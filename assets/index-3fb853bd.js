(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function oi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Sc(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var R1={exports:{}},rh={},k1={exports:{}},he={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bc=Symbol.for("react.element"),NN=Symbol.for("react.portal"),LN=Symbol.for("react.fragment"),IN=Symbol.for("react.strict_mode"),AN=Symbol.for("react.profiler"),MN=Symbol.for("react.provider"),DN=Symbol.for("react.context"),FN=Symbol.for("react.forward_ref"),zN=Symbol.for("react.suspense"),$N=Symbol.for("react.memo"),jN=Symbol.for("react.lazy"),US=Symbol.iterator;function qN(n){return n===null||typeof n!="object"?null:(n=US&&n[US]||n["@@iterator"],typeof n=="function"?n:null)}var N1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L1=Object.assign,I1={};function wa(n,e,t){this.props=n,this.context=e,this.refs=I1,this.updater=t||N1}wa.prototype.isReactComponent={};wa.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};wa.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function A1(){}A1.prototype=wa.prototype;function Wv(n,e,t){this.props=n,this.context=e,this.refs=I1,this.updater=t||N1}var Vv=Wv.prototype=new A1;Vv.constructor=Wv;L1(Vv,wa.prototype);Vv.isPureReactComponent=!0;var HS=Array.isArray,M1=Object.prototype.hasOwnProperty,Gv={current:null},D1={key:!0,ref:!0,__self:!0,__source:!0};function F1(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)M1.call(e,r)&&!D1.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:bc,type:n,key:s,ref:o,props:i,_owner:Gv.current}}function BN(n,e){return{$$typeof:bc,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Kv(n){return typeof n=="object"&&n!==null&&n.$$typeof===bc}function UN(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var WS=/\/+/g;function Lf(n,e){return typeof n=="object"&&n!==null&&n.key!=null?UN(""+n.key):e.toString(36)}function ku(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case bc:case NN:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+Lf(o,0):r,HS(i)?(t="",n!=null&&(t=n.replace(WS,"$&/")+"/"),ku(i,e,t,"",function(c){return c})):i!=null&&(Kv(i)&&(i=BN(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(WS,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",HS(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+Lf(s,a);o+=ku(s,e,t,l,i)}else if(l=qN(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+Lf(s,a++),o+=ku(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function eu(n,e,t){if(n==null)return n;var r=[],i=0;return ku(n,r,"","",function(s){return e.call(t,s,i++)}),r}function HN(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Jt={current:null},Nu={transition:null},WN={ReactCurrentDispatcher:Jt,ReactCurrentBatchConfig:Nu,ReactCurrentOwner:Gv};function z1(){throw Error("act(...) is not supported in production builds of React.")}he.Children={map:eu,forEach:function(n,e,t){eu(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return eu(n,function(){e++}),e},toArray:function(n){return eu(n,function(e){return e})||[]},only:function(n){if(!Kv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};he.Component=wa;he.Fragment=LN;he.Profiler=AN;he.PureComponent=Wv;he.StrictMode=IN;he.Suspense=zN;he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WN;he.act=z1;he.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=L1({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Gv.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)M1.call(e,l)&&!D1.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:bc,type:n.type,key:i,ref:s,props:r,_owner:o}};he.createContext=function(n){return n={$$typeof:DN,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:MN,_context:n},n.Consumer=n};he.createElement=F1;he.createFactory=function(n){var e=F1.bind(null,n);return e.type=n,e};he.createRef=function(){return{current:null}};he.forwardRef=function(n){return{$$typeof:FN,render:n}};he.isValidElement=Kv;he.lazy=function(n){return{$$typeof:jN,_payload:{_status:-1,_result:n},_init:HN}};he.memo=function(n,e){return{$$typeof:$N,type:n,compare:e===void 0?null:e}};he.startTransition=function(n){var e=Nu.transition;Nu.transition={};try{n()}finally{Nu.transition=e}};he.unstable_act=z1;he.useCallback=function(n,e){return Jt.current.useCallback(n,e)};he.useContext=function(n){return Jt.current.useContext(n)};he.useDebugValue=function(){};he.useDeferredValue=function(n){return Jt.current.useDeferredValue(n)};he.useEffect=function(n,e){return Jt.current.useEffect(n,e)};he.useId=function(){return Jt.current.useId()};he.useImperativeHandle=function(n,e,t){return Jt.current.useImperativeHandle(n,e,t)};he.useInsertionEffect=function(n,e){return Jt.current.useInsertionEffect(n,e)};he.useLayoutEffect=function(n,e){return Jt.current.useLayoutEffect(n,e)};he.useMemo=function(n,e){return Jt.current.useMemo(n,e)};he.useReducer=function(n,e,t){return Jt.current.useReducer(n,e,t)};he.useRef=function(n){return Jt.current.useRef(n)};he.useState=function(n){return Jt.current.useState(n)};he.useSyncExternalStore=function(n,e,t){return Jt.current.useSyncExternalStore(n,e,t)};he.useTransition=function(){return Jt.current.useTransition()};he.version="18.3.1";k1.exports=he;var H=k1.exports;const VN=oi(H);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GN=H,KN=Symbol.for("react.element"),JN=Symbol.for("react.fragment"),QN=Object.prototype.hasOwnProperty,XN=GN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,YN={key:!0,ref:!0,__self:!0,__source:!0};function $1(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)QN.call(e,r)&&!YN.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:KN,type:n,key:s,ref:o,props:i,_owner:XN.current}}rh.Fragment=JN;rh.jsx=$1;rh.jsxs=$1;R1.exports=rh;var D=R1.exports,Im={},j1={exports:{}},Tn={},q1={exports:{}},B1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(A,B){var k=A.length;A.push(B);e:for(;0<k;){var $=k-1>>>1,T=A[$];if(0<i(T,B))A[$]=B,A[k]=T,k=$;else break e}}function t(A){return A.length===0?null:A[0]}function r(A){if(A.length===0)return null;var B=A[0],k=A.pop();if(k!==B){A[0]=k;e:for(var $=0,T=A.length,I=T>>>1;$<I;){var C=2*($+1)-1,R=A[C],L=C+1,U=A[L];if(0>i(R,k))L<T&&0>i(U,R)?(A[$]=U,A[L]=k,$=L):(A[$]=R,A[C]=k,$=C);else if(L<T&&0>i(U,k))A[$]=U,A[L]=k,$=L;else break e}}return B}function i(A,B){var k=A.sortIndex-B.sortIndex;return k!==0?k:A.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,g=!1,S=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(A){for(var B=t(c);B!==null;){if(B.callback===null)r(c);else if(B.startTime<=A)r(c),B.sortIndex=B.expirationTime,e(l,B);else break;B=t(c)}}function b(A){if(g=!1,y(A),!p)if(t(l)!==null)p=!0,N(w);else{var B=t(c);B!==null&&W(b,B.startTime-A)}}function w(A,B){p=!1,g&&(g=!1,m(P),P=-1),f=!0;var k=h;try{for(y(B),d=t(l);d!==null&&(!(d.expirationTime>B)||A&&!G());){var $=d.callback;if(typeof $=="function"){d.callback=null,h=d.priorityLevel;var T=$(d.expirationTime<=B);B=n.unstable_now(),typeof T=="function"?d.callback=T:d===t(l)&&r(l),y(B)}else r(l);d=t(l)}if(d!==null)var I=!0;else{var C=t(c);C!==null&&W(b,C.startTime-B),I=!1}return I}finally{d=null,h=k,f=!1}}var x=!1,E=null,P=-1,M=5,F=-1;function G(){return!(n.unstable_now()-F<M)}function z(){if(E!==null){var A=n.unstable_now();F=A;var B=!0;try{B=E(!0,A)}finally{B?X():(x=!1,E=null)}}else x=!1}var X;if(typeof v=="function")X=function(){v(z)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,_=V.port2;V.port1.onmessage=z,X=function(){_.postMessage(null)}}else X=function(){S(z,0)};function N(A){E=A,x||(x=!0,X())}function W(A,B){P=S(function(){A(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(A){A.callback=null},n.unstable_continueExecution=function(){p||f||(p=!0,N(w))},n.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<A?Math.floor(1e3/A):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(A){switch(h){case 1:case 2:case 3:var B=3;break;default:B=h}var k=h;h=B;try{return A()}finally{h=k}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(A,B){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var k=h;h=A;try{return B()}finally{h=k}},n.unstable_scheduleCallback=function(A,B,k){var $=n.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?$+k:$):k=$,A){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=k+T,A={id:u++,callback:B,priorityLevel:A,startTime:k,expirationTime:T,sortIndex:-1},k>$?(A.sortIndex=k,e(c,A),t(l)===null&&A===t(c)&&(g?(m(P),P=-1):g=!0,W(b,k-$))):(A.sortIndex=T,e(l,A),p||f||(p=!0,N(w))),A},n.unstable_shouldYield=G,n.unstable_wrapCallback=function(A){var B=h;return function(){var k=h;h=B;try{return A.apply(this,arguments)}finally{h=k}}}})(B1);q1.exports=B1;var ZN=q1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eL=H,wn=ZN;function j(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var U1=new Set,zl={};function eo(n,e){ra(n,e),ra(n+"Capture",e)}function ra(n,e){for(zl[n]=e,n=0;n<e.length;n++)U1.add(e[n])}var Zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Am=Object.prototype.hasOwnProperty,tL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,VS={},GS={};function nL(n){return Am.call(GS,n)?!0:Am.call(VS,n)?!1:tL.test(n)?GS[n]=!0:(VS[n]=!0,!1)}function rL(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function iL(n,e,t,r){if(e===null||typeof e>"u"||rL(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Qt(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Tt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Tt[n]=new Qt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Tt[e]=new Qt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Tt[n]=new Qt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Tt[n]=new Qt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Tt[n]=new Qt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Tt[n]=new Qt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Tt[n]=new Qt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Tt[n]=new Qt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Tt[n]=new Qt(n,5,!1,n.toLowerCase(),null,!1,!1)});var Jv=/[\-:]([a-z])/g;function Qv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Jv,Qv);Tt[e]=new Qt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Jv,Qv);Tt[e]=new Qt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Jv,Qv);Tt[e]=new Qt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Tt[n]=new Qt(n,1,!1,n.toLowerCase(),null,!1,!1)});Tt.xlinkHref=new Qt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Tt[n]=new Qt(n,1,!1,n.toLowerCase(),null,!0,!0)});function Xv(n,e,t,r){var i=Tt.hasOwnProperty(e)?Tt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(iL(e,t,i,r)&&(t=null),r||i===null?nL(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ai=eL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tu=Symbol.for("react.element"),xo=Symbol.for("react.portal"),Oo=Symbol.for("react.fragment"),Yv=Symbol.for("react.strict_mode"),Mm=Symbol.for("react.profiler"),H1=Symbol.for("react.provider"),W1=Symbol.for("react.context"),Zv=Symbol.for("react.forward_ref"),Dm=Symbol.for("react.suspense"),Fm=Symbol.for("react.suspense_list"),ey=Symbol.for("react.memo"),yi=Symbol.for("react.lazy"),V1=Symbol.for("react.offscreen"),KS=Symbol.iterator;function Ba(n){return n===null||typeof n!="object"?null:(n=KS&&n[KS]||n["@@iterator"],typeof n=="function"?n:null)}var Ve=Object.assign,If;function cl(n){if(If===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);If=e&&e[1]||""}return`
`+If+n}var Af=!1;function Mf(n,e){if(!n||Af)return"";Af=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Af=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?cl(n):""}function sL(n){switch(n.tag){case 5:return cl(n.type);case 16:return cl("Lazy");case 13:return cl("Suspense");case 19:return cl("SuspenseList");case 0:case 2:case 15:return n=Mf(n.type,!1),n;case 11:return n=Mf(n.type.render,!1),n;case 1:return n=Mf(n.type,!0),n;default:return""}}function zm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Oo:return"Fragment";case xo:return"Portal";case Mm:return"Profiler";case Yv:return"StrictMode";case Dm:return"Suspense";case Fm:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case W1:return(n.displayName||"Context")+".Consumer";case H1:return(n._context.displayName||"Context")+".Provider";case Zv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ey:return e=n.displayName||null,e!==null?e:zm(n.type)||"Memo";case yi:e=n._payload,n=n._init;try{return zm(n(e))}catch{}}return null}function oL(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zm(e);case 8:return e===Yv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Qi(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function G1(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function aL(n){var e=G1(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function nu(n){n._valueTracker||(n._valueTracker=aL(n))}function K1(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=G1(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function id(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function $m(n,e){var t=e.checked;return Ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function JS(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Qi(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function J1(n,e){e=e.checked,e!=null&&Xv(n,"checked",e,!1)}function jm(n,e){J1(n,e);var t=Qi(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?qm(n,e.type,t):e.hasOwnProperty("defaultValue")&&qm(n,e.type,Qi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function QS(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function qm(n,e,t){(e!=="number"||id(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var ul=Array.isArray;function jo(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Qi(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Bm(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(j(91));return Ve({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function XS(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(j(92));if(ul(t)){if(1<t.length)throw Error(j(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Qi(t)}}function Q1(n,e){var t=Qi(e.value),r=Qi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function YS(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function X1(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Um(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?X1(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ru,Y1=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ru=ru||document.createElement("div"),ru.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ru.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function $l(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var gl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lL=["Webkit","ms","Moz","O"];Object.keys(gl).forEach(function(n){lL.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),gl[e]=gl[n]})});function Z1(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||gl.hasOwnProperty(n)&&gl[n]?(""+e).trim():e+"px"}function eT(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Z1(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var cL=Ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hm(n,e){if(e){if(cL[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(j(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(j(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(j(61))}if(e.style!=null&&typeof e.style!="object")throw Error(j(62))}}function Wm(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vm=null;function ty(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Gm=null,qo=null,Bo=null;function ZS(n){if(n=_c(n)){if(typeof Gm!="function")throw Error(j(280));var e=n.stateNode;e&&(e=lh(e),Gm(n.stateNode,n.type,e))}}function tT(n){qo?Bo?Bo.push(n):Bo=[n]:qo=n}function nT(){if(qo){var n=qo,e=Bo;if(Bo=qo=null,ZS(n),e)for(n=0;n<e.length;n++)ZS(e[n])}}function rT(n,e){return n(e)}function iT(){}var Df=!1;function sT(n,e,t){if(Df)return n(e,t);Df=!0;try{return rT(n,e,t)}finally{Df=!1,(qo!==null||Bo!==null)&&(iT(),nT())}}function jl(n,e){var t=n.stateNode;if(t===null)return null;var r=lh(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(j(231,e,typeof t));return t}var Km=!1;if(Zr)try{var Ua={};Object.defineProperty(Ua,"passive",{get:function(){Km=!0}}),window.addEventListener("test",Ua,Ua),window.removeEventListener("test",Ua,Ua)}catch{Km=!1}function uL(n,e,t,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var vl=!1,sd=null,od=!1,Jm=null,dL={onError:function(n){vl=!0,sd=n}};function hL(n,e,t,r,i,s,o,a,l){vl=!1,sd=null,uL.apply(dL,arguments)}function fL(n,e,t,r,i,s,o,a,l){if(hL.apply(this,arguments),vl){if(vl){var c=sd;vl=!1,sd=null}else throw Error(j(198));od||(od=!0,Jm=c)}}function to(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function oT(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function eb(n){if(to(n)!==n)throw Error(j(188))}function pL(n){var e=n.alternate;if(!e){if(e=to(n),e===null)throw Error(j(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return eb(i),n;if(s===r)return eb(i),e;s=s.sibling}throw Error(j(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(j(189))}}if(t.alternate!==r)throw Error(j(190))}if(t.tag!==3)throw Error(j(188));return t.stateNode.current===t?n:e}function aT(n){return n=pL(n),n!==null?lT(n):null}function lT(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=lT(n);if(e!==null)return e;n=n.sibling}return null}var cT=wn.unstable_scheduleCallback,tb=wn.unstable_cancelCallback,mL=wn.unstable_shouldYield,gL=wn.unstable_requestPaint,Xe=wn.unstable_now,vL=wn.unstable_getCurrentPriorityLevel,ny=wn.unstable_ImmediatePriority,uT=wn.unstable_UserBlockingPriority,ad=wn.unstable_NormalPriority,yL=wn.unstable_LowPriority,dT=wn.unstable_IdlePriority,ih=null,Sr=null;function SL(n){if(Sr&&typeof Sr.onCommitFiberRoot=="function")try{Sr.onCommitFiberRoot(ih,n,void 0,(n.current.flags&128)===128)}catch{}}var Zn=Math.clz32?Math.clz32:CL,bL=Math.log,wL=Math.LN2;function CL(n){return n>>>=0,n===0?32:31-(bL(n)/wL|0)|0}var iu=64,su=4194304;function dl(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ld(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=dl(a):(s&=o,s!==0&&(r=dl(s)))}else o=t&~i,o!==0?r=dl(o):s!==0&&(r=dl(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Zn(e),i=1<<t,r|=n[t],e&=~i;return r}function _L(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function EL(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-Zn(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=_L(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function Qm(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function hT(){var n=iu;return iu<<=1,!(iu&4194240)&&(iu=64),n}function Ff(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function wc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Zn(e),n[e]=t}function TL(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Zn(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function ry(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Zn(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Te=0;function fT(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var pT,iy,mT,gT,vT,Xm=!1,ou=[],Ai=null,Mi=null,Di=null,ql=new Map,Bl=new Map,Ci=[],xL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nb(n,e){switch(n){case"focusin":case"focusout":Ai=null;break;case"dragenter":case"dragleave":Mi=null;break;case"mouseover":case"mouseout":Di=null;break;case"pointerover":case"pointerout":ql.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bl.delete(e.pointerId)}}function Ha(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=_c(e),e!==null&&iy(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function OL(n,e,t,r,i){switch(e){case"focusin":return Ai=Ha(Ai,n,e,t,r,i),!0;case"dragenter":return Mi=Ha(Mi,n,e,t,r,i),!0;case"mouseover":return Di=Ha(Di,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return ql.set(s,Ha(ql.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Bl.set(s,Ha(Bl.get(s)||null,n,e,t,r,i)),!0}return!1}function yT(n){var e=Ps(n.target);if(e!==null){var t=to(e);if(t!==null){if(e=t.tag,e===13){if(e=oT(t),e!==null){n.blockedOn=e,vT(n.priority,function(){mT(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Lu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Ym(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Vm=r,t.target.dispatchEvent(r),Vm=null}else return e=_c(t),e!==null&&iy(e),n.blockedOn=t,!1;e.shift()}return!0}function rb(n,e,t){Lu(n)&&t.delete(e)}function PL(){Xm=!1,Ai!==null&&Lu(Ai)&&(Ai=null),Mi!==null&&Lu(Mi)&&(Mi=null),Di!==null&&Lu(Di)&&(Di=null),ql.forEach(rb),Bl.forEach(rb)}function Wa(n,e){n.blockedOn===e&&(n.blockedOn=null,Xm||(Xm=!0,wn.unstable_scheduleCallback(wn.unstable_NormalPriority,PL)))}function Ul(n){function e(i){return Wa(i,n)}if(0<ou.length){Wa(ou[0],n);for(var t=1;t<ou.length;t++){var r=ou[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ai!==null&&Wa(Ai,n),Mi!==null&&Wa(Mi,n),Di!==null&&Wa(Di,n),ql.forEach(e),Bl.forEach(e),t=0;t<Ci.length;t++)r=Ci[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ci.length&&(t=Ci[0],t.blockedOn===null);)yT(t),t.blockedOn===null&&Ci.shift()}var Uo=ai.ReactCurrentBatchConfig,cd=!0;function RL(n,e,t,r){var i=Te,s=Uo.transition;Uo.transition=null;try{Te=1,sy(n,e,t,r)}finally{Te=i,Uo.transition=s}}function kL(n,e,t,r){var i=Te,s=Uo.transition;Uo.transition=null;try{Te=4,sy(n,e,t,r)}finally{Te=i,Uo.transition=s}}function sy(n,e,t,r){if(cd){var i=Ym(n,e,t,r);if(i===null)Gf(n,e,r,ud,t),nb(n,r);else if(OL(i,n,e,t,r))r.stopPropagation();else if(nb(n,r),e&4&&-1<xL.indexOf(n)){for(;i!==null;){var s=_c(i);if(s!==null&&pT(s),s=Ym(n,e,t,r),s===null&&Gf(n,e,r,ud,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else Gf(n,e,r,null,t)}}var ud=null;function Ym(n,e,t,r){if(ud=null,n=ty(r),n=Ps(n),n!==null)if(e=to(n),e===null)n=null;else if(t=e.tag,t===13){if(n=oT(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return ud=n,null}function ST(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vL()){case ny:return 1;case uT:return 4;case ad:case yL:return 16;case dT:return 536870912;default:return 16}default:return 16}}var Ti=null,oy=null,Iu=null;function bT(){if(Iu)return Iu;var n,e=oy,t=e.length,r,i="value"in Ti?Ti.value:Ti.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return Iu=i.slice(n,1<r?1-r:void 0)}function Au(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function au(){return!0}function ib(){return!1}function xn(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?au:ib,this.isPropagationStopped=ib,this}return Ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=au)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=au)},persist:function(){},isPersistent:au}),e}var Ca={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ay=xn(Ca),Cc=Ve({},Ca,{view:0,detail:0}),NL=xn(Cc),zf,$f,Va,sh=Ve({},Cc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ly,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Va&&(Va&&n.type==="mousemove"?(zf=n.screenX-Va.screenX,$f=n.screenY-Va.screenY):$f=zf=0,Va=n),zf)},movementY:function(n){return"movementY"in n?n.movementY:$f}}),sb=xn(sh),LL=Ve({},sh,{dataTransfer:0}),IL=xn(LL),AL=Ve({},Cc,{relatedTarget:0}),jf=xn(AL),ML=Ve({},Ca,{animationName:0,elapsedTime:0,pseudoElement:0}),DL=xn(ML),FL=Ve({},Ca,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),zL=xn(FL),$L=Ve({},Ca,{data:0}),ob=xn($L),jL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function UL(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=BL[n])?!!e[n]:!1}function ly(){return UL}var HL=Ve({},Cc,{key:function(n){if(n.key){var e=jL[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Au(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?qL[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ly,charCode:function(n){return n.type==="keypress"?Au(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Au(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),WL=xn(HL),VL=Ve({},sh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ab=xn(VL),GL=Ve({},Cc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ly}),KL=xn(GL),JL=Ve({},Ca,{propertyName:0,elapsedTime:0,pseudoElement:0}),QL=xn(JL),XL=Ve({},sh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),YL=xn(XL),ZL=[9,13,27,32],cy=Zr&&"CompositionEvent"in window,yl=null;Zr&&"documentMode"in document&&(yl=document.documentMode);var eI=Zr&&"TextEvent"in window&&!yl,wT=Zr&&(!cy||yl&&8<yl&&11>=yl),lb=String.fromCharCode(32),cb=!1;function CT(n,e){switch(n){case"keyup":return ZL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _T(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Po=!1;function tI(n,e){switch(n){case"compositionend":return _T(e);case"keypress":return e.which!==32?null:(cb=!0,lb);case"textInput":return n=e.data,n===lb&&cb?null:n;default:return null}}function nI(n,e){if(Po)return n==="compositionend"||!cy&&CT(n,e)?(n=bT(),Iu=oy=Ti=null,Po=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return wT&&e.locale!=="ko"?null:e.data;default:return null}}var rI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ub(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!rI[n.type]:e==="textarea"}function ET(n,e,t,r){tT(r),e=dd(e,"onChange"),0<e.length&&(t=new ay("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Sl=null,Hl=null;function iI(n){MT(n,0)}function oh(n){var e=No(n);if(K1(e))return n}function sI(n,e){if(n==="change")return e}var TT=!1;if(Zr){var qf;if(Zr){var Bf="oninput"in document;if(!Bf){var db=document.createElement("div");db.setAttribute("oninput","return;"),Bf=typeof db.oninput=="function"}qf=Bf}else qf=!1;TT=qf&&(!document.documentMode||9<document.documentMode)}function hb(){Sl&&(Sl.detachEvent("onpropertychange",xT),Hl=Sl=null)}function xT(n){if(n.propertyName==="value"&&oh(Hl)){var e=[];ET(e,Hl,n,ty(n)),sT(iI,e)}}function oI(n,e,t){n==="focusin"?(hb(),Sl=e,Hl=t,Sl.attachEvent("onpropertychange",xT)):n==="focusout"&&hb()}function aI(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return oh(Hl)}function lI(n,e){if(n==="click")return oh(e)}function cI(n,e){if(n==="input"||n==="change")return oh(e)}function uI(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var rr=typeof Object.is=="function"?Object.is:uI;function Wl(n,e){if(rr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Am.call(e,i)||!rr(n[i],e[i]))return!1}return!0}function fb(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function pb(n,e){var t=fb(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=fb(t)}}function OT(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?OT(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function PT(){for(var n=window,e=id();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=id(n.document)}return e}function uy(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function dI(n){var e=PT(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&OT(t.ownerDocument.documentElement,t)){if(r!==null&&uy(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=pb(t,s);var o=pb(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var hI=Zr&&"documentMode"in document&&11>=document.documentMode,Ro=null,Zm=null,bl=null,eg=!1;function mb(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;eg||Ro==null||Ro!==id(r)||(r=Ro,"selectionStart"in r&&uy(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bl&&Wl(bl,r)||(bl=r,r=dd(Zm,"onSelect"),0<r.length&&(e=new ay("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ro)))}function lu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ko={animationend:lu("Animation","AnimationEnd"),animationiteration:lu("Animation","AnimationIteration"),animationstart:lu("Animation","AnimationStart"),transitionend:lu("Transition","TransitionEnd")},Uf={},RT={};Zr&&(RT=document.createElement("div").style,"AnimationEvent"in window||(delete ko.animationend.animation,delete ko.animationiteration.animation,delete ko.animationstart.animation),"TransitionEvent"in window||delete ko.transitionend.transition);function ah(n){if(Uf[n])return Uf[n];if(!ko[n])return n;var e=ko[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in RT)return Uf[n]=e[t];return n}var kT=ah("animationend"),NT=ah("animationiteration"),LT=ah("animationstart"),IT=ah("transitionend"),AT=new Map,gb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ts(n,e){AT.set(n,e),eo(e,[n])}for(var Hf=0;Hf<gb.length;Hf++){var Wf=gb[Hf],fI=Wf.toLowerCase(),pI=Wf[0].toUpperCase()+Wf.slice(1);ts(fI,"on"+pI)}ts(kT,"onAnimationEnd");ts(NT,"onAnimationIteration");ts(LT,"onAnimationStart");ts("dblclick","onDoubleClick");ts("focusin","onFocus");ts("focusout","onBlur");ts(IT,"onTransitionEnd");ra("onMouseEnter",["mouseout","mouseover"]);ra("onMouseLeave",["mouseout","mouseover"]);ra("onPointerEnter",["pointerout","pointerover"]);ra("onPointerLeave",["pointerout","pointerover"]);eo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));eo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));eo("onBeforeInput",["compositionend","keypress","textInput","paste"]);eo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));eo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));eo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mI=new Set("cancel close invalid load scroll toggle".split(" ").concat(hl));function vb(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,fL(r,e,void 0,n),n.currentTarget=null}function MT(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;vb(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;vb(i,a,c),s=l}}}if(od)throw n=Jm,od=!1,Jm=null,n}function Le(n,e){var t=e[sg];t===void 0&&(t=e[sg]=new Set);var r=n+"__bubble";t.has(r)||(DT(e,n,2,!1),t.add(r))}function Vf(n,e,t){var r=0;e&&(r|=4),DT(t,n,r,e)}var cu="_reactListening"+Math.random().toString(36).slice(2);function Vl(n){if(!n[cu]){n[cu]=!0,U1.forEach(function(t){t!=="selectionchange"&&(mI.has(t)||Vf(t,!1,n),Vf(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[cu]||(e[cu]=!0,Vf("selectionchange",!1,e))}}function DT(n,e,t,r){switch(ST(e)){case 1:var i=RL;break;case 4:i=kL;break;default:i=sy}t=i.bind(null,e,t,n),i=void 0,!Km||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Gf(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Ps(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}sT(function(){var c=s,u=ty(t),d=[];e:{var h=AT.get(n);if(h!==void 0){var f=ay,p=n;switch(n){case"keypress":if(Au(t)===0)break e;case"keydown":case"keyup":f=WL;break;case"focusin":p="focus",f=jf;break;case"focusout":p="blur",f=jf;break;case"beforeblur":case"afterblur":f=jf;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=sb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=IL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=KL;break;case kT:case NT:case LT:f=DL;break;case IT:f=QL;break;case"scroll":f=NL;break;case"wheel":f=YL;break;case"copy":case"cut":case"paste":f=zL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=ab}var g=(e&4)!==0,S=!g&&n==="scroll",m=g?h!==null?h+"Capture":null:h;g=[];for(var v=c,y;v!==null;){y=v;var b=y.stateNode;if(y.tag===5&&b!==null&&(y=b,m!==null&&(b=jl(v,m),b!=null&&g.push(Gl(v,b,y)))),S)break;v=v.return}0<g.length&&(h=new f(h,p,null,t,u),d.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==Vm&&(p=t.relatedTarget||t.fromElement)&&(Ps(p)||p[ei]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=c,p=p?Ps(p):null,p!==null&&(S=to(p),p!==S||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(g=sb,b="onMouseLeave",m="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(g=ab,b="onPointerLeave",m="onPointerEnter",v="pointer"),S=f==null?h:No(f),y=p==null?h:No(p),h=new g(b,v+"leave",f,t,u),h.target=S,h.relatedTarget=y,b=null,Ps(u)===c&&(g=new g(m,v+"enter",p,t,u),g.target=y,g.relatedTarget=S,b=g),S=b,f&&p)t:{for(g=f,m=p,v=0,y=g;y;y=po(y))v++;for(y=0,b=m;b;b=po(b))y++;for(;0<v-y;)g=po(g),v--;for(;0<y-v;)m=po(m),y--;for(;v--;){if(g===m||m!==null&&g===m.alternate)break t;g=po(g),m=po(m)}g=null}else g=null;f!==null&&yb(d,h,f,g,!1),p!==null&&S!==null&&yb(d,S,p,g,!0)}}e:{if(h=c?No(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var w=sI;else if(ub(h))if(TT)w=cI;else{w=aI;var x=oI}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(w=lI);if(w&&(w=w(n,c))){ET(d,w,t,u);break e}x&&x(n,h,c),n==="focusout"&&(x=h._wrapperState)&&x.controlled&&h.type==="number"&&qm(h,"number",h.value)}switch(x=c?No(c):window,n){case"focusin":(ub(x)||x.contentEditable==="true")&&(Ro=x,Zm=c,bl=null);break;case"focusout":bl=Zm=Ro=null;break;case"mousedown":eg=!0;break;case"contextmenu":case"mouseup":case"dragend":eg=!1,mb(d,t,u);break;case"selectionchange":if(hI)break;case"keydown":case"keyup":mb(d,t,u)}var E;if(cy)e:{switch(n){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else Po?CT(n,t)&&(P="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(P="onCompositionStart");P&&(wT&&t.locale!=="ko"&&(Po||P!=="onCompositionStart"?P==="onCompositionEnd"&&Po&&(E=bT()):(Ti=u,oy="value"in Ti?Ti.value:Ti.textContent,Po=!0)),x=dd(c,P),0<x.length&&(P=new ob(P,n,null,t,u),d.push({event:P,listeners:x}),E?P.data=E:(E=_T(t),E!==null&&(P.data=E)))),(E=eI?tI(n,t):nI(n,t))&&(c=dd(c,"onBeforeInput"),0<c.length&&(u=new ob("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=E))}MT(d,e)})}function Gl(n,e,t){return{instance:n,listener:e,currentTarget:t}}function dd(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=jl(n,t),s!=null&&r.unshift(Gl(n,s,i)),s=jl(n,e),s!=null&&r.push(Gl(n,s,i))),n=n.return}return r}function po(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function yb(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=jl(t,s),l!=null&&o.unshift(Gl(t,l,a))):i||(l=jl(t,s),l!=null&&o.push(Gl(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var gI=/\r\n?/g,vI=/\u0000|\uFFFD/g;function Sb(n){return(typeof n=="string"?n:""+n).replace(gI,`
`).replace(vI,"")}function uu(n,e,t){if(e=Sb(e),Sb(n)!==e&&t)throw Error(j(425))}function hd(){}var tg=null,ng=null;function rg(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ig=typeof setTimeout=="function"?setTimeout:void 0,yI=typeof clearTimeout=="function"?clearTimeout:void 0,bb=typeof Promise=="function"?Promise:void 0,SI=typeof queueMicrotask=="function"?queueMicrotask:typeof bb<"u"?function(n){return bb.resolve(null).then(n).catch(bI)}:ig;function bI(n){setTimeout(function(){throw n})}function Kf(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Ul(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Ul(e)}function Fi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function wb(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var _a=Math.random().toString(36).slice(2),pr="__reactFiber$"+_a,Kl="__reactProps$"+_a,ei="__reactContainer$"+_a,sg="__reactEvents$"+_a,wI="__reactListeners$"+_a,CI="__reactHandles$"+_a;function Ps(n){var e=n[pr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ei]||t[pr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=wb(n);n!==null;){if(t=n[pr])return t;n=wb(n)}return e}n=t,t=n.parentNode}return null}function _c(n){return n=n[pr]||n[ei],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function No(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(j(33))}function lh(n){return n[Kl]||null}var og=[],Lo=-1;function ns(n){return{current:n}}function Me(n){0>Lo||(n.current=og[Lo],og[Lo]=null,Lo--)}function Ne(n,e){Lo++,og[Lo]=n.current,n.current=e}var Xi={},Ft=ns(Xi),rn=ns(!1),qs=Xi;function ia(n,e){var t=n.type.contextTypes;if(!t)return Xi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function sn(n){return n=n.childContextTypes,n!=null}function fd(){Me(rn),Me(Ft)}function Cb(n,e,t){if(Ft.current!==Xi)throw Error(j(168));Ne(Ft,e),Ne(rn,t)}function FT(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(j(108,oL(n)||"Unknown",i));return Ve({},t,r)}function pd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Xi,qs=Ft.current,Ne(Ft,n),Ne(rn,rn.current),!0}function _b(n,e,t){var r=n.stateNode;if(!r)throw Error(j(169));t?(n=FT(n,e,qs),r.__reactInternalMemoizedMergedChildContext=n,Me(rn),Me(Ft),Ne(Ft,n)):Me(rn),Ne(rn,t)}var Ur=null,ch=!1,Jf=!1;function zT(n){Ur===null?Ur=[n]:Ur.push(n)}function _I(n){ch=!0,zT(n)}function rs(){if(!Jf&&Ur!==null){Jf=!0;var n=0,e=Te;try{var t=Ur;for(Te=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Ur=null,ch=!1}catch(i){throw Ur!==null&&(Ur=Ur.slice(n+1)),cT(ny,rs),i}finally{Te=e,Jf=!1}}return null}var Io=[],Ao=0,md=null,gd=0,Rn=[],kn=0,Bs=null,Wr=1,Vr="";function us(n,e){Io[Ao++]=gd,Io[Ao++]=md,md=n,gd=e}function $T(n,e,t){Rn[kn++]=Wr,Rn[kn++]=Vr,Rn[kn++]=Bs,Bs=n;var r=Wr;n=Vr;var i=32-Zn(r)-1;r&=~(1<<i),t+=1;var s=32-Zn(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Wr=1<<32-Zn(e)+i|t<<i|r,Vr=s+n}else Wr=1<<s|t<<i|r,Vr=n}function dy(n){n.return!==null&&(us(n,1),$T(n,1,0))}function hy(n){for(;n===md;)md=Io[--Ao],Io[Ao]=null,gd=Io[--Ao],Io[Ao]=null;for(;n===Bs;)Bs=Rn[--kn],Rn[kn]=null,Vr=Rn[--kn],Rn[kn]=null,Wr=Rn[--kn],Rn[kn]=null}var bn=null,yn=null,$e=!1,Qn=null;function jT(n,e){var t=Mn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Eb(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,bn=n,yn=Fi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,bn=n,yn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Bs!==null?{id:Wr,overflow:Vr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Mn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,bn=n,yn=null,!0):!1;default:return!1}}function ag(n){return(n.mode&1)!==0&&(n.flags&128)===0}function lg(n){if($e){var e=yn;if(e){var t=e;if(!Eb(n,e)){if(ag(n))throw Error(j(418));e=Fi(t.nextSibling);var r=bn;e&&Eb(n,e)?jT(r,t):(n.flags=n.flags&-4097|2,$e=!1,bn=n)}}else{if(ag(n))throw Error(j(418));n.flags=n.flags&-4097|2,$e=!1,bn=n}}}function Tb(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;bn=n}function du(n){if(n!==bn)return!1;if(!$e)return Tb(n),$e=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!rg(n.type,n.memoizedProps)),e&&(e=yn)){if(ag(n))throw qT(),Error(j(418));for(;e;)jT(n,e),e=Fi(e.nextSibling)}if(Tb(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(j(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){yn=Fi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}yn=null}}else yn=bn?Fi(n.stateNode.nextSibling):null;return!0}function qT(){for(var n=yn;n;)n=Fi(n.nextSibling)}function sa(){yn=bn=null,$e=!1}function fy(n){Qn===null?Qn=[n]:Qn.push(n)}var EI=ai.ReactCurrentBatchConfig;function Ga(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(j(309));var r=t.stateNode}if(!r)throw Error(j(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(j(284));if(!t._owner)throw Error(j(290,n))}return n}function hu(n,e){throw n=Object.prototype.toString.call(e),Error(j(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function xb(n){var e=n._init;return e(n._payload)}function BT(n){function e(m,v){if(n){var y=m.deletions;y===null?(m.deletions=[v],m.flags|=16):y.push(v)}}function t(m,v){if(!n)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function r(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function i(m,v){return m=qi(m,v),m.index=0,m.sibling=null,m}function s(m,v,y){return m.index=y,n?(y=m.alternate,y!==null?(y=y.index,y<v?(m.flags|=2,v):y):(m.flags|=2,v)):(m.flags|=1048576,v)}function o(m){return n&&m.alternate===null&&(m.flags|=2),m}function a(m,v,y,b){return v===null||v.tag!==6?(v=np(y,m.mode,b),v.return=m,v):(v=i(v,y),v.return=m,v)}function l(m,v,y,b){var w=y.type;return w===Oo?u(m,v,y.props.children,b,y.key):v!==null&&(v.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===yi&&xb(w)===v.type)?(b=i(v,y.props),b.ref=Ga(m,v,y),b.return=m,b):(b=qu(y.type,y.key,y.props,null,m.mode,b),b.ref=Ga(m,v,y),b.return=m,b)}function c(m,v,y,b){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=rp(y,m.mode,b),v.return=m,v):(v=i(v,y.children||[]),v.return=m,v)}function u(m,v,y,b,w){return v===null||v.tag!==7?(v=Ms(y,m.mode,b,w),v.return=m,v):(v=i(v,y),v.return=m,v)}function d(m,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=np(""+v,m.mode,y),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case tu:return y=qu(v.type,v.key,v.props,null,m.mode,y),y.ref=Ga(m,null,v),y.return=m,y;case xo:return v=rp(v,m.mode,y),v.return=m,v;case yi:var b=v._init;return d(m,b(v._payload),y)}if(ul(v)||Ba(v))return v=Ms(v,m.mode,y,null),v.return=m,v;hu(m,v)}return null}function h(m,v,y,b){var w=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return w!==null?null:a(m,v,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case tu:return y.key===w?l(m,v,y,b):null;case xo:return y.key===w?c(m,v,y,b):null;case yi:return w=y._init,h(m,v,w(y._payload),b)}if(ul(y)||Ba(y))return w!==null?null:u(m,v,y,b,null);hu(m,y)}return null}function f(m,v,y,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return m=m.get(y)||null,a(v,m,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case tu:return m=m.get(b.key===null?y:b.key)||null,l(v,m,b,w);case xo:return m=m.get(b.key===null?y:b.key)||null,c(v,m,b,w);case yi:var x=b._init;return f(m,v,y,x(b._payload),w)}if(ul(b)||Ba(b))return m=m.get(y)||null,u(v,m,b,w,null);hu(v,b)}return null}function p(m,v,y,b){for(var w=null,x=null,E=v,P=v=0,M=null;E!==null&&P<y.length;P++){E.index>P?(M=E,E=null):M=E.sibling;var F=h(m,E,y[P],b);if(F===null){E===null&&(E=M);break}n&&E&&F.alternate===null&&e(m,E),v=s(F,v,P),x===null?w=F:x.sibling=F,x=F,E=M}if(P===y.length)return t(m,E),$e&&us(m,P),w;if(E===null){for(;P<y.length;P++)E=d(m,y[P],b),E!==null&&(v=s(E,v,P),x===null?w=E:x.sibling=E,x=E);return $e&&us(m,P),w}for(E=r(m,E);P<y.length;P++)M=f(E,m,P,y[P],b),M!==null&&(n&&M.alternate!==null&&E.delete(M.key===null?P:M.key),v=s(M,v,P),x===null?w=M:x.sibling=M,x=M);return n&&E.forEach(function(G){return e(m,G)}),$e&&us(m,P),w}function g(m,v,y,b){var w=Ba(y);if(typeof w!="function")throw Error(j(150));if(y=w.call(y),y==null)throw Error(j(151));for(var x=w=null,E=v,P=v=0,M=null,F=y.next();E!==null&&!F.done;P++,F=y.next()){E.index>P?(M=E,E=null):M=E.sibling;var G=h(m,E,F.value,b);if(G===null){E===null&&(E=M);break}n&&E&&G.alternate===null&&e(m,E),v=s(G,v,P),x===null?w=G:x.sibling=G,x=G,E=M}if(F.done)return t(m,E),$e&&us(m,P),w;if(E===null){for(;!F.done;P++,F=y.next())F=d(m,F.value,b),F!==null&&(v=s(F,v,P),x===null?w=F:x.sibling=F,x=F);return $e&&us(m,P),w}for(E=r(m,E);!F.done;P++,F=y.next())F=f(E,m,P,F.value,b),F!==null&&(n&&F.alternate!==null&&E.delete(F.key===null?P:F.key),v=s(F,v,P),x===null?w=F:x.sibling=F,x=F);return n&&E.forEach(function(z){return e(m,z)}),$e&&us(m,P),w}function S(m,v,y,b){if(typeof y=="object"&&y!==null&&y.type===Oo&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case tu:e:{for(var w=y.key,x=v;x!==null;){if(x.key===w){if(w=y.type,w===Oo){if(x.tag===7){t(m,x.sibling),v=i(x,y.props.children),v.return=m,m=v;break e}}else if(x.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===yi&&xb(w)===x.type){t(m,x.sibling),v=i(x,y.props),v.ref=Ga(m,x,y),v.return=m,m=v;break e}t(m,x);break}else e(m,x);x=x.sibling}y.type===Oo?(v=Ms(y.props.children,m.mode,b,y.key),v.return=m,m=v):(b=qu(y.type,y.key,y.props,null,m.mode,b),b.ref=Ga(m,v,y),b.return=m,m=b)}return o(m);case xo:e:{for(x=y.key;v!==null;){if(v.key===x)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){t(m,v.sibling),v=i(v,y.children||[]),v.return=m,m=v;break e}else{t(m,v);break}else e(m,v);v=v.sibling}v=rp(y,m.mode,b),v.return=m,m=v}return o(m);case yi:return x=y._init,S(m,v,x(y._payload),b)}if(ul(y))return p(m,v,y,b);if(Ba(y))return g(m,v,y,b);hu(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(t(m,v.sibling),v=i(v,y),v.return=m,m=v):(t(m,v),v=np(y,m.mode,b),v.return=m,m=v),o(m)):t(m,v)}return S}var oa=BT(!0),UT=BT(!1),vd=ns(null),yd=null,Mo=null,py=null;function my(){py=Mo=yd=null}function gy(n){var e=vd.current;Me(vd),n._currentValue=e}function cg(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Ho(n,e){yd=n,py=Mo=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(nn=!0),n.firstContext=null)}function jn(n){var e=n._currentValue;if(py!==n)if(n={context:n,memoizedValue:e,next:null},Mo===null){if(yd===null)throw Error(j(308));Mo=n,yd.dependencies={lanes:0,firstContext:n}}else Mo=Mo.next=n;return e}var Rs=null;function vy(n){Rs===null?Rs=[n]:Rs.push(n)}function HT(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,vy(e)):(t.next=i.next,i.next=t),e.interleaved=t,ti(n,r)}function ti(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Si=!1;function yy(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function WT(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Kr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function zi(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ge&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ti(n,t)}return i=r.interleaved,i===null?(e.next=e,vy(r)):(e.next=i.next,i.next=e),r.interleaved=e,ti(n,t)}function Mu(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ry(n,t)}}function Ob(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Sd(n,e,t,r){var i=n.updateQueue;Si=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,f=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,g=a;switch(h=e,f=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=Ve({},d,h);break e;case 2:Si=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Hs|=o,n.lanes=o,n.memoizedState=d}}function Pb(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(j(191,i));i.call(r)}}}var Ec={},br=ns(Ec),Jl=ns(Ec),Ql=ns(Ec);function ks(n){if(n===Ec)throw Error(j(174));return n}function Sy(n,e){switch(Ne(Ql,e),Ne(Jl,n),Ne(br,Ec),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Um(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Um(e,n)}Me(br),Ne(br,e)}function aa(){Me(br),Me(Jl),Me(Ql)}function VT(n){ks(Ql.current);var e=ks(br.current),t=Um(e,n.type);e!==t&&(Ne(Jl,n),Ne(br,t))}function by(n){Jl.current===n&&(Me(br),Me(Jl))}var Be=ns(0);function bd(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Qf=[];function wy(){for(var n=0;n<Qf.length;n++)Qf[n]._workInProgressVersionPrimary=null;Qf.length=0}var Du=ai.ReactCurrentDispatcher,Xf=ai.ReactCurrentBatchConfig,Us=0,We=null,ot=null,mt=null,wd=!1,wl=!1,Xl=0,TI=0;function xt(){throw Error(j(321))}function Cy(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!rr(n[t],e[t]))return!1;return!0}function _y(n,e,t,r,i,s){if(Us=s,We=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Du.current=n===null||n.memoizedState===null?RI:kI,n=t(r,i),wl){s=0;do{if(wl=!1,Xl=0,25<=s)throw Error(j(301));s+=1,mt=ot=null,e.updateQueue=null,Du.current=NI,n=t(r,i)}while(wl)}if(Du.current=Cd,e=ot!==null&&ot.next!==null,Us=0,mt=ot=We=null,wd=!1,e)throw Error(j(300));return n}function Ey(){var n=Xl!==0;return Xl=0,n}function cr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mt===null?We.memoizedState=mt=n:mt=mt.next=n,mt}function qn(){if(ot===null){var n=We.alternate;n=n!==null?n.memoizedState:null}else n=ot.next;var e=mt===null?We.memoizedState:mt.next;if(e!==null)mt=e,ot=n;else{if(n===null)throw Error(j(310));ot=n,n={memoizedState:ot.memoizedState,baseState:ot.baseState,baseQueue:ot.baseQueue,queue:ot.queue,next:null},mt===null?We.memoizedState=mt=n:mt=mt.next=n}return mt}function Yl(n,e){return typeof e=="function"?e(n):e}function Yf(n){var e=qn(),t=e.queue;if(t===null)throw Error(j(311));t.lastRenderedReducer=n;var r=ot,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Us&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,We.lanes|=u,Hs|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,rr(r,e.memoizedState)||(nn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,We.lanes|=s,Hs|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Zf(n){var e=qn(),t=e.queue;if(t===null)throw Error(j(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);rr(s,e.memoizedState)||(nn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function GT(){}function KT(n,e){var t=We,r=qn(),i=e(),s=!rr(r.memoizedState,i);if(s&&(r.memoizedState=i,nn=!0),r=r.queue,Ty(XT.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||mt!==null&&mt.memoizedState.tag&1){if(t.flags|=2048,Zl(9,QT.bind(null,t,r,i,e),void 0,null),gt===null)throw Error(j(349));Us&30||JT(t,e,i)}return i}function JT(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=We.updateQueue,e===null?(e={lastEffect:null,stores:null},We.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function QT(n,e,t,r){e.value=t,e.getSnapshot=r,YT(e)&&ZT(n)}function XT(n,e,t){return t(function(){YT(e)&&ZT(n)})}function YT(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!rr(n,t)}catch{return!0}}function ZT(n){var e=ti(n,1);e!==null&&er(e,n,1,-1)}function Rb(n){var e=cr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yl,lastRenderedState:n},e.queue=n,n=n.dispatch=PI.bind(null,We,n),[e.memoizedState,n]}function Zl(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=We.updateQueue,e===null?(e={lastEffect:null,stores:null},We.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function ex(){return qn().memoizedState}function Fu(n,e,t,r){var i=cr();We.flags|=n,i.memoizedState=Zl(1|e,t,void 0,r===void 0?null:r)}function uh(n,e,t,r){var i=qn();r=r===void 0?null:r;var s=void 0;if(ot!==null){var o=ot.memoizedState;if(s=o.destroy,r!==null&&Cy(r,o.deps)){i.memoizedState=Zl(e,t,s,r);return}}We.flags|=n,i.memoizedState=Zl(1|e,t,s,r)}function kb(n,e){return Fu(8390656,8,n,e)}function Ty(n,e){return uh(2048,8,n,e)}function tx(n,e){return uh(4,2,n,e)}function nx(n,e){return uh(4,4,n,e)}function rx(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function ix(n,e,t){return t=t!=null?t.concat([n]):null,uh(4,4,rx.bind(null,e,n),t)}function xy(){}function sx(n,e){var t=qn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Cy(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function ox(n,e){var t=qn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Cy(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function ax(n,e,t){return Us&21?(rr(t,e)||(t=hT(),We.lanes|=t,Hs|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,nn=!0),n.memoizedState=t)}function xI(n,e){var t=Te;Te=t!==0&&4>t?t:4,n(!0);var r=Xf.transition;Xf.transition={};try{n(!1),e()}finally{Te=t,Xf.transition=r}}function lx(){return qn().memoizedState}function OI(n,e,t){var r=ji(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},cx(n))ux(e,t);else if(t=HT(n,e,t,r),t!==null){var i=Wt();er(t,n,r,i),dx(t,e,r)}}function PI(n,e,t){var r=ji(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(cx(n))ux(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,rr(a,o)){var l=e.interleaved;l===null?(i.next=i,vy(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=HT(n,e,i,r),t!==null&&(i=Wt(),er(t,n,r,i),dx(t,e,r))}}function cx(n){var e=n.alternate;return n===We||e!==null&&e===We}function ux(n,e){wl=wd=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function dx(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ry(n,t)}}var Cd={readContext:jn,useCallback:xt,useContext:xt,useEffect:xt,useImperativeHandle:xt,useInsertionEffect:xt,useLayoutEffect:xt,useMemo:xt,useReducer:xt,useRef:xt,useState:xt,useDebugValue:xt,useDeferredValue:xt,useTransition:xt,useMutableSource:xt,useSyncExternalStore:xt,useId:xt,unstable_isNewReconciler:!1},RI={readContext:jn,useCallback:function(n,e){return cr().memoizedState=[n,e===void 0?null:e],n},useContext:jn,useEffect:kb,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Fu(4194308,4,rx.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Fu(4194308,4,n,e)},useInsertionEffect:function(n,e){return Fu(4,2,n,e)},useMemo:function(n,e){var t=cr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=cr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=OI.bind(null,We,n),[r.memoizedState,n]},useRef:function(n){var e=cr();return n={current:n},e.memoizedState=n},useState:Rb,useDebugValue:xy,useDeferredValue:function(n){return cr().memoizedState=n},useTransition:function(){var n=Rb(!1),e=n[0];return n=xI.bind(null,n[1]),cr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=We,i=cr();if($e){if(t===void 0)throw Error(j(407));t=t()}else{if(t=e(),gt===null)throw Error(j(349));Us&30||JT(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,kb(XT.bind(null,r,s,n),[n]),r.flags|=2048,Zl(9,QT.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=cr(),e=gt.identifierPrefix;if($e){var t=Vr,r=Wr;t=(r&~(1<<32-Zn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Xl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=TI++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},kI={readContext:jn,useCallback:sx,useContext:jn,useEffect:Ty,useImperativeHandle:ix,useInsertionEffect:tx,useLayoutEffect:nx,useMemo:ox,useReducer:Yf,useRef:ex,useState:function(){return Yf(Yl)},useDebugValue:xy,useDeferredValue:function(n){var e=qn();return ax(e,ot.memoizedState,n)},useTransition:function(){var n=Yf(Yl)[0],e=qn().memoizedState;return[n,e]},useMutableSource:GT,useSyncExternalStore:KT,useId:lx,unstable_isNewReconciler:!1},NI={readContext:jn,useCallback:sx,useContext:jn,useEffect:Ty,useImperativeHandle:ix,useInsertionEffect:tx,useLayoutEffect:nx,useMemo:ox,useReducer:Zf,useRef:ex,useState:function(){return Zf(Yl)},useDebugValue:xy,useDeferredValue:function(n){var e=qn();return ot===null?e.memoizedState=n:ax(e,ot.memoizedState,n)},useTransition:function(){var n=Zf(Yl)[0],e=qn().memoizedState;return[n,e]},useMutableSource:GT,useSyncExternalStore:KT,useId:lx,unstable_isNewReconciler:!1};function Vn(n,e){if(n&&n.defaultProps){e=Ve({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function ug(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Ve({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var dh={isMounted:function(n){return(n=n._reactInternals)?to(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Wt(),i=ji(n),s=Kr(r,i);s.payload=e,t!=null&&(s.callback=t),e=zi(n,s,i),e!==null&&(er(e,n,i,r),Mu(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Wt(),i=ji(n),s=Kr(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=zi(n,s,i),e!==null&&(er(e,n,i,r),Mu(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Wt(),r=ji(n),i=Kr(t,r);i.tag=2,e!=null&&(i.callback=e),e=zi(n,i,r),e!==null&&(er(e,n,r,t),Mu(e,n,r))}};function Nb(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Wl(t,r)||!Wl(i,s):!0}function hx(n,e,t){var r=!1,i=Xi,s=e.contextType;return typeof s=="object"&&s!==null?s=jn(s):(i=sn(e)?qs:Ft.current,r=e.contextTypes,s=(r=r!=null)?ia(n,i):Xi),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=dh,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function Lb(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&dh.enqueueReplaceState(e,e.state,null)}function dg(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},yy(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=jn(s):(s=sn(e)?qs:Ft.current,i.context=ia(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(ug(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&dh.enqueueReplaceState(i,i.state,null),Sd(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function la(n,e){try{var t="",r=e;do t+=sL(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function ep(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function hg(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var LI=typeof WeakMap=="function"?WeakMap:Map;function fx(n,e,t){t=Kr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Ed||(Ed=!0,Cg=r),hg(n,e)},t}function px(n,e,t){t=Kr(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){hg(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){hg(n,e),typeof r!="function"&&($i===null?$i=new Set([this]):$i.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Ib(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new LI;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=VI.bind(null,n,e,t),e.then(n,n))}function Ab(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Mb(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Kr(-1,1),e.tag=2,zi(t,e,1))),t.lanes|=1),n)}var II=ai.ReactCurrentOwner,nn=!1;function qt(n,e,t,r){e.child=n===null?UT(e,null,t,r):oa(e,n.child,t,r)}function Db(n,e,t,r,i){t=t.render;var s=e.ref;return Ho(e,i),r=_y(n,e,t,r,s,i),t=Ey(),n!==null&&!nn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ni(n,e,i)):($e&&t&&dy(e),e.flags|=1,qt(n,e,r,i),e.child)}function Fb(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Ay(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,mx(n,e,s,r,i)):(n=qu(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:Wl,t(o,r)&&n.ref===e.ref)return ni(n,e,i)}return e.flags|=1,n=qi(s,r),n.ref=e.ref,n.return=e,e.child=n}function mx(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(Wl(s,r)&&n.ref===e.ref)if(nn=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(nn=!0);else return e.lanes=n.lanes,ni(n,e,i)}return fg(n,e,t,r,i)}function gx(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ne(Fo,dn),dn|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ne(Fo,dn),dn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Ne(Fo,dn),dn|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Ne(Fo,dn),dn|=r;return qt(n,e,i,t),e.child}function vx(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function fg(n,e,t,r,i){var s=sn(t)?qs:Ft.current;return s=ia(e,s),Ho(e,i),t=_y(n,e,t,r,s,i),r=Ey(),n!==null&&!nn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ni(n,e,i)):($e&&r&&dy(e),e.flags|=1,qt(n,e,t,i),e.child)}function zb(n,e,t,r,i){if(sn(t)){var s=!0;pd(e)}else s=!1;if(Ho(e,i),e.stateNode===null)zu(n,e),hx(e,t,r),dg(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=jn(c):(c=sn(t)?qs:Ft.current,c=ia(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Lb(e,o,r,c),Si=!1;var h=e.memoizedState;o.state=h,Sd(e,r,o,i),l=e.memoizedState,a!==r||h!==l||rn.current||Si?(typeof u=="function"&&(ug(e,t,u,r),l=e.memoizedState),(a=Si||Nb(e,t,a,r,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,WT(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Vn(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=jn(l):(l=sn(t)?qs:Ft.current,l=ia(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Lb(e,o,r,l),Si=!1,h=e.memoizedState,o.state=h,Sd(e,r,o,i);var p=e.memoizedState;a!==d||h!==p||rn.current||Si?(typeof f=="function"&&(ug(e,t,f,r),p=e.memoizedState),(c=Si||Nb(e,t,c,r,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return pg(n,e,t,r,s,i)}function pg(n,e,t,r,i,s){vx(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&_b(e,t,!1),ni(n,e,s);r=e.stateNode,II.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=oa(e,n.child,null,s),e.child=oa(e,null,a,s)):qt(n,e,a,s),e.memoizedState=r.state,i&&_b(e,t,!0),e.child}function yx(n){var e=n.stateNode;e.pendingContext?Cb(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Cb(n,e.context,!1),Sy(n,e.containerInfo)}function $b(n,e,t,r,i){return sa(),fy(i),e.flags|=256,qt(n,e,t,r),e.child}var mg={dehydrated:null,treeContext:null,retryLane:0};function gg(n){return{baseLanes:n,cachePool:null,transitions:null}}function Sx(n,e,t){var r=e.pendingProps,i=Be.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Ne(Be,i&1),n===null)return lg(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=ph(o,r,0,null),n=Ms(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=gg(t),e.memoizedState=mg,n):Oy(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return AI(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=qi(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=qi(a,s):(s=Ms(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?gg(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=mg,r}return s=n.child,n=s.sibling,r=qi(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Oy(n,e){return e=ph({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function fu(n,e,t,r){return r!==null&&fy(r),oa(e,n.child,null,t),n=Oy(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function AI(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=ep(Error(j(422))),fu(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=ph({mode:"visible",children:r.children},i,0,null),s=Ms(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&oa(e,n.child,null,o),e.child.memoizedState=gg(o),e.memoizedState=mg,s);if(!(e.mode&1))return fu(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(j(419)),r=ep(s,r,void 0),fu(n,e,o,r)}if(a=(o&n.childLanes)!==0,nn||a){if(r=gt,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ti(n,i),er(r,n,i,-1))}return Iy(),r=ep(Error(j(421))),fu(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=GI.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,yn=Fi(i.nextSibling),bn=e,$e=!0,Qn=null,n!==null&&(Rn[kn++]=Wr,Rn[kn++]=Vr,Rn[kn++]=Bs,Wr=n.id,Vr=n.overflow,Bs=e),e=Oy(e,r.children),e.flags|=4096,e)}function jb(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),cg(n.return,e,t)}function tp(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function bx(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(qt(n,e,r.children,t),r=Be.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&jb(n,t,e);else if(n.tag===19)jb(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Ne(Be,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&bd(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),tp(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&bd(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}tp(e,!0,t,null,s);break;case"together":tp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function zu(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ni(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Hs|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(j(153));if(e.child!==null){for(n=e.child,t=qi(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=qi(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function MI(n,e,t){switch(e.tag){case 3:yx(e),sa();break;case 5:VT(e);break;case 1:sn(e.type)&&pd(e);break;case 4:Sy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Ne(vd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ne(Be,Be.current&1),e.flags|=128,null):t&e.child.childLanes?Sx(n,e,t):(Ne(Be,Be.current&1),n=ni(n,e,t),n!==null?n.sibling:null);Ne(Be,Be.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return bx(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ne(Be,Be.current),r)break;return null;case 22:case 23:return e.lanes=0,gx(n,e,t)}return ni(n,e,t)}var wx,vg,Cx,_x;wx=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};vg=function(){};Cx=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,ks(br.current);var s=null;switch(t){case"input":i=$m(n,i),r=$m(n,r),s=[];break;case"select":i=Ve({},i,{value:void 0}),r=Ve({},r,{value:void 0}),s=[];break;case"textarea":i=Bm(n,i),r=Bm(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=hd)}Hm(t,r);var o;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(zl.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(zl.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Le("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};_x=function(n,e,t,r){t!==r&&(e.flags|=4)};function Ka(n,e){if(!$e)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Ot(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function DI(n,e,t){var r=e.pendingProps;switch(hy(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ot(e),null;case 1:return sn(e.type)&&fd(),Ot(e),null;case 3:return r=e.stateNode,aa(),Me(rn),Me(Ft),wy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(du(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Qn!==null&&(Tg(Qn),Qn=null))),vg(n,e),Ot(e),null;case 5:by(e);var i=ks(Ql.current);if(t=e.type,n!==null&&e.stateNode!=null)Cx(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(j(166));return Ot(e),null}if(n=ks(br.current),du(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[pr]=e,r[Kl]=s,n=(e.mode&1)!==0,t){case"dialog":Le("cancel",r),Le("close",r);break;case"iframe":case"object":case"embed":Le("load",r);break;case"video":case"audio":for(i=0;i<hl.length;i++)Le(hl[i],r);break;case"source":Le("error",r);break;case"img":case"image":case"link":Le("error",r),Le("load",r);break;case"details":Le("toggle",r);break;case"input":JS(r,s),Le("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Le("invalid",r);break;case"textarea":XS(r,s),Le("invalid",r)}Hm(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&uu(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&uu(r.textContent,a,n),i=["children",""+a]):zl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Le("scroll",r)}switch(t){case"input":nu(r),QS(r,s,!0);break;case"textarea":nu(r),YS(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=hd)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=X1(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[pr]=e,n[Kl]=r,wx(n,e,!1,!1),e.stateNode=n;e:{switch(o=Wm(t,r),t){case"dialog":Le("cancel",n),Le("close",n),i=r;break;case"iframe":case"object":case"embed":Le("load",n),i=r;break;case"video":case"audio":for(i=0;i<hl.length;i++)Le(hl[i],n);i=r;break;case"source":Le("error",n),i=r;break;case"img":case"image":case"link":Le("error",n),Le("load",n),i=r;break;case"details":Le("toggle",n),i=r;break;case"input":JS(n,r),i=$m(n,r),Le("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Ve({},r,{value:void 0}),Le("invalid",n);break;case"textarea":XS(n,r),i=Bm(n,r),Le("invalid",n);break;default:i=r}Hm(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?eT(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Y1(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&$l(n,l):typeof l=="number"&&$l(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(zl.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Le("scroll",n):l!=null&&Xv(n,s,l,o))}switch(t){case"input":nu(n),QS(n,r,!1);break;case"textarea":nu(n),YS(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Qi(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?jo(n,!!r.multiple,s,!1):r.defaultValue!=null&&jo(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=hd)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ot(e),null;case 6:if(n&&e.stateNode!=null)_x(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(j(166));if(t=ks(Ql.current),ks(br.current),du(e)){if(r=e.stateNode,t=e.memoizedProps,r[pr]=e,(s=r.nodeValue!==t)&&(n=bn,n!==null))switch(n.tag){case 3:uu(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&uu(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[pr]=e,e.stateNode=r}return Ot(e),null;case 13:if(Me(Be),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if($e&&yn!==null&&e.mode&1&&!(e.flags&128))qT(),sa(),e.flags|=98560,s=!1;else if(s=du(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(j(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(j(317));s[pr]=e}else sa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ot(e),s=!1}else Qn!==null&&(Tg(Qn),Qn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Be.current&1?lt===0&&(lt=3):Iy())),e.updateQueue!==null&&(e.flags|=4),Ot(e),null);case 4:return aa(),vg(n,e),n===null&&Vl(e.stateNode.containerInfo),Ot(e),null;case 10:return gy(e.type._context),Ot(e),null;case 17:return sn(e.type)&&fd(),Ot(e),null;case 19:if(Me(Be),s=e.memoizedState,s===null)return Ot(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Ka(s,!1);else{if(lt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=bd(n),o!==null){for(e.flags|=128,Ka(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ne(Be,Be.current&1|2),e.child}n=n.sibling}s.tail!==null&&Xe()>ca&&(e.flags|=128,r=!0,Ka(s,!1),e.lanes=4194304)}else{if(!r)if(n=bd(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ka(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!$e)return Ot(e),null}else 2*Xe()-s.renderingStartTime>ca&&t!==1073741824&&(e.flags|=128,r=!0,Ka(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Xe(),e.sibling=null,t=Be.current,Ne(Be,r?t&1|2:t&1),e):(Ot(e),null);case 22:case 23:return Ly(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?dn&1073741824&&(Ot(e),e.subtreeFlags&6&&(e.flags|=8192)):Ot(e),null;case 24:return null;case 25:return null}throw Error(j(156,e.tag))}function FI(n,e){switch(hy(e),e.tag){case 1:return sn(e.type)&&fd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return aa(),Me(rn),Me(Ft),wy(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return by(e),null;case 13:if(Me(Be),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(j(340));sa()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Me(Be),null;case 4:return aa(),null;case 10:return gy(e.type._context),null;case 22:case 23:return Ly(),null;case 24:return null;default:return null}}var pu=!1,Mt=!1,zI=typeof WeakSet=="function"?WeakSet:Set,J=null;function Do(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ke(n,e,r)}else t.current=null}function yg(n,e,t){try{t()}catch(r){Ke(n,e,r)}}var qb=!1;function $I(n,e){if(tg=cd,n=PT(),uy(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=n,h=null;t:for(;;){for(var f;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(ng={focusedElem:n,selectionRange:t},cd=!1,J=e;J!==null;)if(e=J,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,J=n;else for(;J!==null;){e=J;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,S=p.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?g:Vn(e.type,g),S);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(j(163))}}catch(b){Ke(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,J=n;break}J=e.return}return p=qb,qb=!1,p}function Cl(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&yg(e,t,s)}i=i.next}while(i!==r)}}function hh(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Sg(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Ex(n){var e=n.alternate;e!==null&&(n.alternate=null,Ex(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[pr],delete e[Kl],delete e[sg],delete e[wI],delete e[CI])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Tx(n){return n.tag===5||n.tag===3||n.tag===4}function Bb(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Tx(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function bg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=hd));else if(r!==4&&(n=n.child,n!==null))for(bg(n,e,t),n=n.sibling;n!==null;)bg(n,e,t),n=n.sibling}function wg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(wg(n,e,t),n=n.sibling;n!==null;)wg(n,e,t),n=n.sibling}var wt=null,Gn=!1;function hi(n,e,t){for(t=t.child;t!==null;)xx(n,e,t),t=t.sibling}function xx(n,e,t){if(Sr&&typeof Sr.onCommitFiberUnmount=="function")try{Sr.onCommitFiberUnmount(ih,t)}catch{}switch(t.tag){case 5:Mt||Do(t,e);case 6:var r=wt,i=Gn;wt=null,hi(n,e,t),wt=r,Gn=i,wt!==null&&(Gn?(n=wt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):wt.removeChild(t.stateNode));break;case 18:wt!==null&&(Gn?(n=wt,t=t.stateNode,n.nodeType===8?Kf(n.parentNode,t):n.nodeType===1&&Kf(n,t),Ul(n)):Kf(wt,t.stateNode));break;case 4:r=wt,i=Gn,wt=t.stateNode.containerInfo,Gn=!0,hi(n,e,t),wt=r,Gn=i;break;case 0:case 11:case 14:case 15:if(!Mt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&yg(t,e,o),i=i.next}while(i!==r)}hi(n,e,t);break;case 1:if(!Mt&&(Do(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Ke(t,e,a)}hi(n,e,t);break;case 21:hi(n,e,t);break;case 22:t.mode&1?(Mt=(r=Mt)||t.memoizedState!==null,hi(n,e,t),Mt=r):hi(n,e,t);break;default:hi(n,e,t)}}function Ub(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new zI),e.forEach(function(r){var i=KI.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Hn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:wt=a.stateNode,Gn=!1;break e;case 3:wt=a.stateNode.containerInfo,Gn=!0;break e;case 4:wt=a.stateNode.containerInfo,Gn=!0;break e}a=a.return}if(wt===null)throw Error(j(160));xx(s,o,i),wt=null,Gn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Ke(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ox(e,n),e=e.sibling}function Ox(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Hn(e,n),sr(n),r&4){try{Cl(3,n,n.return),hh(3,n)}catch(g){Ke(n,n.return,g)}try{Cl(5,n,n.return)}catch(g){Ke(n,n.return,g)}}break;case 1:Hn(e,n),sr(n),r&512&&t!==null&&Do(t,t.return);break;case 5:if(Hn(e,n),sr(n),r&512&&t!==null&&Do(t,t.return),n.flags&32){var i=n.stateNode;try{$l(i,"")}catch(g){Ke(n,n.return,g)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&J1(i,s),Wm(a,o);var c=Wm(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?eT(i,d):u==="dangerouslySetInnerHTML"?Y1(i,d):u==="children"?$l(i,d):Xv(i,u,d,c)}switch(a){case"input":jm(i,s);break;case"textarea":Q1(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?jo(i,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?jo(i,!!s.multiple,s.defaultValue,!0):jo(i,!!s.multiple,s.multiple?[]:"",!1))}i[Kl]=s}catch(g){Ke(n,n.return,g)}}break;case 6:if(Hn(e,n),sr(n),r&4){if(n.stateNode===null)throw Error(j(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(g){Ke(n,n.return,g)}}break;case 3:if(Hn(e,n),sr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Ul(e.containerInfo)}catch(g){Ke(n,n.return,g)}break;case 4:Hn(e,n),sr(n);break;case 13:Hn(e,n),sr(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(ky=Xe())),r&4&&Ub(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(Mt=(c=Mt)||u,Hn(e,n),Mt=c):Hn(e,n),sr(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(J=n,u=n.child;u!==null;){for(d=J=u;J!==null;){switch(h=J,f=h.child,h.tag){case 0:case 11:case 14:case 15:Cl(4,h,h.return);break;case 1:Do(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){Ke(r,t,g)}}break;case 5:Do(h,h.return);break;case 22:if(h.memoizedState!==null){Wb(d);continue}}f!==null?(f.return=h,J=f):Wb(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Z1("display",o))}catch(g){Ke(n,n.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){Ke(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Hn(e,n),sr(n),r&4&&Ub(n);break;case 21:break;default:Hn(e,n),sr(n)}}function sr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Tx(t)){var r=t;break e}t=t.return}throw Error(j(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&($l(i,""),r.flags&=-33);var s=Bb(n);wg(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Bb(n);bg(n,a,o);break;default:throw Error(j(161))}}catch(l){Ke(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function jI(n,e,t){J=n,Px(n)}function Px(n,e,t){for(var r=(n.mode&1)!==0;J!==null;){var i=J,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||pu;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Mt;a=pu;var c=Mt;if(pu=o,(Mt=l)&&!c)for(J=i;J!==null;)o=J,l=o.child,o.tag===22&&o.memoizedState!==null?Vb(i):l!==null?(l.return=o,J=l):Vb(i);for(;s!==null;)J=s,Px(s),s=s.sibling;J=i,pu=a,Mt=c}Hb(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,J=s):Hb(n)}}function Hb(n){for(;J!==null;){var e=J;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Mt||hh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Mt)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Vn(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Pb(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Pb(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Ul(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(j(163))}Mt||e.flags&512&&Sg(e)}catch(h){Ke(e,e.return,h)}}if(e===n){J=null;break}if(t=e.sibling,t!==null){t.return=e.return,J=t;break}J=e.return}}function Wb(n){for(;J!==null;){var e=J;if(e===n){J=null;break}var t=e.sibling;if(t!==null){t.return=e.return,J=t;break}J=e.return}}function Vb(n){for(;J!==null;){var e=J;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{hh(4,e)}catch(l){Ke(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Ke(e,i,l)}}var s=e.return;try{Sg(e)}catch(l){Ke(e,s,l)}break;case 5:var o=e.return;try{Sg(e)}catch(l){Ke(e,o,l)}}}catch(l){Ke(e,e.return,l)}if(e===n){J=null;break}var a=e.sibling;if(a!==null){a.return=e.return,J=a;break}J=e.return}}var qI=Math.ceil,_d=ai.ReactCurrentDispatcher,Py=ai.ReactCurrentOwner,Fn=ai.ReactCurrentBatchConfig,ge=0,gt=null,nt=null,Et=0,dn=0,Fo=ns(0),lt=0,ec=null,Hs=0,fh=0,Ry=0,_l=null,tn=null,ky=0,ca=1/0,$r=null,Ed=!1,Cg=null,$i=null,mu=!1,xi=null,Td=0,El=0,_g=null,$u=-1,ju=0;function Wt(){return ge&6?Xe():$u!==-1?$u:$u=Xe()}function ji(n){return n.mode&1?ge&2&&Et!==0?Et&-Et:EI.transition!==null?(ju===0&&(ju=hT()),ju):(n=Te,n!==0||(n=window.event,n=n===void 0?16:ST(n.type)),n):1}function er(n,e,t,r){if(50<El)throw El=0,_g=null,Error(j(185));wc(n,t,r),(!(ge&2)||n!==gt)&&(n===gt&&(!(ge&2)&&(fh|=t),lt===4&&_i(n,Et)),on(n,r),t===1&&ge===0&&!(e.mode&1)&&(ca=Xe()+500,ch&&rs()))}function on(n,e){var t=n.callbackNode;EL(n,e);var r=ld(n,n===gt?Et:0);if(r===0)t!==null&&tb(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&tb(t),e===1)n.tag===0?_I(Gb.bind(null,n)):zT(Gb.bind(null,n)),SI(function(){!(ge&6)&&rs()}),t=null;else{switch(fT(r)){case 1:t=ny;break;case 4:t=uT;break;case 16:t=ad;break;case 536870912:t=dT;break;default:t=ad}t=Dx(t,Rx.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Rx(n,e){if($u=-1,ju=0,ge&6)throw Error(j(327));var t=n.callbackNode;if(Wo()&&n.callbackNode!==t)return null;var r=ld(n,n===gt?Et:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=xd(n,r);else{e=r;var i=ge;ge|=2;var s=Nx();(gt!==n||Et!==e)&&($r=null,ca=Xe()+500,As(n,e));do try{HI();break}catch(a){kx(n,a)}while(1);my(),_d.current=s,ge=i,nt!==null?e=0:(gt=null,Et=0,e=lt)}if(e!==0){if(e===2&&(i=Qm(n),i!==0&&(r=i,e=Eg(n,i))),e===1)throw t=ec,As(n,0),_i(n,r),on(n,Xe()),t;if(e===6)_i(n,r);else{if(i=n.current.alternate,!(r&30)&&!BI(i)&&(e=xd(n,r),e===2&&(s=Qm(n),s!==0&&(r=s,e=Eg(n,s))),e===1))throw t=ec,As(n,0),_i(n,r),on(n,Xe()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(j(345));case 2:ds(n,tn,$r);break;case 3:if(_i(n,r),(r&130023424)===r&&(e=ky+500-Xe(),10<e)){if(ld(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Wt(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=ig(ds.bind(null,n,tn,$r),e);break}ds(n,tn,$r);break;case 4:if(_i(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-Zn(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Xe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*qI(r/1960))-r,10<r){n.timeoutHandle=ig(ds.bind(null,n,tn,$r),r);break}ds(n,tn,$r);break;case 5:ds(n,tn,$r);break;default:throw Error(j(329))}}}return on(n,Xe()),n.callbackNode===t?Rx.bind(null,n):null}function Eg(n,e){var t=_l;return n.current.memoizedState.isDehydrated&&(As(n,e).flags|=256),n=xd(n,e),n!==2&&(e=tn,tn=t,e!==null&&Tg(e)),n}function Tg(n){tn===null?tn=n:tn.push.apply(tn,n)}function BI(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!rr(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function _i(n,e){for(e&=~Ry,e&=~fh,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Zn(e),r=1<<t;n[t]=-1,e&=~r}}function Gb(n){if(ge&6)throw Error(j(327));Wo();var e=ld(n,0);if(!(e&1))return on(n,Xe()),null;var t=xd(n,e);if(n.tag!==0&&t===2){var r=Qm(n);r!==0&&(e=r,t=Eg(n,r))}if(t===1)throw t=ec,As(n,0),_i(n,e),on(n,Xe()),t;if(t===6)throw Error(j(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ds(n,tn,$r),on(n,Xe()),null}function Ny(n,e){var t=ge;ge|=1;try{return n(e)}finally{ge=t,ge===0&&(ca=Xe()+500,ch&&rs())}}function Ws(n){xi!==null&&xi.tag===0&&!(ge&6)&&Wo();var e=ge;ge|=1;var t=Fn.transition,r=Te;try{if(Fn.transition=null,Te=1,n)return n()}finally{Te=r,Fn.transition=t,ge=e,!(ge&6)&&rs()}}function Ly(){dn=Fo.current,Me(Fo)}function As(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,yI(t)),nt!==null)for(t=nt.return;t!==null;){var r=t;switch(hy(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&fd();break;case 3:aa(),Me(rn),Me(Ft),wy();break;case 5:by(r);break;case 4:aa();break;case 13:Me(Be);break;case 19:Me(Be);break;case 10:gy(r.type._context);break;case 22:case 23:Ly()}t=t.return}if(gt=n,nt=n=qi(n.current,null),Et=dn=e,lt=0,ec=null,Ry=fh=Hs=0,tn=_l=null,Rs!==null){for(e=0;e<Rs.length;e++)if(t=Rs[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}Rs=null}return n}function kx(n,e){do{var t=nt;try{if(my(),Du.current=Cd,wd){for(var r=We.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}wd=!1}if(Us=0,mt=ot=We=null,wl=!1,Xl=0,Py.current=null,t===null||t.return===null){lt=1,ec=e,nt=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Et,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Ab(o);if(f!==null){f.flags&=-257,Mb(f,o,a,s,e),f.mode&1&&Ib(s,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var g=new Set;g.add(l),e.updateQueue=g}else p.add(l);break e}else{if(!(e&1)){Ib(s,c,e),Iy();break e}l=Error(j(426))}}else if($e&&a.mode&1){var S=Ab(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),Mb(S,o,a,s,e),fy(la(l,a));break e}}s=l=la(l,a),lt!==4&&(lt=2),_l===null?_l=[s]:_l.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=fx(s,l,e);Ob(s,m);break e;case 1:a=l;var v=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&($i===null||!$i.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var b=px(s,a,e);Ob(s,b);break e}}s=s.return}while(s!==null)}Ix(t)}catch(w){e=w,nt===t&&t!==null&&(nt=t=t.return);continue}break}while(1)}function Nx(){var n=_d.current;return _d.current=Cd,n===null?Cd:n}function Iy(){(lt===0||lt===3||lt===2)&&(lt=4),gt===null||!(Hs&268435455)&&!(fh&268435455)||_i(gt,Et)}function xd(n,e){var t=ge;ge|=2;var r=Nx();(gt!==n||Et!==e)&&($r=null,As(n,e));do try{UI();break}catch(i){kx(n,i)}while(1);if(my(),ge=t,_d.current=r,nt!==null)throw Error(j(261));return gt=null,Et=0,lt}function UI(){for(;nt!==null;)Lx(nt)}function HI(){for(;nt!==null&&!mL();)Lx(nt)}function Lx(n){var e=Mx(n.alternate,n,dn);n.memoizedProps=n.pendingProps,e===null?Ix(n):nt=e,Py.current=null}function Ix(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=FI(t,e),t!==null){t.flags&=32767,nt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{lt=6,nt=null;return}}else if(t=DI(t,e,dn),t!==null){nt=t;return}if(e=e.sibling,e!==null){nt=e;return}nt=e=n}while(e!==null);lt===0&&(lt=5)}function ds(n,e,t){var r=Te,i=Fn.transition;try{Fn.transition=null,Te=1,WI(n,e,t,r)}finally{Fn.transition=i,Te=r}return null}function WI(n,e,t,r){do Wo();while(xi!==null);if(ge&6)throw Error(j(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(j(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(TL(n,s),n===gt&&(nt=gt=null,Et=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||mu||(mu=!0,Dx(ad,function(){return Wo(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Fn.transition,Fn.transition=null;var o=Te;Te=1;var a=ge;ge|=4,Py.current=null,$I(n,t),Ox(t,n),dI(ng),cd=!!tg,ng=tg=null,n.current=t,jI(t),gL(),ge=a,Te=o,Fn.transition=s}else n.current=t;if(mu&&(mu=!1,xi=n,Td=i),s=n.pendingLanes,s===0&&($i=null),SL(t.stateNode),on(n,Xe()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ed)throw Ed=!1,n=Cg,Cg=null,n;return Td&1&&n.tag!==0&&Wo(),s=n.pendingLanes,s&1?n===_g?El++:(El=0,_g=n):El=0,rs(),null}function Wo(){if(xi!==null){var n=fT(Td),e=Fn.transition,t=Te;try{if(Fn.transition=null,Te=16>n?16:n,xi===null)var r=!1;else{if(n=xi,xi=null,Td=0,ge&6)throw Error(j(331));var i=ge;for(ge|=4,J=n.current;J!==null;){var s=J,o=s.child;if(J.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(J=c;J!==null;){var u=J;switch(u.tag){case 0:case 11:case 15:Cl(8,u,s)}var d=u.child;if(d!==null)d.return=u,J=d;else for(;J!==null;){u=J;var h=u.sibling,f=u.return;if(Ex(u),u===c){J=null;break}if(h!==null){h.return=f,J=h;break}J=f}}}var p=s.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var S=g.sibling;g.sibling=null,g=S}while(g!==null)}}J=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,J=o;else e:for(;J!==null;){if(s=J,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Cl(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,J=m;break e}J=s.return}}var v=n.current;for(J=v;J!==null;){o=J;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,J=y;else e:for(o=v;J!==null;){if(a=J,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:hh(9,a)}}catch(w){Ke(a,a.return,w)}if(a===o){J=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,J=b;break e}J=a.return}}if(ge=i,rs(),Sr&&typeof Sr.onPostCommitFiberRoot=="function")try{Sr.onPostCommitFiberRoot(ih,n)}catch{}r=!0}return r}finally{Te=t,Fn.transition=e}}return!1}function Kb(n,e,t){e=la(t,e),e=fx(n,e,1),n=zi(n,e,1),e=Wt(),n!==null&&(wc(n,1,e),on(n,e))}function Ke(n,e,t){if(n.tag===3)Kb(n,n,t);else for(;e!==null;){if(e.tag===3){Kb(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&($i===null||!$i.has(r))){n=la(t,n),n=px(e,n,1),e=zi(e,n,1),n=Wt(),e!==null&&(wc(e,1,n),on(e,n));break}}e=e.return}}function VI(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Wt(),n.pingedLanes|=n.suspendedLanes&t,gt===n&&(Et&t)===t&&(lt===4||lt===3&&(Et&130023424)===Et&&500>Xe()-ky?As(n,0):Ry|=t),on(n,e)}function Ax(n,e){e===0&&(n.mode&1?(e=su,su<<=1,!(su&130023424)&&(su=4194304)):e=1);var t=Wt();n=ti(n,e),n!==null&&(wc(n,e,t),on(n,t))}function GI(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Ax(n,t)}function KI(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(j(314))}r!==null&&r.delete(e),Ax(n,t)}var Mx;Mx=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||rn.current)nn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return nn=!1,MI(n,e,t);nn=!!(n.flags&131072)}else nn=!1,$e&&e.flags&1048576&&$T(e,gd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;zu(n,e),n=e.pendingProps;var i=ia(e,Ft.current);Ho(e,t),i=_y(null,e,r,n,i,t);var s=Ey();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,sn(r)?(s=!0,pd(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,yy(e),i.updater=dh,e.stateNode=i,i._reactInternals=e,dg(e,r,n,t),e=pg(null,e,r,!0,s,t)):(e.tag=0,$e&&s&&dy(e),qt(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(zu(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=QI(r),n=Vn(r,n),i){case 0:e=fg(null,e,r,n,t);break e;case 1:e=zb(null,e,r,n,t);break e;case 11:e=Db(null,e,r,n,t);break e;case 14:e=Fb(null,e,r,Vn(r.type,n),t);break e}throw Error(j(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Vn(r,i),fg(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Vn(r,i),zb(n,e,r,i,t);case 3:e:{if(yx(e),n===null)throw Error(j(387));r=e.pendingProps,s=e.memoizedState,i=s.element,WT(n,e),Sd(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=la(Error(j(423)),e),e=$b(n,e,r,t,i);break e}else if(r!==i){i=la(Error(j(424)),e),e=$b(n,e,r,t,i);break e}else for(yn=Fi(e.stateNode.containerInfo.firstChild),bn=e,$e=!0,Qn=null,t=UT(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(sa(),r===i){e=ni(n,e,t);break e}qt(n,e,r,t)}e=e.child}return e;case 5:return VT(e),n===null&&lg(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,rg(r,i)?o=null:s!==null&&rg(r,s)&&(e.flags|=32),vx(n,e),qt(n,e,o,t),e.child;case 6:return n===null&&lg(e),null;case 13:return Sx(n,e,t);case 4:return Sy(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=oa(e,null,r,t):qt(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Vn(r,i),Db(n,e,r,i,t);case 7:return qt(n,e,e.pendingProps,t),e.child;case 8:return qt(n,e,e.pendingProps.children,t),e.child;case 12:return qt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Ne(vd,r._currentValue),r._currentValue=o,s!==null)if(rr(s.value,o)){if(s.children===i.children&&!rn.current){e=ni(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Kr(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),cg(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(j(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),cg(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}qt(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Ho(e,t),i=jn(i),r=r(i),e.flags|=1,qt(n,e,r,t),e.child;case 14:return r=e.type,i=Vn(r,e.pendingProps),i=Vn(r.type,i),Fb(n,e,r,i,t);case 15:return mx(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Vn(r,i),zu(n,e),e.tag=1,sn(r)?(n=!0,pd(e)):n=!1,Ho(e,t),hx(e,r,i),dg(e,r,i,t),pg(null,e,r,!0,n,t);case 19:return bx(n,e,t);case 22:return gx(n,e,t)}throw Error(j(156,e.tag))};function Dx(n,e){return cT(n,e)}function JI(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mn(n,e,t,r){return new JI(n,e,t,r)}function Ay(n){return n=n.prototype,!(!n||!n.isReactComponent)}function QI(n){if(typeof n=="function")return Ay(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Zv)return 11;if(n===ey)return 14}return 2}function qi(n,e){var t=n.alternate;return t===null?(t=Mn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function qu(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")Ay(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Oo:return Ms(t.children,i,s,e);case Yv:o=8,i|=8;break;case Mm:return n=Mn(12,t,e,i|2),n.elementType=Mm,n.lanes=s,n;case Dm:return n=Mn(13,t,e,i),n.elementType=Dm,n.lanes=s,n;case Fm:return n=Mn(19,t,e,i),n.elementType=Fm,n.lanes=s,n;case V1:return ph(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case H1:o=10;break e;case W1:o=9;break e;case Zv:o=11;break e;case ey:o=14;break e;case yi:o=16,r=null;break e}throw Error(j(130,n==null?n:typeof n,""))}return e=Mn(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Ms(n,e,t,r){return n=Mn(7,n,r,e),n.lanes=t,n}function ph(n,e,t,r){return n=Mn(22,n,r,e),n.elementType=V1,n.lanes=t,n.stateNode={isHidden:!1},n}function np(n,e,t){return n=Mn(6,n,null,e),n.lanes=t,n}function rp(n,e,t){return e=Mn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function XI(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ff(0),this.expirationTimes=Ff(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ff(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function My(n,e,t,r,i,s,o,a,l){return n=new XI(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Mn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},yy(s),n}function YI(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xo,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Fx(n){if(!n)return Xi;n=n._reactInternals;e:{if(to(n)!==n||n.tag!==1)throw Error(j(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(sn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(j(171))}if(n.tag===1){var t=n.type;if(sn(t))return FT(n,t,e)}return e}function zx(n,e,t,r,i,s,o,a,l){return n=My(t,r,!0,n,i,s,o,a,l),n.context=Fx(null),t=n.current,r=Wt(),i=ji(t),s=Kr(r,i),s.callback=e??null,zi(t,s,i),n.current.lanes=i,wc(n,i,r),on(n,r),n}function mh(n,e,t,r){var i=e.current,s=Wt(),o=ji(i);return t=Fx(t),e.context===null?e.context=t:e.pendingContext=t,e=Kr(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=zi(i,e,o),n!==null&&(er(n,i,o,s),Mu(n,i,o)),o}function Od(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Jb(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Dy(n,e){Jb(n,e),(n=n.alternate)&&Jb(n,e)}function ZI(){return null}var $x=typeof reportError=="function"?reportError:function(n){console.error(n)};function Fy(n){this._internalRoot=n}gh.prototype.render=Fy.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(j(409));mh(n,e,null,null)};gh.prototype.unmount=Fy.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Ws(function(){mh(null,n,null,null)}),e[ei]=null}};function gh(n){this._internalRoot=n}gh.prototype.unstable_scheduleHydration=function(n){if(n){var e=gT();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ci.length&&e!==0&&e<Ci[t].priority;t++);Ci.splice(t,0,n),t===0&&yT(n)}};function zy(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function vh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Qb(){}function eA(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=Od(o);s.call(c)}}var o=zx(e,r,n,0,null,!1,!1,"",Qb);return n._reactRootContainer=o,n[ei]=o.current,Vl(n.nodeType===8?n.parentNode:n),Ws(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Od(l);a.call(c)}}var l=My(n,0,!1,null,null,!1,!1,"",Qb);return n._reactRootContainer=l,n[ei]=l.current,Vl(n.nodeType===8?n.parentNode:n),Ws(function(){mh(e,l,t,r)}),l}function yh(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=Od(o);a.call(l)}}mh(e,o,n,i)}else o=eA(t,e,n,i,r);return Od(o)}pT=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=dl(e.pendingLanes);t!==0&&(ry(e,t|1),on(e,Xe()),!(ge&6)&&(ca=Xe()+500,rs()))}break;case 13:Ws(function(){var r=ti(n,1);if(r!==null){var i=Wt();er(r,n,1,i)}}),Dy(n,1)}};iy=function(n){if(n.tag===13){var e=ti(n,134217728);if(e!==null){var t=Wt();er(e,n,134217728,t)}Dy(n,134217728)}};mT=function(n){if(n.tag===13){var e=ji(n),t=ti(n,e);if(t!==null){var r=Wt();er(t,n,e,r)}Dy(n,e)}};gT=function(){return Te};vT=function(n,e){var t=Te;try{return Te=n,e()}finally{Te=t}};Gm=function(n,e,t){switch(e){case"input":if(jm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=lh(r);if(!i)throw Error(j(90));K1(r),jm(r,i)}}}break;case"textarea":Q1(n,t);break;case"select":e=t.value,e!=null&&jo(n,!!t.multiple,e,!1)}};rT=Ny;iT=Ws;var tA={usingClientEntryPoint:!1,Events:[_c,No,lh,tT,nT,Ny]},Ja={findFiberByHostInstance:Ps,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nA={bundleType:Ja.bundleType,version:Ja.version,rendererPackageName:Ja.rendererPackageName,rendererConfig:Ja.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ai.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=aT(n),n===null?null:n.stateNode},findFiberByHostInstance:Ja.findFiberByHostInstance||ZI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gu.isDisabled&&gu.supportsFiber)try{ih=gu.inject(nA),Sr=gu}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tA;Tn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zy(e))throw Error(j(200));return YI(n,e,null,t)};Tn.createRoot=function(n,e){if(!zy(n))throw Error(j(299));var t=!1,r="",i=$x;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=My(n,1,!1,null,null,t,!1,r,i),n[ei]=e.current,Vl(n.nodeType===8?n.parentNode:n),new Fy(e)};Tn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(j(188)):(n=Object.keys(n).join(","),Error(j(268,n)));return n=aT(e),n=n===null?null:n.stateNode,n};Tn.flushSync=function(n){return Ws(n)};Tn.hydrate=function(n,e,t){if(!vh(e))throw Error(j(200));return yh(null,n,e,!0,t)};Tn.hydrateRoot=function(n,e,t){if(!zy(n))throw Error(j(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=$x;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=zx(e,null,n,1,t??null,i,!1,s,o),n[ei]=e.current,Vl(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new gh(e)};Tn.render=function(n,e,t){if(!vh(e))throw Error(j(200));return yh(null,n,e,!1,t)};Tn.unmountComponentAtNode=function(n){if(!vh(n))throw Error(j(40));return n._reactRootContainer?(Ws(function(){yh(null,null,n,!1,function(){n._reactRootContainer=null,n[ei]=null})}),!0):!1};Tn.unstable_batchedUpdates=Ny;Tn.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!vh(t))throw Error(j(200));if(n==null||n._reactInternals===void 0)throw Error(j(38));return yh(n,e,t,!1,r)};Tn.version="18.3.1-next-f1338f8080-20240426";function jx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jx)}catch(n){console.error(n)}}jx(),j1.exports=Tn;var rA=j1.exports,Xb=rA;Im.createRoot=Xb.createRoot,Im.hydrateRoot=Xb.hydrateRoot;function Tc(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function li(n,e,t,r){return new(t||(t=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?i(c.value):(u=c.value,u instanceof t?u:new t(function(d){d(u)})).then(o,a)}l((r=r.apply(n,e||[])).next())})}const iA={childProxyingCommunication:!1};function qx(){return iA.childProxyingCommunication}let sA={disableEnforceOriginMatchForChildResponses:!1};function oA(){return sA}var Yb,Zb,ew,Pd,tw,nw,rw,xg,iw,sw;function aA(n){return(n==null?void 0:n.errorCode)!==void 0}(function(n){n.Inline="inline",n.Desktop="desktop",n.Web="web"})(Yb||(Yb={})),function(n){n.M365Content="m365content"}(Zb||(Zb={})),function(n){n.DriveId="driveId",n.GroupId="groupId",n.SiteId="siteId",n.UserId="userId"}(ew||(ew={})),function(n){n[n.NOT_SUPPORTED_ON_PLATFORM=100]="NOT_SUPPORTED_ON_PLATFORM",n[n.INTERNAL_ERROR=500]="INTERNAL_ERROR",n[n.NOT_SUPPORTED_IN_CURRENT_CONTEXT=501]="NOT_SUPPORTED_IN_CURRENT_CONTEXT",n[n.PERMISSION_DENIED=1e3]="PERMISSION_DENIED",n[n.NETWORK_ERROR=2e3]="NETWORK_ERROR",n[n.NO_HW_SUPPORT=3e3]="NO_HW_SUPPORT",n[n.INVALID_ARGUMENTS=4e3]="INVALID_ARGUMENTS",n[n.UNAUTHORIZED_USER_OPERATION=5e3]="UNAUTHORIZED_USER_OPERATION",n[n.INSUFFICIENT_RESOURCES=6e3]="INSUFFICIENT_RESOURCES",n[n.THROTTLE=7e3]="THROTTLE",n[n.USER_ABORT=8e3]="USER_ABORT",n[n.OPERATION_TIMED_OUT=8001]="OPERATION_TIMED_OUT",n[n.OLD_PLATFORM=9e3]="OLD_PLATFORM",n[n.FILE_NOT_FOUND=404]="FILE_NOT_FOUND",n[n.SIZE_EXCEEDED=1e4]="SIZE_EXCEEDED"}(Pd||(Pd={})),function(n){n.GeoLocation="geolocation",n.Media="media"}(tw||(tw={})),function(n){n.BCAIS="bcais",n.BCWAF="bcwaf",n.BCWBF="bcwbf"}(nw||(nw={})),function(n){n.Faculty="faculty",n.Student="student",n.Other="other"}(rw||(rw={})),function(n){n.Adult="adult",n.MinorNoParentalConsentRequired="minorNoParentalConsentRequired",n.MinorWithoutParentalConsent="minorWithoutParentalConsent",n.MinorWithParentalConsent="minorWithParentalConsent",n.NotAdult="notAdult",n.NonAdult="notAdult"}(xg||(xg={})),function(n){n.HigherEducation="higherEducation",n.K12="k12",n.Other="other"}(iw||(iw={})),function(n){n.TextPlain="text/plain",n.TextHtml="text/html",n.ImagePNG="image/png",n.ImageJPEG="image/jpeg"}(sw||(sw={}));var pe,Og,Dn,ow,aw,lw,cw,uw;(function(n){n.desktop="desktop",n.web="web",n.android="android",n.ios="ios",n.ipados="ipados",n.macos="macos",n.visionOS="visionOS",n.rigel="rigel",n.surfaceHub="surfaceHub",n.teamsRoomsWindows="teamsRoomsWindows",n.teamsRoomsAndroid="teamsRoomsAndroid",n.teamsPhones="teamsPhones",n.teamsDisplays="teamsDisplays"})(pe||(pe={})),function(n){n.office="Office",n.outlook="Outlook",n.outlookWin32="OutlookWin32",n.orange="Orange",n.places="Places",n.teams="Teams",n.teamsModern="TeamsModern"}(Og||(Og={})),function(n){n.settings="settings",n.content="content",n.authentication="authentication",n.remove="remove",n.task="task",n.sidePanel="sidePanel",n.stage="stage",n.meetingStage="meetingStage"}(Dn||(Dn={})),function(n){n.copilotSidePanel="copilotSidePanel",n.copilotMainPane="copilotMainPane",n.copilotFullScreen="copilotFullScreen"}(ow||(ow={})),function(n){n[n.Standard=0]="Standard",n[n.Edu=1]="Edu",n[n.Class=2]="Class",n[n.Plc=3]="Plc",n[n.Staff=4]="Staff"}(aw||(aw={})),function(n){n[n.Admin=0]="Admin",n[n.User=1]="User",n[n.Guest=2]="Guest"}(lw||(lw={})),function(n){n.Large="large",n.Medium="medium",n.Small="small"}(cw||(cw={})),function(n){n.Regular="Regular",n.Private="Private",n.Shared="Shared"}(uw||(uw={}));const lA={errorCode:Pd.NOT_SUPPORTED_ON_PLATFORM},Bx={adaptiveCardSchemaVersion:{majorVersion:1,minorVersion:5}};var dw={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let vu;const cA=new Uint8Array(16);function uA(){if(!vu&&(vu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vu(cA)}const yt=[];for(let n=0;n<256;++n)yt.push((n+256).toString(16).slice(1));function dA(n,e=0){return yt[n[e+0]]+yt[n[e+1]]+yt[n[e+2]]+yt[n[e+3]]+"-"+yt[n[e+4]]+yt[n[e+5]]+"-"+yt[n[e+6]]+yt[n[e+7]]+"-"+yt[n[e+8]]+yt[n[e+9]]+"-"+yt[n[e+10]]+yt[n[e+11]]+yt[n[e+12]]+yt[n[e+13]]+yt[n[e+14]]+yt[n[e+15]]}function hA(n,e,t){if(dw.randomUUID&&!e&&!n)return dw.randomUUID();const r=(n=n||{}).random||(n.rng||uA)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,dA(r)}var fA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function pA(n){return typeof n=="string"&&fA.test(n)}function Ux(n,e){if(typeof n!="string"||typeof e!="string")return NaN;const t=n.split("."),r=e.split(".");function i(s){return/^\d+$/.test(s)}if(!t.every(i)||!r.every(i))return NaN;for(;t.length<r.length;)t.push("0");for(;r.length<t.length;)r.push("0");for(let s=0;s<t.length;++s)if(Number(t[s])!=Number(r[s]))return Number(t[s])>Number(r[s])?1:-1;return 0}function mA(){return hA()}function Hx(n){return Object.keys(n).forEach(e=>{n[e]!==null&&n[e]!==void 0&&typeof n[e]=="object"&&Hx(n[e])}),Object.freeze(n)}function gA(n,e,t){return new Promise((r,i)=>{const s=setTimeout(i,e,t);n().then(o=>{clearTimeout(s),r(o)}).catch(o=>{clearTimeout(s),i(o)})})}function vA(n){return n.protocol==="https:"}function yA(){if(Sh())throw new Error("window object undefined at SSR check");return window}function Sh(){return typeof window>"u"}function SA(n){return new RegExp(`${/<script[^>]*>|&lt;script[^&]*&gt;|%3Cscript[^%]*%3E/gi.source}|${/<\/script[^>]*>|&lt;\/script[^&]*&gt;|%3C\/script[^%]*%3E/gi.source}`,"gi").test(n)}function bA(n){if(!n)throw new Error("id must not be empty");if(pA(n)===!1)throw new Error("id must be a valid UUID")}const wA=!!performance&&"now"in performance;function $y(){return wA?performance.now()+performance.timeOrigin:void 0}function hw(n){var e,t;if(!(!((t=(e=n.hostVersionsInfo)===null||e===void 0?void 0:e.appEligibilityInformation)===null||t===void 0)&&t.ageGroup))return n;const r=n.hostVersionsInfo.appEligibilityInformation.ageGroup;return(r==null?void 0:r.toLowerCase())!=="nonadult"?n:Object.assign(Object.assign({},n),{hostVersionsInfo:Object.assign(Object.assign({},n.hostVersionsInfo),{appEligibilityInformation:Object.assign(Object.assign({},n.hostVersionsInfo.appEligibilityInformation),{ageGroup:xg.NotAdult})})})}let Ea=class{constructor(e=mA()){this.uuid=e,bA(e)}toString(){return this.uuid}serialize(){return this.toString()}};const Wx=n=>{const{uuid:e}=n,t=Tc(n,["uuid"]),r=e==null?void 0:e.toString();return Object.assign(Object.assign({},t),{uuidAsString:r})},CA=n=>{const{uuidAsString:e}=n,t=Tc(n,["uuidAsString"]);return Object.assign(Object.assign({},t),{uuid:e?new Ea(e):void 0})},_A=n=>{const{uuidAsString:e}=n,t=Tc(n,["uuidAsString"]);return Object.assign(Object.assign({},t),{uuid:e?new Ea(e):void 0})},EA=n=>{const{uuid:e}=n,t=Tc(n,["uuid"]),r=e==null?void 0:e.toString();return Object.assign(Object.assign({},t),{uuidAsString:r})};var Pg={exports:{}},fw,pw;function TA(){if(pw)return fw;pw=1;var n=1e3,e=60*n,t=60*e,r=24*t,i=7*r,s=365.25*r;function o(a,l,c,u){var d=l>=1.5*c;return Math.round(a/c)+" "+u+(d?"s":"")}return fw=function(a,l){l=l||{};var c=typeof a;if(c==="string"&&a.length>0)return function(u){if(!((u=String(u)).length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]);switch((d[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}(a);if(c==="number"&&isFinite(a))return l.long?function(u){var d=Math.abs(u);return d>=r?o(u,d,r,"day"):d>=t?o(u,d,t,"hour"):d>=e?o(u,d,e,"minute"):d>=n?o(u,d,n,"second"):u+" ms"}(a):function(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}var xA=function(n){function e(i){let s,o,a,l=null;function c(...u){if(!c.enabled)return;const d=c,h=Number(new Date),f=h-(s||h);d.diff=f,d.prev=s,d.curr=h,s=h,u[0]=e.coerce(u[0]),typeof u[0]!="string"&&u.unshift("%O");let p=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,(g,S)=>{if(g==="%%")return"%";p++;const m=e.formatters[S];if(typeof m=="function"){const v=u[p];g=m.call(d,v),u.splice(p,1),p--}return g}),e.formatArgs.call(d,u),(d.log||e.log).apply(d,u)}return c.namespace=i,c.useColors=e.useColors(),c.color=e.selectColor(i),c.extend=t,c.destroy=e.destroy,Object.defineProperty(c,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(o!==e.namespaces&&(o=e.namespaces,a=e.enabled(i)),a),set:u=>{l=u}}),typeof e.init=="function"&&e.init(c),c}function t(i,s){const o=e(this.namespace+(s===void 0?":":s)+i);return o.log=this.log,o}function r(i){return i.toString().substring(2,i.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(i){return i instanceof Error?i.stack||i.message:i},e.disable=function(){const i=[...e.names.map(r),...e.skips.map(r).map(s=>"-"+s)].join(",");return e.enable(""),i},e.enable=function(i){let s;e.save(i),e.namespaces=i,e.names=[],e.skips=[];const o=(typeof i=="string"?i:"").split(/[\s,]+/),a=o.length;for(s=0;s<a;s++)o[s]&&((i=o[s].replace(/\*/g,".*?"))[0]==="-"?e.skips.push(new RegExp("^"+i.slice(1)+"$")):e.names.push(new RegExp("^"+i+"$")))},e.enabled=function(i){if(i[i.length-1]==="*")return!0;let s,o;for(s=0,o=e.skips.length;s<o;s++)if(e.skips[s].test(i))return!1;for(s=0,o=e.names.length;s<o;s++)if(e.names[s].test(i))return!0;return!1},e.humanize=TA(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(n).forEach(i=>{e[i]=n[i]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(i){let s=0;for(let o=0;o<i.length;o++)s=(s<<5)-s+i.charCodeAt(o),s|=0;return e.colors[Math.abs(s)%e.colors.length]},e.enable(e.load()),e};(function(n,e){e.formatArgs=function(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;r.splice(1,0,i,"color: inherit");let s=0,o=0;r[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(s++,a==="%c"&&(o=s))}),r.splice(o,0,i)},e.save=function(r){try{r?e.storage.setItem("debug",r):e.storage.removeItem("debug")}catch{}},e.load=function(){let r;try{r=e.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r={}.DEBUG),r},e.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch{}}(),e.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),n.exports=xA(e);const{formatters:t}=n.exports;t.j=function(r){try{return JSON.stringify(r)}catch(i){return"[UnexpectedJSONParseError]: "+i.message}}})(Pg,Pg.exports);var jy=Pg.exports;const OA=new Ea,PA=jy.debug.formatArgs;jy.debug.formatArgs=function(n){n[0]=`(${new Date().toISOString()}): ${n[0]} [${OA.toString()}]`,PA.call(this,n)};const RA=jy.debug("teamsJs");function Ir(n){return RA.extend(n)}function ve(n,e){return`${n}_${e}`}function Vx(n){return/^v\d+_[\w.]+$/.test(n)}function zn(n){return n.uuidAsString!==void 0?`${n.uuidAsString} (legacy id: ${n.id})`:n.uuid!==void 0?`${n.uuid.toString()} (legacy id: ${n.id})`:`legacy id: ${n.id} (no uuid)`}const kA=Ir("flushMessageQueue");function qy(n,e,t,r){if(n&&e&&t.length!==0)for(;t.length>0;){const i=t.shift();if(i){const s=Wx(i);kA("Flushing message %s from %s message queue via postMessage.",zn(s),r),n.postMessage(s,e)}}}var NA=["teams.microsoft.com","teams.microsoft.us","gov.teams.microsoft.us","dod.teams.microsoft.us","int.teams.microsoft.com","outlook.office.com","outlook-sdf.office.com","outlook.office365.com","outlook-sdf.office365.com","outlook.office365.us","outlook-dod.office365.us","webmail.apps.mil","outlook.live.com","outlook-sdf.live.com","teams.live.com","local.teams.live.com","local.teams.live.com:8080","local.teams.office.com","local.teams.office.com:8080","devspaces.skype.com","*.www.office.com","www.office.com","word.office.com","excel.office.com","powerpoint.office.com","www.officeppe.com","*.www.microsoft365.com","www.microsoft365.com","bing.com","edgeservices.bing.com","work.bing.com","www.bing.com","www.staging-bing-int.com","*.cloud.microsoft","*.m365.cloud.microsoft","*.outlook.cloud.microsoft","chatuxmanager.svc.cloud.microsoft","copilot.microsoft.com","windows.msn.com","fa000000125.resources.office.net","fa000000129.resources.office.net","fa000000124.resources.office.net","fa000000128.resources.office.net","fa000000136.resources.office.net","fa000000125.officeapps.live.com","fa000000129.officeapps.live.com","fa000000124.officeapps.live.com","fa000000128.officeapps.live.com"];const mw="2.0.1",Bu=NA,gw=1500,LA=new URL("https://res.cdn.office.net/teams-js/validDomains/json/validDomains.json"),IA=/^https:\/\//,tc="The library has not yet been initialized",AA="The runtime has not yet been initialized",MA="The runtime version is not supported";let ae=class{};ae.initializeCalled=!1,ae.initializeCompleted=!1,ae.additionalValidOrigins=[],ae.initializePromise=void 0,ae.isFramelessWindow=!1,ae.frameContext=void 0,ae.hostClientType=void 0,ae.printCapabilityEnabled=!1,ae.teamsJsInstanceId=new Ea().toString();const Gx=Ir("runtime"),bh=4;function Kx(n){return n.apiVersion===bh}function DA(n){if(Kx(n))return!0;throw n.apiVersion===-1?new Error(AA):new Error(MA)}let an={apiVersion:-1,supports:{}};const FA={apiVersion:4,isNAAChannelRecommended:!1,isDeeplyNestedAuthSupported:!1,hostVersionsInfo:Bx,isLegacyTeams:!0,supports:{appInstallDialog:{},appEntity:{},call:{},chat:{},conversations:{},dialog:{card:{bot:{}},url:{bot:{},parentCommunication:{}},update:{}},interactive:{},logs:{},meetingRoom:{},menus:{},monetization:{},notifications:{},pages:{config:{},backStack:{},fullTrust:{}},remoteCamera:{},teams:{fullTrust:{}},teamsCore:{},video:{sharedFrame:{}}}},Jx=[pe.desktop,pe.web,pe.rigel,pe.surfaceHub,pe.teamsRoomsWindows,pe.teamsRoomsAndroid,pe.teamsPhones,pe.teamsDisplays],zA=[pe.android,pe.ios,pe.ipados,pe.visionOS],vw=[...Jx,...zA];function $A(n){let e=n;if(e.apiVersion<bh&&jA.forEach(t=>{e.apiVersion===t.versionToUpgradeFrom&&(e=t.upgradeToNextVersion(e))}),Kx(e))return e;throw new Error("Received a runtime that could not be upgraded to the latest version")}const jA=[{versionToUpgradeFrom:1,upgradeToNextVersion:n=>{var e;return{apiVersion:2,hostVersionsInfo:void 0,isLegacyTeams:n.isLegacyTeams,supports:Object.assign(Object.assign({},n.supports),{dialog:n.supports.dialog?{card:void 0,url:n.supports.dialog,update:(e=n.supports.dialog)===null||e===void 0?void 0:e.update}:void 0})}}},{versionToUpgradeFrom:2,upgradeToNextVersion:n=>{const e=n.supports,t=Tc(e,["appNotification"]);return Object.assign(Object.assign({},n),{apiVersion:3,supports:t})}},{versionToUpgradeFrom:3,upgradeToNextVersion:n=>{var e,t,r,i,s;return{apiVersion:4,hostVersionsInfo:n.hostVersionsInfo,isNAAChannelRecommended:n.isNAAChannelRecommended,isLegacyTeams:n.isLegacyTeams,supports:Object.assign(Object.assign({},n.supports),{dialog:n.supports.dialog?{card:(e=n.supports.dialog)===null||e===void 0?void 0:e.card,url:{bot:(r=(t=n.supports.dialog)===null||t===void 0?void 0:t.url)===null||r===void 0?void 0:r.bot,parentCommunication:!((i=n.supports.dialog)===null||i===void 0)&&i.url?{}:void 0},update:(s=n.supports.dialog)===null||s===void 0?void 0:s.update}:void 0})}}}],qA={"1.0.0":[{capability:{pages:{appButton:{},tabs:{}},stageView:{}},hostClientTypes:Jx}],"1.9.0":[{capability:{location:{}},hostClientTypes:vw}],"2.0.0":[{capability:{people:{}},hostClientTypes:vw},{capability:{sharing:{}},hostClientTypes:[pe.desktop,pe.web]}],"2.0.1":[{capability:{teams:{fullTrust:{joinedTeams:{}}}},hostClientTypes:[pe.android,pe.desktop,pe.ios,pe.teamsRoomsAndroid,pe.teamsPhones,pe.teamsDisplays,pe.web]},{capability:{webStorage:{}},hostClientTypes:[pe.desktop]}],"2.0.5":[{capability:{webStorage:{}},hostClientTypes:[pe.android,pe.ios]}],"2.0.8":[{capability:{sharing:{}},hostClientTypes:[pe.android,pe.ios]}],"2.1.1":[{capability:{nestedAppAuth:{}},hostClientTypes:[pe.android,pe.ios,pe.ipados,pe.visionOS]}],"2.1.2":[]},ip=Gx.extend("generateBackCompatRuntimeConfig");function Qx(n,e){const t=Object.assign({},n);for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(typeof e[r]!="object"||Array.isArray(e[r])?r in n||(t[r]=e[r]):t[r]=Qx(n[r]||{},e[r]));return t}function BA(n,e,t){ip("generating back compat runtime config for %s",n);let r=Object.assign({},e.supports);ip("Supported capabilities in config before updating based on highestSupportedVersion: %o",r),Object.keys(t).forEach(s=>{Ux(n,s)>=0&&t[s].forEach(o=>{ae.hostClientType!==void 0&&o.hostClientTypes.includes(ae.hostClientType)&&(r=Qx(r,o.capability))})});const i={apiVersion:bh,hostVersionsInfo:Bx,isLegacyTeams:!0,supports:r};return ip("Runtime config after updating based on highestSupportedVersion: %o",i),i}const sp=Gx.extend("applyRuntimeConfig");function op(n){typeof n.apiVersion=="string"&&(sp("Trying to apply runtime with string apiVersion, processing as v1: %o",n),n=Object.assign(Object.assign({},n),{apiVersion:1})),sp("Fast-forwarding runtime %o",n);const e=$A(n);sp("Applying runtime %o",e),an=Hx(e)}function UA(n){return n!=null&&n.serialize!==void 0&&typeof n.serialize=="function"}const nc="2.46.0";let Rd=class Co{static storeCallbackInformation(e,t){Co.callbackInformation.set(e,t)}static clearMessages(){Co.callbackInformation.clear()}static deleteMessageInformation(e){Co.callbackInformation.delete(e)}static handleOneWayPerformanceMetrics(e,t,r){const i=e.monotonicTimestamp;i&&r?Rw({actionName:e.func,messageDelay:r-i,requestStartedAt:i}):t("Unable to send performance metrics for event %s",e.func)}static handlePerformanceMetrics(e,t,r,i){const s=Co.callbackInformation.get(e);s&&t.monotonicTimestamp&&i?(Rw({actionName:s.name,messageDelay:i-t.monotonicTimestamp,requestStartedAt:s.calledAt}),Co.deleteMessageInformation(e)):r("Unable to send performance metrics for callback %s with arguments %o",e.toString(),t.args)}};Rd.callbackInformation=new Map;const Xx=Ir("nestedAppAuthUtils"),HA=Xx.extend("tryPolyfillWithNestedAppAuthBridge"),WA="v2";function VA(n,e,t){var r;const i=HA;if(ae.isFramelessWindow)return void i("Cannot polyfill nestedAppAuthBridge as current window is frameless");if(!e)return void i("Cannot polyfill nestedAppAuthBridge as current window does not exist");if(e.parent!==e.top)return void i("Default NAA bridge injection not supported in nested iframe. Use standalone NAA bridge instead.");const s=(()=>{try{return JSON.parse(n)}catch{return null}})();if(!s||!(!((r=s.supports)===null||r===void 0)&&r.nestedAppAuth))return void i("Cannot polyfill nestedAppAuthBridge as current hub does not support nested app auth");const o=e;if(o.nestedAppAuthBridge)return void i("nestedAppAuthBridge already exists on current window, skipping polyfill");const a=function(l,c){const u=GA;if(!l)return u("nestedAppAuthBridge cannot be created as current window does not exist"),null;const{onMessage:d,sendPostMessage:h}=c,f=p=>g=>d(g,p);return{addEventListener:(p,g)=>{p==="message"?l.addEventListener(p,f(g)):u(`Event ${p} is not supported by nestedAppAuthBridge`)},postMessage:p=>{const g=(()=>{try{return JSON.parse(p)}catch{return null}})();if(!g||typeof g!="object"||g.messageType!=="NestedAppAuthRequest")return void u("Unrecognized data format received by app, message being ignored. Message: %o",p);const S=ve(WA,"nestedAppAuth.execute");h(p,S)},removeEventListener:(p,g)=>{l.removeEventListener(p,f(g))}}}(o,t);a&&(o.nestedAppAuthBridge=a)}const GA=Xx.extend("createNestedAppAuthBridge");let bi=[];const Ei=Ir("validateOrigin");let fl;function KA(){return li(this,void 0,void 0,function*(){fl||(yield Zx())})}function Yx(){return bi.length===0}function Zx(n=!1){return li(this,void 0,void 0,function*(){if(!Yx()&&!n)return bi;if(fl)return fl;if(Sh())return bi=Bu,Bu;{Ei("Initiating fetch call to acquire valid origins list from CDN");const e=new AbortController,t=setTimeout(()=>e.abort(),gw);return fl=fetch(LA,{signal:e.signal}).then(r=>{if(clearTimeout(t),!r.ok)throw new Error("Invalid Response from Fetch Call");return Ei("Fetch call completed and retrieved valid origins list from CDN"),r.json().then(i=>{if(function(s){let o=JSON.parse(s);try{o=JSON.parse(s)}catch{return!1}if(!o.validOrigins)return!1;for(const a of o.validOrigins)try{new URL("https://"+a)}catch{return Ei("isValidOriginsFromCDN call failed to validate origin: %s",a),!1}return!0}(JSON.stringify(i)))return bi=i.validOrigins,bi;throw new Error("Valid origins list retrieved from CDN is invalid")})}).catch(r=>(r.name==="AbortError"?Ei(`validOrigins fetch call to CDN failed due to Timeout of ${gw} ms. Defaulting to fallback list`):Ei("validOrigins fetch call to CDN failed with error: %s. Defaulting to fallback list",r),bi=Bu,bi)),fl}})}function yw(n,e){if(n.substring(0,2)==="*."){const t=n.substring(1);if(e.length>t.length&&e.split(".").length===t.split(".").length&&e.substring(e.length-t.length)===t)return!0}else if(n===e)return!0;return!1}function JA(n,e){const t=Yx()?Bu:bi;return Sw(n,t)?Promise.resolve(!0):(Ei("Origin %s is not in the local valid origins list, fetching from CDN",n),Zx(e).then(r=>Sw(n,r)))}function Sw(n,e){if(!vA(n))return Ei("Origin %s is invalid because it is not using https protocol. Protocol being used: %s",n,n.protocol),!1;const t=n.host;if(e.some(r=>yw(r,t)))return!0;for(const r of ae.additionalValidOrigins)if(yw(r.substring(0,8)==="https://"?r.substring(8):r,t))return!0;return Ei(`Origin %s is invalid because it is not an origin approved by this library or included in the call to app.initialize.
Origins approved by this library: %o
Origins included in app.initialize: %o`,n,e,ae.additionalValidOrigins),!1}KA();const no=Ir("communication");let Y=class{},me=class{};function QA(n,e){if(me.messageListener=t=>function(r){return li(this,void 0,void 0,function*(){if(!r||!r.data||typeof r.data!="object")return void bw("Unrecognized message format received by app, message being ignored. Message: %o",r);const i=r.source||r.originalEvent&&r.originalEvent.source,s=r.origin||r.originalEvent&&r.originalEvent.origin;return tO(i,s).then(o=>{o?(function(a,l){ae.isFramelessWindow||Y.parentWindow&&!Y.parentWindow.closed&&a!==Y.parentWindow||(Y.parentWindow=a,Y.parentOrigin=l),Y.parentWindow&&Y.parentWindow.closed&&(Y.parentWindow=null,Y.parentOrigin=null),qy(Y.parentWindow,Y.parentOrigin,me.parentMessageQueue,"parent")}(i,s),i!==Y.parentWindow?JM(i,s)&&QM(r,i,By,(a,l)=>me.callbacks.set(a,l)):Cw(r)):bw("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin, message: %o, source: %o, origin: %o",r,i,s)})})}(t),Y.currentWindow=Y.currentWindow||yA(),Y.parentWindow=Y.currentWindow.parent!==Y.currentWindow.self?Y.currentWindow.parent:Y.currentWindow.opener,Y.topWindow=Y.currentWindow.top,(Y.parentWindow||n)&&Y.currentWindow.addEventListener("message",me.messageListener,!1),!Y.parentWindow){const t=Y.currentWindow;if(!t.nativeInterface)return Promise.reject(new Error("Initialization Failed. No Parent window found."));ae.isFramelessWindow=!0,t.onNativeMessage=Cw}try{return Y.parentOrigin="*",xc(e,"initialize",[nc,bh,n]).then(([t,r,i,s])=>(VA(s,Y.currentWindow,{onMessage:oM,sendPostMessage:nM}),{context:t,clientType:r,runtimeConfig:i,clientSupportedSDKVersion:s}))}finally{Y.parentOrigin=null}}function XA(n,e,...t){return xc(n,e,t).then(([r])=>r)}function YA(n,e,t,...r){return xc(n,e,r).then(([i,s])=>{if(!i)throw new Error(s||t)})}function fi(n,e,...t){return xc(n,e,t).then(([r,i])=>{if(r)throw r;return i})}function xc(n,e,t=void 0){if(!Vx(n))throw Error(`apiVersionTag: ${n} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);return new Promise(r=>{const i=By(n,e,t);var s;r((s=i.uuid,new Promise(o=>{me.promiseCallbacks.set(s,o)})))})}function ZA(n){return n.map(e=>UA(e)?e.serialize():e)}function eM(n,e,t,r,i){var s;return li(this,void 0,void 0,function*(){const o=ZA(e),[a]=yield xc(r,n,o);if(i&&i(a)||!i&&aA(a))throw new Error(`${a.errorCode}, message: ${(s=a.message)!==null&&s!==void 0?s:"None"}`);if(t.validate(a))return t.deserialize(a);throw new Error(`${Pd.INTERNAL_ERROR}, message: Invalid response from host - ${JSON.stringify(a)}`)})}function Cn(n,e,t,r){let i;if(t instanceof Function?r=t:t instanceof Array&&(i=t),!Vx(n))throw Error(`apiVersionTag: ${n} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);const s=By(n,e,i);r&&me.callbacks.set(s.uuid,r)}me.parentMessageQueue=[],me.topMessageQueue=[],me.nextMessageId=0,me.callbacks=new Map,me.promiseCallbacks=new Map,me.portCallbacks=new Map,me.legacyMessageIdsToUuidMap={};const tM=no.extend("sendNestedAuthRequestToTopWindow");function nM(n,e){const t=tM,r=Y.topWindow,i=function(s,o){const a=me.nextMessageId++,l=new Ea;return me.legacyMessageIdsToUuidMap[a]=l,{id:a,uuid:l,func:"nestedAppAuth.execute",timestamp:Date.now(),monotonicTimestamp:$y(),apiVersionTag:o,args:[],data:s}}(n,e);return t("Message %s information: %o",zn(i),{actionName:i.func}),eO(r,i)}const rM=no.extend("sendRequestToTargetWindowHelper");function eO(n,e){const t=rM,r=function(s){return s===Y.topWindow&&Rg()?"top":s===Y.parentWindow?"parent":null}(n),i=Wx(e);if(ae.isFramelessWindow)Y.currentWindow&&Y.currentWindow.nativeInterface&&(t("Sending message %s to %s via framelessPostMessage interface",zn(i),r),Y.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(i)));else{const s=function(o){return o===Y.topWindow&&Rg()?Y.topOrigin:o===Y.parentWindow?Y.parentOrigin:null}(n);n&&s?(t("Sending message %s to %s via postMessage",zn(i),r),n.postMessage(i,s)):(t("Adding message %s to %s message queue",zn(i),r),aM(n).push(e))}return e}const iM=no.extend("sendMessageToParentHelper");function By(n,e,t,r,i){const s=iM,o=Y.parentWindow,a=function(l,c,u,d,h){const f=me.nextMessageId++,p=new Ea;me.legacyMessageIdsToUuidMap[f]=p;const g=d===!0?h:ae.teamsJsInstanceId;return{id:f,uuid:p,func:c,timestamp:Date.now(),monotonicTimestamp:$y(),args:u||[],apiVersionTag:l,isProxiedFromChild:d!=null&&d,teamsJsInstanceId:g}}(n,e,t,r,i);return Rd.storeCallbackInformation(a.uuid,{name:e,calledAt:a.timestamp}),s("Message %s information: %o",zn(a),{actionName:e,args:t}),eO(o,a)}const bw=no.extend("processIncomingMessage"),sM=no.extend("processAuthBridgeMessage");function oM(n,e){var t,r;const i=sM;if(!n||!n.data||typeof n.data!="object")return void i("Unrecognized message format received by app, message being ignored. Message: %o",n);const{args:s}=n.data,[,o]=s??[],a=(()=>{try{return JSON.parse(o)}catch{return null}})();if(!a||typeof a!="object"||a.messageType!=="NestedAppAuthResponse")return void i("Unrecognized data format received by app, message being ignored. Message: %o",n);const l=n.source||((t=n==null?void 0:n.originalEvent)===null||t===void 0?void 0:t.source),c=n.origin||((r=n==null?void 0:n.originalEvent)===null||r===void 0?void 0:r.origin);l?tO(l,c)?(Y.topWindow&&!Y.topWindow.closed&&l!==Y.topWindow||(Y.topWindow=l,Y.topOrigin=c),Y.topWindow&&Y.topWindow.closed&&(Y.topWindow=null,Y.topOrigin=null),qy(Y.topWindow,Y.topOrigin,me.topMessageQueue,"top"),e(o)):i("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin"):i("Message being ignored by app because it is coming for a target that is null")}const ap=no.extend("shouldProcessIncomingMessage");function tO(n,e){return li(this,void 0,void 0,function*(){if(Y.currentWindow&&n===Y.currentWindow)return ap("Should not process message because it is coming from the current window"),!1;if(Y.currentWindow&&Y.currentWindow.location&&e&&e===Y.currentWindow.location.origin)return!0;{let t;try{t=new URL(e)}catch{return ap("Message has an invalid origin of %s",e),!1}const r=yield JA(t);return r||ap("Message has an invalid origin of %s",e),r}})}const ww=no.extend("handleIncomingMessageFromParent");function Uu(n,e){if(e){const t=[...n].find(([r,i])=>r.toString()===e.toString());if(t)return t[0]}}function lp(n,e){const t=Uu(e,n.uuid);t&&e.delete(t),n.uuid?me.legacyMessageIdsToUuidMap={}:delete me.legacyMessageIdsToUuidMap[n.id]}function Cw(n){const e=ww,t=$y();if("id"in n.data&&typeof n.data.id=="number"){const r=n.data,i=_A(r),s=function(o){const a=ww;if(!o.uuid)return me.legacyMessageIdsToUuidMap[o.id];{const l=o.uuid,c=Uu(me.callbacks,l);if(c)return c;const u=Uu(me.promiseCallbacks,l);if(u)return u;const d=Uu(me.portCallbacks,l);if(d)return d}a("Received message %s that failed to produce a callbackId",zn(o))}(i);if(s){const o=me.callbacks.get(s);e("Received a response from parent for message %s",s.toString()),Rd.handlePerformanceMetrics(s,i,e,t),o&&(e("Invoking the registered callback for message %s with arguments %o",s.toString(),i.args),o.apply(null,[...i.args,i.isPartialResponse]),function(c){return c.data.isPartialResponse===!0}(n)||(e("Removing registered callback for message %s",s.toString()),lp(i,me.callbacks)));const a=me.promiseCallbacks.get(s);a&&(e("Invoking the registered promise callback for message %s with arguments %o",s.toString(),i.args),a(i.args),e("Removing registered promise callback for message %s",s.toString()),lp(i,me.promiseCallbacks));const l=me.portCallbacks.get(s);if(l){let c;e("Invoking the registered port callback for message %s with arguments %o",s.toString(),i.args),n.ports&&n.ports[0]instanceof MessagePort&&(c=n.ports[0]),l(c,i.args),e("Removing registered port callback for message %s",s.toString()),lp(i,me.portCallbacks)}i.uuid&&(me.legacyMessageIdsToUuidMap={})}}else if("func"in n.data&&typeof n.data.func=="string"){const r=n.data;Rd.handleOneWayPerformanceMetrics(r,e,t),e('Received a message from parent %s, action: "%s"',zn(r),r.func),lO(r.func,r.args)}else e("Received an unknown message: %O",n)}function Rg(){return Y.topWindow!==Y.parentWindow}function aM(n){return n===Y.topWindow&&Rg()?me.topMessageQueue:n===Y.parentWindow?me.parentMessageQueue:[]}const nO=Ir("internal"),lM=nO.extend("ensureInitializeCalled"),cM=nO.extend("ensureInitialized");function rO(){if(!ae.initializeCalled)throw lM(tc),new Error(tc)}function ci(n,...e){if(!ae.initializeCompleted)throw cM("%s. initializeCalled: %s",tc,ae.initializeCalled.toString()),new Error(tc);if(e&&e.length>0){let t=!1;for(let r=0;r<e.length;r++)if(e[r]===ae.frameContext){t=!0;break}if(!t)throw new Error(`This call is only allowed in following contexts: ${JSON.stringify(e)}. Current context: "${ae.frameContext}".`)}return DA(n)}function uM(n){let e=ae.additionalValidOrigins.concat(n.filter(r=>typeof r=="string"&&IA.test(r)));const t={};e=e.filter(r=>!t[r]&&(t[r]=!0,!0)),ae.additionalValidOrigins=e}function dM(n){if(!fM(n))throw new Error(`Potential app id (${n}) is invalid; its length ${n.length} is not within the length limits (${iO}-${sO}).`)}function hM(n){if(SA(n))throw new Error(`Potential app id (${n}) is invalid; it contains script tags.`);if(pM(n))throw new Error(`Potential app id (${n}) is invalid; it contains non-printable characters.`)}const iO=4,sO=256;function fM(n){return n.length<sO&&n.length>iO}function pM(n){return[...n].some(e=>{const t=e.charCodeAt(0);return t<32||t>126})}let mM=class{constructor(e){this.idAsString=e,hM(e)}serialize(){return this.toString()}toString(){return this.idAsString}},gM=class extends mM{constructor(e){super(e),dM(e)}toJSON(){return{appIdAsString:this.toString()}}};const wh="v2",cp=Ir("app"),kg={AppLoaded:"appInitialization.appLoaded",Success:"appInitialization.success",Failure:"appInitialization.failure",ExpectedFailure:"appInitialization.expectedFailure"};var _w,Ew;function Uy(n){return AM(ve(wh,"app.initialize"),n)}function oO(){return new Promise(n=>{rO(),n(XA(ve(wh,"app.getContext"),"getContext"))}).then(n=>function(e){var t;return{actionInfo:e.actionInfo,app:{locale:e.locale,sessionId:e.appSessionId?e.appSessionId:"",theme:e.theme?e.theme:"default",iconPositionVertical:e.appIconPosition,osLocaleInfo:e.osLocaleInfo,messageId:e.messageId,parentMessageId:e.parentMessageId,userClickTime:e.userClickTime,userClickTimeV2:e.userClickTimeV2,userFileOpenPreference:e.userFileOpenPreference,host:{name:e.hostName?e.hostName:Og.teams,clientType:e.hostClientType?e.hostClientType:pe.web,sessionId:e.sessionId?e.sessionId:"",ringId:e.ringId},appLaunchId:e.appLaunchId,appId:e.appId?new gM(e.appId):void 0,manifestVersion:e.manifestVersion},page:{id:e.entityId,frameContext:e.frameContext?e.frameContext:ae.frameContext,renderingSurface:e.renderingSurface?e.renderingSurface:void 0,subPageId:e.subEntityId,isFullScreen:e.isFullScreen,isMultiWindow:e.isMultiWindow,isBackgroundLoad:e.isBackgroundLoad,sourceOrigin:e.sourceOrigin},user:{id:(t=e.userObjectId)!==null&&t!==void 0?t:"",displayName:e.userDisplayName,isCallingAllowed:e.isCallingAllowed,isPSTNCallingAllowed:e.isPSTNCallingAllowed,licenseType:e.userLicenseType,loginHint:e.loginHint,userPrincipalName:e.userPrincipalName,tenant:e.tid?{id:e.tid,teamsSku:e.tenantSKU}:void 0},channel:e.channelId?{id:e.channelId,displayName:e.channelName,relativeUrl:e.channelRelativeUrl,membershipType:e.channelType,defaultOneNoteSectionId:e.defaultOneNoteSectionId,ownerGroupId:e.hostTeamGroupId,ownerTenantId:e.hostTeamTenantId}:void 0,chat:e.chatId?{id:e.chatId}:void 0,meeting:e.meetingId?{id:e.meetingId}:void 0,sharepoint:e.sharepoint,team:e.teamId?{internalId:e.teamId,displayName:e.teamName,type:e.teamType,groupId:e.groupId,templateId:e.teamTemplateId,isArchived:e.isTeamArchived,userRole:e.userTeamRole}:void 0,sharePointSite:e.teamSiteUrl||e.teamSiteDomain||e.teamSitePath||e.mySitePath||e.mySiteDomain?{teamSiteUrl:e.teamSiteUrl,teamSiteDomain:e.teamSiteDomain,teamSitePath:e.teamSitePath,teamSiteId:e.teamSiteId,mySitePath:e.mySitePath,mySiteDomain:e.mySiteDomain}:void 0,dialogParameters:e.dialogParameters||{}}}(n))}function vM(){rO(),MM(ve(wh,"app.notifyAppLoaded"))}function yM(){return DM(ve(wh,"app.notifySuccess"))}(function(n){n.AuthFailed="AuthFailed",n.Timeout="Timeout",n.Other="Other"})(_w||(_w={})),function(n){n.PermissionError="PermissionError",n.NotFound="NotFound",n.Throttling="Throttling",n.Offline="Offline",n.Other="Other"}(Ew||(Ew={})),cp("teamsjs instance is version %s, starting at %s UTC (%s local)",nc,new Date().toISOString(),new Date().toLocaleString()),function(){if(Sh())return;const n=document.getElementsByTagName("script"),e=n&&n[n.length-1]&&n[n.length-1].src,t="Today, teamsjs can only be used from a single script or you may see undefined behavior. This log line is used to help detect cases where teamsjs is loaded multiple times -- it is always written. The presence of the log itself does not indicate a multi-load situation, but multiples of these log lines will. If you would like to use teamjs from more than one script at the same time, please open an issue at https://github.com/OfficeDev/microsoft-teams-library-js/issues";e&&e.length!==0?cp("teamsjs is being used from %s. %s",e,t):cp("teamsjs is being used from a script tag embedded directly in your html. %s",t)}();const SM="v2",bM=[];function wM(n){ae.frameContext&&(ae.frameContext===Dn.task?bM.push(n):HM("messageForChild"))}function CM(){Ds(ve(SM,"dialog.registerMessageForChildHandler"),"messageForChild",wM,!1)}const Vo="v2";var Tw,xw;(function(n){n[n.ifRoom=0]="ifRoom",n[n.overflowOnly=1]="overflowOnly"})(Tw||(Tw={}));function _M(){Ds(ve(Vo,"menus.registerNavBarMenuItemPressHandler"),"navBarMenuItemPress",TM,!1),Ds(ve(Vo,"menus.registerActionMenuItemPressHandler"),"actionMenuItemPress",xM,!1),Ds(ve(Vo,"menus.registerSetModuleViewHandler"),"setModuleView",EM,!1)}function EM(n){ci(an),Cn(ve(Vo,"menus.handleViewConfigItemPress"),"viewConfigItemPress",[n])}function TM(n){ci(an),Cn(ve(Vo,"menus.handleNavBarMenuItemPress"),"handleNavBarMenuItemPress",[n])}function xM(n){ci(an),Cn(ve(Vo,"menus.handleActionMenuItemPress"),"handleActionMenuItemPress",[n])}(function(n){n.dropDown="dropDown",n.popOver="popOver"})(xw||(xw={}));class OM{}class PM extends OM{validate(e){return!0}deserialize(e){return e}}function RM(){Ds(ve(Vs,"pages.config.registerSettingsSaveHandler"),"settings.save",kM,!1),Ds(ve(Vs,"pages.config.registerSettingsRemoveHandler"),"settings.remove",LM,!1)}function kM(n){const e=new NM(n);ri()?ii("settings.save",[n]):e.notifySuccess()}let NM=class{constructor(e){this.notified=!1,this.result=e||{}}notifySuccess(){this.ensureNotNotified(),Cn(ve(Vs,"pages.saveEvent.notifySuccess"),"settings.save.success"),this.notified=!0}notifyFailure(e){this.ensureNotNotified(),Cn(ve(Vs,"pages.saveEvent.notifyFailure"),"settings.save.failure",[e]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The SaveEvent may only notify success or failure once.")}};function LM(){const n=new IM;ri()?ii("settings.remove",[]):n.notifySuccess()}class IM{constructor(){this.notified=!1}notifySuccess(){this.ensureNotNotified(),Cn(ve(Vs,"pages.removeEvent.notifySuccess"),"settings.remove.success"),this.notified=!0}notifyFailure(e){this.ensureNotNotified(),Cn(ve(Vs,"pages.removeEvent.notifyFailure"),"settings.remove.failure",[e]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The removeEventType may only notify success or failure once.")}}const aO=Ir("app");function AM(n,e){return Sh()?(aO.extend("initialize")("window object undefined at initialization"),Promise.resolve()):gA(()=>function(t,r){return new Promise(i=>{ae.initializeCalled||(ae.initializeCalled=!0,UM(),ae.initializePromise=QA(r,t).then(({context:s,clientType:o,runtimeConfig:a,clientSupportedSDKVersion:l=mw})=>{ae.frameContext=s,ae.hostClientType=o,ae.clientSupportedSDKVersion=l;try{Qa("Parsing %s",a);let c=JSON.parse(a);if(Qa("Checking if %o is a valid runtime object",c??"null"),!c||!c.apiVersion)throw new Error("Received runtime config is invalid");c=hw(c),a&&op(c)}catch(c){if(!(c instanceof SyntaxError))throw c;try{Qa("Attempting to parse %s as an SDK version",a),isNaN(Ux(a,mw))||(ae.clientSupportedSDKVersion=a);let u=JSON.parse(l);if(Qa("givenRuntimeConfig parsed to %o",u??"null"),!u)throw new Error("givenRuntimeConfig string was successfully parsed. However, it parsed to value of null");u=hw(u),op(u)}catch(u){if(!(u instanceof SyntaxError))throw u;op(BA(ae.clientSupportedSDKVersion,FA,qA))}}ae.initializeCompleted=!0}),_M(),RM(),CM()),Array.isArray(r)&&uM(r),ae.initializePromise!==void 0?i(ae.initializePromise):Qa("GlobalVars.initializePromise is unexpectedly undefined")})}(n,e),6e4,new Error("SDK initialization timed out."))}function MM(n){Cn(n,kg.AppLoaded,[nc])}function DM(n){return li(this,void 0,void 0,function*(){if(ae.initializeCompleted)return Ow(n);if(!ae.initializePromise)throw new Error(tc);return ae.initializePromise.then(()=>Ow(n))})}function Ow(n){return li(this,void 0,void 0,function*(){return ci(an)&&(!((e=an.supports.app)===null||e===void 0)&&e.notifySuccessResponse)?eM(kg.Success,[nc],new PM,n).then(()=>({hasFinishedSuccessfully:!0})):(Cn(n,kg.Success,[nc]),{hasFinishedSuccessfully:"unknown"});var e})}const Qa=aO.extend("initializeHelper");function FM(){return $M(ve(Vs,"pages.backStack.navigateBack"))}function zM(){return!(!ci(an)||!an.supports.pages)&&!!an.supports.pages.backStack}const Vs="v2";function $M(n){return new Promise(e=>{if(ci(an),!zM())throw lA;e(YA(n,"navigateBack","Back navigation is not supported in the current client or context."))})}function jM(){Ds(ve("v2","pages.backStack.registerBackButtonPressHandler"),"backButtonPress",qM,!1)}function qM(){ri()?ii("backButtonPress",[]):FM()}const BM=Ir("handlers");let ze=class lr{static initializeHandlers(){lr.handlers.themeChange=WM,lr.handlers.load=VM,lr.handlers.beforeUnload=GM,jM()}static uninitializeHandlers(){lr.handlers={},lr.themeChangeHandler=null,lr.loadHandler=null,lr.beforeUnloadHandler=null,lr.beforeSuspendOrTerminateHandler=null,lr.resumeHandler=null}};function UM(){ze.initializeHandlers()}ze.handlers={},ze.themeChangeHandler=null,ze.loadHandler=null,ze.beforeUnloadHandler=null,ze.beforeSuspendOrTerminateHandler=null,ze.resumeHandler=null,ze.hostToAppPerformanceMetricsHandler=null;const Pw=BM.extend("callHandler");function lO(n,e){const t=ze.handlers[n];return t?(Pw("Invoking the registered handler for message %s with arguments %o",n,e),[!0,t.apply(this,e)]):ri()?(ii(n,e),[!1,void 0]):(Pw("Handler for action message %s not found.",n),[!1,void 0])}function Ds(n,e,t,r=!0,i=[]){t?(ze.handlers[e]=t,r&&Cn(n,"registerHandler",[e,...i])):delete ze.handlers[e]}function HM(n){delete ze.handlers[n]}function WM(n){ze.themeChangeHandler&&ze.themeChangeHandler(n),ri()&&ii("themeChange",[n])}function Rw(n){ze.hostToAppPerformanceMetricsHandler&&ze.hostToAppPerformanceMetricsHandler(n)}function VM(n){const e={entityId:(t=n).entityId,contentUrl:new URL(t.contentUrl)};var t;ze.resumeHandler?(ze.resumeHandler(e),ri()&&ii("load",[e])):ze.loadHandler&&(ze.loadHandler(n),ri()&&ii("load",[n]))}function GM(){return li(this,void 0,void 0,function*(){const n=()=>{Cn(ve("v2","handleBeforeUnload"),"readyToUnload",[])};ze.beforeSuspendOrTerminateHandler?(yield ze.beforeSuspendOrTerminateHandler(),ri()?ii("beforeUnload"):n()):ze.beforeUnloadHandler&&ze.beforeUnloadHandler(n)||(ri()?ii("beforeUnload"):n())})}const KM=Ir("childProxyingCommunication");let De=class{};function ri(){return!!qx()&&!!De.window}function JM(n,e){return!!qx()&&(De.window&&!De.window.closed&&n!==De.window||(De.window=n,De.origin=e),De.window&&De.window.closed?(De.window=null,De.origin=null,!1):De.window===n)}function QM(n,e,t,r){return li(this,void 0,void 0,function*(){De.window===e&&(qy(De.window,De.origin,De.messageQueue,"child"),function(i,s,o){if(i.data.id===void 0||i.data.func===void 0)return;const a=CA(i.data),[l,c]=lO(a.func,a.args);if(l&&c!==void 0)return pl("Handler called in response to message %s from child. Returning response from handler to child, action: %s.",zn(a),a.func),void kw(a.id,a.uuid,Array.isArray(c)?c:[c]);pl("No handler for message %s from child found; relaying message on to parent, action: %s. Relayed message will have a new id.",zn(a),a.func),function(u,d,h){const f=d(ve("v2","tasks.startTask"),u.func,u.args,!0,u.teamsJsInstanceId),p=De.origin;h(f.uuid,(...g)=>{if(!De.window)return;if(!oA().disableEnforceOriginMatchForChildResponses&&p!==De.origin)return void pl("Origin of child window has changed, not sending response back to child window");const S=g.pop();pl("Message from parent being relayed to child, id: %s",zn(u)),kw(u.id,u.uuid,g,S)})}(a,s,o)}(n,t,r))})}De.messageQueue=[];const pl=KM.extend("handleIncomingMessageFromChild");function kw(n,e,t,r){const i=De.window,s=function(l,c,u,d){return{id:l,uuid:c,args:u||[],isPartialResponse:d}}(n,e,t,r),o=EA(s),a=De.origin;i&&a&&(pl("Sending message %s to %s via postMessage, args = %o",zn(o),"child",o.args),i.postMessage(o,a))}function ii(n,e){const t=De.window,r=function(s,o){return{func:s,args:o||[]}}(n,e),i=De.origin;t&&i?t.postMessage(r,i):De.messageQueue.push(r)}const pi="v2";var Nw,Lw;function XM(){return!(!ci(an,Dn.meetingStage,Dn.sidePanel,Dn.content)||!an.supports.interactive)}(function(n){n.guest="Guest",n.attendee="Attendee",n.presenter="Presenter",n.organizer="Organizer"})(Nw||(Nw={})),function(n){n.added="Added",n.alreadyExists="AlreadyExists",n.conflict="Conflict",n.notFound="NotFound"}(Lw||(Lw={}));class Hy{getFluidTenantInfo(){return Mr(),new Promise(e=>{e(fi(ve(pi,"interactive.getFluidTenantInfo"),"interactive.getFluidTenantInfo"))})}getFluidToken(e){return Mr(),new Promise(t=>{t(fi(ve(pi,"interactive.getFluidToken"),"interactive.getFluidToken",e))})}getFluidContainerId(){return Mr(),new Promise(e=>{e(fi(ve(pi,"interactive.getFluidContainerId"),"interactive.getFluidContainerId"))})}setFluidContainerId(e){return Mr(),new Promise(t=>{t(fi(ve(pi,"interactive.setFluidContainerId"),"interactive.setFluidContainerId",e))})}getNtpTime(){return Mr(),new Promise(e=>{e(fi(ve(pi,"interactive.getNtpTime"),"interactive.getNtpTime"))})}registerClientId(e){return Mr(),new Promise(t=>{t(fi(ve(pi,"interactive.registerClientId"),"interactive.registerClientId",e))})}getClientRoles(e){return Mr(),new Promise(t=>{t(fi(ve(pi,"interactive.getClientRoles"),"interactive.getClientRoles",e))})}getClientInfo(e){return Mr(),new Promise(t=>{t(fi(ve(pi,"interactive.getClientInfo"),"interactive.getClientInfo",e))})}static create(){return Mr(),new Hy}}function Mr(){if(!XM())throw new Error("LiveShareHost Not supported")}const cO="v1";var Iw,Aw,Mw,Dw,Ng,Fw;function kd(n){if(!n)throw new Error("[get meeting details] Callback cannot be null");ci(an,Dn.sidePanel,Dn.meetingStage,Dn.settings,Dn.content),Cn(ve(cO,"meeting.getMeetingDetails"),"meeting.getMeetingDetails",n)}function YM(n,e,t={sharingProtocol:Ng.Collaborative}){if(!n)throw new Error("[share app content to stage] Callback cannot be null");ci(an,Dn.sidePanel,Dn.meetingStage),Cn(ve(cO,"meeting.shareAppContentToStage"),"meeting.shareAppContentToStage",[e,t],n)}(function(n){n[n.HostInitiated=0]="HostInitiated",n[n.AppInitiated=1]="AppInitiated",n[n.AppDeclinedToChange=2]="AppDeclinedToChange",n[n.AppFailedToChange=3]="AppFailedToChange"})(Iw||(Iw={})),function(n){n.like="like",n.heart="heart",n.laugh="laugh",n.surprised="surprised",n.applause="applause"}(Aw||(Aw={})),function(n){n.Unknown="Unknown",n.Adhoc="Adhoc",n.Scheduled="Scheduled",n.Recurring="Recurring",n.Broadcast="Broadcast",n.MeetNow="MeetNow"}(Mw||(Mw={})),function(n){n.OneOnOneCall="oneOnOneCall",n.GroupCall="groupCall"}(Dw||(Dw={})),function(n){n.Collaborative="Collaborative",n.ScreenShare="ScreenShare"}(Ng||(Ng={})),function(n){n.M365CalendarGridContextMenu="m365_calendar_grid_context_menu",n.M365CalendarGridPeek="m365_calendar_grid_peek",n.M365CalendarGridEventCardJoinButton="m365_calendar_grid_event_card_join_button",n.M365CalendarFormRibbonJoinButton="m365_calendar_form_ribbon_join_button",n.M365CalendarFormJoinTeamsMeetingButton="m365_calendar_form_join_teams_meeting_button",n.Other="other"}(Fw||(Fw={}));function ZM(){return!!new URLSearchParams(window.location.search).get("inTeams")}var Nd={},ui={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const uO=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string"&&typeof(n==null?void 0:n.fluid)=="object",zw=n=>{const e=n;return typeof e=="object"&&(typeof(e==null?void 0:e.package)=="string"||uO(e==null?void 0:e.package))&&((e==null?void 0:e.config)===void 0||typeof(e==null?void 0:e.config)=="object")};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Yi;(function(n){n.genericError="genericError",n.throttlingError="throttlingError",n.dataCorruptionError="dataCorruptionError",n.dataProcessingError="dataProcessingError",n.usageError="usageError",n.clientSessionExpiredError="clientSessionExpiredError"})(Yi||(Yi={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var je;(function(n){n.cache="fluid-cache",n.clientDetails="fluid-client-details",n.loadMode="loadMode",n.reconnect="fluid-reconnect",n.sequenceNumber="fluid-sequence-number",n.version="version"})(je||(je={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Z;(function(n){n.Detached="Detached",n.Attaching="Attaching",n.Attached="Attached"})(Z||(Z={}));var pn;(function(n){n.NotBound="NotBound",n.Binding="Binding",n.Bound="Bound"})(pn||(pn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var we;(function(n){n[n.Disconnected=0]="Disconnected",n[n.EstablishingConnection=3]="EstablishingConnection",n[n.Connecting=1]="Connecting",n[n.CatchingUp=1]="CatchingUp",n[n.Connected=2]="Connected"})(we||(we={}));function eD(){this.__data__=[],this.size=0}var tD=eD;function nD(n,e){return n===e||n!==n&&e!==e}var Ch=nD,rD=Ch;function iD(n,e){for(var t=n.length;t--;)if(rD(n[t][0],e))return t;return-1}var _h=iD,sD=_h,oD=Array.prototype,aD=oD.splice;function lD(n){var e=this.__data__,t=sD(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():aD.call(e,t,1),--this.size,!0}var cD=lD,uD=_h;function dD(n){var e=this.__data__,t=uD(e,n);return t<0?void 0:e[t][1]}var hD=dD,fD=_h;function pD(n){return fD(this.__data__,n)>-1}var mD=pD,gD=_h;function vD(n,e){var t=this.__data__,r=gD(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}var yD=vD,SD=tD,bD=cD,wD=hD,CD=mD,_D=yD;function Ta(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Ta.prototype.clear=SD;Ta.prototype.delete=bD;Ta.prototype.get=wD;Ta.prototype.has=CD;Ta.prototype.set=_D;var Eh=Ta,ED=Eh;function TD(){this.__data__=new ED,this.size=0}var xD=TD;function OD(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}var PD=OD;function RD(n){return this.__data__.get(n)}var kD=RD;function ND(n){return this.__data__.has(n)}var LD=ND,ID=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,dO=ID,AD=dO,MD=typeof self=="object"&&self&&self.Object===Object&&self,DD=AD||MD||Function("return this")(),Ar=DD,FD=Ar,zD=FD.Symbol,Wy=zD,$w=Wy,hO=Object.prototype,$D=hO.hasOwnProperty,jD=hO.toString,Xa=$w?$w.toStringTag:void 0;function qD(n){var e=$D.call(n,Xa),t=n[Xa];try{n[Xa]=void 0;var r=!0}catch{}var i=jD.call(n);return r&&(e?n[Xa]=t:delete n[Xa]),i}var BD=qD,UD=Object.prototype,HD=UD.toString;function WD(n){return HD.call(n)}var VD=WD,jw=Wy,GD=BD,KD=VD,JD="[object Null]",QD="[object Undefined]",qw=jw?jw.toStringTag:void 0;function XD(n){return n==null?n===void 0?QD:JD:qw&&qw in Object(n)?GD(n):KD(n)}var Oc=XD;function YD(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var is=YD,ZD=Oc,eF=is,tF="[object AsyncFunction]",nF="[object Function]",rF="[object GeneratorFunction]",iF="[object Proxy]";function sF(n){if(!eF(n))return!1;var e=ZD(n);return e==nF||e==rF||e==tF||e==iF}var Vy=sF,oF=Ar,aF=oF["__core-js_shared__"],lF=aF,up=lF,Bw=function(){var n=/[^.]+$/.exec(up&&up.keys&&up.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function cF(n){return!!Bw&&Bw in n}var uF=cF,dF=Function.prototype,hF=dF.toString;function fF(n){if(n!=null){try{return hF.call(n)}catch{}try{return n+""}catch{}}return""}var fO=fF,pF=Vy,mF=uF,gF=is,vF=fO,yF=/[\\^$.*+?()[\]{}|]/g,SF=/^\[object .+?Constructor\]$/,bF=Function.prototype,wF=Object.prototype,CF=bF.toString,_F=wF.hasOwnProperty,EF=RegExp("^"+CF.call(_F).replace(yF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function TF(n){if(!gF(n)||mF(n))return!1;var e=pF(n)?EF:SF;return e.test(vF(n))}var xF=TF;function OF(n,e){return n==null?void 0:n[e]}var PF=OF,RF=xF,kF=PF;function NF(n,e){var t=kF(n,e);return RF(t)?t:void 0}var ro=NF,LF=ro,IF=Ar,AF=LF(IF,"Map"),Gy=AF,MF=ro,DF=MF(Object,"create"),Th=DF,Uw=Th;function FF(){this.__data__=Uw?Uw(null):{},this.size=0}var zF=FF;function $F(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var jF=$F,qF=Th,BF="__lodash_hash_undefined__",UF=Object.prototype,HF=UF.hasOwnProperty;function WF(n){var e=this.__data__;if(qF){var t=e[n];return t===BF?void 0:t}return HF.call(e,n)?e[n]:void 0}var VF=WF,GF=Th,KF=Object.prototype,JF=KF.hasOwnProperty;function QF(n){var e=this.__data__;return GF?e[n]!==void 0:JF.call(e,n)}var XF=QF,YF=Th,ZF="__lodash_hash_undefined__";function ez(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=YF&&e===void 0?ZF:e,this}var tz=ez,nz=zF,rz=jF,iz=VF,sz=XF,oz=tz;function xa(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}xa.prototype.clear=nz;xa.prototype.delete=rz;xa.prototype.get=iz;xa.prototype.has=sz;xa.prototype.set=oz;var az=xa,Hw=az,lz=Eh,cz=Gy;function uz(){this.size=0,this.__data__={hash:new Hw,map:new(cz||lz),string:new Hw}}var dz=uz;function hz(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var fz=hz,pz=fz;function mz(n,e){var t=n.__data__;return pz(e)?t[typeof e=="string"?"string":"hash"]:t.map}var xh=mz,gz=xh;function vz(n){var e=gz(this,n).delete(n);return this.size-=e?1:0,e}var yz=vz,Sz=xh;function bz(n){return Sz(this,n).get(n)}var wz=bz,Cz=xh;function _z(n){return Cz(this,n).has(n)}var Ez=_z,Tz=xh;function xz(n,e){var t=Tz(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}var Oz=xz,Pz=dz,Rz=yz,kz=wz,Nz=Ez,Lz=Oz;function Oa(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Oa.prototype.clear=Pz;Oa.prototype.delete=Rz;Oa.prototype.get=kz;Oa.prototype.has=Nz;Oa.prototype.set=Lz;var Iz=Oa,Az=Eh,Mz=Gy,Dz=Iz,Fz=200;function zz(n,e){var t=this.__data__;if(t instanceof Az){var r=t.__data__;if(!Mz||r.length<Fz-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new Dz(r)}return t.set(n,e),this.size=t.size,this}var $z=zz,jz=Eh,qz=xD,Bz=PD,Uz=kD,Hz=LD,Wz=$z;function Pa(n){var e=this.__data__=new jz(n);this.size=e.size}Pa.prototype.clear=qz;Pa.prototype.delete=Bz;Pa.prototype.get=Uz;Pa.prototype.has=Hz;Pa.prototype.set=Wz;var pO=Pa,Vz=ro,Gz=function(){try{var n=Vz(Object,"defineProperty");return n({},"",{}),n}catch{}}(),mO=Gz,Ww=mO;function Kz(n,e,t){e=="__proto__"&&Ww?Ww(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var Ky=Kz,Jz=Ky,Qz=Ch;function Xz(n,e,t){(t!==void 0&&!Qz(n[e],t)||t===void 0&&!(e in n))&&Jz(n,e,t)}var gO=Xz;function Yz(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var l=o[n?a:++i];if(t(s[l],l,s)===!1)break}return e}}var Zz=Yz,e$=Zz,t$=e$(),n$=t$,Ld={exports:{}};Ld.exports;(function(n,e){var t=Ar,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s?t.Buffer:void 0,a=o?o.allocUnsafe:void 0;function l(c,u){if(u)return c.slice();var d=c.length,h=a?a(d):new c.constructor(d);return c.copy(h),h}n.exports=l})(Ld,Ld.exports);var vO=Ld.exports,r$=Ar,i$=r$.Uint8Array,s$=i$,Vw=s$;function o$(n){var e=new n.constructor(n.byteLength);return new Vw(e).set(new Vw(n)),e}var Jy=o$,a$=Jy;function l$(n,e){var t=e?a$(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var yO=l$;function c$(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var SO=c$,u$=is,Gw=Object.create,d$=function(){function n(){}return function(e){if(!u$(e))return{};if(Gw)return Gw(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}(),h$=d$;function f$(n,e){return function(t){return n(e(t))}}var bO=f$,p$=bO,m$=p$(Object.getPrototypeOf,Object),Qy=m$,g$=Object.prototype;function v$(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||g$;return n===t}var Xy=v$,y$=h$,S$=Qy,b$=Xy;function w$(n){return typeof n.constructor=="function"&&!b$(n)?y$(S$(n)):{}}var wO=w$;function C$(n){return n!=null&&typeof n=="object"}var io=C$,_$=Oc,E$=io,T$="[object Arguments]";function x$(n){return E$(n)&&_$(n)==T$}var O$=x$,Kw=O$,P$=io,CO=Object.prototype,R$=CO.hasOwnProperty,k$=CO.propertyIsEnumerable,N$=Kw(function(){return arguments}())?Kw:function(n){return P$(n)&&R$.call(n,"callee")&&!k$.call(n,"callee")},_O=N$,L$=Array.isArray,Oh=L$,I$=9007199254740991;function A$(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=I$}var EO=A$,M$=Vy,D$=EO;function F$(n){return n!=null&&D$(n.length)&&!M$(n)}var Ph=F$,z$=Ph,$$=io;function j$(n){return $$(n)&&z$(n)}var q$=j$,Id={exports:{}};function B$(){return!1}var U$=B$;Id.exports;(function(n,e){var t=Ar,r=U$,i=e&&!e.nodeType&&e,s=i&&!0&&n&&!n.nodeType&&n,o=s&&s.exports===i,a=o?t.Buffer:void 0,l=a?a.isBuffer:void 0,c=l||r;n.exports=c})(Id,Id.exports);var Yy=Id.exports,H$=Oc,W$=Qy,V$=io,G$="[object Object]",K$=Function.prototype,J$=Object.prototype,TO=K$.toString,Q$=J$.hasOwnProperty,X$=TO.call(Object);function Y$(n){if(!V$(n)||H$(n)!=G$)return!1;var e=W$(n);if(e===null)return!0;var t=Q$.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&TO.call(t)==X$}var Z$=Y$,ej=Oc,tj=EO,nj=io,rj="[object Arguments]",ij="[object Array]",sj="[object Boolean]",oj="[object Date]",aj="[object Error]",lj="[object Function]",cj="[object Map]",uj="[object Number]",dj="[object Object]",hj="[object RegExp]",fj="[object Set]",pj="[object String]",mj="[object WeakMap]",gj="[object ArrayBuffer]",vj="[object DataView]",yj="[object Float32Array]",Sj="[object Float64Array]",bj="[object Int8Array]",wj="[object Int16Array]",Cj="[object Int32Array]",_j="[object Uint8Array]",Ej="[object Uint8ClampedArray]",Tj="[object Uint16Array]",xj="[object Uint32Array]",Ie={};Ie[yj]=Ie[Sj]=Ie[bj]=Ie[wj]=Ie[Cj]=Ie[_j]=Ie[Ej]=Ie[Tj]=Ie[xj]=!0;Ie[rj]=Ie[ij]=Ie[gj]=Ie[sj]=Ie[vj]=Ie[oj]=Ie[aj]=Ie[lj]=Ie[cj]=Ie[uj]=Ie[dj]=Ie[hj]=Ie[fj]=Ie[pj]=Ie[mj]=!1;function Oj(n){return nj(n)&&tj(n.length)&&!!Ie[ej(n)]}var Pj=Oj;function Rj(n){return function(e){return n(e)}}var Zy=Rj,Ad={exports:{}};Ad.exports;(function(n,e){var t=dO,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s&&t.process,a=function(){try{var l=i&&i.require&&i.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();n.exports=a})(Ad,Ad.exports);var e0=Ad.exports,kj=Pj,Nj=Zy,Jw=e0,Qw=Jw&&Jw.isTypedArray,Lj=Qw?Nj(Qw):kj,xO=Lj;function Ij(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}var OO=Ij,Aj=Ky,Mj=Ch,Dj=Object.prototype,Fj=Dj.hasOwnProperty;function zj(n,e,t){var r=n[e];(!(Fj.call(n,e)&&Mj(r,t))||t===void 0&&!(e in n))&&Aj(n,e,t)}var PO=zj,$j=PO,jj=Ky;function qj(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=r?r(t[a],n[a],a,t,n):void 0;l===void 0&&(l=n[a]),i?jj(t,a,l):$j(t,a,l)}return t}var Pc=qj;function Bj(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var Uj=Bj,Hj=9007199254740991,Wj=/^(?:0|[1-9]\d*)$/;function Vj(n,e){var t=typeof n;return e=e??Hj,!!e&&(t=="number"||t!="symbol"&&Wj.test(n))&&n>-1&&n%1==0&&n<e}var RO=Vj,Gj=Uj,Kj=_O,Jj=Oh,Qj=Yy,Xj=RO,Yj=xO,Zj=Object.prototype,eq=Zj.hasOwnProperty;function tq(n,e){var t=Jj(n),r=!t&&Kj(n),i=!t&&!r&&Qj(n),s=!t&&!r&&!i&&Yj(n),o=t||r||i||s,a=o?Gj(n.length,String):[],l=a.length;for(var c in n)(e||eq.call(n,c))&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Xj(c,l)))&&a.push(c);return a}var kO=tq;function nq(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var rq=nq,iq=is,sq=Xy,oq=rq,aq=Object.prototype,lq=aq.hasOwnProperty;function cq(n){if(!iq(n))return oq(n);var e=sq(n),t=[];for(var r in n)r=="constructor"&&(e||!lq.call(n,r))||t.push(r);return t}var uq=cq,dq=kO,hq=uq,fq=Ph;function pq(n){return fq(n)?dq(n,!0):hq(n)}var Rc=pq,mq=Pc,gq=Rc;function vq(n){return mq(n,gq(n))}var yq=vq,Xw=gO,Sq=vO,bq=yO,wq=SO,Cq=wO,Yw=_O,Zw=Oh,_q=q$,Eq=Yy,Tq=Vy,xq=is,Oq=Z$,Pq=xO,eC=OO,Rq=yq;function kq(n,e,t,r,i,s,o){var a=eC(n,t),l=eC(e,t),c=o.get(l);if(c){Xw(n,t,c);return}var u=s?s(a,l,t+"",n,e,o):void 0,d=u===void 0;if(d){var h=Zw(l),f=!h&&Eq(l),p=!h&&!f&&Pq(l);u=l,h||f||p?Zw(a)?u=a:_q(a)?u=wq(a):f?(d=!1,u=Sq(l,!0)):p?(d=!1,u=bq(l,!0)):u=[]:Oq(l)||Yw(l)?(u=a,Yw(a)?u=Rq(a):(!xq(a)||Tq(a))&&(u=Cq(l))):d=!1}d&&(o.set(l,u),i(u,l,r,s,o),o.delete(l)),Xw(n,t,u)}var Nq=kq,Lq=pO,Iq=gO,Aq=n$,Mq=Nq,Dq=is,Fq=Rc,zq=OO;function NO(n,e,t,r,i){n!==e&&Aq(e,function(s,o){if(i||(i=new Lq),Dq(s))Mq(n,e,o,t,NO,r,i);else{var a=r?r(zq(n,o),s,o+"",n,e,i):void 0;a===void 0&&(a=s),Iq(n,o,a)}},Fq)}var $q=NO;function jq(n){return n}var LO=jq;function qq(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}var Bq=qq,Uq=Bq,tC=Math.max;function Hq(n,e,t){return e=tC(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=tC(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(o),Uq(n,this,a)}}var Wq=Hq;function Vq(n){return function(){return n}}var Gq=Vq,Kq=Gq,nC=mO,Jq=LO,Qq=nC?function(n,e){return nC(n,"toString",{configurable:!0,enumerable:!1,value:Kq(e),writable:!0})}:Jq,Xq=Qq,Yq=800,Zq=16,eB=Date.now;function tB(n){var e=0,t=0;return function(){var r=eB(),i=Zq-(r-t);if(t=r,i>0){if(++e>=Yq)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}var nB=tB,rB=Xq,iB=nB,sB=iB(rB),oB=sB,aB=LO,lB=Wq,cB=oB;function uB(n,e){return cB(lB(n,e,aB),n+"")}var dB=uB,hB=Ch,fB=Ph,pB=RO,mB=is;function gB(n,e,t){if(!mB(t))return!1;var r=typeof e;return(r=="number"?fB(t)&&pB(e,t.length):r=="string"&&e in t)?hB(t[e],n):!1}var vB=gB,yB=dB,SB=vB;function bB(n){return yB(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&SB(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,s)}return e})}var wB=bB,CB=$q,_B=wB,EB=_B(function(n,e,t){CB(n,e,t)}),TB=EB;const xB=oi(TB);var yu,OB=new Uint8Array(16);function PB(){if(!yu&&(yu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!yu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yu(OB)}const RB=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function kB(n){return typeof n=="string"&&RB.test(n)}var St=[];for(var dp=0;dp<256;++dp)St.push((dp+256).toString(16).substr(1));function NB(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(St[n[e+0]]+St[n[e+1]]+St[n[e+2]]+St[n[e+3]]+"-"+St[n[e+4]]+St[n[e+5]]+"-"+St[n[e+6]]+St[n[e+7]]+"-"+St[n[e+8]]+St[n[e+9]]+"-"+St[n[e+10]]+St[n[e+11]]+St[n[e+12]]+St[n[e+13]]+St[n[e+14]]+St[n[e+15]]).toLowerCase();if(!kB(t))throw TypeError("Stringified UUID is invalid");return t}function Ze(n,e,t){n=n||{};var r=n.random||(n.rng||PB)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return NB(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function q(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}var t0={};t0.byteLength=AB;var di=t0.toByteArray=DB,ir=t0.fromByteArray=$B,mr=[],Pn=[],LB=typeof Uint8Array<"u"?Uint8Array:Array,hp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var mo=0,IB=hp.length;mo<IB;++mo)mr[mo]=hp[mo],Pn[hp.charCodeAt(mo)]=mo;Pn["-".charCodeAt(0)]=62;Pn["_".charCodeAt(0)]=63;function IO(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function AB(n){var e=IO(n),t=e[0],r=e[1];return(t+r)*3/4-r}function MB(n,e,t){return(e+t)*3/4-t}function DB(n){var e,t=IO(n),r=t[0],i=t[1],s=new LB(MB(n,r,i)),o=0,a=i>0?r-4:r,l;for(l=0;l<a;l+=4)e=Pn[n.charCodeAt(l)]<<18|Pn[n.charCodeAt(l+1)]<<12|Pn[n.charCodeAt(l+2)]<<6|Pn[n.charCodeAt(l+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Pn[n.charCodeAt(l)]<<2|Pn[n.charCodeAt(l+1)]>>4,s[o++]=e&255),i===1&&(e=Pn[n.charCodeAt(l)]<<10|Pn[n.charCodeAt(l+1)]<<4|Pn[n.charCodeAt(l+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function FB(n){return mr[n>>18&63]+mr[n>>12&63]+mr[n>>6&63]+mr[n&63]}function zB(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(FB(r));return i.join("")}function $B(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(zB(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(mr[e>>2]+mr[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(mr[e>>10]+mr[e>>4&63]+mr[e<<2&63]+"=")),i.join("")}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jB(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const qB=(n,e)=>BB.from(n,e).buffer;function rC(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let BB=class hs extends Uint8Array{toString(e){return jB(this,e)}static from(e,t,r){if(typeof e=="string")return hs.fromString(e,t);if(e!==null&&typeof e=="object"&&rC(e.buffer))return q(e.byteOffset===0,0),q(e.byteLength===e.buffer.byteLength,1),hs.fromArrayBuffer(e.buffer,t,r);if(rC(e))return hs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new hs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new hs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new hs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};const UB="modulepreload",HB=function(n){return"/personal-whiteboard-app/"+n},iC={},AO=function(e,t,r){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=HB(s),s in iC)return;iC[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":UB,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Lt=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ya(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}var n0={exports:{}},Go=typeof Reflect=="object"?Reflect:null,sC=Go&&typeof Go.apply=="function"?Go.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},Hu;Go&&typeof Go.ownKeys=="function"?Hu=Go.ownKeys:Object.getOwnPropertySymbols?Hu=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Hu=function(e){return Object.getOwnPropertyNames(e)};function WB(n){console&&console.warn&&console.warn(n)}var MO=Number.isNaN||function(e){return e!==e};function Oe(){Oe.init.call(this)}n0.exports=Oe;n0.exports.once=JB;Oe.EventEmitter=Oe;Oe.prototype._events=void 0;Oe.prototype._eventsCount=0;Oe.prototype._maxListeners=void 0;var oC=10;function Rh(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Oe,"defaultMaxListeners",{enumerable:!0,get:function(){return oC},set:function(n){if(typeof n!="number"||n<0||MO(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");oC=n}});Oe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||MO(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function DO(n){return n._maxListeners===void 0?Oe.defaultMaxListeners:n._maxListeners}Oe.prototype.getMaxListeners=function(){return DO(this)};Oe.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")sC(l,this,t);else for(var c=l.length,u=qO(l,c),r=0;r<c;++r)sC(u[r],this,t);return!0};function FO(n,e,t,r){var i,s,o;if(Rh(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=r?[t,o]:[o,t]:r?o.unshift(t):o.push(t),i=DO(n),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=e,a.count=o.length,WB(a)}return n}Oe.prototype.addListener=function(e,t){return FO(this,e,t,!1)};Oe.prototype.on=Oe.prototype.addListener;Oe.prototype.prependListener=function(e,t){return FO(this,e,t,!0)};function VB(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zO(n,e,t){var r={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=VB.bind(r);return i.listener=t,r.wrapFn=i,i}Oe.prototype.once=function(e,t){return Rh(t),this.on(e,zO(this,e,t)),this};Oe.prototype.prependOnceListener=function(e,t){return Rh(t),this.prependListener(e,zO(this,e,t)),this};Oe.prototype.removeListener=function(e,t){var r,i,s,o,a;if(Rh(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():GB(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Oe.prototype.off=Oe.prototype.removeListener;Oe.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function $O(n,e,t){var r=n._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?KB(i):qO(i,i.length)}Oe.prototype.listeners=function(e){return $O(this,e,!0)};Oe.prototype.rawListeners=function(e){return $O(this,e,!1)};Oe.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):jO.call(n,e)};Oe.prototype.listenerCount=jO;function jO(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Oe.prototype.eventNames=function(){return this._eventsCount>0?Hu(this._events):[]};function qO(n,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=n[r];return t}function GB(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function KB(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function JB(n,e){return new Promise(function(t,r){function i(o){n.removeListener(e,s),r(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}BO(n,e,s,{once:!0}),e!=="error"&&QB(n,i,{once:!0})})}function QB(n,e,t){typeof n.on=="function"&&BO(n,"error",e,t)}function BO(n,e,t,r){if(typeof n.on=="function")r.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(s){r.once&&n.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var ln=n0.exports;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let kh=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let kc=class fs extends kh{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(fs.removeListenerEvent,t),this.on(fs.newListenerEvent,r)}}static isEmitterEvent(e){return e===fs.newListenerEvent||e===fs.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!fs.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!fs.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};kc.newListenerEvent="newListener";kc.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let XB=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};function YB(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var ZB=YB,e2=bO,t2=e2(Object.keys,Object),n2=t2,r2=Xy,i2=n2,s2=Object.prototype,o2=s2.hasOwnProperty;function a2(n){if(!r2(n))return i2(n);var e=[];for(var t in Object(n))o2.call(n,t)&&t!="constructor"&&e.push(t);return e}var l2=a2,c2=kO,u2=l2,d2=Ph;function h2(n){return d2(n)?c2(n):u2(n)}var r0=h2,f2=Pc,p2=r0;function m2(n,e){return n&&f2(e,p2(e),n)}var g2=m2,v2=Pc,y2=Rc;function S2(n,e){return n&&v2(e,y2(e),n)}var b2=S2;function w2(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var o=n[t];e(o,t,n)&&(s[i++]=o)}return s}var C2=w2;function _2(){return[]}var UO=_2,E2=C2,T2=UO,x2=Object.prototype,O2=x2.propertyIsEnumerable,aC=Object.getOwnPropertySymbols,P2=aC?function(n){return n==null?[]:(n=Object(n),E2(aC(n),function(e){return O2.call(n,e)}))}:T2,i0=P2,R2=Pc,k2=i0;function N2(n,e){return R2(n,k2(n),e)}var L2=N2;function I2(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var HO=I2,A2=HO,M2=Qy,D2=i0,F2=UO,z2=Object.getOwnPropertySymbols,$2=z2?function(n){for(var e=[];n;)A2(e,D2(n)),n=M2(n);return e}:F2,WO=$2,j2=Pc,q2=WO;function B2(n,e){return j2(n,q2(n),e)}var U2=B2,H2=HO,W2=Oh;function V2(n,e,t){var r=e(n);return W2(n)?r:H2(r,t(n))}var VO=V2,G2=VO,K2=i0,J2=r0;function Q2(n){return G2(n,J2,K2)}var X2=Q2,Y2=VO,Z2=WO,eU=Rc;function tU(n){return Y2(n,eU,Z2)}var nU=tU,rU=ro,iU=Ar,sU=rU(iU,"DataView"),oU=sU,aU=ro,lU=Ar,cU=aU(lU,"Promise"),uU=cU,dU=ro,hU=Ar,fU=dU(hU,"Set"),pU=fU,mU=ro,gU=Ar,vU=mU(gU,"WeakMap"),yU=vU,Lg=oU,Ig=Gy,Ag=uU,Mg=pU,Dg=yU,GO=Oc,Ra=fO,lC="[object Map]",SU="[object Object]",cC="[object Promise]",uC="[object Set]",dC="[object WeakMap]",hC="[object DataView]",bU=Ra(Lg),wU=Ra(Ig),CU=Ra(Ag),_U=Ra(Mg),EU=Ra(Dg),ps=GO;(Lg&&ps(new Lg(new ArrayBuffer(1)))!=hC||Ig&&ps(new Ig)!=lC||Ag&&ps(Ag.resolve())!=cC||Mg&&ps(new Mg)!=uC||Dg&&ps(new Dg)!=dC)&&(ps=function(n){var e=GO(n),t=e==SU?n.constructor:void 0,r=t?Ra(t):"";if(r)switch(r){case bU:return hC;case wU:return lC;case CU:return cC;case _U:return uC;case EU:return dC}return e});var s0=ps,TU=Object.prototype,xU=TU.hasOwnProperty;function OU(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&xU.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var PU=OU,RU=Jy;function kU(n,e){var t=e?RU(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}var NU=kU,LU=/\w*$/;function IU(n){var e=new n.constructor(n.source,LU.exec(n));return e.lastIndex=n.lastIndex,e}var AU=IU,fC=Wy,pC=fC?fC.prototype:void 0,mC=pC?pC.valueOf:void 0;function MU(n){return mC?Object(mC.call(n)):{}}var DU=MU,FU=Jy,zU=NU,$U=AU,jU=DU,qU=yO,BU="[object Boolean]",UU="[object Date]",HU="[object Map]",WU="[object Number]",VU="[object RegExp]",GU="[object Set]",KU="[object String]",JU="[object Symbol]",QU="[object ArrayBuffer]",XU="[object DataView]",YU="[object Float32Array]",ZU="[object Float64Array]",e3="[object Int8Array]",t3="[object Int16Array]",n3="[object Int32Array]",r3="[object Uint8Array]",i3="[object Uint8ClampedArray]",s3="[object Uint16Array]",o3="[object Uint32Array]";function a3(n,e,t){var r=n.constructor;switch(e){case QU:return FU(n);case BU:case UU:return new r(+n);case XU:return zU(n,t);case YU:case ZU:case e3:case t3:case n3:case r3:case i3:case s3:case o3:return qU(n,t);case HU:return new r;case WU:case KU:return new r(n);case VU:return $U(n);case GU:return new r;case JU:return jU(n)}}var l3=a3,c3=s0,u3=io,d3="[object Map]";function h3(n){return u3(n)&&c3(n)==d3}var f3=h3,p3=f3,m3=Zy,gC=e0,vC=gC&&gC.isMap,g3=vC?m3(vC):p3,v3=g3,y3=s0,S3=io,b3="[object Set]";function w3(n){return S3(n)&&y3(n)==b3}var C3=w3,_3=C3,E3=Zy,yC=e0,SC=yC&&yC.isSet,T3=SC?E3(SC):_3,x3=T3,O3=pO,P3=ZB,R3=PO,k3=g2,N3=b2,L3=vO,I3=SO,A3=L2,M3=U2,D3=X2,F3=nU,z3=s0,$3=PU,j3=l3,q3=wO,B3=Oh,U3=Yy,H3=v3,W3=is,V3=x3,G3=r0,K3=Rc,J3=1,Q3=2,X3=4,KO="[object Arguments]",Y3="[object Array]",Z3="[object Boolean]",e4="[object Date]",t4="[object Error]",JO="[object Function]",n4="[object GeneratorFunction]",r4="[object Map]",i4="[object Number]",QO="[object Object]",s4="[object RegExp]",o4="[object Set]",a4="[object String]",l4="[object Symbol]",c4="[object WeakMap]",u4="[object ArrayBuffer]",d4="[object DataView]",h4="[object Float32Array]",f4="[object Float64Array]",p4="[object Int8Array]",m4="[object Int16Array]",g4="[object Int32Array]",v4="[object Uint8Array]",y4="[object Uint8ClampedArray]",S4="[object Uint16Array]",b4="[object Uint32Array]",Pe={};Pe[KO]=Pe[Y3]=Pe[u4]=Pe[d4]=Pe[Z3]=Pe[e4]=Pe[h4]=Pe[f4]=Pe[p4]=Pe[m4]=Pe[g4]=Pe[r4]=Pe[i4]=Pe[QO]=Pe[s4]=Pe[o4]=Pe[a4]=Pe[l4]=Pe[v4]=Pe[y4]=Pe[S4]=Pe[b4]=!0;Pe[t4]=Pe[JO]=Pe[c4]=!1;function Wu(n,e,t,r,i,s){var o,a=e&J3,l=e&Q3,c=e&X3;if(t&&(o=i?t(n,r,i,s):t(n)),o!==void 0)return o;if(!W3(n))return n;var u=B3(n);if(u){if(o=$3(n),!a)return I3(n,o)}else{var d=z3(n),h=d==JO||d==n4;if(U3(n))return L3(n,a);if(d==QO||d==KO||h&&!i){if(o=l||h?{}:q3(n),!a)return l?M3(n,N3(o,n)):A3(n,k3(o,n))}else{if(!Pe[d])return i?n:{};o=j3(n,d,a)}}s||(s=new O3);var f=s.get(n);if(f)return f;s.set(n,o),V3(n)?n.forEach(function(S){o.add(Wu(S,e,t,S,n,s))}):H3(n)&&n.forEach(function(S,m){o.set(m,Wu(S,e,t,m,n,s))});var p=c?l?F3:D3:l?K3:G3,g=u?void 0:p(n);return P3(g||n,function(S,m){g&&(m=S,S=n[m]),R3(o,m,Wu(S,e,t,m,n,s))}),o}var w4=Wu,C4=w4,_4=1,E4=4;function T4(n){return C4(n,_4|E4)}var x4=T4;const ua=oi(x4);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Fg=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){q(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function zg(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function O4(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const rc=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let P4=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let R4=class{send(e){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let k4=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};var $g={exports:{}},fp,bC;function N4(){if(bC)return fp;bC=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;fp=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return o(u);if(h==="number"&&isFinite(u))return d.long?l(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=r?c(u,d,r,"day"):d>=t?c(u,d,t,"hour"):d>=e?c(u,d,e,"minute"):d>=n?c(u,d,n,"second"):u+" ms"}function c(u,d,h,f){var p=d>=h*1.5;return Math.round(u/h)+" "+f+(p?"s":"")}return fp}function L4(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=a,t.humanize=N4(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,f,p;function g(...S){if(!g.enabled)return;const m=g,v=Number(new Date),y=v-(d||v);m.diff=y,m.prev=d,m.curr=v,d=v,S[0]=t.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let b=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(x,E)=>{if(x==="%%")return"%";b++;const P=t.formatters[E];if(typeof P=="function"){const M=S[b];x=P.call(m,M),S.splice(b,1),b--}return x}),t.formatArgs.call(m,S),(m.log||t.log).apply(m,S)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==t.namespaces&&(f=t.namespaces,p=t.enabled(u)),p),set:S=>{h=S}}),typeof t.init=="function"&&t.init(g),g}function r(u,d){const h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];const d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const h of d)h[0]==="-"?t.skips.push(h.slice(1)):t.names.push(h)}function s(u,d){let h=0,f=0,p=-1,g=0;for(;h<u.length;)if(f<d.length&&(d[f]===u[h]||d[f]==="*"))d[f]==="*"?(p=f,g=h,f++):(h++,f++);else if(p!==-1)f=p+1,g++,h=g;else return!1;for(;f<d.length&&d[f]==="*";)f++;return f===d.length}function o(){const u=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),u}function a(u){for(const d of t.skips)if(s(u,d))return!1;for(const d of t.names)if(s(u,d))return!0;return!1}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var I4=L4;(function(n,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let u=0,d=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(u++,h==="%c"&&(d=u))}),l.splice(d,0,c)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function o(){try{return localStorage}catch{}}n.exports=I4(e);const{formatters:a}=n.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})($g,$g.exports);var jg=$g.exports;const XO=new k4(()=>M4(D4())),A4={getRawConfig:()=>{}},M4=n=>n!=null?new Nc({getRawConfig:e=>{var t,r;try{return(r=YO((t=n.getItem(e))!==null&&t!==void 0?t:void 0))===null||r===void 0?void 0:r.raw}catch{}}}):A4;function wC(n){switch(n){case"boolean":case"number":case"string":return!0;default:return!1}}function YO(n){let e=n,t;if(typeof n=="string")try{e=JSON.parse(n),t={raw:n,string:n}}catch{}if(e===void 0)return t;const r=typeof e;if(wC(r))return Object.assign(Object.assign({},t),{raw:n,[r]:e});if(Array.isArray(e)){const i=typeof e[0];if(!wC(i))return t;for(const s of e)if(typeof s!==i)return t;return Object.assign(Object.assign({},t),{raw:n,[`${i}[]`]:e})}return t}const D4=()=>{try{return sessionStorage!==null?sessionStorage:void 0}catch{return}};class Nc{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,r=[...e];for(;r.length>0;){const i=r.shift();i!==void 0&&ZO(i)&&!t.has(i)&&(t.add(i),i instanceof Nc?r.push(...i.orderedBaseProviders):this.orderedBaseProviders.push(i))}}getBoolean(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.boolean}getNumber(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.number}getString(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.string}getBooleanArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["boolean[]"]}getNumberArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["number[]"]}getStringArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["string[]"]}getRawConfig(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const r=YO(t==null?void 0:t.getRawConfig(e));if(r!==void 0)return this.configCache.set(e,r),r}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function o0(n){const e=n;return ZO(e==null?void 0:e.config)&&(e==null?void 0:e.logger)!==void 0}function ka(n){return o0(n)?n:a0(n,XO.value)}function a0(n,...e){if(o0(n))throw new Error("Logger is already a monitoring context");const t=n;return t.config=new Nc(...e),t.logger=n,t}function ZO(n){const e=n;return typeof(e==null?void 0:e.getRawConfig)=="function"}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const eP=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function"&&typeof(n==null?void 0:n.addTelemetryProperties)=="function",tP=n=>typeof(n==null?void 0:n.errorInstanceId)=="string";function nP(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&tP(n)&&eP(n)}function rP(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&eP(n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const F4=n=>n!==null&&!Array.isArray(n)&&typeof n=="object";function l0(n,e){const t=(s,o)=>{if(!e)return s;const a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(F4(n)){const{errorType:s,stack:o,name:a}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const l=typeof a=="string"?a:void 0;i.stack=t(o,l)}}return i}const c0=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function";function z4(n,e){for(const t of Object.keys(e))n[t]===void 0&&(n[t]=e[t])}function $4(n){const e=n;e.errorInstanceId===void 0&&(e.errorInstanceId=Ze())}function tr(n,e={}){var t;if(rP(n)&&$4(n),nP(n))return n.addTelemetryProperties((t=e.props)!==null&&t!==void 0?t:{}),n;const{message:r,stack:i}=l0(n,!1),s=new Lc({message:r,stack:i});if(typeof n=="object"&&n!==null){const{canRetry:a,retryAfterSeconds:l}=n;Object.assign(tr,{canRetry:a,retryAfterSeconds:l})}typeof n!="object"&&s.addTelemetryProperties({typeofError:typeof n});const o=c0(n)?n.getTelemetryProperties():{};return s.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},o),e.props),{untrustedOrigin:1})),s}let pp;function Nh(){const n=new Error("<<generated stack>>");if(pp===void 0&&(pp=n.stack!==void 0),pp)return n;try{throw n}catch(e){return e}}function j4(){return Nh().stack}function Lh(n,e){const{message:t,stack:r}=l0(n,!1),i=e(t);return r!==void 0&&sP(i,r),oP(n)&&i.addTelemetryProperties({untrustedOrigin:1}),tP(n)&&(i.overwriteErrorInstanceId(n.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:n.errorInstanceId})),c0(n)&&i.addTelemetryProperties(n.getTelemetryProperties()),i}function iP(n,e,t){const r=Lh(n,e),i=r.errorInstanceId,s=i;return t.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:s},n),r}function sP(n,e){try{Object.assign(n,{stack:e})}catch{n.addTelemetryProperties({stack2:e})}}function oP(n){return!rP(n)||n.getTelemetryProperties().untrustedOrigin===1&&n.errorType===Lc.normalizedErrorType}function q4(n){return typeof(n==null?void 0:n.value)!="object"&&typeof(n==null?void 0:n.tag)=="string"}function B4(n,e){const t={};for(const r of Object.keys(n)){if(e.has(r))continue;const i=n[r];switch(typeof i){case"string":case"number":case"boolean":case"undefined":t[r]=i;break;default:{q4(i)?t[r]=i:t[r]="REDACTED (arbitrary object)";break}}}return t}const U4=()=>{const n=new WeakSet;return(e,t)=>{if(typeof t=="object"&&t!==null){if(n.has(t))return"<removed/circular>";n.add(t)}return t}};class oe extends Error{constructor(e,t,r=new Set){super(e),this.omitPropsFromLogging=r,this._errorInstanceId=Ze(),this.fluidErrorCode="-",r.add("omitPropsFromLogging"),r.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){z4(this,e)}getTelemetryProperties(){const e=B4(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class Lc extends oe{constructor(e){super(e.message),this.errorType=Lc.normalizedErrorType,e.stack!==void 0&&sP(this,e.stack)}}Lc.normalizedErrorType="genericError";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ke;(function(n){n.PackageData="PackageData",n.CodeArtifact="CodeArtifact",n.UserData="UserData"})(ke||(ke={}));class Ue{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(e==null)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,r){const{message:i,errorType:s,stack:o}=l0(t,!0);if(e.stack=o,e.error=i,e.errorType=s,c0(t)){const a=t.getTelemetryProperties();for(const l of Object.keys(a))e[l]===void 0&&(e[l]=a[l])}e.stack===void 0&&r&&(e.stack=j4())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=Object.assign({},e);t!==void 0&&Ue.prepareErrorObject(r,t,!1),typeof r.duration=="number"&&(r.duration=Ue.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const i=Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"performance"});this.sendTelemetryEventCore(i,t)}prepareEvent(e){const t=e.category==="error"||e.error!==void 0,r=Object.assign({},e);if(this.namespace!==void 0&&(r.eventName=`${this.namespace}${Ue.eventNamespaceSeparator}${r.eventName}`),this.properties){const i=[];i.push(this.properties.all),t&&i.push(this.properties.error);for(const s of i)if(s!==void 0)for(const o of Object.keys(s)){if(e[o]!==void 0)continue;const a=s[o],l=typeof a=="function"?a():a;l!==void 0&&(r[o]=l)}}return r}}Ue.eventNamespaceSeparator=":";class H4{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const r of Object.keys(e)){const i=e[r],{value:s,tag:o}=typeof i=="object"?i:{value:i,tag:void 0};switch(o){case void 0:t[r]=s;break;case ke.PackageData:t[r]=s;break;case ke.UserData:t[r]="REDACTED (UserData)";break;default:t[r]="REDACTED (unknown tag)";break}}this.logger.send(t)}}class ue extends Ue{constructor(e,t,r){super(t,r),this.baseLogger=e,o0(e)&&a0(this,new Nc(e.config))}static create(e,t,r){if(e instanceof ue){const i={};for(const o of[e.properties,r])o!==void 0&&(o.all!==void 0&&(i.all=Object.assign(Object.assign({},i.all),o.all)),o.error!==void 0&&(i.error=Object.assign(Object.assign({},i.error),o.error)));const s=e.namespace===void 0?t:t===void 0?e.namespace:`${e.namespace}${Ue.eventNamespaceSeparator}${t}`;return new ue(e.baseLogger,s,i)}return new ue(e||new R4,t,r)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class W4 extends Ue{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){e!=null&&this.loggers.push(e)}send(e){const t=this.prepareEvent(e);this.loggers.forEach(r=>{r.send(t)})}}class le{constructor(e,t,r={end:!0,cancel:"generic"}){this.logger=e,this.markers=r,this.startTime=rc.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),typeof window=="object"&&window!=null&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,r){return new le(e,t,r)}static timedExec(e,t,r,i){const s=le.start(e,t,i);try{const o=r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}static async timedExecAsync(e,t,r,i){const s=le.start(e,t,i);try{const o=await r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}get duration(){return rc.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){this.markers.cancel!==void 0&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,r){if(!this.event)return;const i=Object.assign(Object.assign({},this.event),t);i.eventName=`${i.eventName}_${e}`,e!=="start"&&(i.duration=this.duration),this.logger.sendPerformanceEvent(i,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Tl extends Ue{constructor(e,t,r){super(void 0,r),this.debug=e,this.debugErr=t}static create(e,t){const r=jg.debug(e),i=jg.debug(e);return i.log=console.error.bind(console),i.enabled=!0,new Tl(r,i,t)}static mixinDebugLogger(e,t,r){if(!t)return Tl.create(e,r);const i=new W4(void 0,r);return i.addLogger(Tl.create(e,this.tryGetBaseLoggerProps(t))),i.addLogger(ue.create(t,e)),i}static tryGetBaseLoggerProps(e){if(e instanceof Ue)return e.properties}send(e){const t=this.prepareEvent(e),r=t.category==="error";let i=r?this.debugErr:this.debug;const s=e.eventName.lastIndexOf(Ue.eventNamespaceSeparator),o=e.eventName.substring(s+1);s>0&&(i=i.extend(e.eventName.substring(0,s))),t.eventName=void 0;let a="";a=`tick=${Ue.formatTick(rc.now())}`;const l=t.stack?t.stack:"";t.stack=void 0;let c;try{c=JSON.stringify(t)}catch{t.error=void 0,c=JSON.stringify(t)}c==="{}"&&(c=""),r&&(i.enabled=!0),i(`${o} ${c} ${a} ${l}`)}}class u0 extends P4{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(r){return this.errorHandler(e,r),!0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const aP="connected",lP="disconnected";function V4(n,e,t,...r){try{n.emit(t,...r)}catch(i){e.sendErrorEvent({eventName:"RaiseEventError",event:t},i)}}function d0(n,e,t,r){try{t?e.emit(aP,r):e.emit(lP)}catch(i){n.sendErrorEvent({eventName:"RaiseConnectedEventError"},i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class cP{constructor(e,t,r=e){this.threshold=e,this.logger=t,this.thresholdMultiple=r}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=this.thresholdMultiple*2)}}function G4(n,e,t){if(n)return!0;const r=typeof t=="string"?{eventName:t,category:"error"}:Object.assign({category:"error"},t);return e.send(r),!1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class CC{constructor(e,t,r,i=!1,s=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=r,this.includeAggregateMetrics=i,this.perBucketProperties=s,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var r,i,s;const o=rc.now(),a=e(),l=rc.now()-o;let c=this.measurementsMap.get(t);return c===void 0&&(c={count:0,duration:-1},this.measurementsMap.set(t,c)),c.count++,c.duration=l,this.includeAggregateMetrics&&(c.totalDuration=((r=c.totalDuration)!==null&&r!==void 0?r:0)+l,c.minDuration=Math.min((i=c.minDuration)!==null&&i!==void 0?i:l,l),c.maxDuration=Math.max((s=c.maxDuration)!==null&&s!==void 0?s:0,l)),c.count>=this.sampleThreshold&&this.flushBucket(t),a}flushBucket(e){const t=this.measurementsMap.get(e);if(t!==void 0&&t.count!==0){const r=this.perBucketProperties.get(e),i=Object.assign(Object.assign(Object.assign({},this.eventBase),r),t);this.logger.sendPerformanceEvent(i),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach((t,r)=>this.flushBucket(r))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Gr extends oe{constructor(e,t,r){super(e,r,new Set(["error"])),this.error=t,this.errorType=Yi.genericError}}class h0 extends oe{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=Yi.throttlingError}static wrap(e,t,r){return iP(e,s=>new h0(s,t),r)}}class ye extends oe{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class K4 extends oe{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=Yi.clientSessionExpiredError}}class wr extends oe{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=Yi.dataCorruptionError,this.canRetry=!1}}class _n extends oe{constructor(e){super(e),this.errorType=Yi.dataProcessingError,this.canRetry=!1}static create(e,t,r,i={}){const s=_n.wrapIfUnrecognized(e,t,r);return s.addTelemetryProperties(i),s}static wrapIfUnrecognized(e,t,r){const i=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},r===void 0?void 0:Gs(r)),s=tr(e,{props:i});if(!oP(s))return s;const o=Lh(s,a=>new _n(a));return o.addTelemetryProperties(s.getTelemetryProperties()),o}}const Gs=n=>({messageClientId:n.clientId,messageSequenceNumber:n.sequenceNumber,messageClientSequenceNumber:n.clientSequenceNumber,messageReferenceSequenceNumber:n.referenceSequenceNumber,messageMinimumSequenceNumber:n.minimumSequenceNumber,messageTimestamp:n.timestamp});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class f0{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return(e=this._policies)!==null&&e!==void 0?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.internalStorageService.getSnapshotTree(e,t)}async getVersions(e,t,r){return this.internalStorageService.getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.internalStorageService.downloadSummary(e)}async createBlob(e){return this.internalStorageService.createBlob(e)}async readBlob(e){return this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class J4 extends f0{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}async readBlob(e){const t=this.blobs.get(e);return t!==void 0?t:this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fs;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Fs||(Fs={}));var _C;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(_C||(_C={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Md;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Md||(Md={}));var xl;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(xl||(xl={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ns;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Ns||(Ns={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function xe(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Q4(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const X4=(n,e)=>p0.from(n,e).buffer,Y4=(n,e)=>p0.from(n).toString(e);function EC(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let p0=class ms extends Uint8Array{toString(e){return Q4(this,e)}static from(e,t,r){if(typeof e=="string")return ms.fromString(e,t);if(e!==null&&typeof e=="object"&&EC(e.buffer))return xe(e.byteOffset===0,0),xe(e.byteLength===e.buffer.byteLength,1),ms.fromArrayBuffer(e.buffer,t,r);if(EC(e))return ms.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new ms(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new ms(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new ms(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Oi=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let uP=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Z4=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Pi;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Pi||(Pi={}));var TC;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(TC||(TC={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ks;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Ks||(Ks={}));var ic;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(ic||(ic={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var gr;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(gr||(gr={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qg(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let m0=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dP(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function eH(n){const e=n.type===gr.Handle?n.handleType:n.type;switch(e){case gr.Blob:case gr.Attachment:return Ks.File;case gr.Tree:return Ks.Directory;default:dP(e,`Unknown type: ${e}`)}}function hP(n){const e=n.type===gr.Handle?n.handleType:n.type;switch(e){case gr.Blob:case gr.Attachment:return"blob";case gr.Tree:return"tree";default:dP(e,`Unknown type: ${e}`)}}function g0(n,e=new Map,t=!1){const r={},i={id:n.sha,blobs:{},trees:{}};r[""]=i;for(const s of n.tree){const o=t?s.path.replace(/^\.app\//,""):s.path,a=o.lastIndexOf("/"),l=o.slice(0,Math.max(0,a)),c=o.slice(a+1),u=r[l];if(s.type==="tree"){const d={id:s.sha,blobs:{},commits:{},trees:{}};u.trees[decodeURIComponent(c)]=d,r[o]=d}else if(s.type==="blob")u.blobs[decodeURIComponent(c)]=s.sha,e.set(s.sha,`/${o}`);else throw new Error("Unknown entry type!!")}return i}class fP{constructor(e,t,r="utf-8"){this.path=e,this.mode=Ks.File,this.type=ic.Blob,this.value={contents:t,encoding:r}}}class tH{constructor(e,t){this.path=e,this.value=t,this.mode=Ks.Directory,this.type=ic.Tree}}class nH{constructor(e,t){this.path=e,this.id=t,this.mode=Ks.File,this.type=ic.Attachment,this.value={id:t}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class xC{constructor(e,t,r,i){this.sequenceNumber=e,this.key=t,this.value=r,this.local=i}}class rH extends m0{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return(e=this.snapshotCache)!==null&&e!==void 0||(this.snapshotCache=ua(Array.from(this.members))),this.snapshotCache}addMember(e,t){qg(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){qg(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class iH extends m0{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new ln.EventEmitter,this.proposals=new Map(e.proposals.map(([,r])=>[r.sequenceNumber,new xC(r.sequenceNumber,r.key,r.value,!1)])),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return(e=this.proposalsSnapshotCache)!==null&&e!==void 0||(this.proposalsSnapshotCache=Array.from(this.proposals).map(([r,i])=>[r,{sequenceNumber:r,key:i.key,value:i.value},[]])),(t=this.valuesSnapshotCache)!==null&&t!==void 0||(this.valuesSnapshotCache=ua(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return(t=this.values.get(e))===null||t===void 0?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?ua(t):void 0}async propose(e,t){const r=this.sendProposal(e,t);if(r<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise((i,s)=>{let o;const a=(h,f)=>{h===r&&(o=f,this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("disconnected",c),this.stateEvents.on("localProposalApproved",l))},l=h=>{h===o&&(i(),d())},c=()=>{o===void 0&&this.stateEvents.once("connected",()=>{o===void 0&&(s(new Error("Client disconnected without successfully sending proposal")),d())})},u=()=>{s(new Error("QuorumProposals was disposed")),d()},d=()=>{this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("localProposalApproved",l),this.stateEvents.off("disconnected",c),this.stateEvents.off("disposed",u)};this.stateEvents.on("localProposalSequenced",a),this.stateEvents.on("disconnected",c),this.stateEvents.on("disposed",u)})}addProposal(e,t,r,i,s){qg(!this.proposals.has(r),464);const o=new xC(r,e,t,i);this.proposals.set(r,o),this.emit("addProposal",o),i&&this.stateEvents.emit("localProposalSequenced",s,r),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,r=[];for(const[i,s]of this.proposals)i<=t&&r.push(s);r.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);for(const i of r){const s={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:i.key,sequenceNumber:i.sequenceNumber,value:i.value};this.values.set(s.key,s),this.valuesSnapshotCache=void 0,this.emit("approveProposal",s.sequenceNumber,s.key,s.value,s.approvalSequenceNumber),this.proposals.delete(i.sequenceNumber),this.proposalsSnapshotCache=void 0,i.local&&this.stateEvents.emit("localProposalApproved",i.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class sH extends m0{constructor(e,t,r,i){super(),this.isDisposed=!1,this.quorumClients=new rH(e),this.quorumClients.on("addMember",(s,o)=>{this.emit("addMember",s,o)}),this.quorumClients.on("removeMember",s=>{this.emit("removeMember",s)}),this.quorumProposals=new iH({proposals:t,values:r},i),this.quorumProposals.on("addProposal",s=>{this.emit("addProposal",s)}),this.quorumProposals.on("approveProposal",(s,o,a,l)=>{this.emit("approveProposal",s,o,a,l)})}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:r}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:r}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}async propose(e,t){return this.quorumProposals.propose(e,t)}addProposal(e,t,r,i,s){return this.quorumProposals.addProposal(e,t,r,i,s)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class oH{constructor(e,t,r,i,s,o,a){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=r??1,this._quorum=new sH(i,s,o,a)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let r=!1;switch(e.type){case Pi.ClientJoin:const i=e,s=JSON.parse(i.data),o={client:s.detail,sequenceNumber:i.sequenceNumber};this._quorum.addMember(s.clientId,o);break;case Pi.ClientLeave:const l=JSON.parse(e.data);this._quorum.removeMember(l);break;case Pi.Propose:const c=e.contents;this._quorum.addProposal(c.key,c.value,e.sequenceNumber,t,e.clientSequenceNumber),r=!0;break;case Pi.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:r}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}class aH extends oH{processMessage(e,t){const r=this._quorum.getMember(e.clientId);if(e.clientId!=null){if(r===void 0&&e.type!==Pi.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if((r==null?void 0:r.shouldHaveLeft)===!0&&e.type!==Pi.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function pP(n,e,t){const r=[];for(const i of e){const s=`${n}${i.path}`;if(i.type===xl.Blob){const o=i.value,a=X4(o.contents,o.encoding),l=Ze();t.set(l,a);const c={mode:Md[i.mode],path:s,sha:l,size:0,type:"blob",url:""};r.push(c)}else if(i.type===xl.Tree){xe(i.type===xl.Tree,257);const o=i.value,a={mode:Md[i.mode],path:s,sha:"",size:-1,type:"tree",url:""};r.push(a);const l=pP(`${s}/`,o.entries,t);r.push(...l)}}return r}function lH(n,e){return{sha:"",tree:pP("",n,e),url:""}}function mP(n,e){const t=lH(n,e);return g0(t)}var Dd={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Dd.exports;(function(n,e){(function(t){var r=e&&!e.nodeType&&e,i=n&&!n.nodeType&&n,s=typeof globalThis=="object"&&globalThis;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,c=1,u=26,d=38,h=700,f=72,p=128,g="-",S=/^xn--/,m=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=l-c,w=Math.floor,x=String.fromCharCode,E;function P(k){throw new RangeError(y[k])}function M(k,$){for(var T=k.length,I=[];T--;)I[T]=$(k[T]);return I}function F(k,$){var T=k.split("@"),I="";T.length>1&&(I=T[0]+"@",k=T[1]),k=k.replace(v,".");var C=k.split("."),R=M(C,$).join(".");return I+R}function G(k){for(var $=[],T=0,I=k.length,C,R;T<I;)C=k.charCodeAt(T++),C>=55296&&C<=56319&&T<I?(R=k.charCodeAt(T++),(R&64512)==56320?$.push(((C&1023)<<10)+(R&1023)+65536):($.push(C),T--)):$.push(C);return $}function z(k){return M(k,function($){var T="";return $>65535&&($-=65536,T+=x($>>>10&1023|55296),$=56320|$&1023),T+=x($),T}).join("")}function X(k){return k-48<10?k-22:k-65<26?k-65:k-97<26?k-97:l}function V(k,$){return k+22+75*(k<26)-(($!=0)<<5)}function _(k,$,T){var I=0;for(k=T?w(k/h):k>>1,k+=w(k/$);k>b*u>>1;I+=l)k=w(k/b);return w(I+(b+1)*k/(k+d))}function N(k){var $=[],T=k.length,I,C=0,R=p,L=f,U,ne,ie,be,Ce,vt,ut,Xt,dt;for(U=k.lastIndexOf(g),U<0&&(U=0),ne=0;ne<U;++ne)k.charCodeAt(ne)>=128&&P("not-basic"),$.push(k.charCodeAt(ne));for(ie=U>0?U+1:0;ie<T;){for(be=C,Ce=1,vt=l;ie>=T&&P("invalid-input"),ut=X(k.charCodeAt(ie++)),(ut>=l||ut>w((a-C)/Ce))&&P("overflow"),C+=ut*Ce,Xt=vt<=L?c:vt>=L+u?u:vt-L,!(ut<Xt);vt+=l)dt=l-Xt,Ce>w(a/dt)&&P("overflow"),Ce*=dt;I=$.length+1,L=_(C-be,I,be==0),w(C/I)>a-R&&P("overflow"),R+=w(C/I),C%=I,$.splice(C++,0,R)}return z($)}function W(k){var $,T,I,C,R,L,U,ne,ie,be,Ce,vt=[],ut,Xt,dt,On;for(k=G(k),ut=k.length,$=p,T=0,R=f,L=0;L<ut;++L)Ce=k[L],Ce<128&&vt.push(x(Ce));for(I=C=vt.length,C&&vt.push(g);I<ut;){for(U=a,L=0;L<ut;++L)Ce=k[L],Ce>=$&&Ce<U&&(U=Ce);for(Xt=I+1,U-$>w((a-T)/Xt)&&P("overflow"),T+=(U-$)*Xt,$=U,L=0;L<ut;++L)if(Ce=k[L],Ce<$&&++T>a&&P("overflow"),Ce==$){for(ne=T,ie=l;be=ie<=R?c:ie>=R+u?u:ie-R,!(ne<be);ie+=l)On=ne-be,dt=l-be,vt.push(x(V(be+On%dt,0))),ne=w(On/dt);vt.push(x(V(ne,0))),R=_(T,Xt,I==C),T=0,++I}++T,++$}return vt.join("")}function A(k){return F(k,function($){return S.test($)?N($.slice(4).toLowerCase()):$})}function B(k){return F(k,function($){return m.test($)?"xn--"+W($):$})}if(o={version:"1.4.1",ucs2:{decode:G,encode:z},decode:N,encode:W,toASCII:B,toUnicode:A},r&&i)if(n.exports==r)i.exports=o;else for(E in o)o.hasOwnProperty(E)&&(r[E]=o[E]);else t.punycode=o})(K)})(Dd,Dd.exports);var cH=Dd.exports,Na=TypeError;const uH={},dH=Object.freeze(Object.defineProperty({__proto__:null,default:uH},Symbol.toStringTag,{value:"Module"})),hH=Sc(dH);var v0=typeof Map=="function"&&Map.prototype,mp=Object.getOwnPropertyDescriptor&&v0?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Fd=v0&&mp&&typeof mp.get=="function"?mp.get:null,OC=v0&&Map.prototype.forEach,y0=typeof Set=="function"&&Set.prototype,gp=Object.getOwnPropertyDescriptor&&y0?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,zd=y0&&gp&&typeof gp.get=="function"?gp.get:null,PC=y0&&Set.prototype.forEach,fH=typeof WeakMap=="function"&&WeakMap.prototype,Ol=fH?WeakMap.prototype.has:null,pH=typeof WeakSet=="function"&&WeakSet.prototype,Pl=pH?WeakSet.prototype.has:null,mH=typeof WeakRef=="function"&&WeakRef.prototype,RC=mH?WeakRef.prototype.deref:null,gH=Boolean.prototype.valueOf,vH=Object.prototype.toString,yH=Function.prototype.toString,SH=String.prototype.match,S0=String.prototype.slice,Ri=String.prototype.replace,bH=String.prototype.toUpperCase,kC=String.prototype.toLowerCase,gP=RegExp.prototype.test,NC=Array.prototype.concat,hr=Array.prototype.join,wH=Array.prototype.slice,LC=Math.floor,Bg=typeof BigInt=="function"?BigInt.prototype.valueOf:null,vp=Object.getOwnPropertySymbols,Ug=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,da=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Rl=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===da||"symbol")?Symbol.toStringTag:null,vP=Object.prototype.propertyIsEnumerable,IC=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function AC(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||gP.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var r=n<0?-LC(-n):LC(n);if(r!==n){var i=String(r),s=S0.call(e,i.length+1);return Ri.call(i,t,"$&_")+"."+Ri.call(Ri.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ri.call(e,t,"$&_")}var Hg=hH,MC=Hg.custom,DC=bP(MC)?MC:null,yP={__proto__:null,double:'"',single:"'"},CH={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Ih=function n(e,t,r,i){var s=t||{};if(jr(s,"quoteStyle")&&!jr(yP,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(jr(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=jr(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(jr(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(jr(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return CP(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return a?AC(e,l):l}if(typeof e=="bigint"){var c=String(e)+"n";return a?AC(e,c):c}var u=typeof s.depth>"u"?5:s.depth;if(typeof r>"u"&&(r=0),r>=u&&u>0&&typeof e=="object")return Wg(e)?"[Array]":"[Object]";var d=jH(s,r);if(typeof i>"u")i=[];else if(wP(i,e)>=0)return"[Circular]";function h(X,V,_){if(V&&(i=wH.call(i),i.push(V)),_){var N={depth:s.depth};return jr(s,"quoteStyle")&&(N.quoteStyle=s.quoteStyle),n(X,N,r+1,i)}return n(X,s,r+1,i)}if(typeof e=="function"&&!FC(e)){var f=NH(e),p=Su(e,h);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+hr.call(p,", ")+" }":"")}if(bP(e)){var g=da?Ri.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ug.call(e);return typeof e=="object"&&!da?Za(g):g}if(FH(e)){for(var S="<"+kC.call(String(e.nodeName)),m=e.attributes||[],v=0;v<m.length;v++)S+=" "+m[v].name+"="+SP(_H(m[v].value),"double",s);return S+=">",e.childNodes&&e.childNodes.length&&(S+="..."),S+="</"+kC.call(String(e.nodeName))+">",S}if(Wg(e)){if(e.length===0)return"[]";var y=Su(e,h);return d&&!$H(y)?"["+Vg(y,d)+"]":"[ "+hr.call(y,", ")+" ]"}if(TH(e)){var b=Su(e,h);return!("cause"in Error.prototype)&&"cause"in e&&!vP.call(e,"cause")?"{ ["+String(e)+"] "+hr.call(NC.call("[cause]: "+h(e.cause),b),", ")+" }":b.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+hr.call(b,", ")+" }"}if(typeof e=="object"&&o){if(DC&&typeof e[DC]=="function"&&Hg)return Hg(e,{depth:u-r});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(LH(e)){var w=[];return OC&&OC.call(e,function(X,V){w.push(h(V,e,!0)+" => "+h(X,e))}),zC("Map",Fd.call(e),w,d)}if(MH(e)){var x=[];return PC&&PC.call(e,function(X){x.push(h(X,e))}),zC("Set",zd.call(e),x,d)}if(IH(e))return yp("WeakMap");if(DH(e))return yp("WeakSet");if(AH(e))return yp("WeakRef");if(OH(e))return Za(h(Number(e)));if(RH(e))return Za(h(Bg.call(e)));if(PH(e))return Za(gH.call(e));if(xH(e))return Za(h(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof globalThis<"u"&&e===globalThis)return"{ [object globalThis] }";if(!EH(e)&&!FC(e)){var E=Su(e,h),P=IC?IC(e)===Object.prototype:e instanceof Object||e.constructor===Object,M=e instanceof Object?"":"null prototype",F=!P&&Rl&&Object(e)===e&&Rl in e?S0.call(ss(e),8,-1):M?"Object":"",G=P||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",z=G+(F||M?"["+hr.call(NC.call([],F||[],M||[]),": ")+"] ":"");return E.length===0?z+"{}":d?z+"{"+Vg(E,d)+"}":z+"{ "+hr.call(E,", ")+" }"}return String(e)};function SP(n,e,t){var r=t.quoteStyle||e,i=yP[r];return i+n+i}function _H(n){return Ri.call(String(n),/"/g,"&quot;")}function so(n){return!Rl||!(typeof n=="object"&&(Rl in n||typeof n[Rl]<"u"))}function Wg(n){return ss(n)==="[object Array]"&&so(n)}function EH(n){return ss(n)==="[object Date]"&&so(n)}function FC(n){return ss(n)==="[object RegExp]"&&so(n)}function TH(n){return ss(n)==="[object Error]"&&so(n)}function xH(n){return ss(n)==="[object String]"&&so(n)}function OH(n){return ss(n)==="[object Number]"&&so(n)}function PH(n){return ss(n)==="[object Boolean]"&&so(n)}function bP(n){if(da)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!Ug)return!1;try{return Ug.call(n),!0}catch{}return!1}function RH(n){if(!n||typeof n!="object"||!Bg)return!1;try{return Bg.call(n),!0}catch{}return!1}var kH=Object.prototype.hasOwnProperty||function(n){return n in this};function jr(n,e){return kH.call(n,e)}function ss(n){return vH.call(n)}function NH(n){if(n.name)return n.name;var e=SH.call(yH.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function wP(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,r=n.length;t<r;t++)if(n[t]===e)return t;return-1}function LH(n){if(!Fd||!n||typeof n!="object")return!1;try{Fd.call(n);try{zd.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function IH(n){if(!Ol||!n||typeof n!="object")return!1;try{Ol.call(n,Ol);try{Pl.call(n,Pl)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function AH(n){if(!RC||!n||typeof n!="object")return!1;try{return RC.call(n),!0}catch{}return!1}function MH(n){if(!zd||!n||typeof n!="object")return!1;try{zd.call(n);try{Fd.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function DH(n){if(!Pl||!n||typeof n!="object")return!1;try{Pl.call(n,Pl);try{Ol.call(n,Ol)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function FH(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function CP(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,r="... "+t+" more character"+(t>1?"s":"");return CP(S0.call(n,0,e.maxStringLength),e)+r}var i=CH[e.quoteStyle||"single"];i.lastIndex=0;var s=Ri.call(Ri.call(n,i,"\\$1"),/[\x00-\x1f]/g,zH);return SP(s,"single",e)}function zH(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+bH.call(e.toString(16))}function Za(n){return"Object("+n+")"}function yp(n){return n+" { ? }"}function zC(n,e,t,r){var i=r?Vg(t,r):hr.call(t,", ");return n+" ("+e+") {"+i+"}"}function $H(n){for(var e=0;e<n.length;e++)if(wP(n[e],`
`)>=0)return!1;return!0}function jH(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=hr.call(Array(n.indent+1)," ");else return null;return{base:t,prev:hr.call(Array(e+1),t)}}function Vg(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+hr.call(n,","+t)+`
`+e.prev}function Su(n,e){var t=Wg(n),r=[];if(t){r.length=n.length;for(var i=0;i<n.length;i++)r[i]=jr(n,i)?e(n[i],n):""}var s=typeof vp=="function"?vp(n):[],o;if(da){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in n)jr(n,l)&&(t&&String(Number(l))===l&&l<n.length||da&&o["$"+l]instanceof Symbol||(gP.call(/[^\w$]/,l)?r.push(e(l,n)+": "+e(n[l],n)):r.push(l+": "+e(n[l],n))));if(typeof vp=="function")for(var c=0;c<s.length;c++)vP.call(n,s[c])&&r.push("["+e(s[c])+"]: "+e(n[s[c]],n));return r}var qH=Ih,BH=Na,Ah=function(n,e,t){for(var r=n,i;(i=r.next)!=null;r=i)if(i.key===e)return r.next=i.next,t||(i.next=n.next,n.next=i),i},UH=function(n,e){if(n){var t=Ah(n,e);return t&&t.value}},HH=function(n,e,t){var r=Ah(n,e);r?r.value=t:n.next={key:e,next:n.next,value:t}},WH=function(n,e){return n?!!Ah(n,e):!1},VH=function(n,e){if(n)return Ah(n,e,!0)},GH=function(){var e,t={assert:function(r){if(!t.has(r))throw new BH("Side channel does not contain "+qH(r))},delete:function(r){var i=e&&e.next,s=VH(e,r);return s&&i&&i===s&&(e=void 0),!!s},get:function(r){return UH(e,r)},has:function(r){return WH(e,r)},set:function(r,i){e||(e={next:void 0}),HH(e,r,i)}};return t},_P=Object,KH=Error,JH=EvalError,QH=RangeError,XH=ReferenceError,YH=SyntaxError,ZH=URIError,e6=Math.abs,t6=Math.floor,n6=Math.max,r6=Math.min,i6=Math.pow,s6=Math.round,o6=Number.isNaN||function(e){return e!==e},a6=o6,l6=function(e){return a6(e)||e===0?e:e<0?-1:1},c6=Object.getOwnPropertyDescriptor,Vu=c6;if(Vu)try{Vu([],"length")}catch{Vu=null}var EP=Vu,Gu=Object.defineProperty||!1;if(Gu)try{Gu({},"a",{value:1})}catch{Gu=!1}var u6=Gu,Sp,$C;function d6(){return $C||($C=1,Sp=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Sp}var bp,jC;function h6(){if(jC)return bp;jC=1;var n=typeof Symbol<"u"&&Symbol,e=d6();return bp=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},bp}var wp,qC;function TP(){return qC||(qC=1,wp=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),wp}var Cp,BC;function xP(){if(BC)return Cp;BC=1;var n=_P;return Cp=n.getPrototypeOf||null,Cp}var f6="Function.prototype.bind called on incompatible ",p6=Object.prototype.toString,m6=Math.max,g6="[object Function]",UC=function(e,t){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var s=0;s<t.length;s+=1)r[s+e.length]=t[s];return r},v6=function(e,t){for(var r=[],i=t||0,s=0;i<e.length;i+=1,s+=1)r[s]=e[i];return r},y6=function(n,e){for(var t="",r=0;r<n.length;r+=1)t+=n[r],r+1<n.length&&(t+=e);return t},S6=function(e){var t=this;if(typeof t!="function"||p6.apply(t)!==g6)throw new TypeError(f6+t);for(var r=v6(arguments,1),i,s=function(){if(this instanceof i){var u=t.apply(this,UC(r,arguments));return Object(u)===u?u:this}return t.apply(e,UC(r,arguments))},o=m6(0,t.length-r.length),a=[],l=0;l<o;l++)a[l]="$"+l;if(i=Function("binder","return function ("+y6(a,",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var c=function(){};c.prototype=t.prototype,i.prototype=new c,c.prototype=null}return i},b6=S6,Mh=Function.prototype.bind||b6,b0=Function.prototype.call,_p,HC;function OP(){return HC||(HC=1,_p=Function.prototype.apply),_p}var w6=typeof Reflect<"u"&&Reflect&&Reflect.apply,C6=Mh,_6=OP(),E6=b0,T6=w6,x6=T6||C6.call(E6,_6),O6=Mh,P6=Na,R6=b0,k6=x6,PP=function(e){if(e.length<1||typeof e[0]!="function")throw new P6("a function is required");return k6(O6,R6,e)},Ep,WC;function N6(){if(WC)return Ep;WC=1;var n=PP,e=EP,t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return Ep=r&&typeof r.get=="function"?n([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,Ep}var Tp,VC;function L6(){if(VC)return Tp;VC=1;var n=TP(),e=xP(),t=N6();return Tp=n?function(i){return n(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,Tp}var xp,GC;function I6(){if(GC)return xp;GC=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Mh;return xp=t.call(n,e),xp}var de,A6=_P,M6=KH,D6=JH,F6=QH,z6=XH,ha=YH,Ko=Na,$6=ZH,j6=e6,q6=t6,B6=n6,U6=r6,H6=i6,W6=s6,V6=l6,RP=Function,Op=function(n){try{return RP('"use strict"; return ('+n+").constructor;")()}catch{}},sc=EP,G6=u6,Pp=function(){throw new Ko},K6=sc?function(){try{return arguments.callee,Pp}catch{try{return sc(arguments,"callee").get}catch{return Pp}}}():Pp,go=h6()(),ft=L6(),J6=xP(),Q6=TP(),kP=OP(),Ic=b0,_o={},X6=typeof Uint8Array>"u"||!ft?de:ft(Uint8Array),zs={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?de:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?de:ArrayBuffer,"%ArrayIteratorPrototype%":go&&ft?ft([][Symbol.iterator]()):de,"%AsyncFromSyncIteratorPrototype%":de,"%AsyncFunction%":_o,"%AsyncGenerator%":_o,"%AsyncGeneratorFunction%":_o,"%AsyncIteratorPrototype%":_o,"%Atomics%":typeof Atomics>"u"?de:Atomics,"%BigInt%":typeof BigInt>"u"?de:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?de:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?de:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?de:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":M6,"%eval%":eval,"%EvalError%":D6,"%Float16Array%":typeof Float16Array>"u"?de:Float16Array,"%Float32Array%":typeof Float32Array>"u"?de:Float32Array,"%Float64Array%":typeof Float64Array>"u"?de:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?de:FinalizationRegistry,"%Function%":RP,"%GeneratorFunction%":_o,"%Int8Array%":typeof Int8Array>"u"?de:Int8Array,"%Int16Array%":typeof Int16Array>"u"?de:Int16Array,"%Int32Array%":typeof Int32Array>"u"?de:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":go&&ft?ft(ft([][Symbol.iterator]())):de,"%JSON%":typeof JSON=="object"?JSON:de,"%Map%":typeof Map>"u"?de:Map,"%MapIteratorPrototype%":typeof Map>"u"||!go||!ft?de:ft(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":A6,"%Object.getOwnPropertyDescriptor%":sc,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?de:Promise,"%Proxy%":typeof Proxy>"u"?de:Proxy,"%RangeError%":F6,"%ReferenceError%":z6,"%Reflect%":typeof Reflect>"u"?de:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?de:Set,"%SetIteratorPrototype%":typeof Set>"u"||!go||!ft?de:ft(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?de:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":go&&ft?ft(""[Symbol.iterator]()):de,"%Symbol%":go?Symbol:de,"%SyntaxError%":ha,"%ThrowTypeError%":K6,"%TypedArray%":X6,"%TypeError%":Ko,"%Uint8Array%":typeof Uint8Array>"u"?de:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?de:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?de:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?de:Uint32Array,"%URIError%":$6,"%WeakMap%":typeof WeakMap>"u"?de:WeakMap,"%WeakRef%":typeof WeakRef>"u"?de:WeakRef,"%WeakSet%":typeof WeakSet>"u"?de:WeakSet,"%Function.prototype.call%":Ic,"%Function.prototype.apply%":kP,"%Object.defineProperty%":G6,"%Object.getPrototypeOf%":J6,"%Math.abs%":j6,"%Math.floor%":q6,"%Math.max%":B6,"%Math.min%":U6,"%Math.pow%":H6,"%Math.round%":W6,"%Math.sign%":V6,"%Reflect.getPrototypeOf%":Q6};if(ft)try{null.error}catch(n){var Y6=ft(ft(n));zs["%Error.prototype%"]=Y6}var Z6=function n(e){var t;if(e==="%AsyncFunction%")t=Op("async function () {}");else if(e==="%GeneratorFunction%")t=Op("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Op("async function* () {}");else if(e==="%AsyncGenerator%"){var r=n("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=n("%AsyncGenerator%");i&&ft&&(t=ft(i.prototype))}return zs[e]=t,t},KC={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ac=Mh,$d=I6(),e8=Ac.call(Ic,Array.prototype.concat),t8=Ac.call(kP,Array.prototype.splice),JC=Ac.call(Ic,String.prototype.replace),jd=Ac.call(Ic,String.prototype.slice),n8=Ac.call(Ic,RegExp.prototype.exec),r8=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,i8=/\\(\\)?/g,s8=function(e){var t=jd(e,0,1),r=jd(e,-1);if(t==="%"&&r!=="%")throw new ha("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new ha("invalid intrinsic syntax, expected opening `%`");var i=[];return JC(e,r8,function(s,o,a,l){i[i.length]=a?JC(l,i8,"$1"):o||s}),i},o8=function(e,t){var r=e,i;if($d(KC,r)&&(i=KC[r],r="%"+i[0]+"%"),$d(zs,r)){var s=zs[r];if(s===_o&&(s=Z6(r)),typeof s>"u"&&!t)throw new Ko("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:s}}throw new ha("intrinsic "+e+" does not exist!")},w0=function(e,t){if(typeof e!="string"||e.length===0)throw new Ko("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Ko('"allowMissing" argument must be a boolean');if(n8(/^%?[^%]*%?$/,e)===null)throw new ha("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=s8(e),i=r.length>0?r[0]:"",s=o8("%"+i+"%",t),o=s.name,a=s.value,l=!1,c=s.alias;c&&(i=c[0],t8(r,e8([0,1],c)));for(var u=1,d=!0;u<r.length;u+=1){var h=r[u],f=jd(h,0,1),p=jd(h,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new ha("property names with quotes must have matching quotes");if((h==="constructor"||!d)&&(l=!0),i+="."+h,o="%"+i+"%",$d(zs,o))a=zs[o];else if(a!=null){if(!(h in a)){if(!t)throw new Ko("base intrinsic for "+e+" exists, but the property is not available.");return}if(sc&&u+1>=r.length){var g=sc(a,h);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[h]}else d=$d(a,h),a=a[h];d&&!l&&(zs[o]=a)}}return a},NP=w0,LP=PP,a8=LP([NP("%String.prototype.indexOf%")]),IP=function(e,t){var r=NP(e,!!t);return typeof r=="function"&&a8(e,".prototype.")>-1?LP([r]):r},l8=w0,Mc=IP,c8=Ih,u8=Na,QC=l8("%Map%",!0),d8=Mc("Map.prototype.get",!0),h8=Mc("Map.prototype.set",!0),f8=Mc("Map.prototype.has",!0),p8=Mc("Map.prototype.delete",!0),m8=Mc("Map.prototype.size",!0),AP=!!QC&&function(){var e,t={assert:function(r){if(!t.has(r))throw new u8("Side channel does not contain "+c8(r))},delete:function(r){if(e){var i=p8(e,r);return m8(e)===0&&(e=void 0),i}return!1},get:function(r){if(e)return d8(e,r)},has:function(r){return e?f8(e,r):!1},set:function(r,i){e||(e=new QC),h8(e,r,i)}};return t},g8=w0,Dh=IP,v8=Ih,bu=AP,y8=Na,vo=g8("%WeakMap%",!0),S8=Dh("WeakMap.prototype.get",!0),b8=Dh("WeakMap.prototype.set",!0),w8=Dh("WeakMap.prototype.has",!0),C8=Dh("WeakMap.prototype.delete",!0),_8=vo?function(){var e,t,r={assert:function(i){if(!r.has(i))throw new y8("Side channel does not contain "+v8(i))},delete:function(i){if(vo&&i&&(typeof i=="object"||typeof i=="function")){if(e)return C8(e,i)}else if(bu&&t)return t.delete(i);return!1},get:function(i){return vo&&i&&(typeof i=="object"||typeof i=="function")&&e?S8(e,i):t&&t.get(i)},has:function(i){return vo&&i&&(typeof i=="object"||typeof i=="function")&&e?w8(e,i):!!t&&t.has(i)},set:function(i,s){vo&&i&&(typeof i=="object"||typeof i=="function")?(e||(e=new vo),b8(e,i,s)):bu&&(t||(t=bu()),t.set(i,s))}};return r}:bu,E8=Na,T8=Ih,x8=GH,O8=AP,P8=_8,R8=P8||O8||x8,k8=function(){var e,t={assert:function(r){if(!t.has(r))throw new E8("Side channel does not contain "+T8(r))},delete:function(r){return!!e&&e.delete(r)},get:function(r){return e&&e.get(r)},has:function(r){return!!e&&e.has(r)},set:function(r,i){e||(e=R8()),e.set(r,i)}};return t},N8=String.prototype.replace,L8=/%20/g,Rp={RFC1738:"RFC1738",RFC3986:"RFC3986"},C0={default:Rp.RFC3986,formatters:{RFC1738:function(n){return N8.call(n,L8,"+")},RFC3986:function(n){return String(n)}},RFC1738:Rp.RFC1738,RFC3986:Rp.RFC3986},I8=C0,kp=Object.prototype.hasOwnProperty,_s=Array.isArray,or=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),A8=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(_s(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);t.obj[t.prop]=i}}},MP=function(e,t){for(var r=t&&t.plainObjects?{__proto__:null}:{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},M8=function n(e,t,r){if(!t)return e;if(typeof t!="object"&&typeof t!="function"){if(_s(e))e.push(t);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!kp.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return _s(e)&&!_s(t)&&(i=MP(e,r)),_s(e)&&_s(t)?(t.forEach(function(s,o){if(kp.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=n(a,s,r):e.push(s)}else e[o]=s}),e):Object.keys(t).reduce(function(s,o){var a=t[o];return kp.call(s,o)?s[o]=n(s[o],a,r):s[o]=a,s},i)},D8=function(e,t){return Object.keys(t).reduce(function(r,i){return r[i]=t[i],r},e)},F8=function(n,e,t){var r=n.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Np=1024,z8=function(e,t,r,i,s){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});for(var a="",l=0;l<o.length;l+=Np){for(var c=o.length>=Np?o.slice(l,l+Np):o,u=[],d=0;d<c.length;++d){var h=c.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===I8.RFC1738&&(h===40||h===41)){u[u.length]=c.charAt(d);continue}if(h<128){u[u.length]=or[h];continue}if(h<2048){u[u.length]=or[192|h>>6]+or[128|h&63];continue}if(h<55296||h>=57344){u[u.length]=or[224|h>>12]+or[128|h>>6&63]+or[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|c.charCodeAt(d)&1023),u[u.length]=or[240|h>>18]+or[128|h>>12&63]+or[128|h>>6&63]+or[128|h&63]}a+=u.join("")}return a},$8=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],o=s.obj[s.prop],a=Object.keys(o),l=0;l<a.length;++l){var c=a[l],u=o[c];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(t.push({obj:o,prop:c}),r.push(u))}return A8(t),e},j8=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},q8=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},B8=function(e,t){return[].concat(e,t)},U8=function(e,t){if(_s(e)){for(var r=[],i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)},DP={arrayToObject:MP,assign:D8,combine:B8,compact:$8,decode:F8,encode:z8,isBuffer:q8,isRegExp:j8,maybeMap:U8,merge:M8},FP=k8,Ku=DP,kl=C0,H8=Object.prototype.hasOwnProperty,zP={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},dr=Array.isArray,W8=Array.prototype.push,$P=function(n,e){W8.apply(n,dr(e)?e:[e])},V8=Date.prototype.toISOString,XC=kl.default,it={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ku.encode,encodeValuesOnly:!1,filter:void 0,format:XC,formatter:kl.formatters[XC],indices:!1,serializeDate:function(e){return V8.call(e)},skipNulls:!1,strictNullHandling:!1},G8=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Lp={},K8=function n(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g,S,m,v){for(var y=e,b=v,w=0,x=!1;(b=b.get(Lp))!==void 0&&!x;){var E=b.get(e);if(w+=1,typeof E<"u"){if(E===w)throw new RangeError("Cyclic object value");x=!0}typeof b.get(Lp)>"u"&&(w=0)}if(typeof u=="function"?y=u(t,y):y instanceof Date?y=f(y):r==="comma"&&dr(y)&&(y=Ku.maybeMap(y,function(k){return k instanceof Date?f(k):k})),y===null){if(o)return c&&!S?c(t,it.encoder,m,"key",p):t;y=""}if(G8(y)||Ku.isBuffer(y)){if(c){var P=S?t:c(t,it.encoder,m,"key",p);return[g(P)+"="+g(c(y,it.encoder,m,"value",p))]}return[g(t)+"="+g(String(y))]}var M=[];if(typeof y>"u")return M;var F;if(r==="comma"&&dr(y))S&&c&&(y=Ku.maybeMap(y,c)),F=[{value:y.length>0?y.join(",")||null:void 0}];else if(dr(u))F=u;else{var G=Object.keys(y);F=d?G.sort(d):G}var z=l?String(t).replace(/\./g,"%2E"):String(t),X=i&&dr(y)&&y.length===1?z+"[]":z;if(s&&dr(y)&&y.length===0)return X+"[]";for(var V=0;V<F.length;++V){var _=F[V],N=typeof _=="object"&&_&&typeof _.value<"u"?_.value:y[_];if(!(a&&N===null)){var W=h&&l?String(_).replace(/\./g,"%2E"):String(_),A=dr(y)?typeof r=="function"?r(X,W):X:X+(h?"."+W:"["+W+"]");v.set(e,w);var B=FP();B.set(Lp,v),$P(M,n(N,A,r,i,s,o,a,l,r==="comma"&&S&&dr(y)?null:c,u,d,h,f,p,g,S,m,B))}}return M},J8=function(e){if(!e)return it;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||it.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=kl.default;if(typeof e.format<"u"){if(!H8.call(kl.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=kl.formatters[r],s=it.filter;(typeof e.filter=="function"||dr(e.filter))&&(s=e.filter);var o;if(e.arrayFormat in zP?o=e.arrayFormat:"indices"in e?o=e.indices?"indices":"repeat":o=it.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:it.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:it.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:it.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:it.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?it.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:it.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:it.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:it.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:it.encodeValuesOnly,filter:s,format:r,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:it.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:it.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:it.strictNullHandling}},Q8=function(n,e){var t=n,r=J8(e),i,s;typeof r.filter=="function"?(s=r.filter,t=s("",t)):dr(r.filter)&&(s=r.filter,i=s);var o=[];if(typeof t!="object"||t===null)return"";var a=zP[r.arrayFormat],l=a==="comma"&&r.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);for(var c=FP(),u=0;u<i.length;++u){var d=i[u],h=t[d];r.skipNulls&&h===null||$P(o,K8(h,d,a,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}var f=o.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},Js=DP,Gg=Object.prototype.hasOwnProperty,YC=Array.isArray,Ge={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Js.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},X8=function(n){return n.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},jP=function(n,e,t){if(n&&typeof n=="string"&&e.comma&&n.indexOf(",")>-1)return n.split(",");if(e.throwOnLimitExceeded&&t>=e.arrayLimit)throw new RangeError("Array limit exceeded. Only "+e.arrayLimit+" element"+(e.arrayLimit===1?"":"s")+" allowed in an array.");return n},Y8="utf8=%26%2310003%3B",Z8="utf8=%E2%9C%93",eW=function(e,t){var r={__proto__:null},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;i=i.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=i.split(t.delimiter,t.throwOnLimitExceeded?s+1:s);if(t.throwOnLimitExceeded&&o.length>s)throw new RangeError("Parameter limit exceeded. Only "+s+" parameter"+(s===1?"":"s")+" allowed.");var a=-1,l,c=t.charset;if(t.charsetSentinel)for(l=0;l<o.length;++l)o[l].indexOf("utf8=")===0&&(o[l]===Z8?c="utf-8":o[l]===Y8&&(c="iso-8859-1"),a=l,l=o.length);for(l=0;l<o.length;++l)if(l!==a){var u=o[l],d=u.indexOf("]="),h=d===-1?u.indexOf("="):d+1,f,p;h===-1?(f=t.decoder(u,Ge.decoder,c,"key"),p=t.strictNullHandling?null:""):(f=t.decoder(u.slice(0,h),Ge.decoder,c,"key"),p=Js.maybeMap(jP(u.slice(h+1),t,YC(r[f])?r[f].length:0),function(S){return t.decoder(S,Ge.decoder,c,"value")})),p&&t.interpretNumericEntities&&c==="iso-8859-1"&&(p=X8(String(p))),u.indexOf("[]=")>-1&&(p=YC(p)?[p]:p);var g=Gg.call(r,f);g&&t.duplicates==="combine"?r[f]=Js.combine(r[f],p):(!g||t.duplicates==="last")&&(r[f]=p)}return r},tW=function(n,e,t,r){var i=0;if(n.length>0&&n[n.length-1]==="[]"){var s=n.slice(0,-1).join("");i=Array.isArray(e)&&e[s]?e[s].length:0}for(var o=r?e:jP(e,t,i),a=n.length-1;a>=0;--a){var l,c=n[a];if(c==="[]"&&t.parseArrays)l=t.allowEmptyArrays&&(o===""||t.strictNullHandling&&o===null)?[]:Js.combine([],o);else{l=t.plainObjects?{__proto__:null}:{};var u=c.charAt(0)==="["&&c.charAt(c.length-1)==="]"?c.slice(1,-1):c,d=t.decodeDotInKeys?u.replace(/%2E/g,"."):u,h=parseInt(d,10);!t.parseArrays&&d===""?l={0:o}:!isNaN(h)&&c!==d&&String(h)===d&&h>=0&&t.parseArrays&&h<=t.arrayLimit?(l=[],l[h]=o):d!=="__proto__"&&(l[d]=o)}o=l}return o},nW=function(e,t,r,i){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=r.depth>0&&o.exec(s),c=l?s.slice(0,l.index):s,u=[];if(c){if(!r.plainObjects&&Gg.call(Object.prototype,c)&&!r.allowPrototypes)return;u.push(c)}for(var d=0;r.depth>0&&(l=a.exec(s))!==null&&d<r.depth;){if(d+=1,!r.plainObjects&&Gg.call(Object.prototype,l[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(l[1])}if(l){if(r.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");u.push("["+s.slice(l.index)+"]")}return tW(u,t,r,i)}},rW=function(e){if(!e)return Ge;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof e.throwOnLimitExceeded<"u"&&typeof e.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var t=typeof e.charset>"u"?Ge.charset:e.charset,r=typeof e.duplicates>"u"?Ge.duplicates:e.duplicates;if(r!=="combine"&&r!=="first"&&r!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var i=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:Ge.allowDots:!!e.allowDots;return{allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:Ge.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:Ge.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:Ge.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:Ge.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Ge.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:Ge.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:Ge.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:Ge.decoder,delimiter:typeof e.delimiter=="string"||Js.isRegExp(e.delimiter)?e.delimiter:Ge.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:Ge.depth,duplicates:r,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:Ge.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:Ge.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:Ge.plainObjects,strictDepth:typeof e.strictDepth=="boolean"?!!e.strictDepth:Ge.strictDepth,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Ge.strictNullHandling,throwOnLimitExceeded:typeof e.throwOnLimitExceeded=="boolean"?e.throwOnLimitExceeded:!1}},iW=function(n,e){var t=rW(e);if(n===""||n===null||typeof n>"u")return t.plainObjects?{__proto__:null}:{};for(var r=typeof n=="string"?eW(n,t):n,i=t.plainObjects?{__proto__:null}:{},s=Object.keys(r),o=0;o<s.length;++o){var a=s[o],l=nW(a,r[a],t,typeof n=="string");i=Js.merge(i,l,t)}return t.allowSparse===!0?i:Js.compact(i)},sW=Q8,oW=iW,aW=C0,lW={formats:aW,parse:oW,stringify:sW},cW=cH;function Jr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var uW=/^([a-z0-9.+-]+:)/i,dW=/:[0-9]*$/,hW=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,fW=["<",">",'"',"`"," ","\r",`
`,"	"],pW=["{","}","|","\\","^","`"].concat(fW),Kg=["'"].concat(pW),ZC=["%","/","?",";","#"].concat(Kg),e_=["/","?","#"],mW=255,t_=/^[+a-z0-9A-Z_-]{0,63}$/,gW=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,vW={javascript:!0,"javascript:":!0},Jg={javascript:!0,"javascript:":!0},Jo={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Qg=lW;function qP(n,e,t){if(n&&typeof n=="object"&&n instanceof Jr)return n;var r=new Jr;return r.parse(n,e,t),r}Jr.prototype.parse=function(n,e,t){if(typeof n!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof n);var r=n.indexOf("?"),i=r!==-1&&r<n.indexOf("#")?"?":"#",s=n.split(i),o=/\\/g;s[0]=s[0].replace(o,"/"),n=s.join(i);var a=n;if(a=a.trim(),!t&&n.split("#").length===1){var l=hW.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=Qg.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=uW.exec(a);if(c){c=c[0];var u=c.toLowerCase();this.protocol=u,a=a.substr(c.length)}if(t||c||a.match(/^\/\/[^@/]+@[^@/]+/)){var d=a.substr(0,2)==="//";d&&!(c&&Jg[c])&&(a=a.substr(2),this.slashes=!0)}if(!Jg[c]&&(d||c&&!Jo[c])){for(var h=-1,f=0;f<e_.length;f++){var p=a.indexOf(e_[f]);p!==-1&&(h===-1||p<h)&&(h=p)}var g,S;h===-1?S=a.lastIndexOf("@"):S=a.lastIndexOf("@",h),S!==-1&&(g=a.slice(0,S),a=a.slice(S+1),this.auth=decodeURIComponent(g)),h=-1;for(var f=0;f<ZC.length;f++){var p=a.indexOf(ZC[f]);p!==-1&&(h===-1||p<h)&&(h=p)}h===-1&&(h=a.length),this.host=a.slice(0,h),a=a.slice(h),this.parseHost(),this.hostname=this.hostname||"";var m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!m)for(var v=this.hostname.split(/\./),f=0,y=v.length;f<y;f++){var b=v[f];if(b&&!b.match(t_)){for(var w="",x=0,E=b.length;x<E;x++)b.charCodeAt(x)>127?w+="x":w+=b[x];if(!w.match(t_)){var P=v.slice(0,f),M=v.slice(f+1),F=b.match(gW);F&&(P.push(F[1]),M.unshift(F[2])),M.length&&(a="/"+M.join(".")+a),this.hostname=P.join(".");break}}}this.hostname.length>mW?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=cW.toASCII(this.hostname));var G=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+G,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!vW[u])for(var f=0,y=Kg.length;f<y;f++){var X=Kg[f];if(a.indexOf(X)!==-1){var V=encodeURIComponent(X);V===X&&(V=escape(X)),a=a.split(X).join(V)}}var _=a.indexOf("#");_!==-1&&(this.hash=a.substr(_),a=a.slice(0,_));var N=a.indexOf("?");if(N!==-1?(this.search=a.substr(N),this.query=a.substr(N+1),e&&(this.query=Qg.parse(this.query)),a=a.slice(0,N)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Jo[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var G=this.pathname||"",W=this.search||"";this.path=G+W}return this.href=this.format(),this};Jr.prototype.format=function(){var n=this.auth||"";n&&(n=encodeURIComponent(n),n=n.replace(/%3A/i,":"),n+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=n+this.host:this.hostname&&(i=n+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Qg.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Jo[e])&&i!==!1?(i="//"+(i||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):i||(i=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+i+t+o+r};Jr.prototype.resolve=function(n){return this.resolveObject(qP(n,!1,!0)).format()};Jr.prototype.resolveObject=function(n){if(typeof n=="string"){var e=new Jr;e.parse(n,!1,!0),n=e}for(var t=new Jr,r=Object.keys(this),i=0;i<r.length;i++){var s=r[i];t[s]=this[s]}if(t.hash=n.hash,n.href==="")return t.href=t.format(),t;if(n.slashes&&!n.protocol){for(var o=Object.keys(n),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(t[l]=n[l])}return Jo[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(n.protocol&&n.protocol!==t.protocol){if(!Jo[n.protocol]){for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];t[d]=n[d]}return t.href=t.format(),t}if(t.protocol=n.protocol,!n.host&&!Jg[n.protocol]){for(var y=(n.pathname||"").split("/");y.length&&!(n.host=y.shift()););n.host||(n.host=""),n.hostname||(n.hostname=""),y[0]!==""&&y.unshift(""),y.length<2&&y.unshift(""),t.pathname=y.join("/")}else t.pathname=n.pathname;if(t.search=n.search,t.query=n.query,t.host=n.host||"",t.auth=n.auth,t.hostname=n.hostname||n.host,t.port=n.port,t.pathname||t.search){var h=t.pathname||"",f=t.search||"";t.path=h+f}return t.slashes=t.slashes||n.slashes,t.href=t.format(),t}var p=t.pathname&&t.pathname.charAt(0)==="/",g=n.host||n.pathname&&n.pathname.charAt(0)==="/",S=g||p||t.host&&n.pathname,m=S,v=t.pathname&&t.pathname.split("/")||[],y=n.pathname&&n.pathname.split("/")||[],b=t.protocol&&!Jo[t.protocol];if(b&&(t.hostname="",t.port=null,t.host&&(v[0]===""?v[0]=t.host:v.unshift(t.host)),t.host="",n.protocol&&(n.hostname=null,n.port=null,n.host&&(y[0]===""?y[0]=n.host:y.unshift(n.host)),n.host=null),S=S&&(y[0]===""||v[0]==="")),g)t.host=n.host||n.host===""?n.host:t.host,t.hostname=n.hostname||n.hostname===""?n.hostname:t.hostname,t.search=n.search,t.query=n.query,v=y;else if(y.length)v||(v=[]),v.pop(),v=v.concat(y),t.search=n.search,t.query=n.query;else if(n.search!=null){if(b){t.host=v.shift(),t.hostname=t.host;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return t.search=n.search,t.query=n.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!v.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var x=v.slice(-1)[0],E=(t.host||n.host||v.length>1)&&(x==="."||x==="..")||x==="",P=0,M=v.length;M>=0;M--)x=v[M],x==="."?v.splice(M,1):x===".."?(v.splice(M,1),P++):P&&(v.splice(M,1),P--);if(!S&&!m)for(;P--;P)v.unshift("..");S&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),E&&v.join("/").substr(-1)!=="/"&&v.push("");var F=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(b){t.hostname=F?"":v.length?v.shift():"",t.host=t.hostname;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return S=S||t.host&&v.length,S&&!F&&v.unshift(""),v.length>0?t.pathname=v.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=n.auth||t.auth,t.slashes=t.slashes||n.slashes,t.href=t.format(),t};Jr.prototype.parseHost=function(){var n=this.host,e=dW.exec(n);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),n=n.substr(0,n.length-e.length)),n&&(this.hostname=n)};var Xg=qP;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var En;(function(n){n.genericError="genericError",n.genericNetworkError="genericNetworkError",n.authorizationError="authorizationError",n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",n.throttlingError="throttlingError",n.offlineError="offlineError",n.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",n.writeError="writeError",n.fetchFailure="fetchFailure",n.incorrectServerResponse="incorrectServerResponse",n.fileOverwrittenInStorage="fileOverwrittenInStorage",n.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",n.locationRedirection="locationRedirection"})(En||(En={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var fa;(function(n){n[n.NoCaching=0]="NoCaching",n[n.Prefetch=1]="Prefetch"})(fa||(fa={}));var pa;(function(n){n.summarizingClient="fluid-client-summarizer",n.createNew="createNew"})(pa||(pa={}));var _0={exports:{}},BP=function(e,t){return function(){return e.apply(t,arguments)}},yW=BP,E0=Object.prototype.toString,T0=function(n){return function(e){var t=E0.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())}}(Object.create(null));function os(n){return n=n.toLowerCase(),function(t){return T0(t)===n}}function Fh(n){return Array.isArray(n)}function Yg(n){return typeof n>"u"}function SW(n){return n!==null&&!Yg(n)&&n.constructor!==null&&!Yg(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}var UP=os("ArrayBuffer");function bW(n){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&UP(n.buffer),e}function wW(n){return typeof n=="string"}function HP(n){return typeof n=="number"}function WP(n){return n!==null&&typeof n=="object"}function Ju(n){if(T0(n)!=="object")return!1;var e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}function CW(n){return n&&Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}var _W=os("Date"),EW=os("File"),TW=os("Blob"),xW=os("FileList");function x0(n){return E0.call(n)==="[object Function]"}function OW(n){return WP(n)&&x0(n.pipe)}function PW(n){var e="[object FormData]";return n&&(typeof FormData=="function"&&n instanceof FormData||E0.call(n)===e||x0(n.toString)&&n.toString()===e)}var RW=os("URLSearchParams");function kW(n){return n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function NW(){var n;return typeof navigator<"u"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window<"u"&&typeof document<"u"}function O0(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),Fh(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.call(null,n[i],i,n)}function Zg(){var n={};function e(i,s){Ju(n[s])&&Ju(i)?n[s]=Zg(n[s],i):Ju(i)?n[s]=Zg({},i):Fh(i)?n[s]=i.slice():n[s]=i}for(var t=0,r=arguments.length;t<r;t++)O0(arguments[t],e);return n}function LW(n,e,t){return O0(e,function(i,s){t&&typeof i=="function"?n[s]=yW(i,t):n[s]=i}),n}function IW(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n}function AW(n,e,t,r){n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,t&&Object.assign(n.prototype,t)}function MW(n,e,t,r){var i,s,o,a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&Object.getPrototypeOf(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e}function DW(n,e,t){n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return r!==-1&&r===t}function FW(n){if(!n)return null;if(Fh(n))return n;var e=n.length;if(!HP(e))return null;for(var t=new Array(e);e-- >0;)t[e]=n[e];return t}var zW=function(n){return function(e){return n&&e instanceof n}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array));function $W(n,e){for(var t=n&&n[Symbol.iterator],r=t.call(n),i;(i=r.next())&&!i.done;){var s=i.value;e.call(n,s[0],s[1])}}function jW(n,e){for(var t,r=[];(t=n.exec(e))!==null;)r.push(t);return r}var qW=os("HTMLFormElement"),BW=function(e){return function(t,r){return e.call(t,r)}}(Object.prototype.hasOwnProperty),ct={isArray:Fh,isArrayBuffer:UP,isBuffer:SW,isFormData:PW,isArrayBufferView:bW,isString:wW,isNumber:HP,isObject:WP,isPlainObject:Ju,isEmptyObject:CW,isUndefined:Yg,isDate:_W,isFile:EW,isBlob:TW,isFunction:x0,isStream:OW,isURLSearchParams:RW,isStandardBrowserEnv:NW,forEach:O0,merge:Zg,extend:LW,trim:kW,stripBOM:IW,inherits:AW,toFlatObject:MW,kindOf:T0,kindOfTest:os,endsWith:DW,toArray:FW,isTypedArray:zW,isFileList:xW,forEachEntry:$W,matchAll:jW,isHTMLForm:qW,hasOwnProperty:BW},VP=ct;function ma(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}VP.inherits(ma,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var GP=ma.prototype,KP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(function(n){KP[n]={value:n}});Object.defineProperties(ma,KP);Object.defineProperty(GP,"isAxiosError",{value:!0});ma.from=function(n,e,t,r,i,s){var o=Object.create(GP);return VP.toFlatObject(n,o,function(l){return l!==Error.prototype}),ma.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};var oo=ma,UW=typeof self=="object"?self.FormData:window.FormData,HW=UW,Re=ct,WW=oo,VW=HW;function ev(n){return Re.isPlainObject(n)||Re.isArray(n)}function JP(n){return Re.endsWith(n,"[]")?n.slice(0,-2):n}function n_(n,e,t){return n?n.concat(e).map(function(i,s){return i=JP(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function GW(n){return Re.isArray(n)&&!n.some(ev)}var KW=Re.toFlatObject(Re,{},null,function(e){return/^is[A-Z]/.test(e)});function JW(n){return n&&Re.isFunction(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator]}function QW(n,e,t){if(!Re.isObject(n))throw new TypeError("target must be an object");e=e||new(VW||FormData),t=Re.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,S){return!Re.isUndefined(S[g])});var r=t.metaTokens,i=t.visitor||u,s=t.dots,o=t.indexes,a=t.Blob||typeof Blob<"u"&&Blob,l=a&&JW(e);if(!Re.isFunction(i))throw new TypeError("visitor must be a function");function c(p){if(p===null)return"";if(Re.isDate(p))return p.toISOString();if(!l&&Re.isBlob(p))throw new WW("Blob is not supported. Use a Buffer instead.");return Re.isArrayBuffer(p)||Re.isTypedArray(p)?l&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function u(p,g,S){var m=p;if(p&&!S&&typeof p=="object"){if(Re.endsWith(g,"{}"))g=r?g:g.slice(0,-2),p=JSON.stringify(p);else if(Re.isArray(p)&&GW(p)||Re.isFileList(p)||Re.endsWith(g,"[]")&&(m=Re.toArray(p)))return g=JP(g),m.forEach(function(y,b){!Re.isUndefined(y)&&e.append(o===!0?n_([g],b,s):o===null?g:g+"[]",c(y))}),!1}return ev(p)?!0:(e.append(n_(S,g,s),c(p)),!1)}var d=[],h=Object.assign(KW,{defaultVisitor:u,convertValue:c,isVisitable:ev});function f(p,g){if(!Re.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(p),Re.forEach(p,function(m,v){var y=!Re.isUndefined(m)&&i.call(e,m,Re.isString(v)?v.trim():v,g,h);y===!0&&f(m,g?g.concat(v):[v])}),d.pop()}}if(!Re.isObject(n))throw new TypeError("data must be an object");return f(n),e}var zh=QW,XW=zh;function r_(n){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'\(\)~]|%20|%00/g,function(r){return e[r]})}function QP(n,e){this._pairs=[],n&&XW(n,this,e)}var XP=QP.prototype;XP.append=function(e,t){this._pairs.push([e,t])};XP.toString=function(e){var t=e?function(r){return e.call(this,r,r_)}:r_;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var YP=QP,YW=ct,ZW=YP;function eV(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var ZP=function(e,t,r){if(!t)return e;var i=e.indexOf("#");i!==-1&&(e=e.slice(0,i));var s=r&&r.encode||eV,o=r&&r.serialize,a;return o?a=o(t,r):a=YW.isURLSearchParams(t)?t.toString():new ZW(t,r).toString(s),a&&(e+=(e.indexOf("?")===-1?"?":"&")+a),e},tV=ct;function Dc(){this.handlers=[]}Dc.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};Dc.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Dc.prototype.clear=function(){this.handlers&&(this.handlers=[])};Dc.prototype.forEach=function(e){tV.forEach(this.handlers,function(r){r!==null&&e(r)})};var nV=Dc,rV=ct,eR=function(e,t){rV.forEach(e,function(i,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[s])})},tR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},iV=YP,sV=typeof URLSearchParams<"u"?URLSearchParams:iV,oV=FormData,aV={isBrowser:!0,classes:{URLSearchParams:sV,FormData:oV,Blob},protocols:["http","https","file","blob","url","data"]},P0=aV,lV=ct,cV=zh,i_=P0,uV=function(e,t){return cV(e,new i_.classes.URLSearchParams,Object.assign({visitor:function(r,i,s,o){return i_.isNode&&lV.isBuffer(r)?(this.append(i,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))},gi=ct;function dV(n){return gi.matchAll(/\w+|\[(\w*)]/g,n).map(function(e){return e[0]==="[]"?"":e[1]||e[0]})}function hV(n){var e={},t=Object.keys(n),r,i=t.length,s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function fV(n){function e(r,i,s,o){var a=r[o++],l=Number.isFinite(+a),c=o>=r.length;if(a=!a&&gi.isArray(s)?s.length:a,c)return gi.hasOwnProperty(s,a)?s[a]=[s[a],i]:s[a]=i,!l;(!s[a]||!gi.isObject(s[a]))&&(s[a]=[]);var u=e(r,i,s[a],o);return u&&gi.isArray(s[a])&&(s[a]=hV(s[a])),!l}if(gi.isFormData(n)&&gi.isFunction(n.entries)){var t={};return gi.forEachEntry(n,function(r,i){e(dV(r),i,t,0)}),t}return null}var nR=fV,Ip,s_;function pV(){if(s_)return Ip;s_=1;var n=oo;return Ip=function(t,r,i){var s=i.config.validateStatus;!i.status||!s||s(i.status)?t(i):r(new n("Request failed with status code "+i.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))},Ip}var Ap,o_;function mV(){if(o_)return Ap;o_=1;var n=ct;return Ap=n.isStandardBrowserEnv()?function(){return{write:function(r,i,s,o,a,l){var c=[];c.push(r+"="+encodeURIComponent(i)),n.isNumber(s)&&c.push("expires="+new Date(s).toGMTString()),n.isString(o)&&c.push("path="+o),n.isString(a)&&c.push("domain="+a),l===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Ap}var gV=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},vV=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},yV=gV,SV=vV,rR=function(e,t){return e&&!yV(t)?SV(e,t):t},Mp,a_;function bV(){if(a_)return Mp;a_=1;var n=ct,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Mp=function(r){var i={},s,o,a;return r&&n.forEach(r.split(`
`),function(c){if(a=c.indexOf(":"),s=n.trim(c.slice(0,a)).toLowerCase(),o=n.trim(c.slice(a+1)),s){if(i[s]&&e.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},Mp}var Dp,l_;function wV(){if(l_)return Dp;l_=1;var n=ct;return Dp=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),i;function s(o){var a=o;return t&&(r.setAttribute("href",a),a=r.href),r.setAttribute("href",a),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=s(window.location.href),function(a){var l=n.isString(a)?s(a):a;return l.protocol===i.protocol&&l.host===i.host}}():function(){return function(){return!0}}(),Dp}var Fp,c_;function $h(){if(c_)return Fp;c_=1;var n=oo,e=ct;function t(r,i,s){n.call(this,r??"canceled",n.ERR_CANCELED,i,s),this.name="CanceledError"}return e.inherits(t,n,{__CANCEL__:!0}),Fp=t,Fp}var zp,u_;function CV(){return u_||(u_=1,zp=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}),zp}var $p,d_;function h_(){if(d_)return $p;d_=1;var n=ct,e=pV(),t=mV(),r=ZP,i=rR,s=bV(),o=wV(),a=tR,l=oo,c=$h(),u=CV(),d=P0;return $p=function(f){return new Promise(function(g,S){var m=f.data,v=f.headers,y=f.responseType,b=f.withXSRFToken,w;function x(){f.cancelToken&&f.cancelToken.unsubscribe(w),f.signal&&f.signal.removeEventListener("abort",w)}n.isFormData(m)&&n.isStandardBrowserEnv()&&delete v["Content-Type"];var E=new XMLHttpRequest;if(f.auth){var P=f.auth.username||"",M=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";v.Authorization="Basic "+btoa(P+":"+M)}var F=i(f.baseURL,f.url);E.open(f.method.toUpperCase(),r(F,f.params,f.paramsSerializer),!0),E.timeout=f.timeout;function G(){if(E){var V="getAllResponseHeaders"in E?s(E.getAllResponseHeaders()):null,_=!y||y==="text"||y==="json"?E.responseText:E.response,N={data:_,status:E.status,statusText:E.statusText,headers:V,config:f,request:E};e(function(A){g(A),x()},function(A){S(A),x()},N),E=null}}if("onloadend"in E?E.onloadend=G:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(G)},E.onabort=function(){E&&(S(new l("Request aborted",l.ECONNABORTED,f,E)),E=null)},E.onerror=function(){S(new l("Network Error",l.ERR_NETWORK,f,E)),E=null},E.ontimeout=function(){var _=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",N=f.transitional||a;f.timeoutErrorMessage&&(_=f.timeoutErrorMessage),S(new l(_,N.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,f,E)),E=null},n.isStandardBrowserEnv()&&(b&&n.isFunction(b)&&(b=b(f)),b||b!==!1&&o(F))){var z=f.xsrfHeaderName&&f.xsrfCookieName&&t.read(f.xsrfCookieName);z&&(v[f.xsrfHeaderName]=z)}"setRequestHeader"in E&&n.forEach(v,function(_,N){typeof m>"u"&&N.toLowerCase()==="content-type"?delete v[N]:E.setRequestHeader(N,_)}),n.isUndefined(f.withCredentials)||(E.withCredentials=!!f.withCredentials),y&&y!=="json"&&(E.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&E.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&E.upload&&E.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(w=function(V){E&&(S(!V||V.type?new c(null,f,E):V),E.abort(),E=null)},f.cancelToken&&f.cancelToken.subscribe(w),f.signal&&(f.signal.aborted?w():f.signal.addEventListener("abort",w))),!m&&m!==!1&&m!==0&&m!==""&&(m=null);var X=u(F);if(X&&d.protocols.indexOf(X)===-1){S(new l("Unsupported protocol "+X+":",l.ERR_BAD_REQUEST,f));return}E.send(m)})},$p}var st=ct,f_=eR,p_=oo,_V=tR,EV=zh,TV=uV,m_=P0,xV=nR,OV={"Content-Type":"application/x-www-form-urlencoded"};function g_(n,e){!st.isUndefined(n)&&st.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}function PV(){var n;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(n=h_()),n}function RV(n,e,t){if(st.isString(n))try{return(e||JSON.parse)(n),st.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var jh={transitional:_V,adapter:PV(),transformRequest:[function(e,t){f_(t,"Accept"),f_(t,"Content-Type");var r=t&&t["Content-Type"]||"",i=r.indexOf("application/json")>-1,s=st.isObject(e);s&&st.isHTMLForm(e)&&(e=new FormData(e));var o=st.isFormData(e);if(o)return i?JSON.stringify(xV(e)):e;if(st.isArrayBuffer(e)||st.isBuffer(e)||st.isStream(e)||st.isFile(e)||st.isBlob(e))return e;if(st.isArrayBufferView(e))return e.buffer;if(st.isURLSearchParams(e))return g_(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var a;if(s){if(r.indexOf("application/x-www-form-urlencoded")!==-1)return TV(e,this.formSerializer).toString();if((a=st.isFileList(e))||r.indexOf("multipart/form-data")>-1){var l=this.env&&this.env.FormData;return EV(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||i?(g_(t,"application/json"),RV(e)):e}],transformResponse:[function(e){var t=this.transitional||jh.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&st.isString(e)&&(r&&!this.responseType||i)){var s=t&&t.silentJSONParsing,o=!s&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?p_.from(a,p_.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:m_.classes.FormData,Blob:m_.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};st.forEach(["delete","get","head"],function(e){jh.headers[e]={}});st.forEach(["post","put","patch"],function(e){jh.headers[e]=st.merge(OV)});var R0=jh,kV=ct,NV=R0,LV=function(e,t,r,i){var s=this||NV;return kV.forEach(i,function(a){e=a.call(s,e,t,r)}),e},jp,v_;function iR(){return v_||(v_=1,jp=function(e){return!!(e&&e.__CANCEL__)}),jp}var y_=ct,qp=LV,IV=iR(),AV=R0,MV=$h(),S_=eR;function Bp(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new MV}var DV=function(e){Bp(e),e.headers=e.headers||{},e.data=qp.call(e,e.data,e.headers,null,e.transformRequest),S_(e.headers,"Accept"),S_(e.headers,"Content-Type"),e.headers=y_.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),y_.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var t=e.adapter||AV.adapter;return t(e).then(function(i){return Bp(e),i.data=qp.call(e,i.data,i.headers,i.status,e.transformResponse),i},function(i){return IV(i)||(Bp(e),i&&i.response&&(i.response.data=qp.call(e,i.response.data,i.response.headers,i.response.status,e.transformResponse))),Promise.reject(i)})},zt=ct,sR=function(e,t){t=t||{};var r={};function i(u,d){return zt.isPlainObject(u)&&zt.isPlainObject(d)?zt.merge(u,d):zt.isEmptyObject(d)?zt.merge({},u):zt.isPlainObject(d)?zt.merge({},d):zt.isArray(d)?d.slice():d}function s(u){if(zt.isUndefined(t[u])){if(!zt.isUndefined(e[u]))return i(void 0,e[u])}else return i(e[u],t[u])}function o(u){if(!zt.isUndefined(t[u]))return i(void 0,t[u])}function a(u){if(zt.isUndefined(t[u])){if(!zt.isUndefined(e[u]))return i(void 0,e[u])}else return i(void 0,t[u])}function l(u){if(u in t)return i(e[u],t[u]);if(u in e)return i(void 0,e[u])}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l};return zt.forEach(Object.keys(e).concat(Object.keys(t)),function(d){var h=c[d]||s,f=h(d);zt.isUndefined(f)&&h!==l||(r[d]=f)}),r},Up,b_;function oR(){return b_||(b_=1,Up={version:"0.28.1"}),Up}var FV=oR().version,wi=oo,k0={};["object","boolean","number","function","string","symbol"].forEach(function(n,e){k0[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var w_={};k0.transitional=function(e,t,r){function i(s,o){return"[Axios v"+FV+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return function(s,o,a){if(e===!1)throw new wi(i(o," has been removed"+(t?" in "+t:"")),wi.ERR_DEPRECATED);return t&&!w_[o]&&(w_[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function zV(n,e,t){if(typeof n!="object")throw new wi("options must be an object",wi.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(n),i=r.length;i-- >0;){var s=r[i],o=e[s];if(o){var a=n[s],l=a===void 0||o(a,s,n);if(l!==!0)throw new wi("option "+s+" must be "+l,wi.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new wi("Unknown option "+s,wi.ERR_BAD_OPTION)}}var $V={assertOptions:zV,validators:k0},N0=ct,jV=ZP,C_=nV,__=DV,qh=sR,qV=rR,tv=$V,mi=tv.validators;function ga(n){this.defaults=n,this.interceptors={request:new C_,response:new C_}}ga.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=qh(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;r!==void 0&&tv.assertOptions(r,{silentJSONParsing:mi.transitional(mi.boolean),forcedJSONParsing:mi.transitional(mi.boolean),clarifyTimeoutError:mi.transitional(mi.boolean)},!1);var i=t.paramsSerializer;i!==void 0&&tv.assertOptions(i,{encode:mi.function,serialize:mi.function},!0),N0.isFunction(i)&&(t.paramsSerializer={serialize:i});var s=[],o=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(o=o&&p.synchronous,s.unshift(p.fulfilled,p.rejected))});var a=[];this.interceptors.response.forEach(function(p){a.push(p.fulfilled,p.rejected)});var l;if(!o){var c=[__,void 0];for(Array.prototype.unshift.apply(c,s),c=c.concat(a),l=Promise.resolve(t);c.length;)l=l.then(c.shift(),c.shift());return l}for(var u=t;s.length;){var d=s.shift(),h=s.shift();try{u=d(u)}catch(f){h(f);break}}try{l=__(u)}catch(f){return Promise.reject(f)}for(;a.length;)l=l.then(a.shift(),a.shift());return l};ga.prototype.getUri=function(e){e=qh(this.defaults,e);var t=qV(e.baseURL,e.url);return jV(t,e.params,e.paramsSerializer)};N0.forEach(["delete","get","head","options"],function(e){ga.prototype[e]=function(t,r){return this.request(qh(r||{},{method:e,url:t,data:(r||{}).data}))}});N0.forEach(["post","put","patch"],function(e){function t(r){return function(s,o,a){return this.request(qh(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}ga.prototype[e]=t(),ga.prototype[e+"Form"]=t(!0)});var BV=ga,Hp,E_;function UV(){if(E_)return Hp;E_=1;var n=$h();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(o){r=o});var i=this;this.promise.then(function(s){if(i._listeners){for(var o=i._listeners.length;o-- >0;)i._listeners[o](s);i._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(l){i.subscribe(l),o=l}).then(s);return a.cancel=function(){i.unsubscribe(o)},a},t(function(o,a,l){i.reason||(i.reason=new n(o,a,l),r(i.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(this._listeners){var i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}},e.source=function(){var r,i=new e(function(o){r=o});return{token:i,cancel:r}},Hp=e,Hp}var Wp,T_;function HV(){return T_||(T_=1,Wp=function(e){return function(r){return e.apply(null,r)}}),Wp}var Vp,x_;function WV(){if(x_)return Vp;x_=1;var n=ct;return Vp=function(t){return n.isObject(t)&&t.isAxiosError===!0},Vp}var nv=ct,VV=BP,Qu=BV,GV=sR,KV=R0,JV=nR;function aR(n){var e=new Qu(n),t=VV(Qu.prototype.request,e);return nv.extend(t,Qu.prototype,e),nv.extend(t,e),t.create=function(i){return aR(GV(n,i))},t}var Gt=aR(KV);Gt.Axios=Qu;Gt.CanceledError=$h();Gt.CancelToken=UV();Gt.isCancel=iR();Gt.VERSION=oR().version;Gt.toFormData=zh;Gt.AxiosError=oo;Gt.Cancel=Gt.CanceledError;Gt.all=function(e){return Promise.all(e)};Gt.spread=HV();Gt.isAxiosError=WV();Gt.formToJSON=function(n){return JV(nv.isHTMLForm(n)?new FormData(n):n)};_0.exports=Gt;_0.exports.default=Gt;var QV=_0.exports,XV=QV;const lR=oi(XV);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const L0=n=>(n==null?void 0:n.type)==="fluid";function kr(n){if(!L0(n))throw new Error(`resolved is not a Fluid url. Type: ${n==null?void 0:n.type}`)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class I0{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach(t=>{this.protocolToDocumentFactoryMap.set(t.protocolName,t)})}static create(e){if(Array.isArray(e)){const t=[];return e.forEach(r=>{const i=r;i.protocolToDocumentFactoryMap!==void 0?t.push(...i.protocolToDocumentFactoryMap.values()):t.push(r)}),t.length===1?t[0]:new I0(t)}return e}async createDocumentService(e,t,r){kr(e);const i=Xg(e.url);if(i.protocol===void 0||i.protocol===null)throw new Error("No protocol provided");const s=this.protocolToDocumentFactoryMap.get(i.protocol);if(s===void 0)throw new Error("Unknown Fluid protocol");return s.createDocumentService(e,t,r)}async createContainer(e,t,r,i){kr(t);const s=Xg(t.url);if(s.protocol===void 0||s.protocol===null)throw new Error("No protocol provided");const o=this.protocolToDocumentFactoryMap.get(s.protocol);if(o===void 0)throw new Error("Unknown Fluid protocol");return o.createContainer(e,t,r,i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function YV(n,e){let t;for(const r of n)if(t=await r.resolve(Object.assign({},e)),t!==void 0)return t}class A0{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?e.length===1?e[0]:new A0(e):e}async resolve(e){return YV(this.urlResolvers,e)}async getAbsoluteUrl(e,t){throw new Error("Not implmented")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gp,Bi;(function(n){n[n.Offline=0]="Offline",n[n.Online=1]="Online",n[n.Unknown=2]="Unknown"})(Bi||(Bi={}));function M0(){return typeof navigator=="object"&&navigator!==null&&typeof navigator.onLine=="boolean"?navigator.onLine?Bi.Online:Bi.Offline:Bi.Unknown}class rv extends oe{constructor(e,t,r){super(e,r),this.canRetry=t,this.errorType=En.genericNetworkError}}const O_="deltaStreamConnectionForbidden";class Bh extends oe{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=Bh.errorType,this.canRetry=!1}}Bh.errorType=(Gp=En[O_])!==null&&Gp!==void 0?Gp:O_;class ZV extends oe{constructor(e,t,r,i){super(e,i,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=r,this.errorType=En.authorizationError,this.canRetry=!1}}class e5 extends oe{constructor(e,t,r,i){super(e,i),this.errorType=t,this.canRetry=r}}class Uh extends e5{constructor(e,t,r){super(e,t,!1,r),this.errorType=t}}class t5 extends oe{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=En.throttlingError,this.canRetry=!0}}const n5=(n,e)=>new Uh(n,En.writeError,e);function va(n,e,t){return e.retryAfterMs!==void 0&&e.canRetry?new t5(n,e.retryAfterMs/1e3,t):new rv(n,e.canRetry,t)}const Fc=n=>(n==null?void 0:n.canRetry)===!0,P_=n=>n==null?void 0:n.retryAfterSeconds,qd=n=>(n==null?void 0:n.retryAfterSeconds)!==void 0?n.retryAfterSeconds*1e3:void 0;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function at(n,e){const t=await n.readBlob(e),r=Y4(t,"utf8");return JSON.parse(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Xu(n,e){return{type:Ns.Tree,tree:{".protocol":e,".app":n}}}function r5(n){var e;const t=n.tree.attributes,r=JSON.parse(t.content);return r.term=(e=r.term)!==null&&e!==void 0?e:1,r}function i5(n){const e=n.tree.quorumValues;return JSON.parse(e.content)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function iv(n,e,t){var r,i;const s=Object.assign({},e),o=t.online;if(s.online=typeof o=="string"?o:Bi[M0()],typeof navigator=="object"&&navigator!==null){const a=navigator,l=(i=(r=a.connection)!==null&&r!==void 0?r:a.mozConnection)!==null&&i!==void 0?i:a.webkitConnection;l!==null&&typeof l=="object"&&(s.connectionType=l.type)}s.category=Fc(t)?"generic":"error",n.sendTelemetryEvent(s,t)}function sv(n){return new Promise(t=>{let r=t,i=n;M0()===Bi.Offline&&(window==null?void 0:window.addEventListener)!==void 0&&(r=()=>{t(),window.removeEventListener("online",r)},window.addEventListener("online",r,!1),i=Math.max(n,3e4)),setTimeout(r,i)})}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const cR="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const s5=1e4,o5=100;class a5{constructor(e,t,r,i,s,o){this.to=t,this.payloadSize=r,this.logger=i,this.requestCallback=s,this.responseCallback=o,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new uP,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=t!==void 0}get working(){return this.workingState==="working"}get canceled(){return this.workingState==="canceled"}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(e){xe(e>0,258),xe(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){xe(this.to!==void 0,260),xe(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(e===void 0)break;this.results.delete(this.nextToDeliver),xe(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(this.requestsInFlight===0?(xe(this.results.size===0,263),this.done()):this.to!==void 0&&this.nextToDeliver>=this.to&&(xe(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;if(!(this.to!==void 0&&this.to<=e))return this.latestRequested+=this.payloadSize,this.to!==void 0&&(this.latestRequested=Math.min(this.to,this.latestRequested)),xe(e<this.latestRequested,265),{from:e,to:this.latestRequested}}addRequest(){const e=this.getNextChunk();e!==void 0&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}async addRequestCore(e,t){xe(this.working,266);let r=e,i=t;for(this.requestsInFlight++;this.working;){const s=i-r;xe(s>0,267),this.to!==void 0&&(xe(r<this.to,268),xe(i<=this.to,269)),this.requests++;const o=this.requestCallback(this.requests,r,i,this.to!==void 0,{});this.dispatch();const{payload:a,cancel:l,partial:c}=await o;if(l&&this.cancel(),this.to!==void 0&&r>=this.to){xe(!this.knewTo,270),a.length!==0&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:r,to:i,end:this.to,length:a.length});break}if(this.working){const u=r,d=a.length;let h=s<=d;if(d!==0){s<d&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:r,to:i,length:d});const f=a.splice(0,s);this.results.set(r,f),r+=f.length}else xe(!c,271),xe(!this.knewTo,272);if(!c&&!h){if(!this.knewTo){(this.to===void 0||this.to>r)&&(this.to=r);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:u,to:i,length:d})}if(i===this.latestRequested&&(a.length!==0&&(this.results.set(r,a),r+=a.length),this.latestRequested=r,h=!0),h){const f=this.getNextChunk();if(f===void 0)break;r=f.from,i=f.to}}}this.requestsInFlight--,this.dispatch()}}class l5{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){xe(!this.done,274),this.deferred?(xe(this.queue.length===0,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}async read(){xe(this.deferred===void 0,276);const e=this.queue.shift();return e!==void 0?e:(xe(!this.done,277),this.deferred=new uP,this.deferred.promise)}}async function c5(n,e,t,r,i,s){let o,a=0;const l=[],c={partial:!1,cancel:!0,payload:[]};for(;(i==null?void 0:i.aborted)!==!0;){a++;let u=Math.min(s5,o5*Math.pow(2,a));const d=Oi.now();try{const h=n(Object.assign(Object.assign({},e),{retry:a})),{messages:f,partialResult:p}=await h;if(l.push(...f),f.length!==0||!t)return{payload:l,cancel:!1,partial:p};if(o===void 0)o=Oi.now();else if(Oi.now()-o>3e4)throw va("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:a,driverVersion:cR},e))}catch(h){const f=Fc(h);o=void 0;const p=qd(h);if(iv(r,Object.assign(Object.assign({eventName:"GetDeltas_Error"},e),{retry:a,duration:Oi.now()-d,retryAfter:p,reason:s}),h),!f)throw h;p!==void 0&&p>=0&&(u=p)}await sv(u)}return c}function u5(n,e,t,r,i,s,o,a){let l=0,c,u=0;const d=new l5,h={fromTotal:t,toTotal:r},f=le.start(s,Object.assign(Object.assign({eventName:"GetDeltas"},h),{reason:a})),p=new a5(t,r,i,s,async(S,m,v,y,b)=>(l++,c5(async w=>n(m,v,w),Object.assign(Object.assign({request:S,from:m,to:v},h),b),y,s,o,a)),S=>{c===void 0?xe(S[0].sequenceNumber===t,621):xe(S[0].sequenceNumber===c+1,622),c=S[S.length-1].sequenceNumber,xe(c-S[0].sequenceNumber+1===S.length,623),u+=S.length,d.pushValue(S)}),g=S=>{p.cancel()};return o!==void 0&&o.addEventListener("abort",g),p.run(e).finally(()=>{o!==void 0&&o.removeEventListener("abort",g)}).then(()=>{const S={lastFetch:c,length:u,requests:l};p.canceled?f.cancel(Object.assign(Object.assign({},S),{error:"ops request cancelled by client"})):(xe(r===void 0||c!==void 0&&c>=r-1,624),f.end(S)),d.pushDone()}).catch(S=>{f.cancel({lastFetch:c,length:u,requests:l},S),d.pushError(S)}),d}const d5={read:async()=>({done:!0})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class h5 extends f0{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:fa.NoCaching})}async getSnapshotTree(e){const t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then(r=>{r!=null&&this.prefetchTree(r)}),t}async readBlob(e){return this.cachedRead(e)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(e){if(this.prefetchEnabled){const t=this.prefetchCache.get(e);if(t!==void 0)return t;const r=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,r.catch(i=>{throw Fc(i)&&this.prefetchCache.delete(e),i})),r}return this.internalStorageService.readBlob(e)}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const r of t)this.cachedRead(r)}prefetchTreeCore(e,t){for(const r of Object.keys(e.blobs)){const i=e.blobs[r];r.startsWith(".")||r==="header"||r.startsWith("quorum")?i!==null&&this.cachedRead(i):r.startsWith("deltas")||i!==null&&t.push(i)}for(const r of Object.keys(e.trees))this.prefetchTreeCore(e.trees[r],t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Bd=class{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const t=this.tasks.shift();if(t!==void 0)return t();this.maxRequests++},xe(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(this.maxRequests>0){this.maxRequests--;return}return new Promise(e=>{this.tasks.push(e)})}async schedule(e){return await this.acquire(),e().finally(this.release)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function D0(n,e,t,r){var i,s;let o,a=!1,l=1e3,c=0;const u=Oi.now();let d;do try{o=await n(r.cancel),a=!0}catch(h){if(!Fc(h))throw t.sendTelemetryEvent({eventName:`${e}_cancel`,retry:c,duration:Oi.now()-u,fetchCallName:e},h),h;if(((i=r.cancel)===null||i===void 0?void 0:i.aborted)===!0)throw t.sendTelemetryEvent({eventName:`${e}_runWithRetryAborted`,retry:c,duration:Oi.now()-u,fetchCallName:e},h),new Uh("runWithRetry was Aborted",En.genericError,{driverVersion:cR,fetchCallName:e});c++,d=h,l=(s=qd(h))!==null&&s!==void 0?s:Math.min(l*2,8e3),r.onRetry&&r.onRetry(l,h),await Z4(l)}while(!a);return c>0&&t.sendTelemetryEvent({eventName:`${e}_lastError`,retry:c,duration:Oi.now()-u,fetchCallName:e},d),o}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class f5{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:Ns.Tree,tree:Object.assign({},this.summaryTree),unreferenced:(e=this.props)===null||e===void 0?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:Ns.Blob,content:t}}addHandle(e,t,r){this.summaryTree[e]={type:Ns.Handle,handleType:t,handle:r}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:Ns.Attachment}}}function uR(n,e){const t=new f5({unreferenced:n.unreferenced});for(const[r,i]of Object.entries(n.blobs)){const s=e.get(i);xe(s!==void 0,733),t.addBlob(r,p0.from(s).toString("utf-8"))}for(const[r,i]of Object.entries(n.trees)){const s=uR(i,e);t.addTree(r,s)}return t.summary}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function p5(n){if(oc(n))return!0;switch(n.type){case Fs.Propose:case Fs.Reject:case Fs.NoOp:return!0;default:return!1}}function oc(n){return n.type===Fs.Operation||n.type===Fs.Summarize}var ov;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(ov||(ov={}));function ac(n){return!!Object.values(ov).includes(n.type)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Nn;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Nn||(Nn={}));var R_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(R_||(R_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var fn;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(fn||(fn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ud;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(Ud||(Ud={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class m5 extends ln.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return t!==void 0?(this.members.delete(e),this.emit("removeMember",e,t),!0):!1}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const g5="Code package does not implement IRuntimeFactory";class F0{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g){this.container=e,this.scope=t,this.codeLoader=r,this._codeDetails=i,this._baseSnapshot=s,this.deltaManager=o,this.loader=l,this.submitFn=c,this.submitSignalFn=u,this.closeFn=d,this.version=h,this.updateDirtyContainerState=f,this.existing=p,this.pendingLocalState=g,this._disposed=!1,this._quorum=a,this.taggedLogger=e.subLogger,this._fluidModuleP=new XB(async()=>this.loadCodeModule(i)),this.attachListener()}static async createOrLoad(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g){const S=new F0(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g);return await S.instantiateRuntime(p),S}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return L0(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(this._runtime===void 0)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return(e=this._quorum.get("code"))!==null&&e!==void 0?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const r=this.runtime;q(e===this.connected,222),r.setConnectionState(e,t)}process(e,t,r){this.runtime.process(e,t,r)}processSignal(e,t){this.runtime.processSignal(e,t)}async request(e){return this.runtime.request(e)}async getAbsoluteUrl(e){return this.container.getAbsoluteUrl(e)}getPendingLocalState(){return this.runtime.getPendingLocalState()}async satisfies(e){var t;const r=[],i=this.codeLoader;i.IFluidCodeDetailsComparer!==void 0&&r.push(i.IFluidCodeDetailsComparer);const s=await this._fluidModuleP,o=(t=s.module)===null||t===void 0?void 0:t.fluidExport;if((o==null?void 0:o.IFluidCodeDetailsComparer)!==void 0&&r.push(o.IFluidCodeDetailsComparer),r.length===0)return!1;for(const a of r)if(await a.satisfies(s.details,e)===!1)return!1;return!0}notifyAttaching(e){var t,r;this._baseSnapshot=e,(r=(t=this.runtime).notifyAttaching)===null||r===void 0||r.call(t,e),this.runtime.setAttachState(Z.Attaching)}async getRuntimeFactory(){var e;const t=(e=(await this._fluidModuleP).module)===null||e===void 0?void 0:e.fluidExport,r=t==null?void 0:t.IRuntimeFactory;if(r===void 0)throw new Error(g5);return r}async instantiateRuntime(e){const t=await this.getRuntimeFactory();this._runtime=await t.instantiateRuntime(this,e)}attachListener(){this.container.once("attached",()=>{this.runtime.setAttachState(Z.Attached)})}async loadCodeModule(e){const t=await le.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},async()=>this.codeLoader.load(e));if("module"in t){const{module:r,details:i}=t;return{module:r,details:i??e}}else return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var jt;(function(n){n.Never="Never",n.Disabled="Disabled",n.Enabled="Enabled"})(jt||(jt={}));const v5=n=>{let e;return n&&"name"in n?e=n:uO(n==null?void 0:n.package)?e=n==null?void 0:n.package.name:e=n==null?void 0:n.package,{name:e}};var Hh={exports:{}};const{AbortController:dR,AbortSignal:y5}=typeof self<"u"?self:typeof window<"u"?window:void 0;Hh.exports=dR;Hh.exports.AbortSignal=y5;Hh.exports.default=dR;var S5=Hh.exports;const av=oi(S5);function Se(n){if(this._capacity=fR(n),this._length=0,this._front=0,hR(n)){for(var e=n.length,t=0;t<e;++t)this[t]=n[t];this._length=e}}Se.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,i=this._capacity,s=0;s<e;++s)t[s]=this[r+s&i-1];return t};Se.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var i=this._capacity;if(r+t>i){for(var o=0;o<t;++o){this._checkCapacity(r+1);var s=this._front+r&this._capacity-1;this[s]=arguments[o],r++,this._length=r}return r}else{for(var s=this._front,o=0;o<t;++o)this[s+r&i-1]=arguments[o],s++;return this._length=r+t,r+t}}if(t===0)return r;this._checkCapacity(r+1);var o=this._front+r&this._capacity-1;return this[o]=e,this._length=r+1,r+1};Se.prototype.pop=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}};Se.prototype.shift=function(){var e=this._length;if(e!==0){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}};Se.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){var o=this._capacity;if(t+r>o){for(var a=r-1;a>=0;a--){this._checkCapacity(t+1);var o=this._capacity,i=(this._front-1&o-1^o)-o;this[i]=arguments[a],t++,this._length=t,this._front=i}return t}else{for(var s=this._front,a=r-1;a>=0;a--){var i=(s-1&o-1^o)-o;this[i]=arguments[a],s=i}return this._front=s,this._length=t+r,t+r}}if(r===0)return t;this._checkCapacity(t+1);var o=this._capacity,a=(this._front-1&o-1^o)-o;return this[a]=e,this._length=t+1,this._front=a,t+1};Se.prototype.peekBack=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1;return this[t]}};Se.prototype.peekFront=function(){if(this._length!==0)return this[this._front]};Se.prototype.get=function(e){var t=e;if(t===(t|0)){var r=this._length;if(t<0&&(t=t+r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}};Se.prototype.isEmpty=function(){return this._length===0};Se.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,i=0;i<e;++i)this[t+i&r-1]=void 0;this._length=0,this._front=0};Se.prototype.toString=function(){return this.toArray().toString()};Se.prototype.valueOf=Se.prototype.toString;Se.prototype.removeFront=Se.prototype.shift;Se.prototype.removeBack=Se.prototype.pop;Se.prototype.insertFront=Se.prototype.unshift;Se.prototype.insertBack=Se.prototype.push;Se.prototype.enqueue=Se.prototype.push;Se.prototype.dequeue=Se.prototype.shift;Se.prototype.toJSON=Se.prototype.toArray;Object.defineProperty(Se.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}});Se.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(fR(this._capacity*1.5+16))};Se.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,i=this._length;if(r+i>t){var s=r+i&t-1;b5(this,0,this,t,s)}};var hR=Array.isArray;function b5(n,e,t,r,i){for(var s=0;s<i;++s)t[s+r]=n[s+e],n[s+e]=void 0}function w5(n){return n=n>>>0,n=n-1,n=n|n>>1,n=n|n>>2,n=n|n>>4,n=n|n>>8,n=n|n>>16,n+1}function fR(n){if(typeof n!="number")if(hR(n))n=n.length;else return 16;return w5(Math.min(Math.max(16,n),1073741824))}var C5=Se;const lv=oi(C5);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class cv extends kh{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new lv,this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return this.pauseCount!==0}get length(){return this.q.length}get idle(){return this.processingPromise===void 0&&this.q.length===0}async waitTillProcessingDone(){var e;return(e=this.processingPromise)!==null&&e!==void 0?e:{count:0,duration:0}}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){q(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&this.processingPromise===void 0&&(this.processingPromise=Promise.resolve().then(()=>{q(this.processingPromise!==void 0,"reentrancy?");const e=this.processDeltas();return q(this.processingPromise!==void 0,"reentrancy?"),this.processingPromise=void 0,e}).catch(e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0})),q(this.processingPromise!==void 0,"processDeltas() should run async"))}anythingToProcess(){return this.q.length!==0&&!this.paused&&this.error===void 0}processDeltas(){const e=Lt.now();let t=0;for(;this.anythingToProcess();){const i=this.q.shift();t++,this.worker(i),this.emit("op",i)}const r=Lt.now()-e;return this.q.length===0&&this.emit("idle",t,r),{count:t,duration:r}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _5 extends kh{constructor(e,t,r,i){super(),this.serviceProvider=e,this.logger=t,this._active=r,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new av,this.deltaStorageDelayId=Ze(),this.deltaStreamDelayId=Ze(),this.messageBuffer=[];const s={incomingOpHandler:(o,a)=>{try{this.enqueueMessages(o,a)}catch(l){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},l),this.close(tr(l))}},signalHandler:o=>this._inboundSignal.push(o),reconnectionDelayHandler:(o,a)=>this.emitDelayInfo(this.deltaStreamDelayId,o,a),closeHandler:o=>this.close(o),disconnectHandler:o=>this.disconnectHandler(o),connectHandler:o=>this.connectHandler(o),pongHandler:o=>this.emit("pong",o),readonlyChangeHandler:o=>V4(this,this.logger,"readonly",o)};this.connectionManager=i(s),this._inbound=new cv(o=>{this.processInboundMessage(o)}),this._inbound.on("error",o=>{this.close(_n.wrapIfUnrecognized(o,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new cv(o=>{if(this.handler===void 0)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:o.clientId,content:JSON.parse(o.content)})}),this._inboundSignal.on("error",o=>{this.close(tr(o))})}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return q(this.connectionManager.connected,223),this._checkpointSequenceNumber!==void 0}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,r=!1,i){const s={contents:JSON.stringify(t),metadata:i,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};r||this.flush();const o=this.connectionManager.prepareMessageToSend(s);return o===void 0?-1:(this.opsSize+=o.contents.length,this.messageBuffer.push(o),this.emit("submitOp",o),r||this.flush(),o.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){this.messageBuffer.length!==0&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;q(this.connectionManager.connected,568);const r=this.pending.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:(t=r[0])===null||t===void 0?void 0:t.sequenceNumber,haveHandler:this.handler!==void 0,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const r=e.checkpointSequenceNumber;this._checkpointSequenceNumber=r,r!==void 0&&this.updateLatestKnownOpSeqNumber(r),q(this.messageBuffer.length===0,233),this.opsSize=0,this.emit("connect",e,r!==void 0?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),r!==void 0?r>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):e.mode==="read"&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}async attachOpHandler(e,t,r,i,s="none"){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=r,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,q(this.handler===void 0,226),this.handler=i,q(!!this.handler,227),q(this.fetchReason===void 0,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),s!=="none"){const o=s==="cached";await this.fetchMissingDeltasCore(`DocumentOpen_${s}`,o),o&&this.fetchMissingDeltas("PostDocumentOpen")}q(this.fetchReason!==void 0||this.pending.length===0,617)}}connect(e){var t;const r=(t=e.fetchOpsFromStorage)!==null&&t!==void 0?t:!0;G4(this.handler!==void 0||!r,this.logger,"CantFetchWithoutBaseline"),r&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}async getDeltas(e,t,r,i,s){const o=this.serviceProvider();if(o===void 0)throw new Error("Delta manager is not attached");this.deltaStorage===void 0&&(this.deltaStorage=await o.connectToDeltaStorage());let a;if(t!==void 0){const d=t-1;if(this.lastQueuedSequenceNumber>=d){this.logger.sendPerformanceEvent(Object.assign({reason:r,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));return}a=h=>h.sequenceNumber>=d}else a=d=>d.sequenceNumber>=this.lastObservedSeqNumber;const l=new av;let c=!1;const u=d=>{q(d.sequenceNumber===this.lastQueuedSequenceNumber,570),!c&&a(d)&&(l.abort(),this._inbound.off("push",u))};try{this._inbound.on("push",u),q(this.closeAbortController.signal.onabort===null,488),this.closeAbortController.signal.onabort=()=>l.abort();const d=this.deltaStorage.fetchMessages(e,t,l.signal,s,r);for(;;){const h=await d.read();if(h.done)break;try{c=!0,i(h.value)}finally{c=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",u),q(!c,649)}}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),this.throttlingIdSet.size===0&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,r){const i=Date.now();if(this.throttlingIdSet.add(e),t>0&&i+t>this.timeTillThrottling){this.timeTillThrottling=i+t;const s=h0.wrap(r,t/1e3,this.logger);this.emit("throttled",s)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,r=!1){var i,s;if(this.handler===void 0){this.pending=this.pending.concat(e);return}if(q(this.pending.length===0||this.fetchReason!==void 0,489),e.length===0)return;const o=e[0].sequenceNumber,a=e[e.length-1].sequenceNumber;if(a>this.lastQueuedSequenceNumber){let c=o-1;const u=c-this.lastQueuedSequenceNumber;let d,h=0,f=0;for(const g of e)g.sequenceNumber===c?h++:g.sequenceNumber!==c+1&&(f++,d===void 0&&(d=c+1)),c=g.sequenceNumber;let p;h!==0||f!==0&&!r||u>0&&this.fetchReason===void 0?p="enqueueMessages":this.fetchReason!==void 0&&this.fetchReason!==t&&o<=this.lastQueuedSequenceNumber+1&&a>this.lastQueuedSequenceNumber&&(p="enqueueMessagesExtraFetch"),p!==void 0&&this.logger.sendPerformanceEvent(Object.assign({eventName:p,reason:t,previousReason:this.prevEnqueueMessagesReason,from:o,to:a+1,length:e.length,fetchReason:this.fetchReason,duplicate:h>0?h:void 0,initialGap:u!==0?u:void 0,gap:f>0?f:void 0,firstMissing:d,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const l=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;q(l===void 0||l===this.lastQueuedSequenceNumber,236);for(const c of e)if(c.sequenceNumber<=this.lastQueuedSequenceNumber){if(((s=this.previouslyProcessedMessage)===null||s===void 0?void 0:s.sequenceNumber)===c.sequenceNumber){const u=this.comparableMessagePayload(this.previouslyProcessedMessage),d=this.comparableMessagePayload(c);if(u!==d){const h=new Uh("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",En.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:c.sequenceNumber,message1:u,message2:d,driverVersion:void 0});this.close(h)}}}else c.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(c),this.fetchMissingDeltas(t,c.sequenceNumber)):(this.lastQueuedSequenceNumber=c.sequenceNumber,this.previouslyProcessedMessage=c,this._inbound.push(c));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,q(e.clientId!==void 0||!p5(e),237),typeof e.contents=="string"&&e.contents!==""&&e.type!==Nn.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new wr("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},Gs(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new wr("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},Gs(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,q(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),e.term===void 0&&(e.term=1),this.baseTerm=e.term,this.handler===void 0)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const r=Date.now();this.emit("op",e,r-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch(r=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},r)})}async fetchMissingDeltasCore(e,t,r){var i;if(this.fetchReason===void 0){if(this.closed){this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});return}if(this.handler===void 0){q(this.lastQueuedSequenceNumber===0,619);return}try{let s=this.lastQueuedSequenceNumber+1;const o=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;o!==void 0&&(q(o===this.lastQueuedSequenceNumber,242),q(s>1,243),s--);const a=`${e}_fetch`;this.fetchReason=a,await this.getDeltas(s,r,a,l=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(l,a)},t)}catch(s){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},s),this.close(tr(s))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}}}processPendingOps(e){if(this.closed)return;q(this.handler!==void 0,620);const t=this.pending.sort((r,i)=>r.sequenceNumber-i.sequenceNumber);this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),this.fetchReason===void 0&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Kp extends kc{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}async systemPause(){return this.pause()}async pause(){return this.queue.pause()}async systemResume(){return this.resume()}async resume(){this.queue.resume()}async waitTillProcessingDone(){return this.queue.waitTillProcessingDone()}}class E5 extends kc{constructor(e){super(e),this.deltaManager=e,this.inbound=new Kp(e.inbound),this.outbound=new Kp(e.outbound),this.inboundSignal=new Kp(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Jp(n){var e;const t=Xg(n,!0);if(typeof t.pathname!="string")throw new oe("Failed to parse pathname");const r=(e=t.search)!==null&&e!==void 0?e:"",s=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(t.pathname);return(s==null?void 0:s.length)===3?{id:s[1],path:s[2],query:r,version:t.query.version}:void 0}function pR(n){const e={blobs:{},blobsContents:{},trees:{},id:Ze(),unreferenced:n.unreferenced},t=Object.keys(n.tree);for(const r of t){const i=n.tree[r];switch(i.type){case fn.Tree:{e.trees[r]=pR(i);break}case fn.Attachment:e.blobs[r]=i.id;break;case fn.Blob:{const s=Ze();e.blobs[r]=s;const o=typeof i.content=="string"?qB(i.content,"utf8"):O4(i.content);e.blobsContents[s]=o;break}case fn.Handle:throw new oe("No handles should be there in summary in detached container!!");default:zg(i,`Unknown tree type ${i.type}`)}}return e}function T5(n,e){const t={type:fn.Tree,tree:Object.assign({},e.tree)};return t.tree[".protocol"]=n,pR(t)}const Qp=n=>{const e=n.tree[".protocol"],t=n.tree[".app"];return q(e!==void 0&&t!==void 0,480),T5(e,t)};function k_(n){return".protocol"in n.trees?n.trees[".protocol"]:n}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const mR="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function gR(n){return n.headers===void 0?!0:n.headers[je.cache]!==!1}class x5{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}async resolve(e){var t,r,i,s,o;if(e.url.startsWith("/")){if(gR(e))return this.container;{const a=this.container.resolvedUrl;return kr(a),await vr.load(this.loader,{canReconnect:(t=e.headers)===null||t===void 0?void 0:t[je.reconnect],clientDetailsOverride:(r=e.headers)===null||r===void 0?void 0:r[je.clientDetails],resolvedUrl:Object.assign({},a),version:(s=(i=e.headers)===null||i===void 0?void 0:i[je.version])!==null&&s!==void 0?s:void 0,loadMode:(o=e.headers)===null||o===void 0?void 0:o[je.loadMode]})}}if(this.loader===void 0)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)}async request(e){return e.url.startsWith("/")?(await this.resolve(e)).request(e):this.loader===void 0?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)}}function O5(n){const e=Object.create(n),t=new Map;return e.resolve=async r=>gR(r)?(t.has(r.url)||t.set(r.url,n.resolve(r)),t.get(r.url)):n.resolve(r),e}class P5{constructor(e){var t,r;this.containers=new Map;const i=Object.assign({},e.scope);((t=e.options)===null||t===void 0?void 0:t.provideScopeLoader)!==!1&&(i.ILoader=this);const s={loaderId:Ze(),loaderVersion:mR},o=a0(Tl.mixinDebugLogger("fluid:telemetry",e.logger,{all:s}),XO.value,e.configProvider);this.services={urlResolver:O5(A0.create(e.urlResolver)),documentServiceFactory:I0.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:(r=e.options)!==null&&r!==void 0?r:{},scope:i,subLogger:o.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=ka(ue.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}async createDetachedContainer(e){const t=await vr.createDetached(this,e);return this.cachingEnabled&&t.once("attached",()=>{kr(t.resolvedUrl);const r=Jp(t.resolvedUrl.url);r!==void 0&&this.addToContainerCache(r.id,Promise.resolve(t))}),t}async rehydrateDetachedContainerFromSnapshot(e){return vr.rehydrateDetachedFromSnapshot(this,e)}async resolve(e,t){const r=t===void 0?"Resolve":"ResolveWithPendingState";return le.timedExecAsync(this.mc.logger,{eventName:r},async()=>(await this.resolveCore(e,t!==void 0?JSON.parse(t):void 0)).container)}async request(e){return le.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>{const t=await this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))})}getKeyForContainerCache(e,t){var r;return((r=e.headers)===null||r===void 0?void 0:r[je.version])!==void 0?`${t.id}@${e.headers[je.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then(r=>{r.closed?this.containers.delete(e):r.once("closed",()=>{this.containers.delete(e)})}).catch(r=>{})}async resolveCore(e,t){const r=await this.services.urlResolver.resolve(e);kr(r);const i=Jp(r.url);if(i===void 0)throw new Error(`Invalid URL ${r.url}`);if(t!==void 0){const c=Jp(t.url);if((c==null?void 0:c.id)!==i.id||(c==null?void 0:c.path.replace(/\/$/,""))!==i.path.replace(/\/$/,"")){const u=`URL ${r.url} does not match pending state URL ${t.url}`;throw new Error(u)}}const{canCache:s,fromSequenceNumber:o}=this.parseHeader(i,e),a=t!==void 0?!1:s;let l;if(a){const c=this.getKeyForContainerCache(e,i),u=await this.containers.get(c);if(u!==void 0)l=u;else{const d=this.loadContainer(e,r);this.addToContainerCache(c,d),l=await d}}else l=await this.loadContainer(e,r,t);return l.deltaManager.lastSequenceNumber<=o&&await new Promise((c,u)=>{function d(h){h.sequenceNumber>o&&(c(),l.removeListener("op",d))}l.on("op",d)}),{container:l,parsed:i}}get cachingEnabled(){return this.services.options.cache!==!1}canCacheForRequest(e){return this.cachingEnabled&&e[je.cache]!==!1}parseHeader(e,t){var r,i;let s=-1;t.headers=(r=t.headers)!==null&&r!==void 0?r:{};const o=t.headers[je.sequenceNumber];return o!==void 0&&(s=o),t.headers[je.version]=(i=e.version)!==null&&i!==void 0?i:t.headers[je.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:s}}async loadContainer(e,t,r){var i,s,o,a,l;return vr.load(this,{canReconnect:(i=e.headers)===null||i===void 0?void 0:i[je.reconnect],clientDetailsOverride:(s=e.headers)===null||s===void 0?void 0:s[je.clientDetails],resolvedUrl:t,version:(a=(o=e.headers)===null||o===void 0?void 0:o[je.version])!==null&&a!==void 0?a:void 0,loadMode:(l=e.headers)===null||l===void 0?void 0:l[je.loadMode]},r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const R5=45e3;class k5{constructor(e,t,r){var i;this.handler=e,this.logger=t,this._clientId=r,this._connectionState=we.Disconnected,this.prevClientLeftTimer=new Fg((i=this.handler.maxClientLeaveWaitTime)!==null&&i!==void 0?i:3e5,()=>{q(!this.connected,684),this.applyForConnectedState("timeout")}),this.joinOpTimer=new Fg(R5,()=>{var s;if(this.connectionState!==we.CatchingUp)return;const o=this.handler.quorumClients(),a={quorumInitialized:o!==void 0,hasPendingClientId:this.pendingClientId!==void 0,inQuorum:(o==null?void 0:o.getMember((s=this.pendingClientId)!==null&&s!==void 0?s:""))!==void 0,waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",a)})}get connectionState(){return this._connectionState}get connected(){return this.connectionState===we.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){q(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){q(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){q(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=le.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,r;const i=this.handler.quorumClients();q(i!==void 0,566),q(this.waitingForLeaveOp===!1||this.clientId!==void 0&&i.getMember(this.clientId)!==void 0,738),this.pendingClientId!==this.clientId&&this.pendingClientId!==void 0&&i.getMember(this.pendingClientId)!==void 0&&!this.waitingForLeaveOp?((t=this.waitEvent)===null||t===void 0||t.end({source:e}),this.setConnectionState(we.Connected)):this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:e==="timeout"?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:(i==null?void 0:i.getMember((r=this.pendingClientId)!==null&&r!==void 0?r:""))!==void 0})})}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(we.Disconnected,e)}receivedConnectEvent(e,t){const r=this._connectionState;this._connectionState=we.CatchingUp;const i=e==="write";q(i||!this.handler.shouldClientJoinWrite(),778),q(i||!this.waitingForLeaveOp,678);const s=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(we.CatchingUp,r),i&&(s==null?void 0:s.getMember(this._pendingClientId))===void 0?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(we.Connected)}setConnectionState(e,t){if(this.connectionState===e){this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});return}const r=this._connectionState;this._connectionState=e;const i=this.handler.quorumClients();let s;this._clientId!==void 0&&(s=i==null?void 0:i.getMember(this._clientId)),e===we.Connected?(q(r===we.CatchingUp,472),s!==void 0&&(s.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===we.Disconnected&&(this._pendingClientId=void 0,s!==void 0&&this.handler.shouldClientJoinWrite()&&this.prevClientLeftTimer.hasTimer===!1?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:s!==void 0,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,r,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",(t,r)=>{this.receivedAddMemberEvent(t)}),e.quorum.on("removeMember",t=>{this.receivedRemoveMemberEvent(t)}),this.clientId!==void 0&&e.quorum.getMember(this.clientId)!==void 0&&this.prevClientLeftTimer.restart()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class N5{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.runWithRetry(async()=>this.internalStorageService.getSnapshotTree(e,t),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry(async()=>this.internalStorageService.readBlob(e),"storage_readBlob")}async getVersions(e,t,r){return this.runWithRetry(async()=>this.internalStorageService.getVersions(e,t,r),"storage_getVersions")}async uploadSummaryWithContext(e,t){return q(t.referenceSequenceNumber===0==(t.ackHandle===void 0),593),t.referenceSequenceNumber!==0?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry(async()=>this.internalStorageService.uploadSummaryWithContext(e,t),"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry(async()=>this.internalStorageService.downloadSummary(e),"storage_downloadSummary")}async createBlob(e){return this.runWithRetry(async()=>this.internalStorageService.createBlob(e),"storage_createBlob")}checkStorageDisposed(){if(this._disposed)throw new Gr("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return D0(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class L5{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(Xu(e,this.generateProtocolTree()),t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class I5{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,r]of Object.entries(e.blobsContents))this.blobContents[t]=r;for(const[t,r]of Object.entries(e.trees))this.getBlobContents(r)}get policies(){try{return this.storageGetter().policies}catch{}}get repositoryUrl(){return this.storageGetter().repositoryUrl}async getSnapshotTree(e,t){return this.storageGetter().getSnapshotTree(e,t)}async readBlob(e){const t=this.blobContents[e];return t!==void 0?t:this.storageGetter().readBlob(e)}async getVersions(e,t,r){return this.storageGetter().getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.storageGetter().uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storageGetter().downloadSummary(e)}async createBlob(e){return this.storageGetter().createBlob(e)}}class A5{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(e){return this.blobStorage.createBlob(e)}async readBlob(e){return this.blobStorage.readBlob(e)}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class M5 extends kc{constructor(e){super(e),super.setMaxListeners(50),this.propose=Ya(this,e.propose.bind(e)),this.has=Ya(this,e.has.bind(e)),this.get=Ya(this,e.get.bind(e)),this.getMembers=Ya(this,e.getMembers.bind(e)),this.getMember=Ya(this,e.getMember.bind(e))}}function D5(n){const t=new Map(n).get("code");return q(t!==void 0,732),t==null?void 0:t.value}function N_(n){return[["code",{key:"code",value:n,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const F5=2e3,z5=50;class $5{constructor(e,t=F5,r=z5){this.submit=e,this.NoopCountFrequency=r,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new Fg(t,()=>{this.opsCountSinceNoop!==0&&this.submitNoop(!1)}))}scheduleSequenceNumberUpdate(e,t){if(t){this.submitNoop(!0);return}if(oc(e)){if(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency){this.submitNoop(!1);return}this.timer!==void 0&&(this.opsCountSinceNoop===1&&this.timer.restart(),q(this.timer.hasTimer,578))}}submitNoop(e){this.submit(Nn.NoOp,e?"":null),q(this.opsCountSinceNoop===0,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const j5=8e3,q5=1e3,B5=16*1024,L_={fatalConnectError:!0};function U5(n){const e=`Nack (${n.type}): ${n.message}`,t=n.code!==403,r=n.retryAfter!==void 0?n.retryAfter*1e3:void 0;return va(e,{canRetry:t,retryAfterMs:r},{statusCode:n.code,driverVersion:void 0})}class Xp extends kh{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[Ud.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map(t=>({operation:t,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class z0{constructor(e,t,r,i,s){this.serviceProvider=e,this.client=t,this.logger=i,this.props=s,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(o,a)=>{const l=Array.isArray(a)?a:[a];this.props.incomingOpHandler(l,"opHandler")},this.nackHandler=(o,a)=>{const l=a[0];if(this._readonlyPermissions===!0){this.props.closeHandler(n5("writeOnReadOnlyDocument",{driverVersion:void 0}));return}const c=U5(l.content);if(!c.canRetry){this.props.closeHandler(c);return}this.reconnectOnError("write",c)},this.disconnectHandlerInternal=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.errorHandler=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=r?jt.Enabled:jt.Never,this._outbound=new cv(o=>{if(this.connection===void 0)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(o)}),this._outbound.on("error",o=>{this.props.closeHandler(tr(o))})}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return(t=(e=this.connection)===null||e===void 0?void 0:e.mode)!==null&&t!==void 0?t:"read"}get connected(){return this.connection!==void 0}get clientId(){var e;return(e=this.connection)===null||e===void 0?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,r;return(r=(t=(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration)===null||t===void 0?void 0:t.maxMessageSize)!==null&&r!==void 0?r:B5}get version(){if(this.connection===void 0)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration}get scopes(){var e;return(e=this.connection)===null||e===void 0?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return this.connection!==void 0?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return this._forceReadonly?!0:this._readonlyPermissions}get readOnlyInfo(){const e=this.connection!==void 0&&this.connection instanceof Xp;return e||this._forceReadonly||this._readonlyPermissions===!0?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=jt.Never,this._outbound.clear();const t=e!==void 0?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){q(e!==jt.Never&&this._reconnectMode!==jt.Never,632),this._reconnectMode=e,e!==jt.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===jt.Never)throw new ye("API is not supported for non-connecting or closed container");let r=!1;this.readonly===!0&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),r=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),r&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch(t=>{const r=tr(t,{props:L_});this.props.closeHandler(r)})}async connectCore(e){var t,r;if(q(!this.closed,618),this.connection!==void 0)return;let i;this.pendingConnection!==void 0&&(i=this.pendingConnection.connectionMode,this.cancelConnection(),q(this.pendingConnection===void 0,836));let s=(t=e??i)!==null&&t!==void 0?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(s="write");const o=this.serviceProvider();q(o!==void 0,679);let a;if(((r=o.policies)===null||r===void 0?void 0:r.storageOnly)===!0){a=new Xp,this.setupNewSuccessfulConnection(a,"read"),q(this.pendingConnection===void 0,691);return}let l=q5,c=0;const u=Lt.now();let d;const h=new av,f=h.signal;for(this.pendingConnection={abort:()=>{h.abort()},connectionMode:s};a===void 0;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(f.aborted===!0){this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:Ue.formatTick(Lt.now()-u),connectionEstablished:!1});return}c++;try{this.client.mode=s,a=await o.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:s})),a.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),a=void 0)}catch(p){if(typeof p=="object"&&p!==null&&(p==null?void 0:p.errorType)===Bh.errorType){a=new Xp,s="read";break}if(!Fc(p)){const S=tr(p,{props:L_});throw this.props.closeHandler(S),S}iv(this.logger,{attempts:c,delay:l,eventName:"DeltaConnectionFailureToConnect",duration:Ue.formatTick(Lt.now()-u)},p),d=p;const g=qd(p);l=g??Math.min(l*2,j5),g!==void 0&&this.props.reconnectionDelayHandler(g,p),await sv(l)}}if(c>1&&iv(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:c,duration:Ue.formatTick(Lt.now()-u)},d),f.aborted===!0){a.dispose(),this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:Ue.formatTick(Lt.now()-u),connectionEstablished:!0});return}this.setupNewSuccessfulConnection(a,s)}triggerConnect(e){q(this.connection===void 0,569),this.reconnectMode===jt.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,this.connection===void 0)return this.pendingConnection!==void 0?(this.cancelConnection(),!0):!1;q(this.pendingConnection===void 0,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){q(this.pendingConnection!==void 0,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){q(this.connection===void 0,230),q(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const r=!e.claims.scopes.includes(Ud.DocWrite);if(q(t==="read"||r===(this.connectionMode==="read"),231),q(!r||this.connectionMode==="read",232),this.set_readonlyPermissions(r),this.closed){this.disconnectFromDeltaStream("ConnectionManager already closed");return}this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const i=e.initialMessages.sort((l,c)=>l.sequenceNumber-c.sequenceNumber);let s=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},e.relayServiceAgent!==void 0&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let o=-1;if(i.length!==0&&(this._connectionVerboseProps.connectionInitialOpsFrom=i[0].sequenceNumber,o=i[i.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=o+1,(s===void 0||s<o)&&(s=o)),this.props.incomingOpHandler(i,this.connectFirstConnection?"InitialOps":"ReconnectOps"),e.initialSignals!==void 0)for(const l of e.initialSignals)this.props.signalHandler(l);const a=z0.detailsFromConnection(e);a.checkpointSequenceNumber=s,this.props.connectHandler(a),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}async reconnect(e,t,r){if(q(this.connection!==void 0,235),this.disconnectFromDeltaStream(t),r!==void 0&&!r.canRetry&&this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},r),this.reconnectMode===jt.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==jt.Enabled)return;const i=qd(r);r!==void 0&&i!==void 0&&(this.props.reconnectionDelayHandler(i,r),await sv(i)),this.triggerConnect(e)}prepareMessageToSend(e){var t,r;if(this.readonly===!0){q(this.readOnlyInfo.readonly===!0,496);const i=new Gr("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(i);return}return q(!!this.connection,228),this.lastSubmittedClientId!==((t=this.connection)===null||t===void 0?void 0:t.clientId)&&(this.lastSubmittedClientId=(r=this.connection)===null||r===void 0?void 0:r.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===Nn.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber})}submitSignal(e){this.connection!==void 0?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){if(q(this.connected,692),this.connectionMode==="read"){this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then(async()=>{this.pendingReconnect&&await this.reconnect("write","Switch to write")}).catch(()=>{}));return}q(!this.pendingReconnect,693),this._outbound.push(e)}beforeProcessingIncomingOp(e){if(q(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),this.lastSubmittedClientId!==void 0&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;q(this.clientSequenceNumberObserved<t,239),q(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}e.type===Nn.ClientLeave&&JSON.parse(e.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch(i=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},i)}))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const H5=0,I_="dirty",Yp="saved",W5=n=>{var e;return(e=n.get("code"))!==null&&e!==void 0?e:n.get("code2")};async function A_(n,e,t){const r=le.start(n,{eventName:e}),i=await t();r.duration>1e3&&r.end(i)}const M_="summarizer";class vr extends u0{constructor(e,t){var r,i;super((u,d)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:typeof u=="string"?u:void 0},d)}),this.loader=e,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=Z.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=Lt.now(),this._audience=new m5,this.clientDetailsOverride=t.clientDetailsOverride,this._resolvedUrl=t.resolvedUrl,t.canReconnect!==void 0&&(this._canReconnect=t.canReconnect);const s=this.client.details.type,a=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${s!==void 0&&s!==""?`/${s}`:""}`;this.subLogger=ue.create(e.services.subLogger,void 0,{all:{clientType:a,containerId:Ze(),docId:()=>{var u,d;return(d=(u=this._resolvedUrl)===null||u===void 0?void 0:u.id)!==null&&d!==void 0?d:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>we[this.connectionState],serializedContainer:t.serializedContainerState!==void 0},error:{dmInitialSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var u;return(u=this.loadedFromVersion)===null||u===void 0?void 0:u.id},containerLoadedFromVersionDate:()=>{var u;return(u=this.loadedFromVersion)===null||u===void 0?void 0:u.date},dmLastMsqSeqNumber:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.timestamp},dmLastMsqSeqClientId:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.clientId},connectionStateDuration:()=>Lt.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=ka(ue.create(this.subLogger,"Container"));const l=(r=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))!==null&&r!==void 0?r:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:l}),this.connectionStateHandler=new k5({quorumClients:()=>{var u;return(u=this._protocolHandler)===null||u===void 0?void 0:u.quorum},logConnectionStateChangeTelemetry:(u,d,h)=>this.logConnectionStateChangeTelemetry(u,d,h),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(u,d)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:u,duration:Lt.now()-this.connectionTransitionTimes[we.CatchingUp]},d===void 0?{}:{details:JSON.stringify(d)}))},connectionStateChanged:()=>{this._lifecycleState==="loaded"&&this.propagateConnectionState()}},this.mc.logger,(i=t.serializedContainerState)===null||i===void 0?void 0:i.clientId),this.on(Yp,()=>{this.connectionStateHandler.containerSaved()}),this._deltaManager=this.createDeltaManager(),this._storage=new I5(()=>{if(this.attachState!==Z.Attached){if(this.loader.services.detachedBlobStorage!==void 0)return new A5(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService}),typeof document=="object"&&document!==null&&typeof document.addEventListener=="function"&&document.addEventListener!==null&&(this.lastVisible=document.hidden?Lt.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=Lt.now():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",(u,d)=>{Promise.resolve().then(()=>{switch(u){case I_:this._dirtyContainer&&d();break;case Yp:this._dirtyContainer||d();break;case aP:this.connected&&d(this.clientId);break;case lP:this.connected||d();break}}).catch(h=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},h)})})}static async load(e,t,r){const i=new vr(e,{clientDetailsOverride:t.clientDetailsOverride,resolvedUrl:t.resolvedUrl,canReconnect:t.canReconnect,serializedContainerState:r});return le.timedExecAsync(i.mc.logger,{eventName:"Load"},async s=>new Promise((o,a)=>{var l,c;const u=t.version,d={opsBeforeReturn:"cached"},h=r?Object.assign(Object.assign({},(l=t.loadMode)!==null&&l!==void 0?l:d),{opsBeforeReturn:void 0}):(c=t.loadMode)!==null&&c!==void 0?c:d,f=p=>{a(p??new Gr("Container closed without error during load"))};i.on("closed",f),i.load(u,h,r).finally(()=>{i.removeListener("closed",f)}).then(p=>{s.end(Object.assign(Object.assign({},p),t.loadMode)),o(i)},p=>{const g=tr(p);i.close(g),f(g)})}),{start:!0,end:!0,cancel:"generic"})}static async createDetached(e,t){const r=new vr(e,{});return le.timedExecAsync(r.mc.logger,{eventName:"CreateDetached"},async i=>(await r.createDetached(t),r),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(e,t){const r=new vr(e,{});return le.timedExecAsync(r.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},async i=>{const s=JSON.parse(t);return await r.rehydrateDetachedFromSnapshot(s),r},{start:!0,end:!0,cancel:"generic"})}setLoaded(){this._lifecycleState==="loading"&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return this._lifecycleState==="closing"||this._lifecycleState==="closed"}get storage(){return this._storage}get storageService(){if(this._storageService===void 0)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(this._context===void 0)throw new Gr("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(this._protocolHandler===void 0)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(e){this._deltaManager.connectionManager.forceReadonly(e)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var e;return(e=this._context)===null||e===void 0?void 0:e.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(e){this._deltaManager.close(e),q(this.connectionState===we.Disconnected,207),q(this._lifecycleState==="closed",788)}closeCore(e){var t,r,i,s;q(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:e===void 0?"generic":"error"},e),this._lifecycleState="closing",(t=this._protocolHandler)===null||t===void 0||t.close(),this.connectionStateHandler.dispose(),(r=this._context)===null||r===void 0||r.dispose(e!==void 0?new Error(e.message):void 0),(i=this._storageService)===null||i===void 0||i.dispose(),(s=this.service)===null||s===void 0||s.dispose(e)}catch(o){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},o)}this.emit("closed",e),this.removeAllListeners(),this.visibilityEventHandler!==void 0&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){q(this.attachState===Z.Attached,209),q(this.resolvedUrl!==void 0&&this.resolvedUrl.type==="fluid",210),q(!!this._protocolHandler,739),q(this._protocolHandler.attributes.term!==void 0,779);const e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}get attachState(){return this._attachState}serialize(){q(this.attachState===Z.Detached,211);const e=this.context.createSummary(),t=this.captureProtocolSummary(),r=Xu(e,t);return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(r.tree[".hasAttachmentBlobs"]={type:fn.Blob,content:"true"}),JSON.stringify(r)}async attach(e){await le.timedExecAsync(this.mc.logger,{eventName:"Attach"},async()=>{if(this._lifecycleState!=="loaded")throw new ye(`The Container is not in a valid state for attach [${this._lifecycleState}]`);q(this._attachState===Z.Detached&&!this.attachStarted,517),this.attachStarted=!0;const t=this.loader.services.detachedBlobStorage!==void 0&&this.loader.services.detachedBlobStorage.size>0;try{q(this.deltaManager.inbound.length===0,214);let r;if(!t){const o=this.context.createSummary(),a=this.captureProtocolSummary();r=Xu(o,a),this._attachState=Z.Attaching,this.context.notifyAttaching(Qp(r))}const i=await this.urlResolver.resolve(e);kr(i),this.service===void 0&&(q(this.client.details.type!==M_,708),this.service=await D0(async()=>this.serviceFactory.createContainer(r,i,this.subLogger,!1),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));const s=this.service.resolvedUrl;if(kr(s),this._resolvedUrl=s,await this.connectStorageService(),t){q(!!this.loader.services.detachedBlobStorage,590);const o=new Map;for(;o.size<this.loader.services.detachedBlobStorage.size;){const c=this.loader.services.detachedBlobStorage.getBlobIds().filter(u=>!o.has(u));for(const u of c){const d=await this.loader.services.detachedBlobStorage.readBlob(u),h=await this.storageService.createBlob(d);o.set(u,h.id)}}const a=this.context.createSummary(o),l=this.captureProtocolSummary();r=Xu(a,l),this._attachState=Z.Attaching,this.context.notifyAttaching(Qp(r)),await this.storageService.uploadSummaryWithContext(r,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=Z.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(r){const i=tr(r),s=this.resolvedUrl;throw L0(s)&&i.addTelemetryProperties({resolvedUrl:s.url}),this.close(i),i}},{start:!0,end:!0,cancel:"generic"})}async request(e){return le.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>this.context.request(e),{end:!0,cancel:"error"})}setAutoReconnectInternal(e){if(this._deltaManager.connectionManager.reconnectMode===e)return;const r=Lt.now(),i=r-this.setAutoReconnectTime;this.setAutoReconnectTime=r,this.mc.logger.sendTelemetryEvent({eventName:e===jt.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:we[this.connectionState],duration:i}),this._deltaManager.connectionManager.setAutoReconnect(e)}connect(){if(this.closed)throw new ye("The Container is closed and cannot be connected");if(this._attachState!==Z.Attached)throw new ye("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(e){q(!this.closed,709),q(this._attachState===Z.Attached,710),this.resumeInternal(e);const t=jt.Enabled;this.setAutoReconnectInternal(t)}disconnect(){if(this.closed)throw new ye("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){q(!this.closed,711);const e=jt.Disabled;this.setAutoReconnectInternal(e)}resumeInternal(e){q(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}async getAbsoluteUrl(e){var t;if(this.resolvedUrl!==void 0)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,e,v5((t=this._context)===null||t===void 0?void 0:t.codeDetails))}async proposeCodeDetails(e){if(!zw(e))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const t=await this.codeLoader.IFluidCodeDetailsComparer.compare(e,this.getCodeDetailsFromQuorum());if(t!==void 0&&t<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",e).then(()=>!0).catch(()=>!1)}async processCodeProposal(){const e=this.getCodeDetailsFromQuorum();if(await Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),await this.context.satisfies(e)===!0){this.deltaManager.inbound.resume(),this.deltaManager.inboundSignal.resume();return}this.close(new Gr("Existing context does not satisfy incoming proposal"))}async getVersion(e){return(await this.storageService.getVersions(e,1))[0]}recordConnectStartTime(){this.connectionTransitionTimes[we.Disconnected]===void 0&&(this.connectionTransitionTimes[we.Disconnected]=Lt.now())}connectToDeltaStream(e){this.recordConnectStartTime(),(!this._canReconnect||!this.client.details.capabilities.interactive)&&(e.mode="write"),this._deltaManager.connect(e)}async load(e,t,r){if(this._resolvedUrl===void 0)throw new Error("Attempting to load without a resolved url");this.service=await this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===M_);const i={reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1};t.deltaConnection===void 0&&this.connectToDeltaStream(i),r?this.connectStorageService().catch(u=>this.close(u)):await this.connectStorageService(),this._attachState=Z.Attached;const{snapshot:s,versionId:o}=r===void 0?await this.fetchSnapshotTree(e):{snapshot:void 0,versionId:void 0};q(s!==void 0||r!==void 0,567);const a=r===void 0?await this.getDocumentAttributes(this.storageService,s):{sequenceNumber:r.protocol.sequenceNumber,minimumSequenceNumber:r.protocol.minimumSequenceNumber,term:r.term};let l;switch(t.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(a,t.deltaConnection!=="none"?"all":"none");break;case"cached":l=this.attachDeltaManagerOpHandler(a,"cached");break;case"all":l=this.attachDeltaManagerOpHandler(a,"all");break;default:zg(t.opsBeforeReturn)}this._protocolHandler=r===void 0?await this.initializeProtocolStateFromSnapshot(a,this.storageService,s):await this.initializeProtocolState(a,r.protocol.members,r.protocol.proposals,r.protocol.values);const c=this.getCodeDetailsFromQuorum();if(await this.instantiateContext(!0,c,s,r==null?void 0:r.pendingRuntimeState),!this.closed)switch(l!==void 0&&(this._deltaManager.inbound.resume(),await A_(this.mc.logger,"WaitOps",async()=>(await l,{})),await A_(this.mc.logger,"WaitOpProcessing",async()=>this._deltaManager.inbound.waitTillProcessingDone()),this._deltaManager.inbound.pause()),t.deltaConnection){case void 0:case"delayed":q(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:zg(t.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:a.sequenceNumber,version:o,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(e){const t={sequenceNumber:H5,term:1,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(t);const r=N_(e);this._protocolHandler=await this.initializeProtocolState(t,[],[],r),await this.instantiateContextDetached(!1),this.setLoaded()}async rehydrateDetachedFromSnapshot(e){e.tree[".hasAttachmentBlobs"]!==void 0&&(q(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete e.tree[".hasAttachmentBlobs"]);const t=Qp(e);this._storage.loadSnapshotForRehydratingContainer(t);const r=await this.getDocumentAttributes(this._storage,t);await this.attachDeltaManagerOpHandler(r);const i=k_(t),s=await at(this._storage,i.blobs.quorumValues),o=D5(s);this._protocolHandler=await this.initializeProtocolState(r,[],[],o!==void 0?N_(o):[]),await this.instantiateContextDetached(!0,t),this.setLoaded()}async connectStorageService(){var e,t;if(this._storageService!==void 0)return;q(this.service!==void 0,495);const r=await this.service.connectToStorage();this._storageService=new N5(r,this.mc.logger),this.options.summarizeProtocolTree===!0&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new L5(this._storageService,()=>this.captureProtocolSummary())),q(((e=r.policies)===null||e===void 0?void 0:e.minBlobSize)===((t=this.storageService.policies)===null||t===void 0?void 0:t.minBlobSize),224)}async getDocumentAttributes(e,t){if(t===void 0)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const r=".protocol"in t.trees?t.trees[".protocol"].blobs.attributes:t.blobs[".attributes"],i=await at(e,r);return i.term===void 0&&(i.term=1),i}async initializeProtocolStateFromSnapshot(e,t,r){let i=[],s=[],o=[];if(r!==void 0){const l=k_(r);[i,s,o]=await Promise.all([at(t,l.blobs.quorumMembers),at(t,l.blobs.quorumProposals),at(t,l.blobs.quorumValues)])}return await this.initializeProtocolState(e,i,s,o)}async initializeProtocolState(e,t,r,i){const s=new aH(e.minimumSequenceNumber,e.sequenceNumber,e.term,t,r,i,(a,l)=>this.submitMessage(Nn.Propose,{key:a,value:l})),o=ue.create(this.subLogger,"ProtocolHandler");return s.quorum.on("error",a=>{o.sendErrorEvent(a)}),this.connectionStateHandler.initProtocol(s),s.quorum.on("addProposal",a=>{(a.key==="code"||a.key==="code2")&&this.emit("codeDetailsProposed",a.value,a)}),s.quorum.on("approveProposal",(a,l,c)=>{(l==="code"||l==="code2")&&(zw(c)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch(u=>{throw this.close(tr(u)),u}))}),s}captureProtocolSummary(){const e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:fn.Blob},quorumMembers:{content:JSON.stringify(e.members),type:fn.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:fn.Blob},quorumValues:{content:JSON.stringify(e.values),type:fn.Blob}},type:fn.Tree}}getCodeDetailsFromQuorum(){const e=this.protocolHandler.quorum;return W5(e)}get client(){var e;const t=((e=this.options)===null||e===void 0?void 0:e.client)!==void 0?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return this.clientDetailsOverride!==void 0&&xB(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment,` loaderVersion:${mR}`].join(";"),t}activeConnection(){return this.connectionState===we.Connected&&this.connectionMode==="write"}createDeltaManager(){const e=()=>this.service,t=new _5(e,ue.create(this.subLogger,"DeltaManager"),()=>this.activeConnection(),r=>new z0(e,this.client,this._canReconnect,ue.create(this.subLogger,"ConnectionManager"),r));return t.inbound.pause(),t.inboundSignal.pause(),t.on("connect",(r,i)=>{var s;this._audience.clear();for(const o of(s=r.initialClients)!==null&&s!==void 0?s:[])this._audience.addMember(o.clientId,o.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,r)}),t.on("disconnect",r=>{var i;(i=this.collabWindowTracker)===null||i===void 0||i.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(r)}),t.on("throttled",r=>{const i=r;i.logged!==!0&&this.logContainerError(i),this.emit("warning",i)}),t.on("readonly",r=>{this.emit("readonly",r)}),t.on("closed",r=>{this.closeCore(r)}),t}async attachDeltaManagerOpHandler(e,t){var r;return this._deltaManager.attachOpHandler(e.minimumSequenceNumber,e.sequenceNumber,(r=e.term)!==null&&r!==void 0?r:1,{process:i=>this.processRemoteMessage(i),processSignal:i=>{this.processSignal(i)}},t)}logConnectionStateChangeTelemetry(e,t,r){var i;const s=Lt.now();this.connectionTransitionTimes[e]=s;const o=s-this.connectionTransitionTimes[t];let a,l,c,u,d;e===we.Disconnected?c=this._deltaManager.connectionManager.reconnectMode:(e===we.Connected?(a=s-this.connectionTransitionTimes[we.Disconnected],a=Ue.formatTick(a)):(u=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(d=u-this.deltaManager.lastSequenceNumber)),this.firstConnection?l="InitialConnect":l="AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${we[e]}`,from:we[t],duration:o,durationFromDisconnected:a,reason:r,connectionInitiationReason:l,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:c,opsBehind:d,online:Bi[M0()],lastVisible:this.lastVisible!==void 0?Lt.now()-this.lastVisible:void 0,checkpointSequenceNumber:u,quorumSize:(i=this._protocolHandler)===null||i===void 0?void 0:i.quorum.getMembers().size},this._deltaManager.connectionProps)),e===we.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var e;const t=this.connectionState===we.Connected&&!this.firstConnection&&this.connectionMode==="write";t&&(this.messageCountAfterDisconnection=0);const r=this.connectionState===we.Connected;((e=this._context)===null||e===void 0?void 0:e.disposed)===!1&&this.context.setConnectionState(r,this.clientId),this.protocolHandler.setConnectionState(r,this.clientId),d0(this.mc.logger,this,r,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(e,t,r,i){switch(e){case Nn.Operation:case Nn.RemoteHelp:break;case Nn.Summarize:{const o=t;o.details===void 0&&(o.details={}),o.details.includesProtocolTree=this.options.summarizeProtocolTree===!0;break}default:return this.close(new Gr("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,r,i)}submitMessage(e,t,r,i){var s;return this.connectionState!==we.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,(s=this.collabWindowTracker)===null||s===void 0||s.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,r,i))}processRemoteMessage(e){const t=this.clientId===e.clientId;let r={immediateNoOp:!1};try{r=this.protocolHandler.processMessage(e,t)}catch(i){this.close(Lh(i,s=>new wr(s,Gs(e))))}return ac(e)&&!oc(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),(oc(e)||ac(e))&&this.context.process(e,t,void 0),this.activeConnection()&&(this.collabWindowTracker===void 0&&(q(this.serviceConfiguration!==void 0,740),this.collabWindowTracker=new $5((i,s)=>{q(this.activeConnection(),577),this.submitMessage(i,s)},this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,r.immediateNoOp===!0)),this.emit("op",e),r}submitSignal(e){this._deltaManager.submitSignal(JSON.stringify(e))}processSignal(e){if(e.clientId===null){const t=e.content;if(t.type===Nn.ClientJoin){const r=t.content;this._audience.addMember(r.clientId,r.client)}else if(t.type===Nn.ClientLeave){const r=t.content;this._audience.removeMember(r)}}else{const t=this.clientId===e.clientId;this.context.processSignal(e,t)}}async fetchSnapshotTree(e){var t;const r=await this.getVersion(e??null);r===void 0&&e!==void 0&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:e}),this._loadedFromVersion=r;const i=(t=await this.storageService.getSnapshotTree(r))!==null&&t!==void 0?t:void 0;return i===void 0&&r!==void 0&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:r.id}),{snapshot:i,versionId:r==null?void 0:r.id}}async instantiateContextDetached(e,t){const r=this.getCodeDetailsFromQuorum();if(r===void 0)throw new Error("pkg should be provided in create flow!!");await this.instantiateContext(e,r,t)}async instantiateContext(e,t,r,i){var s;q(((s=this._context)===null||s===void 0?void 0:s.disposed)!==!1,221);const o=new x5(this,this.loader);this._context=await F0.createOrLoad(this,this.scope,this.codeLoader,t,r,new E5(this._deltaManager),new M5(this.protocolHandler.quorum),o,(a,l,c,u)=>this.submitContainerMessage(a,l,c,u),a=>this.submitSignal(a),a=>this.close(a),vr.version,a=>this.updateDirtyContainerState(a),e,i),this.emit("contextChanged",t)}updateDirtyContainerState(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?I_:Yp))}logContainerError(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}vr.version="^0.1.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let vR=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class uv extends vR{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=r=>this.emit("disposed",r),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(){throw new Error("Cannot attach container. Container is not in detached state")}async connect(){var e,t;(t=(e=this.container).connect)===null||t===void 0||t.call(e)}async disconnect(){var e,t;(t=(e=this.container).disconnect)===null||t===void 0||t.call(e)}async create(e){return this.rootDataObject.create(e)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Hd;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Hd||(Hd={}));var D_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(D_||(D_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function zc(n,e){if(n==="")return e===void 0?"":e.absolutePath;{let t=n.startsWith("/")?n.slice(1):n;return t=t.endsWith("/")?t.slice(0,-1):t,e===void 0?`/${t}`:`${e.absolutePath==="/"?"":e.absolutePath}/${t}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ee(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function yR(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const V5=(n,e)=>$0.from(n).toString(e);function F_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let $0=class gs extends Uint8Array{toString(e){return yR(this,e)}static from(e,t,r){if(typeof e=="string")return gs.fromString(e,t);if(e!==null&&typeof e=="object"&&F_(e.buffer))return Ee(e.byteOffset===0,0),Ee(e.byteLength===e.buffer.byteLength,1),gs.fromArrayBuffer(e.buffer,t,r);if(F_(e))return gs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new gs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new gs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new gs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const G5=n=>$0.from(n,"base64").toString("utf-8");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let K5=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function SR(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Wd(n){if(n!==null&&typeof n=="object"&&n.errorFromRequestFluidObject===!0){const r=n;return{mimeType:"text/plain",status:r.code,value:r.message,get stack(){return r.stack}}}const t=Nh();return{mimeType:"text/plain",status:500,value:`${n}`,get stack(){var r;return(r=n==null?void 0:n.stack)!==null&&r!==void 0?r:t.stack}}}function Wh(n,e){const t=n.value,r=Nh();return{errorFromRequestFluidObject:!0,message:t,name:"Error",code:n.status,get stack(){var s;return(s=n.stack)!==null&&s!==void 0?s:r.stack}}}async function lc(n,e){const t=typeof e=="string"?{url:e}:e,r=await n.request(t);if(r.status!==200||r.mimeType!=="fluid/object")throw Wh(r);return Ee(r.value,410),r.value}const An=n=>Vd(404,"not found",n);function Vd(n,e,t){var r;Ee(n!==200,411);const i=(r=t.url)===null||r===void 0?void 0:r.split("?")[0],s=Nh();return{mimeType:"text/plain",status:n,value:i===void 0?e:`${e}: ${i}`,get stack(){return s.stack}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class J5{constructor(e,t){this.storage=e,this.path=t,Ee(!t.endsWith("/"),412)}async readBlob(e){return this.storage.readBlob(`${this.path}/${e}`)}async contains(e){return this.storage.contains(`${this.path}/${e}`)}async list(e){return this.storage.list(`${this.path}/${e}`)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Q5(n){let e=n;return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e.length>0?e.split("/"):[]}class Cr{constructor(e){this.request=e;const t=this.request.url.indexOf("?");t>=0?this.query=this.request.url.substring(t):this.query=""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((r,i)=>(i!==void 0&&i.length>0&&r.push(decodeURIComponent(i)),r),[])}static create(e){return e instanceof Cr?e:new Cr(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return this.requestPathParts===void 0&&(this.requestPathParts=Cr.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return this.query===""&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const r=`/${this.pathParts.slice(e).join("/")}`;return{url:this.query===""?r:`${r}/${this.query}`,headers:this.headers}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class X5{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const r=t===void 0?e.existing===!0:t,i=await this.preInitialize(e,r);return r?await this.instantiateFromExisting(i):await this.instantiateFirstTime(i),await this.hasInitialized(i),i}async instantiateFirstTime(e){}async instantiateFromExisting(e){}async hasInitialized(e){}}var te={},Vh={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Vh,"__esModule",{value:!0});Vh.IFluidDataStoreFactory=void 0;Vh.IFluidDataStoreFactory="IFluidDataStoreFactory";var Gh={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Gh,"__esModule",{value:!0});Gh.IFluidDataStoreRegistry=void 0;Gh.IFluidDataStoreRegistry="IFluidDataStoreRegistry";var bR={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.VisibilityState=n.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(n.FlushMode||(n.FlushMode={})),n.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}})(bR);var Kh={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Kh,"__esModule",{value:!0});Kh.gcBlobKey=void 0;Kh.gcBlobKey="gc";var wR={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(wR,"__esModule",{value:!0});var CR={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.totalBlobSizePropertyName=n.blobCountPropertyName=n.channelsTreeName=n.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(n.CreateSummarizerNodeSource||(n.CreateSummarizerNodeSource={})),n.channelsTreeName=".channels",n.blobCountPropertyName="BlobCount",n.totalBlobSizePropertyName="TotalBlobSize"})(CR);(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Vh,n),t(Gh,n),t(bR,n),t(Kh,n),t(wR,n),t(CR,n)})(te);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var z_;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(z_||(z_={}));var Nl;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Nl||(Nl={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var et;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(et||(et={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Zi(...n){const e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const t of n)e.treeNodeCount+=t.treeNodeCount,e.blobNodeCount+=t.blobNodeCount,e.handleNodeCount+=t.handleNodeCount,e.totalBlobSize+=t.totalBlobSize,e.unreferencedBlobSize+=t.unreferencedBlobSize;return e}function Y5(n){let e=n.length;for(let t=n.length-1;t>=0;t--){const r=n.charCodeAt(t);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&t--}return e}function _R(n){return typeof n=="string"?Y5(n):n.byteLength}function ER(n,e){switch(n.type){case et.Tree:{e.treeNodeCount++;for(const t of Object.values(n.tree))ER(t,e);return}case et.Handle:{e.handleNodeCount++;return}case et.Blob:{e.blobNodeCount++,e.totalBlobSize+=_R(n.content);return}default:return}}function TR(n){const e=Zi();return ER(n,e),e}function yr(n,e,t){const r={type:et.Blob,content:t};n.summary.tree[e]=r,n.stats.blobNodeCount++,n.stats.totalBlobSize+=_R(t)}function Z5(n,e,t){n.summary.tree[e]=t.summary,n.stats=Zi(n.stats,t.stats)}function eG(n,e,t){n.summary.tree[e]=t.summary,n.stats=Zi(n.stats,t.stats)}class Kt{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=Zi(),this.summaryStats.treeNodeCount++}get summary(){return{type:et.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){yr({summary:{type:et.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,r){this.summaryTree[e]={type:et.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=Zi(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:et.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function tG(n,e=!1){const t=new Kt;for(const i of n.entries)switch(i.type){case Nl.Blob:{const s=i.value;let o;s.encoding==="base64"?o=$0.from(s.contents,"base64"):o=s.contents,t.addBlob(i.path,o);break}case Nl.Tree:{const s=j0(i.value,e);t.addWithStats(i.path,s);break}case Nl.Attachment:{const s=i.value.id;t.addAttachment(s);break}default:throw new Error("Unexpected TreeEntry type")}const r=t.getSummaryTree();return r.summary.unreferenced=n.unreferenced,r}function j0(n,e=!1){if(n.id&&!e){const t=Zi();return t.handleNodeCount++,{summary:{handle:n.id,handleType:et.Tree,type:et.Handle},stats:t}}else return tG(n,e)}function q0(n){const e=new Kt;for(const[r,i]of Object.entries(n.blobs)){let s;if(n.blobsContents!==void 0){const o=n.blobsContents[i];o!==void 0&&(s=V5(o,"utf-8"))}else n.blobs[i]!==void 0&&(s=G5(n.blobs[i]));s!==void 0&&e.addBlob(r,s)}for(const[r,i]of Object.entries(n.trees)){const s=q0(i);e.addWithStats(r,s)}const t=e.getSummaryTree();return t.summary.unreferenced=n.unreferenced,t}function B0(n){const e=[];for(const[t,r]of Object.entries(n.tree))switch(r.type){case et.Blob:{let i,s="utf-8";typeof r.content=="string"?i=r.content:(i=yR(r.content,"base64"),s="base64"),e.push(new fP(t,i,s));break}case et.Tree:{e.push(new tH(t,B0(r)));break}case et.Attachment:{e.push(new nH(t,r.id));break}case et.Handle:throw new Error("Should not have Handle type in summary tree");default:SR(r,"Unexpected summary tree type")}return{entries:e,unreferenced:n.unreferenced}}class nG{constructor(){this.telemetry=new Map}set(e,t,r){this.telemetry.set(`${e}${t}`,r)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach((t,r)=>{e[r]=t}),JSON.stringify(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Ll="_baseSummary",xR="_outstandingOps",$_=100;class It{constructor(e){this.path=e}static create(e){return new It(encodeURIComponent(e))}static createAndConcat(e){var t;let r=It.create((t=e[0])!==null&&t!==void 0?t:"");for(let i=1;i<e.length;i++)r=r.concat(It.create(e[i]));return r}toString(){return this.path}concat(e){return new It(`${this.path}/${e.path}`)}}class Ui{constructor(e){this.summary=e}static createForRoot(e){return new Ui({referenceSequenceNumber:e,basePath:void 0,localPath:It.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return(t=(e=this.basePath)===null||e===void 0?void 0:e.concat(this.localPath))!==null&&t!==void 0?t:this.localPath}get fullPathForChildren(){return this.additionalPath!==void 0?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new Ui({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:It.create(e)})}}function j_(n,e){let t=n;const r=[],i=[];for(let s=0;;s++){s>$_&&e.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:$_});const o=t.blobs[xR],a=t.trees[Ll];if(o===void 0&&a===void 0)return{baseSummary:t,pathParts:r,async getOutstandingOps(l){let c=[];for(const u of i){const d=await l(u);if(c.length>0&&d.length>0){const h=c[c.length-1].sequenceNumber,f=d[0].sequenceNumber;if(f<=h)for(e.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${f} <= ${h}`});d.length>0&&d[0].sequenceNumber<=h;)d.shift()}c=c.concat(d)}return c}};Ee(!!o,431),Ee(a!==void 0,432),t=a,r.push(Ll),i.unshift(o)}}function rG(n,e){let t=It.create(Ll);const r=new Kt;if(r.addBlob(xR,JSON.stringify(e)),n.fromSummary){const s=n.summaryNode;s.additionalPath!==void 0&&(t=t.concat(s.additionalPath)),r.addHandle(Ll,et.Tree,s.fullPath.path)}else r.addWithStats(Ll,n.initialSummary);const i=r.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:t})}function Zp(n){const e=n.trees[te.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:te.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}function iG(n){const e=n.tree[te.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:te.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class U0{constructor(e,t,r,i,s,o,a){var l;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=i,this._latestSummary=s,this.initialSummary=o,this.wipSummaryLogger=a,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=(l=r.canReuseHandle)!==null&&l!==void 0?l:!0,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return(t=(e=this._latestSummary)===null||e===void 0?void 0:e.referenceSequenceNumber)!==null&&t!==void 0?t:0}startSummary(e,t){Ee(this.wipSummaryLogger===void 0,415),Ee(this.wipReferenceSequenceNumber===void 0,416),this.wipSummaryLogger=t;for(const r of this.children.values())r.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}async summarize(e,t=!0,r){if(Ee(this.isTrackingInProgress(),417),Ee(this.wipSummaryLogger!==void 0,418),this.canReuseHandle&&!e&&!this.hasChanged()){const i=this._latestSummary;if(i!==void 0){this.wipLocalPaths={localPath:i.localPath,additionalPath:i.additionalPath},this.wipSkipRecursion=!0;const s=Zi();return s.handleNodeCount++,{summary:{type:et.Handle,handle:i.fullPath.path,handleType:et.Tree},stats:s}}}try{const i=await this.summarizeInternalFn(e,!0,r);return this.wipLocalPaths={localPath:It.create(i.id)},i.pathPartsForChildren!==void 0&&(this.wipLocalPaths.additionalPath=It.createAndConcat(i.pathPartsForChildren)),{summary:i.summary,stats:i.stats}}catch(i){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw i;const s=this._latestSummary,o=this.initialSummary;let a,l;if(s!==void 0)a={fromSummary:!0,summaryNode:s},l=s.localPath;else if((o==null?void 0:o.summary)!==void 0)a={fromSummary:!1,initialSummary:o.summary},l=It.create(o.id);else throw i;this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},i);const c=rG(a,this.outstandingOps);return this.wipLocalPaths={localPath:l,additionalPath:c.additionalPath},this.wipSkipRecursion=!0,{summary:c.summary,stats:c.stats}}}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,r){Ee(this.wipSummaryLogger!==void 0,419),Ee(this.wipReferenceSequenceNumber!==void 0,420);let i=this.wipLocalPaths;if(r){const a=this._latestSummary;if(a!==void 0)i={localPath:a.localPath,additionalPath:a.additionalPath};else{this.clearSummary();return}}Ee(!!i,421);const s=new Ui(Object.assign(Object.assign({},i),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),o=s.fullPathForChildren;for(const a of this.children.values())a.completeSummaryCore(e,o,this.wipSkipRecursion||r);this.pendingSummaries.set(e,s),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}async refreshLatestSummary(e,t,r,i,s){if(e!==void 0){const a=this.pendingSummaries.get(e);if(a!==void 0)return this.refreshLatestSummaryFromPending(e,a.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const o=await r();return await this.refreshLatestSummaryFromSnapshot(t,o,void 0,It.create(""),s,i),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:o}}refreshLatestSummaryFromPending(e,t){const r=this.pendingSummaries.get(e);if(r===void 0){Ee(this._latestSummary===void 0,422);return}else Ee(t===r.referenceSequenceNumber,423),this.pendingSummaries.delete(e);this.refreshLatestSummaryCore(t),this._latestSummary=r;for(const i of this.children.values())i.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);const{baseSummary:a,pathParts:l}=j_(t,s);this._latestSummary=new Ui({referenceSequenceNumber:e,basePath:r,localPath:i});const{childrenTree:c,childrenPathPart:u}=Zp(a);u!==void 0&&l.push(u),l.length>0&&(this._latestSummary.additionalPath=It.createAndConcat(l));const d=this._latestSummary.fullPathForChildren;await Promise.all(Array.from(this.children).filter(([h])=>c.trees[h]!==void 0).map(async([h,f])=>f.refreshLatestSummaryFromSnapshot(e,c.trees[h],d,It.create(h),s,o)))}refreshLatestSummaryCore(e){for(const[t,r]of this.pendingSummaries)r.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=Zp(e);t!==void 0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=It.create(t))}async loadBaseSummary(e,t){const r=j_(e,this.defaultLogger),i=await r.getOutstandingOps(t),{childrenPathPart:s}=Zp(r.baseSummary);if(s!==void 0&&r.pathParts.push(s),r.pathParts.length>0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=It.createAndConcat(r.pathParts)),i.length>0){const o=i[i.length-1].sequenceNumber;Ee(o<=this.trackingSequenceNumber,425)}return{baseSummary:r.baseSummary,outstandingOps:i}}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];t!==void 0&&Ee(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,r,i={}){Ee(!this.children.has(t),427);const s=this.getCreateDetailsForChild(t,r),o=new U0(this.defaultLogger,e,i,s.changeSequenceNumber,s.latestSummary,s.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(o),this.children.set(t,o),o}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var r;let i,s,o;const a=this._latestSummary;switch(t.type){case te.CreateSummarizerNodeSource.FromAttach:{if(a!==void 0&&t.sequenceNumber<=a.referenceSequenceNumber)s=a.createForChild(e);else{const l=j0(t.snapshot);i={sequenceNumber:t.sequenceNumber,id:e,summary:l}}o=t.sequenceNumber;break}case te.CreateSummarizerNodeSource.FromSummary:this.initialSummary===void 0&&Ee(!!a,428);case te.CreateSummarizerNodeSource.Local:{const l=this.initialSummary;if(l!==void 0){let c;if(l.summary!==void 0){const{childrenTree:d}=iG(l.summary.summary);Ee(d.type===et.Tree,470),c=d.tree[e]}t.type===te.CreateSummarizerNodeSource.FromSummary&&Ee(!!c,429);let u;c!==void 0&&(Ee(c.type===et.Tree,430),u={summary:c,stats:TR(c)}),i={sequenceNumber:l.sequenceNumber,id:e,summary:u}}s=a==null?void 0:a.createForChild(e),o=(r=a==null?void 0:a.referenceSequenceNumber)!==null&&r!==void 0?r:-1;break}default:{const l=t.type;SR(t,`Unexpected CreateSummarizerNodeSource: ${l}`)}}return{initialSummary:i,latestSummary:s,changeSequenceNumber:o}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),e._latestSummary!==void 0)for(const[t,r]of this.pendingSummaries.entries()){const i=new Ui({referenceSequenceNumber:r.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,i)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return this.wipReferenceSequenceNumber!==void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function em(n,e){const t=new Set,r=[...e];for(const o of r){if(t.has(o))continue;t.add(o);const a=n[o];a!==void 0&&r.push(...a)}const i=[],s=[];for(const o of Object.keys(n))t.has(o)?i.push(o):s.push(o);return{referencedNodeIds:i,deletedNodeIds:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function zo(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function sG(n){return n.replace(/^\/+|\/+$/g,"")}function oG(n){return n.replace(/^\/+/g,"")}function aG(n){return n.replace(/\/+$/g,"")}function Il(n){const e={};for(const[t,r]of Object.entries(n.gcNodes))e[t]=Array.from(r);return{gcNodes:e}}function OR(n){const e=new Map;if(n.gcData===void 0)return e;const t=n.gcData.gcNodes;delete t["/"];for(const[i,s]of Object.entries(t)){zo(i.startsWith("/"),686);const o=i.split("/")[1];let a=i.slice(o.length+1);a===""&&(a="/");let l=e.get(o);l===void 0&&(l={gcData:{gcNodes:{}},usedRoutes:[]}),zo(l.gcData!==void 0,687),l.gcData.gcNodes[a]=[...new Set(s)],e.set(o,l)}if(n.usedRoutes===void 0)return e;const r=n.usedRoutes.filter(i=>i!==""&&i!=="/");for(const i of r){zo(i.startsWith("/"),688);const s=i.split("/")[1],o=i.slice(s.length+1),a=e.get(s);zo((a==null?void 0:a.usedRoutes)!==void 0,689),a.usedRoutes.push(o),e.set(s,a)}return e}function PR(n){const e=n.filter(r=>r!==""&&r!=="/"),t=new Map;for(const r of e){zo(r.startsWith("/"),408);const i=r.split("/")[1],s=r.slice(i.length+1),o=t.get(i);o!==void 0?o.push(s):t.set(i,[s])}return t}function lG(n,e){const t=Object.entries(n);for(const[r,i]of t){const s=new Set(i);s.delete(e),n[r]=[...s]}}function cG(n,e){var t;const r={};for(const[i,s]of Object.entries(n.gcNodes))r[i]={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs};for(const[i,s]of Object.entries(e.gcNodes)){let o=r[i];o===void 0?o={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs}:(s.unreferencedTimestampMs!==void 0&&o.unreferencedTimestampMs!==void 0&&zo(s.unreferencedTimestampMs===o.unreferencedTimestampMs,690),o={outboundRoutes:[...new Set([...s.outboundRoutes,...o.outboundRoutes])],unreferencedTimestampMs:(t=s.unreferencedTimestampMs)!==null&&t!==void 0?t:o.unreferencedTimestampMs}),r[i]=o}return{gcNodes:r}}function uG(n,e){const t=Il(n);for(const[r,i]of Object.entries(e.gcNodes))if(t.gcNodes[r]===void 0)t.gcNodes[r]=Array.from(i);else{const s=[...i,...t.gcNodes[r]];t.gcNodes[r]=[...new Set(s)]}return t}class H0{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,r]of Object.entries(this.gcNodesSet))e[t]=[...r];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[r,i]of Object.entries(t)){let s=oG(r);s=`/${e}/${s}`,s=aG(s),this.gcNodesSet[s]=new Set(i)}}addNodes(e){for(const[t,r]of Object.entries(e))this.gcNodesSet[t]=new Set(r)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class dG extends Ui{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class W0 extends U0{constructor(e,t,r,i,s,o,a,l,c){super(e,async(u,d,h)=>t(u,!0,h),r,i,s,o,a),this.summarizeFn=t,this.getGCDataFn=l,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=r.gcDisabled===!0,this.baseGCDetailsP=new K5(async()=>{var u;return(u=await(c==null?void 0:c()))!==null&&u!==void 0?u:{usedRoutes:[]}})}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}async loadBaseGCDetails(){var e;const t=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,t.gcData!==void 0&&(this.gcData=Il(t.gcData)),this.referenceUsedRoutes=(e=t.usedRoutes)===null||e===void 0?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)}async summarize(e,t=!0,r){return!this.gcDisabled&&this.isTrackingInProgress()&&Ee(this.wipSerializedUsedRoutes!==void 0,433),t?super.summarize(e,!0,r):this.summarizeFn(e,t,r)}async getGCData(e=!1){if(Ee(!this.gcDisabled,434),Ee(this.getGCDataFn!==void 0,435),await this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&this.gcData!==void 0)return Il(this.gcData);const t=await this.getGCDataFn(e);return this.gcData=Il(t),t}startSummary(e,t){this.gcDisabled||Ee(this.wipSerializedUsedRoutes===void 0,436),super.startSummary(e,t)}completeSummaryCore(e,t,r){let i;if(this.gcDisabled||(i=this.wipSerializedUsedRoutes,Ee(i!==void 0,437)),super.completeSummaryCore(e,t,r),!this.gcDisabled){const s=this.pendingSummaries.get(e);if(s!==void 0){const o=new dG(i,s);this.pendingSummaries.set(e,o)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const r=this.pendingSummaries.get(e);r!==void 0&&(this.referenceUsedRoutes=JSON.parse(r.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(!this.gcDisabled){const a=t.blobs[te.gcBlobKey];if(a!==void 0){const l=await o(a);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=l.usedRoutes}}return super.refreshLatestSummaryFromSnapshot(e,t,r,i,s,o)}createChild(e,t,r,i={},s,o){var a;Ee(!this.children.has(t),438);const l=this.getCreateDetailsForChild(t,r),c=new W0(this.defaultLogger,e,Object.assign(Object.assign({},i),{gcDisabled:(a=i.gcDisabled)!==null&&a!==void 0?a:this.gcDisabled}),l.changeSequenceNumber,l.latestSummary,l.initialSummary,this.wipSummaryLogger,s,o);return this.maybeUpdateChildState(c),this.children.set(t,c),c}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){if(this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()){this.unreferencedTimestampMs=void 0;return}this.unreferencedTimestampMs===void 0&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return this.gcDisabled?!1:this.referenceUsedRoutes===void 0||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes)}}const hG=(n,e,t,r,i={},s,o)=>new W0(n,e,i,t,r===void 0?void 0:Ui.createForRoot(r),void 0,void 0,s,o);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function fG(n,e){const t=n.trees[".protocol"].blobs.attributes;return(await e(t)).sequenceNumber}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function $s(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function O(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function pG(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const mG=(n,e)=>RR.from(n,e).buffer,q_=(n,e)=>RR.from(n).toString(e);function B_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let RR=class vs extends Uint8Array{toString(e){return pG(this,e)}static from(e,t,r){if(typeof e=="string")return vs.fromString(e,t);if(e!==null&&typeof e=="object"&&B_(e.buffer))return O(e.byteOffset===0,0),O(e.byteLength===e.buffer.byteLength,1),vs.fromArrayBuffer(e.buffer,t,r);if(B_(e))return vs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new vs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new vs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new vs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const mn=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let La=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Dt=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},Qo=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Jh=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){O(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}},gG=class{constructor(e,t){this.timer=new Jh(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Dt,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),O(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let U_=class kR{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=mn.now();return new kR(e)}trace(){const e=mn.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dv(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let V0=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const vG=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ye;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Ye||(Ye={}));var H_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(H_||(H_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Hi;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Hi||(Hi={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class yG{constructor(e,t,r){this.path=e,this.runtime=t,this.routeContext=r,this.absolutePath=zc(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==Z.Detached}async resolveHandle(e){return this.runtime.resolveHandle(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class G0{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new ye("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}async get(e){if(this.map.has(e))return this.map.get(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Zt="summarizer";class Xo extends La{constructor(e,t,r,i,s){super(),this.logger=e,this.summaryCollection=t,this.clientElection=r,this.maxOpsSinceLastSummary=i,this.electionEnabled=s,this.lastReportedSeq=0,this.summaryCollection.on("default",({sequenceNumber:o})=>{var a,l,c;const u=this.electedClientId;if(u===void 0){this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(o);return}let d=this.clientElection.electionSequenceNumber;if(o-((a=this.lastSummaryAckSeqForClient)!==null&&a!==void 0?a:d)>this.maxOpsSinceLastSummary){const f=o-this.lastReportedSeq;if(f>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:u,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:d,nextElectedClientId:(l=this.clientElection.peekNextElectedClient())===null||l===void 0?void 0:l.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=o),this.electionEnabled){const p=this.electedParentId;this.clientElection.incrementElectedClient(o),d=this.clientElection.electionSequenceNumber,o>((c=this.lastSummaryAckSeqForClient)!==null&&c!==void 0?c:d)&&f>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:d,sequenceNumber:o,previousClientId:u,previousParentId:p,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:f,maxOpsSinceLastSummary:i})}}}),this.summaryCollection.on(Ye.SummaryAck,o=>{this.lastSummaryAckSeqForClient=o.sequenceNumber}),this.clientElection.on("election",(o,a)=>{this.lastSummaryAckSeqForClient=void 0,o===void 0&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(a),this.emit("electedSummarizerChanged")})}get electedClientId(){var e;return(e=this.clientElection.electedClient)===null||e===void 0?void 0:e.clientId}get electedParentId(){var e;return(e=this.clientElection.electedParent)===null||e===void 0?void 0:e.clientId}serialize(){var e;const{electedClientId:t,electedParentId:r,electionSequenceNumber:i}=this.clientElection.serialize();return{electedClientId:t,electedParentId:r,electionSequenceNumber:(e=this.lastSummaryAckSeqForClient)!==null&&e!==void 0?e:i}}static isClientEligible(e){const t=e.client.details;return t===void 0?!0:Xo.clientDetailsPermitElection(t)}}Xo.clientDetailsPermitElection=n=>n.capabilities.interactive||n.type===Zt;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function se(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let SG=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let el=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},bG=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function wG(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let NR=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var hv;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(hv||(hv={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class CG{constructor(e,t,r,i,s){this.objectId=e,this._connected=t,this.submit=r,this.dirty=i,this.addedGCOutboundReference=s}get handler(){return se(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){se(this._handler===void 0,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,r){try{this.handler.process(e,t,r)}catch(i){throw _n.wrapIfUnrecognized(i,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(this.handler.rollback===void 0)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Gd{constructor(e,t,r,i){this.tree=e,this.storage=t,this.logger=r,this.extraBlobs=i,this.flattenedTree={},e!==void 0&&Gd.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,r){for(const i in t.trees)Gd.flattenTree(`${e}${i}/`,t.trees[i],r);for(const i in t.blobs)r[`${e}${i}`]=t.blobs[i]}async contains(e){return this.flattenedTree[e]!==void 0}async readBlob(e){const t=await this.getIdForPath(e),r=this.extraBlobs!==void 0?this.extraBlobs.get(t):void 0;if(r!==void 0)return r;const i=this.storage.readBlob(t);return i.catch(s=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},s)),i}async list(e){var t;let r=this.tree;const i=Q5(e);for(;r!==void 0&&i.length>0;){const s=i.shift();r=r.trees[s]}if(r===void 0||i.length!==0)throw new Error("path does not exist");return Object.keys((t=r==null?void 0:r.blobs)!==null&&t!==void 0?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Kd=".attributes";function K0(n,e,t,r,i,s,o,a,l){const c=new CG(n,e,(d,h)=>t(d,h),r,i),u=new Gd(a,s,o,l);return{deltaConnection:c,objectStorage:u}}function LR(n,e=!1,t=!1,r){const i=n.getAttachSummary(e,t,r);return yr(i,Kd,JSON.stringify(n.attributes)),i}async function IR(n,e=!1,t=!1,r){const i=await n.summarize(e,t,r);return yr(i,Kd,JSON.stringify(n.attributes)),i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class J0{constructor(e,t,r,i){this.id=e,this.registry=t,this.runtime=r,this.servicesGetter=i,this.globallyVisible=!1,this.pending=[],se(!this.id.includes("/"),783)}async getChannel(){return se(this.channel!==void 0,519),this.channel}get isLoaded(){return this.channel!==void 0}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,r){se(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,r):(se(t===!1,393),this.pending.push(e))}reSubmit(e,t){se(this.isLoaded,394),se(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){se(this.isLoaded,750),se(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,r){return se(this.isLoaded&&this.channel!==void 0,396),IR(this.channel,e,t,r)}getAttachSummary(e){return se(this.isLoaded&&this.channel!==void 0,397),LR(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(se(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return se(this.isLoaded&&this.channel!==void 0,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class _G extends J0{constructor(e,t,r,i,s,o,a,l,c,u){super(e,t,r,()=>this.services),this.snapshotTree=u;const d=new Map,h=ua(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(h,d)&&this.sanitizeSnapshot(h),this.services=new NR(()=>K0(this.id,i.connected,a,this.dirtyFn,c,s,o,h,d)),this.dirtyFn=()=>{l(e)}}async getChannel(){return this.channel===void 0&&(this.channel=await this.loadChannel().catch(e=>{throw _n.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)})),this.channel}async loadChannel(){se(!this.isLoaded,398),se(await this.services.value.objectStorage.contains(".attributes"),400);const e=await at(this.services.value.objectStorage,".attributes");if(se(this.factory===void 0,520),this.factory=this.registry.get(e.type),this.factory===void 0)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const r of this.pending)this.services.value.deltaConnection.process(r,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let r=!1;const i=e.blobsContents;Object.entries(i).forEach(([s,o])=>{t.set(s,o),e.blobs[s]!==void 0&&(r=!0)});for(const s of Object.values(e.trees))r=r||this.isSnapshotInOldFormatAndCollectBlobs(s,t);return r}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[r,i]of t.entries())t.get(i)===void 0&&delete e.blobs[r];for(const r of Object.values(e.trees))this.sanitizeSnapshot(r)}}class EG extends J0{constructor(e,t,r,i,s,o,a,l,c,u){if(super(e,t,i,()=>this.services),se(r!==void 0,521),this.factory=t.get(r),this.factory===void 0)throw new Error(`Channel Factory ${r} not registered`);this.channel=this.factory.create(i,e),this.services=new NR(()=>K0(this.id,s.connected,l,this.dirtyFn,u,o,a)),this.dirtyFn=()=>{c(e)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class cc{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f){this.runtime=e,this.dataStoreContext=t,this.id=a,this.registry=c,this.attachMessageType=f,this.isLoaded=!1,this.pending=[],se(!this.id.includes("/"),784),this.subLogger=ue.create(this.runtime.logger,"RemoteChannelContext"),this.services=K0(this.id,this.dataStoreContext.connected,i,()=>s(this.id),o,r,this.subLogger,l,u);const p=async(g,S,m)=>this.summarizeInternal(g,S,m);this.summarizerNode=d(p,async g=>this.getGCDataInternal(g),async()=>h()),this.thresholdOpsCounter=new cP(cc.pendingOpsCountThreshold,this.subLogger)}getChannel(){return this.channelP===void 0&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return se(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,r){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,r):(se(!t,405),se(this.pending!==void 0,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){se(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){se(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){const i=await this.getChannel(),s=await IR(i,e,t,r);return Object.assign(Object.assign({},s),{id:this.id})}async loadChannel(){se(!this.isLoaded,407);let e;await this.services.objectStorage.contains(Kd)&&(e=await at(this.services.objectStorage,Kd));let t;if(e===void 0){if(this.attachMessageType===void 0)throw new wr("channelTypeNotAvailable",{channelId:{value:this.id,tag:ke.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:ke.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),t===void 0)throw new wr("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:ke.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:ke.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),t===void 0)throw new wr("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:ke.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:ke.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});e.snapshotFormatVersion!==void 0&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:ke.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:ke.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:ke.PackageData}});const r=await t.load(this.runtime,this.id,this.services,e);se(this.pending!==void 0,575);for(const i of this.pending)this.services.deltaConnection.process(i,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=r,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}cc.pendingOpsCountThreshold=1e3;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var qr;(function(n){n.Attach="attach",n.ChannelOp="op"})(qr||(qr={}));class $c extends SG{constructor(e,t,r){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new el,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,se(!e.id.includes("/"),782),this.logger=ue.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:Ze()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const i=e.baseSnapshot;this.channelsBaseGCDetails=new bG(async()=>{var s,o,a;const l=await((a=(o=(s=this.dataStoreContext).getBaseGCDetails)===null||o===void 0?void 0:o.call(s))!==null&&a!==void 0?a:this.dataStoreContext.getInitialGCSummaryDetails());return OR(l)}),(i==null?void 0:i.trees)!==void 0&&Object.keys(i.trees).forEach(s=>{if(s==="_search")return;let o;e.isLocalDataStore?(o=new _G(s,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(l,c)=>this.submitChannelOp(s,l,c),l=>this.setChannelDirty(l),(l,c)=>this.addedGCOutboundReference(l,c),i.trees[s]),e.attachState!==Z.Detached?o.makeVisible():this.localChannelContextQueue.set(s,o)):o=new cc(this,e,e.storage,(l,c)=>this.submitChannelOp(s,l,c),l=>this.setChannelDirty(l),(l,c)=>this.addedGCOutboundReference(l,c),s,i.trees[s],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:te.CreateSummarizerNodeSource.FromSummary}),async()=>this.getChannelBaseGCDetails(s));const a=new el;a.resolve(o),this.contexts.set(s,o),this.contextsDeferred.set(s,a)}),this.attachListener(),this.bindState=r?pn.Bound:pn.NotBound,this._attachState=e.attachState,r?this.visibilityState=e.attachState===Z.Detached?te.VisibilityState.LocallyVisible:te.VisibilityState.GloballyVisible:this.visibilityState=te.VisibilityState.NotVisible,r&&this.deferredAttached.resolve()}static load(e,t,r){return new $c(e,t,r)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==Z.Detached}get attachState(){return this._attachState}get absolutePath(){return zc(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const t=Cr.create(e),r=t.pathParts[0];if(r==="_channels"||r==="_custom")return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(r)&&t.isLeaf(1))try{return{mimeType:"fluid/object",status:200,value:await(await this.contextsDeferred.get(r).promise).getChannel()}}catch(i){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},i),Vd(500,`Failed to get Channel: ${i}`,e)}return An(e)}catch(t){return Wd(t)}}async getChannel(e){return this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new el),await(await this.contextsDeferred.get(e).promise).getChannel()}createChannel(e=Ze(),t){if(e.includes("/"))throw new ye(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),se(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const r=new EG(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(i,s)=>this.submitChannelOp(e,i,s),i=>this.setChannelDirty(i),(i,s)=>this.addedGCOutboundReference(i,s));if(this.contexts.set(e,r),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(r);else{const i=new el;i.resolve(r),this.contextsDeferred.set(e,i)}return se(!!r.channel,378),r.channel}bindChannel(e){if(se(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached){this.attachChannel(e);return}this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===te.VisibilityState.NotVisible&&(this.visibilityState=te.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===pn.NotBound&&(this.bindState=pn.Binding,this.dataStoreContext.bindToContext(),this.bindState=pn.Bound)}bind(e){if(this.visibilityState!==te.VisibilityState.NotVisible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}setConnectionState(e,t){this.verifyNotClosed();for(const[,r]of this.contexts)r.setConnectionState(e,t);d0(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,r){this.verifyNotClosed();try{switch(e.type){case qr.Attach:{const i=e.contents,s=i.id;if(t)se(this.pendingAttach.has(s),380),this.pendingAttach.delete(s);else{se(!this.contexts.has(s),381);const o=new Map,a=mP(i.snapshot.entries,o),l=new cc(this,this.dataStoreContext,this.dataStoreContext.storage,(c,u)=>this.submitChannelOp(s,c,u),c=>this.setChannelDirty(c),(c,u)=>this.addedGCOutboundReference(c,u),s,a,this.sharedObjectRegistry,o,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:te.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),async()=>this.getChannelBaseGCDetails(s),i.type);if(this.contexts.set(s,l),this.contextsDeferred.has(s))this.contextsDeferred.get(s).resolve(l);else{const c=new el;c.resolve(l),this.contextsDeferred.set(s,c)}}break}case qr.ChannelOp:this.processChannelOp(e,t,r);break;default:}this.emit("op",e)}catch(i){throw _n.wrapIfUnrecognized(i,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new H0;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>this.isChannelAttached(r)).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var r;const i=PR(e);for(const[s]of i)se(this.contexts.has(s),382);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}addedGCOutboundReference(e,t){var r,i;(i=(r=this.dataStoreContext).addedGCOutboundReference)===null||i===void 0||i.call(r,e,t)}async getChannelBaseGCDetails(e){var t;let r=(await this.channelsBaseGCDetails).get(e);return r===void 0?r={}:((t=r.gcData)===null||t===void 0?void 0:t.gcNodes)!==void 0&&lG(r.gcData.gcNodes,this.absolutePath),(r.usedRoutes===void 0||r.usedRoutes.length===0)&&(r.usedRoutes=[""]),r}async summarize(e=!1,t=!0,r){const i=new Kt;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>{const a=this.isChannelAttached(s);return se(a,383),a}).map(async([s,o])=>{const a=await o.summarize(e,t,r);i.addWithStats(s,a)})),i.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new Kt;for(const[r,i]of this.contexts){if(!(i instanceof J0))throw new oe("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(r)){let s;if(i.isLoaded){const o=i.getAttachSummary(e);se(o.summary.type===hv.Tree,384),s={stats:o.stats,summary:o.summary}}else se(!!this.dataStoreContext.baseSnapshot,385),s=q0(this.dataStoreContext.baseSnapshot.trees[r]);t.addWithStats(r,s)}}return t.getSummaryTree()}submitMessage(e,t,r){this.submit(e,t,r)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),se(this.isAttached,386),se(this.visibilityState===te.VisibilityState.GloballyVisible,720);const t=LR(e,!0,!1),r=B0(t.summary),i={id:e.id,snapshot:r,type:e.attributes.type};this.pendingAttach.set(e.id,i),this.submit(qr.Attach,i),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,r){const i={address:e,contents:t};this.submit(qr.ChannelOp,i,r)}submit(e,t,r=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,r)}reSubmit(e,t,r){switch(this.verifyNotClosed(),e){case qr.ChannelOp:{const i=t,s=this.contexts.get(i.address);se(!!s,387),s.reSubmit(i.contents,r);break}case qr.Attach:this.submit(e,t,r);break;default:wG()}}rollback(e,t,r){switch(this.verifyNotClosed(),e){case qr.ChannelOp:{const i=t,s=this.contexts.get(i.address);se(!!s,749),s.rollback(i.contents,r);break}default:throw new oe(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return se(!!r,388),await r.getChannel(),r.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,r){this.verifyNotClosed();const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);return se(!!o,389),o.processOp(s,t,r),o}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",()=>{this.attachGraph(),this._attachState=Z.Attaching,se(this.visibilityState===te.VisibilityState.LocallyVisible,721),this.visibilityState=te.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach(e=>{e.makeVisible()}),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")}),this.dataStoreContext.once("attached",()=>{se(this.visibilityState===te.VisibilityState.GloballyVisible,722),this._attachState=Z.Attached,this.emit("attached")})}verifyNotClosed(){if(this._disposed)throw new oe("Runtime is closed")}}const TG=(n,e=$c)=>class extends e{async request(r){const i=await super.request(r);return i.status===404?n(r,this):i}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Yo{constructor(e,t,r){this.value=e,this.path=t,this.routeContext=r,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=zc(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){if(this.visible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class xG extends Yo{async get(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")}attach(){}bind(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class OG{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:e??this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class PG{constructor(e,t,r,i){this.heuristicData=e,this.configuration=t,this.trySummarize=r,this.logger=i,this.idleTimer=new Jh(this.configuration.idleTime,()=>this.trySummarize("idle")),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function fv(n,e,t){const r=[n.then(i=>({result:"done",value:i})),e.then(({timerResult:i})=>({result:i}))];return t!==void 0&&r.push(t.waitCancelled.then(()=>({result:"cancelled"}))),Promise.race(r)}const W_=2e4,RG=5,V_={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class Al{constructor(){this.summarySubmitted=new Dt,this.summaryOpBroadcasted=new Dt,this.receivedSummaryAckOrNack=new Dt}fail(e,t,r,i){O(!this.receivedSummaryAckOrNack.isCompleted,606);const s={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:i};this.summarySubmitted.resolve(s),this.summaryOpBroadcasted.resolve(s),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},s),{data:r}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class kG{constructor(e,t,r,i,s,o,a){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=r,this.raiseSummarizingError=i,this.successfulSummaryCallback=s,this.summaryWatcher=o,this.logger=a,this.summarizeTimer=new Jh(W_,()=>this.summarizeTimerHandler(W_,1))}summarize(e,t,r,i=new Al){return this.summarizeCore(e,t,i,r).catch(s=>{const o="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:o},e),s),i.fail(o,s)}),i.build()}async summarizeCore(e,t,r,i){const{refreshLatestAck:s,fullTree:o}=t,a=ue.create(this.logger,void 0,{all:e}),l=Date.now()-this.heuristicData.lastAttempt.summaryTime,c=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime;let u={fullTree:o,timeSinceLastAttempt:l,timeSinceLastSummary:c};const d=le.start(a,Object.assign({eventName:"Summarize",refreshLatestAck:s},u)),h=g=>`${g}: ${V_[g]}`,f=(g,S,m,v)=>{this.raiseSummarizingError(V_[g]);const y=P_(S),b=i.cancelled||(S==null?void 0:S.errorType)===En.offlineError?"generic":"error";d.cancel(Object.assign(Object.assign({},m),{reason:g,category:b,retryAfterSeconds:y}),S),r.fail(h(g),S,v,y)};this.summarizeTimer.start();let p;try{p=await this.submitSummaryCallback({fullTree:o,refreshLatestAck:s,summaryLogger:a,cancellationToken:i});const g=p.referenceSequenceNumber,S=g-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(u=Object.assign(Object.assign({},u),{referenceSequenceNumber:g,minimumSequenceNumber:p.minimumSequenceNumber,opsSinceLastAttempt:g-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:S}),p.stage!=="base"&&(u=Object.assign(Object.assign(Object.assign({},u),p.summaryStats),{generateDuration:p.generateDuration}),p.stage!=="generate"&&(u=Object.assign(Object.assign({},u),{handle:p.handle,uploadDuration:p.uploadDuration}),p.stage!=="upload"&&(u=Object.assign(Object.assign({},u),{clientSequenceNumber:p.clientSequenceNumber})))),p.stage!=="submit")return f("submitSummaryFailure",p.error,u);if(!o&&!p.forcedFullTree){const{summarizedDataStoreCount:m,gcStateUpdatedDataStoreCount:v=0}=p.summaryStats;m>v+S&&a.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:m,gcStateUpdatedDataStoreCount:v,opsSinceLastSummary:S})}d.reportEvent("generate",Object.assign({},u)),r.summarySubmitted.resolve({success:!0,data:p})}catch(g){return f("submitSummaryFailure",g)}finally{this.heuristicData.recordAttempt(p==null?void 0:p.referenceSequenceNumber),this.summarizeTimer.clear()}try{const g=this.pendingAckTimer.start(),S=this.summaryWatcher.watchSummary(p.clientSequenceNumber),m=await fv(S.waitBroadcast(),g,i);if(m.result==="cancelled")return f("disconnect");if(m.result!=="done")return f("summaryOpWaitTimeout");const v=m.value,y=Date.now()-this.heuristicData.lastAttempt.summaryTime;r.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:v,broadcastDuration:y}}),this.heuristicData.lastAttempt.summarySequenceNumber=v.sequenceNumber,a.sendTelemetryEvent({eventName:"Summarize_Op",duration:y,referenceSequenceNumber:v.referenceSequenceNumber,summarySequenceNumber:v.sequenceNumber,handle:v.contents.handle});const b=await fv(S.waitAckNack(),g,i);if(b.result==="cancelled")return f("disconnect");if(b.result!=="done")return f("summaryAckWaitTimeout");const w=b.value;this.pendingAckTimer.clear();const x=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(u=Object.assign({ackWaitDuration:x,ackNackSequenceNumber:w.sequenceNumber,summarySequenceNumber:w.contents.summaryProposal.summarySequenceNumber},u),w.type===Ye.SummaryAck)this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),d.end(Object.assign(Object.assign({},u),{handle:w.contents.handle})),r.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:w,ackNackDuration:x}});else{O(w.type===Ye.SummaryNack,628);const E=w.contents,P=E==null?void 0:E.message,M=E==null?void 0:E.retryAfter,F=new oe(`Received summaryNack: ${P}`,{retryAfterSeconds:M});return O(P_(F)===M,607),f("summaryNack",F,Object.assign(Object.assign({},u),{nackRetryAfter:M}),{summaryNackOp:w,ackNackDuration:x})}}finally{this.pendingAckTimer.clear()}}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<RG){const r=e*2;this.summarizeTimer.start(r,()=>this.summarizeTimerHandler(r,t+1))}}dispose(){this.summarizeTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var tm=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const NG=10*60*1e3;class Q0{constructor(e,t,r,i,s,o,a,l,c){this.summaryWatcher=t,this.configuration=r,this.submitSummaryCallback=i,this.heuristicData=s,this.raiseSummarizingError=o,this.summaryCollection=a,this.cancellationToken=l,this.stopSummarizerCallback=c,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=h=>this.heuristicData.lastAttempt.refSequenceNumber===h?this.logger:void 0;const u={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=ue.create(e,"Running",{all:u}),r.state!=="disableHeuristics"&&(O(this.configuration.state==="enabled",746),this.heuristicRunner=new PG(s,this.configuration,h=>this.trySummarize(h),this.logger)),O(this.configuration.state!=="disabled",747);const d=Math.min(this.configuration.maxAckWaitTime,NG);this.pendingAckTimer=new gG(d,()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:d,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})}),a.setPendingAckTimerTimeoutCallback(d,()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())}),this.generator=new kG(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,()=>{this.totalSuccessfulAttempts++},this.summaryWatcher,this.logger)}static async start(e,t,r,i,s,o,a,l,c){var u;const d=new Q0(e,t,r,i,s,o,a,l,c);return await d.waitStart(),(u=d.heuristicRunner)===null||u===void 0||u.run(),d}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),(e=this.heuristicRunner)===null||e===void 0||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case Ye.ClientLeave:case Ye.ClientJoin:case Ye.Propose:{this.handleOp(void 0,e);return}default:return}}handleOp(e,{sequenceNumber:t,type:r,clientId:i,contents:s}){var o;e===void 0&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||(o=this.heuristicRunner)===null||o===void 0||o.run())}async waitStop(e){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(!((t=this.heuristicRunner)===null||t===void 0)&&t.shouldRunLastSummary())&&this.summarizingLock===void 0&&this.trySummarizeOnce({reason:"lastSummary"},{}),await this.summarizingLock)}async waitStart(){const e=await fv(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),e.result==="done"&&e.value!==void 0&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})}async lockedRefreshSummaryAckAction(e){O(this.refreshSummaryAckLock===void 0,"Refresh Summary Ack - Caller is responsible for checking lock");const t=new Dt;return this.refreshSummaryAckLock=t.promise,e().finally(()=>{t.resolve(),this.refreshSummaryAckLock=void 0})}async lockedSummaryAction(e){O(this.summarizingLock===void 0,603);const t=new Dt;return this.summarizingLock=t.promise,this.summarizeCount++,await this.refreshSummaryAckLock,e().finally(()=>{var r;t.resolve(),this.summarizingLock=void 0;const i=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,!this.stopping&&!this.tryRunEnqueuedSummary()&&i&&((r=this.heuristicRunner)===null||r===void 0||r.run())})}trySummarizeOnce(e,t,r=this.cancellationToken,i=new Al){return this.lockedSummaryAction(async()=>this.generator.summarize(e,t,r,i).receivedSummaryAckOrNack).catch(s=>{}),i.build()}trySummarize(e,t=this.cancellationToken){if(this.summarizingLock!==void 0){this.tryWhileSummarizing=!0;return}this.lockedSummaryAction(async()=>{const r=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let i,s=0,o=0,a;for(let l=0;l<r.length;){if(this.cancellationToken.cancelled||++s>1&&e==="lastSummary")return;o++;const c=r[l],{delaySeconds:u=0}=c,d=tm(c,["delaySeconds"]),h=i??u,f=Object.assign({reason:e,summaryAttempts:s,summaryAttemptsPerPhase:o,summaryAttemptPhase:l+1},d);h>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:h,summaryNackDelay:i!==void 0},f)),await vG(h*1e3)),await this.refreshSummaryAckLock;const g=await this.generator.summarize(f,d,t).receivedSummaryAckOrNack;if(g.success)return;i=g.retryAfterSeconds,(i===void 0||o>1)&&(l++,o=0),a=g}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:a==null?void 0:a.message},a==null?void 0:a.error),this.stopSummarizerCallback("failToSummarize")}).catch(r=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},r)})}summarizeOnDemand(e=new Al,t){var{reason:r}=t,i=tm(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(this.summarizingLock!==void 0)throw new ye("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${r}`},i,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:r=0,override:i=!1}=e,s=tm(e,["reason","afterSequenceNumber","override"]);const o=`enqueue;${t}`;let a=!1;if(this.enqueuedSummary!==void 0){if(!i)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,a=!0}this.enqueuedSummary={reason:o,afterSequenceNumber:r,options:s,resultsBuilder:new Al};const l=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),a?Object.assign(Object.assign({},l),{alreadyEnqueued:!0,overridden:!0}):l}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(this.enqueuedSummary===void 0||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||this.summarizingLock!==void 0)return!1;const{reason:e,resultsBuilder:t,options:r}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},r,this.cancellationToken,t),!0}disposeEnqueuedSummary(){this.enqueuedSummary!==void 0&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const LG="summarizingError";class uc extends oe{constructor(e,t=!1){super(e),this.logged=t,this.errorType=LG,this.canRetry=!0}static wrap(e,t=!1,r){return iP(e,s=>new uc(s,t),r)}}const IG=(n,e)=>new uc(n,e);class X0 extends ln.EventEmitter{constructor(e,t,r,i,s,o,a){super(),this.runtime=t,this.configurationGetter=r,this.internalsProvider=i,this.summaryCollection=o,this.runCoordinatorCreateFn=a,this._disposed=!1,this.starting=!1,this.stopDeferred=new Dt,this.summarizeOnDemand=(...l)=>{var c;try{if(this._disposed||!((c=this.runningSummarizer)===null||c===void 0)&&c.disposed)throw new ye("Summarizer is already disposed.");if(this.runtime.summarizerClientId!==void 0&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new ye("On-demand summary attempted while an elected summarizer is present");const u=new Al;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(u,...l):(this.runCoordinatorCreateFn(this.runtime).then(h=>{this.start(this.runtime.clientId,h).then(async p=>{p.summarizeOnDemand(u,...l);const g=await Promise.race([this.stopDeferred.promise,h.waitCancelled]);await p.waitStop(!1),h.stop(g),this.close()}).catch(p=>{u.fail("Failed to start summarizer",p)})}).catch(h=>{u.fail("Failed to create cancellation token",h)}),u.build())}catch(u){throw uc.wrap(u,!1,this.logger)}},this.enqueueSummarize=(...l)=>{if(this._disposed||this.runningSummarizer===void 0||this.runningSummarizer.disposed)throw new ye("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...l)},this.logger=ue.create(this.runtime.logger,"Summarizer"),this.innerHandle=new xG(this,e,s)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static async create(e,t){const r={headers:{[je.cache]:!1,[je.clientDetails]:{capabilities:{interactive:!1},type:Zt},[pa.summarizingClient]:!0,[je.reconnect]:!1},url:t},i=await e.resolve(r),s=await lc(i,{url:"_summarizer"});if(s.ISummarizer===void 0)throw new ye("Fluid object does not implement ISummarizer");return s.ISummarizer}async run(e){try{return await this.runCore(e)}catch(t){throw this.stop("summarizerException"),uc.wrap(t,!1,this.logger)}finally{this.close()}}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}async runCore(e){const t=await this.runCoordinatorCreateFn(this.runtime),r=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(r.then(o=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:o})}),t.cancelled)return t.waitCancelled;const i=await this.start(e,t),s=await r;return await i.waitStop(!t.cancelled&&X0.stopReasonCanRunLastSummary(s)),t.stop(s),s}static stopReasonCanRunLastSummary(e){return e==="parentNotConnected"}async start(e,t){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new ye("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new ye("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const r=this.runtime.clientId;if(r===void 0)throw new ye("clientId should be defined if connected.");const i=await Q0.start(this.logger,this.summaryCollection.createWatcher(r),this.configurationGetter(),async(...s)=>this.internalsProvider.submitSummary(...s),new OG(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),s=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},IG(s,!0))},this.summaryCollection,t,s=>t.stop(s));return this.runningSummarizer=i,this.starting=!1,this.handleSummaryAcks().catch(s=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},s)}),this.systemOpListener=s=>i.handleSystemOp(s),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(s,o)=>i.handleOp(s,o),this.runtime.on("batchEnd",this.opListener),i}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}async handleSummaryAcks(){var e,t,r,i,s;let o=this.runtime.deltaManager.initialSequenceNumber,a;for(;this.runningSummarizer;){const l=(e=this.runningSummarizer.tryGetCorrelatedLogger(o))!==null&&e!==void 0?e:this.logger;try{a=void 0,a=await this.summaryCollection.waitSummaryAck(o),o=a.summaryOp.referenceSequenceNumber;const c=a.summaryOp.contents.handle,u=a.summaryAck.contents.handle;await this.runningSummarizer.lockedRefreshSummaryAckAction(async()=>this.internalsProvider.refreshLatestSummaryAck(c,u,o,l).catch(async d=>{if(nP(d)&&d.errorType===En.fileNotFoundOrAccessDeniedError)l.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:o,proposalHandle:c,ackHandle:u},d);else throw d}))}catch(c){l.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:o,handle:(r=(t=a==null?void 0:a.summaryOp)===null||t===void 0?void 0:t.contents)===null||r===void 0?void 0:r.handle,ackHandle:(s=(i=a==null?void 0:a.summaryAck)===null||i===void 0?void 0:i.contents)===null||s===void 0?void 0:s.handle},c)}o++}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const AG=5e3,MG=4e3;var ht;(function(n){n[n.Off=0]="Off",n[n.Starting=1]="Starting",n[n.Running=2]="Running",n[n.Stopping=3]="Stopping"})(ht||(ht={}));class Qh{constructor(e,t,r,i,s,o,{initialDelayMs:a=AG,opsToBypassInitialDelay:l=MG}={},c){this.clientElection=e,this.connectedState=t,this.summaryCollection=r,this.requestSummarizerFn=s,this.startThrottler=o,this.disableHeuristics=c,this.state=ht.Off,this._disposed=!1,this.handleConnected=u=>{this.latestClientId=u,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const u=this.getShouldSummarizeState();switch(this.state){case ht.Off:{u.shouldSummarize&&this.startSummarization();return}case ht.Starting:return;case ht.Running:{u.shouldSummarize===!1&&this.stop(u.stopReason);return}case ht.Stopping:return;default:return}},this.summarizeOnDemand=(...u)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...u)},this.enqueueSummarize=(...u)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...u)},this.logger=ue.create(i,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=l,this.initialDelayMs=a}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){if(this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==ht.Running&&this.connectedState.clientId!==this.clientElection.electedClientId)return{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"};if(this.connectedState.connected)if(this.disposed)O(!1,608);else return{shouldSummarize:!0};else return{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){O(this.state===ht.Off,609),this.state=ht.Starting,O(this.summarizer===void 0,610),this.delayBeforeCreatingSummarizer().then(async e=>{if(e&&this.getShouldSummarizeState().shouldSummarize===!1)return"early exit";O(this.state===ht.Starting,611),this.state=ht.Running;const t=await this.requestSummarizerFn();this.summarizer=t;const r=this.getShouldSummarizeState();if(r.shouldSummarize===!1)return this.state=ht.Starting,t.stop(r.stopReason),"early exit after starting summarizer";const i=this.latestClientId;return le.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},async()=>t.run(i,this.disableHeuristics))}).then(e=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:e})}).catch(e=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},e),this.getShouldSummarizeState().shouldSummarize||this.summarizer!==void 0){const t=(e==null?void 0:e.errorType)===En.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:t},e)}}).finally(()=>{var e;O(this.state!==ht.Off,612),this.state=ht.Off,(e=this.summarizer)===null||e===void 0||e.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()})}stop(e){var t;Qh.isStartingOrRunning(this.state)&&(this.state=ht.Stopping,(t=this.summarizer)===null||t===void 0||t.stop(e))}async delayBeforeCreatingSummarizer(){let e=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:e,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let t=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(t=!0,e=Math.max(e,this.initialDelayMs)),e>0){let r,i;const s=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(r),i())},o=new Promise(l=>{r=setTimeout(()=>l(),e)}),a=new Promise(l=>{i=l});this.summaryCollection.addOpListener(s),await Promise.race([o,a]),this.summaryCollection.removeOpListener(s)}return t}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}Qh.isStartingOrRunning=n=>n===ht.Starting||n===ht.Running;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class dc{constructor(e,t){this.logger=t,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=dc.processingTime,this.schedulingCount=0,this.deltaManager=e,this.deltaManager.inbound.on("idle",()=>{this.inboundQueueIdle()})}batchBegin(e){this.processingStartTime||(this.processingStartTime=mn.now()),this.schedulingLog===void 0&&this.schedulingCount%500===0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:mn.now()})}batchEnd(e){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const t=mn.now(),r=t-this.processingStartTime;r>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=r),setTimeout(()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:Ue.formatTick(r),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:Ue.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:Ue.formatTick(mn.now()-t)}),this.deltaManager.inbound.resume()}),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const e=mn.now();this.schedulingLog.totalProcessingTime+=e-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:Ue.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:Ue.formatTick(e-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=dc.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}dc.processingTime=50;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const AR=5e3;class DG{constructor(e,t,r){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=mn.now(),this.connectionStartTime=0,this.gap=0,this.logger=ue.create(r,"OpPerf"),this.deltaManager.on("pong",i=>this.recordPingTime(i)),this.deltaManager.on("submitOp",i=>this.beforeOpSubmit(i)),this.deltaManager.on("op",i=>this.afterProcessingOp(i)),this.deltaManager.on("connect",(i,s)=>{this.clientId=i.clientId,s!==void 0&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=s,this.connectionStartTime=mn.now(),this.gap<=0&&this.reportGettingUpToDate())}),this.deltaManager.on("disconnect",()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0}),this.deltaManager.outbound.on("push",i=>{for(const s of i)s.type===Ye.Operation&&this.clientSequenceNumberForLatencyStatistics===s.clientSequenceNumber&&(O(this.opProcessingTimes.outboundPushEventTime===void 0,712),O(this.opPerfData.durationNetwork===void 0,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),O(this.opPerfData.durationOutboundBatching===void 0,714),O(this.opProcessingTimes.submitOpEventTime!==void 0,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)}),this.deltaManager.inbound.on("push",i=>{this.clientId===i.clientId&&i.type===Ye.Operation&&this.clientSequenceNumberForLatencyStatistics===i.clientSequenceNumber&&this.opProcessingTimes.outboundPushEventTime!==void 0&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)}),this.deltaManager.inbound.on("idle",(i,s)=>{typeof i=="number"&&i>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:i,duration:s})})}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:mn.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?Ue.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100===0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){this.clientSequenceNumberForLatencyStatistics===void 0&&e.clientSequenceNumber%500===1&&(O(this.opProcessingTimes.outboundPushEventTime===void 0,716),O(this.opPerfData.durationNetwork===void 0,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),this.sequenceNumberForMsnTracking===void 0&&t%1e3===0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),this.sequenceNumberForMsnTracking!==void 0&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(O(this.msnTrackingTimestamp!==void 0,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){O(this.opProcessingTimes.submitOpEventTime!==void 0,288);const r=Date.now();this.opProcessingTimes.inboundPushEventTime!==void 0&&(this.opPerfData.durationInboundToProcessing=r-this.opProcessingTimes.inboundPushEventTime);const i=r-this.opProcessingTimes.submitOpEventTime,s=i>AR?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:i,category:s,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}function FG(n,e,t){new DG(n,e,t)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zG{constructor(e,t,r){var i;this.stateHandler=e,this.pendingStates=new lv,this.disposeOnce=new V0(()=>{this.initialStates.clear(),this.pendingStates.clear()}),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new lv((i=r==null?void 0:r.pendingStates)!==null&&i!==void 0?i:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return this._pendingMessagesCount!==0||!this.initialStates.isEmpty()}getLocalState(){if(O(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map(e=>e.type==="message"?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e)}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,r,i,s,o){const a={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:r,content:i,localOpMetadata:s,opMetadata:o};this.pendingStates.push(a),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===te.FlushMode.Immediate)return;const e=this.pendingStates.peekBack();(e==null?void 0:e.type)==="message"&&this.pendingStates.push({type:"flush"})}async applyStashedOpsAt(e){for(;!this.initialStates.isEmpty();){const t=this.initialStates.peekFront();if(t.type==="message"){if(e!==void 0){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const r=await this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=r}this.pendingStates.push(this.initialStates.shift())}}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if(O(t.type==="message",361),this.pendingStates.shift(),t.clientSequenceNumber!==e.clientSequenceNumber){const r=_n.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(r);return}return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata}maybeProcessBatchBegin(e){let t,r=!1,i=this.peekNextPendingState();for(;i.type!=="message";)i.type==="flushMode"&&(t=i.flushMode),i.type==="flush"&&(r=!0),this.pendingStates.shift(),i=this.peekNextPendingState();t!==void 0&&(this.flushModeForNextMessage=t),t!==te.FlushMode.Immediate&&(t===te.FlushMode.TurnBased||r)&&(O(!this.isProcessingBatch&&this.pendingBatchBeginMessage===void 0,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,r;if(!this.isProcessingBatch)return;const i=this.peekNextPendingState();if(i.type==="message")return;O(i.type!=="flushMode",701),O(this.pendingBatchBeginMessage!==void 0,365);const s=(t=this.pendingBatchBeginMessage.metadata)===null||t===void 0?void 0:t.batch;if(this.pendingBatchBeginMessage===e)O(s===void 0,366);else{const o=(r=e.metadata)===null||r===void 0?void 0:r.batch;O(s===!0,367),O(o===!1,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(t){const r=Lh(t,i=>_n.create(`RollbackError: ${i}`,"checkpointRollback",void 0));throw this.stateHandler.close(r),r}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return O(!!e,369),e}rollbackNextPendingState(){if(this.pendingStates.length===0)return;this._pendingMessagesCount--;const t=this.pendingStates.pop();switch(t.type){case"message":this.stateHandler.rollback(t.messageType,t.content,t.localOpMetadata);break;default:throw new Error(`Can't rollback state ${t.type}`)}}replayPendingStates(){O(this.stateHandler.connected(),370),O(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),O(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(e===0)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const r=this.pendingStates.shift();switch(r.type){case"message":this.stateHandler.reSubmit(r.messageType,r.content,r.localOpMetadata,r.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(r.flushMode);break;case"flush":this.stateHandler.flush();break}e--}this.stateHandler.setFlushMode(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const Yu="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class G_{constructor(e,t,r){this.path=e,this.routeContext=t,this.get=r,this.attached=!1,this.absolutePath=zc(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}class gn{constructor(e,t,r,i,s,o,a){this.routeContext=e,this.getStorage=r,this.attachBlobCallback=i,this.gcNodeUpdated=s,this.runtime=o,this.logger=a,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",()=>{for(const l of this.pendingBlobIds.values())l.reject(new Error("runtime disposed while blobAttach op in flight"))}),this.load(t)}hasBlob(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}getBlobGCNodePath(e){return`/${gn.basePath}/${e}`}async getBlob(e){var t,r;const i=(r=(t=this.redirectTable)===null||t===void 0?void 0:t.get(e))!==null&&r!==void 0?r:e;return O(this.hasBlob(i),287),this.gcNodeUpdated(this.getBlobGCNodePath(e)),new G_(`${gn.basePath}/${i}`,this.routeContext,async()=>le.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:i},async()=>this.getStorage().readBlob(i),{end:!0,cancel:"error"}))}async createBlob(e){var t,r;this.runtime.attachState===Z.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise(o=>this.runtime.once("attached",o))),!this.runtime.connected&&this.runtime.attachState===Z.Attached&&await new Promise(o=>this.runtime.once("connected",o));const i=await le.timedExecAsync(this.logger,{eventName:"createBlob"},async()=>this.getStorage().createBlob(e),{end:!0,cancel:"error"}),s=new G_(`${gn.basePath}/${i.id}`,this.routeContext,async()=>this.getBlob(i.id).then(async o=>o.get()));return this.runtime.attachState===Z.Detached?(this.detachedBlobIds.add(i.id),s):(this.pendingBlobIds.has(i.id)?await((t=this.pendingBlobIds.get(i.id))===null||t===void 0?void 0:t.promise):this.blobIds.has(i.id)||(this.pendingBlobIds.set(i.id,new Dt),this.attachBlobCallback(i.id),await((r=this.pendingBlobIds.get(i.id))===null||r===void 0?void 0:r.promise)),s)}processBlobAttachOp(e,t){if(t){const r=this.pendingBlobIds.get(e);O(r!==void 0,504),r.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}static async load(e,t){if(!e)return{};let r;const i=e.blobs[this.redirectTableBlobName];return i&&(r=await t(i)),{ids:Object.entries(e.blobs).filter(([o,a])=>o!==this.redirectTableBlobName).map(([o,a])=>a),redirectTable:r}}load(e){var t,r,i;if(e.ids){const s=this.runtime.attachState===Z.Detached;e.ids.map(o=>s?this.detachedBlobIds.add(o):this.blobIds.add(o))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:(r=(t=e.ids)===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:0,redirectTable:(i=e.redirectTable)===null||i===void 0?void 0:i.length})}getGCData(e=!1){const t={gcNodes:{}};if(this.blobIds.forEach(r=>{t.gcNodes[this.getBlobGCNodePath(r)]=[]}),this.redirectTable!==void 0)for(const[r,i]of this.redirectTable)t.gcNodes[this.getBlobGCNodePath(r)]=[this.getBlobGCNodePath(i)];return t}deleteUnusedRoutes(e){var t;for(const r of e){const i=r.split("/");O(i.length===3&&i[1]===gn.basePath,725);const s=i[2];if(!((t=this.redirectTable)===null||t===void 0)&&t.has(s)){this.redirectTable.delete(s);continue}this.blobIds.delete(s)}}summarize(e){const r=!!this.redirectTable||this.runtime.attachState!==Z.Detached?this.blobIds:this.detachedBlobIds,i=new Kt;return r.forEach(s=>{i.addAttachment(s)}),this.redirectTable&&this.redirectTable.size>0&&i.addBlob(gn.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),i.getSummaryTree()}setRedirectTable(e){O(this.runtime.attachState===Z.Detached,594),O(!this.redirectTable,595);for(const[t,r]of e)O(this.detachedBlobIds.delete(t),596),this.blobIds.add(r);O(this.detachedBlobIds.size===0,597),this.redirectTable=e}}gn.basePath="_blobs";gn.redirectTableBlobName=".redirectTable";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class $G{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new V0(()=>{for(const[t,r]of this.deferredContexts)r.promise.then(i=>{i.dispose()}).catch(i=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:t},i)})}),this.dispose=()=>this.disposeOnce.value,this._logger=ue.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(!(this._contexts.get(e)===void 0||!this.notBoundContexts.has(e)))return this._contexts.get(e)}addUnbound(e){const t=e.id;O(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}async getBoundOrRemoted(e,t){const r=this.ensureDeferred(e);if(!(!t&&!r.isCompleted))return r.promise}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const r=new Dt;return this.deferredContexts.set(e,r),r}bind(e){const t=this.notBoundContexts.delete(e);O(t,345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);O(!!t,346),O(!this.notBoundContexts.has(e),347);const r=this.deferredContexts.get(e);O(!!r,348),r.resolve(t)}addBoundOrRemoted(e){const t=e.id;O(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var jG=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const qG=1,ki="gc",MR="__gc",BG="Fluid.GarbageCollection.RunGC",UG="Fluid.GarbageCollection.RunSweep",HG="Fluid.GarbageCollection.GCTestMode",WG="Fluid.GarbageCollection.WriteDataAtRoot",VG="Fluid.GarbageCollection.RunSessionExpiry",GG="Fluid.GarbageCollection.DisableSessionExpiry",KG="Fluid.GarbageCollection.TrackGCState",JG="Fluid.GarbageCollection.DisableSweepLog",Y0=1*24*60*60*1e3,QG=7*Y0,XG=30*Y0,Bt={DataStore:"DataStore",SubDataStore:"SubDataStore",Blob:"Blob",Other:"Other"},hn={Active:"Active",Inactive:"Inactive",SweepReady:"SweepReady"};class K_{constructor(e,t,r,i){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=r,this._state=hn.Active,i!==void 0&&this.updateTracking(i)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(this.sweepTimeoutMs!==void 0&&t>=this.sweepTimeoutMs){this._state=hn.SweepReady,this.clearTimers();return}if(t>=this.inactiveTimeoutMs){this._state=hn.Inactive,this.clearTimers(),this.sweepTimeoutMs!==void 0&&Jd(this.sweepTimeoutMs-t,()=>{this._state=hn.SweepReady},i=>{this.sweepTimer=i});return}const r=this.inactiveTimeoutMs-t;if(this.inactiveTimer===void 0){const i=()=>{this._state=hn.Inactive,this.sweepTimeoutMs!==void 0&&Jd(this.sweepTimeoutMs-this.inactiveTimeoutMs,()=>{this._state=hn.SweepReady},s=>{this.sweepTimer=s})};this.inactiveTimer=new Jh(r,()=>i())}this.inactiveTimer.restart(r)}clearTimers(){var e;(e=this.inactiveTimer)===null||e===void 0||e.clear(),this.sweepTimer!==void 0&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=hn.Active}}let YG=class DR{constructor(e){var t,r,i,s,o,a,l;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=qG,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const c=e.baseSnapshot,u=e.metadata,d=e.readAndParseBlob;this.mc=ka(ue.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}}));let h;if(e.existing)h=Z_(u),this.gcEnabled=h>0,this.sweepEnabled=(t=u==null?void 0:u.sweepEnabled)!==null&&t!==void 0?t:!1,this.sessionExpiryTimeoutMs=u==null?void 0:u.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&this.gcOptions.gcAllowed===!1)throw new ye("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=this.gcOptions.gcAllowed!==!1,this.sweepEnabled=this.gcOptions.sweepAllowed===!0,this.mc.config.getBoolean(VG)&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=XG)}if(this.sessionExpiryTimeoutMs!==void 0&&this.mc.config.getBoolean(GG)!==!0){const g=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),S=g??this.sessionExpiryTimeoutMs;Jd(S,()=>{this.runtime.closeFn(new K4("Client session expired.",S))},m=>{this.sessionExpiryTimer=m}),e.snapshotCacheExpiryMs!==void 0&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+Y0)}if(this.latestSummaryGCVersion=h??this.currentGCVersion,this.shouldRunGC=(r=this.mc.config.getBoolean(BG))!==null&&r!==void 0?r:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&this.sweepTimeoutMs!==void 0&&((i=this.mc.config.getBoolean(UG))!==null&&i!==void 0?i:this.sweepEnabled),this.trackGCState=this.mc.config.getBoolean(KG)===!0,this.inactiveTimeoutMs=(o=(s=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))!==null&&s!==void 0?s:this.gcOptions.inactiveTimeoutMs)!==null&&o!==void 0?o:QG,this.sweepTimeoutMs!==void 0&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new ye("inactive timeout should not be greated than the sweep timeout");if(this.testMode=(a=this.mc.config.getBoolean(HG))!==null&&a!==void 0?a:this.gcOptions.runGCInTestMode===!0,this._writeDataAtRoot=(l=this.mc.config.getBoolean(WG))!==null&&l!==void 0?l:!0,this._writeDataAtRoot){const g=(c==null?void 0:c.trees[ki])!==void 0;this.initialStateNeedsReset=g!==this.shouldRunGC}const f=new Qo(async()=>{var g;if(c===void 0)return;const S=c.trees[ki];if(S!==void 0){this._writeDataAtRoot=!0;const y=await J_(S,d);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(nm(y))),y}const m={gcNodes:{"/":{outboundRoutes:[]}}},v=qR(c,u);O(v!==void 0,680);for(const[y,b]of Object.entries(v.trees)){const w=b.blobs[te.gcBlobKey];if(w===void 0)continue;const x=await d(w);if(((g=x.gcData)===null||g===void 0?void 0:g.gcNodes)===void 0)continue;const E=`/${y}`;(await d(b.blobs[Qs])).isRootDataStore&&m.gcNodes["/"].outboundRoutes.push(E);for(const[M,F]of Object.entries(x.gcData.gcNodes)){const G=M==="/"?E:`${E}${M}`;m.gcNodes[G]={outboundRoutes:Array.from(F)}}O(m.gcNodes[E]!==void 0,681),m.gcNodes[E].unreferencedTimestampMs=x.unrefTimestamp}return Object.keys(m.gcNodes).length===1?void 0:m});this.initializeBaseStateP=new Qo(async()=>{const g=this.runtime.getCurrentReferenceTimestampMs(),S=await f;if(S===void 0)return;const m={};for(const[v,y]of Object.entries(S.gcNodes))y.unreferencedTimestampMs!==void 0&&this.unreferencedNodesState.set(v,new K_(y.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,g)),m[v]=Array.from(y.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:m}}),this.baseGCDetailsP=new Qo(async()=>{const g=await f;if(g===void 0)return new Map;const S={};for(const[y,b]of Object.entries(g.gcNodes))S[y]=Array.from(b.outboundRoutes);const m=em(S,["/"]).referencedNodeIds,v=OR({gcData:{gcNodes:S},usedRoutes:m});for(const[y,b]of Object.entries(g.gcNodes))if(b.unreferencedTimestampMs!==void 0){const w=v.get(y.slice(1));w!==void 0&&(w.unrefTimestamp=b.unreferencedTimestampMs)}return v});const p=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:p}),this.shouldRunGC&&this.initializeBaseStateP.catch(g=>{const S=_n.wrapIfUnrecognized(g,"FailedToInitializeGC");throw S.addTelemetryProperties({gcConfigs:p}),S})}static create(e){return new DR(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}async collectGarbage(e){const{fullGC:t=this.gcOptions.runFullGC===!0||this.summaryStateNeedsReset}=e,r=e.logger?ue.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return le.timedExecAsync(r,{eventName:"GarbageCollection"},async i=>{await this.runPreGCSteps();const s=await this.runtime.getGCData(t),o=em(s.gcNodes,["/"]),a=await this.runPostGCSteps(s,o,r);return i.end(Object.assign({},a)),this.completedRuns++,a},{end:!0,cancel:"error"})}async runPreGCSteps(){await this.initializeBaseStateP,await this.runtime.updateStateBeforeGC()}async runPostGCSteps(e,t,r){const i=this.generateStats(t);this.updateStateSinceLastRun(e,r);const s=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,s),this.runtime.updateUsedRoutes(t.referencedNodeIds,s),this.logSweepEvents(r,s),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),await this.logUnreferencedEvents(r),i}summarize(e,t,r){var i;if(!this.shouldRunGC||this.previousGCDataFromLastRun===void 0)return;const s={gcNodes:{}};for(const[l,c]of Object.entries(this.previousGCDataFromLastRun.gcNodes))s.gcNodes[l]={outboundRoutes:c,unreferencedTimestampMs:(i=this.unreferencedNodesState.get(l))===null||i===void 0?void 0:i.unreferencedTimestampMs};const o=JSON.stringify(nm(s));if(this.trackGCState&&(this.pendingSerializedSummaryState=o,this.latestSerializedSummaryState!==void 0&&this.latestSerializedSummaryState===o&&!e&&t)){const l=Zi();return l.handleNodeCount++,{summary:{type:Hi.Handle,handle:`/${ki}`,handleType:Hi.Tree},stats:l}}const a=new Kt;return a.addBlob(`${MR}_root`,o),a.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}async getBaseGCDetails(){return this.baseGCDetailsP}async latestSummaryStateRefreshed(e,t){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked){this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0);return}const r=e.snapshot,i=r.blobs[pv];if(i){const o=await t(i);this.latestSummaryGCVersion=Z_(o)}const s=r.trees[ki];if(s!==void 0&&this.trackGCState){const o=await J_(s,t);this.latestSerializedSummaryState=JSON.stringify(nm(o))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0}nodeUpdated(e,t,r,i,s){if(!this.shouldRunGC)return;const o=this.unreferencedNodesState.get(e);o&&o.state!==hn.Active&&this.inactiveNodeUsed(t,e,o,void 0,i,r,s)}addedOutboundReference(e,t){var r;if(!this.shouldRunGC)return;const i=(r=this.newReferencesSinceLastRun.get(e))!==null&&r!==void 0?r:[];i.push(t),this.newReferencesSinceLastRun.set(e,i);const s=this.unreferencedNodesState.get(t);s&&s.state!==hn.Active&&this.inactiveNodeUsed("Revived",t,s,e)}dispose(){this.sessionExpiryTimer!==void 0&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,r){this.previousGCDataFromLastRun=Il(e),this.newReferencesSinceLastRun.clear();for(const i of t.referencedNodeIds){const s=this.unreferencedNodesState.get(i);s!==void 0&&(s.stopTracking(),this.unreferencedNodesState.delete(i))}if(r!==void 0)for(const i of t.deletedNodeIds){const s=this.unreferencedNodesState.get(i);s===void 0?this.unreferencedNodesState.set(i,new K_(r,this.inactiveTimeoutMs,this.sweepTimeoutMs,r)):s.updateTracking(r)}}updateStateSinceLastRun(e,t){if(this.previousGCDataFromLastRun===void 0)return;const r=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&r.length>0&&r.forEach(o=>{const a={eventName:"gcUnknownOutboundReferences",gcNodeId:o[0],gcRoutes:JSON.stringify(o[1])};t.sendPerformanceEvent(a)}),this.newReferencesSinceLastRun.size===0)return;const i=uG(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach((o,a)=>{i.gcNodes[a]===void 0?i.gcNodes[a]=o:i.gcNodes[a].push(...o)});const s=em(i.gcNodes,["/"]);for(const o of s.referencedNodeIds){const a=this.unreferencedNodesState.get(o);a!==void 0&&(a.stopTracking(),this.unreferencedNodesState.delete(o))}}findMissingExplicitReferences(e,t,r){O(t!==void 0,695);const i=Object.entries(e.gcNodes),s=[];return i.forEach(([o,a])=>{var l,c;const u=(l=t.gcNodes[o])!==null&&l!==void 0?l:[],d=(c=r.get(o))!==null&&c!==void 0?c:[],h=[];a.forEach(f=>{const p=this.runtime.getNodeType(f)===Bt.Blob||this.runtime.getNodeType(f)===Bt.DataStore,g=!o.startsWith(f);p&&g&&!u.includes(f)&&!d.includes(f)&&h.push(f)}),h.length>0&&s.push([o,h])}),s}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},r=(i,s)=>{t.nodeCount++;const o=this.previousGCDataFromLastRun===void 0||this.unreferencedNodesState.has(i)===s;o&&t.updatedNodeCount++,s||t.unrefNodeCount++,this.runtime.getNodeType(i)===Bt.DataStore&&(t.dataStoreCount++,o&&t.updatedDataStoreCount++,s||t.unrefDataStoreCount++),this.runtime.getNodeType(i)===Bt.Blob&&(t.attachmentBlobCount++,o&&t.updatedAttachmentBlobCount++,s||t.unrefAttachmentBlobCount++)};for(const i of e.referencedNodeIds)r(i,!0);for(const i of e.deletedNodeIds)r(i,!1);return t}logSweepEvents(e,t){this.mc.config.getBoolean(JG)===!0||t===void 0||this.sweepTimeoutMs===void 0||this.unreferencedNodesState.forEach((r,i)=>{if(r.state!==hn.SweepReady)return;const s=this.runtime.getNodeType(i);if(s!==Bt.DataStore&&s!==Bt.Blob)return;const o=`Deleted-${i}`;this.loggedUnreferencedEvents.has(o)||(this.loggedUnreferencedEvents.add(o),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:i,type:s,age:t-r.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))})}inactiveNodeUsed(e,t,r,i,s,o=this.runtime.getCurrentReferenceTimestampMs(),a){if(o===void 0||r.state===hn.Active||!this.isSummarizerClient&&e!=="Loaded")return;const l=this.runtime.getNodeType(t);if(l!==Bt.DataStore&&l!==Bt.Blob)return;const c=r.state,u=`${c}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(u))return;this.loggedUnreferencedEvents.add(u);const d={id:t,type:l,unrefTime:r.unreferencedTimestampMs,age:o-r.unreferencedTimestampMs,timeout:r.state===hn.Inactive?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:a==null?void 0:a[Wi.externalRequest],viaHandle:a==null?void 0:a[Wi.viaHandle],fromId:i};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},d),{usageType:e,state:c})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},d),{eventName:`${c}Object_${e}`,pkg:s?{value:s.join("/"),tag:ke.CodeArtifact}:void 0}))}async logUnreferencedEvents(e){for(const t of this.pendingEventsQueue){const{usageType:r,state:i}=t,s=jG(t,["usageType","state"]),o=this.unreferencedNodesState.get(t.id),a=o===void 0||o.state===hn.Active;if(r==="Revived"===a){const l=await this.getNodePackagePath(t.id),c=t.fromId?await this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},s),{eventName:`${i}Object_${r}`,pkg:l?{value:l.join("/"),tag:ke.CodeArtifact}:void 0,fromPkg:c?{value:c.join("/"),tag:ke.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]}};async function J_(n,e){let t={gcNodes:{}};for(const r of Object.keys(n.blobs)){if(!r.startsWith(MR))continue;const i=n.blobs[r];if(i===void 0)continue;const s=await e(i);O(s!==void 0,685),t=cG(t,s)}return t}function nm(n){const e=Object.entries(n.gcNodes);e.sort(([r],[i])=>r.localeCompare(i));const t={gcNodes:{}};for(const[r,i]of e)i.outboundRoutes.sort(),t.gcNodes[r]=i;return t}function Jd(n,e,t){let i;if(n>2147483647){const s=n-2147483647;i=setTimeout(()=>Jd(s,e,t),2147483647)}else i=setTimeout(()=>e(),n);t(i)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function FR(n){return n.summaryFormatVersion?n.summaryFormatVersion:n.snapshotFormatVersion==="0.1"?1:0}function zR(n){return!!n.summaryFormatVersion&&!n.disableIsolatedChannels}const ZG=n=>n===void 0?void 0:{clientId:n.clientId,clientSequenceNumber:n.clientSequenceNumber,minimumSequenceNumber:n.minimumSequenceNumber,referenceSequenceNumber:n.referenceSequenceNumber,sequenceNumber:n.sequenceNumber,timestamp:n.timestamp,type:n.type},Q_=".aliases",pv=".metadata",X_=".chunks",Y_=".electedSummarizer",mv=".blobs";function e9(n){return!!n&&!n.disableIsolatedChannels}function Z_(n){var e;return n&&(e=n.gcFeature)!==null&&e!==void 0?e:0}const t9=".protocol",n9=[t9,".logTail",".serviceProtocol",mv,ki],Qs=".component";function Qd(n){n.summary={type:Hi.Tree,tree:{[te.channelsTreeName]:n.summary}},n.stats.treeNodeCount++}async function r9(n,e){const t=await at(n,e.blobs[Qs]),r=FR(t);return O(r>0,469),t}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Z0(n,e,t){const r=JSON.stringify(n);return t?{pkg:r,snapshotFormatVersion:"0.1",isRootDataStore:e}:{pkg:r,summaryFormatVersion:2,isRootDataStore:e}}function i9(n,e,t){const r=Z0(n,e,t);return new fP(Qs,JSON.stringify(r))}class jc extends La{constructor(e,t,r,i,s){super(),this.existing=t,this.bindState=r,this.isLocalDataStore=i,this.makeLocallyVisibleFn=s,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=e.runtime,this.id=e.id,this.storage=e.storage,this.scope=e.scope,this.writeGCDataAtRoot=e.writeGCDataAtRoot,this.disableIsolatedChannels=e.disableIsolatedChannels,this.pkg=e.pkg,O(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==Z.Detached&&this.existing?this.containerRuntime.attachState:Z.Detached,this.bindToContext=()=>{O(this.bindState===pn.NotBound,315),this.bindState=pn.Binding,O(this.channel!==void 0,316),this.makeLocallyVisible(),this.bindState=pn.Bound};const o=async(a,l,c)=>this.summarizeInternal(a,l,c);this.summarizerNode=e.createSummarizerNodeFn(o,async a=>this.getGCDataInternal(a),async()=>this.getBaseGCDetails()),this.subLogger=ue.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new cP(jc.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return O(this.pkg!==void 0,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}async isRoot(){return this.isInMemoryRoot()||(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then(e=>{e.dispose()}).catch(e=>{}))}rejectDeferredRealize(e,t){throw new oe(e,{packageName:{value:t,tag:ke.PackageData}})}async realize(){return O(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new Dt,this.realizeCore(this.existing).catch(e=>{var t;const r=_n.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");r.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"RealizeError"},r)})),this.channelDeferred.promise}async factoryFromPackagePath(e){O(this.pkg===e,318),e===void 0&&this.rejectDeferredRealize("packages is undefined");let t,r=this._containerRuntime.IFluidDataStoreRegistry,i;for(const o of e)r||this.rejectDeferredRealize("No registry for package",i),i=o,t=await r.get(o),t||this.rejectDeferredRealize("Registry does not contain entry for the package",o),r=t.IFluidDataStoreRegistry;const s=t==null?void 0:t.IFluidDataStoreFactory;return s===void 0&&this.rejectDeferredRealize("Can't find factory for package",i),{factory:s,registry:r}}async realizeCore(e){const t=await this.getInitialSnapshotDetails();this._baseSnapshot=t.snapshot;const r=t.pkg,{factory:i,registry:s}=await this.factoryFromPackagePath(r);O(this.registry===void 0,319),this.registry=s;const o=await i.instantiateDataStore(this,e);O(o!==void 0,320),this.bindRuntime(o)}setConnectionState(e,t){this.verifyNotClosed(),this.loaded&&(O(this.connected===e,321),this.channel.setConnectionState(e,t))}process(e,t,r){var i;this.verifyNotClosed();const s=e.contents,o=Object.assign(Object.assign({},e),{type:s.type,contents:s.content});if(this.summarizerNode.recordChange(o),this.loaded)return(i=this.channel)===null||i===void 0?void 0:i.process(o,t,r);O(!t,322),O(this.pending!==void 0,573),this.pending.push(o),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(e,t){var r;this.verifyNotClosed(),this.loaded&&((r=this.channel)===null||r===void 0||r.processSignal(e,t))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){await this.realize();const i=await this.channel.summarize(e,t,r);let s;this.disableIsolatedChannels||(Qd(i),s=[te.channelsTreeName]);const{pkg:o}=await this.getInitialSnapshotDetails(),a=await this.isRoot(),l=Z0(o,a,this.disableIsolatedChannels);return yr(i,Qs,JSON.stringify(l)),this.writeGCDataAtRoot||yr(i,te.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(i.summary.unreferenced=!0,i.stats.unreferencedBlobSize=i.stats.totalBlobSize),Object.assign(Object.assign({},i),{id:this.id,pathPartsForChildren:s})}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return await this.realize(),O(this.channel!==void 0,323),this.channel.getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}updateChannelUsedRoutes(){if(O(this.loaded,324),O(this.channel!==void 0,325),this.lastUsedState===void 0)return;const e=this.lastUsedState.usedRoutes.filter(t=>t!=="/"&&t!=="");this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}async request(e){return(await this.realize()).request(e)}submitMessage(e,t,r){this.verifyNotClosed(),O(!!this.channel,326);const i={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,i,r)}setChannelDirty(e){this.verifyNotClosed();const t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);const r=this.summarizerNode.getChild(e);r&&r.invalidate(t)}submitSignal(e,t){return this.verifyNotClosed(),O(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}makeLocallyVisible(){O(this.channel!==void 0,719),this.makeLocallyVisibleFn()}bindRuntime(e){var t;if(this.channel)throw new Error("Runtime already bound");try{O(!this.detachedRuntimeCreation,328),O(this.channelDeferred!==void 0,329),O(this.pkg!==void 0,330);const r=this.pending;for(const i of r)e.process(i,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",r.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(r){(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},r)}}async getAbsoluteUrl(e){if(this.attachState===Z.Attached)return this._containerRuntime.getAbsoluteUrl(e)}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(e,t){O(!!this.channel,331);const r=e;this.channel.reSubmit(r.type,r.content,t)}rollback(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");const r=e;this.channel.rollback(r.type,r.content,t)}async applyStashedOp(e){this.channel||await this.realize(),O(!!this.channel,332);const t=e;return this.channel.applyStashedOp(t.content)}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(e,t){return(r,i,s)=>this.summarizerNode.createChild(r,e,t,{throwOnFailure:!0},i,s)}async uploadBlob(e){return this.containerRuntime.uploadBlob(e)}}jc.pendingOpsCountThreshold=1e3;class eE extends jc{constructor(e){super(e,!0,pn.Bound,!1,()=>{throw new Error("Already attached")}),this.initialSnapshotDetailsP=new Qo(async()=>{var t,r;let i,s=!0;if(typeof this.initSnapshotValue=="string"){const a=(await this.storage.getVersions(this.initSnapshotValue,1))[0];i=(t=await this.storage.getSnapshotTree(a))!==null&&t!==void 0?t:void 0}else i=this.initSnapshotValue;const o=async a=>at(this.storage,a);if(i){const a=await this.summarizerNode.loadBaseSummary(i,o);i=a.baseSummary,this.pending=a.outstandingOps.concat(this.pending)}if(i&&i.blobs[Qs]!==void 0){const a=await o(i.blobs[Qs]);let l;FR(a)<1?a.pkg.startsWith('["')&&a.pkg.endsWith('"]')?l=JSON.parse(a.pkg):l=[a.pkg]:l=JSON.parse(a.pkg),this.pkg=l,s=(r=a.isRootDataStore)!==null&&r!==void 0?r:!0,zR(a)&&(i=i.trees[te.channelsTreeName],O(i!==void 0,510))}return{pkg:this.pkg,isRootDataStore:s,snapshot:i}}),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new Qo(async()=>{var t;return(t=await e.getBaseGCDetails())!==null&&t!==void 0?t:{}})}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}async getInitialGCSummaryDetails(){return this.getBaseGCDetails()}async getBaseGCDetails(){return this.baseGCDetailsP}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class $R extends jc{constructor(e){super(e,e.snapshotTree!==void 0,e.snapshotTree?pn.Bound:pn.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,e.isRootDataStore===!0&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",()=>{O(this.attachState===Z.Detached,333),this._attachState=Z.Attaching}),this.once("attached",()=>{O(this.attachState===Z.Attaching,334),this._attachState=Z.Attached})}generateAttachMessage(){O(this.channel!==void 0,335),O(this.pkg!==void 0,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||Qd(e);const t=Z0(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);yr(e,Qs,JSON.stringify(t));const r=B0(e.summary);return{id:this.id,snapshot:r,type:this.pkg[this.pkg.length-1]}}async getInitialSnapshotDetails(){var e;let t=this.snapshotTree,r,i=!1;return t!==void 0&&(r=await r9(this.storage,t),zR(r)&&(t=t.trees[te.channelsTreeName],O(t!==void 0,511)),this.pkg===void 0&&(this.pkg=JSON.parse(r.pkg),(!((e=r.isRootDataStore)!==null&&e!==void 0)||e)&&(i=!0,this.setInMemoryRoot()))),O(this.pkg!==void 0,338),{pkg:this.pkg,isRootDataStore:i,snapshot:t}}async getInitialGCSummaryDetails(){return{}}async getBaseGCDetails(){return{}}}class tE extends $R{constructor(e){super(e)}}class s9 extends $R{constructor(e){super(e),this.detachedRuntimeCreation=!0}async attachRuntime(e,t){O(this.detachedRuntimeCreation,340),O(this.channelDeferred===void 0,341);const r=e.IFluidDataStoreFactory,i=await this.factoryFromPackagePath(this.pkg);O(i.factory===r,342),O(this.registry===void 0,343),this.registry=i.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new Dt,super.bindRuntime(t),await this.isRoot()&&(t.makeVisibleAndAttachGraph!==void 0?t.makeVisibleAndAttachGraph():t.bindToContext())}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const jR=n=>typeof(n==null?void 0:n.internalId)=="string"&&typeof(n==null?void 0:n.alias)=="string",rm=(n,e,t,r,i)=>new o9(n,e,t,r,i);var ur;(function(n){n.Aliased="Aliased",n.Aliasing="Aliasing",n.None="None"})(ur||(ur={}));class o9{constructor(e,t,r,i,s){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=r,this.datastores=i,this.logger=s,this.aliasState=ur.None}async trySetAlias(e){if(e.includes("/"))throw new ye(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case ur.Aliasing:return O(this.aliasResult!==void 0,790),await this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case ur.Aliased:return this.alias===e?"Success":"AlreadyAliased";case ur.None:break;default:dv(this.aliasState)}return this.aliasState=ur.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult}async trySetAliasInternal(e){const t={internalId:this.internalId,alias:e};if(this.fluidDataStoreChannel.makeVisibleAndAttachGraph!==void 0?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===Z.Detached){const i=this.datastores.processAliasMessageCore(t);return this.aliasState=ur.Aliased,i?"Success":"Conflict"}return await this.ackBasedPromise(i=>{this.runtime.submitDataStoreAliasOp(t,i)}).then(i=>(this.aliasState=ur.Aliased,i&&(this.alias=e),i)).catch(i=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:ke.UserData},internalId:{value:this.internalId,tag:ke.PackageData}},i),this.aliasState=ur.None,!1))?"Success":"Conflict"}async request(e){return this.fluidDataStoreChannel.request(e)}get IFluidRouter(){return this.fluidDataStoreChannel}async ackBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class a9{constructor(e,t,r,i,s,o,a,l,c,u,d=new $G(o)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=r,this.getCreateChildSummarizerNodeFn=i,this.deleteChildSummarizerNodeFn=s,this.gcNodeUpdated=l,this.aliasMap=c,this.writeGCDataAtRoot=u,this.contexts=d,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new V0(()=>this.contexts.dispose()),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=ue.create(o),this.containerRuntimeHandle=new Yo(this.runtime,"/",this.runtime.IFluidHandleContext);const h=new Qo(async()=>a()),f=async S=>(await h).get(S),p=new Map;if(e)for(const[S,m]of Object.entries(e.trees))p.set(S,m);let g=0;for(const[S,m]of p){let v;if(m.unreferenced&&g++,this.runtime.attachState!==Z.Detached)v=new eE({id:S,snapshotTree:m,getBaseGCDetails:async()=>f(S),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(S,{type:te.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if(typeof m!="object")throw new oe("Snapshot should be there to load from!!");const y=m;v=new tE({id:S,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(S,{type:te.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(S),snapshotTree:y,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(v)}this.containerLoadStats={containerLoadDataStoreCount:p.size,referencedDataStoreCount:p.size-g}}aliases(){return this.aliasMap}processAttachMessage(e,t){var r,i;const s=e.contents;if(this.dataStoresSinceLastGC.push(s.id),t){O(this.pendingAttach.has(s.id),350),(r=this.contexts.get(s.id))===null||r===void 0||r.emit("attached"),this.pendingAttach.delete(s.id);return}if(this.alreadyProcessed(s.id))throw new wr("Duplicate DataStore created with existing id",Object.assign(Object.assign({},Gs(e)),{dataStoreId:{value:s.id,tag:ke.PackageData}}));const o=new Map;let a;s.snapshot&&(a=mP(s.snapshot.entries,o));const l=[s.type],c=new eE({id:s.id,snapshotTree:a,getBaseGCDetails:async()=>({}),runtime:this.runtime,storage:new J4(this.runtime.storage,o),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(s.id,{type:te.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:(i=s.snapshot)!==null&&i!==void 0?i:{entries:[i9(l,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:l});this.contexts.addBoundOrRemoted(c)}processAliasMessage(e,t,r){const i=e.contents;if(!jR(i))throw new wr("malformedDataStoreAliasMessage",Object.assign({},Gs(e)));const s=t,o=this.processAliasMessageCore(i);r&&s(o)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(t===void 0)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const r=new Yo(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return this.aliasMap.get(e)!==void 0||this.contexts.get(e)!==void 0}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if(O(!!t,351),this.runtime.attachState!==Z.Detached){t.emit("attaching");const r=t.generateAttachMessage();this.pendingAttach.set(e,r),this.submitAttachFn(r),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,r=Ze()){O(!r.includes("/"),780);const i=new s9({id:r,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(r,{type:te.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(r),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(i),i}_createFluidDataStoreContext(e,t,r,i){O(!t.includes("/"),781);const s=new tE({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:te.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:r,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:i});return this.contexts.addUnbound(s),s}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);O(!!i,352),i.reSubmit(r.contents,t)}rollbackDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);O(!!i,744),i.rollback(r.contents,t)}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return O(!!r,353),r.applyStashedOp(t.contents)}async applyStashedAttachOp(e){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)}processFluidDataStoreOp(e,t,r){const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);O(!!o,354),o.process(s,t,r),this.gcNodeUpdated(`/${i.address}`,e.timestamp,o.isLoaded?o.packagePath:void 0)}async getDataStore(e,t){const r=await this.contexts.getBoundOrRemoted(e,t);if(r===void 0)throw Wh(An({url:e}));return r}processSignal(e,t,r){const i=this.contexts.get(e);if(!i){O(!r,355),this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:ke.PackageData}});return}i.processSignal(t,r)}setConnectionState(e,t){for(const[r,i]of this.contexts)try{i.setConnectionState(e,t)}catch(s){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:r},s)}}setAttachState(e){let t;e===Z.Attaching?t="attaching":t="attached";for(const[,r]of this.contexts)this.contexts.isNotBound(r.id)||r.emit(t)}get size(){return this.contexts.size}async summarize(e,t,r){const i=new Kt;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>(O(o.attachState!==Z.Attaching,357),o.attachState===Z.Attached)).map(async([s,o])=>{const a=await o.summarize(e,t,r);i.addWithStats(s,a)})),i.getSummaryTree()}createSummary(e){const t=new Kt;let r;do{const i=t.summary.tree;r=this.contexts.notBoundLength(),Array.from(this.contexts).filter(([s,o])=>!(this.contexts.isNotBound(s)||i[s]||this.attachOpFiredForDataStore.has(s))).map(([s,o])=>{let a;if(o.isLoaded){const l=o.generateAttachMessage().snapshot;a=j0(l,!0)}else O(!!this.baseSnapshot,358),a=q0(this.baseSnapshot.trees[s]);t.addWithStats(s,a)})}while(r!==this.contexts.notBoundLength());return t.getSummaryTree()}async updateStateBeforeGC(){for(const e of this.dataStoresSinceLastGC){const t=this.contexts.get(e);if(O(t!==void 0,694),await t.isRoot()){const r=new Yo(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r)}}this.dataStoresSinceLastGC=[]}async getGCData(e=!1){const t=new H0;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>i.attachState===Z.Attached).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),t.addNode("/",await this.getOutboundRoutes()),t.getGCData()}updateUsedRoutes(e,t){var r;const i=PR(e);for(const[s]of i)O(this.contexts.has(s),359);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}deleteUnusedRoutes(e){for(const t of e){const r=t.split("/");if(r.length>2)continue;const i=r[1];O(this.contexts.has(i),727),this.contexts.delete(i),this.deleteChildSummarizerNodeFn(i)}}async getOutboundRoutes(){const e=[];for(const[t,r]of this.contexts)await r.isRoot()&&e.push(`/${t}`);return e}async getDataStorePackagePath(e){var t;const r=this.contexts.get(e.split("/")[1]);return(t=await(r==null?void 0:r.getInitialSnapshotDetails()))===null||t===void 0?void 0:t.pkg}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return t.length===2?Bt.DataStore:Bt.SubDataStore}}function qR(n,e){if(n)if(e9(e)){const t=n.trees[te.channelsTreeName];return O(!!t,360),t}else{const t={};for(const[r,i]of Object.entries(n.trees))n9.includes(r)||(t[r]=i);return Object.assign(Object.assign({},n),{trees:t})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Br;(function(n){n[n.Local=0]="Local",n[n.Broadcast=1]="Broadcast",n[n.Acked=2]="Acked",n[n.Nacked=-1]="Nacked"})(Br||(Br={}));class hc{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=Br.Local,this.defSummaryOp=new Dt,this.defSummaryAck=new Dt}static createLocal(e,t){return new hc(e,t)}static createFromOp(e){const t=new hc(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===Br.Acked}broadcast(e){return O(this.state===Br.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=Br.Broadcast,!0}ackNack(e){return O(this.state===Br.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===Ye.SummaryAck?Br.Acked:Br.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class l9{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=hc.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class c9 extends La{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new Dt,this.deltaManager.on("op",r=>this.handleOp(r))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-((t=(e=this.lastAck)===null||e===void 0?void 0:e.summaryAck.sequenceNumber)!==null&&t!==void 0?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new l9(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const e=Array.from(this.pendingSummaries,([,t])=>t.waitAckNack());await Promise.all(e)}return this.lastAck}async waitSummaryAck(e){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)await this.refreshWaitNextAck.promise;return this.lastAck}handleOp(e){var t;switch(e.type){case Ye.Summarize:{this.handleSummaryOp(e);return}case Ye.SummaryAck:{this.handleSummaryAck(e);return}case Ye.SummaryNack:{this.handleSummaryNack(e);return}default:{const r=e.timestamp;this.lastSummaryTimestamp!==void 0&&this.maxAckWaitTime!==void 0&&r-this.lastSummaryTimestamp>=this.maxAckWaitTime&&((t=this.pendingAckTimerTimeoutCallback)===null||t===void 0||t.call(this)),this.emit("default",e);return}}}handleSummaryOp(e){let t;const r=this.summaryWatchers.get(e.clientId);r&&(t=r.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=hc.createFromOp(e),r&&r.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(Ye.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);if(!r||r.summaryOp===void 0){t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber});return}r.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:r.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new Dt,this.emit(Ye.SummaryAck,e))}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);r&&(r.ackNack(e),this.pendingSummaries.delete(t),this.emit(Ye.SummaryNack,e))}}class u9 extends La{constructor(e,t,r){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=ue.create(e,"OrderedClientCollection");const i=r.getMembers();for(const[s,o]of i)this.addClient(s,o);r.on("addMember",(s,o)=>{const a=this.addClient(s,o);this.emit("addClient",a,t.lastSequenceNumber)}),r.on("removeMember",s=>{const o=t.lastSequenceNumber,a=this.removeClient(s);a===void 0?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:s,sequenceNumber:o}):this.emit("removeClient",a,o)})}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){O(t.sequenceNumber>-1,502);let r=this._youngestClient;for(;r.sequenceNumber>t.sequenceNumber;)O(r.olderClient!==void 0,503),r=r.olderClient;const i={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:r,youngerClient:r.youngerClient};return i.olderClient.youngerClient=i,i.youngerClient===void 0?this._youngestClient=i:i.youngerClient.olderClient=i,this.clientMap.set(e,i),i}removeClient(e){const t=this.clientMap.get(e);if(t!==void 0)return t.olderClient.youngerClient=t.youngerClient,t.youngerClient===void 0?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;t.youngerClient!==void 0;)e.push(t.youngerClient),t=t.youngerClient;return e}}class d9 extends La{constructor(e,t,r,i){super(),this.orderedClientCollection=t,this.isEligibleFn=i,this._eligibleCount=0;let s,o;for(const a of t.getAllClients())this.addClient(a,0),typeof r!="number"&&(a.clientId===r.electedClientId&&(s=a,r.electedParentId===void 0&&a.client.details.type!==Zt&&(o=a)),a.clientId===r.electedParentId&&(o=a));t.on("addClient",(a,l)=>this.addClient(a,l)),t.on("removeClient",(a,l)=>this.removeClient(a,l)),typeof r=="number"?this._electionSequenceNumber=r:((s==null?void 0:s.clientId)!==r.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId,clientCount:t.count}):s!==void 0&&!i(s)&&(s=o=this.findFirstEligibleParent(o),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId})),this._electedParent=o,this._electedClient=s,this._electionSequenceNumber=r.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let r=!1;const i=(e==null?void 0:e.client.details.type)===Zt,s=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,r=!0),this._electedParent!==e&&!i&&(this._electedParent=e,r=!0),r&&this.emit("election",e,t,s)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;t!==void 0&&(!this.isEligibleFn(t)||t.client.details.type===Zt);)t=t.youngerClient;return t}addClient(e,t){var r;if(this.isEligibleFn(e)){this._eligibleCount++;const i=e.client.details.type===Zt,s=((r=this._electedClient)===null||r===void 0?void 0:r.client.details.type)===Zt;this._electedClient===void 0||!s&&i?this.tryElectingClient(e,t):this._electedParent===void 0&&!i&&this.tryElectingParent(e,t)}}removeClient(e,t){var r,i,s,o,a;if(this.isEligibleFn(e)){if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==Zt)throw new ye("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const l=(i=this.findFirstEligibleParent((r=this._electedParent)===null||r===void 0?void 0:r.youngerClient))!==null&&i!==void 0?i:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(l,t)}else if(this._electedParent===e){if(((s=this._electedClient)===null||s===void 0?void 0:s.client.details.type)!==Zt)throw new ye("Elected client should be a summarizer client 2");const l=(a=this.findFirstEligibleParent((o=this._electedParent)===null||o===void 0?void 0:o.youngerClient))!==null&&a!==void 0?a:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(l,t)}}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,r;const i=(r=this.findFirstEligibleParent((t=this._electedParent)===null||t===void 0?void 0:t.youngerClient))!==null&&r!==void 0?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(i,e):this.tryElectingParent(i,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return(t=this.findFirstEligibleParent((e=this._electedParent)===null||e===void 0?void 0:e.youngerClient))!==null&&t!==void 0?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:(e=this.electedClient)===null||e===void 0?void 0:e.clientId,electedParentId:(t=this.electedParent)===null||t===void 0?void 0:t.clientId}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class h9{constructor(e,t,r){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=r,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(t!==void 0){const i=t-e;i>0&&(this.startTimes=this.startTimes.map(s=>s-i))}this.startTimes=this.startTimes.filter(i=>e-i<this.delayWindowMs);const r=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map(i=>i+r),r===this.maxDelayMs&&this.startTimes.shift(),r}}const f9=({multiplier:n=2,coefficient:e=1,offset:t=0,initialDelay:r=void 0}={})=>i=>Math.max(0,i<=0&&r!==void 0?r:e*Math.pow(n,i)+t);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */new Promise(()=>{});class eS{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new Dt}get cancelled(){return this._cancelled||O(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(e){const t=new eS(e);return await t.waitStart(),t}async waitStart(){if(this.runtime.disposed){this.stop("summarizerClientDisconnected");return}if(this.runtime.once("dispose",()=>this.stop("summarizerClientDisconnected")),!this.runtime.connected){const e=new Promise(t=>this.runtime.once("connected",t));await Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",()=>this.stop("summarizerClientDisconnected"))}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class p9{constructor(e,t,r,i,s=()=>mn.now()){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=ue.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",o=>{this.startBatchSequenceNumber=o.sequenceNumber,this.batchProcessingStartTimeStamp=s(),this.trackedBatchCount++}),this.batchEventEmitter.on("batchEnd",(o,a)=>{O(this.startBatchSequenceNumber!==void 0&&this.batchProcessingStartTimeStamp!==void 0,698);const l=a.sequenceNumber-this.startBatchSequenceNumber+1;l>=r&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:l,threshold:r,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp,batchError:o!==void 0}),this.trackedBatchCount%i===0&&this.logger.sendPerformanceEvent({eventName:"Length",length:l,samplingRate:i,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0})}}const m9=(n,e,t=1e3,r=1e3)=>new p9(n,e,t,r);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class im{constructor(e,t){this.storageGetter=e,this.blobs=t}static async serializeTree(e,t){const r={};return await this.serializeTreeCore(e,r,t),r}static async serializeTreeCore(e,t,r){const i=[];for(const s of Object.values(e.trees))i.push(this.serializeTreeCore(s,t,r));for(const s of Object.values(e.blobs)){const o=await r.readBlob(s);t[s]=q_(o,"utf8")}return Promise.all(i)}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const r of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(r,t);for(const r of Object.values(e.blobs)){const i=e.blobsContents[r];O(!!i,748),t[r]=q_(i,"utf8")}}get storage(){return this._storage?this._storage:(this._storage=this.storageGetter(),this._storage)}get repositoryUrl(){return this.storage.repositoryUrl}async readBlob(e){return this.blobs[e]!==void 0?mG(this.blobs[e],"utf8"):this.storage.readBlob(e)}async getSnapshotTree(e){return this.storage.getSnapshotTree(e)}async getVersions(e,t){return this.storage.getVersions(e,t)}async createBlob(e){return this.storage.createBlob(e)}async uploadSummaryWithContext(e,t){return this.storage.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storage.downloadSummary(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Ml{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,!t&&(e.inbound.on("push",r=>{var i;const s=typeof r.contents=="string"?r.contents:(i=JSON.stringify(r.contents))!==null&&i!==void 0?i:"",o=Ml.messageHasData(r)?r.data:"";this.messageSize[Ml.messageId(r)]=s.length+o.length}),e.on("op",r=>{var i;this._nonSystemOpCount+=oc(r)?1:0;const s=Ml.messageId(r);this._opsSizeAccumulator+=(i=this.messageSize[s])!==null&&i!==void 0?i:0,this.messageSize.delete(s)}))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return e.data!==void 0}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}var _e;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias"})(_e||(_e={}));const g9={state:"enabled",idleTime:5e3*3,maxTime:5e3*12,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6*10*1e3,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var Wi;(function(n){n.wait="wait",n.externalRequest="externalRequest",n.viaHandle="viaHandle"})(Wi||(Wi={}));const v9="Fluid.ContainerRuntime.UseDataStoreAliasing",y9="Fluid.ContainerRuntime.MaxConsecutiveReconnects",S9="Fluid.ContainerRuntime.MaxOpSizeInBytes",b9=768e3,w9="Fluid.ContainerRuntime.DisableOpTracking",C9=te.FlushMode.TurnBased;var nE;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(nE||(nE={}));function _9(n){if(n.type===Ye.Operation){if(n.contents.address!==void 0&&n.contents.type===void 0)n.type=_e.FluidDataStoreOp;else{const e=n.contents;O(e.type!==void 0,289),n.type=e.type,n.contents=e.contents}O(ac(n),290)}return n}class E9{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",i=>{if(i.length===0)return;const s=i[0].metadata;if(!(s!=null&&s.batch))return;if(i.length===1){delete s.batch;return}const o=i[i.length-1];o.metadata=Object.assign(Object.assign({},o.metadata),{batch:!1})}),this.deltaManager.inbound.on("push",i=>{this.trackPending(i)}),O(!this.localPaused,659);const r=this.deltaManager.inbound.toArray();for(const i of r)this.trackPending(i);this.deltaManager.on("op",i=>this.afterOpProcessing(i.sequenceNumber))}afterOpProcessing(e){if(O(!this.localPaused,660),this.deltaManager.inbound.length===0){O(this.pauseSequenceNumber===void 0,661);return}this.pauseSequenceNumber!==void 0&&(O(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue())}pauseQueue(){O(!this.localPaused,663),this.localPaused=!0,this.timePaused=mn.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const r=t.sequenceNumber,i=this.localPaused?mn.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3===1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:r,length:r-e+1,msnDistance:r-t.minimumSequenceNumber,duration:i,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,i!==void 0&&i>AR&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:i,sequenceNumber:r,length:r-e}),this.deltaManager.inbound.resume())}trackPending(e){O(this.deltaManager.inbound.length!==0,664),O(this.currentBatchClientId===void 0==(this.pauseSequenceNumber===void 0),665);const t=e.metadata,r=t==null?void 0:t.batch;if(!ac(e)){O(this.currentBatchClientId===void 0,666),O(r===void 0,667),O(!this.localPaused,668);return}if(this.currentBatchClientId===void 0&&r===void 0){O(!this.localPaused,669);return}if((this.currentBatchClientId!==void 0||r===!1)&&this.currentBatchClientId!==e.clientId)throw new wr("OpBatchIncomplete",Object.assign({runtimeVersion:Yu,batchClientId:this.currentBatchClientId},Gs(e)));r?(O(this.currentBatchClientId===void 0,670),O(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,this.deltaManager.inbound.length===1&&this.pauseQueue()):r===!1?(O(this.pauseSequenceNumber!==void 0,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):O(this.currentBatchClientId!==void 0,673)}}class T9{constructor(e,t,r){this.deltaManager=e,this.emitter=t,this.logger=r,this.hitError=!1,this.deltaScheduler=new dc(this.deltaManager,ue.create(this.logger,"DeltaScheduler")),new E9(e,r)}beforeOpProcessing(e){var t;this.batchClientId!==e.clientId&&(O(this.batchClientId===void 0,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e),((t=e==null?void 0:e.metadata)===null||t===void 0?void 0:t.batch)?this.batchClientId=e.clientId:this.batchClientId=void 0)}afterOpProcessing(e,t){var r;if(O(!this.hitError,675),e){this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),this.deltaScheduler.batchEnd(t);return}const i=(r=t==null?void 0:t.metadata)===null||r===void 0?void 0:r.batch;if(this.batchClientId===void 0||i===!1){this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),this.deltaScheduler.batchEnd(t);return}}}const rE="_scheduler";function x9(){try{if(typeof navigator=="object"&&navigator!==null)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch{}return{}}class tS extends La{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f,p){var g,S,m,v,y,b,w,x,E;p===void 0&&(p=Object.assign(Object.assign({},g9),(g=a.summaryOptions)===null||g===void 0?void 0:g.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=a,this.containerScope=l,this.logger=c,this._storage=h,this.requestHandler=f,this.summaryConfiguration=p,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...z)=>{if(this.clientDetails.type===Zt)return this.summarizer.summarizeOnDemand(...z);if(this.summaryManager!==void 0)return this.summaryManager.summarizeOnDemand(...z);throw new ye(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...z)=>{if(this.clientDetails.type===Zt)return this.summarizer.enqueueSummarize(...z);if(this.summaryManager!==void 0)return this.summaryManager.enqueueSummarize(...z);throw new ye(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=r==null?void 0:r.message,this.disableIsolatedChannels=(S=this.runtimeOptions.summaryOptions.disableIsolatedChannels)!==null&&S!==void 0?S:!1,this._connected=this.context.connected,this.chunkMap=new Map(s),this.handleContext=new yG("",this),this.mc=ka(ue.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=((m=this.mc.config.getBoolean(v9))!==null&&m!==void 0?m:!1)||((v=a.useDataStoreAliasing)!==null&&v!==void 0?v:!1),this._maxOpSizeInBytes=(y=this.mc.config.getNumber(S9))!==null&&y!==void 0?y:b9,this.maxConsecutiveReconnects=(b=this.mc.config.getNumber(y9))!==null&&b!==void 0?b:this.defaultMaxConsecutiveReconnects,this._flushMode=a.flushMode;const P=e.pendingLocalState,M=(w=P==null?void 0:P.baseSnapshot)!==null&&w!==void 0?w:e.baseSnapshot;this.garbageCollector=YG.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:M,baseLogger:this.mc.logger,existing:u,metadata:r,isSummarizerClient:this.context.clientDetails.type===Zt,getNodePackagePath:async z=>this.getGCNodePackagePath(z),getLastSummaryTimestampMs:()=>{var z;return(z=this.messageAtLastSummary)===null||z===void 0?void 0:z.timestamp},readAndParseBlob:async z=>at(this.storage,z)});const F=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=hG(ue.create(this.logger,"SummarizerNode"),async(z,X,V)=>this.summarizeInternal(z,X,V),F,M?F:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),M&&this.summarizerNode.loadBaseSummaryWithoutDifferential(M),this.dataStores=new a9(qR(M,r),this,z=>this.submit(_e.Attach,z),(z,X)=>(V,_,N)=>this.summarizerNode.createChild(V,z,X,void 0,_,N),z=>this.summarizerNode.deleteChild(z),this.mc.logger,async()=>this.garbageCollector.getBaseGCDetails(),(z,X,V)=>this.garbageCollector.nodeUpdated(z,"Changed",X,V),new Map(o),this.garbageCollector.writeDataAtRoot),this.blobManager=new gn(this.handleContext,d,()=>this.storage,z=>this.submit(_e.BlobAttach,void 0,void 0,{blobId:z}),z=>this.garbageCollector.nodeUpdated(z,"Loaded"),this,this.logger),this.scheduleManager=new T9(e.deltaManager,this,ue.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new zG({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:z=>this.setFlushMode(z)},this._flushMode,P==null?void 0:P.pending),this.context.quorum.on("removeMember",z=>{this.clearPartialChunks(z)}),this.summaryCollection=new c9(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==Z.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const z=ue.create(this.logger,"OrderedClientElection"),X=new u9(z,this.context.deltaManager,this.context.quorum),V=new d9(z,X,i??this.context.deltaManager.lastSequenceNumber,Xo.isClientEligible);if(this.summarizerClientElection=new Xo(z,this.summaryCollection,V,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===Zt)this._summarizer=new X0("/_summarizer",this,()=>this.summaryConfiguration,this,this.handleContext,this.summaryCollection,async _=>eS.create(_));else if(Xo.clientDetailsPermitElection(this.context.clientDetails)){const _=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(Ye.SummaryAck,()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",_)}),this.summaryCollection.off("default",_))};this.summaryCollection.on("default",_),this.summaryManager=new Qh(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new h9(60*1e3,30*1e3,f9({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}this.deltaManager.on("readonly",z=>{O(z===this.deltaManager.readOnlyInfo.readonly,292),O(!z||!this.connected,293),this.replayPendingStates()}),c.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},x9()));let G;u?(this.createContainerMetadata={createContainerRuntimeVersion:r==null?void 0:r.createContainerRuntimeVersion,createContainerTimestamp:r==null?void 0:r.createContainerTimestamp},G=(E=(x=r==null?void 0:r.summaryNumber)!==null&&x!==void 0?x:r==null?void 0:r.summaryCount)!==null&&E!==void 0?E:0):(this.createContainerMetadata={createContainerRuntimeVersion:Yu,createContainerTimestamp:Date.now()},G=0),this.nextSummaryNumber=G+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:G,summaryFormatVersion:r==null?void 0:r.summaryFormatVersion,disableIsolatedChannels:r==null?void 0:r.disableIsolatedChannels,gcVersion:r==null?void 0:r.gcFeature})),FG(this.context.clientId,this.deltaManager,this.logger),m9(this,this.logger),this.opTracker=new Ml(this.deltaManager,this.mc.config.getBoolean(w9)===!0)}get IContainerRuntime(){return this}get IFluidRouter(){return this}static async load(e,t,r,i={},s=e.scope,o){var a,l,c;const u=e,d=(a=u.taggedLogger)!==null&&a!==void 0?a:new H4(u.logger),h=ue.create(d,void 0,{all:{runtimeVersion:Yu}}),{summaryOptions:f={},gcOptions:p={},loadSequenceNumberVerification:g="close",useDataStoreAliasing:S=!1,flushMode:m=C9,enableOfflineLoad:v=!1}=i,y=e.pendingLocalState,b=(l=y==null?void 0:y.baseSnapshot)!==null&&l!==void 0?l:e.baseSnapshot,w=y?new im(()=>e.storage,y.snapshotBlobs):e.storage,x=new G0(t),E=async N=>{const W=b==null?void 0:b.blobs[N];if(b&&W)return O(w!==void 0,501),at(w,W)},[P,M,F,G]=await Promise.all([E(X_),E(pv),E(Y_),E(Q_)]),z=o===!0||e.existing===!0,X=await gn.load(b==null?void 0:b.trees[mv],async N=>(O(w!==void 0,598),at(w,N))),V=(c=M==null?void 0:M.message)===null||c===void 0?void 0:c.sequenceNumber;if(!y&&V!==void 0){const N=e.deltaManager.initialSequenceNumber;if(g!=="bypass"&&V!==N){const W=new wr("Summary metadata mismatch",{runtimeVersion:Yu,runtimeSequenceNumber:V,protocolSequenceNumber:N});g==="log"?h.sendErrorEvent({eventName:"SequenceNumberMismatch"},W):e.closeFn(W)}}const _=new tS(e,x,M,F,P??[],G??[],{summaryOptions:f,gcOptions:p,loadSequenceNumberVerification:g,useDataStoreAliasing:S,flushMode:m,enableOfflineLoad:v},s,h,z,X,w,r);return y&&(await _.processSavedOps(y),y.savedOps=[]),await _.getSnapshotBlobs(),_}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return(e=this.summarizerClientElection)===null||e===void 0?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return O(this._summarizer!==void 0,599),this._summarizer}isSummariesDisabled(){return this.runtimeOptions.summaryOptions.disableSummaries===!0?!0:this.summaryConfiguration.state==="disabled"}isHeuristicsDisabled(){var e;return((e=this.runtimeOptions.summaryOptions.summarizerOptions)===null||e===void 0?void 0:e.disableHeuristics)===!0?!0:this.summaryConfiguration.state==="disableHeuristics"}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))!==null&&e!==void 0?e:!0:this.runtimeOptions.summaryOptions.summarizerClientElection===!0?!0:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.summarizerClientElection===!0:!1}getMaxOpsSinceLastSummary(){return this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary!==void 0?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return this.runtimeOptions.summaryOptions.initialSummarizerDelayMs!==void 0?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),this.summaryManager!==void 0&&this.summaryManager.dispose(),this.garbageCollector.dispose(),(t=this._summarizer)===null||t===void 0||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(!((e=this.options)===null||e===void 0)&&e.intelligence)return{intelligence:this.options.intelligence}}async request(e){try{const t=Cr.create(e);return t.pathParts[0]==="_summarizer"&&t.pathParts.length===1?this._summarizer!==void 0?{status:200,mimeType:"fluid/object",value:this.summarizer}:An(e):this.requestHandler!==void 0?this.requestHandler(t,this):An(e)}catch(t){return Wd(t)}}async resolveHandle(e){try{const t=Cr.create(e),r=t.pathParts[0];if(r==="_channels")return this.resolveHandle(t.createSubRequest(1));if(r===gn.basePath&&t.isLeaf(2)){const i=await this.blobManager.getBlob(t.pathParts[1]);return i?{status:200,mimeType:"fluid/object",value:i.get()}:An(e)}else if(t.pathParts.length>0){const i=await this.getDataStoreFromRequest(r,e),s=t.createSubRequest(1);return O(s.url.startsWith("/"),294),i.IFluidRouter.request(s)}return An(e)}catch(t){return Wd(t)}}internalId(e){var t;return(t=this.dataStores.aliases().get(e))!==null&&t!==void 0?t:e}async getDataStoreFromRequest(e,t){var r,i,s;const o=typeof((r=t.headers)===null||r===void 0?void 0:r[Wi.wait])=="boolean"?(i=t.headers)===null||i===void 0?void 0:i[Wi.wait]:!0,a=this.internalId(e),l=await this.dataStores.getDataStore(a,o);if(!((s=t.headers)===null||s===void 0)&&s[Wi.externalRequest]&&this.garbageCollector.shouldRunGC){const d=(await l.getBaseGCDetails()).usedRoutes;if(!(d===void 0||d.includes("")||d.includes("/")))throw Wh(An(t))}const c=await l.realize(),u=sG(t.url.split("?")[0]);return this.garbageCollector.nodeUpdated(`/${u}`,"Loaded",void 0,l.packagePath,t==null?void 0:t.headers),c}addMetadataToSummary(e){var t;const r=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:(t=ZG(this.deltaManager.lastMessage))!==null&&t!==void 0?t:this.messageAtLastSummary});yr(e,pv,JSON.stringify(r))}addContainerStateToSummary(e,t,r,i){var s;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const l=JSON.stringify([...this.chunkMap]);yr(e,X_,l)}const o=this.dataStores.aliases();if(o.size>0&&yr(e,Q_,JSON.stringify([...o])),this.summarizerClientElection){const l=JSON.stringify((s=this.summarizerClientElection)===null||s===void 0?void 0:s.serialize());yr(e,Y_,l)}const a=this.blobManager.summarize();if(Object.keys(a.summary.tree).length>0&&Z5(e,mv,a),this.garbageCollector.writeDataAtRoot){const l=this.garbageCollector.summarize(t,r,i);l!==void 0&&eG(e,ki,l)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0?!0:this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0)}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;this.dirtyContainer=!1,O(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;let t;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}async applyStashedOp(e,t){switch(e){case _e.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case _e.Attach:return this.dataStores.applyStashedAttachOp(t);case _e.Alias:case _e.BlobAttach:return;case _e.ChunkedOp:throw new Error("chunkedOp not expected here");case _e.Rejoin:throw new Error("rejoin not expected here");default:dv(e,`Unknown ContainerMessageType: ${e}`)}}setConnectionState(e,t){this.verifyNotClosed();const r=this._connected!==e,i=r&&e;if(this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),i&&(this.consecutiveReconnects++,!this.shouldContinueReconnecting())){this.closeFn(_n.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}));return}r&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),d0(this.mc.logger,this,e,t)}process(e,t){var r,i;if(this.verifyNotClosed(),!ac(e))return;((r=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&r!==void 0?r:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let s=Object.assign({},e);this.scheduleManager.beforeOpProcessing(s);try{s=_9(s),s=this.processRemoteChunkedMessage(s);let o;switch(t&&s.type!==_e.ChunkedOp&&(o=this.pendingStateManager.processPendingLocalMessage(s)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),s.type){case _e.Attach:this.dataStores.processAttachMessage(s,t);break;case _e.Alias:this.processAliasMessage(s,o,t);break;case _e.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(s,t,o);break;case _e.BlobAttach:O((i=s==null?void 0:s.metadata)===null||i===void 0?void 0:i.blobId,298),this.blobManager.processBlobAttachOp(s.metadata.blobId,t);break;default:}this.emit("op",s),this.scheduleManager.afterOpProcessing(void 0,s),t&&this.resetReconnectCount()}catch(o){throw this.scheduleManager.afterOpProcessing(o,s),o}}processAliasMessage(e,t,r){this.dataStores.processAliasMessage(e,t,r)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const r=e.content,i={clientId:e.clientId,content:r.contents.content,type:r.contents.type};if(e.clientId===this.clientId&&this.connected&&(this._perfSignalData.trackingSignalSequenceNumber!==void 0&&r.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:r.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:r.clientSignalSequenceNumber})):r.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(r.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),r.address===void 0){this.emit("signal",i,t);return}this.dataStores.processSignal(r.address,i,t)}async getRootDataStore(e,t=!0){const r=this.internalId(e),i=await this.dataStores.getDataStore(r,t);return O(await i.isRoot(),299),i.realize()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===te.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(O(this._orderSequentiallyCalls===0,588),!!this.deltaSender&&(this.pendingStateManager.onFlush(),!!this.needsFlush&&(this.needsFlush=!1,!!this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===te.FlushMode.TurnBased){this.trackOrderSequentiallyCalls(e);return}const t=this.flushMode;this.setFlushMode(te.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(r){throw t?t.rollback():this.closeFn(new Gr("orderSequentially callback exception",r)),r}finally{this._orderSequentiallyCalls--}}async createDataStore(e){const t=Ze();return rm(await this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)}async createRootDataStoreLegacy(e,t){const r=await this._createDataStore(e,!0,t);return r.makeVisibleAndAttachGraph!==void 0?r.makeVisibleAndAttachGraph():r.bindToContext(),r}async createRootDataStore(e,t){if(t.includes("/"))throw new ye(`Id cannot contain slashes: '${t}'`);return this._aliasingEnabled===!0?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)}async createAndAliasDataStore(e,t,r){const i=Ze(),s=await this._createDataStore(e,!1,i,r),o=rm(s,i,this,this.dataStores,this.mc.logger),a=await o.trySetAlias(t);if(a!=="Success")throw new Gr("dataStoreAliasFailure",void 0,{alias:{value:t,tag:ke.UserData},internalId:{value:i,tag:ke.PackageData},aliasResult:a});return o}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new ye(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}async _createDataStoreWithPropsLegacy(e,t,r=Ze(),i=!1){const s=await this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,i,t).realize();return i&&(s.makeVisibleAndAttachGraph!==void 0?s.makeVisibleAndAttachGraph():s.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:t!==void 0})),rm(s,r,this,this.dataStores,this.mc.logger)}async _createDataStoreWithProps(e,t,r=Ze(),i=!1){return this._aliasingEnabled===!0&&i?this.createAndAliasDataStore(e,r,t):this._createDataStoreWithPropsLegacy(e,t,r,i)}async _createDataStore(e,t,r=Ze(),i){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,t,i).realize()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===_e.Attach){if(t.id===rE)return!1}else if(e===_e.FluidDataStoreOp&&t.address===rE)return!1;return!0}createNewSignalEnvelope(e,t,r){const i=++this._perfSignalData.signalSequenceNumber,s={address:e,clientSignalSequenceNumber:i,contents:{type:t,content:r}};return i%this.defaultTelemetrySignalSampleCount===1&&this._perfSignalData.trackingSignalSequenceNumber===void 0&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=i),s}submitSignal(e,t){this.verifyNotClosed();const r=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(r)}submitDataStoreSignal(e,t,r){const i=this.createNewSignalEnvelope(e,t,r);return this.context.submitSignalFn(i)}setAttachState(e){e===Z.Attaching?O(this.attachState===Z.Attaching,301):(O(this.attachState===Z.Attached,302),this.emit("attached")),e===Z.Attached&&!this.pendingStateManager.hasPendingMessages()&&this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const r=this.dataStores.createSummary(t);return this.disableIsolatedChannels||Qd(r),this.addContainerStateToSummary(r,!0,!1,t),r.summary}async getAbsoluteUrl(e){if(this.context.getAbsoluteUrl===void 0)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===Z.Attached)return this.context.getAbsoluteUrl(e)}async summarizeInternal(e,t,r){const i=await this.dataStores.summarize(e,t,r);let s;return this.disableIsolatedChannels||(Qd(i),s=[te.channelsTreeName]),this.addContainerStateToSummary(i,e,t,r),Object.assign(Object.assign({},i),{id:"",pathPartsForChildren:s})}async summarize(e){this.verifyNotClosed();const{fullTree:t=!1,trackState:r=!0,summaryLogger:i=this.mc.logger,runGC:s=this.garbageCollector.shouldRunGC,runSweep:o,fullGC:a}=e;let l;s&&(l=await this.collectGarbage({logger:i,runSweep:o,fullGC:a}));const c=new nG,{stats:u,summary:d}=await this.summarizerNode.summarize(t,r,c);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:c.serialize()}),O(d.type===Hi.Tree,303),{stats:u,summary:d,gcStats:l}}async updateStateBeforeGC(){return this.dataStores.updateStateBeforeGC()}async getGCData(e){const t=new H0,r=await this.dataStores.getGCData(e);t.addNodes(r.gcNodes);const i=this.blobManager.getGCData(e);return t.addNodes(i.gcNodes),t.getGCData()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const r=[];for(const i of e)i.split("/")[1]!==gn.basePath&&r.push(i);return this.dataStores.updateUsedRoutes(r,t)}deleteUnusedRoutes(e){const t=[],r=[];for(const i of e)this.isBlobPath(i)?t.push(i):r.push(i);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(r)}getCurrentReferenceTimestampMs(){var e,t,r;return(t=(e=this.deltaManager.lastMessage)===null||e===void 0?void 0:e.timestamp)!==null&&t!==void 0?t:(r=this.messageAtLastSummary)===null||r===void 0?void 0:r.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?Bt.Blob:(t=this.dataStores.getGCNodeType(e))!==null&&t!==void 0?t:Bt.Other}async getGCNodePackagePath(e){switch(this.getNodeType(e)){case Bt.Blob:return["_blobs"];case Bt.DataStore:case Bt.SubDataStore:return this.dataStores.getDataStorePackagePath(e);default:O(!1,734)}}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==gn.basePath)}async collectGarbage(e){return this.garbageCollector.collectGarbage(e)}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}async submitSummary(e){var t,r,i;const{fullTree:s,refreshLatestAck:o,summaryLogger:a}=e,l=this.nextSummaryNumber,c=ue.create(a,void 0,{all:{summaryNumber:l}});let u;if(o){const d=await this.refreshLatestSummaryAckFromServer(ue.create(c,void 0,{all:{safeSummary:!0}})),h=d.latestSnapshotRefSeq;u=d.latestSnapshotVersionId,h>this.deltaManager.lastSequenceNumber&&await le.timedExecAsync(c,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:h,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},async()=>O9(this.deltaManager,h),{start:!0,end:!0,cancel:"error"})}try{await this.deltaManager.inbound.pause();const d=this.deltaManager.lastSequenceNumber,h=this.deltaManager.minimumSequenceNumber,f=`Summary @${d}:${this.deltaManager.minimumSequenceNumber}`;d!==((t=this.deltaManager.lastMessage)===null||t===void 0?void 0:t.sequenceNumber)&&c.sendErrorEvent({eventName:"LastSequenceMismatch",error:f}),this.summarizerNode.startSummary(d,c);const p=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(O(this.connected,600),this.deltaManager.lastSequenceNumber!==d?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${d}`}:{continue:!0});let g=p();if(!g.continue)return{stage:"base",referenceSequenceNumber:d,minimumSequenceNumber:h,error:g.error};const S=U_.start();let m;const v=this.garbageCollector.summaryStateNeedsReset;try{m=await this.summarize({fullTree:s||v,trackState:!0,summaryLogger:c,runGC:this.garbageCollector.shouldRunGC})}catch(A){return{stage:"base",referenceSequenceNumber:d,minimumSequenceNumber:h,error:A}}const{summary:y,stats:b}=m;this.messageAtLastSummary=this.deltaManager.lastMessage;const w=this.disableIsolatedChannels?y:y.tree[te.channelsTreeName];O(w.type===Hi.Tree,508);const x=Object.values(w.tree).filter(A=>A.type===Hi.Handle).length,E=y.tree[ki]?TR(y.tree[ki]):void 0,P=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-x,gcStateUpdatedDataStoreCount:(r=m.gcStats)===null||r===void 0?void 0:r.updatedDataStoreCount,gcBlobNodeCount:E==null?void 0:E.blobNodeCount,gcTotalBlobsSize:E==null?void 0:E.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:l},b),M={referenceSequenceNumber:d,minimumSequenceNumber:h,summaryTree:y,summaryStats:P,generateDuration:S.trace().duration,forcedFullTree:v};if(g=p(),!g.continue)return Object.assign(Object.assign({stage:"generate"},M),{error:g.error});const F=this.summaryCollection.latestAck;let G;(F==null?void 0:F.summaryAck.contents.handle)!==u&&u!==void 0?G={proposalHandle:void 0,ackHandle:u,referenceSequenceNumber:d}:F===void 0?G={proposalHandle:void 0,ackHandle:(i=this.context.getLoadedFromVersion())===null||i===void 0?void 0:i.id,referenceSequenceNumber:d}:G={proposalHandle:F.summaryOp.contents.handle,ackHandle:F.summaryAck.contents.handle,referenceSequenceNumber:d};let z;try{z=await this.storage.uploadSummaryWithContext(m.summary,G)}catch(A){return Object.assign(Object.assign({stage:"generate"},M),{error:A})}const X=G.ackHandle,V={handle:z,head:X,message:f,parents:X?[X]:[]},_=Object.assign(Object.assign({},M),{handle:z,uploadDuration:S.trace().duration});if(g=p(),!g.continue)return Object.assign(Object.assign({stage:"upload"},_),{error:g.error});let N;try{N=this.submitSystemMessage(Ye.Summarize,V)}catch(A){return Object.assign(Object.assign({stage:"upload"},_),{error:A})}const W=Object.assign(Object.assign({stage:"submit"},_),{clientSequenceNumber:N,submitOpDuration:S.trace().duration});return this.summarizerNode.completeSummary(z),this.opTracker.reset(),W}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}}processRemoteChunkedMessage(e){if(e.type!==_e.ChunkedOp)return e;const t=e.clientId,r=e.contents;if(this.addChunk(t,r),r.chunkId===r.totalChunks){const i=Object.assign({},e),s=this.chunkMap.get(t).join("");return i.contents=JSON.parse(s),i.type=r.originalType,this.clearPartialChunks(t),i}return e}addChunk(e,t){let r=this.chunkMap.get(e);r===void 0&&(r=[],this.chunkMap.set(e,r)),O(t.chunkId===r.length+1,305),r.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,r=void 0){const i={address:e,contents:t};this.submit(_e.FluidDataStoreOp,i,r)}submitDataStoreAliasOp(e,t){if(!jR(e))throw new ye("malformedDataStoreAliasMessage");this.submit(_e.Alias,e,t)}async uploadBlob(e){return this.verifyNotClosed(),this.blobManager.createBlob(e)}submit(e,t,r=void 0,i=void 0){this.verifyNotClosed(),O(this.attachState!==Z.Detached,306);let s=-1,o=i;if(this.canSendOps()){const a=JSON.stringify(t),l=this.context.deltaManager.maxMessageSize;this.flushMode===te.FlushMode.TurnBased&&!this.needsFlush&&(o=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then(()=>{this.flushTrigger=!1,this.flush()})),s=this.submitMaybeChunkedMessages(e,t,a,l,this._flushMode===te.FlushMode.TurnBased,o)}this.pendingStateManager.onSubmitMessage(e,s,this.deltaManager.lastSequenceNumber,t,r,o),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,r,i,s,o=void 0){return this._maxOpSizeInBytes>=0?!r||r.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,s,o):(this.closeFn(new Gr("OpTooLarge",void 0,{length:{value:r.length,tag:ke.PackageData},limit:{value:this._maxOpSizeInBytes,tag:ke.PackageData}})),-1):!r||r.length<=i?this.submitRuntimeMessage(e,t,s,o):this.submitChunkedMessage(e,r,i)}submitChunkedMessage(e,t,r){const i=t.length,s=Math.floor((i-1)/r)+1;let o=0,a=0;for(let l=1;l<=s;l=l+1){const c={chunkId:l,contents:t.substr(o,r),originalType:e,totalChunks:s};o+=r,a=this.submitRuntimeMessage(_e.ChunkedOp,c,!1)}return a}submitSystemMessage(e,t){this.verifyNotClosed(),O(this.connected,307);const r=this.flushMode===te.FlushMode.TurnBased&&this.needsFlush;return r&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,r)}submitRuntimeMessage(e,t,r,i){this.verifyNotClosed(),O(this.connected,601);const s={type:e,contents:t};return this.context.submitFn(Ye.Operation,s,r,i)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,r,i){switch(e){case _e.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,r);break;case _e.Attach:case _e.Alias:this.submit(e,t,r);break;case _e.ChunkedOp:throw new Error("chunkedOp not expected here");case _e.BlobAttach:this.submit(e,t,r,i);break;case _e.Rejoin:this.submit(e,t);break;default:dv(e,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,r){switch(e){case _e.FluidDataStoreOp:this.dataStores.rollbackDataStoreOp(t,r);break;default:throw new Error(`Can't rollback ${e}`)}}async refreshLatestSummaryAck(e,t,r,i){const s=async l=>at(this.storage,l),{snapshotTree:o}=await this.fetchSnapshotFromStorage(t,i,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:r,fetchLatest:!1}),a=await this.summarizerNode.refreshLatestSummary(e,r,async()=>o,s,i);await this.garbageCollector.latestSummaryStateRefreshed(a,s)}async refreshLatestSummaryAckFromServer(e){const{snapshotTree:t,versionId:r}=await this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),i=async a=>at(this.storage,a),s=await fG(t,i),o=await this.summarizerNode.refreshLatestSummary(void 0,s,async()=>t,i,e);return await this.garbageCollector.latestSummaryStateRefreshed(o,i),{latestSnapshotRefSeq:s,latestSnapshotVersionId:r}}async fetchSnapshotFromStorage(e,t,r){return le.timedExecAsync(t,r,async i=>{const s={},o=U_.start(),a=await this.storage.getVersions(e,1);O(!!a&&!!a[0],311),s.getVersionDuration=o.trace().duration;const l=await this.storage.getSnapshotTree(a[0]);return O(!!l,312),s.getSnapshotDuration=o.trace().duration,i.end(s),{snapshotTree:l,versionId:a[0].id}})}notifyAttaching(e){var t;((t=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&t!==void 0?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=im.serializeTreeWithBlobContents(e))}async getSnapshotBlobs(){var e;!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad)||this.attachState!==Z.Attached||this.context.pendingLocalState||(O(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=await im.serializeTree(this.context.baseSnapshot,this.storage))}getPendingLocalState(){var e;if(!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad))throw new ye("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(O(!!this.context.baseSnapshot,742),O(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return async()=>{const t={headers:{[je.cache]:!1,[je.clientDetails]:{capabilities:{interactive:!1},type:Zt},[pa.summarizingClient]:!0,[je.reconnect]:!1},url:"/_summarizer"},i=(await lc(e,t)).ISummarizer;if(!i)throw new ye("Fluid object does not implement ISummarizer");return i}}async processSavedOps(e){for(const t of e.savedOps)this.process(t,!1),await this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);await this.pendingStateManager.applyStashedOpsAt()}}const O9=async(n,e)=>new Promise((t,r)=>{n.on("closed",r);const i=s=>{s.sequenceNumber>=e&&(t(),n.off("op",i))};n.on("op",i)});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class P9{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,$s(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(this.objectP===void 0){const e={url:this.absolutePath,headers:{[Wi.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then(t=>{if(t.mimeType==="fluid/object")return t.value;throw Wh(t)})}return this.objectP}attachGraph(){}bind(e){e.attachGraph()}async request(e){try{const r=(await this.get()).IFluidRouter;return r!==void 0?r.request(e):An(e)}catch(t){return Wd(t)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const R9=n=>(n==null?void 0:n.type)==="__fluid_handle__";class BR{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(r,i)=>{const s=r==null?void 0:r.IFluidHandle;return s!==void 0?this.serializeHandle(s,i):r},this.decodeValue=r=>{if(R9(r)){const i=r.url.startsWith("/")?r.url:zc(r.url,this.context),s=new P9(i,this.root);return this.handleParsedCb(s),s}else return r},this.root=this.context;this.root.routeContext!==void 0;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&typeof e=="object"?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&typeof e=="object"?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,(r,i)=>this.encodeValue(i,t))}parse(e){return JSON.parse(e,(t,r)=>this.decodeValue(r))}recursivelyReplace(e,t,r){const i=t(e,r);if(i!==e)return i;let s;for(const o of Object.keys(e)){const a=e[o];if(a&&typeof a=="object"){const l=this.recursivelyReplace(a,t,r);l!==a&&(s=s??(Array.isArray(e)?[...e]:Object.assign({},e)),s[o]=l)}}return s??e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class k9 extends Yo{get isAttached(){return this.value.isAttached()}constructor(e,t,r){super(e,t,r)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class N9 extends BR{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class L9 extends u0{constructor(e,t,r){super((i,s)=>this.eventListenerErrorHandler(i,s)),this.id=e,this.runtime=t,this.attributes=r,this._connected=!1,this._isBoundToContext=!1,$s(!e.includes("/"),772),this.handle=new k9(this,e,t.IFluidHandleContext),this.logger=ue.create(t.logger,void 0,{all:{sharedObjectId:Ze(),ddsType:{value:this.attributes.type,tag:ke.CodeArtifact}}}),this.mc=ka(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;$s(this.mc!==void 0&&this.logger!==void 0,"this.mc and/or this.logger has not been set");const r=new CC({eventName:"ddsOpProcessing",category:"performance"},this.logger,(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))!==null&&e!==void 0?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new CC({eventName:"ddsEventCallbacks",category:"performance"},this.logger,(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))!==null&&t!==void 0?t:100,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),[r,i]}closeWithError(e){this.closeError===void 0&&(this.closeError=e)}verifyNotClosed(){if(this.closeError!==void 0)throw this.closeError}eventListenerErrorHandler(e,t){const r=_n.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw r.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(r),r}attachListeners(){this.isAttached()||this.runtime.once("attaching",()=>{this.didAttach()})}async load(e){this.runtime.attachState!==Z.Detached&&(this.services=e),await this.loadCore(e.objectStorage),this.runtime.attachState!==Z.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return this.services!==void 0&&this.runtime.attachState!==Z.Detached}handleDecoded(e){var t,r,i;this.isAttached()&&((i=(t=this.services)===null||t===void 0?void 0:(r=t.deltaConnection).addedGCOutboundReference)===null||i===void 0||i.call(r,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}async newAckBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}attachDeltaHandler(){$s(this.services!==void 0,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,r)=>{this.process(e,t,r)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,r){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure(()=>{this.processCore(e,t,r)},t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure(()=>super.emit(e,...t))}emitInternal(e,...t){return super.emit(e,...t)}}class Xh extends L9{constructor(e,t,r,i){super(e,t,r),this.telemetryContextPrefix=i,this._isGCing=!1,this._serializer=new BR(this.runtime.channelsRoutingContext,s=>this.handleDecoded(s))}get serializer(){return $s(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(te.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(te.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}async summarize(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(te.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(te.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}getGCData(e=!1){$s(!this._isGCing,120),this._isGCing=!0;let t;try{const r=new N9(this.runtime.channelsRoutingContext,i=>this.handleDecoded(i));this.processGCDataCore(r),t={gcNodes:{"/":r.getSerializedRoutes()}},$s(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,r){var i;const s=(i=r==null?void 0:r.get(this.telemetryContextPrefix,e))!==null&&i!==void 0?i:0;r==null||r.set(this.telemetryContextPrefix,e,s+t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function UR(n,e,t){return n!==void 0?e.stringify(n,t):n}function HR(n,e,t){return e.encode(n,t)}function Xd(n,e){return n!==void 0?e.parse(JSON.stringify(n)):n}function I9(n,e){const t=new Kt;return t.addBlob(n,e),t.getSummaryTree()}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fe;(function(n){n[n.Shared=0]="Shared",n[n.Plain=1]="Plain"})(Fe||(Fe={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ae(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let A9=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function gv(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class iE{constructor(e){this.value=e}get type(){return Fe[Fe.Plain]}makeSerialized(e,t){const r=UR(this.value,e,t);return{type:this.type,value:r}}}class nS{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===Fe[Fe.Shared]){e.type=Fe[Fe.Plain];const r={type:"__fluid_handle__",url:e.value};e.value=r}const t=Xd(e.value,this.serializer);return new iE(t)}fromInMemory(e){return new iE(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function sm(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit")}function sE(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"}function M9(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit"||n.type==="clear")}class D9{constructor(e,t,r,i,s){this.serializer=e,this.handle=t,this.submitMessage=r,this.isAttached=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new nS(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){const t=this.data.get(e);return t===void 0?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(e==null)throw new Error("Undefined and null keys are not supported");const r=this.localValueMaker.fromInMemory(t),i=gv(r,this.serializer,this.handle),s=this.setCore(e,r,!0);if(!this.isAttached())return;const o={key:e,type:"set",value:i};this.submitMapKeyMessage(o,s)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return t!==void 0;const r={key:e,type:"delete"};return this.submitMapKeyMessage(r,t),t!==void 0}clear(){const e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),!this.isAttached())return;const t={type:"clear"};this.submitMapClearMessage(t,e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=gv(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){const i={key:t,value:this.makeLocal(t,r)};this.data.set(i.key,i.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const r=this.messageHandlers.get(e.type);return r===void 0?!1:(r.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(t===void 0)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,r){const i=this.messageHandlers.get(e.type);return i===void 0?!1:(i.process(e,t,r),!0)}rollback(e,t){if(!M9(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){if(t.previousMap===void 0)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if(e.type==="delete"||e.type==="set"){if(t.type==="add")this.deleteCore(e.key,!0);else if(t.type==="edit"&&t.previousValue!==void 0)this.setCore(e.key,t.previousValue,!0);else throw new Error("Cannot rollback without previous value");const r=this.pendingKeys.get(e.key),i=r==null?void 0:r.pop();if(!r||i!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");r.length===0&&this.pendingKeys.delete(e.key)}else throw new Error("Unsupported op for rollback")}setCore(e,t,r){const i=this.data.get(e),s=i==null?void 0:i.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:s},r,this.eventEmitter),i}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const r=this.data.get(e),i=r==null?void 0:r.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},t,this.eventEmitter),r}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r)=>{e.set(r,this.data.get(r))}),this.clearCore(!1),e.forEach((t,r)=>{this.setCore(r,t,!0)})}makeLocal(e,t){if(t.type===Fe[Fe.Plain]||t.type===Fe[Fe.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&Ae(r!==void 0&&sm(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){Ae(r!==void 0&&sm(r),20);const s=this.pendingKeys.get(e.key);Ae(s!==void 0&&s[0]===r.pendingMessageId,762),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(t,r,i)=>{if(r){Ae(sE(i),21);const s=this.pendingClearMessageIds.shift();Ae(s===i.pendingMessageId,763);return}if(this.pendingKeys.size!==0){this.clearExceptPendingKeys();return}this.clearCore(r)},submit:(t,r)=>{Ae(sE(r),764);const i=this.pendingClearMessageIds.shift();Ae(i===r.pendingMessageId,765),this.submitMapClearMessage(t,r.previousMap)},getStashedOpLocalMetadata:t=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(t,r,i)=>{this.needProcessKeyOperation(t,r,i)&&this.deleteCore(t.key,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e.set("set",{process:(t,r,i)=>{if(!this.needProcessKeyOperation(t,r,i))return;const s=this.makeLocal(t.key,t.value);this.setCore(t.key,s,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const r={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,r)}getMapKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const r=this.getMapKeyMessageId(e),i=t?{type:"edit",pendingMessageId:r,previousValue:t}:{type:"add",pendingMessageId:r};this.submitMessage(e,i)}resubmitMapKeyMessage(e,t){Ae(sm(t),766);const r=this.pendingKeys.get(e.key);Ae(r!==void 0&&r[0]===t.pendingMessageId,767),r.shift(),r.length===0&&this.pendingKeys.delete(e.key);const i=this.getMapKeyMessageId(e),s=t.type==="edit"?{type:"edit",pendingMessageId:i,previousValue:t.previousValue}:{type:"add",pendingMessageId:i};this.submitMessage(e,s)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const WR="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var oE;const aE="header";class $n{get type(){return $n.Type}get attributes(){return $n.Attributes}async load(e,t,r,i){const s=new fc(t,e,i);return await s.load(r),s}create(e,t){const r=new fc(t,e,$n.Attributes);return r.initializeLocal(),r}}$n.Type="https://graph.microsoft.com/types/map";$n.Attributes={type:$n.Type,snapshotFormatVersion:"0.2",packageVersion:WR};class fc extends Xh{constructor(e,t,r){super(e,t,r,"fluid_map_"),this[oE]="SharedMap",this.kernel=new D9(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),()=>this.isAttached(),this)}static create(e,t){return e.createChannel(t,$n.Type)}static getFactory(){return new $n}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(oE=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let r=0,i=0,s={};const o=[],a=new Kt,l=this.kernel.getSerializedStorage(e),c=8*1024,u=16*1024;for(const h of Object.keys(l)){const f=l[h];if(f.value&&f.value.length>=c){const p=`blob${i}`;i++,o.push(p);const g={[h]:{type:f.type,value:JSON.parse(f.value)}};a.addBlob(p,JSON.stringify(g))}else{if(r+=f.type.length+21,f.value&&(r+=f.value.length),r>u){const p=`blob${i}`;i++,o.push(p),a.addBlob(p,JSON.stringify(s)),s={},r=0}s[h]={type:f.type,value:f.value===void 0?void 0:JSON.parse(f.value)}}}const d={blobs:o,content:s};return a.addBlob(aE,JSON.stringify(d)),a.getSummaryTree()}async loadCore(e){const t=await at(e,aE),r=t;Array.isArray(r.blobs)?(this.kernel.populateFromSerializable(r.content),await Promise.all(r.blobs.map(async i=>{const s=await at(e,i);this.kernel.populateFromSerializable(s)}))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,r){e.type===Hd.Operation&&this.kernel.tryProcessMessage(e.contents,t,r)}rollback(e,t){this.kernel.rollback(e,t)}}function ar(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function lE(n,e){for(var t="",r=0,i=-1,s=0,o,a=0;a<=n.length;++a){if(a<n.length)o=n.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(i+1,a):t=n.slice(i+1,a),r=a-i-1;i=a,s=0}else o===46&&s!==-1?++s:s=-1}return t}function F9(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var Zo={resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var s;i>=0?s=arguments[i]:(r===void 0&&(r=process.cwd()),s=r),ar(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=lE(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(ar(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=lE(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return ar(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];ar(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Zo.normalize(e)},relative:function(e,t){if(ar(e),ar(t),e===t||(e=Zo.resolve(e),t=Zo.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,s=i-r,o=1;o<t.length&&t.charCodeAt(o)===47;++o);for(var a=t.length,l=a-o,c=s<l?s:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(t.charCodeAt(o+d)===47)return t.slice(o+d+1);if(d===0)return t.slice(o+d)}else s>c&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var h=e.charCodeAt(r+d),f=t.charCodeAt(o+d);if(h!==f)break;h===47&&(u=d)}var p="";for(d=r+u+1;d<=i;++d)(d===i||e.charCodeAt(d)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+t.slice(o+u):(o+=u,t.charCodeAt(o)===47&&++o,t.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(ar(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,s=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!s){i=o;break}}else s=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');ar(e);var r=0,i=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(o=e.length-1;o>=0;--o){var c=e.charCodeAt(o);if(c===47){if(!s){r=o+1;break}}else l===-1&&(s=!1,l=o+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(i=o):(a=-1,i=l))}return r===i?i=l:i===-1&&(i=e.length),e.slice(r,i)}else{for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!s){r=o+1;break}}else i===-1&&(s=!1,i=o+1);return i===-1?"":e.slice(r,i)}},extname:function(e){ar(e);for(var t=-1,r=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}i===-1&&(s=!1,i=a+1),l===46?t===-1?t=a:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return F9("/",e)},parse:function(e){ar(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,s;i?(t.root="/",s=1):s=0;for(var o=-1,a=0,l=-1,c=!0,u=e.length-1,d=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?o===-1?o=u:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||l===-1||d===0||d===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&i?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&i?(t.name=e.slice(1,o),t.base=e.slice(1,l)):(t.name=e.slice(a,o),t.base=e.slice(a,l)),t.ext=e.slice(o,l)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Zo.posix=Zo;var z9=Zo;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var cE,uE;const Yt=z9.posix,dE="header";class nr{get type(){return nr.Type}get attributes(){return nr.Attributes}async load(e,t,r,i){const s=new pc(t,e,i);return await s.load(r),s}create(e,t){const r=new pc(t,e,nr.Attributes);return r.initializeLocal(),r}}nr.Type="https://graph.microsoft.com/types/directory";nr.Attributes={type:nr.Type,snapshotFormatVersion:"0.1",packageVersion:WR};class pc extends Xh{constructor(e,t,r){super(e,t,r,"fluid_directory_"),this[cE]="SharedDirectory",this.root=new Yd(this,this.runtime,this.serializer,Yt.sep),this.messageHandlers=new Map,this.localValueMaker=new nS(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",(i,s)=>{this.emit("containedValueChanged",i,s,this)}),this.root.on("subDirectoryCreated",(i,s)=>{this.emit("subDirectoryCreated",i,s,this)}),this.root.on("subDirectoryDeleted",(i,s)=>{this.emit("subDirectoryDeleted",i,s,this)})}static create(e,t){return e.createChannel(t,nr.Type)}static getFactory(){return new nr}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(cE=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===Yt.sep)return this.root;let r=this.root;const i=t.substr(1).split(Yt.sep);for(const s of i)if(r=r.getSubDirectory(s),!r)return;return r}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const r=e,i=this.messageHandlers.get(r.type);Ae(i!==void 0,13),i.submit(r,t)}async loadCore(e){const t=await at(e,dE),r=t;Array.isArray(r.blobs)?(this.populate(r.content),await Promise.all(r.blobs.map(async i=>{const s=await at(e,i);this.populate(s)}))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[r,i]=t.pop();if(i.subdirectories)for(const[s,o]of Object.entries(i.subdirectories)){let a=r.getSubDirectory(s);a||(a=new Yd(this,this.runtime,this.serializer,Yt.join(r.absolutePath,s)),r.populateSubDirectory(s,a)),t.push([a,o])}if(i.storage)for(const[s,o]of Object.entries(i.storage)){const a=this.makeLocal(s,r.absolutePath,o);r.populateStorage(s,a)}}}processCore(e,t,r){if(e.type===Hd.Operation){const i=e.contents,s=this.messageHandlers.get(i.type);Ae(s!==void 0,14),s.process(i,t,r)}}rollback(e,t){const r=e,i=this.getWorkingDirectory(r.path);i&&i.rollback(r,t)}makeAbsolute(e){return Yt.resolve(Yt.sep,e)}makeLocal(e,t,r){return Ae(r.type===Fe[Fe.Plain]||r.type===Fe[Fe.Shared],484),this.localValueMaker.fromSerializable(r)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processClearMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);if(i){const s=t?void 0:this.makeLocal(e.key,e.path,e.value);i.processSetMessage(e,s,t,r)}},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processCreateSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,r){const s=new Kt;let o=0;const a=[],l=[],c={};for(l.push([e,c]);l.length>0;){const[d,h]=l.pop();for(const[f,p]of d.getSerializedStorage(t)){h.storage||(h.storage={});const g={type:p.type,value:p.value&&JSON.parse(p.value)};if(p.value&&p.value.length>=8192){const S={};let m=S;if(d.absolutePath!==Yt.sep)for(const y of d.absolutePath.substr(1).split(Yt.sep)){const b={};m.subdirectories={[y]:b},m=b}m.storage={[f]:g};const v=`blob${o}`;o++,a.push(v),s.addBlob(v,JSON.stringify(S))}else h.storage[f]=g}for(const[f,p]of d.subdirectories()){h.subdirectories||(h.subdirectories={});const g={};h.subdirectories[f]=g,l.push([p,g])}}const u={blobs:a,content:c};return s.addBlob(dE,JSON.stringify(u)),s.getSummaryTree()}}function om(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&n.type==="edit"}function hE(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"&&typeof n.previousStorage=="object"}function fE(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean"||n.type==="deleteSubDir")}function $9(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="edit"||n.type==="deleteSubDir"||n.type==="clear"&&typeof n.previousStorage=="object"||n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean")}class Yd extends A9{constructor(e,t,r,i){super(),this.directory=e,this.runtime=t,this.serializer=r,this.absolutePath=i,this._deleted=!1,this[uE]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new ye("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),(t=this._storage.get(e))===null||t===void 0?void 0:t.value}set(e,t){if(this.throwIfDisposed(),e==null)throw new Error("Undefined and null keys are not supported");const r=this.directory.localValueMaker.fromInMemory(t),i=gv(r,this.serializer,this.directory.handle),s=this.setCore(e,r,!0);if(!this.directory.isAttached())return this;const o={key:e,path:this.absolutePath,type:"set",value:i};return this.submitKeyMessage(o,s),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),e==null)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(Yt.sep))throw new Error(`SubDirectory name may not contain ${Yt.sep}`);const t=this.createSubDirectoryCore(e,!0),r=this._subdirectories.get(e);if(!this.directory.isAttached())return r;const i={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(i,!t),r}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(r,t),t!==void 0}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(r,t),t!==void 0}clear(){if(this.throwIfDisposed(),!this.directory.isAttached()){this.clearCore(!0);return}const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach((t,r,i)=>{e(t.value,r,i)})}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[(uE=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,r){if(this.throwIfDisposed(),t){Ae(hE(r),15);const i=this.pendingClearMessageIds.shift();Ae(i===r.pendingMessageId,810);return}this.clearExceptPendingKeys()}processDeleteMessage(e,t,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,r)&&this.deleteCore(e.key,t)}processSetMessage(e,t,r,i){this.throwIfDisposed(),this.needProcessStorageOperation(e,r,i)&&this.setCore(e.key,t,r)}processCreateSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const r=++this.pendingMessageId;this.pendingClearMessageIds.push(r);const i={type:"clear",pendingMessageId:r,previousStorage:t};this.directory.submitDirectoryMessage(e,i)}resubmitClearMessage(e,t){Ae(hE(t),811);const r=this.pendingClearMessageIds.shift();Ae(r===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const i={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,i)}resubmitKeyMessage(e,t){Ae(om(t),813);const r=this.pendingKeys.get(e.key);Ae(r!==void 0&&r[0]===t.pendingMessageId,814),r.shift(),r.length===0&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,r=this.pendingSubDirectories.get(e.subdirName);return r!==void 0?r.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,i)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,i)}resubmitSubDirectoryMessage(e,t){Ae(fE(t),815);const r=this.pendingSubDirectories.get(e.subdirName);Ae(r!==void 0&&r[0]===t.pendingMessageId,816),r.shift(),r.length===0&&this.pendingSubDirectories.delete(e.subdirName),t.type==="createSubDir"?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,r]of this._storage){const i=r.makeSerialized(e,this.directory.handle);yield[t,i]}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,r){const i=e.get(t),s=i==null?void 0:i.pop();if(!i||s!==r)throw new Error("Rollback op does not match last pending");i.length===0&&e.delete(t)}rollback(e,t){if(!$9(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){t.previousStorage.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if((e.type==="delete"||e.type==="set")&&t.type==="edit")t.previousValue===void 0?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId);else if(e.type==="createSubDirectory"&&t.type==="createSubDir")t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else if(e.type==="deleteSubDirectory"&&t.type==="deleteSubDir")t.subDirectory!==void 0&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else throw new Error("Unsupported op for rollback")}makeAbsolute(e){return Yt.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&Ae(r!==void 0&&om(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){Ae(r!==void 0&&om(r),17);const s=this.pendingKeys.get(e.key);Ae(s!==void 0&&s[0]===r.pendingMessageId,817),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,r){if(this.pendingSubDirectories.get(e.subdirName)!==void 0){if(t){Ae(fE(r),18);const s=this.pendingSubDirectories.get(e.subdirName);Ae(s!==void 0&&s[0]===r.pendingMessageId,818),s.shift(),s.length===0&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r,i)=>{e.set(r,this._storage.get(r))}),this.clearCore(!1),e.forEach((t,r,i)=>{this.setCore(r,t,!0)})}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const r=this._storage.get(e),i=r==null?void 0:r.value;if(this._storage.delete(e)){const o={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",o,t,this.directory);const a={key:e,previousValue:i};this.emit("containedValueChanged",a,t,this)}return r}setCore(e,t,r){const i=this._storage.get(e),s=i==null?void 0:i.value;this._storage.set(e,t);const o={key:e,path:this.absolutePath,previousValue:s};this.directory.emit("valueChanged",o,r,this.directory);const a={key:e,previousValue:s};return this.emit("containedValueChanged",a,r,this),i}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const r=Yt.join(this.absolutePath,e),i=new Yd(this.directory,this.runtime,this.serializer,r);return this.registerEventsOnSubDirectory(i,e),this._subdirectories.set(e,i),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",(r,i)=>{this.emit("subDirectoryCreated",Yt.join(t,r),i,this)}),e.on("subDirectoryDeleted",(r,i)=>{this.emit("subDirectoryDeleted",Yt.join(t,r),i,this)})}deleteSubDirectoryCore(e,t){const r=this._subdirectories.get(e);return r!==void 0&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(r),this.emit("subDirectoryDeleted",e,t,this)),r}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[r,i]of t)this.disposeSubDirectoryTree(i);typeof e.dispose=="function"&&e.dispose()}undeleteSubDirectoryTree(e){for(const[t,r]of this._subdirectories.entries())this.undeleteSubDirectoryTree(r);e.undispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const pE="IFluidDependencySynthesizer";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Yh{constructor(...e){this.providers=new Map,this.parents=e.filter(t=>t!==void 0)}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const r={};return this.generateRequired(r,t),this.generateOptional(r,e),Object.defineProperty(r,pE,{get:()=>this}),r}has(e,t){return this.providers.has(e)?!0:t!==!0?this.parents.some(r=>r.has(e)):!1}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof Yh)return t.getProvider(e);{const r=t;if((r==null?void 0:r.getProvider)!==void 0)return r.getProvider(e)}}}}generateRequired(e,t){if(t!==void 0)for(const r of Object.keys(t)){const i=this.resolveProvider(r);if(i===void 0)throw new Error(`Object attempted to be created without registered required provider ${r}`);Object.defineProperty(e,r,i)}}generateOptional(e,t){var r;if(t!==void 0)for(const i of Object.keys(t)){const s=(r=this.resolveProvider(i))!==null&&r!==void 0?r:{get:async()=>{}};Object.defineProperty(e,i,s)}}resolveProvider(e){const t=this.providers.get(e);if(t===void 0){for(const r of this.parents){const i={[e]:e},s=r.synthesize(i,{}),o=Object.getOwnPropertyDescriptor(s,e);if(o!==void 0)return o}return}return typeof t=="function"?{get(){if(t&&typeof t=="function")return Promise.resolve(this[pE]).then(async r=>t(r)).then(r=>r==null?void 0:r[e])}}:{get(){if(t)return Promise.resolve(t).then(r=>{if(r)return r[e]})}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function am(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let j9=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let rS=class ys extends j9{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(ys.removeListenerEvent,t),this.on(ys.newListenerEvent,r)}}static isEmitterEvent(e){return e===ys.newListenerEvent||e===ys.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!ys.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!ys.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};rS.newListenerEvent="newListener";rS.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function q9(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class B9{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){q9(!1,202)}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(e.status===200&&e.mimeType==="fluid/object")return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}function U9(n,e){return new B9(n,e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class H9{constructor(){this.handlers=[]}pushHandler(...e){e!==void 0&&this.handlers.push(...e)}async handleRequest(e,t){const r=Cr.create(e);for(const i of this.handlers){const s=await i(r,t);if(s!==void 0)return s}return An(e)}}function VR(...n){const e=new H9;return e.pushHandler(...n),async(t,r)=>e.handleRequest(t,r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const iS="_services";class W9{constructor(e){this.runtime=e}get IFluidRouter(){return this}async request(e){return{status:200,mimeType:"fluid/object",value:this}}}class V9{constructor(e){this.serviceFn=e}async getService(e){return this.service||(this.service=this.serviceFn(e)),this.service}}const G9=n=>{const e=new Map;return new Map(n).forEach((t,r)=>{e.set(r,new V9(t))}),async(t,r)=>{if(t.pathParts[0]!==iS)return;if(t.pathParts.length<2)return Vd(400,"request did not specify a service to route to",t);const i=e.get(t.pathParts[1]);if(!i)return An(t);const s=await i.getService(r),o=s.IFluidRouter,a=t.createSubRequest(2);return o?o.request(a):t.isLeaf(2)?{status:200,mimeType:"fluid/object",value:s}:Vd(400,"request sub-url for service that doesn't support routing",t)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const K9=(n,e)=>{const t=VR(...e);return async(r,i)=>{var s;const o=((s=r.headers)===null||s===void 0?void 0:s.mountableView)===!0;let a=r;if(o){const c=Object.assign({},r.headers);delete c.mountableView,a={url:r.url,headers:c}}const l=await t(a,i);return o&&l.status===200&&n.canMount(l.value)?{status:200,mimeType:"fluid/object",value:new n(l.value)}:l}},sS=n=>async(e,t)=>{const r=Cr.create(e);if(r.pathParts.length===0)return t.IFluidHandleContext.resolveHandle({url:`/${n}${r.query}`,headers:e.headers})};function GR(n,e){return e.url===""||e.url==="/"||e.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:n}:An(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class oS extends rS{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,am(this.runtime._dataObject===void 0,189),this.runtime._dataObject=this,this.innerHandle=new Yo(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",()=>{this._disposed=!0,this.dispose()})}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return am(t!==void 0,188),await t.finishInitialization(!0),t}async request(e){return GR(this,e)}async finishInitialization(e){return this.initializeP!==void 0?this.initializeP:(this.initializeP=this.initializeInternal(e),this.initializeP)}async initializeInternal(e){var t;await this.preInitialize(),e?(am(this.initProps===void 0,190),await this.initializingFromExisting()):await this.initializingFirstTime((t=this.context.createProps)!==null&&t!==void 0?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,r){const i=r?r(e,t):t.get(e),s=i==null?void 0:i.IFluidHandle;if(s)return s.get()}async getService(e){return U9(`/${iS}/${e}`,this.context.containerRuntime).get()}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class KR extends oS{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=Cr.create(e);if(t.pathParts[0]==="bigBlobs"){const i=this.root.get(t.pathParts.join("/"));return i===void 0?An(t):{mimeType:"fluid/object",status:200,value:i}}else return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===$n.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=pc.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function mE(n,e,t,r,i,s,o){let a=i;a=TG(async(f,p)=>(await oS.getDataObject(p)).request(f),a);const l=new a(e,t,s),c=e.scope,d=new Yh(c.IFluidDependencySynthesizer).synthesize(r,{}),h=new n({runtime:l,context:e,providers:d,initProps:o});return s||await h.finishInitialization(s),{instance:h,runtime:l}}class JR{constructor(e,t,r,i,s,o=$c){if(this.type=e,this.ctor=t,this.optionalProviders=i,this.runtimeClass=o,this.type==="")throw new Error("undefined type member");s!==void 0&&(this.registry=new G0(s)),this.sharedObjectRegistry=new Map(r.map(a=>[a.type,a]))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:r}=await mE(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return r}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,r){const i=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(i,r)}async createNonRootInstanceCore(e,t,r){const i=e.createDetachedDataStore(t);return this.createInstanceCore(i,r)}async createInstanceCore(e,t){const{instance:r,runtime:i}=await mE(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,i),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class QR extends JR{constructor(e,t,r=[],i,s,o=$c){const a=[...r];r.find(l=>l.type===nr.Type)||a.push(pc.getFactory()),r.find(l=>l.type===$n.Type)||a.push(fc.getFactory()),super(e,t,a,i,s,o)}}var XR={},Zh={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Zh,"__esModule",{value:!0});Zh.IContainerRuntime=void 0;Zh.IContainerRuntime="IContainerRuntime";(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Zh,n)})(XR);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class aS extends X5{constructor(e,t,r=[],i){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=r,this.runtimeOptions=i,this.registry=new G0(e)}get IFluidDataStoreRegistry(){return this.registry}async instantiateFirstTime(e){await this.containerInitializingFirstTime(e),await this.containerHasInitialized(e)}async instantiateFromExisting(e){await this.containerHasInitialized(e)}async preInitialize(e,t){const r=e.scope,i=new Yh(this.dependencyContainer,r.IFluidDependencySynthesizer);r.IFluidDependencySynthesizer=i;const s=await tS.load(e,this.registryEntries,VR(...this.requestHandlers),this.runtimeOptions,r,t);return i.register(XR.IContainerRuntime,s),s}async containerInitializingFirstTime(e){}async containerHasInitialized(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const vv="default";class YR extends aS{constructor(e,t,r,i=[],s){super(t,r,[sS(vv),...i],s),this.defaultFactory=e}async containerInitializingFirstTime(e){await(await e.createDataStore(this.defaultFactory.type)).trySetAlias(vv)}}YR.defaultDataStoreId=vv;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function J9(n){if(n.attachState!==Z.Attached)return new Promise(e=>{n.once("attached",()=>{Promise.resolve().then(()=>e()).catch(()=>{})})})}async function Q9(n){const e="/",t=await n.request({url:e});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object at URL: "${e}"`);if(t.value===void 0)throw new Error(`Empty response from URL: "${e}"`);return t.value}async function X9(n,e){const t=`/${n}`,r=await e.request({url:t});if(r.status!==200||r.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with ID: "${n}" from URL: "${t}"`);if(r.value===void 0)throw new Error(`Empty response for ID: "${n}" from URL: "${t}"`);return r.value}async function Y9(n,e){const t=await e.request({url:n});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with from URL: "${n}"`);if(t.value===void 0)throw new Error(`Empty response for from URL: "${n}"`);return t.value}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Z9=Object.freeze(Object.defineProperty({__proto__:null,BaseContainerRuntimeFactory:aS,BaseContainerService:W9,ContainerRuntimeFactoryWithDefaultDataStore:YR,DataObject:KR,DataObjectFactory:QR,PureDataObject:oS,PureDataObjectFactory:JR,defaultFluidObjectRequestHandler:GR,defaultRouteRequestHandler:sS,generateContainerServicesRequestHandler:G9,getDefaultObjectFromContainer:Q9,getObjectFromContainer:Y9,getObjectWithIdFromContainer:X9,mountableViewRequestHandler:K9,serviceRoutePathRoot:iS,waitForAttach:J9},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const ZR=n=>(n==null?void 0:n.factory)!==void 0,ek=n=>(n==null?void 0:n.getFactory)!==void 0,e7=n=>{var e;const t=new Set,r=new Set,i=o=>{if(ek(o))r.add(o.getFactory());else if(ZR(o))t.add([o.factory.type,Promise.resolve(o.factory)]);else throw new Error("Entry is neither a DataObject or a SharedObject")};if(new Set([...Object.values(n.initialObjects),...(e=n.dynamicObjectTypes)!==null&&e!==void 0?e:[]]).forEach(i),t.size===0&&r.size===0)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(t),Array.from(r)]};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class tk extends KR{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(e===void 0)throw new Error("InitialObjects sub-directory was not initialized");return e}async initializingFirstTime(e){this.root.createSubDirectory(this.initialObjectsDirKey);const t=[];Object.entries(e.initialObjects).forEach(([r,i])=>{const s=async()=>{const o=await this.create(i);this.initialObjectsDir.set(r,o.handle)};t.push(s())}),await Promise.all(t)}async hasInitialized(){const e=[];for(const[t,r]of Array.from(this.initialObjectsDir.entries())){const i=async()=>{const s=await r.get();Object.assign(this._initialObjects,{[t]:s})};e.push(i())}await Promise.all(e)}get initialObjects(){if(Object.keys(this._initialObjects).length===0)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(e){if(ZR(e))return this.createDataObject(e);if(ek(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")}async createDataObject(e){const t=e.factory,r=[...this.context.packagePath,t.type],i=await this.context.containerRuntime.createDataStore(r);return lc(i,"/")}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}const gE="rootDOId";class nk extends aS{constructor(e){const[t,r]=e7(e),i=new QR("rootDO",tk,r,{},t);super([i.registryEntry],void 0,[sS(gE)],{flushMode:te.FlushMode.Immediate}),this.rootDataObjectFactory=i,this.initialObjects=e.initialObjects}async containerInitializingFirstTime(e){await this.rootDataObjectFactory.createRootInstance(gE,e,{initialObjects:this.initialObjects})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class rk extends vR{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",(t,r)=>{if(this.shouldIncludeAsMember(r)){const i=this.getMember(t);this.emit("memberAdded",t,i),this.emit("membersChanged")}}),this.audience.on("removeMember",t=>{this.lastMembers.has(t)&&(this.emit("memberRemoved",t,this.lastMembers.get(t)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach((r,i)=>{if(this.shouldIncludeAsMember(r)){const s=r.user.id;let o=e.get(s);o===void 0&&(o=this.createServiceMember(r),e.set(s,o)),o.connections.push({id:i,mode:r.mode}),t.set(i,o)}}),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(e!==void 0)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(t===void 0)return;const i=this.getMembers().get(t==null?void 0:t.user.id);if(i===void 0)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return i}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Sn(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function t7(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const ik=(n,e)=>n7.from(n).toString(e);function vE(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let n7=class Ss extends Uint8Array{toString(e){return t7(this,e)}static from(e,t,r){if(typeof e=="string")return Ss.fromString(e,t);if(e!==null&&typeof e=="object"&&vE(e.buffer))return Sn(e.byteOffset===0,0),Sn(e.byteLength===e.buffer.byteLength,1),Ss.fromArrayBuffer(e.buffer,t,r);if(vE(e))return Ss.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ss(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new Ss(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ss(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let sk=class extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let r7=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var yv;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(yv||(yv={}));var yE;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(yE||(yE={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Q(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function i7(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const Sv=(n,e)=>s7.from(n).toString(e);function SE(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let s7=class bs extends Uint8Array{toString(e){return i7(this,e)}static from(e,t,r){if(typeof e=="string")return bs.fromString(e,t);if(e!==null&&typeof e=="object"&&SE(e.buffer))return Q(e.byteOffset===0,0),Q(e.byteLength===e.buffer.byteLength,1),bs.fromArrayBuffer(e.buffer,t,r);if(SE(e))return bs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new bs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new bs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new bs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const bE=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let yo=class ok{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=bE.now();return new ok(e)}trace(){const e=bE.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function o7(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class lS{constructor(){this.items=[]}push(e){this.items.push(e)}empty(){return this.items.length===0}top(){return this.items[this.items.length-1]}pop(){return this.items.pop()}}function ak(n){if(n!==void 0){{if(n.isHead)return;n.next.prev=n.prev,n.prev.next=n.next}return n}}function wE(n){return new lk(!1,n)}function $o(){return new lk(!0,void 0)}class lk{constructor(e,t){this.isHead=e,this.data=t,this.prev=this,this.next=this}clear(){this.isHead&&(this.prev=this,this.next=this)}add(e){const t=wE(e);return this.prev.next=t,t.next=this,t.prev=this.prev,this.prev=t,t}dequeue(){if(!this.empty())return ak(this.next).data}enqueue(e){return this.add(e)}walk(e){for(let t=this.next;!t.isHead;t=t.next)e(t.data,t)}some(e,t){const r=[],i=t?this.prev:this.next;for(let s=i;!s.isHead;s=t?s.prev:s.next){const o=s.data;e(o,s)&&(t?r.unshift(o):r.push(o))}return r}count(){let e,t;for(e=this.next,t=0;!e.isHead;t++)e=e.next;return t}first(){if(!this.empty())return this.next.data}last(){if(!this.empty())return this.prev.data}empty(){return this.next===this}push(e){this.unshift(e)}unshift(e){const t=wE(e);t.data=e,t.isHead=!1,t.next=this.next,t.prev=this,this.next=t,t.next.prev=t}[Symbol.iterator](){let e=this;return{next(){for(;e&&e.next.isHead===!1;)if(e=e.next,e.data!==void 0)return{value:e.data,done:!1};return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}}let CE=class{constructor(e,t){this.comp=t,this.L=[t.min];for(let r=0,i=e.length;r<i;r++)this.add(e[r])}count(){return this.L.length-1}peek(){return this.L[1]}get(){const e=this.L[1];return this.L[1]=this.L[this.count()],this.L.pop(),this.fixDown(1),e}add(e){this.L.push(e),this.fixup(this.count())}fixup(e){let t=e;for(;t>1&&this.comp.compare(this.L[t>>1],this.L[t])>0;){const r=this.L[t>>1];this.L[t>>1]=this.L[t],this.L[t]=r,t=t>>1}}fixDown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r],this.L[r+1])>0&&r++,this.comp.compare(this.L[t],this.L[r])<=0)break;const i=this.L[t];this.L[t]=this.L[r],this.L[r]=i,t=r}}};const $t={RED:0,BLACK:1};class mc{constructor(e,t){this.compareKeys=e,this.aug=t}makeNode(e,t,r,i){return{key:e,data:t,color:r,size:i}}isRed(e){return!!e&&e.color===$t.RED}nodeSize(e){return e?e.size:0}size(){return this.nodeSize(this.root)}isEmpty(){return!this.root}get(e){if(e!==void 0)return this.nodeGet(this.root,e)}nodeGet(e,t){let r=e;for(;r;){const i=this.compareKeys(t,r.key);if(i<0)r=r.left;else if(i>0)r=r.right;else return r}}contains(e){return this.get(e)}gather(e,t){const r=[];return e!==void 0&&this.nodeGather(this.root,r,e,t),r}nodeGather(e,t,r,i){e&&(i.continueSubtree(e.left,r)&&this.nodeGather(e.left,t,r,i),i.matchNode(e,r)&&t.push(e),i.continueSubtree(e.right,r)&&this.nodeGather(e.right,t,r,i))}walkExactMatchesForward(e,t,r,i){this.nodeWalkExactMatchesForward(this.root,e,t,r,i)}nodeWalkExactMatchesForward(e,t,r,i,s){if(!e)return;const o=t(e);i(o)&&this.nodeWalkExactMatchesForward(e.left,t,r,i,s),o===0&&r(e),s(o)&&this.nodeWalkExactMatchesForward(e.right,t,r,i,s)}walkExactMatchesBackward(e,t,r,i){this.nodeWalkExactMatchesBackward(this.root,e,t,r,i)}nodeWalkExactMatchesBackward(e,t,r,i,s){if(!e)return;const o=t(e);s(o)&&this.nodeWalkExactMatchesBackward(e.right,t,r,i,s),o===0&&r(e),i(o)&&this.nodeWalkExactMatchesBackward(e.left,t,r,i,s)}put(e,t,r){e!==void 0&&(t===void 0?this.remove(e):(this.root=this.nodePut(this.root,e,t,r),this.root.color=$t.BLACK))}nodePut(e,t,r,i){let s=e;if(s){const o=this.compareKeys(t,s.key);if(o<0)s.left=this.nodePut(s.left,t,r,i);else if(o>0)s.right=this.nodePut(s.right,t,r,i);else if(i){const a=i(t,s.key,r,s.data);a.key&&(s.key=a.key),a.data?s.data=a.data:s.data=r}else s.data=r;return this.isRed(s.right)&&!this.isRed(s.left)&&(s=this.rotateLeft(s)),this.isRed(s.left)&&this.isRed(s.left.left)&&(s=this.rotateRight(s)),this.isRed(s.left)&&this.isRed(s.right)&&this.flipColors(s),s.size=this.nodeSize(s.left)+this.nodeSize(s.right)+1,this.aug&&this.updateLocal(s),s}else return this.makeNode(t,r,$t.RED,1)}updateLocal(e){this.aug&&(this.isRed(e.left)&&this.aug.update(e.left),this.isRed(e.right)&&this.aug.update(e.right),this.aug.update(e))}nodeRemoveMin(e){let t=e;if(t.left)return!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.nodeRemoveMin(t.left),this.balance(t)}remove(e){if(e!==void 0){if(!this.contains(e))return;this.removeExisting(e)}}removeExisting(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.color=$t.RED),this.root=this.nodeRemove(this.root,e)}nodeRemove(e,t){let r=e;if(this.compareKeys(t,r.key)<0)!this.isRed(r.left)&&!this.isRed(r.left.left)&&(r=this.moveRedLeft(r)),r.left=this.nodeRemove(r.left,t);else{if(this.isRed(r.left)&&(r=this.rotateRight(r)),this.compareKeys(t,r.key)===0&&!r.right)return;if(!this.isRed(r.right)&&!this.isRed(r.right.left)&&(r=this.moveRedRight(r)),this.compareKeys(t,r.key)===0){const i=this.nodeMin(r.right);r.key=i.key,r.data=i.data,r.right=this.nodeRemoveMin(r.right)}else r.right=this.nodeRemove(r.right,t)}return this.balance(r)}floor(e){if(!this.isEmpty())return this.nodeFloor(this.root,e)}nodeFloor(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r<0)return this.nodeFloor(e.left,t);{const i=this.nodeFloor(e.right,t);return i||e}}}ceil(e){if(!this.isEmpty())return this.nodeCeil(this.root,e)}nodeCeil(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r>0)return this.nodeCeil(e.right,t);{const i=this.nodeCeil(e.left,t);return i||e}}}min(){if(this.root)return this.nodeMin(this.root)}nodeMin(e){return e.left?this.nodeMin(e.left):e}max(){if(this.root)return this.nodeMax(this.root)}nodeMax(e){return e.right?this.nodeMax(e.right):e}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.color=t.right.color,t.right.color=$t.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.color=t.left.color,t.left.color=$t.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}oppositeColor(e){return e===$t.BLACK?$t.RED:$t.BLACK}flipColors(e){e.color=this.oppositeColor(e.color),e.left.color=this.oppositeColor(e.left.color),e.right.color=this.oppositeColor(e.right.color)}moveRedLeft(e){let t=e;return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(e){let t=e;return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}balance(e){let t=e;return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&this.aug.update(t),t}mapRange(e,t,r,i){this.nodeMap(this.root,e,r,i)}map(e,t){this.nodeMap(this.root,e,t)}keys(){const e=[],t={showStructure:!0,infix:r=>(e.push(r.key),!0)};return this.walk(t),e}walk(e){this.nodeWalk(this.root,e)}walkBackward(e){this.nodeWalkBackward(this.root,e)}nodeWalk(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===$t.BLACK)&&(r=t.pre(e)),e.left&&(r=this.nodeWalk(e.left,t)),r&&t.infix&&(t.showStructure||e.color===$t.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalk(e.right,t)),r&&t.post&&(t.showStructure||e.color===$t.BLACK)&&(r=t.post(e))),r}nodeWalkBackward(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===$t.BLACK)&&(r=t.pre(e)),e.right&&(r=this.nodeWalkBackward(e.right,t)),r&&t.infix&&(t.showStructure||e.color===$t.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalkBackward(e.left,t)),r&&t.post&&(t.showStructure||e.color===$t.BLACK)&&(r=t.post(e))),r}nodeMap(e,t,r,i,s){let o=i,a=s;if(!e)return!0;o===void 0&&(o=this.nodeMin(e).key),a===void 0&&(a=this.nodeMax(e).key);const l=this.compareKeys(o,e.key),c=this.compareKeys(a,e.key);let u=!0;return l<0&&(u=this.nodeMap(e.left,t,r,o,a)),u&&l<=0&&c>=0&&(u=t(e,r)),u&&c>0&&(u=this.nodeMap(e.right,t,r,o,a)),u}}const a7=(n,e)=>n.compare(e);class l7{constructor(){this.intervals=new mc(a7,this)}remove(e){this.intervals.remove(e)}removeExisting(e){this.intervals.removeExisting(e)}put(e,t){let r;t&&(r=(i,s)=>({key:t(i,s)})),this.intervals.put(e,{minmax:e.clone()},r)}map(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walk(t)}mapUntil(e){const t={infix:r=>e(r.key),showStructure:!0};this.intervals.walk(t)}mapBackward(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walkBackward(t)}match(e){return this.intervals.gather(e,this)}matchNode(e,t){return!!e&&e.key.overlaps(t)}continueSubtree(e,t){return!!e&&e.data.minmax.overlaps(t)}update(e){e.left&&e.right?e.data.minmax=e.key.union(e.left.data.minmax.union(e.right.data.minmax)):e.left?e.data.minmax=e.key.union(e.left.data.minmax):e.right?e.data.minmax=e.key.union(e.right.data.minmax):e.data.minmax=e.key.clone()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Ut=0,re=-1,cs=-2,Es=-1,Ls=-2;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ee;(function(n){n[n.Simple=0]="Simple",n[n.Tile=1]="Tile",n[n.NestBegin=2]="NestBegin",n[n.NestEnd=4]="NestEnd",n[n.RangeBegin=16]="RangeBegin",n[n.RangeEnd=32]="RangeEnd",n[n.SlideOnRemove=64]="SlideOnRemove",n[n.StayOnRemove=128]="StayOnRemove",n[n.Transient=256]="Transient"})(ee||(ee={}));const ce={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ck(n,e,t,r){let i=e;switch(i===void 0&&(i=n.defaultValue),n.name){case"incr":i+=t,n.minValue&&i<n.minValue&&(i=n.minValue);break;case"consensus":if(i===void 0)i={value:t,seq:r};else{const s=i;s.seq===-1&&(s.seq=r)}break}return i}function qc(n,e){if(n)if(e){for(const t in n){if(e[t]===void 0)return!1;if(typeof e[t]=="object"){if(!qc(n[t],e[t]))return!1}else if(e[t]!==n[t])return!1}for(const t in e)if(n[t]===void 0)return!1}else return!1;else if(e)return!1;return!0}function uk(n,e,t,r){if(e!==void 0)for(const i in e){const s=e[i];s===null?delete n[i]:t&&t.name!=="rewrite"?n[i]=ck(t,n[i],s,r):n[i]=s}return n}function c7(n){if(n===void 0)return;const e=Vt();for(const t in n){const r=n[t];r!==null&&(e[t]=r)}return e}function dk(n,e,t,r){let i=n;return(!i||t&&t.name==="rewrite")&&(i=Vt()),uk(i,e,t,r),i}function u7(n,e){if(e!==void 0)for(const t in e)n[t]===void 0&&(n[t]=e[t]);return n}function Vt(){return Object.create(null)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const d7="referenceTileLabels",Bc="referenceRangeLabels";function He(n,e){return((typeof n=="number"?n:n.refType)&e)!==0}const Xs=n=>He(n,ee.Tile)&&n.properties?n.properties[d7]:void 0,Ys=n=>He(n,ee.NestBegin|ee.NestEnd)&&n.properties?n.properties[Bc]:void 0;function ef(n,e){const t=Xs(n);if(t){for(const r of t)if(e===r)return!0}return!1}function cS(n,e){const t=Ys(n);if(t){for(const r of t)if(e===r)return!0}return!1}function Ts(n){return Xs(n)!==void 0}function xs(n){return Ys(n)!==void 0}function h7(n,e){return uS(n,e)<0?n:e}function f7(n,e){return uS(n,e)>0?n:e}function uS(n,e){const t=n.getSegment(),r=e.getSegment();return t===r?n.getOffset()-e.getOffset():t===void 0||r!==void 0&&t.ordinal<r.ordinal?-1:1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function p7(n){let e=0;if(He(n,ee.Transient)&&++e,He(n,ee.SlideOnRemove)&&++e,He(n,ee.StayOnRemove)&&++e,e>1)throw new ye("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}class ao{constructor(e,t,r=0,i=ee.Simple,s){this.client=e,this.offset=r,this.refType=i,p7(i),this.segment=t,this.properties=s}min(e){return h7(this,e)}max(e){return f7(this,e)}compare(e){return uS(this,e)}toPosition(){return this.getClient().localReferencePositionToPosition(this)}hasTileLabels(){return Ts(this)}hasRangeLabels(){return xs(this)}hasTileLabel(e){return ef(this,e)}hasRangeLabel(e){return cS(this,e)}getTileLabels(){return Xs(this)}getRangeLabels(){return Ys(this)}isLeaf(){return!1}addProperties(e,t){this.properties=dk(this.properties,e,t)}getClient(){return this.client}getSegment(){return this.segment}getOffset(){return this.offset}getProperties(){return this.properties}}ao.DetachedPosition=-1;function wu(n){Q(n instanceof ao,736)}class Qr{constructor(e,t=new Array(e.cachedLength)){this.segment=e,this.hierRefCount=0,this.refCount=0,this.refsByOffset=t}static append(e,t){t.localRefs&&!t.localRefs.empty?(e.localRefs||(e.localRefs=new Qr(e)),Q(e.localRefs.refsByOffset.length===e.cachedLength,702),e.localRefs.append(t.localRefs)):e.localRefs&&(e.localRefs.refsByOffset.length+=t.cachedLength)}[Symbol.iterator](){const e=[];for(const r of this.refsByOffset)r&&(r.before&&e.push(r.before[Symbol.iterator]()),r.at&&e.push(r.at[Symbol.iterator]()),r.after&&e.push(r.after[Symbol.iterator]()));return{next(){for(;e.length>0;){const r=e[0].next();if(r.done===!0)e.shift();else return r}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}clear(){this.refCount=0,this.hierRefCount=0;const e=t=>{if(t)for(const r of t)r.segment===this.segment&&(r.segment=void 0)};for(let t=0;t<this.refsByOffset.length;t++){const r=this.refsByOffset[t];r&&(e(r.before),e(r.at),e(r.before),this.refsByOffset[t]=void 0)}}get empty(){return this.refCount===0}createLocalRef(e,t,r,i){const s=new ao(i,this.segment,e,t,r);return He(s,ee.Transient)||this.addLocalRef(s),s}addLocalRef(e){var t,r;Q(!He(e,ee.Transient),735),wu(e);const i=this.refsByOffset[e.offset]=(t=this.refsByOffset[e.offset])!==null&&t!==void 0?t:{at:$o()};(i.at=(r=i.at)!==null&&r!==void 0?r:$o()).enqueue(e),(xs(e)||Ts(e))&&this.hierRefCount++,this.refCount++}removeLocalRef(e){wu(e);const t=i=>{if(i){let s=i;do if(s=s.next,s.data===e)return ak(s),(xs(e)||Ts(e))&&this.hierRefCount--,this.refCount--,e;while(!s.isHead)}},r=this.refsByOffset[e.offset];if(r!==void 0){let i=t(r.before);if(i||(i=t(r.at),i)||(i=t(r.after),i))return i}}append(e){if(!(!e||e.empty)){this.hierRefCount+=e.hierRefCount,this.refCount+=e.refCount,e.hierRefCount=0;for(const t of e)t.segment=this.segment,t.offset+=this.refsByOffset.length;this.refsByOffset.push(...e.refsByOffset)}}split(e,t){if(this.empty)this.refsByOffset.length=e;else{const r=new Qr(t,this.refsByOffset.splice(e,this.refsByOffset.length-e));t.localRefs=r;for(const i of r)i.segment=t,i.offset-=e,(xs(i)||Ts(i))&&(this.hierRefCount--,r.hierRefCount++),this.refCount--,r.refCount++}}addBeforeTombstones(...e){var t,r,i,s,o;const a=(r=(t=this.refsByOffset[0])===null||t===void 0?void 0:t.before)!==null&&r!==void 0?r:$o();for(const l of e)for(const c of l)wu(c),He(c,ee.SlideOnRemove)?(a.push(c),c.segment=this.segment,c.offset=0,(xs(c)||Ts(c))&&this.hierRefCount++,this.refCount++):c.segment=void 0;if(!a.empty()&&((i=this.refsByOffset[0])===null||i===void 0?void 0:i.before)===void 0){const l=this.refsByOffset[0]=(s=this.refsByOffset[0])!==null&&s!==void 0?s:{before:a};l.before=(o=l.before)!==null&&o!==void 0?o:a}}addAfterTombstones(...e){var t,r,i,s,o;const a=this.refsByOffset.length-1,l=(r=(t=this.refsByOffset[a])===null||t===void 0?void 0:t.after)!==null&&r!==void 0?r:$o();for(const c of e)for(const u of c)wu(u),He(u,ee.SlideOnRemove)?(l.push(u),u.segment=this.segment,u.offset=this.segment.cachedLength-1,(xs(u)||Ts(u))&&this.hierRefCount++,this.refCount++):u.segment=void 0;if(!l.empty()&&((i=this.refsByOffset[a])===null||i===void 0?void 0:i.after)===void 0){const c=this.refsByOffset[a]=(s=this.refsByOffset[a])!==null&&s!==void 0?s:{after:l};c.after=(o=c.after)!==null&&o!==void 0?o:l}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Cu={APPEND:-1,SPLIT:-2,UNLINK:-3,ACKNOWLEDGED:-4};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class m7{constructor(){this.ordinalSortedItems=[]}get size(){return this.ordinalSortedItems.length}get items(){return this.ordinalSortedItems}addOrUpdate(e,t){const r=this.findOrdinalPosition(this.getOrdinal(e));r.exists?t&&t(this.ordinalSortedItems[r.index],e):this.ordinalSortedItems.splice(r.index,0,e)}remove(e){const t=this.findOrdinalPosition(this.getOrdinal(e));return t.exists?(this.ordinalSortedItems.splice(t.index,1),!0):!1}has(e){return this.findOrdinalPosition(this.getOrdinal(e)).exists}getOrdinal(e){const t=e;return t!=null&&t.segment?t.segment.ordinal:e.ordinal}findOrdinalPosition(e,t,r){if(this.ordinalSortedItems.length===0)return{exists:!1,index:0};if(t===void 0||r===void 0)return this.findOrdinalPosition(e,0,this.ordinalSortedItems.length-1);const i=t+Math.floor((r-t)/2);return this.getOrdinal(this.ordinalSortedItems[i])>e?t===i?{exists:!1,index:i}:this.findOrdinalPosition(e,t,i-1):this.getOrdinal(this.ordinalSortedItems[i])<e?i===r?{exists:!1,index:i+1}:this.findOrdinalPosition(e,i+1,r):{exists:!0,index:i}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class g7{constructor(e){this.segment=e,this.trackingGroups=new Set}link(e){e&&(this.trackingGroups.has(e)||this.trackingGroups.add(e),e.has(this.segment)||e.link(this.segment))}unlink(e){e.has(this.segment)&&e.unlink(this.segment),this.trackingGroups.delete(e)}copyTo(e){this.trackingGroups.forEach(t=>e.trackingCollection.link(t))}get empty(){return this.trackingGroups.size===0}matches(e){if(!e||this.trackingGroups.size!==e.trackingGroups.size)return!1;for(const t of this.trackingGroups.values())if(!e.trackingGroups.has(t))return!1;return!0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function So(n,e){let t=-1,r=0,i=n.length-1;for(;r<=i;){const s=r+Math.floor((i-r)/2);n[s].seq<=e?((t<0||n[t].seq<n[s].seq)&&(t=s),r=s+1):i=s-1}return t}class Qe{constructor(e){this.minSeq=e,this.minLength=0,this.segmentCount=0,this.partialLengths=[],this.clientSeqNumbers=[]}static combine(e,t,r,i=!1){return Qe.combineBranch(e,t,r,i)}static combineBranch(e,t,r,i=!1){let s=new Qe(r.minSeq);Qe.fromLeaves(s,t,r);let o;function a(h){if(!h)return;const f=new mc(xE);return h.map(p=>(f.put(p.data.clientId,Object.assign({},p.data)),!0)),f}function l(h,f){const p=h.overlapRemoveClients;p?f.overlapRemoveClients&&f.overlapRemoveClients.map(g=>{const S=p.get(g.key);return S?S.data.seglen+=g.data.seglen:p.put(g.data.clientId,Object.assign({},g.data)),!0}):h.overlapRemoveClients=a(f.overlapRemoveClients)}function c(h){const f=h.seq;let p=0;if(o)if(o.seq===h.seq){o.seglen+=h.seglen,o.len+=h.seglen,l(o,h);return}else p=o.len,s.addClientSeqNumberFromPartial(o);o={clientId:h.clientId,len:p+h.seglen,overlapRemoveClients:a(h.overlapRemoveClients),seglen:h.seglen,seq:f},s.partialLengths.push(o)}const u=[];for(let h=0;h<t.childCount;h++){const f=t.children[h];if(!f.isLeaf()){const p=f;i&&(p.partialLengths=Qe.combine(e,p,r,!0)),u.push(p.partialLengths)}}let d=u.length;if(d!==0){s.partialLengths.length>0&&(u.push(s),d++,s=new Qe(r.minSeq));const h=new Array(d),f=new Array(d);for(let S=0;S<d;S++)h[S]=0,f[S]=u[S].partialLengths.length,s.minLength+=u[S].minLength,s.segmentCount+=u[S].segmentCount;let p=0,g;for(;p>=0;){p=-1;for(let S=0;S<d;S++)if(h[S]<f[S]){const m=u[S].partialLengths[h[S]];(p<0||m.seq<g.seq)&&(p=S,g=m)}p>=0&&(c(g),h[p]++)}o&&s.addClientSeqNumberFromPartial(o)}return Qe.options.zamboni&&s.zamboni(r),Qe.options.verify&&s.verify(),s}static fromLeaves(e,t,r){e.minLength=0,e.segmentCount=t.childCount;function i(l,c){return l!==void 0&&l!==re&&l<=c}for(let l=0;l<t.childCount;l++){const c=t.children[l];if(c.isLeaf()){const u=c;i(u.seq,r.minSeq)?e.minLength+=u.cachedLength:u.seq!==re&&Qe.insertSegment(e,u);const d=Vi(u);i(d==null?void 0:d.removedSeq,r.minSeq)?e.minLength-=u.cachedLength:d!==void 0&&d.removedSeq!==re&&Qe.insertSegment(e,u,d)}}const s=e.partialLengths,o=s.length;let a=0;for(let l=0;l<o;l++)s[l].len=a+s[l].seglen,a=s[l].len,e.addClientSeqNumberFromPartial(s[l]);Qe.options.verify&&e.verify()}static getOverlapClients(e,t){const r=new mc(xE);for(const i of e)r.put(i,{clientId:i,seglen:t});return r}static accumulateRemoveClientOverlap(e,t,r){if(e.overlapRemoveClients)for(const i of t){const s=e.overlapRemoveClients.get(i);s?s.data.seglen+=r:e.overlapRemoveClients.put(i,{clientId:i,seglen:r})}else e.overlapRemoveClients=Qe.getOverlapClients(t,r)}static insertSegment(e,t,r){let i=t.seq,s=t.cachedLength,o=t.clientId,a;r&&(i=r.removedSeq,s=-s,o=r.removedClientIds[0],a=r.removedClientIds.length>1?r.removedClientIds.slice(1):void 0);const l=e.partialLengths,c=l.length;let u=0;for(;u<c&&!(l[u].seq>=i);u++);if(u<c&&l[u].seq===i)l[u].seglen+=s,a&&Qe.accumulateRemoveClientOverlap(l[u],a,s);else{let d;if(a){const h=Qe.getOverlapClients(a,s);d={seq:i,clientId:o,len:0,seglen:s,overlapRemoveClients:h}}else d={seq:i,clientId:o,len:0,seglen:s};if(u<c){for(let h=c;h>u;h--)l[h]=l[h-1];l[u]=d}else l.push(d)}}static addSeq(e,t,r,i){let s,o,a=So(e,t);if(a>=0){const l=e[a];l.seq===t?(s=l,a=So(e,t-1),a>=0&&(o=e[a])):o=l}s===void 0?(s={clientId:i,seglen:r,seq:t},e.push(s)):s.seglen=r,o!==void 0?s.len=s.seglen+o.len:s.len=s.seglen}update(e,t,r,i,s){let o=0,a=0;for(let l=0;l<t.childCount;l++){const c=t.children[l];if(c.isLeaf()){const u=c,d=Vi(u);u.seq===r?(d==null?void 0:d.removedSeq)!==r&&(o+=u.cachedLength):(d==null?void 0:d.removedSeq)===r&&(o-=u.cachedLength),a++}else{const d=c.partialLengths,h=d.partialLengths,f=So(h,r);if(f>=0){const p=h[f];p.seq===r&&(o+=p.seglen)}a+=d.segmentCount}}this.segmentCount=a,Qe.addSeq(this.partialLengths,r,o,i),this.clientSeqNumbers[i]===void 0&&(this.clientSeqNumbers[i]=[]),Qe.addSeq(this.clientSeqNumbers[i],r,o),Qe.options.zamboni&&this.zamboni(s),Qe.options.verify&&this.verify()}getPartialLength(e,t){let r=this.minLength;const i=So(this.partialLengths,e),s=this.cliLatest(t),o=this.clientSeqNumbers[t];if(i>=0){if(r+=this.partialLengths[i].len,s>=0){const a=o[s];if(a.seq>e){r+=a.len;const l=this.cliLatestLEQ(t,e);l>=0&&(r-=o[l].len)}}}else if(s>=0){const a=o[s];r+=a.len}return r}toString(e,t=0){let r="";for(const i of this.partialLengths)r+=`(${i.seq},${i.len}) `;for(const i in this.clientSeqNumbers)if(this.clientSeqNumbers[i].length>0){r+="Client ",e?r+=`${e(+i)}`:r+=`${i}`,r+="[";for(const s of this.clientSeqNumbers[i])r+=`(${s.seq},${s.len})`;r+="]"}return r=`min(seq ${this.minSeq}): ${this.minLength}; sc: ${this.segmentCount};${r}`,r}zamboni(e){function t(r){const i=So(r,e.minSeq);let s=0;if(i>=0){s=r[i].len;const o=r.length;if(i<=o-1){const a=o-i-1;for(let l=0;l<a;l++)r[l]=r[l+i+1],r[l].len-=s;r.length=a}}return s}this.minLength+=t(this.partialLengths);for(const r in this.clientSeqNumbers){const i=this.clientSeqNumbers[r];i&&t(i)}}addClientSeqNumber(e,t,r){this.clientSeqNumbers[e]===void 0&&(this.clientSeqNumbers[e]=[]);const i=this.clientSeqNumbers[e];let s=r;i.length>0&&(s+=i[i.length-1].len),i.push({seq:t,len:s,seglen:r})}addClientSeqNumberFromPartial(e){this.addClientSeqNumber(e.clientId,e.seq,e.seglen),e.overlapRemoveClients&&e.overlapRemoveClients.map(t=>(this.addClientSeqNumber(t.data.clientId,e.seq,t.data.seglen),!0))}cliLatestLEQ(e,t){const r=this.clientSeqNumbers[e];return r?So(r,t):-1}cliLatest(e){const t=this.clientSeqNumbers[e];return t&&t.length>0?t.length-1:-1}verifyPartialLengths(e,t){if(e.length===0)return 0;let r=0,i=0,s=0;for(const o of e)s++,Q(this.minSeq<=o.seq,84),Q(r<o.seq,85),r=o.seq,i+=o.seglen,i!==o.len&&Q(!1,86),t||this.minLength+o.len<0&&Q(!1,87),o.overlapRemoveClients&&(Q(!t,88),s+=o.overlapRemoveClients.size());return s}verify(){if(this.clientSeqNumbers){let e=0;for(const r of this.clientSeqNumbers)r&&(e+=this.verifyPartialLengths(r,!0));Q(!!this.partialLengths,89);const t=this.verifyPartialLengths(this.partialLengths,!1);Q(t===e,90)}else Q(!this.partialLengths,91)}}Qe.options={verify:!1,zamboni:!0};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class v7{constructor(e){this.segment=e,this.segmentGroups=$o()}get size(){return this.segmentGroups.count()}get empty(){return this.segmentGroups.empty()}enqueue(e){this.segmentGroups.enqueue(e),e.segments.push(this.segment)}dequeue(){return this.segmentGroups.dequeue()}clear(){this.segmentGroups.clear()}copyTo(e){this.segmentGroups.walk(t=>e.segmentGroups.enqueue(t))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ya{constructor(){this.pendingRewriteCount=0}ackPendingProperties(e){var t,r;e.combiningOp&&e.combiningOp.name==="rewrite"&&this.pendingRewriteCount--;for(const i of Object.keys(e.props))((t=this.pendingKeyUpdateCount)===null||t===void 0?void 0:t[i])!==void 0&&(Q(this.pendingKeyUpdateCount[i]>0,92),this.pendingKeyUpdateCount[i]--,((r=this.pendingKeyUpdateCount)===null||r===void 0?void 0:r[i])===0&&delete this.pendingKeyUpdateCount[i])}addProperties(e,t,r,i,s=!1){var o;if(this.pendingKeyUpdateCount||(this.pendingKeyUpdateCount=Vt()),this.pendingRewriteCount>0&&i!==re&&s)return;const a=r&&r.name==="rewrite",l=a?void 0:r||void 0,c=d=>{var h;return!!(i===re||((h=this.pendingKeyUpdateCount)===null||h===void 0?void 0:h[d])===void 0||l)},u={};if(a){s&&i===re&&this.pendingRewriteCount++;for(const d of Object.keys(e))!t[d]&&c(d)&&(u[d]=e[d],delete e[d])}for(const d of Object.keys(t)){if(s){if(i===re)((o=this.pendingKeyUpdateCount)===null||o===void 0?void 0:o[d])===void 0&&(this.pendingKeyUpdateCount[d]=0),this.pendingKeyUpdateCount[d]++;else if(!c(d))continue}const h=e[d];u[d]=h===void 0?null:h;let f;l?f=ck(l,h,f,i):f=t[d],f===null?delete e[d]:e[d]=f}return u}copyTo(e,t,r){if(e){if(t||(t=Vt()),!r)throw new Error("Must provide new PropertyManager");for(const i of Object.keys(e))t[i]=e[i];r.pendingRewriteCount=this.pendingRewriteCount,r.pendingKeyUpdateCount=Vt();for(const i of Object.keys(this.pendingKeyUpdateCount))r.pendingKeyUpdateCount[i]=this.pendingKeyUpdateCount[i]}return t}hasPendingProperties(){return this.pendingRewriteCount>0||Object.keys(this.pendingKeyUpdateCount).length>0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Vi(n){if((n==null?void 0:n.removedClientIds)!==void 0&&(n==null?void 0:n.removedSeq)!==void 0)return n;Q((n==null?void 0:n.removedClientIds)===void 0&&(n==null?void 0:n.removedSeq)===void 0,703)}function y7(n){return Vi(n)!==void 0}function lm(n){const e=Vi(n);return e!==void 0&&e.removedSeq!==re}class hk{constructor(){this.index=0,this.ordinal="",this.cachedLength=0}isLeaf(){return!1}}function _E(n,e){const t=Xs(n);if(t)for(const r of t)e[r]=n}function EE(n,e){const t=Xs(n);if(t)for(const r of t)e[r]===void 0&&(e[r]=n)}function fk(n,e){for(const t in e){const r=e[t];if(!r.empty()){let i=n[t];i===void 0&&(i=new lS,n[t]=i);for(const s of r.items)dS(i,s)}}}function dS(n,e){if(He(e,ee.NestBegin))return n.push(e),!0;{const t=n.top();return t&&He(t,ee.NestBegin)?n.pop():n.push(e),!1}}function S7(n,e,t,r,i){var s;function o(a,l){let c=i[a];c===void 0&&(c=new lS,i[a]=c),dS(c,l)}if(e.isLeaf()){const a=e;if(((s=n.localNetLength(a))!==null&&s!==void 0?s:0)>0)if(_t.is(a)){const l=a.getId();if(l&&n.mapIdToSegment(l,a),He(a,ee.Tile)&&(_E(a,t),EE(a,r)),a.refType&(ee.NestBegin|ee.NestEnd)){const c=Ys(a);if(c)for(const u of c)o(u,a)}}else{const l=e;if(l.localRefs&&l.localRefs.hierRefCount!==void 0&&l.localRefs.hierRefCount>0){for(const c of l.localRefs)if(He(c,ee.Tile)&&(_E(c,t),EE(c,r)),c.refType&(ee.NestBegin|ee.NestEnd))for(const u of Ys(c))o(u,c)}}}else{const a=e;fk(i,a.rangeStacks),uk(t,a.rightmostTiles),u7(r,a.leftmostTiles)}}const un=8;class b7 extends hk{constructor(e){super(),this.childCount=e,this.children=new Array(un)}hierBlock(){}setOrdinal(e,t){let r=this.childCount;r===8&&(r=7),Q(r>=1&&r<=7,64);let i;const s=1<<un-(r+1);if(t===0)i=s-1;else{const o=this.children[t-1].ordinal;i=o.charCodeAt(o.length-1)+s}e.ordinal=this.ordinal+String.fromCharCode(i),Q(e.ordinal.length===this.ordinal.length+1,65),t>0&&Q(e.ordinal>this.children[t-1].ordinal,66)}assignChild(e,t,r=!0){e.parent=this,e.index=t,r&&this.setOrdinal(e,t),this.children[t]=e}}class w7 extends b7{constructor(e){super(e),this.rightmostTiles=Vt(),this.leftmostTiles=Vt(),this.rangeStacks=Vt()}addNodeReferences(e,t){S7(e,t,this.rightmostTiles,this.leftmostTiles,this.rangeStacks)}hierBlock(){return this}hierToString(e){let t="";for(const r in this.rangeStacks){const i=this.rangeStacks[r];t+=O7(e),t+=`${r}: `;for(const s of i.items)t+=`${s.toString()} `;t+=`
`}return t}}function C7(n,e){return e.isLeaf()?n.localNetLength(e):e.cachedLength}class tf extends hk{constructor(){super(...arguments),this.clientId=Es,this.seq=Ut,this.segmentGroups=new v7(this),this.trackingCollection=new g7(this)}addProperties(e,t,r,i){return this.propertyManager||(this.propertyManager=new ya),this.properties||(this.properties=Vt()),this.propertyManager.addProperties(this.properties,e,t,r,i&&i.collaborating)}hasProperty(e){return!!this.properties&&this.properties[e]!==void 0}isLeaf(){return!0}cloneInto(e){var t;e.clientId=this.clientId,e.properties=c7(this.properties),e.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),e.removedSeq=this.removedSeq,e.seq=this.seq}canAppend(e){return!1}addSerializedProps(e){this.properties&&(e.props=this.properties)}ack(e,t,r){const i=this.segmentGroups.dequeue();switch(Q(i===e,67),t.op.type){case ce.ANNOTATE:return Q(!!this.propertyManager,68),this.propertyManager.ackPendingProperties(t.op),!0;case ce.INSERT:return Q(this.seq===re,69),this.seq=t.sequencedMessage.sequenceNumber,this.localSeq=void 0,!0;case ce.REMOVE:const s=Vi(this);return Q(s!==void 0,70),this.localRemovedSeq=void 0,s.removedSeq===re?(s.removedSeq=t.sequencedMessage.sequenceNumber,!0):!1;default:throw new Error(`${t.op.type} is in unrecognized operation type`)}}splitAt(e){var t;if(e>0){const r=this.createSplitSegmentAt(e);return r&&(this.copyPropertiesTo(r),r.parent=this.parent,r.ordinal=this.ordinal+String.fromCharCode(0),r.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),r.removedSeq=this.removedSeq,r.localRemovedSeq=this.localRemovedSeq,r.seq=this.seq,r.localSeq=this.localSeq,r.clientId=this.clientId,this.segmentGroups.copyTo(r),this.trackingCollection.copyTo(r),this.localRefs&&this.localRefs.split(e,r)),r}}copyPropertiesTo(e){this.propertyManager&&this.properties&&(e.propertyManager=new ya,e.properties=this.propertyManager.copyTo(this.properties,e.properties,e.propertyManager))}}const TE="markerId",_7="markerSimpleType";class _t extends tf{constructor(e){super(),this.refType=e,this.type=_t.type,this.cachedLength=1}static is(e){return e.type===_t.type}static make(e,t){const r=new _t(e);return t&&r.addProperties(t),r}toJSONObject(){const e={marker:{refType:this.refType}};return super.addSerializedProps(e),e}static fromJSONObject(e){if(e&&typeof e=="object"&&"marker"in e)return _t.make(e.marker.refType,e.props)}clone(){const e=_t.make(this.refType,this.properties);return this.cloneInto(e),e}getSegment(){return this}getOffset(){return 0}hasSimpleType(e){return!!this.properties&&this.properties[_7]===e}getProperties(){return this.properties}getId(){if(this.properties&&this.properties[TE])return this.properties[TE]}hasTileLabels(){return Ts(this)}hasRangeLabels(){return xs(this)}hasTileLabel(e){return ef(this,e)}hasRangeLabel(e){return cS(this,e)}getTileLabels(){return Xs(this)}getRangeLabels(){return Ys(this)}toString(){let e="";He(this,ee.Tile)&&(e+="Tile"),He(this,ee.NestBegin)&&(e.length>0&&(e+="; "),e+="RangeBegin"),He(this,ee.NestEnd)&&(e.length>0&&(e+="; "),e+="RangeEnd");let t="";const r=this.getId();r&&(e+=` (${r}) `);const i=Xs(this);if(i){t+="tile -- ";for(let a=0,l=i.length;a<l;a++){const c=i[a];a>0&&(t+="; "),t+=c}}const s=Ys(this);if(s){let a="begin";He(this,ee.NestEnd)&&(a="end"),i&&(t+=" "),t+=`range ${a} -- `;const l=s;for(let c=0,u=l.length;c<u;c++){const d=l[c];c>0&&(t+="; "),t+=d}}let o="";return this.properties&&(o+=JSON.stringify(this.properties,(a,l)=>{const c=!!l&&l.IFluidHandle;return c?`#Handle(${c.routeContext.path}/${c.path})`:l})),`M ${e}: ${t} ${o}`}createSplitSegmentAt(e){}canAppend(e){return!1}append(){throw new Error("Can not append to marker")}}_t.type="Marker";var ea;(function(n){n[n.Go=0]="Go",n[n.Stop=1]="Stop",n[n.Yield=2]="Yield"})(ea||(ea={}));class E7{constructor(e,t,r,i,s,o,a,l,c=0){this.block=e,this.actions=t,this.pos=r,this.refSeq=i,this.clientId=s,this.context=o,this.start=a,this.end=l,this.childIndex=c,this.op=ea.Go}}class T7{constructor(){this.clientId=Es,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0}loadFrom(e){this.clientId=e.clientId,this.collaborating=e.collaborating,this.minSeq=e.minSeq,this.currentSeq=e.currentSeq}}const xE=(n,e)=>n-e,x7=(n,e)=>n.localeCompare(e),_u=[""," ","  "];function O7(n){if(_u[n]===void 0){_u[n]="";for(let e=0;e<n;e++)_u[n]+=" "}return _u[n]}const P7={min:{maxSeq:-2},compare:(n,e)=>n.maxSeq-e.maxSeq};function pk(n,e){for(const t of e.rangeLabels)if(cS(n,t)){let r=e.stacks[t];r===void 0&&(r=new lS,e.stacks[t]=r),dS(r,n)}}function R7(n,e,t,r,i,s,o){return _t.is(n)&&n.refType&(ee.NestBegin|ee.NestEnd)&&pk(n,o),!1}function k7(n,e,t,r,i,s,o){var a;if(n.isLeaf()){const l=n;((a=o.mergeTree.localNetLength(l))!==null&&a!==void 0?a:0)>0&&_t.is(l)&&l.refType&(ee.NestBegin|ee.NestEnd)&&pk(l,o)}else{const l=n;fk(o.stacks,l.rangeStacks)}return!0}function OE(n,e,t,r,i,s,o){return _t.is(n)&&ef(n,o.tileLabel)&&(o.tile=n),!1}function PE(n,e,t,r,i,s,o){if(n.isLeaf()){const a=n;o.mergeTree.localNetLength(a)>0&&_t.is(a)&&ef(a,o.tileLabel)&&(o.tile=a)}else{const a=n;let l;o.posPrecedesTile?l=a.rightmostTiles[o.tileLabel]:l=a.leftmostTiles[o.tileLabel],l!==void 0&&(o.tile=l)}return!0}const N7={min:{minRequired:Number.MIN_VALUE,onMinGE:()=>{Q(!1,72)}},compare:(n,e)=>n.minRequired-e.minRequired};class tt{constructor(e){this.options=e,this.blockUpdateActions=tt.initBlockUpdateActions,this.collabWindow=new T7,this.idToSegment=new Map,this.splitLeafSegment=(t,r)=>{if(!(r>0&&t))return{};const i=t.splitAt(r);return this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Cu.SPLIT,deltaSegments:[{segment:t},{segment:i}]},void 0),{next:i}},this.root=this.makeBlock(0)}makeBlock(e){const t=new w7(e);return t.ordinal="",t}clone(){const e=new tt(this.options);e.root=e.blockClone(this.root)}blockClone(e,t){const r=this.makeBlock(e.childCount);for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=this.segmentClone(s);r.assignChild(o,i),t&&t.push(o)}else r.assignChild(this.blockClone(s,t),i)}return this.nodeUpdateLengthNewStructure(r),this.nodeUpdateOrdinals(r),r}segmentClone(e){return e.clone()}localNetLength(e){return Vi(e)!==void 0?0:e.cachedLength}mapIdToSegment(e,t){this.idToSegment.set(e,t)}addNode(e,t){const r=e.childCount++;return e.assignChild(t,r,!1),r}reloadFromSegments(e){Q(!this.collabWindow.collaborating,73);const t=un-1,r=i=>{const s=Math.ceil(i.length/t),o=new Array(s);for(let a=0,l=0;l<s;l++){const c=o[l]=this.makeBlock(0);for(let u=0;u<t&&a<i.length;u++,a++)this.addNode(c,i[a]);this.blockUpdate(c)}return o.length===1?o[0]:r(o)};e.length>0?(this.root=r(e),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}startCollaboration(e,t,r){this.collabWindow.clientId=e,this.collabWindow.minSeq=t,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=r,this.segmentsToScour=new CE([],P7),this.pendingSegments=$o(),this.nodeUpdateLengthNewStructure(this.root,!0)}addToLRUSet(e,t){e.parent.needsScour!==!0&&t>this.collabWindow.currentSeq&&(e.parent.needsScour=!0,this.segmentsToScour.add({segment:e,maxSeq:t}))}underflow(e){return e.childCount<un/2}scourNode(e,t){let r;for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=s;o.segmentGroups.empty?o.removedSeq!==void 0?(o.removedSeq>this.collabWindow.minSeq?t.push(o):o.trackingCollection.empty?(this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Cu.UNLINK,deltaSegments:[{segment:o}]},void 0),o.parent=void 0):t.push(o),r=void 0):o.seq<=this.collabWindow.minSeq?r&&r.canAppend(o)&&qc(r.properties,o.properties)&&r.trackingCollection.matches(o.trackingCollection)&&this.localNetLength(o)>0?(r.append(o),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Cu.APPEND,deltaSegments:[{segment:r},{segment:o}]},void 0),o.parent=void 0,o.trackingCollection.trackingGroups.forEach(l=>l.unlink(o))):(t.push(o),this.localNetLength(o)>0?r=o:r=void 0):(t.push(o),r=void 0):(t.push(o),r=void 0)}else t.push(s),r=void 0}}packParent(e){const t=e.children;let r,i;const s=[];for(r=0;r<e.childCount;r++)i=t[r],this.scourNode(i,s),i.parent=void 0;const o=s.length,a=un/2;let l=Math.min(un-1,Math.floor(o/a));l<1&&(l=1);const c=Math.floor(o/l);let u=o%l;const d=new Array(un);let h=0;for(let f=0;f<l;f++){let p=c;u>0&&(p++,u--);const g=this.makeBlock(p);for(let S=0;S<p;S++){const m=s[h++];g.assignChild(m,S,!1)}g.parent=e,d[f]=g,this.nodeUpdateLengthNewStructure(g)}e.children=d;for(let f=0;f<l;f++)e.assignChild(d[f],f,!1);e.childCount=l,this.underflow(e)&&e.parent?this.packParent(e.parent):(this.nodeUpdateOrdinals(e),this.blockUpdatePathLengths(e,re,-1,!0))}zamboniSegments(e=tt.zamboniSegmentsMaxCount){if(this.collabWindow.collaborating)for(let t=0;t<e;t++){let r=this.segmentsToScour.peek();if(!r||r.maxSeq>this.collabWindow.minSeq)break;if(r=this.segmentsToScour.get(),r.segment.parent&&r.segment.parent.needsScour!==!1){const i=r.segment.parent,s=[];this.scourNode(i,s),i.needsScour=!1;const o=s.length;if(o<i.childCount){i.childCount=o,i.children=s;for(let a=0;a<o;a++)i.assignChild(s[a],a,!1);this.underflow(i)&&i.parent?this.packParent(i.parent):(this.nodeUpdateOrdinals(i),this.blockUpdatePathLengths(i,re,-1,!0))}}}}getCollabWindow(){return this.collabWindow}getStats(){const e=r=>{const i={maxHeight:0,nodeCount:0,leafCount:0,removedLeafCount:0,liveCount:0,histo:[]};for(let s=0;s<un;s++)i.histo[s]=0;for(let s=0;s<r.childCount;s++){const o=r.children[s];let a=1;if(o.isLeaf())i.leafCount++,o.removedSeq!==void 0&&i.removedLeafCount++;else{const l=e(o);a=1+l.maxHeight,i.nodeCount+=l.nodeCount,i.leafCount+=l.leafCount,i.removedLeafCount+=l.removedLeafCount,i.liveCount+=l.liveCount;for(let c=0;c<un;c++)i.histo[c]+=l.histo[c]}a>i.maxHeight&&(i.maxHeight=a)}return i.histo[r.childCount]++,i.nodeCount++,i.liveCount+=r.childCount,i};return e(this.root)}getLength(e,t){return this.blockLength(this.root,e,t)}get length(){return this.root.cachedLength}getPosition(e,t,r){var i;let s=0,o=e.parent,a;for(;o;){const l=o.children;for(let c=0;c<o.childCount;c++){const u=l[c];if(a&&u===a||u===e)break;s+=(i=this.nodeLength(u,t,r))!==null&&i!==void 0?i:0}a=o,o=o.parent}return s}getContainingSegment(e,t,r){let i,s;const o=(a,l,c,u,d)=>(i=a,s=d,!1);return this.searchBlock(this.root,e,0,t,r,{leaf:o},void 0),{segment:i,offset:s}}_getSlideToSegment(e){if(!e.segment||!lm(e.segment))return e;let t;const r=i=>i.seq!==re&&!lm(i)?(t=i,!1):!0;return this.rightExcursion(e.segment,r),t?{segment:t,offset:0}:(this.leftExcursion(e.segment,r),t=t,t?{segment:t,offset:t.cachedLength-1}:{segment:void 0,offset:0})}slideReferences(e,t){var r,i,s,o,a;Q(lm(e),753),Q(!!e.localRefs,754);const l=this._getSlideToSegment({segment:e,offset:0}),c=l.segment;c&&!c.localRefs&&(c.localRefs=new Qr(c));for(const u of t){(i=(r=u.callbacks)===null||r===void 0?void 0:r.beforeSlide)===null||i===void 0||i.call(r);const d=e.localRefs.removeLocalRef(u);Q(u===d,755),c?(u.segment=c,u.offset=(s=l.offset)!==null&&s!==void 0?s:0,Q(!!c.localRefs,756),c.localRefs.addLocalRef(u)):(u.segment=void 0,u.offset=0),(a=(o=u.callbacks)===null||o===void 0?void 0:o.afterSlide)===null||a===void 0||a.call(o)}c&&this.blockUpdatePathLengths(c.parent,cs,Es)}updateSegmentRefsAfterMarkRemoved(e,t){if(!e.localRefs||e.localRefs.empty)return;const r=[],i=[];for(const s of e.localRefs)He(s,ee.StayOnRemove)?i.push(s):He(s,ee.SlideOnRemove)&&(t?i.push(s):r.push(s));t||this.slideReferences(e,r),e.localRefs.clear();for(const s of i)s.segment=e,e.localRefs.addLocalRef(s)}blockLength(e,t,r){return this.collabWindow.collaborating&&r!==this.collabWindow.clientId?e.partialLengths.getPartialLength(t,r):e.cachedLength}nodeLength(e,t,r){if(!this.collabWindow.collaborating||this.collabWindow.clientId===r)return e.isLeaf()?this.localNetLength(e):e.cachedLength;if(e.isLeaf()){const i=e,s=Vi(i);return s!==void 0&&s.removedSeq!==re&&s.removedSeq<=t?void 0:i.clientId===r||i.seq!==re&&i.seq<=t?s!==void 0&&s.removedClientIds.includes(r)?0:i.cachedLength:s!==void 0&&s.removedSeq!==re?void 0:0}else return e.partialLengths.getPartialLength(t,r)}addMinSeqListener(e,t){this.minSeqListeners||(this.minSeqListeners=new CE([],N7)),this.minSeqListeners.add({minRequired:e,onMinGE:t})}notifyMinSeqListeners(){if(this.minSeqListeners)for(;this.minSeqListeners.count()>0&&this.minSeqListeners.peek().minRequired<=this.collabWindow.minSeq;)this.minSeqListeners.get().onMinGE(this.collabWindow.minSeq)}setMinSeq(e){Q(e<=this.collabWindow.currentSeq,78),Q(this.collabWindow.minSeq<=e,79),e>this.collabWindow.minSeq&&(this.collabWindow.minSeq=e,tt.options.zamboniSegments&&this.zamboniSegments(),this.notifyMinSeqListeners())}referencePositionToLocalPosition(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){const i=e.getSegment();return i&&i.parent?(i.removedSeq?0:e.getOffset())+this.getPosition(i,t,r):ao.DetachedPosition}getStackContext(e,t,r){const i={mergeTree:this,stacks:Vt(),rangeLabels:r};return this.search(e,Ut,t,{leaf:R7,shift:k7},i),i.stacks}findTile(e,t,r,i=!0){const s={mergeTree:this,posPrecedesTile:i,tileLabel:r};if(i?this.search(e,Ut,t,{leaf:OE,shift:PE},s):this.backwardSearch(e,Ut,t,{leaf:OE,shift:PE},s),s.tile){let o;if(s.tile.isLeaf()){const a=s.tile;o=this.getPosition(a,Ut,t)}else o=s.tile.toPosition();return{tile:s.tile,pos:o}}}search(e,t,r,i,s){return this.searchBlock(this.root,e,0,t,r,i,s)}searchBlock(e,t,r,i,s,o,a){var l;let c=t,u=r;const d=e.children;o&&o.pre&&o.pre(e,u,i,s,void 0,void 0,a);const h=o&&o.contains;for(let f=0;f<e.childCount;f++){const p=d[f],g=(l=this.nodeLength(p,i,s))!==null&&l!==void 0?l:0;if(!h&&c<g||h&&h(p,c,i,s,void 0,void 0,a))return p.isLeaf()?(o&&o.leaf&&o.leaf(p,u,i,s,c,-1,a),p):this.searchBlock(p,c,u,i,s,o,a);o&&o.shift&&o.shift(p,u,i,s,c,void 0,a),c-=g,u+=g}o&&o.post&&o.post(e,u,i,s,void 0,void 0,a)}backwardSearch(e,t,r,i,s){const o=this.getLength(t,r);if(!(e>o))return this.backwardSearchBlock(this.root,e,o,t,r,i,s)}backwardSearchBlock(e,t,r,i,s,o,a){var l;let c=r;const u=e.children;o&&o.pre&&o.pre(e,c,i,s,void 0,void 0,a);const d=o&&o.contains;for(let h=e.childCount-1;h>=0;h--){const f=u[h],p=(l=this.nodeLength(f,i,s))!==null&&l!==void 0?l:0,g=c-p;if(!d&&t>=g||d&&d(f,t,i,s,void 0,void 0,a))return f.isLeaf()?(o&&o.leaf&&o.leaf(f,g,i,s,t,-1,a),f):this.backwardSearchBlock(f,t,c,i,s,o,a);o&&o.shift&&o.shift(f,g,i,s,t,void 0,a),c=g}o&&o.post&&o.post(e,c,i,s,void 0,void 0,a)}updateRoot(e){if(e!==void 0){const t=this.makeBlock(2);t.assignChild(this.root,0,!1),t.assignChild(e,1,!1),this.root=t,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}}ackPendingSegment(e){const t=e.sequencedMessage.sequenceNumber,r=this.pendingSegments.dequeue(),i=[];let s=!1;if(r!==void 0){const o=[];r.segments.map(l=>{const c=!l.ack(r,e,this);s=c||s,!c&&e.op.type===ce.REMOVE&&this.updateSegmentRefsAfterMarkRemoved(l,!1),tt.options.zamboniSegments&&this.addToLRUSet(l,t),i.includes(l.parent)||i.push(l.parent),o.push({segment:l})}),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({deltaSegments:o,operation:Cu.ACKNOWLEDGED},e);const a=this.collabWindow.clientId;for(const l of i)this.blockUpdatePathLengths(l,t,a,s)}tt.options.zamboniSegments&&this.zamboniSegments()}addToPendingList(e,t,r){let i=t;return i===void 0&&(i={segments:[],localSeq:r},this.pendingSegments.enqueue(i)),e.segmentGroups.enqueue(i),i}getMarkerFromId(e){return this.idToSegment.get(e)}posFromRelativePos(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){let i=-1,s;return e.id&&(s=this.getMarkerFromId(e.id)),s&&(i=this.getPosition(s,t,r),e.before?e.offset!==void 0&&(i-=e.offset):(i+=s.cachedLength,e.offset!==void 0&&(i+=e.offset))),i}insertSegments(e,t,r,i,s,o){this.ensureIntervalBoundary(e,r,i);const a=s===re?++this.collabWindow.localSeq:void 0;this.blockInsert(e,r,i,s,a,t),this.mergeTreeDeltaCallback&&o!==void 0&&this.mergeTreeDeltaCallback(o,{operation:ce.INSERT,deltaSegments:t.map(l=>({segment:l}))}),this.collabWindow.collaborating&&tt.options.zamboniSegments&&s!==re&&this.zamboniSegments()}insertAtReferencePosition(e,t,r){if(t.cachedLength===0)return;if(t.parent||t.removedSeq||t.seq!==Ut)throw new Error("Cannot insert segment that has already been inserted.");const i=u=>{let d=u.parent,h=d;for(;d!==void 0;){if(d.childCount>=un){const f=this.split(d);d===this.root?(this.updateRoot(f),h=void 0):(this.insertChildNode(d.parent,f,d.index+1),h=f.parent,this.blockUpdateLength(d.parent,re,s))}else this.blockUpdateLength(d,re,s);d=d.parent}h&&this.nodeUpdateOrdinals(h)},s=this.collabWindow.clientId,o=e.getSegment(),a=e.getOffset(),l=this.nodeLength(o,this.collabWindow.currentSeq,s);let c=o;if(a!==0&&l!==void 0&&l!==0){const u=this.splitLeafSegment(o,a);Q(!!u.next,80),this.insertChildNode(o.parent,u.next,o.index+1),i(u.next),c=u.next}if(this.leftExcursion(c,u=>{if(!u.isLeaf())return!0;const d=this.nodeLength(u,this.collabWindow.currentSeq,s);return d===void 0?!0:d===0?(this.breakTie(0,u,re)&&(c=u),!0):!1}),this.collabWindow.collaborating?(t.localSeq=++this.collabWindow.localSeq,t.seq=re):t.seq=Ut,t.clientId=s,_t.is(t)){const u=t.getId();u&&this.mapIdToSegment(u,t)}this.insertChildNode(c.parent,t,c.index),i(t),this.mergeTreeDeltaCallback&&this.mergeTreeDeltaCallback(r,{deltaSegments:[{segment:t}],operation:ce.INSERT}),this.collabWindow.collaborating&&this.addToPendingList(t,void 0,t.localSeq)}resolveRemoteClientPosition(e,t,r){if(t<this.collabWindow.minSeq)return;const i=this.getContainingSegment(e,t,r),s=this.getCollabWindow();if(i&&i.segment)return this.getPosition(i.segment,s.currentSeq,s.clientId)+i.offset;if(e===this.getLength(t,r))return this.getLength(s.currentSeq,s.clientId)}insertChildNode(e,t,r){Q(e.childCount<un,81);for(let i=e.childCount;i>r;i--)e.children[i]=e.children[i-1],e.children[i].index=i;e.childCount++,e.assignChild(t,r,!1)}blockInsert(e,t,r,i,s,o){let a=!1;const l=p=>(p.seq===re&&(a=!0),!1),c=p=>(a=!1,this.rightExcursion(p,l),a);let u;const d=p=>{this.collabWindow.collaborating&&(p.seq===re&&r===this.collabWindow.clientId?u=this.addToPendingList(p,u,s):p.seq>this.collabWindow.minSeq&&tt.options.zamboniSegments&&this.addToLRUSet(p,p.seq))},h=(p,g,S)=>{const m={};return p?(m.replaceCurrent=S.candidateSegment,m.next=p):m.next=S.candidateSegment,m};let f=e;for(const p of o)if(a=!1,p.cachedLength>0){if(p.seq=i,p.localSeq=s,p.clientId=r,_t.is(p)){const S=p.getId();S&&this.mapIdToSegment(S,p)}const g=this.insertingWalk(this.root,f,t,r,i,{leaf:h,candidateSegment:p,continuePredicate:c});if(p.parent===void 0)throw new Error(`MergeTree insert failed: ${JSON.stringify({currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:p.seq})}`);this.updateRoot(g),d(p),f+=p.cachedLength}}ensureIntervalBoundary(e,t,r){const i=this.insertingWalk(this.root,e,t,r,cs,{leaf:this.splitLeafSegment});this.updateRoot(i)}breakTie(e,t,r){var i;if(t.isLeaf()){if(e===0){const s=r===re?Number.MAX_SAFE_INTEGER:r,o=t.seq===re?Number.MAX_SAFE_INTEGER-1:(i=t.seq)!==null&&i!==void 0?i:0;return s>o}return!1}else return!0}leftExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let a,l,c=!1;for(a=s.childCount-1;a>=0;a--)if(l=o[a],c){if(l.isLeaf())r=t(l,0,Ut,this.collabWindow.clientId,0,0,void 0);else{const u=l;r=this.nodeMapReverse(u,t,0,Ut,this.collabWindow.clientId)}if(!r)return}else c=i===l;i=s,s=s.parent}}rightExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let a,l,c=!1;for(a=0;a<s.childCount;a++)if(l=o[a],c){if(l.isLeaf())r=t(l);else{const u=l;r=this.walkAllSegments(u,t)}if(!r)return}else c=i===l;i=s,s=s.parent}}insertingWalk(e,t,r,i,s,o){let a=t;const l=e.children;let c,u,d,h;for(c=0;c<e.childCount;c++){u=l[c];const f=this.nodeLength(u,r,i);if(f!==void 0)if(a<f||a===f&&this.breakTie(a,u,s)){if(u.isLeaf()){const p=u,g=o.leaf(p,a,o);if(g.replaceCurrent&&(e.assignChild(g.replaceCurrent,c,!1),g.replaceCurrent.ordinal=u.ordinal),g.next)d=g.next,c++;else{o.structureChange&&this.nodeUpdateLengthNewStructure(e);return}}else{const p=u,g=this.insertingWalk(p,a,r,i,s,o);if(g===void 0){o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else if(g===tt.theUnfinishedNode){a-=f;continue}else d=g,h=g,c++}break}else a-=f}if(!d&&a===0){if(s!==re&&o.continuePredicate&&o.continuePredicate(e))return tt.theUnfinishedNode;d=o.leaf(void 0,a,o).next}if(d){for(let f=e.childCount;f>c;f--)e.children[f]=e.children[f-1],e.children[f].index=f;if(e.assignChild(d,c,!1),e.childCount++,e.setOrdinal(d,c),e.childCount<un){h&&this.nodeUpdateOrdinals(h),o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else return this.split(e)}else return}split(e){const t=un/2,r=this.makeBlock(t);e.childCount=t,this.nodeUpdateOrdinals(e);for(let i=0;i<t;i++)r.assignChild(e.children[t+i],i,!1),e.children[t+i]=void 0;return this.nodeUpdateLengthNewStructure(e),this.nodeUpdateLengthNewStructure(r),r}nodeUpdateOrdinals(e){for(let t=0;t<e.childCount;t++){const r=e.children[t];e.setOrdinal(r,t),r.isLeaf()||this.nodeUpdateOrdinals(r)}}annotateRange(e,t,r,i,s,o,a,l){this.ensureIntervalBoundary(e,s,o),this.ensureIntervalBoundary(t,s,o);const c=[],u=a===re?++this.collabWindow.localSeq:void 0;let d;const h=f=>{const p=f.addProperties(r,i,a,this.collabWindow);return c.push({segment:f,propertyDeltas:p}),this.collabWindow.collaborating&&(a===re?d=this.addToPendingList(f,d,u):tt.options.zamboniSegments&&this.addToLRUSet(f,a)),!0};this.mapRange({leaf:h},s,o,void 0,e,t),this.mergeTreeDeltaCallback&&c.length>0&&this.mergeTreeDeltaCallback(l,{operation:ce.ANNOTATE,deltaSegments:c}),this.collabWindow.collaborating&&a!==re&&tt.options.zamboniSegments&&this.zamboniSegments()}markRangeRemoved(e,t,r,i,s,o=!1,a){let l=o;this.ensureIntervalBoundary(e,r,i),this.ensureIntervalBoundary(t,r,i);let c;const u=[],d=[],h=s===re?++this.collabWindow.localSeq:void 0,f=(S,m,v,y)=>{const b=Vi(S);return b!==void 0?(l=!0,b.removedSeq===re?(b.removedClientIds.unshift(i),b.removedSeq=s,S.localRemovedSeq=void 0):b.removedClientIds.push(i)):(S.removedClientIds=[i],S.removedSeq=s,S.localRemovedSeq=h,u.push({segment:S})),S.localRefs&&!S.localRefs.empty&&d.push(S),this.collabWindow.collaborating&&(S.removedSeq===re&&i===this.collabWindow.clientId?c=this.addToPendingList(S,c,h):tt.options.zamboniSegments&&this.addToLRUSet(S,s)),!0},p=(S,m,v,y)=>(l?this.nodeUpdateLengthNewStructure(S):this.blockUpdateLength(S,s,i),!0);this.mapRange({leaf:f,post:p},r,i,void 0,e,t);const g=this.collabWindow.collaborating&&i===this.collabWindow.clientId;for(const S of d)this.updateSegmentRefsAfterMarkRemoved(S,g);this.mergeTreeDeltaCallback&&u.length>0&&this.mergeTreeDeltaCallback(a,{operation:ce.REMOVE,deltaSegments:u}),this.collabWindow.collaborating&&s!==re&&tt.options.zamboniSegments&&this.zamboniSegments()}nodeUpdateLengthNewStructure(e,t=!1){this.blockUpdate(e),this.collabWindow.collaborating&&(e.partialLengths=Qe.combine(this,e,this.collabWindow,t))}removeLocalReferencePosition(e){var t;const r=e.getSegment();if(r){const i=(t=r==null?void 0:r.localRefs)===null||t===void 0?void 0:t.removeLocalRef(e);return i!==void 0&&this.blockUpdatePathLengths(r.parent,cs,Es),i}}createLocalReferencePosition(e,t,r,i,s){var o;if(y7(e)&&!He(r,ee.SlideOnRemove|ee.Transient))throw new ye("Can only create SlideOnRemove or Transient local reference position on a removed segment");const a=(o=e.localRefs)!==null&&o!==void 0?o:new Qr(e);e.localRefs=a;const l=a.createLocalRef(t,r,i,s);return this.blockUpdatePathLengths(e.parent,cs,Es),l}removeLocalReference(e,t){e.localRefs&&e.localRefs.removeLocalRef(t)&&this.blockUpdatePathLengths(e.parent,cs,Es)}addLocalReference(e){const t=e.segment;let r=t.localRefs;r||(r=new Qr(t),t.localRefs=r),r.addLocalRef(e),this.blockUpdatePathLengths(t.parent,cs,Es)}blockUpdate(e){var t;let r=0;const i=e.hierBlock();i&&(i.rightmostTiles=Vt(),i.leftmostTiles=Vt(),i.rangeStacks={});for(let s=0;s<e.childCount;s++){const o=e.children[s];r+=(t=C7(this,o))!==null&&t!==void 0?t:0,i&&i.addNodeReferences(this,o),this.blockUpdateActions&&this.blockUpdateActions.child(e,s)}e.cachedLength=r}blockUpdatePathLengths(e,t,r,i=!1){let s=e;for(;s!==void 0;)i?this.nodeUpdateLengthNewStructure(s):this.blockUpdateLength(s,t,r),s=s.parent}blockUpdateLength(e,t,r){this.blockUpdate(e),this.collabWindow.collaborating&&t!==re&&t!==cs&&(e.partialLengths!==void 0&&tt.options.incrementalUpdate&&r!==Ls?e.partialLengths.update(this,e,t,r,this.collabWindow):e.partialLengths=Qe.combine(this,e,this.collabWindow))}map(e,t,r,i){this.nodeMap(this.root,e,0,t,r,i)}mapRange(e,t,r,i,s,o,a=!1){a&&(s&&this.ensureIntervalBoundary(s,t,r),o&&this.ensureIntervalBoundary(o,t,r)),this.nodeMap(this.root,e,0,t,r,i,s,o)}incrementalBlockMap(e){for(var t;!e.empty();){const r=e.top();if(r.op!==ea.Go)return;if(r.childIndex===0&&(r.start===void 0&&(r.start=0),r.end===void 0&&(r.end=this.blockLength(r.block,r.refSeq,r.clientId)),r.actions.pre&&r.actions.pre(r)),r.op===ea.Go&&r.childIndex<r.block.childCount){const i=r.block.children[r.childIndex],s=(t=this.nodeLength(i,r.refSeq,r.clientId))!==null&&t!==void 0?t:0;if(s>0&&r.start<s&&r.end>0)if(i.isLeaf())r.actions.leaf(i,r);else{const o=new E7(i,r.actions,r.pos,r.refSeq,r.clientId,r.context,r.start,r.end,0);e.push(o)}r.pos+=s,r.start-=s,r.end-=s,r.childIndex++}else r.childIndex===r.block.childCount&&(r.op===ea.Go&&r.actions.post&&r.actions.post(r),e.pop())}}nodeMap(e,t,r,i,s,o,a,l){var c;let u=a,d=l,h=r;u===void 0&&(u=0),d===void 0&&(d=this.blockLength(e,i,s));let f=!0;if(t.pre&&(f=t.pre(e,h,i,s,u,d,o),!f))return!0;const p=e.children;for(let g=0;g<e.childCount;g++){const S=p[g],m=(c=this.nodeLength(S,i,s))!==null&&c!==void 0?c:0;if(f&&d>0&&m>0&&u<m&&(S.isLeaf()?t.leaf&&(f=t.leaf(S,h,i,s,u,d,o)):f&&(f=this.nodeMap(S,t,h,i,s,o,u,d))),!f)break;t.shift&&t.shift(S,h,i,s,u,d,o),h+=m,u-=m,d-=m}return f&&t.post&&(f=t.post(e,h,i,s,u,d,o)),f}walkAllSegments(e,t,r){let i=!0;const s=e.children;for(let o=0;i&&o<e.childCount;o++){const a=s[o];i=a.isLeaf()?t(a,r):this.walkAllSegments(a,t,r)}return i}nodeMapReverse(e,t,r,i,s){let o=!0;const a=e.children;for(let l=e.childCount-1;l>=0;l--){const c=a[l];if(o&&(c.isLeaf()?o=t(c,r,i,s,0,0,void 0):o&&(o=this.nodeMapReverse(c,t,r,i,s))),!o)break}return o}}tt.zamboniSegmentsMaxCount=2;tt.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0};tt.theUnfinishedNode={childCount:-1};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function L7(n,e,t){const r=n.getId();if(r)return{combiningOp:t,props:e,relativePos1:{id:r,before:!0},relativePos2:{id:r},type:ce.ANNOTATE}}function bv(n,e,t,r){return{combiningOp:r,pos1:n,pos2:e,props:t,type:ce.ANNOTATE}}function wv(n,e){return{pos1:n,pos2:e,type:ce.REMOVE}}function cm(n,e){return mk(n,e.toJSONObject())}function mk(n,e){return{pos1:n,seg:e,type:ce.INSERT}}function Zd(...n){return{ops:n,type:ce.GROUP}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function I7(n){return!!n&&typeof n=="object"&&"json"in n}function RE(n,e,t,r,i,s){let o;switch(e.version!==void 0&&t.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:e.version,toChunkVersion:void 0}),e.version){case void 0:o=e,o.headerMetadata=vk(n,o);break;case"1":const a=e,l=n===Je.header?a.headerMetadata:void 0;o={version:void 0,chunkStartSegmentIndex:a.startIndex,chunkLengthChars:a.length,chunkSegmentCount:a.segmentCount,segmentTexts:a.segments,totalLengthChars:l==null?void 0:l.totalLength,totalSegmentCount:l==null?void 0:l.totalSegmentCount,chunkSequenceNumber:l==null?void 0:l.sequenceNumber,chunkMinSequenceNumber:l==null?void 0:l.minSequenceNumber,headerMetadata:l};break;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}return i.stringify(o,s)}function kE(n,e,t,r,i,s){const o=gk(n,e);return i.stringify(o,s)}function gk(n,e,t,r){switch(e.version){case void 0:{const i=e;return{version:"1",length:i.chunkLengthChars,segmentCount:i.chunkSegmentCount,headerMetadata:vk(n,i),segments:i.segmentTexts,startIndex:i.chunkStartSegmentIndex}}case"1":return e;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}}function vk(n,e,t){if(n===Je.header){if(e.headerMetadata!==void 0)return e.headerMetadata;const r=[{id:Je.header}];return e.chunkLengthChars<e.totalLengthChars&&r.push({id:Je.body}),{orderedChunkMetadata:r,minSequenceNumber:e.chunkMinSequenceNumber,sequenceNumber:e.chunkSequenceNumber,totalLength:e.totalLengthChars,totalSegmentCount:e.totalSegmentCount}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Je{constructor(e,t,r,i){var s,o;this.mergeTree=e,this.filename=r,this.onCompletion=i,this.logger=ue.create(t,"Snapshot"),this.chunkSize=(o=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.mergeTreeSnapshotChunkSize)!==null&&o!==void 0?o:Je.sizeOfFirstChunk}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,a=0;for(;o<r&&i+a<e.length;){const l=e[i+a];s.push(l),o+=t[i+a],a++}return{version:void 0,chunkStartSegmentIndex:i,chunkSegmentCount:a,chunkLengthChars:o,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:e.length,chunkSequenceNumber:this.header.seq,segmentTexts:s}}emit(e,t,r){var i,s;const o=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize);let a=o.chunkLengthChars,l=o.chunkSegmentCount;const c=new Kt;if(c.addBlob(Je.header,RE(Je.header,o,this.logger,this.mergeTree.options,t,r)),o.chunkSegmentCount<o.totalSegmentCount){const u=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.header.segmentsTotalLength,o.chunkSegmentCount);a+=u.chunkLengthChars,l+=u.chunkSegmentCount,c.addBlob(Je.body,RE(Je.body,u,this.logger,this.mergeTree.options,t,r))}return Q(a===this.header.segmentsTotalLength,93),Q(l===o.totalSegmentCount,94),e!==void 0&&e.length>0&&c.addBlob((s=(i=this.mergeTree.options)===null||i===void 0?void 0:i.catchUpBlobName)!==null&&s!==void 0?s:Je.catchupOps,t?t.stringify(e,r):JSON.stringify(e)),c.getSummaryTree()}extractSync(){const e=this.mergeTree.getCollabWindow();this.seq=e.minSeq,this.header={segmentsTotalLength:this.mergeTree.getLength(this.mergeTree.collabWindow.minSeq,Ls),seq:this.mergeTree.collabWindow.minSeq};const t=[];let r;const i=(o,a,l,c,u,d)=>(o.seq!==re&&o.seq<=this.seq&&(o.removedSeq===void 0||o.removedSeq===re||o.removedSeq>this.seq)&&(r!=null&&r.canAppend(o)&&qc(r.properties,o.properties)?(r=r.clone(),r.append(o.clone())):(r&&t.push(r),r=o)),!0);this.mergeTree.map({leaf:i},this.seq,Ls,void 0),r&&t.push(r),this.segments=[],this.segmentLengths=[];let s=0;return t.map(o=>{s+=o.cachedLength,this.segments.push(o.toJSONObject()),this.segmentLengths.push(o.cachedLength)}),this.header.segmentsTotalLength!==s&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:s,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=s),this.segments}}Je.header="header";Je.body="body";Je.catchupOps="catchupOps";Je.sizeOfFirstChunk=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Zs{constructor(e,t,r,i,s){var o,a;this.mergeTree=e,this.getLongClientId=r,this.filename=i,this.onCompletion=s,this.logger=ue.create(t,"Snapshot"),this.chunkSize=(a=(o=e==null?void 0:e.options)===null||o===void 0?void 0:o.mergeTreeSnapshotChunkSize)!==null&&a!==void 0?a:Zs.chunkSize;const{currentSeq:l,minSeq:c}=e.getCollabWindow();this.header={minSequenceNumber:c,sequenceNumber:l,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[]}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,a=0;for(;o<r&&i+a<e.length;){const l=e[i+a];s.push(l),o+=t[i+a],a++}return{version:"1",segmentCount:a,length:o,segments:s,startIndex:i,headerMetadata:void 0}}emit(e,t){const r=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{const a=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize,this.header.totalSegmentCount);r.push(a),this.header.totalSegmentCount+=a.segmentCount,this.header.totalLength+=a.length}while(this.header.totalSegmentCount<this.segments.length);const i=r.shift();i.headerMetadata=this.header,i.headerMetadata.orderedChunkMetadata=[{id:Je.header}];const s=[];r.forEach((a,l)=>{const c=`${Je.body}_${l}`;this.header.orderedChunkMetadata.push({id:c}),s.push([c,kE(c,a,this.logger,this.mergeTree.options,e,t)])});const o=new Kt;return o.addBlob(Je.header,kE(Je.header,i,this.logger,this.mergeTree.options,e,t)),s.forEach(a=>{o.addBlob(a[0],a[1])}),o.getSummaryTree()}extractSync(){const e=this.mergeTree,t=this.header.minSequenceNumber,r=(a,l)=>{this.segments.push(a),this.segmentLengths.push(l)},i=a=>{a&&r(a.toJSONObject(),a.cachedLength)};let s;const o=a=>{var l;if(a.seq===re||a.removedSeq<=t)return!0;if(a.seq<=t&&(a.removedSeq===void 0||a.removedSeq===re))s?s.canAppend(a)&&qc(s.properties,a.properties)?(s=s.clone(),s.append(a.clone())):(i(s),s=a):s=a;else{i(s),s=void 0;const c={json:a.toJSONObject()};a.seq>t&&(c.seq=a.seq,c.client=this.getLongClientId(a.clientId)),a.removedSeq!==void 0&&(Q(a.removedSeq!==re&&a.removedSeq>t,101),c.removedSeq=a.removedSeq,c.removedClient=a.removedClientIds!==void 0?this.getLongClientId(a.removedClientIds[0]):void 0,c.removedClientIds=(l=a.removedClientIds)===null||l===void 0?void 0:l.map(u=>this.getLongClientId(u))),Q(c.seq!==void 0&&c.client!==void 0||c.removedSeq!==void 0&&c.removedClient!==void 0,102),r(c,a.cachedLength)}return!0};return e.walkAllSegments(e.root,o,this),i(s),this.segments}static async loadChunk(e,t,r,i,s){const o=await e.readBlob(t),a=Sv(o,"utf8");return Zs.processChunk(t,a,r,i,s)}static processChunk(e,t,r,i,s){const o=s?s.parse(t):JSON.parse(t);return gk(e,o)}}Zs.chunkSize=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class A7{constructor(e,t,r,i,s){this.runtime=e,this.client=t,this.mergeTree=r,this.serializer=s,this.specToSegment=o=>{var a;let l;return I7(o)?(l=this.client.specToSegment(o.json),l.clientId=o.client!==void 0?this.client.getOrAddShortClientId(o.client):Ls,l.seq=o.seq!==void 0?o.seq:Ut,o.removedSeq!==void 0&&(l.removedSeq=o.removedSeq),o.removedClient!==void 0&&(l.removedClientIds=[this.client.getOrAddShortClientId(o.removedClient)]),o.removedClientIds!==void 0&&(l.removedClientIds=(a=o.removedClientIds)===null||a===void 0?void 0:a.map(c=>this.client.getOrAddShortClientId(c)))):(l=this.client.specToSegment(o),l.seq=Ut,l.clientId=Ls),l},this.logger=ue.create(i,"SnapshotLoader")}async initialize(e){const t=e.readBlob(Je.header).then(i=>(Q(!!i,95),this.loadHeader(Sv(i,"utf8")))),r=this.loadBodyAndCatchupOps(t,e);return r.catch(i=>this.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},i)),await t,{catchupOpsP:r}}async loadBodyAndCatchupOps(e,t){const r=t.list(""),i=await e;await this.loadBody(i,t);const s=await r;if(s.length===i.headerMetadata.orderedChunkMetadata.length+1)return i.headerMetadata.orderedChunkMetadata.forEach(o=>s.splice(s.indexOf(o.id),1)),Q(s.length===1,96),this.loadCatchupOps(t.readBlob(s[0]));if(s.length!==i.headerMetadata.orderedChunkMetadata.length)throw new Error("Unexpected blobs in snapshot");return[]}loadHeader(e){var t;const r=Zs.processChunk(Je.header,e,this.logger,this.mergeTree.options,this.serializer),i=r.segments.map(this.specToSegment);if(this.mergeTree.reloadFromSegments(i),r.headerMetadata===void 0)throw new Error("header metadata not available");return this.runtime.attachState!==Z.Detached&&this.client.startOrUpdateCollaboration((t=this.runtime.clientId)!==null&&t!==void 0?t:"snapshot",r.headerMetadata.minSequenceNumber!==void 0?r.headerMetadata.minSequenceNumber:r.headerMetadata.sequenceNumber,r.headerMetadata.sequenceNumber),r}async loadBody(e,t){if(Q(e.length<=e.headerMetadata.totalLength,97),Q(e.segmentCount<=e.headerMetadata.totalSegmentCount,98),e.segmentCount===e.headerMetadata.totalSegmentCount)return;const r=[];let i=e.length;for(let c=1;c<e.headerMetadata.orderedChunkMetadata.length;c++){const u=await Zs.loadChunk(t,e.headerMetadata.orderedChunkMetadata[c].id,this.logger,this.mergeTree.options,this.serializer);i+=u.length,r.push(...u.segments.map(this.specToSegment))}Q(i===e.headerMetadata.totalLength,99),Q(e.segmentCount+r.length===e.headerMetadata.totalSegmentCount,100);const s=this.mergeTree,o=(c,u,d)=>{s.insertSegments(s.root.cachedLength,c,Ut,u,d,void 0)},a=[],l=()=>{a.length>0&&o(a,Ls,Ut)};for(const c of r){const u=c.clientId,d=c.seq;u===Ls&&d===Ut?a.push(c):(l(),o([c],u,d))}l()}async loadCatchupOps(e){return JSON.parse(Sv(await e,"utf8"))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const NE=256;class pt extends tf{constructor(e){super(),this.text=e,this.type=pt.type,this.cachedLength=e.length}static is(e){return e.type===pt.type}static make(e,t){const r=new pt(e);return t&&r.addProperties(t),r}static fromJSONObject(e){if(typeof e=="string")return new pt(e);if(e&&typeof e=="object"&&"text"in e){const t=e;return pt.make(t.text,t.props)}}toJSONObject(){return this.properties?{text:this.text,props:this.properties}:this.text}clone(e=0,t){const r=this.text.substring(e,t),i=pt.make(r,this.properties);return this.cloneInto(i),i}canAppend(e){return!this.text.endsWith(`
`)&&pt.is(e)&&(this.cachedLength<=NE||e.cachedLength<=NE)}toString(){return this.text}append(e){if(pt.is(e))Qr.append(this,e),this.text+=e.text,this.cachedLength=this.text.length;else throw new Error("can only append text segment")}removeRange(e,t){let r="";const i=this.text.length;return e>0&&(r+=this.text.substring(0,e)),t<i&&(r+=this.text.substring(t)),this.text=r,this.cachedLength=r.length,r.length===0}createSplitSegmentAt(e){if(e>0){const t=this.text.substring(e);return this.text=this.text.substring(0,e),this.cachedLength=this.text.length,new pt(t)}}}pt.type="TextSegment";function LE(n){return n.parallelArrays===!0}class M7{constructor(e){this.mergeTree=e,this.gatherText=(t,r,i,s,o,a,l)=>{var c,u;let d=o;if(pt.is(t)){let h="",f="";if(LE(l)){const p=[],g=[];!((c=t.properties)===null||c===void 0)&&c["font-weight"]&&p.push("b"),!((u=t.properties)===null||u===void 0)&&u["text-decoration"]&&p.push("u");const S=[];if(p.length>0){for(const m of p)l.tagsInProgress.includes(m)||(h+=`<${m}>`,g.push(m));for(const m of l.tagsInProgress)p.includes(m)||(f+=`</${m}>`,S.push(m));for(const m of g.reverse())l.tagsInProgress.push(m)}else for(const m of l.tagsInProgress)f+=`</${m}>`,S.push(m);for(const m of S){const v=l.tagsInProgress.indexOf(m);v>=0&&l.tagsInProgress.splice(v,1)}}l.textSegment.text+=f,l.textSegment.text+=h,d<=0&&a>=t.text.length?l.textSegment.text+=t.text:(d<0&&(d=0),a>=t.text.length?l.textSegment.text+=t.text.substring(d):l.textSegment.text+=t.text.substring(d,a))}else if(l.placeholder&&l.placeholder.length>0)if(l.placeholder==="*"){const h=t;l.textSegment.text+=`
${h.toString()}`}else for(let h=0;h<t.cachedLength;h++)l.textSegment.text+=l.placeholder;else if(LE(l)){const h=t;h.hasTileLabel(l.parallelMarkerLabel)&&(l.parallelMarkers.push(h),l.parallelText.push(l.textSegment.text),l.textSegment.text="")}return!0}}getTextAndMarkers(e,t,r,i,s){const o=this.getValidRange(i,s,e,t),a={parallelArrays:!0,parallelMarkerLabel:r,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new pt("")};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),{parallelText:a.parallelText,parallelMarkers:a.parallelMarkers}}getText(e,t,r="",i,s){const o=this.getValidRange(i,s,e,t),a={textSegment:new pt(""),placeholder:r};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),a.textSegment.text}getValidRange(e,t,r,i){return{end:t??this.mergeTree.getLength(r,i),start:e??0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Eu(n){return n.trace().duration*1e3}class hS{constructor(e,t,r){this.specToSegment=e,this.logger=t,this.measureOps=!1,this.accumTime=0,this.localTime=0,this.localOps=0,this.accumWindowTime=0,this.accumWindow=0,this.accumOps=0,this.maxWindowTime=0,this.clientNameToIds=new mc(x7),this.shortClientIdMap=[],this.pendingConsensus=new Map,this.mergeTree=new tt(r)}get mergeTreeDeltaCallback(){return this.mergeTree.mergeTreeDeltaCallback}set mergeTreeDeltaCallback(e){this.mergeTree.mergeTreeDeltaCallback=e}get mergeTreeMaintenanceCallback(){return this.mergeTree.mergeTreeMaintenanceCallback}set mergeTreeMaintenanceCallback(e){this.mergeTree.mergeTreeMaintenanceCallback=e}peekPendingSegmentGroups(e=1){var t,r;if(e===1)return(t=this.mergeTree.pendingSegments)===null||t===void 0?void 0:t.last();let i=0;return(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.some(()=>i<e?(i++,!0):!1,!0)}annotateMarkerNotifyConsensus(e,t,r){const i={name:"consensus"},s=this.annotateMarker(e,t,i);if(s){const o={callback:r,marker:e};return this.pendingConsensus.set(e.getId(),o),s}else return}annotateMarker(e,t,r){const i=L7(e,t,r);if(this.applyAnnotateRangeOp({op:i}))return i}annotateRangeLocal(e,t,r,i){const s=bv(e,t,r,i);if(this.applyAnnotateRangeOp({op:s}))return s}removeRangeLocal(e,t){const r=wv(e,t);if(this.applyRemoveRangeOp({op:r}))return r}insertSegmentLocal(e,t){if(t.cachedLength<=0)return;const r=cm(e,t);if(this.applyInsertOp({op:r}))return r}insertAtReferencePositionLocal(e,t){const r=this.mergeTree.referencePositionToLocalPosition(e,this.getCurrentSeq(),this.getClientId());if(r===ao.DetachedPosition)return;const i=cm(r,t),s={op:i};let o;return this.measureOps&&(o=yo.start()),this.mergeTree.insertAtReferencePosition(e,t,s),this.completeAndLogOp(s,this.getClientSequenceArgs(s),{start:i.pos1},o),i}walkSegments(e,t,r,i,s=!1){this.mergeTree.mapRange({leaf:e},this.getCurrentSeq(),this.getClientId(),i,t,r,s)}serializeGCData(e,t){this.mergeTree.walkAllSegments(this.mergeTree.root,r=>(r.removedSeq===void 0&&t.stringify(r.clone().toJSONObject(),e),!0))}getCollabWindow(){return this.mergeTree.getCollabWindow()}getPosition(e){return(e==null?void 0:e.parent)===void 0?-1:this.mergeTree.getPosition(e,this.getCurrentSeq(),this.getClientId())}addLocalReference(e){return this.mergeTree.addLocalReference(e)}removeLocalReference(e){return this.removeLocalReferencePosition(e)}createLocalReferencePosition(e,t,r,i){return this.mergeTree.createLocalReferencePosition(e,t,r,i,this)}removeLocalReferencePosition(e){return this.mergeTree.removeLocalReferencePosition(e)}localReferencePositionToPosition(e){return this.mergeTree.referencePositionToLocalPosition(e)}posFromRelativePos(e){return this.mergeTree.posFromRelativePos(e)}getMarkerFromId(e){return this.mergeTree.getMarkerFromId(e)}applyRemoveRangeOp(e){Q(e.op.type===ce.REMOVE,45);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=yo.start()),this.mergeTree.markRangeRemoved(i.start,i.end,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,!1,e),this.completeAndLogOp(e,r,i,s),!0}applyAnnotateRangeOp(e){Q(e.op.type===ce.ANNOTATE,46);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=yo.start()),this.mergeTree.annotateRange(i.start,i.end,t.props,t.combiningOp,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,s),!0}applyInsertOp(e){Q(e.op.type===ce.INSERT,47);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;if(t.seg&&(s=[this.specToSegment(t.seg)]),!s||s.length===0)return!1;let o;return this.measureOps&&(o=yo.start()),this.mergeTree.insertSegments(i.start,s,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,o),!0}completeAndLogOp(e,t,r,i){e.sequencedMessage?(Q(this.mergeTree.getCollabWindow().currentSeq<t.sequenceNumber,48),Q(this.mergeTree.getCollabWindow().minSeq<=e.sequencedMessage.minimumSequenceNumber,49),i&&(this.accumTime+=Eu(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)):i&&(this.localTime+=Eu(i),this.localOps++)}getValidOpRange(e,t){let r=e.pos1;r===void 0&&e.relativePos1&&(r=this.mergeTree.posFromRelativePos(e.relativePos1,t.referenceSequenceNumber,t.clientId));let i=e.pos2;if(i===void 0&&e.relativePos2&&(i=this.mergeTree.posFromRelativePos(e.relativePos2,t.referenceSequenceNumber,t.clientId)),t.clientId===this.getClientId()){const s=this.getLength(),o=[];if((r===void 0||r<0||r>s||r===s&&e.type!==ce.INSERT)&&o.push("start"),(e.type!==ce.INSERT||i!==void 0)&&(i===void 0||i<=r)&&o.push("end"),o.length>0)throw new oe("RangeOutOfBounds",{usageError:!0,end:i,invalidPositions:o.toString(),length:s,opPos1:e.pos1,opPos1Relative:e.relativePos1!==void 0,opPos2:e.pos2,opPos2Relative:e.relativePos2!==void 0,opType:e.type,start:r})}return{start:r,end:i}}getClientSequenceArgsForMessage(e){if(e)return{clientId:this.getOrAddShortClientId(e.clientId),referenceSequenceNumber:e.referenceSequenceNumber,sequenceNumber:e.sequenceNumber};{const t=this.getCollabWindow();return{clientId:t.clientId,referenceSequenceNumber:t.currentSeq,sequenceNumber:this.getLocalSequenceNumber()}}}getClientSequenceArgs(e){return this.getClientSequenceArgsForMessage(e.sequencedMessage)}ackPendingSegment(e){const t=r=>{let i;this.measureOps&&(i=yo.start()),this.mergeTree.ackPendingSegment(r),r.op.type===ce.ANNOTATE&&r.op.combiningOp&&r.op.combiningOp.name==="consensus"&&this.updateConsensusProperty(r.op,r.sequencedMessage),i&&(this.accumTime+=Eu(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)};if(e.op.type===ce.GROUP)for(const r of e.op.ops)t({groupOp:e.op,op:r,sequencedMessage:e.sequencedMessage});else t(e)}cloneFromSegments(){const e=new hS(this.specToSegment,this.logger,this.mergeTree.options),t=[],r=this.mergeTree.blockClone(this.mergeTree.root,t);return e.mergeTree.root=r,e}getOrAddShortClientId(e){return this.clientNameToIds.get(e)||this.addLongClientId(e),this.getShortClientId(e)}getShortClientId(e){return this.clientNameToIds.get(e).data}getLongClientId(e){return e>=0?this.shortClientIdMap[e]:"original"}addLongClientId(e){this.clientNameToIds.put(e,this.shortClientIdMap.length),this.shortClientIdMap.push(e)}findReconnectionPosition(e,t){Q(t<=this.mergeTree.collabWindow.localSeq,50);let r=0;return this.mergeTree.walkAllSegments(this.mergeTree.root,i=>i===e?!1:((i.localSeq===void 0||i.localSeq<=t)&&(i.removedSeq===void 0||i.localRemovedSeq>t)&&(r+=i.cachedLength),!0)),r}rebasePosition(e,t,r){Q(r<=this.mergeTree.collabWindow.localSeq,768);let i,s=0,o=e;const a=u=>u.seq!==void 0&&u.seq!==re&&u.seq<=t||u.localSeq!==void 0&&u.localSeq<=r,l=({removedSeq:u,localRemovedSeq:d})=>u!==void 0&&u!==re&&u<=t||d!==void 0&&d<=r;this.mergeTree.walkAllSegments(this.mergeTree.root,u=>(Q(u.seq!==void 0||u.localSeq!==void 0,769),i=u,a(u)&&!l(u)&&(s+=u.cachedLength,o>=u.cachedLength&&(o-=u.cachedLength)),s<=e)),Q(i!==void 0,770);const c=this.getCollabWindow().currentSeq;return(i.removedSeq!==void 0&&i.removedSeq!==re&&i.removedSeq<=c||i.localRemovedSeq!==void 0&&i.localRemovedSeq<=r)&&(o=0),Q(0<=o&&o<i.cachedLength,771),this.findReconnectionPosition(i,r)+o}resetPendingDeltaToOps(e,t){var r,i;Q(!!t,51);const s=(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.dequeue();Q(t===s,52);const o=[];for(const a of t.segments.sort((l,c)=>l.ordinal<c.ordinal?-1:1)){const l=a.segmentGroups.dequeue();Q(t===l,53);const c=this.findReconnectionPosition(a,t.localSeq);let u;switch(e.type){case ce.ANNOTATE:Q(((i=a.propertyManager)===null||i===void 0?void 0:i.hasPendingProperties())===!0,54),(a.removedSeq===void 0||a.localRemovedSeq!==void 0)&&(u=bv(c,c+a.cachedLength,e.props,e.combiningOp));break;case ce.INSERT:Q(a.seq===re,55);let d=a;typeof e.seg=="object"&&e.seg.props!==void 0&&(d=a.clone(),d.properties=e.seg.props),u=cm(c,d);break;case ce.REMOVE:a.localRemovedSeq!==void 0&&(u=wv(c,c+a.cachedLength));break;default:throw new Error("Invalid op type")}if(u){const d={segments:[],localSeq:t.localSeq};a.segmentGroups.enqueue(d),this.mergeTree.pendingSegments.enqueue(d),o.push(u)}}return o}applyRemoteOp(e){const t=e.op,r=e.sequencedMessage;switch(this.getOrAddShortClientId(r.clientId),t.type){case ce.INSERT:this.applyInsertOp(e);break;case ce.REMOVE:this.applyRemoveRangeOp(e);break;case ce.ANNOTATE:this.applyAnnotateRangeOp(e);break;case ce.GROUP:{for(const i of t.ops)this.applyRemoteOp({op:i,groupOp:t,sequencedMessage:r});break}}}applyStashedOp(e){let t;switch(e.type){case ce.INSERT:this.applyInsertOp({op:e}),t=this.peekPendingSegmentGroups();break;case ce.REMOVE:this.applyRemoveRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case ce.ANNOTATE:this.applyAnnotateRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case ce.GROUP:return e.ops.map(r=>this.applyStashedOp(r));default:o7(e,"unrecognized op type")}return Q(!!t,731),t}applyMsg(e,t=!1){var r;if(this.getOrAddShortClientId(e.clientId),e.type===yv.Operation){const i={op:e.contents,sequencedMessage:e};((r=i.sequencedMessage)===null||r===void 0?void 0:r.clientId)===this.longClientId||t?this.ackPendingSegment(i):this.applyRemoteOp(i)}this.updateSeqNumbers(e.minimumSequenceNumber,e.sequenceNumber)}updateSeqNumbers(e,t){const r=this.mergeTree.getCollabWindow();Q(r.currentSeq<=t,56),r.currentSeq=t,Q(e<=t,57),this.updateMinSeq(e)}resolveRemoteClientPosition(e,t,r){const i=this.getOrAddShortClientId(r);return this.mergeTree.resolveRemoteClientPosition(e,t,i)}regeneratePendingOp(e,t){const r=[];if(e.type===ce.GROUP)if(Array.isArray(t)){Q(e.ops.length===t.length,58);for(let i=0;i<e.ops.length;i++)r.push(...this.resetPendingDeltaToOps(e.ops[i],t[i]))}else Q(e.ops.length===1,59),r.push(...this.resetPendingDeltaToOps(e.ops[0],t));else Q(e.type!==ce.GROUP,60),Q(!Array.isArray(t),61),r.push(...this.resetPendingDeltaToOps(e,t));return r.length===1?r[0]:Zd(...r)}createTextHelper(){return new M7(this.mergeTree)}summarize(e,t,r,i){var s;const o=e.deltaManager,a=o.minimumSequenceNumber;if(this.updateSeqNumbers(a,o.lastSequenceNumber),Q(this.getCollabWindow().minSeq===a,62),((s=this.mergeTree.options)===null||s===void 0?void 0:s.newMergeTreeSnapshotFormat)===!0){Q(i===void 0||i.length===0,63);const l=new Zs(this.mergeTree,this.logger,c=>this.getLongClientId(c));return l.extractSync(),l.emit(r,t)}else{const l=new Je(this.mergeTree,this.logger);return l.extractSync(),l.emit(i,r,t)}}async load(e,t,r){return new A7(e,this,this.mergeTree,this.logger,r).initialize(t)}getStackContext(e,t){return this.mergeTree.getStackContext(e,this.getCollabWindow().clientId,t)}getLocalSequenceNumber(){return this.getCollabWindow().collaborating?re:Ut}localTransaction(e){for(const t of e.ops){const r={op:t,groupOp:e};switch(t.type){case ce.INSERT:this.applyInsertOp(r);break;case ce.ANNOTATE:this.applyAnnotateRangeOp(r);break;case ce.REMOVE:this.applyRemoveRangeOp(r);break}}}updateConsensusProperty(e,t){const r=e.relativePos1.id,i=this.pendingConsensus.get(r);i&&i.marker.addProperties(e.props,e.combiningOp,t.sequenceNumber),this.mergeTree.addMinSeqListener(t.sequenceNumber,()=>i.callback(i.marker))}updateMinSeq(e){let t;if(this.measureOps&&(t=yo.start()),this.mergeTree.setMinSeq(e),t){const r=Eu(t);this.accumWindowTime+=r,r>this.maxWindowTime&&(this.maxWindowTime=r)}}getContainingSegment(e,t){const r=this.getClientSequenceArgsForMessage(t);return this.mergeTree.getContainingSegment(e,r.referenceSequenceNumber,r.clientId)}getSlideToSegment(e){return this.mergeTree._getSlideToSegment(e)}getPropertiesAtPosition(e){let t;const i=this.getContainingSegment(e).segment;return i&&(t=i.properties),t}getRangeExtentsOfPosition(e){let t,r;const s=this.getContainingSegment(e).segment;return s&&(t=this.getPosition(s),r=t+s.cachedLength),{posStart:t,posAfterEnd:r}}getCurrentSeq(){return this.getCollabWindow().currentSeq}getClientId(){return this.getCollabWindow().clientId}getLength(){return this.mergeTree.length}startOrUpdateCollaboration(e,t=0,r=0){if(e!==void 0)if(this.longClientId===void 0)this.longClientId=e,this.addLongClientId(this.longClientId),this.mergeTree.startCollaboration(this.getShortClientId(this.longClientId),t,r);else{const i=this.longClientId,s=this.clientNameToIds.get(i).data;this.longClientId=e,this.clientNameToIds.put(e,s),this.shortClientIdMap[s]=e}}findTile(e,t,r=!0){const i=this.getClientId();return this.mergeTree.findTile(e,i,t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var D7=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const At="intervalId";var Yn;(function(n){n[n.Simple=0]="Simple",n[n.Nest=1]="Nest",n[n.SlideOnRemove=2]="SlideOnRemove",n[n.Transient=4]="Transient"})(Yn||(Yn={}));function F7(n,e){return{start:n[0],end:n[1],sequenceNumber:n[2],intervalType:n[3],properties:Object.assign(Object.assign({},n[4]),{[Bc]:e})}}function z7(n){const{start:e,end:t,sequenceNumber:r,intervalType:i,properties:s}=n;return[e,t,r,i,Object.assign(Object.assign({},s),{[Bc]:void 0})]}class ta{constructor(e,t,r){this.start=e,this.end=t,this.propertyManager=new ya,this.properties={},r&&this.addProperties(r)}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[At];if(t!==void 0)return`${t}`}getAdditionalPropertySets(){return this.auxProps}addPropertySet(e){this.auxProps===void 0&&(this.auxProps=[]),this.auxProps.push(e)}serialize(e){let t=0;e&&(t=e.getCurrentSeq());const r={end:this.end,intervalType:0,sequenceNumber:t,start:this.start};return this.properties&&(r.properties=this.properties),r}clone(){return new ta(this.start,this.end,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start-e.start}compareEnd(e){return this.end-e.end}overlaps(e){return this.start<=e.end&&this.end>=e.start}union(e){return new ta(Math.min(this.start,e.start),Math.max(this.end,e.end),this.properties)}getProperties(){return this.properties}addProperties(e,t=!1,r,i){if(e)return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}modify(e,t,r,i){const s=t??this.start,o=r??this.end;if(this.start===s&&this.end===o)return;const a=new ta(s,o);return this.properties&&(a.initializeProperties(),this.propertyManager.copyTo(this.properties,a.properties,a.propertyManager)),a}initializeProperties(){this.propertyManager||(this.propertyManager=new ya),this.properties||(this.properties=Vt())}}class Xr{constructor(e,t,r,i){this.start=e,this.end=t,this.intervalType=r,this.propertyManager=new ya,this.properties={},i&&this.addProperties(i)}addPositionChangeListeners(e,t){var r,i,s,o;if(this.callbacks===void 0){this.callbacks={beforePositionChange:e,afterPositionChange:t};const a=(r=(s=this.start).callbacks)!==null&&r!==void 0?r:s.callbacks={},l=(i=(o=this.end).callbacks)!==null&&i!==void 0?i:o.callbacks={};a.beforeSlide=l.beforeSlide=e,a.afterSlide=l.afterSlide=t}}removePositionChangeListeners(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}serialize(e){const t=this.start.toPosition(),i={end:this.end.toPosition(),intervalType:this.intervalType,sequenceNumber:e.getCurrentSeq(),start:t};return this.properties&&(i.properties=this.properties),i}clone(){return new Xr(this.start,this.end,this.intervalType,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start.compare(e.start)}compareEnd(e){return this.end.compare(e.end)}overlaps(e){return this.start.compare(e.end)<=0&&this.end.compare(e.start)>=0}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[At];if(t!==void 0)return`${t}`}union(e){return new Xr(this.start.min(e.start),this.end.max(e.end),this.intervalType)}addProperties(e,t=!1,r,i){return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}overlapsPos(e,t){const r=this.start.toPosition();return this.start.toPosition()>e&&r<t}modify(e,t,r,i){const s=c=>{let u=c;return i===void 0&&(u&=~ee.SlideOnRemove,u|=ee.StayOnRemove),u};let o=this.start;t!==void 0&&(o=eh(this.start.getClient(),t,s(this.start.refType),i),o.addProperties(this.start.properties));let a=this.end;r!==void 0&&(a=eh(this.end.getClient(),r,s(this.end.refType),i),a.addProperties(this.end.properties)),o.pairedRef=a,a.pairedRef=o;const l=new Xr(o,a,this.intervalType);return this.properties&&(l.initializeProperties(),this.propertyManager.copyTo(this.properties,l.properties,l.propertyManager)),l}initializeProperties(){this.propertyManager||(this.propertyManager=new ya),this.properties||(this.properties=Vt())}}function Cv(n,e,t,r){if(e.segment)return n.createLocalReferencePosition(e.segment,e.offset,t,void 0);if(!r&&!He(t,ee.Transient))throw new ye("Non-transient references need segment");return new ao(n,void 0,0,t)}function eh(n,e,t,r){let i;return r?(Sn((t&ee.SlideOnRemove)!==0,757),i=n.getContainingSegment(e,r),i=n.getSlideToSegment(i)):(Sn((t&ee.SlideOnRemove)===0,758),i=n.getContainingSegment(e)),Cv(n,i,t,r)}function $7(n,e,t,r,i,s){let o=ee.RangeBegin,a=ee.RangeEnd;i===Yn.Transient?(o=ee.Transient,a=ee.Transient):(i===Yn.Nest&&(o=ee.NestBegin,a=ee.NestEnd),s?(o|=ee.SlideOnRemove,a|=ee.SlideOnRemove):(o|=ee.StayOnRemove,a|=ee.StayOnRemove));const l=eh(r,e,o,s),c=eh(r,t,a,s);l.pairedRef=c,c.pairedRef=l;const u={[Bc]:[n]};return l.addProperties(u),c.addProperties(u),new Xr(l,c,i,u)}class nf{constructor(e,t,r,i){this.client=e,this.label=t,this.helpers=r,this.onPositionChange=i,this.intervalTree=new l7,this.intervalIdMap=new Map,this.endIntervalTree=new mc(r.compareEnds)}addConflictResolver(e){this.conflictResolver=e,this.endConflictResolver=(t,r)=>{const i=e(t,r);return{data:i,key:i}}}map(e){this.intervalTree.map(e)}createLegacyId(e,t){return`${nf.legacyIdPrefix}${e}-${t}`}ensureSerializedId(e){var t;let r=(t=e.properties)===null||t===void 0?void 0:t[At];if(r===void 0){r=this.createLegacyId(e.start,e.end);const i={[At]:r};e.properties=dk(e.properties,i)}return Object.defineProperty(e.properties,At,{configurable:!1,enumerable:!0,writable:!1}),r}mapUntil(e){this.intervalTree.mapUntil(e)}gatherIterationResults(e,t,r,i){if(!this.intervalTree.intervals.isEmpty())if(r===void 0&&i===void 0)t?this.intervalTree.map(s=>{e.push(s)}):this.intervalTree.mapBackward(s=>{e.push(s)});else{const s=this.helpers.create("transient",r,i,this.client,Yn.Transient);if(r===void 0)t?this.intervalTree.map(o=>{s.compareEnd(o)===0&&e.push(o)}):this.intervalTree.mapBackward(o=>{s.compareEnd(o)===0&&e.push(o)});else{const o=i===void 0?u=>s.compareStart(u.key):u=>s.compare(u.key),a=u=>u<=0,l=u=>u>=0,c=u=>{e.push(u.key)};t?this.intervalTree.intervals.walkExactMatchesForward(o,c,a,l):this.intervalTree.intervals.walkExactMatchesBackward(o,c,a,l)}}}findOverlappingIntervals(e,t){if(t<e||this.intervalTree.intervals.isEmpty())return[];const r=this.helpers.create("transient",e,t,this.client,Yn.Transient);return this.intervalTree.match(r).map(s=>s.key)}previousInterval(e){const t=this.helpers.create("transient",e,e,this.client,Yn.Transient),r=this.endIntervalTree.floor(t);if(r)return r.data}nextInterval(e){const t=this.helpers.create("transient",e,e,this.client,Yn.Transient),r=this.endIntervalTree.ceil(t);if(r)return r.data}removeInterval(e,t){const r=this.helpers.create("transient",e,t,this.client,Yn.Transient);return this.intervalTree.remove(r),this.endIntervalTree.remove(r),r}removeIntervalFromIndex(e){this.intervalTree.removeExisting(e),this.endIntervalTree.remove(e);const t=e.getIntervalId();Sn(t!==void 0,785),this.intervalIdMap.delete(t)}removeExistingInterval(e){this.removeIntervalFromIndex(e),this.removeIntervalListeners(e)}createInterval(e,t,r,i){return this.helpers.create(this.label,e,t,this.client,r,i)}addInterval(e,t,r,i,s){const o=this.createInterval(e,t,r,s);return o&&(o.properties||(o.properties=Vt()),i&&o.addProperties(i),o.properties[At]===void 0&&(o.properties[At]=Ze()),this.add(o)),o}addIntervalToIndex(e){const t=e.getIntervalId();Sn(t!==void 0,704),Object.defineProperty(e.properties,At,{configurable:!1,enumerable:!0,writable:!1}),this.intervalTree.put(e,this.conflictResolver),this.endIntervalTree.put(e,e,this.endConflictResolver),this.intervalIdMap.set(t,e)}add(e){this.addIntervalToIndex(e),this.addIntervalListeners(e)}getIntervalById(e){return this.intervalIdMap.get(e)}changeInterval(e,t,r,i){const s=e.modify(this.label,t,r,i);return s&&(this.removeExistingInterval(e),this.add(s)),s}serialize(){const e=this.client,t=this.intervalTree.intervals.keys();return{label:this.label,intervals:t.map(r=>z7(r.serialize(e))),version:2}}addIntervalListeners(e){e instanceof Xr&&e.addPositionChangeListeners(()=>this.removeIntervalFromIndex(e),()=>{var t;this.addIntervalToIndex(e),(t=this.onPositionChange)===null||t===void 0||t.call(this,e)})}removeIntervalListeners(e){e instanceof Xr&&e.removePositionChangeListeners()}}nf.legacyIdPrefix="legacy";const j7=(n,e)=>n.end.compare(e.end);class q7{load(e,t=[]){const r={compareEnds:j7,create:$7};return new fS(r,!0,e,t)}store(e){return e.serializeInternal()}}class Gi{get name(){return Gi.Name}get factory(){return Gi._factory}get ops(){return Gi._ops}}Gi.Name="sharedStringIntervalCollection";Gi._factory=new q7;Gi._ops=yk();const B7=(n,e)=>n.end-e.end;function U7(n,e,t,r){const i={};return n&&n.length>0&&(i[Bc]=[n]),new ta(e,t,i)}class H7{load(e,t=[]){const r={compareEnds:B7,create:U7},i=new fS(r,!1,e,t);return i.attachGraph(void 0,""),i}store(e){return e.serializeInternal()}}class Ki{get name(){return Ki.Name}get factory(){return Ki._factory}get ops(){return Ki._ops}}Ki.Name="sharedIntervalCollection";Ki._factory=new H7;Ki._ops=yk();function yk(){const n=(e,t,r)=>{const{localSeq:i}=r,s=e.rebaseLocalInterval(t.opName,t.value,i);return{rebasedOp:Object.assign(Object.assign({},t),{value:s}),rebasedLocalOpMetadata:r}};return new Map([["add",{process:(e,t,r,i)=>{e.ackAdd(t,r,i)},rebase:n}],["delete",{process:(e,t,r,i)=>{e.ackDelete(t,r,i)},rebase:(e,t,r)=>({rebasedOp:t,rebasedLocalOpMetadata:r})}],["change",{process:(e,t,r,i)=>{e.ackChange(t,r,i)},rebase:n}]])}class Eo{constructor(e,t=!0,r,i){this.results=[],this.index=0,e.gatherIterationResults(this.results,t,r,i)}next(){let e,t=!0;return this.index<this.results.length&&(e=this.results[this.index++],t=!1),{value:e,done:t}}}class fS extends sk{constructor(e,t,r,i){super(),this.helpers=e,this.requiresClient=t,this.emitter=r,this.pendingChangesStart=new Map,this.pendingChangesEnd=new Map,Array.isArray(i)?this.savedSerializedIntervals=i:this.savedSerializedIntervals=i.intervals.map(s=>F7(s,i.label))}get attached(){return!!this.localCollection}attachGraph(e,t){if(this.attached)throw new oe("Only supports one Sequence attach");if(e===void 0&&this.requiresClient)throw new oe("Client required for this collection");if(this.client=e,this.localCollection=new nf(e,t,this.helpers,r=>this.emit("changeInterval",r,!0,void 0)),this.savedSerializedIntervals)for(const r of this.savedSerializedIntervals)this.localCollection.ensureSerializedId(r),this.localCollection.addInterval(r.start,r.end,r.intervalType,r.properties);this.savedSerializedIntervals=void 0}getNextLocalSeq(){return++this.client.getCollabWindow().localSeq}getIntervalById(e){if(!this.attached)throw new oe("attach must be called before accessing intervals");return this.localCollection.getIntervalById(e)}add(e,t,r,i){var s,o;if(!this.attached)throw new oe("attach must be called prior to adding intervals");if(r&Yn.Transient)throw new oe("Can not add transient intervals");const a=this.localCollection.addInterval(e,t,r,i);if(a){const l={end:t,intervalType:r,properties:a.properties,sequenceNumber:(o=(s=this.client)===null||s===void 0?void 0:s.getCurrentSeq())!==null&&o!==void 0?o:0,start:e};this.emitter.emit("add",void 0,l,{localSeq:this.getNextLocalSeq()})}return this.emit("addInterval",a,!0,void 0),a}deleteExistingInterval(e,t,r){this.localCollection.removeExistingInterval(e),e&&(t?this.emitter.emit("delete",void 0,e.serialize(this.client),{localSeq:this.getNextLocalSeq()}):this.onDeserialize&&this.onDeserialize(e)),this.emit("deleteInterval",e,t,r)}removeIntervalById(e){const t=this.localCollection.getIntervalById(e);return t&&this.deleteExistingInterval(t,!0,void 0),t}changeProperties(e,t){if(!this.attached)throw new oe("Attach must be called before accessing intervals");if(typeof e!="string")throw new oe("Change API requires an ID that is a string");if(!t)throw new oe("changeProperties should be called with a property set");const r=this.getIntervalById(e);if(r){const i=r.addProperties(t,!0,re),s=r.serialize(this.client);s.start=void 0,s.end=void 0,s.properties=t,s.properties[At]=r.getIntervalId(),this.emitter.emit("change",void 0,s,{localSeq:this.getNextLocalSeq()}),this.emit("propertyChanged",r,i)}this.emit("changeInterval",r,!0,void 0)}change(e,t,r){if(!this.attached)throw new oe("Attach must be called before accessing intervals");if(typeof e!="string")throw new oe("Change API requires an ID that is a string");const i=this.getIntervalById(e);if(i){const s=this.localCollection.changeInterval(i,t,r),o=i.serialize(this.client);return o.start=t,o.end=r,o.properties={[At]:i.getIntervalId()},this.emitter.emit("change",void 0,o,{localSeq:this.getNextLocalSeq()}),this.addPendingChange(e,o),this.emit("changeInterval",s,!0,void 0),s}}addPendingChange(e,t){t.start!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesStart,t),t.end!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesEnd,t)}addPendingChangeHelper(e,t,r){let i=t.get(e);i||(i=[],t.set(e,i)),i.push(r)}removePendingChange(e){var t;const r=(t=e.properties)===null||t===void 0?void 0:t[At];e.start!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesStart,e),e.end!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesEnd,e)}removePendingChangeHelper(e,t,r){const i=t.get(e);if(i){const s=i.shift();if(i.length===0&&t.delete(e),(s==null?void 0:s.start)!==r.start||(s==null?void 0:s.end)!==r.end)throw new oe("Mismatch in pending changes")}}hasPendingChangeStart(e){const t=this.pendingChangesStart.get(e);return t&&t.length!==0}hasPendingChangeEnd(e){const t=this.pendingChangesEnd.get(e);return t&&t.length!==0}changeInterval(e,t,r){return this.ackChange(e,t,r)}ackChange(e,t,r){var i,s,o,a;if(!this.attached)throw new oe("Attach must be called before accessing intervals");let l;if(t){this.removePendingChange(e);const c=(i=e.properties)===null||i===void 0?void 0:i[At];l=this.getIntervalById(c),l&&((s=l.propertyManager)===null||s===void 0||s.ackPendingProperties({type:ce.ANNOTATE,props:(o=e.properties)!==null&&o!==void 0?o:{}}),this.ackInterval(l,r))}else{const c=e.properties,u=At,d=c[u],h=D7(c,[u+""]);if(l=this.getIntervalById(d),l){let f,p;this.hasPendingChangeStart(d)||(f=e.start),this.hasPendingChangeEnd(d)||(p=e.end),(f!==void 0||p!==void 0)&&(l=(a=this.localCollection.changeInterval(l,f,p,r))!==null&&a!==void 0?a:l);const g=l.addProperties(h,!0,r.sequenceNumber);this.onDeserialize&&this.onDeserialize(l),this.emit("propertyChanged",l,g)}}l&&this.emit("changeInterval",l,t,r)}addConflictResolver(e){if(!this.attached)throw new oe("attachSequence must be called");this.localCollection.addConflictResolver(e)}attachDeserializer(e){e&&(this.onDeserialize=e,this.localCollection.map(t=>{e(t)}))}rebaseLocalInterval(e,t,r){var i,s;if(!this.attached)throw new oe("attachSequence must be called");const{start:o,end:a,intervalType:l,properties:c,sequenceNumber:u}=t,d=o===void 0?void 0:this.client.rebasePosition(o,u,r),h=a===void 0?void 0:this.client.rebasePosition(a,u,r),f=c==null?void 0:c[At],p={start:d,end:h,intervalType:l,sequenceNumber:(s=(i=this.client)===null||i===void 0?void 0:i.getCurrentSeq())!==null&&s!==void 0?s:0,properties:c};return e==="change"&&(this.hasPendingChangeStart(f)||this.hasPendingChangeEnd(f))&&(this.removePendingChange(t),this.addPendingChange(f,p)),p}getSlideToSegment(e){const t={segment:e.segment,offset:e.offset},r=this.client.getSlideToSegment(t);return t.segment===r.segment&&t.offset===r.offset?void 0:r}setSlideOnRemove(e){let t=e.refType;t=t&~ee.StayOnRemove,t=t|ee.SlideOnRemove,e.refType=t}ackInterval(e,t){if(!(e instanceof Xr)||!He(e.start,ee.StayOnRemove)&&!He(e.end,ee.StayOnRemove))return;const r=this.getSlideToSegment(e.start),i=this.getSlideToSegment(e.end),s=e.properties[At],o=this.hasPendingChangeStart(s),a=this.hasPendingChangeEnd(s);o||this.setSlideOnRemove(e.start),a||this.setSlideOnRemove(e.end);const l=r!==void 0&&!o,c=i!==void 0&&!a;if(l||c){if(this.localCollection.removeExistingInterval(e),l){const u=e.start.properties;this.client.removeLocalReferencePosition(e.start),e.start=Cv(this.client,r,e.start.refType,t),u&&e.start.addProperties(u)}if(c){const u=e.end.properties;this.client.removeLocalReferencePosition(e.end),e.end=Cv(this.client,i,e.end.refType,t),u&&e.end.addProperties(u)}this.localCollection.add(e)}}addInternal(e,t,r){return this.ackAdd(e,t,r)}ackAdd(e,t,r){var i;if(t){const o=(i=e.properties)===null||i===void 0?void 0:i[At],a=this.getIntervalById(o);a&&this.ackInterval(a,r);return}if(!this.attached)throw new oe("attachSequence must be called");this.localCollection.ensureSerializedId(e);const s=this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties,r);return s&&this.onDeserialize&&this.onDeserialize(s),this.emit("addInterval",s,t,r),s}deleteInterval(e,t,r){return this.ackDelete(e,t,r)}ackDelete(e,t,r){if(t)return;if(!this.attached)throw new oe("attach must be called prior to deleting intervals");const i=this.localCollection.ensureSerializedId(e),s=this.localCollection.getIntervalById(i);s&&this.deleteExistingInterval(s,t,r)}serializeInternal(){if(!this.attached)throw new oe("attachSequence must be called");return this.localCollection.serialize()}[Symbol.iterator](){return new Eo(this)}CreateForwardIteratorWithStartPosition(e){return new Eo(this,!0,e)}CreateBackwardIteratorWithStartPosition(e){return new Eo(this,!1,e)}CreateForwardIteratorWithEndPosition(e){return new Eo(this,!0,void 0,e)}CreateBackwardIteratorWithEndPosition(e){return new Eo(this,!1,void 0,e)}gatherIterationResults(e,t,r,i){this.attached&&this.localCollection.gatherIterationResults(e,t,r,i)}findOverlappingIntervals(e,t){if(!this.attached)throw new oe("attachSequence must be called");return this.localCollection.findOverlappingIntervals(e,t)}map(e){if(!this.attached)throw new oe("attachSequence must be called");this.localCollection.map(e)}previousInterval(e){if(!this.attached)throw new oe("attachSequence must be called");return this.localCollection.previousInterval(e)}nextInterval(e){if(!this.attached)throw new oe("attachSequence must be called");return this.localCollection.nextInterval(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var th;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(th||(th={}));var IE;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(IE||(IE={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function W7(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class AE{constructor(e,t){this.value=e,this.valueType=t}get type(){return this.valueType.name}makeSerialized(e,t){const r=this.valueType.factory.store(this.value),i=UR(r,e,t);return{type:this.type,value:i}}getOpHandler(e){const t=this.valueType.ops.get(e);if(!t)throw new Error("Unknown type message");return t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Sk{constructor(e,t,r,i,s=new sk){this.serializer=e,this.handle=t,this.submitMessage=r,this.type=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){var t;return((t=this.data.get(e))!==null&&t!==void 0?t:this.createCore(e,!0)).value}has(e){return this.data.has(e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=W7(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){if(r.type===Fe[Fe.Plain]||r.type===Fe[Fe.Shared])continue;const s={key:t.startsWith("intervalCollections/")?t.substring(20):t,value:this.makeLocal(t,r)};this.data.set(s.key,s.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}tryResubmitMessage(e,t){const r=e.type,i=this.messageHandlers.get(r);return i!==void 0?(i.resubmit(e,t),!0):!1}tryGetStashedOpLocalMetadata(e){const t=e.type;if(this.messageHandlers.has(t))return this.messageHandlers.get(t).getStashedOpLocalMetadata(e);throw new Error("no apply stashed op handler")}tryProcessMessage(e,t,r,i){const s=this.messageHandlers.get(e.type);return s!==void 0?(s.process(e,t,r,i),!0):!1}createCore(e,t){const r=new AE(this.type.factory.load(this.makeMapValueOpEmitter(e),void 0),this.type),i=this.data.get(e);this.data.set(e,r);const s={key:e,previousValue:i};return this.eventEmitter.emit("create",s,t,this.eventEmitter),r}makeLocal(e,t){Sn(t.type!==Fe[Fe.Plain]&&t.type!==Fe[Fe.Shared],737),t.value=Xd(t.value,this.serializer);const r=this.type.factory.load(this.makeMapValueOpEmitter(e),t.value);return new AE(r,this.type)}getMessageHandlers(){const e=new Map;return e.set("act",{process:(t,r,i,s)=>{var o;const a=(o=this.data.get(t.key))!==null&&o!==void 0?o:this.createCore(t.key,r),l=a.getOpHandler(t.value.opName),c=a.value,u=Xd(t.value.value,this.serializer);l.process(c,u,r,i,s);const d={key:t.key,previousValue:c};this.eventEmitter.emit("valueChanged",d,r,i,this.eventEmitter)},submit:(t,r)=>{this.submitMessage(t,r)},resubmit:(t,r)=>{const i=this.data.get(t.key),s=i.getOpHandler(t.value.opName),{rebasedOp:o,rebasedLocalOpMetadata:a}=s.rebase(i.value,t.value,r);this.submitMessage(Object.assign(Object.assign({},t),{value:o}),a)},getStashedOpLocalMetadata:t=>{Sn(!1,22)}}),e}makeMapValueOpEmitter(e){return{emit:(r,i,s,o)=>{const a=HR(s,this.serializer,this.handle),l={key:e,type:"act",value:{opName:r,value:a}};this.submitMessage(l,o);const c={key:e,previousValue:i};this.eventEmitter.emit("valueChanged",c,!0,null,this.eventEmitter)}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class pS{constructor(e,t){this.deltaArgs=e,this.mergeTreeClient=t,Sn(e.deltaSegments.length>0,728),this.isEmpty=!1,this.deltaOperation=e.operation,this.sortedRanges=new um(()=>{const r=new m7;return this.deltaArgs.deltaSegments.forEach(i=>{const s={operation:this.deltaArgs.operation,position:this.mergeTreeClient.getPosition(i.segment),propertyDeltas:i.propertyDeltas,segment:i.segment};r.addOrUpdate(s)}),r}),this.pFirst=new um(()=>this.sortedRanges.value.items[0]),this.pLast=new um(()=>this.sortedRanges.value.items[this.sortedRanges.value.size-1])}get ranges(){return this.sortedRanges.value.items}get clientId(){return this.mergeTreeClient.longClientId}get first(){return this.pFirst.value}get last(){return this.pLast.value}}class bk extends pS{constructor(e,t,r){super(t,r),this.opArgs=e,this.isLocal=e.sequencedMessage===void 0}}class wk extends pS{constructor(e,t,r){super(t,r),this.opArgs=e}}let um=class{constructor(e){this.valueGenerator=e,this.pEvaluated=!1}get evaluated(){return this.pEvaluated}get value(){return this.pEvaluated||(this.pEvaluated=!0,this.pValue=this.valueGenerator()),this.pValue}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const dm="header",ME="content";class Ia extends Xh{constructor(e,t,r,i){super(t,e,r,"fluid_sequence_"),this.dataStoreRuntime=e,this.id=t,this.segmentFromSpec=i,this.loadedDeferred=new r7,this.loadedDeferredOutgoingOps=[],this.deferIncomingOps=!0,this.loadedDeferredIncomingOps=[],this.messagesSinceMSNChange=[],this.loadedDeferred.promise.catch(s=>{this.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},s)}),this.client=new hS(i,ue.create(this.logger,"SharedSegmentSequence.MergeTreeClient"),e.options),super.on("newListener",s=>{switch(s){case"sequenceDelta":this.client.mergeTreeDeltaCallback||(this.client.mergeTreeDeltaCallback=(o,a)=>{this.emit("sequenceDelta",new bk(o,a,this.client),this)});break;case"maintenance":this.client.mergeTreeMaintenanceCallback||(this.client.mergeTreeMaintenanceCallback=(o,a)=>{this.emit("maintenance",new wk(a,o,this.client),this)});break}}),super.on("removeListener",s=>{switch(s){case"sequenceDelta":super.listenerCount(s)===0&&(this.client.mergeTreeDeltaCallback=void 0);break;case"maintenance":super.listenerCount(s)===0&&(this.client.mergeTreeMaintenanceCallback=void 0);break}}),this.intervalCollections=new Sk(this.serializer,this.handle,(s,o)=>this.submitLocalMessage(s,o),new Gi)}get loaded(){return this.loadedDeferred.promise}static createOpsFromDelta(e){var t,r;const i=[];for(const s of e.ranges)switch(e.deltaOperation){case ce.ANNOTATE:{const o=i[i.length-1],a={};for(const l of Object.keys(s.propertyDeltas))a[l]=(r=(t=s.segment.properties)===null||t===void 0?void 0:t[l])!==null&&r!==void 0?r:null;o&&o.pos2===s.position&&qc(o.props,a)?o.pos2+=s.segment.cachedLength:i.push(bv(s.position,s.position+s.segment.cachedLength,a,void 0));break}case ce.INSERT:i.push(mk(s.position,s.segment.clone().toJSONObject()));break;case ce.REMOVE:{const o=i[i.length-1];(o==null?void 0:o.pos1)===s.position?o.pos2+=s.segment.cachedLength:i.push(wv(s.position,s.position+s.segment.cachedLength));break}}return i}removeRange(e,t){const r=this.client.removeRangeLocal(e,t);return r&&this.submitSequenceMessage(r),r}groupOperation(e){this.client.localTransaction(e),this.submitSequenceMessage(e)}getContainingSegment(e){return this.client.getContainingSegment(e)}getLength(){return this.client.getLength()}getPosition(e){return this.client.getPosition(e)}annotateRange(e,t,r,i){const s=this.client.annotateRangeLocal(e,t,r,i);s&&this.submitSequenceMessage(s)}getPropertiesAtPosition(e){return this.client.getPropertiesAtPosition(e)}getRangeExtentsOfPosition(e){return this.client.getRangeExtentsOfPosition(e)}createPositionReference(e,t,r){const i=new ao(this.client,e,t,r);return r!==ee.Transient&&this.addLocalReference(i),i}createLocalReferencePosition(e,t,r,i){return this.client.createLocalReferencePosition(e,t,r,i)}localRefToPos(e){return this.client.localReferencePositionToPosition(e)}localReferencePositionToPosition(e){return this.client.localReferencePositionToPosition(e)}resolveRemoteClientPosition(e,t,r){return this.client.resolveRemoteClientPosition(e,t,r)}submitSequenceMessage(e){if(!this.isAttached())return;const t=HR(e,this.serializer,this.handle),r=this.client.peekPendingSegmentGroups(e.type===ce.GROUP?e.ops.length:1);this.loadedDeferred.isCompleted?this.submitLocalMessage(t,r):this.loadedDeferredOutgoingOps.push([t,r])}addLocalReference(e){return this.client.addLocalReference(e)}removeLocalReference(e){return this.client.removeLocalReferencePosition(e)}removeLocalReferencePosition(e){return this.client.removeLocalReferencePosition(e)}posFromRelativePos(e){return this.client.posFromRelativePos(e)}walkSegments(e,t,r,i,s=!1){return this.client.walkSegments(e,t,r,i,s)}getStackContext(e,t){return this.client.getStackContext(e,t)}getCurrentSeq(){return this.client.getCurrentSeq()}insertAtReferencePosition(e,t){const r=this.client.insertAtReferencePositionLocal(e,t);r&&this.submitSequenceMessage(r)}async waitIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollectionLabels(){return this.intervalCollections.keys()}summarizeCore(e,t){const r=new Kt;return this.intervalCollections.size>0&&r.addBlob(dm,this.intervalCollections.serialize(e)),r.addWithStats(ME,this.summarizeMergeTree(e)),r.getSummaryTree()}processGCDataCore(e){this.intervalCollections.size>0&&this.intervalCollections.serialize(e),this.client.serializeGCData(this.handle,e)}replaceRange(e,t,r){const i=Math.max(e,t),s=this.client.insertSegmentLocal(i,r);if(s)if(e<t){const o=this.client.removeRangeLocal(e,t);this.submitSequenceMessage(Zd(s,o))}else this.submitSequenceMessage(s)}onConnect(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}onDisconnect(){}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)||this.submitSequenceMessage(this.client.regeneratePendingOp(e,t))}async loadCore(e){var t;if(await e.contains(dm)){const r=await e.readBlob(dm),i=ik(r,"utf8");this.intervalCollections.populate(i)}try{const{catchupOpsP:r}=await this.client.load(this.runtime,new J5(e,ME),this.serializer),i=r.then(s=>{s.forEach(o=>{const a=this.client.getCollabWindow();if(o.minimumSequenceNumber<a.minSeq||o.referenceSequenceNumber<a.minSeq||o.sequenceNumber<=a.minSeq||o.sequenceNumber<=a.currentSeq)throw new Error(`Invalid catchup operations in snapshot: ${JSON.stringify({op:{seq:o.sequenceNumber,minSeq:o.minimumSequenceNumber,refSeq:o.referenceSequenceNumber},collabWindow:{seq:a.currentSeq,minSeq:a.minSeq}})}`);this.processMergeTreeMsg(o)}),this.loadFinished()}).catch(s=>{this.loadFinished(s)});((t=this.dataStoreRuntime.options)===null||t===void 0?void 0:t.sequenceInitializeFromHeaderOnly)!==!0&&await i}catch(r){this.loadFinished(r)}}processCore(e,t,r){this.deferIncomingOps?(Sn(!t,114),this.loadedDeferredIncomingOps.push(e)):(Sn(e.type===th.Operation,115),this.intervalCollections.tryProcessMessage(e.contents,t,e,r)||this.processMergeTreeMsg(e,t))}didAttach(){var e;this.isAttached()&&this.client.startOrUpdateCollaboration((e=this.runtime.clientId)!==null&&e!==void 0?e:"attached")}initializeLocalCore(){super.initializeLocalCore(),this.loadFinished()}applyStashedOp(e){return this.client.applyStashedOp(e)}summarizeMergeTree(e){Sn(this.loadedDeferred.isCompleted,116);const t=this.runtime.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(t),this.messagesSinceMSNChange.forEach(r=>{r.minimumSequenceNumber=t}),this.client.summarize(this.runtime,this.handle,e,this.messagesSinceMSNChange)}processMergeTreeMsg(e,t){var r,i;const s=Xd(e,this.serializer),o=[];function a(u){o.push(...Ia.createOpsFromDelta(u))}const l=s.referenceSequenceNumber!==s.sequenceNumber-1;let c=s;((r=this.runtime.options)===null||r===void 0?void 0:r.newMergeTreeSnapshotFormat)!==!0&&l&&this.on("sequenceDelta",a),this.client.applyMsg(s,t),((i=this.runtime.options)===null||i===void 0?void 0:i.newMergeTreeSnapshotFormat)!==!0&&(l&&(this.removeListener("sequenceDelta",a),c=Object.assign(Object.assign({},s),{referenceSequenceNumber:c.sequenceNumber-1,contents:o.length!==1?Zd(...o):o[0]})),this.messagesSinceMSNChange.push(c),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<s.minimumSequenceNumber&&this.processMinSequenceNumberChanged(s.minimumSequenceNumber))}processMinSequenceNumberChanged(e){let t=0;for(;t<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[t].sequenceNumber>e);t++);t!==0&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(t))}loadFinished(e){if(!this.loadedDeferred.isCompleted){if(this.initializeIntervalCollections(),e)throw this.loadedDeferred.reject(e),e;this.deferIncomingOps=!1;for(const t of this.loadedDeferredIncomingOps)this.processCore(t,!1,void 0);this.loadedDeferredIncomingOps.length=0,this.loadedDeferred.resolve();for(const[t,r]of this.loadedDeferredOutgoingOps)this.reSubmitCore(t,r);this.loadedDeferredOutgoingOps.length=0}}initializeIntervalCollections(){this.intervalCollections.eventEmitter.on("create",({key:e,previousValue:t},r)=>{const i=this.intervalCollections.get(e);i.attached||i.attachGraph(this.client,e),Sn(t===void 0,705),this.emit("createIntervalCollection",e,r,this)});for(const e of this.intervalCollections.keys())this.intervalCollections.get(e).attachGraph(this.client,e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const Uc="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const DE=128;class Ht extends tf{constructor(e){super(),this.items=e,this.type=Ht.typeString,this.cachedLength=e.length}static is(e){return e.type===Ht.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new Ht(e.items);return e.props&&t.addProperties(e.props),t}}toJSONObject(){const e={items:this.items};return super.addSerializedProps(e),e}clone(e=0,t){const r=this.items.slice(e,t),i=new Ht(r);return this.cloneInto(i),i}canAppend(e){return Ht.is(e)&&(this.cachedLength<=DE||e.cachedLength<=DE)}toString(){return this.items.toString()}append(e){if(!Ht.is(e))throw new Error("can only append another run segment");Qr.append(this,e),this.items=this.items.concat(e.items),this.cachedLength=this.items.length}removeRange(e,t){let r=[];const i=this.items.length;return e>0&&(r=r.concat(this.items.slice(0,e))),t<i&&(r=r.concat(this.items.slice(t))),this.items=r,this.cachedLength=this.items.length,this.items.length===0}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);return this.items=this.items.slice(0,e),this.cachedLength=this.items.length,new Ht(t)}}}Ht.typeString="SubSequence";class mS extends Ia{constructor(e,t,r,i){super(e,t,r,i),this.id=t}insert(e,t,r){const i=new Ht(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}remove(e,t){this.removeRange(e,t)}getItemCount(){return this.getLength()}getItems(e,t){const r=[];let i;return t!==void 0&&t<=e||(this.walkSegments(s=>(Ht.is(s)&&(i===void 0&&(i=s),r.push(...s.items)),!0),e,t),i!==void 0&&r.splice(0,e-this.getPosition(i)),t!==void 0&&r.splice(t-e)),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _v extends mS{constructor(e,t,r){super(e,t,r,Tr.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Tr.Type)}static getFactory(){return new Tr}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Ev extends mS{constructor(e,t,r){super(e,t,r,Er.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Er.Type)}static getFactory(){return new Er}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _r{static segmentFromSpec(e){const t=pt.fromJSONObject(e);if(t)return t;const r=_t.fromJSONObject(e);if(r)return r}get type(){return _r.Type}get attributes(){return _r.Attributes}async load(e,t,r,i){const s=new Tv(e,t,i);return await s.load(r),s}create(e,t){const r=new Tv(e,t,this.attributes);return r.initializeLocal(),r}}_r.Type="https://graph.microsoft.com/types/mergeTree";_r.Attributes={type:_r.Type,snapshotFormatVersion:"0.1",packageVersion:Uc};class Er{static segmentFromSpec(e){const t=e;if(t.items){const r=new Ht(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return Er.Type}get attributes(){return Er.Attributes}async load(e,t,r,i){const s=new Ev(e,t,i);return await s.load(r),s}create(e,t){const r=new Ev(e,t,this.attributes);return r.initializeLocal(),r}}Er.Type="https://graph.microsoft.com/types/mergeTree/object-sequence";Er.Attributes={type:Er.Type,snapshotFormatVersion:"0.1",packageVersion:Uc};class Tr{static segmentFromSpec(e){const t=e;if(t.items){const r=new Ht(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return Tr.Type}get attributes(){return Tr.Attributes}async load(e,t,r,i){const s=new _v(e,t,i);return await s.load(r),s}create(e,t){const r=new _v(e,t,this.attributes);return r.initializeLocal(),r}}Tr.Type="https://graph.microsoft.com/types/mergeTree/number-sequence";Tr.Attributes={type:Tr.Type,snapshotFormatVersion:"0.1",packageVersion:Uc};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Tv extends Ia{constructor(e,t,r){super(e,t,r,_r.segmentFromSpec),this.id=t,this.mergeTreeTextHelper=this.client.createTextHelper()}static create(e,t){return e.createChannel(t,_r.Type)}static getFactory(){return new _r}get ISharedString(){return this}insertMarkerRelative(e,t,r){const i=new _t(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertMarker(e,t,r){const i=new _t(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);return s&&this.submitSequenceMessage(s),s}insertTextRelative(e,t,r){const i=new pt(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertText(e,t,r){const i=new pt(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}replaceText(e,t,r,i){this.replaceRange(e,t,pt.make(r,i))}removeText(e,t){return this.removeRange(e,t)}annotateMarkerNotifyConsensus(e,t,r){const i=this.client.annotateMarkerNotifyConsensus(e,t,r);i&&this.submitSequenceMessage(i)}annotateMarker(e,t,r){const i=this.client.annotateMarker(e,t,r);i&&this.submitSequenceMessage(i)}findTile(e,t,r=!0){return this.client.findTile(e,t,r)}getTextAndMarkers(e){const t=this.client.getCollabWindow();return this.mergeTreeTextHelper.getTextAndMarkers(t.currentSeq,t.clientId,e)}getText(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"",e,t)}getTextWithPlaceholders(){const e=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(e.currentSeq,e.clientId," ")}getTextRangeWithPlaceholders(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId," ",e,t)}getTextRangeWithMarkers(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"*",e,t)}getMarkerFromId(e){return this.client.getMarkerFromId(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class en extends tf{constructor(e){super(),this.type=en.typeString,this.cachedLength=e}static is(e){return e.type===en.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"pad"in e){const t=new en(e.pad);return e.props&&t.addProperties(e.props),t}}toJSONObject(){return{pad:this.cachedLength,props:this.properties}}clone(e=0,t){const r=new en(this.cachedLength);return this.cloneInto(r),r}canAppend(e){return en.is(e)}toString(){return`[padding: ${this.cachedLength}]`}append(e){if(!en.is(e))throw new Error("can only append padding segment");Qr.append(this,e),this.cachedLength+=e.cachedLength}removeRange(e,t){return this.cachedLength-=t-e,this.cachedLength===0}createSplitSegmentAt(e){const t=e,r=this.cachedLength-e;return this.cachedLength=t,new en(r)}}en.typeString="PaddingSegment";class vn extends Ht{constructor(e){super(e),this.items=e,this.type=vn.typeString,this.tags=new Array(e.length).fill(void 0)}static is(e){return e.type===vn.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new vn(e.items);return e.props&&t.addProperties(e.props),t}}clone(e=0,t){const r=new vn(this.items.slice(e,t));return this.tags&&(r.tags=this.tags.slice(e,t)),this.cloneInto(r),r}append(e){super.append(e);const t=e;return t.tags&&this.tags&&this.tags.splice(this.items.length,0,...t.tags),this}removeRange(e,t){return this.tags.splice(e,t-e),super.removeRange(e,t)}getTag(e){return this.tags[e]}setTag(e,t){this.tags[e]=t}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);this.items=this.items.slice(0,e),this.cachedLength=this.items.length;const r=new vn(t);return r.tags=this.tags.slice(e),this.tags.length=e,r}}}vn.typeString="RunSegment";const gc=2097152,js=gc+1,gS=4294967295,V7=gS+1,G7=gc*gS,vi=(n,e)=>n*js+e;function Ck(n){const e=Math.floor(n/js),t=n-e*js;return{row:e,col:t}}class xv extends Ia{constructor(e,t,r){super(e,t,r,xr.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,xr.Type)}static getFactory(){return new xr}get numRows(){return Ck(this.getLength()).row}setItems(e,t,r,i){const s=vi(e,t),o=s+r.length,a=new vn(r);i&&a.addProperties(i),this.replaceRange(s,o,a)}getItem(e,t){const r=vi(e,t),{segment:i,offset:s}=this.getContainingSegment(r);if(i&&vn.is(i))return i.items[s];if(i&&en.is(i))return;throw new Error("Unrecognized Segment type")}getTag(e,t){const{segment:r,offset:i}=this.getSegment(e,t);if(vn.is(r))return r.getTag(i)}setTag(e,t,r){const{segment:i,offset:s}=this.getSegment(e,t);if(vn.is(i))i.setTag(s,r);else if(r!==void 0)throw new Error(`Must not attempt to set tags on '${i.constructor.name}'.`)}insertRows(e,t){const r=vi(e,0),i=js*t,s=new en(i),o=this.client.insertSegmentLocal(r,s);o&&this.submitSequenceMessage(o)}removeRows(e,t){const r=vi(e,0),i=js*t;this.removeRange(r,r+i)}insertCols(e,t){this.moveAsPadding(gc-t,e,t)}removeCols(e,t){this.moveAsPadding(e,gc-t,t)}annotatePosition(e,t,r){const i=vi(e,t);this.annotateRange(i,i+1,r)}getPositionProperties(e,t){const r=vi(e,t);return this.getPropertiesAtPosition(r)}moveAsPadding(e,t,r){const i=e,s=e+r,o=[];for(let a=0,l=0;a<this.numRows;a++,l+=js){o.push(this.client.removeRangeLocal(l+i,l+s));const c=l+t,u=new en(r);o.push(this.client.insertSegmentLocal(c,u))}this.submitSequenceMessage(Zd(...o))}getSegment(e,t){const r=vi(e,t);return this.getContainingSegment(r)}}class xr{static segmentFromSpec(e){const t=en.fromJSONObject(e);if(t)return t;const r=vn.fromJSONObject(e);if(r)return r;throw new Error(`Unrecognized IJSONObject: '${JSON.stringify(e)}'`)}get type(){return xr.Type}get attributes(){return xr.Attributes}async load(e,t,r,i){const s=new xv(e,t,i);return await s.load(r),s}create(e,t){const r=new xv(e,t,this.attributes);return r.initializeLocal(),r}}xr.Type="https://graph.microsoft.com/types/mergeTree/sparse-matrix";xr.Attributes={type:xr.Type,snapshotFormatVersion:"0.1",packageVersion:Uc};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var _k;const FE="header";class si{get type(){return si.Type}get attributes(){return si.Attributes}async load(e,t,r,i){const s=new Ov(t,e,i);return await s.load(r),s}create(e,t){const r=new Ov(t,e,this.attributes);return r.initializeLocal(),r}}si.Type="https://graph.microsoft.com/types/sharedIntervalCollection";si.Attributes={type:si.Type,snapshotFormatVersion:"0.1",packageVersion:Uc};class Ov extends Xh{constructor(e,t,r){super(e,t,r,"fluid_sharedIntervalCollection_"),this[_k]="SharedIntervalCollection",this.intervalCollections=new Sk(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),new Ki)}static create(e,t){return e.createChannel(t,si.Type)}static getFactory(){return new si}async waitIntervalCollection(e){return this.intervalCollections.get(this.getIntervalCollectionPath(e))}getIntervalCollection(e){const t=this.getIntervalCollectionPath(e);return this.intervalCollections.get(t)}summarizeCore(e){return I9(FE,this.intervalCollections.serialize(e))}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)}onDisconnect(){}async loadCore(e){const t=await e.readBlob(FE),r=ik(t,"utf8");this.intervalCollections.populate(r)}processCore(e,t,r){e.type===th.Operation&&this.intervalCollections.tryProcessMessage(e.contents,t,e,r)}getIntervalCollectionPath(e){return e}applyStashedOp(){throw new Error("not implemented")}}_k=Symbol.toStringTag;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const K7=Object.freeze(Object.defineProperty({__proto__:null,get AttachState(){return Z},get ConnectionState(){return we},get ContainerErrorType(){return Yi},DOProviderContainerRuntimeFactory:nk,DirectoryFactory:nr,get DriverErrorType(){return En},FluidContainer:uv,Interval:ta,IntervalCollection:fS,IntervalCollectionIterator:Eo,get IntervalType(){return Yn},LocalValueMaker:nS,MapFactory:$n,PaddingSegment:en,RootDataObject:tk,RunSegment:vn,SequenceDeltaEvent:bk,SequenceEvent:pS,SequenceInterval:Xr,SequenceMaintenanceEvent:wk,ServiceAudience:rk,SharedDirectory:pc,SharedIntervalCollection:Ov,SharedIntervalCollectionFactory:si,SharedMap:fc,SharedNumberSequence:_v,SharedNumberSequenceFactory:Tr,SharedObjectSequence:Ev,SharedObjectSequenceFactory:Er,SharedSegmentSequence:Ia,SharedSequence:mS,SharedString:Tv,SharedStringFactory:_r,SparseMatrix:xv,SparseMatrixFactory:xr,SubSequence:Ht,maxCellPosition:G7,maxCol:gc,maxCols:js,maxRow:gS,maxRows:V7,positionToRowCol:Ck,rowColToPosition:vi},Symbol.toStringTag,{value:"Module"})),J7=Sc(K7);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(ui,"__esModule",{value:!0});ui.DynamicObjectRegistry=void 0;const Sa=J7,zE="@microsoft/live-share:DYNAMIC-LOADABLE-OBJECTS";class Hc{static get dynamicLoadableObjects(){return typeof window>"u"?this._dynamicLoadableObjects:window[zE]||this._dynamicLoadableObjects}static registerObjectClass(e,t){const r=this.dynamicLoadableObjects;r.has(t)||(r.set(t,e),typeof window<"u"&&(window[zE]=r))}}Hc._dynamicLoadableObjects=new Map;ui.DynamicObjectRegistry=Hc;Hc.registerObjectClass(Sa.SharedMap,Sa.SharedMap.getFactory().type);Hc.registerObjectClass(Sa.SharedString,Sa.SharedString.getFactory().type);Hc.registerObjectClass(Sa.SharedDirectory,Sa.SharedDirectory.getFactory().type);var Wc={},Vc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var hm=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Vc,"__esModule",{value:!0});Vc.TimestampProvider=void 0;const Q7=5*1e3,X7=5;class Y7{constructor(){this._retries=0,this._lastTimeSent=0}get isRunning(){return!!this._serverTime}getTimestamp(){if(!this._serverTime)throw new Error("TimestampProvider: can't call getTimestamp() before calling start().");return this._lastTimeSent=Math.max(new Date().getTime()+this._serverTime.offset,this._lastTimeSent+1)}getMaxTimestampError(){if(!this._serverTime)throw new Error("DefaultTimestampProvider: can't call getMaxTimestampError() before calling initialize().");return Math.floor(this._serverTime.requestLatency/2)}start(){return hm(this,void 0,void 0,function*(){this.stop(),performance.mark("TeamsSync: starting clock");try{yield this.improveAccuracy()}finally{performance.measure("TeamsSync: clock startup","TeamsSync: starting clock")}})}stop(){this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._serverTime=void 0,this._retries=0}improveAccuracy(){return hm(this,void 0,void 0,function*(){const e=yield this.getSessionTimeOffset();!this._serverTime||e.requestLatency<this._serverTime.requestLatency?(this._serverTime=e,this._retries=0):this._retries++,this._retries<=X7?this._syncTimer=setTimeout(this.improveAccuracy.bind(this),Q7):this._syncTimer=void 0})}getSessionTimeOffset(){return hm(this,void 0,void 0,function*(){const e=performance.now(),t=yield this.getNtpTime(),r=performance.now(),i=new Date().getTime(),s=r-e,o=t.ntpTimeInUTC+Math.floor(s/2);return{serverTimeInUtc:o,localTimeInUtc:i,requestLatency:s,offset:o-i}})}}Vc.TimestampProvider=Y7;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Wc,"__esModule",{value:!0});Wc.HostTimestampProvider=void 0;const Z7=Vc;class eK extends Z7.TimestampProvider{constructor(e){super(),this._host=e}getNtpTime(){return this._host.getNtpTime()}}Wc.HostTimestampProvider=eK;var Bn={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.LiveDataObjectInitializeState=n.ContainerState=n.UserMeetingRole=void 0,function(e){e.guest="Guest",e.attendee="Attendee",e.presenter="Presenter",e.organizer="Organizer"}(n.UserMeetingRole||(n.UserMeetingRole={})),function(e){e.added="Added",e.alreadyExists="AlreadyExists",e.conflict="Conflict",e.notFound="NotFound"}(n.ContainerState||(n.ContainerState={})),function(e){e.needed="needed",e.pending="pending",e.succeeded="succeeded",e.fatalError="fatalError"}(n.LiveDataObjectInitializeState||(n.LiveDataObjectInitializeState={}))})(Bn);var fm={};const Aa=Sc(Z9);var tl={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Kn(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ek(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const tK=(n,e)=>lo.from(n,e).buffer,nK=(n,e)=>lo.from(n).toString(e);function Pv(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let lo=class ws extends Uint8Array{toString(e){return Ek(this,e)}static from(e,t,r){if(typeof e=="string")return ws.fromString(e,t);if(e!==null&&typeof e=="object"&&Pv(e.buffer))return ws.fromArrayBuffer(e.buffer,e.byteOffset,e.byteLength);if(Pv(e))return ws.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new ws(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new ws(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new ws(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};async function rK(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function iK(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return ir(n)}}async function Tk(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return AO(()=>import("./hashFileNode-e11a79d9.js"),["assets/hashFileNode-e11a79d9.js","assets/sha256-c81de050.js"]).then(async i=>i.hashFile(n,e,t));const r=await rK(n,e);return iK(r,t)}async function sK(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=lo.from(t+n.toString());return Tk(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Rv=globalThis.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const oK=n=>lo.from(n,"base64").toString("utf-8"),aK=n=>lo.from(n,"utf8").toString("base64"),lK=(n,e)=>{switch(e){case"utf8":case"utf-8":return n;default:return lo.from(n,e).toString()}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function cK(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const uK=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dK(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class xk extends ln.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class fr extends xk{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(fr.removeListenerEvent,t),this.on(fr.newListenerEvent,r)}}static isEmitterEvent(e){return e===fr.newListenerEvent||e===fr.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!fr.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!fr.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if((i==null?void 0:i.has(e))===!0&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}}fr.newListenerEvent="newListener";fr.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const hK={compare:(n,e)=>n-e,min:Number.MIN_VALUE};class fK{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const e=this.L.pop();return this.fixdown(1),e.value}add(e){const t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){const t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){const t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){const r=t>>1;this.swap(t,r),t=r}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r].value,this.L[r+1].value)>0&&r++,this.comp.compare(this.L[t].value,this.L[r].value)<=0)break;this.swap(t,r),t=r}}swap(e,t){const r=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=r,this.L[t].position=t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class pK{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class mK{send(e){}}let gK=class{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class vK{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(e,setTimeout(()=>{this.cleanup(e),this.cancel(e)},this.expiry.durationMs))}cancel(e){const t=this.gcTimeouts.get(e);t!==void 0&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){this.expiry.policy==="sliding"&&(this.cancel(e),this.schedule(e))}}class yK{constructor({expiry:e={policy:"indefinite"},removeOnError:t=()=>!0}={}){this.cache=new Map,this.removeOnError=t,this.gc=new vK(e,r=>this.remove(r))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}async addOrGet(e,t){let r=this.get(e);return r===void 0&&(r=(async()=>t())(),this.cache.set(e,r),r.catch(s=>{this.removeOnError(s)&&this.remove(e)}),this.gc.schedule(e)),r}add(e,t){const r=this.has(e);return this.addOrGet(e,t).catch(()=>{}),!r}async addValueOrGet(e,t){return this.addOrGet(e,async()=>t)}addValue(e,t){return this.add(e,async()=>t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ok=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};class SK{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class bK{constructor(e,t){typeof e=="number"?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=ua(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:ua(this.ranges)}}add(e,t){Kn(e>=this.lastPrimary,3),this.lastSecondary!==void 0&&Kn(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;const r=this.ranges[this.ranges.length-1],i=r.primary+r.length,s=r.secondary+r.length;t!==s&&(e===i?r.length===0?r.secondary=t:(r.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&s+1===t?r.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){Kn(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);Kn(e>=this.ranges[t-1].primary,6);const r=this.ranges[t-1];return Math.min(e-r.primary,r.length)+r.secondary}updateBase(e){Kn(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);Kn(e>=this.ranges[t-1].primary,8);const r=this.ranges[t-1],i=e-r.primary;r.secondary=r.secondary+Math.min(i,r.length),r.length=Math.max(r.length-i,0),r.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,Kn(e===this.ranges[0].primary,9)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class wK{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){const r=[],i=Date.now();for(const s of t){const o=`${e}/${s}`;if(!this.requestMap.has(o))this.requestMap.set(o,i),r.push(s);else{if(this.requestMap.get(o)+this.windowMSec>i)continue;this.requestMap.set(o,i),r.push(s)}}return r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function CK(n){let e;try{e=JSON.parse(n)}catch{return}return e}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const pm=2147483647;function vS(n,e,t){let r;if(e>pm){const i=e-pm;r=setTimeout(()=>vS(n,i,t),pm)}else r=setTimeout(()=>n(),Math.max(e,0));return t==null||t(r),r}class Pk{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:vS(()=>this.handler(),e,i=>{this.runningState!==void 0&&(this.runningState.timeout=i)})}}handler(){Kn(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class _K{constructor(e,t){this.timer=new Pk(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Ok,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),Kn(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class yS{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=Rv.now();return new yS(e)}trace(){const e=Rv.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function EK(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const TK=Object.freeze(Object.defineProperty({__proto__:null,BaseTelemetryNullLogger:mK,Deferred:Ok,EventForwarder:fr,Heap:fK,IsoBuffer:lo,Lazy:pK,LazyPromise:SK,NumberComparer:hK,PromiseCache:yK,PromiseTimer:_K,RangeTracker:bK,RateLimiter:wK,TelemetryNullLogger:gK,Timer:Pk,Trace:yS,TypedEventEmitter:xk,Uint8ArrayToArrayBuffer:cK,Uint8ArrayToString:Ek,assert:Kn,bufferToString:nK,delay:uK,doIfNotDisposed:dK,fromBase64ToUtf8:oK,fromUtf8ToBase64:aK,gitHashFile:sK,hashFile:Tk,isArrayBuffer:Pv,performance:Rv,safelyParseJSON:CK,setLongTimeout:vS,stringToBuffer:tK,toUtf8:lK,unreachableCase:EK},Symbol.toStringTag,{value:"Module"})),Ma=Sc(TK);var mm={},Or={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Or,"__esModule",{value:!0});Or.LiveShareReportIssueLink=Or.ObjectSynchronizerEvents=Or.TelemetryEvents=void 0;Or.TelemetryEvents={LivePresence:{LocalPresenceChanged:"LivePresence:LocalPresenceChange",RemotePresenceChanged:"LivePresence:RemotePresenceChange",GetClientInfoError:"LivePresence:GetClientInfoError",RoleVerificationError:"LivePresence:RoleVerificationError"},LiveState:{StateChanged:"LiveState:StateChanged",RoleVerificationError:"LiveState:RoleVerificationError"}};Or.ObjectSynchronizerEvents={update:"update",connect:"connect"};Or.LiveShareReportIssueLink="https://aka.ms/teamsliveshare/issue";var rf={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var gm=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(rf,"__esModule",{value:!0});rf.LiveShareTokenProvider=void 0;class xK{constructor(e){this._host=e}fetchOrdererToken(e,t,r){return gm(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchStorageToken(e,t,r){return gm(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchFluidToken(e,t,r){return gm(this,void 0,void 0,function*(){let i;return!this._frsToken||r||this._tenantId!==e||this._documentId!==t?(this._frsToken=yield this._host.getFluidToken(t),i=!1):i=!0,this._tenantId=e,t&&(this._documentId=t),{jwt:this._frsToken,fromCache:i}})}}rf.LiveShareTokenProvider=xK;var Da={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Da,"__esModule",{value:!0});Da.RequestCache=void 0;class OK{constructor(e){this._cache=new Map,this._cacheLifetime=e}cacheRequest(e,t){const r=new Date().getTime();let i;if(this._cache.has(e)){i=this._cache.get(e);const o=i.startTime+this._cacheLifetime;if(r<o)return i.promise}const s=t();return this._cache.set(e,{startTime:r,promise:s}),s}has(e){return this._cache.has(e)}}Da.RequestCache=OK;var sf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var PK=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(sf,"__esModule",{value:!0});sf.RoleVerifier=void 0;class RK{constructor(e){this._host=e}verifyRolesAllowed(e,t){var r;return PK(this,void 0,void 0,function*(){if(!e)throw new Error("RoleVerifier: called verifyRolesAllowed() without a clientId");if(Array.isArray(t)&&t.length>0){const i=yield this._host.getClientInfo(e),s=(r=i==null?void 0:i.roles)!==null&&r!==void 0?r:[];for(let o=0;o<t.length;o++){const a=t[o];if(s.indexOf(a)>=0)return!0}return!1}return!0})}}sf.RoleVerifier=RK;var qe={},Rk={},of={},af={};Object.defineProperty(af,"__esModule",{value:!0});af.default=NK;let Tu;const kK=new Uint8Array(16);function NK(){if(!Tu&&(Tu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Tu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tu(kK)}var as={},co={},lf={};Object.defineProperty(lf,"__esModule",{value:!0});lf.default=void 0;var LK=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;lf.default=LK;Object.defineProperty(co,"__esModule",{value:!0});co.default=void 0;var IK=AK(lf);function AK(n){return n&&n.__esModule?n:{default:n}}function MK(n){return typeof n=="string"&&IK.default.test(n)}var DK=MK;co.default=DK;Object.defineProperty(as,"__esModule",{value:!0});as.default=void 0;as.unsafeStringify=kk;var FK=zK(co);function zK(n){return n&&n.__esModule?n:{default:n}}const bt=[];for(let n=0;n<256;++n)bt.push((n+256).toString(16).slice(1));function kk(n,e=0){return bt[n[e+0]]+bt[n[e+1]]+bt[n[e+2]]+bt[n[e+3]]+"-"+bt[n[e+4]]+bt[n[e+5]]+"-"+bt[n[e+6]]+bt[n[e+7]]+"-"+bt[n[e+8]]+bt[n[e+9]]+"-"+bt[n[e+10]]+bt[n[e+11]]+bt[n[e+12]]+bt[n[e+13]]+bt[n[e+14]]+bt[n[e+15]]}function $K(n,e=0){const t=kk(n,e);if(!(0,FK.default)(t))throw TypeError("Stringified UUID is invalid");return t}var jK=$K;as.default=jK;Object.defineProperty(of,"__esModule",{value:!0});of.default=void 0;var qK=UK(af),BK=as;function UK(n){return n&&n.__esModule?n:{default:n}}let $E,vm,ym=0,Sm=0;function HK(n,e,t){let r=e&&t||0;const i=e||new Array(16);n=n||{};let s=n.node||$E,o=n.clockseq!==void 0?n.clockseq:vm;if(s==null||o==null){const h=n.random||(n.rng||qK.default)();s==null&&(s=$E=[h[0]|1,h[1],h[2],h[3],h[4],h[5]]),o==null&&(o=vm=(h[6]<<8|h[7])&16383)}let a=n.msecs!==void 0?n.msecs:Date.now(),l=n.nsecs!==void 0?n.nsecs:Sm+1;const c=a-ym+(l-Sm)/1e4;if(c<0&&n.clockseq===void 0&&(o=o+1&16383),(c<0||a>ym)&&n.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ym=a,Sm=l,vm=o,a+=122192928e5;const u=((a&268435455)*1e4+l)%4294967296;i[r++]=u>>>24&255,i[r++]=u>>>16&255,i[r++]=u>>>8&255,i[r++]=u&255;const d=a/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=d&255,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(let h=0;h<6;++h)i[r+h]=s[h];return e||(0,BK.unsafeStringify)(i)}var WK=HK;of.default=WK;var cf={},es={},Gc={};Object.defineProperty(Gc,"__esModule",{value:!0});Gc.default=void 0;var VK=GK(co);function GK(n){return n&&n.__esModule?n:{default:n}}function KK(n){if(!(0,VK.default)(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var JK=KK;Gc.default=JK;Object.defineProperty(es,"__esModule",{value:!0});es.URL=es.DNS=void 0;es.default=eJ;var QK=as,XK=YK(Gc);function YK(n){return n&&n.__esModule?n:{default:n}}function ZK(n){n=unescape(encodeURIComponent(n));const e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}const Nk="6ba7b810-9dad-11d1-80b4-00c04fd430c8";es.DNS=Nk;const Lk="6ba7b811-9dad-11d1-80b4-00c04fd430c8";es.URL=Lk;function eJ(n,e,t){function r(i,s,o,a){var l;if(typeof i=="string"&&(i=ZK(i)),typeof s=="string"&&(s=(0,XK.default)(s)),((l=s)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=c[u];return o}return(0,QK.unsafeStringify)(c)}try{r.name=n}catch{}return r.DNS=Nk,r.URL=Lk,r}var uf={};Object.defineProperty(uf,"__esModule",{value:!0});uf.default=void 0;function tJ(n){if(typeof n=="string"){const e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return nJ(rJ(iJ(n),n.length*8))}function nJ(n){const e=[],t=n.length*32,r="0123456789abcdef";for(let i=0;i<t;i+=8){const s=n[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);e.push(o)}return e}function Ik(n){return(n+64>>>9<<4)+14+1}function rJ(n,e){n[e>>5]|=128<<e%32,n[Ik(e)-1]=e;let t=1732584193,r=-271733879,i=-1732584194,s=271733878;for(let o=0;o<n.length;o+=16){const a=t,l=r,c=i,u=s;t=Pt(t,r,i,s,n[o],7,-680876936),s=Pt(s,t,r,i,n[o+1],12,-389564586),i=Pt(i,s,t,r,n[o+2],17,606105819),r=Pt(r,i,s,t,n[o+3],22,-1044525330),t=Pt(t,r,i,s,n[o+4],7,-176418897),s=Pt(s,t,r,i,n[o+5],12,1200080426),i=Pt(i,s,t,r,n[o+6],17,-1473231341),r=Pt(r,i,s,t,n[o+7],22,-45705983),t=Pt(t,r,i,s,n[o+8],7,1770035416),s=Pt(s,t,r,i,n[o+9],12,-1958414417),i=Pt(i,s,t,r,n[o+10],17,-42063),r=Pt(r,i,s,t,n[o+11],22,-1990404162),t=Pt(t,r,i,s,n[o+12],7,1804603682),s=Pt(s,t,r,i,n[o+13],12,-40341101),i=Pt(i,s,t,r,n[o+14],17,-1502002290),r=Pt(r,i,s,t,n[o+15],22,1236535329),t=Rt(t,r,i,s,n[o+1],5,-165796510),s=Rt(s,t,r,i,n[o+6],9,-1069501632),i=Rt(i,s,t,r,n[o+11],14,643717713),r=Rt(r,i,s,t,n[o],20,-373897302),t=Rt(t,r,i,s,n[o+5],5,-701558691),s=Rt(s,t,r,i,n[o+10],9,38016083),i=Rt(i,s,t,r,n[o+15],14,-660478335),r=Rt(r,i,s,t,n[o+4],20,-405537848),t=Rt(t,r,i,s,n[o+9],5,568446438),s=Rt(s,t,r,i,n[o+14],9,-1019803690),i=Rt(i,s,t,r,n[o+3],14,-187363961),r=Rt(r,i,s,t,n[o+8],20,1163531501),t=Rt(t,r,i,s,n[o+13],5,-1444681467),s=Rt(s,t,r,i,n[o+2],9,-51403784),i=Rt(i,s,t,r,n[o+7],14,1735328473),r=Rt(r,i,s,t,n[o+12],20,-1926607734),t=kt(t,r,i,s,n[o+5],4,-378558),s=kt(s,t,r,i,n[o+8],11,-2022574463),i=kt(i,s,t,r,n[o+11],16,1839030562),r=kt(r,i,s,t,n[o+14],23,-35309556),t=kt(t,r,i,s,n[o+1],4,-1530992060),s=kt(s,t,r,i,n[o+4],11,1272893353),i=kt(i,s,t,r,n[o+7],16,-155497632),r=kt(r,i,s,t,n[o+10],23,-1094730640),t=kt(t,r,i,s,n[o+13],4,681279174),s=kt(s,t,r,i,n[o],11,-358537222),i=kt(i,s,t,r,n[o+3],16,-722521979),r=kt(r,i,s,t,n[o+6],23,76029189),t=kt(t,r,i,s,n[o+9],4,-640364487),s=kt(s,t,r,i,n[o+12],11,-421815835),i=kt(i,s,t,r,n[o+15],16,530742520),r=kt(r,i,s,t,n[o+2],23,-995338651),t=Nt(t,r,i,s,n[o],6,-198630844),s=Nt(s,t,r,i,n[o+7],10,1126891415),i=Nt(i,s,t,r,n[o+14],15,-1416354905),r=Nt(r,i,s,t,n[o+5],21,-57434055),t=Nt(t,r,i,s,n[o+12],6,1700485571),s=Nt(s,t,r,i,n[o+3],10,-1894986606),i=Nt(i,s,t,r,n[o+10],15,-1051523),r=Nt(r,i,s,t,n[o+1],21,-2054922799),t=Nt(t,r,i,s,n[o+8],6,1873313359),s=Nt(s,t,r,i,n[o+15],10,-30611744),i=Nt(i,s,t,r,n[o+6],15,-1560198380),r=Nt(r,i,s,t,n[o+13],21,1309151649),t=Nt(t,r,i,s,n[o+4],6,-145523070),s=Nt(s,t,r,i,n[o+11],10,-1120210379),i=Nt(i,s,t,r,n[o+2],15,718787259),r=Nt(r,i,s,t,n[o+9],21,-343485551),t=Ni(t,a),r=Ni(r,l),i=Ni(i,c),s=Ni(s,u)}return[t,r,i,s]}function iJ(n){if(n.length===0)return[];const e=n.length*8,t=new Uint32Array(Ik(e));for(let r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function Ni(n,e){const t=(n&65535)+(e&65535);return(n>>16)+(e>>16)+(t>>16)<<16|t&65535}function sJ(n,e){return n<<e|n>>>32-e}function df(n,e,t,r,i,s){return Ni(sJ(Ni(Ni(e,n),Ni(r,s)),i),t)}function Pt(n,e,t,r,i,s,o){return df(e&t|~e&r,n,e,i,s,o)}function Rt(n,e,t,r,i,s,o){return df(e&r|t&~r,n,e,i,s,o)}function kt(n,e,t,r,i,s,o){return df(e^t^r,n,e,i,s,o)}function Nt(n,e,t,r,i,s,o){return df(t^(e|~r),n,e,i,s,o)}var oJ=tJ;uf.default=oJ;Object.defineProperty(cf,"__esModule",{value:!0});cf.default=void 0;var aJ=Ak(es),lJ=Ak(uf);function Ak(n){return n&&n.__esModule?n:{default:n}}const cJ=(0,aJ.default)("v3",48,lJ.default);var uJ=cJ;cf.default=uJ;var hf={},ff={};Object.defineProperty(ff,"__esModule",{value:!0});ff.default=void 0;const dJ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var hJ={randomUUID:dJ};ff.default=hJ;Object.defineProperty(hf,"__esModule",{value:!0});hf.default=void 0;var jE=Mk(ff),fJ=Mk(af),pJ=as;function Mk(n){return n&&n.__esModule?n:{default:n}}function mJ(n,e,t){if(jE.default.randomUUID&&!e&&!n)return jE.default.randomUUID();n=n||{};const r=n.random||(n.rng||fJ.default)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return(0,pJ.unsafeStringify)(r)}var gJ=mJ;hf.default=gJ;var pf={},mf={};Object.defineProperty(mf,"__esModule",{value:!0});mf.default=void 0;function vJ(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function bm(n,e){return n<<e|n>>>32-e}function yJ(n){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let a=0;a<o.length;++a)n.push(o.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const r=n.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(let o=0;o<i;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=n[o*64+l*4]<<24|n[o*64+l*4+1]<<16|n[o*64+l*4+2]<<8|n[o*64+l*4+3];s[o]=a}s[i-1][14]=(n.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<i;++o){const a=new Uint32Array(80);for(let f=0;f<16;++f)a[f]=s[o][f];for(let f=16;f<80;++f)a[f]=bm(a[f-3]^a[f-8]^a[f-14]^a[f-16],1);let l=t[0],c=t[1],u=t[2],d=t[3],h=t[4];for(let f=0;f<80;++f){const p=Math.floor(f/20),g=bm(l,5)+vJ(p,c,u,d)+h+e[p]+a[f]>>>0;h=d,d=u,u=bm(c,30)>>>0,c=l,l=g}t[0]=t[0]+l>>>0,t[1]=t[1]+c>>>0,t[2]=t[2]+u>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+h>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var SJ=yJ;mf.default=SJ;Object.defineProperty(pf,"__esModule",{value:!0});pf.default=void 0;var bJ=Dk(es),wJ=Dk(mf);function Dk(n){return n&&n.__esModule?n:{default:n}}const CJ=(0,bJ.default)("v5",80,wJ.default);var _J=CJ;pf.default=_J;var gf={};Object.defineProperty(gf,"__esModule",{value:!0});gf.default=void 0;var EJ="00000000-0000-0000-0000-000000000000";gf.default=EJ;var vf={};Object.defineProperty(vf,"__esModule",{value:!0});vf.default=void 0;var TJ=xJ(co);function xJ(n){return n&&n.__esModule?n:{default:n}}function OJ(n){if(!(0,TJ.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}var PJ=OJ;vf.default=PJ;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return o.default}});var e=u(of),t=u(cf),r=u(hf),i=u(pf),s=u(gf),o=u(vf),a=u(co),l=u(as),c=u(Gc);function u(d){return d&&d.__esModule?d:{default:d}}})(Rk);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var SS=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(qe,"__esModule",{value:!0});qe.waitUntilConnected=qe.getInsecureTokenProvider=qe.timeoutRequest=qe.waitForResult=qe.TimeoutError=qe.waitForDelay=qe.parseJwt=qe.decodeBase64=qe.cloneValue=void 0;const RJ=Rk;function kJ(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n}qe.cloneValue=kJ;function Fk(n){return typeof atob=="function"?atob(n):Buffer.from(n,"base64").toString()}qe.decodeBase64=Fk;const NJ=n=>{try{return JSON.parse(Fk(n.split(".")[1]))}catch{return null}};qe.parseJwt=NJ;function zk(n){return new Promise(e=>{setTimeout(()=>e(),n)})}qe.waitForDelay=zk;class bS extends Error{constructor(){super("timed out")}}qe.TimeoutError=bS;function LJ(n,e,t,r,i,s,o=1e3){let a=0;return new Promise((l,c)=>SS(this,void 0,void 0,function*(){for(;;){try{const u=yield $k(n,Math.max(o*(a+1),o*3),s),d=e(u);if(d!==null){l(d.response);break}else if(a>=r.length){c(new Error("waitForResult: invalid response"));break}}catch(u){if(a>=r.length){c(t(u));break}if(i&&!(u instanceof bS)){const d=i(u);if(d!==null){c(d);break}}}yield zk(r[a++])}}))}qe.waitForResult=LJ;function $k(n,e,t){return new Promise((r,i)=>SS(this,void 0,void 0,function*(){let s=setTimeout(()=>{i(new bS),s=null},e);try{const o=yield n();r(o),s==null&&(t==null||t())}catch(o){i(o),s==null&&(t==null||t())}clearTimeout(s)}))}qe.timeoutRequest=$k;function IJ(){var n,e;return SS(this,void 0,void 0,function*(){try{const{InsecureTokenProvider:t}=yield require("@fluidframework/test-client-utils"),r=(e=(n=new URL(window.location.href))===null||n===void 0?void 0:n.searchParams)===null||e===void 0?void 0:e.get("userId");return new t("",{id:r??(0,RJ.v4)(),name:"Test User"})}catch{throw new Error("@microsoft/live-share: when using 'local' connection type, you must have @fluidframework/test-client-utils installed")}})}qe.getInsecureTokenProvider=IJ;function AJ(n){return new Promise(e=>{const t=r=>{n.off("connected",t),e(r)};n.clientId?e(n.clientId):n.on("connected",t)})}qe.waitUntilConnected=AJ;var yf={},Fa={},wm=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Fa,"__esModule",{value:!0});Fa.BaseHostDecorator=void 0;class MJ{constructor(e){this._host=e}registerClientId(e){return wm(this,void 0,void 0,function*(){return this._host.registerClientId(e)})}getClientRoles(e){return wm(this,void 0,void 0,function*(){return this._host.getClientRoles(e)})}getClientInfo(e){return wm(this,void 0,void 0,function*(){return this._host.getClientInfo(e)})}getFluidTenantInfo(){return this._host.getFluidTenantInfo()}getFluidToken(e){return this._host.getFluidToken(e)}getFluidContainerId(){return this._host.getFluidContainerId()}setFluidContainerId(e){return this._host.setFluidContainerId(e)}getNtpTime(){return this._host.getNtpTime()}}Fa.BaseHostDecorator=MJ;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.isTimestampProvider=Ct.isILiveEvent=Ct.isErrorLike=Ct.isIClientInfo=Ct.isClientRolesResponse=Ct.isMobileWorkaroundRolesResponse=void 0;function DJ(n){return wS(n==null?void 0:n.userRoles)}Ct.isMobileWorkaroundRolesResponse=DJ;function wS(n){return Array.isArray(n)&&n.every(e=>typeof e=="string")}Ct.isClientRolesResponse=wS;function FJ(n){return n===void 0||(n==null?void 0:n.userId)!==void 0&&wS(n==null?void 0:n.roles)}Ct.isIClientInfo=FJ;function zJ(n){return typeof(n==null?void 0:n.message)=="string"}Ct.isErrorLike=zJ;function $J(n){return typeof n=="object"&&typeof n.clientId=="string"&&typeof n.timestamp=="number"&&typeof n.name=="string"}Ct.isILiveEvent=$J;function jJ(n){return typeof(n==null?void 0:n.start)=="function"}Ct.isTimestampProvider=jJ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var xu=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(yf,"__esModule",{value:!0});yf.LiveShareHostDecorator=void 0;const qJ=Fa,qE=Da,bo=Ct,BE=qe,UE=[100,200,200,400,600],HE=4*1e3;class BJ extends qJ.BaseHostDecorator{constructor(){super(...arguments),this._registerRequestCache=new qE.RequestCache(HE),this._userInfoRequestCache=new qE.RequestCache(HE)}getClientInfo(e,t,r){return xu(this,void 0,void 0,function*(){if(!e)throw new Error("LiveShareHostDecorator: called getClientInfo() without a clientId");const i=r?`${e}backwardsCompat`:e;return this._userInfoRequestCache.cacheRequest(i,()=>(0,BE.waitForResult)(()=>xu(this,void 0,void 0,function*(){return yield this._host.getClientInfo(e)}),s=>(0,bo.isIClientInfo)(s)?{response:s}:null,s=>new Error(`LiveShareHostDecorator: getting client info for a remote client ID for reason: ${(0,bo.isErrorLike)(s)?s.message:"unknown"}`),r??UE,s=>e==="fakeId"?new Error((0,bo.isErrorLike)(s)?s.message:"an unknown error occurred"):null,t))})}registerClientId(e){return xu(this,void 0,void 0,function*(){return this._registerRequestCache.cacheRequest(e,()=>(0,BE.waitForResult)(()=>xu(this,void 0,void 0,function*(){return yield this._host.registerClientId(e)}),t=>(0,bo.isClientRolesResponse)(t)?{response:t}:(0,bo.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,t=>new Error(`LiveShareHostDecorator: registering local client ID for reason: ${(0,bo.isErrorLike)(t)?t.message:"unknown"}`),UE))})}}yf.LiveShareHostDecorator=BJ;var Sf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Cm=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Sf,"__esModule",{value:!0});Sf.BackwardsCompatibilityHostDecorator=void 0;const UJ=Fa,HJ=Da,_m=Ct,WJ=qe,WE=[100,200,200,400,600],VJ=5*60*1e3;class GJ extends UJ.BaseHostDecorator{constructor(e){super(e),this._host=e,this._userRolesRequestCache=new HJ.RequestCache(VJ),this._totalTries=4,this._getClientInfoTriesRemaining=this._totalTries,this._getClientInfoExists=!1,this._hasWarnedPolyfill=!1,this.warmupCheckGetClientInfoExists()}getClientRoles(e){return Cm(this,void 0,void 0,function*(){if(!e)throw new Error("BackwardsCompatibilityHostDecorator: called getClientInfo() without a clientId");return this._userRolesRequestCache.cacheRequest(e,()=>(0,WJ.waitForResult)(()=>Cm(this,void 0,void 0,function*(){return yield this._host.getClientRoles(e)}),t=>(0,_m.isClientRolesResponse)(t)?{response:t}:(0,_m.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,()=>new Error("BackwardsCompatibilityHostDecorator: timed out getting roles for a remote client ID"),WE))})}getClientInfo(e){return Cm(this,void 0,void 0,function*(){if(this._getClientInfoExists)return yield this._host.getClientInfo(e);if(this._getClientInfoTriesRemaining<=0){this._hasWarnedPolyfill||(console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: using getClientInfo polyfill"),this._hasWarnedPolyfill=!0);const r=yield this.getClientRoles(e);return{userId:e,displayName:void 0,roles:r??[]}}const t=this.getClientRoles(e);try{const r=yield this._host.getClientInfo(e,()=>{this._getClientInfoExists=!0},this.getRetrySchedule());return this._getClientInfoExists=!0,r}catch(r){if((0,_m.isErrorLike)(r)&&r.message.includes("timed out")){this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining<=0&&console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill");const i=yield t;return{userId:e,displayName:void 0,roles:i??[]}}}return this._getClientInfoExists=!0,console.log("BackwardsCompatibilityHostDecorator: error, retryingWithActual"),yield this.getClientInfo(e)})}warmupCheckGetClientInfoExists(){this._getClientInfoExists||this._host.getClientInfo("fakeId",()=>{this._getClientInfoExists=!0},[]).catch(e=>{e.message.includes("timed out")?(this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining>0?this.warmupCheckGetClientInfoExists():console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill")):this._getClientInfoExists=!0})}getRetrySchedule(){const e=this._totalTries-Math.max(0,this._getClientInfoTriesRemaining);return WE.slice(0,e)}}Sf.BackwardsCompatibilityHostDecorator=GJ;var Kc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Kc,"__esModule",{value:!0});Kc.Deferred=void 0;class KJ{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}get resolve(){return this._resolve}get reject(){return this._reject}}Kc.Deferred=KJ;var jk={};Object.defineProperty(jk,"__esModule",{value:!0});var nl={},VE;function JJ(){if(VE)return nl;VE=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=K&&K.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(nl,"__esModule",{value:!0}),nl.LiveObjectManager=void 0;const e=Ma,t=$a(),r=Un();let i=class extends e.TypedEventEmitter{constructor(o,a){super(),this._liveRuntime=o,this._containerRuntime=a,this.objectStoreMap=new Map,this.updateInterval=1e4}start(){this.startReceivingSignalUpdates()}stop(){this.stopReceivingSignalUpdates(),this.objectStoreMap.clear()}registerObject(o,a,l,c,u){return n(this,void 0,void 0,function*(){this._synchronizer||(this._synchronizer=new r.ContainerSynchronizer(a,this._containerRuntime,this._liveRuntime,this)),this._synchronizer.registerObject(o,c,u);const d={clientId:yield(0,r.waitUntilConnected)(a),timestamp:0,data:l,name:r.ObjectSynchronizerEvents.update};this.updateEventLocallyInStore(o,d)})}unregisterObject(o){this._synchronizer&&this._synchronizer.unregisterObject(o)}getLatestEventForObject(o){var a;return(a=this.getEventsForObject(o))===null||a===void 0?void 0:a[0]}getLatestEventForObjectClient(o,a){var l;return(l=this.objectStoreMap.get(o))===null||l===void 0?void 0:l.get(a)}getEventsForObject(o){var a;const l=this.objectStoreMap.get(o);if(l)return(a=[...l.values()])===null||a===void 0?void 0:a.sort((c,u)=>u.timestamp-c.timestamp)}sendEventForObject(o,a){return n(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const l=yield this._synchronizer.sendEventForObject(o,a);return this.updateEventLocallyInStore(o,l),l})}sendThrottledEventForObject(o,a){return n(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const l=yield this._synchronizer.sendThrottledEventForObject(o,a);return this.updateEventLocallyInStore(o,l),l})}clientIdDidChange(o,a){this.objectStoreMap.forEach(l=>{const c=l.get(o);c&&(l.set(a,c),l.delete(o))})}__dangerouslySetContainerRuntime(o){var a;this._containerRuntime!==o&&(this.stopReceivingSignalUpdates(),this._containerRuntime=o,this.startReceivingSignalUpdates(),(a=this._synchronizer)===null||a===void 0||a.__dangerouslySetContainerRuntime(o))}setAudience(o){this._audience=o}onReceivedSignal(o,a){var l;a||!o.clientId||!(0,r.isILiveEvent)(o.content)||typeof o.content.data!="object"||(this.dispatchUpdates(r.ObjectSynchronizerEvents.update,o.clientId,o.content.data,a),o.type===r.ObjectSynchronizerEvents.connect&&((l=this._synchronizer)===null||l===void 0||l.onSendBackgroundUpdates()))}dispatchUpdates(o,a,l,c){for(const u in l){const d=l[u],h={clientId:a,timestamp:d.timestamp,data:(0,r.cloneValue)(d.data),name:o};this.updateEventLocallyInStore(u,h)&&this.emit(r.ObjectSynchronizerEvents.update,u,(0,r.cloneValue)(h),c)}}updateEventLocallyInStore(o,a){let l=this.objectStoreMap.get(o);if(l){const c=l.get(a.clientId);if(c&&!t.LiveEvent.isNewer(c,a))return!1;l.set(a.clientId,a),c||this.emitJoined(o,a)}else l=new Map,l.set(a.clientId,a),this.objectStoreMap.set(o,l),this.emitJoined(o,a);return!0}emitJoined(o,a){this.emit("joined",{objectId:o,clientId:a.clientId,timestamp:a.timestamp})}startReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this.stopReceivingSignalUpdates(),this._onBoundReceivedSignalListener=this.onReceivedSignal.bind(this),this._containerRuntime.on("signal",this._onBoundReceivedSignalListener)}stopReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this._containerRuntime.off("signal",this._onBoundReceivedSignalListener)}};return nl.LiveObjectManager=i,nl}var rl={},il={},Dr={},GE;function uo(){if(GE)return Dr;GE=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.LiveDataObjectInitializeNotNeededError=Dr.LiveDataObjectNotInitializedError=Dr.UnexpectedError=void 0;const n=Un(),e=Bn;class t extends Error{constructor(o,a){super(`${o} - ${a}
Please report this issue at ${n.LiveShareReportIssueLink}.`)}static assert(o,a,l){if(!o)throw new t(a,l)}}Dr.UnexpectedError=t;class r extends Error{constructor(o,a,l){super(`${o} - not initialized prior to calling \`${a}()\`. \`initializeState\` is \`${l}\` but must equal \`succeeded\`.
To fix this error, ensure \`.initialize()\` has resolved before calling this function.`)}static assert(o,a,l){if(l!==e.LiveDataObjectInitializeState.succeeded)throw new r(o,a,l)}}Dr.LiveDataObjectNotInitializedError=r;class i extends Error{constructor(o,a){super(`${o} -  initialization is not needed. \`initializeState\` is \`${a}\` but must equal \`needed\`.
To fix this error, ensure you only call \`.initialize()\` when \`initializeState\` equals \`needed\`.`)}static assert(o,a){if(a!==e.LiveDataObjectInitializeState.needed)throw new i(o,a)}}return Dr.LiveDataObjectInitializeNotNeededError=i,Dr}var KE;function QJ(){if(KE)return il;KE=1;var n=K&&K.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(il,"__esModule",{value:!0}),il.ThrottledEventQueue=void 0;const e=Kc,t=Or,r=uo();let i=class{constructor(o,a=50){this._events={},this._containerSynchronizer=o,this._throttleIntervalMilli=a}sendWithQueue(o,a){return n(this,void 0,void 0,function*(){this._events[o]=a,this._hTimer||(this._deferred=new e.Deferred,this._hTimer=setTimeout(()=>n(this,void 0,void 0,function*(){var c,u;try{const d=yield this._containerSynchronizer.sendEventUpdates(this._events,t.ObjectSynchronizerEvents.update);r.UnexpectedError.assert(!!d,"ThrottledEventQueue","unable to send empty set of updates, which should not occur."),(c=this._deferred)===null||c===void 0||c.resolve(d)}catch(d){(u=this._deferred)===null||u===void 0||u.reject(d)}finally{this._events={},this._hTimer=void 0}}),this._throttleIntervalMilli)),r.UnexpectedError.assert(!!this._deferred,"ThrottledEventQueue","no deferred set, which should not occur.");const l=yield this._deferred.promise;return{clientId:l.clientId,timestamp:l.data[o].timestamp,name:l.name,data:l.data[o].data}})}};return il.ThrottledEventQueue=i,il}var JE;function XJ(){if(JE)return rl;JE=1;var n=K&&K.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(rl,"__esModule",{value:!0}),rl.ContainerSynchronizer=void 0;const e=QJ(),t=Or,r=qe;let i=class{constructor(o,a,l,c){this._runtime=o,this._containerRuntime=a,this._liveRuntime=l,this._objectStore=c,this._objects=new Map,this._throttledEventsQueue=new e.ThrottledEventQueue(this),this._connectedKeys=[],this._ddsBackgroundUpdateEnabled=new Set,this.startListeningForConnected()}registerObject(o,a,l){var c;if(this._objects.has(o))throw new Error(`LiveObjectSynchronizer: too many calls to registerObject() for object '${o}'`);this._connectedKeys.push(o),this._objects.set(o,a),this._runtime.clientId&&this._runtime.clientId!==this._connectSentForClientId&&this.onConnected(this._runtime.clientId),(c=this._objectStore.getEventsForObject(o))===null||c===void 0||c.forEach(u=>{this.onReceiveUpdate(o,u,u.clientId===this._runtime.clientId)}),l&&(this._ddsBackgroundUpdateEnabled.add(o),this._ddsBackgroundUpdateEnabled.size==1&&this.startBackgroundObjectUpdates())}unregisterObject(o){return this._objects.has(o)&&(this._objects.delete(o),this._connectedKeys=this._connectedKeys.filter(l=>l!=o),this._ddsBackgroundUpdateEnabled.has(o)&&(this._ddsBackgroundUpdateEnabled.delete(o),this._ddsBackgroundUpdateEnabled.size==0))?(this.stopBackgroundObjectUpdates(),!0):!1}onSendBackgroundUpdates(){return n(this,void 0,void 0,function*(){this._liveRuntime.canSendBackgroundUpdates&&(yield this.sendGroupEvent(this._connectedKeys.filter(o=>this._ddsBackgroundUpdateEnabled.has(o)),t.ObjectSynchronizerEvents.update).catch(o=>console.error(o)))})}sendEventForObject(o,a){return n(this,void 0,void 0,function*(){const l=this._objects.get(o);if(!l)throw new Error("ContainerSynchronizer.sendEventForObject(): cannot send an event for an object that is not registered");if(!(yield l.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");const u=yield this.sendEventUpdates({[o]:{data:a,timestamp:this._liveRuntime.getTimestamp()}},t.ObjectSynchronizerEvents.update);if(!u)throw new Error("Unable to send an event with empty updates");return{clientId:u.clientId,timestamp:u.data[o].timestamp,name:u.name,data:u.data[o].data}})}sendThrottledEventForObject(o,a){return n(this,void 0,void 0,function*(){const l=this._objects.get(o);if(!l)throw new Error("ContainerSynchronizer.sendThrottledEventForObject(): cannot send an event for an object that is not registered");if(!(yield l.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");return yield this._throttledEventsQueue.sendWithQueue(o,{data:a,timestamp:this._liveRuntime.getTimestamp()})})}sendEventUpdates(o,a){return n(this,void 0,void 0,function*(){if(Object.keys(o).length>0){const c={clientId:yield this.waitUntilConnected(),data:o,timestamp:a===t.ObjectSynchronizerEvents.connect?0:this._liveRuntime.getTimestamp(),name:a};return this._containerRuntime.submitSignal(a,c),c}})}__dangerouslySetContainerRuntime(o){this._containerRuntime!==o&&(this._containerRuntime=o)}onConnected(o){return n(this,void 0,void 0,function*(){if(o!==this._connectSentForClientId){this._connectSentForClientId&&this._objectStore.clientIdDidChange(this._connectSentForClientId,o),this._connectSentForClientId=o,this._liveRuntime.host.registerClientId(o).catch(a=>{console.error(a)});try{yield this.sendGroupEvent(this._connectedKeys,t.ObjectSynchronizerEvents.connect)}catch(a){console.error(`LiveObjectSynchronizer: error sending update - ${a.toString()}`)}}})}sendGroupEvent(o,a){return n(this,void 0,void 0,function*(){const l=[],c={},u=yield this.waitUntilConnected();for(let h=0;h<o.length;h++){const f=o[h];try{const p=this._objects.get(f);if(p&&(yield p.getLocalUserCanSend(a===t.ObjectSynchronizerEvents.connect))){const g=this._objectStore.getLatestEventForObjectClient(f,u);if(typeof g=="object"){c[f]={data:g.data,timestamp:p.shouldUpdateTimestampPeriodically?this._liveRuntime.getTimestamp():a===t.ObjectSynchronizerEvents.connect?0:g.timestamp};continue}}}catch(p){console.error(`LiveObjectSynchronizer: error getting an objects state - ${p.toString()}`)}l.push(f)}const d=Object.keys(c);return yield this.sendEventUpdates(c,a),{sent:d,skipped:l}})}onReceiveUpdate(o,a,l){return n(this,void 0,void 0,function*(){const c=this._objects.get(o);!c||!(yield c.updateState(a,a.clientId,l))||this._objectStore.updateEventLocallyInStore.bind(this._objectStore)(o,Object.assign(Object.assign({},a),{clientId:yield this.waitUntilConnected()}))})}waitUntilConnected(){return(0,r.waitUntilConnected)(this._runtime)}startListeningForConnected(){this._onBoundConnectedListener&&this.stopListeningForConnected(),this._onBoundConnectedListener=this.onConnected.bind(this),this._runtime.on("connected",this._onBoundConnectedListener)}stopListeningForConnected(){this._onBoundConnectedListener&&this._runtime.off("connected",this._onBoundConnectedListener)}startBackgroundObjectUpdates(){this.stopBackgroundObjectUpdates(),this._onReceiveObjectUpdateListener=this.onReceiveUpdate.bind(this),this._objectStore.on(t.ObjectSynchronizerEvents.update,this._onReceiveObjectUpdateListener),this._onSendUpdatesIntervalCallback=this.onSendBackgroundUpdates.bind(this),this._hTimer=setInterval(this._onSendUpdatesIntervalCallback,this._liveRuntime.objectManager.updateInterval)}stopBackgroundObjectUpdates(){this._hTimer&&(clearInterval(this._hTimer),this._hTimer=void 0,this._onSendUpdatesIntervalCallback=void 0),this._onReceiveObjectUpdateListener&&(this._objectStore.off("update",this._onReceiveObjectUpdateListener),this._onReceiveObjectUpdateListener=void 0)}};return rl.ContainerSynchronizer=i,rl}var bf={},YJ=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(bf,"__esModule",{value:!0});bf.FormatFixHostDecorator=void 0;const ZJ=Fa,qk=Ct;class eQ extends ZJ.BaseHostDecorator{getClientInfo(e){return YJ(this,void 0,void 0,function*(){const t=yield this._host.getClientInfo(e);if((0,qk.isIClientInfo)(e))return t;const r=tQ(t);return r||t})}}bf.FormatFixHostDecorator=eQ;function tQ(n){if(n instanceof Object){let e,t,r;if(Object.keys(n).map(i=>n[i]).forEach(i=>{(0,qk.isClientRolesResponse)(i)?t=i:nQ(i)?e=i:typeof i=="string"&&(r=i)}),e&&t)return{userId:e,roles:t,displayName:r}}}function nQ(n){return typeof n=="string"?/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/.test(n):!1}var QE;function Un(){return QE||(QE=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Or,n),t(rf,n),t(Da,n),t(sf,n),t(qe,n),t(yf,n),t(Sf,n),t(Kc,n),t(Ct,n),t(jk,n),t(JJ(),n),t(XJ(),n),t(bf,n)}(mm)),mm}var XE;function Bk(){if(XE)return tl;XE=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=K&&K.__awaiter||function(o,a,l,c){function u(d){return d instanceof l?d:new l(function(h){h(d)})}return new(l||(l=Promise))(function(d,h){function f(S){try{g(c.next(S))}catch(m){h(m)}}function p(S){try{g(c.throw(S))}catch(m){h(m)}}function g(S){S.done?d(S.value):u(S.value).then(f,p)}g((c=c.apply(o,a||[])).next())})},e=K&&K.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(tl,"__esModule",{value:!0}),tl.LiveEventScope=void 0;const t=e(ln),r=Ma,i=Un();let s=class extends r.TypedEventEmitter{constructor(a,l,c){super(),this._liveRuntime=l,this.emitter=new t.default,this.throwForEvents=[],this._runtime=a,this._allowedRoles=c||[],this.emitter.on("error",u=>{this.emit("error",u)}),this._runtime.on("signal",(u,d)=>{if(!u.clientId||!this._runtime.connected)return;const h=u.clientId;u.content.clientId=h,this.emitToListeners(h,u.content,d)})}get allowedRoles(){return this._allowedRoles}set allowedRoles(a){this._allowedRoles=a}get clientId(){return this._runtime.clientId}onEvent(a,l){return this.throwForEvents.push(a),this.emitter.on(a,l),this}offEvent(a,l){this.emitter.off(a,l);const c=this.throwForEvents.indexOf(a);return c>=0&&this.throwForEvents.splice(c,1),this}sendEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.createEvent(a,l);return this._runtime.submitSignal(a,c),c})}sendLocalEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.createEvent(a,l);return this.emitToListeners(c.clientId,c,!0),c})}createEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.waitUntilConnected();if(!(yield this._liveRuntime.verifyRolesAllowed(c,this._allowedRoles)))throw new Error(`The local user doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`);return{clientId:c,name:a,timestamp:this._liveRuntime.getTimestamp(),data:l}})}waitUntilConnected(){return(0,i.waitUntilConnected)(this._runtime)}emitToListeners(a,l,c){this._liveRuntime.verifyRolesAllowed(a,this._allowedRoles).then(u=>{u?this.emitter.emit(l.name,l,c):this.throwForEvents.includes(l.name)&&this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},new Error(`The clientId of "${a}" doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`))}).catch(u=>{this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},u)})}};return tl.LiveEventScope=s,tl}var Jc={},Qc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var YE=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Qc,"__esModule",{value:!0});Qc.LiveEventSource=void 0;class rQ{constructor(e,t){this._scope=e,this._eventName=t}sendEvent(e){return YE(this,void 0,void 0,function*(){return yield this._scope.sendEvent(this._eventName,e)})}sendLocalEvent(e){return YE(this,void 0,void 0,function*(){return yield this._scope.sendLocalEvent(this._eventName,e)})}}Qc.LiveEventSource=rQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Jc,"__esModule",{value:!0});Jc.LiveEventTarget=void 0;const iQ=Qc;class sQ extends iQ.LiveEventSource{constructor(e,t,r){super(e,t),e.onEvent(t,r)}}Jc.LiveEventTarget=sQ;var sl={},ZE;function za(){if(ZE)return sl;ZE=1;var n=K&&K.__awaiter||function(o,a,l,c){function u(d){return d instanceof l?d:new l(function(h){h(d)})}return new(l||(l=Promise))(function(d,h){function f(S){try{g(c.next(S))}catch(m){h(m)}}function p(S){try{g(c.throw(S))}catch(m){h(m)}}function g(S){S.done?d(S.value):u(S.value).then(f,p)}g((c=c.apply(o,a||[])).next())})};Object.defineProperty(sl,"__esModule",{value:!0}),sl.LiveDataObject=void 0;const e=Aa,t=Ma,r=Bn,i=Un();let s=class extends e.DataObject{get liveRuntime(){return(0,t.assert)(this._liveRuntime!==null,`LiveShareRuntime not initialized. Ensure your Fluid \`ContainerSchema\` was first wrapped inside of \`getLiveContainerSchema()\` before calling \`client.getContainer()\` / \`client.createContainer()\` from your \`AzureClient\` (or equivalent) instance.
Alternatively, you can use the \`.joinContainer()\` in \`LiveShareClient\`, which does this for you.
If you are using \`LiveShareClient\` and are still encountering this issue, please report this issue at ${i.LiveShareReportIssueLink}.`),this._liveRuntime}get isInitialized(){return this.initializeState===r.LiveDataObjectInitializeState.succeeded}get initializeState(){return this._initializeState}set initializeState(a){this._initializeState=a}constructor(a){super(a),this._initializeState=r.LiveDataObjectInitializeState.needed,this._allowedRoles=[],this._liveRuntime=null}getClientInfo(a){return this.liveRuntime.getClientInfo(a)}waitUntilConnected(){return(0,i.waitUntilConnected)(this.runtime)}verifyLocalUserRoles(){var a;return n(this,void 0,void 0,function*(){const l=yield this.waitUntilConnected();return this.liveRuntime.verifyRolesAllowed(l,(a=this._allowedRoles)!==null&&a!==void 0?a:[])})}__dangerouslySetLiveRuntime(a){this._liveRuntime=a}onLocalUserAllowed(a){return n(this,void 0,void 0,function*(){(yield this.verifyLocalUserRoles())&&a()})}};return s.LiveEnabled=!0,sl.LiveDataObject=s,sl}var e1;function $a(){return e1||(e1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(h,f,p,g){function S(m){return m instanceof p?m:new p(function(v){v(m)})}return new(p||(p=Promise))(function(m,v){function y(x){try{w(g.next(x))}catch(E){v(E)}}function b(x){try{w(g.throw(x))}catch(E){v(E)}}function w(x){x.done?m(x.value):S(x.value).then(y,b)}w((g=g.apply(h,f||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveEvent=n.LiveEventEvents=void 0;const t=Aa,r=Bn,i=Bk(),s=Jc,o=ui,a=za(),l=Un(),c=uo();var u;(function(h){h.received="received"})(u=n.LiveEventEvents||(n.LiveEventEvents={}));class d extends a.LiveDataObject{initialize(f){c.LiveDataObjectInitializeNotNeededError.assert("LiveEvent:initialize",this.initializeState),this.initializeState=r.LiveDataObjectInitializeState.pending,this._allowedRoles=f??[];const p=new i.LiveEventScope(this.runtime,this.liveRuntime,f);return this._eventTarget=new s.LiveEventTarget(p,"event",(g,S)=>{this.emit(u.received,(0,l.cloneValue)(g.data),S,g.clientId,g.timestamp)}),this.initializeState=r.LiveDataObjectInitializeState.succeeded,Promise.resolve()}send(f){return e(this,void 0,void 0,function*(){return c.LiveDataObjectNotInitializedError.assert("LiveEvent:send","send",this.initializeState),c.UnexpectedError.assert(!!this._eventTarget,"LiveEvent:send","`this._eventTarget` is undefined, implying there was an error during initialization that should not occur."),yield this._eventTarget.sendEvent(f)})}static isNewer(f,p,g=0){if(f){if(f.timestamp==p.timestamp){if((f.clientId||"").localeCompare(p.clientId||"")<=0)return!1}else if(f.timestamp>p.timestamp){if(f.timestamp-p.timestamp>g)return!1}else if(p.timestamp-f.timestamp<g)return!1}return!0}}d.TypeName="@microsoft/live-share:LiveEvent",d.factory=new t.DataObjectFactory(d.TypeName,d,[],{}),n.LiveEvent=d,o.DynamicObjectRegistry.registerObjectClass(d,d.TypeName)}(fm)),fm}var wf={},ja={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(ja,"__esModule",{value:!0});ja.TimeInterval=void 0;class oQ{constructor(e){this._value=e}get milliseconds(){return this._value}set milliseconds(e){this._value=e}get seconds(){return this._value/1e3}set seconds(e){this._value=Math.floor(e*1e3)}}ja.TimeInterval=oQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(wf,"__esModule",{value:!0});wf.LiveEventTimer=void 0;const aQ=ja;class lQ{constructor(e,t,r,i=!1){this._isRunning=!1,this._eventSource=e,this._createEvent=t,this._delay=new aQ.TimeInterval(r),this.repeat=i}get delay(){return this._delay.milliseconds}set delay(e){this._delay.milliseconds=e}get isRunning(){return this._isRunning}sendEvent(){const e=this._createEvent();return this._eventSource.sendEvent(e)}start(){this.stop(),this._isRunning=!0,this.delayedEmit(this.delay)}stop(){this._timer!=null&&(clearTimeout(this._timer),this._timer=void 0),this._isRunning=!1}delayedEmit(e){this._timer=setTimeout(()=>{this._timer=void 0;const t=new Date().getTime();if(this.sendEvent().catch(r=>{console.warn(r)}),this._isRunning&&this.repeat){const r=(new Date().getTime()-t)%this.delay;this.delayedEmit(this.delay-r)}},e)}}wf.LiveEventTimer=lQ;var CS={},Em={},ol={},t1;function cQ(){if(t1)return ol;t1=1,Object.defineProperty(ol,"__esModule",{value:!0}),ol.LivePresenceConnection=void 0;const n=Un(),e=$a(),t=Cf();let r=class{constructor(s,o,a,l){this._evt=s,this._isLocalConnection=o,this._expirationPeriod=a,this._liveRuntime=l}get isLocalConnection(){return this._isLocalConnection}get clientId(){return this._evt.clientId}get state(){return this.hasExpired()?t.PresenceState.offline:this._evt.data.state}get data(){return(0,n.cloneValue)(this._evt.data.data)}updateConnection(s){if(this._evt.clientId!==s.clientId)throw new Error("LivePresenceConnection.updateConnection called with event with different clientId");e.LiveEvent.isNewer(this._evt,s)&&(this._evt=s)}set expirationPeriod(s){this._expirationPeriod=s}hasExpired(){const o=this._liveRuntime.getTimestamp()-this._evt.timestamp;return!this._isLocalConnection&&o>this._expirationPeriod.milliseconds}};return ol.LivePresenceConnection=r,ol}var n1;function Cf(){return n1||(n1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresenceUser=n.PresenceState=void 0;const e=$a(),t=Un(),r=cQ();var i;(function(o){o.online="online",o.away="away",o.offline="offline"})(i=n.PresenceState||(n.PresenceState={}));class s{constructor(a,l,c,u,d){this._clientInfo=a,this._evt=l,this._expirationPeriod=c,this._liveRuntime=u,this._connections=new Map,this._isLocalUser=!1,this.updateClients(this._evt,d),this._lastUpdateTime=this._liveRuntime.getTimestamp()}get isLocalUser(){return this._isLocalUser}get userId(){return this._clientInfo.userId}get displayName(){return this._clientInfo.displayName}get state(){return this.hasExpired()?i.offline:this._evt.data.state}get data(){return(0,t.cloneValue)(this._evt.data.data)}get roles(){return this._clientInfo.roles}getConnections(a){const l=[];return this._connections.forEach(c=>{(a==null||c.state==a)&&l.push(c)}),l}getConnection(a){return this._connections.get(a)}isFromClient(a){return this._connections.get(a)!==void 0}updateReceived(a,l,c){const u=this.updateClients(a,c),d=this._evt,h=this._clientInfo;return e.LiveEvent.isNewer(d,a)?(this._evt=a,this._clientInfo=l,this._lastUpdateTime=this._liveRuntime.getTimestamp(),u||a.data.state!=d.data.state||JSON.stringify(l)!=JSON.stringify(h)||JSON.stringify(a.data.data)!=JSON.stringify(d.data.data)):u}set expirationPeriod(a){this._expirationPeriod=a,this._connections.forEach(l=>{l.expirationPeriod=a})}hasExpired(){const l=this._liveRuntime.getTimestamp()-this._lastUpdateTime;return!this._isLocalUser&&l>this._expirationPeriod.milliseconds}updateClients(a,l){const c=this._connections.get(a.clientId);return c?(c.updateConnection(a),!1):(this._connections.set(a.clientId,new r.LivePresenceConnection(a,l,this._expirationPeriod,this._liveRuntime)),l&&!this._isLocalUser?(this._isLocalUser=l,!0):!1)}}n.LivePresenceUser=s}(Em)),Em}var ho={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(ho,"__esModule",{value:!0});ho.LiveObjectSynchronizer=void 0;class uQ{constructor(e,t,r){this.id=e,this.runtime=t,this.liveRuntime=r,this._isDisposed=!1,this._joinedListener=()=>{}}start(e,t,r,i=!1,s=!0){return this.liveRuntime.objectManager.registerObject(this.id,this.runtime,e,{updateState:t,getLocalUserCanSend:r,shouldUpdateTimestampPeriodically:i},s)}dispose(){this._isDisposed||(this._isDisposed=!0,this.liveRuntime.objectManager.unregisterObject(this.id),this.liveRuntime.objectManager.off("joined",this._joinedListener))}getLatestEvent(){return this.liveRuntime.objectManager.getLatestEventForObject(this.id)}getLatestEventForClient(e){return this.liveRuntime.objectManager.getLatestEventForObjectClient(this.id,e)}getEvents(){return this.liveRuntime.objectManager.getEventsForObject(this.id)}sendEvent(e){return this.liveRuntime.objectManager.sendEventForObject(this.id,e)}sendThrottledEvent(e){return this.liveRuntime.objectManager.sendThrottledEventForObject(this.id,e)}set onJoinedListener(e){this.liveRuntime.objectManager.off("joined",this._joinedListener),this._joinedListener=e,this.liveRuntime.objectManager.on("joined",({objectId:t,clientId:r,timestamp:i})=>{t===this.id&&this._joinedListener(r,i)})}}ho.LiveObjectSynchronizer=uQ;var fo={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(fo,"__esModule",{value:!0});fo.LiveTelemetryLogger=void 0;class _S{constructor(e,t){this._liveRuntime=t,this._runtime=e}sendTelemetryEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendTelemetryEvent(i,t)}}sendErrorEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendErrorEvent(i,t)}}sendPerformanceEvent(e,t,r,i){if(this._runtime.logger){const s=Object.assign({duration:t},this.createTelemetryEvent(e,i));this._runtime.logger.sendPerformanceEvent(s,r)}}createTelemetryEvent(e,t){const r=this._liveRuntime.getTimestamp();return Object.assign({eventName:e,clientId:this._runtime.clientId,correlationId:_S.formatCorrelationId(this._runtime.clientId,r),timestamp:r},t)}static formatCorrelationId(e,t){return`${e}:${t}`}}fo.LiveTelemetryLogger=_S;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(p,g,S,m){function v(y){return y instanceof S?y:new S(function(b){b(y)})}return new(S||(S=Promise))(function(y,b){function w(P){try{E(m.next(P))}catch(M){b(M)}}function x(P){try{E(m.throw(P))}catch(M){b(M)}}function E(P){P.done?y(P.value):v(P.value).then(w,x)}E((m=m.apply(p,g||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresence=n.LivePresenceEvents=void 0;const t=Aa,r=Cf(),i=ho,s=fo,o=Un(),a=uo(),l=ja,c=ui,u=Bn,d=za();var h;(function(p){p.presenceChanged="presenceChanged"})(h=n.LivePresenceEvents||(n.LivePresenceEvents={}));class f extends d.LiveDataObject{constructor(){super(...arguments),this._expirationPeriod=new l.TimeInterval(2e4),this._users=[],this._lastEmitPresenceStateMap=new Map}get expirationPeriod(){return this._expirationPeriod.seconds}set expirationPeriod(g){this._expirationPeriod.seconds=g>.1?g:.1,this.getUsers().forEach(S=>{S.expirationPeriod=this._expirationPeriod})}get localUser(){var g;const S=(g=this._currentPresence)===null||g===void 0?void 0:g.clientId;if(S)return this.getUserForClient(S)}initialize(g,S=r.PresenceState.online,m){return e(this,void 0,void 0,function*(){a.LiveDataObjectInitializeNotNeededError.assert("LivePresence:initialize",this.initializeState),a.UnexpectedError.assert(!this._synchronizer,"LivePresence:initialize","_synchronizer already set, which is an unexpected error."),this.initializeState=u.LiveDataObjectInitializeState.pending,this._logger=new s.LiveTelemetryLogger(this.runtime,this.liveRuntime),this._allowedRoles=m||[],this._currentPresence={clientId:yield this.waitUntilConnected(),name:"UpdatePresence",timestamp:0,data:{state:S,data:g}},this._synchronizer=new i.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentPresence.data,(v,y,b)=>e(this,void 0,void 0,function*(){return yield this.updateMembersList(v,b),!1}),v=>e(this,void 0,void 0,function*(){if(v)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}),!0)}catch(v){throw this.initializeState=u.LiveDataObjectInitializeState.fatalError,v}this.initializeState=u.LiveDataObjectInitializeState.succeeded,yield this.updateInternal(this._currentPresence.data.data,this._currentPresence.data.state,!0,!0).catch(()=>{})})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}getUsers(g){return g?this._users.filter(S=>S.state==g):this._users}update(g,S){return e(this,void 0,void 0,function*(){return yield this.updateInternal(g,S)})}getUserForClient(g){return this._users.find(S=>S.isFromClient(g))}getUser(g){return this._users.find(S=>S.userId==g)}updateInternal(g,S,m=!1,v=!1){var y;return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LivePresence:updateInternal","update",this.initializeState),a.UnexpectedError.assert(!!this._synchronizer,"LivePresence:updateInternal","this._synchronizer is undefined, implying there was an error during initialization that should not occur."),a.UnexpectedError.assert(!!this._currentPresence,"LivePresence:updateInternal","this._currentPresence is undefined, implying there was an error during initialization that should not occur.");const b={state:S??this._currentPresence.data.state,data:(y=(0,o.cloneValue)(g))!==null&&y!==void 0?y:this._currentPresence.data.data};if(!v||this.liveRuntime.canSendBackgroundUpdates){const w=m?yield this._synchronizer.sendThrottledEvent(b):yield this._synchronizer.sendEvent(b);yield this.updateMembersList(w,!0)}else{const w={data:b,name:"",clientId:yield this.waitUntilConnected(),timestamp:1};yield this.updateMembersList(w,!0)}})}updateMembersList(g,S){var m;return e(this,void 0,void 0,function*(){try{if(!(yield this.liveRuntime.verifyRolesAllowed(g.clientId,this._allowedRoles)))return!1;S&&(this._currentPresence=g);const y=yield this.liveRuntime.getClientInfo(g.clientId);return y?this.useTransientParticipantWorkaround(y)?this.transientParticipantWorkaround(g,S,y):this.updateMembersListWithInfo(g,S,y):!1}catch(v){(m=this._logger)===null||m===void 0||m.sendErrorEvent(o.TelemetryEvents.LiveState.RoleVerificationError,v)}return!1})}useTransientParticipantWorkaround(g){const S={userId:g.userId,roles:[u.UserMeetingRole.guest],displayName:void 0};return JSON.stringify(g)===JSON.stringify(S)}transientParticipantWorkaround(g,S,m){const v=this._users.find(y=>y.userId===m.userId);if(v){const y={userId:v.userId,roles:v.roles,displayName:v.displayName};return this.updateMembersListWithInfo(g,S,y)}return this.updateMembersListWithInfo(g,S,m)}updateMembersListWithInfo(g,S,m){const v=x=>{var E,P;this._lastEmitPresenceStateMap.set(x.userId,x.state),this.emit(h.presenceChanged,x,S,g.clientId),S?(E=this._logger)===null||E===void 0||E.sendTelemetryEvent(o.TelemetryEvents.LivePresence.LocalPresenceChanged,null,{user:JSON.stringify(g)}):(P=this._logger)===null||P===void 0||P.sendTelemetryEvent(o.TelemetryEvents.LivePresence.RemotePresenceChanged,null,{user:JSON.stringify(g)})};let y=!1,b=!0;for(let x=0;x<this._users.length;x++){const E=this._users[x];m.userId===E.userId?(E.updateReceived(g,m,S)&&(v(E),y=!0),b=!1):this._lastEmitPresenceStateMap.get(E.userId)!==E.state&&(v(E),y=!0)}if(!b)return y;const w=new r.LivePresenceUser(m,g,this._expirationPeriod,this.liveRuntime,S);return this._users.push(w),v(w),!0}}f.TypeName="@microsoft/live-share:LivePresence",f.factory=new t.DataObjectFactory(f.TypeName,f,[],{}),n.LivePresence=f,c.DynamicObjectRegistry.registerObjectClass(f,f.TypeName)})(CS);var Uk={},ES={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(p,g,S,m){function v(y){return y instanceof S?y:new S(function(b){b(y)})}return new(S||(S=Promise))(function(y,b){function w(P){try{E(m.next(P))}catch(M){b(M)}}function x(P){try{E(m.throw(P))}catch(M){b(M)}}function E(P){P.done?y(P.value):v(P.value).then(w,x)}E((m=m.apply(p,g||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveState=n.LiveStateEvents=void 0;const t=Aa,r=Ma,i=Bn,s=Un(),o=uo(),a=fo,l=$a(),c=ho,u=ui,d=za();var h;(function(p){p.stateChanged="stateChanged"})(h=n.LiveStateEvents||(n.LiveStateEvents={}));class f extends d.LiveDataObject{get state(){return this.latestEvent.data}initialize(g,S){return e(this,void 0,void 0,function*(){o.LiveDataObjectInitializeNotNeededError.assert("LiveState:initialize",this.initializeState),o.UnexpectedError.assert(!this._synchronizer,"LiveState:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._logger=new a.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.latestEvent={clientId:"",name:"ChangeState",timestamp:0,data:g},this._allowedRoles=S||[],this._synchronizer=new c.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(g,(m,v,y)=>e(this,void 0,void 0,function*(){return yield this.onReceivedStateEvent(m,v,y)}),m=>e(this,void 0,void 0,function*(){if(m)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(m){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,m}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}set(g){return e(this,void 0,void 0,function*(){o.LiveDataObjectNotInitializedError.assert("LiveState:set","set",this.initializeState);const S=(0,s.cloneValue)(g),m=yield this._synchronizer.sendEvent(S);this.updateState(m,!0)})}get latestEvent(){return(0,r.assert)(this._latestEvent!==void 0,"LiveState is not initialized"),this._latestEvent}set latestEvent(g){this._latestEvent=g}onReceivedStateEvent(g,S,m){var v;return e(this,void 0,void 0,function*(){try{return!(yield this.liveRuntime.verifyRolesAllowed(S,this._allowedRoles))||!l.LiveEvent.isNewer(this.latestEvent,g)||JSON.stringify(this.latestEvent.data)===JSON.stringify(g.data)?!1:(this.updateState(g,m),!0)}catch(y){return(v=this._logger)===null||v===void 0||v.sendErrorEvent(s.TelemetryEvents.LiveState.RoleVerificationError,y),!1}})}updateState(g,S){var m;const v=this.latestEvent.data,y=g.data;this.latestEvent=g,this.emit(h.stateChanged,(0,s.cloneValue)(g.data),S,g.clientId,g.timestamp),(m=this._logger)===null||m===void 0||m.sendTelemetryEvent(s.TelemetryEvents.LiveState.StateChanged,null,{oldState:JSON.stringify(v),newState:JSON.stringify(y)})}}f.TypeName="@microsoft/live-share:LiveState",f.factory=new t.DataObjectFactory(f.TypeName,f,[],{}),n.LiveState=f,u.DynamicObjectRegistry.registerObjectClass(f,f.TypeName)})(ES);(function(n){var e=K&&K.__awaiter||function(S,m,v,y){function b(w){return w instanceof v?w:new v(function(x){x(w)})}return new(v||(v=Promise))(function(w,x){function E(F){try{M(y.next(F))}catch(G){x(G)}}function P(F){try{M(y.throw(F))}catch(G){x(G)}}function M(F){F.done?w(F.value):b(F.value).then(E,P)}M((y=y.apply(S,m||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveFollowMode=n.FollowModeType=n.LiveFollowModeEvents=void 0;const t=za(),r=ES,i=CS,s=Aa,o=Ma,a=Bn,l=fo,c=Cf(),u=ui,d=uo();(function(S){S.stateChanged="stateChanged",S.presenceChanged="presenceChanged"})(n.LiveFollowModeEvents||(n.LiveFollowModeEvents={}));var h;(function(S){S.local="local",S.activeFollowers="activeFollowers",S.activePresenter="activePresenter",S.followPresenter="followPresenter",S.suspendFollowPresenter="suspendFollowPresenter",S.followUser="followUser",S.suspendFollowUser="suspendFollowUser"})(h=n.FollowModeType||(n.FollowModeType={}));const f="@microsoft/live-share:LiveFollowMode:LiveState",p="@microsoft/live-share:LiveFollowMode:LivePresence";class g extends t.LiveDataObject{constructor(){super(...arguments),this._suspended=!1}get state(){const m=this.presence.localUser;if(!m||!m.data)return;const v=this.presentingUserIdState.state?this.presence.getUser(this.presentingUserIdState.state):void 0;if(v&&v.data){const w=this.getUsers(c.PresenceState.online).length-1;return v.isLocalUser?{value:v.data.stateValue,followingUserId:v.userId,type:h.activePresenter,otherUsersCount:w,isLocalValue:!0}:this._suspended?{value:m.data.stateValue,followingUserId:v.userId,type:h.suspendFollowPresenter,otherUsersCount:w-1,isLocalValue:!0}:{value:v.data.stateValue,followingUserId:v.userId,type:h.followPresenter,otherUsersCount:w-1,isLocalValue:!1}}const y=m.data.followingUserId?this.presence.getUser(m.data.followingUserId):void 0;if(y&&y.data){const w=this.getUserFollowers(y.userId,c.PresenceState.online).length-1;return this._suspended?{value:m.data.stateValue,followingUserId:y.userId,type:h.suspendFollowUser,otherUsersCount:w,isLocalValue:!0}:{value:y.data.stateValue,followingUserId:y.userId,type:h.followUser,otherUsersCount:w,isLocalValue:!1}}const b=this.getUserFollowers(m.userId,c.PresenceState.online).length;return b>0?{value:m.data.stateValue,followingUserId:m.userId,type:h.activeFollowers,otherUsersCount:b,isLocalValue:!0}:{value:m.data.stateValue,followingUserId:m.userId,type:h.local,otherUsersCount:this.getUserFollowers(m.userId,c.PresenceState.online).length,isLocalValue:!0}}get localUser(){return this.presence.localUser}get presentingUserIdState(){return d.UnexpectedError.assert(this._presentingUserIdState!==void 0,"LiveFollowMode:presentingUserIdState","This happens when `hasInitialized()` has not yet resolved, which should not happen."),this._presentingUserIdState}get presence(){return(0,o.assert)(this._presence!==void 0,"_presence not initialized"),this._presence}initialize(m,v){return e(this,void 0,void 0,function*(){d.LiveDataObjectInitializeNotNeededError.assert("LiveFollowMode:initialize",this.initializeState),this.initializeState=a.LiveDataObjectInitializeState.pending,this._logger=new l.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.presentingUserIdState.on("stateChanged",(y,b,w)=>{this._suspended=!1,this.handlePotentialStateChange(b,w)}),this.presence.on("presenceChanged",(y,b,w)=>{this.handlePotentialStateChange(b,w),this.emit("presenceChanged",y,b,w)});try{yield Promise.all([this.presentingUserIdState.initialize(void 0,v),this.presence.initialize({stateValue:m,followingUserId:void 0})])}catch(y){throw this.initializeState=a.LiveDataObjectInitializeState.fatalError,y}this.initializeState=a.LiveDataObjectInitializeState.succeeded})}update(m){var v;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:update","update",this.initializeState),d.UnexpectedError.assert(!!(!((v=this.presence.localUser)===null||v===void 0)&&v.data),"LiveFollowMode:update","invalid local user's current state value when calling `.update()`, implying there was an error during initialization that should not occur."),yield this.presence.update({stateValue:m,followingUserId:this.presence.localUser.data.followingUserId})})}startPresenting(){var m;return e(this,void 0,void 0,function*(){if(d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:startPresenting","startPresenting",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:startPresenting","invalid local user's current state value when calling `.startPresenting()`, implying there was an error during initialization that should not occur."),this.presence.localUser.userId===this.presentingUserIdState.state)throw new Error("LiveFollowMode:startPresenting - the local user is already the active presenter. To stop presenting, use the `.stopPresenting()` function.");yield this.presentingUserIdState.set(this.presence.localUser.userId)})}stopPresenting(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopPresenting","stopPresenting",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:stopPresenting","invalid local user's current state value when calling `.stopPresenting()`, implying there was an error during initialization that should not occur."),yield this.presentingUserIdState.set(void 0)})}beginSuspension(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:beginSuspension","beginSuspension",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:beginSuspension","invalid local user's current state value when calling `.beginSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!0,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}endSuspension(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:endSuspension","endSuspension",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:endSuspension","invalid local user's current state value when calling `.endSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!1,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}followUser(m){var v;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:followUser","followUser",this.initializeState),d.UnexpectedError.assert(!!(!((v=this.presence.localUser)===null||v===void 0)&&v.data),"LiveFollowMode:followUser","invalid local user's current state value when calling `.followUser()`, implying there was an error during initialization that should not occur.");const y=this.presence.getUser(m);if(!y)throw new Error(`LiveFollowMode:followUser - cannot find user for provided \`userId\` of ${m}. Ensure remote user for this userId has also called \`.initialize()\`.`);if(y.isLocalUser)throw new Error("LiveFollowMode:followUser - local user cannot follow themselves. If you are trying to stop following another user, instead use the `.stopFollowing()` function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:m})})}stopFollowing(){var m;return e(this,void 0,void 0,function*(){if(d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopFollowing","stopFollowing",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:stopFollowing","invalid local user's current state value when calling `.stopFollowing()`, implying there was an error during initialization that should not occur."),!this.presence.localUser.data.followingUserId)throw new Error("LiveFollowMode:stopFollowing - the local user is not following another user.\nTo fix this error, ensure that `.followUser()` has resolved before calling this function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:void 0})})}getUsers(m){return this.presence.getUsers(m)}getUser(m){return this.presence.getUser(m)}getUserForClient(m){return this.presence.getUserForClient(m)}getUserFollowers(m,v){return this.getUsers(v).filter(b=>{var w;return((w=b.data)===null||w===void 0?void 0:w.followingUserId)===m})}dispose(){super.dispose(),this.presence.dispose(),this.presentingUserIdState.dispose()}initializingFirstTime(){return e(this,void 0,void 0,function*(){const m=r.LiveState.factory.createChildInstance(this.context),v=i.LivePresence.factory.createChildInstance(this.context);try{const[y,b]=yield Promise.all([m,v]);this.root.set(f,y.handle),this.root.set(p,b.handle)}catch(y){console.log(y)}})}hasInitialized(){return e(this,void 0,void 0,function*(){const m=this.root.get(f),v=this.root.get(p),[y,b]=yield Promise.all([m==null?void 0:m.get(),v==null?void 0:v.get()]);y==null||y.__dangerouslySetLiveRuntime(this.liveRuntime),b==null||b.__dangerouslySetLiveRuntime(this.liveRuntime),this._presentingUserIdState=y,this._presence=b})}handlePotentialStateChange(m,v){const y=this.state;JSON.stringify(y)!==JSON.stringify(this._recentState)&&(this._recentState=y,this.emit("stateChanged",y,m,v))}}g.TypeName="@microsoft/live-share:LiveFollowMode",g.factory=new s.DataObjectFactory(g.TypeName,g,[],{},new Map([r.LiveState.factory.registryEntry,i.LivePresence.factory.registryEntry])),n.LiveFollowMode=g,u.DynamicObjectRegistry.registerObjectClass(g,g.TypeName)})(Uk);var _f={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Hk extends rk{createServiceMember(e){const t=e.user;return Kn((t==null?void 0:t.name)!==void 0,'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var kv;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(kv||(kv={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var nh;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(nh||(nh={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function vc(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ef(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const Wk=(n,e)=>Vk.from(n,e).buffer;function r1(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let Vk=class Cs extends Uint8Array{toString(e){return Ef(this,e)}static from(e,t,r){if(typeof e=="string")return Cs.fromString(e,t);if(e!==null&&typeof e=="object"&&r1(e.buffer))return vc(e.byteOffset===0,0),vc(e.byteLength===e.buffer.byteLength,1),Cs.fromArrayBuffer(e.buffer,t,r);if(r1(e))return Cs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Cs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new Cs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Cs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const dQ=n=>Vk.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hQ{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const fQ=2e3;class pQ{constructor(e,t,r,i){this.tenantId=e,this.id=t,this.deltaStorageService=r,this.documentStorageService=i,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,r,i,s){return i?d5:u5(this.getCore.bind(this),1,e,t,fQ,new hQ,r,s)}async getCore(e,t){const r=this.logtailSha?await at(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,r.length>0){const i=r.filter(s=>s.sequenceNumber>=e);if(i.length>0)return{messages:i,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)}}class mQ{constructor(e,t,r,i=async()=>this.restWrapper,s=()=>this.url){this.url=e,this.restWrapper=t,this.logger=r,this.getRestWrapper=i,this.getDeltaStorageUrl=s}async get(e,t,r,i){return{messages:await le.timedExecAsync(this.logger,{eventName:"getDeltas",from:r,to:i},async o=>{const a=await this.getRestWrapper(),l=this.getDeltaStorageUrl(),c=await a.get(l,{from:r-1,to:i});return o.end({count:c.length}),c}),partialResult:!1}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class wo extends Error{constructor(e,t,r,i,s){super(t),this.code=e,this.canRetry=r,this.isFatal=i,this.retryAfterMs=s,this.name="NetworkError",this.retryAfter=s!==void 0?s/1e3:void 0}get details(){return this.canRetry===void 0&&this.isFatal===void 0&&this.retryAfterMs===void 0?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function Tm(n,e){var t;let r,i,s,o;switch(e&&typeof e=="object"?(r=(t=e.message)!==null&&t!==void 0?t:"Unknown Error",i=e.canRetry,s=e.isFatal,o=e.retryAfter):e&&typeof e=="string"?r=e:r="Unknown Error",n){case 401:case 403:case 404:return new wo(n,r,!1,!1);case 413:case 422:return new wo(n,r,i??!1,s??!1,i?o:void 0);case 429:return new wo(n,r,!0,!1,o);case 500:return new wo(n,r,i??!0,s??!1,i?o:void 0);case 502:case 503:case 504:return new wo(n,r,!0,!1,o);default:return new wo(n,r,!1,!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const xm="x-correlation-id";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Li(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function TS(n,e){switch(e){case"base64":return ir(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const gQ=(n,e)=>Xn.from(n,e).buffer;function i1(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}class Xn extends Uint8Array{toString(e){return TS(this,e)}static from(e,t,r){if(typeof e=="string")return Xn.fromString(e,t);if(e!==null&&typeof e=="object"&&i1(e.buffer))return Li(e.byteOffset===0,0),Li(e.byteLength===e.buffer.byteLength,1),Xn.fromArrayBuffer(e.buffer,t,r);if(i1(e))return Xn.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Xn(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=di(r);return new Xn(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Xn(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}}async function vQ(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function yQ(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return ir(n)}}async function SQ(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return AO(()=>import("./hashFileNode-dabbecc3.js"),["assets/hashFileNode-dabbecc3.js","assets/sha256-c81de050.js"]).then(async i=>i.hashFile(n,e,t));const r=await vQ(n,e);return yQ(r,t)}async function bQ(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=Xn.from(t+n.toString());return SQ(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const wQ=n=>Xn.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Gk(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Nv;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Nv||(Nv={}));var Os;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Os||(Os={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ln;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Ln||(Ln={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const CQ="@fluidframework/server-services-client",_Q="0.1036.5002";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Is=jg.debug("fluid:services-client");Is(`Package: ${CQ} - Version: ${_Q}`);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class s1{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(e,t){const r=await this.historian.getHeader(t);for(const i of r.blobs)this.blobCache.set(i.sha,i);return g0(r.tree)}async getFullTree(e){return this.historian.getFullTree(e)}async getCommit(e){return this.commitCache.has(e)?(Is(`Cache hit on ${e}`),this.commitCache.get(e)):this.historian.getCommit(e)}async getCommits(e,t){let r=e;if(this.refCache.has(e)&&(Is(`Commit cache hit on ${e}`),r=this.refCache.get(e),this.refCache.delete(e),!r))return[];if(this.commitCache.has(r)){const i=this.commitCache.get(r);return[{commit:{author:i.author,committer:i.committer,message:i.message,tree:i.tree,url:i.url},parents:i.parents,sha:i.sha,url:i.url}]}return this.historian.getCommits(r,t)}async getTree(e,t=!0){return this.treeCache.has(e)?(Is(`Tree cache hit on ${e}`),this.treeCache.get(e)):this.historian.getTree(e,t)}async getBlob(e){return this.blobCache.has(e)?(Is(`Blob cache hit on ${e}`),this.blobCache.get(e)):this.historian.getBlob(e)}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}async getContent(e,t){return this.historian.getContent(t,e)}async createBlob(e,t){const r={content:e,encoding:t};return this.historian.createBlob(r)}async createGitTree(e){return this.historian.createTree(e)}async createTree(e){return this.createTreeCore(e,0)}async createCommit(e){return this.historian.createCommit(e)}async createSummary(e){return this.historian.createSummary(e)}async deleteSummary(e){return this.historian.deleteSummary(e)}async getSummary(e){return this.historian.getSummary(e)}async getRef(e){return this.historian.getRef(`heads/${e}`).catch(t=>{if(t===400||t===404)return null;throw t})}async createRef(e,t){const r={ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}};return this.historian.createRef(r)}async upsertRef(e,t){const r={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef(`heads/${e}`,r)}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}async write(e,t,r,i){const s=await this.createTree(t),o={author:{date:new Date().toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:r,tree:s.sha},a=await this.historian.createCommit(o);return await this.getRef(e)?await this.upsertRef(e,a.sha):await this.createRef(e,a.sha),a}async createTreeCore(e,t){if(e.id)return this.getTree(e.id);const r=[];for(const l of e.entries)switch(Os[l.type]){case Os.Blob:{const c=l.value;l.mode===Nv.Symlink&&(c.contents=this.translateSymlink(c.contents,t));const u=this.createBlob(c.contents,c.encoding);r.push(u);break}case Os.Tree:{const c=l.value,u=this.createTreeCore(c,t+1);r.push(u);break}default:throw new Error("Unknown entry type")}const i=await Promise.all(r),s=[];Li(i.length===e.entries.length,"File entries length is not correct");for(let l=0;l<e.entries.length;l++){const c=e.entries[l].type===Os.Tree?"tree":e.entries[l].type===Os.Blob?"blob":"commit";s.push({mode:e.entries[l].mode,path:e.entries[l].path,sha:i[l].sha,type:c})}const o={tree:s};return this.historian.createTree(o)}translateSymlink(e,t){let r="";for(let i=0;i<=t;i++)r+="../";return`${r}${e}`}}var al=function(n){switch(typeof n){case"string":return n;case"boolean":return n?"true":"false";case"number":return isFinite(n)?n:"";default:return""}},EQ=function(n,e,t,r){return e=e||"&",t=t||"=",n===null&&(n=void 0),typeof n=="object"?Object.keys(n).map(function(i){var s=encodeURIComponent(al(i))+t;return Array.isArray(n[i])?n[i].map(function(o){return s+encodeURIComponent(al(o))}).join(e):s+encodeURIComponent(al(n[i]))}).filter(Boolean).join(e):r?encodeURIComponent(al(r))+t+encodeURIComponent(al(n)):""},Kk;Kk=EQ;var Lv={exports:{}};(function(n,e){e=n.exports=t,e.getSerialize=r;function t(i,s,o,a){return JSON.stringify(i,r(s,a),o)}function r(i,s){var o=[],a=[];return s==null&&(s=function(l,c){return o[0]===c?"[Circular ~]":"[Circular ~."+a.slice(0,o.indexOf(c)).join(".")+"]"}),function(l,c){if(o.length>0){var u=o.indexOf(this);~u?o.splice(u+1):o.push(this),~u?a.splice(u,1/0,l):a.push(l),~o.indexOf(c)&&(c=s.call(this,l,c))}else o.push(c);return i==null?c:i.call(this,l,c)}}})(Lv,Lv.exports);var TQ=Lv.exports;const Iv=oi(TQ);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Jk{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=r,this.maxContentLength=i}async get(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(i,200)}async post(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(r)}`};return this.request(s,201)}async delete(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(i,204)}async patch(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(r)}`};return this.request(s,200)}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),r=Kk(t);if(r!=="")return`?${r}`}return""}}class xQ extends Jk{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024,s={},o=lR,a,l,c){super(e,t,r,i),this.defaultHeaders=s,this.axios=o,this.refreshDefaultQueryString=a,this.refreshDefaultHeaders=l,this.getCorrelationId=c}async request(e,t,r=!0){var i,s;const o=Object.assign({},e);return o.headers=this.generateHeaders(o.headers,(s=(i=this.getCorrelationId)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:Ze()),new Promise((a,l)=>{this.axios.request(o).then(c=>{a(c.data)}).catch(c=>{var u,d,h,f,p,g,S,m,v,y,b,w,x,E;if(((u=c==null?void 0:c.response)===null||u===void 0?void 0:u.status)===t&&a((d=c==null?void 0:c.response)===null||d===void 0?void 0:d.data),c!=null&&c.config?Is(`[${c.config.method}] request to [${(h=c.config.baseURL)!==null&&h!==void 0?h:""}${(f=c.config.url)!==null&&f!==void 0?f:""}] failed with [${(p=c.response)===null||p===void 0?void 0:p.status}] [${Iv((g=c.response)===null||g===void 0?void 0:g.data,void 0,2)}]`):Is(`request to ${o.url} failed ${c?c.message:""}`),((S=c==null?void 0:c.response)===null||S===void 0?void 0:S.status)===429&&((v=(m=c==null?void 0:c.response)===null||m===void 0?void 0:m.data)===null||v===void 0?void 0:v.retryAfter)>0&&r)setTimeout(()=>{this.request(o,t).then(a).catch(l)},c.response.data.retryAfter*1e3);else if(((y=c==null?void 0:c.response)===null||y===void 0?void 0:y.status)===401&&r&&this.refreshOnAuthError()){const P=Object.assign({},e);P.headers=this.generateHeaders(P.headers,o.headers[xm]),this.request(P,t,!1).then(a).catch(l)}else if(c!=null&&c.response)l(Tm((b=c==null?void 0:c.response)===null||b===void 0?void 0:b.status,(w=c==null?void 0:c.response)===null||w===void 0?void 0:w.data));else if(c!=null&&c.request)l(Tm(502,`Network Error: ${(x=c==null?void 0:c.message)!==null&&x!==void 0?x:"undefined"}`));else{const P={canRetry:!1,isFatal:!1,message:(E=c==null?void 0:c.message)!==null&&E!==void 0?E:"Unknown Error"};l(Tm(500,P))}})})}generateHeaders(e,t){let r=e??{};return this.defaultHeaders&&(r=Object.assign(Object.assign({},this.defaultHeaders),e)),r[xm]?r:Object.assign({[xm]:t},r)}refreshOnAuthError(){return this.refreshDefaultQueryString===void 0&&this.refreshDefaultHeaders===void 0?!1:(this.refreshDefaultHeaders!==void 0&&(this.defaultHeaders=this.refreshDefaultHeaders()),this.refreshDefaultQueryString!==void 0&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function OQ(n,e){for(const t of e)if(n.endsWith(t))return!0;return!1}const PQ=n=>`Basic ${wQ(`${n.user}:${n.password}`)}`;class o1{constructor(e,t,r,i){this.endpoint=e,this.historianApi=t,this.restWrapper=i,this.defaultQueryString={},r&&this.historianApi?(this.defaultQueryString.disableCache=r,this.cacheBust=!1):this.cacheBust=r,this.restWrapper===void 0&&(this.restWrapper=new xQ(this.endpoint))}async getHeader(e){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(e)}`,this.getQueryString()):this.getHeaderDirect(e)}async getFullTree(e){return this.restWrapper.get(`/tree/${encodeURIComponent(e)}`,this.getQueryString())}async getBlob(e){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,this.getQueryString())}async createBlob(e){return this.restWrapper.post("/git/blobs",e,this.getQueryString())}async getContent(e,t){return this.restWrapper.get(`/contents/${e}`,this.getQueryString({ref:t}))}async getCommits(e,t){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch(r=>r===400||r===404?[]:Promise.reject(r))}async getCommit(e){return this.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,this.getQueryString())}async createCommit(e){return this.restWrapper.post("/git/commits",e,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(e){return this.restWrapper.get(`/git/refs/${e}`,this.getQueryString())}async createRef(e){return this.restWrapper.post("/git/refs",e,this.getQueryString())}async updateRef(e,t){return this.restWrapper.patch(`/git/refs/${e}`,t,this.getQueryString())}async deleteRef(e){await this.restWrapper.delete(`/git/refs/${e}`,this.getQueryString())}async createTag(e){return this.restWrapper.post("/git/tags",e,this.getQueryString())}async getTag(e){return this.restWrapper.get(`/git/tags/${e}`,this.getQueryString())}async createTree(e){return this.restWrapper.post("/git/trees",e,this.getQueryString())}async getTree(e,t){return this.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,this.getQueryString({recursive:t?1:0}))}async createSummary(e){return this.restWrapper.post("/git/summaries",e,this.getQueryString())}async deleteSummary(e){const t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)}async getSummary(e){return this.restWrapper.get(`/git/summaries/${e}`,this.getQueryString())}async getHeaderDirect(e){const t=await this.getTree(e,!0),r=[".attributes",".blobs",".messages","header"],i=[];for(const o of t.tree)if(o.type==="blob"&&OQ(o.path,r)){const a=this.getBlob(o.sha);i.push(a)}return{blobs:await Promise.all(i),tree:t}}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Dl;(function(n){n.Method="method",n.Header="header",n.Body="body"})(Dl||(Dl={}));const RQ=(n,e)=>`${n}: ${e}`;class kQ{translate(e){var t,r;const i=Object.assign({},e),s=new URLSearchParams;if(s.append(Dl.Method,(t=i.method)!==null&&t!==void 0?t:"GET"),i.headers)for(const[o,a]of Object.entries(i.headers)){const l=RQ(o,a);s.append(Dl.Header,l)}if(i.data&&["post","put","patch"].includes((r=i.method)===null||r===void 0?void 0:r.toLowerCase())){const o=JSON.stringify(i.data);s.append(Dl.Body,o)}return i.data=s.toString(),i.method="POST",i.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},i}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Om=(...n)=>n.map(e=>e.replace(/^\//,"").replace(/\/$/,"")).filter(e=>!!e).join("/");function Qk(n,e,t="",r=""){const i={type:"tree",entries:[]},s=Object.keys(e.tree);for(const o of s){const a=e.tree[o];let l,c,u;const d=Om(t===""?r:t,o);switch(a.type){case Ln.Tree:{c=Qk(n,a,d,r),u=a.unreferenced||void 0;break}case Ln.Blob:{typeof a.content=="string"?c={type:"blob",content:a.content,encoding:"utf-8"}:c={type:"blob",content:TS(a.content,"base64"),encoding:"base64"};break}case Ln.Handle:{if(a.embedded)l=a.handle;else{if(!n)throw Error("Parent summary does not exist to reference by handle.");l=Om(n,r,a.handle)}break}case Ln.Attachment:{l=a.id;break}default:Gk(a,`Unknown type: ${a.type}`)}const h={path:encodeURIComponent(o),type:hP(a)};let f;if(c)Li(l===void 0,173),f=Object.assign({value:c,unreferenced:u},h);else if(l)f=Object.assign(Object.assign({},h),{id:l});else throw new Error(`Invalid tree entry for ${a.type}`);i.entries.push(f)}return i}function NQ(n,e){const t={},r={id:n.id,blobs:{},trees:{}};t[""]=r;for(const i of n.entries){const s=i.path.replace(new RegExp(`^${e}/`),""),o=s.lastIndexOf("/"),a=s.slice(0,Math.max(0,o)),l=s.slice(o+1),c=t[a];if(i.type==="tree"){const u={blobs:{},trees:{},unreferenced:i.unreferenced};c.trees[decodeURIComponent(l)]=u,t[s]=u}else if(i.type==="blob")c.blobs[decodeURIComponent(l)]=i.id;else throw new Error("Unknown entry type!!")}return r}function a1(n,e=".app"){var t;const r=new Map;n.blobs&&n.blobs.forEach(a=>{var l;r.set(a.id,gQ(a.content,(l=a.encoding)!==null&&l!==void 0?l:"utf-8"))});const i=(t=n.trees)===null||t===void 0?void 0:t[0],s=i==null?void 0:i.sequenceNumber,o=NQ(i,e);return{blobs:r,snapshotTree:o,sequenceNumber:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class LQ{constructor(e,t,r){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=r}async writeSummaryTree(e,t,r,i){const s=await this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,s??void 0)}async writeSummaryTreeCore(e,t){const r=await Promise.all(Object.keys(e.tree).map(async s=>{const o=e.tree[s],a=await this.writeSummaryTreeObject(o,t);return{mode:eH(o),path:encodeURIComponent(s),sha:a,type:hP(o)}}));return(await this.manager.createGitTree({tree:r})).sha}async writeSummaryTreeObject(e,t){switch(e.type){case Ln.Blob:return this.writeSummaryBlob(e.content);case Ln.Handle:{if(t===void 0)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t)}case Ln.Tree:return this.writeSummaryTreeCore(e,t);case Ln.Attachment:return e.id;default:Gk(e,`Unknown type: ${e.type}`)}}async writeSummaryBlob(e){const{parsedContent:t,encoding:r}=typeof e=="string"?{parsedContent:e,encoding:"utf-8"}:{parsedContent:TS(e,"base64"),encoding:"base64"},i=await bQ(Xn.from(t,r));if(!this.blobsShaCache.has(i)){this.blobsShaCache.set(i,"");const s=await this.manager.createBlob(t,r);Li(i===s.sha,182)}return i}getIdFromPath(e,t,r){const i=t.split("/").map(s=>decodeURIComponent(s));return i[0]===""&&i.shift(),i.length===0?r.id:this.getIdFromPathCore(e,i,r)}getIdFromPathCore(e,t,r){var i;Li(t.length>0,179);const s=t[0];if(t.length===1)switch(e){case Ln.Blob:{const o=r.blobs[s];return Li(!!o,180),o}case Ln.Tree:{const o=(i=r.trees[s])===null||i===void 0?void 0:i.id;return Li(!!o,181),o}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),r.trees[s])}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class IQ{constructor(e){this.manager=e}async writeSummaryTree(e,t,r,i){const s=await this.writeSummaryTreeCore(t,e,r,i??0);if(!s)throw new Error("Failed to write summary tree");return s}async writeSummaryTreeCore(e,t,r,i){const o={entries:Qk(e,t,"",r==="channel"?".app":"").entries,message:void 0,sequenceNumber:i,type:r};return this.manager.createSummary(o).then(a=>a.id)}}const Nr=Object.create(null);Nr.open="0";Nr.close="1";Nr.ping="2";Nr.pong="3";Nr.message="4";Nr.upgrade="5";Nr.noop="6";const Zu=Object.create(null);Object.keys(Nr).forEach(n=>{Zu[Nr[n]]=n});const Av={type:"error",data:"parser error"},Xk=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Yk=typeof ArrayBuffer=="function",Zk=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,xS=({type:n,data:e},t,r)=>Xk&&e instanceof Blob?t?r(e):l1(e,r):Yk&&(e instanceof ArrayBuffer||Zk(e))?t?r(e):l1(new Blob([e]),r):r(Nr[n]+(e||"")),l1=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function c1(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let Pm;function AQ(n,e){if(Xk&&n.data instanceof Blob)return n.data.arrayBuffer().then(c1).then(e);if(Yk&&(n.data instanceof ArrayBuffer||Zk(n.data)))return e(c1(n.data));xS(n,!1,t=>{Pm||(Pm=new TextEncoder),e(Pm.encode(t))})}const u1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ml=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<u1.length;n++)ml[u1.charCodeAt(n)]=n;const MQ=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,a,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(r=0;r<t;r+=4)s=ml[n.charCodeAt(r)],o=ml[n.charCodeAt(r+1)],a=ml[n.charCodeAt(r+2)],l=ml[n.charCodeAt(r+3)],u[i++]=s<<2|o>>4,u[i++]=(o&15)<<4|a>>2,u[i++]=(a&3)<<6|l&63;return c},DQ=typeof ArrayBuffer=="function",OS=(n,e)=>{if(typeof n!="string")return{type:"message",data:eN(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:FQ(n.substring(1),e)}:Zu[t]?n.length>1?{type:Zu[t],data:n.substring(1)}:{type:Zu[t]}:Av},FQ=(n,e)=>{if(DQ){const t=MQ(n);return eN(t,e)}else return{base64:!0,data:n}},eN=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},tN=String.fromCharCode(30),zQ=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,o)=>{xS(s,!1,a=>{r[o]=a,++i===t&&e(r.join(tN))})})},$Q=(n,e)=>{const t=n.split(tN),r=[];for(let i=0;i<t.length;i++){const s=OS(t[i],e);if(r.push(s),s.type==="error")break}return r};function jQ(){return new TransformStream({transform(n,e){AQ(n,t=>{const r=t.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let Rm;function Ou(n){return n.reduce((e,t)=>e+t.length,0)}function Pu(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)t[i]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function qQ(n,e){Rm||(Rm=new TextDecoder);const t=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(r===0){if(Ou(t)<1)break;const l=Pu(t,1);s=(l[0]&128)===128,i=l[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(Ou(t)<2)break;const l=Pu(t,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(Ou(t)<8)break;const l=Pu(t,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,53-32)-1){a.enqueue(Av);break}i=u*Math.pow(2,32)+c.getUint32(4),r=3}else{if(Ou(t)<i)break;const l=Pu(t,i);a.enqueue(OS(s?l:Rm.decode(l),e)),r=0}if(i===0||i>n){a.enqueue(Av);break}}}})}const nN=4;function rt(n){if(n)return BQ(n)}function BQ(n){for(var e in rt.prototype)n[e]=rt.prototype[e];return n}rt.prototype.on=rt.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};rt.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};rt.prototype.off=rt.prototype.removeListener=rt.prototype.removeAllListeners=rt.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};rt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};rt.prototype.emitReserved=rt.prototype.emit;rt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};rt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Tf=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),In=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),UQ="arraybuffer";function rN(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const HQ=In.setTimeout,WQ=In.clearTimeout;function xf(n,e){e.useNativeTimers?(n.setTimeoutFn=HQ.bind(In),n.clearTimeoutFn=WQ.bind(In)):(n.setTimeoutFn=In.setTimeout.bind(In),n.clearTimeoutFn=In.clearTimeout.bind(In))}const VQ=1.33;function GQ(n){return typeof n=="string"?KQ(n):Math.ceil((n.byteLength||n.size)*VQ)}function KQ(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function iN(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function JQ(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function QQ(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class XQ extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class PS extends rt{constructor(e){super(),this.writable=!1,xf(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new XQ(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=OS(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=JQ(e);return t.length?"?"+t:""}}class YQ extends PS{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};$Q(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,zQ(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=iN()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let sN=!1;try{sN=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ZQ=sN;function eX(){}class tX extends YQ{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Pr extends rt{constructor(e,t,r){super(),this.createRequest=e,xf(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=rN(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Pr.requestsCount++,Pr.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=eX,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Pr.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Pr.requestsCount=0;Pr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",d1);else if(typeof addEventListener=="function"){const n="onpagehide"in In?"pagehide":"unload";addEventListener(n,d1,!1)}}function d1(){for(let n in Pr.requests)Pr.requests.hasOwnProperty(n)&&Pr.requests[n].abort()}const nX=function(){const n=oN({xdomain:!1});return n&&n.responseType!==null}();class rX extends tX{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=nX&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Pr(oN,this.uri(),e)}}function oN(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ZQ))return new XMLHttpRequest}catch{}if(!e)try{return new In[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const aN=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class iX extends PS{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=aN?{}:rN(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;xS(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}i&&Tf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=iN()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const km=In.WebSocket||In.MozWebSocket;class sX extends iX{createSocket(e,t,r){return aN?new km(e,t,r):t?new km(e,t):new km(e)}doWrite(e,t){this.ws.send(t)}}class oX extends PS{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=qQ(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),i=jQ();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const s=()=>{r.read().then(({done:a,value:l})=>{a||(this.onPacket(l),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;this._writer.write(r).then(()=>{i&&Tf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const aX={websocket:sX,webtransport:oX,polling:rX},lX=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,cX=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Mv(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=lX.exec(n||""),s={},o=14;for(;o--;)s[cX[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=uX(s,s.path),s.queryKey=dX(s,s.query),s}function uX(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function dX(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}const Dv=typeof addEventListener=="function"&&typeof removeEventListener=="function",ed=[];Dv&&addEventListener("offline",()=>{ed.forEach(n=>n())},!1);class Ji extends rt{constructor(e,t){if(super(),this.binaryType=UQ,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=Mv(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=Mv(t.host).host);xf(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const i=r.prototype.name;this.transports.push(i),this._transportsByName[i]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=QQ(this.opts.query)),Dv&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ed.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=nN,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Ji.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Ji.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(t+=GQ(i)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Tf(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(Ji.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Dv&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=ed.indexOf(this._offlineEventListener);r!==-1&&ed.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Ji.protocol=nN;class hX extends Ji{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;Ji.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Ji.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=t.name,this.emitReserved("upgradeError",h)}}))};function s(){r||(r=!0,u(),t.close(),t=null)}const o=d=>{const h=new Error("probe error: "+d);h.transport=t.name,s(),this.emitReserved("upgradeError",h)};function a(){o("transport closed")}function l(){o("socket closed")}function c(d){t&&d.name!==t.name&&s()}const u=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let fX=class extends hX{constructor(e,t={}){const r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(i=>aX[i]).filter(i=>!!i)),super(e,r)}};function pX(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=Mv(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}const mX=typeof ArrayBuffer=="function",gX=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,lN=Object.prototype.toString,vX=typeof Blob=="function"||typeof Blob<"u"&&lN.call(Blob)==="[object BlobConstructor]",yX=typeof File=="function"||typeof File<"u"&&lN.call(File)==="[object FileConstructor]";function RS(n){return mX&&(n instanceof ArrayBuffer||gX(n))||vX&&n instanceof Blob||yX&&n instanceof File}function td(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(td(n[t]))return!0;return!1}if(RS(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return td(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&td(n[t]))return!0;return!1}function SX(n){const e=[],t=n.data,r=n;return r.data=Fv(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Fv(n,e){if(!n)return n;if(RS(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=Fv(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=Fv(n[r],e));return t}return n}function bX(n,e){return n.data=zv(n.data,e),delete n.attachments,n}function zv(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=zv(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=zv(n[t],e));return n}const wX=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],CX=5;var fe;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(fe||(fe={}));class _X{constructor(e){this.replacer=e}encode(e){return(e.type===fe.EVENT||e.type===fe.ACK)&&td(e)?this.encodeAsBinary({type:e.type===fe.EVENT?fe.BINARY_EVENT:fe.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===fe.BINARY_EVENT||e.type===fe.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=SX(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function h1(n){return Object.prototype.toString.call(n)==="[object Object]"}class kS extends rt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===fe.BINARY_EVENT;r||t.type===fe.BINARY_ACK?(t.type=r?fe.EVENT:fe.ACK,this.reconstructor=new EX(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(RS(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(fe[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===fe.BINARY_EVENT||r.type===fe.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(kS.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case fe.CONNECT:return h1(t);case fe.DISCONNECT:return t===void 0;case fe.CONNECT_ERROR:return typeof t=="string"||h1(t);case fe.EVENT:case fe.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&wX.indexOf(t[0])===-1);case fe.ACK:case fe.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class EX{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=bX(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const TX=Object.freeze(Object.defineProperty({__proto__:null,Decoder:kS,Encoder:_X,get PacketType(){return fe},protocol:CX},Symbol.toStringTag,{value:"Module"}));function Jn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const xX=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class cN extends rt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Jn(e,"open",this.onopen.bind(this)),Jn(e,"packet",this.onpacket.bind(this)),Jn(e,"error",this.onerror.bind(this)),Jn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,i,s;if(xX.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:fe.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const u=this.ids++,d=t.pop();this._registerAckCallback(u,d),o.id=u}const a=(i=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||i===void 0?void 0:i.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(s),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((r,i)=>{const s=(o,a)=>o?i(o):r(a);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:fe.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case fe.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case fe.EVENT:case fe.BINARY_EVENT:this.onevent(e);break;case fe.ACK:case fe.BINARY_ACK:this.onack(e);break;case fe.DISCONNECT:this.ondisconnect();break;case fe.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:fe.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:fe.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function qa(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}qa.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};qa.prototype.reset=function(){this.attempts=0};qa.prototype.setMin=function(n){this.ms=n};qa.prototype.setMax=function(n){this.max=n};qa.prototype.setJitter=function(n){this.jitter=n};class $v extends rt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,xf(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new qa({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||TX;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new fX(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Jn(t,"open",function(){r.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Jn(t,"error",s);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Jn(e,"ping",this.onping.bind(this)),Jn(e,"data",this.ondata.bind(this)),Jn(e,"error",this.onerror.bind(this)),Jn(e,"close",this.onclose.bind(this)),Jn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Tf(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new cN(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ll={};function nd(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=pX(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=ll[i]&&s in ll[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new $v(r,e):(ll[i]||(ll[i]=new $v(r,e)),l=ll[i]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(nd,{Manager:$v,Socket:cN,io:nd,connect:nd});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ba{constructor(){this.cache=new Map}async get(e){return this.cache.get(e)}async put(e,t){this.cache.set(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const f1="latest";class OX{constructor(e,t,r,i={},s,o=new ba,a=new ba,l,c=async u=>u&&this.noCacheGitManager!==void 0?this.noCacheGitManager:this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.driverPolicies=s,this.blobCache=o,this.snapshotTreeCache=a,this.noCacheGitManager=l,this.getStorageManager=c,this.firstVersionsCall=!0}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new IQ(e)}async getVersions(e,t){var r;if(e!==this.id&&e!==null)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&t===1){this.firstVersionsCall=!1;const{id:o,snapshotTree:a}=!((r=this.driverPolicies)===null||r===void 0)&&r.enableDiscovery?await this.fetchAndCacheSnapshotTree(f1,!0):await this.fetchAndCacheSnapshotTree(f1,!1);return[{id:o,treeId:a.id}]}const i=e||this.id;return(await le.timedExecAsync(this.logger,{eventName:"getVersions",versionId:i,count:t},async()=>(await this.getStorageManager()).getCommits(i,t))).map(o=>({date:o.commit.author.date,id:o.sha,treeId:o.commit.tree.sha}))}async getSnapshotTree(e){let t=e;if(!t){const r=await this.getVersions(this.id,1);if(r.length===0)return null;t=r[0]}return(await this.fetchAndCacheSnapshotTree(t.id)).snapshotTree}async readBlob(e){const t=await this.blobCache.get(this.getCacheKey(e));if(t!==void 0)return t;const r=await le.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async s=>{const a=await(await this.getStorageManager()).getBlob(e);return s.end({size:a.size}),a}),i=Wk(r.content,r.encoding);return await this.blobCache.put(this.getCacheKey(r.sha),i),i}async uploadSummaryWithContext(e,t){return await le.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){const t=await le.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},async s=>{var o;const l=await(await this.getStorageManager()).getSummary(e.handle);return s.end({size:(o=l.trees[0])===null||o===void 0?void 0:o.entries.length}),l}),{blobs:r,snapshotTree:i}=a1(t,"");return uR(i,r)}async createBlob(e){const t=new Uint8Array(e);return le.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Ef(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async fetchAndCacheSnapshotTree(e,t){const r=await this.snapshotTreeCache.get(this.getCacheKey(e));if(r!==void 0)return{id:r.id,snapshotTree:r.snapshotTree};const i=await le.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},async u=>{var d;const f=await(await this.getStorageManager(t)).getSummary(e);return u.end({size:(d=f.trees[0])===null||d===void 0?void 0:d.entries.length}),f}),s=a1(i),o=i.id,a=s.snapshotTree.id;vc(a!==void 0,629);const l={id:o,snapshotTree:s.snapshotTree},c=[this.snapshotTreeCache.put(this.getCacheKey(a),l),this.initBlobCache(s.blobs)];return a!==e&&c.push(this.snapshotTreeCache.put(this.getCacheKey(e),l)),await Promise.all(c),l}async initBlobCache(e){const t=[];e.forEach((r,i)=>{const s=this.getCacheKey(i);t.push(this.blobCache.put(s,r))}),await Promise.all(t)}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class PX{constructor(e,t){this.internalGitManager=e,this.logger=t}async getHeader(e,t){return this.runWithRetry(async()=>this.internalGitManager.getHeader(e,t),"gitManager_getHeader")}async getFullTree(e){return this.runWithRetry(async()=>this.internalGitManager.getFullTree(e),"gitManager_getFullTree")}async getCommit(e){return this.runWithRetry(async()=>this.internalGitManager.getCommit(e),"gitManager_getCommit")}async getCommits(e,t){return this.runWithRetry(async()=>this.internalGitManager.getCommits(e,t),"gitManager_getCommits")}async getTree(e,t){return this.runWithRetry(async()=>this.internalGitManager.getTree(e,t),"gitManager_getTree")}async getBlob(e){return this.runWithRetry(async()=>this.internalGitManager.getBlob(e),"gitManager_getBlob")}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}async getContent(e,t){return this.runWithRetry(async()=>this.internalGitManager.getContent(e,t),"gitManager_getContent")}async createBlob(e,t){return this.runWithRetry(async()=>this.internalGitManager.createBlob(e,t),"gitManager_createBlob")}async createGitTree(e){return this.runWithRetry(async()=>this.internalGitManager.createGitTree(e),"gitManager_createGitTree")}async createTree(e){return this.runWithRetry(async()=>this.internalGitManager.createTree(e),"gitManager_createTree")}async createCommit(e){return this.runWithRetry(async()=>this.internalGitManager.createCommit(e),"gitManager_createCommit")}async getRef(e){return this.runWithRetry(async()=>this.internalGitManager.getRef(e),"gitManager_getRef")}async createRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.createRef(e,t),"gitManager_createRef")}async upsertRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.upsertRef(e,t),"gitManager_upsertRef")}async write(e,t,r,i){return this.runWithRetry(async()=>this.internalGitManager.write(e,t,r,i),"gitManager_write")}async createSummary(e){return this.runWithRetry(async()=>this.internalGitManager.createSummary(e),"gitManager_createSummary")}async deleteSummary(e){return this.runWithRetry(async()=>this.internalGitManager.deleteSummary(e),"gitManager_deleteSummary")}async getSummary(e){return this.runWithRetry(async()=>this.internalGitManager.getSummary(e),"gitManager_getSummary")}async runWithRetry(e,t){return D0(e,t,this.logger,{})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const RX=typeof window>"u";class kX{constructor(e,t,r,i={},s,o,a,l=async()=>this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.getStorageManager=l,this.blobsShaCache=new Map,((s==null?void 0:s.enableRestLess)===!0||RX)&&(this.blobCache=o??new ba,this.snapshotTreeCache=a??new ba)}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new LQ(new PX(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}async getVersions(e,t){const r=e||this.id;return(await le.timedExecAsync(this.logger,{eventName:"getVersions",versionId:r,count:t},async()=>(await this.getStorageManager()).getCommits(r,t))).map(s=>({date:s.commit.author.date,id:s.sha,treeId:s.commit.tree.sha}))}async getSnapshotTree(e){var t,r;let i=e;if(!i){const l=await this.getVersions(this.id,1);if(l.length===0)return null;i=l[0]}const s=await((t=this.snapshotTreeCache)===null||t===void 0?void 0:t.get(this.getCacheKey(i.treeId)));if(s)return s.snapshotTree;const o=await le.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:i.treeId},async l=>{const u=await(await this.getStorageManager()).getTree(i.treeId);return l.end({size:u.tree.length}),u}),a=g0(o,this.blobsShaCache,!0);return await((r=this.snapshotTreeCache)===null||r===void 0?void 0:r.put(this.getCacheKey(a.id),{id:i.id,snapshotTree:a})),a}async readBlob(e){var t,r;const i=await((t=this.blobCache)===null||t===void 0?void 0:t.get(this.getCacheKey(e)));if(i)return i;const s=await le.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async a=>{const c=await(await this.getStorageManager()).getBlob(e);return a.end({size:c.size}),c});this.blobsShaCache.set(s.sha,"");const o=Wk(s.content,s.encoding);return await((r=this.blobCache)===null||r===void 0?void 0:r.put(this.getCacheKey(s.sha),o)),o}async uploadSummaryWithContext(e,t){return await le.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){throw new Error("NOT IMPLEMENTED!")}async createBlob(e){const t=new Uint8Array(e);return le.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Ef(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async getPreviousFullSnapshot(e){return e?this.getVersions(e,1).then(async t=>(this.blobsShaCache.clear(),this.getSnapshotTree(t[0]))):void 0}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class NS extends f0{constructor(e,t,r,i={},s,o,a,l,c){super(NS.loadInternalDocumentStorageService(e,t,r,i,s,o,a,l,c)),this.id=e,this.manager=t,this.noCacheGitManager=l,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,r,i,s,o,a,l,c){const u=s!=null&&s.enableWholeSummaryUpload?new OX(e,t,r,i,s,o,a,l,c):new kX(e,t,r,i,s,o,a,c);return!(s!=null&&s.enableWholeSummaryUpload)&&i.caching===fa.Prefetch?new h5(u):u}async getSnapshotTree(e){const t=await this.internalStorageService.getSnapshotTree(e);return t!==null&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function cn(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function NX(n){const e=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",t=(s,o)=>{const a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(e(n)){const{errorType:s,stack:o,name:a}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const l=typeof a=="string"?a:void 0;i.stack=t(o,l)}}return i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var jv;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(jv||(jv={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const p1="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Ii extends u0{constructor(e,t,r,i=!1){super((s,o)=>{r.sendErrorEvent({eventName:"DeltaConnection:EventException",name:s},o)}),this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=i,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(s,o)=>{this.queuedMessages.push(...o)},this.earlySignalHandler=s=>{this.queuedSignals.push(s)},this.mc=ka(ue.create(r,"DeltaConnection")),this.on("newListener",(s,o)=>{if(cn(!this.disposed,522),Ii.eventsAlwaysForwarded.includes(s)){cn(this.trackedListeners.has(s),581);return}if(!Ii.eventsToForward.includes(s))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${s}`);cn(this.listeners(s).length!==0===this.trackedListeners.has(s),523),this.trackedListeners.has(s)||this.addTrackedListener(s,(...a)=>{this.emit(s,...a)})})}get hasDetails(){return!!this._details}get disposed(){return cn(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){cn(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),cn(this.earlyOpHandlerAttached,142),cn(this.listeners("op").length!==0,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((e,t)=>e.sequenceNumber-t.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),cn(this.listeners("signal").length!==0,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submitCore(e,t){this.emitMessages(e,[t])}submit(e){this.checkNotClosed(),this.submitCore("submitOp",e)}submitSignal(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}dispose(){this.disposeCore(!1,va("Client closing delta connection",{canRetry:!0},{driverVersion:p1}))}disposeCore(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}disconnect(e,t){this.socket.disconnect()}async initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let r=0;const i=()=>this.socket.io.reconnection(),s=()=>i()?this.socket.io.reconnectionAttempts():0,o=()=>s()+1;this._details=await new Promise((a,l)=>{const c=(u,d)=>{this.disposeCore(u,d),l(d)};this.addConnectionListener("connect_error",u=>{var d;r++;let h=!1;try{const f=u==null?void 0:u.description;f&&typeof f=="object"&&(u.type==="TransportError"&&(h=!0),f.target=void 0)}catch{}h&&this.enableLongPollingDowngrades&&((d=this.socket.io.opts.transports)===null||d===void 0?void 0:d[0])!=="polling"&&(this.socket.io.opts.transports=["polling","websocket"],i()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),!(i()&&r<o())&&c(!0,this.createErrorObject("connect_error",u))}),this.addConnectionListener("connect_timeout",()=>{c(!0,this.createErrorObject("connect_timeout"))}),this.addConnectionListener("connect_document_success",u=>{if(e.nonce!==void 0&&u.nonce!==void 0&&u.nonce!==e.nonce)return;const d=e.mode,h=u.mode;if(u.claims.scopes.includes(jv.DocWrite)){if(h!==d){c(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1));return}}else if(h==="write"){c(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));return}this.checkpointSequenceNumber=u.checkpointSequenceNumber,this.removeConnectionListeners(),a(u)}),this.addTrackedListener("disconnect",u=>{const d=this.createErrorObject("disconnect",u);this.emit("disconnect",d),c(!0,d)}),this.addTrackedListener("error",u=>{const d=this.createErrorObject("error",u,u!=="Invalid namespace");this.emit("error",d),c(!0,d)}),this.addConnectionListener("connect_document_error",u=>{e.nonce!==void 0&&u.nonce!==void 0&&u.nonce!==e.nonce||c(!1,this.createErrorObject("connect_document_error",u))}),this.socket.emit("connect_document",e),this.socketConnectionTimeout=setTimeout(()=>{c(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))},t+2e3)}),cn(!this.disposed,582)}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(e,t){cn(!Ii.eventsAlwaysForwarded.includes(e),583),cn(!Ii.eventsToForward.includes(e),584),this.socket.on(e,t),cn(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),cn(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){this.socketConnectionTimeout!==void 0&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t,r=!0){let i;return(t==null?void 0:t.type)==="TransportError"?i=`${(t==null?void 0:t.message)!==void 0?`${t.message}: `:""}${JSON.stringify(t,U4())}`:i=NX(t).message,va(`socket.io (${e}): ${i}`,{canRetry:r},{driverVersion:p1})}}Ii.eventsToForward=["nack","op","signal","pong"];Ii.eventsAlwaysForwarded=["disconnect","error"];/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const Of="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var qv;(function(n){n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"})(qv||(qv={}));function uN(n,e,t){const r={statusCode:e,driverVersion:Of};switch(e){case void 0:return new rv(n,n.startsWith("NetworkError"),r);case 401:case 403:return new ZV(n,void 0,void 0,r);case 404:const i=qv.fileNotFoundOrAccessDeniedError;return new Uh(n,i,r);case 429:return va(n,{canRetry:!0,retryAfterMs:t},r);case 500:case 502:return new rv(n,!0,r);default:return va(n,{canRetry:t!==void 0,retryAfterMs:t},r)}}function m1(n,e,t){throw uN(n,e,t)}function LX(n,e){const t=`R11s socket error (${e}): ${n.message}`;return uN(t,n.code,n.retryAfterMs)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const IX=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class LS extends Ii{static async create(e,t,r,i,s,o,a,l=2e4){const c=i(o,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:l}),u={client:s,id:t,mode:s.mode,tenantId:e,token:r,versions:IX,relayUserAgent:[s.details.environment,` driverVersion:${Of}`].join(";")},d=!0,h=new LS(c,t,a,d);return await h.initialize(u,l),h}createErrorObject(e,t,r=!0){return r&&Number.isInteger(t==null?void 0:t.code)&&typeof(t==null?void 0:t.message)=="string"?LX(t,e):super.createErrorObject(e,t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class AX{get repositoryUrl(){throw new Error("Invalid operation")}async getSnapshotTree(e){return e?Promise.reject(new Error("Invalid operation")):null}async getVersions(e,t){return[]}async uploadSummaryWithContext(e,t){return Promise.reject(new Error("Invalid operation"))}async downloadSummary(e){return Promise.reject(new Error("Invalid operation"))}async createBlob(e){return Promise.reject(new Error("Null blob storage can not create blob"))}async readBlob(e){return Promise.reject(new Error("Null blob storage can not read blob"))}}var Bv={exports:{}};(function(n,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof s<"u"&&s||{},l={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function c(_){return _&&DataView.prototype.isPrototypeOf(_)}if(l.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(_){return _&&u.indexOf(Object.prototype.toString.call(_))>-1};function h(_){if(typeof _!="string"&&(_=String(_)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(_)||_==="")throw new TypeError('Invalid character in header field name: "'+_+'"');return _.toLowerCase()}function f(_){return typeof _!="string"&&(_=String(_)),_}function p(_){var N={next:function(){var W=_.shift();return{done:W===void 0,value:W}}};return l.iterable&&(N[Symbol.iterator]=function(){return N}),N}function g(_){this.map={},_ instanceof g?_.forEach(function(N,W){this.append(W,N)},this):Array.isArray(_)?_.forEach(function(N){if(N.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+N.length);this.append(N[0],N[1])},this):_&&Object.getOwnPropertyNames(_).forEach(function(N){this.append(N,_[N])},this)}g.prototype.append=function(_,N){_=h(_),N=f(N);var W=this.map[_];this.map[_]=W?W+", "+N:N},g.prototype.delete=function(_){delete this.map[h(_)]},g.prototype.get=function(_){return _=h(_),this.has(_)?this.map[_]:null},g.prototype.has=function(_){return this.map.hasOwnProperty(h(_))},g.prototype.set=function(_,N){this.map[h(_)]=f(N)},g.prototype.forEach=function(_,N){for(var W in this.map)this.map.hasOwnProperty(W)&&_.call(N,this.map[W],W,this)},g.prototype.keys=function(){var _=[];return this.forEach(function(N,W){_.push(W)}),p(_)},g.prototype.values=function(){var _=[];return this.forEach(function(N){_.push(N)}),p(_)},g.prototype.entries=function(){var _=[];return this.forEach(function(N,W){_.push([W,N])}),p(_)},l.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function S(_){if(!_._noBody){if(_.bodyUsed)return Promise.reject(new TypeError("Already read"));_.bodyUsed=!0}}function m(_){return new Promise(function(N,W){_.onload=function(){N(_.result)},_.onerror=function(){W(_.error)}})}function v(_){var N=new FileReader,W=m(N);return N.readAsArrayBuffer(_),W}function y(_){var N=new FileReader,W=m(N),A=/charset=([A-Za-z0-9_-]+)/.exec(_.type),B=A?A[1]:"utf-8";return N.readAsText(_,B),W}function b(_){for(var N=new Uint8Array(_),W=new Array(N.length),A=0;A<N.length;A++)W[A]=String.fromCharCode(N[A]);return W.join("")}function w(_){if(_.slice)return _.slice(0);var N=new Uint8Array(_.byteLength);return N.set(new Uint8Array(_)),N.buffer}function x(){return this.bodyUsed=!1,this._initBody=function(_){this.bodyUsed=this.bodyUsed,this._bodyInit=_,_?typeof _=="string"?this._bodyText=_:l.blob&&Blob.prototype.isPrototypeOf(_)?this._bodyBlob=_:l.formData&&FormData.prototype.isPrototypeOf(_)?this._bodyFormData=_:l.searchParams&&URLSearchParams.prototype.isPrototypeOf(_)?this._bodyText=_.toString():l.arrayBuffer&&l.blob&&c(_)?(this._bodyArrayBuffer=w(_.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):l.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(_)||d(_))?this._bodyArrayBuffer=w(_):this._bodyText=_=Object.prototype.toString.call(_):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof _=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):l.searchParams&&URLSearchParams.prototype.isPrototypeOf(_)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},l.blob&&(this.blob=function(){var _=S(this);if(_)return _;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var _=S(this);return _||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(l.blob)return this.blob().then(v);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var _=S(this);if(_)return _;if(this._bodyBlob)return y(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},l.formData&&(this.formData=function(){return this.text().then(F)}),this.json=function(){return this.text().then(JSON.parse)},this}var E=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function P(_){var N=_.toUpperCase();return E.indexOf(N)>-1?N:_}function M(_,N){if(!(this instanceof M))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');N=N||{};var W=N.body;if(_ instanceof M){if(_.bodyUsed)throw new TypeError("Already read");this.url=_.url,this.credentials=_.credentials,N.headers||(this.headers=new g(_.headers)),this.method=_.method,this.mode=_.mode,this.signal=_.signal,!W&&_._bodyInit!=null&&(W=_._bodyInit,_.bodyUsed=!0)}else this.url=String(_);if(this.credentials=N.credentials||this.credentials||"same-origin",(N.headers||!this.headers)&&(this.headers=new g(N.headers)),this.method=P(N.method||this.method||"GET"),this.mode=N.mode||this.mode||null,this.signal=N.signal||this.signal||function(){if("AbortController"in a){var k=new AbortController;return k.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&W)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(W),(this.method==="GET"||this.method==="HEAD")&&(N.cache==="no-store"||N.cache==="no-cache")){var A=/([?&])_=[^&]*/;if(A.test(this.url))this.url=this.url.replace(A,"$1_="+new Date().getTime());else{var B=/\?/;this.url+=(B.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}M.prototype.clone=function(){return new M(this,{body:this._bodyInit})};function F(_){var N=new FormData;return _.trim().split("&").forEach(function(W){if(W){var A=W.split("="),B=A.shift().replace(/\+/g," "),k=A.join("=").replace(/\+/g," ");N.append(decodeURIComponent(B),decodeURIComponent(k))}}),N}function G(_){var N=new g,W=_.replace(/\r?\n[\t ]+/g," ");return W.split("\r").map(function(A){return A.indexOf(`
`)===0?A.substr(1,A.length):A}).forEach(function(A){var B=A.split(":"),k=B.shift().trim();if(k){var $=B.join(":").trim();try{N.append(k,$)}catch(T){console.warn("Response "+T.message)}}}),N}x.call(M.prototype);function z(_,N){if(!(this instanceof z))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(N||(N={}),this.type="default",this.status=N.status===void 0?200:N.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=N.statusText===void 0?"":""+N.statusText,this.headers=new g(N.headers),this.url=N.url||"",this._initBody(_)}x.call(z.prototype),z.prototype.clone=function(){return new z(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},z.error=function(){var _=new z(null,{status:200,statusText:""});return _.ok=!1,_.status=0,_.type="error",_};var X=[301,302,303,307,308];z.redirect=function(_,N){if(X.indexOf(N)===-1)throw new RangeError("Invalid status code");return new z(null,{status:N,headers:{location:_}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(N,W){this.message=N,this.name=W;var A=Error(N);this.stack=A.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function V(_,N){return new Promise(function(W,A){var B=new M(_,N);if(B.signal&&B.signal.aborted)return A(new o.DOMException("Aborted","AbortError"));var k=new XMLHttpRequest;function $(){k.abort()}k.onload=function(){var C={statusText:k.statusText,headers:G(k.getAllResponseHeaders()||"")};B.url.indexOf("file://")===0&&(k.status<200||k.status>599)?C.status=200:C.status=k.status,C.url="responseURL"in k?k.responseURL:C.headers.get("X-Request-URL");var R="response"in k?k.response:k.responseText;setTimeout(function(){W(new z(R,C))},0)},k.onerror=function(){setTimeout(function(){A(new TypeError("Network request failed"))},0)},k.ontimeout=function(){setTimeout(function(){A(new TypeError("Network request timed out"))},0)},k.onabort=function(){setTimeout(function(){A(new o.DOMException("Aborted","AbortError"))},0)};function T(C){try{return C===""&&a.location.href?a.location.href:C}catch{return C}}if(k.open(B.method,T(B.url),!0),B.credentials==="include"?k.withCredentials=!0:B.credentials==="omit"&&(k.withCredentials=!1),"responseType"in k&&(l.blob?k.responseType="blob":l.arrayBuffer&&(k.responseType="arraybuffer")),N&&typeof N.headers=="object"&&!(N.headers instanceof g||a.Headers&&N.headers instanceof a.Headers)){var I=[];Object.getOwnPropertyNames(N.headers).forEach(function(C){I.push(h(C)),k.setRequestHeader(C,f(N.headers[C]))}),B.headers.forEach(function(C,R){I.indexOf(R)===-1&&k.setRequestHeader(R,C)})}else B.headers.forEach(function(C,R){k.setRequestHeader(R,C)});B.signal&&(B.signal.addEventListener("abort",$),k.onreadystatechange=function(){k.readyState===4&&B.signal.removeEventListener("abort",$)}),k.send(typeof B._bodyInit>"u"?null:B._bodyInit)})}return V.polyfill=!0,a.fetch||(a.fetch=V,a.Headers=g,a.Request=M,a.Response=z),o.Headers=g,o.Request=M,o.Response=z,o.fetch=V,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=t.fetch?t:r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(Bv,Bv.exports);var MX=Bv.exports;const DX=oi(MX),FX=n=>{var e,t;const r=n.baseURL!==void 0?`${n.baseURL}${(e=n.url)!==null&&e!==void 0?e:""}`:(t=n.url)!==null&&t!==void 0?t:"",i={method:n.method,headers:n.headers,body:n.data};return[r,i]};class dN extends Jk{constructor(e,t,r,i,s,o={}){super(s,o),this.rateLimiter=t,this.getAuthorizationHeader=r,this.useRestLess=i,this.restLess=new kQ}async load(){this.authorizationHeader=await this.getAuthorizationHeader()}async request(e,t,r=!0){var i;const s=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),o=this.useRestLess?this.restLess.translate(s):s,a=FX(o),l=await this.rateLimiter.schedule(async()=>DX(...a).catch(async d=>{const h=["TypeError","FetchError"].includes(d==null?void 0:d.name);m1(h?`NetworkError: ${d.message}`:Iv(d))})),c=!((i=l.headers.get("content-type"))===null||i===void 0)&&i.includes("application/json")?await l.json():await l.text();if(l.ok||l.status===t)return c;if(l.status===401&&r)return this.authorizationHeader=await this.getAuthorizationHeader(!0),this.request(s,t,!1);if(l.status===429&&(c==null?void 0:c.retryAfter)>0)return new Promise((d,h)=>setTimeout(()=>{this.request(s,t).then(d).catch(h)},c.retryAfter*1e3));const u=c!==void 0?typeof c=="string"?c:Iv(c):l.statusText;m1(`R11s fetch error: ${u}`,l.status,c==null?void 0:c.retryAfter)}generateHeaders(e){const t=(e==null?void 0:e["x-correlation-id"])||Ze();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":Of,Authorization:this.authorizationHeader})}}class IS extends dN{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,a){const l={token:`${dQ(e)}`},c=async d=>le.timedExecAsync(i,{eventName:"FetchStorageToken",docId:t},async()=>{const f={password:(await r.fetchStorageToken(e,t,d)).jwt,user:e};return PQ(f)}),u=new IS(i,s,c,o,a,l);try{await u.load()}catch(d){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},d),await u.load()}return u}}class yc extends dN{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,a){const l=async u=>le.timedExecAsync(i,{eventName:"FetchOrdererToken",docId:t},async()=>`Basic ${(await r.fetchOrdererToken(e,t,u)).jwt}`),c=new yc(i,s,l,o,a);try{await c.load()}catch(u){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},u),await c.load()}return c}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const zX=5*6e4;class $X{constructor(e,t,r,i,s,o,a,l,c,u,d,h){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=r,this.storageUrl=i,this.logger=s,this.tokenProvider=o,this.tenantId=a,this.documentId=l,this.driverPolicies=c,this.blobCache=u,this.snapshotTreeCache=d,this.discoverFluidResolvedUrl=h,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}async connectToStorage(){if(this.documentStorageService!==void 0)return this.documentStorageService;if(this.storageUrl===void 0)return new AX;const e=async s=>{const o=this.shouldUpdateDiscoveredSessionInfo();if(o&&await this.refreshDiscovery(),!this.storageManager||!this.noCacheStorageManager||o){const a=new Bd(this.driverPolicies.maxConcurrentStorageRequests),l=await IS.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,a,this.driverPolicies.enableRestLess,this.storageUrl),c=new o1(this.storageUrl,!0,!1,l);this.storageManager=new s1(c);const u=new o1(this.storageUrl,!0,!0,l);this.noCacheStorageManager=new s1(u)}return s?this.noCacheStorageManager:this.storageManager},t=await e(),r=await e(!0),i={caching:this.driverPolicies.enablePrefetch?fa.Prefetch:fa.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new NS(this.documentId,t,this.logger,i,this.driverPolicies,this.blobCache,this.snapshotTreeCache,r,e),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),vc(!!this.documentStorageService,177);const e=async()=>{const i=this.shouldUpdateDiscoveredSessionInfo();if(i&&await this.refreshDiscovery(),!this.ordererRestWrapper||i){const s=new Bd(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=await yc.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,s,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},t=await e(),r=new mQ(this.deltaStorageUrl,t,this.logger,e,()=>this.deltaStorageUrl);return new pQ(this.tenantId,this.documentId,r,this.documentStorageService)}async connectToDeltaStream(e){const t=async r=>{this.shouldUpdateDiscoveredSessionInfo()&&await this.refreshDiscovery();const i=await le.timedExecAsync(this.logger,{eventName:"GetDeltaStreamToken",docId:this.documentId,details:JSON.stringify({refreshToken:r})},async()=>this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,r));return le.timedExecAsync(this.logger,{eventName:"ConnectToDeltaStream",docId:this.documentId},async()=>LS.create(this.tenantId,this.documentId,i.jwt,nd,e,this.ordererUrl,this.logger))};try{return await t()}catch(r){if((r==null?void 0:r.statusCode)===401)return t(!0);throw r}}async refreshDiscovery(){return this.discoverP||(this.discoverP=le.timedExecAsync(this.logger,{eventName:"RefreshDiscovery"},async()=>this.refreshDiscoveryCore())),this.discoverP}async refreshDiscoveryCore(){const e=await this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const t=Date.now()-this.lastDiscoveredAt>zX;return t&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch(()=>{this.lastDiscoveredAt=0})),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fl;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Fl||(Fl={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function hN(n){const e=Object.keys(n.tree);for(const t of e){const r=n.tree[t];switch(r.type){case Fl.Tree:{n.tree[t]=hN(r);break}case Fl.Blob:{r.content=typeof r.content=="string"?r.content:Ef(r.content,"utf8");break}case Fl.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${r.type}`)}}return n}var jX=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},AS={},qX=Object.prototype.hasOwnProperty,BX;function g1(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function v1(n){try{return encodeURIComponent(n)}catch{return null}}function UX(n){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},r;r=e.exec(n);){var i=g1(r[1]),s=g1(r[2]);i===null||s===null||i in t||(t[i]=s)}return t}function HX(n,e){e=e||"";var t=[],r,i;typeof e!="string"&&(e="?");for(i in n)if(qX.call(n,i)){if(r=n[i],!r&&(r===null||r===BX||isNaN(r))&&(r=""),i=v1(i),r=v1(r),i===null||r===null)continue;t.push(i+"="+r)}return t.length?e+t.join("&"):""}AS.stringify=HX;AS.parse=UX;var fN=jX,Pf=AS,WX=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,pN=/[\n\r\t]/g,VX=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,mN=/:\d+$/,GX=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,KX=/^[a-zA-Z]:/;function MS(n){return(n||"").toString().replace(WX,"")}var Uv=[["#","hash"],["?","query"],function(e,t){return Rr(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],y1={hash:1,query:1};function gN(n){var e;typeof window<"u"?e=window:typeof globalThis<"u"?e=globalThis:typeof self<"u"?e=self:e={};var t=e.location||{};n=n||t;var r={},i=typeof n,s;if(n.protocol==="blob:")r=new Lr(unescape(n.pathname),{});else if(i==="string"){r=new Lr(n,{});for(s in y1)delete r[s]}else if(i==="object"){for(s in n)s in y1||(r[s]=n[s]);r.slashes===void 0&&(r.slashes=VX.test(n.href))}return r}function Rr(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function vN(n,e){n=MS(n),n=n.replace(pN,""),e=e||{};var t=GX.exec(n),r=t[1]?t[1].toLowerCase():"",i=!!t[2],s=!!t[3],o=0,a;return i?s?(a=t[2]+t[3]+t[4],o=t[2].length+t[3].length):(a=t[2]+t[4],o=t[2].length):s?(a=t[3]+t[4],o=t[3].length):a=t[4],r==="file:"?o>=2&&(a=a.slice(2)):Rr(r)?a=t[4]:r?i&&(a=a.slice(2)):o>=2&&Rr(e.protocol)&&(a=t[4]),{protocol:r,slashes:i||Rr(r),slashesCount:o,rest:a}}function JX(n,e){if(n==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(n.split("/")),r=t.length,i=t[r-1],s=!1,o=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),o++):o&&(r===0&&(s=!0),t.splice(r,1),o--);return s&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function Lr(n,e,t){if(n=MS(n),n=n.replace(pN,""),!(this instanceof Lr))return new Lr(n,e,t);var r,i,s,o,a,l,c=Uv.slice(),u=typeof e,d=this,h=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=Pf.parse),e=gN(e),i=vN(n||"",e),r=!i.protocol&&!i.slashes,d.slashes=i.slashes||r&&e.slashes,d.protocol=i.protocol||e.protocol||"",n=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||KX.test(n))||!i.slashes&&(i.protocol||i.slashesCount<2||!Rr(d.protocol)))&&(c[3]=[/(.*)/,"pathname"]);h<c.length;h++){if(o=c[h],typeof o=="function"){n=o(n,d);continue}s=o[0],l=o[1],s!==s?d[l]=n:typeof s=="string"?(a=s==="@"?n.lastIndexOf(s):n.indexOf(s),~a&&(typeof o[2]=="number"?(d[l]=n.slice(0,a),n=n.slice(a+o[2])):(d[l]=n.slice(a),n=n.slice(0,a)))):(a=s.exec(n))&&(d[l]=a[1],n=n.slice(0,a.index)),d[l]=d[l]||r&&o[3]&&e[l]||"",o[4]&&(d[l]=d[l].toLowerCase())}t&&(d.query=t(d.query)),r&&e.slashes&&d.pathname.charAt(0)!=="/"&&(d.pathname!==""||e.pathname!=="")&&(d.pathname=JX(d.pathname,e.pathname)),d.pathname.charAt(0)!=="/"&&Rr(d.protocol)&&(d.pathname="/"+d.pathname),fN(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.indexOf(":"),~a?(d.username=d.auth.slice(0,a),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(a+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin=d.protocol!=="file:"&&Rr(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function QX(n,e,t){var r=this;switch(n){case"query":typeof e=="string"&&e.length&&(e=(t||Pf.parse)(e)),r[n]=e;break;case"port":r[n]=e,fN(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[n]="");break;case"hostname":r[n]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[n]=e,mN.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(e){var i=n==="pathname"?"/":"#";r[n]=e.charAt(0)!==i?i+e:e}else r[n]=e;break;case"username":case"password":r[n]=encodeURIComponent(e);break;case"auth":var s=e.indexOf(":");~s?(r.username=e.slice(0,s),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(s+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var o=0;o<Uv.length;o++){var a=Uv[o];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&Rr(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function XX(n){(!n||typeof n!="function")&&(n=Pf.stringify);var e,t=this,r=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var s=i+(t.protocol&&t.slashes||Rr(t.protocol)?"//":"");return t.username?(s+=t.username,t.password&&(s+=":"+t.password),s+="@"):t.password?(s+=":"+t.password,s+="@"):t.protocol!=="file:"&&Rr(t.protocol)&&!r&&t.pathname!=="/"&&(s+="@"),(r[r.length-1]===":"||mN.test(t.hostname)&&!t.port)&&(r+=":"),s+=r+t.pathname,e=typeof t.query=="object"?n(t.query):t.query,e&&(s+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(s+=t.hash),s}Lr.prototype={set:QX,toString:XX};Lr.extractProtocol=vN;Lr.location=gN;Lr.trimLeft=MS;Lr.qs=Pf;var YX=Lr;const To=oi(YX);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const rd=n=>new To(n,!0),S1=(n,e)=>n.split("/").slice(0,-1).concat([e]).join("/"),b1=(n,e)=>{if(e){const t=new To(e.ordererUrl),r=new To(n.endpoints.deltaStorageUrl);r.set("host",t.host);const i=new To(e.historianUrl),s=new To(n.endpoints.storageUrl);s.set("host",i.host);const o=rd(n.url);return{endpoints:{deltaStorageUrl:r.toString(),ordererUrl:e.ordererUrl,storageUrl:s.toString()},id:n.id,tokens:n.tokens,type:n.type,url:new To(`fluid://${t.host}${o.pathname}`).toString()}}else return n};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const ZX={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class eY{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new ba,this.snapshotTreeCache=new ba,this.driverPolicies=Object.assign(Object.assign({},ZX),t)}async createContainer(e,t,r,i){if(kr(t),e===void 0)throw new Error("Empty file summary creation isn't supported in this driver.");vc(!!t.endpoints.ordererUrl,178);let s=rd(t.url);if(!s.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,o]=s.pathname.split("/"),a=e.tree[".protocol"],l=e.tree[".app"];if(!(a&&l))throw new Error("Protocol and App Summary required in the full summary");const c=r5(a),u=i5(a),d=ue.create(r,"RouterliciousDriver"),h=new Bd(this.driverPolicies.maxConcurrentOrdererRequests),f=await yc.load(o,void 0,this.tokenProvider,d,h,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl),p=await le.timedExecAsync(d,{eventName:"CreateNew",details:JSON.stringify({enableDiscovery:this.driverPolicies.enableDiscovery,sequenceNumber:c.sequenceNumber})},async b=>{const w=await f.post(`/documents/${o}`,{summary:hN(l),sequenceNumber:c.sequenceNumber,values:u,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:this.tokenProvider.documentPostCreateCallback!==void 0});return b.end({docId:typeof w=="string"?w:w.id}),w});let g,S,m;typeof p=="string"?g=p:(g=p.id,S=p.token,m=this.driverPolicies.enableDiscovery?p.session:void 0),s=rd(t.url);try{await le.timedExecAsync(d,{eventName:"DocPostCreateCallback",docId:g},async()=>{if(S&&this.tokenProvider.documentPostCreateCallback!==void 0)return this.tokenProvider.documentPostCreateCallback(g,S)})}catch(b){throw new tY(b)}s.set("pathname",S1(s.pathname,g));const v=t.endpoints.deltaStorageUrl;if(!v)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${v}]`);const y=new URL(v);return y.pathname=S1(y.pathname,g),this.createDocumentService(Object.assign(Object.assign({},t),{url:s.toString(),id:g,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:y.toString()})}),r,i,m)}async createDocumentService(e,t,r,i){kr(e);const s=rd(e.url),[,o,a]=s.pathname.split("/");if(!a||!o)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${a}][tenantId:${o}]`);const l=ue.create(t,"RouterliciousDriver",{all:{driverVersion:Of}}),c=async()=>{if(!this.driverPolicies.enableDiscovery)return e;const p=new Bd(this.driverPolicies.maxConcurrentOrdererRequests),g=await yc.load(o,a,this.tokenProvider,l,p,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl),S=await le.timedExecAsync(l,{eventName:"DiscoverSession",docId:a},async()=>g.get(`/documents/${o}/session/${a}`));return b1(e,S)},u=i!==void 0?b1(e,i):await c(),d=u.endpoints.storageUrl,h=u.endpoints.ordererUrl,f=u.endpoints.deltaStorageUrl;if(!h||!f)throw new Error(`All endpoints urls must be provided. [ordererUrl:${h}][deltaStorageUrl:${f}]`);return new $X(u,h,f,d,l,this.tokenProvider,o,a,this.driverPolicies,this.blobCache,this.snapshotTreeCache,c)}}class tY extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}class nY{constructor(){}async resolve(e){const{ordererUrl:t,storageUrl:r,tenantId:i,containerId:s}=rY(e.url);if(e.headers&&e.headers[pa.createNew]===!0)return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/new`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:"",tokens:{},type:"fluid",url:`${t}/${i}/new`};if(s===void 0)throw new Error("Azure URL did not contain containerId");const o=`${t}/${i}/${s}`;return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/${s}`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:s,tokens:{},type:"fluid",url:o}}async getAbsoluteUrl(e,t){if(e.type!=="fluid")throw new Error("Invalid Resolved Url");return`${e.url}/${t}`}}function rY(n){const e=new URL(n),t=e.origin,r=e.searchParams,i=r.get("storage");if(i===null)throw new Error("Azure URL did not contain a storage URL");const s=r.get("tenantId");if(s===null)throw new Error("Azure URL did not contain a tenant ID");const o=decodeURIComponent(i),a=decodeURIComponent(s),l=r.get("containerId"),c=l!==null?decodeURIComponent(l):void 0;return{ordererUrl:t,storageUrl:o,tenantId:a,containerId:c}}const iY=(n,e)=>{const t=new URL(n);return t.searchParams.append("storage",encodeURIComponent(n)),t.searchParams.append("tenantId",encodeURIComponent(e)),{url:t.href,headers:{[pa.createNew]:!0}}};function yN(n){return n.type==="remote"}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const sY="local",Ru=n=>yN(n)?n.tenantId:sY,oY=5;class aY{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new nY;const t=yN(this.props.connection);this.documentServiceFactory=new eY(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}async createContainer(e){const r=await this.createLoader(e).createDetachedContainer({package:"no-dynamic-package",config:{}}),i=await this.createFluidContainer(r,this.props.connection),s=this.getContainerServices(r);return{container:i,services:s}}async copyContainer(e,t,r){var i;const s=this.createLoader(t),o=new URL(this.props.connection.endpoint);o.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),o.searchParams.append("tenantId",encodeURIComponent(Ru(this.props.connection))),o.searchParams.append("containerId",encodeURIComponent(e));const a=await s.resolve({url:o.href});if(a.resolvedUrl===void 0)throw new Error("Source container cannot resolve URL.");const c=await(await this.documentServiceFactory.createDocumentService(a.resolvedUrl)).connectToStorage(),u={type:nh.Handle,handleType:nh.Tree,handle:(i=r==null?void 0:r.id)!==null&&i!==void 0?i:"latest"},d=await c.downloadSummary(u),h=await s.rehydrateDetachedContainerFromSnapshot(JSON.stringify(d)),f=await this.createFluidContainer(h,this.props.connection),p=this.getContainerServices(h);return{container:f,services:p}}async getContainer(e,t){const r=this.createLoader(t),i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Ru(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await r.resolve({url:i.href}),o=await lc(s,"/"),a=new uv(s,o),l=this.getContainerServices(s);return{container:a,services:l}}async getContainerVersions(e,t){var r;const i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Ru(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await this.urlResolver.resolve({url:i.href});if(!s)throw new Error("Unable to resolved URL");return(await(await(await this.documentServiceFactory.createDocumentService(s)).connectToStorage()).getVersions(null,(r=t==null?void 0:t.maxCount)!==null&&r!==void 0?r:oY)).map(c=>({id:c.id,date:c.date}))}getContainerServices(e){return{audience:new Hk(e)}}createLoader(e){const t=new nk(e),i={load:async()=>({module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}})},s={details:{capabilities:{interactive:!0}},permission:[],scopes:[],user:{id:""},mode:"write"};return new P5({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:i,logger:this.props.logger,options:{client:s}})}async createFluidContainer(e,t){const r=iY(t.endpoint,Ru(t)),i=await lc(e,"/"),s=async()=>{if(e.attachState!==Z.Detached)throw new Error("Cannot attach container. Container is not in detached state");await e.attach(r);const a=e.resolvedUrl;return kr(a),a.id},o=new uv(e,i);return o.attach=s,o}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class lY{constructor(e,t){this.azFunctionUrl=e,this.user=t}async fetchOrdererToken(e,t){return{jwt:await this.getToken(e,t)}}async fetchStorageToken(e,t){return{jwt:await this.getToken(e,t)}}async getToken(e,t){var r,i,s;return(await lR.get(this.azFunctionUrl,{params:{tenantId:e,documentId:t,userId:(r=this.user)===null||r===void 0?void 0:r.userId,userName:(i=this.user)===null||i===void 0?void 0:i.userName,additionalDetails:(s=this.user)===null||s===void 0?void 0:s.additionalDetails}})).data}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const cY=Object.freeze(Object.defineProperty({__proto__:null,AzureAudience:Hk,AzureClient:aY,AzureFunctionTokenProvider:lY,get ScopeType(){return kv}},Symbol.toStringTag,{value:"Module"})),uY=Sc(cY);var Xc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Xc,"__esModule",{value:!0});Xc.LocalTimestampProvider=void 0;class na{constructor(e=!1){this._lastTimeSent=0,e&&(na._warned=!0)}getTimestamp(){return na._warned||(console.warn("LiveEvent is using a LocalTimestampProvider which could cause issues when used across multiple clients."),na._warned=!0),this._lastTimeSent=Math.max(new Date().getTime(),this._lastTimeSent+1)}getMaxTimestampError(){return 0}}na._warned=!1;Xc.LocalTimestampProvider=na;var Yc={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var w1=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Yc,"__esModule",{value:!0});Yc.TestLiveShareHost=void 0;const Fr=Bn;class Hr{static create(e,t){return new Hr(e,t)}constructor(e,t){this._getLocalTestContainerId=e,this._setLocalTestContainerId=t,this.roleCache=new Map,this.defaultRemoteRoles=[Fr.UserMeetingRole.organizer,Fr.UserMeetingRole.presenter,Fr.UserMeetingRole.attendee],this.defaultLocalRoles=[Fr.UserMeetingRole.organizer,Fr.UserMeetingRole.presenter,Fr.UserMeetingRole.attendee]}getFluidTenantInfo(){return Hr.ensureWarned(),Promise.resolve({tenantId:"local",serviceEndpoint:"http://localhost:7070"})}getFluidToken(e){return Promise.resolve(Hr.LOCAL_MODE_TEST_TOKEN)}getFluidContainerId(){const e=this.getLocalTestContainerId();return Promise.resolve({containerState:e?Fr.ContainerState.alreadyExists:Fr.ContainerState.notFound,shouldCreate:!e,containerId:e,retryAfter:0})}setFluidContainerId(e){return this.setLocalTestContainerId(e),Promise.resolve({containerState:Fr.ContainerState.added,containerId:e,shouldCreate:!1,retryAfter:0})}getNtpTime(){const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})}registerClientId(e){if(this.roleCache.has(e))throw new Error("Already registered clientId");return this.addClient(e,this.defaultLocalRoles),Promise.resolve(this.defaultLocalRoles)}addClient(e,t){return this.roleCache.set(e,t),this}getClientInfo(e){return w1(this,void 0,void 0,function*(){const t={userId:e,roles:yield this.getClientRoles(e),displayName:e.substring(0,4)};return Promise.resolve(t)})}getClientRoles(e){return w1(this,void 0,void 0,function*(){if(!e)throw new Error("TestLiveShareHost: called getClientRoles() without a clientId");let t;return this.roleCache.has(e)?t=this.roleCache.get(e):t=this.defaultRemoteRoles,Promise.resolve(t)})}getLocalTestContainerId(){return this._getLocalTestContainerId?this._getLocalTestContainerId():window.location.hash?window.location.hash.substring(1):void 0}setLocalTestContainerId(e){this._setLocalTestContainerId?this._setLocalTestContainerId(e):window.location.hash=e}static ensureWarned(){Hr._warned||(console.warn("TestLiveShareHost is being used. This should only be used for local testing purposes."),Hr._warned=!0)}}Hr.LOCAL_MODE_TEST_TOKEN="test-token";Hr._warned=!1;Yc.TestLiveShareHost=Hr;var Zc={},dY=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Zc,"__esModule",{value:!0});Zc.LiveShareRuntime=void 0;const hY=Ma,Nm=Wc,Wn=Un();class fY{constructor(e,t,r=!0){var i,s,o;this._started=!1,this._objectManager=null,this._host=r?new Wn.BackwardsCompatibilityHostDecorator(new Wn.LiveShareHostDecorator(new Wn.FormatFixHostDecorator(e))):e,this._timestampProvider=(i=t==null?void 0:t.timestampProvider)!==null&&i!==void 0?i:new Nm.HostTimestampProvider(this._host),this._roleVerifier=(s=t==null?void 0:t.roleVerifier)!==null&&s!==void 0?s:new Wn.RoleVerifier(this._host),this._canSendBackgroundUpdates=(o=t==null?void 0:t.canSendBackgroundUpdates)!==null&&o!==void 0?o:!0}get objectManager(){return(0,hY.assert)(this._objectManager!==null,"LiveObjectSynchronizerManager not initialized."),this._objectManager}get timestampProvider(){return this._timestampProvider}get host(){return this._host}get canSendBackgroundUpdates(){return this._canSendBackgroundUpdates}set canSendBackgroundUpdates(e){this._canSendBackgroundUpdates=e}getTimestamp(){return this._timestampProvider.getTimestamp()}verifyRolesAllowed(e,t){return this._roleVerifier.verifyRolesAllowed(e,t)}getClientInfo(e){return this._host.getClientInfo(e)}setTimestampProvider(e){this._timestampProvider=e}setRoleVerifier(e){this._roleVerifier=e}setHost(e,t=!0){this._host=t?new Wn.BackwardsCompatibilityHostDecorator(new Wn.LiveShareHostDecorator(e)):e,this._timestampProvider instanceof Nm.HostTimestampProvider&&(this._timestampProvider.stop(),this.setTimestampProvider(new Nm.HostTimestampProvider(this._host))),this._roleVerifier instanceof Wn.RoleVerifier&&this.setRoleVerifier(new Wn.RoleVerifier(this._host))}setAudience(e){var t;this._audience=e,(t=this._objectManager)===null||t===void 0||t.setAudience(this._audience)}start(){return dY(this,void 0,void 0,function*(){if(this._started)throw new Error("LiveShareRuntime.start(): cannot call start when already started");this._started=!0,this._objectManager&&this.startObjectSynchronizerManager(),(0,Wn.isTimestampProvider)(this._timestampProvider)&&!this._timestampProvider.isRunning&&(yield this._timestampProvider.start())})}stop(){var e;if(!this._started)throw new Error("LiveShareRuntime.stop(): cannot call stop when not already started");this._started=!1,(0,Wn.isTimestampProvider)(this._timestampProvider)&&this._timestampProvider.isRunning&&this._timestampProvider.stop(),(e=this._objectManager)===null||e===void 0||e.stop()}__dangerouslySetContainerRuntime(e){if(this._containerRuntime!==e){if(this._containerRuntime=e,this._objectManager){this._objectManager.__dangerouslySetContainerRuntime(e);return}this._objectManager=new Wn.LiveObjectManager(this,this._containerRuntime),this.startObjectSynchronizerManager()}}startObjectSynchronizerManager(){this.objectManager.start()}}Zc.LiveShareRuntime=fY;var Yr={},pY=K&&K.__setFunctionName||function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.getLiveDataObjectClass=Yr.getLiveContainerSchemaProxy=Yr.getLiveContainerSchema=void 0;function SN(n,e){var t;const r=new Map,i=Object.entries(n.initialObjects).map(([o,a])=>[o,Hv(a,e,r)]);return{initialObjects:Object.fromEntries(i),dynamicObjectTypes:(t=n.dynamicObjectTypes)===null||t===void 0?void 0:t.map(o=>Hv(o,e,r))}}Yr.getLiveContainerSchema=SN;function mY(n,e){return SN(n,e)}Yr.getLiveContainerSchemaProxy=mY;function Hv(n,e,t=new Map){if(gY(n)){const r=n.TypeName,i=t.get(r);if(i!==void 0)return i;const s=vY(n,e);return t.set(r,s),s}return n}Yr.getLiveDataObjectClass=Hv;function gY(n){return n.LiveEnabled===!0}function vY(n,e){var t;class r extends n{constructor(o){if(super(o),this.__dangerouslySetLiveRuntime(e),!this.context||!this.context.containerRuntime)throw Error("getLiveDataObjectProxyClassInternal: required dependencies unknown");this.context.clientDetails.capabilities.interactive!==!1&&e.__dangerouslySetContainerRuntime(this.context.containerRuntime)}}return t=class extends n{},pY(t,"DynamicClass"),t.TypeName=n.TypeName,t.factory=new Proxy(n.factory,{get:function(s,o,a){return o==="ctor"?r:Reflect.get(s,o,a)}}),t}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Lm=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(_f,"__esModule",{value:!0});_f.LiveShareClient=void 0;const C1=Un(),yY=uY,SY=Bn,bY=Xc,bN=Yc,wY=Zc,CY=Yr,_1=new Map().set("https://alfred.westus2.fluidrelay.azure.com","https://us.fluidrelay.azure.com").set("https://alfred.westeurope.fluidrelay.azure.com","https://eu.fluidrelay.azure.com").set("https://alfred.southeastasia.fluidrelay.azure.com","https://globalThis.fluidrelay.azure.com");class _Y{constructor(e,t){if(this._host=bN.TestLiveShareHost.create(void 0,void 0),this.maxContainerLookupTries=3,!e)throw new Error(`LiveShareClient: prop \`host\` is \`${e}\` when it is expected to be a non-optional value of type \`ILiveShareHost\`. Please ensure \`host\` is defined before initializing \`LiveShareClient\`.`);if(typeof e.getFluidTenantInfo!="function")throw new Error(`LiveShareClient: \`host.getFluidTenantInfo\` is of type \`${typeof e.getFluidTenantInfo}\` when it is expected to be a type of \`function\`. For more information, review the \`ILiveShareHost\` interface.`);this._host=e,this._options=Object.assign(Object.assign({},t),{timestampProvider:E1(e,t)?new bY.LocalTimestampProvider:t==null?void 0:t.timestampProvider}),this._runtime=new wY.LiveShareRuntime(this._host,this._options,!0)}get isTesting(){return E1(this._host,this._options)}get canSendBackgroundUpdates(){return this._runtime.canSendBackgroundUpdates}set canSendBackgroundUpdates(e){this._runtime.canSendBackgroundUpdates=e}joinContainer(e,t){return Lm(this,void 0,void 0,function*(){performance.mark("TeamsSync: join container");try{const r=this._runtime.start(),i=(0,CY.getLiveContainerSchema)(e,this._runtime);let s=this._options.connection;if(!s){const c=yield this._host.getFluidTenantInfo();let u=c.serviceEndpoint;if(!u)if(_1.has(c.serviceEndpoint))u=_1.get(c.serviceEndpoint);else throw new Error(`LiveShareClient:joinContainer - unable to find fluid endpoint for: ${c.serviceEndpoint}`);c.tenantId=="local"?s={type:"local",endpoint:u,tokenProvider:yield(0,C1.getInsecureTokenProvider)()}:s={type:"remote",tenantId:c.tenantId,endpoint:u,tokenProvider:new C1.LiveShareTokenProvider(this._host)}}const o=new yY.AzureClient({connection:s,logger:this._options.logger}),a=this.getOrCreateContainer(o,i,0,t),l=yield Promise.all([a,r]);return this._runtime.setAudience(l[0].services.audience),performance.mark("TeamsSync: container connecting"),this._results=Object.assign(Object.assign({},l[0]),{timestampProvider:this._runtime.timestampProvider}),this._results}finally{performance.measure("TeamsSync: container joined","TeamsSync: join container")}})}getOrCreateContainer(e,t,r,i){return Lm(this,void 0,void 0,function*(){const s=yield this._host.getFluidContainerId();if(s.shouldCreate)return yield this.createNewContainer(e,t,r,i);if(s.containerId)return Object.assign({created:!1},yield e.getContainer(s.containerId,t));if(r<this.maxContainerLookupTries&&s.retryAfter>0)return yield this.wait(s.retryAfter),yield this.getOrCreateContainer(e,t,r+1,i);throw new Error("LiveShareClient: timed out attempting to create or get container for current context.")})}createNewContainer(e,t,r,i){return Lm(this,void 0,void 0,function*(){const{container:s,services:o}=yield e.createContainer(t);i&&i(s);const a=yield s.attach(),l=yield this._host.setFluidContainerId(a);return l.containerState!=SY.ContainerState.added?(s.dispose(),Object.assign({created:!1},yield e.getContainer(l.containerId,t))):{container:s,services:o,created:!0}})}wait(e){return new Promise(t=>{setTimeout(()=>t(),e)})}}_f.LiveShareClient=_Y;function E1(n,e){var t;return((t=e==null?void 0:e.connection)===null||t===void 0?void 0:t.type)=="local"||n instanceof bN.TestLiveShareHost}var wN={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(d,h,f,p){function g(S){return S instanceof f?S:new f(function(m){m(S)})}return new(f||(f=Promise))(function(S,m){function v(w){try{b(p.next(w))}catch(x){m(x)}}function y(w){try{b(p.throw(w))}catch(x){m(x)}}function b(w){w.done?S(w.value):g(w.value).then(v,y)}b((p=p.apply(d,h||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveTimer=n.LiveTimerEvents=void 0;const t=Aa,r=ho,i=Bn,s=$a(),o=ui,a=za(),l=uo();var c;(function(d){d.started="started",d.played="played",d.paused="paused",d.finished="finished",d.onTick="onTick"})(c=n.LiveTimerEvents||(n.LiveTimerEvents={}));class u extends a.LiveDataObject{constructor(){super(...arguments),this._currentConfig={clientId:"",timestamp:0,data:{duration:0,position:0,running:!1}},this._defaultTickRate=20,this._tickRate=this._defaultTickRate}get tickRate(){return this._tickRate}set tickRate(h){this._tickRate=h}initialize(h){return e(this,void 0,void 0,function*(){l.LiveDataObjectInitializeNotNeededError.assert("LiveTimer:initialize",this.initializeState),l.UnexpectedError.assert(!this._synchronizer,"LiveTimer:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._allowedRoles=h||[],this._synchronizer=new r.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentConfig.data,(f,p)=>e(this,void 0,void 0,function*(){return yield this.remoteConfigReceived(f,p)}),f=>e(this,void 0,void 0,function*(){if(f)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(f){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,f}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}start(h){return e(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveTimer:start","start",this.initializeState),yield this.playInternal(h,0)})}play(){return e(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveTimer:play","play",this.initializeState),!this._currentConfig.data.running&&this._currentConfig.data.position<this._currentConfig.data.duration&&(yield this.playInternal(this._currentConfig.data.duration,this._currentConfig.data.position))})}playInternal(h,f){return e(this,void 0,void 0,function*(){const p={timestamp:this.liveRuntime.getTimestamp(),clientId:yield this.waitUntilConnected(),data:{duration:h,position:f,running:!0}};yield this.updateConfig(p,!0)})}pause(){return e(this,void 0,void 0,function*(){if(l.LiveDataObjectNotInitializedError.assert("LiveTimer:pause","pause",this.initializeState),this._currentConfig.data.running){const h=this.liveRuntime.getTimestamp(),f={timestamp:h,clientId:yield this.waitUntilConnected(),data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.position+(h-this._currentConfig.timestamp),running:!1}};yield this.updateConfig(f,!0)}})}remoteConfigReceived(h,f){return e(this,void 0,void 0,function*(){try{const p=yield this.liveRuntime.verifyRolesAllowed(f,this._allowedRoles),g={timestamp:this._currentConfig.timestamp,clientId:this._currentConfig.clientId},S=s.LiveEvent.isNewer(g,h),m=this.liveRuntime.getTimestamp(),v=this.endTimeFromConfig(h);if(p&&this._currentConfig.timestamp===0&&h.data.running===!0&&m>=v){const y={timestamp:v,clientId:h.clientId,data:{duration:h.data.duration,position:h.data.duration,running:!1}};return this.updateConfig(y,!1),!0}return JSON.stringify(this._currentConfig.data)===JSON.stringify(h.data)&&this._currentConfig.timestamp===h.timestamp?!1:p&&S?(this.updateConfig(h,!1),!0):!1}catch{return!1}})}updateConfig(h,f){return e(this,void 0,void 0,function*(){const p=Object.assign({clientId:h.clientId,configChangedAt:h.timestamp},h.data);if(this._currentConfig=h,h.data.position===0?this.emit(c.started,p,f):h.data.duration===h.data.position?this.emit(c.finished,p):h.data.running?this.emit(c.played,p,f):this.emit(c.paused,p,f),h.data.running&&this.startTicking(),f)return yield this._synchronizer.sendEvent(h.data)})}startTicking(){const h=()=>{if(this._currentConfig.data.running){const f=this.liveRuntime.getTimestamp(),p=this.endTimeFromConfig(this._currentConfig);if(f>=p){const g={timestamp:p,clientId:this._currentConfig.clientId,data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.duration,running:!1}};this.updateConfig(g,!1).catch(S=>{console.error(S)})}else this.emit(c.onTick,p-f),this.scheduleAnimationFrame(h)}};this.scheduleAnimationFrame(h)}scheduleAnimationFrame(h){this._tickRate<=this._defaultTickRate&&typeof requestAnimationFrame=="function"?requestAnimationFrame(h):setTimeout(h,this._tickRate)}endTimeFromConfig(h){return h.timestamp-h.data.position+h.data.duration}}u.TypeName="@microsoft/live-share:LiveTimer",u.factory=new t.DataObjectFactory(u.TypeName,u,[],{}),n.LiveTimer=u,o.DynamicObjectRegistry.registerObjectClass(u,u.TypeName)})(wN);var Rf={},zr=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Rf,"__esModule",{value:!0});Rf.AzureLiveShareHost=void 0;const T1=Bn,EY=Un();class DS{constructor(e){this._shouldWarnLocalTimestamp=e,this._azureAudienceDeferred=new EY.Deferred,this.hasWarned=!1}static create(e=!0){return new DS(e)}setAudience(e){this._azureAudienceDeferred.resolve(e)}registerClientId(e){var t;return zr(this,void 0,void 0,function*(){const r=yield this.getClientInfo(e);return(t=r==null?void 0:r.roles)!==null&&t!==void 0?t:[]})}getClientInfo(e){return zr(this,void 0,void 0,function*(){const t=yield this.getAudienceMemberInfo(e);if(!t)throw new Error("AzureLiveShareHost.getClientInfo: audience member not found");return{userId:t.userId,roles:this.getRolesForAudienceMember(t),displayName:t.userName}})}getNtpTime(){return zr(this,void 0,void 0,function*(){!this.hasWarned&&this._shouldWarnLocalTimestamp&&(console.warn(`AzureLiveShareHost is using a local timestamp, which could cause issues when use some LiveDataObject data structures across multiple clients.

                To disable this warning, set _shouldWarn in AzureLiveShareHost.create() to false.

                To resolve synchronization issues you may encounter, you should implement a service API to get this timestamp value and override this function.`),this.hasWarned=!0);const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})})}getClientRoles(e){return zr(this,void 0,void 0,function*(){const t=yield this.getClientInfo(e);return t==null?void 0:t.roles})}getFluidTenantInfo(){return zr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidTenantInfo: not implemented exception")})}getFluidToken(e){return zr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidToken: not implemented exception")})}getFluidContainerId(){return zr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidContainerId: not implemented exception")})}setFluidContainerId(e){return zr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.setFluidContainerId: not implemented exception")})}getAudienceMemberInfo(e){return zr(this,void 0,void 0,function*(){const r=[...(yield this._azureAudienceDeferred.promise).getMembers().values()];for(let i=0;i<r.length;i++){const s=r[i];if(s.connections.find(o=>o.id===e))return s}})}getRolesForAudienceMember(e){return e.connections.length===0?[]:e.connections[e.connections.length-1].mode==="write"?[T1.UserMeetingRole.presenter]:[T1.UserMeetingRole.attendee]}}Rf.AzureLiveShareHost=DS;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(ui,n),t(Wc,n),t(Bn,n),t($a(),n),t(Bk(),n),t(Qc,n),t(Jc,n),t(wf,n),t(CS,n),t(Cf(),n),t(Uk,n),t(_f,n),t(ES,n),t(fo,n),t(wN,n),t(Xc,n),t(Yc,n),t(ja,n),t(Vc,n),t(Yr,n),t(za(),n),t(Zc,n),t(Rf,n),t(ho,n),t(uo(),n)})(Nd);const x1={initialObjects:{bus:Nd.LiveEvent,flags:fc,phase:Nd.LiveState}},CN=H.createContext({container:null,bus:null,flags:null,phase:null,loading:!0,error:null}),FS=()=>{const n=H.useContext(CN);if(!n)throw new Error("useLiveShare must be used within a LiveShareProvider");return n},_N=({children:n})=>{const[e,t]=H.useState(!0),[r,i]=H.useState(null),s=H.useRef(null),o=H.useRef(null),a=H.useRef(null),l=H.useRef(null);H.useEffect(()=>{let u=!0;return(async()=>{try{console.log("[LiveShareProvider] ==================== STARTING INITIALIZATION ===================="),console.log("[LiveShareProvider] Step 1: Initializing Teams SDK..."),await Uy(),console.log("[LiveShareProvider] ✅ Teams SDK initialized successfully"),console.log("[LiveShareProvider] Step 2: Creating LiveShareHost...");const h=Hy.create();console.log("[LiveShareProvider] ✅ LiveShareHost created:",h),console.log("[LiveShareProvider] Step 3: Creating LiveShareClient...");const f=new Nd.LiveShareClient(h);console.log("[LiveShareProvider] ✅ LiveShareClient created:",f),console.log("[LiveShareProvider] Step 4: Joining container with schema:",x1);const{container:p}=await f.joinContainer(x1);if(console.log("[LiveShareProvider] ✅ Container joined successfully:",p),!u){console.log("[LiveShareProvider] ⚠️ Component unmounted during initialization, aborting");return}console.log("[LiveShareProvider] Step 5: Extracting Live Share objects..."),s.current=p,o.current=p.initialObjects.bus,a.current=p.initialObjects.flags,l.current=p.initialObjects.phase,console.log("[LiveShareProvider] ✅ Live Share objects extracted:"),console.log("[LiveShareProvider] - bus:",o.current),console.log("[LiveShareProvider] - flags:",a.current),console.log("[LiveShareProvider] - phase:",l.current);const g=o.current,S=a.current,m=l.current;if(console.log("[LiveShareProvider] Step 6: Initializing LiveEvent (bus)..."),g&&typeof g.initialize=="function"?(console.log("[LiveShareProvider] Calling bus.initialize()..."),await g.initialize(),console.log("[LiveShareProvider] ✅ LiveEvent initialized successfully")):console.log("[LiveShareProvider] ⚠️ Bus object missing or no initialize method:",g),console.log("[LiveShareProvider] Step 7: Initializing LiveState..."),m&&typeof m.initialize=="function"?(console.log("[LiveShareProvider] Calling phase.initialize('idle')..."),await m.initialize("idle"),console.log("[LiveShareProvider] ✅ LiveState initialized with 'idle'")):console.log("[LiveShareProvider] ⚠️ Phase object missing or no initialize method:",m),console.log("[LiveShareProvider] Step 8: Setting SharedMap defaults..."),S){const v=S.get("roundVisible"),y=S.get("editingEnabled"),b=S.get("clearAllCounter");console.log("[LiveShareProvider] Current SharedMap values:"),console.log("[LiveShareProvider] - roundVisible:",v),console.log("[LiveShareProvider] - editingEnabled:",y),console.log("[LiveShareProvider] - clearAllCounter:",b),v===void 0&&(console.log("[LiveShareProvider] Setting roundVisible = false"),S.set("roundVisible",!1)),y===void 0&&(console.log("[LiveShareProvider] Setting editingEnabled = false"),S.set("editingEnabled",!1)),b===void 0&&(console.log("[LiveShareProvider] Setting clearAllCounter = 0"),S.set("clearAllCounter",0)),console.log("[LiveShareProvider] ✅ SharedMap defaults set")}else console.log("[LiveShareProvider] ⚠️ Flags object is null/undefined");console.log("[LiveShareProvider] ==================== INITIALIZATION COMPLETE ====================")}catch(h){console.error("[LiveShareProvider] ❌ INITIALIZATION FAILED:"),console.error("[LiveShareProvider] Error type:",typeof h),console.error("[LiveShareProvider] Error message:",h instanceof Error?h.message:String(h)),console.error("[LiveShareProvider] Error stack:",h instanceof Error?h.stack:"No stack trace"),console.error("[LiveShareProvider] Full error object:",h),u&&i(h instanceof Error?h.message:String(h))}finally{u&&(console.log("[LiveShareProvider] Setting loading = false"),t(!1))}})(),()=>{u=!1}},[]);const c={container:s.current,bus:o.current,flags:a.current,phase:l.current,loading:e,error:r};return console.log("[LiveShareProvider] Context value update:"),console.log("[LiveShareProvider] - container:",c.container),console.log("[LiveShareProvider] - bus:",c.bus),console.log("[LiveShareProvider] - flags:",c.flags),console.log("[LiveShareProvider] - phase:",c.phase),console.log("[LiveShareProvider] - loading:",c.loading),console.log("[LiveShareProvider] - error:",c.error),D.jsx(CN.Provider,{value:c,children:n})};function TY({onCanvasReady:n,onControlsReady:e,userInfo:t}){const r=H.useRef(null),i=H.useRef(null),s=H.useRef(null),o=H.useRef(!1),{bus:a,flags:l,loading:c}=FS(),[u,d]=H.useState(!0),[h,f]=H.useState([]),[p,g]=H.useState([]);H.useEffect(()=>{const C=r.current;C&&(f([C.toDataURL()]),g([]))},[]);const S=()=>{const C=r.current;C&&(f(R=>[...R,C.toDataURL()]),g([]))},[m,v]=H.useState({tool:"pen",color:"#000000",penSize:5,eraserSize:20,fontSize:16,isDrawing:!1,lastPoint:null}),[y,b]=H.useState({visible:!1,x:0,y:0,text:"",fontSize:16}),w=()=>y.visible?y.text.trim()?(console.log("[PrivateCanvas] commitOrHideActiveText: committing text due to navigation away"),P(y.text),!0):(console.log("[PrivateCanvas] commitOrHideActiveText: hiding empty text input due to navigation away"),b(C=>({...C,visible:!1})),!1):!1;H.useEffect(()=>{const C=r.current;if(!C)return;const R=C.getContext("2d");if(!R)return;const L=()=>{var ne;const U=(ne=C.parentElement)==null?void 0:ne.getBoundingClientRect();if(U&&(C.width!==U.width||C.height!==U.height)){const ie=R.getImageData(0,0,C.width,C.height);C.width=U.width,C.height=U.height,R.putImageData(ie,0,0),R.lineCap="round",R.lineJoin="round",R.imageSmoothingEnabled=!0,console.log("[PrivateCanvas] Resized canvas to",C.width,C.height)}};return R.lineCap="round",R.lineJoin="round",R.imageSmoothingEnabled=!0,L(),window.addEventListener("resize",L),i.current=R,console.log("[PrivateCanvas] Canvas initialized",{canvas:C,context:R}),n==null||n(C,R),()=>{window.removeEventListener("resize",L)}},[n]),H.useEffect(()=>{if(!a||c){console.log("[PrivateCanvas] Live Share bus not ready yet, skipping event listener setup");return}console.log("[PrivateCanvas] Setting up Live Share event listeners");const C=R=>{switch(console.log("[PrivateCanvas] Received Live Share event:",R),R.type){case"clearAll":console.log("[PrivateCanvas] Handling clearAll event"),_();break;case"enableCanvas":console.log("[PrivateCanvas] Handling enableCanvas event"),d(!0);break;case"disableCanvas":console.log("[PrivateCanvas] Handling disableCanvas event"),d(!1),y.visible&&y.text.trim()?P(y.text):y.visible&&b(U=>({...U,visible:!1}));break;case"shareCanvas":console.log("[PrivateCanvas] Handling shareCanvas event - exporting canvas data");const L=N();L&&a&&(a.send({type:"canvasData",...L}),console.log("[PrivateCanvas] Canvas data sent to stage for user:",L.userName));break;default:console.log("[PrivateCanvas] Unhandled Live Share event type:",R.type)}};return a.on("received",C),()=>{console.log("[PrivateCanvas] Cleaning up Live Share event listeners"),a.off("received",C)}},[a,c,y.visible,y.text]),H.useEffect(()=>{if(!l||c)return;const C=l.get("editingEnabled");C!==void 0&&(console.log("[PrivateCanvas] Initializing canvas editing state from Live Share:",C),d(!!C))},[l,c]);const x=C=>{const R=r.current;if(!R)return console.log("[PrivateCanvas] getCanvasPoint: No canvas ref"),{x:0,y:0};const L=R.getBoundingClientRect(),U=R.width/L.width,ne=R.height/L.height;if(console.log("[PrivateCanvas] getCanvasPoint: canvas dimensions",{canvasWidth:R.width,canvasHeight:R.height,rectWidth:L.width,rectHeight:L.height,scaleX:U,scaleY:ne}),"touches"in C&&C.touches.length>0){const ie={x:(C.touches[0].clientX-L.left)*U,y:(C.touches[0].clientY-L.top)*ne};return console.log("[PrivateCanvas] Touch point:",ie,"from",C.touches[0].clientX,C.touches[0].clientY),ie}else{const ie=C,be={x:(ie.clientX-L.left)*U,y:(ie.clientY-L.top)*ne};return console.log("[PrivateCanvas] Mouse point:",be,"from",ie.clientX,ie.clientY),be}},E=C=>{if(console.log("[PrivateCanvas] handleTextInput called, current textInput visible:",y.visible,"text:",y.text),!u){console.log("[PrivateCanvas] Canvas editing is disabled, preventing text input");return}y.visible&&y.text.trim()&&(console.log("[PrivateCanvas] Committing existing text before creating new input:",y.text),P(y.text));const R=x(C),L=r.current;if(!L)return;const U=L.getBoundingClientRect(),ne=U.left+R.x*U.width/L.width,ie=U.top+R.y*U.height/L.height;b({visible:!0,x:ne,y:ie,text:"",fontSize:m.fontSize}),setTimeout(()=>{var be;(be=s.current)==null||be.focus()},10),console.log("[PrivateCanvas] Showing text input at",{point:R,displayX:ne,displayY:ie})},P=C=>{S();const R=i.current,L=r.current,U=C||y.text,ne=y.fontSize,ie=y.x,be=y.y;if(console.log("[PrivateCanvas] commitText: Hiding text input, finalText:",U),b(Xt=>({...Xt,visible:!1})),!U.trim()||!R||!L){console.log("[PrivateCanvas] No text to commit or missing context/canvas");return}const Ce=L.getBoundingClientRect(),vt=(ie-Ce.left)/Ce.width*L.width,ut=(be-Ce.top)/Ce.height*L.height;R.globalCompositeOperation="source-over",R.fillStyle=m.color,R.font=`${ne}px "Comic Sans MS", cursive, sans-serif`,R.textAlign="left",R.textBaseline="top",R.globalAlpha=1,R.fillText(U,vt,ut),console.log("[PrivateCanvas] Added text:",U,"at",{canvasX:vt,canvasY:ut},"fontSize:",ne)},M=C=>{C.key==="Enter"?P():C.key==="Escape"&&(console.log("[PrivateCanvas] handleTextInputKeyDown: Escape pressed, hiding text input with text:",y.text),b(R=>({...R,visible:!1})))},F=C=>{C.preventDefault();const R=C.deltaY>0?-2:2,L=Math.max(10,Math.min(72,y.fontSize+R));b(U=>({...U,fontSize:L})),console.log("[PrivateCanvas] Mouse wheel font size changed to:",L)},G=C=>{console.log("[PrivateCanvas] handleTextInputBlur called! Event target:",C.target),setTimeout(()=>{var ie;const R=C.target.value||"",L=((ie=s.current)==null?void 0:ie.value)||"",U=y.text||"",ne=R||L||U;console.log("[PrivateCanvas] Blur event - eventText:",R,"refText:",L,"stateText:",U,"using:",ne),ne.trim()?P(ne):(console.log("[PrivateCanvas] handleTextInputBlur: No text to commit, hiding text input"),b(be=>({...be,visible:!1})))},0)},z=C=>{if(C.preventDefault(),!u){console.log("[PrivateCanvas] Canvas editing is disabled, preventing drawing");return}const R=x(C);if(console.log("[PrivateCanvas] Start drawing at",R,"with state",m),m.tool==="text"){E(C);return}w(),v(U=>({...U,isDrawing:!0,lastPoint:R}));const L=i.current;if(L){switch(m.tool){case"pen":L.globalCompositeOperation="source-over",L.strokeStyle=m.color,L.lineWidth=m.penSize,L.globalAlpha=1;break;case"eraser":L.globalCompositeOperation="destination-out",L.lineWidth=m.eraserSize;break}L.beginPath(),L.moveTo(R.x,R.y)}},X=C=>{if((!m.isDrawing||m.tool==="text")&&!o.current)return;C.preventDefault();const R=x(C),L=i.current;L&&(L.lineTo(R.x,R.y),L.stroke(),console.log("[PrivateCanvas] Draw to",R,o.current?"(right-erase)":""),v(U=>({...U,lastPoint:R})))},V=()=>{m.isDrawing&&S(),v(L=>({...L,isDrawing:!1,lastPoint:null}));const C=i.current,R=r.current;!C||!R||(C.beginPath(),o.current&&(C.globalCompositeOperation="source-over",o.current=!1),console.log("[PrivateCanvas] Stop drawing"))},_=()=>{S();const C=i.current,R=r.current;!C||!R||(C.clearRect(0,0,R.width,R.height),console.log("[PrivateCanvas] Canvas cleared"))},N=()=>{const C=r.current;if(!C)return console.log("[PrivateCanvas] Cannot export canvas data - no canvas ref"),null;try{const L={imageData:C.toDataURL("image/png"),width:C.width,height:C.height,userName:(t==null?void 0:t.displayName)||(t==null?void 0:t.userPrincipalName)||"Unknown User",userId:(t==null?void 0:t.id)||(t==null?void 0:t.userObjectId)||(t==null?void 0:t.aadObjectId)||"unknown",timestamp:Date.now()};return console.log("[PrivateCanvas] Exported canvas data for user:",L.userName),L}catch(R){return console.error("[PrivateCanvas] Error exporting canvas data:",R),null}},W=()=>{const C=r.current,R=i.current;f(L=>{if(L.length<=1||!C||!R)return console.log("[PrivateCanvas] Undo: nothing to undo. Undo stack length:",L.length),L;const U=p.length;g(be=>[C.toDataURL(),...be]);const ne=L[L.length-2],ie=new window.Image;return ie.onload=()=>{R.clearRect(0,0,C.width,C.height),R.drawImage(ie,0,0,C.width,C.height),console.log("[PrivateCanvas] Undo: restored previous state. Undo stack length:",L.length-1,"Redo stack length:",U+1)},ie.src=ne,L.slice(0,-1)})},A=()=>{const C=r.current,R=i.current;g(L=>L.length===0||!C||!R?(console.log("[PrivateCanvas] Redo: nothing to redo. Redo stack length:",L.length),L):(f(U=>{const ne=new window.Image;return ne.onload=()=>{R.clearRect(0,0,C.width,C.height),R.drawImage(ne,0,0,C.width,C.height),console.log("[PrivateCanvas] Redo: restored next state. Undo stack length:",U.length+1,"Redo stack length:",L.length-1)},ne.src=L[0],[...U,L[0]]}),L.slice(1)))},B=C=>{console.log("[PrivateCanvas] Tool change requested to",C,"current textInput visible:",y.visible,"text:",y.text),y.visible&&y.text.trim()?(console.log("[PrivateCanvas] Committing active text before tool change:",y.text),P(y.text)):y.visible&&(console.log("[PrivateCanvas] Hiding empty text input before tool change"),b(R=>({...R,visible:!1}))),v(R=>(console.log("[PrivateCanvas] Tool changed to",C),{...R,tool:C}))},k=C=>{w(),v(R=>(console.log("[PrivateCanvas] Color changed to",C),{...R,color:C}))},$=C=>{w(),v(R=>(console.log("[PrivateCanvas] Pen size changed to",C),{...R,penSize:C}))},T=C=>{w(),v(R=>(console.log("[PrivateCanvas] Eraser size changed to",C),{...R,eraserSize:C}))},I=C=>{w(),v(R=>(console.log("[PrivateCanvas] Font size changed to",C),{...R,fontSize:C}))};return H.useEffect(()=>{const C={setTool:B,setColor:k,setPenSize:$,setEraserSize:T,setFontSize:I,clearCanvas:_,undo:W,redo:A,drawingState:m};console.log("[PrivateCanvas] Exposing controls to parent (one time only)"),e==null||e(C)},[]),H.useEffect(()=>{e&&e({setTool:B,setColor:k,setPenSize:$,setEraserSize:T,setFontSize:I,clearCanvas:_,undo:W,redo:A,drawingState:m})},[m.tool,m.penSize,m.eraserSize,m.fontSize,m.color]),H.useEffect(()=>{if(!y.visible)return;const C=R=>{const L=r.current,U=s.current;L&&(U&&(U===R.target||U.contains(R.target))||L===R.target||L.contains(R.target)||w())};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[y.visible,y.text,y.x,y.y]),D.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[D.jsx("canvas",{ref:r,onContextMenu:C=>{C.preventDefault()},onMouseDown:C=>{if(console.log("[PrivateCanvas] Mouse down event",C),!u){console.log("[PrivateCanvas] Canvas editing is disabled, preventing mouse interaction");return}if(C.button===1){C.preventDefault(),y.visible&&y.text.trim()&&P(y.text),E(C);return}if(C.button===2){C.preventDefault();const R=x(C),L=i.current;L&&(o.current=!0,v(U=>({...U,isDrawing:!0,lastPoint:R})),L.globalCompositeOperation="destination-out",L.lineWidth=m.eraserSize,L.beginPath(),L.moveTo(R.x,R.y));return}z(C)},onMouseMove:C=>{X(C)},onMouseUp:C=>{console.log("[PrivateCanvas] Mouse up event",C),V()},onMouseLeave:C=>{console.log("[PrivateCanvas] Mouse leave event",C),V()},onTouchStart:C=>{if(console.log("[PrivateCanvas] Touch start event",C),!u){console.log("[PrivateCanvas] Canvas editing is disabled, preventing touch interaction");return}z(C)},onTouchMove:C=>{console.log("[PrivateCanvas] Touch move event",C),X(C)},onTouchEnd:C=>{console.log("[PrivateCanvas] Touch end event",C),V()},style:{width:"100%",height:"100%",display:"block",touchAction:"none",cursor:u?m.tool==="eraser"?"grab":m.tool==="text"?"text":`url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23000' d='M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z'/%3E%3C/svg%3E") 2 22, crosshair`:"not-allowed",opacity:u?1:.6}}),!u&&D.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:100},children:D.jsx("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px 16px",borderRadius:"8px",fontSize:"14px",fontWeight:"bold"},children:"Canvas editing is disabled"})}),y.visible&&D.jsxs("div",{style:{position:"fixed",left:y.x,top:y.y-30,zIndex:1e3},children:[D.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"11px",marginBottom:"2px",whiteSpace:"nowrap"},children:["Mouse wheel to resize (",y.fontSize,"px)"]}),D.jsx("input",{ref:s,type:"text",value:y.text,onChange:C=>b(R=>({...R,text:C.target.value})),onKeyDown:M,onBlur:G,onWheel:F,style:{border:"none",borderRadius:"0",padding:"0",fontSize:`${y.fontSize}px`,fontFamily:'"Comic Sans MS", cursive, sans-serif',color:m.color,backgroundColor:"transparent",outline:"none",minWidth:"120px"},placeholder:"Type text..."})]})]})}function xY({canvasControls:n,userInfo:e,meetingInfo:t}){var k;const{setTool:r,setColor:i,setPenSize:s,setEraserSize:o,setFontSize:a,clearCanvas:l,drawingState:c}=n,[u,d]=H.useState(!1),[h,f]=H.useState(!1),[p,g]=H.useState(!1),[S,m]=H.useState(null),[v,y]=H.useState(null),[b,w]=H.useState(null),x=$=>{console.log("[PrivateToolbar] Tool button clicked:",$),r($)},E=$=>{console.log("[PrivateToolbar] Color button clicked:",$),i($)},P=$=>{const T=Number($.target.value);console.log("[PrivateToolbar] Pen size changed:",T),c.tool!=="pen"&&x("pen"),s(T)},M=$=>{const T=Number($.target.value);console.log("[PrivateToolbar] Eraser size changed:",T),c.tool!=="eraser"&&x("eraser"),o(T)},F=$=>{const T=Number($.target.value);console.log("[PrivateToolbar] Font size changed:",T),c.tool!=="text"&&x("text"),a(T)},G=()=>{console.log("[PrivateToolbar] Clear button clicked"),l()},z=()=>{console.log("[PrivateToolbar] Undo button clicked"),n.undo?(console.log("[PrivateToolbar] Calling canvasControls.undo"),n.undo(),console.log("[PrivateToolbar] canvasControls.undo call finished")):console.log("[PrivateToolbar] canvasControls.undo is not defined")},X=()=>{console.log("[PrivateToolbar] Redo button clicked"),n.redo?(console.log("[PrivateToolbar] Calling canvasControls.redo"),n.redo(),console.log("[PrivateToolbar] canvasControls.redo call finished")):console.log("[PrivateToolbar] canvasControls.redo is not defined")},V=()=>{S&&(clearTimeout(S),m(null)),f(!1),g(!1),v&&(clearTimeout(v),y(null)),b&&(clearTimeout(b),w(null)),d(!0)},_=()=>{const $=setTimeout(()=>{d(!1)},300);m($)},N=()=>{v&&(clearTimeout(v),y(null)),d(!1),g(!1),S&&(clearTimeout(S),m(null)),b&&(clearTimeout(b),w(null)),f(!0)},W=()=>{const $=setTimeout(()=>{f(!1)},1e3);y($)},A=()=>{b&&(clearTimeout(b),w(null)),d(!1),f(!1),S&&(clearTimeout(S),m(null)),v&&(clearTimeout(v),y(null)),g(!0)},B=()=>{const $=setTimeout(()=>{g(!1)},1e3);w($)};return H.useEffect(()=>{const $=T=>{(T.ctrlKey||T.metaKey)&&!T.shiftKey&&T.key.toLowerCase()==="z"?(T.preventDefault(),z()):(T.ctrlKey||T.metaKey)&&T.key.toLowerCase()==="y"&&(T.preventDefault(),X())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[n]),D.jsxs("div",{className:"toolbar",children:[e&&(e.displayName||e.userPrincipalName)&&D.jsxs("div",{title:[e.displayName,e.userPrincipalName,e.userObjectId||e.aadObjectId].filter(Boolean).join(`
`),style:{width:"100%",fontWeight:600,fontSize:"14px",padding:"4px 8px",background:"#f3f2f1",border:"1px solid #e1dfdd",borderRadius:"4px",marginBottom:"6px",display:"flex",alignItems:"center",gap:"6px",lineHeight:1.2},children:[D.jsx("span",{role:"img","aria-label":"user",children:"👤"}),(()=>{let T=e.displayName||e.userPrincipalName||"";return!e.displayName&&e.userPrincipalName&&(T=e.userPrincipalName.split("@")[0].replace(/\./g," ")),D.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:180},children:T})})(),e.userPrincipalName&&e.displayName&&e.userPrincipalName!==e.displayName&&D.jsxs("span",{style:{fontSize:"11px",fontWeight:400,color:"#605e5c"},children:["(",e.userPrincipalName,")"]}),(t==null?void 0:t.isOrganizer)&&D.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#0f6cbd",background:"#d0e7f8",padding:"2px 4px",borderRadius:"3px"},children:"HOST"})]}),t&&(t.title||t.organizer)&&D.jsxs("div",{style:{width:"100%",fontSize:"12px",padding:"4px 8px",background:"#faf9f8",border:"1px solid #e1dfdd",borderRadius:"4px",marginBottom:"6px",display:"flex",flexDirection:"column",gap:"2px"},children:[t.title&&D.jsxs("div",{style:{fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[D.jsx("span",{role:"img","aria-label":"meeting",children:"📅"}),D.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.title})]}),t.organizer&&D.jsxs("div",{style:{color:"#444",display:"flex",alignItems:"center",gap:4},children:[D.jsx("span",{role:"img","aria-label":"organizer",children:"🧑‍💼"}),D.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.organizer.displayName||t.organizer.userPrincipalName}),t.organizer.userPrincipalName&&D.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:["(",t.organizer.userPrincipalName,")"]})]}),t.host&&D.jsxs("div",{style:{color:"#444",display:"flex",alignItems:"center",gap:4},children:[D.jsx("span",{role:"img","aria-label":"host",children:"⭐"}),D.jsx("span",{style:{fontWeight:500},children:"Host:"}),D.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.host.displayName||t.host.userPrincipalName}),t.host.userPrincipalName&&D.jsxs("span",{style:{fontSize:"11px",color:"#666"},children:["(",t.host.userPrincipalName,")"]}),t.isOrganizer&&t.host.userPrincipalName&&((k=e==null?void 0:e.userPrincipalName)==null?void 0:k.toLowerCase())===t.host.userPrincipalName.toLowerCase()&&D.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#0f6cbd",marginLeft:4},children:"You"})]})]}),D.jsxs("div",{className:"tool-group",children:[D.jsxs("div",{style:{position:"relative",display:"inline-block"},onMouseEnter:V,onMouseLeave:_,children:[D.jsx("button",{className:c.tool==="pen"?"selected":"",onClick:()=>x("pen"),style:{padding:"8px 12px",margin:"2px",border:c.tool==="pen"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="pen"?"#e6f3ff":"white",cursor:"pointer"},children:"✏️ Pen"}),u&&D.jsxs("div",{style:{position:"absolute",top:"100%",left:"0",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[D.jsx("input",{type:"range",min:"1",max:"10",value:c.penSize,onChange:P,style:{width:"80px"}}),D.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.penSize,"px"]})]})]}),D.jsxs("div",{style:{position:"relative",display:"inline-block"},onMouseEnter:N,onMouseLeave:W,children:[D.jsx("button",{className:c.tool==="eraser"?"selected":"",onClick:()=>x("eraser"),style:{padding:"8px 12px",margin:"2px",border:c.tool==="eraser"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="eraser"?"#e6f3ff":"white",cursor:"pointer"},children:"🧽 Eraser"}),h&&D.jsxs("div",{style:{position:"absolute",top:"100%",left:"0",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[D.jsx("input",{type:"range",min:"5",max:"50",value:c.eraserSize,onChange:M,style:{width:"80px"}}),D.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.eraserSize,"px"]})]})]}),D.jsxs("div",{style:{position:"relative",display:"inline-block"},onMouseEnter:A,onMouseLeave:B,children:[D.jsx("button",{className:c.tool==="text"?"selected":"",onClick:()=>x("text"),style:{padding:"8px 12px",margin:"2px",border:c.tool==="text"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="text"?"#e6f3ff":"white",cursor:"pointer"},children:"📝 Text"}),p&&D.jsxs("div",{style:{position:"absolute",top:"100%",left:"0",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[D.jsx("input",{type:"range",min:"10",max:"72",value:c.fontSize,onChange:F,style:{width:"80px"}}),D.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.fontSize,"px"]})]})]})]}),D.jsxs("div",{className:"tool-group",children:[D.jsx("label",{style:{fontSize:"14px",fontWeight:"bold"},children:"Color:"}),D.jsx("input",{type:"color",value:c.color,onChange:$=>E($.target.value),style:{width:"40px",height:"30px",margin:"2px",border:"1px solid #ccc",borderRadius:"4px",cursor:"pointer"}})]}),D.jsxs("div",{className:"tool-group",children:[D.jsx("button",{onClick:z,style:{padding:"8px 12px",margin:"2px",border:"1px solid #ccc",borderRadius:"4px",background:"white",cursor:"pointer"},children:"↩️ Undo"}),D.jsx("button",{onClick:X,style:{padding:"8px 12px",margin:"2px",border:"1px solid #ccc",borderRadius:"4px",background:"white",cursor:"pointer"},children:"↪️ Redo"})]}),D.jsx("div",{className:"tool-group",children:D.jsx("button",{onClick:G,style:{padding:"8px 12px",margin:"2px",border:"1px solid #d13438",borderRadius:"4px",background:"#f8d7da",color:"#721c24",cursor:"pointer",fontWeight:"bold"},children:"🗑️ Clear All"})}),D.jsx("div",{className:"tool-group",children:D.jsx("small",{style:{color:"#666",fontStyle:"italic",padding:"5px 10px",backgroundColor:"#f8f9fa",borderRadius:"4px",border:"1px solid #dee2e6"},children:"✨ Private: Only you can see your drawings"})})]})}const OY=()=>{const[n,e]=H.useState(!1),t=H.useRef(null),[r,i]=H.useState(!1),[s,o]=H.useState(!0),{bus:a,flags:l,phase:c,loading:u,error:d}=FS();H.useEffect(()=>{let S=!0;(async()=>{var y,b;try{console.log("[HostActionsButton] ==================== STARTING AUTH INIT ===================="),console.log("[HostActionsButton] Initializing Teams SDK for user context..."),await Uy(),console.log("[HostActionsButton] ✅ Teams SDK initialized"),console.log("[HostActionsButton] Getting Teams context...");const w=await oO();console.log("[HostActionsButton] ✅ Teams context received:",w);const x=w==null?void 0:w.user,E=w==null?void 0:w.meeting;console.log("[HostActionsButton] User info:",x),console.log("[HostActionsButton] Meeting context:",E);const P=(b=(y=x==null?void 0:x.userPrincipalName)==null?void 0:y.toLowerCase)==null?void 0:b.call(y);console.log("[HostActionsButton] User email:",P);const M=new Set(["Organizer","CoOrganizer","Presenter"]);let F=!1;console.log("[HostActionsButton] Checking if user is organizer...");try{await new Promise(G=>{if(!kd)return console.log("[HostActionsButton] meeting.getMeetingDetails not available"),G();console.log("[HostActionsButton] Calling meeting.getMeetingDetails..."),kd((z,X)=>{if(console.log("[HostActionsButton] getMeetingDetails result - err:",z,"details:",X),!z&&X){const V=X==null?void 0:X.organizer;console.log("[HostActionsButton] Meeting organizer:",V),V!=null&&V.userPrincipalName&&P&&P===V.userPrincipalName.toLowerCase()?(console.log("[HostActionsButton] ✅ User is meeting organizer!"),F=!0):console.log("[HostActionsButton] User is not meeting organizer")}G()})})}catch(G){console.log("[HostActionsButton] Error checking organizer status:",G)}console.log("[HostActionsButton] Checking user role..."),console.log("[HostActionsButton] Meeting role:",E==null?void 0:E.role),console.log("[HostActionsButton] Host roles:",Array.from(M)),!F&&(E!=null&&E.role)&&M.has(E.role)&&(console.log("[HostActionsButton] ✅ User has host role:",E.role),F=!0),console.log("[HostActionsButton] Checking special override..."),P==="vithoma@microsoft.com"&&(console.log("[HostActionsButton] ✅ Special user override for vithoma@microsoft.com"),F=!0),console.log("[HostActionsButton] Final host detection result:",F),S&&i(!!F),console.log("[HostActionsButton] ==================== AUTH INIT COMPLETE ====================")}catch(w){console.error("[HostActionsButton] ❌ AUTH INIT FAILED:",w)}finally{S&&(console.log("[HostActionsButton] Setting authLoading = false"),o(!1))}})();const m=y=>{t.current&&(t.current.contains(y.target)||e(!1))},v=y=>{y.key==="Escape"&&e(!1)};return document.addEventListener("mousedown",m),document.addEventListener("keydown",v),()=>{S=!1,document.removeEventListener("mousedown",m),document.removeEventListener("keydown",v)}},[]);async function h(S,m){if(console.log(`[HostActionsButton] ==================== BROADCASTING ACTION: ${S} ====================`),!a||!l||!c){console.error("[HostActionsButton] ❌ Live Share objects not available!"),console.error("[HostActionsButton] - bus:",a),console.error("[HostActionsButton] - flags:",l),console.error("[HostActionsButton] - phase:",c);return}console.log("[HostActionsButton] ✅ Live Share objects available, proceeding with broadcast"),console.log(`[HostActionsButton] Action type: ${S}`),console.log("[HostActionsButton] Payload:",m);try{const v={type:S,...m,ts:Date.now()};console.log("[HostActionsButton] Step 1: Sending LiveEvent with data:",v);const y=await a.send(v);console.log("[HostActionsButton] ✅ LiveEvent sent successfully:",y),console.log("[HostActionsButton] Step 2: Updating SharedMap and LiveState...");const b=Date.now();switch(S){case"clear-all":console.log("[HostActionsButton] Processing clear-all action..."),l.set("lastAction","clear-all"),l.set("lastActionAt",b);const w=(Number(l.get("clearAllCounter"))||0)+1;console.log("[HostActionsButton] Setting clearAllCounter to:",w),l.set("clearAllCounter",w),c.set&&(console.log("[HostActionsButton] Setting phase to 'idle'"),await c.set("idle"));break;case"share-all":console.log("[HostActionsButton] Processing share-all action..."),l.set("roundVisible",!0),l.set("lastAction","share-all"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'visible'"),await c.set("visible"));break;case"enable-editing":console.log("[HostActionsButton] Processing enable-editing action..."),l.set("editingEnabled",!0),l.set("lastAction","enable-editing"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'editing'"),await c.set("editing"));break;case"start-stage-page":console.log("[HostActionsButton] Processing start-stage-page action..."),l.set("stagePageActive",!0),l.set("lastAction","start-stage-page"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'stage'"),await c.set("stage"));break;case"send-content-to-all":console.log("[HostActionsButton] Processing send-content-to-all action..."),l.set("sendContentToAll",!0),l.set("lastAction","send-content-to-all"),l.set("lastActionAt",b);const x=(Number(l.get("sendContentCounter"))||0)+1;console.log("[HostActionsButton] Setting sendContentCounter to:",x),l.set("sendContentCounter",x);break}console.log("[HostActionsButton] ✅ SharedMap and LiveState updated"),console.log("[HostActionsButton] Final SharedMap state:"),console.log("[HostActionsButton] - roundVisible:",l.get("roundVisible")),console.log("[HostActionsButton] - editingEnabled:",l.get("editingEnabled")),console.log("[HostActionsButton] - lastAction:",l.get("lastAction")),console.log("[HostActionsButton] - lastActionAt:",l.get("lastActionAt")),console.log("[HostActionsButton] - clearAllCounter:",l.get("clearAllCounter")),console.log("[HostActionsButton] ==================== BROADCAST COMPLETE ====================")}catch(v){console.error(`[HostActionsButton] ❌ BROADCAST FAILED for action ${S}:`),console.error("[HostActionsButton] Error type:",typeof v),console.error("[HostActionsButton] Error message:",v instanceof Error?v.message:String(v)),console.error("[HostActionsButton] Error stack:",v instanceof Error?v.stack:"No stack trace"),console.error("[HostActionsButton] Full error object:",v)}}const f=()=>h("send-content-to-all"),p=async()=>{try{console.log("[HostActionsButton] Starting stage page..."),await h("start-stage-page",{active:!0}),console.log("[HostActionsButton] Sharing content to meeting stage...");const S=`${window.location.origin}${window.location.pathname}?page=stage`;console.log("[HostActionsButton] Stage page URL:",S),YM((m,v)=>{m?console.error("[HostActionsButton] Error sharing to stage:",m):console.log("[HostActionsButton] Successfully shared to stage:",v)},S)}catch(S){console.error("[HostActionsButton] Error in onStartStagePage:",S)}};return u||s?D.jsx("button",{className:"px-3 py-2 rounded-lg bg-gray-100 text-gray-400 cursor-not-allowed",disabled:!0,children:"Host Actions"}):d?D.jsx("button",{className:"px-3 py-2 rounded-lg bg-red-100 text-red-400 cursor-not-allowed",disabled:!0,children:"Live Share Error"}):D.jsxs("div",{className:"relative inline-block",ref:t,children:[D.jsxs("button",{type:"button",onClick:()=>e(S=>!S),disabled:!r,className:`px-4 py-2 rounded-lg font-medium transition-colors ${r?"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,"aria-haspopup":"menu","aria-expanded":n,children:["Host Actions",D.jsx("span",{className:"ml-2 inline-block align-middle",children:"▾"})]}),n&&r&&D.jsxs("div",{role:"menu","aria-label":"Host actions",className:"absolute right-0 mt-2 w-56 rounded-xl border border-gray-200 bg-white shadow-lg overflow-hidden z-50",children:[D.jsx("button",{role:"menuitem",onClick:()=>{e(!1),f()},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Send Content to All Canvases"}),D.jsx("button",{role:"menuitem",onClick:()=>{e(!1),p()},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Start Stage Page"})]})]})};function PY({userInfo:n,meetingInfo:e}){const[t,r]=H.useState(null),i=H.useCallback((o,a)=>{console.log("[PrivateWhiteboardApp] Canvas ready:",o.width,"x",o.height,o,a)},[]),s=H.useCallback(o=>{console.log("[PrivateWhiteboardApp] Controls ready:",o),r(o)},[]);return console.log("[PrivateWhiteboardApp] Render",{canvasControls:t}),D.jsx(_N,{children:D.jsxs("div",{className:"whiteboard-container private-whiteboard",children:[D.jsx(OY,{}),t&&D.jsx(xY,{canvasControls:t,userInfo:n,meetingInfo:e}),D.jsx("div",{className:"canvas-area",children:D.jsx("div",{className:"canvas-container",children:D.jsx(TY,{onCanvasReady:i,onControlsReady:s,userInfo:n})})})]})})}function O1({message:n="Loading..."}){return D.jsxs("div",{className:"loading-container",children:[D.jsx("div",{className:"spinner",style:{border:"4px solid #f3f3f3",borderTop:"4px solid #0078d4",borderRadius:"50%",width:"40px",height:"40px",animation:"spin 1s linear infinite"}}),D.jsx("p",{children:n}),D.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})}function RY({error:n}){return D.jsxs("div",{className:"error-container",children:[D.jsx("h2",{children:"Something went wrong"}),D.jsx("p",{children:n.message}),D.jsx("button",{onClick:()=>window.location.reload(),children:"Reload App"})]})}const kY=()=>{const{bus:n,flags:e,phase:t,loading:r,error:i}=FS(),[s,o]=H.useState(!1),[a,l]=H.useState(!1),[c,u]=H.useState(new Map),d=H.useRef(null),h=H.useRef(null),[f,p]=H.useState(!1),[g,S]=H.useState(null),m=H.useRef(!1),[v,y]=H.useState(1),[b,w]=H.useState({x:0,y:0}),[x,E]=H.useState(!1),[P,M]=H.useState(null);H.useEffect(()=>{if(e){const T=e.get("editingEnabled");o(!!T)}},[e]),H.useEffect(()=>{const T=d.current;if(!T)return;const I=T.getContext("2d");if(!I)return;I.lineCap="round",I.lineJoin="round",I.imageSmoothingEnabled=!0,I.fillStyle="#ffffff",I.fillRect(0,0,T.width,T.height),h.current=I;const C=()=>{(T.width!==1200||T.height!==800)&&(T.width=1200,T.height=800,I.fillStyle="#ffffff",I.fillRect(0,0,T.width,T.height),a&&c.size>0&&G())};return C(),window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C)}},[a,c]),H.useEffect(()=>{a&&c.size>0&&(console.log("[StagePage] Redrawing shared canvases"),G())},[c,a]),H.useEffect(()=>{const T=d.current,I=h.current;if(!T||!I)return;console.log("[StagePage] Applying zoom/pan transformation and redrawing:",{zoomLevel:v,panOffset:b});const C=I.getImageData(0,0,T.width,T.height);I.setTransform(1,0,0,1,0,0),I.clearRect(0,0,T.width,T.height),I.fillStyle="#ffffff",I.fillRect(0,0,T.width,T.height),a&&c.size>0&&G(),I.translate(b.x,b.y),I.scale(v,v);const R=document.createElement("canvas");R.width=T.width,R.height=T.height;const L=R.getContext("2d");L&&(L.putImageData(C,0,0),I.globalAlpha=1,I.globalCompositeOperation="source-over")},[v,b,a,c]);const F=()=>{const T=h.current;T&&(T.setTransform(1,0,0,1,0,0),T.translate(b.x,b.y),T.scale(v,v))};H.useEffect(()=>{if(!n||r){console.log("[StagePage] Live Share bus not ready yet, skipping event listener setup");return}console.log("[StagePage] Setting up Live Share event listener for canvas data");const T=I=>{console.log("[StagePage] Received Live Share event:",I),I.type==="canvasData"&&(console.log("[StagePage] Received canvas data from:",I.userName),u(C=>{const R=new Map(C);return R.set(I.userId,{imageData:I.imageData,width:I.width,height:I.height,userName:I.userName,userId:I.userId,timestamp:I.timestamp}),console.log("[StagePage] Canvas collection updated, total canvases:",R.size),R}))};return n.on("received",T),()=>{console.log("[StagePage] Cleaning up Live Share event listener"),n.off("received",T)}},[n,r]),H.useEffect(()=>{a&&c.size>0&&(console.log("[StagePage] Redrawing canvas grid with",c.size,"canvases"),G())},[c,a]);const G=()=>{const T=d.current,I=h.current;if(!T||!I||c.size===0)return;I.save(),I.setTransform(1,0,0,1,0,0);const C=Array.from(c.values()),R=C.length,L=Math.ceil(Math.sqrt(R)),U=Math.ceil(R/L),ne=480/640,ie=20,be=30,Ce=T.width-(L+1)*ie,vt=T.height-(U+1)*ie-be*U,ut=Ce/L,Xt=vt/U;let dt,On;ut/Xt>ne?(On=Xt*.6,dt=On*ne):(dt=ut*.6,On=dt/ne),console.log("[StagePage] Drawing grid:",{cols:L,rows:U,cellWidth:dt,cellHeight:On,numCanvases:R,aspectRatio:ne,maxCellWidth:ut,maxCellHeight:Xt}),C.forEach((zS,$S)=>{const EN=Math.floor($S/L),TN=$S%L,xN=dt+ie,ON=On+ie+be,PN=L*dt+(L-1)*ie,kf=(T.width-PN)/2+TN*xN,Nf=ie+be+EN*ON;I.fillStyle="#333",I.font="16px sans-serif",I.textAlign="center",I.fillText(zS.userName,kf+dt/2,Nf-10);const ls=new Image;ls.onload=()=>{I.save(),I.setTransform(1,0,0,1,0,0);const jS=Math.min(dt/ls.width,On/ls.height),qS=ls.width*jS,BS=ls.height*jS,RN=kf+(dt-qS)/2,kN=Nf+(On-BS)/2;I.strokeStyle="#ddd",I.lineWidth=2,I.strokeRect(kf,Nf,dt,On),I.drawImage(ls,RN,kN,qS,BS),I.restore()},ls.src=zS.imageData}),I.restore()},z=T=>{const I=d.current;if(!I)return{x:0,y:0};const C=I.getBoundingClientRect(),R=I.width/C.width,L=I.height/C.height;let U,ne;if("touches"in T&&T.touches.length>0)U=T.touches[0].clientX,ne=T.touches[0].clientY;else{const Ce=T;U=Ce.clientX,ne=Ce.clientY}const ie=((U-C.left)*R-b.x)/v,be=((ne-C.top)*L-b.y)/v;return{x:ie,y:be}},X=T=>({x:T.clientX,y:T.clientY}),V=T=>{T.preventDefault();const I=h.current;if(!I)return;if("button"in T&&T.button===1){E(!0);const R=X(T);M(R),console.log("[StagePage] Started panning at",R);return}const C=z(T);if("button"in T&&T.button===2){m.current=!0,p(!0),S(C),F(),I.globalCompositeOperation="destination-out",I.lineWidth=20,I.beginPath(),I.moveTo(C.x,C.y),console.log("[StagePage] Started right-click erase at",C);return}p(!0),S(C),F(),I.globalCompositeOperation="source-over",I.strokeStyle="#ff0000",I.lineWidth=3,I.globalAlpha=.8,I.beginPath(),I.moveTo(C.x,C.y),console.log("[StagePage] Started drawing at",C)},_=T=>{if(T.preventDefault(),x&&P&&"button"in T){const R=X(T),L=R.x-P.x,U=R.y-P.y;w(ne=>({x:ne.x+L,y:ne.y+U})),M(R),console.log("[StagePage] Panning by",{deltaX:L,deltaY:U});return}if(!f&&!m.current)return;const I=z(T),C=h.current;C&&(C.lineTo(I.x,I.y),C.stroke(),S(I),m.current&&console.log("[StagePage] Erasing at",I))},N=()=>{p(!1),E(!1),S(null),M(null);const T=h.current;T&&(T.beginPath(),m.current&&(T.globalCompositeOperation="source-over",m.current=!1,console.log("[StagePage] Stopped erasing, reset composite mode")))},W=T=>{T.preventDefault();const I=d.current;if(!I)return;const C=I.getBoundingClientRect(),R=T.clientX-C.left,L=T.clientY-C.top,U=T.deltaY>0?.9:1.1,ne=Math.max(.1,Math.min(5,v*U)),ie=ne/v,be=R-(R-b.x)*ie,Ce=L-(L-b.y)*ie;y(ne),w({x:be,y:Ce}),console.log("[StagePage] Zoom changed to",ne,"pan offset",{x:be,y:Ce})},A=()=>{const T=d.current,I=h.current;if(!T||!I){console.error("[StagePage] Canvas or context not available for clearing");return}try{console.log("[StagePage] Clearing stage canvas completely..."),I.setTransform(1,0,0,1,0,0),I.clearRect(0,0,T.width,T.height),I.fillStyle="#ffffff",I.fillRect(0,0,T.width,T.height),F(),console.log("[StagePage] ✅ Stage canvas cleared completely (including shared canvases)")}catch(C){console.error("[StagePage] ❌ Failed to clear stage canvas:",C)}},B=()=>{const T=d.current,I=h.current;if(!T||!I){console.error("[StagePage] Canvas or context not available for clearing annotations");return}try{console.log("[StagePage] Clearing annotations only, preserving shared canvases..."),I.setTransform(1,0,0,1,0,0),I.clearRect(0,0,T.width,T.height),I.fillStyle="#ffffff",I.fillRect(0,0,T.width,T.height),a&&c.size>0&&G(),F(),console.log("[StagePage] ✅ Annotations cleared, shared canvases preserved")}catch(C){console.error("[StagePage] ❌ Failed to clear annotations:",C)}},k=async()=>{if(!n||!e||!t){console.error("[StagePage] Live Share objects not available for toggle editing");return}try{const T=!s;console.log(`[StagePage] Broadcasting ${T?"enableCanvas":"disableCanvas"} event...`);const I={type:T?"enableCanvas":"disableCanvas",enabled:T,ts:Date.now()};await n.send(I),e.set("editingEnabled",T),e.set("lastAction",T?"enableCanvas":"disableCanvas"),e.set("lastActionAt",Date.now()),o(T),console.log(`[StagePage] ✅ ${T?"EnableCanvas":"DisableCanvas"} event broadcasted successfully`)}catch(T){console.error("[StagePage] ❌ Failed to broadcast toggle editing:",T)}},$=async()=>{if(!n||!e||!t){console.error("[StagePage] Live Share objects not available for share canvases");return}try{console.log("[StagePage] Broadcasting shareCanvas event..."),u(new Map);const T={type:"shareCanvas",requestId:Date.now().toString(),ts:Date.now()};await n.send(T),e.set("canvasesVisible",!0),e.set("lastAction","shareCanvas"),e.set("lastActionAt",Date.now()),l(!0),console.log("[StagePage] ✅ ShareCanvas event broadcasted successfully")}catch(T){console.error("[StagePage] ❌ Failed to broadcast share canvases:",T)}};return r?D.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:D.jsx("div",{className:"text-center",children:D.jsx("div",{className:"text-2xl text-indigo-600 mb-4",children:"Loading Live Share..."})})}):i?D.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center",children:D.jsxs("div",{className:"text-center",children:[D.jsx("div",{className:"text-2xl text-red-600 mb-4",children:"Live Share Error"}),D.jsx("div",{className:"text-red-500",children:i})]})}):D.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:[D.jsxs("div",{className:"flex gap-4 mb-8",children:[a?D.jsxs(D.Fragment,{children:[D.jsx("button",{onClick:B,className:"px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors text-sm",title:"Clear only host annotations, keep shared canvases",children:"Clear Annotations"}),D.jsx("button",{onClick:A,className:"px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors text-sm",title:"Clear everything including shared canvases",children:"Clear Everything"})]}):D.jsx("button",{onClick:A,className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Clear Canvas"}),D.jsx("button",{onClick:k,className:`px-6 py-3 font-medium rounded-lg transition-colors ${s?"bg-orange-600 hover:bg-orange-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:s?"Disable Editing":"Enable Editing"}),D.jsx("button",{onClick:$,className:`px-6 py-3 font-medium rounded-lg transition-colors ${a?"bg-purple-600 hover:bg-purple-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:a?"Refresh Canvases":"Share all canvases"}),D.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[D.jsx("button",{onClick:()=>{const T=Math.max(.1,v*.8);y(T)},className:"px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors text-sm",title:"Zoom Out",children:"−"}),D.jsxs("span",{className:"text-sm font-medium text-gray-700 min-w-[60px] text-center",children:[Math.round(v*100),"%"]}),D.jsx("button",{onClick:()=>{const T=Math.min(5,v*1.25);y(T)},className:"px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors text-sm",title:"Zoom In",children:"+"}),D.jsx("button",{onClick:()=>{y(1),w({x:0,y:0})},className:"px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm",title:"Reset Zoom & Pan",children:"Reset"})]})]}),D.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-lg p-6",style:{backgroundColor:"#ffffff",colorScheme:"light"},children:[D.jsxs("div",{className:"text-center mb-6",children:[D.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Stage Canvas"}),D.jsx("p",{className:"text-gray-600",children:a?"Draw over shared canvases • Left-click: Draw • Right-click: Erase • Mouse wheel: Zoom • Middle-click drag: Pan":"Interactive canvas for host annotations • Mouse wheel: Zoom • Middle-click drag: Pan"})]}),D.jsx("div",{className:"border border-gray-300 rounded-lg mx-auto overflow-auto bg-white",style:{maxWidth:"100%",maxHeight:"60vh",backgroundColor:"#ffffff"},children:D.jsx("canvas",{ref:d,width:1200,height:800,className:"block cursor-crosshair",onContextMenu:T=>{T.preventDefault()},onWheel:W,onMouseDown:V,onMouseMove:_,onMouseUp:N,onMouseLeave:N,onTouchStart:V,onTouchMove:_,onTouchEnd:N,style:{touchAction:"none",backgroundColor:"#ffffff",filter:"none",colorScheme:"light",minWidth:"800px",minHeight:"600px",cursor:x?"grabbing":"crosshair"}})})]})]})},P1=ZM();function NY(){const n=H.useRef(!1),[e,t]=H.useState(!1),[r,i]=H.useState(P1),[s,o]=H.useState(null),[a,l]=H.useState(null),[c,u]=H.useState(null),[d,h]=H.useState(!1),f=()=>new URLSearchParams(window.location.search).get("page")||"main",[p,g]=H.useState(f());if(H.useEffect(()=>{const m=()=>{g(f())};return window.addEventListener("popstate",m),()=>window.removeEventListener("popstate",m)},[]),H.useEffect(()=>{n.current||(n.current=!0,(async()=>{var m,v;try{console.log("App: Attempting Teams SDK initialize"),await Uy(),i(!0);const y=await oO(),b=(y==null?void 0:y.user)||{},w=(y==null?void 0:y.meeting)||{},x=(m=y==null?void 0:y.page)==null?void 0:m.frameContext,E=new Set(["meetingStage","meetingSidePanel","meetingChatTab","meetingDetailsTab"]),P=x&&E.has(x)||Array.isArray((v=y==null?void 0:y.page)==null?void 0:v.contexts)&&y.page.contexts.some(z=>E.has(z));h(!!P);const M={displayName:b.displayName,userPrincipalName:b.userPrincipalName||b.loginHint,loginHint:b.loginHint,id:b.id,userObjectId:b.id||b.userObjectId||b.aadObjectId,aadObjectId:b.aadObjectId||b.id};if(!M.displayName&&M.userPrincipalName){const z=M.userPrincipalName.split("@")[0];M.displayName=z.replace(/\./g," ")}const F=new URLSearchParams(window.location.search);!M.displayName&&F.get("user")&&(M.displayName=F.get("user")||void 0),!M.userPrincipalName&&F.get("upn")&&(M.userPrincipalName=F.get("upn")||void 0),l(M);let G=!1;P&&kd&&await new Promise(z=>{kd((X,V)=>{if(X)return console.info("App: meeting.getMeetingDetails not available here:",X),z();const _=(V==null?void 0:V.organizer)||{},N=(V==null?void 0:V.title)||(w==null?void 0:w.meetingTitle),W=!!(M.userPrincipalName&&(_!=null&&_.userPrincipalName)&&M.userPrincipalName.toLowerCase()===_.userPrincipalName.toLowerCase());u({title:N,organizer:{displayName:_==null?void 0:_.displayName,userPrincipalName:_==null?void 0:_.userPrincipalName,id:_==null?void 0:_.id},host:{displayName:_==null?void 0:_.displayName,userPrincipalName:_==null?void 0:_.userPrincipalName,id:_==null?void 0:_.id},isOrganizer:W}),G=!0,z()})}),!G&&(w!=null&&w.meetingTitle)&&u(z=>z||{title:w.meetingTitle}),vM(),yM(),t(!0),console.log("App: Teams client SDK initialized successfully")}catch(y){console.warn("App: Teams initialize failed; assuming non-Teams host.",y),i(!1),P1&&o(y)}})())},[]),r&&!e&&!s)return D.jsx(O1,{message:"Initializing Teams app..."});if(s)return D.jsx(RY,{error:s});const S=r&&e||!r;return p==="stage"?D.jsx(_N,{children:D.jsx(kY,{})}):D.jsx("div",{className:"app-container",children:S?D.jsx(PY,{userInfo:a||(r?{displayName:"Unknown User"}:{displayName:"Local Browser"}),meetingInfo:c}):D.jsx(O1,{message:"Loading..."})})}Im.createRoot(document.getElementById("root")).render(D.jsx(VN.StrictMode,{children:D.jsx(NY,{})}));export{w0 as a,t0 as b,x6 as c,PP as d,u6 as e,Mh as f,EP as g,d6 as h,L6 as i,IP as j,oi as k,OP as r,YH as s,Na as t};
