(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function pi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Lc(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var V1={exports:{}},mh={},W1={exports:{}},pe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ic=Symbol.for("react.element"),JN=Symbol.for("react.portal"),QN=Symbol.for("react.fragment"),XN=Symbol.for("react.strict_mode"),YN=Symbol.for("react.profiler"),ZN=Symbol.for("react.provider"),eL=Symbol.for("react.context"),tL=Symbol.for("react.forward_ref"),nL=Symbol.for("react.suspense"),rL=Symbol.for("react.memo"),iL=Symbol.for("react.lazy"),ib=Symbol.iterator;function sL(n){return n===null||typeof n!="object"?null:(n=ib&&n[ib]||n["@@iterator"],typeof n=="function"?n:null)}var G1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K1=Object.assign,J1={};function La(n,e,t){this.props=n,this.context=e,this.refs=J1,this.updater=t||G1}La.prototype.isReactComponent={};La.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};La.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Q1(){}Q1.prototype=La.prototype;function oy(n,e,t){this.props=n,this.context=e,this.refs=J1,this.updater=t||G1}var ay=oy.prototype=new Q1;ay.constructor=oy;K1(ay,La.prototype);ay.isPureReactComponent=!0;var sb=Array.isArray,X1=Object.prototype.hasOwnProperty,ly={current:null},Y1={key:!0,ref:!0,__self:!0,__source:!0};function Z1(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)X1.call(e,r)&&!Y1.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ic,type:n,key:s,ref:o,props:i,_owner:ly.current}}function oL(n,e){return{$$typeof:Ic,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function cy(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ic}function aL(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var ob=/\/+/g;function Gf(n,e){return typeof n=="object"&&n!==null&&n.key!=null?aL(""+n.key):e.toString(36)}function Uu(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ic:case JN:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+Gf(o,0):r,sb(i)?(t="",n!=null&&(t=n.replace(ob,"$&/")+"/"),Uu(i,e,t,"",function(c){return c})):i!=null&&(cy(i)&&(i=oL(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(ob,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",sb(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+Gf(s,a);o+=Uu(s,e,t,l,i)}else if(l=sL(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+Gf(s,a++),o+=Uu(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function fu(n,e,t){if(n==null)return n;var r=[],i=0;return Uu(n,r,"","",function(s){return e.call(t,s,i++)}),r}function lL(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var nn={current:null},Hu={transition:null},cL={ReactCurrentDispatcher:nn,ReactCurrentBatchConfig:Hu,ReactCurrentOwner:ly};function eT(){throw Error("act(...) is not supported in production builds of React.")}pe.Children={map:fu,forEach:function(n,e,t){fu(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return fu(n,function(){e++}),e},toArray:function(n){return fu(n,function(e){return e})||[]},only:function(n){if(!cy(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};pe.Component=La;pe.Fragment=QN;pe.Profiler=YN;pe.PureComponent=oy;pe.StrictMode=XN;pe.Suspense=nL;pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cL;pe.act=eT;pe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=K1({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=ly.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)X1.call(e,l)&&!Y1.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Ic,type:n.type,key:i,ref:s,props:r,_owner:o}};pe.createContext=function(n){return n={$$typeof:eL,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:ZN,_context:n},n.Consumer=n};pe.createElement=Z1;pe.createFactory=function(n){var e=Z1.bind(null,n);return e.type=n,e};pe.createRef=function(){return{current:null}};pe.forwardRef=function(n){return{$$typeof:tL,render:n}};pe.isValidElement=cy;pe.lazy=function(n){return{$$typeof:iL,_payload:{_status:-1,_result:n},_init:lL}};pe.memo=function(n,e){return{$$typeof:rL,type:n,compare:e===void 0?null:e}};pe.startTransition=function(n){var e=Hu.transition;Hu.transition={};try{n()}finally{Hu.transition=e}};pe.unstable_act=eT;pe.useCallback=function(n,e){return nn.current.useCallback(n,e)};pe.useContext=function(n){return nn.current.useContext(n)};pe.useDebugValue=function(){};pe.useDeferredValue=function(n){return nn.current.useDeferredValue(n)};pe.useEffect=function(n,e){return nn.current.useEffect(n,e)};pe.useId=function(){return nn.current.useId()};pe.useImperativeHandle=function(n,e,t){return nn.current.useImperativeHandle(n,e,t)};pe.useInsertionEffect=function(n,e){return nn.current.useInsertionEffect(n,e)};pe.useLayoutEffect=function(n,e){return nn.current.useLayoutEffect(n,e)};pe.useMemo=function(n,e){return nn.current.useMemo(n,e)};pe.useReducer=function(n,e,t){return nn.current.useReducer(n,e,t)};pe.useRef=function(n){return nn.current.useRef(n)};pe.useState=function(n){return nn.current.useState(n)};pe.useSyncExternalStore=function(n,e,t){return nn.current.useSyncExternalStore(n,e,t)};pe.useTransition=function(){return nn.current.useTransition()};pe.version="18.3.1";W1.exports=pe;var B=W1.exports;const uL=pi(B);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dL=B,hL=Symbol.for("react.element"),fL=Symbol.for("react.fragment"),pL=Object.prototype.hasOwnProperty,mL=dL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gL={key:!0,ref:!0,__self:!0,__source:!0};function tT(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)pL.call(e,r)&&!gL.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:hL,type:n,key:s,ref:o,props:i,_owner:mL.current}}mh.Fragment=fL;mh.jsx=tT;mh.jsxs=tT;V1.exports=mh;var D=V1.exports,Km={},nT={exports:{}},Ln={},rT={exports:{}},iT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(I,U){var x=I.length;I.push(U);e:for(;0<x;){var j=x-1>>>1,Q=I[j];if(0<i(Q,U))I[j]=U,I[x]=Q,x=j;else break e}}function t(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var U=I[0],x=I.pop();if(x!==U){I[0]=x;e:for(var j=0,Q=I.length,me=Q>>>1;j<me;){var _=2*(j+1)-1,R=I[_],M=_+1,H=I[M];if(0>i(R,x))M<Q&&0>i(H,R)?(I[j]=H,I[M]=x,j=M):(I[j]=R,I[_]=x,j=_);else if(M<Q&&0>i(H,x))I[j]=H,I[M]=x,j=M;else break e}}return U}function i(I,U){var x=I.sortIndex-U.sortIndex;return x!==0?x:I.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,g=!1,S=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(I){for(var U=t(c);U!==null;){if(U.callback===null)r(c);else if(U.startTime<=I)r(c),U.sortIndex=U.expirationTime,e(l,U);else break;U=t(c)}}function b(I){if(g=!1,y(I),!p)if(t(l)!==null)p=!0,k(w);else{var U=t(c);U!==null&&V(b,U.startTime-I)}}function w(I,U){p=!1,g&&(g=!1,m(O),O=-1),f=!0;var x=h;try{for(y(U),d=t(l);d!==null&&(!(d.expirationTime>U)||I&&!X());){var j=d.callback;if(typeof j=="function"){d.callback=null,h=d.priorityLevel;var Q=j(d.expirationTime<=U);U=n.unstable_now(),typeof Q=="function"?d.callback=Q:d===t(l)&&r(l),y(U)}else r(l);d=t(l)}if(d!==null)var me=!0;else{var _=t(c);_!==null&&V(b,_.startTime-U),me=!1}return me}finally{d=null,h=x,f=!1}}var T=!1,E=null,O=-1,A=5,F=-1;function X(){return!(n.unstable_now()-F<A)}function z(){if(E!==null){var I=n.unstable_now();F=I;var U=!0;try{U=E(!0,I)}finally{U?Z():(T=!1,E=null)}}else T=!1}var Z;if(typeof v=="function")Z=function(){v(z)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,C=W.port2;W.port1.onmessage=z,Z=function(){C.postMessage(null)}}else Z=function(){S(z,0)};function k(I){E=I,T||(T=!0,Z())}function V(I,U){O=S(function(){I(n.unstable_now())},U)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(I){I.callback=null},n.unstable_continueExecution=function(){p||f||(p=!0,k(w))},n.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<I?Math.floor(1e3/I):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(I){switch(h){case 1:case 2:case 3:var U=3;break;default:U=h}var x=h;h=U;try{return I()}finally{h=x}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(I,U){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var x=h;h=I;try{return U()}finally{h=x}},n.unstable_scheduleCallback=function(I,U,x){var j=n.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?j+x:j):x=j,I){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=x+Q,I={id:u++,callback:U,priorityLevel:I,startTime:x,expirationTime:Q,sortIndex:-1},x>j?(I.sortIndex=x,e(c,I),t(l)===null&&I===t(c)&&(g?(m(O),O=-1):g=!0,V(b,x-j))):(I.sortIndex=Q,e(l,I),p||f||(p=!0,k(w))),I},n.unstable_shouldYield=X,n.unstable_wrapCallback=function(I){var U=h;return function(){var x=h;h=U;try{return I.apply(this,arguments)}finally{h=x}}}})(iT);rT.exports=iT;var vL=rT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yL=B,Pn=vL;function $(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sT=new Set,Xl={};function uo(n,e){pa(n,e),pa(n+"Capture",e)}function pa(n,e){for(Xl[n]=e,n=0;n<e.length;n++)sT.add(e[n])}var ai=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jm=Object.prototype.hasOwnProperty,SL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ab={},lb={};function bL(n){return Jm.call(lb,n)?!0:Jm.call(ab,n)?!1:SL.test(n)?lb[n]=!0:(ab[n]=!0,!1)}function wL(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function CL(n,e,t,r){if(e===null||typeof e>"u"||wL(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function rn(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){kt[n]=new rn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];kt[e]=new rn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){kt[n]=new rn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){kt[n]=new rn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){kt[n]=new rn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){kt[n]=new rn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){kt[n]=new rn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){kt[n]=new rn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){kt[n]=new rn(n,5,!1,n.toLowerCase(),null,!1,!1)});var uy=/[\-:]([a-z])/g;function dy(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(uy,dy);kt[e]=new rn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(uy,dy);kt[e]=new rn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(uy,dy);kt[e]=new rn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){kt[n]=new rn(n,1,!1,n.toLowerCase(),null,!1,!1)});kt.xlinkHref=new rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){kt[n]=new rn(n,1,!1,n.toLowerCase(),null,!0,!0)});function hy(n,e,t,r){var i=kt.hasOwnProperty(e)?kt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(CL(e,t,i,r)&&(t=null),r||i===null?bL(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var mi=yL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pu=Symbol.for("react.element"),Fo=Symbol.for("react.portal"),zo=Symbol.for("react.fragment"),fy=Symbol.for("react.strict_mode"),Qm=Symbol.for("react.profiler"),oT=Symbol.for("react.provider"),aT=Symbol.for("react.context"),py=Symbol.for("react.forward_ref"),Xm=Symbol.for("react.suspense"),Ym=Symbol.for("react.suspense_list"),my=Symbol.for("react.memo"),Oi=Symbol.for("react.lazy"),lT=Symbol.for("react.offscreen"),cb=Symbol.iterator;function tl(n){return n===null||typeof n!="object"?null:(n=cb&&n[cb]||n["@@iterator"],typeof n=="function"?n:null)}var Ze=Object.assign,Kf;function Cl(n){if(Kf===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Kf=e&&e[1]||""}return`
`+Kf+n}var Jf=!1;function Qf(n,e){if(!n||Jf)return"";Jf=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Jf=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Cl(n):""}function EL(n){switch(n.tag){case 5:return Cl(n.type);case 16:return Cl("Lazy");case 13:return Cl("Suspense");case 19:return Cl("SuspenseList");case 0:case 2:case 15:return n=Qf(n.type,!1),n;case 11:return n=Qf(n.type.render,!1),n;case 1:return n=Qf(n.type,!0),n;default:return""}}function Zm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case zo:return"Fragment";case Fo:return"Portal";case Qm:return"Profiler";case fy:return"StrictMode";case Xm:return"Suspense";case Ym:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case aT:return(n.displayName||"Context")+".Consumer";case oT:return(n._context.displayName||"Context")+".Provider";case py:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case my:return e=n.displayName||null,e!==null?e:Zm(n.type)||"Memo";case Oi:e=n._payload,n=n._init;try{return Zm(n(e))}catch{}}return null}function _L(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zm(e);case 8:return e===fy?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ss(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function cT(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function TL(n){var e=cT(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function mu(n){n._valueTracker||(n._valueTracker=TL(n))}function uT(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=cT(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function vd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function eg(n,e){var t=e.checked;return Ze({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function ub(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=ss(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function dT(n,e){e=e.checked,e!=null&&hy(n,"checked",e,!1)}function tg(n,e){dT(n,e);var t=ss(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?ng(n,e.type,t):e.hasOwnProperty("defaultValue")&&ng(n,e.type,ss(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function db(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function ng(n,e,t){(e!=="number"||vd(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var El=Array.isArray;function Xo(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+ss(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function rg(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error($(91));return Ze({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function hb(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error($(92));if(El(t)){if(1<t.length)throw Error($(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ss(t)}}function hT(n,e){var t=ss(e.value),r=ss(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function fb(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function fT(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ig(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?fT(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var gu,pT=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(gu=gu||document.createElement("div"),gu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gu.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Yl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Rl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xL=["Webkit","ms","Moz","O"];Object.keys(Rl).forEach(function(n){xL.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Rl[e]=Rl[n]})});function mT(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Rl.hasOwnProperty(n)&&Rl[n]?(""+e).trim():e+"px"}function gT(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=mT(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var OL=Ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sg(n,e){if(e){if(OL[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error($(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error($(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error($(61))}if(e.style!=null&&typeof e.style!="object")throw Error($(62))}}function og(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ag=null;function gy(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var lg=null,Yo=null,Zo=null;function pb(n){if(n=Dc(n)){if(typeof lg!="function")throw Error($(280));var e=n.stateNode;e&&(e=bh(e),lg(n.stateNode,n.type,e))}}function vT(n){Yo?Zo?Zo.push(n):Zo=[n]:Yo=n}function yT(){if(Yo){var n=Yo,e=Zo;if(Zo=Yo=null,pb(n),e)for(n=0;n<e.length;n++)pb(e[n])}}function ST(n,e){return n(e)}function bT(){}var Xf=!1;function wT(n,e,t){if(Xf)return n(e,t);Xf=!0;try{return ST(n,e,t)}finally{Xf=!1,(Yo!==null||Zo!==null)&&(bT(),yT())}}function Zl(n,e){var t=n.stateNode;if(t===null)return null;var r=bh(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error($(231,e,typeof t));return t}var cg=!1;if(ai)try{var nl={};Object.defineProperty(nl,"passive",{get:function(){cg=!0}}),window.addEventListener("test",nl,nl),window.removeEventListener("test",nl,nl)}catch{cg=!1}function PL(n,e,t,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var kl=!1,yd=null,Sd=!1,ug=null,RL={onError:function(n){kl=!0,yd=n}};function kL(n,e,t,r,i,s,o,a,l){kl=!1,yd=null,PL.apply(RL,arguments)}function NL(n,e,t,r,i,s,o,a,l){if(kL.apply(this,arguments),kl){if(kl){var c=yd;kl=!1,yd=null}else throw Error($(198));Sd||(Sd=!0,ug=c)}}function ho(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function CT(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function mb(n){if(ho(n)!==n)throw Error($(188))}function LL(n){var e=n.alternate;if(!e){if(e=ho(n),e===null)throw Error($(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return mb(i),n;if(s===r)return mb(i),e;s=s.sibling}throw Error($(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error($(189))}}if(t.alternate!==r)throw Error($(190))}if(t.tag!==3)throw Error($(188));return t.stateNode.current===t?n:e}function ET(n){return n=LL(n),n!==null?_T(n):null}function _T(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=_T(n);if(e!==null)return e;n=n.sibling}return null}var TT=Pn.unstable_scheduleCallback,gb=Pn.unstable_cancelCallback,IL=Pn.unstable_shouldYield,AL=Pn.unstable_requestPaint,it=Pn.unstable_now,ML=Pn.unstable_getCurrentPriorityLevel,vy=Pn.unstable_ImmediatePriority,xT=Pn.unstable_UserBlockingPriority,bd=Pn.unstable_NormalPriority,DL=Pn.unstable_LowPriority,OT=Pn.unstable_IdlePriority,gh=null,xr=null;function FL(n){if(xr&&typeof xr.onCommitFiberRoot=="function")try{xr.onCommitFiberRoot(gh,n,void 0,(n.current.flags&128)===128)}catch{}}var sr=Math.clz32?Math.clz32:jL,zL=Math.log,$L=Math.LN2;function jL(n){return n>>>=0,n===0?32:31-(zL(n)/$L|0)|0}var vu=64,yu=4194304;function _l(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function wd(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=_l(a):(s&=o,s!==0&&(r=_l(s)))}else o=t&~i,o!==0?r=_l(o):s!==0&&(r=_l(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-sr(e),i=1<<t,r|=n[t],e&=~i;return r}function qL(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function BL(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-sr(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=qL(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function dg(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function PT(){var n=vu;return vu<<=1,!(vu&4194240)&&(vu=64),n}function Yf(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Ac(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-sr(e),n[e]=t}function UL(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-sr(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function yy(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-sr(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Pe=0;function RT(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var kT,Sy,NT,LT,IT,hg=!1,Su=[],Ui=null,Hi=null,Vi=null,ec=new Map,tc=new Map,Ni=[],HL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vb(n,e){switch(n){case"focusin":case"focusout":Ui=null;break;case"dragenter":case"dragleave":Hi=null;break;case"mouseover":case"mouseout":Vi=null;break;case"pointerover":case"pointerout":ec.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":tc.delete(e.pointerId)}}function rl(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Dc(e),e!==null&&Sy(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function VL(n,e,t,r,i){switch(e){case"focusin":return Ui=rl(Ui,n,e,t,r,i),!0;case"dragenter":return Hi=rl(Hi,n,e,t,r,i),!0;case"mouseover":return Vi=rl(Vi,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return ec.set(s,rl(ec.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,tc.set(s,rl(tc.get(s)||null,n,e,t,r,i)),!0}return!1}function AT(n){var e=zs(n.target);if(e!==null){var t=ho(e);if(t!==null){if(e=t.tag,e===13){if(e=CT(t),e!==null){n.blockedOn=e,IT(n.priority,function(){NT(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Vu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=fg(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);ag=r,t.target.dispatchEvent(r),ag=null}else return e=Dc(t),e!==null&&Sy(e),n.blockedOn=t,!1;e.shift()}return!0}function yb(n,e,t){Vu(n)&&t.delete(e)}function WL(){hg=!1,Ui!==null&&Vu(Ui)&&(Ui=null),Hi!==null&&Vu(Hi)&&(Hi=null),Vi!==null&&Vu(Vi)&&(Vi=null),ec.forEach(yb),tc.forEach(yb)}function il(n,e){n.blockedOn===e&&(n.blockedOn=null,hg||(hg=!0,Pn.unstable_scheduleCallback(Pn.unstable_NormalPriority,WL)))}function nc(n){function e(i){return il(i,n)}if(0<Su.length){il(Su[0],n);for(var t=1;t<Su.length;t++){var r=Su[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ui!==null&&il(Ui,n),Hi!==null&&il(Hi,n),Vi!==null&&il(Vi,n),ec.forEach(e),tc.forEach(e),t=0;t<Ni.length;t++)r=Ni[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ni.length&&(t=Ni[0],t.blockedOn===null);)AT(t),t.blockedOn===null&&Ni.shift()}var ea=mi.ReactCurrentBatchConfig,Cd=!0;function GL(n,e,t,r){var i=Pe,s=ea.transition;ea.transition=null;try{Pe=1,by(n,e,t,r)}finally{Pe=i,ea.transition=s}}function KL(n,e,t,r){var i=Pe,s=ea.transition;ea.transition=null;try{Pe=4,by(n,e,t,r)}finally{Pe=i,ea.transition=s}}function by(n,e,t,r){if(Cd){var i=fg(n,e,t,r);if(i===null)lp(n,e,r,Ed,t),vb(n,r);else if(VL(i,n,e,t,r))r.stopPropagation();else if(vb(n,r),e&4&&-1<HL.indexOf(n)){for(;i!==null;){var s=Dc(i);if(s!==null&&kT(s),s=fg(n,e,t,r),s===null&&lp(n,e,r,Ed,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else lp(n,e,r,null,t)}}var Ed=null;function fg(n,e,t,r){if(Ed=null,n=gy(r),n=zs(n),n!==null)if(e=ho(n),e===null)n=null;else if(t=e.tag,t===13){if(n=CT(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Ed=n,null}function MT(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ML()){case vy:return 1;case xT:return 4;case bd:case DL:return 16;case OT:return 536870912;default:return 16}default:return 16}}var Ai=null,wy=null,Wu=null;function DT(){if(Wu)return Wu;var n,e=wy,t=e.length,r,i="value"in Ai?Ai.value:Ai.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return Wu=i.slice(n,1<r?1-r:void 0)}function Gu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function bu(){return!0}function Sb(){return!1}function In(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?bu:Sb,this.isPropagationStopped=Sb,this}return Ze(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=bu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=bu)},persist:function(){},isPersistent:bu}),e}var Ia={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cy=In(Ia),Mc=Ze({},Ia,{view:0,detail:0}),JL=In(Mc),Zf,ep,sl,vh=Ze({},Mc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ey,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==sl&&(sl&&n.type==="mousemove"?(Zf=n.screenX-sl.screenX,ep=n.screenY-sl.screenY):ep=Zf=0,sl=n),Zf)},movementY:function(n){return"movementY"in n?n.movementY:ep}}),bb=In(vh),QL=Ze({},vh,{dataTransfer:0}),XL=In(QL),YL=Ze({},Mc,{relatedTarget:0}),tp=In(YL),ZL=Ze({},Ia,{animationName:0,elapsedTime:0,pseudoElement:0}),eI=In(ZL),tI=Ze({},Ia,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),nI=In(tI),rI=Ze({},Ia,{data:0}),wb=In(rI),iI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aI(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=oI[n])?!!e[n]:!1}function Ey(){return aI}var lI=Ze({},Mc,{key:function(n){if(n.key){var e=iI[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Gu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?sI[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ey,charCode:function(n){return n.type==="keypress"?Gu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Gu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),cI=In(lI),uI=Ze({},vh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cb=In(uI),dI=Ze({},Mc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ey}),hI=In(dI),fI=Ze({},Ia,{propertyName:0,elapsedTime:0,pseudoElement:0}),pI=In(fI),mI=Ze({},vh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),gI=In(mI),vI=[9,13,27,32],_y=ai&&"CompositionEvent"in window,Nl=null;ai&&"documentMode"in document&&(Nl=document.documentMode);var yI=ai&&"TextEvent"in window&&!Nl,FT=ai&&(!_y||Nl&&8<Nl&&11>=Nl),Eb=String.fromCharCode(32),_b=!1;function zT(n,e){switch(n){case"keyup":return vI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $T(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var $o=!1;function SI(n,e){switch(n){case"compositionend":return $T(e);case"keypress":return e.which!==32?null:(_b=!0,Eb);case"textInput":return n=e.data,n===Eb&&_b?null:n;default:return null}}function bI(n,e){if($o)return n==="compositionend"||!_y&&zT(n,e)?(n=DT(),Wu=wy=Ai=null,$o=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return FT&&e.locale!=="ko"?null:e.data;default:return null}}var wI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!wI[n.type]:e==="textarea"}function jT(n,e,t,r){vT(r),e=_d(e,"onChange"),0<e.length&&(t=new Cy("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Ll=null,rc=null;function CI(n){XT(n,0)}function yh(n){var e=Bo(n);if(uT(e))return n}function EI(n,e){if(n==="change")return e}var qT=!1;if(ai){var np;if(ai){var rp="oninput"in document;if(!rp){var xb=document.createElement("div");xb.setAttribute("oninput","return;"),rp=typeof xb.oninput=="function"}np=rp}else np=!1;qT=np&&(!document.documentMode||9<document.documentMode)}function Ob(){Ll&&(Ll.detachEvent("onpropertychange",BT),rc=Ll=null)}function BT(n){if(n.propertyName==="value"&&yh(rc)){var e=[];jT(e,rc,n,gy(n)),wT(CI,e)}}function _I(n,e,t){n==="focusin"?(Ob(),Ll=e,rc=t,Ll.attachEvent("onpropertychange",BT)):n==="focusout"&&Ob()}function TI(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return yh(rc)}function xI(n,e){if(n==="click")return yh(e)}function OI(n,e){if(n==="input"||n==="change")return yh(e)}function PI(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var cr=typeof Object.is=="function"?Object.is:PI;function ic(n,e){if(cr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Jm.call(e,i)||!cr(n[i],e[i]))return!1}return!0}function Pb(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Rb(n,e){var t=Pb(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Pb(t)}}function UT(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?UT(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function HT(){for(var n=window,e=vd();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=vd(n.document)}return e}function Ty(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function RI(n){var e=HT(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&UT(t.ownerDocument.documentElement,t)){if(r!==null&&Ty(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=Rb(t,s);var o=Rb(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var kI=ai&&"documentMode"in document&&11>=document.documentMode,jo=null,pg=null,Il=null,mg=!1;function kb(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;mg||jo==null||jo!==vd(r)||(r=jo,"selectionStart"in r&&Ty(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Il&&ic(Il,r)||(Il=r,r=_d(pg,"onSelect"),0<r.length&&(e=new Cy("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=jo)))}function wu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var qo={animationend:wu("Animation","AnimationEnd"),animationiteration:wu("Animation","AnimationIteration"),animationstart:wu("Animation","AnimationStart"),transitionend:wu("Transition","TransitionEnd")},ip={},VT={};ai&&(VT=document.createElement("div").style,"AnimationEvent"in window||(delete qo.animationend.animation,delete qo.animationiteration.animation,delete qo.animationstart.animation),"TransitionEvent"in window||delete qo.transitionend.transition);function Sh(n){if(ip[n])return ip[n];if(!qo[n])return n;var e=qo[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in VT)return ip[n]=e[t];return n}var WT=Sh("animationend"),GT=Sh("animationiteration"),KT=Sh("animationstart"),JT=Sh("transitionend"),QT=new Map,Nb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function us(n,e){QT.set(n,e),uo(e,[n])}for(var sp=0;sp<Nb.length;sp++){var op=Nb[sp],NI=op.toLowerCase(),LI=op[0].toUpperCase()+op.slice(1);us(NI,"on"+LI)}us(WT,"onAnimationEnd");us(GT,"onAnimationIteration");us(KT,"onAnimationStart");us("dblclick","onDoubleClick");us("focusin","onFocus");us("focusout","onBlur");us(JT,"onTransitionEnd");pa("onMouseEnter",["mouseout","mouseover"]);pa("onMouseLeave",["mouseout","mouseover"]);pa("onPointerEnter",["pointerout","pointerover"]);pa("onPointerLeave",["pointerout","pointerover"]);uo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));uo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));uo("onBeforeInput",["compositionend","keypress","textInput","paste"]);uo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));uo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));uo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),II=new Set("cancel close invalid load scroll toggle".split(" ").concat(Tl));function Lb(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,NL(r,e,void 0,n),n.currentTarget=null}function XT(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Lb(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Lb(i,a,c),s=l}}}if(Sd)throw n=ug,Sd=!1,ug=null,n}function De(n,e){var t=e[bg];t===void 0&&(t=e[bg]=new Set);var r=n+"__bubble";t.has(r)||(YT(e,n,2,!1),t.add(r))}function ap(n,e,t){var r=0;e&&(r|=4),YT(t,n,r,e)}var Cu="_reactListening"+Math.random().toString(36).slice(2);function sc(n){if(!n[Cu]){n[Cu]=!0,sT.forEach(function(t){t!=="selectionchange"&&(II.has(t)||ap(t,!1,n),ap(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Cu]||(e[Cu]=!0,ap("selectionchange",!1,e))}}function YT(n,e,t,r){switch(MT(e)){case 1:var i=GL;break;case 4:i=KL;break;default:i=by}t=i.bind(null,e,t,n),i=void 0,!cg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function lp(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=zs(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}wT(function(){var c=s,u=gy(t),d=[];e:{var h=QT.get(n);if(h!==void 0){var f=Cy,p=n;switch(n){case"keypress":if(Gu(t)===0)break e;case"keydown":case"keyup":f=cI;break;case"focusin":p="focus",f=tp;break;case"focusout":p="blur",f=tp;break;case"beforeblur":case"afterblur":f=tp;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=bb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=XL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=hI;break;case WT:case GT:case KT:f=eI;break;case JT:f=pI;break;case"scroll":f=JL;break;case"wheel":f=gI;break;case"copy":case"cut":case"paste":f=nI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Cb}var g=(e&4)!==0,S=!g&&n==="scroll",m=g?h!==null?h+"Capture":null:h;g=[];for(var v=c,y;v!==null;){y=v;var b=y.stateNode;if(y.tag===5&&b!==null&&(y=b,m!==null&&(b=Zl(v,m),b!=null&&g.push(oc(v,b,y)))),S)break;v=v.return}0<g.length&&(h=new f(h,p,null,t,u),d.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==ag&&(p=t.relatedTarget||t.fromElement)&&(zs(p)||p[li]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=c,p=p?zs(p):null,p!==null&&(S=ho(p),p!==S||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(g=bb,b="onMouseLeave",m="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(g=Cb,b="onPointerLeave",m="onPointerEnter",v="pointer"),S=f==null?h:Bo(f),y=p==null?h:Bo(p),h=new g(b,v+"leave",f,t,u),h.target=S,h.relatedTarget=y,b=null,zs(u)===c&&(g=new g(m,v+"enter",p,t,u),g.target=y,g.relatedTarget=S,b=g),S=b,f&&p)t:{for(g=f,m=p,v=0,y=g;y;y=To(y))v++;for(y=0,b=m;b;b=To(b))y++;for(;0<v-y;)g=To(g),v--;for(;0<y-v;)m=To(m),y--;for(;v--;){if(g===m||m!==null&&g===m.alternate)break t;g=To(g),m=To(m)}g=null}else g=null;f!==null&&Ib(d,h,f,g,!1),p!==null&&S!==null&&Ib(d,S,p,g,!0)}}e:{if(h=c?Bo(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var w=EI;else if(Tb(h))if(qT)w=OI;else{w=TI;var T=_I}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(w=xI);if(w&&(w=w(n,c))){jT(d,w,t,u);break e}T&&T(n,h,c),n==="focusout"&&(T=h._wrapperState)&&T.controlled&&h.type==="number"&&ng(h,"number",h.value)}switch(T=c?Bo(c):window,n){case"focusin":(Tb(T)||T.contentEditable==="true")&&(jo=T,pg=c,Il=null);break;case"focusout":Il=pg=jo=null;break;case"mousedown":mg=!0;break;case"contextmenu":case"mouseup":case"dragend":mg=!1,kb(d,t,u);break;case"selectionchange":if(kI)break;case"keydown":case"keyup":kb(d,t,u)}var E;if(_y)e:{switch(n){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else $o?zT(n,t)&&(O="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(O="onCompositionStart");O&&(FT&&t.locale!=="ko"&&($o||O!=="onCompositionStart"?O==="onCompositionEnd"&&$o&&(E=DT()):(Ai=u,wy="value"in Ai?Ai.value:Ai.textContent,$o=!0)),T=_d(c,O),0<T.length&&(O=new wb(O,n,null,t,u),d.push({event:O,listeners:T}),E?O.data=E:(E=$T(t),E!==null&&(O.data=E)))),(E=yI?SI(n,t):bI(n,t))&&(c=_d(c,"onBeforeInput"),0<c.length&&(u=new wb("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=E))}XT(d,e)})}function oc(n,e,t){return{instance:n,listener:e,currentTarget:t}}function _d(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Zl(n,t),s!=null&&r.unshift(oc(n,s,i)),s=Zl(n,e),s!=null&&r.push(oc(n,s,i))),n=n.return}return r}function To(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ib(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Zl(t,s),l!=null&&o.unshift(oc(t,l,a))):i||(l=Zl(t,s),l!=null&&o.push(oc(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var AI=/\r\n?/g,MI=/\u0000|\uFFFD/g;function Ab(n){return(typeof n=="string"?n:""+n).replace(AI,`
`).replace(MI,"")}function Eu(n,e,t){if(e=Ab(e),Ab(n)!==e&&t)throw Error($(425))}function Td(){}var gg=null,vg=null;function yg(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Sg=typeof setTimeout=="function"?setTimeout:void 0,DI=typeof clearTimeout=="function"?clearTimeout:void 0,Mb=typeof Promise=="function"?Promise:void 0,FI=typeof queueMicrotask=="function"?queueMicrotask:typeof Mb<"u"?function(n){return Mb.resolve(null).then(n).catch(zI)}:Sg;function zI(n){setTimeout(function(){throw n})}function cp(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),nc(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);nc(e)}function Wi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Db(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Aa=Math.random().toString(36).slice(2),wr="__reactFiber$"+Aa,ac="__reactProps$"+Aa,li="__reactContainer$"+Aa,bg="__reactEvents$"+Aa,$I="__reactListeners$"+Aa,jI="__reactHandles$"+Aa;function zs(n){var e=n[wr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[li]||t[wr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Db(n);n!==null;){if(t=n[wr])return t;n=Db(n)}return e}n=t,t=n.parentNode}return null}function Dc(n){return n=n[wr]||n[li],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Bo(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error($(33))}function bh(n){return n[ac]||null}var wg=[],Uo=-1;function ds(n){return{current:n}}function $e(n){0>Uo||(n.current=wg[Uo],wg[Uo]=null,Uo--)}function Me(n,e){Uo++,wg[Uo]=n.current,n.current=e}var os={},Ut=ds(os),un=ds(!1),Xs=os;function ma(n,e){var t=n.type.contextTypes;if(!t)return os;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function dn(n){return n=n.childContextTypes,n!=null}function xd(){$e(un),$e(Ut)}function Fb(n,e,t){if(Ut.current!==os)throw Error($(168));Me(Ut,e),Me(un,t)}function ZT(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error($(108,_L(n)||"Unknown",i));return Ze({},t,r)}function Od(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||os,Xs=Ut.current,Me(Ut,n),Me(un,un.current),!0}function zb(n,e,t){var r=n.stateNode;if(!r)throw Error($(169));t?(n=ZT(n,e,Xs),r.__reactInternalMemoizedMergedChildContext=n,$e(un),$e(Ut),Me(Ut,n)):$e(un),Me(un,t)}var Xr=null,wh=!1,up=!1;function ex(n){Xr===null?Xr=[n]:Xr.push(n)}function qI(n){wh=!0,ex(n)}function hs(){if(!up&&Xr!==null){up=!0;var n=0,e=Pe;try{var t=Xr;for(Pe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Xr=null,wh=!1}catch(i){throw Xr!==null&&(Xr=Xr.slice(n+1)),TT(vy,hs),i}finally{Pe=e,up=!1}}return null}var Ho=[],Vo=0,Pd=null,Rd=0,Mn=[],Dn=0,Ys=null,Zr=1,ei="";function bs(n,e){Ho[Vo++]=Rd,Ho[Vo++]=Pd,Pd=n,Rd=e}function tx(n,e,t){Mn[Dn++]=Zr,Mn[Dn++]=ei,Mn[Dn++]=Ys,Ys=n;var r=Zr;n=ei;var i=32-sr(r)-1;r&=~(1<<i),t+=1;var s=32-sr(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Zr=1<<32-sr(e)+i|t<<i|r,ei=s+n}else Zr=1<<s|t<<i|r,ei=n}function xy(n){n.return!==null&&(bs(n,1),tx(n,1,0))}function Oy(n){for(;n===Pd;)Pd=Ho[--Vo],Ho[Vo]=null,Rd=Ho[--Vo],Ho[Vo]=null;for(;n===Ys;)Ys=Mn[--Dn],Mn[Dn]=null,ei=Mn[--Dn],Mn[Dn]=null,Zr=Mn[--Dn],Mn[Dn]=null}var On=null,Tn=null,Ve=!1,nr=null;function nx(n,e){var t=qn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function $b(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,On=n,Tn=Wi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,On=n,Tn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ys!==null?{id:Zr,overflow:ei}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=qn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,On=n,Tn=null,!0):!1;default:return!1}}function Cg(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Eg(n){if(Ve){var e=Tn;if(e){var t=e;if(!$b(n,e)){if(Cg(n))throw Error($(418));e=Wi(t.nextSibling);var r=On;e&&$b(n,e)?nx(r,t):(n.flags=n.flags&-4097|2,Ve=!1,On=n)}}else{if(Cg(n))throw Error($(418));n.flags=n.flags&-4097|2,Ve=!1,On=n}}}function jb(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;On=n}function _u(n){if(n!==On)return!1;if(!Ve)return jb(n),Ve=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!yg(n.type,n.memoizedProps)),e&&(e=Tn)){if(Cg(n))throw rx(),Error($(418));for(;e;)nx(n,e),e=Wi(e.nextSibling)}if(jb(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error($(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Tn=Wi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Tn=null}}else Tn=On?Wi(n.stateNode.nextSibling):null;return!0}function rx(){for(var n=Tn;n;)n=Wi(n.nextSibling)}function ga(){Tn=On=null,Ve=!1}function Py(n){nr===null?nr=[n]:nr.push(n)}var BI=mi.ReactCurrentBatchConfig;function ol(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error($(309));var r=t.stateNode}if(!r)throw Error($(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error($(284));if(!t._owner)throw Error($(290,n))}return n}function Tu(n,e){throw n=Object.prototype.toString.call(e),Error($(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function qb(n){var e=n._init;return e(n._payload)}function ix(n){function e(m,v){if(n){var y=m.deletions;y===null?(m.deletions=[v],m.flags|=16):y.push(v)}}function t(m,v){if(!n)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function r(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function i(m,v){return m=Qi(m,v),m.index=0,m.sibling=null,m}function s(m,v,y){return m.index=y,n?(y=m.alternate,y!==null?(y=y.index,y<v?(m.flags|=2,v):y):(m.flags|=2,v)):(m.flags|=1048576,v)}function o(m){return n&&m.alternate===null&&(m.flags|=2),m}function a(m,v,y,b){return v===null||v.tag!==6?(v=vp(y,m.mode,b),v.return=m,v):(v=i(v,y),v.return=m,v)}function l(m,v,y,b){var w=y.type;return w===zo?u(m,v,y.props.children,b,y.key):v!==null&&(v.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Oi&&qb(w)===v.type)?(b=i(v,y.props),b.ref=ol(m,v,y),b.return=m,b):(b=ed(y.type,y.key,y.props,null,m.mode,b),b.ref=ol(m,v,y),b.return=m,b)}function c(m,v,y,b){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=yp(y,m.mode,b),v.return=m,v):(v=i(v,y.children||[]),v.return=m,v)}function u(m,v,y,b,w){return v===null||v.tag!==7?(v=Vs(y,m.mode,b,w),v.return=m,v):(v=i(v,y),v.return=m,v)}function d(m,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=vp(""+v,m.mode,y),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case pu:return y=ed(v.type,v.key,v.props,null,m.mode,y),y.ref=ol(m,null,v),y.return=m,y;case Fo:return v=yp(v,m.mode,y),v.return=m,v;case Oi:var b=v._init;return d(m,b(v._payload),y)}if(El(v)||tl(v))return v=Vs(v,m.mode,y,null),v.return=m,v;Tu(m,v)}return null}function h(m,v,y,b){var w=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return w!==null?null:a(m,v,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case pu:return y.key===w?l(m,v,y,b):null;case Fo:return y.key===w?c(m,v,y,b):null;case Oi:return w=y._init,h(m,v,w(y._payload),b)}if(El(y)||tl(y))return w!==null?null:u(m,v,y,b,null);Tu(m,y)}return null}function f(m,v,y,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return m=m.get(y)||null,a(v,m,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case pu:return m=m.get(b.key===null?y:b.key)||null,l(v,m,b,w);case Fo:return m=m.get(b.key===null?y:b.key)||null,c(v,m,b,w);case Oi:var T=b._init;return f(m,v,y,T(b._payload),w)}if(El(b)||tl(b))return m=m.get(y)||null,u(v,m,b,w,null);Tu(v,b)}return null}function p(m,v,y,b){for(var w=null,T=null,E=v,O=v=0,A=null;E!==null&&O<y.length;O++){E.index>O?(A=E,E=null):A=E.sibling;var F=h(m,E,y[O],b);if(F===null){E===null&&(E=A);break}n&&E&&F.alternate===null&&e(m,E),v=s(F,v,O),T===null?w=F:T.sibling=F,T=F,E=A}if(O===y.length)return t(m,E),Ve&&bs(m,O),w;if(E===null){for(;O<y.length;O++)E=d(m,y[O],b),E!==null&&(v=s(E,v,O),T===null?w=E:T.sibling=E,T=E);return Ve&&bs(m,O),w}for(E=r(m,E);O<y.length;O++)A=f(E,m,O,y[O],b),A!==null&&(n&&A.alternate!==null&&E.delete(A.key===null?O:A.key),v=s(A,v,O),T===null?w=A:T.sibling=A,T=A);return n&&E.forEach(function(X){return e(m,X)}),Ve&&bs(m,O),w}function g(m,v,y,b){var w=tl(y);if(typeof w!="function")throw Error($(150));if(y=w.call(y),y==null)throw Error($(151));for(var T=w=null,E=v,O=v=0,A=null,F=y.next();E!==null&&!F.done;O++,F=y.next()){E.index>O?(A=E,E=null):A=E.sibling;var X=h(m,E,F.value,b);if(X===null){E===null&&(E=A);break}n&&E&&X.alternate===null&&e(m,E),v=s(X,v,O),T===null?w=X:T.sibling=X,T=X,E=A}if(F.done)return t(m,E),Ve&&bs(m,O),w;if(E===null){for(;!F.done;O++,F=y.next())F=d(m,F.value,b),F!==null&&(v=s(F,v,O),T===null?w=F:T.sibling=F,T=F);return Ve&&bs(m,O),w}for(E=r(m,E);!F.done;O++,F=y.next())F=f(E,m,O,F.value,b),F!==null&&(n&&F.alternate!==null&&E.delete(F.key===null?O:F.key),v=s(F,v,O),T===null?w=F:T.sibling=F,T=F);return n&&E.forEach(function(z){return e(m,z)}),Ve&&bs(m,O),w}function S(m,v,y,b){if(typeof y=="object"&&y!==null&&y.type===zo&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case pu:e:{for(var w=y.key,T=v;T!==null;){if(T.key===w){if(w=y.type,w===zo){if(T.tag===7){t(m,T.sibling),v=i(T,y.props.children),v.return=m,m=v;break e}}else if(T.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Oi&&qb(w)===T.type){t(m,T.sibling),v=i(T,y.props),v.ref=ol(m,T,y),v.return=m,m=v;break e}t(m,T);break}else e(m,T);T=T.sibling}y.type===zo?(v=Vs(y.props.children,m.mode,b,y.key),v.return=m,m=v):(b=ed(y.type,y.key,y.props,null,m.mode,b),b.ref=ol(m,v,y),b.return=m,m=b)}return o(m);case Fo:e:{for(T=y.key;v!==null;){if(v.key===T)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){t(m,v.sibling),v=i(v,y.children||[]),v.return=m,m=v;break e}else{t(m,v);break}else e(m,v);v=v.sibling}v=yp(y,m.mode,b),v.return=m,m=v}return o(m);case Oi:return T=y._init,S(m,v,T(y._payload),b)}if(El(y))return p(m,v,y,b);if(tl(y))return g(m,v,y,b);Tu(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(t(m,v.sibling),v=i(v,y),v.return=m,m=v):(t(m,v),v=vp(y,m.mode,b),v.return=m,m=v),o(m)):t(m,v)}return S}var va=ix(!0),sx=ix(!1),kd=ds(null),Nd=null,Wo=null,Ry=null;function ky(){Ry=Wo=Nd=null}function Ny(n){var e=kd.current;$e(kd),n._currentValue=e}function _g(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ta(n,e){Nd=n,Ry=Wo=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(cn=!0),n.firstContext=null)}function Wn(n){var e=n._currentValue;if(Ry!==n)if(n={context:n,memoizedValue:e,next:null},Wo===null){if(Nd===null)throw Error($(308));Wo=n,Nd.dependencies={lanes:0,firstContext:n}}else Wo=Wo.next=n;return e}var $s=null;function Ly(n){$s===null?$s=[n]:$s.push(n)}function ox(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Ly(e)):(t.next=i.next,i.next=t),e.interleaved=t,ci(n,r)}function ci(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Pi=!1;function Iy(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ax(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ni(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Gi(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,we&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ci(n,t)}return i=r.interleaved,i===null?(e.next=e,Ly(r)):(e.next=i.next,i.next=e),r.interleaved=e,ci(n,t)}function Ku(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,yy(n,t)}}function Bb(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ld(n,e,t,r){var i=n.updateQueue;Pi=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,f=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,g=a;switch(h=e,f=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=Ze({},d,h);break e;case 2:Pi=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);eo|=o,n.lanes=o,n.memoizedState=d}}function Ub(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error($(191,i));i.call(r)}}}var Fc={},Or=ds(Fc),lc=ds(Fc),cc=ds(Fc);function js(n){if(n===Fc)throw Error($(174));return n}function Ay(n,e){switch(Me(cc,e),Me(lc,n),Me(Or,Fc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ig(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=ig(e,n)}$e(Or),Me(Or,e)}function ya(){$e(Or),$e(lc),$e(cc)}function lx(n){js(cc.current);var e=js(Or.current),t=ig(e,n.type);e!==t&&(Me(lc,n),Me(Or,t))}function My(n){lc.current===n&&($e(Or),$e(lc))}var Je=ds(0);function Id(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var dp=[];function Dy(){for(var n=0;n<dp.length;n++)dp[n]._workInProgressVersionPrimary=null;dp.length=0}var Ju=mi.ReactCurrentDispatcher,hp=mi.ReactCurrentBatchConfig,Zs=0,Ye=null,pt=null,wt=null,Ad=!1,Al=!1,uc=0,UI=0;function Lt(){throw Error($(321))}function Fy(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!cr(n[t],e[t]))return!1;return!0}function zy(n,e,t,r,i,s){if(Zs=s,Ye=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ju.current=n===null||n.memoizedState===null?GI:KI,n=t(r,i),Al){s=0;do{if(Al=!1,uc=0,25<=s)throw Error($(301));s+=1,wt=pt=null,e.updateQueue=null,Ju.current=JI,n=t(r,i)}while(Al)}if(Ju.current=Md,e=pt!==null&&pt.next!==null,Zs=0,wt=pt=Ye=null,Ad=!1,e)throw Error($(300));return n}function $y(){var n=uc!==0;return uc=0,n}function gr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wt===null?Ye.memoizedState=wt=n:wt=wt.next=n,wt}function Gn(){if(pt===null){var n=Ye.alternate;n=n!==null?n.memoizedState:null}else n=pt.next;var e=wt===null?Ye.memoizedState:wt.next;if(e!==null)wt=e,pt=n;else{if(n===null)throw Error($(310));pt=n,n={memoizedState:pt.memoizedState,baseState:pt.baseState,baseQueue:pt.baseQueue,queue:pt.queue,next:null},wt===null?Ye.memoizedState=wt=n:wt=wt.next=n}return wt}function dc(n,e){return typeof e=="function"?e(n):e}function fp(n){var e=Gn(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=n;var r=pt,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Zs&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,Ye.lanes|=u,eo|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,cr(r,e.memoizedState)||(cn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Ye.lanes|=s,eo|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function pp(n){var e=Gn(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);cr(s,e.memoizedState)||(cn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function cx(){}function ux(n,e){var t=Ye,r=Gn(),i=e(),s=!cr(r.memoizedState,i);if(s&&(r.memoizedState=i,cn=!0),r=r.queue,jy(fx.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||wt!==null&&wt.memoizedState.tag&1){if(t.flags|=2048,hc(9,hx.bind(null,t,r,i,e),void 0,null),Ct===null)throw Error($(349));Zs&30||dx(t,e,i)}return i}function dx(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function hx(n,e,t,r){e.value=t,e.getSnapshot=r,px(e)&&mx(n)}function fx(n,e,t){return t(function(){px(e)&&mx(n)})}function px(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!cr(n,t)}catch{return!0}}function mx(n){var e=ci(n,1);e!==null&&or(e,n,1,-1)}function Hb(n){var e=gr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dc,lastRenderedState:n},e.queue=n,n=n.dispatch=WI.bind(null,Ye,n),[e.memoizedState,n]}function hc(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function gx(){return Gn().memoizedState}function Qu(n,e,t,r){var i=gr();Ye.flags|=n,i.memoizedState=hc(1|e,t,void 0,r===void 0?null:r)}function Ch(n,e,t,r){var i=Gn();r=r===void 0?null:r;var s=void 0;if(pt!==null){var o=pt.memoizedState;if(s=o.destroy,r!==null&&Fy(r,o.deps)){i.memoizedState=hc(e,t,s,r);return}}Ye.flags|=n,i.memoizedState=hc(1|e,t,s,r)}function Vb(n,e){return Qu(8390656,8,n,e)}function jy(n,e){return Ch(2048,8,n,e)}function vx(n,e){return Ch(4,2,n,e)}function yx(n,e){return Ch(4,4,n,e)}function Sx(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function bx(n,e,t){return t=t!=null?t.concat([n]):null,Ch(4,4,Sx.bind(null,e,n),t)}function qy(){}function wx(n,e){var t=Gn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Fy(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Cx(n,e){var t=Gn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Fy(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Ex(n,e,t){return Zs&21?(cr(t,e)||(t=PT(),Ye.lanes|=t,eo|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,cn=!0),n.memoizedState=t)}function HI(n,e){var t=Pe;Pe=t!==0&&4>t?t:4,n(!0);var r=hp.transition;hp.transition={};try{n(!1),e()}finally{Pe=t,hp.transition=r}}function _x(){return Gn().memoizedState}function VI(n,e,t){var r=Ji(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Tx(n))xx(e,t);else if(t=ox(n,e,t,r),t!==null){var i=Yt();or(t,n,r,i),Ox(t,e,r)}}function WI(n,e,t){var r=Ji(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Tx(n))xx(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,cr(a,o)){var l=e.interleaved;l===null?(i.next=i,Ly(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=ox(n,e,i,r),t!==null&&(i=Yt(),or(t,n,r,i),Ox(t,e,r))}}function Tx(n){var e=n.alternate;return n===Ye||e!==null&&e===Ye}function xx(n,e){Al=Ad=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Ox(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,yy(n,t)}}var Md={readContext:Wn,useCallback:Lt,useContext:Lt,useEffect:Lt,useImperativeHandle:Lt,useInsertionEffect:Lt,useLayoutEffect:Lt,useMemo:Lt,useReducer:Lt,useRef:Lt,useState:Lt,useDebugValue:Lt,useDeferredValue:Lt,useTransition:Lt,useMutableSource:Lt,useSyncExternalStore:Lt,useId:Lt,unstable_isNewReconciler:!1},GI={readContext:Wn,useCallback:function(n,e){return gr().memoizedState=[n,e===void 0?null:e],n},useContext:Wn,useEffect:Vb,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Qu(4194308,4,Sx.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Qu(4194308,4,n,e)},useInsertionEffect:function(n,e){return Qu(4,2,n,e)},useMemo:function(n,e){var t=gr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=gr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=VI.bind(null,Ye,n),[r.memoizedState,n]},useRef:function(n){var e=gr();return n={current:n},e.memoizedState=n},useState:Hb,useDebugValue:qy,useDeferredValue:function(n){return gr().memoizedState=n},useTransition:function(){var n=Hb(!1),e=n[0];return n=HI.bind(null,n[1]),gr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Ye,i=gr();if(Ve){if(t===void 0)throw Error($(407));t=t()}else{if(t=e(),Ct===null)throw Error($(349));Zs&30||dx(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,Vb(fx.bind(null,r,s,n),[n]),r.flags|=2048,hc(9,hx.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=gr(),e=Ct.identifierPrefix;if(Ve){var t=ei,r=Zr;t=(r&~(1<<32-sr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=uc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=UI++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},KI={readContext:Wn,useCallback:wx,useContext:Wn,useEffect:jy,useImperativeHandle:bx,useInsertionEffect:vx,useLayoutEffect:yx,useMemo:Cx,useReducer:fp,useRef:gx,useState:function(){return fp(dc)},useDebugValue:qy,useDeferredValue:function(n){var e=Gn();return Ex(e,pt.memoizedState,n)},useTransition:function(){var n=fp(dc)[0],e=Gn().memoizedState;return[n,e]},useMutableSource:cx,useSyncExternalStore:ux,useId:_x,unstable_isNewReconciler:!1},JI={readContext:Wn,useCallback:wx,useContext:Wn,useEffect:jy,useImperativeHandle:bx,useInsertionEffect:vx,useLayoutEffect:yx,useMemo:Cx,useReducer:pp,useRef:gx,useState:function(){return pp(dc)},useDebugValue:qy,useDeferredValue:function(n){var e=Gn();return pt===null?e.memoizedState=n:Ex(e,pt.memoizedState,n)},useTransition:function(){var n=pp(dc)[0],e=Gn().memoizedState;return[n,e]},useMutableSource:cx,useSyncExternalStore:ux,useId:_x,unstable_isNewReconciler:!1};function Yn(n,e){if(n&&n.defaultProps){e=Ze({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Tg(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Ze({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Eh={isMounted:function(n){return(n=n._reactInternals)?ho(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Yt(),i=Ji(n),s=ni(r,i);s.payload=e,t!=null&&(s.callback=t),e=Gi(n,s,i),e!==null&&(or(e,n,i,r),Ku(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Yt(),i=Ji(n),s=ni(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Gi(n,s,i),e!==null&&(or(e,n,i,r),Ku(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Yt(),r=Ji(n),i=ni(t,r);i.tag=2,e!=null&&(i.callback=e),e=Gi(n,i,r),e!==null&&(or(e,n,r,t),Ku(e,n,r))}};function Wb(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!ic(t,r)||!ic(i,s):!0}function Px(n,e,t){var r=!1,i=os,s=e.contextType;return typeof s=="object"&&s!==null?s=Wn(s):(i=dn(e)?Xs:Ut.current,r=e.contextTypes,s=(r=r!=null)?ma(n,i):os),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Eh,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function Gb(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Eh.enqueueReplaceState(e,e.state,null)}function xg(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Iy(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Wn(s):(s=dn(e)?Xs:Ut.current,i.context=ma(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Tg(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Eh.enqueueReplaceState(i,i.state,null),Ld(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Sa(n,e){try{var t="",r=e;do t+=EL(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function mp(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Og(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var QI=typeof WeakMap=="function"?WeakMap:Map;function Rx(n,e,t){t=ni(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Fd||(Fd=!0,Fg=r),Og(n,e)},t}function kx(n,e,t){t=ni(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){Og(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){Og(n,e),typeof r!="function"&&(Ki===null?Ki=new Set([this]):Ki.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Kb(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new QI;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=uA.bind(null,n,e,t),e.then(n,n))}function Jb(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Qb(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ni(-1,1),e.tag=2,Gi(t,e,1))),t.lanes|=1),n)}var XI=mi.ReactCurrentOwner,cn=!1;function Kt(n,e,t,r){e.child=n===null?sx(e,null,t,r):va(e,n.child,t,r)}function Xb(n,e,t,r,i){t=t.render;var s=e.ref;return ta(e,i),r=zy(n,e,t,r,s,i),t=$y(),n!==null&&!cn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ui(n,e,i)):(Ve&&t&&xy(e),e.flags|=1,Kt(n,e,r,i),e.child)}function Yb(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Jy(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,Nx(n,e,s,r,i)):(n=ed(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:ic,t(o,r)&&n.ref===e.ref)return ui(n,e,i)}return e.flags|=1,n=Qi(s,r),n.ref=e.ref,n.return=e,e.child=n}function Nx(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(ic(s,r)&&n.ref===e.ref)if(cn=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(cn=!0);else return e.lanes=n.lanes,ui(n,e,i)}return Pg(n,e,t,r,i)}function Lx(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Me(Ko,yn),yn|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Me(Ko,yn),yn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Me(Ko,yn),yn|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Me(Ko,yn),yn|=r;return Kt(n,e,i,t),e.child}function Ix(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Pg(n,e,t,r,i){var s=dn(t)?Xs:Ut.current;return s=ma(e,s),ta(e,i),t=zy(n,e,t,r,s,i),r=$y(),n!==null&&!cn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ui(n,e,i)):(Ve&&r&&xy(e),e.flags|=1,Kt(n,e,t,i),e.child)}function Zb(n,e,t,r,i){if(dn(t)){var s=!0;Od(e)}else s=!1;if(ta(e,i),e.stateNode===null)Xu(n,e),Px(e,t,r),xg(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Wn(c):(c=dn(t)?Xs:Ut.current,c=ma(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Gb(e,o,r,c),Pi=!1;var h=e.memoizedState;o.state=h,Ld(e,r,o,i),l=e.memoizedState,a!==r||h!==l||un.current||Pi?(typeof u=="function"&&(Tg(e,t,u,r),l=e.memoizedState),(a=Pi||Wb(e,t,a,r,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,ax(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Yn(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Wn(l):(l=dn(t)?Xs:Ut.current,l=ma(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Gb(e,o,r,l),Pi=!1,h=e.memoizedState,o.state=h,Ld(e,r,o,i);var p=e.memoizedState;a!==d||h!==p||un.current||Pi?(typeof f=="function"&&(Tg(e,t,f,r),p=e.memoizedState),(c=Pi||Wb(e,t,c,r,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return Rg(n,e,t,r,s,i)}function Rg(n,e,t,r,i,s){Ix(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&zb(e,t,!1),ui(n,e,s);r=e.stateNode,XI.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=va(e,n.child,null,s),e.child=va(e,null,a,s)):Kt(n,e,a,s),e.memoizedState=r.state,i&&zb(e,t,!0),e.child}function Ax(n){var e=n.stateNode;e.pendingContext?Fb(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Fb(n,e.context,!1),Ay(n,e.containerInfo)}function ew(n,e,t,r,i){return ga(),Py(i),e.flags|=256,Kt(n,e,t,r),e.child}var kg={dehydrated:null,treeContext:null,retryLane:0};function Ng(n){return{baseLanes:n,cachePool:null,transitions:null}}function Mx(n,e,t){var r=e.pendingProps,i=Je.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Me(Je,i&1),n===null)return Eg(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=xh(o,r,0,null),n=Vs(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Ng(t),e.memoizedState=kg,n):By(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return YI(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Qi(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Qi(a,s):(s=Vs(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?Ng(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=kg,r}return s=n.child,n=s.sibling,r=Qi(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function By(n,e){return e=xh({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function xu(n,e,t,r){return r!==null&&Py(r),va(e,n.child,null,t),n=By(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function YI(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=mp(Error($(422))),xu(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=xh({mode:"visible",children:r.children},i,0,null),s=Vs(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&va(e,n.child,null,o),e.child.memoizedState=Ng(o),e.memoizedState=kg,s);if(!(e.mode&1))return xu(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error($(419)),r=mp(s,r,void 0),xu(n,e,o,r)}if(a=(o&n.childLanes)!==0,cn||a){if(r=Ct,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ci(n,i),or(r,n,i,-1))}return Ky(),r=mp(Error($(421))),xu(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=dA.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,Tn=Wi(i.nextSibling),On=e,Ve=!0,nr=null,n!==null&&(Mn[Dn++]=Zr,Mn[Dn++]=ei,Mn[Dn++]=Ys,Zr=n.id,ei=n.overflow,Ys=e),e=By(e,r.children),e.flags|=4096,e)}function tw(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),_g(n.return,e,t)}function gp(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function Dx(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Kt(n,e,r.children,t),r=Je.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&tw(n,t,e);else if(n.tag===19)tw(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Me(Je,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Id(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),gp(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Id(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}gp(e,!0,t,null,s);break;case"together":gp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Xu(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ui(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),eo|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error($(153));if(e.child!==null){for(n=e.child,t=Qi(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Qi(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function ZI(n,e,t){switch(e.tag){case 3:Ax(e),ga();break;case 5:lx(e);break;case 1:dn(e.type)&&Od(e);break;case 4:Ay(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Me(kd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Me(Je,Je.current&1),e.flags|=128,null):t&e.child.childLanes?Mx(n,e,t):(Me(Je,Je.current&1),n=ui(n,e,t),n!==null?n.sibling:null);Me(Je,Je.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Dx(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Me(Je,Je.current),r)break;return null;case 22:case 23:return e.lanes=0,Lx(n,e,t)}return ui(n,e,t)}var Fx,Lg,zx,$x;Fx=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Lg=function(){};zx=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,js(Or.current);var s=null;switch(t){case"input":i=eg(n,i),r=eg(n,r),s=[];break;case"select":i=Ze({},i,{value:void 0}),r=Ze({},r,{value:void 0}),s=[];break;case"textarea":i=rg(n,i),r=rg(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Td)}sg(t,r);var o;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Xl.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Xl.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&De("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};$x=function(n,e,t,r){t!==r&&(e.flags|=4)};function al(n,e){if(!Ve)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function It(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function eA(n,e,t){var r=e.pendingProps;switch(Oy(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return It(e),null;case 1:return dn(e.type)&&xd(),It(e),null;case 3:return r=e.stateNode,ya(),$e(un),$e(Ut),Dy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(_u(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,nr!==null&&(jg(nr),nr=null))),Lg(n,e),It(e),null;case 5:My(e);var i=js(cc.current);if(t=e.type,n!==null&&e.stateNode!=null)zx(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error($(166));return It(e),null}if(n=js(Or.current),_u(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[wr]=e,r[ac]=s,n=(e.mode&1)!==0,t){case"dialog":De("cancel",r),De("close",r);break;case"iframe":case"object":case"embed":De("load",r);break;case"video":case"audio":for(i=0;i<Tl.length;i++)De(Tl[i],r);break;case"source":De("error",r);break;case"img":case"image":case"link":De("error",r),De("load",r);break;case"details":De("toggle",r);break;case"input":ub(r,s),De("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},De("invalid",r);break;case"textarea":hb(r,s),De("invalid",r)}sg(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Eu(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Eu(r.textContent,a,n),i=["children",""+a]):Xl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&De("scroll",r)}switch(t){case"input":mu(r),db(r,s,!0);break;case"textarea":mu(r),fb(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Td)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=fT(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[wr]=e,n[ac]=r,Fx(n,e,!1,!1),e.stateNode=n;e:{switch(o=og(t,r),t){case"dialog":De("cancel",n),De("close",n),i=r;break;case"iframe":case"object":case"embed":De("load",n),i=r;break;case"video":case"audio":for(i=0;i<Tl.length;i++)De(Tl[i],n);i=r;break;case"source":De("error",n),i=r;break;case"img":case"image":case"link":De("error",n),De("load",n),i=r;break;case"details":De("toggle",n),i=r;break;case"input":ub(n,r),i=eg(n,r),De("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Ze({},r,{value:void 0}),De("invalid",n);break;case"textarea":hb(n,r),i=rg(n,r),De("invalid",n);break;default:i=r}sg(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?gT(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&pT(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Yl(n,l):typeof l=="number"&&Yl(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Xl.hasOwnProperty(s)?l!=null&&s==="onScroll"&&De("scroll",n):l!=null&&hy(n,s,l,o))}switch(t){case"input":mu(n),db(n,r,!1);break;case"textarea":mu(n),fb(n);break;case"option":r.value!=null&&n.setAttribute("value",""+ss(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Xo(n,!!r.multiple,s,!1):r.defaultValue!=null&&Xo(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Td)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return It(e),null;case 6:if(n&&e.stateNode!=null)$x(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error($(166));if(t=js(cc.current),js(Or.current),_u(e)){if(r=e.stateNode,t=e.memoizedProps,r[wr]=e,(s=r.nodeValue!==t)&&(n=On,n!==null))switch(n.tag){case 3:Eu(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Eu(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[wr]=e,e.stateNode=r}return It(e),null;case 13:if($e(Je),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ve&&Tn!==null&&e.mode&1&&!(e.flags&128))rx(),ga(),e.flags|=98560,s=!1;else if(s=_u(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error($(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error($(317));s[wr]=e}else ga(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;It(e),s=!1}else nr!==null&&(jg(nr),nr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Je.current&1?gt===0&&(gt=3):Ky())),e.updateQueue!==null&&(e.flags|=4),It(e),null);case 4:return ya(),Lg(n,e),n===null&&sc(e.stateNode.containerInfo),It(e),null;case 10:return Ny(e.type._context),It(e),null;case 17:return dn(e.type)&&xd(),It(e),null;case 19:if($e(Je),s=e.memoizedState,s===null)return It(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)al(s,!1);else{if(gt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Id(n),o!==null){for(e.flags|=128,al(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Me(Je,Je.current&1|2),e.child}n=n.sibling}s.tail!==null&&it()>ba&&(e.flags|=128,r=!0,al(s,!1),e.lanes=4194304)}else{if(!r)if(n=Id(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),al(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ve)return It(e),null}else 2*it()-s.renderingStartTime>ba&&t!==1073741824&&(e.flags|=128,r=!0,al(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=it(),e.sibling=null,t=Je.current,Me(Je,r?t&1|2:t&1),e):(It(e),null);case 22:case 23:return Gy(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?yn&1073741824&&(It(e),e.subtreeFlags&6&&(e.flags|=8192)):It(e),null;case 24:return null;case 25:return null}throw Error($(156,e.tag))}function tA(n,e){switch(Oy(e),e.tag){case 1:return dn(e.type)&&xd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return ya(),$e(un),$e(Ut),Dy(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return My(e),null;case 13:if($e(Je),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error($(340));ga()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return $e(Je),null;case 4:return ya(),null;case 10:return Ny(e.type._context),null;case 22:case 23:return Gy(),null;case 24:return null;default:return null}}var Ou=!1,qt=!1,nA=typeof WeakSet=="function"?WeakSet:Set,K=null;function Go(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){tt(n,e,r)}else t.current=null}function Ig(n,e,t){try{t()}catch(r){tt(n,e,r)}}var nw=!1;function rA(n,e){if(gg=Cd,n=HT(),Ty(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=n,h=null;t:for(;;){for(var f;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(vg={focusedElem:n,selectionRange:t},Cd=!1,K=e;K!==null;)if(e=K,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,K=n;else for(;K!==null;){e=K;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,S=p.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?g:Yn(e.type,g),S);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($(163))}}catch(b){tt(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,K=n;break}K=e.return}return p=nw,nw=!1,p}function Ml(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&Ig(e,t,s)}i=i.next}while(i!==r)}}function _h(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Ag(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function jx(n){var e=n.alternate;e!==null&&(n.alternate=null,jx(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[wr],delete e[ac],delete e[bg],delete e[$I],delete e[jI])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function qx(n){return n.tag===5||n.tag===3||n.tag===4}function rw(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||qx(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Mg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Td));else if(r!==4&&(n=n.child,n!==null))for(Mg(n,e,t),n=n.sibling;n!==null;)Mg(n,e,t),n=n.sibling}function Dg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Dg(n,e,t),n=n.sibling;n!==null;)Dg(n,e,t),n=n.sibling}var xt=null,Zn=!1;function wi(n,e,t){for(t=t.child;t!==null;)Bx(n,e,t),t=t.sibling}function Bx(n,e,t){if(xr&&typeof xr.onCommitFiberUnmount=="function")try{xr.onCommitFiberUnmount(gh,t)}catch{}switch(t.tag){case 5:qt||Go(t,e);case 6:var r=xt,i=Zn;xt=null,wi(n,e,t),xt=r,Zn=i,xt!==null&&(Zn?(n=xt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):xt.removeChild(t.stateNode));break;case 18:xt!==null&&(Zn?(n=xt,t=t.stateNode,n.nodeType===8?cp(n.parentNode,t):n.nodeType===1&&cp(n,t),nc(n)):cp(xt,t.stateNode));break;case 4:r=xt,i=Zn,xt=t.stateNode.containerInfo,Zn=!0,wi(n,e,t),xt=r,Zn=i;break;case 0:case 11:case 14:case 15:if(!qt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Ig(t,e,o),i=i.next}while(i!==r)}wi(n,e,t);break;case 1:if(!qt&&(Go(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){tt(t,e,a)}wi(n,e,t);break;case 21:wi(n,e,t);break;case 22:t.mode&1?(qt=(r=qt)||t.memoizedState!==null,wi(n,e,t),qt=r):wi(n,e,t);break;default:wi(n,e,t)}}function iw(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new nA),e.forEach(function(r){var i=hA.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Qn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:xt=a.stateNode,Zn=!1;break e;case 3:xt=a.stateNode.containerInfo,Zn=!0;break e;case 4:xt=a.stateNode.containerInfo,Zn=!0;break e}a=a.return}if(xt===null)throw Error($(160));Bx(s,o,i),xt=null,Zn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){tt(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ux(e,n),e=e.sibling}function Ux(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Qn(e,n),hr(n),r&4){try{Ml(3,n,n.return),_h(3,n)}catch(g){tt(n,n.return,g)}try{Ml(5,n,n.return)}catch(g){tt(n,n.return,g)}}break;case 1:Qn(e,n),hr(n),r&512&&t!==null&&Go(t,t.return);break;case 5:if(Qn(e,n),hr(n),r&512&&t!==null&&Go(t,t.return),n.flags&32){var i=n.stateNode;try{Yl(i,"")}catch(g){tt(n,n.return,g)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&dT(i,s),og(a,o);var c=og(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?gT(i,d):u==="dangerouslySetInnerHTML"?pT(i,d):u==="children"?Yl(i,d):hy(i,u,d,c)}switch(a){case"input":tg(i,s);break;case"textarea":hT(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Xo(i,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Xo(i,!!s.multiple,s.defaultValue,!0):Xo(i,!!s.multiple,s.multiple?[]:"",!1))}i[ac]=s}catch(g){tt(n,n.return,g)}}break;case 6:if(Qn(e,n),hr(n),r&4){if(n.stateNode===null)throw Error($(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(g){tt(n,n.return,g)}}break;case 3:if(Qn(e,n),hr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{nc(e.containerInfo)}catch(g){tt(n,n.return,g)}break;case 4:Qn(e,n),hr(n);break;case 13:Qn(e,n),hr(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Vy=it())),r&4&&iw(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(qt=(c=qt)||u,Qn(e,n),qt=c):Qn(e,n),hr(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(K=n,u=n.child;u!==null;){for(d=K=u;K!==null;){switch(h=K,f=h.child,h.tag){case 0:case 11:case 14:case 15:Ml(4,h,h.return);break;case 1:Go(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){tt(r,t,g)}}break;case 5:Go(h,h.return);break;case 22:if(h.memoizedState!==null){ow(d);continue}}f!==null?(f.return=h,K=f):ow(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=mT("display",o))}catch(g){tt(n,n.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){tt(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Qn(e,n),hr(n),r&4&&iw(n);break;case 21:break;default:Qn(e,n),hr(n)}}function hr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(qx(t)){var r=t;break e}t=t.return}throw Error($(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Yl(i,""),r.flags&=-33);var s=rw(n);Dg(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=rw(n);Mg(n,a,o);break;default:throw Error($(161))}}catch(l){tt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function iA(n,e,t){K=n,Hx(n)}function Hx(n,e,t){for(var r=(n.mode&1)!==0;K!==null;){var i=K,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Ou;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||qt;a=Ou;var c=qt;if(Ou=o,(qt=l)&&!c)for(K=i;K!==null;)o=K,l=o.child,o.tag===22&&o.memoizedState!==null?aw(i):l!==null?(l.return=o,K=l):aw(i);for(;s!==null;)K=s,Hx(s),s=s.sibling;K=i,Ou=a,qt=c}sw(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,K=s):sw(n)}}function sw(n){for(;K!==null;){var e=K;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qt||_h(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!qt)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Yn(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Ub(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Ub(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&nc(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($(163))}qt||e.flags&512&&Ag(e)}catch(h){tt(e,e.return,h)}}if(e===n){K=null;break}if(t=e.sibling,t!==null){t.return=e.return,K=t;break}K=e.return}}function ow(n){for(;K!==null;){var e=K;if(e===n){K=null;break}var t=e.sibling;if(t!==null){t.return=e.return,K=t;break}K=e.return}}function aw(n){for(;K!==null;){var e=K;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{_h(4,e)}catch(l){tt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){tt(e,i,l)}}var s=e.return;try{Ag(e)}catch(l){tt(e,s,l)}break;case 5:var o=e.return;try{Ag(e)}catch(l){tt(e,o,l)}}}catch(l){tt(e,e.return,l)}if(e===n){K=null;break}var a=e.sibling;if(a!==null){a.return=e.return,K=a;break}K=e.return}}var sA=Math.ceil,Dd=mi.ReactCurrentDispatcher,Uy=mi.ReactCurrentOwner,Un=mi.ReactCurrentBatchConfig,we=0,Ct=null,ct=null,Rt=0,yn=0,Ko=ds(0),gt=0,fc=null,eo=0,Th=0,Hy=0,Dl=null,ln=null,Vy=0,ba=1/0,Gr=null,Fd=!1,Fg=null,Ki=null,Pu=!1,Mi=null,zd=0,Fl=0,zg=null,Yu=-1,Zu=0;function Yt(){return we&6?it():Yu!==-1?Yu:Yu=it()}function Ji(n){return n.mode&1?we&2&&Rt!==0?Rt&-Rt:BI.transition!==null?(Zu===0&&(Zu=PT()),Zu):(n=Pe,n!==0||(n=window.event,n=n===void 0?16:MT(n.type)),n):1}function or(n,e,t,r){if(50<Fl)throw Fl=0,zg=null,Error($(185));Ac(n,t,r),(!(we&2)||n!==Ct)&&(n===Ct&&(!(we&2)&&(Th|=t),gt===4&&Li(n,Rt)),hn(n,r),t===1&&we===0&&!(e.mode&1)&&(ba=it()+500,wh&&hs()))}function hn(n,e){var t=n.callbackNode;BL(n,e);var r=wd(n,n===Ct?Rt:0);if(r===0)t!==null&&gb(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&gb(t),e===1)n.tag===0?qI(lw.bind(null,n)):ex(lw.bind(null,n)),FI(function(){!(we&6)&&hs()}),t=null;else{switch(RT(r)){case 1:t=vy;break;case 4:t=xT;break;case 16:t=bd;break;case 536870912:t=OT;break;default:t=bd}t=Yx(t,Vx.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Vx(n,e){if(Yu=-1,Zu=0,we&6)throw Error($(327));var t=n.callbackNode;if(na()&&n.callbackNode!==t)return null;var r=wd(n,n===Ct?Rt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=$d(n,r);else{e=r;var i=we;we|=2;var s=Gx();(Ct!==n||Rt!==e)&&(Gr=null,ba=it()+500,Hs(n,e));do try{lA();break}catch(a){Wx(n,a)}while(1);ky(),Dd.current=s,we=i,ct!==null?e=0:(Ct=null,Rt=0,e=gt)}if(e!==0){if(e===2&&(i=dg(n),i!==0&&(r=i,e=$g(n,i))),e===1)throw t=fc,Hs(n,0),Li(n,r),hn(n,it()),t;if(e===6)Li(n,r);else{if(i=n.current.alternate,!(r&30)&&!oA(i)&&(e=$d(n,r),e===2&&(s=dg(n),s!==0&&(r=s,e=$g(n,s))),e===1))throw t=fc,Hs(n,0),Li(n,r),hn(n,it()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error($(345));case 2:ws(n,ln,Gr);break;case 3:if(Li(n,r),(r&130023424)===r&&(e=Vy+500-it(),10<e)){if(wd(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Yt(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Sg(ws.bind(null,n,ln,Gr),e);break}ws(n,ln,Gr);break;case 4:if(Li(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-sr(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=it()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*sA(r/1960))-r,10<r){n.timeoutHandle=Sg(ws.bind(null,n,ln,Gr),r);break}ws(n,ln,Gr);break;case 5:ws(n,ln,Gr);break;default:throw Error($(329))}}}return hn(n,it()),n.callbackNode===t?Vx.bind(null,n):null}function $g(n,e){var t=Dl;return n.current.memoizedState.isDehydrated&&(Hs(n,e).flags|=256),n=$d(n,e),n!==2&&(e=ln,ln=t,e!==null&&jg(e)),n}function jg(n){ln===null?ln=n:ln.push.apply(ln,n)}function oA(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!cr(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Li(n,e){for(e&=~Hy,e&=~Th,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-sr(e),r=1<<t;n[t]=-1,e&=~r}}function lw(n){if(we&6)throw Error($(327));na();var e=wd(n,0);if(!(e&1))return hn(n,it()),null;var t=$d(n,e);if(n.tag!==0&&t===2){var r=dg(n);r!==0&&(e=r,t=$g(n,r))}if(t===1)throw t=fc,Hs(n,0),Li(n,e),hn(n,it()),t;if(t===6)throw Error($(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ws(n,ln,Gr),hn(n,it()),null}function Wy(n,e){var t=we;we|=1;try{return n(e)}finally{we=t,we===0&&(ba=it()+500,wh&&hs())}}function to(n){Mi!==null&&Mi.tag===0&&!(we&6)&&na();var e=we;we|=1;var t=Un.transition,r=Pe;try{if(Un.transition=null,Pe=1,n)return n()}finally{Pe=r,Un.transition=t,we=e,!(we&6)&&hs()}}function Gy(){yn=Ko.current,$e(Ko)}function Hs(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,DI(t)),ct!==null)for(t=ct.return;t!==null;){var r=t;switch(Oy(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&xd();break;case 3:ya(),$e(un),$e(Ut),Dy();break;case 5:My(r);break;case 4:ya();break;case 13:$e(Je);break;case 19:$e(Je);break;case 10:Ny(r.type._context);break;case 22:case 23:Gy()}t=t.return}if(Ct=n,ct=n=Qi(n.current,null),Rt=yn=e,gt=0,fc=null,Hy=Th=eo=0,ln=Dl=null,$s!==null){for(e=0;e<$s.length;e++)if(t=$s[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}$s=null}return n}function Wx(n,e){do{var t=ct;try{if(ky(),Ju.current=Md,Ad){for(var r=Ye.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Ad=!1}if(Zs=0,wt=pt=Ye=null,Al=!1,uc=0,Uy.current=null,t===null||t.return===null){gt=1,fc=e,ct=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Rt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Jb(o);if(f!==null){f.flags&=-257,Qb(f,o,a,s,e),f.mode&1&&Kb(s,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var g=new Set;g.add(l),e.updateQueue=g}else p.add(l);break e}else{if(!(e&1)){Kb(s,c,e),Ky();break e}l=Error($(426))}}else if(Ve&&a.mode&1){var S=Jb(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),Qb(S,o,a,s,e),Py(Sa(l,a));break e}}s=l=Sa(l,a),gt!==4&&(gt=2),Dl===null?Dl=[s]:Dl.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=Rx(s,l,e);Bb(s,m);break e;case 1:a=l;var v=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ki===null||!Ki.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var b=kx(s,a,e);Bb(s,b);break e}}s=s.return}while(s!==null)}Jx(t)}catch(w){e=w,ct===t&&t!==null&&(ct=t=t.return);continue}break}while(1)}function Gx(){var n=Dd.current;return Dd.current=Md,n===null?Md:n}function Ky(){(gt===0||gt===3||gt===2)&&(gt=4),Ct===null||!(eo&268435455)&&!(Th&268435455)||Li(Ct,Rt)}function $d(n,e){var t=we;we|=2;var r=Gx();(Ct!==n||Rt!==e)&&(Gr=null,Hs(n,e));do try{aA();break}catch(i){Wx(n,i)}while(1);if(ky(),we=t,Dd.current=r,ct!==null)throw Error($(261));return Ct=null,Rt=0,gt}function aA(){for(;ct!==null;)Kx(ct)}function lA(){for(;ct!==null&&!IL();)Kx(ct)}function Kx(n){var e=Xx(n.alternate,n,yn);n.memoizedProps=n.pendingProps,e===null?Jx(n):ct=e,Uy.current=null}function Jx(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=tA(t,e),t!==null){t.flags&=32767,ct=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{gt=6,ct=null;return}}else if(t=eA(t,e,yn),t!==null){ct=t;return}if(e=e.sibling,e!==null){ct=e;return}ct=e=n}while(e!==null);gt===0&&(gt=5)}function ws(n,e,t){var r=Pe,i=Un.transition;try{Un.transition=null,Pe=1,cA(n,e,t,r)}finally{Un.transition=i,Pe=r}return null}function cA(n,e,t,r){do na();while(Mi!==null);if(we&6)throw Error($(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error($(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(UL(n,s),n===Ct&&(ct=Ct=null,Rt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Pu||(Pu=!0,Yx(bd,function(){return na(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Un.transition,Un.transition=null;var o=Pe;Pe=1;var a=we;we|=4,Uy.current=null,rA(n,t),Ux(t,n),RI(vg),Cd=!!gg,vg=gg=null,n.current=t,iA(t),AL(),we=a,Pe=o,Un.transition=s}else n.current=t;if(Pu&&(Pu=!1,Mi=n,zd=i),s=n.pendingLanes,s===0&&(Ki=null),FL(t.stateNode),hn(n,it()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Fd)throw Fd=!1,n=Fg,Fg=null,n;return zd&1&&n.tag!==0&&na(),s=n.pendingLanes,s&1?n===zg?Fl++:(Fl=0,zg=n):Fl=0,hs(),null}function na(){if(Mi!==null){var n=RT(zd),e=Un.transition,t=Pe;try{if(Un.transition=null,Pe=16>n?16:n,Mi===null)var r=!1;else{if(n=Mi,Mi=null,zd=0,we&6)throw Error($(331));var i=we;for(we|=4,K=n.current;K!==null;){var s=K,o=s.child;if(K.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(K=c;K!==null;){var u=K;switch(u.tag){case 0:case 11:case 15:Ml(8,u,s)}var d=u.child;if(d!==null)d.return=u,K=d;else for(;K!==null;){u=K;var h=u.sibling,f=u.return;if(jx(u),u===c){K=null;break}if(h!==null){h.return=f,K=h;break}K=f}}}var p=s.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var S=g.sibling;g.sibling=null,g=S}while(g!==null)}}K=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,K=o;else e:for(;K!==null;){if(s=K,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ml(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,K=m;break e}K=s.return}}var v=n.current;for(K=v;K!==null;){o=K;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,K=y;else e:for(o=v;K!==null;){if(a=K,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:_h(9,a)}}catch(w){tt(a,a.return,w)}if(a===o){K=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,K=b;break e}K=a.return}}if(we=i,hs(),xr&&typeof xr.onPostCommitFiberRoot=="function")try{xr.onPostCommitFiberRoot(gh,n)}catch{}r=!0}return r}finally{Pe=t,Un.transition=e}}return!1}function cw(n,e,t){e=Sa(t,e),e=Rx(n,e,1),n=Gi(n,e,1),e=Yt(),n!==null&&(Ac(n,1,e),hn(n,e))}function tt(n,e,t){if(n.tag===3)cw(n,n,t);else for(;e!==null;){if(e.tag===3){cw(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ki===null||!Ki.has(r))){n=Sa(t,n),n=kx(e,n,1),e=Gi(e,n,1),n=Yt(),e!==null&&(Ac(e,1,n),hn(e,n));break}}e=e.return}}function uA(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Yt(),n.pingedLanes|=n.suspendedLanes&t,Ct===n&&(Rt&t)===t&&(gt===4||gt===3&&(Rt&130023424)===Rt&&500>it()-Vy?Hs(n,0):Hy|=t),hn(n,e)}function Qx(n,e){e===0&&(n.mode&1?(e=yu,yu<<=1,!(yu&130023424)&&(yu=4194304)):e=1);var t=Yt();n=ci(n,e),n!==null&&(Ac(n,e,t),hn(n,t))}function dA(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Qx(n,t)}function hA(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error($(314))}r!==null&&r.delete(e),Qx(n,t)}var Xx;Xx=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||un.current)cn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return cn=!1,ZI(n,e,t);cn=!!(n.flags&131072)}else cn=!1,Ve&&e.flags&1048576&&tx(e,Rd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Xu(n,e),n=e.pendingProps;var i=ma(e,Ut.current);ta(e,t),i=zy(null,e,r,n,i,t);var s=$y();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,dn(r)?(s=!0,Od(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Iy(e),i.updater=Eh,e.stateNode=i,i._reactInternals=e,xg(e,r,n,t),e=Rg(null,e,r,!0,s,t)):(e.tag=0,Ve&&s&&xy(e),Kt(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Xu(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=pA(r),n=Yn(r,n),i){case 0:e=Pg(null,e,r,n,t);break e;case 1:e=Zb(null,e,r,n,t);break e;case 11:e=Xb(null,e,r,n,t);break e;case 14:e=Yb(null,e,r,Yn(r.type,n),t);break e}throw Error($(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Yn(r,i),Pg(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Yn(r,i),Zb(n,e,r,i,t);case 3:e:{if(Ax(e),n===null)throw Error($(387));r=e.pendingProps,s=e.memoizedState,i=s.element,ax(n,e),Ld(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Sa(Error($(423)),e),e=ew(n,e,r,t,i);break e}else if(r!==i){i=Sa(Error($(424)),e),e=ew(n,e,r,t,i);break e}else for(Tn=Wi(e.stateNode.containerInfo.firstChild),On=e,Ve=!0,nr=null,t=sx(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ga(),r===i){e=ui(n,e,t);break e}Kt(n,e,r,t)}e=e.child}return e;case 5:return lx(e),n===null&&Eg(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,yg(r,i)?o=null:s!==null&&yg(r,s)&&(e.flags|=32),Ix(n,e),Kt(n,e,o,t),e.child;case 6:return n===null&&Eg(e),null;case 13:return Mx(n,e,t);case 4:return Ay(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=va(e,null,r,t):Kt(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Yn(r,i),Xb(n,e,r,i,t);case 7:return Kt(n,e,e.pendingProps,t),e.child;case 8:return Kt(n,e,e.pendingProps.children,t),e.child;case 12:return Kt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Me(kd,r._currentValue),r._currentValue=o,s!==null)if(cr(s.value,o)){if(s.children===i.children&&!un.current){e=ui(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=ni(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),_g(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error($(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),_g(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Kt(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ta(e,t),i=Wn(i),r=r(i),e.flags|=1,Kt(n,e,r,t),e.child;case 14:return r=e.type,i=Yn(r,e.pendingProps),i=Yn(r.type,i),Yb(n,e,r,i,t);case 15:return Nx(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Yn(r,i),Xu(n,e),e.tag=1,dn(r)?(n=!0,Od(e)):n=!1,ta(e,t),Px(e,r,i),xg(e,r,i,t),Rg(null,e,r,!0,n,t);case 19:return Dx(n,e,t);case 22:return Lx(n,e,t)}throw Error($(156,e.tag))};function Yx(n,e){return TT(n,e)}function fA(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qn(n,e,t,r){return new fA(n,e,t,r)}function Jy(n){return n=n.prototype,!(!n||!n.isReactComponent)}function pA(n){if(typeof n=="function")return Jy(n)?1:0;if(n!=null){if(n=n.$$typeof,n===py)return 11;if(n===my)return 14}return 2}function Qi(n,e){var t=n.alternate;return t===null?(t=qn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function ed(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")Jy(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case zo:return Vs(t.children,i,s,e);case fy:o=8,i|=8;break;case Qm:return n=qn(12,t,e,i|2),n.elementType=Qm,n.lanes=s,n;case Xm:return n=qn(13,t,e,i),n.elementType=Xm,n.lanes=s,n;case Ym:return n=qn(19,t,e,i),n.elementType=Ym,n.lanes=s,n;case lT:return xh(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case oT:o=10;break e;case aT:o=9;break e;case py:o=11;break e;case my:o=14;break e;case Oi:o=16,r=null;break e}throw Error($(130,n==null?n:typeof n,""))}return e=qn(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Vs(n,e,t,r){return n=qn(7,n,r,e),n.lanes=t,n}function xh(n,e,t,r){return n=qn(22,n,r,e),n.elementType=lT,n.lanes=t,n.stateNode={isHidden:!1},n}function vp(n,e,t){return n=qn(6,n,null,e),n.lanes=t,n}function yp(n,e,t){return e=qn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function mA(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yf(0),this.expirationTimes=Yf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yf(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Qy(n,e,t,r,i,s,o,a,l){return n=new mA(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=qn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Iy(s),n}function gA(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fo,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Zx(n){if(!n)return os;n=n._reactInternals;e:{if(ho(n)!==n||n.tag!==1)throw Error($(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(dn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error($(171))}if(n.tag===1){var t=n.type;if(dn(t))return ZT(n,t,e)}return e}function eO(n,e,t,r,i,s,o,a,l){return n=Qy(t,r,!0,n,i,s,o,a,l),n.context=Zx(null),t=n.current,r=Yt(),i=Ji(t),s=ni(r,i),s.callback=e??null,Gi(t,s,i),n.current.lanes=i,Ac(n,i,r),hn(n,r),n}function Oh(n,e,t,r){var i=e.current,s=Yt(),o=Ji(i);return t=Zx(t),e.context===null?e.context=t:e.pendingContext=t,e=ni(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Gi(i,e,o),n!==null&&(or(n,i,o,s),Ku(n,i,o)),o}function jd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function uw(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Xy(n,e){uw(n,e),(n=n.alternate)&&uw(n,e)}function vA(){return null}var tO=typeof reportError=="function"?reportError:function(n){console.error(n)};function Yy(n){this._internalRoot=n}Ph.prototype.render=Yy.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error($(409));Oh(n,e,null,null)};Ph.prototype.unmount=Yy.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;to(function(){Oh(null,n,null,null)}),e[li]=null}};function Ph(n){this._internalRoot=n}Ph.prototype.unstable_scheduleHydration=function(n){if(n){var e=LT();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ni.length&&e!==0&&e<Ni[t].priority;t++);Ni.splice(t,0,n),t===0&&AT(n)}};function Zy(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Rh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function dw(){}function yA(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=jd(o);s.call(c)}}var o=eO(e,r,n,0,null,!1,!1,"",dw);return n._reactRootContainer=o,n[li]=o.current,sc(n.nodeType===8?n.parentNode:n),to(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=jd(l);a.call(c)}}var l=Qy(n,0,!1,null,null,!1,!1,"",dw);return n._reactRootContainer=l,n[li]=l.current,sc(n.nodeType===8?n.parentNode:n),to(function(){Oh(e,l,t,r)}),l}function kh(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=jd(o);a.call(l)}}Oh(e,o,n,i)}else o=yA(t,e,n,i,r);return jd(o)}kT=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=_l(e.pendingLanes);t!==0&&(yy(e,t|1),hn(e,it()),!(we&6)&&(ba=it()+500,hs()))}break;case 13:to(function(){var r=ci(n,1);if(r!==null){var i=Yt();or(r,n,1,i)}}),Xy(n,1)}};Sy=function(n){if(n.tag===13){var e=ci(n,134217728);if(e!==null){var t=Yt();or(e,n,134217728,t)}Xy(n,134217728)}};NT=function(n){if(n.tag===13){var e=Ji(n),t=ci(n,e);if(t!==null){var r=Yt();or(t,n,e,r)}Xy(n,e)}};LT=function(){return Pe};IT=function(n,e){var t=Pe;try{return Pe=n,e()}finally{Pe=t}};lg=function(n,e,t){switch(e){case"input":if(tg(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=bh(r);if(!i)throw Error($(90));uT(r),tg(r,i)}}}break;case"textarea":hT(n,t);break;case"select":e=t.value,e!=null&&Xo(n,!!t.multiple,e,!1)}};ST=Wy;bT=to;var SA={usingClientEntryPoint:!1,Events:[Dc,Bo,bh,vT,yT,Wy]},ll={findFiberByHostInstance:zs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bA={bundleType:ll.bundleType,version:ll.version,rendererPackageName:ll.rendererPackageName,rendererConfig:ll.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=ET(n),n===null?null:n.stateNode},findFiberByHostInstance:ll.findFiberByHostInstance||vA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ru.isDisabled&&Ru.supportsFiber)try{gh=Ru.inject(bA),xr=Ru}catch{}}Ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SA;Ln.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zy(e))throw Error($(200));return gA(n,e,null,t)};Ln.createRoot=function(n,e){if(!Zy(n))throw Error($(299));var t=!1,r="",i=tO;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Qy(n,1,!1,null,null,t,!1,r,i),n[li]=e.current,sc(n.nodeType===8?n.parentNode:n),new Yy(e)};Ln.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error($(188)):(n=Object.keys(n).join(","),Error($(268,n)));return n=ET(e),n=n===null?null:n.stateNode,n};Ln.flushSync=function(n){return to(n)};Ln.hydrate=function(n,e,t){if(!Rh(e))throw Error($(200));return kh(null,n,e,!0,t)};Ln.hydrateRoot=function(n,e,t){if(!Zy(n))throw Error($(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=tO;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=eO(e,null,n,1,t??null,i,!1,s,o),n[li]=e.current,sc(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Ph(e)};Ln.render=function(n,e,t){if(!Rh(e))throw Error($(200));return kh(null,n,e,!1,t)};Ln.unmountComponentAtNode=function(n){if(!Rh(n))throw Error($(40));return n._reactRootContainer?(to(function(){kh(null,null,n,!1,function(){n._reactRootContainer=null,n[li]=null})}),!0):!1};Ln.unstable_batchedUpdates=Wy;Ln.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Rh(t))throw Error($(200));if(n==null||n._reactInternals===void 0)throw Error($(38));return kh(n,e,t,!1,r)};Ln.version="18.3.1-next-f1338f8080-20240426";function nO(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(nO)}catch(n){console.error(n)}}nO(),nT.exports=Ln;var wA=nT.exports,hw=wA;Km.createRoot=hw.createRoot,Km.hydrateRoot=hw.hydrateRoot;function zc(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function gi(n,e,t,r){return new(t||(t=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?i(c.value):(u=c.value,u instanceof t?u:new t(function(d){d(u)})).then(o,a)}l((r=r.apply(n,e||[])).next())})}const CA={childProxyingCommunication:!1};function rO(){return CA.childProxyingCommunication}let EA={disableEnforceOriginMatchForChildResponses:!1};function _A(){return EA}var fw,pw,mw,qd,gw,vw,yw,qg,Sw,bw;function TA(n){return(n==null?void 0:n.errorCode)!==void 0}(function(n){n.Inline="inline",n.Desktop="desktop",n.Web="web"})(fw||(fw={})),function(n){n.M365Content="m365content"}(pw||(pw={})),function(n){n.DriveId="driveId",n.GroupId="groupId",n.SiteId="siteId",n.UserId="userId"}(mw||(mw={})),function(n){n[n.NOT_SUPPORTED_ON_PLATFORM=100]="NOT_SUPPORTED_ON_PLATFORM",n[n.INTERNAL_ERROR=500]="INTERNAL_ERROR",n[n.NOT_SUPPORTED_IN_CURRENT_CONTEXT=501]="NOT_SUPPORTED_IN_CURRENT_CONTEXT",n[n.PERMISSION_DENIED=1e3]="PERMISSION_DENIED",n[n.NETWORK_ERROR=2e3]="NETWORK_ERROR",n[n.NO_HW_SUPPORT=3e3]="NO_HW_SUPPORT",n[n.INVALID_ARGUMENTS=4e3]="INVALID_ARGUMENTS",n[n.UNAUTHORIZED_USER_OPERATION=5e3]="UNAUTHORIZED_USER_OPERATION",n[n.INSUFFICIENT_RESOURCES=6e3]="INSUFFICIENT_RESOURCES",n[n.THROTTLE=7e3]="THROTTLE",n[n.USER_ABORT=8e3]="USER_ABORT",n[n.OPERATION_TIMED_OUT=8001]="OPERATION_TIMED_OUT",n[n.OLD_PLATFORM=9e3]="OLD_PLATFORM",n[n.FILE_NOT_FOUND=404]="FILE_NOT_FOUND",n[n.SIZE_EXCEEDED=1e4]="SIZE_EXCEEDED"}(qd||(qd={})),function(n){n.GeoLocation="geolocation",n.Media="media"}(gw||(gw={})),function(n){n.BCAIS="bcais",n.BCWAF="bcwaf",n.BCWBF="bcwbf"}(vw||(vw={})),function(n){n.Faculty="faculty",n.Student="student",n.Other="other"}(yw||(yw={})),function(n){n.Adult="adult",n.MinorNoParentalConsentRequired="minorNoParentalConsentRequired",n.MinorWithoutParentalConsent="minorWithoutParentalConsent",n.MinorWithParentalConsent="minorWithParentalConsent",n.NotAdult="notAdult",n.NonAdult="notAdult"}(qg||(qg={})),function(n){n.HigherEducation="higherEducation",n.K12="k12",n.Other="other"}(Sw||(Sw={})),function(n){n.TextPlain="text/plain",n.TextHtml="text/html",n.ImagePNG="image/png",n.ImageJPEG="image/jpeg"}(bw||(bw={}));var Se,Bg,Bn,ww,Cw,Ew,_w,Tw;(function(n){n.desktop="desktop",n.web="web",n.android="android",n.ios="ios",n.ipados="ipados",n.macos="macos",n.visionOS="visionOS",n.rigel="rigel",n.surfaceHub="surfaceHub",n.teamsRoomsWindows="teamsRoomsWindows",n.teamsRoomsAndroid="teamsRoomsAndroid",n.teamsPhones="teamsPhones",n.teamsDisplays="teamsDisplays"})(Se||(Se={})),function(n){n.office="Office",n.outlook="Outlook",n.outlookWin32="OutlookWin32",n.orange="Orange",n.places="Places",n.teams="Teams",n.teamsModern="TeamsModern"}(Bg||(Bg={})),function(n){n.settings="settings",n.content="content",n.authentication="authentication",n.remove="remove",n.task="task",n.sidePanel="sidePanel",n.stage="stage",n.meetingStage="meetingStage"}(Bn||(Bn={})),function(n){n.copilotSidePanel="copilotSidePanel",n.copilotMainPane="copilotMainPane",n.copilotFullScreen="copilotFullScreen"}(ww||(ww={})),function(n){n[n.Standard=0]="Standard",n[n.Edu=1]="Edu",n[n.Class=2]="Class",n[n.Plc=3]="Plc",n[n.Staff=4]="Staff"}(Cw||(Cw={})),function(n){n[n.Admin=0]="Admin",n[n.User=1]="User",n[n.Guest=2]="Guest"}(Ew||(Ew={})),function(n){n.Large="large",n.Medium="medium",n.Small="small"}(_w||(_w={})),function(n){n.Regular="Regular",n.Private="Private",n.Shared="Shared"}(Tw||(Tw={}));const xA={errorCode:qd.NOT_SUPPORTED_ON_PLATFORM},iO={adaptiveCardSchemaVersion:{majorVersion:1,minorVersion:5}};var xw={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let ku;const OA=new Uint8Array(16);function PA(){if(!ku&&(ku=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ku))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ku(OA)}const Et=[];for(let n=0;n<256;++n)Et.push((n+256).toString(16).slice(1));function RA(n,e=0){return Et[n[e+0]]+Et[n[e+1]]+Et[n[e+2]]+Et[n[e+3]]+"-"+Et[n[e+4]]+Et[n[e+5]]+"-"+Et[n[e+6]]+Et[n[e+7]]+"-"+Et[n[e+8]]+Et[n[e+9]]+"-"+Et[n[e+10]]+Et[n[e+11]]+Et[n[e+12]]+Et[n[e+13]]+Et[n[e+14]]+Et[n[e+15]]}function kA(n,e,t){if(xw.randomUUID&&!e&&!n)return xw.randomUUID();const r=(n=n||{}).random||(n.rng||PA)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,RA(r)}var NA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function LA(n){return typeof n=="string"&&NA.test(n)}function sO(n,e){if(typeof n!="string"||typeof e!="string")return NaN;const t=n.split("."),r=e.split(".");function i(s){return/^\d+$/.test(s)}if(!t.every(i)||!r.every(i))return NaN;for(;t.length<r.length;)t.push("0");for(;r.length<t.length;)r.push("0");for(let s=0;s<t.length;++s)if(Number(t[s])!=Number(r[s]))return Number(t[s])>Number(r[s])?1:-1;return 0}function IA(){return kA()}function oO(n){return Object.keys(n).forEach(e=>{n[e]!==null&&n[e]!==void 0&&typeof n[e]=="object"&&oO(n[e])}),Object.freeze(n)}function AA(n,e,t){return new Promise((r,i)=>{const s=setTimeout(i,e,t);n().then(o=>{clearTimeout(s),r(o)}).catch(o=>{clearTimeout(s),i(o)})})}function MA(n){return n.protocol==="https:"}function DA(){if(Nh())throw new Error("window object undefined at SSR check");return window}function Nh(){return typeof window>"u"}function FA(n){return new RegExp(`${/<script[^>]*>|&lt;script[^&]*&gt;|%3Cscript[^%]*%3E/gi.source}|${/<\/script[^>]*>|&lt;\/script[^&]*&gt;|%3C\/script[^%]*%3E/gi.source}`,"gi").test(n)}function zA(n){if(!n)throw new Error("id must not be empty");if(LA(n)===!1)throw new Error("id must be a valid UUID")}const $A=!!performance&&"now"in performance;function e0(){return $A?performance.now()+performance.timeOrigin:void 0}function Ow(n){var e,t;if(!(!((t=(e=n.hostVersionsInfo)===null||e===void 0?void 0:e.appEligibilityInformation)===null||t===void 0)&&t.ageGroup))return n;const r=n.hostVersionsInfo.appEligibilityInformation.ageGroup;return(r==null?void 0:r.toLowerCase())!=="nonadult"?n:Object.assign(Object.assign({},n),{hostVersionsInfo:Object.assign(Object.assign({},n.hostVersionsInfo),{appEligibilityInformation:Object.assign(Object.assign({},n.hostVersionsInfo.appEligibilityInformation),{ageGroup:qg.NotAdult})})})}let Ma=class{constructor(e=IA()){this.uuid=e,zA(e)}toString(){return this.uuid}serialize(){return this.toString()}};const aO=n=>{const{uuid:e}=n,t=zc(n,["uuid"]),r=e==null?void 0:e.toString();return Object.assign(Object.assign({},t),{uuidAsString:r})},jA=n=>{const{uuidAsString:e}=n,t=zc(n,["uuidAsString"]);return Object.assign(Object.assign({},t),{uuid:e?new Ma(e):void 0})},qA=n=>{const{uuidAsString:e}=n,t=zc(n,["uuidAsString"]);return Object.assign(Object.assign({},t),{uuid:e?new Ma(e):void 0})},BA=n=>{const{uuid:e}=n,t=zc(n,["uuid"]),r=e==null?void 0:e.toString();return Object.assign(Object.assign({},t),{uuidAsString:r})};var Ug={exports:{}},Pw,Rw;function UA(){if(Rw)return Pw;Rw=1;var n=1e3,e=60*n,t=60*e,r=24*t,i=7*r,s=365.25*r;function o(a,l,c,u){var d=l>=1.5*c;return Math.round(a/c)+" "+u+(d?"s":"")}return Pw=function(a,l){l=l||{};var c=typeof a;if(c==="string"&&a.length>0)return function(u){if(!((u=String(u)).length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]);switch((d[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}(a);if(c==="number"&&isFinite(a))return l.long?function(u){var d=Math.abs(u);return d>=r?o(u,d,r,"day"):d>=t?o(u,d,t,"hour"):d>=e?o(u,d,e,"minute"):d>=n?o(u,d,n,"second"):u+" ms"}(a):function(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}var HA=function(n){function e(i){let s,o,a,l=null;function c(...u){if(!c.enabled)return;const d=c,h=Number(new Date),f=h-(s||h);d.diff=f,d.prev=s,d.curr=h,s=h,u[0]=e.coerce(u[0]),typeof u[0]!="string"&&u.unshift("%O");let p=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,(g,S)=>{if(g==="%%")return"%";p++;const m=e.formatters[S];if(typeof m=="function"){const v=u[p];g=m.call(d,v),u.splice(p,1),p--}return g}),e.formatArgs.call(d,u),(d.log||e.log).apply(d,u)}return c.namespace=i,c.useColors=e.useColors(),c.color=e.selectColor(i),c.extend=t,c.destroy=e.destroy,Object.defineProperty(c,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(o!==e.namespaces&&(o=e.namespaces,a=e.enabled(i)),a),set:u=>{l=u}}),typeof e.init=="function"&&e.init(c),c}function t(i,s){const o=e(this.namespace+(s===void 0?":":s)+i);return o.log=this.log,o}function r(i){return i.toString().substring(2,i.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(i){return i instanceof Error?i.stack||i.message:i},e.disable=function(){const i=[...e.names.map(r),...e.skips.map(r).map(s=>"-"+s)].join(",");return e.enable(""),i},e.enable=function(i){let s;e.save(i),e.namespaces=i,e.names=[],e.skips=[];const o=(typeof i=="string"?i:"").split(/[\s,]+/),a=o.length;for(s=0;s<a;s++)o[s]&&((i=o[s].replace(/\*/g,".*?"))[0]==="-"?e.skips.push(new RegExp("^"+i.slice(1)+"$")):e.names.push(new RegExp("^"+i+"$")))},e.enabled=function(i){if(i[i.length-1]==="*")return!0;let s,o;for(s=0,o=e.skips.length;s<o;s++)if(e.skips[s].test(i))return!1;for(s=0,o=e.names.length;s<o;s++)if(e.names[s].test(i))return!0;return!1},e.humanize=UA(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(n).forEach(i=>{e[i]=n[i]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(i){let s=0;for(let o=0;o<i.length;o++)s=(s<<5)-s+i.charCodeAt(o),s|=0;return e.colors[Math.abs(s)%e.colors.length]},e.enable(e.load()),e};(function(n,e){e.formatArgs=function(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;r.splice(1,0,i,"color: inherit");let s=0,o=0;r[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(s++,a==="%c"&&(o=s))}),r.splice(o,0,i)},e.save=function(r){try{r?e.storage.setItem("debug",r):e.storage.removeItem("debug")}catch{}},e.load=function(){let r;try{r=e.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r={}.DEBUG),r},e.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch{}}(),e.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),n.exports=HA(e);const{formatters:t}=n.exports;t.j=function(r){try{return JSON.stringify(r)}catch(i){return"[UnexpectedJSONParseError]: "+i.message}}})(Ug,Ug.exports);var t0=Ug.exports;const VA=new Ma,WA=t0.debug.formatArgs;t0.debug.formatArgs=function(n){n[0]=`(${new Date().toISOString()}): ${n[0]} [${VA.toString()}]`,WA.call(this,n)};const GA=t0.debug("teamsJs");function jr(n){return GA.extend(n)}function Ce(n,e){return`${n}_${e}`}function lO(n){return/^v\d+_[\w.]+$/.test(n)}function Hn(n){return n.uuidAsString!==void 0?`${n.uuidAsString} (legacy id: ${n.id})`:n.uuid!==void 0?`${n.uuid.toString()} (legacy id: ${n.id})`:`legacy id: ${n.id} (no uuid)`}const KA=jr("flushMessageQueue");function n0(n,e,t,r){if(n&&e&&t.length!==0)for(;t.length>0;){const i=t.shift();if(i){const s=aO(i);KA("Flushing message %s from %s message queue via postMessage.",Hn(s),r),n.postMessage(s,e)}}}var JA=["teams.microsoft.com","teams.microsoft.us","gov.teams.microsoft.us","dod.teams.microsoft.us","int.teams.microsoft.com","outlook.office.com","outlook-sdf.office.com","outlook.office365.com","outlook-sdf.office365.com","outlook.office365.us","outlook-dod.office365.us","webmail.apps.mil","outlook.live.com","outlook-sdf.live.com","teams.live.com","local.teams.live.com","local.teams.live.com:8080","local.teams.office.com","local.teams.office.com:8080","devspaces.skype.com","*.www.office.com","www.office.com","word.office.com","excel.office.com","powerpoint.office.com","www.officeppe.com","*.www.microsoft365.com","www.microsoft365.com","bing.com","edgeservices.bing.com","work.bing.com","www.bing.com","www.staging-bing-int.com","*.cloud.microsoft","*.m365.cloud.microsoft","*.outlook.cloud.microsoft","chatuxmanager.svc.cloud.microsoft","copilot.microsoft.com","windows.msn.com","fa000000125.resources.office.net","fa000000129.resources.office.net","fa000000124.resources.office.net","fa000000128.resources.office.net","fa000000136.resources.office.net","fa000000125.officeapps.live.com","fa000000129.officeapps.live.com","fa000000124.officeapps.live.com","fa000000128.officeapps.live.com"];const kw="2.0.1",td=JA,Nw=1500,QA=new URL("https://res.cdn.office.net/teams-js/validDomains/json/validDomains.json"),XA=/^https:\/\//,pc="The library has not yet been initialized",YA="The runtime has not yet been initialized",ZA="The runtime version is not supported";let le=class{};le.initializeCalled=!1,le.initializeCompleted=!1,le.additionalValidOrigins=[],le.initializePromise=void 0,le.isFramelessWindow=!1,le.frameContext=void 0,le.hostClientType=void 0,le.printCapabilityEnabled=!1,le.teamsJsInstanceId=new Ma().toString();const cO=jr("runtime"),Lh=4;function uO(n){return n.apiVersion===Lh}function eM(n){if(uO(n))return!0;throw n.apiVersion===-1?new Error(YA):new Error(ZA)}let fn={apiVersion:-1,supports:{}};const tM={apiVersion:4,isNAAChannelRecommended:!1,isDeeplyNestedAuthSupported:!1,hostVersionsInfo:iO,isLegacyTeams:!0,supports:{appInstallDialog:{},appEntity:{},call:{},chat:{},conversations:{},dialog:{card:{bot:{}},url:{bot:{},parentCommunication:{}},update:{}},interactive:{},logs:{},meetingRoom:{},menus:{},monetization:{},notifications:{},pages:{config:{},backStack:{},fullTrust:{}},remoteCamera:{},teams:{fullTrust:{}},teamsCore:{},video:{sharedFrame:{}}}},dO=[Se.desktop,Se.web,Se.rigel,Se.surfaceHub,Se.teamsRoomsWindows,Se.teamsRoomsAndroid,Se.teamsPhones,Se.teamsDisplays],nM=[Se.android,Se.ios,Se.ipados,Se.visionOS],Lw=[...dO,...nM];function rM(n){let e=n;if(e.apiVersion<Lh&&iM.forEach(t=>{e.apiVersion===t.versionToUpgradeFrom&&(e=t.upgradeToNextVersion(e))}),uO(e))return e;throw new Error("Received a runtime that could not be upgraded to the latest version")}const iM=[{versionToUpgradeFrom:1,upgradeToNextVersion:n=>{var e;return{apiVersion:2,hostVersionsInfo:void 0,isLegacyTeams:n.isLegacyTeams,supports:Object.assign(Object.assign({},n.supports),{dialog:n.supports.dialog?{card:void 0,url:n.supports.dialog,update:(e=n.supports.dialog)===null||e===void 0?void 0:e.update}:void 0})}}},{versionToUpgradeFrom:2,upgradeToNextVersion:n=>{const e=n.supports,t=zc(e,["appNotification"]);return Object.assign(Object.assign({},n),{apiVersion:3,supports:t})}},{versionToUpgradeFrom:3,upgradeToNextVersion:n=>{var e,t,r,i,s;return{apiVersion:4,hostVersionsInfo:n.hostVersionsInfo,isNAAChannelRecommended:n.isNAAChannelRecommended,isLegacyTeams:n.isLegacyTeams,supports:Object.assign(Object.assign({},n.supports),{dialog:n.supports.dialog?{card:(e=n.supports.dialog)===null||e===void 0?void 0:e.card,url:{bot:(r=(t=n.supports.dialog)===null||t===void 0?void 0:t.url)===null||r===void 0?void 0:r.bot,parentCommunication:!((i=n.supports.dialog)===null||i===void 0)&&i.url?{}:void 0},update:(s=n.supports.dialog)===null||s===void 0?void 0:s.update}:void 0})}}}],sM={"1.0.0":[{capability:{pages:{appButton:{},tabs:{}},stageView:{}},hostClientTypes:dO}],"1.9.0":[{capability:{location:{}},hostClientTypes:Lw}],"2.0.0":[{capability:{people:{}},hostClientTypes:Lw},{capability:{sharing:{}},hostClientTypes:[Se.desktop,Se.web]}],"2.0.1":[{capability:{teams:{fullTrust:{joinedTeams:{}}}},hostClientTypes:[Se.android,Se.desktop,Se.ios,Se.teamsRoomsAndroid,Se.teamsPhones,Se.teamsDisplays,Se.web]},{capability:{webStorage:{}},hostClientTypes:[Se.desktop]}],"2.0.5":[{capability:{webStorage:{}},hostClientTypes:[Se.android,Se.ios]}],"2.0.8":[{capability:{sharing:{}},hostClientTypes:[Se.android,Se.ios]}],"2.1.1":[{capability:{nestedAppAuth:{}},hostClientTypes:[Se.android,Se.ios,Se.ipados,Se.visionOS]}],"2.1.2":[]},Sp=cO.extend("generateBackCompatRuntimeConfig");function hO(n,e){const t=Object.assign({},n);for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(typeof e[r]!="object"||Array.isArray(e[r])?r in n||(t[r]=e[r]):t[r]=hO(n[r]||{},e[r]));return t}function oM(n,e,t){Sp("generating back compat runtime config for %s",n);let r=Object.assign({},e.supports);Sp("Supported capabilities in config before updating based on highestSupportedVersion: %o",r),Object.keys(t).forEach(s=>{sO(n,s)>=0&&t[s].forEach(o=>{le.hostClientType!==void 0&&o.hostClientTypes.includes(le.hostClientType)&&(r=hO(r,o.capability))})});const i={apiVersion:Lh,hostVersionsInfo:iO,isLegacyTeams:!0,supports:r};return Sp("Runtime config after updating based on highestSupportedVersion: %o",i),i}const bp=cO.extend("applyRuntimeConfig");function wp(n){typeof n.apiVersion=="string"&&(bp("Trying to apply runtime with string apiVersion, processing as v1: %o",n),n=Object.assign(Object.assign({},n),{apiVersion:1})),bp("Fast-forwarding runtime %o",n);const e=rM(n);bp("Applying runtime %o",e),fn=oO(e)}function aM(n){return n!=null&&n.serialize!==void 0&&typeof n.serialize=="function"}const mc="2.46.0";let Bd=class Io{static storeCallbackInformation(e,t){Io.callbackInformation.set(e,t)}static clearMessages(){Io.callbackInformation.clear()}static deleteMessageInformation(e){Io.callbackInformation.delete(e)}static handleOneWayPerformanceMetrics(e,t,r){const i=e.monotonicTimestamp;i&&r?Hw({actionName:e.func,messageDelay:r-i,requestStartedAt:i}):t("Unable to send performance metrics for event %s",e.func)}static handlePerformanceMetrics(e,t,r,i){const s=Io.callbackInformation.get(e);s&&t.monotonicTimestamp&&i?(Hw({actionName:s.name,messageDelay:i-t.monotonicTimestamp,requestStartedAt:s.calledAt}),Io.deleteMessageInformation(e)):r("Unable to send performance metrics for callback %s with arguments %o",e.toString(),t.args)}};Bd.callbackInformation=new Map;const fO=jr("nestedAppAuthUtils"),lM=fO.extend("tryPolyfillWithNestedAppAuthBridge"),cM="v2";function uM(n,e,t){var r;const i=lM;if(le.isFramelessWindow)return void i("Cannot polyfill nestedAppAuthBridge as current window is frameless");if(!e)return void i("Cannot polyfill nestedAppAuthBridge as current window does not exist");if(e.parent!==e.top)return void i("Default NAA bridge injection not supported in nested iframe. Use standalone NAA bridge instead.");const s=(()=>{try{return JSON.parse(n)}catch{return null}})();if(!s||!(!((r=s.supports)===null||r===void 0)&&r.nestedAppAuth))return void i("Cannot polyfill nestedAppAuthBridge as current hub does not support nested app auth");const o=e;if(o.nestedAppAuthBridge)return void i("nestedAppAuthBridge already exists on current window, skipping polyfill");const a=function(l,c){const u=dM;if(!l)return u("nestedAppAuthBridge cannot be created as current window does not exist"),null;const{onMessage:d,sendPostMessage:h}=c,f=p=>g=>d(g,p);return{addEventListener:(p,g)=>{p==="message"?l.addEventListener(p,f(g)):u(`Event ${p} is not supported by nestedAppAuthBridge`)},postMessage:p=>{const g=(()=>{try{return JSON.parse(p)}catch{return null}})();if(!g||typeof g!="object"||g.messageType!=="NestedAppAuthRequest")return void u("Unrecognized data format received by app, message being ignored. Message: %o",p);const S=Ce(cM,"nestedAppAuth.execute");h(p,S)},removeEventListener:(p,g)=>{l.removeEventListener(p,f(g))}}}(o,t);a&&(o.nestedAppAuthBridge=a)}const dM=fO.extend("createNestedAppAuthBridge");let Ri=[];const Ii=jr("validateOrigin");let xl;function hM(){return gi(this,void 0,void 0,function*(){xl||(yield mO())})}function pO(){return Ri.length===0}function mO(n=!1){return gi(this,void 0,void 0,function*(){if(!pO()&&!n)return Ri;if(xl)return xl;if(Nh())return Ri=td,td;{Ii("Initiating fetch call to acquire valid origins list from CDN");const e=new AbortController,t=setTimeout(()=>e.abort(),Nw);return xl=fetch(QA,{signal:e.signal}).then(r=>{if(clearTimeout(t),!r.ok)throw new Error("Invalid Response from Fetch Call");return Ii("Fetch call completed and retrieved valid origins list from CDN"),r.json().then(i=>{if(function(s){let o=JSON.parse(s);try{o=JSON.parse(s)}catch{return!1}if(!o.validOrigins)return!1;for(const a of o.validOrigins)try{new URL("https://"+a)}catch{return Ii("isValidOriginsFromCDN call failed to validate origin: %s",a),!1}return!0}(JSON.stringify(i)))return Ri=i.validOrigins,Ri;throw new Error("Valid origins list retrieved from CDN is invalid")})}).catch(r=>(r.name==="AbortError"?Ii(`validOrigins fetch call to CDN failed due to Timeout of ${Nw} ms. Defaulting to fallback list`):Ii("validOrigins fetch call to CDN failed with error: %s. Defaulting to fallback list",r),Ri=td,Ri)),xl}})}function Iw(n,e){if(n.substring(0,2)==="*."){const t=n.substring(1);if(e.length>t.length&&e.split(".").length===t.split(".").length&&e.substring(e.length-t.length)===t)return!0}else if(n===e)return!0;return!1}function fM(n,e){const t=pO()?td:Ri;return Aw(n,t)?Promise.resolve(!0):(Ii("Origin %s is not in the local valid origins list, fetching from CDN",n),mO(e).then(r=>Aw(n,r)))}function Aw(n,e){if(!MA(n))return Ii("Origin %s is invalid because it is not using https protocol. Protocol being used: %s",n,n.protocol),!1;const t=n.host;if(e.some(r=>Iw(r,t)))return!0;for(const r of le.additionalValidOrigins)if(Iw(r.substring(0,8)==="https://"?r.substring(8):r,t))return!0;return Ii(`Origin %s is invalid because it is not an origin approved by this library or included in the call to app.initialize.
Origins approved by this library: %o
Origins included in app.initialize: %o`,n,e,le.additionalValidOrigins),!1}hM();const fo=jr("communication");let Y=class{},be=class{};function pM(n,e){if(be.messageListener=t=>function(r){return gi(this,void 0,void 0,function*(){if(!r||!r.data||typeof r.data!="object")return void Mw("Unrecognized message format received by app, message being ignored. Message: %o",r);const i=r.source||r.originalEvent&&r.originalEvent.source,s=r.origin||r.originalEvent&&r.originalEvent.origin;return vO(i,s).then(o=>{o?(function(a,l){le.isFramelessWindow||Y.parentWindow&&!Y.parentWindow.closed&&a!==Y.parentWindow||(Y.parentWindow=a,Y.parentOrigin=l),Y.parentWindow&&Y.parentWindow.closed&&(Y.parentWindow=null,Y.parentOrigin=null),n0(Y.parentWindow,Y.parentOrigin,be.parentMessageQueue,"parent")}(i,s),i!==Y.parentWindow?fD(i,s)&&pD(r,i,r0,(a,l)=>be.callbacks.set(a,l)):Fw(r)):Mw("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin, message: %o, source: %o, origin: %o",r,i,s)})})}(t),Y.currentWindow=Y.currentWindow||DA(),Y.parentWindow=Y.currentWindow.parent!==Y.currentWindow.self?Y.currentWindow.parent:Y.currentWindow.opener,Y.topWindow=Y.currentWindow.top,(Y.parentWindow||n)&&Y.currentWindow.addEventListener("message",be.messageListener,!1),!Y.parentWindow){const t=Y.currentWindow;if(!t.nativeInterface)return Promise.reject(new Error("Initialization Failed. No Parent window found."));le.isFramelessWindow=!0,t.onNativeMessage=Fw}try{return Y.parentOrigin="*",$c(e,"initialize",[mc,Lh,n]).then(([t,r,i,s])=>(uM(s,Y.currentWindow,{onMessage:_M,sendPostMessage:bM}),{context:t,clientType:r,runtimeConfig:i,clientSupportedSDKVersion:s}))}finally{Y.parentOrigin=null}}function mM(n,e,...t){return $c(n,e,t).then(([r])=>r)}function gM(n,e,t,...r){return $c(n,e,r).then(([i,s])=>{if(!i)throw new Error(s||t)})}function Ci(n,e,...t){return $c(n,e,t).then(([r,i])=>{if(r)throw r;return i})}function $c(n,e,t=void 0){if(!lO(n))throw Error(`apiVersionTag: ${n} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);return new Promise(r=>{const i=r0(n,e,t);var s;r((s=i.uuid,new Promise(o=>{be.promiseCallbacks.set(s,o)})))})}function vM(n){return n.map(e=>aM(e)?e.serialize():e)}function yM(n,e,t,r,i){var s;return gi(this,void 0,void 0,function*(){const o=vM(e),[a]=yield $c(r,n,o);if(i&&i(a)||!i&&TA(a))throw new Error(`${a.errorCode}, message: ${(s=a.message)!==null&&s!==void 0?s:"None"}`);if(t.validate(a))return t.deserialize(a);throw new Error(`${qd.INTERNAL_ERROR}, message: Invalid response from host - ${JSON.stringify(a)}`)})}function Rn(n,e,t,r){let i;if(t instanceof Function?r=t:t instanceof Array&&(i=t),!lO(n))throw Error(`apiVersionTag: ${n} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);const s=r0(n,e,i);r&&be.callbacks.set(s.uuid,r)}be.parentMessageQueue=[],be.topMessageQueue=[],be.nextMessageId=0,be.callbacks=new Map,be.promiseCallbacks=new Map,be.portCallbacks=new Map,be.legacyMessageIdsToUuidMap={};const SM=fo.extend("sendNestedAuthRequestToTopWindow");function bM(n,e){const t=SM,r=Y.topWindow,i=function(s,o){const a=be.nextMessageId++,l=new Ma;return be.legacyMessageIdsToUuidMap[a]=l,{id:a,uuid:l,func:"nestedAppAuth.execute",timestamp:Date.now(),monotonicTimestamp:e0(),apiVersionTag:o,args:[],data:s}}(n,e);return t("Message %s information: %o",Hn(i),{actionName:i.func}),gO(r,i)}const wM=fo.extend("sendRequestToTargetWindowHelper");function gO(n,e){const t=wM,r=function(s){return s===Y.topWindow&&Hg()?"top":s===Y.parentWindow?"parent":null}(n),i=aO(e);if(le.isFramelessWindow)Y.currentWindow&&Y.currentWindow.nativeInterface&&(t("Sending message %s to %s via framelessPostMessage interface",Hn(i),r),Y.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(i)));else{const s=function(o){return o===Y.topWindow&&Hg()?Y.topOrigin:o===Y.parentWindow?Y.parentOrigin:null}(n);n&&s?(t("Sending message %s to %s via postMessage",Hn(i),r),n.postMessage(i,s)):(t("Adding message %s to %s message queue",Hn(i),r),TM(n).push(e))}return e}const CM=fo.extend("sendMessageToParentHelper");function r0(n,e,t,r,i){const s=CM,o=Y.parentWindow,a=function(l,c,u,d,h){const f=be.nextMessageId++,p=new Ma;be.legacyMessageIdsToUuidMap[f]=p;const g=d===!0?h:le.teamsJsInstanceId;return{id:f,uuid:p,func:c,timestamp:Date.now(),monotonicTimestamp:e0(),args:u||[],apiVersionTag:l,isProxiedFromChild:d!=null&&d,teamsJsInstanceId:g}}(n,e,t,r,i);return Bd.storeCallbackInformation(a.uuid,{name:e,calledAt:a.timestamp}),s("Message %s information: %o",Hn(a),{actionName:e,args:t}),gO(o,a)}const Mw=fo.extend("processIncomingMessage"),EM=fo.extend("processAuthBridgeMessage");function _M(n,e){var t,r;const i=EM;if(!n||!n.data||typeof n.data!="object")return void i("Unrecognized message format received by app, message being ignored. Message: %o",n);const{args:s}=n.data,[,o]=s??[],a=(()=>{try{return JSON.parse(o)}catch{return null}})();if(!a||typeof a!="object"||a.messageType!=="NestedAppAuthResponse")return void i("Unrecognized data format received by app, message being ignored. Message: %o",n);const l=n.source||((t=n==null?void 0:n.originalEvent)===null||t===void 0?void 0:t.source),c=n.origin||((r=n==null?void 0:n.originalEvent)===null||r===void 0?void 0:r.origin);l?vO(l,c)?(Y.topWindow&&!Y.topWindow.closed&&l!==Y.topWindow||(Y.topWindow=l,Y.topOrigin=c),Y.topWindow&&Y.topWindow.closed&&(Y.topWindow=null,Y.topOrigin=null),n0(Y.topWindow,Y.topOrigin,be.topMessageQueue,"top"),e(o)):i("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin"):i("Message being ignored by app because it is coming for a target that is null")}const Cp=fo.extend("shouldProcessIncomingMessage");function vO(n,e){return gi(this,void 0,void 0,function*(){if(Y.currentWindow&&n===Y.currentWindow)return Cp("Should not process message because it is coming from the current window"),!1;if(Y.currentWindow&&Y.currentWindow.location&&e&&e===Y.currentWindow.location.origin)return!0;{let t;try{t=new URL(e)}catch{return Cp("Message has an invalid origin of %s",e),!1}const r=yield fM(t);return r||Cp("Message has an invalid origin of %s",e),r}})}const Dw=fo.extend("handleIncomingMessageFromParent");function nd(n,e){if(e){const t=[...n].find(([r,i])=>r.toString()===e.toString());if(t)return t[0]}}function Ep(n,e){const t=nd(e,n.uuid);t&&e.delete(t),n.uuid?be.legacyMessageIdsToUuidMap={}:delete be.legacyMessageIdsToUuidMap[n.id]}function Fw(n){const e=Dw,t=e0();if("id"in n.data&&typeof n.data.id=="number"){const r=n.data,i=qA(r),s=function(o){const a=Dw;if(!o.uuid)return be.legacyMessageIdsToUuidMap[o.id];{const l=o.uuid,c=nd(be.callbacks,l);if(c)return c;const u=nd(be.promiseCallbacks,l);if(u)return u;const d=nd(be.portCallbacks,l);if(d)return d}a("Received message %s that failed to produce a callbackId",Hn(o))}(i);if(s){const o=be.callbacks.get(s);e("Received a response from parent for message %s",s.toString()),Bd.handlePerformanceMetrics(s,i,e,t),o&&(e("Invoking the registered callback for message %s with arguments %o",s.toString(),i.args),o.apply(null,[...i.args,i.isPartialResponse]),function(c){return c.data.isPartialResponse===!0}(n)||(e("Removing registered callback for message %s",s.toString()),Ep(i,be.callbacks)));const a=be.promiseCallbacks.get(s);a&&(e("Invoking the registered promise callback for message %s with arguments %o",s.toString(),i.args),a(i.args),e("Removing registered promise callback for message %s",s.toString()),Ep(i,be.promiseCallbacks));const l=be.portCallbacks.get(s);if(l){let c;e("Invoking the registered port callback for message %s with arguments %o",s.toString(),i.args),n.ports&&n.ports[0]instanceof MessagePort&&(c=n.ports[0]),l(c,i.args),e("Removing registered port callback for message %s",s.toString()),Ep(i,be.portCallbacks)}i.uuid&&(be.legacyMessageIdsToUuidMap={})}}else if("func"in n.data&&typeof n.data.func=="string"){const r=n.data;Bd.handleOneWayPerformanceMetrics(r,e,t),e('Received a message from parent %s, action: "%s"',Hn(r),r.func),EO(r.func,r.args)}else e("Received an unknown message: %O",n)}function Hg(){return Y.topWindow!==Y.parentWindow}function TM(n){return n===Y.topWindow&&Hg()?be.topMessageQueue:n===Y.parentWindow?be.parentMessageQueue:[]}const yO=jr("internal"),xM=yO.extend("ensureInitializeCalled"),OM=yO.extend("ensureInitialized");function SO(){if(!le.initializeCalled)throw xM(pc),new Error(pc)}function vi(n,...e){if(!le.initializeCompleted)throw OM("%s. initializeCalled: %s",pc,le.initializeCalled.toString()),new Error(pc);if(e&&e.length>0){let t=!1;for(let r=0;r<e.length;r++)if(e[r]===le.frameContext){t=!0;break}if(!t)throw new Error(`This call is only allowed in following contexts: ${JSON.stringify(e)}. Current context: "${le.frameContext}".`)}return eM(n)}function PM(n){let e=le.additionalValidOrigins.concat(n.filter(r=>typeof r=="string"&&XA.test(r)));const t={};e=e.filter(r=>!t[r]&&(t[r]=!0,!0)),le.additionalValidOrigins=e}function RM(n){if(!NM(n))throw new Error(`Potential app id (${n}) is invalid; its length ${n.length} is not within the length limits (${bO}-${wO}).`)}function kM(n){if(FA(n))throw new Error(`Potential app id (${n}) is invalid; it contains script tags.`);if(LM(n))throw new Error(`Potential app id (${n}) is invalid; it contains non-printable characters.`)}const bO=4,wO=256;function NM(n){return n.length<wO&&n.length>bO}function LM(n){return[...n].some(e=>{const t=e.charCodeAt(0);return t<32||t>126})}let IM=class{constructor(e){this.idAsString=e,kM(e)}serialize(){return this.toString()}toString(){return this.idAsString}},AM=class extends IM{constructor(e){super(e),RM(e)}toJSON(){return{appIdAsString:this.toString()}}};const Ih="v2",_p=jr("app"),Vg={AppLoaded:"appInitialization.appLoaded",Success:"appInitialization.success",Failure:"appInitialization.failure",ExpectedFailure:"appInitialization.expectedFailure"};var zw,$w;function Ah(n){return YM(Ce(Ih,"app.initialize"),n)}function i0(){return new Promise(n=>{SO(),n(mM(Ce(Ih,"app.getContext"),"getContext"))}).then(n=>function(e){var t;return{actionInfo:e.actionInfo,app:{locale:e.locale,sessionId:e.appSessionId?e.appSessionId:"",theme:e.theme?e.theme:"default",iconPositionVertical:e.appIconPosition,osLocaleInfo:e.osLocaleInfo,messageId:e.messageId,parentMessageId:e.parentMessageId,userClickTime:e.userClickTime,userClickTimeV2:e.userClickTimeV2,userFileOpenPreference:e.userFileOpenPreference,host:{name:e.hostName?e.hostName:Bg.teams,clientType:e.hostClientType?e.hostClientType:Se.web,sessionId:e.sessionId?e.sessionId:"",ringId:e.ringId},appLaunchId:e.appLaunchId,appId:e.appId?new AM(e.appId):void 0,manifestVersion:e.manifestVersion},page:{id:e.entityId,frameContext:e.frameContext?e.frameContext:le.frameContext,renderingSurface:e.renderingSurface?e.renderingSurface:void 0,subPageId:e.subEntityId,isFullScreen:e.isFullScreen,isMultiWindow:e.isMultiWindow,isBackgroundLoad:e.isBackgroundLoad,sourceOrigin:e.sourceOrigin},user:{id:(t=e.userObjectId)!==null&&t!==void 0?t:"",displayName:e.userDisplayName,isCallingAllowed:e.isCallingAllowed,isPSTNCallingAllowed:e.isPSTNCallingAllowed,licenseType:e.userLicenseType,loginHint:e.loginHint,userPrincipalName:e.userPrincipalName,tenant:e.tid?{id:e.tid,teamsSku:e.tenantSKU}:void 0},channel:e.channelId?{id:e.channelId,displayName:e.channelName,relativeUrl:e.channelRelativeUrl,membershipType:e.channelType,defaultOneNoteSectionId:e.defaultOneNoteSectionId,ownerGroupId:e.hostTeamGroupId,ownerTenantId:e.hostTeamTenantId}:void 0,chat:e.chatId?{id:e.chatId}:void 0,meeting:e.meetingId?{id:e.meetingId}:void 0,sharepoint:e.sharepoint,team:e.teamId?{internalId:e.teamId,displayName:e.teamName,type:e.teamType,groupId:e.groupId,templateId:e.teamTemplateId,isArchived:e.isTeamArchived,userRole:e.userTeamRole}:void 0,sharePointSite:e.teamSiteUrl||e.teamSiteDomain||e.teamSitePath||e.mySitePath||e.mySiteDomain?{teamSiteUrl:e.teamSiteUrl,teamSiteDomain:e.teamSiteDomain,teamSitePath:e.teamSitePath,teamSiteId:e.teamSiteId,mySitePath:e.mySitePath,mySiteDomain:e.mySiteDomain}:void 0,dialogParameters:e.dialogParameters||{}}}(n))}function MM(){SO(),ZM(Ce(Ih,"app.notifyAppLoaded"))}function DM(){return eD(Ce(Ih,"app.notifySuccess"))}(function(n){n.AuthFailed="AuthFailed",n.Timeout="Timeout",n.Other="Other"})(zw||(zw={})),function(n){n.PermissionError="PermissionError",n.NotFound="NotFound",n.Throttling="Throttling",n.Offline="Offline",n.Other="Other"}($w||($w={})),_p("teamsjs instance is version %s, starting at %s UTC (%s local)",mc,new Date().toISOString(),new Date().toLocaleString()),function(){if(Nh())return;const n=document.getElementsByTagName("script"),e=n&&n[n.length-1]&&n[n.length-1].src,t="Today, teamsjs can only be used from a single script or you may see undefined behavior. This log line is used to help detect cases where teamsjs is loaded multiple times -- it is always written. The presence of the log itself does not indicate a multi-load situation, but multiples of these log lines will. If you would like to use teamjs from more than one script at the same time, please open an issue at https://github.com/OfficeDev/microsoft-teams-library-js/issues";e&&e.length!==0?_p("teamsjs is being used from %s. %s",e,t):_p("teamsjs is being used from a script tag embedded directly in your html. %s",t)}();const FM="v2",zM=[];function $M(n){le.frameContext&&(le.frameContext===Bn.task?zM.push(n):lD("messageForChild"))}function jM(){Ws(Ce(FM,"dialog.registerMessageForChildHandler"),"messageForChild",$M,!1)}const ra="v2";var jw,qw;(function(n){n[n.ifRoom=0]="ifRoom",n[n.overflowOnly=1]="overflowOnly"})(jw||(jw={}));function qM(){Ws(Ce(ra,"menus.registerNavBarMenuItemPressHandler"),"navBarMenuItemPress",UM,!1),Ws(Ce(ra,"menus.registerActionMenuItemPressHandler"),"actionMenuItemPress",HM,!1),Ws(Ce(ra,"menus.registerSetModuleViewHandler"),"setModuleView",BM,!1)}function BM(n){vi(fn),Rn(Ce(ra,"menus.handleViewConfigItemPress"),"viewConfigItemPress",[n])}function UM(n){vi(fn),Rn(Ce(ra,"menus.handleNavBarMenuItemPress"),"handleNavBarMenuItemPress",[n])}function HM(n){vi(fn),Rn(Ce(ra,"menus.handleActionMenuItemPress"),"handleActionMenuItemPress",[n])}(function(n){n.dropDown="dropDown",n.popOver="popOver"})(qw||(qw={}));class VM{}class WM extends VM{validate(e){return!0}deserialize(e){return e}}function GM(){Ws(Ce(no,"pages.config.registerSettingsSaveHandler"),"settings.save",KM,!1),Ws(Ce(no,"pages.config.registerSettingsRemoveHandler"),"settings.remove",QM,!1)}function KM(n){const e=new JM(n);di()?hi("settings.save",[n]):e.notifySuccess()}let JM=class{constructor(e){this.notified=!1,this.result=e||{}}notifySuccess(){this.ensureNotNotified(),Rn(Ce(no,"pages.saveEvent.notifySuccess"),"settings.save.success"),this.notified=!0}notifyFailure(e){this.ensureNotNotified(),Rn(Ce(no,"pages.saveEvent.notifyFailure"),"settings.save.failure",[e]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The SaveEvent may only notify success or failure once.")}};function QM(){const n=new XM;di()?hi("settings.remove",[]):n.notifySuccess()}class XM{constructor(){this.notified=!1}notifySuccess(){this.ensureNotNotified(),Rn(Ce(no,"pages.removeEvent.notifySuccess"),"settings.remove.success"),this.notified=!0}notifyFailure(e){this.ensureNotNotified(),Rn(Ce(no,"pages.removeEvent.notifyFailure"),"settings.remove.failure",[e]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The removeEventType may only notify success or failure once.")}}const CO=jr("app");function YM(n,e){return Nh()?(CO.extend("initialize")("window object undefined at initialization"),Promise.resolve()):AA(()=>function(t,r){return new Promise(i=>{le.initializeCalled||(le.initializeCalled=!0,aD(),le.initializePromise=pM(r,t).then(({context:s,clientType:o,runtimeConfig:a,clientSupportedSDKVersion:l=kw})=>{le.frameContext=s,le.hostClientType=o,le.clientSupportedSDKVersion=l;try{cl("Parsing %s",a);let c=JSON.parse(a);if(cl("Checking if %o is a valid runtime object",c??"null"),!c||!c.apiVersion)throw new Error("Received runtime config is invalid");c=Ow(c),a&&wp(c)}catch(c){if(!(c instanceof SyntaxError))throw c;try{cl("Attempting to parse %s as an SDK version",a),isNaN(sO(a,kw))||(le.clientSupportedSDKVersion=a);let u=JSON.parse(l);if(cl("givenRuntimeConfig parsed to %o",u??"null"),!u)throw new Error("givenRuntimeConfig string was successfully parsed. However, it parsed to value of null");u=Ow(u),wp(u)}catch(u){if(!(u instanceof SyntaxError))throw u;wp(oM(le.clientSupportedSDKVersion,tM,sM))}}le.initializeCompleted=!0}),qM(),GM(),jM()),Array.isArray(r)&&PM(r),le.initializePromise!==void 0?i(le.initializePromise):cl("GlobalVars.initializePromise is unexpectedly undefined")})}(n,e),6e4,new Error("SDK initialization timed out."))}function ZM(n){Rn(n,Vg.AppLoaded,[mc])}function eD(n){return gi(this,void 0,void 0,function*(){if(le.initializeCompleted)return Bw(n);if(!le.initializePromise)throw new Error(pc);return le.initializePromise.then(()=>Bw(n))})}function Bw(n){return gi(this,void 0,void 0,function*(){return vi(fn)&&(!((e=fn.supports.app)===null||e===void 0)&&e.notifySuccessResponse)?yM(Vg.Success,[mc],new WM,n).then(()=>({hasFinishedSuccessfully:!0})):(Rn(n,Vg.Success,[mc]),{hasFinishedSuccessfully:"unknown"});var e})}const cl=CO.extend("initializeHelper");function tD(){return rD(Ce(no,"pages.backStack.navigateBack"))}function nD(){return!(!vi(fn)||!fn.supports.pages)&&!!fn.supports.pages.backStack}const no="v2";function rD(n){return new Promise(e=>{if(vi(fn),!nD())throw xA;e(gM(n,"navigateBack","Back navigation is not supported in the current client or context."))})}function iD(){Ws(Ce("v2","pages.backStack.registerBackButtonPressHandler"),"backButtonPress",sD,!1)}function sD(){di()?hi("backButtonPress",[]):tD()}const oD=jr("handlers");let He=class mr{static initializeHandlers(){mr.handlers.themeChange=cD,mr.handlers.load=uD,mr.handlers.beforeUnload=dD,iD()}static uninitializeHandlers(){mr.handlers={},mr.themeChangeHandler=null,mr.loadHandler=null,mr.beforeUnloadHandler=null,mr.beforeSuspendOrTerminateHandler=null,mr.resumeHandler=null}};function aD(){He.initializeHandlers()}He.handlers={},He.themeChangeHandler=null,He.loadHandler=null,He.beforeUnloadHandler=null,He.beforeSuspendOrTerminateHandler=null,He.resumeHandler=null,He.hostToAppPerformanceMetricsHandler=null;const Uw=oD.extend("callHandler");function EO(n,e){const t=He.handlers[n];return t?(Uw("Invoking the registered handler for message %s with arguments %o",n,e),[!0,t.apply(this,e)]):di()?(hi(n,e),[!1,void 0]):(Uw("Handler for action message %s not found.",n),[!1,void 0])}function Ws(n,e,t,r=!0,i=[]){t?(He.handlers[e]=t,r&&Rn(n,"registerHandler",[e,...i])):delete He.handlers[e]}function lD(n){delete He.handlers[n]}function cD(n){He.themeChangeHandler&&He.themeChangeHandler(n),di()&&hi("themeChange",[n])}function Hw(n){He.hostToAppPerformanceMetricsHandler&&He.hostToAppPerformanceMetricsHandler(n)}function uD(n){const e={entityId:(t=n).entityId,contentUrl:new URL(t.contentUrl)};var t;He.resumeHandler?(He.resumeHandler(e),di()&&hi("load",[e])):He.loadHandler&&(He.loadHandler(n),di()&&hi("load",[n]))}function dD(){return gi(this,void 0,void 0,function*(){const n=()=>{Rn(Ce("v2","handleBeforeUnload"),"readyToUnload",[])};He.beforeSuspendOrTerminateHandler?(yield He.beforeSuspendOrTerminateHandler(),di()?hi("beforeUnload"):n()):He.beforeUnloadHandler&&He.beforeUnloadHandler(n)||(di()?hi("beforeUnload"):n())})}const hD=jr("childProxyingCommunication");let Be=class{};function di(){return!!rO()&&!!Be.window}function fD(n,e){return!!rO()&&(Be.window&&!Be.window.closed&&n!==Be.window||(Be.window=n,Be.origin=e),Be.window&&Be.window.closed?(Be.window=null,Be.origin=null,!1):Be.window===n)}function pD(n,e,t,r){return gi(this,void 0,void 0,function*(){Be.window===e&&(n0(Be.window,Be.origin,Be.messageQueue,"child"),function(i,s,o){if(i.data.id===void 0||i.data.func===void 0)return;const a=jA(i.data),[l,c]=EO(a.func,a.args);if(l&&c!==void 0)return Ol("Handler called in response to message %s from child. Returning response from handler to child, action: %s.",Hn(a),a.func),void Vw(a.id,a.uuid,Array.isArray(c)?c:[c]);Ol("No handler for message %s from child found; relaying message on to parent, action: %s. Relayed message will have a new id.",Hn(a),a.func),function(u,d,h){const f=d(Ce("v2","tasks.startTask"),u.func,u.args,!0,u.teamsJsInstanceId),p=Be.origin;h(f.uuid,(...g)=>{if(!Be.window)return;if(!_A().disableEnforceOriginMatchForChildResponses&&p!==Be.origin)return void Ol("Origin of child window has changed, not sending response back to child window");const S=g.pop();Ol("Message from parent being relayed to child, id: %s",Hn(u)),Vw(u.id,u.uuid,g,S)})}(a,s,o)}(n,t,r))})}Be.messageQueue=[];const Ol=hD.extend("handleIncomingMessageFromChild");function Vw(n,e,t,r){const i=Be.window,s=function(l,c,u,d){return{id:l,uuid:c,args:u||[],isPartialResponse:d}}(n,e,t,r),o=BA(s),a=Be.origin;i&&a&&(Ol("Sending message %s to %s via postMessage, args = %o",Hn(o),"child",o.args),i.postMessage(o,a))}function hi(n,e){const t=Be.window,r=function(s,o){return{func:s,args:o||[]}}(n,e),i=Be.origin;t&&i?t.postMessage(r,i):Be.messageQueue.push(r)}const Ei="v2";var Ww,Gw;function mD(){return!(!vi(fn,Bn.meetingStage,Bn.sidePanel,Bn.content)||!fn.supports.interactive)}(function(n){n.guest="Guest",n.attendee="Attendee",n.presenter="Presenter",n.organizer="Organizer"})(Ww||(Ww={})),function(n){n.added="Added",n.alreadyExists="AlreadyExists",n.conflict="Conflict",n.notFound="NotFound"}(Gw||(Gw={}));class s0{getFluidTenantInfo(){return Ur(),new Promise(e=>{e(Ci(Ce(Ei,"interactive.getFluidTenantInfo"),"interactive.getFluidTenantInfo"))})}getFluidToken(e){return Ur(),new Promise(t=>{t(Ci(Ce(Ei,"interactive.getFluidToken"),"interactive.getFluidToken",e))})}getFluidContainerId(){return Ur(),new Promise(e=>{e(Ci(Ce(Ei,"interactive.getFluidContainerId"),"interactive.getFluidContainerId"))})}setFluidContainerId(e){return Ur(),new Promise(t=>{t(Ci(Ce(Ei,"interactive.setFluidContainerId"),"interactive.setFluidContainerId",e))})}getNtpTime(){return Ur(),new Promise(e=>{e(Ci(Ce(Ei,"interactive.getNtpTime"),"interactive.getNtpTime"))})}registerClientId(e){return Ur(),new Promise(t=>{t(Ci(Ce(Ei,"interactive.registerClientId"),"interactive.registerClientId",e))})}getClientRoles(e){return Ur(),new Promise(t=>{t(Ci(Ce(Ei,"interactive.getClientRoles"),"interactive.getClientRoles",e))})}getClientInfo(e){return Ur(),new Promise(t=>{t(Ci(Ce(Ei,"interactive.getClientInfo"),"interactive.getClientInfo",e))})}static create(){return Ur(),new s0}}function Ur(){if(!mD())throw new Error("LiveShareHost Not supported")}const _O="v1";var Kw,Jw,Qw,Xw,Wg,Yw;function Zw(n){if(!n)throw new Error("[get meeting details] Callback cannot be null");vi(fn,Bn.sidePanel,Bn.meetingStage,Bn.settings,Bn.content),Rn(Ce(_O,"meeting.getMeetingDetails"),"meeting.getMeetingDetails",n)}function TO(n,e,t={sharingProtocol:Wg.Collaborative}){if(!n)throw new Error("[share app content to stage] Callback cannot be null");vi(fn,Bn.sidePanel,Bn.meetingStage),Rn(Ce(_O,"meeting.shareAppContentToStage"),"meeting.shareAppContentToStage",[e,t],n)}(function(n){n[n.HostInitiated=0]="HostInitiated",n[n.AppInitiated=1]="AppInitiated",n[n.AppDeclinedToChange=2]="AppDeclinedToChange",n[n.AppFailedToChange=3]="AppFailedToChange"})(Kw||(Kw={})),function(n){n.like="like",n.heart="heart",n.laugh="laugh",n.surprised="surprised",n.applause="applause"}(Jw||(Jw={})),function(n){n.Unknown="Unknown",n.Adhoc="Adhoc",n.Scheduled="Scheduled",n.Recurring="Recurring",n.Broadcast="Broadcast",n.MeetNow="MeetNow"}(Qw||(Qw={})),function(n){n.OneOnOneCall="oneOnOneCall",n.GroupCall="groupCall"}(Xw||(Xw={})),function(n){n.Collaborative="Collaborative",n.ScreenShare="ScreenShare"}(Wg||(Wg={})),function(n){n.M365CalendarGridContextMenu="m365_calendar_grid_context_menu",n.M365CalendarGridPeek="m365_calendar_grid_peek",n.M365CalendarGridEventCardJoinButton="m365_calendar_grid_event_card_join_button",n.M365CalendarFormRibbonJoinButton="m365_calendar_form_ribbon_join_button",n.M365CalendarFormJoinTeamsMeetingButton="m365_calendar_form_join_teams_meeting_button",n.Other="other"}(Yw||(Yw={}));function gD(){return!!new URLSearchParams(window.location.search).get("inTeams")}var Ud={},yi={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const xO=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string"&&typeof(n==null?void 0:n.fluid)=="object",eC=n=>{const e=n;return typeof e=="object"&&(typeof(e==null?void 0:e.package)=="string"||xO(e==null?void 0:e.package))&&((e==null?void 0:e.config)===void 0||typeof(e==null?void 0:e.config)=="object")};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var as;(function(n){n.genericError="genericError",n.throttlingError="throttlingError",n.dataCorruptionError="dataCorruptionError",n.dataProcessingError="dataProcessingError",n.usageError="usageError",n.clientSessionExpiredError="clientSessionExpiredError"})(as||(as={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ge;(function(n){n.cache="fluid-cache",n.clientDetails="fluid-client-details",n.loadMode="loadMode",n.reconnect="fluid-reconnect",n.sequenceNumber="fluid-sequence-number",n.version="version"})(Ge||(Ge={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var te;(function(n){n.Detached="Detached",n.Attaching="Attaching",n.Attached="Attached"})(te||(te={}));var wn;(function(n){n.NotBound="NotBound",n.Binding="Binding",n.Bound="Bound"})(wn||(wn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Te;(function(n){n[n.Disconnected=0]="Disconnected",n[n.EstablishingConnection=3]="EstablishingConnection",n[n.Connecting=1]="Connecting",n[n.CatchingUp=1]="CatchingUp",n[n.Connected=2]="Connected"})(Te||(Te={}));function vD(){this.__data__=[],this.size=0}var yD=vD;function SD(n,e){return n===e||n!==n&&e!==e}var Mh=SD,bD=Mh;function wD(n,e){for(var t=n.length;t--;)if(bD(n[t][0],e))return t;return-1}var Dh=wD,CD=Dh,ED=Array.prototype,_D=ED.splice;function TD(n){var e=this.__data__,t=CD(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():_D.call(e,t,1),--this.size,!0}var xD=TD,OD=Dh;function PD(n){var e=this.__data__,t=OD(e,n);return t<0?void 0:e[t][1]}var RD=PD,kD=Dh;function ND(n){return kD(this.__data__,n)>-1}var LD=ND,ID=Dh;function AD(n,e){var t=this.__data__,r=ID(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}var MD=AD,DD=yD,FD=xD,zD=RD,$D=LD,jD=MD;function Da(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Da.prototype.clear=DD;Da.prototype.delete=FD;Da.prototype.get=zD;Da.prototype.has=$D;Da.prototype.set=jD;var Fh=Da,qD=Fh;function BD(){this.__data__=new qD,this.size=0}var UD=BD;function HD(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}var VD=HD;function WD(n){return this.__data__.get(n)}var GD=WD;function KD(n){return this.__data__.has(n)}var JD=KD,QD=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,OO=QD,XD=OO,YD=typeof self=="object"&&self&&self.Object===Object&&self,ZD=XD||YD||Function("return this")(),qr=ZD,eF=qr,tF=eF.Symbol,o0=tF,tC=o0,PO=Object.prototype,nF=PO.hasOwnProperty,rF=PO.toString,ul=tC?tC.toStringTag:void 0;function iF(n){var e=nF.call(n,ul),t=n[ul];try{n[ul]=void 0;var r=!0}catch{}var i=rF.call(n);return r&&(e?n[ul]=t:delete n[ul]),i}var sF=iF,oF=Object.prototype,aF=oF.toString;function lF(n){return aF.call(n)}var cF=lF,nC=o0,uF=sF,dF=cF,hF="[object Null]",fF="[object Undefined]",rC=nC?nC.toStringTag:void 0;function pF(n){return n==null?n===void 0?fF:hF:rC&&rC in Object(n)?uF(n):dF(n)}var jc=pF;function mF(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var fs=mF,gF=jc,vF=fs,yF="[object AsyncFunction]",SF="[object Function]",bF="[object GeneratorFunction]",wF="[object Proxy]";function CF(n){if(!vF(n))return!1;var e=gF(n);return e==SF||e==bF||e==yF||e==wF}var a0=CF,EF=qr,_F=EF["__core-js_shared__"],TF=_F,Tp=TF,iC=function(){var n=/[^.]+$/.exec(Tp&&Tp.keys&&Tp.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function xF(n){return!!iC&&iC in n}var OF=xF,PF=Function.prototype,RF=PF.toString;function kF(n){if(n!=null){try{return RF.call(n)}catch{}try{return n+""}catch{}}return""}var RO=kF,NF=a0,LF=OF,IF=fs,AF=RO,MF=/[\\^$.*+?()[\]{}|]/g,DF=/^\[object .+?Constructor\]$/,FF=Function.prototype,zF=Object.prototype,$F=FF.toString,jF=zF.hasOwnProperty,qF=RegExp("^"+$F.call(jF).replace(MF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function BF(n){if(!IF(n)||LF(n))return!1;var e=NF(n)?qF:DF;return e.test(AF(n))}var UF=BF;function HF(n,e){return n==null?void 0:n[e]}var VF=HF,WF=UF,GF=VF;function KF(n,e){var t=GF(n,e);return WF(t)?t:void 0}var po=KF,JF=po,QF=qr,XF=JF(QF,"Map"),l0=XF,YF=po,ZF=YF(Object,"create"),zh=ZF,sC=zh;function ez(){this.__data__=sC?sC(null):{},this.size=0}var tz=ez;function nz(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var rz=nz,iz=zh,sz="__lodash_hash_undefined__",oz=Object.prototype,az=oz.hasOwnProperty;function lz(n){var e=this.__data__;if(iz){var t=e[n];return t===sz?void 0:t}return az.call(e,n)?e[n]:void 0}var cz=lz,uz=zh,dz=Object.prototype,hz=dz.hasOwnProperty;function fz(n){var e=this.__data__;return uz?e[n]!==void 0:hz.call(e,n)}var pz=fz,mz=zh,gz="__lodash_hash_undefined__";function vz(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=mz&&e===void 0?gz:e,this}var yz=vz,Sz=tz,bz=rz,wz=cz,Cz=pz,Ez=yz;function Fa(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Fa.prototype.clear=Sz;Fa.prototype.delete=bz;Fa.prototype.get=wz;Fa.prototype.has=Cz;Fa.prototype.set=Ez;var _z=Fa,oC=_z,Tz=Fh,xz=l0;function Oz(){this.size=0,this.__data__={hash:new oC,map:new(xz||Tz),string:new oC}}var Pz=Oz;function Rz(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var kz=Rz,Nz=kz;function Lz(n,e){var t=n.__data__;return Nz(e)?t[typeof e=="string"?"string":"hash"]:t.map}var $h=Lz,Iz=$h;function Az(n){var e=Iz(this,n).delete(n);return this.size-=e?1:0,e}var Mz=Az,Dz=$h;function Fz(n){return Dz(this,n).get(n)}var zz=Fz,$z=$h;function jz(n){return $z(this,n).has(n)}var qz=jz,Bz=$h;function Uz(n,e){var t=Bz(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}var Hz=Uz,Vz=Pz,Wz=Mz,Gz=zz,Kz=qz,Jz=Hz;function za(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}za.prototype.clear=Vz;za.prototype.delete=Wz;za.prototype.get=Gz;za.prototype.has=Kz;za.prototype.set=Jz;var Qz=za,Xz=Fh,Yz=l0,Zz=Qz,e$=200;function t$(n,e){var t=this.__data__;if(t instanceof Xz){var r=t.__data__;if(!Yz||r.length<e$-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new Zz(r)}return t.set(n,e),this.size=t.size,this}var n$=t$,r$=Fh,i$=UD,s$=VD,o$=GD,a$=JD,l$=n$;function $a(n){var e=this.__data__=new r$(n);this.size=e.size}$a.prototype.clear=i$;$a.prototype.delete=s$;$a.prototype.get=o$;$a.prototype.has=a$;$a.prototype.set=l$;var kO=$a,c$=po,u$=function(){try{var n=c$(Object,"defineProperty");return n({},"",{}),n}catch{}}(),NO=u$,aC=NO;function d$(n,e,t){e=="__proto__"&&aC?aC(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var c0=d$,h$=c0,f$=Mh;function p$(n,e,t){(t!==void 0&&!f$(n[e],t)||t===void 0&&!(e in n))&&h$(n,e,t)}var LO=p$;function m$(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var l=o[n?a:++i];if(t(s[l],l,s)===!1)break}return e}}var g$=m$,v$=g$,y$=v$(),S$=y$,Hd={exports:{}};Hd.exports;(function(n,e){var t=qr,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s?t.Buffer:void 0,a=o?o.allocUnsafe:void 0;function l(c,u){if(u)return c.slice();var d=c.length,h=a?a(d):new c.constructor(d);return c.copy(h),h}n.exports=l})(Hd,Hd.exports);var IO=Hd.exports,b$=qr,w$=b$.Uint8Array,C$=w$,lC=C$;function E$(n){var e=new n.constructor(n.byteLength);return new lC(e).set(new lC(n)),e}var u0=E$,_$=u0;function T$(n,e){var t=e?_$(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var AO=T$;function x$(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var MO=x$,O$=fs,cC=Object.create,P$=function(){function n(){}return function(e){if(!O$(e))return{};if(cC)return cC(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}(),R$=P$;function k$(n,e){return function(t){return n(e(t))}}var DO=k$,N$=DO,L$=N$(Object.getPrototypeOf,Object),d0=L$,I$=Object.prototype;function A$(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||I$;return n===t}var h0=A$,M$=R$,D$=d0,F$=h0;function z$(n){return typeof n.constructor=="function"&&!F$(n)?M$(D$(n)):{}}var FO=z$;function $$(n){return n!=null&&typeof n=="object"}var mo=$$,j$=jc,q$=mo,B$="[object Arguments]";function U$(n){return q$(n)&&j$(n)==B$}var H$=U$,uC=H$,V$=mo,zO=Object.prototype,W$=zO.hasOwnProperty,G$=zO.propertyIsEnumerable,K$=uC(function(){return arguments}())?uC:function(n){return V$(n)&&W$.call(n,"callee")&&!G$.call(n,"callee")},$O=K$,J$=Array.isArray,jh=J$,Q$=9007199254740991;function X$(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=Q$}var jO=X$,Y$=a0,Z$=jO;function ej(n){return n!=null&&Z$(n.length)&&!Y$(n)}var qh=ej,tj=qh,nj=mo;function rj(n){return nj(n)&&tj(n)}var ij=rj,Vd={exports:{}};function sj(){return!1}var oj=sj;Vd.exports;(function(n,e){var t=qr,r=oj,i=e&&!e.nodeType&&e,s=i&&!0&&n&&!n.nodeType&&n,o=s&&s.exports===i,a=o?t.Buffer:void 0,l=a?a.isBuffer:void 0,c=l||r;n.exports=c})(Vd,Vd.exports);var f0=Vd.exports,aj=jc,lj=d0,cj=mo,uj="[object Object]",dj=Function.prototype,hj=Object.prototype,qO=dj.toString,fj=hj.hasOwnProperty,pj=qO.call(Object);function mj(n){if(!cj(n)||aj(n)!=uj)return!1;var e=lj(n);if(e===null)return!0;var t=fj.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&qO.call(t)==pj}var gj=mj,vj=jc,yj=jO,Sj=mo,bj="[object Arguments]",wj="[object Array]",Cj="[object Boolean]",Ej="[object Date]",_j="[object Error]",Tj="[object Function]",xj="[object Map]",Oj="[object Number]",Pj="[object Object]",Rj="[object RegExp]",kj="[object Set]",Nj="[object String]",Lj="[object WeakMap]",Ij="[object ArrayBuffer]",Aj="[object DataView]",Mj="[object Float32Array]",Dj="[object Float64Array]",Fj="[object Int8Array]",zj="[object Int16Array]",$j="[object Int32Array]",jj="[object Uint8Array]",qj="[object Uint8ClampedArray]",Bj="[object Uint16Array]",Uj="[object Uint32Array]",Fe={};Fe[Mj]=Fe[Dj]=Fe[Fj]=Fe[zj]=Fe[$j]=Fe[jj]=Fe[qj]=Fe[Bj]=Fe[Uj]=!0;Fe[bj]=Fe[wj]=Fe[Ij]=Fe[Cj]=Fe[Aj]=Fe[Ej]=Fe[_j]=Fe[Tj]=Fe[xj]=Fe[Oj]=Fe[Pj]=Fe[Rj]=Fe[kj]=Fe[Nj]=Fe[Lj]=!1;function Hj(n){return Sj(n)&&yj(n.length)&&!!Fe[vj(n)]}var Vj=Hj;function Wj(n){return function(e){return n(e)}}var p0=Wj,Wd={exports:{}};Wd.exports;(function(n,e){var t=OO,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s&&t.process,a=function(){try{var l=i&&i.require&&i.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();n.exports=a})(Wd,Wd.exports);var m0=Wd.exports,Gj=Vj,Kj=p0,dC=m0,hC=dC&&dC.isTypedArray,Jj=hC?Kj(hC):Gj,BO=Jj;function Qj(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}var UO=Qj,Xj=c0,Yj=Mh,Zj=Object.prototype,eq=Zj.hasOwnProperty;function tq(n,e,t){var r=n[e];(!(eq.call(n,e)&&Yj(r,t))||t===void 0&&!(e in n))&&Xj(n,e,t)}var HO=tq,nq=HO,rq=c0;function iq(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=r?r(t[a],n[a],a,t,n):void 0;l===void 0&&(l=n[a]),i?rq(t,a,l):nq(t,a,l)}return t}var qc=iq;function sq(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var oq=sq,aq=9007199254740991,lq=/^(?:0|[1-9]\d*)$/;function cq(n,e){var t=typeof n;return e=e??aq,!!e&&(t=="number"||t!="symbol"&&lq.test(n))&&n>-1&&n%1==0&&n<e}var VO=cq,uq=oq,dq=$O,hq=jh,fq=f0,pq=VO,mq=BO,gq=Object.prototype,vq=gq.hasOwnProperty;function yq(n,e){var t=hq(n),r=!t&&dq(n),i=!t&&!r&&fq(n),s=!t&&!r&&!i&&mq(n),o=t||r||i||s,a=o?uq(n.length,String):[],l=a.length;for(var c in n)(e||vq.call(n,c))&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||pq(c,l)))&&a.push(c);return a}var WO=yq;function Sq(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var bq=Sq,wq=fs,Cq=h0,Eq=bq,_q=Object.prototype,Tq=_q.hasOwnProperty;function xq(n){if(!wq(n))return Eq(n);var e=Cq(n),t=[];for(var r in n)r=="constructor"&&(e||!Tq.call(n,r))||t.push(r);return t}var Oq=xq,Pq=WO,Rq=Oq,kq=qh;function Nq(n){return kq(n)?Pq(n,!0):Rq(n)}var Bc=Nq,Lq=qc,Iq=Bc;function Aq(n){return Lq(n,Iq(n))}var Mq=Aq,fC=LO,Dq=IO,Fq=AO,zq=MO,$q=FO,pC=$O,mC=jh,jq=ij,qq=f0,Bq=a0,Uq=fs,Hq=gj,Vq=BO,gC=UO,Wq=Mq;function Gq(n,e,t,r,i,s,o){var a=gC(n,t),l=gC(e,t),c=o.get(l);if(c){fC(n,t,c);return}var u=s?s(a,l,t+"",n,e,o):void 0,d=u===void 0;if(d){var h=mC(l),f=!h&&qq(l),p=!h&&!f&&Vq(l);u=l,h||f||p?mC(a)?u=a:jq(a)?u=zq(a):f?(d=!1,u=Dq(l,!0)):p?(d=!1,u=Fq(l,!0)):u=[]:Hq(l)||pC(l)?(u=a,pC(a)?u=Wq(a):(!Uq(a)||Bq(a))&&(u=$q(l))):d=!1}d&&(o.set(l,u),i(u,l,r,s,o),o.delete(l)),fC(n,t,u)}var Kq=Gq,Jq=kO,Qq=LO,Xq=S$,Yq=Kq,Zq=fs,eB=Bc,tB=UO;function GO(n,e,t,r,i){n!==e&&Xq(e,function(s,o){if(i||(i=new Jq),Zq(s))Yq(n,e,o,t,GO,r,i);else{var a=r?r(tB(n,o),s,o+"",n,e,i):void 0;a===void 0&&(a=s),Qq(n,o,a)}},eB)}var nB=GO;function rB(n){return n}var KO=rB;function iB(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}var sB=iB,oB=sB,vC=Math.max;function aB(n,e,t){return e=vC(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=vC(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(o),oB(n,this,a)}}var lB=aB;function cB(n){return function(){return n}}var uB=cB,dB=uB,yC=NO,hB=KO,fB=yC?function(n,e){return yC(n,"toString",{configurable:!0,enumerable:!1,value:dB(e),writable:!0})}:hB,pB=fB,mB=800,gB=16,vB=Date.now;function yB(n){var e=0,t=0;return function(){var r=vB(),i=gB-(r-t);if(t=r,i>0){if(++e>=mB)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}var SB=yB,bB=pB,wB=SB,CB=wB(bB),EB=CB,_B=KO,TB=lB,xB=EB;function OB(n,e){return xB(TB(n,e,_B),n+"")}var PB=OB,RB=Mh,kB=qh,NB=VO,LB=fs;function IB(n,e,t){if(!LB(t))return!1;var r=typeof e;return(r=="number"?kB(t)&&NB(e,t.length):r=="string"&&e in t)?RB(t[e],n):!1}var AB=IB,MB=PB,DB=AB;function FB(n){return MB(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&DB(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,s)}return e})}var zB=FB,$B=nB,jB=zB,qB=jB(function(n,e,t){$B(n,e,t)}),BB=qB;const UB=pi(BB);var Nu,HB=new Uint8Array(16);function VB(){if(!Nu&&(Nu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Nu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nu(HB)}const WB=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function GB(n){return typeof n=="string"&&WB.test(n)}var _t=[];for(var xp=0;xp<256;++xp)_t.push((xp+256).toString(16).substr(1));function KB(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(_t[n[e+0]]+_t[n[e+1]]+_t[n[e+2]]+_t[n[e+3]]+"-"+_t[n[e+4]]+_t[n[e+5]]+"-"+_t[n[e+6]]+_t[n[e+7]]+"-"+_t[n[e+8]]+_t[n[e+9]]+"-"+_t[n[e+10]]+_t[n[e+11]]+_t[n[e+12]]+_t[n[e+13]]+_t[n[e+14]]+_t[n[e+15]]).toLowerCase();if(!GB(t))throw TypeError("Stringified UUID is invalid");return t}function ot(n,e,t){n=n||{};var r=n.random||(n.rng||VB)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return KB(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function q(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}var g0={};g0.byteLength=XB;var Si=g0.toByteArray=ZB,ur=g0.fromByteArray=n2,Cr=[],An=[],JB=typeof Uint8Array<"u"?Uint8Array:Array,Op="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var xo=0,QB=Op.length;xo<QB;++xo)Cr[xo]=Op[xo],An[Op.charCodeAt(xo)]=xo;An["-".charCodeAt(0)]=62;An["_".charCodeAt(0)]=63;function JO(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function XB(n){var e=JO(n),t=e[0],r=e[1];return(t+r)*3/4-r}function YB(n,e,t){return(e+t)*3/4-t}function ZB(n){var e,t=JO(n),r=t[0],i=t[1],s=new JB(YB(n,r,i)),o=0,a=i>0?r-4:r,l;for(l=0;l<a;l+=4)e=An[n.charCodeAt(l)]<<18|An[n.charCodeAt(l+1)]<<12|An[n.charCodeAt(l+2)]<<6|An[n.charCodeAt(l+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=An[n.charCodeAt(l)]<<2|An[n.charCodeAt(l+1)]>>4,s[o++]=e&255),i===1&&(e=An[n.charCodeAt(l)]<<10|An[n.charCodeAt(l+1)]<<4|An[n.charCodeAt(l+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function e2(n){return Cr[n>>18&63]+Cr[n>>12&63]+Cr[n>>6&63]+Cr[n&63]}function t2(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(e2(r));return i.join("")}function n2(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(t2(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(Cr[e>>2]+Cr[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Cr[e>>10]+Cr[e>>4&63]+Cr[e<<2&63]+"=")),i.join("")}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function r2(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const i2=(n,e)=>s2.from(n,e).buffer;function SC(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let s2=class Cs extends Uint8Array{toString(e){return r2(this,e)}static from(e,t,r){if(typeof e=="string")return Cs.fromString(e,t);if(e!==null&&typeof e=="object"&&SC(e.buffer))return q(e.byteOffset===0,0),q(e.byteLength===e.buffer.byteLength,1),Cs.fromArrayBuffer(e.buffer,t,r);if(SC(e))return Cs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Cs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Cs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Cs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};const o2="modulepreload",a2=function(n){return"/personal-whiteboard-app/"+n},bC={},QO=function(e,t,r){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=a2(s),s in bC)return;bC[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":o2,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const zt=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dl(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}var v0={exports:{}},ia=typeof Reflect=="object"?Reflect:null,wC=ia&&typeof ia.apply=="function"?ia.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},rd;ia&&typeof ia.ownKeys=="function"?rd=ia.ownKeys:Object.getOwnPropertySymbols?rd=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:rd=function(e){return Object.getOwnPropertyNames(e)};function l2(n){console&&console.warn&&console.warn(n)}var XO=Number.isNaN||function(e){return e!==e};function ke(){ke.init.call(this)}v0.exports=ke;v0.exports.once=h2;ke.EventEmitter=ke;ke.prototype._events=void 0;ke.prototype._eventsCount=0;ke.prototype._maxListeners=void 0;var CC=10;function Bh(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(ke,"defaultMaxListeners",{enumerable:!0,get:function(){return CC},set:function(n){if(typeof n!="number"||n<0||XO(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");CC=n}});ke.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ke.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||XO(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function YO(n){return n._maxListeners===void 0?ke.defaultMaxListeners:n._maxListeners}ke.prototype.getMaxListeners=function(){return YO(this)};ke.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")wC(l,this,t);else for(var c=l.length,u=rP(l,c),r=0;r<c;++r)wC(u[r],this,t);return!0};function ZO(n,e,t,r){var i,s,o;if(Bh(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=r?[t,o]:[o,t]:r?o.unshift(t):o.push(t),i=YO(n),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=e,a.count=o.length,l2(a)}return n}ke.prototype.addListener=function(e,t){return ZO(this,e,t,!1)};ke.prototype.on=ke.prototype.addListener;ke.prototype.prependListener=function(e,t){return ZO(this,e,t,!0)};function c2(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function eP(n,e,t){var r={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=c2.bind(r);return i.listener=t,r.wrapFn=i,i}ke.prototype.once=function(e,t){return Bh(t),this.on(e,eP(this,e,t)),this};ke.prototype.prependOnceListener=function(e,t){return Bh(t),this.prependListener(e,eP(this,e,t)),this};ke.prototype.removeListener=function(e,t){var r,i,s,o,a;if(Bh(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():u2(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};ke.prototype.off=ke.prototype.removeListener;ke.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function tP(n,e,t){var r=n._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?d2(i):rP(i,i.length)}ke.prototype.listeners=function(e){return tP(this,e,!0)};ke.prototype.rawListeners=function(e){return tP(this,e,!1)};ke.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):nP.call(n,e)};ke.prototype.listenerCount=nP;function nP(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}ke.prototype.eventNames=function(){return this._eventsCount>0?rd(this._events):[]};function rP(n,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=n[r];return t}function u2(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function d2(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function h2(n,e){return new Promise(function(t,r){function i(o){n.removeListener(e,s),r(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}iP(n,e,s,{once:!0}),e!=="error"&&f2(n,i,{once:!0})})}function f2(n,e,t){typeof n.on=="function"&&iP(n,"error",e,t)}function iP(n,e,t,r){if(typeof n.on=="function")r.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(s){r.once&&n.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var pn=v0.exports;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Uh=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Uc=class Es extends Uh{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(Es.removeListenerEvent,t),this.on(Es.newListenerEvent,r)}}static isEmitterEvent(e){return e===Es.newListenerEvent||e===Es.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!Es.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!Es.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};Uc.newListenerEvent="newListener";Uc.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let p2=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};function m2(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var g2=m2,v2=DO,y2=v2(Object.keys,Object),S2=y2,b2=h0,w2=S2,C2=Object.prototype,E2=C2.hasOwnProperty;function _2(n){if(!b2(n))return w2(n);var e=[];for(var t in Object(n))E2.call(n,t)&&t!="constructor"&&e.push(t);return e}var T2=_2,x2=WO,O2=T2,P2=qh;function R2(n){return P2(n)?x2(n):O2(n)}var y0=R2,k2=qc,N2=y0;function L2(n,e){return n&&k2(e,N2(e),n)}var I2=L2,A2=qc,M2=Bc;function D2(n,e){return n&&A2(e,M2(e),n)}var F2=D2;function z2(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var o=n[t];e(o,t,n)&&(s[i++]=o)}return s}var $2=z2;function j2(){return[]}var sP=j2,q2=$2,B2=sP,U2=Object.prototype,H2=U2.propertyIsEnumerable,EC=Object.getOwnPropertySymbols,V2=EC?function(n){return n==null?[]:(n=Object(n),q2(EC(n),function(e){return H2.call(n,e)}))}:B2,S0=V2,W2=qc,G2=S0;function K2(n,e){return W2(n,G2(n),e)}var J2=K2;function Q2(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var oP=Q2,X2=oP,Y2=d0,Z2=S0,eU=sP,tU=Object.getOwnPropertySymbols,nU=tU?function(n){for(var e=[];n;)X2(e,Z2(n)),n=Y2(n);return e}:eU,aP=nU,rU=qc,iU=aP;function sU(n,e){return rU(n,iU(n),e)}var oU=sU,aU=oP,lU=jh;function cU(n,e,t){var r=e(n);return lU(n)?r:aU(r,t(n))}var lP=cU,uU=lP,dU=S0,hU=y0;function fU(n){return uU(n,hU,dU)}var pU=fU,mU=lP,gU=aP,vU=Bc;function yU(n){return mU(n,vU,gU)}var SU=yU,bU=po,wU=qr,CU=bU(wU,"DataView"),EU=CU,_U=po,TU=qr,xU=_U(TU,"Promise"),OU=xU,PU=po,RU=qr,kU=PU(RU,"Set"),NU=kU,LU=po,IU=qr,AU=LU(IU,"WeakMap"),MU=AU,Gg=EU,Kg=l0,Jg=OU,Qg=NU,Xg=MU,cP=jc,ja=RO,_C="[object Map]",DU="[object Object]",TC="[object Promise]",xC="[object Set]",OC="[object WeakMap]",PC="[object DataView]",FU=ja(Gg),zU=ja(Kg),$U=ja(Jg),jU=ja(Qg),qU=ja(Xg),_s=cP;(Gg&&_s(new Gg(new ArrayBuffer(1)))!=PC||Kg&&_s(new Kg)!=_C||Jg&&_s(Jg.resolve())!=TC||Qg&&_s(new Qg)!=xC||Xg&&_s(new Xg)!=OC)&&(_s=function(n){var e=cP(n),t=e==DU?n.constructor:void 0,r=t?ja(t):"";if(r)switch(r){case FU:return PC;case zU:return _C;case $U:return TC;case jU:return xC;case qU:return OC}return e});var b0=_s,BU=Object.prototype,UU=BU.hasOwnProperty;function HU(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&UU.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var VU=HU,WU=u0;function GU(n,e){var t=e?WU(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}var KU=GU,JU=/\w*$/;function QU(n){var e=new n.constructor(n.source,JU.exec(n));return e.lastIndex=n.lastIndex,e}var XU=QU,RC=o0,kC=RC?RC.prototype:void 0,NC=kC?kC.valueOf:void 0;function YU(n){return NC?Object(NC.call(n)):{}}var ZU=YU,e3=u0,t3=KU,n3=XU,r3=ZU,i3=AO,s3="[object Boolean]",o3="[object Date]",a3="[object Map]",l3="[object Number]",c3="[object RegExp]",u3="[object Set]",d3="[object String]",h3="[object Symbol]",f3="[object ArrayBuffer]",p3="[object DataView]",m3="[object Float32Array]",g3="[object Float64Array]",v3="[object Int8Array]",y3="[object Int16Array]",S3="[object Int32Array]",b3="[object Uint8Array]",w3="[object Uint8ClampedArray]",C3="[object Uint16Array]",E3="[object Uint32Array]";function _3(n,e,t){var r=n.constructor;switch(e){case f3:return e3(n);case s3:case o3:return new r(+n);case p3:return t3(n,t);case m3:case g3:case v3:case y3:case S3:case b3:case w3:case C3:case E3:return i3(n,t);case a3:return new r;case l3:case d3:return new r(n);case c3:return n3(n);case u3:return new r;case h3:return r3(n)}}var T3=_3,x3=b0,O3=mo,P3="[object Map]";function R3(n){return O3(n)&&x3(n)==P3}var k3=R3,N3=k3,L3=p0,LC=m0,IC=LC&&LC.isMap,I3=IC?L3(IC):N3,A3=I3,M3=b0,D3=mo,F3="[object Set]";function z3(n){return D3(n)&&M3(n)==F3}var $3=z3,j3=$3,q3=p0,AC=m0,MC=AC&&AC.isSet,B3=MC?q3(MC):j3,U3=B3,H3=kO,V3=g2,W3=HO,G3=I2,K3=F2,J3=IO,Q3=MO,X3=J2,Y3=oU,Z3=pU,e4=SU,t4=b0,n4=VU,r4=T3,i4=FO,s4=jh,o4=f0,a4=A3,l4=fs,c4=U3,u4=y0,d4=Bc,h4=1,f4=2,p4=4,uP="[object Arguments]",m4="[object Array]",g4="[object Boolean]",v4="[object Date]",y4="[object Error]",dP="[object Function]",S4="[object GeneratorFunction]",b4="[object Map]",w4="[object Number]",hP="[object Object]",C4="[object RegExp]",E4="[object Set]",_4="[object String]",T4="[object Symbol]",x4="[object WeakMap]",O4="[object ArrayBuffer]",P4="[object DataView]",R4="[object Float32Array]",k4="[object Float64Array]",N4="[object Int8Array]",L4="[object Int16Array]",I4="[object Int32Array]",A4="[object Uint8Array]",M4="[object Uint8ClampedArray]",D4="[object Uint16Array]",F4="[object Uint32Array]",Le={};Le[uP]=Le[m4]=Le[O4]=Le[P4]=Le[g4]=Le[v4]=Le[R4]=Le[k4]=Le[N4]=Le[L4]=Le[I4]=Le[b4]=Le[w4]=Le[hP]=Le[C4]=Le[E4]=Le[_4]=Le[T4]=Le[A4]=Le[M4]=Le[D4]=Le[F4]=!0;Le[y4]=Le[dP]=Le[x4]=!1;function id(n,e,t,r,i,s){var o,a=e&h4,l=e&f4,c=e&p4;if(t&&(o=i?t(n,r,i,s):t(n)),o!==void 0)return o;if(!l4(n))return n;var u=s4(n);if(u){if(o=n4(n),!a)return Q3(n,o)}else{var d=t4(n),h=d==dP||d==S4;if(o4(n))return J3(n,a);if(d==hP||d==uP||h&&!i){if(o=l||h?{}:i4(n),!a)return l?Y3(n,K3(o,n)):X3(n,G3(o,n))}else{if(!Le[d])return i?n:{};o=r4(n,d,a)}}s||(s=new H3);var f=s.get(n);if(f)return f;s.set(n,o),c4(n)?n.forEach(function(S){o.add(id(S,e,t,S,n,s))}):a4(n)&&n.forEach(function(S,m){o.set(m,id(S,e,t,m,n,s))});var p=c?l?e4:Z3:l?d4:u4,g=u?void 0:p(n);return V3(g||n,function(S,m){g&&(m=S,S=n[m]),W3(o,m,id(S,e,t,m,n,s))}),o}var z4=id,$4=z4,j4=1,q4=4;function B4(n){return $4(n,j4|q4)}var U4=B4;const wa=pi(U4);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Yg=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){q(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Zg(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function H4(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const gc=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let V4=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let W4=class{send(e){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let G4=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};var ev={exports:{}},Pp,DC;function K4(){if(DC)return Pp;DC=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;Pp=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return o(u);if(h==="number"&&isFinite(u))return d.long?l(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=r?c(u,d,r,"day"):d>=t?c(u,d,t,"hour"):d>=e?c(u,d,e,"minute"):d>=n?c(u,d,n,"second"):u+" ms"}function c(u,d,h,f){var p=d>=h*1.5;return Math.round(u/h)+" "+f+(p?"s":"")}return Pp}function J4(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=a,t.humanize=K4(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,f,p;function g(...S){if(!g.enabled)return;const m=g,v=Number(new Date),y=v-(d||v);m.diff=y,m.prev=d,m.curr=v,d=v,S[0]=t.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let b=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(T,E)=>{if(T==="%%")return"%";b++;const O=t.formatters[E];if(typeof O=="function"){const A=S[b];T=O.call(m,A),S.splice(b,1),b--}return T}),t.formatArgs.call(m,S),(m.log||t.log).apply(m,S)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==t.namespaces&&(f=t.namespaces,p=t.enabled(u)),p),set:S=>{h=S}}),typeof t.init=="function"&&t.init(g),g}function r(u,d){const h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];const d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const h of d)h[0]==="-"?t.skips.push(h.slice(1)):t.names.push(h)}function s(u,d){let h=0,f=0,p=-1,g=0;for(;h<u.length;)if(f<d.length&&(d[f]===u[h]||d[f]==="*"))d[f]==="*"?(p=f,g=h,f++):(h++,f++);else if(p!==-1)f=p+1,g++,h=g;else return!1;for(;f<d.length&&d[f]==="*";)f++;return f===d.length}function o(){const u=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),u}function a(u){for(const d of t.skips)if(s(u,d))return!1;for(const d of t.names)if(s(u,d))return!0;return!1}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Q4=J4;(function(n,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let u=0,d=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(u++,h==="%c"&&(d=u))}),l.splice(d,0,c)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function o(){try{return localStorage}catch{}}n.exports=Q4(e);const{formatters:a}=n.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(ev,ev.exports);var tv=ev.exports;const fP=new G4(()=>Y4(Z4())),X4={getRawConfig:()=>{}},Y4=n=>n!=null?new Hc({getRawConfig:e=>{var t,r;try{return(r=pP((t=n.getItem(e))!==null&&t!==void 0?t:void 0))===null||r===void 0?void 0:r.raw}catch{}}}):X4;function FC(n){switch(n){case"boolean":case"number":case"string":return!0;default:return!1}}function pP(n){let e=n,t;if(typeof n=="string")try{e=JSON.parse(n),t={raw:n,string:n}}catch{}if(e===void 0)return t;const r=typeof e;if(FC(r))return Object.assign(Object.assign({},t),{raw:n,[r]:e});if(Array.isArray(e)){const i=typeof e[0];if(!FC(i))return t;for(const s of e)if(typeof s!==i)return t;return Object.assign(Object.assign({},t),{raw:n,[`${i}[]`]:e})}return t}const Z4=()=>{try{return sessionStorage!==null?sessionStorage:void 0}catch{return}};class Hc{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,r=[...e];for(;r.length>0;){const i=r.shift();i!==void 0&&mP(i)&&!t.has(i)&&(t.add(i),i instanceof Hc?r.push(...i.orderedBaseProviders):this.orderedBaseProviders.push(i))}}getBoolean(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.boolean}getNumber(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.number}getString(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.string}getBooleanArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["boolean[]"]}getNumberArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["number[]"]}getStringArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["string[]"]}getRawConfig(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const r=pP(t==null?void 0:t.getRawConfig(e));if(r!==void 0)return this.configCache.set(e,r),r}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function w0(n){const e=n;return mP(e==null?void 0:e.config)&&(e==null?void 0:e.logger)!==void 0}function qa(n){return w0(n)?n:C0(n,fP.value)}function C0(n,...e){if(w0(n))throw new Error("Logger is already a monitoring context");const t=n;return t.config=new Hc(...e),t.logger=n,t}function mP(n){const e=n;return typeof(e==null?void 0:e.getRawConfig)=="function"}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const gP=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function"&&typeof(n==null?void 0:n.addTelemetryProperties)=="function",vP=n=>typeof(n==null?void 0:n.errorInstanceId)=="string";function yP(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&vP(n)&&gP(n)}function SP(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&gP(n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const eH=n=>n!==null&&!Array.isArray(n)&&typeof n=="object";function E0(n,e){const t=(s,o)=>{if(!e)return s;const a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(eH(n)){const{errorType:s,stack:o,name:a}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const l=typeof a=="string"?a:void 0;i.stack=t(o,l)}}return i}const _0=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function";function tH(n,e){for(const t of Object.keys(e))n[t]===void 0&&(n[t]=e[t])}function nH(n){const e=n;e.errorInstanceId===void 0&&(e.errorInstanceId=ot())}function ar(n,e={}){var t;if(SP(n)&&nH(n),yP(n))return n.addTelemetryProperties((t=e.props)!==null&&t!==void 0?t:{}),n;const{message:r,stack:i}=E0(n,!1),s=new Vc({message:r,stack:i});if(typeof n=="object"&&n!==null){const{canRetry:a,retryAfterSeconds:l}=n;Object.assign(ar,{canRetry:a,retryAfterSeconds:l})}typeof n!="object"&&s.addTelemetryProperties({typeofError:typeof n});const o=_0(n)?n.getTelemetryProperties():{};return s.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},o),e.props),{untrustedOrigin:1})),s}let Rp;function Hh(){const n=new Error("<<generated stack>>");if(Rp===void 0&&(Rp=n.stack!==void 0),Rp)return n;try{throw n}catch(e){return e}}function rH(){return Hh().stack}function Vh(n,e){const{message:t,stack:r}=E0(n,!1),i=e(t);return r!==void 0&&wP(i,r),CP(n)&&i.addTelemetryProperties({untrustedOrigin:1}),vP(n)&&(i.overwriteErrorInstanceId(n.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:n.errorInstanceId})),_0(n)&&i.addTelemetryProperties(n.getTelemetryProperties()),i}function bP(n,e,t){const r=Vh(n,e),i=r.errorInstanceId,s=i;return t.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:s},n),r}function wP(n,e){try{Object.assign(n,{stack:e})}catch{n.addTelemetryProperties({stack2:e})}}function CP(n){return!SP(n)||n.getTelemetryProperties().untrustedOrigin===1&&n.errorType===Vc.normalizedErrorType}function iH(n){return typeof(n==null?void 0:n.value)!="object"&&typeof(n==null?void 0:n.tag)=="string"}function sH(n,e){const t={};for(const r of Object.keys(n)){if(e.has(r))continue;const i=n[r];switch(typeof i){case"string":case"number":case"boolean":case"undefined":t[r]=i;break;default:{iH(i)?t[r]=i:t[r]="REDACTED (arbitrary object)";break}}}return t}const oH=()=>{const n=new WeakSet;return(e,t)=>{if(typeof t=="object"&&t!==null){if(n.has(t))return"<removed/circular>";n.add(t)}return t}};class ae extends Error{constructor(e,t,r=new Set){super(e),this.omitPropsFromLogging=r,this._errorInstanceId=ot(),this.fluidErrorCode="-",r.add("omitPropsFromLogging"),r.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){tH(this,e)}getTelemetryProperties(){const e=sH(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class Vc extends ae{constructor(e){super(e.message),this.errorType=Vc.normalizedErrorType,e.stack!==void 0&&wP(this,e.stack)}}Vc.normalizedErrorType="genericError";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ae;(function(n){n.PackageData="PackageData",n.CodeArtifact="CodeArtifact",n.UserData="UserData"})(Ae||(Ae={}));class Qe{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(e==null)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,r){const{message:i,errorType:s,stack:o}=E0(t,!0);if(e.stack=o,e.error=i,e.errorType=s,_0(t)){const a=t.getTelemetryProperties();for(const l of Object.keys(a))e[l]===void 0&&(e[l]=a[l])}e.stack===void 0&&r&&(e.stack=rH())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=Object.assign({},e);t!==void 0&&Qe.prepareErrorObject(r,t,!1),typeof r.duration=="number"&&(r.duration=Qe.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const i=Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"performance"});this.sendTelemetryEventCore(i,t)}prepareEvent(e){const t=e.category==="error"||e.error!==void 0,r=Object.assign({},e);if(this.namespace!==void 0&&(r.eventName=`${this.namespace}${Qe.eventNamespaceSeparator}${r.eventName}`),this.properties){const i=[];i.push(this.properties.all),t&&i.push(this.properties.error);for(const s of i)if(s!==void 0)for(const o of Object.keys(s)){if(e[o]!==void 0)continue;const a=s[o],l=typeof a=="function"?a():a;l!==void 0&&(r[o]=l)}}return r}}Qe.eventNamespaceSeparator=":";class aH{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const r of Object.keys(e)){const i=e[r],{value:s,tag:o}=typeof i=="object"?i:{value:i,tag:void 0};switch(o){case void 0:t[r]=s;break;case Ae.PackageData:t[r]=s;break;case Ae.UserData:t[r]="REDACTED (UserData)";break;default:t[r]="REDACTED (unknown tag)";break}}this.logger.send(t)}}class de extends Qe{constructor(e,t,r){super(t,r),this.baseLogger=e,w0(e)&&C0(this,new Hc(e.config))}static create(e,t,r){if(e instanceof de){const i={};for(const o of[e.properties,r])o!==void 0&&(o.all!==void 0&&(i.all=Object.assign(Object.assign({},i.all),o.all)),o.error!==void 0&&(i.error=Object.assign(Object.assign({},i.error),o.error)));const s=e.namespace===void 0?t:t===void 0?e.namespace:`${e.namespace}${Qe.eventNamespaceSeparator}${t}`;return new de(e.baseLogger,s,i)}return new de(e||new W4,t,r)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class lH extends Qe{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){e!=null&&this.loggers.push(e)}send(e){const t=this.prepareEvent(e);this.loggers.forEach(r=>{r.send(t)})}}class ce{constructor(e,t,r={end:!0,cancel:"generic"}){this.logger=e,this.markers=r,this.startTime=gc.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),typeof window=="object"&&window!=null&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,r){return new ce(e,t,r)}static timedExec(e,t,r,i){const s=ce.start(e,t,i);try{const o=r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}static async timedExecAsync(e,t,r,i){const s=ce.start(e,t,i);try{const o=await r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}get duration(){return gc.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){this.markers.cancel!==void 0&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,r){if(!this.event)return;const i=Object.assign(Object.assign({},this.event),t);i.eventName=`${i.eventName}_${e}`,e!=="start"&&(i.duration=this.duration),this.logger.sendPerformanceEvent(i,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zl extends Qe{constructor(e,t,r){super(void 0,r),this.debug=e,this.debugErr=t}static create(e,t){const r=tv.debug(e),i=tv.debug(e);return i.log=console.error.bind(console),i.enabled=!0,new zl(r,i,t)}static mixinDebugLogger(e,t,r){if(!t)return zl.create(e,r);const i=new lH(void 0,r);return i.addLogger(zl.create(e,this.tryGetBaseLoggerProps(t))),i.addLogger(de.create(t,e)),i}static tryGetBaseLoggerProps(e){if(e instanceof Qe)return e.properties}send(e){const t=this.prepareEvent(e),r=t.category==="error";let i=r?this.debugErr:this.debug;const s=e.eventName.lastIndexOf(Qe.eventNamespaceSeparator),o=e.eventName.substring(s+1);s>0&&(i=i.extend(e.eventName.substring(0,s))),t.eventName=void 0;let a="";a=`tick=${Qe.formatTick(gc.now())}`;const l=t.stack?t.stack:"";t.stack=void 0;let c;try{c=JSON.stringify(t)}catch{t.error=void 0,c=JSON.stringify(t)}c==="{}"&&(c=""),r&&(i.enabled=!0),i(`${o} ${c} ${a} ${l}`)}}class T0 extends V4{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(r){return this.errorHandler(e,r),!0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const EP="connected",_P="disconnected";function cH(n,e,t,...r){try{n.emit(t,...r)}catch(i){e.sendErrorEvent({eventName:"RaiseEventError",event:t},i)}}function x0(n,e,t,r){try{t?e.emit(EP,r):e.emit(_P)}catch(i){n.sendErrorEvent({eventName:"RaiseConnectedEventError"},i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class TP{constructor(e,t,r=e){this.threshold=e,this.logger=t,this.thresholdMultiple=r}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=this.thresholdMultiple*2)}}function uH(n,e,t){if(n)return!0;const r=typeof t=="string"?{eventName:t,category:"error"}:Object.assign({category:"error"},t);return e.send(r),!1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zC{constructor(e,t,r,i=!1,s=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=r,this.includeAggregateMetrics=i,this.perBucketProperties=s,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var r,i,s;const o=gc.now(),a=e(),l=gc.now()-o;let c=this.measurementsMap.get(t);return c===void 0&&(c={count:0,duration:-1},this.measurementsMap.set(t,c)),c.count++,c.duration=l,this.includeAggregateMetrics&&(c.totalDuration=((r=c.totalDuration)!==null&&r!==void 0?r:0)+l,c.minDuration=Math.min((i=c.minDuration)!==null&&i!==void 0?i:l,l),c.maxDuration=Math.max((s=c.maxDuration)!==null&&s!==void 0?s:0,l)),c.count>=this.sampleThreshold&&this.flushBucket(t),a}flushBucket(e){const t=this.measurementsMap.get(e);if(t!==void 0&&t.count!==0){const r=this.perBucketProperties.get(e),i=Object.assign(Object.assign(Object.assign({},this.eventBase),r),t);this.logger.sendPerformanceEvent(i),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach((t,r)=>this.flushBucket(r))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ti extends ae{constructor(e,t,r){super(e,r,new Set(["error"])),this.error=t,this.errorType=as.genericError}}class O0 extends ae{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=as.throttlingError}static wrap(e,t,r){return bP(e,s=>new O0(s,t),r)}}class Ee extends ae{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class dH extends ae{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=as.clientSessionExpiredError}}class Pr extends ae{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=as.dataCorruptionError,this.canRetry=!1}}class kn extends ae{constructor(e){super(e),this.errorType=as.dataProcessingError,this.canRetry=!1}static create(e,t,r,i={}){const s=kn.wrapIfUnrecognized(e,t,r);return s.addTelemetryProperties(i),s}static wrapIfUnrecognized(e,t,r){const i=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},r===void 0?void 0:ro(r)),s=ar(e,{props:i});if(!CP(s))return s;const o=Vh(s,a=>new kn(a));return o.addTelemetryProperties(s.getTelemetryProperties()),o}}const ro=n=>({messageClientId:n.clientId,messageSequenceNumber:n.sequenceNumber,messageClientSequenceNumber:n.clientSequenceNumber,messageReferenceSequenceNumber:n.referenceSequenceNumber,messageMinimumSequenceNumber:n.minimumSequenceNumber,messageTimestamp:n.timestamp});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class P0{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return(e=this._policies)!==null&&e!==void 0?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.internalStorageService.getSnapshotTree(e,t)}async getVersions(e,t,r){return this.internalStorageService.getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.internalStorageService.downloadSummary(e)}async createBlob(e){return this.internalStorageService.createBlob(e)}async readBlob(e){return this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hH extends P0{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}async readBlob(e){const t=this.blobs.get(e);return t!==void 0?t:this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gs;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Gs||(Gs={}));var $C;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})($C||($C={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gd;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Gd||(Gd={}));var $l;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})($l||($l={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var qs;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(qs||(qs={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Re(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function fH(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const pH=(n,e)=>R0.from(n,e).buffer,mH=(n,e)=>R0.from(n).toString(e);function jC(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let R0=class Ts extends Uint8Array{toString(e){return fH(this,e)}static from(e,t,r){if(typeof e=="string")return Ts.fromString(e,t);if(e!==null&&typeof e=="object"&&jC(e.buffer))return Re(e.byteOffset===0,0),Re(e.byteLength===e.buffer.byteLength,1),Ts.fromArrayBuffer(e.buffer,t,r);if(jC(e))return Ts.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ts(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Ts(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ts(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Di=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let xP=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const gH=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fi;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Fi||(Fi={}));var qC;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(qC||(qC={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var io;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(io||(io={}));var vc;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(vc||(vc={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Er;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Er||(Er={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function nv(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let k0=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function OP(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function vH(n){const e=n.type===Er.Handle?n.handleType:n.type;switch(e){case Er.Blob:case Er.Attachment:return io.File;case Er.Tree:return io.Directory;default:OP(e,`Unknown type: ${e}`)}}function PP(n){const e=n.type===Er.Handle?n.handleType:n.type;switch(e){case Er.Blob:case Er.Attachment:return"blob";case Er.Tree:return"tree";default:OP(e,`Unknown type: ${e}`)}}function N0(n,e=new Map,t=!1){const r={},i={id:n.sha,blobs:{},trees:{}};r[""]=i;for(const s of n.tree){const o=t?s.path.replace(/^\.app\//,""):s.path,a=o.lastIndexOf("/"),l=o.slice(0,Math.max(0,a)),c=o.slice(a+1),u=r[l];if(s.type==="tree"){const d={id:s.sha,blobs:{},commits:{},trees:{}};u.trees[decodeURIComponent(c)]=d,r[o]=d}else if(s.type==="blob")u.blobs[decodeURIComponent(c)]=s.sha,e.set(s.sha,`/${o}`);else throw new Error("Unknown entry type!!")}return i}class RP{constructor(e,t,r="utf-8"){this.path=e,this.mode=io.File,this.type=vc.Blob,this.value={contents:t,encoding:r}}}class yH{constructor(e,t){this.path=e,this.value=t,this.mode=io.Directory,this.type=vc.Tree}}class SH{constructor(e,t){this.path=e,this.id=t,this.mode=io.File,this.type=vc.Attachment,this.value={id:t}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class BC{constructor(e,t,r,i){this.sequenceNumber=e,this.key=t,this.value=r,this.local=i}}class bH extends k0{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return(e=this.snapshotCache)!==null&&e!==void 0||(this.snapshotCache=wa(Array.from(this.members))),this.snapshotCache}addMember(e,t){nv(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){nv(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class wH extends k0{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new pn.EventEmitter,this.proposals=new Map(e.proposals.map(([,r])=>[r.sequenceNumber,new BC(r.sequenceNumber,r.key,r.value,!1)])),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return(e=this.proposalsSnapshotCache)!==null&&e!==void 0||(this.proposalsSnapshotCache=Array.from(this.proposals).map(([r,i])=>[r,{sequenceNumber:r,key:i.key,value:i.value},[]])),(t=this.valuesSnapshotCache)!==null&&t!==void 0||(this.valuesSnapshotCache=wa(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return(t=this.values.get(e))===null||t===void 0?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?wa(t):void 0}async propose(e,t){const r=this.sendProposal(e,t);if(r<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise((i,s)=>{let o;const a=(h,f)=>{h===r&&(o=f,this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("disconnected",c),this.stateEvents.on("localProposalApproved",l))},l=h=>{h===o&&(i(),d())},c=()=>{o===void 0&&this.stateEvents.once("connected",()=>{o===void 0&&(s(new Error("Client disconnected without successfully sending proposal")),d())})},u=()=>{s(new Error("QuorumProposals was disposed")),d()},d=()=>{this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("localProposalApproved",l),this.stateEvents.off("disconnected",c),this.stateEvents.off("disposed",u)};this.stateEvents.on("localProposalSequenced",a),this.stateEvents.on("disconnected",c),this.stateEvents.on("disposed",u)})}addProposal(e,t,r,i,s){nv(!this.proposals.has(r),464);const o=new BC(r,e,t,i);this.proposals.set(r,o),this.emit("addProposal",o),i&&this.stateEvents.emit("localProposalSequenced",s,r),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,r=[];for(const[i,s]of this.proposals)i<=t&&r.push(s);r.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);for(const i of r){const s={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:i.key,sequenceNumber:i.sequenceNumber,value:i.value};this.values.set(s.key,s),this.valuesSnapshotCache=void 0,this.emit("approveProposal",s.sequenceNumber,s.key,s.value,s.approvalSequenceNumber),this.proposals.delete(i.sequenceNumber),this.proposalsSnapshotCache=void 0,i.local&&this.stateEvents.emit("localProposalApproved",i.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class CH extends k0{constructor(e,t,r,i){super(),this.isDisposed=!1,this.quorumClients=new bH(e),this.quorumClients.on("addMember",(s,o)=>{this.emit("addMember",s,o)}),this.quorumClients.on("removeMember",s=>{this.emit("removeMember",s)}),this.quorumProposals=new wH({proposals:t,values:r},i),this.quorumProposals.on("addProposal",s=>{this.emit("addProposal",s)}),this.quorumProposals.on("approveProposal",(s,o,a,l)=>{this.emit("approveProposal",s,o,a,l)})}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:r}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:r}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}async propose(e,t){return this.quorumProposals.propose(e,t)}addProposal(e,t,r,i,s){return this.quorumProposals.addProposal(e,t,r,i,s)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class EH{constructor(e,t,r,i,s,o,a){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=r??1,this._quorum=new CH(i,s,o,a)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let r=!1;switch(e.type){case Fi.ClientJoin:const i=e,s=JSON.parse(i.data),o={client:s.detail,sequenceNumber:i.sequenceNumber};this._quorum.addMember(s.clientId,o);break;case Fi.ClientLeave:const l=JSON.parse(e.data);this._quorum.removeMember(l);break;case Fi.Propose:const c=e.contents;this._quorum.addProposal(c.key,c.value,e.sequenceNumber,t,e.clientSequenceNumber),r=!0;break;case Fi.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:r}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}class _H extends EH{processMessage(e,t){const r=this._quorum.getMember(e.clientId);if(e.clientId!=null){if(r===void 0&&e.type!==Fi.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if((r==null?void 0:r.shouldHaveLeft)===!0&&e.type!==Fi.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function kP(n,e,t){const r=[];for(const i of e){const s=`${n}${i.path}`;if(i.type===$l.Blob){const o=i.value,a=pH(o.contents,o.encoding),l=ot();t.set(l,a);const c={mode:Gd[i.mode],path:s,sha:l,size:0,type:"blob",url:""};r.push(c)}else if(i.type===$l.Tree){Re(i.type===$l.Tree,257);const o=i.value,a={mode:Gd[i.mode],path:s,sha:"",size:-1,type:"tree",url:""};r.push(a);const l=kP(`${s}/`,o.entries,t);r.push(...l)}}return r}function TH(n,e){return{sha:"",tree:kP("",n,e),url:""}}function NP(n,e){const t=TH(n,e);return N0(t)}var Kd={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Kd.exports;(function(n,e){(function(t){var r=e&&!e.nodeType&&e,i=n&&!n.nodeType&&n,s=typeof globalThis=="object"&&globalThis;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,c=1,u=26,d=38,h=700,f=72,p=128,g="-",S=/^xn--/,m=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=l-c,w=Math.floor,T=String.fromCharCode,E;function O(x){throw new RangeError(y[x])}function A(x,j){for(var Q=x.length,me=[];Q--;)me[Q]=j(x[Q]);return me}function F(x,j){var Q=x.split("@"),me="";Q.length>1&&(me=Q[0]+"@",x=Q[1]),x=x.replace(v,".");var _=x.split("."),R=A(_,j).join(".");return me+R}function X(x){for(var j=[],Q=0,me=x.length,_,R;Q<me;)_=x.charCodeAt(Q++),_>=55296&&_<=56319&&Q<me?(R=x.charCodeAt(Q++),(R&64512)==56320?j.push(((_&1023)<<10)+(R&1023)+65536):(j.push(_),Q--)):j.push(_);return j}function z(x){return A(x,function(j){var Q="";return j>65535&&(j-=65536,Q+=T(j>>>10&1023|55296),j=56320|j&1023),Q+=T(j),Q}).join("")}function Z(x){return x-48<10?x-22:x-65<26?x-65:x-97<26?x-97:l}function W(x,j){return x+22+75*(x<26)-((j!=0)<<5)}function C(x,j,Q){var me=0;for(x=Q?w(x/h):x>>1,x+=w(x/j);x>b*u>>1;me+=l)x=w(x/b);return w(me+(b+1)*x/(x+d))}function k(x){var j=[],Q=x.length,me,_=0,R=p,M=f,H,se,ge,je,qe,dt,Nt,mn,Br;for(H=x.lastIndexOf(g),H<0&&(H=0),se=0;se<H;++se)x.charCodeAt(se)>=128&&O("not-basic"),j.push(x.charCodeAt(se));for(ge=H>0?H+1:0;ge<Q;){for(je=_,qe=1,dt=l;ge>=Q&&O("invalid-input"),Nt=Z(x.charCodeAt(ge++)),(Nt>=l||Nt>w((a-_)/qe))&&O("overflow"),_+=Nt*qe,mn=dt<=M?c:dt>=M+u?u:dt-M,!(Nt<mn);dt+=l)Br=l-mn,qe>w(a/Br)&&O("overflow"),qe*=Br;me=j.length+1,M=C(_-je,me,je==0),w(_/me)>a-R&&O("overflow"),R+=w(_/me),_%=me,j.splice(_++,0,R)}return z(j)}function V(x){var j,Q,me,_,R,M,H,se,ge,je,qe,dt=[],Nt,mn,Br,Za;for(x=X(x),Nt=x.length,j=p,Q=0,R=f,M=0;M<Nt;++M)qe=x[M],qe<128&&dt.push(T(qe));for(me=_=dt.length,_&&dt.push(g);me<Nt;){for(H=a,M=0;M<Nt;++M)qe=x[M],qe>=j&&qe<H&&(H=qe);for(mn=me+1,H-j>w((a-Q)/mn)&&O("overflow"),Q+=(H-j)*mn,j=H,M=0;M<Nt;++M)if(qe=x[M],qe<j&&++Q>a&&O("overflow"),qe==j){for(se=Q,ge=l;je=ge<=R?c:ge>=R+u?u:ge-R,!(se<je);ge+=l)Za=se-je,Br=l-je,dt.push(T(W(je+Za%Br,0))),se=w(Za/Br);dt.push(T(W(se,0))),R=C(Q,mn,me==_),Q=0,++me}++Q,++j}return dt.join("")}function I(x){return F(x,function(j){return S.test(j)?k(j.slice(4).toLowerCase()):j})}function U(x){return F(x,function(j){return m.test(j)?"xn--"+V(j):j})}if(o={version:"1.4.1",ucs2:{decode:X,encode:z},decode:k,encode:V,toASCII:U,toUnicode:I},r&&i)if(n.exports==r)i.exports=o;else for(E in o)o.hasOwnProperty(E)&&(r[E]=o[E]);else t.punycode=o})(G)})(Kd,Kd.exports);var xH=Kd.exports,Ba=TypeError;const OH={},PH=Object.freeze(Object.defineProperty({__proto__:null,default:OH},Symbol.toStringTag,{value:"Module"})),RH=Lc(PH);var L0=typeof Map=="function"&&Map.prototype,kp=Object.getOwnPropertyDescriptor&&L0?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Jd=L0&&kp&&typeof kp.get=="function"?kp.get:null,UC=L0&&Map.prototype.forEach,I0=typeof Set=="function"&&Set.prototype,Np=Object.getOwnPropertyDescriptor&&I0?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Qd=I0&&Np&&typeof Np.get=="function"?Np.get:null,HC=I0&&Set.prototype.forEach,kH=typeof WeakMap=="function"&&WeakMap.prototype,jl=kH?WeakMap.prototype.has:null,NH=typeof WeakSet=="function"&&WeakSet.prototype,ql=NH?WeakSet.prototype.has:null,LH=typeof WeakRef=="function"&&WeakRef.prototype,VC=LH?WeakRef.prototype.deref:null,IH=Boolean.prototype.valueOf,AH=Object.prototype.toString,MH=Function.prototype.toString,DH=String.prototype.match,A0=String.prototype.slice,zi=String.prototype.replace,FH=String.prototype.toUpperCase,WC=String.prototype.toLowerCase,LP=RegExp.prototype.test,GC=Array.prototype.concat,Sr=Array.prototype.join,zH=Array.prototype.slice,KC=Math.floor,rv=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Lp=Object.getOwnPropertySymbols,iv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ca=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Bl=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ca||"symbol")?Symbol.toStringTag:null,IP=Object.prototype.propertyIsEnumerable,JC=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function QC(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||LP.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var r=n<0?-KC(-n):KC(n);if(r!==n){var i=String(r),s=A0.call(e,i.length+1);return zi.call(i,t,"$&_")+"."+zi.call(zi.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return zi.call(e,t,"$&_")}var sv=RH,XC=sv.custom,YC=DP(XC)?XC:null,AP={__proto__:null,double:'"',single:"'"},$H={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Wh=function n(e,t,r,i){var s=t||{};if(Kr(s,"quoteStyle")&&!Kr(AP,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Kr(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Kr(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Kr(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Kr(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return zP(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return a?QC(e,l):l}if(typeof e=="bigint"){var c=String(e)+"n";return a?QC(e,c):c}var u=typeof s.depth>"u"?5:s.depth;if(typeof r>"u"&&(r=0),r>=u&&u>0&&typeof e=="object")return ov(e)?"[Array]":"[Object]";var d=r6(s,r);if(typeof i>"u")i=[];else if(FP(i,e)>=0)return"[Circular]";function h(Z,W,C){if(W&&(i=zH.call(i),i.push(W)),C){var k={depth:s.depth};return Kr(s,"quoteStyle")&&(k.quoteStyle=s.quoteStyle),n(Z,k,r+1,i)}return n(Z,s,r+1,i)}if(typeof e=="function"&&!ZC(e)){var f=KH(e),p=Lu(e,h);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+Sr.call(p,", ")+" }":"")}if(DP(e)){var g=Ca?zi.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):iv.call(e);return typeof e=="object"&&!Ca?hl(g):g}if(e6(e)){for(var S="<"+WC.call(String(e.nodeName)),m=e.attributes||[],v=0;v<m.length;v++)S+=" "+m[v].name+"="+MP(jH(m[v].value),"double",s);return S+=">",e.childNodes&&e.childNodes.length&&(S+="..."),S+="</"+WC.call(String(e.nodeName))+">",S}if(ov(e)){if(e.length===0)return"[]";var y=Lu(e,h);return d&&!n6(y)?"["+av(y,d)+"]":"[ "+Sr.call(y,", ")+" ]"}if(BH(e)){var b=Lu(e,h);return!("cause"in Error.prototype)&&"cause"in e&&!IP.call(e,"cause")?"{ ["+String(e)+"] "+Sr.call(GC.call("[cause]: "+h(e.cause),b),", ")+" }":b.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Sr.call(b,", ")+" }"}if(typeof e=="object"&&o){if(YC&&typeof e[YC]=="function"&&sv)return sv(e,{depth:u-r});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(JH(e)){var w=[];return UC&&UC.call(e,function(Z,W){w.push(h(W,e,!0)+" => "+h(Z,e))}),eE("Map",Jd.call(e),w,d)}if(YH(e)){var T=[];return HC&&HC.call(e,function(Z){T.push(h(Z,e))}),eE("Set",Qd.call(e),T,d)}if(QH(e))return Ip("WeakMap");if(ZH(e))return Ip("WeakSet");if(XH(e))return Ip("WeakRef");if(HH(e))return hl(h(Number(e)));if(WH(e))return hl(h(rv.call(e)));if(VH(e))return hl(IH.call(e));if(UH(e))return hl(h(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof globalThis<"u"&&e===globalThis)return"{ [object globalThis] }";if(!qH(e)&&!ZC(e)){var E=Lu(e,h),O=JC?JC(e)===Object.prototype:e instanceof Object||e.constructor===Object,A=e instanceof Object?"":"null prototype",F=!O&&Bl&&Object(e)===e&&Bl in e?A0.call(ps(e),8,-1):A?"Object":"",X=O||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",z=X+(F||A?"["+Sr.call(GC.call([],F||[],A||[]),": ")+"] ":"");return E.length===0?z+"{}":d?z+"{"+av(E,d)+"}":z+"{ "+Sr.call(E,", ")+" }"}return String(e)};function MP(n,e,t){var r=t.quoteStyle||e,i=AP[r];return i+n+i}function jH(n){return zi.call(String(n),/"/g,"&quot;")}function go(n){return!Bl||!(typeof n=="object"&&(Bl in n||typeof n[Bl]<"u"))}function ov(n){return ps(n)==="[object Array]"&&go(n)}function qH(n){return ps(n)==="[object Date]"&&go(n)}function ZC(n){return ps(n)==="[object RegExp]"&&go(n)}function BH(n){return ps(n)==="[object Error]"&&go(n)}function UH(n){return ps(n)==="[object String]"&&go(n)}function HH(n){return ps(n)==="[object Number]"&&go(n)}function VH(n){return ps(n)==="[object Boolean]"&&go(n)}function DP(n){if(Ca)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!iv)return!1;try{return iv.call(n),!0}catch{}return!1}function WH(n){if(!n||typeof n!="object"||!rv)return!1;try{return rv.call(n),!0}catch{}return!1}var GH=Object.prototype.hasOwnProperty||function(n){return n in this};function Kr(n,e){return GH.call(n,e)}function ps(n){return AH.call(n)}function KH(n){if(n.name)return n.name;var e=DH.call(MH.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function FP(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,r=n.length;t<r;t++)if(n[t]===e)return t;return-1}function JH(n){if(!Jd||!n||typeof n!="object")return!1;try{Jd.call(n);try{Qd.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function QH(n){if(!jl||!n||typeof n!="object")return!1;try{jl.call(n,jl);try{ql.call(n,ql)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function XH(n){if(!VC||!n||typeof n!="object")return!1;try{return VC.call(n),!0}catch{}return!1}function YH(n){if(!Qd||!n||typeof n!="object")return!1;try{Qd.call(n);try{Jd.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function ZH(n){if(!ql||!n||typeof n!="object")return!1;try{ql.call(n,ql);try{jl.call(n,jl)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function e6(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function zP(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,r="... "+t+" more character"+(t>1?"s":"");return zP(A0.call(n,0,e.maxStringLength),e)+r}var i=$H[e.quoteStyle||"single"];i.lastIndex=0;var s=zi.call(zi.call(n,i,"\\$1"),/[\x00-\x1f]/g,t6);return MP(s,"single",e)}function t6(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+FH.call(e.toString(16))}function hl(n){return"Object("+n+")"}function Ip(n){return n+" { ? }"}function eE(n,e,t,r){var i=r?av(t,r):Sr.call(t,", ");return n+" ("+e+") {"+i+"}"}function n6(n){for(var e=0;e<n.length;e++)if(FP(n[e],`
`)>=0)return!1;return!0}function r6(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=Sr.call(Array(n.indent+1)," ");else return null;return{base:t,prev:Sr.call(Array(e+1),t)}}function av(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+Sr.call(n,","+t)+`
`+e.prev}function Lu(n,e){var t=ov(n),r=[];if(t){r.length=n.length;for(var i=0;i<n.length;i++)r[i]=Kr(n,i)?e(n[i],n):""}var s=typeof Lp=="function"?Lp(n):[],o;if(Ca){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in n)Kr(n,l)&&(t&&String(Number(l))===l&&l<n.length||Ca&&o["$"+l]instanceof Symbol||(LP.call(/[^\w$]/,l)?r.push(e(l,n)+": "+e(n[l],n)):r.push(l+": "+e(n[l],n))));if(typeof Lp=="function")for(var c=0;c<s.length;c++)IP.call(n,s[c])&&r.push("["+e(s[c])+"]: "+e(n[s[c]],n));return r}var i6=Wh,s6=Ba,Gh=function(n,e,t){for(var r=n,i;(i=r.next)!=null;r=i)if(i.key===e)return r.next=i.next,t||(i.next=n.next,n.next=i),i},o6=function(n,e){if(n){var t=Gh(n,e);return t&&t.value}},a6=function(n,e,t){var r=Gh(n,e);r?r.value=t:n.next={key:e,next:n.next,value:t}},l6=function(n,e){return n?!!Gh(n,e):!1},c6=function(n,e){if(n)return Gh(n,e,!0)},u6=function(){var e,t={assert:function(r){if(!t.has(r))throw new s6("Side channel does not contain "+i6(r))},delete:function(r){var i=e&&e.next,s=c6(e,r);return s&&i&&i===s&&(e=void 0),!!s},get:function(r){return o6(e,r)},has:function(r){return l6(e,r)},set:function(r,i){e||(e={next:void 0}),a6(e,r,i)}};return t},$P=Object,d6=Error,h6=EvalError,f6=RangeError,p6=ReferenceError,m6=SyntaxError,g6=URIError,v6=Math.abs,y6=Math.floor,S6=Math.max,b6=Math.min,w6=Math.pow,C6=Math.round,E6=Number.isNaN||function(e){return e!==e},_6=E6,T6=function(e){return _6(e)||e===0?e:e<0?-1:1},x6=Object.getOwnPropertyDescriptor,sd=x6;if(sd)try{sd([],"length")}catch{sd=null}var jP=sd,od=Object.defineProperty||!1;if(od)try{od({},"a",{value:1})}catch{od=!1}var O6=od,Ap,tE;function P6(){return tE||(tE=1,Ap=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Ap}var Mp,nE;function R6(){if(nE)return Mp;nE=1;var n=typeof Symbol<"u"&&Symbol,e=P6();return Mp=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Mp}var Dp,rE;function qP(){return rE||(rE=1,Dp=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Dp}var Fp,iE;function BP(){if(iE)return Fp;iE=1;var n=$P;return Fp=n.getPrototypeOf||null,Fp}var k6="Function.prototype.bind called on incompatible ",N6=Object.prototype.toString,L6=Math.max,I6="[object Function]",sE=function(e,t){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var s=0;s<t.length;s+=1)r[s+e.length]=t[s];return r},A6=function(e,t){for(var r=[],i=t||0,s=0;i<e.length;i+=1,s+=1)r[s]=e[i];return r},M6=function(n,e){for(var t="",r=0;r<n.length;r+=1)t+=n[r],r+1<n.length&&(t+=e);return t},D6=function(e){var t=this;if(typeof t!="function"||N6.apply(t)!==I6)throw new TypeError(k6+t);for(var r=A6(arguments,1),i,s=function(){if(this instanceof i){var u=t.apply(this,sE(r,arguments));return Object(u)===u?u:this}return t.apply(e,sE(r,arguments))},o=L6(0,t.length-r.length),a=[],l=0;l<o;l++)a[l]="$"+l;if(i=Function("binder","return function ("+M6(a,",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var c=function(){};c.prototype=t.prototype,i.prototype=new c,c.prototype=null}return i},F6=D6,Kh=Function.prototype.bind||F6,M0=Function.prototype.call,zp,oE;function UP(){return oE||(oE=1,zp=Function.prototype.apply),zp}var z6=typeof Reflect<"u"&&Reflect&&Reflect.apply,$6=Kh,j6=UP(),q6=M0,B6=z6,U6=B6||$6.call(q6,j6),H6=Kh,V6=Ba,W6=M0,G6=U6,HP=function(e){if(e.length<1||typeof e[0]!="function")throw new V6("a function is required");return G6(H6,W6,e)},$p,aE;function K6(){if(aE)return $p;aE=1;var n=HP,e=jP,t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return $p=r&&typeof r.get=="function"?n([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,$p}var jp,lE;function J6(){if(lE)return jp;lE=1;var n=qP(),e=BP(),t=K6();return jp=n?function(i){return n(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,jp}var qp,cE;function Q6(){if(cE)return qp;cE=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Kh;return qp=t.call(n,e),qp}var fe,X6=$P,Y6=d6,Z6=h6,e8=f6,t8=p6,Ea=m6,sa=Ba,n8=g6,r8=v6,i8=y6,s8=S6,o8=b6,a8=w6,l8=C6,c8=T6,VP=Function,Bp=function(n){try{return VP('"use strict"; return ('+n+").constructor;")()}catch{}},yc=jP,u8=O6,Up=function(){throw new sa},d8=yc?function(){try{return arguments.callee,Up}catch{try{return yc(arguments,"callee").get}catch{return Up}}}():Up,Oo=R6()(),St=J6(),h8=BP(),f8=qP(),WP=UP(),Wc=M0,Ao={},p8=typeof Uint8Array>"u"||!St?fe:St(Uint8Array),Ks={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?fe:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?fe:ArrayBuffer,"%ArrayIteratorPrototype%":Oo&&St?St([][Symbol.iterator]()):fe,"%AsyncFromSyncIteratorPrototype%":fe,"%AsyncFunction%":Ao,"%AsyncGenerator%":Ao,"%AsyncGeneratorFunction%":Ao,"%AsyncIteratorPrototype%":Ao,"%Atomics%":typeof Atomics>"u"?fe:Atomics,"%BigInt%":typeof BigInt>"u"?fe:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?fe:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?fe:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?fe:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Y6,"%eval%":eval,"%EvalError%":Z6,"%Float16Array%":typeof Float16Array>"u"?fe:Float16Array,"%Float32Array%":typeof Float32Array>"u"?fe:Float32Array,"%Float64Array%":typeof Float64Array>"u"?fe:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?fe:FinalizationRegistry,"%Function%":VP,"%GeneratorFunction%":Ao,"%Int8Array%":typeof Int8Array>"u"?fe:Int8Array,"%Int16Array%":typeof Int16Array>"u"?fe:Int16Array,"%Int32Array%":typeof Int32Array>"u"?fe:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Oo&&St?St(St([][Symbol.iterator]())):fe,"%JSON%":typeof JSON=="object"?JSON:fe,"%Map%":typeof Map>"u"?fe:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Oo||!St?fe:St(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":X6,"%Object.getOwnPropertyDescriptor%":yc,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?fe:Promise,"%Proxy%":typeof Proxy>"u"?fe:Proxy,"%RangeError%":e8,"%ReferenceError%":t8,"%Reflect%":typeof Reflect>"u"?fe:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?fe:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Oo||!St?fe:St(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?fe:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Oo&&St?St(""[Symbol.iterator]()):fe,"%Symbol%":Oo?Symbol:fe,"%SyntaxError%":Ea,"%ThrowTypeError%":d8,"%TypedArray%":p8,"%TypeError%":sa,"%Uint8Array%":typeof Uint8Array>"u"?fe:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?fe:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?fe:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?fe:Uint32Array,"%URIError%":n8,"%WeakMap%":typeof WeakMap>"u"?fe:WeakMap,"%WeakRef%":typeof WeakRef>"u"?fe:WeakRef,"%WeakSet%":typeof WeakSet>"u"?fe:WeakSet,"%Function.prototype.call%":Wc,"%Function.prototype.apply%":WP,"%Object.defineProperty%":u8,"%Object.getPrototypeOf%":h8,"%Math.abs%":r8,"%Math.floor%":i8,"%Math.max%":s8,"%Math.min%":o8,"%Math.pow%":a8,"%Math.round%":l8,"%Math.sign%":c8,"%Reflect.getPrototypeOf%":f8};if(St)try{null.error}catch(n){var m8=St(St(n));Ks["%Error.prototype%"]=m8}var g8=function n(e){var t;if(e==="%AsyncFunction%")t=Bp("async function () {}");else if(e==="%GeneratorFunction%")t=Bp("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Bp("async function* () {}");else if(e==="%AsyncGenerator%"){var r=n("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=n("%AsyncGenerator%");i&&St&&(t=St(i.prototype))}return Ks[e]=t,t},uE={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Gc=Kh,Xd=Q6(),v8=Gc.call(Wc,Array.prototype.concat),y8=Gc.call(WP,Array.prototype.splice),dE=Gc.call(Wc,String.prototype.replace),Yd=Gc.call(Wc,String.prototype.slice),S8=Gc.call(Wc,RegExp.prototype.exec),b8=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,w8=/\\(\\)?/g,C8=function(e){var t=Yd(e,0,1),r=Yd(e,-1);if(t==="%"&&r!=="%")throw new Ea("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new Ea("invalid intrinsic syntax, expected opening `%`");var i=[];return dE(e,b8,function(s,o,a,l){i[i.length]=a?dE(l,w8,"$1"):o||s}),i},E8=function(e,t){var r=e,i;if(Xd(uE,r)&&(i=uE[r],r="%"+i[0]+"%"),Xd(Ks,r)){var s=Ks[r];if(s===Ao&&(s=g8(r)),typeof s>"u"&&!t)throw new sa("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:s}}throw new Ea("intrinsic "+e+" does not exist!")},D0=function(e,t){if(typeof e!="string"||e.length===0)throw new sa("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new sa('"allowMissing" argument must be a boolean');if(S8(/^%?[^%]*%?$/,e)===null)throw new Ea("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=C8(e),i=r.length>0?r[0]:"",s=E8("%"+i+"%",t),o=s.name,a=s.value,l=!1,c=s.alias;c&&(i=c[0],y8(r,v8([0,1],c)));for(var u=1,d=!0;u<r.length;u+=1){var h=r[u],f=Yd(h,0,1),p=Yd(h,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new Ea("property names with quotes must have matching quotes");if((h==="constructor"||!d)&&(l=!0),i+="."+h,o="%"+i+"%",Xd(Ks,o))a=Ks[o];else if(a!=null){if(!(h in a)){if(!t)throw new sa("base intrinsic for "+e+" exists, but the property is not available.");return}if(yc&&u+1>=r.length){var g=yc(a,h);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[h]}else d=Xd(a,h),a=a[h];d&&!l&&(Ks[o]=a)}}return a},GP=D0,KP=HP,_8=KP([GP("%String.prototype.indexOf%")]),JP=function(e,t){var r=GP(e,!!t);return typeof r=="function"&&_8(e,".prototype.")>-1?KP([r]):r},T8=D0,Kc=JP,x8=Wh,O8=Ba,hE=T8("%Map%",!0),P8=Kc("Map.prototype.get",!0),R8=Kc("Map.prototype.set",!0),k8=Kc("Map.prototype.has",!0),N8=Kc("Map.prototype.delete",!0),L8=Kc("Map.prototype.size",!0),QP=!!hE&&function(){var e,t={assert:function(r){if(!t.has(r))throw new O8("Side channel does not contain "+x8(r))},delete:function(r){if(e){var i=N8(e,r);return L8(e)===0&&(e=void 0),i}return!1},get:function(r){if(e)return P8(e,r)},has:function(r){return e?k8(e,r):!1},set:function(r,i){e||(e=new hE),R8(e,r,i)}};return t},I8=D0,Jh=JP,A8=Wh,Iu=QP,M8=Ba,Po=I8("%WeakMap%",!0),D8=Jh("WeakMap.prototype.get",!0),F8=Jh("WeakMap.prototype.set",!0),z8=Jh("WeakMap.prototype.has",!0),$8=Jh("WeakMap.prototype.delete",!0),j8=Po?function(){var e,t,r={assert:function(i){if(!r.has(i))throw new M8("Side channel does not contain "+A8(i))},delete:function(i){if(Po&&i&&(typeof i=="object"||typeof i=="function")){if(e)return $8(e,i)}else if(Iu&&t)return t.delete(i);return!1},get:function(i){return Po&&i&&(typeof i=="object"||typeof i=="function")&&e?D8(e,i):t&&t.get(i)},has:function(i){return Po&&i&&(typeof i=="object"||typeof i=="function")&&e?z8(e,i):!!t&&t.has(i)},set:function(i,s){Po&&i&&(typeof i=="object"||typeof i=="function")?(e||(e=new Po),F8(e,i,s)):Iu&&(t||(t=Iu()),t.set(i,s))}};return r}:Iu,q8=Ba,B8=Wh,U8=u6,H8=QP,V8=j8,W8=V8||H8||U8,G8=function(){var e,t={assert:function(r){if(!t.has(r))throw new q8("Side channel does not contain "+B8(r))},delete:function(r){return!!e&&e.delete(r)},get:function(r){return e&&e.get(r)},has:function(r){return!!e&&e.has(r)},set:function(r,i){e||(e=W8()),e.set(r,i)}};return t},K8=String.prototype.replace,J8=/%20/g,Hp={RFC1738:"RFC1738",RFC3986:"RFC3986"},F0={default:Hp.RFC3986,formatters:{RFC1738:function(n){return K8.call(n,J8,"+")},RFC3986:function(n){return String(n)}},RFC1738:Hp.RFC1738,RFC3986:Hp.RFC3986},Q8=F0,Vp=Object.prototype.hasOwnProperty,Is=Array.isArray,fr=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),X8=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Is(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);t.obj[t.prop]=i}}},XP=function(e,t){for(var r=t&&t.plainObjects?{__proto__:null}:{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},Y8=function n(e,t,r){if(!t)return e;if(typeof t!="object"&&typeof t!="function"){if(Is(e))e.push(t);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Vp.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return Is(e)&&!Is(t)&&(i=XP(e,r)),Is(e)&&Is(t)?(t.forEach(function(s,o){if(Vp.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=n(a,s,r):e.push(s)}else e[o]=s}),e):Object.keys(t).reduce(function(s,o){var a=t[o];return Vp.call(s,o)?s[o]=n(s[o],a,r):s[o]=a,s},i)},Z8=function(e,t){return Object.keys(t).reduce(function(r,i){return r[i]=t[i],r},e)},eV=function(n,e,t){var r=n.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Wp=1024,tV=function(e,t,r,i,s){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});for(var a="",l=0;l<o.length;l+=Wp){for(var c=o.length>=Wp?o.slice(l,l+Wp):o,u=[],d=0;d<c.length;++d){var h=c.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===Q8.RFC1738&&(h===40||h===41)){u[u.length]=c.charAt(d);continue}if(h<128){u[u.length]=fr[h];continue}if(h<2048){u[u.length]=fr[192|h>>6]+fr[128|h&63];continue}if(h<55296||h>=57344){u[u.length]=fr[224|h>>12]+fr[128|h>>6&63]+fr[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|c.charCodeAt(d)&1023),u[u.length]=fr[240|h>>18]+fr[128|h>>12&63]+fr[128|h>>6&63]+fr[128|h&63]}a+=u.join("")}return a},nV=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],o=s.obj[s.prop],a=Object.keys(o),l=0;l<a.length;++l){var c=a[l],u=o[c];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(t.push({obj:o,prop:c}),r.push(u))}return X8(t),e},rV=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},iV=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},sV=function(e,t){return[].concat(e,t)},oV=function(e,t){if(Is(e)){for(var r=[],i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)},YP={arrayToObject:XP,assign:Z8,combine:sV,compact:nV,decode:eV,encode:tV,isBuffer:iV,isRegExp:rV,maybeMap:oV,merge:Y8},ZP=G8,ad=YP,Ul=F0,aV=Object.prototype.hasOwnProperty,eR={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},yr=Array.isArray,lV=Array.prototype.push,tR=function(n,e){lV.apply(n,yr(e)?e:[e])},cV=Date.prototype.toISOString,fE=Ul.default,ht={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ad.encode,encodeValuesOnly:!1,filter:void 0,format:fE,formatter:Ul.formatters[fE],indices:!1,serializeDate:function(e){return cV.call(e)},skipNulls:!1,strictNullHandling:!1},uV=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Gp={},dV=function n(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g,S,m,v){for(var y=e,b=v,w=0,T=!1;(b=b.get(Gp))!==void 0&&!T;){var E=b.get(e);if(w+=1,typeof E<"u"){if(E===w)throw new RangeError("Cyclic object value");T=!0}typeof b.get(Gp)>"u"&&(w=0)}if(typeof u=="function"?y=u(t,y):y instanceof Date?y=f(y):r==="comma"&&yr(y)&&(y=ad.maybeMap(y,function(x){return x instanceof Date?f(x):x})),y===null){if(o)return c&&!S?c(t,ht.encoder,m,"key",p):t;y=""}if(uV(y)||ad.isBuffer(y)){if(c){var O=S?t:c(t,ht.encoder,m,"key",p);return[g(O)+"="+g(c(y,ht.encoder,m,"value",p))]}return[g(t)+"="+g(String(y))]}var A=[];if(typeof y>"u")return A;var F;if(r==="comma"&&yr(y))S&&c&&(y=ad.maybeMap(y,c)),F=[{value:y.length>0?y.join(",")||null:void 0}];else if(yr(u))F=u;else{var X=Object.keys(y);F=d?X.sort(d):X}var z=l?String(t).replace(/\./g,"%2E"):String(t),Z=i&&yr(y)&&y.length===1?z+"[]":z;if(s&&yr(y)&&y.length===0)return Z+"[]";for(var W=0;W<F.length;++W){var C=F[W],k=typeof C=="object"&&C&&typeof C.value<"u"?C.value:y[C];if(!(a&&k===null)){var V=h&&l?String(C).replace(/\./g,"%2E"):String(C),I=yr(y)?typeof r=="function"?r(Z,V):Z:Z+(h?"."+V:"["+V+"]");v.set(e,w);var U=ZP();U.set(Gp,v),tR(A,n(k,I,r,i,s,o,a,l,r==="comma"&&S&&yr(y)?null:c,u,d,h,f,p,g,S,m,U))}}return A},hV=function(e){if(!e)return ht;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||ht.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=Ul.default;if(typeof e.format<"u"){if(!aV.call(Ul.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=Ul.formatters[r],s=ht.filter;(typeof e.filter=="function"||yr(e.filter))&&(s=e.filter);var o;if(e.arrayFormat in eR?o=e.arrayFormat:"indices"in e?o=e.indices?"indices":"repeat":o=ht.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:ht.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:ht.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:ht.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:ht.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?ht.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:ht.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:ht.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:ht.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:ht.encodeValuesOnly,filter:s,format:r,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:ht.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:ht.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:ht.strictNullHandling}},fV=function(n,e){var t=n,r=hV(e),i,s;typeof r.filter=="function"?(s=r.filter,t=s("",t)):yr(r.filter)&&(s=r.filter,i=s);var o=[];if(typeof t!="object"||t===null)return"";var a=eR[r.arrayFormat],l=a==="comma"&&r.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);for(var c=ZP(),u=0;u<i.length;++u){var d=i[u],h=t[d];r.skipNulls&&h===null||tR(o,dV(h,d,a,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}var f=o.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},so=YP,lv=Object.prototype.hasOwnProperty,pE=Array.isArray,et={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:so.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},pV=function(n){return n.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},nR=function(n,e,t){if(n&&typeof n=="string"&&e.comma&&n.indexOf(",")>-1)return n.split(",");if(e.throwOnLimitExceeded&&t>=e.arrayLimit)throw new RangeError("Array limit exceeded. Only "+e.arrayLimit+" element"+(e.arrayLimit===1?"":"s")+" allowed in an array.");return n},mV="utf8=%26%2310003%3B",gV="utf8=%E2%9C%93",vV=function(e,t){var r={__proto__:null},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;i=i.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=i.split(t.delimiter,t.throwOnLimitExceeded?s+1:s);if(t.throwOnLimitExceeded&&o.length>s)throw new RangeError("Parameter limit exceeded. Only "+s+" parameter"+(s===1?"":"s")+" allowed.");var a=-1,l,c=t.charset;if(t.charsetSentinel)for(l=0;l<o.length;++l)o[l].indexOf("utf8=")===0&&(o[l]===gV?c="utf-8":o[l]===mV&&(c="iso-8859-1"),a=l,l=o.length);for(l=0;l<o.length;++l)if(l!==a){var u=o[l],d=u.indexOf("]="),h=d===-1?u.indexOf("="):d+1,f,p;h===-1?(f=t.decoder(u,et.decoder,c,"key"),p=t.strictNullHandling?null:""):(f=t.decoder(u.slice(0,h),et.decoder,c,"key"),p=so.maybeMap(nR(u.slice(h+1),t,pE(r[f])?r[f].length:0),function(S){return t.decoder(S,et.decoder,c,"value")})),p&&t.interpretNumericEntities&&c==="iso-8859-1"&&(p=pV(String(p))),u.indexOf("[]=")>-1&&(p=pE(p)?[p]:p);var g=lv.call(r,f);g&&t.duplicates==="combine"?r[f]=so.combine(r[f],p):(!g||t.duplicates==="last")&&(r[f]=p)}return r},yV=function(n,e,t,r){var i=0;if(n.length>0&&n[n.length-1]==="[]"){var s=n.slice(0,-1).join("");i=Array.isArray(e)&&e[s]?e[s].length:0}for(var o=r?e:nR(e,t,i),a=n.length-1;a>=0;--a){var l,c=n[a];if(c==="[]"&&t.parseArrays)l=t.allowEmptyArrays&&(o===""||t.strictNullHandling&&o===null)?[]:so.combine([],o);else{l=t.plainObjects?{__proto__:null}:{};var u=c.charAt(0)==="["&&c.charAt(c.length-1)==="]"?c.slice(1,-1):c,d=t.decodeDotInKeys?u.replace(/%2E/g,"."):u,h=parseInt(d,10);!t.parseArrays&&d===""?l={0:o}:!isNaN(h)&&c!==d&&String(h)===d&&h>=0&&t.parseArrays&&h<=t.arrayLimit?(l=[],l[h]=o):d!=="__proto__"&&(l[d]=o)}o=l}return o},SV=function(e,t,r,i){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=r.depth>0&&o.exec(s),c=l?s.slice(0,l.index):s,u=[];if(c){if(!r.plainObjects&&lv.call(Object.prototype,c)&&!r.allowPrototypes)return;u.push(c)}for(var d=0;r.depth>0&&(l=a.exec(s))!==null&&d<r.depth;){if(d+=1,!r.plainObjects&&lv.call(Object.prototype,l[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(l[1])}if(l){if(r.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");u.push("["+s.slice(l.index)+"]")}return yV(u,t,r,i)}},bV=function(e){if(!e)return et;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof e.throwOnLimitExceeded<"u"&&typeof e.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var t=typeof e.charset>"u"?et.charset:e.charset,r=typeof e.duplicates>"u"?et.duplicates:e.duplicates;if(r!=="combine"&&r!=="first"&&r!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var i=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:et.allowDots:!!e.allowDots;return{allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:et.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:et.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:et.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:et.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:et.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:et.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:et.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:et.decoder,delimiter:typeof e.delimiter=="string"||so.isRegExp(e.delimiter)?e.delimiter:et.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:et.depth,duplicates:r,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:et.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:et.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:et.plainObjects,strictDepth:typeof e.strictDepth=="boolean"?!!e.strictDepth:et.strictDepth,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:et.strictNullHandling,throwOnLimitExceeded:typeof e.throwOnLimitExceeded=="boolean"?e.throwOnLimitExceeded:!1}},wV=function(n,e){var t=bV(e);if(n===""||n===null||typeof n>"u")return t.plainObjects?{__proto__:null}:{};for(var r=typeof n=="string"?vV(n,t):n,i=t.plainObjects?{__proto__:null}:{},s=Object.keys(r),o=0;o<s.length;++o){var a=s[o],l=SV(a,r[a],t,typeof n=="string");i=so.merge(i,l,t)}return t.allowSparse===!0?i:so.compact(i)},CV=fV,EV=wV,_V=F0,TV={formats:_V,parse:EV,stringify:CV},xV=xH;function ri(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var OV=/^([a-z0-9.+-]+:)/i,PV=/:[0-9]*$/,RV=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,kV=["<",">",'"',"`"," ","\r",`
`,"	"],NV=["{","}","|","\\","^","`"].concat(kV),cv=["'"].concat(NV),mE=["%","/","?",";","#"].concat(cv),gE=["/","?","#"],LV=255,vE=/^[+a-z0-9A-Z_-]{0,63}$/,IV=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,AV={javascript:!0,"javascript:":!0},uv={javascript:!0,"javascript:":!0},oa={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},dv=TV;function rR(n,e,t){if(n&&typeof n=="object"&&n instanceof ri)return n;var r=new ri;return r.parse(n,e,t),r}ri.prototype.parse=function(n,e,t){if(typeof n!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof n);var r=n.indexOf("?"),i=r!==-1&&r<n.indexOf("#")?"?":"#",s=n.split(i),o=/\\/g;s[0]=s[0].replace(o,"/"),n=s.join(i);var a=n;if(a=a.trim(),!t&&n.split("#").length===1){var l=RV.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=dv.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=OV.exec(a);if(c){c=c[0];var u=c.toLowerCase();this.protocol=u,a=a.substr(c.length)}if(t||c||a.match(/^\/\/[^@/]+@[^@/]+/)){var d=a.substr(0,2)==="//";d&&!(c&&uv[c])&&(a=a.substr(2),this.slashes=!0)}if(!uv[c]&&(d||c&&!oa[c])){for(var h=-1,f=0;f<gE.length;f++){var p=a.indexOf(gE[f]);p!==-1&&(h===-1||p<h)&&(h=p)}var g,S;h===-1?S=a.lastIndexOf("@"):S=a.lastIndexOf("@",h),S!==-1&&(g=a.slice(0,S),a=a.slice(S+1),this.auth=decodeURIComponent(g)),h=-1;for(var f=0;f<mE.length;f++){var p=a.indexOf(mE[f]);p!==-1&&(h===-1||p<h)&&(h=p)}h===-1&&(h=a.length),this.host=a.slice(0,h),a=a.slice(h),this.parseHost(),this.hostname=this.hostname||"";var m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!m)for(var v=this.hostname.split(/\./),f=0,y=v.length;f<y;f++){var b=v[f];if(b&&!b.match(vE)){for(var w="",T=0,E=b.length;T<E;T++)b.charCodeAt(T)>127?w+="x":w+=b[T];if(!w.match(vE)){var O=v.slice(0,f),A=v.slice(f+1),F=b.match(IV);F&&(O.push(F[1]),A.unshift(F[2])),A.length&&(a="/"+A.join(".")+a),this.hostname=O.join(".");break}}}this.hostname.length>LV?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=xV.toASCII(this.hostname));var X=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+X,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!AV[u])for(var f=0,y=cv.length;f<y;f++){var Z=cv[f];if(a.indexOf(Z)!==-1){var W=encodeURIComponent(Z);W===Z&&(W=escape(Z)),a=a.split(Z).join(W)}}var C=a.indexOf("#");C!==-1&&(this.hash=a.substr(C),a=a.slice(0,C));var k=a.indexOf("?");if(k!==-1?(this.search=a.substr(k),this.query=a.substr(k+1),e&&(this.query=dv.parse(this.query)),a=a.slice(0,k)):e&&(this.search="",this.query={}),a&&(this.pathname=a),oa[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var X=this.pathname||"",V=this.search||"";this.path=X+V}return this.href=this.format(),this};ri.prototype.format=function(){var n=this.auth||"";n&&(n=encodeURIComponent(n),n=n.replace(/%3A/i,":"),n+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=n+this.host:this.hostname&&(i=n+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=dv.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||oa[e])&&i!==!1?(i="//"+(i||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):i||(i=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+i+t+o+r};ri.prototype.resolve=function(n){return this.resolveObject(rR(n,!1,!0)).format()};ri.prototype.resolveObject=function(n){if(typeof n=="string"){var e=new ri;e.parse(n,!1,!0),n=e}for(var t=new ri,r=Object.keys(this),i=0;i<r.length;i++){var s=r[i];t[s]=this[s]}if(t.hash=n.hash,n.href==="")return t.href=t.format(),t;if(n.slashes&&!n.protocol){for(var o=Object.keys(n),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(t[l]=n[l])}return oa[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(n.protocol&&n.protocol!==t.protocol){if(!oa[n.protocol]){for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];t[d]=n[d]}return t.href=t.format(),t}if(t.protocol=n.protocol,!n.host&&!uv[n.protocol]){for(var y=(n.pathname||"").split("/");y.length&&!(n.host=y.shift()););n.host||(n.host=""),n.hostname||(n.hostname=""),y[0]!==""&&y.unshift(""),y.length<2&&y.unshift(""),t.pathname=y.join("/")}else t.pathname=n.pathname;if(t.search=n.search,t.query=n.query,t.host=n.host||"",t.auth=n.auth,t.hostname=n.hostname||n.host,t.port=n.port,t.pathname||t.search){var h=t.pathname||"",f=t.search||"";t.path=h+f}return t.slashes=t.slashes||n.slashes,t.href=t.format(),t}var p=t.pathname&&t.pathname.charAt(0)==="/",g=n.host||n.pathname&&n.pathname.charAt(0)==="/",S=g||p||t.host&&n.pathname,m=S,v=t.pathname&&t.pathname.split("/")||[],y=n.pathname&&n.pathname.split("/")||[],b=t.protocol&&!oa[t.protocol];if(b&&(t.hostname="",t.port=null,t.host&&(v[0]===""?v[0]=t.host:v.unshift(t.host)),t.host="",n.protocol&&(n.hostname=null,n.port=null,n.host&&(y[0]===""?y[0]=n.host:y.unshift(n.host)),n.host=null),S=S&&(y[0]===""||v[0]==="")),g)t.host=n.host||n.host===""?n.host:t.host,t.hostname=n.hostname||n.hostname===""?n.hostname:t.hostname,t.search=n.search,t.query=n.query,v=y;else if(y.length)v||(v=[]),v.pop(),v=v.concat(y),t.search=n.search,t.query=n.query;else if(n.search!=null){if(b){t.host=v.shift(),t.hostname=t.host;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return t.search=n.search,t.query=n.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!v.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var T=v.slice(-1)[0],E=(t.host||n.host||v.length>1)&&(T==="."||T==="..")||T==="",O=0,A=v.length;A>=0;A--)T=v[A],T==="."?v.splice(A,1):T===".."?(v.splice(A,1),O++):O&&(v.splice(A,1),O--);if(!S&&!m)for(;O--;O)v.unshift("..");S&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),E&&v.join("/").substr(-1)!=="/"&&v.push("");var F=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(b){t.hostname=F?"":v.length?v.shift():"",t.host=t.hostname;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return S=S||t.host&&v.length,S&&!F&&v.unshift(""),v.length>0?t.pathname=v.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=n.auth||t.auth,t.slashes=t.slashes||n.slashes,t.href=t.format(),t};ri.prototype.parseHost=function(){var n=this.host,e=PV.exec(n);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),n=n.substr(0,n.length-e.length)),n&&(this.hostname=n)};var hv=rR;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Nn;(function(n){n.genericError="genericError",n.genericNetworkError="genericNetworkError",n.authorizationError="authorizationError",n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",n.throttlingError="throttlingError",n.offlineError="offlineError",n.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",n.writeError="writeError",n.fetchFailure="fetchFailure",n.incorrectServerResponse="incorrectServerResponse",n.fileOverwrittenInStorage="fileOverwrittenInStorage",n.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",n.locationRedirection="locationRedirection"})(Nn||(Nn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var _a;(function(n){n[n.NoCaching=0]="NoCaching",n[n.Prefetch=1]="Prefetch"})(_a||(_a={}));var Ta;(function(n){n.summarizingClient="fluid-client-summarizer",n.createNew="createNew"})(Ta||(Ta={}));var z0={exports:{}},iR=function(e,t){return function(){return e.apply(t,arguments)}},MV=iR,$0=Object.prototype.toString,j0=function(n){return function(e){var t=$0.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())}}(Object.create(null));function ms(n){return n=n.toLowerCase(),function(t){return j0(t)===n}}function Qh(n){return Array.isArray(n)}function fv(n){return typeof n>"u"}function DV(n){return n!==null&&!fv(n)&&n.constructor!==null&&!fv(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}var sR=ms("ArrayBuffer");function FV(n){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&sR(n.buffer),e}function zV(n){return typeof n=="string"}function oR(n){return typeof n=="number"}function aR(n){return n!==null&&typeof n=="object"}function ld(n){if(j0(n)!=="object")return!1;var e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}function $V(n){return n&&Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}var jV=ms("Date"),qV=ms("File"),BV=ms("Blob"),UV=ms("FileList");function q0(n){return $0.call(n)==="[object Function]"}function HV(n){return aR(n)&&q0(n.pipe)}function VV(n){var e="[object FormData]";return n&&(typeof FormData=="function"&&n instanceof FormData||$0.call(n)===e||q0(n.toString)&&n.toString()===e)}var WV=ms("URLSearchParams");function GV(n){return n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function KV(){var n;return typeof navigator<"u"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window<"u"&&typeof document<"u"}function B0(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),Qh(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.call(null,n[i],i,n)}function pv(){var n={};function e(i,s){ld(n[s])&&ld(i)?n[s]=pv(n[s],i):ld(i)?n[s]=pv({},i):Qh(i)?n[s]=i.slice():n[s]=i}for(var t=0,r=arguments.length;t<r;t++)B0(arguments[t],e);return n}function JV(n,e,t){return B0(e,function(i,s){t&&typeof i=="function"?n[s]=MV(i,t):n[s]=i}),n}function QV(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n}function XV(n,e,t,r){n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,t&&Object.assign(n.prototype,t)}function YV(n,e,t,r){var i,s,o,a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&Object.getPrototypeOf(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e}function ZV(n,e,t){n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return r!==-1&&r===t}function eW(n){if(!n)return null;if(Qh(n))return n;var e=n.length;if(!oR(e))return null;for(var t=new Array(e);e-- >0;)t[e]=n[e];return t}var tW=function(n){return function(e){return n&&e instanceof n}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array));function nW(n,e){for(var t=n&&n[Symbol.iterator],r=t.call(n),i;(i=r.next())&&!i.done;){var s=i.value;e.call(n,s[0],s[1])}}function rW(n,e){for(var t,r=[];(t=n.exec(e))!==null;)r.push(t);return r}var iW=ms("HTMLFormElement"),sW=function(e){return function(t,r){return e.call(t,r)}}(Object.prototype.hasOwnProperty),vt={isArray:Qh,isArrayBuffer:sR,isBuffer:DV,isFormData:VV,isArrayBufferView:FV,isString:zV,isNumber:oR,isObject:aR,isPlainObject:ld,isEmptyObject:$V,isUndefined:fv,isDate:jV,isFile:qV,isBlob:BV,isFunction:q0,isStream:HV,isURLSearchParams:WV,isStandardBrowserEnv:KV,forEach:B0,merge:pv,extend:JV,trim:GV,stripBOM:QV,inherits:XV,toFlatObject:YV,kindOf:j0,kindOfTest:ms,endsWith:ZV,toArray:eW,isTypedArray:tW,isFileList:UV,forEachEntry:nW,matchAll:rW,isHTMLForm:iW,hasOwnProperty:sW},lR=vt;function xa(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}lR.inherits(xa,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var cR=xa.prototype,uR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(function(n){uR[n]={value:n}});Object.defineProperties(xa,uR);Object.defineProperty(cR,"isAxiosError",{value:!0});xa.from=function(n,e,t,r,i,s){var o=Object.create(cR);return lR.toFlatObject(n,o,function(l){return l!==Error.prototype}),xa.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};var vo=xa,oW=typeof self=="object"?self.FormData:window.FormData,aW=oW,Ie=vt,lW=vo,cW=aW;function mv(n){return Ie.isPlainObject(n)||Ie.isArray(n)}function dR(n){return Ie.endsWith(n,"[]")?n.slice(0,-2):n}function yE(n,e,t){return n?n.concat(e).map(function(i,s){return i=dR(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function uW(n){return Ie.isArray(n)&&!n.some(mv)}var dW=Ie.toFlatObject(Ie,{},null,function(e){return/^is[A-Z]/.test(e)});function hW(n){return n&&Ie.isFunction(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator]}function fW(n,e,t){if(!Ie.isObject(n))throw new TypeError("target must be an object");e=e||new(cW||FormData),t=Ie.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,S){return!Ie.isUndefined(S[g])});var r=t.metaTokens,i=t.visitor||u,s=t.dots,o=t.indexes,a=t.Blob||typeof Blob<"u"&&Blob,l=a&&hW(e);if(!Ie.isFunction(i))throw new TypeError("visitor must be a function");function c(p){if(p===null)return"";if(Ie.isDate(p))return p.toISOString();if(!l&&Ie.isBlob(p))throw new lW("Blob is not supported. Use a Buffer instead.");return Ie.isArrayBuffer(p)||Ie.isTypedArray(p)?l&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function u(p,g,S){var m=p;if(p&&!S&&typeof p=="object"){if(Ie.endsWith(g,"{}"))g=r?g:g.slice(0,-2),p=JSON.stringify(p);else if(Ie.isArray(p)&&uW(p)||Ie.isFileList(p)||Ie.endsWith(g,"[]")&&(m=Ie.toArray(p)))return g=dR(g),m.forEach(function(y,b){!Ie.isUndefined(y)&&e.append(o===!0?yE([g],b,s):o===null?g:g+"[]",c(y))}),!1}return mv(p)?!0:(e.append(yE(S,g,s),c(p)),!1)}var d=[],h=Object.assign(dW,{defaultVisitor:u,convertValue:c,isVisitable:mv});function f(p,g){if(!Ie.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(p),Ie.forEach(p,function(m,v){var y=!Ie.isUndefined(m)&&i.call(e,m,Ie.isString(v)?v.trim():v,g,h);y===!0&&f(m,g?g.concat(v):[v])}),d.pop()}}if(!Ie.isObject(n))throw new TypeError("data must be an object");return f(n),e}var Xh=fW,pW=Xh;function SE(n){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'\(\)~]|%20|%00/g,function(r){return e[r]})}function hR(n,e){this._pairs=[],n&&pW(n,this,e)}var fR=hR.prototype;fR.append=function(e,t){this._pairs.push([e,t])};fR.toString=function(e){var t=e?function(r){return e.call(this,r,SE)}:SE;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var pR=hR,mW=vt,gW=pR;function vW(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var mR=function(e,t,r){if(!t)return e;var i=e.indexOf("#");i!==-1&&(e=e.slice(0,i));var s=r&&r.encode||vW,o=r&&r.serialize,a;return o?a=o(t,r):a=mW.isURLSearchParams(t)?t.toString():new gW(t,r).toString(s),a&&(e+=(e.indexOf("?")===-1?"?":"&")+a),e},yW=vt;function Jc(){this.handlers=[]}Jc.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};Jc.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Jc.prototype.clear=function(){this.handlers&&(this.handlers=[])};Jc.prototype.forEach=function(e){yW.forEach(this.handlers,function(r){r!==null&&e(r)})};var SW=Jc,bW=vt,gR=function(e,t){bW.forEach(e,function(i,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[s])})},vR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wW=pR,CW=typeof URLSearchParams<"u"?URLSearchParams:wW,EW=FormData,_W={isBrowser:!0,classes:{URLSearchParams:CW,FormData:EW,Blob},protocols:["http","https","file","blob","url","data"]},U0=_W,TW=vt,xW=Xh,bE=U0,OW=function(e,t){return xW(e,new bE.classes.URLSearchParams,Object.assign({visitor:function(r,i,s,o){return bE.isNode&&TW.isBuffer(r)?(this.append(i,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))},Ti=vt;function PW(n){return Ti.matchAll(/\w+|\[(\w*)]/g,n).map(function(e){return e[0]==="[]"?"":e[1]||e[0]})}function RW(n){var e={},t=Object.keys(n),r,i=t.length,s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function kW(n){function e(r,i,s,o){var a=r[o++],l=Number.isFinite(+a),c=o>=r.length;if(a=!a&&Ti.isArray(s)?s.length:a,c)return Ti.hasOwnProperty(s,a)?s[a]=[s[a],i]:s[a]=i,!l;(!s[a]||!Ti.isObject(s[a]))&&(s[a]=[]);var u=e(r,i,s[a],o);return u&&Ti.isArray(s[a])&&(s[a]=RW(s[a])),!l}if(Ti.isFormData(n)&&Ti.isFunction(n.entries)){var t={};return Ti.forEachEntry(n,function(r,i){e(PW(r),i,t,0)}),t}return null}var yR=kW,Kp,wE;function NW(){if(wE)return Kp;wE=1;var n=vo;return Kp=function(t,r,i){var s=i.config.validateStatus;!i.status||!s||s(i.status)?t(i):r(new n("Request failed with status code "+i.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))},Kp}var Jp,CE;function LW(){if(CE)return Jp;CE=1;var n=vt;return Jp=n.isStandardBrowserEnv()?function(){return{write:function(r,i,s,o,a,l){var c=[];c.push(r+"="+encodeURIComponent(i)),n.isNumber(s)&&c.push("expires="+new Date(s).toGMTString()),n.isString(o)&&c.push("path="+o),n.isString(a)&&c.push("domain="+a),l===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Jp}var IW=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},AW=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},MW=IW,DW=AW,SR=function(e,t){return e&&!MW(t)?DW(e,t):t},Qp,EE;function FW(){if(EE)return Qp;EE=1;var n=vt,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Qp=function(r){var i={},s,o,a;return r&&n.forEach(r.split(`
`),function(c){if(a=c.indexOf(":"),s=n.trim(c.slice(0,a)).toLowerCase(),o=n.trim(c.slice(a+1)),s){if(i[s]&&e.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},Qp}var Xp,_E;function zW(){if(_E)return Xp;_E=1;var n=vt;return Xp=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),i;function s(o){var a=o;return t&&(r.setAttribute("href",a),a=r.href),r.setAttribute("href",a),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=s(window.location.href),function(a){var l=n.isString(a)?s(a):a;return l.protocol===i.protocol&&l.host===i.host}}():function(){return function(){return!0}}(),Xp}var Yp,TE;function Yh(){if(TE)return Yp;TE=1;var n=vo,e=vt;function t(r,i,s){n.call(this,r??"canceled",n.ERR_CANCELED,i,s),this.name="CanceledError"}return e.inherits(t,n,{__CANCEL__:!0}),Yp=t,Yp}var Zp,xE;function $W(){return xE||(xE=1,Zp=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}),Zp}var em,OE;function PE(){if(OE)return em;OE=1;var n=vt,e=NW(),t=LW(),r=mR,i=SR,s=FW(),o=zW(),a=vR,l=vo,c=Yh(),u=$W(),d=U0;return em=function(f){return new Promise(function(g,S){var m=f.data,v=f.headers,y=f.responseType,b=f.withXSRFToken,w;function T(){f.cancelToken&&f.cancelToken.unsubscribe(w),f.signal&&f.signal.removeEventListener("abort",w)}n.isFormData(m)&&n.isStandardBrowserEnv()&&delete v["Content-Type"];var E=new XMLHttpRequest;if(f.auth){var O=f.auth.username||"",A=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";v.Authorization="Basic "+btoa(O+":"+A)}var F=i(f.baseURL,f.url);E.open(f.method.toUpperCase(),r(F,f.params,f.paramsSerializer),!0),E.timeout=f.timeout;function X(){if(E){var W="getAllResponseHeaders"in E?s(E.getAllResponseHeaders()):null,C=!y||y==="text"||y==="json"?E.responseText:E.response,k={data:C,status:E.status,statusText:E.statusText,headers:W,config:f,request:E};e(function(I){g(I),T()},function(I){S(I),T()},k),E=null}}if("onloadend"in E?E.onloadend=X:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(X)},E.onabort=function(){E&&(S(new l("Request aborted",l.ECONNABORTED,f,E)),E=null)},E.onerror=function(){S(new l("Network Error",l.ERR_NETWORK,f,E)),E=null},E.ontimeout=function(){var C=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",k=f.transitional||a;f.timeoutErrorMessage&&(C=f.timeoutErrorMessage),S(new l(C,k.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,f,E)),E=null},n.isStandardBrowserEnv()&&(b&&n.isFunction(b)&&(b=b(f)),b||b!==!1&&o(F))){var z=f.xsrfHeaderName&&f.xsrfCookieName&&t.read(f.xsrfCookieName);z&&(v[f.xsrfHeaderName]=z)}"setRequestHeader"in E&&n.forEach(v,function(C,k){typeof m>"u"&&k.toLowerCase()==="content-type"?delete v[k]:E.setRequestHeader(k,C)}),n.isUndefined(f.withCredentials)||(E.withCredentials=!!f.withCredentials),y&&y!=="json"&&(E.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&E.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&E.upload&&E.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(w=function(W){E&&(S(!W||W.type?new c(null,f,E):W),E.abort(),E=null)},f.cancelToken&&f.cancelToken.subscribe(w),f.signal&&(f.signal.aborted?w():f.signal.addEventListener("abort",w))),!m&&m!==!1&&m!==0&&m!==""&&(m=null);var Z=u(F);if(Z&&d.protocols.indexOf(Z)===-1){S(new l("Unsupported protocol "+Z+":",l.ERR_BAD_REQUEST,f));return}E.send(m)})},em}var ft=vt,RE=gR,kE=vo,jW=vR,qW=Xh,BW=OW,NE=U0,UW=yR,HW={"Content-Type":"application/x-www-form-urlencoded"};function LE(n,e){!ft.isUndefined(n)&&ft.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}function VW(){var n;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(n=PE()),n}function WW(n,e,t){if(ft.isString(n))try{return(e||JSON.parse)(n),ft.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var Zh={transitional:jW,adapter:VW(),transformRequest:[function(e,t){RE(t,"Accept"),RE(t,"Content-Type");var r=t&&t["Content-Type"]||"",i=r.indexOf("application/json")>-1,s=ft.isObject(e);s&&ft.isHTMLForm(e)&&(e=new FormData(e));var o=ft.isFormData(e);if(o)return i?JSON.stringify(UW(e)):e;if(ft.isArrayBuffer(e)||ft.isBuffer(e)||ft.isStream(e)||ft.isFile(e)||ft.isBlob(e))return e;if(ft.isArrayBufferView(e))return e.buffer;if(ft.isURLSearchParams(e))return LE(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var a;if(s){if(r.indexOf("application/x-www-form-urlencoded")!==-1)return BW(e,this.formSerializer).toString();if((a=ft.isFileList(e))||r.indexOf("multipart/form-data")>-1){var l=this.env&&this.env.FormData;return qW(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||i?(LE(t,"application/json"),WW(e)):e}],transformResponse:[function(e){var t=this.transitional||Zh.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&ft.isString(e)&&(r&&!this.responseType||i)){var s=t&&t.silentJSONParsing,o=!s&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?kE.from(a,kE.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:NE.classes.FormData,Blob:NE.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ft.forEach(["delete","get","head"],function(e){Zh.headers[e]={}});ft.forEach(["post","put","patch"],function(e){Zh.headers[e]=ft.merge(HW)});var H0=Zh,GW=vt,KW=H0,JW=function(e,t,r,i){var s=this||KW;return GW.forEach(i,function(a){e=a.call(s,e,t,r)}),e},tm,IE;function bR(){return IE||(IE=1,tm=function(e){return!!(e&&e.__CANCEL__)}),tm}var AE=vt,nm=JW,QW=bR(),XW=H0,YW=Yh(),ME=gR;function rm(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new YW}var ZW=function(e){rm(e),e.headers=e.headers||{},e.data=nm.call(e,e.data,e.headers,null,e.transformRequest),ME(e.headers,"Accept"),ME(e.headers,"Content-Type"),e.headers=AE.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),AE.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var t=e.adapter||XW.adapter;return t(e).then(function(i){return rm(e),i.data=nm.call(e,i.data,i.headers,i.status,e.transformResponse),i},function(i){return QW(i)||(rm(e),i&&i.response&&(i.response.data=nm.call(e,i.response.data,i.response.headers,i.response.status,e.transformResponse))),Promise.reject(i)})},Vt=vt,wR=function(e,t){t=t||{};var r={};function i(u,d){return Vt.isPlainObject(u)&&Vt.isPlainObject(d)?Vt.merge(u,d):Vt.isEmptyObject(d)?Vt.merge({},u):Vt.isPlainObject(d)?Vt.merge({},d):Vt.isArray(d)?d.slice():d}function s(u){if(Vt.isUndefined(t[u])){if(!Vt.isUndefined(e[u]))return i(void 0,e[u])}else return i(e[u],t[u])}function o(u){if(!Vt.isUndefined(t[u]))return i(void 0,t[u])}function a(u){if(Vt.isUndefined(t[u])){if(!Vt.isUndefined(e[u]))return i(void 0,e[u])}else return i(void 0,t[u])}function l(u){if(u in t)return i(e[u],t[u]);if(u in e)return i(void 0,e[u])}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l};return Vt.forEach(Object.keys(e).concat(Object.keys(t)),function(d){var h=c[d]||s,f=h(d);Vt.isUndefined(f)&&h!==l||(r[d]=f)}),r},im,DE;function CR(){return DE||(DE=1,im={version:"0.28.1"}),im}var e5=CR().version,ki=vo,V0={};["object","boolean","number","function","string","symbol"].forEach(function(n,e){V0[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var FE={};V0.transitional=function(e,t,r){function i(s,o){return"[Axios v"+e5+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return function(s,o,a){if(e===!1)throw new ki(i(o," has been removed"+(t?" in "+t:"")),ki.ERR_DEPRECATED);return t&&!FE[o]&&(FE[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function t5(n,e,t){if(typeof n!="object")throw new ki("options must be an object",ki.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(n),i=r.length;i-- >0;){var s=r[i],o=e[s];if(o){var a=n[s],l=a===void 0||o(a,s,n);if(l!==!0)throw new ki("option "+s+" must be "+l,ki.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ki("Unknown option "+s,ki.ERR_BAD_OPTION)}}var n5={assertOptions:t5,validators:V0},W0=vt,r5=mR,zE=SW,$E=ZW,ef=wR,i5=SR,gv=n5,_i=gv.validators;function Oa(n){this.defaults=n,this.interceptors={request:new zE,response:new zE}}Oa.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ef(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;r!==void 0&&gv.assertOptions(r,{silentJSONParsing:_i.transitional(_i.boolean),forcedJSONParsing:_i.transitional(_i.boolean),clarifyTimeoutError:_i.transitional(_i.boolean)},!1);var i=t.paramsSerializer;i!==void 0&&gv.assertOptions(i,{encode:_i.function,serialize:_i.function},!0),W0.isFunction(i)&&(t.paramsSerializer={serialize:i});var s=[],o=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(o=o&&p.synchronous,s.unshift(p.fulfilled,p.rejected))});var a=[];this.interceptors.response.forEach(function(p){a.push(p.fulfilled,p.rejected)});var l;if(!o){var c=[$E,void 0];for(Array.prototype.unshift.apply(c,s),c=c.concat(a),l=Promise.resolve(t);c.length;)l=l.then(c.shift(),c.shift());return l}for(var u=t;s.length;){var d=s.shift(),h=s.shift();try{u=d(u)}catch(f){h(f);break}}try{l=$E(u)}catch(f){return Promise.reject(f)}for(;a.length;)l=l.then(a.shift(),a.shift());return l};Oa.prototype.getUri=function(e){e=ef(this.defaults,e);var t=i5(e.baseURL,e.url);return r5(t,e.params,e.paramsSerializer)};W0.forEach(["delete","get","head","options"],function(e){Oa.prototype[e]=function(t,r){return this.request(ef(r||{},{method:e,url:t,data:(r||{}).data}))}});W0.forEach(["post","put","patch"],function(e){function t(r){return function(s,o,a){return this.request(ef(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Oa.prototype[e]=t(),Oa.prototype[e+"Form"]=t(!0)});var s5=Oa,sm,jE;function o5(){if(jE)return sm;jE=1;var n=Yh();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(o){r=o});var i=this;this.promise.then(function(s){if(i._listeners){for(var o=i._listeners.length;o-- >0;)i._listeners[o](s);i._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(l){i.subscribe(l),o=l}).then(s);return a.cancel=function(){i.unsubscribe(o)},a},t(function(o,a,l){i.reason||(i.reason=new n(o,a,l),r(i.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(this._listeners){var i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}},e.source=function(){var r,i=new e(function(o){r=o});return{token:i,cancel:r}},sm=e,sm}var om,qE;function a5(){return qE||(qE=1,om=function(e){return function(r){return e.apply(null,r)}}),om}var am,BE;function l5(){if(BE)return am;BE=1;var n=vt;return am=function(t){return n.isObject(t)&&t.isAxiosError===!0},am}var vv=vt,c5=iR,cd=s5,u5=wR,d5=H0,h5=yR;function ER(n){var e=new cd(n),t=c5(cd.prototype.request,e);return vv.extend(t,cd.prototype,e),vv.extend(t,e),t.create=function(i){return ER(u5(n,i))},t}var en=ER(d5);en.Axios=cd;en.CanceledError=Yh();en.CancelToken=o5();en.isCancel=bR();en.VERSION=CR().version;en.toFormData=Xh;en.AxiosError=vo;en.Cancel=en.CanceledError;en.all=function(e){return Promise.all(e)};en.spread=a5();en.isAxiosError=l5();en.formToJSON=function(n){return h5(vv.isHTMLForm(n)?new FormData(n):n)};z0.exports=en;z0.exports.default=en;var f5=z0.exports,p5=f5;const _R=pi(p5);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const G0=n=>(n==null?void 0:n.type)==="fluid";function Fr(n){if(!G0(n))throw new Error(`resolved is not a Fluid url. Type: ${n==null?void 0:n.type}`)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class K0{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach(t=>{this.protocolToDocumentFactoryMap.set(t.protocolName,t)})}static create(e){if(Array.isArray(e)){const t=[];return e.forEach(r=>{const i=r;i.protocolToDocumentFactoryMap!==void 0?t.push(...i.protocolToDocumentFactoryMap.values()):t.push(r)}),t.length===1?t[0]:new K0(t)}return e}async createDocumentService(e,t,r){Fr(e);const i=hv(e.url);if(i.protocol===void 0||i.protocol===null)throw new Error("No protocol provided");const s=this.protocolToDocumentFactoryMap.get(i.protocol);if(s===void 0)throw new Error("Unknown Fluid protocol");return s.createDocumentService(e,t,r)}async createContainer(e,t,r,i){Fr(t);const s=hv(t.url);if(s.protocol===void 0||s.protocol===null)throw new Error("No protocol provided");const o=this.protocolToDocumentFactoryMap.get(s.protocol);if(o===void 0)throw new Error("Unknown Fluid protocol");return o.createContainer(e,t,r,i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function m5(n,e){let t;for(const r of n)if(t=await r.resolve(Object.assign({},e)),t!==void 0)return t}class J0{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?e.length===1?e[0]:new J0(e):e}async resolve(e){return m5(this.urlResolvers,e)}async getAbsoluteUrl(e,t){throw new Error("Not implmented")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var lm,Xi;(function(n){n[n.Offline=0]="Offline",n[n.Online=1]="Online",n[n.Unknown=2]="Unknown"})(Xi||(Xi={}));function Q0(){return typeof navigator=="object"&&navigator!==null&&typeof navigator.onLine=="boolean"?navigator.onLine?Xi.Online:Xi.Offline:Xi.Unknown}class yv extends ae{constructor(e,t,r){super(e,r),this.canRetry=t,this.errorType=Nn.genericNetworkError}}const UE="deltaStreamConnectionForbidden";class tf extends ae{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=tf.errorType,this.canRetry=!1}}tf.errorType=(lm=Nn[UE])!==null&&lm!==void 0?lm:UE;class g5 extends ae{constructor(e,t,r,i){super(e,i,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=r,this.errorType=Nn.authorizationError,this.canRetry=!1}}class v5 extends ae{constructor(e,t,r,i){super(e,i),this.errorType=t,this.canRetry=r}}class nf extends v5{constructor(e,t,r){super(e,t,!1,r),this.errorType=t}}class y5 extends ae{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=Nn.throttlingError,this.canRetry=!0}}const S5=(n,e)=>new nf(n,Nn.writeError,e);function Pa(n,e,t){return e.retryAfterMs!==void 0&&e.canRetry?new y5(n,e.retryAfterMs/1e3,t):new yv(n,e.canRetry,t)}const Qc=n=>(n==null?void 0:n.canRetry)===!0,HE=n=>n==null?void 0:n.retryAfterSeconds,Zd=n=>(n==null?void 0:n.retryAfterSeconds)!==void 0?n.retryAfterSeconds*1e3:void 0;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function mt(n,e){const t=await n.readBlob(e),r=mH(t,"utf8");return JSON.parse(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ud(n,e){return{type:qs.Tree,tree:{".protocol":e,".app":n}}}function b5(n){var e;const t=n.tree.attributes,r=JSON.parse(t.content);return r.term=(e=r.term)!==null&&e!==void 0?e:1,r}function w5(n){const e=n.tree.quorumValues;return JSON.parse(e.content)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Sv(n,e,t){var r,i;const s=Object.assign({},e),o=t.online;if(s.online=typeof o=="string"?o:Xi[Q0()],typeof navigator=="object"&&navigator!==null){const a=navigator,l=(i=(r=a.connection)!==null&&r!==void 0?r:a.mozConnection)!==null&&i!==void 0?i:a.webkitConnection;l!==null&&typeof l=="object"&&(s.connectionType=l.type)}s.category=Qc(t)?"generic":"error",n.sendTelemetryEvent(s,t)}function bv(n){return new Promise(t=>{let r=t,i=n;Q0()===Xi.Offline&&(window==null?void 0:window.addEventListener)!==void 0&&(r=()=>{t(),window.removeEventListener("online",r)},window.addEventListener("online",r,!1),i=Math.max(n,3e4)),setTimeout(r,i)})}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const TR="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const C5=1e4,E5=100;class _5{constructor(e,t,r,i,s,o){this.to=t,this.payloadSize=r,this.logger=i,this.requestCallback=s,this.responseCallback=o,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new xP,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=t!==void 0}get working(){return this.workingState==="working"}get canceled(){return this.workingState==="canceled"}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(e){Re(e>0,258),Re(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){Re(this.to!==void 0,260),Re(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(e===void 0)break;this.results.delete(this.nextToDeliver),Re(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(this.requestsInFlight===0?(Re(this.results.size===0,263),this.done()):this.to!==void 0&&this.nextToDeliver>=this.to&&(Re(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;if(!(this.to!==void 0&&this.to<=e))return this.latestRequested+=this.payloadSize,this.to!==void 0&&(this.latestRequested=Math.min(this.to,this.latestRequested)),Re(e<this.latestRequested,265),{from:e,to:this.latestRequested}}addRequest(){const e=this.getNextChunk();e!==void 0&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}async addRequestCore(e,t){Re(this.working,266);let r=e,i=t;for(this.requestsInFlight++;this.working;){const s=i-r;Re(s>0,267),this.to!==void 0&&(Re(r<this.to,268),Re(i<=this.to,269)),this.requests++;const o=this.requestCallback(this.requests,r,i,this.to!==void 0,{});this.dispatch();const{payload:a,cancel:l,partial:c}=await o;if(l&&this.cancel(),this.to!==void 0&&r>=this.to){Re(!this.knewTo,270),a.length!==0&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:r,to:i,end:this.to,length:a.length});break}if(this.working){const u=r,d=a.length;let h=s<=d;if(d!==0){s<d&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:r,to:i,length:d});const f=a.splice(0,s);this.results.set(r,f),r+=f.length}else Re(!c,271),Re(!this.knewTo,272);if(!c&&!h){if(!this.knewTo){(this.to===void 0||this.to>r)&&(this.to=r);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:u,to:i,length:d})}if(i===this.latestRequested&&(a.length!==0&&(this.results.set(r,a),r+=a.length),this.latestRequested=r,h=!0),h){const f=this.getNextChunk();if(f===void 0)break;r=f.from,i=f.to}}}this.requestsInFlight--,this.dispatch()}}class T5{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){Re(!this.done,274),this.deferred?(Re(this.queue.length===0,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}async read(){Re(this.deferred===void 0,276);const e=this.queue.shift();return e!==void 0?e:(Re(!this.done,277),this.deferred=new xP,this.deferred.promise)}}async function x5(n,e,t,r,i,s){let o,a=0;const l=[],c={partial:!1,cancel:!0,payload:[]};for(;(i==null?void 0:i.aborted)!==!0;){a++;let u=Math.min(C5,E5*Math.pow(2,a));const d=Di.now();try{const h=n(Object.assign(Object.assign({},e),{retry:a})),{messages:f,partialResult:p}=await h;if(l.push(...f),f.length!==0||!t)return{payload:l,cancel:!1,partial:p};if(o===void 0)o=Di.now();else if(Di.now()-o>3e4)throw Pa("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:a,driverVersion:TR},e))}catch(h){const f=Qc(h);o=void 0;const p=Zd(h);if(Sv(r,Object.assign(Object.assign({eventName:"GetDeltas_Error"},e),{retry:a,duration:Di.now()-d,retryAfter:p,reason:s}),h),!f)throw h;p!==void 0&&p>=0&&(u=p)}await bv(u)}return c}function O5(n,e,t,r,i,s,o,a){let l=0,c,u=0;const d=new T5,h={fromTotal:t,toTotal:r},f=ce.start(s,Object.assign(Object.assign({eventName:"GetDeltas"},h),{reason:a})),p=new _5(t,r,i,s,async(S,m,v,y,b)=>(l++,x5(async w=>n(m,v,w),Object.assign(Object.assign({request:S,from:m,to:v},h),b),y,s,o,a)),S=>{c===void 0?Re(S[0].sequenceNumber===t,621):Re(S[0].sequenceNumber===c+1,622),c=S[S.length-1].sequenceNumber,Re(c-S[0].sequenceNumber+1===S.length,623),u+=S.length,d.pushValue(S)}),g=S=>{p.cancel()};return o!==void 0&&o.addEventListener("abort",g),p.run(e).finally(()=>{o!==void 0&&o.removeEventListener("abort",g)}).then(()=>{const S={lastFetch:c,length:u,requests:l};p.canceled?f.cancel(Object.assign(Object.assign({},S),{error:"ops request cancelled by client"})):(Re(r===void 0||c!==void 0&&c>=r-1,624),f.end(S)),d.pushDone()}).catch(S=>{f.cancel({lastFetch:c,length:u,requests:l},S),d.pushError(S)}),d}const P5={read:async()=>({done:!0})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class R5 extends P0{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:_a.NoCaching})}async getSnapshotTree(e){const t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then(r=>{r!=null&&this.prefetchTree(r)}),t}async readBlob(e){return this.cachedRead(e)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(e){if(this.prefetchEnabled){const t=this.prefetchCache.get(e);if(t!==void 0)return t;const r=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,r.catch(i=>{throw Qc(i)&&this.prefetchCache.delete(e),i})),r}return this.internalStorageService.readBlob(e)}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const r of t)this.cachedRead(r)}prefetchTreeCore(e,t){for(const r of Object.keys(e.blobs)){const i=e.blobs[r];r.startsWith(".")||r==="header"||r.startsWith("quorum")?i!==null&&this.cachedRead(i):r.startsWith("deltas")||i!==null&&t.push(i)}for(const r of Object.keys(e.trees))this.prefetchTreeCore(e.trees[r],t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let eh=class{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const t=this.tasks.shift();if(t!==void 0)return t();this.maxRequests++},Re(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(this.maxRequests>0){this.maxRequests--;return}return new Promise(e=>{this.tasks.push(e)})}async schedule(e){return await this.acquire(),e().finally(this.release)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function X0(n,e,t,r){var i,s;let o,a=!1,l=1e3,c=0;const u=Di.now();let d;do try{o=await n(r.cancel),a=!0}catch(h){if(!Qc(h))throw t.sendTelemetryEvent({eventName:`${e}_cancel`,retry:c,duration:Di.now()-u,fetchCallName:e},h),h;if(((i=r.cancel)===null||i===void 0?void 0:i.aborted)===!0)throw t.sendTelemetryEvent({eventName:`${e}_runWithRetryAborted`,retry:c,duration:Di.now()-u,fetchCallName:e},h),new nf("runWithRetry was Aborted",Nn.genericError,{driverVersion:TR,fetchCallName:e});c++,d=h,l=(s=Zd(h))!==null&&s!==void 0?s:Math.min(l*2,8e3),r.onRetry&&r.onRetry(l,h),await gH(l)}while(!a);return c>0&&t.sendTelemetryEvent({eventName:`${e}_lastError`,retry:c,duration:Di.now()-u,fetchCallName:e},d),o}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class k5{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:qs.Tree,tree:Object.assign({},this.summaryTree),unreferenced:(e=this.props)===null||e===void 0?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:qs.Blob,content:t}}addHandle(e,t,r){this.summaryTree[e]={type:qs.Handle,handleType:t,handle:r}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:qs.Attachment}}}function xR(n,e){const t=new k5({unreferenced:n.unreferenced});for(const[r,i]of Object.entries(n.blobs)){const s=e.get(i);Re(s!==void 0,733),t.addBlob(r,R0.from(s).toString("utf-8"))}for(const[r,i]of Object.entries(n.trees)){const s=xR(i,e);t.addTree(r,s)}return t.summary}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function N5(n){if(Sc(n))return!0;switch(n.type){case Gs.Propose:case Gs.Reject:case Gs.NoOp:return!0;default:return!1}}function Sc(n){return n.type===Gs.Operation||n.type===Gs.Summarize}var wv;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(wv||(wv={}));function bc(n){return!!Object.values(wv).includes(n.type)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fn;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Fn||(Fn={}));var VE;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(VE||(VE={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var bn;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(bn||(bn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var th;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(th||(th={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class L5 extends pn.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return t!==void 0?(this.members.delete(e),this.emit("removeMember",e,t),!0):!1}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const I5="Code package does not implement IRuntimeFactory";class Y0{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g){this.container=e,this.scope=t,this.codeLoader=r,this._codeDetails=i,this._baseSnapshot=s,this.deltaManager=o,this.loader=l,this.submitFn=c,this.submitSignalFn=u,this.closeFn=d,this.version=h,this.updateDirtyContainerState=f,this.existing=p,this.pendingLocalState=g,this._disposed=!1,this._quorum=a,this.taggedLogger=e.subLogger,this._fluidModuleP=new p2(async()=>this.loadCodeModule(i)),this.attachListener()}static async createOrLoad(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g){const S=new Y0(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g);return await S.instantiateRuntime(p),S}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return G0(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(this._runtime===void 0)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return(e=this._quorum.get("code"))!==null&&e!==void 0?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const r=this.runtime;q(e===this.connected,222),r.setConnectionState(e,t)}process(e,t,r){this.runtime.process(e,t,r)}processSignal(e,t){this.runtime.processSignal(e,t)}async request(e){return this.runtime.request(e)}async getAbsoluteUrl(e){return this.container.getAbsoluteUrl(e)}getPendingLocalState(){return this.runtime.getPendingLocalState()}async satisfies(e){var t;const r=[],i=this.codeLoader;i.IFluidCodeDetailsComparer!==void 0&&r.push(i.IFluidCodeDetailsComparer);const s=await this._fluidModuleP,o=(t=s.module)===null||t===void 0?void 0:t.fluidExport;if((o==null?void 0:o.IFluidCodeDetailsComparer)!==void 0&&r.push(o.IFluidCodeDetailsComparer),r.length===0)return!1;for(const a of r)if(await a.satisfies(s.details,e)===!1)return!1;return!0}notifyAttaching(e){var t,r;this._baseSnapshot=e,(r=(t=this.runtime).notifyAttaching)===null||r===void 0||r.call(t,e),this.runtime.setAttachState(te.Attaching)}async getRuntimeFactory(){var e;const t=(e=(await this._fluidModuleP).module)===null||e===void 0?void 0:e.fluidExport,r=t==null?void 0:t.IRuntimeFactory;if(r===void 0)throw new Error(I5);return r}async instantiateRuntime(e){const t=await this.getRuntimeFactory();this._runtime=await t.instantiateRuntime(this,e)}attachListener(){this.container.once("attached",()=>{this.runtime.setAttachState(te.Attached)})}async loadCodeModule(e){const t=await ce.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},async()=>this.codeLoader.load(e));if("module"in t){const{module:r,details:i}=t;return{module:r,details:i??e}}else return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gt;(function(n){n.Never="Never",n.Disabled="Disabled",n.Enabled="Enabled"})(Gt||(Gt={}));const A5=n=>{let e;return n&&"name"in n?e=n:xO(n==null?void 0:n.package)?e=n==null?void 0:n.package.name:e=n==null?void 0:n.package,{name:e}};var rf={exports:{}};const{AbortController:OR,AbortSignal:M5}=typeof self<"u"?self:typeof window<"u"?window:void 0;rf.exports=OR;rf.exports.AbortSignal=M5;rf.exports.default=OR;var D5=rf.exports;const Cv=pi(D5);function _e(n){if(this._capacity=RR(n),this._length=0,this._front=0,PR(n)){for(var e=n.length,t=0;t<e;++t)this[t]=n[t];this._length=e}}_e.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,i=this._capacity,s=0;s<e;++s)t[s]=this[r+s&i-1];return t};_e.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var i=this._capacity;if(r+t>i){for(var o=0;o<t;++o){this._checkCapacity(r+1);var s=this._front+r&this._capacity-1;this[s]=arguments[o],r++,this._length=r}return r}else{for(var s=this._front,o=0;o<t;++o)this[s+r&i-1]=arguments[o],s++;return this._length=r+t,r+t}}if(t===0)return r;this._checkCapacity(r+1);var o=this._front+r&this._capacity-1;return this[o]=e,this._length=r+1,r+1};_e.prototype.pop=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}};_e.prototype.shift=function(){var e=this._length;if(e!==0){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}};_e.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){var o=this._capacity;if(t+r>o){for(var a=r-1;a>=0;a--){this._checkCapacity(t+1);var o=this._capacity,i=(this._front-1&o-1^o)-o;this[i]=arguments[a],t++,this._length=t,this._front=i}return t}else{for(var s=this._front,a=r-1;a>=0;a--){var i=(s-1&o-1^o)-o;this[i]=arguments[a],s=i}return this._front=s,this._length=t+r,t+r}}if(r===0)return t;this._checkCapacity(t+1);var o=this._capacity,a=(this._front-1&o-1^o)-o;return this[a]=e,this._length=t+1,this._front=a,t+1};_e.prototype.peekBack=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1;return this[t]}};_e.prototype.peekFront=function(){if(this._length!==0)return this[this._front]};_e.prototype.get=function(e){var t=e;if(t===(t|0)){var r=this._length;if(t<0&&(t=t+r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}};_e.prototype.isEmpty=function(){return this._length===0};_e.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,i=0;i<e;++i)this[t+i&r-1]=void 0;this._length=0,this._front=0};_e.prototype.toString=function(){return this.toArray().toString()};_e.prototype.valueOf=_e.prototype.toString;_e.prototype.removeFront=_e.prototype.shift;_e.prototype.removeBack=_e.prototype.pop;_e.prototype.insertFront=_e.prototype.unshift;_e.prototype.insertBack=_e.prototype.push;_e.prototype.enqueue=_e.prototype.push;_e.prototype.dequeue=_e.prototype.shift;_e.prototype.toJSON=_e.prototype.toArray;Object.defineProperty(_e.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}});_e.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(RR(this._capacity*1.5+16))};_e.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,i=this._length;if(r+i>t){var s=r+i&t-1;F5(this,0,this,t,s)}};var PR=Array.isArray;function F5(n,e,t,r,i){for(var s=0;s<i;++s)t[s+r]=n[s+e],n[s+e]=void 0}function z5(n){return n=n>>>0,n=n-1,n=n|n>>1,n=n|n>>2,n=n|n>>4,n=n|n>>8,n=n|n>>16,n+1}function RR(n){if(typeof n!="number")if(PR(n))n=n.length;else return 16;return z5(Math.min(Math.max(16,n),1073741824))}var $5=_e;const Ev=pi($5);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _v extends Uh{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new Ev,this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return this.pauseCount!==0}get length(){return this.q.length}get idle(){return this.processingPromise===void 0&&this.q.length===0}async waitTillProcessingDone(){var e;return(e=this.processingPromise)!==null&&e!==void 0?e:{count:0,duration:0}}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){q(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&this.processingPromise===void 0&&(this.processingPromise=Promise.resolve().then(()=>{q(this.processingPromise!==void 0,"reentrancy?");const e=this.processDeltas();return q(this.processingPromise!==void 0,"reentrancy?"),this.processingPromise=void 0,e}).catch(e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0})),q(this.processingPromise!==void 0,"processDeltas() should run async"))}anythingToProcess(){return this.q.length!==0&&!this.paused&&this.error===void 0}processDeltas(){const e=zt.now();let t=0;for(;this.anythingToProcess();){const i=this.q.shift();t++,this.worker(i),this.emit("op",i)}const r=zt.now()-e;return this.q.length===0&&this.emit("idle",t,r),{count:t,duration:r}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class j5 extends Uh{constructor(e,t,r,i){super(),this.serviceProvider=e,this.logger=t,this._active=r,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new Cv,this.deltaStorageDelayId=ot(),this.deltaStreamDelayId=ot(),this.messageBuffer=[];const s={incomingOpHandler:(o,a)=>{try{this.enqueueMessages(o,a)}catch(l){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},l),this.close(ar(l))}},signalHandler:o=>this._inboundSignal.push(o),reconnectionDelayHandler:(o,a)=>this.emitDelayInfo(this.deltaStreamDelayId,o,a),closeHandler:o=>this.close(o),disconnectHandler:o=>this.disconnectHandler(o),connectHandler:o=>this.connectHandler(o),pongHandler:o=>this.emit("pong",o),readonlyChangeHandler:o=>cH(this,this.logger,"readonly",o)};this.connectionManager=i(s),this._inbound=new _v(o=>{this.processInboundMessage(o)}),this._inbound.on("error",o=>{this.close(kn.wrapIfUnrecognized(o,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new _v(o=>{if(this.handler===void 0)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:o.clientId,content:JSON.parse(o.content)})}),this._inboundSignal.on("error",o=>{this.close(ar(o))})}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return q(this.connectionManager.connected,223),this._checkpointSequenceNumber!==void 0}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,r=!1,i){const s={contents:JSON.stringify(t),metadata:i,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};r||this.flush();const o=this.connectionManager.prepareMessageToSend(s);return o===void 0?-1:(this.opsSize+=o.contents.length,this.messageBuffer.push(o),this.emit("submitOp",o),r||this.flush(),o.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){this.messageBuffer.length!==0&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;q(this.connectionManager.connected,568);const r=this.pending.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:(t=r[0])===null||t===void 0?void 0:t.sequenceNumber,haveHandler:this.handler!==void 0,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const r=e.checkpointSequenceNumber;this._checkpointSequenceNumber=r,r!==void 0&&this.updateLatestKnownOpSeqNumber(r),q(this.messageBuffer.length===0,233),this.opsSize=0,this.emit("connect",e,r!==void 0?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),r!==void 0?r>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):e.mode==="read"&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}async attachOpHandler(e,t,r,i,s="none"){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=r,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,q(this.handler===void 0,226),this.handler=i,q(!!this.handler,227),q(this.fetchReason===void 0,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),s!=="none"){const o=s==="cached";await this.fetchMissingDeltasCore(`DocumentOpen_${s}`,o),o&&this.fetchMissingDeltas("PostDocumentOpen")}q(this.fetchReason!==void 0||this.pending.length===0,617)}}connect(e){var t;const r=(t=e.fetchOpsFromStorage)!==null&&t!==void 0?t:!0;uH(this.handler!==void 0||!r,this.logger,"CantFetchWithoutBaseline"),r&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}async getDeltas(e,t,r,i,s){const o=this.serviceProvider();if(o===void 0)throw new Error("Delta manager is not attached");this.deltaStorage===void 0&&(this.deltaStorage=await o.connectToDeltaStorage());let a;if(t!==void 0){const d=t-1;if(this.lastQueuedSequenceNumber>=d){this.logger.sendPerformanceEvent(Object.assign({reason:r,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));return}a=h=>h.sequenceNumber>=d}else a=d=>d.sequenceNumber>=this.lastObservedSeqNumber;const l=new Cv;let c=!1;const u=d=>{q(d.sequenceNumber===this.lastQueuedSequenceNumber,570),!c&&a(d)&&(l.abort(),this._inbound.off("push",u))};try{this._inbound.on("push",u),q(this.closeAbortController.signal.onabort===null,488),this.closeAbortController.signal.onabort=()=>l.abort();const d=this.deltaStorage.fetchMessages(e,t,l.signal,s,r);for(;;){const h=await d.read();if(h.done)break;try{c=!0,i(h.value)}finally{c=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",u),q(!c,649)}}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),this.throttlingIdSet.size===0&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,r){const i=Date.now();if(this.throttlingIdSet.add(e),t>0&&i+t>this.timeTillThrottling){this.timeTillThrottling=i+t;const s=O0.wrap(r,t/1e3,this.logger);this.emit("throttled",s)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,r=!1){var i,s;if(this.handler===void 0){this.pending=this.pending.concat(e);return}if(q(this.pending.length===0||this.fetchReason!==void 0,489),e.length===0)return;const o=e[0].sequenceNumber,a=e[e.length-1].sequenceNumber;if(a>this.lastQueuedSequenceNumber){let c=o-1;const u=c-this.lastQueuedSequenceNumber;let d,h=0,f=0;for(const g of e)g.sequenceNumber===c?h++:g.sequenceNumber!==c+1&&(f++,d===void 0&&(d=c+1)),c=g.sequenceNumber;let p;h!==0||f!==0&&!r||u>0&&this.fetchReason===void 0?p="enqueueMessages":this.fetchReason!==void 0&&this.fetchReason!==t&&o<=this.lastQueuedSequenceNumber+1&&a>this.lastQueuedSequenceNumber&&(p="enqueueMessagesExtraFetch"),p!==void 0&&this.logger.sendPerformanceEvent(Object.assign({eventName:p,reason:t,previousReason:this.prevEnqueueMessagesReason,from:o,to:a+1,length:e.length,fetchReason:this.fetchReason,duplicate:h>0?h:void 0,initialGap:u!==0?u:void 0,gap:f>0?f:void 0,firstMissing:d,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const l=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;q(l===void 0||l===this.lastQueuedSequenceNumber,236);for(const c of e)if(c.sequenceNumber<=this.lastQueuedSequenceNumber){if(((s=this.previouslyProcessedMessage)===null||s===void 0?void 0:s.sequenceNumber)===c.sequenceNumber){const u=this.comparableMessagePayload(this.previouslyProcessedMessage),d=this.comparableMessagePayload(c);if(u!==d){const h=new nf("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",Nn.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:c.sequenceNumber,message1:u,message2:d,driverVersion:void 0});this.close(h)}}}else c.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(c),this.fetchMissingDeltas(t,c.sequenceNumber)):(this.lastQueuedSequenceNumber=c.sequenceNumber,this.previouslyProcessedMessage=c,this._inbound.push(c));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,q(e.clientId!==void 0||!N5(e),237),typeof e.contents=="string"&&e.contents!==""&&e.type!==Fn.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new Pr("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},ro(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new Pr("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},ro(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,q(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),e.term===void 0&&(e.term=1),this.baseTerm=e.term,this.handler===void 0)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const r=Date.now();this.emit("op",e,r-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch(r=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},r)})}async fetchMissingDeltasCore(e,t,r){var i;if(this.fetchReason===void 0){if(this.closed){this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});return}if(this.handler===void 0){q(this.lastQueuedSequenceNumber===0,619);return}try{let s=this.lastQueuedSequenceNumber+1;const o=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;o!==void 0&&(q(o===this.lastQueuedSequenceNumber,242),q(s>1,243),s--);const a=`${e}_fetch`;this.fetchReason=a,await this.getDeltas(s,r,a,l=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(l,a)},t)}catch(s){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},s),this.close(ar(s))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}}}processPendingOps(e){if(this.closed)return;q(this.handler!==void 0,620);const t=this.pending.sort((r,i)=>r.sequenceNumber-i.sequenceNumber);this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),this.fetchReason===void 0&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class cm extends Uc{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}async systemPause(){return this.pause()}async pause(){return this.queue.pause()}async systemResume(){return this.resume()}async resume(){this.queue.resume()}async waitTillProcessingDone(){return this.queue.waitTillProcessingDone()}}class q5 extends Uc{constructor(e){super(e),this.deltaManager=e,this.inbound=new cm(e.inbound),this.outbound=new cm(e.outbound),this.inboundSignal=new cm(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function um(n){var e;const t=hv(n,!0);if(typeof t.pathname!="string")throw new ae("Failed to parse pathname");const r=(e=t.search)!==null&&e!==void 0?e:"",s=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(t.pathname);return(s==null?void 0:s.length)===3?{id:s[1],path:s[2],query:r,version:t.query.version}:void 0}function kR(n){const e={blobs:{},blobsContents:{},trees:{},id:ot(),unreferenced:n.unreferenced},t=Object.keys(n.tree);for(const r of t){const i=n.tree[r];switch(i.type){case bn.Tree:{e.trees[r]=kR(i);break}case bn.Attachment:e.blobs[r]=i.id;break;case bn.Blob:{const s=ot();e.blobs[r]=s;const o=typeof i.content=="string"?i2(i.content,"utf8"):H4(i.content);e.blobsContents[s]=o;break}case bn.Handle:throw new ae("No handles should be there in summary in detached container!!");default:Zg(i,`Unknown tree type ${i.type}`)}}return e}function B5(n,e){const t={type:bn.Tree,tree:Object.assign({},e.tree)};return t.tree[".protocol"]=n,kR(t)}const dm=n=>{const e=n.tree[".protocol"],t=n.tree[".app"];return q(e!==void 0&&t!==void 0,480),B5(e,t)};function WE(n){return".protocol"in n.trees?n.trees[".protocol"]:n}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const NR="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function LR(n){return n.headers===void 0?!0:n.headers[Ge.cache]!==!1}class U5{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}async resolve(e){var t,r,i,s,o;if(e.url.startsWith("/")){if(LR(e))return this.container;{const a=this.container.resolvedUrl;return Fr(a),await _r.load(this.loader,{canReconnect:(t=e.headers)===null||t===void 0?void 0:t[Ge.reconnect],clientDetailsOverride:(r=e.headers)===null||r===void 0?void 0:r[Ge.clientDetails],resolvedUrl:Object.assign({},a),version:(s=(i=e.headers)===null||i===void 0?void 0:i[Ge.version])!==null&&s!==void 0?s:void 0,loadMode:(o=e.headers)===null||o===void 0?void 0:o[Ge.loadMode]})}}if(this.loader===void 0)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)}async request(e){return e.url.startsWith("/")?(await this.resolve(e)).request(e):this.loader===void 0?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)}}function H5(n){const e=Object.create(n),t=new Map;return e.resolve=async r=>LR(r)?(t.has(r.url)||t.set(r.url,n.resolve(r)),t.get(r.url)):n.resolve(r),e}class V5{constructor(e){var t,r;this.containers=new Map;const i=Object.assign({},e.scope);((t=e.options)===null||t===void 0?void 0:t.provideScopeLoader)!==!1&&(i.ILoader=this);const s={loaderId:ot(),loaderVersion:NR},o=C0(zl.mixinDebugLogger("fluid:telemetry",e.logger,{all:s}),fP.value,e.configProvider);this.services={urlResolver:H5(J0.create(e.urlResolver)),documentServiceFactory:K0.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:(r=e.options)!==null&&r!==void 0?r:{},scope:i,subLogger:o.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=qa(de.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}async createDetachedContainer(e){const t=await _r.createDetached(this,e);return this.cachingEnabled&&t.once("attached",()=>{Fr(t.resolvedUrl);const r=um(t.resolvedUrl.url);r!==void 0&&this.addToContainerCache(r.id,Promise.resolve(t))}),t}async rehydrateDetachedContainerFromSnapshot(e){return _r.rehydrateDetachedFromSnapshot(this,e)}async resolve(e,t){const r=t===void 0?"Resolve":"ResolveWithPendingState";return ce.timedExecAsync(this.mc.logger,{eventName:r},async()=>(await this.resolveCore(e,t!==void 0?JSON.parse(t):void 0)).container)}async request(e){return ce.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>{const t=await this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))})}getKeyForContainerCache(e,t){var r;return((r=e.headers)===null||r===void 0?void 0:r[Ge.version])!==void 0?`${t.id}@${e.headers[Ge.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then(r=>{r.closed?this.containers.delete(e):r.once("closed",()=>{this.containers.delete(e)})}).catch(r=>{})}async resolveCore(e,t){const r=await this.services.urlResolver.resolve(e);Fr(r);const i=um(r.url);if(i===void 0)throw new Error(`Invalid URL ${r.url}`);if(t!==void 0){const c=um(t.url);if((c==null?void 0:c.id)!==i.id||(c==null?void 0:c.path.replace(/\/$/,""))!==i.path.replace(/\/$/,"")){const u=`URL ${r.url} does not match pending state URL ${t.url}`;throw new Error(u)}}const{canCache:s,fromSequenceNumber:o}=this.parseHeader(i,e),a=t!==void 0?!1:s;let l;if(a){const c=this.getKeyForContainerCache(e,i),u=await this.containers.get(c);if(u!==void 0)l=u;else{const d=this.loadContainer(e,r);this.addToContainerCache(c,d),l=await d}}else l=await this.loadContainer(e,r,t);return l.deltaManager.lastSequenceNumber<=o&&await new Promise((c,u)=>{function d(h){h.sequenceNumber>o&&(c(),l.removeListener("op",d))}l.on("op",d)}),{container:l,parsed:i}}get cachingEnabled(){return this.services.options.cache!==!1}canCacheForRequest(e){return this.cachingEnabled&&e[Ge.cache]!==!1}parseHeader(e,t){var r,i;let s=-1;t.headers=(r=t.headers)!==null&&r!==void 0?r:{};const o=t.headers[Ge.sequenceNumber];return o!==void 0&&(s=o),t.headers[Ge.version]=(i=e.version)!==null&&i!==void 0?i:t.headers[Ge.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:s}}async loadContainer(e,t,r){var i,s,o,a,l;return _r.load(this,{canReconnect:(i=e.headers)===null||i===void 0?void 0:i[Ge.reconnect],clientDetailsOverride:(s=e.headers)===null||s===void 0?void 0:s[Ge.clientDetails],resolvedUrl:t,version:(a=(o=e.headers)===null||o===void 0?void 0:o[Ge.version])!==null&&a!==void 0?a:void 0,loadMode:(l=e.headers)===null||l===void 0?void 0:l[Ge.loadMode]},r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const W5=45e3;class G5{constructor(e,t,r){var i;this.handler=e,this.logger=t,this._clientId=r,this._connectionState=Te.Disconnected,this.prevClientLeftTimer=new Yg((i=this.handler.maxClientLeaveWaitTime)!==null&&i!==void 0?i:3e5,()=>{q(!this.connected,684),this.applyForConnectedState("timeout")}),this.joinOpTimer=new Yg(W5,()=>{var s;if(this.connectionState!==Te.CatchingUp)return;const o=this.handler.quorumClients(),a={quorumInitialized:o!==void 0,hasPendingClientId:this.pendingClientId!==void 0,inQuorum:(o==null?void 0:o.getMember((s=this.pendingClientId)!==null&&s!==void 0?s:""))!==void 0,waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",a)})}get connectionState(){return this._connectionState}get connected(){return this.connectionState===Te.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){q(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){q(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){q(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=ce.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,r;const i=this.handler.quorumClients();q(i!==void 0,566),q(this.waitingForLeaveOp===!1||this.clientId!==void 0&&i.getMember(this.clientId)!==void 0,738),this.pendingClientId!==this.clientId&&this.pendingClientId!==void 0&&i.getMember(this.pendingClientId)!==void 0&&!this.waitingForLeaveOp?((t=this.waitEvent)===null||t===void 0||t.end({source:e}),this.setConnectionState(Te.Connected)):this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:e==="timeout"?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:(i==null?void 0:i.getMember((r=this.pendingClientId)!==null&&r!==void 0?r:""))!==void 0})})}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(Te.Disconnected,e)}receivedConnectEvent(e,t){const r=this._connectionState;this._connectionState=Te.CatchingUp;const i=e==="write";q(i||!this.handler.shouldClientJoinWrite(),778),q(i||!this.waitingForLeaveOp,678);const s=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(Te.CatchingUp,r),i&&(s==null?void 0:s.getMember(this._pendingClientId))===void 0?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(Te.Connected)}setConnectionState(e,t){if(this.connectionState===e){this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});return}const r=this._connectionState;this._connectionState=e;const i=this.handler.quorumClients();let s;this._clientId!==void 0&&(s=i==null?void 0:i.getMember(this._clientId)),e===Te.Connected?(q(r===Te.CatchingUp,472),s!==void 0&&(s.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===Te.Disconnected&&(this._pendingClientId=void 0,s!==void 0&&this.handler.shouldClientJoinWrite()&&this.prevClientLeftTimer.hasTimer===!1?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:s!==void 0,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,r,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",(t,r)=>{this.receivedAddMemberEvent(t)}),e.quorum.on("removeMember",t=>{this.receivedRemoveMemberEvent(t)}),this.clientId!==void 0&&e.quorum.getMember(this.clientId)!==void 0&&this.prevClientLeftTimer.restart()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class K5{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.runWithRetry(async()=>this.internalStorageService.getSnapshotTree(e,t),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry(async()=>this.internalStorageService.readBlob(e),"storage_readBlob")}async getVersions(e,t,r){return this.runWithRetry(async()=>this.internalStorageService.getVersions(e,t,r),"storage_getVersions")}async uploadSummaryWithContext(e,t){return q(t.referenceSequenceNumber===0==(t.ackHandle===void 0),593),t.referenceSequenceNumber!==0?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry(async()=>this.internalStorageService.uploadSummaryWithContext(e,t),"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry(async()=>this.internalStorageService.downloadSummary(e),"storage_downloadSummary")}async createBlob(e){return this.runWithRetry(async()=>this.internalStorageService.createBlob(e),"storage_createBlob")}checkStorageDisposed(){if(this._disposed)throw new ti("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return X0(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class J5{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(ud(e,this.generateProtocolTree()),t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Q5{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,r]of Object.entries(e.blobsContents))this.blobContents[t]=r;for(const[t,r]of Object.entries(e.trees))this.getBlobContents(r)}get policies(){try{return this.storageGetter().policies}catch{}}get repositoryUrl(){return this.storageGetter().repositoryUrl}async getSnapshotTree(e,t){return this.storageGetter().getSnapshotTree(e,t)}async readBlob(e){const t=this.blobContents[e];return t!==void 0?t:this.storageGetter().readBlob(e)}async getVersions(e,t,r){return this.storageGetter().getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.storageGetter().uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storageGetter().downloadSummary(e)}async createBlob(e){return this.storageGetter().createBlob(e)}}class X5{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(e){return this.blobStorage.createBlob(e)}async readBlob(e){return this.blobStorage.readBlob(e)}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Y5 extends Uc{constructor(e){super(e),super.setMaxListeners(50),this.propose=dl(this,e.propose.bind(e)),this.has=dl(this,e.has.bind(e)),this.get=dl(this,e.get.bind(e)),this.getMembers=dl(this,e.getMembers.bind(e)),this.getMember=dl(this,e.getMember.bind(e))}}function Z5(n){const t=new Map(n).get("code");return q(t!==void 0,732),t==null?void 0:t.value}function GE(n){return[["code",{key:"code",value:n,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const eG=2e3,tG=50;class nG{constructor(e,t=eG,r=tG){this.submit=e,this.NoopCountFrequency=r,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new Yg(t,()=>{this.opsCountSinceNoop!==0&&this.submitNoop(!1)}))}scheduleSequenceNumberUpdate(e,t){if(t){this.submitNoop(!0);return}if(Sc(e)){if(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency){this.submitNoop(!1);return}this.timer!==void 0&&(this.opsCountSinceNoop===1&&this.timer.restart(),q(this.timer.hasTimer,578))}}submitNoop(e){this.submit(Fn.NoOp,e?"":null),q(this.opsCountSinceNoop===0,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const rG=8e3,iG=1e3,sG=16*1024,KE={fatalConnectError:!0};function oG(n){const e=`Nack (${n.type}): ${n.message}`,t=n.code!==403,r=n.retryAfter!==void 0?n.retryAfter*1e3:void 0;return Pa(e,{canRetry:t,retryAfterMs:r},{statusCode:n.code,driverVersion:void 0})}class hm extends Uh{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[th.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map(t=>({operation:t,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class Z0{constructor(e,t,r,i,s){this.serviceProvider=e,this.client=t,this.logger=i,this.props=s,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(o,a)=>{const l=Array.isArray(a)?a:[a];this.props.incomingOpHandler(l,"opHandler")},this.nackHandler=(o,a)=>{const l=a[0];if(this._readonlyPermissions===!0){this.props.closeHandler(S5("writeOnReadOnlyDocument",{driverVersion:void 0}));return}const c=oG(l.content);if(!c.canRetry){this.props.closeHandler(c);return}this.reconnectOnError("write",c)},this.disconnectHandlerInternal=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.errorHandler=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=r?Gt.Enabled:Gt.Never,this._outbound=new _v(o=>{if(this.connection===void 0)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(o)}),this._outbound.on("error",o=>{this.props.closeHandler(ar(o))})}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return(t=(e=this.connection)===null||e===void 0?void 0:e.mode)!==null&&t!==void 0?t:"read"}get connected(){return this.connection!==void 0}get clientId(){var e;return(e=this.connection)===null||e===void 0?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,r;return(r=(t=(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration)===null||t===void 0?void 0:t.maxMessageSize)!==null&&r!==void 0?r:sG}get version(){if(this.connection===void 0)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration}get scopes(){var e;return(e=this.connection)===null||e===void 0?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return this.connection!==void 0?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return this._forceReadonly?!0:this._readonlyPermissions}get readOnlyInfo(){const e=this.connection!==void 0&&this.connection instanceof hm;return e||this._forceReadonly||this._readonlyPermissions===!0?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=Gt.Never,this._outbound.clear();const t=e!==void 0?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){q(e!==Gt.Never&&this._reconnectMode!==Gt.Never,632),this._reconnectMode=e,e!==Gt.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===Gt.Never)throw new Ee("API is not supported for non-connecting or closed container");let r=!1;this.readonly===!0&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),r=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),r&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch(t=>{const r=ar(t,{props:KE});this.props.closeHandler(r)})}async connectCore(e){var t,r;if(q(!this.closed,618),this.connection!==void 0)return;let i;this.pendingConnection!==void 0&&(i=this.pendingConnection.connectionMode,this.cancelConnection(),q(this.pendingConnection===void 0,836));let s=(t=e??i)!==null&&t!==void 0?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(s="write");const o=this.serviceProvider();q(o!==void 0,679);let a;if(((r=o.policies)===null||r===void 0?void 0:r.storageOnly)===!0){a=new hm,this.setupNewSuccessfulConnection(a,"read"),q(this.pendingConnection===void 0,691);return}let l=iG,c=0;const u=zt.now();let d;const h=new Cv,f=h.signal;for(this.pendingConnection={abort:()=>{h.abort()},connectionMode:s};a===void 0;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(f.aborted===!0){this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:Qe.formatTick(zt.now()-u),connectionEstablished:!1});return}c++;try{this.client.mode=s,a=await o.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:s})),a.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),a=void 0)}catch(p){if(typeof p=="object"&&p!==null&&(p==null?void 0:p.errorType)===tf.errorType){a=new hm,s="read";break}if(!Qc(p)){const S=ar(p,{props:KE});throw this.props.closeHandler(S),S}Sv(this.logger,{attempts:c,delay:l,eventName:"DeltaConnectionFailureToConnect",duration:Qe.formatTick(zt.now()-u)},p),d=p;const g=Zd(p);l=g??Math.min(l*2,rG),g!==void 0&&this.props.reconnectionDelayHandler(g,p),await bv(l)}}if(c>1&&Sv(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:c,duration:Qe.formatTick(zt.now()-u)},d),f.aborted===!0){a.dispose(),this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:Qe.formatTick(zt.now()-u),connectionEstablished:!0});return}this.setupNewSuccessfulConnection(a,s)}triggerConnect(e){q(this.connection===void 0,569),this.reconnectMode===Gt.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,this.connection===void 0)return this.pendingConnection!==void 0?(this.cancelConnection(),!0):!1;q(this.pendingConnection===void 0,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){q(this.pendingConnection!==void 0,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){q(this.connection===void 0,230),q(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const r=!e.claims.scopes.includes(th.DocWrite);if(q(t==="read"||r===(this.connectionMode==="read"),231),q(!r||this.connectionMode==="read",232),this.set_readonlyPermissions(r),this.closed){this.disconnectFromDeltaStream("ConnectionManager already closed");return}this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const i=e.initialMessages.sort((l,c)=>l.sequenceNumber-c.sequenceNumber);let s=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},e.relayServiceAgent!==void 0&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let o=-1;if(i.length!==0&&(this._connectionVerboseProps.connectionInitialOpsFrom=i[0].sequenceNumber,o=i[i.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=o+1,(s===void 0||s<o)&&(s=o)),this.props.incomingOpHandler(i,this.connectFirstConnection?"InitialOps":"ReconnectOps"),e.initialSignals!==void 0)for(const l of e.initialSignals)this.props.signalHandler(l);const a=Z0.detailsFromConnection(e);a.checkpointSequenceNumber=s,this.props.connectHandler(a),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}async reconnect(e,t,r){if(q(this.connection!==void 0,235),this.disconnectFromDeltaStream(t),r!==void 0&&!r.canRetry&&this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},r),this.reconnectMode===Gt.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==Gt.Enabled)return;const i=Zd(r);r!==void 0&&i!==void 0&&(this.props.reconnectionDelayHandler(i,r),await bv(i)),this.triggerConnect(e)}prepareMessageToSend(e){var t,r;if(this.readonly===!0){q(this.readOnlyInfo.readonly===!0,496);const i=new ti("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(i);return}return q(!!this.connection,228),this.lastSubmittedClientId!==((t=this.connection)===null||t===void 0?void 0:t.clientId)&&(this.lastSubmittedClientId=(r=this.connection)===null||r===void 0?void 0:r.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===Fn.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber})}submitSignal(e){this.connection!==void 0?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){if(q(this.connected,692),this.connectionMode==="read"){this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then(async()=>{this.pendingReconnect&&await this.reconnect("write","Switch to write")}).catch(()=>{}));return}q(!this.pendingReconnect,693),this._outbound.push(e)}beforeProcessingIncomingOp(e){if(q(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),this.lastSubmittedClientId!==void 0&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;q(this.clientSequenceNumberObserved<t,239),q(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}e.type===Fn.ClientLeave&&JSON.parse(e.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch(i=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},i)}))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const aG=0,JE="dirty",fm="saved",lG=n=>{var e;return(e=n.get("code"))!==null&&e!==void 0?e:n.get("code2")};async function QE(n,e,t){const r=ce.start(n,{eventName:e}),i=await t();r.duration>1e3&&r.end(i)}const XE="summarizer";class _r extends T0{constructor(e,t){var r,i;super((u,d)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:typeof u=="string"?u:void 0},d)}),this.loader=e,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=te.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=zt.now(),this._audience=new L5,this.clientDetailsOverride=t.clientDetailsOverride,this._resolvedUrl=t.resolvedUrl,t.canReconnect!==void 0&&(this._canReconnect=t.canReconnect);const s=this.client.details.type,a=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${s!==void 0&&s!==""?`/${s}`:""}`;this.subLogger=de.create(e.services.subLogger,void 0,{all:{clientType:a,containerId:ot(),docId:()=>{var u,d;return(d=(u=this._resolvedUrl)===null||u===void 0?void 0:u.id)!==null&&d!==void 0?d:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>Te[this.connectionState],serializedContainer:t.serializedContainerState!==void 0},error:{dmInitialSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var u;return(u=this.loadedFromVersion)===null||u===void 0?void 0:u.id},containerLoadedFromVersionDate:()=>{var u;return(u=this.loadedFromVersion)===null||u===void 0?void 0:u.date},dmLastMsqSeqNumber:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.timestamp},dmLastMsqSeqClientId:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.clientId},connectionStateDuration:()=>zt.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=qa(de.create(this.subLogger,"Container"));const l=(r=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))!==null&&r!==void 0?r:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:l}),this.connectionStateHandler=new G5({quorumClients:()=>{var u;return(u=this._protocolHandler)===null||u===void 0?void 0:u.quorum},logConnectionStateChangeTelemetry:(u,d,h)=>this.logConnectionStateChangeTelemetry(u,d,h),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(u,d)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:u,duration:zt.now()-this.connectionTransitionTimes[Te.CatchingUp]},d===void 0?{}:{details:JSON.stringify(d)}))},connectionStateChanged:()=>{this._lifecycleState==="loaded"&&this.propagateConnectionState()}},this.mc.logger,(i=t.serializedContainerState)===null||i===void 0?void 0:i.clientId),this.on(fm,()=>{this.connectionStateHandler.containerSaved()}),this._deltaManager=this.createDeltaManager(),this._storage=new Q5(()=>{if(this.attachState!==te.Attached){if(this.loader.services.detachedBlobStorage!==void 0)return new X5(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService}),typeof document=="object"&&document!==null&&typeof document.addEventListener=="function"&&document.addEventListener!==null&&(this.lastVisible=document.hidden?zt.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=zt.now():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",(u,d)=>{Promise.resolve().then(()=>{switch(u){case JE:this._dirtyContainer&&d();break;case fm:this._dirtyContainer||d();break;case EP:this.connected&&d(this.clientId);break;case _P:this.connected||d();break}}).catch(h=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},h)})})}static async load(e,t,r){const i=new _r(e,{clientDetailsOverride:t.clientDetailsOverride,resolvedUrl:t.resolvedUrl,canReconnect:t.canReconnect,serializedContainerState:r});return ce.timedExecAsync(i.mc.logger,{eventName:"Load"},async s=>new Promise((o,a)=>{var l,c;const u=t.version,d={opsBeforeReturn:"cached"},h=r?Object.assign(Object.assign({},(l=t.loadMode)!==null&&l!==void 0?l:d),{opsBeforeReturn:void 0}):(c=t.loadMode)!==null&&c!==void 0?c:d,f=p=>{a(p??new ti("Container closed without error during load"))};i.on("closed",f),i.load(u,h,r).finally(()=>{i.removeListener("closed",f)}).then(p=>{s.end(Object.assign(Object.assign({},p),t.loadMode)),o(i)},p=>{const g=ar(p);i.close(g),f(g)})}),{start:!0,end:!0,cancel:"generic"})}static async createDetached(e,t){const r=new _r(e,{});return ce.timedExecAsync(r.mc.logger,{eventName:"CreateDetached"},async i=>(await r.createDetached(t),r),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(e,t){const r=new _r(e,{});return ce.timedExecAsync(r.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},async i=>{const s=JSON.parse(t);return await r.rehydrateDetachedFromSnapshot(s),r},{start:!0,end:!0,cancel:"generic"})}setLoaded(){this._lifecycleState==="loading"&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return this._lifecycleState==="closing"||this._lifecycleState==="closed"}get storage(){return this._storage}get storageService(){if(this._storageService===void 0)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(this._context===void 0)throw new ti("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(this._protocolHandler===void 0)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(e){this._deltaManager.connectionManager.forceReadonly(e)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var e;return(e=this._context)===null||e===void 0?void 0:e.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(e){this._deltaManager.close(e),q(this.connectionState===Te.Disconnected,207),q(this._lifecycleState==="closed",788)}closeCore(e){var t,r,i,s;q(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:e===void 0?"generic":"error"},e),this._lifecycleState="closing",(t=this._protocolHandler)===null||t===void 0||t.close(),this.connectionStateHandler.dispose(),(r=this._context)===null||r===void 0||r.dispose(e!==void 0?new Error(e.message):void 0),(i=this._storageService)===null||i===void 0||i.dispose(),(s=this.service)===null||s===void 0||s.dispose(e)}catch(o){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},o)}this.emit("closed",e),this.removeAllListeners(),this.visibilityEventHandler!==void 0&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){q(this.attachState===te.Attached,209),q(this.resolvedUrl!==void 0&&this.resolvedUrl.type==="fluid",210),q(!!this._protocolHandler,739),q(this._protocolHandler.attributes.term!==void 0,779);const e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}get attachState(){return this._attachState}serialize(){q(this.attachState===te.Detached,211);const e=this.context.createSummary(),t=this.captureProtocolSummary(),r=ud(e,t);return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(r.tree[".hasAttachmentBlobs"]={type:bn.Blob,content:"true"}),JSON.stringify(r)}async attach(e){await ce.timedExecAsync(this.mc.logger,{eventName:"Attach"},async()=>{if(this._lifecycleState!=="loaded")throw new Ee(`The Container is not in a valid state for attach [${this._lifecycleState}]`);q(this._attachState===te.Detached&&!this.attachStarted,517),this.attachStarted=!0;const t=this.loader.services.detachedBlobStorage!==void 0&&this.loader.services.detachedBlobStorage.size>0;try{q(this.deltaManager.inbound.length===0,214);let r;if(!t){const o=this.context.createSummary(),a=this.captureProtocolSummary();r=ud(o,a),this._attachState=te.Attaching,this.context.notifyAttaching(dm(r))}const i=await this.urlResolver.resolve(e);Fr(i),this.service===void 0&&(q(this.client.details.type!==XE,708),this.service=await X0(async()=>this.serviceFactory.createContainer(r,i,this.subLogger,!1),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));const s=this.service.resolvedUrl;if(Fr(s),this._resolvedUrl=s,await this.connectStorageService(),t){q(!!this.loader.services.detachedBlobStorage,590);const o=new Map;for(;o.size<this.loader.services.detachedBlobStorage.size;){const c=this.loader.services.detachedBlobStorage.getBlobIds().filter(u=>!o.has(u));for(const u of c){const d=await this.loader.services.detachedBlobStorage.readBlob(u),h=await this.storageService.createBlob(d);o.set(u,h.id)}}const a=this.context.createSummary(o),l=this.captureProtocolSummary();r=ud(a,l),this._attachState=te.Attaching,this.context.notifyAttaching(dm(r)),await this.storageService.uploadSummaryWithContext(r,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=te.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(r){const i=ar(r),s=this.resolvedUrl;throw G0(s)&&i.addTelemetryProperties({resolvedUrl:s.url}),this.close(i),i}},{start:!0,end:!0,cancel:"generic"})}async request(e){return ce.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>this.context.request(e),{end:!0,cancel:"error"})}setAutoReconnectInternal(e){if(this._deltaManager.connectionManager.reconnectMode===e)return;const r=zt.now(),i=r-this.setAutoReconnectTime;this.setAutoReconnectTime=r,this.mc.logger.sendTelemetryEvent({eventName:e===Gt.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:Te[this.connectionState],duration:i}),this._deltaManager.connectionManager.setAutoReconnect(e)}connect(){if(this.closed)throw new Ee("The Container is closed and cannot be connected");if(this._attachState!==te.Attached)throw new Ee("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(e){q(!this.closed,709),q(this._attachState===te.Attached,710),this.resumeInternal(e);const t=Gt.Enabled;this.setAutoReconnectInternal(t)}disconnect(){if(this.closed)throw new Ee("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){q(!this.closed,711);const e=Gt.Disabled;this.setAutoReconnectInternal(e)}resumeInternal(e){q(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}async getAbsoluteUrl(e){var t;if(this.resolvedUrl!==void 0)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,e,A5((t=this._context)===null||t===void 0?void 0:t.codeDetails))}async proposeCodeDetails(e){if(!eC(e))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const t=await this.codeLoader.IFluidCodeDetailsComparer.compare(e,this.getCodeDetailsFromQuorum());if(t!==void 0&&t<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",e).then(()=>!0).catch(()=>!1)}async processCodeProposal(){const e=this.getCodeDetailsFromQuorum();if(await Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),await this.context.satisfies(e)===!0){this.deltaManager.inbound.resume(),this.deltaManager.inboundSignal.resume();return}this.close(new ti("Existing context does not satisfy incoming proposal"))}async getVersion(e){return(await this.storageService.getVersions(e,1))[0]}recordConnectStartTime(){this.connectionTransitionTimes[Te.Disconnected]===void 0&&(this.connectionTransitionTimes[Te.Disconnected]=zt.now())}connectToDeltaStream(e){this.recordConnectStartTime(),(!this._canReconnect||!this.client.details.capabilities.interactive)&&(e.mode="write"),this._deltaManager.connect(e)}async load(e,t,r){if(this._resolvedUrl===void 0)throw new Error("Attempting to load without a resolved url");this.service=await this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===XE);const i={reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1};t.deltaConnection===void 0&&this.connectToDeltaStream(i),r?this.connectStorageService().catch(u=>this.close(u)):await this.connectStorageService(),this._attachState=te.Attached;const{snapshot:s,versionId:o}=r===void 0?await this.fetchSnapshotTree(e):{snapshot:void 0,versionId:void 0};q(s!==void 0||r!==void 0,567);const a=r===void 0?await this.getDocumentAttributes(this.storageService,s):{sequenceNumber:r.protocol.sequenceNumber,minimumSequenceNumber:r.protocol.minimumSequenceNumber,term:r.term};let l;switch(t.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(a,t.deltaConnection!=="none"?"all":"none");break;case"cached":l=this.attachDeltaManagerOpHandler(a,"cached");break;case"all":l=this.attachDeltaManagerOpHandler(a,"all");break;default:Zg(t.opsBeforeReturn)}this._protocolHandler=r===void 0?await this.initializeProtocolStateFromSnapshot(a,this.storageService,s):await this.initializeProtocolState(a,r.protocol.members,r.protocol.proposals,r.protocol.values);const c=this.getCodeDetailsFromQuorum();if(await this.instantiateContext(!0,c,s,r==null?void 0:r.pendingRuntimeState),!this.closed)switch(l!==void 0&&(this._deltaManager.inbound.resume(),await QE(this.mc.logger,"WaitOps",async()=>(await l,{})),await QE(this.mc.logger,"WaitOpProcessing",async()=>this._deltaManager.inbound.waitTillProcessingDone()),this._deltaManager.inbound.pause()),t.deltaConnection){case void 0:case"delayed":q(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:Zg(t.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:a.sequenceNumber,version:o,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(e){const t={sequenceNumber:aG,term:1,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(t);const r=GE(e);this._protocolHandler=await this.initializeProtocolState(t,[],[],r),await this.instantiateContextDetached(!1),this.setLoaded()}async rehydrateDetachedFromSnapshot(e){e.tree[".hasAttachmentBlobs"]!==void 0&&(q(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete e.tree[".hasAttachmentBlobs"]);const t=dm(e);this._storage.loadSnapshotForRehydratingContainer(t);const r=await this.getDocumentAttributes(this._storage,t);await this.attachDeltaManagerOpHandler(r);const i=WE(t),s=await mt(this._storage,i.blobs.quorumValues),o=Z5(s);this._protocolHandler=await this.initializeProtocolState(r,[],[],o!==void 0?GE(o):[]),await this.instantiateContextDetached(!0,t),this.setLoaded()}async connectStorageService(){var e,t;if(this._storageService!==void 0)return;q(this.service!==void 0,495);const r=await this.service.connectToStorage();this._storageService=new K5(r,this.mc.logger),this.options.summarizeProtocolTree===!0&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new J5(this._storageService,()=>this.captureProtocolSummary())),q(((e=r.policies)===null||e===void 0?void 0:e.minBlobSize)===((t=this.storageService.policies)===null||t===void 0?void 0:t.minBlobSize),224)}async getDocumentAttributes(e,t){if(t===void 0)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const r=".protocol"in t.trees?t.trees[".protocol"].blobs.attributes:t.blobs[".attributes"],i=await mt(e,r);return i.term===void 0&&(i.term=1),i}async initializeProtocolStateFromSnapshot(e,t,r){let i=[],s=[],o=[];if(r!==void 0){const l=WE(r);[i,s,o]=await Promise.all([mt(t,l.blobs.quorumMembers),mt(t,l.blobs.quorumProposals),mt(t,l.blobs.quorumValues)])}return await this.initializeProtocolState(e,i,s,o)}async initializeProtocolState(e,t,r,i){const s=new _H(e.minimumSequenceNumber,e.sequenceNumber,e.term,t,r,i,(a,l)=>this.submitMessage(Fn.Propose,{key:a,value:l})),o=de.create(this.subLogger,"ProtocolHandler");return s.quorum.on("error",a=>{o.sendErrorEvent(a)}),this.connectionStateHandler.initProtocol(s),s.quorum.on("addProposal",a=>{(a.key==="code"||a.key==="code2")&&this.emit("codeDetailsProposed",a.value,a)}),s.quorum.on("approveProposal",(a,l,c)=>{(l==="code"||l==="code2")&&(eC(c)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch(u=>{throw this.close(ar(u)),u}))}),s}captureProtocolSummary(){const e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:bn.Blob},quorumMembers:{content:JSON.stringify(e.members),type:bn.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:bn.Blob},quorumValues:{content:JSON.stringify(e.values),type:bn.Blob}},type:bn.Tree}}getCodeDetailsFromQuorum(){const e=this.protocolHandler.quorum;return lG(e)}get client(){var e;const t=((e=this.options)===null||e===void 0?void 0:e.client)!==void 0?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return this.clientDetailsOverride!==void 0&&UB(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment,` loaderVersion:${NR}`].join(";"),t}activeConnection(){return this.connectionState===Te.Connected&&this.connectionMode==="write"}createDeltaManager(){const e=()=>this.service,t=new j5(e,de.create(this.subLogger,"DeltaManager"),()=>this.activeConnection(),r=>new Z0(e,this.client,this._canReconnect,de.create(this.subLogger,"ConnectionManager"),r));return t.inbound.pause(),t.inboundSignal.pause(),t.on("connect",(r,i)=>{var s;this._audience.clear();for(const o of(s=r.initialClients)!==null&&s!==void 0?s:[])this._audience.addMember(o.clientId,o.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,r)}),t.on("disconnect",r=>{var i;(i=this.collabWindowTracker)===null||i===void 0||i.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(r)}),t.on("throttled",r=>{const i=r;i.logged!==!0&&this.logContainerError(i),this.emit("warning",i)}),t.on("readonly",r=>{this.emit("readonly",r)}),t.on("closed",r=>{this.closeCore(r)}),t}async attachDeltaManagerOpHandler(e,t){var r;return this._deltaManager.attachOpHandler(e.minimumSequenceNumber,e.sequenceNumber,(r=e.term)!==null&&r!==void 0?r:1,{process:i=>this.processRemoteMessage(i),processSignal:i=>{this.processSignal(i)}},t)}logConnectionStateChangeTelemetry(e,t,r){var i;const s=zt.now();this.connectionTransitionTimes[e]=s;const o=s-this.connectionTransitionTimes[t];let a,l,c,u,d;e===Te.Disconnected?c=this._deltaManager.connectionManager.reconnectMode:(e===Te.Connected?(a=s-this.connectionTransitionTimes[Te.Disconnected],a=Qe.formatTick(a)):(u=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(d=u-this.deltaManager.lastSequenceNumber)),this.firstConnection?l="InitialConnect":l="AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${Te[e]}`,from:Te[t],duration:o,durationFromDisconnected:a,reason:r,connectionInitiationReason:l,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:c,opsBehind:d,online:Xi[Q0()],lastVisible:this.lastVisible!==void 0?zt.now()-this.lastVisible:void 0,checkpointSequenceNumber:u,quorumSize:(i=this._protocolHandler)===null||i===void 0?void 0:i.quorum.getMembers().size},this._deltaManager.connectionProps)),e===Te.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var e;const t=this.connectionState===Te.Connected&&!this.firstConnection&&this.connectionMode==="write";t&&(this.messageCountAfterDisconnection=0);const r=this.connectionState===Te.Connected;((e=this._context)===null||e===void 0?void 0:e.disposed)===!1&&this.context.setConnectionState(r,this.clientId),this.protocolHandler.setConnectionState(r,this.clientId),x0(this.mc.logger,this,r,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(e,t,r,i){switch(e){case Fn.Operation:case Fn.RemoteHelp:break;case Fn.Summarize:{const o=t;o.details===void 0&&(o.details={}),o.details.includesProtocolTree=this.options.summarizeProtocolTree===!0;break}default:return this.close(new ti("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,r,i)}submitMessage(e,t,r,i){var s;return this.connectionState!==Te.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,(s=this.collabWindowTracker)===null||s===void 0||s.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,r,i))}processRemoteMessage(e){const t=this.clientId===e.clientId;let r={immediateNoOp:!1};try{r=this.protocolHandler.processMessage(e,t)}catch(i){this.close(Vh(i,s=>new Pr(s,ro(e))))}return bc(e)&&!Sc(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),(Sc(e)||bc(e))&&this.context.process(e,t,void 0),this.activeConnection()&&(this.collabWindowTracker===void 0&&(q(this.serviceConfiguration!==void 0,740),this.collabWindowTracker=new nG((i,s)=>{q(this.activeConnection(),577),this.submitMessage(i,s)},this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,r.immediateNoOp===!0)),this.emit("op",e),r}submitSignal(e){this._deltaManager.submitSignal(JSON.stringify(e))}processSignal(e){if(e.clientId===null){const t=e.content;if(t.type===Fn.ClientJoin){const r=t.content;this._audience.addMember(r.clientId,r.client)}else if(t.type===Fn.ClientLeave){const r=t.content;this._audience.removeMember(r)}}else{const t=this.clientId===e.clientId;this.context.processSignal(e,t)}}async fetchSnapshotTree(e){var t;const r=await this.getVersion(e??null);r===void 0&&e!==void 0&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:e}),this._loadedFromVersion=r;const i=(t=await this.storageService.getSnapshotTree(r))!==null&&t!==void 0?t:void 0;return i===void 0&&r!==void 0&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:r.id}),{snapshot:i,versionId:r==null?void 0:r.id}}async instantiateContextDetached(e,t){const r=this.getCodeDetailsFromQuorum();if(r===void 0)throw new Error("pkg should be provided in create flow!!");await this.instantiateContext(e,r,t)}async instantiateContext(e,t,r,i){var s;q(((s=this._context)===null||s===void 0?void 0:s.disposed)!==!1,221);const o=new U5(this,this.loader);this._context=await Y0.createOrLoad(this,this.scope,this.codeLoader,t,r,new q5(this._deltaManager),new Y5(this.protocolHandler.quorum),o,(a,l,c,u)=>this.submitContainerMessage(a,l,c,u),a=>this.submitSignal(a),a=>this.close(a),_r.version,a=>this.updateDirtyContainerState(a),e,i),this.emit("contextChanged",t)}updateDirtyContainerState(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?JE:fm))}logContainerError(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}_r.version="^0.1.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let IR=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Tv extends IR{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=r=>this.emit("disposed",r),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(){throw new Error("Cannot attach container. Container is not in detached state")}async connect(){var e,t;(t=(e=this.container).connect)===null||t===void 0||t.call(e)}async disconnect(){var e,t;(t=(e=this.container).disconnect)===null||t===void 0||t.call(e)}async create(e){return this.rootDataObject.create(e)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var nh;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(nh||(nh={}));var YE;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(YE||(YE={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Xc(n,e){if(n==="")return e===void 0?"":e.absolutePath;{let t=n.startsWith("/")?n.slice(1):n;return t=t.endsWith("/")?t.slice(0,-1):t,e===void 0?`/${t}`:`${e.absolutePath==="/"?"":e.absolutePath}/${t}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Oe(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function AR(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const cG=(n,e)=>eS.from(n).toString(e);function ZE(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let eS=class xs extends Uint8Array{toString(e){return AR(this,e)}static from(e,t,r){if(typeof e=="string")return xs.fromString(e,t);if(e!==null&&typeof e=="object"&&ZE(e.buffer))return Oe(e.byteOffset===0,0),Oe(e.byteLength===e.buffer.byteLength,1),xs.fromArrayBuffer(e.buffer,t,r);if(ZE(e))return xs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new xs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new xs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new xs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const uG=n=>eS.from(n,"base64").toString("utf-8");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let dG=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function MR(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function rh(n){if(n!==null&&typeof n=="object"&&n.errorFromRequestFluidObject===!0){const r=n;return{mimeType:"text/plain",status:r.code,value:r.message,get stack(){return r.stack}}}const t=Hh();return{mimeType:"text/plain",status:500,value:`${n}`,get stack(){var r;return(r=n==null?void 0:n.stack)!==null&&r!==void 0?r:t.stack}}}function sf(n,e){const t=n.value,r=Hh();return{errorFromRequestFluidObject:!0,message:t,name:"Error",code:n.status,get stack(){var s;return(s=n.stack)!==null&&s!==void 0?s:r.stack}}}async function wc(n,e){const t=typeof e=="string"?{url:e}:e,r=await n.request(t);if(r.status!==200||r.mimeType!=="fluid/object")throw sf(r);return Oe(r.value,410),r.value}const jn=n=>ih(404,"not found",n);function ih(n,e,t){var r;Oe(n!==200,411);const i=(r=t.url)===null||r===void 0?void 0:r.split("?")[0],s=Hh();return{mimeType:"text/plain",status:n,value:i===void 0?e:`${e}: ${i}`,get stack(){return s.stack}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hG{constructor(e,t){this.storage=e,this.path=t,Oe(!t.endsWith("/"),412)}async readBlob(e){return this.storage.readBlob(`${this.path}/${e}`)}async contains(e){return this.storage.contains(`${this.path}/${e}`)}async list(e){return this.storage.list(`${this.path}/${e}`)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function fG(n){let e=n;return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e.length>0?e.split("/"):[]}class Rr{constructor(e){this.request=e;const t=this.request.url.indexOf("?");t>=0?this.query=this.request.url.substring(t):this.query=""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((r,i)=>(i!==void 0&&i.length>0&&r.push(decodeURIComponent(i)),r),[])}static create(e){return e instanceof Rr?e:new Rr(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return this.requestPathParts===void 0&&(this.requestPathParts=Rr.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return this.query===""&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const r=`/${this.pathParts.slice(e).join("/")}`;return{url:this.query===""?r:`${r}/${this.query}`,headers:this.headers}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class pG{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const r=t===void 0?e.existing===!0:t,i=await this.preInitialize(e,r);return r?await this.instantiateFromExisting(i):await this.instantiateFirstTime(i),await this.hasInitialized(i),i}async instantiateFirstTime(e){}async instantiateFromExisting(e){}async hasInitialized(e){}}var re={},of={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(of,"__esModule",{value:!0});of.IFluidDataStoreFactory=void 0;of.IFluidDataStoreFactory="IFluidDataStoreFactory";var af={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(af,"__esModule",{value:!0});af.IFluidDataStoreRegistry=void 0;af.IFluidDataStoreRegistry="IFluidDataStoreRegistry";var DR={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.VisibilityState=n.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(n.FlushMode||(n.FlushMode={})),n.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}})(DR);var lf={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(lf,"__esModule",{value:!0});lf.gcBlobKey=void 0;lf.gcBlobKey="gc";var FR={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(FR,"__esModule",{value:!0});var zR={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.totalBlobSizePropertyName=n.blobCountPropertyName=n.channelsTreeName=n.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(n.CreateSummarizerNodeSource||(n.CreateSummarizerNodeSource={})),n.channelsTreeName=".channels",n.blobCountPropertyName="BlobCount",n.totalBlobSizePropertyName="TotalBlobSize"})(zR);(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=G&&G.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=G&&G.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(of,n),t(af,n),t(DR,n),t(lf,n),t(FR,n),t(zR,n)})(re);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e_;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(e_||(e_={}));var Hl;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Hl||(Hl={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var at;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(at||(at={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ls(...n){const e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const t of n)e.treeNodeCount+=t.treeNodeCount,e.blobNodeCount+=t.blobNodeCount,e.handleNodeCount+=t.handleNodeCount,e.totalBlobSize+=t.totalBlobSize,e.unreferencedBlobSize+=t.unreferencedBlobSize;return e}function mG(n){let e=n.length;for(let t=n.length-1;t>=0;t--){const r=n.charCodeAt(t);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&t--}return e}function $R(n){return typeof n=="string"?mG(n):n.byteLength}function jR(n,e){switch(n.type){case at.Tree:{e.treeNodeCount++;for(const t of Object.values(n.tree))jR(t,e);return}case at.Handle:{e.handleNodeCount++;return}case at.Blob:{e.blobNodeCount++,e.totalBlobSize+=$R(n.content);return}default:return}}function qR(n){const e=ls();return jR(n,e),e}function Tr(n,e,t){const r={type:at.Blob,content:t};n.summary.tree[e]=r,n.stats.blobNodeCount++,n.stats.totalBlobSize+=$R(t)}function gG(n,e,t){n.summary.tree[e]=t.summary,n.stats=ls(n.stats,t.stats)}function vG(n,e,t){n.summary.tree[e]=t.summary,n.stats=ls(n.stats,t.stats)}class tn{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=ls(),this.summaryStats.treeNodeCount++}get summary(){return{type:at.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){Tr({summary:{type:at.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,r){this.summaryTree[e]={type:at.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=ls(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:at.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function yG(n,e=!1){const t=new tn;for(const i of n.entries)switch(i.type){case Hl.Blob:{const s=i.value;let o;s.encoding==="base64"?o=eS.from(s.contents,"base64"):o=s.contents,t.addBlob(i.path,o);break}case Hl.Tree:{const s=tS(i.value,e);t.addWithStats(i.path,s);break}case Hl.Attachment:{const s=i.value.id;t.addAttachment(s);break}default:throw new Error("Unexpected TreeEntry type")}const r=t.getSummaryTree();return r.summary.unreferenced=n.unreferenced,r}function tS(n,e=!1){if(n.id&&!e){const t=ls();return t.handleNodeCount++,{summary:{handle:n.id,handleType:at.Tree,type:at.Handle},stats:t}}else return yG(n,e)}function nS(n){const e=new tn;for(const[r,i]of Object.entries(n.blobs)){let s;if(n.blobsContents!==void 0){const o=n.blobsContents[i];o!==void 0&&(s=cG(o,"utf-8"))}else n.blobs[i]!==void 0&&(s=uG(n.blobs[i]));s!==void 0&&e.addBlob(r,s)}for(const[r,i]of Object.entries(n.trees)){const s=nS(i);e.addWithStats(r,s)}const t=e.getSummaryTree();return t.summary.unreferenced=n.unreferenced,t}function rS(n){const e=[];for(const[t,r]of Object.entries(n.tree))switch(r.type){case at.Blob:{let i,s="utf-8";typeof r.content=="string"?i=r.content:(i=AR(r.content,"base64"),s="base64"),e.push(new RP(t,i,s));break}case at.Tree:{e.push(new yH(t,rS(r)));break}case at.Attachment:{e.push(new SH(t,r.id));break}case at.Handle:throw new Error("Should not have Handle type in summary tree");default:MR(r,"Unexpected summary tree type")}return{entries:e,unreferenced:n.unreferenced}}class SG{constructor(){this.telemetry=new Map}set(e,t,r){this.telemetry.set(`${e}${t}`,r)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach((t,r)=>{e[r]=t}),JSON.stringify(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Vl="_baseSummary",BR="_outstandingOps",t_=100;class $t{constructor(e){this.path=e}static create(e){return new $t(encodeURIComponent(e))}static createAndConcat(e){var t;let r=$t.create((t=e[0])!==null&&t!==void 0?t:"");for(let i=1;i<e.length;i++)r=r.concat($t.create(e[i]));return r}toString(){return this.path}concat(e){return new $t(`${this.path}/${e.path}`)}}class Yi{constructor(e){this.summary=e}static createForRoot(e){return new Yi({referenceSequenceNumber:e,basePath:void 0,localPath:$t.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return(t=(e=this.basePath)===null||e===void 0?void 0:e.concat(this.localPath))!==null&&t!==void 0?t:this.localPath}get fullPathForChildren(){return this.additionalPath!==void 0?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new Yi({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:$t.create(e)})}}function n_(n,e){let t=n;const r=[],i=[];for(let s=0;;s++){s>t_&&e.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:t_});const o=t.blobs[BR],a=t.trees[Vl];if(o===void 0&&a===void 0)return{baseSummary:t,pathParts:r,async getOutstandingOps(l){let c=[];for(const u of i){const d=await l(u);if(c.length>0&&d.length>0){const h=c[c.length-1].sequenceNumber,f=d[0].sequenceNumber;if(f<=h)for(e.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${f} <= ${h}`});d.length>0&&d[0].sequenceNumber<=h;)d.shift()}c=c.concat(d)}return c}};Oe(!!o,431),Oe(a!==void 0,432),t=a,r.push(Vl),i.unshift(o)}}function bG(n,e){let t=$t.create(Vl);const r=new tn;if(r.addBlob(BR,JSON.stringify(e)),n.fromSummary){const s=n.summaryNode;s.additionalPath!==void 0&&(t=t.concat(s.additionalPath)),r.addHandle(Vl,at.Tree,s.fullPath.path)}else r.addWithStats(Vl,n.initialSummary);const i=r.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:t})}function pm(n){const e=n.trees[re.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:re.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}function wG(n){const e=n.tree[re.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:re.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class iS{constructor(e,t,r,i,s,o,a){var l;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=i,this._latestSummary=s,this.initialSummary=o,this.wipSummaryLogger=a,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=(l=r.canReuseHandle)!==null&&l!==void 0?l:!0,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return(t=(e=this._latestSummary)===null||e===void 0?void 0:e.referenceSequenceNumber)!==null&&t!==void 0?t:0}startSummary(e,t){Oe(this.wipSummaryLogger===void 0,415),Oe(this.wipReferenceSequenceNumber===void 0,416),this.wipSummaryLogger=t;for(const r of this.children.values())r.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}async summarize(e,t=!0,r){if(Oe(this.isTrackingInProgress(),417),Oe(this.wipSummaryLogger!==void 0,418),this.canReuseHandle&&!e&&!this.hasChanged()){const i=this._latestSummary;if(i!==void 0){this.wipLocalPaths={localPath:i.localPath,additionalPath:i.additionalPath},this.wipSkipRecursion=!0;const s=ls();return s.handleNodeCount++,{summary:{type:at.Handle,handle:i.fullPath.path,handleType:at.Tree},stats:s}}}try{const i=await this.summarizeInternalFn(e,!0,r);return this.wipLocalPaths={localPath:$t.create(i.id)},i.pathPartsForChildren!==void 0&&(this.wipLocalPaths.additionalPath=$t.createAndConcat(i.pathPartsForChildren)),{summary:i.summary,stats:i.stats}}catch(i){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw i;const s=this._latestSummary,o=this.initialSummary;let a,l;if(s!==void 0)a={fromSummary:!0,summaryNode:s},l=s.localPath;else if((o==null?void 0:o.summary)!==void 0)a={fromSummary:!1,initialSummary:o.summary},l=$t.create(o.id);else throw i;this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},i);const c=bG(a,this.outstandingOps);return this.wipLocalPaths={localPath:l,additionalPath:c.additionalPath},this.wipSkipRecursion=!0,{summary:c.summary,stats:c.stats}}}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,r){Oe(this.wipSummaryLogger!==void 0,419),Oe(this.wipReferenceSequenceNumber!==void 0,420);let i=this.wipLocalPaths;if(r){const a=this._latestSummary;if(a!==void 0)i={localPath:a.localPath,additionalPath:a.additionalPath};else{this.clearSummary();return}}Oe(!!i,421);const s=new Yi(Object.assign(Object.assign({},i),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),o=s.fullPathForChildren;for(const a of this.children.values())a.completeSummaryCore(e,o,this.wipSkipRecursion||r);this.pendingSummaries.set(e,s),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}async refreshLatestSummary(e,t,r,i,s){if(e!==void 0){const a=this.pendingSummaries.get(e);if(a!==void 0)return this.refreshLatestSummaryFromPending(e,a.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const o=await r();return await this.refreshLatestSummaryFromSnapshot(t,o,void 0,$t.create(""),s,i),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:o}}refreshLatestSummaryFromPending(e,t){const r=this.pendingSummaries.get(e);if(r===void 0){Oe(this._latestSummary===void 0,422);return}else Oe(t===r.referenceSequenceNumber,423),this.pendingSummaries.delete(e);this.refreshLatestSummaryCore(t),this._latestSummary=r;for(const i of this.children.values())i.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);const{baseSummary:a,pathParts:l}=n_(t,s);this._latestSummary=new Yi({referenceSequenceNumber:e,basePath:r,localPath:i});const{childrenTree:c,childrenPathPart:u}=pm(a);u!==void 0&&l.push(u),l.length>0&&(this._latestSummary.additionalPath=$t.createAndConcat(l));const d=this._latestSummary.fullPathForChildren;await Promise.all(Array.from(this.children).filter(([h])=>c.trees[h]!==void 0).map(async([h,f])=>f.refreshLatestSummaryFromSnapshot(e,c.trees[h],d,$t.create(h),s,o)))}refreshLatestSummaryCore(e){for(const[t,r]of this.pendingSummaries)r.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=pm(e);t!==void 0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=$t.create(t))}async loadBaseSummary(e,t){const r=n_(e,this.defaultLogger),i=await r.getOutstandingOps(t),{childrenPathPart:s}=pm(r.baseSummary);if(s!==void 0&&r.pathParts.push(s),r.pathParts.length>0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=$t.createAndConcat(r.pathParts)),i.length>0){const o=i[i.length-1].sequenceNumber;Oe(o<=this.trackingSequenceNumber,425)}return{baseSummary:r.baseSummary,outstandingOps:i}}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];t!==void 0&&Oe(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,r,i={}){Oe(!this.children.has(t),427);const s=this.getCreateDetailsForChild(t,r),o=new iS(this.defaultLogger,e,i,s.changeSequenceNumber,s.latestSummary,s.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(o),this.children.set(t,o),o}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var r;let i,s,o;const a=this._latestSummary;switch(t.type){case re.CreateSummarizerNodeSource.FromAttach:{if(a!==void 0&&t.sequenceNumber<=a.referenceSequenceNumber)s=a.createForChild(e);else{const l=tS(t.snapshot);i={sequenceNumber:t.sequenceNumber,id:e,summary:l}}o=t.sequenceNumber;break}case re.CreateSummarizerNodeSource.FromSummary:this.initialSummary===void 0&&Oe(!!a,428);case re.CreateSummarizerNodeSource.Local:{const l=this.initialSummary;if(l!==void 0){let c;if(l.summary!==void 0){const{childrenTree:d}=wG(l.summary.summary);Oe(d.type===at.Tree,470),c=d.tree[e]}t.type===re.CreateSummarizerNodeSource.FromSummary&&Oe(!!c,429);let u;c!==void 0&&(Oe(c.type===at.Tree,430),u={summary:c,stats:qR(c)}),i={sequenceNumber:l.sequenceNumber,id:e,summary:u}}s=a==null?void 0:a.createForChild(e),o=(r=a==null?void 0:a.referenceSequenceNumber)!==null&&r!==void 0?r:-1;break}default:{const l=t.type;MR(t,`Unexpected CreateSummarizerNodeSource: ${l}`)}}return{initialSummary:i,latestSummary:s,changeSequenceNumber:o}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),e._latestSummary!==void 0)for(const[t,r]of this.pendingSummaries.entries()){const i=new Yi({referenceSequenceNumber:r.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,i)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return this.wipReferenceSequenceNumber!==void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function mm(n,e){const t=new Set,r=[...e];for(const o of r){if(t.has(o))continue;t.add(o);const a=n[o];a!==void 0&&r.push(...a)}const i=[],s=[];for(const o of Object.keys(n))t.has(o)?i.push(o):s.push(o);return{referencedNodeIds:i,deletedNodeIds:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Jo(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function CG(n){return n.replace(/^\/+|\/+$/g,"")}function EG(n){return n.replace(/^\/+/g,"")}function _G(n){return n.replace(/\/+$/g,"")}function Wl(n){const e={};for(const[t,r]of Object.entries(n.gcNodes))e[t]=Array.from(r);return{gcNodes:e}}function UR(n){const e=new Map;if(n.gcData===void 0)return e;const t=n.gcData.gcNodes;delete t["/"];for(const[i,s]of Object.entries(t)){Jo(i.startsWith("/"),686);const o=i.split("/")[1];let a=i.slice(o.length+1);a===""&&(a="/");let l=e.get(o);l===void 0&&(l={gcData:{gcNodes:{}},usedRoutes:[]}),Jo(l.gcData!==void 0,687),l.gcData.gcNodes[a]=[...new Set(s)],e.set(o,l)}if(n.usedRoutes===void 0)return e;const r=n.usedRoutes.filter(i=>i!==""&&i!=="/");for(const i of r){Jo(i.startsWith("/"),688);const s=i.split("/")[1],o=i.slice(s.length+1),a=e.get(s);Jo((a==null?void 0:a.usedRoutes)!==void 0,689),a.usedRoutes.push(o),e.set(s,a)}return e}function HR(n){const e=n.filter(r=>r!==""&&r!=="/"),t=new Map;for(const r of e){Jo(r.startsWith("/"),408);const i=r.split("/")[1],s=r.slice(i.length+1),o=t.get(i);o!==void 0?o.push(s):t.set(i,[s])}return t}function TG(n,e){const t=Object.entries(n);for(const[r,i]of t){const s=new Set(i);s.delete(e),n[r]=[...s]}}function xG(n,e){var t;const r={};for(const[i,s]of Object.entries(n.gcNodes))r[i]={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs};for(const[i,s]of Object.entries(e.gcNodes)){let o=r[i];o===void 0?o={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs}:(s.unreferencedTimestampMs!==void 0&&o.unreferencedTimestampMs!==void 0&&Jo(s.unreferencedTimestampMs===o.unreferencedTimestampMs,690),o={outboundRoutes:[...new Set([...s.outboundRoutes,...o.outboundRoutes])],unreferencedTimestampMs:(t=s.unreferencedTimestampMs)!==null&&t!==void 0?t:o.unreferencedTimestampMs}),r[i]=o}return{gcNodes:r}}function OG(n,e){const t=Wl(n);for(const[r,i]of Object.entries(e.gcNodes))if(t.gcNodes[r]===void 0)t.gcNodes[r]=Array.from(i);else{const s=[...i,...t.gcNodes[r]];t.gcNodes[r]=[...new Set(s)]}return t}class sS{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,r]of Object.entries(this.gcNodesSet))e[t]=[...r];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[r,i]of Object.entries(t)){let s=EG(r);s=`/${e}/${s}`,s=_G(s),this.gcNodesSet[s]=new Set(i)}}addNodes(e){for(const[t,r]of Object.entries(e))this.gcNodesSet[t]=new Set(r)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class PG extends Yi{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class oS extends iS{constructor(e,t,r,i,s,o,a,l,c){super(e,async(u,d,h)=>t(u,!0,h),r,i,s,o,a),this.summarizeFn=t,this.getGCDataFn=l,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=r.gcDisabled===!0,this.baseGCDetailsP=new dG(async()=>{var u;return(u=await(c==null?void 0:c()))!==null&&u!==void 0?u:{usedRoutes:[]}})}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}async loadBaseGCDetails(){var e;const t=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,t.gcData!==void 0&&(this.gcData=Wl(t.gcData)),this.referenceUsedRoutes=(e=t.usedRoutes)===null||e===void 0?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)}async summarize(e,t=!0,r){return!this.gcDisabled&&this.isTrackingInProgress()&&Oe(this.wipSerializedUsedRoutes!==void 0,433),t?super.summarize(e,!0,r):this.summarizeFn(e,t,r)}async getGCData(e=!1){if(Oe(!this.gcDisabled,434),Oe(this.getGCDataFn!==void 0,435),await this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&this.gcData!==void 0)return Wl(this.gcData);const t=await this.getGCDataFn(e);return this.gcData=Wl(t),t}startSummary(e,t){this.gcDisabled||Oe(this.wipSerializedUsedRoutes===void 0,436),super.startSummary(e,t)}completeSummaryCore(e,t,r){let i;if(this.gcDisabled||(i=this.wipSerializedUsedRoutes,Oe(i!==void 0,437)),super.completeSummaryCore(e,t,r),!this.gcDisabled){const s=this.pendingSummaries.get(e);if(s!==void 0){const o=new PG(i,s);this.pendingSummaries.set(e,o)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const r=this.pendingSummaries.get(e);r!==void 0&&(this.referenceUsedRoutes=JSON.parse(r.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(!this.gcDisabled){const a=t.blobs[re.gcBlobKey];if(a!==void 0){const l=await o(a);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=l.usedRoutes}}return super.refreshLatestSummaryFromSnapshot(e,t,r,i,s,o)}createChild(e,t,r,i={},s,o){var a;Oe(!this.children.has(t),438);const l=this.getCreateDetailsForChild(t,r),c=new oS(this.defaultLogger,e,Object.assign(Object.assign({},i),{gcDisabled:(a=i.gcDisabled)!==null&&a!==void 0?a:this.gcDisabled}),l.changeSequenceNumber,l.latestSummary,l.initialSummary,this.wipSummaryLogger,s,o);return this.maybeUpdateChildState(c),this.children.set(t,c),c}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){if(this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()){this.unreferencedTimestampMs=void 0;return}this.unreferencedTimestampMs===void 0&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return this.gcDisabled?!1:this.referenceUsedRoutes===void 0||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes)}}const RG=(n,e,t,r,i={},s,o)=>new oS(n,e,i,t,r===void 0?void 0:Yi.createForRoot(r),void 0,void 0,s,o);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function kG(n,e){const t=n.trees[".protocol"].blobs.attributes;return(await e(t)).sequenceNumber}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Js(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function P(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function NG(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const LG=(n,e)=>VR.from(n,e).buffer,r_=(n,e)=>VR.from(n).toString(e);function i_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let VR=class Os extends Uint8Array{toString(e){return NG(this,e)}static from(e,t,r){if(typeof e=="string")return Os.fromString(e,t);if(e!==null&&typeof e=="object"&&i_(e.buffer))return P(e.byteOffset===0,0),P(e.byteLength===e.buffer.byteLength,1),Os.fromArrayBuffer(e.buffer,t,r);if(i_(e))return Os.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Os(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Os(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Os(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Cn=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ua=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Bt=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},aa=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let cf=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){P(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}},IG=class{constructor(e,t){this.timer=new cf(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Bt,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),P(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let s_=class WR{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=Cn.now();return new WR(e)}trace(){const e=Cn.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function xv(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let aS=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const AG=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var st;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(st||(st={}));var o_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(o_||(o_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Zi;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Zi||(Zi={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class MG{constructor(e,t,r){this.path=e,this.runtime=t,this.routeContext=r,this.absolutePath=Xc(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==te.Detached}async resolveHandle(e){return this.runtime.resolveHandle(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class lS{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new Ee("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}async get(e){if(this.map.has(e))return this.map.get(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const on="summarizer";class la extends Ua{constructor(e,t,r,i,s){super(),this.logger=e,this.summaryCollection=t,this.clientElection=r,this.maxOpsSinceLastSummary=i,this.electionEnabled=s,this.lastReportedSeq=0,this.summaryCollection.on("default",({sequenceNumber:o})=>{var a,l,c;const u=this.electedClientId;if(u===void 0){this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(o);return}let d=this.clientElection.electionSequenceNumber;if(o-((a=this.lastSummaryAckSeqForClient)!==null&&a!==void 0?a:d)>this.maxOpsSinceLastSummary){const f=o-this.lastReportedSeq;if(f>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:u,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:d,nextElectedClientId:(l=this.clientElection.peekNextElectedClient())===null||l===void 0?void 0:l.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=o),this.electionEnabled){const p=this.electedParentId;this.clientElection.incrementElectedClient(o),d=this.clientElection.electionSequenceNumber,o>((c=this.lastSummaryAckSeqForClient)!==null&&c!==void 0?c:d)&&f>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:d,sequenceNumber:o,previousClientId:u,previousParentId:p,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:f,maxOpsSinceLastSummary:i})}}}),this.summaryCollection.on(st.SummaryAck,o=>{this.lastSummaryAckSeqForClient=o.sequenceNumber}),this.clientElection.on("election",(o,a)=>{this.lastSummaryAckSeqForClient=void 0,o===void 0&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(a),this.emit("electedSummarizerChanged")})}get electedClientId(){var e;return(e=this.clientElection.electedClient)===null||e===void 0?void 0:e.clientId}get electedParentId(){var e;return(e=this.clientElection.electedParent)===null||e===void 0?void 0:e.clientId}serialize(){var e;const{electedClientId:t,electedParentId:r,electionSequenceNumber:i}=this.clientElection.serialize();return{electedClientId:t,electedParentId:r,electionSequenceNumber:(e=this.lastSummaryAckSeqForClient)!==null&&e!==void 0?e:i}}static isClientEligible(e){const t=e.client.details;return t===void 0?!0:la.clientDetailsPermitElection(t)}}la.clientDetailsPermitElection=n=>n.capabilities.interactive||n.type===on;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function oe(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let DG=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let fl=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},FG=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function zG(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let GR=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ov;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Ov||(Ov={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class $G{constructor(e,t,r,i,s){this.objectId=e,this._connected=t,this.submit=r,this.dirty=i,this.addedGCOutboundReference=s}get handler(){return oe(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){oe(this._handler===void 0,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,r){try{this.handler.process(e,t,r)}catch(i){throw kn.wrapIfUnrecognized(i,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(this.handler.rollback===void 0)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class sh{constructor(e,t,r,i){this.tree=e,this.storage=t,this.logger=r,this.extraBlobs=i,this.flattenedTree={},e!==void 0&&sh.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,r){for(const i in t.trees)sh.flattenTree(`${e}${i}/`,t.trees[i],r);for(const i in t.blobs)r[`${e}${i}`]=t.blobs[i]}async contains(e){return this.flattenedTree[e]!==void 0}async readBlob(e){const t=await this.getIdForPath(e),r=this.extraBlobs!==void 0?this.extraBlobs.get(t):void 0;if(r!==void 0)return r;const i=this.storage.readBlob(t);return i.catch(s=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},s)),i}async list(e){var t;let r=this.tree;const i=fG(e);for(;r!==void 0&&i.length>0;){const s=i.shift();r=r.trees[s]}if(r===void 0||i.length!==0)throw new Error("path does not exist");return Object.keys((t=r==null?void 0:r.blobs)!==null&&t!==void 0?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const oh=".attributes";function cS(n,e,t,r,i,s,o,a,l){const c=new $G(n,e,(d,h)=>t(d,h),r,i),u=new sh(a,s,o,l);return{deltaConnection:c,objectStorage:u}}function KR(n,e=!1,t=!1,r){const i=n.getAttachSummary(e,t,r);return Tr(i,oh,JSON.stringify(n.attributes)),i}async function JR(n,e=!1,t=!1,r){const i=await n.summarize(e,t,r);return Tr(i,oh,JSON.stringify(n.attributes)),i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class uS{constructor(e,t,r,i){this.id=e,this.registry=t,this.runtime=r,this.servicesGetter=i,this.globallyVisible=!1,this.pending=[],oe(!this.id.includes("/"),783)}async getChannel(){return oe(this.channel!==void 0,519),this.channel}get isLoaded(){return this.channel!==void 0}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,r){oe(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,r):(oe(t===!1,393),this.pending.push(e))}reSubmit(e,t){oe(this.isLoaded,394),oe(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){oe(this.isLoaded,750),oe(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,r){return oe(this.isLoaded&&this.channel!==void 0,396),JR(this.channel,e,t,r)}getAttachSummary(e){return oe(this.isLoaded&&this.channel!==void 0,397),KR(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(oe(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return oe(this.isLoaded&&this.channel!==void 0,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class jG extends uS{constructor(e,t,r,i,s,o,a,l,c,u){super(e,t,r,()=>this.services),this.snapshotTree=u;const d=new Map,h=wa(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(h,d)&&this.sanitizeSnapshot(h),this.services=new GR(()=>cS(this.id,i.connected,a,this.dirtyFn,c,s,o,h,d)),this.dirtyFn=()=>{l(e)}}async getChannel(){return this.channel===void 0&&(this.channel=await this.loadChannel().catch(e=>{throw kn.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)})),this.channel}async loadChannel(){oe(!this.isLoaded,398),oe(await this.services.value.objectStorage.contains(".attributes"),400);const e=await mt(this.services.value.objectStorage,".attributes");if(oe(this.factory===void 0,520),this.factory=this.registry.get(e.type),this.factory===void 0)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const r of this.pending)this.services.value.deltaConnection.process(r,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let r=!1;const i=e.blobsContents;Object.entries(i).forEach(([s,o])=>{t.set(s,o),e.blobs[s]!==void 0&&(r=!0)});for(const s of Object.values(e.trees))r=r||this.isSnapshotInOldFormatAndCollectBlobs(s,t);return r}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[r,i]of t.entries())t.get(i)===void 0&&delete e.blobs[r];for(const r of Object.values(e.trees))this.sanitizeSnapshot(r)}}class qG extends uS{constructor(e,t,r,i,s,o,a,l,c,u){if(super(e,t,i,()=>this.services),oe(r!==void 0,521),this.factory=t.get(r),this.factory===void 0)throw new Error(`Channel Factory ${r} not registered`);this.channel=this.factory.create(i,e),this.services=new GR(()=>cS(this.id,s.connected,l,this.dirtyFn,u,o,a)),this.dirtyFn=()=>{c(e)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Cc{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f){this.runtime=e,this.dataStoreContext=t,this.id=a,this.registry=c,this.attachMessageType=f,this.isLoaded=!1,this.pending=[],oe(!this.id.includes("/"),784),this.subLogger=de.create(this.runtime.logger,"RemoteChannelContext"),this.services=cS(this.id,this.dataStoreContext.connected,i,()=>s(this.id),o,r,this.subLogger,l,u);const p=async(g,S,m)=>this.summarizeInternal(g,S,m);this.summarizerNode=d(p,async g=>this.getGCDataInternal(g),async()=>h()),this.thresholdOpsCounter=new TP(Cc.pendingOpsCountThreshold,this.subLogger)}getChannel(){return this.channelP===void 0&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return oe(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,r){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,r):(oe(!t,405),oe(this.pending!==void 0,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){oe(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){oe(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){const i=await this.getChannel(),s=await JR(i,e,t,r);return Object.assign(Object.assign({},s),{id:this.id})}async loadChannel(){oe(!this.isLoaded,407);let e;await this.services.objectStorage.contains(oh)&&(e=await mt(this.services.objectStorage,oh));let t;if(e===void 0){if(this.attachMessageType===void 0)throw new Pr("channelTypeNotAvailable",{channelId:{value:this.id,tag:Ae.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ae.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),t===void 0)throw new Pr("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:Ae.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ae.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),t===void 0)throw new Pr("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:Ae.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:Ae.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});e.snapshotFormatVersion!==void 0&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:Ae.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:Ae.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:Ae.PackageData}});const r=await t.load(this.runtime,this.id,this.services,e);oe(this.pending!==void 0,575);for(const i of this.pending)this.services.deltaConnection.process(i,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=r,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}Cc.pendingOpsCountThreshold=1e3;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Jr;(function(n){n.Attach="attach",n.ChannelOp="op"})(Jr||(Jr={}));class Yc extends DG{constructor(e,t,r){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new fl,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,oe(!e.id.includes("/"),782),this.logger=de.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:ot()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const i=e.baseSnapshot;this.channelsBaseGCDetails=new FG(async()=>{var s,o,a;const l=await((a=(o=(s=this.dataStoreContext).getBaseGCDetails)===null||o===void 0?void 0:o.call(s))!==null&&a!==void 0?a:this.dataStoreContext.getInitialGCSummaryDetails());return UR(l)}),(i==null?void 0:i.trees)!==void 0&&Object.keys(i.trees).forEach(s=>{if(s==="_search")return;let o;e.isLocalDataStore?(o=new jG(s,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(l,c)=>this.submitChannelOp(s,l,c),l=>this.setChannelDirty(l),(l,c)=>this.addedGCOutboundReference(l,c),i.trees[s]),e.attachState!==te.Detached?o.makeVisible():this.localChannelContextQueue.set(s,o)):o=new Cc(this,e,e.storage,(l,c)=>this.submitChannelOp(s,l,c),l=>this.setChannelDirty(l),(l,c)=>this.addedGCOutboundReference(l,c),s,i.trees[s],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:re.CreateSummarizerNodeSource.FromSummary}),async()=>this.getChannelBaseGCDetails(s));const a=new fl;a.resolve(o),this.contexts.set(s,o),this.contextsDeferred.set(s,a)}),this.attachListener(),this.bindState=r?wn.Bound:wn.NotBound,this._attachState=e.attachState,r?this.visibilityState=e.attachState===te.Detached?re.VisibilityState.LocallyVisible:re.VisibilityState.GloballyVisible:this.visibilityState=re.VisibilityState.NotVisible,r&&this.deferredAttached.resolve()}static load(e,t,r){return new Yc(e,t,r)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==te.Detached}get attachState(){return this._attachState}get absolutePath(){return Xc(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const t=Rr.create(e),r=t.pathParts[0];if(r==="_channels"||r==="_custom")return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(r)&&t.isLeaf(1))try{return{mimeType:"fluid/object",status:200,value:await(await this.contextsDeferred.get(r).promise).getChannel()}}catch(i){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},i),ih(500,`Failed to get Channel: ${i}`,e)}return jn(e)}catch(t){return rh(t)}}async getChannel(e){return this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new fl),await(await this.contextsDeferred.get(e).promise).getChannel()}createChannel(e=ot(),t){if(e.includes("/"))throw new Ee(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),oe(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const r=new qG(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(i,s)=>this.submitChannelOp(e,i,s),i=>this.setChannelDirty(i),(i,s)=>this.addedGCOutboundReference(i,s));if(this.contexts.set(e,r),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(r);else{const i=new fl;i.resolve(r),this.contextsDeferred.set(e,i)}return oe(!!r.channel,378),r.channel}bindChannel(e){if(oe(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached){this.attachChannel(e);return}this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===re.VisibilityState.NotVisible&&(this.visibilityState=re.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===wn.NotBound&&(this.bindState=wn.Binding,this.dataStoreContext.bindToContext(),this.bindState=wn.Bound)}bind(e){if(this.visibilityState!==re.VisibilityState.NotVisible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}setConnectionState(e,t){this.verifyNotClosed();for(const[,r]of this.contexts)r.setConnectionState(e,t);x0(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,r){this.verifyNotClosed();try{switch(e.type){case Jr.Attach:{const i=e.contents,s=i.id;if(t)oe(this.pendingAttach.has(s),380),this.pendingAttach.delete(s);else{oe(!this.contexts.has(s),381);const o=new Map,a=NP(i.snapshot.entries,o),l=new Cc(this,this.dataStoreContext,this.dataStoreContext.storage,(c,u)=>this.submitChannelOp(s,c,u),c=>this.setChannelDirty(c),(c,u)=>this.addedGCOutboundReference(c,u),s,a,this.sharedObjectRegistry,o,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:re.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),async()=>this.getChannelBaseGCDetails(s),i.type);if(this.contexts.set(s,l),this.contextsDeferred.has(s))this.contextsDeferred.get(s).resolve(l);else{const c=new fl;c.resolve(l),this.contextsDeferred.set(s,c)}}break}case Jr.ChannelOp:this.processChannelOp(e,t,r);break;default:}this.emit("op",e)}catch(i){throw kn.wrapIfUnrecognized(i,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new sS;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>this.isChannelAttached(r)).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var r;const i=HR(e);for(const[s]of i)oe(this.contexts.has(s),382);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}addedGCOutboundReference(e,t){var r,i;(i=(r=this.dataStoreContext).addedGCOutboundReference)===null||i===void 0||i.call(r,e,t)}async getChannelBaseGCDetails(e){var t;let r=(await this.channelsBaseGCDetails).get(e);return r===void 0?r={}:((t=r.gcData)===null||t===void 0?void 0:t.gcNodes)!==void 0&&TG(r.gcData.gcNodes,this.absolutePath),(r.usedRoutes===void 0||r.usedRoutes.length===0)&&(r.usedRoutes=[""]),r}async summarize(e=!1,t=!0,r){const i=new tn;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>{const a=this.isChannelAttached(s);return oe(a,383),a}).map(async([s,o])=>{const a=await o.summarize(e,t,r);i.addWithStats(s,a)})),i.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new tn;for(const[r,i]of this.contexts){if(!(i instanceof uS))throw new ae("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(r)){let s;if(i.isLoaded){const o=i.getAttachSummary(e);oe(o.summary.type===Ov.Tree,384),s={stats:o.stats,summary:o.summary}}else oe(!!this.dataStoreContext.baseSnapshot,385),s=nS(this.dataStoreContext.baseSnapshot.trees[r]);t.addWithStats(r,s)}}return t.getSummaryTree()}submitMessage(e,t,r){this.submit(e,t,r)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),oe(this.isAttached,386),oe(this.visibilityState===re.VisibilityState.GloballyVisible,720);const t=KR(e,!0,!1),r=rS(t.summary),i={id:e.id,snapshot:r,type:e.attributes.type};this.pendingAttach.set(e.id,i),this.submit(Jr.Attach,i),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,r){const i={address:e,contents:t};this.submit(Jr.ChannelOp,i,r)}submit(e,t,r=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,r)}reSubmit(e,t,r){switch(this.verifyNotClosed(),e){case Jr.ChannelOp:{const i=t,s=this.contexts.get(i.address);oe(!!s,387),s.reSubmit(i.contents,r);break}case Jr.Attach:this.submit(e,t,r);break;default:zG()}}rollback(e,t,r){switch(this.verifyNotClosed(),e){case Jr.ChannelOp:{const i=t,s=this.contexts.get(i.address);oe(!!s,749),s.rollback(i.contents,r);break}default:throw new ae(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return oe(!!r,388),await r.getChannel(),r.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,r){this.verifyNotClosed();const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);return oe(!!o,389),o.processOp(s,t,r),o}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",()=>{this.attachGraph(),this._attachState=te.Attaching,oe(this.visibilityState===re.VisibilityState.LocallyVisible,721),this.visibilityState=re.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach(e=>{e.makeVisible()}),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")}),this.dataStoreContext.once("attached",()=>{oe(this.visibilityState===re.VisibilityState.GloballyVisible,722),this._attachState=te.Attached,this.emit("attached")})}verifyNotClosed(){if(this._disposed)throw new ae("Runtime is closed")}}const BG=(n,e=Yc)=>class extends e{async request(r){const i=await super.request(r);return i.status===404?n(r,this):i}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ca{constructor(e,t,r){this.value=e,this.path=t,this.routeContext=r,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=Xc(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){if(this.visible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class UG extends ca{async get(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")}attach(){}bind(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class HG{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:e??this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class VG{constructor(e,t,r,i){this.heuristicData=e,this.configuration=t,this.trySummarize=r,this.logger=i,this.idleTimer=new cf(this.configuration.idleTime,()=>this.trySummarize("idle")),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function Pv(n,e,t){const r=[n.then(i=>({result:"done",value:i})),e.then(({timerResult:i})=>({result:i}))];return t!==void 0&&r.push(t.waitCancelled.then(()=>({result:"cancelled"}))),Promise.race(r)}const a_=2e4,WG=5,l_={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class Gl{constructor(){this.summarySubmitted=new Bt,this.summaryOpBroadcasted=new Bt,this.receivedSummaryAckOrNack=new Bt}fail(e,t,r,i){P(!this.receivedSummaryAckOrNack.isCompleted,606);const s={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:i};this.summarySubmitted.resolve(s),this.summaryOpBroadcasted.resolve(s),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},s),{data:r}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class GG{constructor(e,t,r,i,s,o,a){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=r,this.raiseSummarizingError=i,this.successfulSummaryCallback=s,this.summaryWatcher=o,this.logger=a,this.summarizeTimer=new cf(a_,()=>this.summarizeTimerHandler(a_,1))}summarize(e,t,r,i=new Gl){return this.summarizeCore(e,t,i,r).catch(s=>{const o="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:o},e),s),i.fail(o,s)}),i.build()}async summarizeCore(e,t,r,i){const{refreshLatestAck:s,fullTree:o}=t,a=de.create(this.logger,void 0,{all:e}),l=Date.now()-this.heuristicData.lastAttempt.summaryTime,c=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime;let u={fullTree:o,timeSinceLastAttempt:l,timeSinceLastSummary:c};const d=ce.start(a,Object.assign({eventName:"Summarize",refreshLatestAck:s},u)),h=g=>`${g}: ${l_[g]}`,f=(g,S,m,v)=>{this.raiseSummarizingError(l_[g]);const y=HE(S),b=i.cancelled||(S==null?void 0:S.errorType)===Nn.offlineError?"generic":"error";d.cancel(Object.assign(Object.assign({},m),{reason:g,category:b,retryAfterSeconds:y}),S),r.fail(h(g),S,v,y)};this.summarizeTimer.start();let p;try{p=await this.submitSummaryCallback({fullTree:o,refreshLatestAck:s,summaryLogger:a,cancellationToken:i});const g=p.referenceSequenceNumber,S=g-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(u=Object.assign(Object.assign({},u),{referenceSequenceNumber:g,minimumSequenceNumber:p.minimumSequenceNumber,opsSinceLastAttempt:g-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:S}),p.stage!=="base"&&(u=Object.assign(Object.assign(Object.assign({},u),p.summaryStats),{generateDuration:p.generateDuration}),p.stage!=="generate"&&(u=Object.assign(Object.assign({},u),{handle:p.handle,uploadDuration:p.uploadDuration}),p.stage!=="upload"&&(u=Object.assign(Object.assign({},u),{clientSequenceNumber:p.clientSequenceNumber})))),p.stage!=="submit")return f("submitSummaryFailure",p.error,u);if(!o&&!p.forcedFullTree){const{summarizedDataStoreCount:m,gcStateUpdatedDataStoreCount:v=0}=p.summaryStats;m>v+S&&a.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:m,gcStateUpdatedDataStoreCount:v,opsSinceLastSummary:S})}d.reportEvent("generate",Object.assign({},u)),r.summarySubmitted.resolve({success:!0,data:p})}catch(g){return f("submitSummaryFailure",g)}finally{this.heuristicData.recordAttempt(p==null?void 0:p.referenceSequenceNumber),this.summarizeTimer.clear()}try{const g=this.pendingAckTimer.start(),S=this.summaryWatcher.watchSummary(p.clientSequenceNumber),m=await Pv(S.waitBroadcast(),g,i);if(m.result==="cancelled")return f("disconnect");if(m.result!=="done")return f("summaryOpWaitTimeout");const v=m.value,y=Date.now()-this.heuristicData.lastAttempt.summaryTime;r.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:v,broadcastDuration:y}}),this.heuristicData.lastAttempt.summarySequenceNumber=v.sequenceNumber,a.sendTelemetryEvent({eventName:"Summarize_Op",duration:y,referenceSequenceNumber:v.referenceSequenceNumber,summarySequenceNumber:v.sequenceNumber,handle:v.contents.handle});const b=await Pv(S.waitAckNack(),g,i);if(b.result==="cancelled")return f("disconnect");if(b.result!=="done")return f("summaryAckWaitTimeout");const w=b.value;this.pendingAckTimer.clear();const T=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(u=Object.assign({ackWaitDuration:T,ackNackSequenceNumber:w.sequenceNumber,summarySequenceNumber:w.contents.summaryProposal.summarySequenceNumber},u),w.type===st.SummaryAck)this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),d.end(Object.assign(Object.assign({},u),{handle:w.contents.handle})),r.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:w,ackNackDuration:T}});else{P(w.type===st.SummaryNack,628);const E=w.contents,O=E==null?void 0:E.message,A=E==null?void 0:E.retryAfter,F=new ae(`Received summaryNack: ${O}`,{retryAfterSeconds:A});return P(HE(F)===A,607),f("summaryNack",F,Object.assign(Object.assign({},u),{nackRetryAfter:A}),{summaryNackOp:w,ackNackDuration:T})}}finally{this.pendingAckTimer.clear()}}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<WG){const r=e*2;this.summarizeTimer.start(r,()=>this.summarizeTimerHandler(r,t+1))}}dispose(){this.summarizeTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var gm=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const KG=10*60*1e3;class dS{constructor(e,t,r,i,s,o,a,l,c){this.summaryWatcher=t,this.configuration=r,this.submitSummaryCallback=i,this.heuristicData=s,this.raiseSummarizingError=o,this.summaryCollection=a,this.cancellationToken=l,this.stopSummarizerCallback=c,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=h=>this.heuristicData.lastAttempt.refSequenceNumber===h?this.logger:void 0;const u={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=de.create(e,"Running",{all:u}),r.state!=="disableHeuristics"&&(P(this.configuration.state==="enabled",746),this.heuristicRunner=new VG(s,this.configuration,h=>this.trySummarize(h),this.logger)),P(this.configuration.state!=="disabled",747);const d=Math.min(this.configuration.maxAckWaitTime,KG);this.pendingAckTimer=new IG(d,()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:d,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})}),a.setPendingAckTimerTimeoutCallback(d,()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())}),this.generator=new GG(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,()=>{this.totalSuccessfulAttempts++},this.summaryWatcher,this.logger)}static async start(e,t,r,i,s,o,a,l,c){var u;const d=new dS(e,t,r,i,s,o,a,l,c);return await d.waitStart(),(u=d.heuristicRunner)===null||u===void 0||u.run(),d}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),(e=this.heuristicRunner)===null||e===void 0||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case st.ClientLeave:case st.ClientJoin:case st.Propose:{this.handleOp(void 0,e);return}default:return}}handleOp(e,{sequenceNumber:t,type:r,clientId:i,contents:s}){var o;e===void 0&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||(o=this.heuristicRunner)===null||o===void 0||o.run())}async waitStop(e){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(!((t=this.heuristicRunner)===null||t===void 0)&&t.shouldRunLastSummary())&&this.summarizingLock===void 0&&this.trySummarizeOnce({reason:"lastSummary"},{}),await this.summarizingLock)}async waitStart(){const e=await Pv(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),e.result==="done"&&e.value!==void 0&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})}async lockedRefreshSummaryAckAction(e){P(this.refreshSummaryAckLock===void 0,"Refresh Summary Ack - Caller is responsible for checking lock");const t=new Bt;return this.refreshSummaryAckLock=t.promise,e().finally(()=>{t.resolve(),this.refreshSummaryAckLock=void 0})}async lockedSummaryAction(e){P(this.summarizingLock===void 0,603);const t=new Bt;return this.summarizingLock=t.promise,this.summarizeCount++,await this.refreshSummaryAckLock,e().finally(()=>{var r;t.resolve(),this.summarizingLock=void 0;const i=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,!this.stopping&&!this.tryRunEnqueuedSummary()&&i&&((r=this.heuristicRunner)===null||r===void 0||r.run())})}trySummarizeOnce(e,t,r=this.cancellationToken,i=new Gl){return this.lockedSummaryAction(async()=>this.generator.summarize(e,t,r,i).receivedSummaryAckOrNack).catch(s=>{}),i.build()}trySummarize(e,t=this.cancellationToken){if(this.summarizingLock!==void 0){this.tryWhileSummarizing=!0;return}this.lockedSummaryAction(async()=>{const r=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let i,s=0,o=0,a;for(let l=0;l<r.length;){if(this.cancellationToken.cancelled||++s>1&&e==="lastSummary")return;o++;const c=r[l],{delaySeconds:u=0}=c,d=gm(c,["delaySeconds"]),h=i??u,f=Object.assign({reason:e,summaryAttempts:s,summaryAttemptsPerPhase:o,summaryAttemptPhase:l+1},d);h>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:h,summaryNackDelay:i!==void 0},f)),await AG(h*1e3)),await this.refreshSummaryAckLock;const g=await this.generator.summarize(f,d,t).receivedSummaryAckOrNack;if(g.success)return;i=g.retryAfterSeconds,(i===void 0||o>1)&&(l++,o=0),a=g}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:a==null?void 0:a.message},a==null?void 0:a.error),this.stopSummarizerCallback("failToSummarize")}).catch(r=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},r)})}summarizeOnDemand(e=new Gl,t){var{reason:r}=t,i=gm(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(this.summarizingLock!==void 0)throw new Ee("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${r}`},i,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:r=0,override:i=!1}=e,s=gm(e,["reason","afterSequenceNumber","override"]);const o=`enqueue;${t}`;let a=!1;if(this.enqueuedSummary!==void 0){if(!i)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,a=!0}this.enqueuedSummary={reason:o,afterSequenceNumber:r,options:s,resultsBuilder:new Gl};const l=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),a?Object.assign(Object.assign({},l),{alreadyEnqueued:!0,overridden:!0}):l}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(this.enqueuedSummary===void 0||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||this.summarizingLock!==void 0)return!1;const{reason:e,resultsBuilder:t,options:r}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},r,this.cancellationToken,t),!0}disposeEnqueuedSummary(){this.enqueuedSummary!==void 0&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const JG="summarizingError";class Ec extends ae{constructor(e,t=!1){super(e),this.logged=t,this.errorType=JG,this.canRetry=!0}static wrap(e,t=!1,r){return bP(e,s=>new Ec(s,t),r)}}const QG=(n,e)=>new Ec(n,e);class hS extends pn.EventEmitter{constructor(e,t,r,i,s,o,a){super(),this.runtime=t,this.configurationGetter=r,this.internalsProvider=i,this.summaryCollection=o,this.runCoordinatorCreateFn=a,this._disposed=!1,this.starting=!1,this.stopDeferred=new Bt,this.summarizeOnDemand=(...l)=>{var c;try{if(this._disposed||!((c=this.runningSummarizer)===null||c===void 0)&&c.disposed)throw new Ee("Summarizer is already disposed.");if(this.runtime.summarizerClientId!==void 0&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new Ee("On-demand summary attempted while an elected summarizer is present");const u=new Gl;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(u,...l):(this.runCoordinatorCreateFn(this.runtime).then(h=>{this.start(this.runtime.clientId,h).then(async p=>{p.summarizeOnDemand(u,...l);const g=await Promise.race([this.stopDeferred.promise,h.waitCancelled]);await p.waitStop(!1),h.stop(g),this.close()}).catch(p=>{u.fail("Failed to start summarizer",p)})}).catch(h=>{u.fail("Failed to create cancellation token",h)}),u.build())}catch(u){throw Ec.wrap(u,!1,this.logger)}},this.enqueueSummarize=(...l)=>{if(this._disposed||this.runningSummarizer===void 0||this.runningSummarizer.disposed)throw new Ee("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...l)},this.logger=de.create(this.runtime.logger,"Summarizer"),this.innerHandle=new UG(this,e,s)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static async create(e,t){const r={headers:{[Ge.cache]:!1,[Ge.clientDetails]:{capabilities:{interactive:!1},type:on},[Ta.summarizingClient]:!0,[Ge.reconnect]:!1},url:t},i=await e.resolve(r),s=await wc(i,{url:"_summarizer"});if(s.ISummarizer===void 0)throw new Ee("Fluid object does not implement ISummarizer");return s.ISummarizer}async run(e){try{return await this.runCore(e)}catch(t){throw this.stop("summarizerException"),Ec.wrap(t,!1,this.logger)}finally{this.close()}}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}async runCore(e){const t=await this.runCoordinatorCreateFn(this.runtime),r=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(r.then(o=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:o})}),t.cancelled)return t.waitCancelled;const i=await this.start(e,t),s=await r;return await i.waitStop(!t.cancelled&&hS.stopReasonCanRunLastSummary(s)),t.stop(s),s}static stopReasonCanRunLastSummary(e){return e==="parentNotConnected"}async start(e,t){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new Ee("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new Ee("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const r=this.runtime.clientId;if(r===void 0)throw new Ee("clientId should be defined if connected.");const i=await dS.start(this.logger,this.summaryCollection.createWatcher(r),this.configurationGetter(),async(...s)=>this.internalsProvider.submitSummary(...s),new HG(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),s=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},QG(s,!0))},this.summaryCollection,t,s=>t.stop(s));return this.runningSummarizer=i,this.starting=!1,this.handleSummaryAcks().catch(s=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},s)}),this.systemOpListener=s=>i.handleSystemOp(s),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(s,o)=>i.handleOp(s,o),this.runtime.on("batchEnd",this.opListener),i}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}async handleSummaryAcks(){var e,t,r,i,s;let o=this.runtime.deltaManager.initialSequenceNumber,a;for(;this.runningSummarizer;){const l=(e=this.runningSummarizer.tryGetCorrelatedLogger(o))!==null&&e!==void 0?e:this.logger;try{a=void 0,a=await this.summaryCollection.waitSummaryAck(o),o=a.summaryOp.referenceSequenceNumber;const c=a.summaryOp.contents.handle,u=a.summaryAck.contents.handle;await this.runningSummarizer.lockedRefreshSummaryAckAction(async()=>this.internalsProvider.refreshLatestSummaryAck(c,u,o,l).catch(async d=>{if(yP(d)&&d.errorType===Nn.fileNotFoundOrAccessDeniedError)l.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:o,proposalHandle:c,ackHandle:u},d);else throw d}))}catch(c){l.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:o,handle:(r=(t=a==null?void 0:a.summaryOp)===null||t===void 0?void 0:t.contents)===null||r===void 0?void 0:r.handle,ackHandle:(s=(i=a==null?void 0:a.summaryAck)===null||i===void 0?void 0:i.contents)===null||s===void 0?void 0:s.handle},c)}o++}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const XG=5e3,YG=4e3;var yt;(function(n){n[n.Off=0]="Off",n[n.Starting=1]="Starting",n[n.Running=2]="Running",n[n.Stopping=3]="Stopping"})(yt||(yt={}));class uf{constructor(e,t,r,i,s,o,{initialDelayMs:a=XG,opsToBypassInitialDelay:l=YG}={},c){this.clientElection=e,this.connectedState=t,this.summaryCollection=r,this.requestSummarizerFn=s,this.startThrottler=o,this.disableHeuristics=c,this.state=yt.Off,this._disposed=!1,this.handleConnected=u=>{this.latestClientId=u,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const u=this.getShouldSummarizeState();switch(this.state){case yt.Off:{u.shouldSummarize&&this.startSummarization();return}case yt.Starting:return;case yt.Running:{u.shouldSummarize===!1&&this.stop(u.stopReason);return}case yt.Stopping:return;default:return}},this.summarizeOnDemand=(...u)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...u)},this.enqueueSummarize=(...u)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...u)},this.logger=de.create(i,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=l,this.initialDelayMs=a}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){if(this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==yt.Running&&this.connectedState.clientId!==this.clientElection.electedClientId)return{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"};if(this.connectedState.connected)if(this.disposed)P(!1,608);else return{shouldSummarize:!0};else return{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){P(this.state===yt.Off,609),this.state=yt.Starting,P(this.summarizer===void 0,610),this.delayBeforeCreatingSummarizer().then(async e=>{if(e&&this.getShouldSummarizeState().shouldSummarize===!1)return"early exit";P(this.state===yt.Starting,611),this.state=yt.Running;const t=await this.requestSummarizerFn();this.summarizer=t;const r=this.getShouldSummarizeState();if(r.shouldSummarize===!1)return this.state=yt.Starting,t.stop(r.stopReason),"early exit after starting summarizer";const i=this.latestClientId;return ce.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},async()=>t.run(i,this.disableHeuristics))}).then(e=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:e})}).catch(e=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},e),this.getShouldSummarizeState().shouldSummarize||this.summarizer!==void 0){const t=(e==null?void 0:e.errorType)===Nn.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:t},e)}}).finally(()=>{var e;P(this.state!==yt.Off,612),this.state=yt.Off,(e=this.summarizer)===null||e===void 0||e.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()})}stop(e){var t;uf.isStartingOrRunning(this.state)&&(this.state=yt.Stopping,(t=this.summarizer)===null||t===void 0||t.stop(e))}async delayBeforeCreatingSummarizer(){let e=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:e,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let t=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(t=!0,e=Math.max(e,this.initialDelayMs)),e>0){let r,i;const s=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(r),i())},o=new Promise(l=>{r=setTimeout(()=>l(),e)}),a=new Promise(l=>{i=l});this.summaryCollection.addOpListener(s),await Promise.race([o,a]),this.summaryCollection.removeOpListener(s)}return t}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}uf.isStartingOrRunning=n=>n===yt.Starting||n===yt.Running;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _c{constructor(e,t){this.logger=t,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=_c.processingTime,this.schedulingCount=0,this.deltaManager=e,this.deltaManager.inbound.on("idle",()=>{this.inboundQueueIdle()})}batchBegin(e){this.processingStartTime||(this.processingStartTime=Cn.now()),this.schedulingLog===void 0&&this.schedulingCount%500===0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:Cn.now()})}batchEnd(e){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const t=Cn.now(),r=t-this.processingStartTime;r>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=r),setTimeout(()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:Qe.formatTick(r),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:Qe.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:Qe.formatTick(Cn.now()-t)}),this.deltaManager.inbound.resume()}),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const e=Cn.now();this.schedulingLog.totalProcessingTime+=e-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:Qe.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:Qe.formatTick(e-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=_c.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}_c.processingTime=50;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const QR=5e3;class ZG{constructor(e,t,r){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=Cn.now(),this.connectionStartTime=0,this.gap=0,this.logger=de.create(r,"OpPerf"),this.deltaManager.on("pong",i=>this.recordPingTime(i)),this.deltaManager.on("submitOp",i=>this.beforeOpSubmit(i)),this.deltaManager.on("op",i=>this.afterProcessingOp(i)),this.deltaManager.on("connect",(i,s)=>{this.clientId=i.clientId,s!==void 0&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=s,this.connectionStartTime=Cn.now(),this.gap<=0&&this.reportGettingUpToDate())}),this.deltaManager.on("disconnect",()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0}),this.deltaManager.outbound.on("push",i=>{for(const s of i)s.type===st.Operation&&this.clientSequenceNumberForLatencyStatistics===s.clientSequenceNumber&&(P(this.opProcessingTimes.outboundPushEventTime===void 0,712),P(this.opPerfData.durationNetwork===void 0,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),P(this.opPerfData.durationOutboundBatching===void 0,714),P(this.opProcessingTimes.submitOpEventTime!==void 0,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)}),this.deltaManager.inbound.on("push",i=>{this.clientId===i.clientId&&i.type===st.Operation&&this.clientSequenceNumberForLatencyStatistics===i.clientSequenceNumber&&this.opProcessingTimes.outboundPushEventTime!==void 0&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)}),this.deltaManager.inbound.on("idle",(i,s)=>{typeof i=="number"&&i>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:i,duration:s})})}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:Cn.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?Qe.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100===0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){this.clientSequenceNumberForLatencyStatistics===void 0&&e.clientSequenceNumber%500===1&&(P(this.opProcessingTimes.outboundPushEventTime===void 0,716),P(this.opPerfData.durationNetwork===void 0,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),this.sequenceNumberForMsnTracking===void 0&&t%1e3===0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),this.sequenceNumberForMsnTracking!==void 0&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(P(this.msnTrackingTimestamp!==void 0,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){P(this.opProcessingTimes.submitOpEventTime!==void 0,288);const r=Date.now();this.opProcessingTimes.inboundPushEventTime!==void 0&&(this.opPerfData.durationInboundToProcessing=r-this.opProcessingTimes.inboundPushEventTime);const i=r-this.opProcessingTimes.submitOpEventTime,s=i>QR?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:i,category:s,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}function e9(n,e,t){new ZG(n,e,t)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class t9{constructor(e,t,r){var i;this.stateHandler=e,this.pendingStates=new Ev,this.disposeOnce=new aS(()=>{this.initialStates.clear(),this.pendingStates.clear()}),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new Ev((i=r==null?void 0:r.pendingStates)!==null&&i!==void 0?i:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return this._pendingMessagesCount!==0||!this.initialStates.isEmpty()}getLocalState(){if(P(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map(e=>e.type==="message"?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e)}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,r,i,s,o){const a={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:r,content:i,localOpMetadata:s,opMetadata:o};this.pendingStates.push(a),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===re.FlushMode.Immediate)return;const e=this.pendingStates.peekBack();(e==null?void 0:e.type)==="message"&&this.pendingStates.push({type:"flush"})}async applyStashedOpsAt(e){for(;!this.initialStates.isEmpty();){const t=this.initialStates.peekFront();if(t.type==="message"){if(e!==void 0){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const r=await this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=r}this.pendingStates.push(this.initialStates.shift())}}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if(P(t.type==="message",361),this.pendingStates.shift(),t.clientSequenceNumber!==e.clientSequenceNumber){const r=kn.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(r);return}return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata}maybeProcessBatchBegin(e){let t,r=!1,i=this.peekNextPendingState();for(;i.type!=="message";)i.type==="flushMode"&&(t=i.flushMode),i.type==="flush"&&(r=!0),this.pendingStates.shift(),i=this.peekNextPendingState();t!==void 0&&(this.flushModeForNextMessage=t),t!==re.FlushMode.Immediate&&(t===re.FlushMode.TurnBased||r)&&(P(!this.isProcessingBatch&&this.pendingBatchBeginMessage===void 0,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,r;if(!this.isProcessingBatch)return;const i=this.peekNextPendingState();if(i.type==="message")return;P(i.type!=="flushMode",701),P(this.pendingBatchBeginMessage!==void 0,365);const s=(t=this.pendingBatchBeginMessage.metadata)===null||t===void 0?void 0:t.batch;if(this.pendingBatchBeginMessage===e)P(s===void 0,366);else{const o=(r=e.metadata)===null||r===void 0?void 0:r.batch;P(s===!0,367),P(o===!1,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(t){const r=Vh(t,i=>kn.create(`RollbackError: ${i}`,"checkpointRollback",void 0));throw this.stateHandler.close(r),r}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return P(!!e,369),e}rollbackNextPendingState(){if(this.pendingStates.length===0)return;this._pendingMessagesCount--;const t=this.pendingStates.pop();switch(t.type){case"message":this.stateHandler.rollback(t.messageType,t.content,t.localOpMetadata);break;default:throw new Error(`Can't rollback state ${t.type}`)}}replayPendingStates(){P(this.stateHandler.connected(),370),P(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),P(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(e===0)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const r=this.pendingStates.shift();switch(r.type){case"message":this.stateHandler.reSubmit(r.messageType,r.content,r.localOpMetadata,r.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(r.flushMode);break;case"flush":this.stateHandler.flush();break}e--}this.stateHandler.setFlushMode(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const dd="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class c_{constructor(e,t,r){this.path=e,this.routeContext=t,this.get=r,this.attached=!1,this.absolutePath=Xc(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}class En{constructor(e,t,r,i,s,o,a){this.routeContext=e,this.getStorage=r,this.attachBlobCallback=i,this.gcNodeUpdated=s,this.runtime=o,this.logger=a,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",()=>{for(const l of this.pendingBlobIds.values())l.reject(new Error("runtime disposed while blobAttach op in flight"))}),this.load(t)}hasBlob(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}getBlobGCNodePath(e){return`/${En.basePath}/${e}`}async getBlob(e){var t,r;const i=(r=(t=this.redirectTable)===null||t===void 0?void 0:t.get(e))!==null&&r!==void 0?r:e;return P(this.hasBlob(i),287),this.gcNodeUpdated(this.getBlobGCNodePath(e)),new c_(`${En.basePath}/${i}`,this.routeContext,async()=>ce.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:i},async()=>this.getStorage().readBlob(i),{end:!0,cancel:"error"}))}async createBlob(e){var t,r;this.runtime.attachState===te.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise(o=>this.runtime.once("attached",o))),!this.runtime.connected&&this.runtime.attachState===te.Attached&&await new Promise(o=>this.runtime.once("connected",o));const i=await ce.timedExecAsync(this.logger,{eventName:"createBlob"},async()=>this.getStorage().createBlob(e),{end:!0,cancel:"error"}),s=new c_(`${En.basePath}/${i.id}`,this.routeContext,async()=>this.getBlob(i.id).then(async o=>o.get()));return this.runtime.attachState===te.Detached?(this.detachedBlobIds.add(i.id),s):(this.pendingBlobIds.has(i.id)?await((t=this.pendingBlobIds.get(i.id))===null||t===void 0?void 0:t.promise):this.blobIds.has(i.id)||(this.pendingBlobIds.set(i.id,new Bt),this.attachBlobCallback(i.id),await((r=this.pendingBlobIds.get(i.id))===null||r===void 0?void 0:r.promise)),s)}processBlobAttachOp(e,t){if(t){const r=this.pendingBlobIds.get(e);P(r!==void 0,504),r.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}static async load(e,t){if(!e)return{};let r;const i=e.blobs[this.redirectTableBlobName];return i&&(r=await t(i)),{ids:Object.entries(e.blobs).filter(([o,a])=>o!==this.redirectTableBlobName).map(([o,a])=>a),redirectTable:r}}load(e){var t,r,i;if(e.ids){const s=this.runtime.attachState===te.Detached;e.ids.map(o=>s?this.detachedBlobIds.add(o):this.blobIds.add(o))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:(r=(t=e.ids)===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:0,redirectTable:(i=e.redirectTable)===null||i===void 0?void 0:i.length})}getGCData(e=!1){const t={gcNodes:{}};if(this.blobIds.forEach(r=>{t.gcNodes[this.getBlobGCNodePath(r)]=[]}),this.redirectTable!==void 0)for(const[r,i]of this.redirectTable)t.gcNodes[this.getBlobGCNodePath(r)]=[this.getBlobGCNodePath(i)];return t}deleteUnusedRoutes(e){var t;for(const r of e){const i=r.split("/");P(i.length===3&&i[1]===En.basePath,725);const s=i[2];if(!((t=this.redirectTable)===null||t===void 0)&&t.has(s)){this.redirectTable.delete(s);continue}this.blobIds.delete(s)}}summarize(e){const r=!!this.redirectTable||this.runtime.attachState!==te.Detached?this.blobIds:this.detachedBlobIds,i=new tn;return r.forEach(s=>{i.addAttachment(s)}),this.redirectTable&&this.redirectTable.size>0&&i.addBlob(En.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),i.getSummaryTree()}setRedirectTable(e){P(this.runtime.attachState===te.Detached,594),P(!this.redirectTable,595);for(const[t,r]of e)P(this.detachedBlobIds.delete(t),596),this.blobIds.add(r);P(this.detachedBlobIds.size===0,597),this.redirectTable=e}}En.basePath="_blobs";En.redirectTableBlobName=".redirectTable";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class n9{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new aS(()=>{for(const[t,r]of this.deferredContexts)r.promise.then(i=>{i.dispose()}).catch(i=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:t},i)})}),this.dispose=()=>this.disposeOnce.value,this._logger=de.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(!(this._contexts.get(e)===void 0||!this.notBoundContexts.has(e)))return this._contexts.get(e)}addUnbound(e){const t=e.id;P(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}async getBoundOrRemoted(e,t){const r=this.ensureDeferred(e);if(!(!t&&!r.isCompleted))return r.promise}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const r=new Bt;return this.deferredContexts.set(e,r),r}bind(e){const t=this.notBoundContexts.delete(e);P(t,345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);P(!!t,346),P(!this.notBoundContexts.has(e),347);const r=this.deferredContexts.get(e);P(!!r,348),r.resolve(t)}addBoundOrRemoted(e){const t=e.id;P(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var r9=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const i9=1,$i="gc",XR="__gc",s9="Fluid.GarbageCollection.RunGC",o9="Fluid.GarbageCollection.RunSweep",a9="Fluid.GarbageCollection.GCTestMode",l9="Fluid.GarbageCollection.WriteDataAtRoot",c9="Fluid.GarbageCollection.RunSessionExpiry",u9="Fluid.GarbageCollection.DisableSessionExpiry",d9="Fluid.GarbageCollection.TrackGCState",h9="Fluid.GarbageCollection.DisableSweepLog",fS=1*24*60*60*1e3,f9=7*fS,p9=30*fS,Jt={DataStore:"DataStore",SubDataStore:"SubDataStore",Blob:"Blob",Other:"Other"},Sn={Active:"Active",Inactive:"Inactive",SweepReady:"SweepReady"};class u_{constructor(e,t,r,i){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=r,this._state=Sn.Active,i!==void 0&&this.updateTracking(i)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(this.sweepTimeoutMs!==void 0&&t>=this.sweepTimeoutMs){this._state=Sn.SweepReady,this.clearTimers();return}if(t>=this.inactiveTimeoutMs){this._state=Sn.Inactive,this.clearTimers(),this.sweepTimeoutMs!==void 0&&ah(this.sweepTimeoutMs-t,()=>{this._state=Sn.SweepReady},i=>{this.sweepTimer=i});return}const r=this.inactiveTimeoutMs-t;if(this.inactiveTimer===void 0){const i=()=>{this._state=Sn.Inactive,this.sweepTimeoutMs!==void 0&&ah(this.sweepTimeoutMs-this.inactiveTimeoutMs,()=>{this._state=Sn.SweepReady},s=>{this.sweepTimer=s})};this.inactiveTimer=new cf(r,()=>i())}this.inactiveTimer.restart(r)}clearTimers(){var e;(e=this.inactiveTimer)===null||e===void 0||e.clear(),this.sweepTimer!==void 0&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=Sn.Active}}let m9=class YR{constructor(e){var t,r,i,s,o,a,l;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=i9,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const c=e.baseSnapshot,u=e.metadata,d=e.readAndParseBlob;this.mc=qa(de.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}}));let h;if(e.existing)h=m_(u),this.gcEnabled=h>0,this.sweepEnabled=(t=u==null?void 0:u.sweepEnabled)!==null&&t!==void 0?t:!1,this.sessionExpiryTimeoutMs=u==null?void 0:u.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&this.gcOptions.gcAllowed===!1)throw new Ee("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=this.gcOptions.gcAllowed!==!1,this.sweepEnabled=this.gcOptions.sweepAllowed===!0,this.mc.config.getBoolean(c9)&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=p9)}if(this.sessionExpiryTimeoutMs!==void 0&&this.mc.config.getBoolean(u9)!==!0){const g=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),S=g??this.sessionExpiryTimeoutMs;ah(S,()=>{this.runtime.closeFn(new dH("Client session expired.",S))},m=>{this.sessionExpiryTimer=m}),e.snapshotCacheExpiryMs!==void 0&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+fS)}if(this.latestSummaryGCVersion=h??this.currentGCVersion,this.shouldRunGC=(r=this.mc.config.getBoolean(s9))!==null&&r!==void 0?r:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&this.sweepTimeoutMs!==void 0&&((i=this.mc.config.getBoolean(o9))!==null&&i!==void 0?i:this.sweepEnabled),this.trackGCState=this.mc.config.getBoolean(d9)===!0,this.inactiveTimeoutMs=(o=(s=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))!==null&&s!==void 0?s:this.gcOptions.inactiveTimeoutMs)!==null&&o!==void 0?o:f9,this.sweepTimeoutMs!==void 0&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new Ee("inactive timeout should not be greated than the sweep timeout");if(this.testMode=(a=this.mc.config.getBoolean(a9))!==null&&a!==void 0?a:this.gcOptions.runGCInTestMode===!0,this._writeDataAtRoot=(l=this.mc.config.getBoolean(l9))!==null&&l!==void 0?l:!0,this._writeDataAtRoot){const g=(c==null?void 0:c.trees[$i])!==void 0;this.initialStateNeedsReset=g!==this.shouldRunGC}const f=new aa(async()=>{var g;if(c===void 0)return;const S=c.trees[$i];if(S!==void 0){this._writeDataAtRoot=!0;const y=await d_(S,d);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(vm(y))),y}const m={gcNodes:{"/":{outboundRoutes:[]}}},v=rk(c,u);P(v!==void 0,680);for(const[y,b]of Object.entries(v.trees)){const w=b.blobs[re.gcBlobKey];if(w===void 0)continue;const T=await d(w);if(((g=T.gcData)===null||g===void 0?void 0:g.gcNodes)===void 0)continue;const E=`/${y}`;(await d(b.blobs[oo])).isRootDataStore&&m.gcNodes["/"].outboundRoutes.push(E);for(const[A,F]of Object.entries(T.gcData.gcNodes)){const X=A==="/"?E:`${E}${A}`;m.gcNodes[X]={outboundRoutes:Array.from(F)}}P(m.gcNodes[E]!==void 0,681),m.gcNodes[E].unreferencedTimestampMs=T.unrefTimestamp}return Object.keys(m.gcNodes).length===1?void 0:m});this.initializeBaseStateP=new aa(async()=>{const g=this.runtime.getCurrentReferenceTimestampMs(),S=await f;if(S===void 0)return;const m={};for(const[v,y]of Object.entries(S.gcNodes))y.unreferencedTimestampMs!==void 0&&this.unreferencedNodesState.set(v,new u_(y.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,g)),m[v]=Array.from(y.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:m}}),this.baseGCDetailsP=new aa(async()=>{const g=await f;if(g===void 0)return new Map;const S={};for(const[y,b]of Object.entries(g.gcNodes))S[y]=Array.from(b.outboundRoutes);const m=mm(S,["/"]).referencedNodeIds,v=UR({gcData:{gcNodes:S},usedRoutes:m});for(const[y,b]of Object.entries(g.gcNodes))if(b.unreferencedTimestampMs!==void 0){const w=v.get(y.slice(1));w!==void 0&&(w.unrefTimestamp=b.unreferencedTimestampMs)}return v});const p=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:p}),this.shouldRunGC&&this.initializeBaseStateP.catch(g=>{const S=kn.wrapIfUnrecognized(g,"FailedToInitializeGC");throw S.addTelemetryProperties({gcConfigs:p}),S})}static create(e){return new YR(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}async collectGarbage(e){const{fullGC:t=this.gcOptions.runFullGC===!0||this.summaryStateNeedsReset}=e,r=e.logger?de.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return ce.timedExecAsync(r,{eventName:"GarbageCollection"},async i=>{await this.runPreGCSteps();const s=await this.runtime.getGCData(t),o=mm(s.gcNodes,["/"]),a=await this.runPostGCSteps(s,o,r);return i.end(Object.assign({},a)),this.completedRuns++,a},{end:!0,cancel:"error"})}async runPreGCSteps(){await this.initializeBaseStateP,await this.runtime.updateStateBeforeGC()}async runPostGCSteps(e,t,r){const i=this.generateStats(t);this.updateStateSinceLastRun(e,r);const s=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,s),this.runtime.updateUsedRoutes(t.referencedNodeIds,s),this.logSweepEvents(r,s),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),await this.logUnreferencedEvents(r),i}summarize(e,t,r){var i;if(!this.shouldRunGC||this.previousGCDataFromLastRun===void 0)return;const s={gcNodes:{}};for(const[l,c]of Object.entries(this.previousGCDataFromLastRun.gcNodes))s.gcNodes[l]={outboundRoutes:c,unreferencedTimestampMs:(i=this.unreferencedNodesState.get(l))===null||i===void 0?void 0:i.unreferencedTimestampMs};const o=JSON.stringify(vm(s));if(this.trackGCState&&(this.pendingSerializedSummaryState=o,this.latestSerializedSummaryState!==void 0&&this.latestSerializedSummaryState===o&&!e&&t)){const l=ls();return l.handleNodeCount++,{summary:{type:Zi.Handle,handle:`/${$i}`,handleType:Zi.Tree},stats:l}}const a=new tn;return a.addBlob(`${XR}_root`,o),a.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}async getBaseGCDetails(){return this.baseGCDetailsP}async latestSummaryStateRefreshed(e,t){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked){this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0);return}const r=e.snapshot,i=r.blobs[Rv];if(i){const o=await t(i);this.latestSummaryGCVersion=m_(o)}const s=r.trees[$i];if(s!==void 0&&this.trackGCState){const o=await d_(s,t);this.latestSerializedSummaryState=JSON.stringify(vm(o))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0}nodeUpdated(e,t,r,i,s){if(!this.shouldRunGC)return;const o=this.unreferencedNodesState.get(e);o&&o.state!==Sn.Active&&this.inactiveNodeUsed(t,e,o,void 0,i,r,s)}addedOutboundReference(e,t){var r;if(!this.shouldRunGC)return;const i=(r=this.newReferencesSinceLastRun.get(e))!==null&&r!==void 0?r:[];i.push(t),this.newReferencesSinceLastRun.set(e,i);const s=this.unreferencedNodesState.get(t);s&&s.state!==Sn.Active&&this.inactiveNodeUsed("Revived",t,s,e)}dispose(){this.sessionExpiryTimer!==void 0&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,r){this.previousGCDataFromLastRun=Wl(e),this.newReferencesSinceLastRun.clear();for(const i of t.referencedNodeIds){const s=this.unreferencedNodesState.get(i);s!==void 0&&(s.stopTracking(),this.unreferencedNodesState.delete(i))}if(r!==void 0)for(const i of t.deletedNodeIds){const s=this.unreferencedNodesState.get(i);s===void 0?this.unreferencedNodesState.set(i,new u_(r,this.inactiveTimeoutMs,this.sweepTimeoutMs,r)):s.updateTracking(r)}}updateStateSinceLastRun(e,t){if(this.previousGCDataFromLastRun===void 0)return;const r=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&r.length>0&&r.forEach(o=>{const a={eventName:"gcUnknownOutboundReferences",gcNodeId:o[0],gcRoutes:JSON.stringify(o[1])};t.sendPerformanceEvent(a)}),this.newReferencesSinceLastRun.size===0)return;const i=OG(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach((o,a)=>{i.gcNodes[a]===void 0?i.gcNodes[a]=o:i.gcNodes[a].push(...o)});const s=mm(i.gcNodes,["/"]);for(const o of s.referencedNodeIds){const a=this.unreferencedNodesState.get(o);a!==void 0&&(a.stopTracking(),this.unreferencedNodesState.delete(o))}}findMissingExplicitReferences(e,t,r){P(t!==void 0,695);const i=Object.entries(e.gcNodes),s=[];return i.forEach(([o,a])=>{var l,c;const u=(l=t.gcNodes[o])!==null&&l!==void 0?l:[],d=(c=r.get(o))!==null&&c!==void 0?c:[],h=[];a.forEach(f=>{const p=this.runtime.getNodeType(f)===Jt.Blob||this.runtime.getNodeType(f)===Jt.DataStore,g=!o.startsWith(f);p&&g&&!u.includes(f)&&!d.includes(f)&&h.push(f)}),h.length>0&&s.push([o,h])}),s}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},r=(i,s)=>{t.nodeCount++;const o=this.previousGCDataFromLastRun===void 0||this.unreferencedNodesState.has(i)===s;o&&t.updatedNodeCount++,s||t.unrefNodeCount++,this.runtime.getNodeType(i)===Jt.DataStore&&(t.dataStoreCount++,o&&t.updatedDataStoreCount++,s||t.unrefDataStoreCount++),this.runtime.getNodeType(i)===Jt.Blob&&(t.attachmentBlobCount++,o&&t.updatedAttachmentBlobCount++,s||t.unrefAttachmentBlobCount++)};for(const i of e.referencedNodeIds)r(i,!0);for(const i of e.deletedNodeIds)r(i,!1);return t}logSweepEvents(e,t){this.mc.config.getBoolean(h9)===!0||t===void 0||this.sweepTimeoutMs===void 0||this.unreferencedNodesState.forEach((r,i)=>{if(r.state!==Sn.SweepReady)return;const s=this.runtime.getNodeType(i);if(s!==Jt.DataStore&&s!==Jt.Blob)return;const o=`Deleted-${i}`;this.loggedUnreferencedEvents.has(o)||(this.loggedUnreferencedEvents.add(o),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:i,type:s,age:t-r.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))})}inactiveNodeUsed(e,t,r,i,s,o=this.runtime.getCurrentReferenceTimestampMs(),a){if(o===void 0||r.state===Sn.Active||!this.isSummarizerClient&&e!=="Loaded")return;const l=this.runtime.getNodeType(t);if(l!==Jt.DataStore&&l!==Jt.Blob)return;const c=r.state,u=`${c}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(u))return;this.loggedUnreferencedEvents.add(u);const d={id:t,type:l,unrefTime:r.unreferencedTimestampMs,age:o-r.unreferencedTimestampMs,timeout:r.state===Sn.Inactive?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:a==null?void 0:a[es.externalRequest],viaHandle:a==null?void 0:a[es.viaHandle],fromId:i};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},d),{usageType:e,state:c})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},d),{eventName:`${c}Object_${e}`,pkg:s?{value:s.join("/"),tag:Ae.CodeArtifact}:void 0}))}async logUnreferencedEvents(e){for(const t of this.pendingEventsQueue){const{usageType:r,state:i}=t,s=r9(t,["usageType","state"]),o=this.unreferencedNodesState.get(t.id),a=o===void 0||o.state===Sn.Active;if(r==="Revived"===a){const l=await this.getNodePackagePath(t.id),c=t.fromId?await this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},s),{eventName:`${i}Object_${r}`,pkg:l?{value:l.join("/"),tag:Ae.CodeArtifact}:void 0,fromPkg:c?{value:c.join("/"),tag:Ae.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]}};async function d_(n,e){let t={gcNodes:{}};for(const r of Object.keys(n.blobs)){if(!r.startsWith(XR))continue;const i=n.blobs[r];if(i===void 0)continue;const s=await e(i);P(s!==void 0,685),t=xG(t,s)}return t}function vm(n){const e=Object.entries(n.gcNodes);e.sort(([r],[i])=>r.localeCompare(i));const t={gcNodes:{}};for(const[r,i]of e)i.outboundRoutes.sort(),t.gcNodes[r]=i;return t}function ah(n,e,t){let i;if(n>2147483647){const s=n-2147483647;i=setTimeout(()=>ah(s,e,t),2147483647)}else i=setTimeout(()=>e(),n);t(i)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ZR(n){return n.summaryFormatVersion?n.summaryFormatVersion:n.snapshotFormatVersion==="0.1"?1:0}function ek(n){return!!n.summaryFormatVersion&&!n.disableIsolatedChannels}const g9=n=>n===void 0?void 0:{clientId:n.clientId,clientSequenceNumber:n.clientSequenceNumber,minimumSequenceNumber:n.minimumSequenceNumber,referenceSequenceNumber:n.referenceSequenceNumber,sequenceNumber:n.sequenceNumber,timestamp:n.timestamp,type:n.type},h_=".aliases",Rv=".metadata",f_=".chunks",p_=".electedSummarizer",kv=".blobs";function v9(n){return!!n&&!n.disableIsolatedChannels}function m_(n){var e;return n&&(e=n.gcFeature)!==null&&e!==void 0?e:0}const y9=".protocol",S9=[y9,".logTail",".serviceProtocol",kv,$i],oo=".component";function lh(n){n.summary={type:Zi.Tree,tree:{[re.channelsTreeName]:n.summary}},n.stats.treeNodeCount++}async function b9(n,e){const t=await mt(n,e.blobs[oo]),r=ZR(t);return P(r>0,469),t}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function pS(n,e,t){const r=JSON.stringify(n);return t?{pkg:r,snapshotFormatVersion:"0.1",isRootDataStore:e}:{pkg:r,summaryFormatVersion:2,isRootDataStore:e}}function w9(n,e,t){const r=pS(n,e,t);return new RP(oo,JSON.stringify(r))}class Zc extends Ua{constructor(e,t,r,i,s){super(),this.existing=t,this.bindState=r,this.isLocalDataStore=i,this.makeLocallyVisibleFn=s,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=e.runtime,this.id=e.id,this.storage=e.storage,this.scope=e.scope,this.writeGCDataAtRoot=e.writeGCDataAtRoot,this.disableIsolatedChannels=e.disableIsolatedChannels,this.pkg=e.pkg,P(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==te.Detached&&this.existing?this.containerRuntime.attachState:te.Detached,this.bindToContext=()=>{P(this.bindState===wn.NotBound,315),this.bindState=wn.Binding,P(this.channel!==void 0,316),this.makeLocallyVisible(),this.bindState=wn.Bound};const o=async(a,l,c)=>this.summarizeInternal(a,l,c);this.summarizerNode=e.createSummarizerNodeFn(o,async a=>this.getGCDataInternal(a),async()=>this.getBaseGCDetails()),this.subLogger=de.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new TP(Zc.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return P(this.pkg!==void 0,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}async isRoot(){return this.isInMemoryRoot()||(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then(e=>{e.dispose()}).catch(e=>{}))}rejectDeferredRealize(e,t){throw new ae(e,{packageName:{value:t,tag:Ae.PackageData}})}async realize(){return P(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new Bt,this.realizeCore(this.existing).catch(e=>{var t;const r=kn.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");r.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"RealizeError"},r)})),this.channelDeferred.promise}async factoryFromPackagePath(e){P(this.pkg===e,318),e===void 0&&this.rejectDeferredRealize("packages is undefined");let t,r=this._containerRuntime.IFluidDataStoreRegistry,i;for(const o of e)r||this.rejectDeferredRealize("No registry for package",i),i=o,t=await r.get(o),t||this.rejectDeferredRealize("Registry does not contain entry for the package",o),r=t.IFluidDataStoreRegistry;const s=t==null?void 0:t.IFluidDataStoreFactory;return s===void 0&&this.rejectDeferredRealize("Can't find factory for package",i),{factory:s,registry:r}}async realizeCore(e){const t=await this.getInitialSnapshotDetails();this._baseSnapshot=t.snapshot;const r=t.pkg,{factory:i,registry:s}=await this.factoryFromPackagePath(r);P(this.registry===void 0,319),this.registry=s;const o=await i.instantiateDataStore(this,e);P(o!==void 0,320),this.bindRuntime(o)}setConnectionState(e,t){this.verifyNotClosed(),this.loaded&&(P(this.connected===e,321),this.channel.setConnectionState(e,t))}process(e,t,r){var i;this.verifyNotClosed();const s=e.contents,o=Object.assign(Object.assign({},e),{type:s.type,contents:s.content});if(this.summarizerNode.recordChange(o),this.loaded)return(i=this.channel)===null||i===void 0?void 0:i.process(o,t,r);P(!t,322),P(this.pending!==void 0,573),this.pending.push(o),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(e,t){var r;this.verifyNotClosed(),this.loaded&&((r=this.channel)===null||r===void 0||r.processSignal(e,t))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){await this.realize();const i=await this.channel.summarize(e,t,r);let s;this.disableIsolatedChannels||(lh(i),s=[re.channelsTreeName]);const{pkg:o}=await this.getInitialSnapshotDetails(),a=await this.isRoot(),l=pS(o,a,this.disableIsolatedChannels);return Tr(i,oo,JSON.stringify(l)),this.writeGCDataAtRoot||Tr(i,re.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(i.summary.unreferenced=!0,i.stats.unreferencedBlobSize=i.stats.totalBlobSize),Object.assign(Object.assign({},i),{id:this.id,pathPartsForChildren:s})}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return await this.realize(),P(this.channel!==void 0,323),this.channel.getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}updateChannelUsedRoutes(){if(P(this.loaded,324),P(this.channel!==void 0,325),this.lastUsedState===void 0)return;const e=this.lastUsedState.usedRoutes.filter(t=>t!=="/"&&t!=="");this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}async request(e){return(await this.realize()).request(e)}submitMessage(e,t,r){this.verifyNotClosed(),P(!!this.channel,326);const i={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,i,r)}setChannelDirty(e){this.verifyNotClosed();const t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);const r=this.summarizerNode.getChild(e);r&&r.invalidate(t)}submitSignal(e,t){return this.verifyNotClosed(),P(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}makeLocallyVisible(){P(this.channel!==void 0,719),this.makeLocallyVisibleFn()}bindRuntime(e){var t;if(this.channel)throw new Error("Runtime already bound");try{P(!this.detachedRuntimeCreation,328),P(this.channelDeferred!==void 0,329),P(this.pkg!==void 0,330);const r=this.pending;for(const i of r)e.process(i,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",r.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(r){(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},r)}}async getAbsoluteUrl(e){if(this.attachState===te.Attached)return this._containerRuntime.getAbsoluteUrl(e)}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(e,t){P(!!this.channel,331);const r=e;this.channel.reSubmit(r.type,r.content,t)}rollback(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");const r=e;this.channel.rollback(r.type,r.content,t)}async applyStashedOp(e){this.channel||await this.realize(),P(!!this.channel,332);const t=e;return this.channel.applyStashedOp(t.content)}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(e,t){return(r,i,s)=>this.summarizerNode.createChild(r,e,t,{throwOnFailure:!0},i,s)}async uploadBlob(e){return this.containerRuntime.uploadBlob(e)}}Zc.pendingOpsCountThreshold=1e3;class g_ extends Zc{constructor(e){super(e,!0,wn.Bound,!1,()=>{throw new Error("Already attached")}),this.initialSnapshotDetailsP=new aa(async()=>{var t,r;let i,s=!0;if(typeof this.initSnapshotValue=="string"){const a=(await this.storage.getVersions(this.initSnapshotValue,1))[0];i=(t=await this.storage.getSnapshotTree(a))!==null&&t!==void 0?t:void 0}else i=this.initSnapshotValue;const o=async a=>mt(this.storage,a);if(i){const a=await this.summarizerNode.loadBaseSummary(i,o);i=a.baseSummary,this.pending=a.outstandingOps.concat(this.pending)}if(i&&i.blobs[oo]!==void 0){const a=await o(i.blobs[oo]);let l;ZR(a)<1?a.pkg.startsWith('["')&&a.pkg.endsWith('"]')?l=JSON.parse(a.pkg):l=[a.pkg]:l=JSON.parse(a.pkg),this.pkg=l,s=(r=a.isRootDataStore)!==null&&r!==void 0?r:!0,ek(a)&&(i=i.trees[re.channelsTreeName],P(i!==void 0,510))}return{pkg:this.pkg,isRootDataStore:s,snapshot:i}}),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new aa(async()=>{var t;return(t=await e.getBaseGCDetails())!==null&&t!==void 0?t:{}})}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}async getInitialGCSummaryDetails(){return this.getBaseGCDetails()}async getBaseGCDetails(){return this.baseGCDetailsP}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class tk extends Zc{constructor(e){super(e,e.snapshotTree!==void 0,e.snapshotTree?wn.Bound:wn.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,e.isRootDataStore===!0&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",()=>{P(this.attachState===te.Detached,333),this._attachState=te.Attaching}),this.once("attached",()=>{P(this.attachState===te.Attaching,334),this._attachState=te.Attached})}generateAttachMessage(){P(this.channel!==void 0,335),P(this.pkg!==void 0,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||lh(e);const t=pS(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);Tr(e,oo,JSON.stringify(t));const r=rS(e.summary);return{id:this.id,snapshot:r,type:this.pkg[this.pkg.length-1]}}async getInitialSnapshotDetails(){var e;let t=this.snapshotTree,r,i=!1;return t!==void 0&&(r=await b9(this.storage,t),ek(r)&&(t=t.trees[re.channelsTreeName],P(t!==void 0,511)),this.pkg===void 0&&(this.pkg=JSON.parse(r.pkg),(!((e=r.isRootDataStore)!==null&&e!==void 0)||e)&&(i=!0,this.setInMemoryRoot()))),P(this.pkg!==void 0,338),{pkg:this.pkg,isRootDataStore:i,snapshot:t}}async getInitialGCSummaryDetails(){return{}}async getBaseGCDetails(){return{}}}class v_ extends tk{constructor(e){super(e)}}class C9 extends tk{constructor(e){super(e),this.detachedRuntimeCreation=!0}async attachRuntime(e,t){P(this.detachedRuntimeCreation,340),P(this.channelDeferred===void 0,341);const r=e.IFluidDataStoreFactory,i=await this.factoryFromPackagePath(this.pkg);P(i.factory===r,342),P(this.registry===void 0,343),this.registry=i.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new Bt,super.bindRuntime(t),await this.isRoot()&&(t.makeVisibleAndAttachGraph!==void 0?t.makeVisibleAndAttachGraph():t.bindToContext())}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const nk=n=>typeof(n==null?void 0:n.internalId)=="string"&&typeof(n==null?void 0:n.alias)=="string",ym=(n,e,t,r,i)=>new E9(n,e,t,r,i);var vr;(function(n){n.Aliased="Aliased",n.Aliasing="Aliasing",n.None="None"})(vr||(vr={}));class E9{constructor(e,t,r,i,s){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=r,this.datastores=i,this.logger=s,this.aliasState=vr.None}async trySetAlias(e){if(e.includes("/"))throw new Ee(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case vr.Aliasing:return P(this.aliasResult!==void 0,790),await this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case vr.Aliased:return this.alias===e?"Success":"AlreadyAliased";case vr.None:break;default:xv(this.aliasState)}return this.aliasState=vr.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult}async trySetAliasInternal(e){const t={internalId:this.internalId,alias:e};if(this.fluidDataStoreChannel.makeVisibleAndAttachGraph!==void 0?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===te.Detached){const i=this.datastores.processAliasMessageCore(t);return this.aliasState=vr.Aliased,i?"Success":"Conflict"}return await this.ackBasedPromise(i=>{this.runtime.submitDataStoreAliasOp(t,i)}).then(i=>(this.aliasState=vr.Aliased,i&&(this.alias=e),i)).catch(i=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:Ae.UserData},internalId:{value:this.internalId,tag:Ae.PackageData}},i),this.aliasState=vr.None,!1))?"Success":"Conflict"}async request(e){return this.fluidDataStoreChannel.request(e)}get IFluidRouter(){return this.fluidDataStoreChannel}async ackBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _9{constructor(e,t,r,i,s,o,a,l,c,u,d=new n9(o)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=r,this.getCreateChildSummarizerNodeFn=i,this.deleteChildSummarizerNodeFn=s,this.gcNodeUpdated=l,this.aliasMap=c,this.writeGCDataAtRoot=u,this.contexts=d,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new aS(()=>this.contexts.dispose()),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=de.create(o),this.containerRuntimeHandle=new ca(this.runtime,"/",this.runtime.IFluidHandleContext);const h=new aa(async()=>a()),f=async S=>(await h).get(S),p=new Map;if(e)for(const[S,m]of Object.entries(e.trees))p.set(S,m);let g=0;for(const[S,m]of p){let v;if(m.unreferenced&&g++,this.runtime.attachState!==te.Detached)v=new g_({id:S,snapshotTree:m,getBaseGCDetails:async()=>f(S),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(S,{type:re.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if(typeof m!="object")throw new ae("Snapshot should be there to load from!!");const y=m;v=new v_({id:S,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(S,{type:re.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(S),snapshotTree:y,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(v)}this.containerLoadStats={containerLoadDataStoreCount:p.size,referencedDataStoreCount:p.size-g}}aliases(){return this.aliasMap}processAttachMessage(e,t){var r,i;const s=e.contents;if(this.dataStoresSinceLastGC.push(s.id),t){P(this.pendingAttach.has(s.id),350),(r=this.contexts.get(s.id))===null||r===void 0||r.emit("attached"),this.pendingAttach.delete(s.id);return}if(this.alreadyProcessed(s.id))throw new Pr("Duplicate DataStore created with existing id",Object.assign(Object.assign({},ro(e)),{dataStoreId:{value:s.id,tag:Ae.PackageData}}));const o=new Map;let a;s.snapshot&&(a=NP(s.snapshot.entries,o));const l=[s.type],c=new g_({id:s.id,snapshotTree:a,getBaseGCDetails:async()=>({}),runtime:this.runtime,storage:new hH(this.runtime.storage,o),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(s.id,{type:re.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:(i=s.snapshot)!==null&&i!==void 0?i:{entries:[w9(l,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:l});this.contexts.addBoundOrRemoted(c)}processAliasMessage(e,t,r){const i=e.contents;if(!nk(i))throw new Pr("malformedDataStoreAliasMessage",Object.assign({},ro(e)));const s=t,o=this.processAliasMessageCore(i);r&&s(o)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(t===void 0)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const r=new ca(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return this.aliasMap.get(e)!==void 0||this.contexts.get(e)!==void 0}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if(P(!!t,351),this.runtime.attachState!==te.Detached){t.emit("attaching");const r=t.generateAttachMessage();this.pendingAttach.set(e,r),this.submitAttachFn(r),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,r=ot()){P(!r.includes("/"),780);const i=new C9({id:r,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(r,{type:re.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(r),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(i),i}_createFluidDataStoreContext(e,t,r,i){P(!t.includes("/"),781);const s=new v_({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:re.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:r,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:i});return this.contexts.addUnbound(s),s}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);P(!!i,352),i.reSubmit(r.contents,t)}rollbackDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);P(!!i,744),i.rollback(r.contents,t)}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return P(!!r,353),r.applyStashedOp(t.contents)}async applyStashedAttachOp(e){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)}processFluidDataStoreOp(e,t,r){const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);P(!!o,354),o.process(s,t,r),this.gcNodeUpdated(`/${i.address}`,e.timestamp,o.isLoaded?o.packagePath:void 0)}async getDataStore(e,t){const r=await this.contexts.getBoundOrRemoted(e,t);if(r===void 0)throw sf(jn({url:e}));return r}processSignal(e,t,r){const i=this.contexts.get(e);if(!i){P(!r,355),this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:Ae.PackageData}});return}i.processSignal(t,r)}setConnectionState(e,t){for(const[r,i]of this.contexts)try{i.setConnectionState(e,t)}catch(s){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:r},s)}}setAttachState(e){let t;e===te.Attaching?t="attaching":t="attached";for(const[,r]of this.contexts)this.contexts.isNotBound(r.id)||r.emit(t)}get size(){return this.contexts.size}async summarize(e,t,r){const i=new tn;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>(P(o.attachState!==te.Attaching,357),o.attachState===te.Attached)).map(async([s,o])=>{const a=await o.summarize(e,t,r);i.addWithStats(s,a)})),i.getSummaryTree()}createSummary(e){const t=new tn;let r;do{const i=t.summary.tree;r=this.contexts.notBoundLength(),Array.from(this.contexts).filter(([s,o])=>!(this.contexts.isNotBound(s)||i[s]||this.attachOpFiredForDataStore.has(s))).map(([s,o])=>{let a;if(o.isLoaded){const l=o.generateAttachMessage().snapshot;a=tS(l,!0)}else P(!!this.baseSnapshot,358),a=nS(this.baseSnapshot.trees[s]);t.addWithStats(s,a)})}while(r!==this.contexts.notBoundLength());return t.getSummaryTree()}async updateStateBeforeGC(){for(const e of this.dataStoresSinceLastGC){const t=this.contexts.get(e);if(P(t!==void 0,694),await t.isRoot()){const r=new ca(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r)}}this.dataStoresSinceLastGC=[]}async getGCData(e=!1){const t=new sS;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>i.attachState===te.Attached).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),t.addNode("/",await this.getOutboundRoutes()),t.getGCData()}updateUsedRoutes(e,t){var r;const i=HR(e);for(const[s]of i)P(this.contexts.has(s),359);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}deleteUnusedRoutes(e){for(const t of e){const r=t.split("/");if(r.length>2)continue;const i=r[1];P(this.contexts.has(i),727),this.contexts.delete(i),this.deleteChildSummarizerNodeFn(i)}}async getOutboundRoutes(){const e=[];for(const[t,r]of this.contexts)await r.isRoot()&&e.push(`/${t}`);return e}async getDataStorePackagePath(e){var t;const r=this.contexts.get(e.split("/")[1]);return(t=await(r==null?void 0:r.getInitialSnapshotDetails()))===null||t===void 0?void 0:t.pkg}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return t.length===2?Jt.DataStore:Jt.SubDataStore}}function rk(n,e){if(n)if(v9(e)){const t=n.trees[re.channelsTreeName];return P(!!t,360),t}else{const t={};for(const[r,i]of Object.entries(n.trees))S9.includes(r)||(t[r]=i);return Object.assign(Object.assign({},n),{trees:t})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Qr;(function(n){n[n.Local=0]="Local",n[n.Broadcast=1]="Broadcast",n[n.Acked=2]="Acked",n[n.Nacked=-1]="Nacked"})(Qr||(Qr={}));class Tc{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=Qr.Local,this.defSummaryOp=new Bt,this.defSummaryAck=new Bt}static createLocal(e,t){return new Tc(e,t)}static createFromOp(e){const t=new Tc(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===Qr.Acked}broadcast(e){return P(this.state===Qr.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=Qr.Broadcast,!0}ackNack(e){return P(this.state===Qr.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===st.SummaryAck?Qr.Acked:Qr.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class T9{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=Tc.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class x9 extends Ua{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new Bt,this.deltaManager.on("op",r=>this.handleOp(r))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-((t=(e=this.lastAck)===null||e===void 0?void 0:e.summaryAck.sequenceNumber)!==null&&t!==void 0?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new T9(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const e=Array.from(this.pendingSummaries,([,t])=>t.waitAckNack());await Promise.all(e)}return this.lastAck}async waitSummaryAck(e){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)await this.refreshWaitNextAck.promise;return this.lastAck}handleOp(e){var t;switch(e.type){case st.Summarize:{this.handleSummaryOp(e);return}case st.SummaryAck:{this.handleSummaryAck(e);return}case st.SummaryNack:{this.handleSummaryNack(e);return}default:{const r=e.timestamp;this.lastSummaryTimestamp!==void 0&&this.maxAckWaitTime!==void 0&&r-this.lastSummaryTimestamp>=this.maxAckWaitTime&&((t=this.pendingAckTimerTimeoutCallback)===null||t===void 0||t.call(this)),this.emit("default",e);return}}}handleSummaryOp(e){let t;const r=this.summaryWatchers.get(e.clientId);r&&(t=r.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=Tc.createFromOp(e),r&&r.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(st.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);if(!r||r.summaryOp===void 0){t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber});return}r.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:r.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new Bt,this.emit(st.SummaryAck,e))}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);r&&(r.ackNack(e),this.pendingSummaries.delete(t),this.emit(st.SummaryNack,e))}}class O9 extends Ua{constructor(e,t,r){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=de.create(e,"OrderedClientCollection");const i=r.getMembers();for(const[s,o]of i)this.addClient(s,o);r.on("addMember",(s,o)=>{const a=this.addClient(s,o);this.emit("addClient",a,t.lastSequenceNumber)}),r.on("removeMember",s=>{const o=t.lastSequenceNumber,a=this.removeClient(s);a===void 0?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:s,sequenceNumber:o}):this.emit("removeClient",a,o)})}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){P(t.sequenceNumber>-1,502);let r=this._youngestClient;for(;r.sequenceNumber>t.sequenceNumber;)P(r.olderClient!==void 0,503),r=r.olderClient;const i={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:r,youngerClient:r.youngerClient};return i.olderClient.youngerClient=i,i.youngerClient===void 0?this._youngestClient=i:i.youngerClient.olderClient=i,this.clientMap.set(e,i),i}removeClient(e){const t=this.clientMap.get(e);if(t!==void 0)return t.olderClient.youngerClient=t.youngerClient,t.youngerClient===void 0?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;t.youngerClient!==void 0;)e.push(t.youngerClient),t=t.youngerClient;return e}}class P9 extends Ua{constructor(e,t,r,i){super(),this.orderedClientCollection=t,this.isEligibleFn=i,this._eligibleCount=0;let s,o;for(const a of t.getAllClients())this.addClient(a,0),typeof r!="number"&&(a.clientId===r.electedClientId&&(s=a,r.electedParentId===void 0&&a.client.details.type!==on&&(o=a)),a.clientId===r.electedParentId&&(o=a));t.on("addClient",(a,l)=>this.addClient(a,l)),t.on("removeClient",(a,l)=>this.removeClient(a,l)),typeof r=="number"?this._electionSequenceNumber=r:((s==null?void 0:s.clientId)!==r.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId,clientCount:t.count}):s!==void 0&&!i(s)&&(s=o=this.findFirstEligibleParent(o),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId})),this._electedParent=o,this._electedClient=s,this._electionSequenceNumber=r.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let r=!1;const i=(e==null?void 0:e.client.details.type)===on,s=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,r=!0),this._electedParent!==e&&!i&&(this._electedParent=e,r=!0),r&&this.emit("election",e,t,s)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;t!==void 0&&(!this.isEligibleFn(t)||t.client.details.type===on);)t=t.youngerClient;return t}addClient(e,t){var r;if(this.isEligibleFn(e)){this._eligibleCount++;const i=e.client.details.type===on,s=((r=this._electedClient)===null||r===void 0?void 0:r.client.details.type)===on;this._electedClient===void 0||!s&&i?this.tryElectingClient(e,t):this._electedParent===void 0&&!i&&this.tryElectingParent(e,t)}}removeClient(e,t){var r,i,s,o,a;if(this.isEligibleFn(e)){if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==on)throw new Ee("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const l=(i=this.findFirstEligibleParent((r=this._electedParent)===null||r===void 0?void 0:r.youngerClient))!==null&&i!==void 0?i:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(l,t)}else if(this._electedParent===e){if(((s=this._electedClient)===null||s===void 0?void 0:s.client.details.type)!==on)throw new Ee("Elected client should be a summarizer client 2");const l=(a=this.findFirstEligibleParent((o=this._electedParent)===null||o===void 0?void 0:o.youngerClient))!==null&&a!==void 0?a:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(l,t)}}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,r;const i=(r=this.findFirstEligibleParent((t=this._electedParent)===null||t===void 0?void 0:t.youngerClient))!==null&&r!==void 0?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(i,e):this.tryElectingParent(i,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return(t=this.findFirstEligibleParent((e=this._electedParent)===null||e===void 0?void 0:e.youngerClient))!==null&&t!==void 0?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:(e=this.electedClient)===null||e===void 0?void 0:e.clientId,electedParentId:(t=this.electedParent)===null||t===void 0?void 0:t.clientId}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class R9{constructor(e,t,r){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=r,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(t!==void 0){const i=t-e;i>0&&(this.startTimes=this.startTimes.map(s=>s-i))}this.startTimes=this.startTimes.filter(i=>e-i<this.delayWindowMs);const r=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map(i=>i+r),r===this.maxDelayMs&&this.startTimes.shift(),r}}const k9=({multiplier:n=2,coefficient:e=1,offset:t=0,initialDelay:r=void 0}={})=>i=>Math.max(0,i<=0&&r!==void 0?r:e*Math.pow(n,i)+t);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */new Promise(()=>{});class mS{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new Bt}get cancelled(){return this._cancelled||P(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(e){const t=new mS(e);return await t.waitStart(),t}async waitStart(){if(this.runtime.disposed){this.stop("summarizerClientDisconnected");return}if(this.runtime.once("dispose",()=>this.stop("summarizerClientDisconnected")),!this.runtime.connected){const e=new Promise(t=>this.runtime.once("connected",t));await Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",()=>this.stop("summarizerClientDisconnected"))}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class N9{constructor(e,t,r,i,s=()=>Cn.now()){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=de.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",o=>{this.startBatchSequenceNumber=o.sequenceNumber,this.batchProcessingStartTimeStamp=s(),this.trackedBatchCount++}),this.batchEventEmitter.on("batchEnd",(o,a)=>{P(this.startBatchSequenceNumber!==void 0&&this.batchProcessingStartTimeStamp!==void 0,698);const l=a.sequenceNumber-this.startBatchSequenceNumber+1;l>=r&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:l,threshold:r,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp,batchError:o!==void 0}),this.trackedBatchCount%i===0&&this.logger.sendPerformanceEvent({eventName:"Length",length:l,samplingRate:i,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0})}}const L9=(n,e,t=1e3,r=1e3)=>new N9(n,e,t,r);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Sm{constructor(e,t){this.storageGetter=e,this.blobs=t}static async serializeTree(e,t){const r={};return await this.serializeTreeCore(e,r,t),r}static async serializeTreeCore(e,t,r){const i=[];for(const s of Object.values(e.trees))i.push(this.serializeTreeCore(s,t,r));for(const s of Object.values(e.blobs)){const o=await r.readBlob(s);t[s]=r_(o,"utf8")}return Promise.all(i)}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const r of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(r,t);for(const r of Object.values(e.blobs)){const i=e.blobsContents[r];P(!!i,748),t[r]=r_(i,"utf8")}}get storage(){return this._storage?this._storage:(this._storage=this.storageGetter(),this._storage)}get repositoryUrl(){return this.storage.repositoryUrl}async readBlob(e){return this.blobs[e]!==void 0?LG(this.blobs[e],"utf8"):this.storage.readBlob(e)}async getSnapshotTree(e){return this.storage.getSnapshotTree(e)}async getVersions(e,t){return this.storage.getVersions(e,t)}async createBlob(e){return this.storage.createBlob(e)}async uploadSummaryWithContext(e,t){return this.storage.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storage.downloadSummary(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Kl{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,!t&&(e.inbound.on("push",r=>{var i;const s=typeof r.contents=="string"?r.contents:(i=JSON.stringify(r.contents))!==null&&i!==void 0?i:"",o=Kl.messageHasData(r)?r.data:"";this.messageSize[Kl.messageId(r)]=s.length+o.length}),e.on("op",r=>{var i;this._nonSystemOpCount+=Sc(r)?1:0;const s=Kl.messageId(r);this._opsSizeAccumulator+=(i=this.messageSize[s])!==null&&i!==void 0?i:0,this.messageSize.delete(s)}))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return e.data!==void 0}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}var xe;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias"})(xe||(xe={}));const I9={state:"enabled",idleTime:5e3*3,maxTime:5e3*12,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6*10*1e3,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var es;(function(n){n.wait="wait",n.externalRequest="externalRequest",n.viaHandle="viaHandle"})(es||(es={}));const A9="Fluid.ContainerRuntime.UseDataStoreAliasing",M9="Fluid.ContainerRuntime.MaxConsecutiveReconnects",D9="Fluid.ContainerRuntime.MaxOpSizeInBytes",F9=768e3,z9="Fluid.ContainerRuntime.DisableOpTracking",$9=re.FlushMode.TurnBased;var y_;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(y_||(y_={}));function j9(n){if(n.type===st.Operation){if(n.contents.address!==void 0&&n.contents.type===void 0)n.type=xe.FluidDataStoreOp;else{const e=n.contents;P(e.type!==void 0,289),n.type=e.type,n.contents=e.contents}P(bc(n),290)}return n}class q9{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",i=>{if(i.length===0)return;const s=i[0].metadata;if(!(s!=null&&s.batch))return;if(i.length===1){delete s.batch;return}const o=i[i.length-1];o.metadata=Object.assign(Object.assign({},o.metadata),{batch:!1})}),this.deltaManager.inbound.on("push",i=>{this.trackPending(i)}),P(!this.localPaused,659);const r=this.deltaManager.inbound.toArray();for(const i of r)this.trackPending(i);this.deltaManager.on("op",i=>this.afterOpProcessing(i.sequenceNumber))}afterOpProcessing(e){if(P(!this.localPaused,660),this.deltaManager.inbound.length===0){P(this.pauseSequenceNumber===void 0,661);return}this.pauseSequenceNumber!==void 0&&(P(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue())}pauseQueue(){P(!this.localPaused,663),this.localPaused=!0,this.timePaused=Cn.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const r=t.sequenceNumber,i=this.localPaused?Cn.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3===1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:r,length:r-e+1,msnDistance:r-t.minimumSequenceNumber,duration:i,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,i!==void 0&&i>QR&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:i,sequenceNumber:r,length:r-e}),this.deltaManager.inbound.resume())}trackPending(e){P(this.deltaManager.inbound.length!==0,664),P(this.currentBatchClientId===void 0==(this.pauseSequenceNumber===void 0),665);const t=e.metadata,r=t==null?void 0:t.batch;if(!bc(e)){P(this.currentBatchClientId===void 0,666),P(r===void 0,667),P(!this.localPaused,668);return}if(this.currentBatchClientId===void 0&&r===void 0){P(!this.localPaused,669);return}if((this.currentBatchClientId!==void 0||r===!1)&&this.currentBatchClientId!==e.clientId)throw new Pr("OpBatchIncomplete",Object.assign({runtimeVersion:dd,batchClientId:this.currentBatchClientId},ro(e)));r?(P(this.currentBatchClientId===void 0,670),P(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,this.deltaManager.inbound.length===1&&this.pauseQueue()):r===!1?(P(this.pauseSequenceNumber!==void 0,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):P(this.currentBatchClientId!==void 0,673)}}class B9{constructor(e,t,r){this.deltaManager=e,this.emitter=t,this.logger=r,this.hitError=!1,this.deltaScheduler=new _c(this.deltaManager,de.create(this.logger,"DeltaScheduler")),new q9(e,r)}beforeOpProcessing(e){var t;this.batchClientId!==e.clientId&&(P(this.batchClientId===void 0,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e),((t=e==null?void 0:e.metadata)===null||t===void 0?void 0:t.batch)?this.batchClientId=e.clientId:this.batchClientId=void 0)}afterOpProcessing(e,t){var r;if(P(!this.hitError,675),e){this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),this.deltaScheduler.batchEnd(t);return}const i=(r=t==null?void 0:t.metadata)===null||r===void 0?void 0:r.batch;if(this.batchClientId===void 0||i===!1){this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),this.deltaScheduler.batchEnd(t);return}}}const S_="_scheduler";function U9(){try{if(typeof navigator=="object"&&navigator!==null)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch{}return{}}class gS extends Ua{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f,p){var g,S,m,v,y,b,w,T,E;p===void 0&&(p=Object.assign(Object.assign({},I9),(g=a.summaryOptions)===null||g===void 0?void 0:g.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=a,this.containerScope=l,this.logger=c,this._storage=h,this.requestHandler=f,this.summaryConfiguration=p,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...z)=>{if(this.clientDetails.type===on)return this.summarizer.summarizeOnDemand(...z);if(this.summaryManager!==void 0)return this.summaryManager.summarizeOnDemand(...z);throw new Ee(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...z)=>{if(this.clientDetails.type===on)return this.summarizer.enqueueSummarize(...z);if(this.summaryManager!==void 0)return this.summaryManager.enqueueSummarize(...z);throw new Ee(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=r==null?void 0:r.message,this.disableIsolatedChannels=(S=this.runtimeOptions.summaryOptions.disableIsolatedChannels)!==null&&S!==void 0?S:!1,this._connected=this.context.connected,this.chunkMap=new Map(s),this.handleContext=new MG("",this),this.mc=qa(de.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=((m=this.mc.config.getBoolean(A9))!==null&&m!==void 0?m:!1)||((v=a.useDataStoreAliasing)!==null&&v!==void 0?v:!1),this._maxOpSizeInBytes=(y=this.mc.config.getNumber(D9))!==null&&y!==void 0?y:F9,this.maxConsecutiveReconnects=(b=this.mc.config.getNumber(M9))!==null&&b!==void 0?b:this.defaultMaxConsecutiveReconnects,this._flushMode=a.flushMode;const O=e.pendingLocalState,A=(w=O==null?void 0:O.baseSnapshot)!==null&&w!==void 0?w:e.baseSnapshot;this.garbageCollector=m9.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:A,baseLogger:this.mc.logger,existing:u,metadata:r,isSummarizerClient:this.context.clientDetails.type===on,getNodePackagePath:async z=>this.getGCNodePackagePath(z),getLastSummaryTimestampMs:()=>{var z;return(z=this.messageAtLastSummary)===null||z===void 0?void 0:z.timestamp},readAndParseBlob:async z=>mt(this.storage,z)});const F=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=RG(de.create(this.logger,"SummarizerNode"),async(z,Z,W)=>this.summarizeInternal(z,Z,W),F,A?F:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),A&&this.summarizerNode.loadBaseSummaryWithoutDifferential(A),this.dataStores=new _9(rk(A,r),this,z=>this.submit(xe.Attach,z),(z,Z)=>(W,C,k)=>this.summarizerNode.createChild(W,z,Z,void 0,C,k),z=>this.summarizerNode.deleteChild(z),this.mc.logger,async()=>this.garbageCollector.getBaseGCDetails(),(z,Z,W)=>this.garbageCollector.nodeUpdated(z,"Changed",Z,W),new Map(o),this.garbageCollector.writeDataAtRoot),this.blobManager=new En(this.handleContext,d,()=>this.storage,z=>this.submit(xe.BlobAttach,void 0,void 0,{blobId:z}),z=>this.garbageCollector.nodeUpdated(z,"Loaded"),this,this.logger),this.scheduleManager=new B9(e.deltaManager,this,de.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new t9({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:z=>this.setFlushMode(z)},this._flushMode,O==null?void 0:O.pending),this.context.quorum.on("removeMember",z=>{this.clearPartialChunks(z)}),this.summaryCollection=new x9(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==te.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const z=de.create(this.logger,"OrderedClientElection"),Z=new O9(z,this.context.deltaManager,this.context.quorum),W=new P9(z,Z,i??this.context.deltaManager.lastSequenceNumber,la.isClientEligible);if(this.summarizerClientElection=new la(z,this.summaryCollection,W,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===on)this._summarizer=new hS("/_summarizer",this,()=>this.summaryConfiguration,this,this.handleContext,this.summaryCollection,async C=>mS.create(C));else if(la.clientDetailsPermitElection(this.context.clientDetails)){const C=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(st.SummaryAck,()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",C)}),this.summaryCollection.off("default",C))};this.summaryCollection.on("default",C),this.summaryManager=new uf(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new R9(60*1e3,30*1e3,k9({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}this.deltaManager.on("readonly",z=>{P(z===this.deltaManager.readOnlyInfo.readonly,292),P(!z||!this.connected,293),this.replayPendingStates()}),c.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},U9()));let X;u?(this.createContainerMetadata={createContainerRuntimeVersion:r==null?void 0:r.createContainerRuntimeVersion,createContainerTimestamp:r==null?void 0:r.createContainerTimestamp},X=(E=(T=r==null?void 0:r.summaryNumber)!==null&&T!==void 0?T:r==null?void 0:r.summaryCount)!==null&&E!==void 0?E:0):(this.createContainerMetadata={createContainerRuntimeVersion:dd,createContainerTimestamp:Date.now()},X=0),this.nextSummaryNumber=X+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:X,summaryFormatVersion:r==null?void 0:r.summaryFormatVersion,disableIsolatedChannels:r==null?void 0:r.disableIsolatedChannels,gcVersion:r==null?void 0:r.gcFeature})),e9(this.context.clientId,this.deltaManager,this.logger),L9(this,this.logger),this.opTracker=new Kl(this.deltaManager,this.mc.config.getBoolean(z9)===!0)}get IContainerRuntime(){return this}get IFluidRouter(){return this}static async load(e,t,r,i={},s=e.scope,o){var a,l,c;const u=e,d=(a=u.taggedLogger)!==null&&a!==void 0?a:new aH(u.logger),h=de.create(d,void 0,{all:{runtimeVersion:dd}}),{summaryOptions:f={},gcOptions:p={},loadSequenceNumberVerification:g="close",useDataStoreAliasing:S=!1,flushMode:m=$9,enableOfflineLoad:v=!1}=i,y=e.pendingLocalState,b=(l=y==null?void 0:y.baseSnapshot)!==null&&l!==void 0?l:e.baseSnapshot,w=y?new Sm(()=>e.storage,y.snapshotBlobs):e.storage,T=new lS(t),E=async k=>{const V=b==null?void 0:b.blobs[k];if(b&&V)return P(w!==void 0,501),mt(w,V)},[O,A,F,X]=await Promise.all([E(f_),E(Rv),E(p_),E(h_)]),z=o===!0||e.existing===!0,Z=await En.load(b==null?void 0:b.trees[kv],async k=>(P(w!==void 0,598),mt(w,k))),W=(c=A==null?void 0:A.message)===null||c===void 0?void 0:c.sequenceNumber;if(!y&&W!==void 0){const k=e.deltaManager.initialSequenceNumber;if(g!=="bypass"&&W!==k){const V=new Pr("Summary metadata mismatch",{runtimeVersion:dd,runtimeSequenceNumber:W,protocolSequenceNumber:k});g==="log"?h.sendErrorEvent({eventName:"SequenceNumberMismatch"},V):e.closeFn(V)}}const C=new gS(e,T,A,F,O??[],X??[],{summaryOptions:f,gcOptions:p,loadSequenceNumberVerification:g,useDataStoreAliasing:S,flushMode:m,enableOfflineLoad:v},s,h,z,Z,w,r);return y&&(await C.processSavedOps(y),y.savedOps=[]),await C.getSnapshotBlobs(),C}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return(e=this.summarizerClientElection)===null||e===void 0?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return P(this._summarizer!==void 0,599),this._summarizer}isSummariesDisabled(){return this.runtimeOptions.summaryOptions.disableSummaries===!0?!0:this.summaryConfiguration.state==="disabled"}isHeuristicsDisabled(){var e;return((e=this.runtimeOptions.summaryOptions.summarizerOptions)===null||e===void 0?void 0:e.disableHeuristics)===!0?!0:this.summaryConfiguration.state==="disableHeuristics"}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))!==null&&e!==void 0?e:!0:this.runtimeOptions.summaryOptions.summarizerClientElection===!0?!0:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.summarizerClientElection===!0:!1}getMaxOpsSinceLastSummary(){return this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary!==void 0?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return this.runtimeOptions.summaryOptions.initialSummarizerDelayMs!==void 0?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),this.summaryManager!==void 0&&this.summaryManager.dispose(),this.garbageCollector.dispose(),(t=this._summarizer)===null||t===void 0||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(!((e=this.options)===null||e===void 0)&&e.intelligence)return{intelligence:this.options.intelligence}}async request(e){try{const t=Rr.create(e);return t.pathParts[0]==="_summarizer"&&t.pathParts.length===1?this._summarizer!==void 0?{status:200,mimeType:"fluid/object",value:this.summarizer}:jn(e):this.requestHandler!==void 0?this.requestHandler(t,this):jn(e)}catch(t){return rh(t)}}async resolveHandle(e){try{const t=Rr.create(e),r=t.pathParts[0];if(r==="_channels")return this.resolveHandle(t.createSubRequest(1));if(r===En.basePath&&t.isLeaf(2)){const i=await this.blobManager.getBlob(t.pathParts[1]);return i?{status:200,mimeType:"fluid/object",value:i.get()}:jn(e)}else if(t.pathParts.length>0){const i=await this.getDataStoreFromRequest(r,e),s=t.createSubRequest(1);return P(s.url.startsWith("/"),294),i.IFluidRouter.request(s)}return jn(e)}catch(t){return rh(t)}}internalId(e){var t;return(t=this.dataStores.aliases().get(e))!==null&&t!==void 0?t:e}async getDataStoreFromRequest(e,t){var r,i,s;const o=typeof((r=t.headers)===null||r===void 0?void 0:r[es.wait])=="boolean"?(i=t.headers)===null||i===void 0?void 0:i[es.wait]:!0,a=this.internalId(e),l=await this.dataStores.getDataStore(a,o);if(!((s=t.headers)===null||s===void 0)&&s[es.externalRequest]&&this.garbageCollector.shouldRunGC){const d=(await l.getBaseGCDetails()).usedRoutes;if(!(d===void 0||d.includes("")||d.includes("/")))throw sf(jn(t))}const c=await l.realize(),u=CG(t.url.split("?")[0]);return this.garbageCollector.nodeUpdated(`/${u}`,"Loaded",void 0,l.packagePath,t==null?void 0:t.headers),c}addMetadataToSummary(e){var t;const r=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:(t=g9(this.deltaManager.lastMessage))!==null&&t!==void 0?t:this.messageAtLastSummary});Tr(e,Rv,JSON.stringify(r))}addContainerStateToSummary(e,t,r,i){var s;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const l=JSON.stringify([...this.chunkMap]);Tr(e,f_,l)}const o=this.dataStores.aliases();if(o.size>0&&Tr(e,h_,JSON.stringify([...o])),this.summarizerClientElection){const l=JSON.stringify((s=this.summarizerClientElection)===null||s===void 0?void 0:s.serialize());Tr(e,p_,l)}const a=this.blobManager.summarize();if(Object.keys(a.summary.tree).length>0&&gG(e,kv,a),this.garbageCollector.writeDataAtRoot){const l=this.garbageCollector.summarize(t,r,i);l!==void 0&&vG(e,$i,l)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0?!0:this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0)}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;this.dirtyContainer=!1,P(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;let t;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}async applyStashedOp(e,t){switch(e){case xe.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case xe.Attach:return this.dataStores.applyStashedAttachOp(t);case xe.Alias:case xe.BlobAttach:return;case xe.ChunkedOp:throw new Error("chunkedOp not expected here");case xe.Rejoin:throw new Error("rejoin not expected here");default:xv(e,`Unknown ContainerMessageType: ${e}`)}}setConnectionState(e,t){this.verifyNotClosed();const r=this._connected!==e,i=r&&e;if(this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),i&&(this.consecutiveReconnects++,!this.shouldContinueReconnecting())){this.closeFn(kn.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}));return}r&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),x0(this.mc.logger,this,e,t)}process(e,t){var r,i;if(this.verifyNotClosed(),!bc(e))return;((r=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&r!==void 0?r:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let s=Object.assign({},e);this.scheduleManager.beforeOpProcessing(s);try{s=j9(s),s=this.processRemoteChunkedMessage(s);let o;switch(t&&s.type!==xe.ChunkedOp&&(o=this.pendingStateManager.processPendingLocalMessage(s)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),s.type){case xe.Attach:this.dataStores.processAttachMessage(s,t);break;case xe.Alias:this.processAliasMessage(s,o,t);break;case xe.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(s,t,o);break;case xe.BlobAttach:P((i=s==null?void 0:s.metadata)===null||i===void 0?void 0:i.blobId,298),this.blobManager.processBlobAttachOp(s.metadata.blobId,t);break;default:}this.emit("op",s),this.scheduleManager.afterOpProcessing(void 0,s),t&&this.resetReconnectCount()}catch(o){throw this.scheduleManager.afterOpProcessing(o,s),o}}processAliasMessage(e,t,r){this.dataStores.processAliasMessage(e,t,r)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const r=e.content,i={clientId:e.clientId,content:r.contents.content,type:r.contents.type};if(e.clientId===this.clientId&&this.connected&&(this._perfSignalData.trackingSignalSequenceNumber!==void 0&&r.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:r.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:r.clientSignalSequenceNumber})):r.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(r.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),r.address===void 0){this.emit("signal",i,t);return}this.dataStores.processSignal(r.address,i,t)}async getRootDataStore(e,t=!0){const r=this.internalId(e),i=await this.dataStores.getDataStore(r,t);return P(await i.isRoot(),299),i.realize()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===re.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(P(this._orderSequentiallyCalls===0,588),!!this.deltaSender&&(this.pendingStateManager.onFlush(),!!this.needsFlush&&(this.needsFlush=!1,!!this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===re.FlushMode.TurnBased){this.trackOrderSequentiallyCalls(e);return}const t=this.flushMode;this.setFlushMode(re.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(r){throw t?t.rollback():this.closeFn(new ti("orderSequentially callback exception",r)),r}finally{this._orderSequentiallyCalls--}}async createDataStore(e){const t=ot();return ym(await this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)}async createRootDataStoreLegacy(e,t){const r=await this._createDataStore(e,!0,t);return r.makeVisibleAndAttachGraph!==void 0?r.makeVisibleAndAttachGraph():r.bindToContext(),r}async createRootDataStore(e,t){if(t.includes("/"))throw new Ee(`Id cannot contain slashes: '${t}'`);return this._aliasingEnabled===!0?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)}async createAndAliasDataStore(e,t,r){const i=ot(),s=await this._createDataStore(e,!1,i,r),o=ym(s,i,this,this.dataStores,this.mc.logger),a=await o.trySetAlias(t);if(a!=="Success")throw new ti("dataStoreAliasFailure",void 0,{alias:{value:t,tag:Ae.UserData},internalId:{value:i,tag:Ae.PackageData},aliasResult:a});return o}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new Ee(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}async _createDataStoreWithPropsLegacy(e,t,r=ot(),i=!1){const s=await this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,i,t).realize();return i&&(s.makeVisibleAndAttachGraph!==void 0?s.makeVisibleAndAttachGraph():s.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:t!==void 0})),ym(s,r,this,this.dataStores,this.mc.logger)}async _createDataStoreWithProps(e,t,r=ot(),i=!1){return this._aliasingEnabled===!0&&i?this.createAndAliasDataStore(e,r,t):this._createDataStoreWithPropsLegacy(e,t,r,i)}async _createDataStore(e,t,r=ot(),i){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,t,i).realize()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===xe.Attach){if(t.id===S_)return!1}else if(e===xe.FluidDataStoreOp&&t.address===S_)return!1;return!0}createNewSignalEnvelope(e,t,r){const i=++this._perfSignalData.signalSequenceNumber,s={address:e,clientSignalSequenceNumber:i,contents:{type:t,content:r}};return i%this.defaultTelemetrySignalSampleCount===1&&this._perfSignalData.trackingSignalSequenceNumber===void 0&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=i),s}submitSignal(e,t){this.verifyNotClosed();const r=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(r)}submitDataStoreSignal(e,t,r){const i=this.createNewSignalEnvelope(e,t,r);return this.context.submitSignalFn(i)}setAttachState(e){e===te.Attaching?P(this.attachState===te.Attaching,301):(P(this.attachState===te.Attached,302),this.emit("attached")),e===te.Attached&&!this.pendingStateManager.hasPendingMessages()&&this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const r=this.dataStores.createSummary(t);return this.disableIsolatedChannels||lh(r),this.addContainerStateToSummary(r,!0,!1,t),r.summary}async getAbsoluteUrl(e){if(this.context.getAbsoluteUrl===void 0)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===te.Attached)return this.context.getAbsoluteUrl(e)}async summarizeInternal(e,t,r){const i=await this.dataStores.summarize(e,t,r);let s;return this.disableIsolatedChannels||(lh(i),s=[re.channelsTreeName]),this.addContainerStateToSummary(i,e,t,r),Object.assign(Object.assign({},i),{id:"",pathPartsForChildren:s})}async summarize(e){this.verifyNotClosed();const{fullTree:t=!1,trackState:r=!0,summaryLogger:i=this.mc.logger,runGC:s=this.garbageCollector.shouldRunGC,runSweep:o,fullGC:a}=e;let l;s&&(l=await this.collectGarbage({logger:i,runSweep:o,fullGC:a}));const c=new SG,{stats:u,summary:d}=await this.summarizerNode.summarize(t,r,c);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:c.serialize()}),P(d.type===Zi.Tree,303),{stats:u,summary:d,gcStats:l}}async updateStateBeforeGC(){return this.dataStores.updateStateBeforeGC()}async getGCData(e){const t=new sS,r=await this.dataStores.getGCData(e);t.addNodes(r.gcNodes);const i=this.blobManager.getGCData(e);return t.addNodes(i.gcNodes),t.getGCData()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const r=[];for(const i of e)i.split("/")[1]!==En.basePath&&r.push(i);return this.dataStores.updateUsedRoutes(r,t)}deleteUnusedRoutes(e){const t=[],r=[];for(const i of e)this.isBlobPath(i)?t.push(i):r.push(i);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(r)}getCurrentReferenceTimestampMs(){var e,t,r;return(t=(e=this.deltaManager.lastMessage)===null||e===void 0?void 0:e.timestamp)!==null&&t!==void 0?t:(r=this.messageAtLastSummary)===null||r===void 0?void 0:r.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?Jt.Blob:(t=this.dataStores.getGCNodeType(e))!==null&&t!==void 0?t:Jt.Other}async getGCNodePackagePath(e){switch(this.getNodeType(e)){case Jt.Blob:return["_blobs"];case Jt.DataStore:case Jt.SubDataStore:return this.dataStores.getDataStorePackagePath(e);default:P(!1,734)}}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==En.basePath)}async collectGarbage(e){return this.garbageCollector.collectGarbage(e)}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}async submitSummary(e){var t,r,i;const{fullTree:s,refreshLatestAck:o,summaryLogger:a}=e,l=this.nextSummaryNumber,c=de.create(a,void 0,{all:{summaryNumber:l}});let u;if(o){const d=await this.refreshLatestSummaryAckFromServer(de.create(c,void 0,{all:{safeSummary:!0}})),h=d.latestSnapshotRefSeq;u=d.latestSnapshotVersionId,h>this.deltaManager.lastSequenceNumber&&await ce.timedExecAsync(c,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:h,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},async()=>H9(this.deltaManager,h),{start:!0,end:!0,cancel:"error"})}try{await this.deltaManager.inbound.pause();const d=this.deltaManager.lastSequenceNumber,h=this.deltaManager.minimumSequenceNumber,f=`Summary @${d}:${this.deltaManager.minimumSequenceNumber}`;d!==((t=this.deltaManager.lastMessage)===null||t===void 0?void 0:t.sequenceNumber)&&c.sendErrorEvent({eventName:"LastSequenceMismatch",error:f}),this.summarizerNode.startSummary(d,c);const p=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(P(this.connected,600),this.deltaManager.lastSequenceNumber!==d?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${d}`}:{continue:!0});let g=p();if(!g.continue)return{stage:"base",referenceSequenceNumber:d,minimumSequenceNumber:h,error:g.error};const S=s_.start();let m;const v=this.garbageCollector.summaryStateNeedsReset;try{m=await this.summarize({fullTree:s||v,trackState:!0,summaryLogger:c,runGC:this.garbageCollector.shouldRunGC})}catch(I){return{stage:"base",referenceSequenceNumber:d,minimumSequenceNumber:h,error:I}}const{summary:y,stats:b}=m;this.messageAtLastSummary=this.deltaManager.lastMessage;const w=this.disableIsolatedChannels?y:y.tree[re.channelsTreeName];P(w.type===Zi.Tree,508);const T=Object.values(w.tree).filter(I=>I.type===Zi.Handle).length,E=y.tree[$i]?qR(y.tree[$i]):void 0,O=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-T,gcStateUpdatedDataStoreCount:(r=m.gcStats)===null||r===void 0?void 0:r.updatedDataStoreCount,gcBlobNodeCount:E==null?void 0:E.blobNodeCount,gcTotalBlobsSize:E==null?void 0:E.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:l},b),A={referenceSequenceNumber:d,minimumSequenceNumber:h,summaryTree:y,summaryStats:O,generateDuration:S.trace().duration,forcedFullTree:v};if(g=p(),!g.continue)return Object.assign(Object.assign({stage:"generate"},A),{error:g.error});const F=this.summaryCollection.latestAck;let X;(F==null?void 0:F.summaryAck.contents.handle)!==u&&u!==void 0?X={proposalHandle:void 0,ackHandle:u,referenceSequenceNumber:d}:F===void 0?X={proposalHandle:void 0,ackHandle:(i=this.context.getLoadedFromVersion())===null||i===void 0?void 0:i.id,referenceSequenceNumber:d}:X={proposalHandle:F.summaryOp.contents.handle,ackHandle:F.summaryAck.contents.handle,referenceSequenceNumber:d};let z;try{z=await this.storage.uploadSummaryWithContext(m.summary,X)}catch(I){return Object.assign(Object.assign({stage:"generate"},A),{error:I})}const Z=X.ackHandle,W={handle:z,head:Z,message:f,parents:Z?[Z]:[]},C=Object.assign(Object.assign({},A),{handle:z,uploadDuration:S.trace().duration});if(g=p(),!g.continue)return Object.assign(Object.assign({stage:"upload"},C),{error:g.error});let k;try{k=this.submitSystemMessage(st.Summarize,W)}catch(I){return Object.assign(Object.assign({stage:"upload"},C),{error:I})}const V=Object.assign(Object.assign({stage:"submit"},C),{clientSequenceNumber:k,submitOpDuration:S.trace().duration});return this.summarizerNode.completeSummary(z),this.opTracker.reset(),V}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}}processRemoteChunkedMessage(e){if(e.type!==xe.ChunkedOp)return e;const t=e.clientId,r=e.contents;if(this.addChunk(t,r),r.chunkId===r.totalChunks){const i=Object.assign({},e),s=this.chunkMap.get(t).join("");return i.contents=JSON.parse(s),i.type=r.originalType,this.clearPartialChunks(t),i}return e}addChunk(e,t){let r=this.chunkMap.get(e);r===void 0&&(r=[],this.chunkMap.set(e,r)),P(t.chunkId===r.length+1,305),r.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,r=void 0){const i={address:e,contents:t};this.submit(xe.FluidDataStoreOp,i,r)}submitDataStoreAliasOp(e,t){if(!nk(e))throw new Ee("malformedDataStoreAliasMessage");this.submit(xe.Alias,e,t)}async uploadBlob(e){return this.verifyNotClosed(),this.blobManager.createBlob(e)}submit(e,t,r=void 0,i=void 0){this.verifyNotClosed(),P(this.attachState!==te.Detached,306);let s=-1,o=i;if(this.canSendOps()){const a=JSON.stringify(t),l=this.context.deltaManager.maxMessageSize;this.flushMode===re.FlushMode.TurnBased&&!this.needsFlush&&(o=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then(()=>{this.flushTrigger=!1,this.flush()})),s=this.submitMaybeChunkedMessages(e,t,a,l,this._flushMode===re.FlushMode.TurnBased,o)}this.pendingStateManager.onSubmitMessage(e,s,this.deltaManager.lastSequenceNumber,t,r,o),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,r,i,s,o=void 0){return this._maxOpSizeInBytes>=0?!r||r.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,s,o):(this.closeFn(new ti("OpTooLarge",void 0,{length:{value:r.length,tag:Ae.PackageData},limit:{value:this._maxOpSizeInBytes,tag:Ae.PackageData}})),-1):!r||r.length<=i?this.submitRuntimeMessage(e,t,s,o):this.submitChunkedMessage(e,r,i)}submitChunkedMessage(e,t,r){const i=t.length,s=Math.floor((i-1)/r)+1;let o=0,a=0;for(let l=1;l<=s;l=l+1){const c={chunkId:l,contents:t.substr(o,r),originalType:e,totalChunks:s};o+=r,a=this.submitRuntimeMessage(xe.ChunkedOp,c,!1)}return a}submitSystemMessage(e,t){this.verifyNotClosed(),P(this.connected,307);const r=this.flushMode===re.FlushMode.TurnBased&&this.needsFlush;return r&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,r)}submitRuntimeMessage(e,t,r,i){this.verifyNotClosed(),P(this.connected,601);const s={type:e,contents:t};return this.context.submitFn(st.Operation,s,r,i)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,r,i){switch(e){case xe.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,r);break;case xe.Attach:case xe.Alias:this.submit(e,t,r);break;case xe.ChunkedOp:throw new Error("chunkedOp not expected here");case xe.BlobAttach:this.submit(e,t,r,i);break;case xe.Rejoin:this.submit(e,t);break;default:xv(e,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,r){switch(e){case xe.FluidDataStoreOp:this.dataStores.rollbackDataStoreOp(t,r);break;default:throw new Error(`Can't rollback ${e}`)}}async refreshLatestSummaryAck(e,t,r,i){const s=async l=>mt(this.storage,l),{snapshotTree:o}=await this.fetchSnapshotFromStorage(t,i,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:r,fetchLatest:!1}),a=await this.summarizerNode.refreshLatestSummary(e,r,async()=>o,s,i);await this.garbageCollector.latestSummaryStateRefreshed(a,s)}async refreshLatestSummaryAckFromServer(e){const{snapshotTree:t,versionId:r}=await this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),i=async a=>mt(this.storage,a),s=await kG(t,i),o=await this.summarizerNode.refreshLatestSummary(void 0,s,async()=>t,i,e);return await this.garbageCollector.latestSummaryStateRefreshed(o,i),{latestSnapshotRefSeq:s,latestSnapshotVersionId:r}}async fetchSnapshotFromStorage(e,t,r){return ce.timedExecAsync(t,r,async i=>{const s={},o=s_.start(),a=await this.storage.getVersions(e,1);P(!!a&&!!a[0],311),s.getVersionDuration=o.trace().duration;const l=await this.storage.getSnapshotTree(a[0]);return P(!!l,312),s.getSnapshotDuration=o.trace().duration,i.end(s),{snapshotTree:l,versionId:a[0].id}})}notifyAttaching(e){var t;((t=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&t!==void 0?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=Sm.serializeTreeWithBlobContents(e))}async getSnapshotBlobs(){var e;!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad)||this.attachState!==te.Attached||this.context.pendingLocalState||(P(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=await Sm.serializeTree(this.context.baseSnapshot,this.storage))}getPendingLocalState(){var e;if(!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad))throw new Ee("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(P(!!this.context.baseSnapshot,742),P(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return async()=>{const t={headers:{[Ge.cache]:!1,[Ge.clientDetails]:{capabilities:{interactive:!1},type:on},[Ta.summarizingClient]:!0,[Ge.reconnect]:!1},url:"/_summarizer"},i=(await wc(e,t)).ISummarizer;if(!i)throw new Ee("Fluid object does not implement ISummarizer");return i}}async processSavedOps(e){for(const t of e.savedOps)this.process(t,!1),await this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);await this.pendingStateManager.applyStashedOpsAt()}}const H9=async(n,e)=>new Promise((t,r)=>{n.on("closed",r);const i=s=>{s.sequenceNumber>=e&&(t(),n.off("op",i))};n.on("op",i)});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class V9{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,Js(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(this.objectP===void 0){const e={url:this.absolutePath,headers:{[es.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then(t=>{if(t.mimeType==="fluid/object")return t.value;throw sf(t)})}return this.objectP}attachGraph(){}bind(e){e.attachGraph()}async request(e){try{const r=(await this.get()).IFluidRouter;return r!==void 0?r.request(e):jn(e)}catch(t){return rh(t)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const W9=n=>(n==null?void 0:n.type)==="__fluid_handle__";class ik{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(r,i)=>{const s=r==null?void 0:r.IFluidHandle;return s!==void 0?this.serializeHandle(s,i):r},this.decodeValue=r=>{if(W9(r)){const i=r.url.startsWith("/")?r.url:Xc(r.url,this.context),s=new V9(i,this.root);return this.handleParsedCb(s),s}else return r},this.root=this.context;this.root.routeContext!==void 0;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&typeof e=="object"?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&typeof e=="object"?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,(r,i)=>this.encodeValue(i,t))}parse(e){return JSON.parse(e,(t,r)=>this.decodeValue(r))}recursivelyReplace(e,t,r){const i=t(e,r);if(i!==e)return i;let s;for(const o of Object.keys(e)){const a=e[o];if(a&&typeof a=="object"){const l=this.recursivelyReplace(a,t,r);l!==a&&(s=s??(Array.isArray(e)?[...e]:Object.assign({},e)),s[o]=l)}}return s??e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class G9 extends ca{get isAttached(){return this.value.isAttached()}constructor(e,t,r){super(e,t,r)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class K9 extends ik{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class J9 extends T0{constructor(e,t,r){super((i,s)=>this.eventListenerErrorHandler(i,s)),this.id=e,this.runtime=t,this.attributes=r,this._connected=!1,this._isBoundToContext=!1,Js(!e.includes("/"),772),this.handle=new G9(this,e,t.IFluidHandleContext),this.logger=de.create(t.logger,void 0,{all:{sharedObjectId:ot(),ddsType:{value:this.attributes.type,tag:Ae.CodeArtifact}}}),this.mc=qa(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;Js(this.mc!==void 0&&this.logger!==void 0,"this.mc and/or this.logger has not been set");const r=new zC({eventName:"ddsOpProcessing",category:"performance"},this.logger,(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))!==null&&e!==void 0?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new zC({eventName:"ddsEventCallbacks",category:"performance"},this.logger,(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))!==null&&t!==void 0?t:100,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),[r,i]}closeWithError(e){this.closeError===void 0&&(this.closeError=e)}verifyNotClosed(){if(this.closeError!==void 0)throw this.closeError}eventListenerErrorHandler(e,t){const r=kn.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw r.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(r),r}attachListeners(){this.isAttached()||this.runtime.once("attaching",()=>{this.didAttach()})}async load(e){this.runtime.attachState!==te.Detached&&(this.services=e),await this.loadCore(e.objectStorage),this.runtime.attachState!==te.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return this.services!==void 0&&this.runtime.attachState!==te.Detached}handleDecoded(e){var t,r,i;this.isAttached()&&((i=(t=this.services)===null||t===void 0?void 0:(r=t.deltaConnection).addedGCOutboundReference)===null||i===void 0||i.call(r,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}async newAckBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}attachDeltaHandler(){Js(this.services!==void 0,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,r)=>{this.process(e,t,r)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,r){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure(()=>{this.processCore(e,t,r)},t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure(()=>super.emit(e,...t))}emitInternal(e,...t){return super.emit(e,...t)}}class df extends J9{constructor(e,t,r,i){super(e,t,r),this.telemetryContextPrefix=i,this._isGCing=!1,this._serializer=new ik(this.runtime.channelsRoutingContext,s=>this.handleDecoded(s))}get serializer(){return Js(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(re.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(re.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}async summarize(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(re.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(re.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}getGCData(e=!1){Js(!this._isGCing,120),this._isGCing=!0;let t;try{const r=new K9(this.runtime.channelsRoutingContext,i=>this.handleDecoded(i));this.processGCDataCore(r),t={gcNodes:{"/":r.getSerializedRoutes()}},Js(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,r){var i;const s=(i=r==null?void 0:r.get(this.telemetryContextPrefix,e))!==null&&i!==void 0?i:0;r==null||r.set(this.telemetryContextPrefix,e,s+t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function sk(n,e,t){return n!==void 0?e.stringify(n,t):n}function ok(n,e,t){return e.encode(n,t)}function ch(n,e){return n!==void 0?e.parse(JSON.stringify(n)):n}function Q9(n,e){const t=new tn;return t.addBlob(n,e),t.getSummaryTree()}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ue;(function(n){n[n.Shared=0]="Shared",n[n.Plain=1]="Plain"})(Ue||(Ue={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ze(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let X9=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Nv(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class b_{constructor(e){this.value=e}get type(){return Ue[Ue.Plain]}makeSerialized(e,t){const r=sk(this.value,e,t);return{type:this.type,value:r}}}class vS{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===Ue[Ue.Shared]){e.type=Ue[Ue.Plain];const r={type:"__fluid_handle__",url:e.value};e.value=r}const t=ch(e.value,this.serializer);return new b_(t)}fromInMemory(e){return new b_(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function bm(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit")}function w_(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"}function Y9(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit"||n.type==="clear")}class Z9{constructor(e,t,r,i,s){this.serializer=e,this.handle=t,this.submitMessage=r,this.isAttached=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new vS(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){const t=this.data.get(e);return t===void 0?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(e==null)throw new Error("Undefined and null keys are not supported");const r=this.localValueMaker.fromInMemory(t),i=Nv(r,this.serializer,this.handle),s=this.setCore(e,r,!0);if(!this.isAttached())return;const o={key:e,type:"set",value:i};this.submitMapKeyMessage(o,s)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return t!==void 0;const r={key:e,type:"delete"};return this.submitMapKeyMessage(r,t),t!==void 0}clear(){const e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),!this.isAttached())return;const t={type:"clear"};this.submitMapClearMessage(t,e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=Nv(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){const i={key:t,value:this.makeLocal(t,r)};this.data.set(i.key,i.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const r=this.messageHandlers.get(e.type);return r===void 0?!1:(r.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(t===void 0)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,r){const i=this.messageHandlers.get(e.type);return i===void 0?!1:(i.process(e,t,r),!0)}rollback(e,t){if(!Y9(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){if(t.previousMap===void 0)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if(e.type==="delete"||e.type==="set"){if(t.type==="add")this.deleteCore(e.key,!0);else if(t.type==="edit"&&t.previousValue!==void 0)this.setCore(e.key,t.previousValue,!0);else throw new Error("Cannot rollback without previous value");const r=this.pendingKeys.get(e.key),i=r==null?void 0:r.pop();if(!r||i!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");r.length===0&&this.pendingKeys.delete(e.key)}else throw new Error("Unsupported op for rollback")}setCore(e,t,r){const i=this.data.get(e),s=i==null?void 0:i.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:s},r,this.eventEmitter),i}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const r=this.data.get(e),i=r==null?void 0:r.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},t,this.eventEmitter),r}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r)=>{e.set(r,this.data.get(r))}),this.clearCore(!1),e.forEach((t,r)=>{this.setCore(r,t,!0)})}makeLocal(e,t){if(t.type===Ue[Ue.Plain]||t.type===Ue[Ue.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&ze(r!==void 0&&bm(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){ze(r!==void 0&&bm(r),20);const s=this.pendingKeys.get(e.key);ze(s!==void 0&&s[0]===r.pendingMessageId,762),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(t,r,i)=>{if(r){ze(w_(i),21);const s=this.pendingClearMessageIds.shift();ze(s===i.pendingMessageId,763);return}if(this.pendingKeys.size!==0){this.clearExceptPendingKeys();return}this.clearCore(r)},submit:(t,r)=>{ze(w_(r),764);const i=this.pendingClearMessageIds.shift();ze(i===r.pendingMessageId,765),this.submitMapClearMessage(t,r.previousMap)},getStashedOpLocalMetadata:t=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(t,r,i)=>{this.needProcessKeyOperation(t,r,i)&&this.deleteCore(t.key,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e.set("set",{process:(t,r,i)=>{if(!this.needProcessKeyOperation(t,r,i))return;const s=this.makeLocal(t.key,t.value);this.setCore(t.key,s,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const r={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,r)}getMapKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const r=this.getMapKeyMessageId(e),i=t?{type:"edit",pendingMessageId:r,previousValue:t}:{type:"add",pendingMessageId:r};this.submitMessage(e,i)}resubmitMapKeyMessage(e,t){ze(bm(t),766);const r=this.pendingKeys.get(e.key);ze(r!==void 0&&r[0]===t.pendingMessageId,767),r.shift(),r.length===0&&this.pendingKeys.delete(e.key);const i=this.getMapKeyMessageId(e),s=t.type==="edit"?{type:"edit",pendingMessageId:i,previousValue:t.previousValue}:{type:"add",pendingMessageId:i};this.submitMessage(e,s)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const ak="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var C_;const E_="header";class Vn{get type(){return Vn.Type}get attributes(){return Vn.Attributes}async load(e,t,r,i){const s=new xc(t,e,i);return await s.load(r),s}create(e,t){const r=new xc(t,e,Vn.Attributes);return r.initializeLocal(),r}}Vn.Type="https://graph.microsoft.com/types/map";Vn.Attributes={type:Vn.Type,snapshotFormatVersion:"0.2",packageVersion:ak};class xc extends df{constructor(e,t,r){super(e,t,r,"fluid_map_"),this[C_]="SharedMap",this.kernel=new Z9(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),()=>this.isAttached(),this)}static create(e,t){return e.createChannel(t,Vn.Type)}static getFactory(){return new Vn}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(C_=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let r=0,i=0,s={};const o=[],a=new tn,l=this.kernel.getSerializedStorage(e),c=8*1024,u=16*1024;for(const h of Object.keys(l)){const f=l[h];if(f.value&&f.value.length>=c){const p=`blob${i}`;i++,o.push(p);const g={[h]:{type:f.type,value:JSON.parse(f.value)}};a.addBlob(p,JSON.stringify(g))}else{if(r+=f.type.length+21,f.value&&(r+=f.value.length),r>u){const p=`blob${i}`;i++,o.push(p),a.addBlob(p,JSON.stringify(s)),s={},r=0}s[h]={type:f.type,value:f.value===void 0?void 0:JSON.parse(f.value)}}}const d={blobs:o,content:s};return a.addBlob(E_,JSON.stringify(d)),a.getSummaryTree()}async loadCore(e){const t=await mt(e,E_),r=t;Array.isArray(r.blobs)?(this.kernel.populateFromSerializable(r.content),await Promise.all(r.blobs.map(async i=>{const s=await mt(e,i);this.kernel.populateFromSerializable(s)}))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,r){e.type===nh.Operation&&this.kernel.tryProcessMessage(e.contents,t,r)}rollback(e,t){this.kernel.rollback(e,t)}}function pr(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function __(n,e){for(var t="",r=0,i=-1,s=0,o,a=0;a<=n.length;++a){if(a<n.length)o=n.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(i+1,a):t=n.slice(i+1,a),r=a-i-1;i=a,s=0}else o===46&&s!==-1?++s:s=-1}return t}function e7(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var ua={resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var s;i>=0?s=arguments[i]:(r===void 0&&(r=process.cwd()),s=r),pr(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=__(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(pr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=__(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return pr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];pr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":ua.normalize(e)},relative:function(e,t){if(pr(e),pr(t),e===t||(e=ua.resolve(e),t=ua.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,s=i-r,o=1;o<t.length&&t.charCodeAt(o)===47;++o);for(var a=t.length,l=a-o,c=s<l?s:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(t.charCodeAt(o+d)===47)return t.slice(o+d+1);if(d===0)return t.slice(o+d)}else s>c&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var h=e.charCodeAt(r+d),f=t.charCodeAt(o+d);if(h!==f)break;h===47&&(u=d)}var p="";for(d=r+u+1;d<=i;++d)(d===i||e.charCodeAt(d)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+t.slice(o+u):(o+=u,t.charCodeAt(o)===47&&++o,t.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(pr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,s=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!s){i=o;break}}else s=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');pr(e);var r=0,i=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(o=e.length-1;o>=0;--o){var c=e.charCodeAt(o);if(c===47){if(!s){r=o+1;break}}else l===-1&&(s=!1,l=o+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(i=o):(a=-1,i=l))}return r===i?i=l:i===-1&&(i=e.length),e.slice(r,i)}else{for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!s){r=o+1;break}}else i===-1&&(s=!1,i=o+1);return i===-1?"":e.slice(r,i)}},extname:function(e){pr(e);for(var t=-1,r=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}i===-1&&(s=!1,i=a+1),l===46?t===-1?t=a:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return e7("/",e)},parse:function(e){pr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,s;i?(t.root="/",s=1):s=0;for(var o=-1,a=0,l=-1,c=!0,u=e.length-1,d=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?o===-1?o=u:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||l===-1||d===0||d===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&i?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&i?(t.name=e.slice(1,o),t.base=e.slice(1,l)):(t.name=e.slice(a,o),t.base=e.slice(a,l)),t.ext=e.slice(o,l)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};ua.posix=ua;var t7=ua;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var T_,x_;const sn=t7.posix,O_="header";class lr{get type(){return lr.Type}get attributes(){return lr.Attributes}async load(e,t,r,i){const s=new Oc(t,e,i);return await s.load(r),s}create(e,t){const r=new Oc(t,e,lr.Attributes);return r.initializeLocal(),r}}lr.Type="https://graph.microsoft.com/types/directory";lr.Attributes={type:lr.Type,snapshotFormatVersion:"0.1",packageVersion:ak};class Oc extends df{constructor(e,t,r){super(e,t,r,"fluid_directory_"),this[T_]="SharedDirectory",this.root=new uh(this,this.runtime,this.serializer,sn.sep),this.messageHandlers=new Map,this.localValueMaker=new vS(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",(i,s)=>{this.emit("containedValueChanged",i,s,this)}),this.root.on("subDirectoryCreated",(i,s)=>{this.emit("subDirectoryCreated",i,s,this)}),this.root.on("subDirectoryDeleted",(i,s)=>{this.emit("subDirectoryDeleted",i,s,this)})}static create(e,t){return e.createChannel(t,lr.Type)}static getFactory(){return new lr}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(T_=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===sn.sep)return this.root;let r=this.root;const i=t.substr(1).split(sn.sep);for(const s of i)if(r=r.getSubDirectory(s),!r)return;return r}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const r=e,i=this.messageHandlers.get(r.type);ze(i!==void 0,13),i.submit(r,t)}async loadCore(e){const t=await mt(e,O_),r=t;Array.isArray(r.blobs)?(this.populate(r.content),await Promise.all(r.blobs.map(async i=>{const s=await mt(e,i);this.populate(s)}))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[r,i]=t.pop();if(i.subdirectories)for(const[s,o]of Object.entries(i.subdirectories)){let a=r.getSubDirectory(s);a||(a=new uh(this,this.runtime,this.serializer,sn.join(r.absolutePath,s)),r.populateSubDirectory(s,a)),t.push([a,o])}if(i.storage)for(const[s,o]of Object.entries(i.storage)){const a=this.makeLocal(s,r.absolutePath,o);r.populateStorage(s,a)}}}processCore(e,t,r){if(e.type===nh.Operation){const i=e.contents,s=this.messageHandlers.get(i.type);ze(s!==void 0,14),s.process(i,t,r)}}rollback(e,t){const r=e,i=this.getWorkingDirectory(r.path);i&&i.rollback(r,t)}makeAbsolute(e){return sn.resolve(sn.sep,e)}makeLocal(e,t,r){return ze(r.type===Ue[Ue.Plain]||r.type===Ue[Ue.Shared],484),this.localValueMaker.fromSerializable(r)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processClearMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);if(i){const s=t?void 0:this.makeLocal(e.key,e.path,e.value);i.processSetMessage(e,s,t,r)}},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processCreateSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,r){const s=new tn;let o=0;const a=[],l=[],c={};for(l.push([e,c]);l.length>0;){const[d,h]=l.pop();for(const[f,p]of d.getSerializedStorage(t)){h.storage||(h.storage={});const g={type:p.type,value:p.value&&JSON.parse(p.value)};if(p.value&&p.value.length>=8192){const S={};let m=S;if(d.absolutePath!==sn.sep)for(const y of d.absolutePath.substr(1).split(sn.sep)){const b={};m.subdirectories={[y]:b},m=b}m.storage={[f]:g};const v=`blob${o}`;o++,a.push(v),s.addBlob(v,JSON.stringify(S))}else h.storage[f]=g}for(const[f,p]of d.subdirectories()){h.subdirectories||(h.subdirectories={});const g={};h.subdirectories[f]=g,l.push([p,g])}}const u={blobs:a,content:c};return s.addBlob(O_,JSON.stringify(u)),s.getSummaryTree()}}function wm(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&n.type==="edit"}function P_(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"&&typeof n.previousStorage=="object"}function R_(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean"||n.type==="deleteSubDir")}function n7(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="edit"||n.type==="deleteSubDir"||n.type==="clear"&&typeof n.previousStorage=="object"||n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean")}class uh extends X9{constructor(e,t,r,i){super(),this.directory=e,this.runtime=t,this.serializer=r,this.absolutePath=i,this._deleted=!1,this[x_]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new Ee("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),(t=this._storage.get(e))===null||t===void 0?void 0:t.value}set(e,t){if(this.throwIfDisposed(),e==null)throw new Error("Undefined and null keys are not supported");const r=this.directory.localValueMaker.fromInMemory(t),i=Nv(r,this.serializer,this.directory.handle),s=this.setCore(e,r,!0);if(!this.directory.isAttached())return this;const o={key:e,path:this.absolutePath,type:"set",value:i};return this.submitKeyMessage(o,s),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),e==null)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(sn.sep))throw new Error(`SubDirectory name may not contain ${sn.sep}`);const t=this.createSubDirectoryCore(e,!0),r=this._subdirectories.get(e);if(!this.directory.isAttached())return r;const i={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(i,!t),r}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(r,t),t!==void 0}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(r,t),t!==void 0}clear(){if(this.throwIfDisposed(),!this.directory.isAttached()){this.clearCore(!0);return}const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach((t,r,i)=>{e(t.value,r,i)})}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[(x_=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,r){if(this.throwIfDisposed(),t){ze(P_(r),15);const i=this.pendingClearMessageIds.shift();ze(i===r.pendingMessageId,810);return}this.clearExceptPendingKeys()}processDeleteMessage(e,t,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,r)&&this.deleteCore(e.key,t)}processSetMessage(e,t,r,i){this.throwIfDisposed(),this.needProcessStorageOperation(e,r,i)&&this.setCore(e.key,t,r)}processCreateSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const r=++this.pendingMessageId;this.pendingClearMessageIds.push(r);const i={type:"clear",pendingMessageId:r,previousStorage:t};this.directory.submitDirectoryMessage(e,i)}resubmitClearMessage(e,t){ze(P_(t),811);const r=this.pendingClearMessageIds.shift();ze(r===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const i={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,i)}resubmitKeyMessage(e,t){ze(wm(t),813);const r=this.pendingKeys.get(e.key);ze(r!==void 0&&r[0]===t.pendingMessageId,814),r.shift(),r.length===0&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,r=this.pendingSubDirectories.get(e.subdirName);return r!==void 0?r.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,i)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,i)}resubmitSubDirectoryMessage(e,t){ze(R_(t),815);const r=this.pendingSubDirectories.get(e.subdirName);ze(r!==void 0&&r[0]===t.pendingMessageId,816),r.shift(),r.length===0&&this.pendingSubDirectories.delete(e.subdirName),t.type==="createSubDir"?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,r]of this._storage){const i=r.makeSerialized(e,this.directory.handle);yield[t,i]}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,r){const i=e.get(t),s=i==null?void 0:i.pop();if(!i||s!==r)throw new Error("Rollback op does not match last pending");i.length===0&&e.delete(t)}rollback(e,t){if(!n7(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){t.previousStorage.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if((e.type==="delete"||e.type==="set")&&t.type==="edit")t.previousValue===void 0?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId);else if(e.type==="createSubDirectory"&&t.type==="createSubDir")t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else if(e.type==="deleteSubDirectory"&&t.type==="deleteSubDir")t.subDirectory!==void 0&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else throw new Error("Unsupported op for rollback")}makeAbsolute(e){return sn.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&ze(r!==void 0&&wm(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){ze(r!==void 0&&wm(r),17);const s=this.pendingKeys.get(e.key);ze(s!==void 0&&s[0]===r.pendingMessageId,817),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,r){if(this.pendingSubDirectories.get(e.subdirName)!==void 0){if(t){ze(R_(r),18);const s=this.pendingSubDirectories.get(e.subdirName);ze(s!==void 0&&s[0]===r.pendingMessageId,818),s.shift(),s.length===0&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r,i)=>{e.set(r,this._storage.get(r))}),this.clearCore(!1),e.forEach((t,r,i)=>{this.setCore(r,t,!0)})}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const r=this._storage.get(e),i=r==null?void 0:r.value;if(this._storage.delete(e)){const o={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",o,t,this.directory);const a={key:e,previousValue:i};this.emit("containedValueChanged",a,t,this)}return r}setCore(e,t,r){const i=this._storage.get(e),s=i==null?void 0:i.value;this._storage.set(e,t);const o={key:e,path:this.absolutePath,previousValue:s};this.directory.emit("valueChanged",o,r,this.directory);const a={key:e,previousValue:s};return this.emit("containedValueChanged",a,r,this),i}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const r=sn.join(this.absolutePath,e),i=new uh(this.directory,this.runtime,this.serializer,r);return this.registerEventsOnSubDirectory(i,e),this._subdirectories.set(e,i),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",(r,i)=>{this.emit("subDirectoryCreated",sn.join(t,r),i,this)}),e.on("subDirectoryDeleted",(r,i)=>{this.emit("subDirectoryDeleted",sn.join(t,r),i,this)})}deleteSubDirectoryCore(e,t){const r=this._subdirectories.get(e);return r!==void 0&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(r),this.emit("subDirectoryDeleted",e,t,this)),r}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[r,i]of t)this.disposeSubDirectoryTree(i);typeof e.dispose=="function"&&e.dispose()}undeleteSubDirectoryTree(e){for(const[t,r]of this._subdirectories.entries())this.undeleteSubDirectoryTree(r);e.undispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const k_="IFluidDependencySynthesizer";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hf{constructor(...e){this.providers=new Map,this.parents=e.filter(t=>t!==void 0)}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const r={};return this.generateRequired(r,t),this.generateOptional(r,e),Object.defineProperty(r,k_,{get:()=>this}),r}has(e,t){return this.providers.has(e)?!0:t!==!0?this.parents.some(r=>r.has(e)):!1}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof hf)return t.getProvider(e);{const r=t;if((r==null?void 0:r.getProvider)!==void 0)return r.getProvider(e)}}}}generateRequired(e,t){if(t!==void 0)for(const r of Object.keys(t)){const i=this.resolveProvider(r);if(i===void 0)throw new Error(`Object attempted to be created without registered required provider ${r}`);Object.defineProperty(e,r,i)}}generateOptional(e,t){var r;if(t!==void 0)for(const i of Object.keys(t)){const s=(r=this.resolveProvider(i))!==null&&r!==void 0?r:{get:async()=>{}};Object.defineProperty(e,i,s)}}resolveProvider(e){const t=this.providers.get(e);if(t===void 0){for(const r of this.parents){const i={[e]:e},s=r.synthesize(i,{}),o=Object.getOwnPropertyDescriptor(s,e);if(o!==void 0)return o}return}return typeof t=="function"?{get(){if(t&&typeof t=="function")return Promise.resolve(this[k_]).then(async r=>t(r)).then(r=>r==null?void 0:r[e])}}:{get(){if(t)return Promise.resolve(t).then(r=>{if(r)return r[e]})}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Cm(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let r7=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let yS=class Ps extends r7{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(Ps.removeListenerEvent,t),this.on(Ps.newListenerEvent,r)}}static isEmitterEvent(e){return e===Ps.newListenerEvent||e===Ps.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!Ps.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!Ps.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};yS.newListenerEvent="newListener";yS.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function i7(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class s7{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){i7(!1,202)}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(e.status===200&&e.mimeType==="fluid/object")return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}function o7(n,e){return new s7(n,e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class a7{constructor(){this.handlers=[]}pushHandler(...e){e!==void 0&&this.handlers.push(...e)}async handleRequest(e,t){const r=Rr.create(e);for(const i of this.handlers){const s=await i(r,t);if(s!==void 0)return s}return jn(e)}}function lk(...n){const e=new a7;return e.pushHandler(...n),async(t,r)=>e.handleRequest(t,r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const SS="_services";class l7{constructor(e){this.runtime=e}get IFluidRouter(){return this}async request(e){return{status:200,mimeType:"fluid/object",value:this}}}class c7{constructor(e){this.serviceFn=e}async getService(e){return this.service||(this.service=this.serviceFn(e)),this.service}}const u7=n=>{const e=new Map;return new Map(n).forEach((t,r)=>{e.set(r,new c7(t))}),async(t,r)=>{if(t.pathParts[0]!==SS)return;if(t.pathParts.length<2)return ih(400,"request did not specify a service to route to",t);const i=e.get(t.pathParts[1]);if(!i)return jn(t);const s=await i.getService(r),o=s.IFluidRouter,a=t.createSubRequest(2);return o?o.request(a):t.isLeaf(2)?{status:200,mimeType:"fluid/object",value:s}:ih(400,"request sub-url for service that doesn't support routing",t)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const d7=(n,e)=>{const t=lk(...e);return async(r,i)=>{var s;const o=((s=r.headers)===null||s===void 0?void 0:s.mountableView)===!0;let a=r;if(o){const c=Object.assign({},r.headers);delete c.mountableView,a={url:r.url,headers:c}}const l=await t(a,i);return o&&l.status===200&&n.canMount(l.value)?{status:200,mimeType:"fluid/object",value:new n(l.value)}:l}},bS=n=>async(e,t)=>{const r=Rr.create(e);if(r.pathParts.length===0)return t.IFluidHandleContext.resolveHandle({url:`/${n}${r.query}`,headers:e.headers})};function ck(n,e){return e.url===""||e.url==="/"||e.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:n}:jn(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class wS extends yS{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,Cm(this.runtime._dataObject===void 0,189),this.runtime._dataObject=this,this.innerHandle=new ca(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",()=>{this._disposed=!0,this.dispose()})}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return Cm(t!==void 0,188),await t.finishInitialization(!0),t}async request(e){return ck(this,e)}async finishInitialization(e){return this.initializeP!==void 0?this.initializeP:(this.initializeP=this.initializeInternal(e),this.initializeP)}async initializeInternal(e){var t;await this.preInitialize(),e?(Cm(this.initProps===void 0,190),await this.initializingFromExisting()):await this.initializingFirstTime((t=this.context.createProps)!==null&&t!==void 0?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,r){const i=r?r(e,t):t.get(e),s=i==null?void 0:i.IFluidHandle;if(s)return s.get()}async getService(e){return o7(`/${SS}/${e}`,this.context.containerRuntime).get()}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class uk extends wS{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=Rr.create(e);if(t.pathParts[0]==="bigBlobs"){const i=this.root.get(t.pathParts.join("/"));return i===void 0?jn(t):{mimeType:"fluid/object",status:200,value:i}}else return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===Vn.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=Oc.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function N_(n,e,t,r,i,s,o){let a=i;a=BG(async(f,p)=>(await wS.getDataObject(p)).request(f),a);const l=new a(e,t,s),c=e.scope,d=new hf(c.IFluidDependencySynthesizer).synthesize(r,{}),h=new n({runtime:l,context:e,providers:d,initProps:o});return s||await h.finishInitialization(s),{instance:h,runtime:l}}class dk{constructor(e,t,r,i,s,o=Yc){if(this.type=e,this.ctor=t,this.optionalProviders=i,this.runtimeClass=o,this.type==="")throw new Error("undefined type member");s!==void 0&&(this.registry=new lS(s)),this.sharedObjectRegistry=new Map(r.map(a=>[a.type,a]))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:r}=await N_(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return r}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,r){const i=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(i,r)}async createNonRootInstanceCore(e,t,r){const i=e.createDetachedDataStore(t);return this.createInstanceCore(i,r)}async createInstanceCore(e,t){const{instance:r,runtime:i}=await N_(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,i),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hk extends dk{constructor(e,t,r=[],i,s,o=Yc){const a=[...r];r.find(l=>l.type===lr.Type)||a.push(Oc.getFactory()),r.find(l=>l.type===Vn.Type)||a.push(xc.getFactory()),super(e,t,a,i,s,o)}}var fk={},ff={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ff,"__esModule",{value:!0});ff.IContainerRuntime=void 0;ff.IContainerRuntime="IContainerRuntime";(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=G&&G.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=G&&G.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(ff,n)})(fk);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class CS extends pG{constructor(e,t,r=[],i){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=r,this.runtimeOptions=i,this.registry=new lS(e)}get IFluidDataStoreRegistry(){return this.registry}async instantiateFirstTime(e){await this.containerInitializingFirstTime(e),await this.containerHasInitialized(e)}async instantiateFromExisting(e){await this.containerHasInitialized(e)}async preInitialize(e,t){const r=e.scope,i=new hf(this.dependencyContainer,r.IFluidDependencySynthesizer);r.IFluidDependencySynthesizer=i;const s=await gS.load(e,this.registryEntries,lk(...this.requestHandlers),this.runtimeOptions,r,t);return i.register(fk.IContainerRuntime,s),s}async containerInitializingFirstTime(e){}async containerHasInitialized(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Lv="default";class pk extends CS{constructor(e,t,r,i=[],s){super(t,r,[bS(Lv),...i],s),this.defaultFactory=e}async containerInitializingFirstTime(e){await(await e.createDataStore(this.defaultFactory.type)).trySetAlias(Lv)}}pk.defaultDataStoreId=Lv;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function h7(n){if(n.attachState!==te.Attached)return new Promise(e=>{n.once("attached",()=>{Promise.resolve().then(()=>e()).catch(()=>{})})})}async function f7(n){const e="/",t=await n.request({url:e});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object at URL: "${e}"`);if(t.value===void 0)throw new Error(`Empty response from URL: "${e}"`);return t.value}async function p7(n,e){const t=`/${n}`,r=await e.request({url:t});if(r.status!==200||r.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with ID: "${n}" from URL: "${t}"`);if(r.value===void 0)throw new Error(`Empty response for ID: "${n}" from URL: "${t}"`);return r.value}async function m7(n,e){const t=await e.request({url:n});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with from URL: "${n}"`);if(t.value===void 0)throw new Error(`Empty response for from URL: "${n}"`);return t.value}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const g7=Object.freeze(Object.defineProperty({__proto__:null,BaseContainerRuntimeFactory:CS,BaseContainerService:l7,ContainerRuntimeFactoryWithDefaultDataStore:pk,DataObject:uk,DataObjectFactory:hk,PureDataObject:wS,PureDataObjectFactory:dk,defaultFluidObjectRequestHandler:ck,defaultRouteRequestHandler:bS,generateContainerServicesRequestHandler:u7,getDefaultObjectFromContainer:f7,getObjectFromContainer:m7,getObjectWithIdFromContainer:p7,mountableViewRequestHandler:d7,serviceRoutePathRoot:SS,waitForAttach:h7},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const mk=n=>(n==null?void 0:n.factory)!==void 0,gk=n=>(n==null?void 0:n.getFactory)!==void 0,v7=n=>{var e;const t=new Set,r=new Set,i=o=>{if(gk(o))r.add(o.getFactory());else if(mk(o))t.add([o.factory.type,Promise.resolve(o.factory)]);else throw new Error("Entry is neither a DataObject or a SharedObject")};if(new Set([...Object.values(n.initialObjects),...(e=n.dynamicObjectTypes)!==null&&e!==void 0?e:[]]).forEach(i),t.size===0&&r.size===0)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(t),Array.from(r)]};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class vk extends uk{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(e===void 0)throw new Error("InitialObjects sub-directory was not initialized");return e}async initializingFirstTime(e){this.root.createSubDirectory(this.initialObjectsDirKey);const t=[];Object.entries(e.initialObjects).forEach(([r,i])=>{const s=async()=>{const o=await this.create(i);this.initialObjectsDir.set(r,o.handle)};t.push(s())}),await Promise.all(t)}async hasInitialized(){const e=[];for(const[t,r]of Array.from(this.initialObjectsDir.entries())){const i=async()=>{const s=await r.get();Object.assign(this._initialObjects,{[t]:s})};e.push(i())}await Promise.all(e)}get initialObjects(){if(Object.keys(this._initialObjects).length===0)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(e){if(mk(e))return this.createDataObject(e);if(gk(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")}async createDataObject(e){const t=e.factory,r=[...this.context.packagePath,t.type],i=await this.context.containerRuntime.createDataStore(r);return wc(i,"/")}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}const L_="rootDOId";class yk extends CS{constructor(e){const[t,r]=v7(e),i=new hk("rootDO",vk,r,{},t);super([i.registryEntry],void 0,[bS(L_)],{flushMode:re.FlushMode.Immediate}),this.rootDataObjectFactory=i,this.initialObjects=e.initialObjects}async containerInitializingFirstTime(e){await this.rootDataObjectFactory.createRootInstance(L_,e,{initialObjects:this.initialObjects})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Sk extends IR{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",(t,r)=>{if(this.shouldIncludeAsMember(r)){const i=this.getMember(t);this.emit("memberAdded",t,i),this.emit("membersChanged")}}),this.audience.on("removeMember",t=>{this.lastMembers.has(t)&&(this.emit("memberRemoved",t,this.lastMembers.get(t)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach((r,i)=>{if(this.shouldIncludeAsMember(r)){const s=r.user.id;let o=e.get(s);o===void 0&&(o=this.createServiceMember(r),e.set(s,o)),o.connections.push({id:i,mode:r.mode}),t.set(i,o)}}),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(e!==void 0)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(t===void 0)return;const i=this.getMembers().get(t==null?void 0:t.user.id);if(i===void 0)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return i}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function xn(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function y7(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const bk=(n,e)=>S7.from(n).toString(e);function I_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let S7=class Rs extends Uint8Array{toString(e){return y7(this,e)}static from(e,t,r){if(typeof e=="string")return Rs.fromString(e,t);if(e!==null&&typeof e=="object"&&I_(e.buffer))return xn(e.byteOffset===0,0),xn(e.byteLength===e.buffer.byteLength,1),Rs.fromArrayBuffer(e.buffer,t,r);if(I_(e))return Rs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Rs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Rs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Rs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let wk=class extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let b7=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Iv;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Iv||(Iv={}));var A_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(A_||(A_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function J(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function w7(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const Av=(n,e)=>C7.from(n).toString(e);function M_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let C7=class ks extends Uint8Array{toString(e){return w7(this,e)}static from(e,t,r){if(typeof e=="string")return ks.fromString(e,t);if(e!==null&&typeof e=="object"&&M_(e.buffer))return J(e.byteOffset===0,0),J(e.byteLength===e.buffer.byteLength,1),ks.fromArrayBuffer(e.buffer,t,r);if(M_(e))return ks.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new ks(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new ks(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new ks(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const D_=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ro=class Ck{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=D_.now();return new Ck(e)}trace(){const e=D_.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function E7(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ES{constructor(){this.items=[]}push(e){this.items.push(e)}empty(){return this.items.length===0}top(){return this.items[this.items.length-1]}pop(){return this.items.pop()}}function Ek(n){if(n!==void 0){{if(n.isHead)return;n.next.prev=n.prev,n.prev.next=n.next}return n}}function F_(n){return new _k(!1,n)}function Qo(){return new _k(!0,void 0)}class _k{constructor(e,t){this.isHead=e,this.data=t,this.prev=this,this.next=this}clear(){this.isHead&&(this.prev=this,this.next=this)}add(e){const t=F_(e);return this.prev.next=t,t.next=this,t.prev=this.prev,this.prev=t,t}dequeue(){if(!this.empty())return Ek(this.next).data}enqueue(e){return this.add(e)}walk(e){for(let t=this.next;!t.isHead;t=t.next)e(t.data,t)}some(e,t){const r=[],i=t?this.prev:this.next;for(let s=i;!s.isHead;s=t?s.prev:s.next){const o=s.data;e(o,s)&&(t?r.unshift(o):r.push(o))}return r}count(){let e,t;for(e=this.next,t=0;!e.isHead;t++)e=e.next;return t}first(){if(!this.empty())return this.next.data}last(){if(!this.empty())return this.prev.data}empty(){return this.next===this}push(e){this.unshift(e)}unshift(e){const t=F_(e);t.data=e,t.isHead=!1,t.next=this.next,t.prev=this,this.next=t,t.next.prev=t}[Symbol.iterator](){let e=this;return{next(){for(;e&&e.next.isHead===!1;)if(e=e.next,e.data!==void 0)return{value:e.data,done:!1};return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}}let z_=class{constructor(e,t){this.comp=t,this.L=[t.min];for(let r=0,i=e.length;r<i;r++)this.add(e[r])}count(){return this.L.length-1}peek(){return this.L[1]}get(){const e=this.L[1];return this.L[1]=this.L[this.count()],this.L.pop(),this.fixDown(1),e}add(e){this.L.push(e),this.fixup(this.count())}fixup(e){let t=e;for(;t>1&&this.comp.compare(this.L[t>>1],this.L[t])>0;){const r=this.L[t>>1];this.L[t>>1]=this.L[t],this.L[t]=r,t=t>>1}}fixDown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r],this.L[r+1])>0&&r++,this.comp.compare(this.L[t],this.L[r])<=0)break;const i=this.L[t];this.L[t]=this.L[r],this.L[r]=i,t=r}}};const Wt={RED:0,BLACK:1};class Pc{constructor(e,t){this.compareKeys=e,this.aug=t}makeNode(e,t,r,i){return{key:e,data:t,color:r,size:i}}isRed(e){return!!e&&e.color===Wt.RED}nodeSize(e){return e?e.size:0}size(){return this.nodeSize(this.root)}isEmpty(){return!this.root}get(e){if(e!==void 0)return this.nodeGet(this.root,e)}nodeGet(e,t){let r=e;for(;r;){const i=this.compareKeys(t,r.key);if(i<0)r=r.left;else if(i>0)r=r.right;else return r}}contains(e){return this.get(e)}gather(e,t){const r=[];return e!==void 0&&this.nodeGather(this.root,r,e,t),r}nodeGather(e,t,r,i){e&&(i.continueSubtree(e.left,r)&&this.nodeGather(e.left,t,r,i),i.matchNode(e,r)&&t.push(e),i.continueSubtree(e.right,r)&&this.nodeGather(e.right,t,r,i))}walkExactMatchesForward(e,t,r,i){this.nodeWalkExactMatchesForward(this.root,e,t,r,i)}nodeWalkExactMatchesForward(e,t,r,i,s){if(!e)return;const o=t(e);i(o)&&this.nodeWalkExactMatchesForward(e.left,t,r,i,s),o===0&&r(e),s(o)&&this.nodeWalkExactMatchesForward(e.right,t,r,i,s)}walkExactMatchesBackward(e,t,r,i){this.nodeWalkExactMatchesBackward(this.root,e,t,r,i)}nodeWalkExactMatchesBackward(e,t,r,i,s){if(!e)return;const o=t(e);s(o)&&this.nodeWalkExactMatchesBackward(e.right,t,r,i,s),o===0&&r(e),i(o)&&this.nodeWalkExactMatchesBackward(e.left,t,r,i,s)}put(e,t,r){e!==void 0&&(t===void 0?this.remove(e):(this.root=this.nodePut(this.root,e,t,r),this.root.color=Wt.BLACK))}nodePut(e,t,r,i){let s=e;if(s){const o=this.compareKeys(t,s.key);if(o<0)s.left=this.nodePut(s.left,t,r,i);else if(o>0)s.right=this.nodePut(s.right,t,r,i);else if(i){const a=i(t,s.key,r,s.data);a.key&&(s.key=a.key),a.data?s.data=a.data:s.data=r}else s.data=r;return this.isRed(s.right)&&!this.isRed(s.left)&&(s=this.rotateLeft(s)),this.isRed(s.left)&&this.isRed(s.left.left)&&(s=this.rotateRight(s)),this.isRed(s.left)&&this.isRed(s.right)&&this.flipColors(s),s.size=this.nodeSize(s.left)+this.nodeSize(s.right)+1,this.aug&&this.updateLocal(s),s}else return this.makeNode(t,r,Wt.RED,1)}updateLocal(e){this.aug&&(this.isRed(e.left)&&this.aug.update(e.left),this.isRed(e.right)&&this.aug.update(e.right),this.aug.update(e))}nodeRemoveMin(e){let t=e;if(t.left)return!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.nodeRemoveMin(t.left),this.balance(t)}remove(e){if(e!==void 0){if(!this.contains(e))return;this.removeExisting(e)}}removeExisting(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.color=Wt.RED),this.root=this.nodeRemove(this.root,e)}nodeRemove(e,t){let r=e;if(this.compareKeys(t,r.key)<0)!this.isRed(r.left)&&!this.isRed(r.left.left)&&(r=this.moveRedLeft(r)),r.left=this.nodeRemove(r.left,t);else{if(this.isRed(r.left)&&(r=this.rotateRight(r)),this.compareKeys(t,r.key)===0&&!r.right)return;if(!this.isRed(r.right)&&!this.isRed(r.right.left)&&(r=this.moveRedRight(r)),this.compareKeys(t,r.key)===0){const i=this.nodeMin(r.right);r.key=i.key,r.data=i.data,r.right=this.nodeRemoveMin(r.right)}else r.right=this.nodeRemove(r.right,t)}return this.balance(r)}floor(e){if(!this.isEmpty())return this.nodeFloor(this.root,e)}nodeFloor(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r<0)return this.nodeFloor(e.left,t);{const i=this.nodeFloor(e.right,t);return i||e}}}ceil(e){if(!this.isEmpty())return this.nodeCeil(this.root,e)}nodeCeil(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r>0)return this.nodeCeil(e.right,t);{const i=this.nodeCeil(e.left,t);return i||e}}}min(){if(this.root)return this.nodeMin(this.root)}nodeMin(e){return e.left?this.nodeMin(e.left):e}max(){if(this.root)return this.nodeMax(this.root)}nodeMax(e){return e.right?this.nodeMax(e.right):e}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.color=t.right.color,t.right.color=Wt.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.color=t.left.color,t.left.color=Wt.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}oppositeColor(e){return e===Wt.BLACK?Wt.RED:Wt.BLACK}flipColors(e){e.color=this.oppositeColor(e.color),e.left.color=this.oppositeColor(e.left.color),e.right.color=this.oppositeColor(e.right.color)}moveRedLeft(e){let t=e;return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(e){let t=e;return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}balance(e){let t=e;return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&this.aug.update(t),t}mapRange(e,t,r,i){this.nodeMap(this.root,e,r,i)}map(e,t){this.nodeMap(this.root,e,t)}keys(){const e=[],t={showStructure:!0,infix:r=>(e.push(r.key),!0)};return this.walk(t),e}walk(e){this.nodeWalk(this.root,e)}walkBackward(e){this.nodeWalkBackward(this.root,e)}nodeWalk(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.pre(e)),e.left&&(r=this.nodeWalk(e.left,t)),r&&t.infix&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalk(e.right,t)),r&&t.post&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.post(e))),r}nodeWalkBackward(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.pre(e)),e.right&&(r=this.nodeWalkBackward(e.right,t)),r&&t.infix&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalkBackward(e.left,t)),r&&t.post&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.post(e))),r}nodeMap(e,t,r,i,s){let o=i,a=s;if(!e)return!0;o===void 0&&(o=this.nodeMin(e).key),a===void 0&&(a=this.nodeMax(e).key);const l=this.compareKeys(o,e.key),c=this.compareKeys(a,e.key);let u=!0;return l<0&&(u=this.nodeMap(e.left,t,r,o,a)),u&&l<=0&&c>=0&&(u=t(e,r)),u&&c>0&&(u=this.nodeMap(e.right,t,r,o,a)),u}}const _7=(n,e)=>n.compare(e);class T7{constructor(){this.intervals=new Pc(_7,this)}remove(e){this.intervals.remove(e)}removeExisting(e){this.intervals.removeExisting(e)}put(e,t){let r;t&&(r=(i,s)=>({key:t(i,s)})),this.intervals.put(e,{minmax:e.clone()},r)}map(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walk(t)}mapUntil(e){const t={infix:r=>e(r.key),showStructure:!0};this.intervals.walk(t)}mapBackward(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walkBackward(t)}match(e){return this.intervals.gather(e,this)}matchNode(e,t){return!!e&&e.key.overlaps(t)}continueSubtree(e,t){return!!e&&e.data.minmax.overlaps(t)}update(e){e.left&&e.right?e.data.minmax=e.key.union(e.left.data.minmax.union(e.right.data.minmax)):e.left?e.data.minmax=e.key.union(e.left.data.minmax):e.right?e.data.minmax=e.key.union(e.right.data.minmax):e.data.minmax=e.key.clone()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Qt=0,ie=-1,Ss=-2,As=-1,Bs=-2;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ne;(function(n){n[n.Simple=0]="Simple",n[n.Tile=1]="Tile",n[n.NestBegin=2]="NestBegin",n[n.NestEnd=4]="NestEnd",n[n.RangeBegin=16]="RangeBegin",n[n.RangeEnd=32]="RangeEnd",n[n.SlideOnRemove=64]="SlideOnRemove",n[n.StayOnRemove=128]="StayOnRemove",n[n.Transient=256]="Transient"})(ne||(ne={}));const ue={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Tk(n,e,t,r){let i=e;switch(i===void 0&&(i=n.defaultValue),n.name){case"incr":i+=t,n.minValue&&i<n.minValue&&(i=n.minValue);break;case"consensus":if(i===void 0)i={value:t,seq:r};else{const s=i;s.seq===-1&&(s.seq=r)}break}return i}function eu(n,e){if(n)if(e){for(const t in n){if(e[t]===void 0)return!1;if(typeof e[t]=="object"){if(!eu(n[t],e[t]))return!1}else if(e[t]!==n[t])return!1}for(const t in e)if(n[t]===void 0)return!1}else return!1;else if(e)return!1;return!0}function xk(n,e,t,r){if(e!==void 0)for(const i in e){const s=e[i];s===null?delete n[i]:t&&t.name!=="rewrite"?n[i]=Tk(t,n[i],s,r):n[i]=s}return n}function x7(n){if(n===void 0)return;const e=Zt();for(const t in n){const r=n[t];r!==null&&(e[t]=r)}return e}function Ok(n,e,t,r){let i=n;return(!i||t&&t.name==="rewrite")&&(i=Zt()),xk(i,e,t,r),i}function O7(n,e){if(e!==void 0)for(const t in e)n[t]===void 0&&(n[t]=e[t]);return n}function Zt(){return Object.create(null)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const P7="referenceTileLabels",tu="referenceRangeLabels";function Xe(n,e){return((typeof n=="number"?n:n.refType)&e)!==0}const ao=n=>Xe(n,ne.Tile)&&n.properties?n.properties[P7]:void 0,lo=n=>Xe(n,ne.NestBegin|ne.NestEnd)&&n.properties?n.properties[tu]:void 0;function pf(n,e){const t=ao(n);if(t){for(const r of t)if(e===r)return!0}return!1}function _S(n,e){const t=lo(n);if(t){for(const r of t)if(e===r)return!0}return!1}function Ms(n){return ao(n)!==void 0}function Ds(n){return lo(n)!==void 0}function R7(n,e){return TS(n,e)<0?n:e}function k7(n,e){return TS(n,e)>0?n:e}function TS(n,e){const t=n.getSegment(),r=e.getSegment();return t===r?n.getOffset()-e.getOffset():t===void 0||r!==void 0&&t.ordinal<r.ordinal?-1:1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function N7(n){let e=0;if(Xe(n,ne.Transient)&&++e,Xe(n,ne.SlideOnRemove)&&++e,Xe(n,ne.StayOnRemove)&&++e,e>1)throw new Ee("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}class yo{constructor(e,t,r=0,i=ne.Simple,s){this.client=e,this.offset=r,this.refType=i,N7(i),this.segment=t,this.properties=s}min(e){return R7(this,e)}max(e){return k7(this,e)}compare(e){return TS(this,e)}toPosition(){return this.getClient().localReferencePositionToPosition(this)}hasTileLabels(){return Ms(this)}hasRangeLabels(){return Ds(this)}hasTileLabel(e){return pf(this,e)}hasRangeLabel(e){return _S(this,e)}getTileLabels(){return ao(this)}getRangeLabels(){return lo(this)}isLeaf(){return!1}addProperties(e,t){this.properties=Ok(this.properties,e,t)}getClient(){return this.client}getSegment(){return this.segment}getOffset(){return this.offset}getProperties(){return this.properties}}yo.DetachedPosition=-1;function Au(n){J(n instanceof yo,736)}class ii{constructor(e,t=new Array(e.cachedLength)){this.segment=e,this.hierRefCount=0,this.refCount=0,this.refsByOffset=t}static append(e,t){t.localRefs&&!t.localRefs.empty?(e.localRefs||(e.localRefs=new ii(e)),J(e.localRefs.refsByOffset.length===e.cachedLength,702),e.localRefs.append(t.localRefs)):e.localRefs&&(e.localRefs.refsByOffset.length+=t.cachedLength)}[Symbol.iterator](){const e=[];for(const r of this.refsByOffset)r&&(r.before&&e.push(r.before[Symbol.iterator]()),r.at&&e.push(r.at[Symbol.iterator]()),r.after&&e.push(r.after[Symbol.iterator]()));return{next(){for(;e.length>0;){const r=e[0].next();if(r.done===!0)e.shift();else return r}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}clear(){this.refCount=0,this.hierRefCount=0;const e=t=>{if(t)for(const r of t)r.segment===this.segment&&(r.segment=void 0)};for(let t=0;t<this.refsByOffset.length;t++){const r=this.refsByOffset[t];r&&(e(r.before),e(r.at),e(r.before),this.refsByOffset[t]=void 0)}}get empty(){return this.refCount===0}createLocalRef(e,t,r,i){const s=new yo(i,this.segment,e,t,r);return Xe(s,ne.Transient)||this.addLocalRef(s),s}addLocalRef(e){var t,r;J(!Xe(e,ne.Transient),735),Au(e);const i=this.refsByOffset[e.offset]=(t=this.refsByOffset[e.offset])!==null&&t!==void 0?t:{at:Qo()};(i.at=(r=i.at)!==null&&r!==void 0?r:Qo()).enqueue(e),(Ds(e)||Ms(e))&&this.hierRefCount++,this.refCount++}removeLocalRef(e){Au(e);const t=i=>{if(i){let s=i;do if(s=s.next,s.data===e)return Ek(s),(Ds(e)||Ms(e))&&this.hierRefCount--,this.refCount--,e;while(!s.isHead)}},r=this.refsByOffset[e.offset];if(r!==void 0){let i=t(r.before);if(i||(i=t(r.at),i)||(i=t(r.after),i))return i}}append(e){if(!(!e||e.empty)){this.hierRefCount+=e.hierRefCount,this.refCount+=e.refCount,e.hierRefCount=0;for(const t of e)t.segment=this.segment,t.offset+=this.refsByOffset.length;this.refsByOffset.push(...e.refsByOffset)}}split(e,t){if(this.empty)this.refsByOffset.length=e;else{const r=new ii(t,this.refsByOffset.splice(e,this.refsByOffset.length-e));t.localRefs=r;for(const i of r)i.segment=t,i.offset-=e,(Ds(i)||Ms(i))&&(this.hierRefCount--,r.hierRefCount++),this.refCount--,r.refCount++}}addBeforeTombstones(...e){var t,r,i,s,o;const a=(r=(t=this.refsByOffset[0])===null||t===void 0?void 0:t.before)!==null&&r!==void 0?r:Qo();for(const l of e)for(const c of l)Au(c),Xe(c,ne.SlideOnRemove)?(a.push(c),c.segment=this.segment,c.offset=0,(Ds(c)||Ms(c))&&this.hierRefCount++,this.refCount++):c.segment=void 0;if(!a.empty()&&((i=this.refsByOffset[0])===null||i===void 0?void 0:i.before)===void 0){const l=this.refsByOffset[0]=(s=this.refsByOffset[0])!==null&&s!==void 0?s:{before:a};l.before=(o=l.before)!==null&&o!==void 0?o:a}}addAfterTombstones(...e){var t,r,i,s,o;const a=this.refsByOffset.length-1,l=(r=(t=this.refsByOffset[a])===null||t===void 0?void 0:t.after)!==null&&r!==void 0?r:Qo();for(const c of e)for(const u of c)Au(u),Xe(u,ne.SlideOnRemove)?(l.push(u),u.segment=this.segment,u.offset=this.segment.cachedLength-1,(Ds(u)||Ms(u))&&this.hierRefCount++,this.refCount++):u.segment=void 0;if(!l.empty()&&((i=this.refsByOffset[a])===null||i===void 0?void 0:i.after)===void 0){const c=this.refsByOffset[a]=(s=this.refsByOffset[a])!==null&&s!==void 0?s:{after:l};c.after=(o=c.after)!==null&&o!==void 0?o:l}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Mu={APPEND:-1,SPLIT:-2,UNLINK:-3,ACKNOWLEDGED:-4};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class L7{constructor(){this.ordinalSortedItems=[]}get size(){return this.ordinalSortedItems.length}get items(){return this.ordinalSortedItems}addOrUpdate(e,t){const r=this.findOrdinalPosition(this.getOrdinal(e));r.exists?t&&t(this.ordinalSortedItems[r.index],e):this.ordinalSortedItems.splice(r.index,0,e)}remove(e){const t=this.findOrdinalPosition(this.getOrdinal(e));return t.exists?(this.ordinalSortedItems.splice(t.index,1),!0):!1}has(e){return this.findOrdinalPosition(this.getOrdinal(e)).exists}getOrdinal(e){const t=e;return t!=null&&t.segment?t.segment.ordinal:e.ordinal}findOrdinalPosition(e,t,r){if(this.ordinalSortedItems.length===0)return{exists:!1,index:0};if(t===void 0||r===void 0)return this.findOrdinalPosition(e,0,this.ordinalSortedItems.length-1);const i=t+Math.floor((r-t)/2);return this.getOrdinal(this.ordinalSortedItems[i])>e?t===i?{exists:!1,index:i}:this.findOrdinalPosition(e,t,i-1):this.getOrdinal(this.ordinalSortedItems[i])<e?i===r?{exists:!1,index:i+1}:this.findOrdinalPosition(e,i+1,r):{exists:!0,index:i}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class I7{constructor(e){this.segment=e,this.trackingGroups=new Set}link(e){e&&(this.trackingGroups.has(e)||this.trackingGroups.add(e),e.has(this.segment)||e.link(this.segment))}unlink(e){e.has(this.segment)&&e.unlink(this.segment),this.trackingGroups.delete(e)}copyTo(e){this.trackingGroups.forEach(t=>e.trackingCollection.link(t))}get empty(){return this.trackingGroups.size===0}matches(e){if(!e||this.trackingGroups.size!==e.trackingGroups.size)return!1;for(const t of this.trackingGroups.values())if(!e.trackingGroups.has(t))return!1;return!0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ko(n,e){let t=-1,r=0,i=n.length-1;for(;r<=i;){const s=r+Math.floor((i-r)/2);n[s].seq<=e?((t<0||n[t].seq<n[s].seq)&&(t=s),r=s+1):i=s-1}return t}class rt{constructor(e){this.minSeq=e,this.minLength=0,this.segmentCount=0,this.partialLengths=[],this.clientSeqNumbers=[]}static combine(e,t,r,i=!1){return rt.combineBranch(e,t,r,i)}static combineBranch(e,t,r,i=!1){let s=new rt(r.minSeq);rt.fromLeaves(s,t,r);let o;function a(h){if(!h)return;const f=new Pc(B_);return h.map(p=>(f.put(p.data.clientId,Object.assign({},p.data)),!0)),f}function l(h,f){const p=h.overlapRemoveClients;p?f.overlapRemoveClients&&f.overlapRemoveClients.map(g=>{const S=p.get(g.key);return S?S.data.seglen+=g.data.seglen:p.put(g.data.clientId,Object.assign({},g.data)),!0}):h.overlapRemoveClients=a(f.overlapRemoveClients)}function c(h){const f=h.seq;let p=0;if(o)if(o.seq===h.seq){o.seglen+=h.seglen,o.len+=h.seglen,l(o,h);return}else p=o.len,s.addClientSeqNumberFromPartial(o);o={clientId:h.clientId,len:p+h.seglen,overlapRemoveClients:a(h.overlapRemoveClients),seglen:h.seglen,seq:f},s.partialLengths.push(o)}const u=[];for(let h=0;h<t.childCount;h++){const f=t.children[h];if(!f.isLeaf()){const p=f;i&&(p.partialLengths=rt.combine(e,p,r,!0)),u.push(p.partialLengths)}}let d=u.length;if(d!==0){s.partialLengths.length>0&&(u.push(s),d++,s=new rt(r.minSeq));const h=new Array(d),f=new Array(d);for(let S=0;S<d;S++)h[S]=0,f[S]=u[S].partialLengths.length,s.minLength+=u[S].minLength,s.segmentCount+=u[S].segmentCount;let p=0,g;for(;p>=0;){p=-1;for(let S=0;S<d;S++)if(h[S]<f[S]){const m=u[S].partialLengths[h[S]];(p<0||m.seq<g.seq)&&(p=S,g=m)}p>=0&&(c(g),h[p]++)}o&&s.addClientSeqNumberFromPartial(o)}return rt.options.zamboni&&s.zamboni(r),rt.options.verify&&s.verify(),s}static fromLeaves(e,t,r){e.minLength=0,e.segmentCount=t.childCount;function i(l,c){return l!==void 0&&l!==ie&&l<=c}for(let l=0;l<t.childCount;l++){const c=t.children[l];if(c.isLeaf()){const u=c;i(u.seq,r.minSeq)?e.minLength+=u.cachedLength:u.seq!==ie&&rt.insertSegment(e,u);const d=ts(u);i(d==null?void 0:d.removedSeq,r.minSeq)?e.minLength-=u.cachedLength:d!==void 0&&d.removedSeq!==ie&&rt.insertSegment(e,u,d)}}const s=e.partialLengths,o=s.length;let a=0;for(let l=0;l<o;l++)s[l].len=a+s[l].seglen,a=s[l].len,e.addClientSeqNumberFromPartial(s[l]);rt.options.verify&&e.verify()}static getOverlapClients(e,t){const r=new Pc(B_);for(const i of e)r.put(i,{clientId:i,seglen:t});return r}static accumulateRemoveClientOverlap(e,t,r){if(e.overlapRemoveClients)for(const i of t){const s=e.overlapRemoveClients.get(i);s?s.data.seglen+=r:e.overlapRemoveClients.put(i,{clientId:i,seglen:r})}else e.overlapRemoveClients=rt.getOverlapClients(t,r)}static insertSegment(e,t,r){let i=t.seq,s=t.cachedLength,o=t.clientId,a;r&&(i=r.removedSeq,s=-s,o=r.removedClientIds[0],a=r.removedClientIds.length>1?r.removedClientIds.slice(1):void 0);const l=e.partialLengths,c=l.length;let u=0;for(;u<c&&!(l[u].seq>=i);u++);if(u<c&&l[u].seq===i)l[u].seglen+=s,a&&rt.accumulateRemoveClientOverlap(l[u],a,s);else{let d;if(a){const h=rt.getOverlapClients(a,s);d={seq:i,clientId:o,len:0,seglen:s,overlapRemoveClients:h}}else d={seq:i,clientId:o,len:0,seglen:s};if(u<c){for(let h=c;h>u;h--)l[h]=l[h-1];l[u]=d}else l.push(d)}}static addSeq(e,t,r,i){let s,o,a=ko(e,t);if(a>=0){const l=e[a];l.seq===t?(s=l,a=ko(e,t-1),a>=0&&(o=e[a])):o=l}s===void 0?(s={clientId:i,seglen:r,seq:t},e.push(s)):s.seglen=r,o!==void 0?s.len=s.seglen+o.len:s.len=s.seglen}update(e,t,r,i,s){let o=0,a=0;for(let l=0;l<t.childCount;l++){const c=t.children[l];if(c.isLeaf()){const u=c,d=ts(u);u.seq===r?(d==null?void 0:d.removedSeq)!==r&&(o+=u.cachedLength):(d==null?void 0:d.removedSeq)===r&&(o-=u.cachedLength),a++}else{const d=c.partialLengths,h=d.partialLengths,f=ko(h,r);if(f>=0){const p=h[f];p.seq===r&&(o+=p.seglen)}a+=d.segmentCount}}this.segmentCount=a,rt.addSeq(this.partialLengths,r,o,i),this.clientSeqNumbers[i]===void 0&&(this.clientSeqNumbers[i]=[]),rt.addSeq(this.clientSeqNumbers[i],r,o),rt.options.zamboni&&this.zamboni(s),rt.options.verify&&this.verify()}getPartialLength(e,t){let r=this.minLength;const i=ko(this.partialLengths,e),s=this.cliLatest(t),o=this.clientSeqNumbers[t];if(i>=0){if(r+=this.partialLengths[i].len,s>=0){const a=o[s];if(a.seq>e){r+=a.len;const l=this.cliLatestLEQ(t,e);l>=0&&(r-=o[l].len)}}}else if(s>=0){const a=o[s];r+=a.len}return r}toString(e,t=0){let r="";for(const i of this.partialLengths)r+=`(${i.seq},${i.len}) `;for(const i in this.clientSeqNumbers)if(this.clientSeqNumbers[i].length>0){r+="Client ",e?r+=`${e(+i)}`:r+=`${i}`,r+="[";for(const s of this.clientSeqNumbers[i])r+=`(${s.seq},${s.len})`;r+="]"}return r=`min(seq ${this.minSeq}): ${this.minLength}; sc: ${this.segmentCount};${r}`,r}zamboni(e){function t(r){const i=ko(r,e.minSeq);let s=0;if(i>=0){s=r[i].len;const o=r.length;if(i<=o-1){const a=o-i-1;for(let l=0;l<a;l++)r[l]=r[l+i+1],r[l].len-=s;r.length=a}}return s}this.minLength+=t(this.partialLengths);for(const r in this.clientSeqNumbers){const i=this.clientSeqNumbers[r];i&&t(i)}}addClientSeqNumber(e,t,r){this.clientSeqNumbers[e]===void 0&&(this.clientSeqNumbers[e]=[]);const i=this.clientSeqNumbers[e];let s=r;i.length>0&&(s+=i[i.length-1].len),i.push({seq:t,len:s,seglen:r})}addClientSeqNumberFromPartial(e){this.addClientSeqNumber(e.clientId,e.seq,e.seglen),e.overlapRemoveClients&&e.overlapRemoveClients.map(t=>(this.addClientSeqNumber(t.data.clientId,e.seq,t.data.seglen),!0))}cliLatestLEQ(e,t){const r=this.clientSeqNumbers[e];return r?ko(r,t):-1}cliLatest(e){const t=this.clientSeqNumbers[e];return t&&t.length>0?t.length-1:-1}verifyPartialLengths(e,t){if(e.length===0)return 0;let r=0,i=0,s=0;for(const o of e)s++,J(this.minSeq<=o.seq,84),J(r<o.seq,85),r=o.seq,i+=o.seglen,i!==o.len&&J(!1,86),t||this.minLength+o.len<0&&J(!1,87),o.overlapRemoveClients&&(J(!t,88),s+=o.overlapRemoveClients.size());return s}verify(){if(this.clientSeqNumbers){let e=0;for(const r of this.clientSeqNumbers)r&&(e+=this.verifyPartialLengths(r,!0));J(!!this.partialLengths,89);const t=this.verifyPartialLengths(this.partialLengths,!1);J(t===e,90)}else J(!this.partialLengths,91)}}rt.options={verify:!1,zamboni:!0};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class A7{constructor(e){this.segment=e,this.segmentGroups=Qo()}get size(){return this.segmentGroups.count()}get empty(){return this.segmentGroups.empty()}enqueue(e){this.segmentGroups.enqueue(e),e.segments.push(this.segment)}dequeue(){return this.segmentGroups.dequeue()}clear(){this.segmentGroups.clear()}copyTo(e){this.segmentGroups.walk(t=>e.segmentGroups.enqueue(t))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Ra{constructor(){this.pendingRewriteCount=0}ackPendingProperties(e){var t,r;e.combiningOp&&e.combiningOp.name==="rewrite"&&this.pendingRewriteCount--;for(const i of Object.keys(e.props))((t=this.pendingKeyUpdateCount)===null||t===void 0?void 0:t[i])!==void 0&&(J(this.pendingKeyUpdateCount[i]>0,92),this.pendingKeyUpdateCount[i]--,((r=this.pendingKeyUpdateCount)===null||r===void 0?void 0:r[i])===0&&delete this.pendingKeyUpdateCount[i])}addProperties(e,t,r,i,s=!1){var o;if(this.pendingKeyUpdateCount||(this.pendingKeyUpdateCount=Zt()),this.pendingRewriteCount>0&&i!==ie&&s)return;const a=r&&r.name==="rewrite",l=a?void 0:r||void 0,c=d=>{var h;return!!(i===ie||((h=this.pendingKeyUpdateCount)===null||h===void 0?void 0:h[d])===void 0||l)},u={};if(a){s&&i===ie&&this.pendingRewriteCount++;for(const d of Object.keys(e))!t[d]&&c(d)&&(u[d]=e[d],delete e[d])}for(const d of Object.keys(t)){if(s){if(i===ie)((o=this.pendingKeyUpdateCount)===null||o===void 0?void 0:o[d])===void 0&&(this.pendingKeyUpdateCount[d]=0),this.pendingKeyUpdateCount[d]++;else if(!c(d))continue}const h=e[d];u[d]=h===void 0?null:h;let f;l?f=Tk(l,h,f,i):f=t[d],f===null?delete e[d]:e[d]=f}return u}copyTo(e,t,r){if(e){if(t||(t=Zt()),!r)throw new Error("Must provide new PropertyManager");for(const i of Object.keys(e))t[i]=e[i];r.pendingRewriteCount=this.pendingRewriteCount,r.pendingKeyUpdateCount=Zt();for(const i of Object.keys(this.pendingKeyUpdateCount))r.pendingKeyUpdateCount[i]=this.pendingKeyUpdateCount[i]}return t}hasPendingProperties(){return this.pendingRewriteCount>0||Object.keys(this.pendingKeyUpdateCount).length>0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ts(n){if((n==null?void 0:n.removedClientIds)!==void 0&&(n==null?void 0:n.removedSeq)!==void 0)return n;J((n==null?void 0:n.removedClientIds)===void 0&&(n==null?void 0:n.removedSeq)===void 0,703)}function M7(n){return ts(n)!==void 0}function Em(n){const e=ts(n);return e!==void 0&&e.removedSeq!==ie}class Pk{constructor(){this.index=0,this.ordinal="",this.cachedLength=0}isLeaf(){return!1}}function $_(n,e){const t=ao(n);if(t)for(const r of t)e[r]=n}function j_(n,e){const t=ao(n);if(t)for(const r of t)e[r]===void 0&&(e[r]=n)}function Rk(n,e){for(const t in e){const r=e[t];if(!r.empty()){let i=n[t];i===void 0&&(i=new ES,n[t]=i);for(const s of r.items)xS(i,s)}}}function xS(n,e){if(Xe(e,ne.NestBegin))return n.push(e),!0;{const t=n.top();return t&&Xe(t,ne.NestBegin)?n.pop():n.push(e),!1}}function D7(n,e,t,r,i){var s;function o(a,l){let c=i[a];c===void 0&&(c=new ES,i[a]=c),xS(c,l)}if(e.isLeaf()){const a=e;if(((s=n.localNetLength(a))!==null&&s!==void 0?s:0)>0)if(Pt.is(a)){const l=a.getId();if(l&&n.mapIdToSegment(l,a),Xe(a,ne.Tile)&&($_(a,t),j_(a,r)),a.refType&(ne.NestBegin|ne.NestEnd)){const c=lo(a);if(c)for(const u of c)o(u,a)}}else{const l=e;if(l.localRefs&&l.localRefs.hierRefCount!==void 0&&l.localRefs.hierRefCount>0){for(const c of l.localRefs)if(Xe(c,ne.Tile)&&($_(c,t),j_(c,r)),c.refType&(ne.NestBegin|ne.NestEnd))for(const u of lo(c))o(u,c)}}}else{const a=e;Rk(i,a.rangeStacks),xk(t,a.rightmostTiles),O7(r,a.leftmostTiles)}}const vn=8;class F7 extends Pk{constructor(e){super(),this.childCount=e,this.children=new Array(vn)}hierBlock(){}setOrdinal(e,t){let r=this.childCount;r===8&&(r=7),J(r>=1&&r<=7,64);let i;const s=1<<vn-(r+1);if(t===0)i=s-1;else{const o=this.children[t-1].ordinal;i=o.charCodeAt(o.length-1)+s}e.ordinal=this.ordinal+String.fromCharCode(i),J(e.ordinal.length===this.ordinal.length+1,65),t>0&&J(e.ordinal>this.children[t-1].ordinal,66)}assignChild(e,t,r=!0){e.parent=this,e.index=t,r&&this.setOrdinal(e,t),this.children[t]=e}}class z7 extends F7{constructor(e){super(e),this.rightmostTiles=Zt(),this.leftmostTiles=Zt(),this.rangeStacks=Zt()}addNodeReferences(e,t){D7(e,t,this.rightmostTiles,this.leftmostTiles,this.rangeStacks)}hierBlock(){return this}hierToString(e){let t="";for(const r in this.rangeStacks){const i=this.rangeStacks[r];t+=H7(e),t+=`${r}: `;for(const s of i.items)t+=`${s.toString()} `;t+=`
`}return t}}function $7(n,e){return e.isLeaf()?n.localNetLength(e):e.cachedLength}class mf extends Pk{constructor(){super(...arguments),this.clientId=As,this.seq=Qt,this.segmentGroups=new A7(this),this.trackingCollection=new I7(this)}addProperties(e,t,r,i){return this.propertyManager||(this.propertyManager=new Ra),this.properties||(this.properties=Zt()),this.propertyManager.addProperties(this.properties,e,t,r,i&&i.collaborating)}hasProperty(e){return!!this.properties&&this.properties[e]!==void 0}isLeaf(){return!0}cloneInto(e){var t;e.clientId=this.clientId,e.properties=x7(this.properties),e.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),e.removedSeq=this.removedSeq,e.seq=this.seq}canAppend(e){return!1}addSerializedProps(e){this.properties&&(e.props=this.properties)}ack(e,t,r){const i=this.segmentGroups.dequeue();switch(J(i===e,67),t.op.type){case ue.ANNOTATE:return J(!!this.propertyManager,68),this.propertyManager.ackPendingProperties(t.op),!0;case ue.INSERT:return J(this.seq===ie,69),this.seq=t.sequencedMessage.sequenceNumber,this.localSeq=void 0,!0;case ue.REMOVE:const s=ts(this);return J(s!==void 0,70),this.localRemovedSeq=void 0,s.removedSeq===ie?(s.removedSeq=t.sequencedMessage.sequenceNumber,!0):!1;default:throw new Error(`${t.op.type} is in unrecognized operation type`)}}splitAt(e){var t;if(e>0){const r=this.createSplitSegmentAt(e);return r&&(this.copyPropertiesTo(r),r.parent=this.parent,r.ordinal=this.ordinal+String.fromCharCode(0),r.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),r.removedSeq=this.removedSeq,r.localRemovedSeq=this.localRemovedSeq,r.seq=this.seq,r.localSeq=this.localSeq,r.clientId=this.clientId,this.segmentGroups.copyTo(r),this.trackingCollection.copyTo(r),this.localRefs&&this.localRefs.split(e,r)),r}}copyPropertiesTo(e){this.propertyManager&&this.properties&&(e.propertyManager=new Ra,e.properties=this.propertyManager.copyTo(this.properties,e.properties,e.propertyManager))}}const q_="markerId",j7="markerSimpleType";class Pt extends mf{constructor(e){super(),this.refType=e,this.type=Pt.type,this.cachedLength=1}static is(e){return e.type===Pt.type}static make(e,t){const r=new Pt(e);return t&&r.addProperties(t),r}toJSONObject(){const e={marker:{refType:this.refType}};return super.addSerializedProps(e),e}static fromJSONObject(e){if(e&&typeof e=="object"&&"marker"in e)return Pt.make(e.marker.refType,e.props)}clone(){const e=Pt.make(this.refType,this.properties);return this.cloneInto(e),e}getSegment(){return this}getOffset(){return 0}hasSimpleType(e){return!!this.properties&&this.properties[j7]===e}getProperties(){return this.properties}getId(){if(this.properties&&this.properties[q_])return this.properties[q_]}hasTileLabels(){return Ms(this)}hasRangeLabels(){return Ds(this)}hasTileLabel(e){return pf(this,e)}hasRangeLabel(e){return _S(this,e)}getTileLabels(){return ao(this)}getRangeLabels(){return lo(this)}toString(){let e="";Xe(this,ne.Tile)&&(e+="Tile"),Xe(this,ne.NestBegin)&&(e.length>0&&(e+="; "),e+="RangeBegin"),Xe(this,ne.NestEnd)&&(e.length>0&&(e+="; "),e+="RangeEnd");let t="";const r=this.getId();r&&(e+=` (${r}) `);const i=ao(this);if(i){t+="tile -- ";for(let a=0,l=i.length;a<l;a++){const c=i[a];a>0&&(t+="; "),t+=c}}const s=lo(this);if(s){let a="begin";Xe(this,ne.NestEnd)&&(a="end"),i&&(t+=" "),t+=`range ${a} -- `;const l=s;for(let c=0,u=l.length;c<u;c++){const d=l[c];c>0&&(t+="; "),t+=d}}let o="";return this.properties&&(o+=JSON.stringify(this.properties,(a,l)=>{const c=!!l&&l.IFluidHandle;return c?`#Handle(${c.routeContext.path}/${c.path})`:l})),`M ${e}: ${t} ${o}`}createSplitSegmentAt(e){}canAppend(e){return!1}append(){throw new Error("Can not append to marker")}}Pt.type="Marker";var da;(function(n){n[n.Go=0]="Go",n[n.Stop=1]="Stop",n[n.Yield=2]="Yield"})(da||(da={}));class q7{constructor(e,t,r,i,s,o,a,l,c=0){this.block=e,this.actions=t,this.pos=r,this.refSeq=i,this.clientId=s,this.context=o,this.start=a,this.end=l,this.childIndex=c,this.op=da.Go}}class B7{constructor(){this.clientId=As,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0}loadFrom(e){this.clientId=e.clientId,this.collaborating=e.collaborating,this.minSeq=e.minSeq,this.currentSeq=e.currentSeq}}const B_=(n,e)=>n-e,U7=(n,e)=>n.localeCompare(e),Du=[""," ","  "];function H7(n){if(Du[n]===void 0){Du[n]="";for(let e=0;e<n;e++)Du[n]+=" "}return Du[n]}const V7={min:{maxSeq:-2},compare:(n,e)=>n.maxSeq-e.maxSeq};function kk(n,e){for(const t of e.rangeLabels)if(_S(n,t)){let r=e.stacks[t];r===void 0&&(r=new ES,e.stacks[t]=r),xS(r,n)}}function W7(n,e,t,r,i,s,o){return Pt.is(n)&&n.refType&(ne.NestBegin|ne.NestEnd)&&kk(n,o),!1}function G7(n,e,t,r,i,s,o){var a;if(n.isLeaf()){const l=n;((a=o.mergeTree.localNetLength(l))!==null&&a!==void 0?a:0)>0&&Pt.is(l)&&l.refType&(ne.NestBegin|ne.NestEnd)&&kk(l,o)}else{const l=n;Rk(o.stacks,l.rangeStacks)}return!0}function U_(n,e,t,r,i,s,o){return Pt.is(n)&&pf(n,o.tileLabel)&&(o.tile=n),!1}function H_(n,e,t,r,i,s,o){if(n.isLeaf()){const a=n;o.mergeTree.localNetLength(a)>0&&Pt.is(a)&&pf(a,o.tileLabel)&&(o.tile=a)}else{const a=n;let l;o.posPrecedesTile?l=a.rightmostTiles[o.tileLabel]:l=a.leftmostTiles[o.tileLabel],l!==void 0&&(o.tile=l)}return!0}const K7={min:{minRequired:Number.MIN_VALUE,onMinGE:()=>{J(!1,72)}},compare:(n,e)=>n.minRequired-e.minRequired};class lt{constructor(e){this.options=e,this.blockUpdateActions=lt.initBlockUpdateActions,this.collabWindow=new B7,this.idToSegment=new Map,this.splitLeafSegment=(t,r)=>{if(!(r>0&&t))return{};const i=t.splitAt(r);return this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Mu.SPLIT,deltaSegments:[{segment:t},{segment:i}]},void 0),{next:i}},this.root=this.makeBlock(0)}makeBlock(e){const t=new z7(e);return t.ordinal="",t}clone(){const e=new lt(this.options);e.root=e.blockClone(this.root)}blockClone(e,t){const r=this.makeBlock(e.childCount);for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=this.segmentClone(s);r.assignChild(o,i),t&&t.push(o)}else r.assignChild(this.blockClone(s,t),i)}return this.nodeUpdateLengthNewStructure(r),this.nodeUpdateOrdinals(r),r}segmentClone(e){return e.clone()}localNetLength(e){return ts(e)!==void 0?0:e.cachedLength}mapIdToSegment(e,t){this.idToSegment.set(e,t)}addNode(e,t){const r=e.childCount++;return e.assignChild(t,r,!1),r}reloadFromSegments(e){J(!this.collabWindow.collaborating,73);const t=vn-1,r=i=>{const s=Math.ceil(i.length/t),o=new Array(s);for(let a=0,l=0;l<s;l++){const c=o[l]=this.makeBlock(0);for(let u=0;u<t&&a<i.length;u++,a++)this.addNode(c,i[a]);this.blockUpdate(c)}return o.length===1?o[0]:r(o)};e.length>0?(this.root=r(e),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}startCollaboration(e,t,r){this.collabWindow.clientId=e,this.collabWindow.minSeq=t,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=r,this.segmentsToScour=new z_([],V7),this.pendingSegments=Qo(),this.nodeUpdateLengthNewStructure(this.root,!0)}addToLRUSet(e,t){e.parent.needsScour!==!0&&t>this.collabWindow.currentSeq&&(e.parent.needsScour=!0,this.segmentsToScour.add({segment:e,maxSeq:t}))}underflow(e){return e.childCount<vn/2}scourNode(e,t){let r;for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=s;o.segmentGroups.empty?o.removedSeq!==void 0?(o.removedSeq>this.collabWindow.minSeq?t.push(o):o.trackingCollection.empty?(this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Mu.UNLINK,deltaSegments:[{segment:o}]},void 0),o.parent=void 0):t.push(o),r=void 0):o.seq<=this.collabWindow.minSeq?r&&r.canAppend(o)&&eu(r.properties,o.properties)&&r.trackingCollection.matches(o.trackingCollection)&&this.localNetLength(o)>0?(r.append(o),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Mu.APPEND,deltaSegments:[{segment:r},{segment:o}]},void 0),o.parent=void 0,o.trackingCollection.trackingGroups.forEach(l=>l.unlink(o))):(t.push(o),this.localNetLength(o)>0?r=o:r=void 0):(t.push(o),r=void 0):(t.push(o),r=void 0)}else t.push(s),r=void 0}}packParent(e){const t=e.children;let r,i;const s=[];for(r=0;r<e.childCount;r++)i=t[r],this.scourNode(i,s),i.parent=void 0;const o=s.length,a=vn/2;let l=Math.min(vn-1,Math.floor(o/a));l<1&&(l=1);const c=Math.floor(o/l);let u=o%l;const d=new Array(vn);let h=0;for(let f=0;f<l;f++){let p=c;u>0&&(p++,u--);const g=this.makeBlock(p);for(let S=0;S<p;S++){const m=s[h++];g.assignChild(m,S,!1)}g.parent=e,d[f]=g,this.nodeUpdateLengthNewStructure(g)}e.children=d;for(let f=0;f<l;f++)e.assignChild(d[f],f,!1);e.childCount=l,this.underflow(e)&&e.parent?this.packParent(e.parent):(this.nodeUpdateOrdinals(e),this.blockUpdatePathLengths(e,ie,-1,!0))}zamboniSegments(e=lt.zamboniSegmentsMaxCount){if(this.collabWindow.collaborating)for(let t=0;t<e;t++){let r=this.segmentsToScour.peek();if(!r||r.maxSeq>this.collabWindow.minSeq)break;if(r=this.segmentsToScour.get(),r.segment.parent&&r.segment.parent.needsScour!==!1){const i=r.segment.parent,s=[];this.scourNode(i,s),i.needsScour=!1;const o=s.length;if(o<i.childCount){i.childCount=o,i.children=s;for(let a=0;a<o;a++)i.assignChild(s[a],a,!1);this.underflow(i)&&i.parent?this.packParent(i.parent):(this.nodeUpdateOrdinals(i),this.blockUpdatePathLengths(i,ie,-1,!0))}}}}getCollabWindow(){return this.collabWindow}getStats(){const e=r=>{const i={maxHeight:0,nodeCount:0,leafCount:0,removedLeafCount:0,liveCount:0,histo:[]};for(let s=0;s<vn;s++)i.histo[s]=0;for(let s=0;s<r.childCount;s++){const o=r.children[s];let a=1;if(o.isLeaf())i.leafCount++,o.removedSeq!==void 0&&i.removedLeafCount++;else{const l=e(o);a=1+l.maxHeight,i.nodeCount+=l.nodeCount,i.leafCount+=l.leafCount,i.removedLeafCount+=l.removedLeafCount,i.liveCount+=l.liveCount;for(let c=0;c<vn;c++)i.histo[c]+=l.histo[c]}a>i.maxHeight&&(i.maxHeight=a)}return i.histo[r.childCount]++,i.nodeCount++,i.liveCount+=r.childCount,i};return e(this.root)}getLength(e,t){return this.blockLength(this.root,e,t)}get length(){return this.root.cachedLength}getPosition(e,t,r){var i;let s=0,o=e.parent,a;for(;o;){const l=o.children;for(let c=0;c<o.childCount;c++){const u=l[c];if(a&&u===a||u===e)break;s+=(i=this.nodeLength(u,t,r))!==null&&i!==void 0?i:0}a=o,o=o.parent}return s}getContainingSegment(e,t,r){let i,s;const o=(a,l,c,u,d)=>(i=a,s=d,!1);return this.searchBlock(this.root,e,0,t,r,{leaf:o},void 0),{segment:i,offset:s}}_getSlideToSegment(e){if(!e.segment||!Em(e.segment))return e;let t;const r=i=>i.seq!==ie&&!Em(i)?(t=i,!1):!0;return this.rightExcursion(e.segment,r),t?{segment:t,offset:0}:(this.leftExcursion(e.segment,r),t=t,t?{segment:t,offset:t.cachedLength-1}:{segment:void 0,offset:0})}slideReferences(e,t){var r,i,s,o,a;J(Em(e),753),J(!!e.localRefs,754);const l=this._getSlideToSegment({segment:e,offset:0}),c=l.segment;c&&!c.localRefs&&(c.localRefs=new ii(c));for(const u of t){(i=(r=u.callbacks)===null||r===void 0?void 0:r.beforeSlide)===null||i===void 0||i.call(r);const d=e.localRefs.removeLocalRef(u);J(u===d,755),c?(u.segment=c,u.offset=(s=l.offset)!==null&&s!==void 0?s:0,J(!!c.localRefs,756),c.localRefs.addLocalRef(u)):(u.segment=void 0,u.offset=0),(a=(o=u.callbacks)===null||o===void 0?void 0:o.afterSlide)===null||a===void 0||a.call(o)}c&&this.blockUpdatePathLengths(c.parent,Ss,As)}updateSegmentRefsAfterMarkRemoved(e,t){if(!e.localRefs||e.localRefs.empty)return;const r=[],i=[];for(const s of e.localRefs)Xe(s,ne.StayOnRemove)?i.push(s):Xe(s,ne.SlideOnRemove)&&(t?i.push(s):r.push(s));t||this.slideReferences(e,r),e.localRefs.clear();for(const s of i)s.segment=e,e.localRefs.addLocalRef(s)}blockLength(e,t,r){return this.collabWindow.collaborating&&r!==this.collabWindow.clientId?e.partialLengths.getPartialLength(t,r):e.cachedLength}nodeLength(e,t,r){if(!this.collabWindow.collaborating||this.collabWindow.clientId===r)return e.isLeaf()?this.localNetLength(e):e.cachedLength;if(e.isLeaf()){const i=e,s=ts(i);return s!==void 0&&s.removedSeq!==ie&&s.removedSeq<=t?void 0:i.clientId===r||i.seq!==ie&&i.seq<=t?s!==void 0&&s.removedClientIds.includes(r)?0:i.cachedLength:s!==void 0&&s.removedSeq!==ie?void 0:0}else return e.partialLengths.getPartialLength(t,r)}addMinSeqListener(e,t){this.minSeqListeners||(this.minSeqListeners=new z_([],K7)),this.minSeqListeners.add({minRequired:e,onMinGE:t})}notifyMinSeqListeners(){if(this.minSeqListeners)for(;this.minSeqListeners.count()>0&&this.minSeqListeners.peek().minRequired<=this.collabWindow.minSeq;)this.minSeqListeners.get().onMinGE(this.collabWindow.minSeq)}setMinSeq(e){J(e<=this.collabWindow.currentSeq,78),J(this.collabWindow.minSeq<=e,79),e>this.collabWindow.minSeq&&(this.collabWindow.minSeq=e,lt.options.zamboniSegments&&this.zamboniSegments(),this.notifyMinSeqListeners())}referencePositionToLocalPosition(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){const i=e.getSegment();return i&&i.parent?(i.removedSeq?0:e.getOffset())+this.getPosition(i,t,r):yo.DetachedPosition}getStackContext(e,t,r){const i={mergeTree:this,stacks:Zt(),rangeLabels:r};return this.search(e,Qt,t,{leaf:W7,shift:G7},i),i.stacks}findTile(e,t,r,i=!0){const s={mergeTree:this,posPrecedesTile:i,tileLabel:r};if(i?this.search(e,Qt,t,{leaf:U_,shift:H_},s):this.backwardSearch(e,Qt,t,{leaf:U_,shift:H_},s),s.tile){let o;if(s.tile.isLeaf()){const a=s.tile;o=this.getPosition(a,Qt,t)}else o=s.tile.toPosition();return{tile:s.tile,pos:o}}}search(e,t,r,i,s){return this.searchBlock(this.root,e,0,t,r,i,s)}searchBlock(e,t,r,i,s,o,a){var l;let c=t,u=r;const d=e.children;o&&o.pre&&o.pre(e,u,i,s,void 0,void 0,a);const h=o&&o.contains;for(let f=0;f<e.childCount;f++){const p=d[f],g=(l=this.nodeLength(p,i,s))!==null&&l!==void 0?l:0;if(!h&&c<g||h&&h(p,c,i,s,void 0,void 0,a))return p.isLeaf()?(o&&o.leaf&&o.leaf(p,u,i,s,c,-1,a),p):this.searchBlock(p,c,u,i,s,o,a);o&&o.shift&&o.shift(p,u,i,s,c,void 0,a),c-=g,u+=g}o&&o.post&&o.post(e,u,i,s,void 0,void 0,a)}backwardSearch(e,t,r,i,s){const o=this.getLength(t,r);if(!(e>o))return this.backwardSearchBlock(this.root,e,o,t,r,i,s)}backwardSearchBlock(e,t,r,i,s,o,a){var l;let c=r;const u=e.children;o&&o.pre&&o.pre(e,c,i,s,void 0,void 0,a);const d=o&&o.contains;for(let h=e.childCount-1;h>=0;h--){const f=u[h],p=(l=this.nodeLength(f,i,s))!==null&&l!==void 0?l:0,g=c-p;if(!d&&t>=g||d&&d(f,t,i,s,void 0,void 0,a))return f.isLeaf()?(o&&o.leaf&&o.leaf(f,g,i,s,t,-1,a),f):this.backwardSearchBlock(f,t,c,i,s,o,a);o&&o.shift&&o.shift(f,g,i,s,t,void 0,a),c=g}o&&o.post&&o.post(e,c,i,s,void 0,void 0,a)}updateRoot(e){if(e!==void 0){const t=this.makeBlock(2);t.assignChild(this.root,0,!1),t.assignChild(e,1,!1),this.root=t,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}}ackPendingSegment(e){const t=e.sequencedMessage.sequenceNumber,r=this.pendingSegments.dequeue(),i=[];let s=!1;if(r!==void 0){const o=[];r.segments.map(l=>{const c=!l.ack(r,e,this);s=c||s,!c&&e.op.type===ue.REMOVE&&this.updateSegmentRefsAfterMarkRemoved(l,!1),lt.options.zamboniSegments&&this.addToLRUSet(l,t),i.includes(l.parent)||i.push(l.parent),o.push({segment:l})}),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({deltaSegments:o,operation:Mu.ACKNOWLEDGED},e);const a=this.collabWindow.clientId;for(const l of i)this.blockUpdatePathLengths(l,t,a,s)}lt.options.zamboniSegments&&this.zamboniSegments()}addToPendingList(e,t,r){let i=t;return i===void 0&&(i={segments:[],localSeq:r},this.pendingSegments.enqueue(i)),e.segmentGroups.enqueue(i),i}getMarkerFromId(e){return this.idToSegment.get(e)}posFromRelativePos(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){let i=-1,s;return e.id&&(s=this.getMarkerFromId(e.id)),s&&(i=this.getPosition(s,t,r),e.before?e.offset!==void 0&&(i-=e.offset):(i+=s.cachedLength,e.offset!==void 0&&(i+=e.offset))),i}insertSegments(e,t,r,i,s,o){this.ensureIntervalBoundary(e,r,i);const a=s===ie?++this.collabWindow.localSeq:void 0;this.blockInsert(e,r,i,s,a,t),this.mergeTreeDeltaCallback&&o!==void 0&&this.mergeTreeDeltaCallback(o,{operation:ue.INSERT,deltaSegments:t.map(l=>({segment:l}))}),this.collabWindow.collaborating&&lt.options.zamboniSegments&&s!==ie&&this.zamboniSegments()}insertAtReferencePosition(e,t,r){if(t.cachedLength===0)return;if(t.parent||t.removedSeq||t.seq!==Qt)throw new Error("Cannot insert segment that has already been inserted.");const i=u=>{let d=u.parent,h=d;for(;d!==void 0;){if(d.childCount>=vn){const f=this.split(d);d===this.root?(this.updateRoot(f),h=void 0):(this.insertChildNode(d.parent,f,d.index+1),h=f.parent,this.blockUpdateLength(d.parent,ie,s))}else this.blockUpdateLength(d,ie,s);d=d.parent}h&&this.nodeUpdateOrdinals(h)},s=this.collabWindow.clientId,o=e.getSegment(),a=e.getOffset(),l=this.nodeLength(o,this.collabWindow.currentSeq,s);let c=o;if(a!==0&&l!==void 0&&l!==0){const u=this.splitLeafSegment(o,a);J(!!u.next,80),this.insertChildNode(o.parent,u.next,o.index+1),i(u.next),c=u.next}if(this.leftExcursion(c,u=>{if(!u.isLeaf())return!0;const d=this.nodeLength(u,this.collabWindow.currentSeq,s);return d===void 0?!0:d===0?(this.breakTie(0,u,ie)&&(c=u),!0):!1}),this.collabWindow.collaborating?(t.localSeq=++this.collabWindow.localSeq,t.seq=ie):t.seq=Qt,t.clientId=s,Pt.is(t)){const u=t.getId();u&&this.mapIdToSegment(u,t)}this.insertChildNode(c.parent,t,c.index),i(t),this.mergeTreeDeltaCallback&&this.mergeTreeDeltaCallback(r,{deltaSegments:[{segment:t}],operation:ue.INSERT}),this.collabWindow.collaborating&&this.addToPendingList(t,void 0,t.localSeq)}resolveRemoteClientPosition(e,t,r){if(t<this.collabWindow.minSeq)return;const i=this.getContainingSegment(e,t,r),s=this.getCollabWindow();if(i&&i.segment)return this.getPosition(i.segment,s.currentSeq,s.clientId)+i.offset;if(e===this.getLength(t,r))return this.getLength(s.currentSeq,s.clientId)}insertChildNode(e,t,r){J(e.childCount<vn,81);for(let i=e.childCount;i>r;i--)e.children[i]=e.children[i-1],e.children[i].index=i;e.childCount++,e.assignChild(t,r,!1)}blockInsert(e,t,r,i,s,o){let a=!1;const l=p=>(p.seq===ie&&(a=!0),!1),c=p=>(a=!1,this.rightExcursion(p,l),a);let u;const d=p=>{this.collabWindow.collaborating&&(p.seq===ie&&r===this.collabWindow.clientId?u=this.addToPendingList(p,u,s):p.seq>this.collabWindow.minSeq&&lt.options.zamboniSegments&&this.addToLRUSet(p,p.seq))},h=(p,g,S)=>{const m={};return p?(m.replaceCurrent=S.candidateSegment,m.next=p):m.next=S.candidateSegment,m};let f=e;for(const p of o)if(a=!1,p.cachedLength>0){if(p.seq=i,p.localSeq=s,p.clientId=r,Pt.is(p)){const S=p.getId();S&&this.mapIdToSegment(S,p)}const g=this.insertingWalk(this.root,f,t,r,i,{leaf:h,candidateSegment:p,continuePredicate:c});if(p.parent===void 0)throw new Error(`MergeTree insert failed: ${JSON.stringify({currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:p.seq})}`);this.updateRoot(g),d(p),f+=p.cachedLength}}ensureIntervalBoundary(e,t,r){const i=this.insertingWalk(this.root,e,t,r,Ss,{leaf:this.splitLeafSegment});this.updateRoot(i)}breakTie(e,t,r){var i;if(t.isLeaf()){if(e===0){const s=r===ie?Number.MAX_SAFE_INTEGER:r,o=t.seq===ie?Number.MAX_SAFE_INTEGER-1:(i=t.seq)!==null&&i!==void 0?i:0;return s>o}return!1}else return!0}leftExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let a,l,c=!1;for(a=s.childCount-1;a>=0;a--)if(l=o[a],c){if(l.isLeaf())r=t(l,0,Qt,this.collabWindow.clientId,0,0,void 0);else{const u=l;r=this.nodeMapReverse(u,t,0,Qt,this.collabWindow.clientId)}if(!r)return}else c=i===l;i=s,s=s.parent}}rightExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let a,l,c=!1;for(a=0;a<s.childCount;a++)if(l=o[a],c){if(l.isLeaf())r=t(l);else{const u=l;r=this.walkAllSegments(u,t)}if(!r)return}else c=i===l;i=s,s=s.parent}}insertingWalk(e,t,r,i,s,o){let a=t;const l=e.children;let c,u,d,h;for(c=0;c<e.childCount;c++){u=l[c];const f=this.nodeLength(u,r,i);if(f!==void 0)if(a<f||a===f&&this.breakTie(a,u,s)){if(u.isLeaf()){const p=u,g=o.leaf(p,a,o);if(g.replaceCurrent&&(e.assignChild(g.replaceCurrent,c,!1),g.replaceCurrent.ordinal=u.ordinal),g.next)d=g.next,c++;else{o.structureChange&&this.nodeUpdateLengthNewStructure(e);return}}else{const p=u,g=this.insertingWalk(p,a,r,i,s,o);if(g===void 0){o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else if(g===lt.theUnfinishedNode){a-=f;continue}else d=g,h=g,c++}break}else a-=f}if(!d&&a===0){if(s!==ie&&o.continuePredicate&&o.continuePredicate(e))return lt.theUnfinishedNode;d=o.leaf(void 0,a,o).next}if(d){for(let f=e.childCount;f>c;f--)e.children[f]=e.children[f-1],e.children[f].index=f;if(e.assignChild(d,c,!1),e.childCount++,e.setOrdinal(d,c),e.childCount<vn){h&&this.nodeUpdateOrdinals(h),o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else return this.split(e)}else return}split(e){const t=vn/2,r=this.makeBlock(t);e.childCount=t,this.nodeUpdateOrdinals(e);for(let i=0;i<t;i++)r.assignChild(e.children[t+i],i,!1),e.children[t+i]=void 0;return this.nodeUpdateLengthNewStructure(e),this.nodeUpdateLengthNewStructure(r),r}nodeUpdateOrdinals(e){for(let t=0;t<e.childCount;t++){const r=e.children[t];e.setOrdinal(r,t),r.isLeaf()||this.nodeUpdateOrdinals(r)}}annotateRange(e,t,r,i,s,o,a,l){this.ensureIntervalBoundary(e,s,o),this.ensureIntervalBoundary(t,s,o);const c=[],u=a===ie?++this.collabWindow.localSeq:void 0;let d;const h=f=>{const p=f.addProperties(r,i,a,this.collabWindow);return c.push({segment:f,propertyDeltas:p}),this.collabWindow.collaborating&&(a===ie?d=this.addToPendingList(f,d,u):lt.options.zamboniSegments&&this.addToLRUSet(f,a)),!0};this.mapRange({leaf:h},s,o,void 0,e,t),this.mergeTreeDeltaCallback&&c.length>0&&this.mergeTreeDeltaCallback(l,{operation:ue.ANNOTATE,deltaSegments:c}),this.collabWindow.collaborating&&a!==ie&&lt.options.zamboniSegments&&this.zamboniSegments()}markRangeRemoved(e,t,r,i,s,o=!1,a){let l=o;this.ensureIntervalBoundary(e,r,i),this.ensureIntervalBoundary(t,r,i);let c;const u=[],d=[],h=s===ie?++this.collabWindow.localSeq:void 0,f=(S,m,v,y)=>{const b=ts(S);return b!==void 0?(l=!0,b.removedSeq===ie?(b.removedClientIds.unshift(i),b.removedSeq=s,S.localRemovedSeq=void 0):b.removedClientIds.push(i)):(S.removedClientIds=[i],S.removedSeq=s,S.localRemovedSeq=h,u.push({segment:S})),S.localRefs&&!S.localRefs.empty&&d.push(S),this.collabWindow.collaborating&&(S.removedSeq===ie&&i===this.collabWindow.clientId?c=this.addToPendingList(S,c,h):lt.options.zamboniSegments&&this.addToLRUSet(S,s)),!0},p=(S,m,v,y)=>(l?this.nodeUpdateLengthNewStructure(S):this.blockUpdateLength(S,s,i),!0);this.mapRange({leaf:f,post:p},r,i,void 0,e,t);const g=this.collabWindow.collaborating&&i===this.collabWindow.clientId;for(const S of d)this.updateSegmentRefsAfterMarkRemoved(S,g);this.mergeTreeDeltaCallback&&u.length>0&&this.mergeTreeDeltaCallback(a,{operation:ue.REMOVE,deltaSegments:u}),this.collabWindow.collaborating&&s!==ie&&lt.options.zamboniSegments&&this.zamboniSegments()}nodeUpdateLengthNewStructure(e,t=!1){this.blockUpdate(e),this.collabWindow.collaborating&&(e.partialLengths=rt.combine(this,e,this.collabWindow,t))}removeLocalReferencePosition(e){var t;const r=e.getSegment();if(r){const i=(t=r==null?void 0:r.localRefs)===null||t===void 0?void 0:t.removeLocalRef(e);return i!==void 0&&this.blockUpdatePathLengths(r.parent,Ss,As),i}}createLocalReferencePosition(e,t,r,i,s){var o;if(M7(e)&&!Xe(r,ne.SlideOnRemove|ne.Transient))throw new Ee("Can only create SlideOnRemove or Transient local reference position on a removed segment");const a=(o=e.localRefs)!==null&&o!==void 0?o:new ii(e);e.localRefs=a;const l=a.createLocalRef(t,r,i,s);return this.blockUpdatePathLengths(e.parent,Ss,As),l}removeLocalReference(e,t){e.localRefs&&e.localRefs.removeLocalRef(t)&&this.blockUpdatePathLengths(e.parent,Ss,As)}addLocalReference(e){const t=e.segment;let r=t.localRefs;r||(r=new ii(t),t.localRefs=r),r.addLocalRef(e),this.blockUpdatePathLengths(t.parent,Ss,As)}blockUpdate(e){var t;let r=0;const i=e.hierBlock();i&&(i.rightmostTiles=Zt(),i.leftmostTiles=Zt(),i.rangeStacks={});for(let s=0;s<e.childCount;s++){const o=e.children[s];r+=(t=$7(this,o))!==null&&t!==void 0?t:0,i&&i.addNodeReferences(this,o),this.blockUpdateActions&&this.blockUpdateActions.child(e,s)}e.cachedLength=r}blockUpdatePathLengths(e,t,r,i=!1){let s=e;for(;s!==void 0;)i?this.nodeUpdateLengthNewStructure(s):this.blockUpdateLength(s,t,r),s=s.parent}blockUpdateLength(e,t,r){this.blockUpdate(e),this.collabWindow.collaborating&&t!==ie&&t!==Ss&&(e.partialLengths!==void 0&&lt.options.incrementalUpdate&&r!==Bs?e.partialLengths.update(this,e,t,r,this.collabWindow):e.partialLengths=rt.combine(this,e,this.collabWindow))}map(e,t,r,i){this.nodeMap(this.root,e,0,t,r,i)}mapRange(e,t,r,i,s,o,a=!1){a&&(s&&this.ensureIntervalBoundary(s,t,r),o&&this.ensureIntervalBoundary(o,t,r)),this.nodeMap(this.root,e,0,t,r,i,s,o)}incrementalBlockMap(e){for(var t;!e.empty();){const r=e.top();if(r.op!==da.Go)return;if(r.childIndex===0&&(r.start===void 0&&(r.start=0),r.end===void 0&&(r.end=this.blockLength(r.block,r.refSeq,r.clientId)),r.actions.pre&&r.actions.pre(r)),r.op===da.Go&&r.childIndex<r.block.childCount){const i=r.block.children[r.childIndex],s=(t=this.nodeLength(i,r.refSeq,r.clientId))!==null&&t!==void 0?t:0;if(s>0&&r.start<s&&r.end>0)if(i.isLeaf())r.actions.leaf(i,r);else{const o=new q7(i,r.actions,r.pos,r.refSeq,r.clientId,r.context,r.start,r.end,0);e.push(o)}r.pos+=s,r.start-=s,r.end-=s,r.childIndex++}else r.childIndex===r.block.childCount&&(r.op===da.Go&&r.actions.post&&r.actions.post(r),e.pop())}}nodeMap(e,t,r,i,s,o,a,l){var c;let u=a,d=l,h=r;u===void 0&&(u=0),d===void 0&&(d=this.blockLength(e,i,s));let f=!0;if(t.pre&&(f=t.pre(e,h,i,s,u,d,o),!f))return!0;const p=e.children;for(let g=0;g<e.childCount;g++){const S=p[g],m=(c=this.nodeLength(S,i,s))!==null&&c!==void 0?c:0;if(f&&d>0&&m>0&&u<m&&(S.isLeaf()?t.leaf&&(f=t.leaf(S,h,i,s,u,d,o)):f&&(f=this.nodeMap(S,t,h,i,s,o,u,d))),!f)break;t.shift&&t.shift(S,h,i,s,u,d,o),h+=m,u-=m,d-=m}return f&&t.post&&(f=t.post(e,h,i,s,u,d,o)),f}walkAllSegments(e,t,r){let i=!0;const s=e.children;for(let o=0;i&&o<e.childCount;o++){const a=s[o];i=a.isLeaf()?t(a,r):this.walkAllSegments(a,t,r)}return i}nodeMapReverse(e,t,r,i,s){let o=!0;const a=e.children;for(let l=e.childCount-1;l>=0;l--){const c=a[l];if(o&&(c.isLeaf()?o=t(c,r,i,s,0,0,void 0):o&&(o=this.nodeMapReverse(c,t,r,i,s))),!o)break}return o}}lt.zamboniSegmentsMaxCount=2;lt.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0};lt.theUnfinishedNode={childCount:-1};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function J7(n,e,t){const r=n.getId();if(r)return{combiningOp:t,props:e,relativePos1:{id:r,before:!0},relativePos2:{id:r},type:ue.ANNOTATE}}function Mv(n,e,t,r){return{combiningOp:r,pos1:n,pos2:e,props:t,type:ue.ANNOTATE}}function Dv(n,e){return{pos1:n,pos2:e,type:ue.REMOVE}}function _m(n,e){return Nk(n,e.toJSONObject())}function Nk(n,e){return{pos1:n,seg:e,type:ue.INSERT}}function dh(...n){return{ops:n,type:ue.GROUP}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Q7(n){return!!n&&typeof n=="object"&&"json"in n}function V_(n,e,t,r,i,s){let o;switch(e.version!==void 0&&t.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:e.version,toChunkVersion:void 0}),e.version){case void 0:o=e,o.headerMetadata=Ik(n,o);break;case"1":const a=e,l=n===nt.header?a.headerMetadata:void 0;o={version:void 0,chunkStartSegmentIndex:a.startIndex,chunkLengthChars:a.length,chunkSegmentCount:a.segmentCount,segmentTexts:a.segments,totalLengthChars:l==null?void 0:l.totalLength,totalSegmentCount:l==null?void 0:l.totalSegmentCount,chunkSequenceNumber:l==null?void 0:l.sequenceNumber,chunkMinSequenceNumber:l==null?void 0:l.minSequenceNumber,headerMetadata:l};break;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}return i.stringify(o,s)}function W_(n,e,t,r,i,s){const o=Lk(n,e);return i.stringify(o,s)}function Lk(n,e,t,r){switch(e.version){case void 0:{const i=e;return{version:"1",length:i.chunkLengthChars,segmentCount:i.chunkSegmentCount,headerMetadata:Ik(n,i),segments:i.segmentTexts,startIndex:i.chunkStartSegmentIndex}}case"1":return e;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}}function Ik(n,e,t){if(n===nt.header){if(e.headerMetadata!==void 0)return e.headerMetadata;const r=[{id:nt.header}];return e.chunkLengthChars<e.totalLengthChars&&r.push({id:nt.body}),{orderedChunkMetadata:r,minSequenceNumber:e.chunkMinSequenceNumber,sequenceNumber:e.chunkSequenceNumber,totalLength:e.totalLengthChars,totalSegmentCount:e.totalSegmentCount}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class nt{constructor(e,t,r,i){var s,o;this.mergeTree=e,this.filename=r,this.onCompletion=i,this.logger=de.create(t,"Snapshot"),this.chunkSize=(o=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.mergeTreeSnapshotChunkSize)!==null&&o!==void 0?o:nt.sizeOfFirstChunk}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,a=0;for(;o<r&&i+a<e.length;){const l=e[i+a];s.push(l),o+=t[i+a],a++}return{version:void 0,chunkStartSegmentIndex:i,chunkSegmentCount:a,chunkLengthChars:o,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:e.length,chunkSequenceNumber:this.header.seq,segmentTexts:s}}emit(e,t,r){var i,s;const o=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize);let a=o.chunkLengthChars,l=o.chunkSegmentCount;const c=new tn;if(c.addBlob(nt.header,V_(nt.header,o,this.logger,this.mergeTree.options,t,r)),o.chunkSegmentCount<o.totalSegmentCount){const u=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.header.segmentsTotalLength,o.chunkSegmentCount);a+=u.chunkLengthChars,l+=u.chunkSegmentCount,c.addBlob(nt.body,V_(nt.body,u,this.logger,this.mergeTree.options,t,r))}return J(a===this.header.segmentsTotalLength,93),J(l===o.totalSegmentCount,94),e!==void 0&&e.length>0&&c.addBlob((s=(i=this.mergeTree.options)===null||i===void 0?void 0:i.catchUpBlobName)!==null&&s!==void 0?s:nt.catchupOps,t?t.stringify(e,r):JSON.stringify(e)),c.getSummaryTree()}extractSync(){const e=this.mergeTree.getCollabWindow();this.seq=e.minSeq,this.header={segmentsTotalLength:this.mergeTree.getLength(this.mergeTree.collabWindow.minSeq,Bs),seq:this.mergeTree.collabWindow.minSeq};const t=[];let r;const i=(o,a,l,c,u,d)=>(o.seq!==ie&&o.seq<=this.seq&&(o.removedSeq===void 0||o.removedSeq===ie||o.removedSeq>this.seq)&&(r!=null&&r.canAppend(o)&&eu(r.properties,o.properties)?(r=r.clone(),r.append(o.clone())):(r&&t.push(r),r=o)),!0);this.mergeTree.map({leaf:i},this.seq,Bs,void 0),r&&t.push(r),this.segments=[],this.segmentLengths=[];let s=0;return t.map(o=>{s+=o.cachedLength,this.segments.push(o.toJSONObject()),this.segmentLengths.push(o.cachedLength)}),this.header.segmentsTotalLength!==s&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:s,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=s),this.segments}}nt.header="header";nt.body="body";nt.catchupOps="catchupOps";nt.sizeOfFirstChunk=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class co{constructor(e,t,r,i,s){var o,a;this.mergeTree=e,this.getLongClientId=r,this.filename=i,this.onCompletion=s,this.logger=de.create(t,"Snapshot"),this.chunkSize=(a=(o=e==null?void 0:e.options)===null||o===void 0?void 0:o.mergeTreeSnapshotChunkSize)!==null&&a!==void 0?a:co.chunkSize;const{currentSeq:l,minSeq:c}=e.getCollabWindow();this.header={minSequenceNumber:c,sequenceNumber:l,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[]}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,a=0;for(;o<r&&i+a<e.length;){const l=e[i+a];s.push(l),o+=t[i+a],a++}return{version:"1",segmentCount:a,length:o,segments:s,startIndex:i,headerMetadata:void 0}}emit(e,t){const r=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{const a=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize,this.header.totalSegmentCount);r.push(a),this.header.totalSegmentCount+=a.segmentCount,this.header.totalLength+=a.length}while(this.header.totalSegmentCount<this.segments.length);const i=r.shift();i.headerMetadata=this.header,i.headerMetadata.orderedChunkMetadata=[{id:nt.header}];const s=[];r.forEach((a,l)=>{const c=`${nt.body}_${l}`;this.header.orderedChunkMetadata.push({id:c}),s.push([c,W_(c,a,this.logger,this.mergeTree.options,e,t)])});const o=new tn;return o.addBlob(nt.header,W_(nt.header,i,this.logger,this.mergeTree.options,e,t)),s.forEach(a=>{o.addBlob(a[0],a[1])}),o.getSummaryTree()}extractSync(){const e=this.mergeTree,t=this.header.minSequenceNumber,r=(a,l)=>{this.segments.push(a),this.segmentLengths.push(l)},i=a=>{a&&r(a.toJSONObject(),a.cachedLength)};let s;const o=a=>{var l;if(a.seq===ie||a.removedSeq<=t)return!0;if(a.seq<=t&&(a.removedSeq===void 0||a.removedSeq===ie))s?s.canAppend(a)&&eu(s.properties,a.properties)?(s=s.clone(),s.append(a.clone())):(i(s),s=a):s=a;else{i(s),s=void 0;const c={json:a.toJSONObject()};a.seq>t&&(c.seq=a.seq,c.client=this.getLongClientId(a.clientId)),a.removedSeq!==void 0&&(J(a.removedSeq!==ie&&a.removedSeq>t,101),c.removedSeq=a.removedSeq,c.removedClient=a.removedClientIds!==void 0?this.getLongClientId(a.removedClientIds[0]):void 0,c.removedClientIds=(l=a.removedClientIds)===null||l===void 0?void 0:l.map(u=>this.getLongClientId(u))),J(c.seq!==void 0&&c.client!==void 0||c.removedSeq!==void 0&&c.removedClient!==void 0,102),r(c,a.cachedLength)}return!0};return e.walkAllSegments(e.root,o,this),i(s),this.segments}static async loadChunk(e,t,r,i,s){const o=await e.readBlob(t),a=Av(o,"utf8");return co.processChunk(t,a,r,i,s)}static processChunk(e,t,r,i,s){const o=s?s.parse(t):JSON.parse(t);return Lk(e,o)}}co.chunkSize=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class X7{constructor(e,t,r,i,s){this.runtime=e,this.client=t,this.mergeTree=r,this.serializer=s,this.specToSegment=o=>{var a;let l;return Q7(o)?(l=this.client.specToSegment(o.json),l.clientId=o.client!==void 0?this.client.getOrAddShortClientId(o.client):Bs,l.seq=o.seq!==void 0?o.seq:Qt,o.removedSeq!==void 0&&(l.removedSeq=o.removedSeq),o.removedClient!==void 0&&(l.removedClientIds=[this.client.getOrAddShortClientId(o.removedClient)]),o.removedClientIds!==void 0&&(l.removedClientIds=(a=o.removedClientIds)===null||a===void 0?void 0:a.map(c=>this.client.getOrAddShortClientId(c)))):(l=this.client.specToSegment(o),l.seq=Qt,l.clientId=Bs),l},this.logger=de.create(i,"SnapshotLoader")}async initialize(e){const t=e.readBlob(nt.header).then(i=>(J(!!i,95),this.loadHeader(Av(i,"utf8")))),r=this.loadBodyAndCatchupOps(t,e);return r.catch(i=>this.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},i)),await t,{catchupOpsP:r}}async loadBodyAndCatchupOps(e,t){const r=t.list(""),i=await e;await this.loadBody(i,t);const s=await r;if(s.length===i.headerMetadata.orderedChunkMetadata.length+1)return i.headerMetadata.orderedChunkMetadata.forEach(o=>s.splice(s.indexOf(o.id),1)),J(s.length===1,96),this.loadCatchupOps(t.readBlob(s[0]));if(s.length!==i.headerMetadata.orderedChunkMetadata.length)throw new Error("Unexpected blobs in snapshot");return[]}loadHeader(e){var t;const r=co.processChunk(nt.header,e,this.logger,this.mergeTree.options,this.serializer),i=r.segments.map(this.specToSegment);if(this.mergeTree.reloadFromSegments(i),r.headerMetadata===void 0)throw new Error("header metadata not available");return this.runtime.attachState!==te.Detached&&this.client.startOrUpdateCollaboration((t=this.runtime.clientId)!==null&&t!==void 0?t:"snapshot",r.headerMetadata.minSequenceNumber!==void 0?r.headerMetadata.minSequenceNumber:r.headerMetadata.sequenceNumber,r.headerMetadata.sequenceNumber),r}async loadBody(e,t){if(J(e.length<=e.headerMetadata.totalLength,97),J(e.segmentCount<=e.headerMetadata.totalSegmentCount,98),e.segmentCount===e.headerMetadata.totalSegmentCount)return;const r=[];let i=e.length;for(let c=1;c<e.headerMetadata.orderedChunkMetadata.length;c++){const u=await co.loadChunk(t,e.headerMetadata.orderedChunkMetadata[c].id,this.logger,this.mergeTree.options,this.serializer);i+=u.length,r.push(...u.segments.map(this.specToSegment))}J(i===e.headerMetadata.totalLength,99),J(e.segmentCount+r.length===e.headerMetadata.totalSegmentCount,100);const s=this.mergeTree,o=(c,u,d)=>{s.insertSegments(s.root.cachedLength,c,Qt,u,d,void 0)},a=[],l=()=>{a.length>0&&o(a,Bs,Qt)};for(const c of r){const u=c.clientId,d=c.seq;u===Bs&&d===Qt?a.push(c):(l(),o([c],u,d))}l()}async loadCatchupOps(e){return JSON.parse(Av(await e,"utf8"))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const G_=256;class bt extends mf{constructor(e){super(),this.text=e,this.type=bt.type,this.cachedLength=e.length}static is(e){return e.type===bt.type}static make(e,t){const r=new bt(e);return t&&r.addProperties(t),r}static fromJSONObject(e){if(typeof e=="string")return new bt(e);if(e&&typeof e=="object"&&"text"in e){const t=e;return bt.make(t.text,t.props)}}toJSONObject(){return this.properties?{text:this.text,props:this.properties}:this.text}clone(e=0,t){const r=this.text.substring(e,t),i=bt.make(r,this.properties);return this.cloneInto(i),i}canAppend(e){return!this.text.endsWith(`
`)&&bt.is(e)&&(this.cachedLength<=G_||e.cachedLength<=G_)}toString(){return this.text}append(e){if(bt.is(e))ii.append(this,e),this.text+=e.text,this.cachedLength=this.text.length;else throw new Error("can only append text segment")}removeRange(e,t){let r="";const i=this.text.length;return e>0&&(r+=this.text.substring(0,e)),t<i&&(r+=this.text.substring(t)),this.text=r,this.cachedLength=r.length,r.length===0}createSplitSegmentAt(e){if(e>0){const t=this.text.substring(e);return this.text=this.text.substring(0,e),this.cachedLength=this.text.length,new bt(t)}}}bt.type="TextSegment";function K_(n){return n.parallelArrays===!0}class Y7{constructor(e){this.mergeTree=e,this.gatherText=(t,r,i,s,o,a,l)=>{var c,u;let d=o;if(bt.is(t)){let h="",f="";if(K_(l)){const p=[],g=[];!((c=t.properties)===null||c===void 0)&&c["font-weight"]&&p.push("b"),!((u=t.properties)===null||u===void 0)&&u["text-decoration"]&&p.push("u");const S=[];if(p.length>0){for(const m of p)l.tagsInProgress.includes(m)||(h+=`<${m}>`,g.push(m));for(const m of l.tagsInProgress)p.includes(m)||(f+=`</${m}>`,S.push(m));for(const m of g.reverse())l.tagsInProgress.push(m)}else for(const m of l.tagsInProgress)f+=`</${m}>`,S.push(m);for(const m of S){const v=l.tagsInProgress.indexOf(m);v>=0&&l.tagsInProgress.splice(v,1)}}l.textSegment.text+=f,l.textSegment.text+=h,d<=0&&a>=t.text.length?l.textSegment.text+=t.text:(d<0&&(d=0),a>=t.text.length?l.textSegment.text+=t.text.substring(d):l.textSegment.text+=t.text.substring(d,a))}else if(l.placeholder&&l.placeholder.length>0)if(l.placeholder==="*"){const h=t;l.textSegment.text+=`
${h.toString()}`}else for(let h=0;h<t.cachedLength;h++)l.textSegment.text+=l.placeholder;else if(K_(l)){const h=t;h.hasTileLabel(l.parallelMarkerLabel)&&(l.parallelMarkers.push(h),l.parallelText.push(l.textSegment.text),l.textSegment.text="")}return!0}}getTextAndMarkers(e,t,r,i,s){const o=this.getValidRange(i,s,e,t),a={parallelArrays:!0,parallelMarkerLabel:r,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new bt("")};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),{parallelText:a.parallelText,parallelMarkers:a.parallelMarkers}}getText(e,t,r="",i,s){const o=this.getValidRange(i,s,e,t),a={textSegment:new bt(""),placeholder:r};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),a.textSegment.text}getValidRange(e,t,r,i){return{end:t??this.mergeTree.getLength(r,i),start:e??0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Fu(n){return n.trace().duration*1e3}class OS{constructor(e,t,r){this.specToSegment=e,this.logger=t,this.measureOps=!1,this.accumTime=0,this.localTime=0,this.localOps=0,this.accumWindowTime=0,this.accumWindow=0,this.accumOps=0,this.maxWindowTime=0,this.clientNameToIds=new Pc(U7),this.shortClientIdMap=[],this.pendingConsensus=new Map,this.mergeTree=new lt(r)}get mergeTreeDeltaCallback(){return this.mergeTree.mergeTreeDeltaCallback}set mergeTreeDeltaCallback(e){this.mergeTree.mergeTreeDeltaCallback=e}get mergeTreeMaintenanceCallback(){return this.mergeTree.mergeTreeMaintenanceCallback}set mergeTreeMaintenanceCallback(e){this.mergeTree.mergeTreeMaintenanceCallback=e}peekPendingSegmentGroups(e=1){var t,r;if(e===1)return(t=this.mergeTree.pendingSegments)===null||t===void 0?void 0:t.last();let i=0;return(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.some(()=>i<e?(i++,!0):!1,!0)}annotateMarkerNotifyConsensus(e,t,r){const i={name:"consensus"},s=this.annotateMarker(e,t,i);if(s){const o={callback:r,marker:e};return this.pendingConsensus.set(e.getId(),o),s}else return}annotateMarker(e,t,r){const i=J7(e,t,r);if(this.applyAnnotateRangeOp({op:i}))return i}annotateRangeLocal(e,t,r,i){const s=Mv(e,t,r,i);if(this.applyAnnotateRangeOp({op:s}))return s}removeRangeLocal(e,t){const r=Dv(e,t);if(this.applyRemoveRangeOp({op:r}))return r}insertSegmentLocal(e,t){if(t.cachedLength<=0)return;const r=_m(e,t);if(this.applyInsertOp({op:r}))return r}insertAtReferencePositionLocal(e,t){const r=this.mergeTree.referencePositionToLocalPosition(e,this.getCurrentSeq(),this.getClientId());if(r===yo.DetachedPosition)return;const i=_m(r,t),s={op:i};let o;return this.measureOps&&(o=Ro.start()),this.mergeTree.insertAtReferencePosition(e,t,s),this.completeAndLogOp(s,this.getClientSequenceArgs(s),{start:i.pos1},o),i}walkSegments(e,t,r,i,s=!1){this.mergeTree.mapRange({leaf:e},this.getCurrentSeq(),this.getClientId(),i,t,r,s)}serializeGCData(e,t){this.mergeTree.walkAllSegments(this.mergeTree.root,r=>(r.removedSeq===void 0&&t.stringify(r.clone().toJSONObject(),e),!0))}getCollabWindow(){return this.mergeTree.getCollabWindow()}getPosition(e){return(e==null?void 0:e.parent)===void 0?-1:this.mergeTree.getPosition(e,this.getCurrentSeq(),this.getClientId())}addLocalReference(e){return this.mergeTree.addLocalReference(e)}removeLocalReference(e){return this.removeLocalReferencePosition(e)}createLocalReferencePosition(e,t,r,i){return this.mergeTree.createLocalReferencePosition(e,t,r,i,this)}removeLocalReferencePosition(e){return this.mergeTree.removeLocalReferencePosition(e)}localReferencePositionToPosition(e){return this.mergeTree.referencePositionToLocalPosition(e)}posFromRelativePos(e){return this.mergeTree.posFromRelativePos(e)}getMarkerFromId(e){return this.mergeTree.getMarkerFromId(e)}applyRemoveRangeOp(e){J(e.op.type===ue.REMOVE,45);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=Ro.start()),this.mergeTree.markRangeRemoved(i.start,i.end,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,!1,e),this.completeAndLogOp(e,r,i,s),!0}applyAnnotateRangeOp(e){J(e.op.type===ue.ANNOTATE,46);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=Ro.start()),this.mergeTree.annotateRange(i.start,i.end,t.props,t.combiningOp,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,s),!0}applyInsertOp(e){J(e.op.type===ue.INSERT,47);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;if(t.seg&&(s=[this.specToSegment(t.seg)]),!s||s.length===0)return!1;let o;return this.measureOps&&(o=Ro.start()),this.mergeTree.insertSegments(i.start,s,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,o),!0}completeAndLogOp(e,t,r,i){e.sequencedMessage?(J(this.mergeTree.getCollabWindow().currentSeq<t.sequenceNumber,48),J(this.mergeTree.getCollabWindow().minSeq<=e.sequencedMessage.minimumSequenceNumber,49),i&&(this.accumTime+=Fu(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)):i&&(this.localTime+=Fu(i),this.localOps++)}getValidOpRange(e,t){let r=e.pos1;r===void 0&&e.relativePos1&&(r=this.mergeTree.posFromRelativePos(e.relativePos1,t.referenceSequenceNumber,t.clientId));let i=e.pos2;if(i===void 0&&e.relativePos2&&(i=this.mergeTree.posFromRelativePos(e.relativePos2,t.referenceSequenceNumber,t.clientId)),t.clientId===this.getClientId()){const s=this.getLength(),o=[];if((r===void 0||r<0||r>s||r===s&&e.type!==ue.INSERT)&&o.push("start"),(e.type!==ue.INSERT||i!==void 0)&&(i===void 0||i<=r)&&o.push("end"),o.length>0)throw new ae("RangeOutOfBounds",{usageError:!0,end:i,invalidPositions:o.toString(),length:s,opPos1:e.pos1,opPos1Relative:e.relativePos1!==void 0,opPos2:e.pos2,opPos2Relative:e.relativePos2!==void 0,opType:e.type,start:r})}return{start:r,end:i}}getClientSequenceArgsForMessage(e){if(e)return{clientId:this.getOrAddShortClientId(e.clientId),referenceSequenceNumber:e.referenceSequenceNumber,sequenceNumber:e.sequenceNumber};{const t=this.getCollabWindow();return{clientId:t.clientId,referenceSequenceNumber:t.currentSeq,sequenceNumber:this.getLocalSequenceNumber()}}}getClientSequenceArgs(e){return this.getClientSequenceArgsForMessage(e.sequencedMessage)}ackPendingSegment(e){const t=r=>{let i;this.measureOps&&(i=Ro.start()),this.mergeTree.ackPendingSegment(r),r.op.type===ue.ANNOTATE&&r.op.combiningOp&&r.op.combiningOp.name==="consensus"&&this.updateConsensusProperty(r.op,r.sequencedMessage),i&&(this.accumTime+=Fu(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)};if(e.op.type===ue.GROUP)for(const r of e.op.ops)t({groupOp:e.op,op:r,sequencedMessage:e.sequencedMessage});else t(e)}cloneFromSegments(){const e=new OS(this.specToSegment,this.logger,this.mergeTree.options),t=[],r=this.mergeTree.blockClone(this.mergeTree.root,t);return e.mergeTree.root=r,e}getOrAddShortClientId(e){return this.clientNameToIds.get(e)||this.addLongClientId(e),this.getShortClientId(e)}getShortClientId(e){return this.clientNameToIds.get(e).data}getLongClientId(e){return e>=0?this.shortClientIdMap[e]:"original"}addLongClientId(e){this.clientNameToIds.put(e,this.shortClientIdMap.length),this.shortClientIdMap.push(e)}findReconnectionPosition(e,t){J(t<=this.mergeTree.collabWindow.localSeq,50);let r=0;return this.mergeTree.walkAllSegments(this.mergeTree.root,i=>i===e?!1:((i.localSeq===void 0||i.localSeq<=t)&&(i.removedSeq===void 0||i.localRemovedSeq>t)&&(r+=i.cachedLength),!0)),r}rebasePosition(e,t,r){J(r<=this.mergeTree.collabWindow.localSeq,768);let i,s=0,o=e;const a=u=>u.seq!==void 0&&u.seq!==ie&&u.seq<=t||u.localSeq!==void 0&&u.localSeq<=r,l=({removedSeq:u,localRemovedSeq:d})=>u!==void 0&&u!==ie&&u<=t||d!==void 0&&d<=r;this.mergeTree.walkAllSegments(this.mergeTree.root,u=>(J(u.seq!==void 0||u.localSeq!==void 0,769),i=u,a(u)&&!l(u)&&(s+=u.cachedLength,o>=u.cachedLength&&(o-=u.cachedLength)),s<=e)),J(i!==void 0,770);const c=this.getCollabWindow().currentSeq;return(i.removedSeq!==void 0&&i.removedSeq!==ie&&i.removedSeq<=c||i.localRemovedSeq!==void 0&&i.localRemovedSeq<=r)&&(o=0),J(0<=o&&o<i.cachedLength,771),this.findReconnectionPosition(i,r)+o}resetPendingDeltaToOps(e,t){var r,i;J(!!t,51);const s=(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.dequeue();J(t===s,52);const o=[];for(const a of t.segments.sort((l,c)=>l.ordinal<c.ordinal?-1:1)){const l=a.segmentGroups.dequeue();J(t===l,53);const c=this.findReconnectionPosition(a,t.localSeq);let u;switch(e.type){case ue.ANNOTATE:J(((i=a.propertyManager)===null||i===void 0?void 0:i.hasPendingProperties())===!0,54),(a.removedSeq===void 0||a.localRemovedSeq!==void 0)&&(u=Mv(c,c+a.cachedLength,e.props,e.combiningOp));break;case ue.INSERT:J(a.seq===ie,55);let d=a;typeof e.seg=="object"&&e.seg.props!==void 0&&(d=a.clone(),d.properties=e.seg.props),u=_m(c,d);break;case ue.REMOVE:a.localRemovedSeq!==void 0&&(u=Dv(c,c+a.cachedLength));break;default:throw new Error("Invalid op type")}if(u){const d={segments:[],localSeq:t.localSeq};a.segmentGroups.enqueue(d),this.mergeTree.pendingSegments.enqueue(d),o.push(u)}}return o}applyRemoteOp(e){const t=e.op,r=e.sequencedMessage;switch(this.getOrAddShortClientId(r.clientId),t.type){case ue.INSERT:this.applyInsertOp(e);break;case ue.REMOVE:this.applyRemoveRangeOp(e);break;case ue.ANNOTATE:this.applyAnnotateRangeOp(e);break;case ue.GROUP:{for(const i of t.ops)this.applyRemoteOp({op:i,groupOp:t,sequencedMessage:r});break}}}applyStashedOp(e){let t;switch(e.type){case ue.INSERT:this.applyInsertOp({op:e}),t=this.peekPendingSegmentGroups();break;case ue.REMOVE:this.applyRemoveRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case ue.ANNOTATE:this.applyAnnotateRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case ue.GROUP:return e.ops.map(r=>this.applyStashedOp(r));default:E7(e,"unrecognized op type")}return J(!!t,731),t}applyMsg(e,t=!1){var r;if(this.getOrAddShortClientId(e.clientId),e.type===Iv.Operation){const i={op:e.contents,sequencedMessage:e};((r=i.sequencedMessage)===null||r===void 0?void 0:r.clientId)===this.longClientId||t?this.ackPendingSegment(i):this.applyRemoteOp(i)}this.updateSeqNumbers(e.minimumSequenceNumber,e.sequenceNumber)}updateSeqNumbers(e,t){const r=this.mergeTree.getCollabWindow();J(r.currentSeq<=t,56),r.currentSeq=t,J(e<=t,57),this.updateMinSeq(e)}resolveRemoteClientPosition(e,t,r){const i=this.getOrAddShortClientId(r);return this.mergeTree.resolveRemoteClientPosition(e,t,i)}regeneratePendingOp(e,t){const r=[];if(e.type===ue.GROUP)if(Array.isArray(t)){J(e.ops.length===t.length,58);for(let i=0;i<e.ops.length;i++)r.push(...this.resetPendingDeltaToOps(e.ops[i],t[i]))}else J(e.ops.length===1,59),r.push(...this.resetPendingDeltaToOps(e.ops[0],t));else J(e.type!==ue.GROUP,60),J(!Array.isArray(t),61),r.push(...this.resetPendingDeltaToOps(e,t));return r.length===1?r[0]:dh(...r)}createTextHelper(){return new Y7(this.mergeTree)}summarize(e,t,r,i){var s;const o=e.deltaManager,a=o.minimumSequenceNumber;if(this.updateSeqNumbers(a,o.lastSequenceNumber),J(this.getCollabWindow().minSeq===a,62),((s=this.mergeTree.options)===null||s===void 0?void 0:s.newMergeTreeSnapshotFormat)===!0){J(i===void 0||i.length===0,63);const l=new co(this.mergeTree,this.logger,c=>this.getLongClientId(c));return l.extractSync(),l.emit(r,t)}else{const l=new nt(this.mergeTree,this.logger);return l.extractSync(),l.emit(i,r,t)}}async load(e,t,r){return new X7(e,this,this.mergeTree,this.logger,r).initialize(t)}getStackContext(e,t){return this.mergeTree.getStackContext(e,this.getCollabWindow().clientId,t)}getLocalSequenceNumber(){return this.getCollabWindow().collaborating?ie:Qt}localTransaction(e){for(const t of e.ops){const r={op:t,groupOp:e};switch(t.type){case ue.INSERT:this.applyInsertOp(r);break;case ue.ANNOTATE:this.applyAnnotateRangeOp(r);break;case ue.REMOVE:this.applyRemoveRangeOp(r);break}}}updateConsensusProperty(e,t){const r=e.relativePos1.id,i=this.pendingConsensus.get(r);i&&i.marker.addProperties(e.props,e.combiningOp,t.sequenceNumber),this.mergeTree.addMinSeqListener(t.sequenceNumber,()=>i.callback(i.marker))}updateMinSeq(e){let t;if(this.measureOps&&(t=Ro.start()),this.mergeTree.setMinSeq(e),t){const r=Fu(t);this.accumWindowTime+=r,r>this.maxWindowTime&&(this.maxWindowTime=r)}}getContainingSegment(e,t){const r=this.getClientSequenceArgsForMessage(t);return this.mergeTree.getContainingSegment(e,r.referenceSequenceNumber,r.clientId)}getSlideToSegment(e){return this.mergeTree._getSlideToSegment(e)}getPropertiesAtPosition(e){let t;const i=this.getContainingSegment(e).segment;return i&&(t=i.properties),t}getRangeExtentsOfPosition(e){let t,r;const s=this.getContainingSegment(e).segment;return s&&(t=this.getPosition(s),r=t+s.cachedLength),{posStart:t,posAfterEnd:r}}getCurrentSeq(){return this.getCollabWindow().currentSeq}getClientId(){return this.getCollabWindow().clientId}getLength(){return this.mergeTree.length}startOrUpdateCollaboration(e,t=0,r=0){if(e!==void 0)if(this.longClientId===void 0)this.longClientId=e,this.addLongClientId(this.longClientId),this.mergeTree.startCollaboration(this.getShortClientId(this.longClientId),t,r);else{const i=this.longClientId,s=this.clientNameToIds.get(i).data;this.longClientId=e,this.clientNameToIds.put(e,s),this.shortClientIdMap[s]=e}}findTile(e,t,r=!0){const i=this.getClientId();return this.mergeTree.findTile(e,i,t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Z7=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const jt="intervalId";var ir;(function(n){n[n.Simple=0]="Simple",n[n.Nest=1]="Nest",n[n.SlideOnRemove=2]="SlideOnRemove",n[n.Transient=4]="Transient"})(ir||(ir={}));function eK(n,e){return{start:n[0],end:n[1],sequenceNumber:n[2],intervalType:n[3],properties:Object.assign(Object.assign({},n[4]),{[tu]:e})}}function tK(n){const{start:e,end:t,sequenceNumber:r,intervalType:i,properties:s}=n;return[e,t,r,i,Object.assign(Object.assign({},s),{[tu]:void 0})]}class ha{constructor(e,t,r){this.start=e,this.end=t,this.propertyManager=new Ra,this.properties={},r&&this.addProperties(r)}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[jt];if(t!==void 0)return`${t}`}getAdditionalPropertySets(){return this.auxProps}addPropertySet(e){this.auxProps===void 0&&(this.auxProps=[]),this.auxProps.push(e)}serialize(e){let t=0;e&&(t=e.getCurrentSeq());const r={end:this.end,intervalType:0,sequenceNumber:t,start:this.start};return this.properties&&(r.properties=this.properties),r}clone(){return new ha(this.start,this.end,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start-e.start}compareEnd(e){return this.end-e.end}overlaps(e){return this.start<=e.end&&this.end>=e.start}union(e){return new ha(Math.min(this.start,e.start),Math.max(this.end,e.end),this.properties)}getProperties(){return this.properties}addProperties(e,t=!1,r,i){if(e)return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}modify(e,t,r,i){const s=t??this.start,o=r??this.end;if(this.start===s&&this.end===o)return;const a=new ha(s,o);return this.properties&&(a.initializeProperties(),this.propertyManager.copyTo(this.properties,a.properties,a.propertyManager)),a}initializeProperties(){this.propertyManager||(this.propertyManager=new Ra),this.properties||(this.properties=Zt())}}class si{constructor(e,t,r,i){this.start=e,this.end=t,this.intervalType=r,this.propertyManager=new Ra,this.properties={},i&&this.addProperties(i)}addPositionChangeListeners(e,t){var r,i,s,o;if(this.callbacks===void 0){this.callbacks={beforePositionChange:e,afterPositionChange:t};const a=(r=(s=this.start).callbacks)!==null&&r!==void 0?r:s.callbacks={},l=(i=(o=this.end).callbacks)!==null&&i!==void 0?i:o.callbacks={};a.beforeSlide=l.beforeSlide=e,a.afterSlide=l.afterSlide=t}}removePositionChangeListeners(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}serialize(e){const t=this.start.toPosition(),i={end:this.end.toPosition(),intervalType:this.intervalType,sequenceNumber:e.getCurrentSeq(),start:t};return this.properties&&(i.properties=this.properties),i}clone(){return new si(this.start,this.end,this.intervalType,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start.compare(e.start)}compareEnd(e){return this.end.compare(e.end)}overlaps(e){return this.start.compare(e.end)<=0&&this.end.compare(e.start)>=0}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[jt];if(t!==void 0)return`${t}`}union(e){return new si(this.start.min(e.start),this.end.max(e.end),this.intervalType)}addProperties(e,t=!1,r,i){return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}overlapsPos(e,t){const r=this.start.toPosition();return this.start.toPosition()>e&&r<t}modify(e,t,r,i){const s=c=>{let u=c;return i===void 0&&(u&=~ne.SlideOnRemove,u|=ne.StayOnRemove),u};let o=this.start;t!==void 0&&(o=hh(this.start.getClient(),t,s(this.start.refType),i),o.addProperties(this.start.properties));let a=this.end;r!==void 0&&(a=hh(this.end.getClient(),r,s(this.end.refType),i),a.addProperties(this.end.properties)),o.pairedRef=a,a.pairedRef=o;const l=new si(o,a,this.intervalType);return this.properties&&(l.initializeProperties(),this.propertyManager.copyTo(this.properties,l.properties,l.propertyManager)),l}initializeProperties(){this.propertyManager||(this.propertyManager=new Ra),this.properties||(this.properties=Zt())}}function Fv(n,e,t,r){if(e.segment)return n.createLocalReferencePosition(e.segment,e.offset,t,void 0);if(!r&&!Xe(t,ne.Transient))throw new Ee("Non-transient references need segment");return new yo(n,void 0,0,t)}function hh(n,e,t,r){let i;return r?(xn((t&ne.SlideOnRemove)!==0,757),i=n.getContainingSegment(e,r),i=n.getSlideToSegment(i)):(xn((t&ne.SlideOnRemove)===0,758),i=n.getContainingSegment(e)),Fv(n,i,t,r)}function nK(n,e,t,r,i,s){let o=ne.RangeBegin,a=ne.RangeEnd;i===ir.Transient?(o=ne.Transient,a=ne.Transient):(i===ir.Nest&&(o=ne.NestBegin,a=ne.NestEnd),s?(o|=ne.SlideOnRemove,a|=ne.SlideOnRemove):(o|=ne.StayOnRemove,a|=ne.StayOnRemove));const l=hh(r,e,o,s),c=hh(r,t,a,s);l.pairedRef=c,c.pairedRef=l;const u={[tu]:[n]};return l.addProperties(u),c.addProperties(u),new si(l,c,i,u)}class gf{constructor(e,t,r,i){this.client=e,this.label=t,this.helpers=r,this.onPositionChange=i,this.intervalTree=new T7,this.intervalIdMap=new Map,this.endIntervalTree=new Pc(r.compareEnds)}addConflictResolver(e){this.conflictResolver=e,this.endConflictResolver=(t,r)=>{const i=e(t,r);return{data:i,key:i}}}map(e){this.intervalTree.map(e)}createLegacyId(e,t){return`${gf.legacyIdPrefix}${e}-${t}`}ensureSerializedId(e){var t;let r=(t=e.properties)===null||t===void 0?void 0:t[jt];if(r===void 0){r=this.createLegacyId(e.start,e.end);const i={[jt]:r};e.properties=Ok(e.properties,i)}return Object.defineProperty(e.properties,jt,{configurable:!1,enumerable:!0,writable:!1}),r}mapUntil(e){this.intervalTree.mapUntil(e)}gatherIterationResults(e,t,r,i){if(!this.intervalTree.intervals.isEmpty())if(r===void 0&&i===void 0)t?this.intervalTree.map(s=>{e.push(s)}):this.intervalTree.mapBackward(s=>{e.push(s)});else{const s=this.helpers.create("transient",r,i,this.client,ir.Transient);if(r===void 0)t?this.intervalTree.map(o=>{s.compareEnd(o)===0&&e.push(o)}):this.intervalTree.mapBackward(o=>{s.compareEnd(o)===0&&e.push(o)});else{const o=i===void 0?u=>s.compareStart(u.key):u=>s.compare(u.key),a=u=>u<=0,l=u=>u>=0,c=u=>{e.push(u.key)};t?this.intervalTree.intervals.walkExactMatchesForward(o,c,a,l):this.intervalTree.intervals.walkExactMatchesBackward(o,c,a,l)}}}findOverlappingIntervals(e,t){if(t<e||this.intervalTree.intervals.isEmpty())return[];const r=this.helpers.create("transient",e,t,this.client,ir.Transient);return this.intervalTree.match(r).map(s=>s.key)}previousInterval(e){const t=this.helpers.create("transient",e,e,this.client,ir.Transient),r=this.endIntervalTree.floor(t);if(r)return r.data}nextInterval(e){const t=this.helpers.create("transient",e,e,this.client,ir.Transient),r=this.endIntervalTree.ceil(t);if(r)return r.data}removeInterval(e,t){const r=this.helpers.create("transient",e,t,this.client,ir.Transient);return this.intervalTree.remove(r),this.endIntervalTree.remove(r),r}removeIntervalFromIndex(e){this.intervalTree.removeExisting(e),this.endIntervalTree.remove(e);const t=e.getIntervalId();xn(t!==void 0,785),this.intervalIdMap.delete(t)}removeExistingInterval(e){this.removeIntervalFromIndex(e),this.removeIntervalListeners(e)}createInterval(e,t,r,i){return this.helpers.create(this.label,e,t,this.client,r,i)}addInterval(e,t,r,i,s){const o=this.createInterval(e,t,r,s);return o&&(o.properties||(o.properties=Zt()),i&&o.addProperties(i),o.properties[jt]===void 0&&(o.properties[jt]=ot()),this.add(o)),o}addIntervalToIndex(e){const t=e.getIntervalId();xn(t!==void 0,704),Object.defineProperty(e.properties,jt,{configurable:!1,enumerable:!0,writable:!1}),this.intervalTree.put(e,this.conflictResolver),this.endIntervalTree.put(e,e,this.endConflictResolver),this.intervalIdMap.set(t,e)}add(e){this.addIntervalToIndex(e),this.addIntervalListeners(e)}getIntervalById(e){return this.intervalIdMap.get(e)}changeInterval(e,t,r,i){const s=e.modify(this.label,t,r,i);return s&&(this.removeExistingInterval(e),this.add(s)),s}serialize(){const e=this.client,t=this.intervalTree.intervals.keys();return{label:this.label,intervals:t.map(r=>tK(r.serialize(e))),version:2}}addIntervalListeners(e){e instanceof si&&e.addPositionChangeListeners(()=>this.removeIntervalFromIndex(e),()=>{var t;this.addIntervalToIndex(e),(t=this.onPositionChange)===null||t===void 0||t.call(this,e)})}removeIntervalListeners(e){e instanceof si&&e.removePositionChangeListeners()}}gf.legacyIdPrefix="legacy";const rK=(n,e)=>n.end.compare(e.end);class iK{load(e,t=[]){const r={compareEnds:rK,create:nK};return new PS(r,!0,e,t)}store(e){return e.serializeInternal()}}class ns{get name(){return ns.Name}get factory(){return ns._factory}get ops(){return ns._ops}}ns.Name="sharedStringIntervalCollection";ns._factory=new iK;ns._ops=Ak();const sK=(n,e)=>n.end-e.end;function oK(n,e,t,r){const i={};return n&&n.length>0&&(i[tu]=[n]),new ha(e,t,i)}class aK{load(e,t=[]){const r={compareEnds:sK,create:oK},i=new PS(r,!1,e,t);return i.attachGraph(void 0,""),i}store(e){return e.serializeInternal()}}class rs{get name(){return rs.Name}get factory(){return rs._factory}get ops(){return rs._ops}}rs.Name="sharedIntervalCollection";rs._factory=new aK;rs._ops=Ak();function Ak(){const n=(e,t,r)=>{const{localSeq:i}=r,s=e.rebaseLocalInterval(t.opName,t.value,i);return{rebasedOp:Object.assign(Object.assign({},t),{value:s}),rebasedLocalOpMetadata:r}};return new Map([["add",{process:(e,t,r,i)=>{e.ackAdd(t,r,i)},rebase:n}],["delete",{process:(e,t,r,i)=>{e.ackDelete(t,r,i)},rebase:(e,t,r)=>({rebasedOp:t,rebasedLocalOpMetadata:r})}],["change",{process:(e,t,r,i)=>{e.ackChange(t,r,i)},rebase:n}]])}class Mo{constructor(e,t=!0,r,i){this.results=[],this.index=0,e.gatherIterationResults(this.results,t,r,i)}next(){let e,t=!0;return this.index<this.results.length&&(e=this.results[this.index++],t=!1),{value:e,done:t}}}class PS extends wk{constructor(e,t,r,i){super(),this.helpers=e,this.requiresClient=t,this.emitter=r,this.pendingChangesStart=new Map,this.pendingChangesEnd=new Map,Array.isArray(i)?this.savedSerializedIntervals=i:this.savedSerializedIntervals=i.intervals.map(s=>eK(s,i.label))}get attached(){return!!this.localCollection}attachGraph(e,t){if(this.attached)throw new ae("Only supports one Sequence attach");if(e===void 0&&this.requiresClient)throw new ae("Client required for this collection");if(this.client=e,this.localCollection=new gf(e,t,this.helpers,r=>this.emit("changeInterval",r,!0,void 0)),this.savedSerializedIntervals)for(const r of this.savedSerializedIntervals)this.localCollection.ensureSerializedId(r),this.localCollection.addInterval(r.start,r.end,r.intervalType,r.properties);this.savedSerializedIntervals=void 0}getNextLocalSeq(){return++this.client.getCollabWindow().localSeq}getIntervalById(e){if(!this.attached)throw new ae("attach must be called before accessing intervals");return this.localCollection.getIntervalById(e)}add(e,t,r,i){var s,o;if(!this.attached)throw new ae("attach must be called prior to adding intervals");if(r&ir.Transient)throw new ae("Can not add transient intervals");const a=this.localCollection.addInterval(e,t,r,i);if(a){const l={end:t,intervalType:r,properties:a.properties,sequenceNumber:(o=(s=this.client)===null||s===void 0?void 0:s.getCurrentSeq())!==null&&o!==void 0?o:0,start:e};this.emitter.emit("add",void 0,l,{localSeq:this.getNextLocalSeq()})}return this.emit("addInterval",a,!0,void 0),a}deleteExistingInterval(e,t,r){this.localCollection.removeExistingInterval(e),e&&(t?this.emitter.emit("delete",void 0,e.serialize(this.client),{localSeq:this.getNextLocalSeq()}):this.onDeserialize&&this.onDeserialize(e)),this.emit("deleteInterval",e,t,r)}removeIntervalById(e){const t=this.localCollection.getIntervalById(e);return t&&this.deleteExistingInterval(t,!0,void 0),t}changeProperties(e,t){if(!this.attached)throw new ae("Attach must be called before accessing intervals");if(typeof e!="string")throw new ae("Change API requires an ID that is a string");if(!t)throw new ae("changeProperties should be called with a property set");const r=this.getIntervalById(e);if(r){const i=r.addProperties(t,!0,ie),s=r.serialize(this.client);s.start=void 0,s.end=void 0,s.properties=t,s.properties[jt]=r.getIntervalId(),this.emitter.emit("change",void 0,s,{localSeq:this.getNextLocalSeq()}),this.emit("propertyChanged",r,i)}this.emit("changeInterval",r,!0,void 0)}change(e,t,r){if(!this.attached)throw new ae("Attach must be called before accessing intervals");if(typeof e!="string")throw new ae("Change API requires an ID that is a string");const i=this.getIntervalById(e);if(i){const s=this.localCollection.changeInterval(i,t,r),o=i.serialize(this.client);return o.start=t,o.end=r,o.properties={[jt]:i.getIntervalId()},this.emitter.emit("change",void 0,o,{localSeq:this.getNextLocalSeq()}),this.addPendingChange(e,o),this.emit("changeInterval",s,!0,void 0),s}}addPendingChange(e,t){t.start!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesStart,t),t.end!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesEnd,t)}addPendingChangeHelper(e,t,r){let i=t.get(e);i||(i=[],t.set(e,i)),i.push(r)}removePendingChange(e){var t;const r=(t=e.properties)===null||t===void 0?void 0:t[jt];e.start!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesStart,e),e.end!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesEnd,e)}removePendingChangeHelper(e,t,r){const i=t.get(e);if(i){const s=i.shift();if(i.length===0&&t.delete(e),(s==null?void 0:s.start)!==r.start||(s==null?void 0:s.end)!==r.end)throw new ae("Mismatch in pending changes")}}hasPendingChangeStart(e){const t=this.pendingChangesStart.get(e);return t&&t.length!==0}hasPendingChangeEnd(e){const t=this.pendingChangesEnd.get(e);return t&&t.length!==0}changeInterval(e,t,r){return this.ackChange(e,t,r)}ackChange(e,t,r){var i,s,o,a;if(!this.attached)throw new ae("Attach must be called before accessing intervals");let l;if(t){this.removePendingChange(e);const c=(i=e.properties)===null||i===void 0?void 0:i[jt];l=this.getIntervalById(c),l&&((s=l.propertyManager)===null||s===void 0||s.ackPendingProperties({type:ue.ANNOTATE,props:(o=e.properties)!==null&&o!==void 0?o:{}}),this.ackInterval(l,r))}else{const c=e.properties,u=jt,d=c[u],h=Z7(c,[u+""]);if(l=this.getIntervalById(d),l){let f,p;this.hasPendingChangeStart(d)||(f=e.start),this.hasPendingChangeEnd(d)||(p=e.end),(f!==void 0||p!==void 0)&&(l=(a=this.localCollection.changeInterval(l,f,p,r))!==null&&a!==void 0?a:l);const g=l.addProperties(h,!0,r.sequenceNumber);this.onDeserialize&&this.onDeserialize(l),this.emit("propertyChanged",l,g)}}l&&this.emit("changeInterval",l,t,r)}addConflictResolver(e){if(!this.attached)throw new ae("attachSequence must be called");this.localCollection.addConflictResolver(e)}attachDeserializer(e){e&&(this.onDeserialize=e,this.localCollection.map(t=>{e(t)}))}rebaseLocalInterval(e,t,r){var i,s;if(!this.attached)throw new ae("attachSequence must be called");const{start:o,end:a,intervalType:l,properties:c,sequenceNumber:u}=t,d=o===void 0?void 0:this.client.rebasePosition(o,u,r),h=a===void 0?void 0:this.client.rebasePosition(a,u,r),f=c==null?void 0:c[jt],p={start:d,end:h,intervalType:l,sequenceNumber:(s=(i=this.client)===null||i===void 0?void 0:i.getCurrentSeq())!==null&&s!==void 0?s:0,properties:c};return e==="change"&&(this.hasPendingChangeStart(f)||this.hasPendingChangeEnd(f))&&(this.removePendingChange(t),this.addPendingChange(f,p)),p}getSlideToSegment(e){const t={segment:e.segment,offset:e.offset},r=this.client.getSlideToSegment(t);return t.segment===r.segment&&t.offset===r.offset?void 0:r}setSlideOnRemove(e){let t=e.refType;t=t&~ne.StayOnRemove,t=t|ne.SlideOnRemove,e.refType=t}ackInterval(e,t){if(!(e instanceof si)||!Xe(e.start,ne.StayOnRemove)&&!Xe(e.end,ne.StayOnRemove))return;const r=this.getSlideToSegment(e.start),i=this.getSlideToSegment(e.end),s=e.properties[jt],o=this.hasPendingChangeStart(s),a=this.hasPendingChangeEnd(s);o||this.setSlideOnRemove(e.start),a||this.setSlideOnRemove(e.end);const l=r!==void 0&&!o,c=i!==void 0&&!a;if(l||c){if(this.localCollection.removeExistingInterval(e),l){const u=e.start.properties;this.client.removeLocalReferencePosition(e.start),e.start=Fv(this.client,r,e.start.refType,t),u&&e.start.addProperties(u)}if(c){const u=e.end.properties;this.client.removeLocalReferencePosition(e.end),e.end=Fv(this.client,i,e.end.refType,t),u&&e.end.addProperties(u)}this.localCollection.add(e)}}addInternal(e,t,r){return this.ackAdd(e,t,r)}ackAdd(e,t,r){var i;if(t){const o=(i=e.properties)===null||i===void 0?void 0:i[jt],a=this.getIntervalById(o);a&&this.ackInterval(a,r);return}if(!this.attached)throw new ae("attachSequence must be called");this.localCollection.ensureSerializedId(e);const s=this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties,r);return s&&this.onDeserialize&&this.onDeserialize(s),this.emit("addInterval",s,t,r),s}deleteInterval(e,t,r){return this.ackDelete(e,t,r)}ackDelete(e,t,r){if(t)return;if(!this.attached)throw new ae("attach must be called prior to deleting intervals");const i=this.localCollection.ensureSerializedId(e),s=this.localCollection.getIntervalById(i);s&&this.deleteExistingInterval(s,t,r)}serializeInternal(){if(!this.attached)throw new ae("attachSequence must be called");return this.localCollection.serialize()}[Symbol.iterator](){return new Mo(this)}CreateForwardIteratorWithStartPosition(e){return new Mo(this,!0,e)}CreateBackwardIteratorWithStartPosition(e){return new Mo(this,!1,e)}CreateForwardIteratorWithEndPosition(e){return new Mo(this,!0,void 0,e)}CreateBackwardIteratorWithEndPosition(e){return new Mo(this,!1,void 0,e)}gatherIterationResults(e,t,r,i){this.attached&&this.localCollection.gatherIterationResults(e,t,r,i)}findOverlappingIntervals(e,t){if(!this.attached)throw new ae("attachSequence must be called");return this.localCollection.findOverlappingIntervals(e,t)}map(e){if(!this.attached)throw new ae("attachSequence must be called");this.localCollection.map(e)}previousInterval(e){if(!this.attached)throw new ae("attachSequence must be called");return this.localCollection.previousInterval(e)}nextInterval(e){if(!this.attached)throw new ae("attachSequence must be called");return this.localCollection.nextInterval(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var fh;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(fh||(fh={}));var J_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(J_||(J_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function lK(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class Q_{constructor(e,t){this.value=e,this.valueType=t}get type(){return this.valueType.name}makeSerialized(e,t){const r=this.valueType.factory.store(this.value),i=sk(r,e,t);return{type:this.type,value:i}}getOpHandler(e){const t=this.valueType.ops.get(e);if(!t)throw new Error("Unknown type message");return t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Mk{constructor(e,t,r,i,s=new wk){this.serializer=e,this.handle=t,this.submitMessage=r,this.type=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){var t;return((t=this.data.get(e))!==null&&t!==void 0?t:this.createCore(e,!0)).value}has(e){return this.data.has(e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=lK(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){if(r.type===Ue[Ue.Plain]||r.type===Ue[Ue.Shared])continue;const s={key:t.startsWith("intervalCollections/")?t.substring(20):t,value:this.makeLocal(t,r)};this.data.set(s.key,s.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}tryResubmitMessage(e,t){const r=e.type,i=this.messageHandlers.get(r);return i!==void 0?(i.resubmit(e,t),!0):!1}tryGetStashedOpLocalMetadata(e){const t=e.type;if(this.messageHandlers.has(t))return this.messageHandlers.get(t).getStashedOpLocalMetadata(e);throw new Error("no apply stashed op handler")}tryProcessMessage(e,t,r,i){const s=this.messageHandlers.get(e.type);return s!==void 0?(s.process(e,t,r,i),!0):!1}createCore(e,t){const r=new Q_(this.type.factory.load(this.makeMapValueOpEmitter(e),void 0),this.type),i=this.data.get(e);this.data.set(e,r);const s={key:e,previousValue:i};return this.eventEmitter.emit("create",s,t,this.eventEmitter),r}makeLocal(e,t){xn(t.type!==Ue[Ue.Plain]&&t.type!==Ue[Ue.Shared],737),t.value=ch(t.value,this.serializer);const r=this.type.factory.load(this.makeMapValueOpEmitter(e),t.value);return new Q_(r,this.type)}getMessageHandlers(){const e=new Map;return e.set("act",{process:(t,r,i,s)=>{var o;const a=(o=this.data.get(t.key))!==null&&o!==void 0?o:this.createCore(t.key,r),l=a.getOpHandler(t.value.opName),c=a.value,u=ch(t.value.value,this.serializer);l.process(c,u,r,i,s);const d={key:t.key,previousValue:c};this.eventEmitter.emit("valueChanged",d,r,i,this.eventEmitter)},submit:(t,r)=>{this.submitMessage(t,r)},resubmit:(t,r)=>{const i=this.data.get(t.key),s=i.getOpHandler(t.value.opName),{rebasedOp:o,rebasedLocalOpMetadata:a}=s.rebase(i.value,t.value,r);this.submitMessage(Object.assign(Object.assign({},t),{value:o}),a)},getStashedOpLocalMetadata:t=>{xn(!1,22)}}),e}makeMapValueOpEmitter(e){return{emit:(r,i,s,o)=>{const a=ok(s,this.serializer,this.handle),l={key:e,type:"act",value:{opName:r,value:a}};this.submitMessage(l,o);const c={key:e,previousValue:i};this.eventEmitter.emit("valueChanged",c,!0,null,this.eventEmitter)}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class RS{constructor(e,t){this.deltaArgs=e,this.mergeTreeClient=t,xn(e.deltaSegments.length>0,728),this.isEmpty=!1,this.deltaOperation=e.operation,this.sortedRanges=new Tm(()=>{const r=new L7;return this.deltaArgs.deltaSegments.forEach(i=>{const s={operation:this.deltaArgs.operation,position:this.mergeTreeClient.getPosition(i.segment),propertyDeltas:i.propertyDeltas,segment:i.segment};r.addOrUpdate(s)}),r}),this.pFirst=new Tm(()=>this.sortedRanges.value.items[0]),this.pLast=new Tm(()=>this.sortedRanges.value.items[this.sortedRanges.value.size-1])}get ranges(){return this.sortedRanges.value.items}get clientId(){return this.mergeTreeClient.longClientId}get first(){return this.pFirst.value}get last(){return this.pLast.value}}class Dk extends RS{constructor(e,t,r){super(t,r),this.opArgs=e,this.isLocal=e.sequencedMessage===void 0}}class Fk extends RS{constructor(e,t,r){super(t,r),this.opArgs=e}}let Tm=class{constructor(e){this.valueGenerator=e,this.pEvaluated=!1}get evaluated(){return this.pEvaluated}get value(){return this.pEvaluated||(this.pEvaluated=!0,this.pValue=this.valueGenerator()),this.pValue}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const xm="header",X_="content";class Ha extends df{constructor(e,t,r,i){super(t,e,r,"fluid_sequence_"),this.dataStoreRuntime=e,this.id=t,this.segmentFromSpec=i,this.loadedDeferred=new b7,this.loadedDeferredOutgoingOps=[],this.deferIncomingOps=!0,this.loadedDeferredIncomingOps=[],this.messagesSinceMSNChange=[],this.loadedDeferred.promise.catch(s=>{this.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},s)}),this.client=new OS(i,de.create(this.logger,"SharedSegmentSequence.MergeTreeClient"),e.options),super.on("newListener",s=>{switch(s){case"sequenceDelta":this.client.mergeTreeDeltaCallback||(this.client.mergeTreeDeltaCallback=(o,a)=>{this.emit("sequenceDelta",new Dk(o,a,this.client),this)});break;case"maintenance":this.client.mergeTreeMaintenanceCallback||(this.client.mergeTreeMaintenanceCallback=(o,a)=>{this.emit("maintenance",new Fk(a,o,this.client),this)});break}}),super.on("removeListener",s=>{switch(s){case"sequenceDelta":super.listenerCount(s)===0&&(this.client.mergeTreeDeltaCallback=void 0);break;case"maintenance":super.listenerCount(s)===0&&(this.client.mergeTreeMaintenanceCallback=void 0);break}}),this.intervalCollections=new Mk(this.serializer,this.handle,(s,o)=>this.submitLocalMessage(s,o),new ns)}get loaded(){return this.loadedDeferred.promise}static createOpsFromDelta(e){var t,r;const i=[];for(const s of e.ranges)switch(e.deltaOperation){case ue.ANNOTATE:{const o=i[i.length-1],a={};for(const l of Object.keys(s.propertyDeltas))a[l]=(r=(t=s.segment.properties)===null||t===void 0?void 0:t[l])!==null&&r!==void 0?r:null;o&&o.pos2===s.position&&eu(o.props,a)?o.pos2+=s.segment.cachedLength:i.push(Mv(s.position,s.position+s.segment.cachedLength,a,void 0));break}case ue.INSERT:i.push(Nk(s.position,s.segment.clone().toJSONObject()));break;case ue.REMOVE:{const o=i[i.length-1];(o==null?void 0:o.pos1)===s.position?o.pos2+=s.segment.cachedLength:i.push(Dv(s.position,s.position+s.segment.cachedLength));break}}return i}removeRange(e,t){const r=this.client.removeRangeLocal(e,t);return r&&this.submitSequenceMessage(r),r}groupOperation(e){this.client.localTransaction(e),this.submitSequenceMessage(e)}getContainingSegment(e){return this.client.getContainingSegment(e)}getLength(){return this.client.getLength()}getPosition(e){return this.client.getPosition(e)}annotateRange(e,t,r,i){const s=this.client.annotateRangeLocal(e,t,r,i);s&&this.submitSequenceMessage(s)}getPropertiesAtPosition(e){return this.client.getPropertiesAtPosition(e)}getRangeExtentsOfPosition(e){return this.client.getRangeExtentsOfPosition(e)}createPositionReference(e,t,r){const i=new yo(this.client,e,t,r);return r!==ne.Transient&&this.addLocalReference(i),i}createLocalReferencePosition(e,t,r,i){return this.client.createLocalReferencePosition(e,t,r,i)}localRefToPos(e){return this.client.localReferencePositionToPosition(e)}localReferencePositionToPosition(e){return this.client.localReferencePositionToPosition(e)}resolveRemoteClientPosition(e,t,r){return this.client.resolveRemoteClientPosition(e,t,r)}submitSequenceMessage(e){if(!this.isAttached())return;const t=ok(e,this.serializer,this.handle),r=this.client.peekPendingSegmentGroups(e.type===ue.GROUP?e.ops.length:1);this.loadedDeferred.isCompleted?this.submitLocalMessage(t,r):this.loadedDeferredOutgoingOps.push([t,r])}addLocalReference(e){return this.client.addLocalReference(e)}removeLocalReference(e){return this.client.removeLocalReferencePosition(e)}removeLocalReferencePosition(e){return this.client.removeLocalReferencePosition(e)}posFromRelativePos(e){return this.client.posFromRelativePos(e)}walkSegments(e,t,r,i,s=!1){return this.client.walkSegments(e,t,r,i,s)}getStackContext(e,t){return this.client.getStackContext(e,t)}getCurrentSeq(){return this.client.getCurrentSeq()}insertAtReferencePosition(e,t){const r=this.client.insertAtReferencePositionLocal(e,t);r&&this.submitSequenceMessage(r)}async waitIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollectionLabels(){return this.intervalCollections.keys()}summarizeCore(e,t){const r=new tn;return this.intervalCollections.size>0&&r.addBlob(xm,this.intervalCollections.serialize(e)),r.addWithStats(X_,this.summarizeMergeTree(e)),r.getSummaryTree()}processGCDataCore(e){this.intervalCollections.size>0&&this.intervalCollections.serialize(e),this.client.serializeGCData(this.handle,e)}replaceRange(e,t,r){const i=Math.max(e,t),s=this.client.insertSegmentLocal(i,r);if(s)if(e<t){const o=this.client.removeRangeLocal(e,t);this.submitSequenceMessage(dh(s,o))}else this.submitSequenceMessage(s)}onConnect(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}onDisconnect(){}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)||this.submitSequenceMessage(this.client.regeneratePendingOp(e,t))}async loadCore(e){var t;if(await e.contains(xm)){const r=await e.readBlob(xm),i=bk(r,"utf8");this.intervalCollections.populate(i)}try{const{catchupOpsP:r}=await this.client.load(this.runtime,new hG(e,X_),this.serializer),i=r.then(s=>{s.forEach(o=>{const a=this.client.getCollabWindow();if(o.minimumSequenceNumber<a.minSeq||o.referenceSequenceNumber<a.minSeq||o.sequenceNumber<=a.minSeq||o.sequenceNumber<=a.currentSeq)throw new Error(`Invalid catchup operations in snapshot: ${JSON.stringify({op:{seq:o.sequenceNumber,minSeq:o.minimumSequenceNumber,refSeq:o.referenceSequenceNumber},collabWindow:{seq:a.currentSeq,minSeq:a.minSeq}})}`);this.processMergeTreeMsg(o)}),this.loadFinished()}).catch(s=>{this.loadFinished(s)});((t=this.dataStoreRuntime.options)===null||t===void 0?void 0:t.sequenceInitializeFromHeaderOnly)!==!0&&await i}catch(r){this.loadFinished(r)}}processCore(e,t,r){this.deferIncomingOps?(xn(!t,114),this.loadedDeferredIncomingOps.push(e)):(xn(e.type===fh.Operation,115),this.intervalCollections.tryProcessMessage(e.contents,t,e,r)||this.processMergeTreeMsg(e,t))}didAttach(){var e;this.isAttached()&&this.client.startOrUpdateCollaboration((e=this.runtime.clientId)!==null&&e!==void 0?e:"attached")}initializeLocalCore(){super.initializeLocalCore(),this.loadFinished()}applyStashedOp(e){return this.client.applyStashedOp(e)}summarizeMergeTree(e){xn(this.loadedDeferred.isCompleted,116);const t=this.runtime.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(t),this.messagesSinceMSNChange.forEach(r=>{r.minimumSequenceNumber=t}),this.client.summarize(this.runtime,this.handle,e,this.messagesSinceMSNChange)}processMergeTreeMsg(e,t){var r,i;const s=ch(e,this.serializer),o=[];function a(u){o.push(...Ha.createOpsFromDelta(u))}const l=s.referenceSequenceNumber!==s.sequenceNumber-1;let c=s;((r=this.runtime.options)===null||r===void 0?void 0:r.newMergeTreeSnapshotFormat)!==!0&&l&&this.on("sequenceDelta",a),this.client.applyMsg(s,t),((i=this.runtime.options)===null||i===void 0?void 0:i.newMergeTreeSnapshotFormat)!==!0&&(l&&(this.removeListener("sequenceDelta",a),c=Object.assign(Object.assign({},s),{referenceSequenceNumber:c.sequenceNumber-1,contents:o.length!==1?dh(...o):o[0]})),this.messagesSinceMSNChange.push(c),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<s.minimumSequenceNumber&&this.processMinSequenceNumberChanged(s.minimumSequenceNumber))}processMinSequenceNumberChanged(e){let t=0;for(;t<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[t].sequenceNumber>e);t++);t!==0&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(t))}loadFinished(e){if(!this.loadedDeferred.isCompleted){if(this.initializeIntervalCollections(),e)throw this.loadedDeferred.reject(e),e;this.deferIncomingOps=!1;for(const t of this.loadedDeferredIncomingOps)this.processCore(t,!1,void 0);this.loadedDeferredIncomingOps.length=0,this.loadedDeferred.resolve();for(const[t,r]of this.loadedDeferredOutgoingOps)this.reSubmitCore(t,r);this.loadedDeferredOutgoingOps.length=0}}initializeIntervalCollections(){this.intervalCollections.eventEmitter.on("create",({key:e,previousValue:t},r)=>{const i=this.intervalCollections.get(e);i.attached||i.attachGraph(this.client,e),xn(t===void 0,705),this.emit("createIntervalCollection",e,r,this)});for(const e of this.intervalCollections.keys())this.intervalCollections.get(e).attachGraph(this.client,e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const nu="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Y_=128;class Xt extends mf{constructor(e){super(),this.items=e,this.type=Xt.typeString,this.cachedLength=e.length}static is(e){return e.type===Xt.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new Xt(e.items);return e.props&&t.addProperties(e.props),t}}toJSONObject(){const e={items:this.items};return super.addSerializedProps(e),e}clone(e=0,t){const r=this.items.slice(e,t),i=new Xt(r);return this.cloneInto(i),i}canAppend(e){return Xt.is(e)&&(this.cachedLength<=Y_||e.cachedLength<=Y_)}toString(){return this.items.toString()}append(e){if(!Xt.is(e))throw new Error("can only append another run segment");ii.append(this,e),this.items=this.items.concat(e.items),this.cachedLength=this.items.length}removeRange(e,t){let r=[];const i=this.items.length;return e>0&&(r=r.concat(this.items.slice(0,e))),t<i&&(r=r.concat(this.items.slice(t))),this.items=r,this.cachedLength=this.items.length,this.items.length===0}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);return this.items=this.items.slice(0,e),this.cachedLength=this.items.length,new Xt(t)}}}Xt.typeString="SubSequence";class kS extends Ha{constructor(e,t,r,i){super(e,t,r,i),this.id=t}insert(e,t,r){const i=new Xt(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}remove(e,t){this.removeRange(e,t)}getItemCount(){return this.getLength()}getItems(e,t){const r=[];let i;return t!==void 0&&t<=e||(this.walkSegments(s=>(Xt.is(s)&&(i===void 0&&(i=s),r.push(...s.items)),!0),e,t),i!==void 0&&r.splice(0,e-this.getPosition(i)),t!==void 0&&r.splice(t-e)),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zv extends kS{constructor(e,t,r){super(e,t,r,Lr.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Lr.Type)}static getFactory(){return new Lr}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class $v extends kS{constructor(e,t,r){super(e,t,r,Nr.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Nr.Type)}static getFactory(){return new Nr}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class kr{static segmentFromSpec(e){const t=bt.fromJSONObject(e);if(t)return t;const r=Pt.fromJSONObject(e);if(r)return r}get type(){return kr.Type}get attributes(){return kr.Attributes}async load(e,t,r,i){const s=new jv(e,t,i);return await s.load(r),s}create(e,t){const r=new jv(e,t,this.attributes);return r.initializeLocal(),r}}kr.Type="https://graph.microsoft.com/types/mergeTree";kr.Attributes={type:kr.Type,snapshotFormatVersion:"0.1",packageVersion:nu};class Nr{static segmentFromSpec(e){const t=e;if(t.items){const r=new Xt(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return Nr.Type}get attributes(){return Nr.Attributes}async load(e,t,r,i){const s=new $v(e,t,i);return await s.load(r),s}create(e,t){const r=new $v(e,t,this.attributes);return r.initializeLocal(),r}}Nr.Type="https://graph.microsoft.com/types/mergeTree/object-sequence";Nr.Attributes={type:Nr.Type,snapshotFormatVersion:"0.1",packageVersion:nu};class Lr{static segmentFromSpec(e){const t=e;if(t.items){const r=new Xt(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return Lr.Type}get attributes(){return Lr.Attributes}async load(e,t,r,i){const s=new zv(e,t,i);return await s.load(r),s}create(e,t){const r=new zv(e,t,this.attributes);return r.initializeLocal(),r}}Lr.Type="https://graph.microsoft.com/types/mergeTree/number-sequence";Lr.Attributes={type:Lr.Type,snapshotFormatVersion:"0.1",packageVersion:nu};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class jv extends Ha{constructor(e,t,r){super(e,t,r,kr.segmentFromSpec),this.id=t,this.mergeTreeTextHelper=this.client.createTextHelper()}static create(e,t){return e.createChannel(t,kr.Type)}static getFactory(){return new kr}get ISharedString(){return this}insertMarkerRelative(e,t,r){const i=new Pt(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertMarker(e,t,r){const i=new Pt(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);return s&&this.submitSequenceMessage(s),s}insertTextRelative(e,t,r){const i=new bt(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertText(e,t,r){const i=new bt(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}replaceText(e,t,r,i){this.replaceRange(e,t,bt.make(r,i))}removeText(e,t){return this.removeRange(e,t)}annotateMarkerNotifyConsensus(e,t,r){const i=this.client.annotateMarkerNotifyConsensus(e,t,r);i&&this.submitSequenceMessage(i)}annotateMarker(e,t,r){const i=this.client.annotateMarker(e,t,r);i&&this.submitSequenceMessage(i)}findTile(e,t,r=!0){return this.client.findTile(e,t,r)}getTextAndMarkers(e){const t=this.client.getCollabWindow();return this.mergeTreeTextHelper.getTextAndMarkers(t.currentSeq,t.clientId,e)}getText(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"",e,t)}getTextWithPlaceholders(){const e=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(e.currentSeq,e.clientId," ")}getTextRangeWithPlaceholders(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId," ",e,t)}getTextRangeWithMarkers(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"*",e,t)}getMarkerFromId(e){return this.client.getMarkerFromId(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class an extends mf{constructor(e){super(),this.type=an.typeString,this.cachedLength=e}static is(e){return e.type===an.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"pad"in e){const t=new an(e.pad);return e.props&&t.addProperties(e.props),t}}toJSONObject(){return{pad:this.cachedLength,props:this.properties}}clone(e=0,t){const r=new an(this.cachedLength);return this.cloneInto(r),r}canAppend(e){return an.is(e)}toString(){return`[padding: ${this.cachedLength}]`}append(e){if(!an.is(e))throw new Error("can only append padding segment");ii.append(this,e),this.cachedLength+=e.cachedLength}removeRange(e,t){return this.cachedLength-=t-e,this.cachedLength===0}createSplitSegmentAt(e){const t=e,r=this.cachedLength-e;return this.cachedLength=t,new an(r)}}an.typeString="PaddingSegment";class _n extends Xt{constructor(e){super(e),this.items=e,this.type=_n.typeString,this.tags=new Array(e.length).fill(void 0)}static is(e){return e.type===_n.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new _n(e.items);return e.props&&t.addProperties(e.props),t}}clone(e=0,t){const r=new _n(this.items.slice(e,t));return this.tags&&(r.tags=this.tags.slice(e,t)),this.cloneInto(r),r}append(e){super.append(e);const t=e;return t.tags&&this.tags&&this.tags.splice(this.items.length,0,...t.tags),this}removeRange(e,t){return this.tags.splice(e,t-e),super.removeRange(e,t)}getTag(e){return this.tags[e]}setTag(e,t){this.tags[e]=t}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);this.items=this.items.slice(0,e),this.cachedLength=this.items.length;const r=new _n(t);return r.tags=this.tags.slice(e),this.tags.length=e,r}}}_n.typeString="RunSegment";const Rc=2097152,Qs=Rc+1,NS=4294967295,cK=NS+1,uK=Rc*NS,xi=(n,e)=>n*Qs+e;function zk(n){const e=Math.floor(n/Qs),t=n-e*Qs;return{row:e,col:t}}class qv extends Ha{constructor(e,t,r){super(e,t,r,Ir.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Ir.Type)}static getFactory(){return new Ir}get numRows(){return zk(this.getLength()).row}setItems(e,t,r,i){const s=xi(e,t),o=s+r.length,a=new _n(r);i&&a.addProperties(i),this.replaceRange(s,o,a)}getItem(e,t){const r=xi(e,t),{segment:i,offset:s}=this.getContainingSegment(r);if(i&&_n.is(i))return i.items[s];if(i&&an.is(i))return;throw new Error("Unrecognized Segment type")}getTag(e,t){const{segment:r,offset:i}=this.getSegment(e,t);if(_n.is(r))return r.getTag(i)}setTag(e,t,r){const{segment:i,offset:s}=this.getSegment(e,t);if(_n.is(i))i.setTag(s,r);else if(r!==void 0)throw new Error(`Must not attempt to set tags on '${i.constructor.name}'.`)}insertRows(e,t){const r=xi(e,0),i=Qs*t,s=new an(i),o=this.client.insertSegmentLocal(r,s);o&&this.submitSequenceMessage(o)}removeRows(e,t){const r=xi(e,0),i=Qs*t;this.removeRange(r,r+i)}insertCols(e,t){this.moveAsPadding(Rc-t,e,t)}removeCols(e,t){this.moveAsPadding(e,Rc-t,t)}annotatePosition(e,t,r){const i=xi(e,t);this.annotateRange(i,i+1,r)}getPositionProperties(e,t){const r=xi(e,t);return this.getPropertiesAtPosition(r)}moveAsPadding(e,t,r){const i=e,s=e+r,o=[];for(let a=0,l=0;a<this.numRows;a++,l+=Qs){o.push(this.client.removeRangeLocal(l+i,l+s));const c=l+t,u=new an(r);o.push(this.client.insertSegmentLocal(c,u))}this.submitSequenceMessage(dh(...o))}getSegment(e,t){const r=xi(e,t);return this.getContainingSegment(r)}}class Ir{static segmentFromSpec(e){const t=an.fromJSONObject(e);if(t)return t;const r=_n.fromJSONObject(e);if(r)return r;throw new Error(`Unrecognized IJSONObject: '${JSON.stringify(e)}'`)}get type(){return Ir.Type}get attributes(){return Ir.Attributes}async load(e,t,r,i){const s=new qv(e,t,i);return await s.load(r),s}create(e,t){const r=new qv(e,t,this.attributes);return r.initializeLocal(),r}}Ir.Type="https://graph.microsoft.com/types/mergeTree/sparse-matrix";Ir.Attributes={type:Ir.Type,snapshotFormatVersion:"0.1",packageVersion:nu};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var $k;const Z_="header";class fi{get type(){return fi.Type}get attributes(){return fi.Attributes}async load(e,t,r,i){const s=new Bv(t,e,i);return await s.load(r),s}create(e,t){const r=new Bv(t,e,this.attributes);return r.initializeLocal(),r}}fi.Type="https://graph.microsoft.com/types/sharedIntervalCollection";fi.Attributes={type:fi.Type,snapshotFormatVersion:"0.1",packageVersion:nu};class Bv extends df{constructor(e,t,r){super(e,t,r,"fluid_sharedIntervalCollection_"),this[$k]="SharedIntervalCollection",this.intervalCollections=new Mk(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),new rs)}static create(e,t){return e.createChannel(t,fi.Type)}static getFactory(){return new fi}async waitIntervalCollection(e){return this.intervalCollections.get(this.getIntervalCollectionPath(e))}getIntervalCollection(e){const t=this.getIntervalCollectionPath(e);return this.intervalCollections.get(t)}summarizeCore(e){return Q9(Z_,this.intervalCollections.serialize(e))}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)}onDisconnect(){}async loadCore(e){const t=await e.readBlob(Z_),r=bk(t,"utf8");this.intervalCollections.populate(r)}processCore(e,t,r){e.type===fh.Operation&&this.intervalCollections.tryProcessMessage(e.contents,t,e,r)}getIntervalCollectionPath(e){return e}applyStashedOp(){throw new Error("not implemented")}}$k=Symbol.toStringTag;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const dK=Object.freeze(Object.defineProperty({__proto__:null,get AttachState(){return te},get ConnectionState(){return Te},get ContainerErrorType(){return as},DOProviderContainerRuntimeFactory:yk,DirectoryFactory:lr,get DriverErrorType(){return Nn},FluidContainer:Tv,Interval:ha,IntervalCollection:PS,IntervalCollectionIterator:Mo,get IntervalType(){return ir},LocalValueMaker:vS,MapFactory:Vn,PaddingSegment:an,RootDataObject:vk,RunSegment:_n,SequenceDeltaEvent:Dk,SequenceEvent:RS,SequenceInterval:si,SequenceMaintenanceEvent:Fk,ServiceAudience:Sk,SharedDirectory:Oc,SharedIntervalCollection:Bv,SharedIntervalCollectionFactory:fi,SharedMap:xc,SharedNumberSequence:zv,SharedNumberSequenceFactory:Lr,SharedObjectSequence:$v,SharedObjectSequenceFactory:Nr,SharedSegmentSequence:Ha,SharedSequence:kS,SharedString:jv,SharedStringFactory:kr,SparseMatrix:qv,SparseMatrixFactory:Ir,SubSequence:Xt,maxCellPosition:uK,maxCol:Rc,maxCols:Qs,maxRow:NS,maxRows:cK,positionToRowCol:zk,rowColToPosition:xi},Symbol.toStringTag,{value:"Module"})),hK=Lc(dK);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(yi,"__esModule",{value:!0});yi.DynamicObjectRegistry=void 0;const ka=hK,e1="@microsoft/live-share:DYNAMIC-LOADABLE-OBJECTS";class ru{static get dynamicLoadableObjects(){return typeof window>"u"?this._dynamicLoadableObjects:window[e1]||this._dynamicLoadableObjects}static registerObjectClass(e,t){const r=this.dynamicLoadableObjects;r.has(t)||(r.set(t,e),typeof window<"u"&&(window[e1]=r))}}ru._dynamicLoadableObjects=new Map;yi.DynamicObjectRegistry=ru;ru.registerObjectClass(ka.SharedMap,ka.SharedMap.getFactory().type);ru.registerObjectClass(ka.SharedString,ka.SharedString.getFactory().type);ru.registerObjectClass(ka.SharedDirectory,ka.SharedDirectory.getFactory().type);var iu={},su={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Om=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(su,"__esModule",{value:!0});su.TimestampProvider=void 0;const fK=5*1e3,pK=5;class mK{constructor(){this._retries=0,this._lastTimeSent=0}get isRunning(){return!!this._serverTime}getTimestamp(){if(!this._serverTime)throw new Error("TimestampProvider: can't call getTimestamp() before calling start().");return this._lastTimeSent=Math.max(new Date().getTime()+this._serverTime.offset,this._lastTimeSent+1)}getMaxTimestampError(){if(!this._serverTime)throw new Error("DefaultTimestampProvider: can't call getMaxTimestampError() before calling initialize().");return Math.floor(this._serverTime.requestLatency/2)}start(){return Om(this,void 0,void 0,function*(){this.stop(),performance.mark("TeamsSync: starting clock");try{yield this.improveAccuracy()}finally{performance.measure("TeamsSync: clock startup","TeamsSync: starting clock")}})}stop(){this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._serverTime=void 0,this._retries=0}improveAccuracy(){return Om(this,void 0,void 0,function*(){const e=yield this.getSessionTimeOffset();!this._serverTime||e.requestLatency<this._serverTime.requestLatency?(this._serverTime=e,this._retries=0):this._retries++,this._retries<=pK?this._syncTimer=setTimeout(this.improveAccuracy.bind(this),fK):this._syncTimer=void 0})}getSessionTimeOffset(){return Om(this,void 0,void 0,function*(){const e=performance.now(),t=yield this.getNtpTime(),r=performance.now(),i=new Date().getTime(),s=r-e,o=t.ntpTimeInUTC+Math.floor(s/2);return{serverTimeInUtc:o,localTimeInUtc:i,requestLatency:s,offset:o-i}})}}su.TimestampProvider=mK;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(iu,"__esModule",{value:!0});iu.HostTimestampProvider=void 0;const gK=su;class vK extends gK.TimestampProvider{constructor(e){super(),this._host=e}getNtpTime(){return this._host.getNtpTime()}}iu.HostTimestampProvider=vK;var Kn={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.LiveDataObjectInitializeState=n.ContainerState=n.UserMeetingRole=void 0,function(e){e.guest="Guest",e.attendee="Attendee",e.presenter="Presenter",e.organizer="Organizer"}(n.UserMeetingRole||(n.UserMeetingRole={})),function(e){e.added="Added",e.alreadyExists="AlreadyExists",e.conflict="Conflict",e.notFound="NotFound"}(n.ContainerState||(n.ContainerState={})),function(e){e.needed="needed",e.pending="pending",e.succeeded="succeeded",e.fatalError="fatalError"}(n.LiveDataObjectInitializeState||(n.LiveDataObjectInitializeState={}))})(Kn);var Pm={};const Va=Lc(g7);var pl={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function er(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jk(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const yK=(n,e)=>So.from(n,e).buffer,SK=(n,e)=>So.from(n).toString(e);function Uv(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let So=class Ns extends Uint8Array{toString(e){return jk(this,e)}static from(e,t,r){if(typeof e=="string")return Ns.fromString(e,t);if(e!==null&&typeof e=="object"&&Uv(e.buffer))return Ns.fromArrayBuffer(e.buffer,e.byteOffset,e.byteLength);if(Uv(e))return Ns.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ns(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Ns(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ns(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};async function bK(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function wK(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return ur(n)}}async function qk(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return QO(()=>import("./hashFileNode-d3a3dee7.js"),["assets/hashFileNode-d3a3dee7.js","assets/sha256-492b8c35.js"]).then(async i=>i.hashFile(n,e,t));const r=await bK(n,e);return wK(r,t)}async function CK(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=So.from(t+n.toString());return qk(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Hv=globalThis.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const EK=n=>So.from(n,"base64").toString("utf-8"),_K=n=>So.from(n,"utf8").toString("base64"),TK=(n,e)=>{switch(e){case"utf8":case"utf-8":return n;default:return So.from(n,e).toString()}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function xK(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const OK=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function PK(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Bk extends pn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class br extends Bk{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(br.removeListenerEvent,t),this.on(br.newListenerEvent,r)}}static isEmitterEvent(e){return e===br.newListenerEvent||e===br.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!br.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!br.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if((i==null?void 0:i.has(e))===!0&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}}br.newListenerEvent="newListener";br.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const RK={compare:(n,e)=>n-e,min:Number.MIN_VALUE};class kK{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const e=this.L.pop();return this.fixdown(1),e.value}add(e){const t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){const t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){const t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){const r=t>>1;this.swap(t,r),t=r}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r].value,this.L[r+1].value)>0&&r++,this.comp.compare(this.L[t].value,this.L[r].value)<=0)break;this.swap(t,r),t=r}}swap(e,t){const r=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=r,this.L[t].position=t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class NK{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class LK{send(e){}}let IK=class{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class AK{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(e,setTimeout(()=>{this.cleanup(e),this.cancel(e)},this.expiry.durationMs))}cancel(e){const t=this.gcTimeouts.get(e);t!==void 0&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){this.expiry.policy==="sliding"&&(this.cancel(e),this.schedule(e))}}class MK{constructor({expiry:e={policy:"indefinite"},removeOnError:t=()=>!0}={}){this.cache=new Map,this.removeOnError=t,this.gc=new AK(e,r=>this.remove(r))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}async addOrGet(e,t){let r=this.get(e);return r===void 0&&(r=(async()=>t())(),this.cache.set(e,r),r.catch(s=>{this.removeOnError(s)&&this.remove(e)}),this.gc.schedule(e)),r}add(e,t){const r=this.has(e);return this.addOrGet(e,t).catch(()=>{}),!r}async addValueOrGet(e,t){return this.addOrGet(e,async()=>t)}addValue(e,t){return this.add(e,async()=>t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Uk=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};class DK{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class FK{constructor(e,t){typeof e=="number"?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=wa(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:wa(this.ranges)}}add(e,t){er(e>=this.lastPrimary,3),this.lastSecondary!==void 0&&er(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;const r=this.ranges[this.ranges.length-1],i=r.primary+r.length,s=r.secondary+r.length;t!==s&&(e===i?r.length===0?r.secondary=t:(r.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&s+1===t?r.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){er(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);er(e>=this.ranges[t-1].primary,6);const r=this.ranges[t-1];return Math.min(e-r.primary,r.length)+r.secondary}updateBase(e){er(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);er(e>=this.ranges[t-1].primary,8);const r=this.ranges[t-1],i=e-r.primary;r.secondary=r.secondary+Math.min(i,r.length),r.length=Math.max(r.length-i,0),r.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,er(e===this.ranges[0].primary,9)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zK{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){const r=[],i=Date.now();for(const s of t){const o=`${e}/${s}`;if(!this.requestMap.has(o))this.requestMap.set(o,i),r.push(s);else{if(this.requestMap.get(o)+this.windowMSec>i)continue;this.requestMap.set(o,i),r.push(s)}}return r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function $K(n){let e;try{e=JSON.parse(n)}catch{return}return e}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Rm=2147483647;function LS(n,e,t){let r;if(e>Rm){const i=e-Rm;r=setTimeout(()=>LS(n,i,t),Rm)}else r=setTimeout(()=>n(),Math.max(e,0));return t==null||t(r),r}class Hk{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:LS(()=>this.handler(),e,i=>{this.runningState!==void 0&&(this.runningState.timeout=i)})}}handler(){er(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class jK{constructor(e,t){this.timer=new Hk(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Uk,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),er(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class IS{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=Hv.now();return new IS(e)}trace(){const e=Hv.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qK(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const BK=Object.freeze(Object.defineProperty({__proto__:null,BaseTelemetryNullLogger:LK,Deferred:Uk,EventForwarder:br,Heap:kK,IsoBuffer:So,Lazy:NK,LazyPromise:DK,NumberComparer:RK,PromiseCache:MK,PromiseTimer:jK,RangeTracker:FK,RateLimiter:zK,TelemetryNullLogger:IK,Timer:Hk,Trace:IS,TypedEventEmitter:Bk,Uint8ArrayToArrayBuffer:xK,Uint8ArrayToString:jk,assert:er,bufferToString:SK,delay:OK,doIfNotDisposed:PK,fromBase64ToUtf8:EK,fromUtf8ToBase64:_K,gitHashFile:CK,hashFile:qk,isArrayBuffer:Uv,performance:Hv,safelyParseJSON:$K,setLongTimeout:LS,stringToBuffer:yK,toUtf8:TK,unreachableCase:qK},Symbol.toStringTag,{value:"Module"})),Wa=Lc(BK);var km={},Ar={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Ar,"__esModule",{value:!0});Ar.LiveShareReportIssueLink=Ar.ObjectSynchronizerEvents=Ar.TelemetryEvents=void 0;Ar.TelemetryEvents={LivePresence:{LocalPresenceChanged:"LivePresence:LocalPresenceChange",RemotePresenceChanged:"LivePresence:RemotePresenceChange",GetClientInfoError:"LivePresence:GetClientInfoError",RoleVerificationError:"LivePresence:RoleVerificationError"},LiveState:{StateChanged:"LiveState:StateChanged",RoleVerificationError:"LiveState:RoleVerificationError"}};Ar.ObjectSynchronizerEvents={update:"update",connect:"connect"};Ar.LiveShareReportIssueLink="https://aka.ms/teamsliveshare/issue";var vf={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Nm=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(vf,"__esModule",{value:!0});vf.LiveShareTokenProvider=void 0;class UK{constructor(e){this._host=e}fetchOrdererToken(e,t,r){return Nm(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchStorageToken(e,t,r){return Nm(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchFluidToken(e,t,r){return Nm(this,void 0,void 0,function*(){let i;return!this._frsToken||r||this._tenantId!==e||this._documentId!==t?(this._frsToken=yield this._host.getFluidToken(t),i=!1):i=!0,this._tenantId=e,t&&(this._documentId=t),{jwt:this._frsToken,fromCache:i}})}}vf.LiveShareTokenProvider=UK;var Ga={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Ga,"__esModule",{value:!0});Ga.RequestCache=void 0;class HK{constructor(e){this._cache=new Map,this._cacheLifetime=e}cacheRequest(e,t){const r=new Date().getTime();let i;if(this._cache.has(e)){i=this._cache.get(e);const o=i.startTime+this._cacheLifetime;if(r<o)return i.promise}const s=t();return this._cache.set(e,{startTime:r,promise:s}),s}has(e){return this._cache.has(e)}}Ga.RequestCache=HK;var yf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var VK=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(yf,"__esModule",{value:!0});yf.RoleVerifier=void 0;class WK{constructor(e){this._host=e}verifyRolesAllowed(e,t){var r;return VK(this,void 0,void 0,function*(){if(!e)throw new Error("RoleVerifier: called verifyRolesAllowed() without a clientId");if(Array.isArray(t)&&t.length>0){const i=yield this._host.getClientInfo(e),s=(r=i==null?void 0:i.roles)!==null&&r!==void 0?r:[];for(let o=0;o<t.length;o++){const a=t[o];if(s.indexOf(a)>=0)return!0}return!1}return!0})}}yf.RoleVerifier=WK;var Ke={},Vk={},Sf={},bf={};Object.defineProperty(bf,"__esModule",{value:!0});bf.default=KK;let zu;const GK=new Uint8Array(16);function KK(){if(!zu&&(zu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!zu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zu(GK)}var gs={},bo={},wf={};Object.defineProperty(wf,"__esModule",{value:!0});wf.default=void 0;var JK=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;wf.default=JK;Object.defineProperty(bo,"__esModule",{value:!0});bo.default=void 0;var QK=XK(wf);function XK(n){return n&&n.__esModule?n:{default:n}}function YK(n){return typeof n=="string"&&QK.default.test(n)}var ZK=YK;bo.default=ZK;Object.defineProperty(gs,"__esModule",{value:!0});gs.default=void 0;gs.unsafeStringify=Wk;var eJ=tJ(bo);function tJ(n){return n&&n.__esModule?n:{default:n}}const Tt=[];for(let n=0;n<256;++n)Tt.push((n+256).toString(16).slice(1));function Wk(n,e=0){return Tt[n[e+0]]+Tt[n[e+1]]+Tt[n[e+2]]+Tt[n[e+3]]+"-"+Tt[n[e+4]]+Tt[n[e+5]]+"-"+Tt[n[e+6]]+Tt[n[e+7]]+"-"+Tt[n[e+8]]+Tt[n[e+9]]+"-"+Tt[n[e+10]]+Tt[n[e+11]]+Tt[n[e+12]]+Tt[n[e+13]]+Tt[n[e+14]]+Tt[n[e+15]]}function nJ(n,e=0){const t=Wk(n,e);if(!(0,eJ.default)(t))throw TypeError("Stringified UUID is invalid");return t}var rJ=nJ;gs.default=rJ;Object.defineProperty(Sf,"__esModule",{value:!0});Sf.default=void 0;var iJ=oJ(bf),sJ=gs;function oJ(n){return n&&n.__esModule?n:{default:n}}let t1,Lm,Im=0,Am=0;function aJ(n,e,t){let r=e&&t||0;const i=e||new Array(16);n=n||{};let s=n.node||t1,o=n.clockseq!==void 0?n.clockseq:Lm;if(s==null||o==null){const h=n.random||(n.rng||iJ.default)();s==null&&(s=t1=[h[0]|1,h[1],h[2],h[3],h[4],h[5]]),o==null&&(o=Lm=(h[6]<<8|h[7])&16383)}let a=n.msecs!==void 0?n.msecs:Date.now(),l=n.nsecs!==void 0?n.nsecs:Am+1;const c=a-Im+(l-Am)/1e4;if(c<0&&n.clockseq===void 0&&(o=o+1&16383),(c<0||a>Im)&&n.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Im=a,Am=l,Lm=o,a+=122192928e5;const u=((a&268435455)*1e4+l)%4294967296;i[r++]=u>>>24&255,i[r++]=u>>>16&255,i[r++]=u>>>8&255,i[r++]=u&255;const d=a/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=d&255,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(let h=0;h<6;++h)i[r+h]=s[h];return e||(0,sJ.unsafeStringify)(i)}var lJ=aJ;Sf.default=lJ;var Cf={},cs={},ou={};Object.defineProperty(ou,"__esModule",{value:!0});ou.default=void 0;var cJ=uJ(bo);function uJ(n){return n&&n.__esModule?n:{default:n}}function dJ(n){if(!(0,cJ.default)(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var hJ=dJ;ou.default=hJ;Object.defineProperty(cs,"__esModule",{value:!0});cs.URL=cs.DNS=void 0;cs.default=vJ;var fJ=gs,pJ=mJ(ou);function mJ(n){return n&&n.__esModule?n:{default:n}}function gJ(n){n=unescape(encodeURIComponent(n));const e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}const Gk="6ba7b810-9dad-11d1-80b4-00c04fd430c8";cs.DNS=Gk;const Kk="6ba7b811-9dad-11d1-80b4-00c04fd430c8";cs.URL=Kk;function vJ(n,e,t){function r(i,s,o,a){var l;if(typeof i=="string"&&(i=gJ(i)),typeof s=="string"&&(s=(0,pJ.default)(s)),((l=s)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=c[u];return o}return(0,fJ.unsafeStringify)(c)}try{r.name=n}catch{}return r.DNS=Gk,r.URL=Kk,r}var Ef={};Object.defineProperty(Ef,"__esModule",{value:!0});Ef.default=void 0;function yJ(n){if(typeof n=="string"){const e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return SJ(bJ(wJ(n),n.length*8))}function SJ(n){const e=[],t=n.length*32,r="0123456789abcdef";for(let i=0;i<t;i+=8){const s=n[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);e.push(o)}return e}function Jk(n){return(n+64>>>9<<4)+14+1}function bJ(n,e){n[e>>5]|=128<<e%32,n[Jk(e)-1]=e;let t=1732584193,r=-271733879,i=-1732584194,s=271733878;for(let o=0;o<n.length;o+=16){const a=t,l=r,c=i,u=s;t=At(t,r,i,s,n[o],7,-680876936),s=At(s,t,r,i,n[o+1],12,-389564586),i=At(i,s,t,r,n[o+2],17,606105819),r=At(r,i,s,t,n[o+3],22,-1044525330),t=At(t,r,i,s,n[o+4],7,-176418897),s=At(s,t,r,i,n[o+5],12,1200080426),i=At(i,s,t,r,n[o+6],17,-1473231341),r=At(r,i,s,t,n[o+7],22,-45705983),t=At(t,r,i,s,n[o+8],7,1770035416),s=At(s,t,r,i,n[o+9],12,-1958414417),i=At(i,s,t,r,n[o+10],17,-42063),r=At(r,i,s,t,n[o+11],22,-1990404162),t=At(t,r,i,s,n[o+12],7,1804603682),s=At(s,t,r,i,n[o+13],12,-40341101),i=At(i,s,t,r,n[o+14],17,-1502002290),r=At(r,i,s,t,n[o+15],22,1236535329),t=Mt(t,r,i,s,n[o+1],5,-165796510),s=Mt(s,t,r,i,n[o+6],9,-1069501632),i=Mt(i,s,t,r,n[o+11],14,643717713),r=Mt(r,i,s,t,n[o],20,-373897302),t=Mt(t,r,i,s,n[o+5],5,-701558691),s=Mt(s,t,r,i,n[o+10],9,38016083),i=Mt(i,s,t,r,n[o+15],14,-660478335),r=Mt(r,i,s,t,n[o+4],20,-405537848),t=Mt(t,r,i,s,n[o+9],5,568446438),s=Mt(s,t,r,i,n[o+14],9,-1019803690),i=Mt(i,s,t,r,n[o+3],14,-187363961),r=Mt(r,i,s,t,n[o+8],20,1163531501),t=Mt(t,r,i,s,n[o+13],5,-1444681467),s=Mt(s,t,r,i,n[o+2],9,-51403784),i=Mt(i,s,t,r,n[o+7],14,1735328473),r=Mt(r,i,s,t,n[o+12],20,-1926607734),t=Dt(t,r,i,s,n[o+5],4,-378558),s=Dt(s,t,r,i,n[o+8],11,-2022574463),i=Dt(i,s,t,r,n[o+11],16,1839030562),r=Dt(r,i,s,t,n[o+14],23,-35309556),t=Dt(t,r,i,s,n[o+1],4,-1530992060),s=Dt(s,t,r,i,n[o+4],11,1272893353),i=Dt(i,s,t,r,n[o+7],16,-155497632),r=Dt(r,i,s,t,n[o+10],23,-1094730640),t=Dt(t,r,i,s,n[o+13],4,681279174),s=Dt(s,t,r,i,n[o],11,-358537222),i=Dt(i,s,t,r,n[o+3],16,-722521979),r=Dt(r,i,s,t,n[o+6],23,76029189),t=Dt(t,r,i,s,n[o+9],4,-640364487),s=Dt(s,t,r,i,n[o+12],11,-421815835),i=Dt(i,s,t,r,n[o+15],16,530742520),r=Dt(r,i,s,t,n[o+2],23,-995338651),t=Ft(t,r,i,s,n[o],6,-198630844),s=Ft(s,t,r,i,n[o+7],10,1126891415),i=Ft(i,s,t,r,n[o+14],15,-1416354905),r=Ft(r,i,s,t,n[o+5],21,-57434055),t=Ft(t,r,i,s,n[o+12],6,1700485571),s=Ft(s,t,r,i,n[o+3],10,-1894986606),i=Ft(i,s,t,r,n[o+10],15,-1051523),r=Ft(r,i,s,t,n[o+1],21,-2054922799),t=Ft(t,r,i,s,n[o+8],6,1873313359),s=Ft(s,t,r,i,n[o+15],10,-30611744),i=Ft(i,s,t,r,n[o+6],15,-1560198380),r=Ft(r,i,s,t,n[o+13],21,1309151649),t=Ft(t,r,i,s,n[o+4],6,-145523070),s=Ft(s,t,r,i,n[o+11],10,-1120210379),i=Ft(i,s,t,r,n[o+2],15,718787259),r=Ft(r,i,s,t,n[o+9],21,-343485551),t=ji(t,a),r=ji(r,l),i=ji(i,c),s=ji(s,u)}return[t,r,i,s]}function wJ(n){if(n.length===0)return[];const e=n.length*8,t=new Uint32Array(Jk(e));for(let r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function ji(n,e){const t=(n&65535)+(e&65535);return(n>>16)+(e>>16)+(t>>16)<<16|t&65535}function CJ(n,e){return n<<e|n>>>32-e}function _f(n,e,t,r,i,s){return ji(CJ(ji(ji(e,n),ji(r,s)),i),t)}function At(n,e,t,r,i,s,o){return _f(e&t|~e&r,n,e,i,s,o)}function Mt(n,e,t,r,i,s,o){return _f(e&r|t&~r,n,e,i,s,o)}function Dt(n,e,t,r,i,s,o){return _f(e^t^r,n,e,i,s,o)}function Ft(n,e,t,r,i,s,o){return _f(t^(e|~r),n,e,i,s,o)}var EJ=yJ;Ef.default=EJ;Object.defineProperty(Cf,"__esModule",{value:!0});Cf.default=void 0;var _J=Qk(cs),TJ=Qk(Ef);function Qk(n){return n&&n.__esModule?n:{default:n}}const xJ=(0,_J.default)("v3",48,TJ.default);var OJ=xJ;Cf.default=OJ;var Tf={},xf={};Object.defineProperty(xf,"__esModule",{value:!0});xf.default=void 0;const PJ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var RJ={randomUUID:PJ};xf.default=RJ;Object.defineProperty(Tf,"__esModule",{value:!0});Tf.default=void 0;var n1=Xk(xf),kJ=Xk(bf),NJ=gs;function Xk(n){return n&&n.__esModule?n:{default:n}}function LJ(n,e,t){if(n1.default.randomUUID&&!e&&!n)return n1.default.randomUUID();n=n||{};const r=n.random||(n.rng||kJ.default)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return(0,NJ.unsafeStringify)(r)}var IJ=LJ;Tf.default=IJ;var Of={},Pf={};Object.defineProperty(Pf,"__esModule",{value:!0});Pf.default=void 0;function AJ(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function Mm(n,e){return n<<e|n>>>32-e}function MJ(n){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let a=0;a<o.length;++a)n.push(o.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const r=n.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(let o=0;o<i;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=n[o*64+l*4]<<24|n[o*64+l*4+1]<<16|n[o*64+l*4+2]<<8|n[o*64+l*4+3];s[o]=a}s[i-1][14]=(n.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<i;++o){const a=new Uint32Array(80);for(let f=0;f<16;++f)a[f]=s[o][f];for(let f=16;f<80;++f)a[f]=Mm(a[f-3]^a[f-8]^a[f-14]^a[f-16],1);let l=t[0],c=t[1],u=t[2],d=t[3],h=t[4];for(let f=0;f<80;++f){const p=Math.floor(f/20),g=Mm(l,5)+AJ(p,c,u,d)+h+e[p]+a[f]>>>0;h=d,d=u,u=Mm(c,30)>>>0,c=l,l=g}t[0]=t[0]+l>>>0,t[1]=t[1]+c>>>0,t[2]=t[2]+u>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+h>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var DJ=MJ;Pf.default=DJ;Object.defineProperty(Of,"__esModule",{value:!0});Of.default=void 0;var FJ=Yk(cs),zJ=Yk(Pf);function Yk(n){return n&&n.__esModule?n:{default:n}}const $J=(0,FJ.default)("v5",80,zJ.default);var jJ=$J;Of.default=jJ;var Rf={};Object.defineProperty(Rf,"__esModule",{value:!0});Rf.default=void 0;var qJ="00000000-0000-0000-0000-000000000000";Rf.default=qJ;var kf={};Object.defineProperty(kf,"__esModule",{value:!0});kf.default=void 0;var BJ=UJ(bo);function UJ(n){return n&&n.__esModule?n:{default:n}}function HJ(n){if(!(0,BJ.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}var VJ=HJ;kf.default=VJ;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return o.default}});var e=u(Sf),t=u(Cf),r=u(Tf),i=u(Of),s=u(Rf),o=u(kf),a=u(bo),l=u(gs),c=u(ou);function u(d){return d&&d.__esModule?d:{default:d}}})(Vk);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var AS=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.waitUntilConnected=Ke.getInsecureTokenProvider=Ke.timeoutRequest=Ke.waitForResult=Ke.TimeoutError=Ke.waitForDelay=Ke.parseJwt=Ke.decodeBase64=Ke.cloneValue=void 0;const WJ=Vk;function GJ(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n}Ke.cloneValue=GJ;function Zk(n){return typeof atob=="function"?atob(n):Buffer.from(n,"base64").toString()}Ke.decodeBase64=Zk;const KJ=n=>{try{return JSON.parse(Zk(n.split(".")[1]))}catch{return null}};Ke.parseJwt=KJ;function eN(n){return new Promise(e=>{setTimeout(()=>e(),n)})}Ke.waitForDelay=eN;class MS extends Error{constructor(){super("timed out")}}Ke.TimeoutError=MS;function JJ(n,e,t,r,i,s,o=1e3){let a=0;return new Promise((l,c)=>AS(this,void 0,void 0,function*(){for(;;){try{const u=yield tN(n,Math.max(o*(a+1),o*3),s),d=e(u);if(d!==null){l(d.response);break}else if(a>=r.length){c(new Error("waitForResult: invalid response"));break}}catch(u){if(a>=r.length){c(t(u));break}if(i&&!(u instanceof MS)){const d=i(u);if(d!==null){c(d);break}}}yield eN(r[a++])}}))}Ke.waitForResult=JJ;function tN(n,e,t){return new Promise((r,i)=>AS(this,void 0,void 0,function*(){let s=setTimeout(()=>{i(new MS),s=null},e);try{const o=yield n();r(o),s==null&&(t==null||t())}catch(o){i(o),s==null&&(t==null||t())}clearTimeout(s)}))}Ke.timeoutRequest=tN;function QJ(){var n,e;return AS(this,void 0,void 0,function*(){try{const{InsecureTokenProvider:t}=yield require("@fluidframework/test-client-utils"),r=(e=(n=new URL(window.location.href))===null||n===void 0?void 0:n.searchParams)===null||e===void 0?void 0:e.get("userId");return new t("",{id:r??(0,WJ.v4)(),name:"Test User"})}catch{throw new Error("@microsoft/live-share: when using 'local' connection type, you must have @fluidframework/test-client-utils installed")}})}Ke.getInsecureTokenProvider=QJ;function XJ(n){return new Promise(e=>{const t=r=>{n.off("connected",t),e(r)};n.clientId?e(n.clientId):n.on("connected",t)})}Ke.waitUntilConnected=XJ;var Nf={},Ka={},Dm=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Ka,"__esModule",{value:!0});Ka.BaseHostDecorator=void 0;class YJ{constructor(e){this._host=e}registerClientId(e){return Dm(this,void 0,void 0,function*(){return this._host.registerClientId(e)})}getClientRoles(e){return Dm(this,void 0,void 0,function*(){return this._host.getClientRoles(e)})}getClientInfo(e){return Dm(this,void 0,void 0,function*(){return this._host.getClientInfo(e)})}getFluidTenantInfo(){return this._host.getFluidTenantInfo()}getFluidToken(e){return this._host.getFluidToken(e)}getFluidContainerId(){return this._host.getFluidContainerId()}setFluidContainerId(e){return this._host.setFluidContainerId(e)}getNtpTime(){return this._host.getNtpTime()}}Ka.BaseHostDecorator=YJ;var Ot={};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.isTimestampProvider=Ot.isILiveEvent=Ot.isErrorLike=Ot.isIClientInfo=Ot.isClientRolesResponse=Ot.isMobileWorkaroundRolesResponse=void 0;function ZJ(n){return DS(n==null?void 0:n.userRoles)}Ot.isMobileWorkaroundRolesResponse=ZJ;function DS(n){return Array.isArray(n)&&n.every(e=>typeof e=="string")}Ot.isClientRolesResponse=DS;function eQ(n){return n===void 0||(n==null?void 0:n.userId)!==void 0&&DS(n==null?void 0:n.roles)}Ot.isIClientInfo=eQ;function tQ(n){return typeof(n==null?void 0:n.message)=="string"}Ot.isErrorLike=tQ;function nQ(n){return typeof n=="object"&&typeof n.clientId=="string"&&typeof n.timestamp=="number"&&typeof n.name=="string"}Ot.isILiveEvent=nQ;function rQ(n){return typeof(n==null?void 0:n.start)=="function"}Ot.isTimestampProvider=rQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var $u=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Nf,"__esModule",{value:!0});Nf.LiveShareHostDecorator=void 0;const iQ=Ka,r1=Ga,No=Ot,i1=Ke,s1=[100,200,200,400,600],o1=4*1e3;class sQ extends iQ.BaseHostDecorator{constructor(){super(...arguments),this._registerRequestCache=new r1.RequestCache(o1),this._userInfoRequestCache=new r1.RequestCache(o1)}getClientInfo(e,t,r){return $u(this,void 0,void 0,function*(){if(!e)throw new Error("LiveShareHostDecorator: called getClientInfo() without a clientId");const i=r?`${e}backwardsCompat`:e;return this._userInfoRequestCache.cacheRequest(i,()=>(0,i1.waitForResult)(()=>$u(this,void 0,void 0,function*(){return yield this._host.getClientInfo(e)}),s=>(0,No.isIClientInfo)(s)?{response:s}:null,s=>new Error(`LiveShareHostDecorator: getting client info for a remote client ID for reason: ${(0,No.isErrorLike)(s)?s.message:"unknown"}`),r??s1,s=>e==="fakeId"?new Error((0,No.isErrorLike)(s)?s.message:"an unknown error occurred"):null,t))})}registerClientId(e){return $u(this,void 0,void 0,function*(){return this._registerRequestCache.cacheRequest(e,()=>(0,i1.waitForResult)(()=>$u(this,void 0,void 0,function*(){return yield this._host.registerClientId(e)}),t=>(0,No.isClientRolesResponse)(t)?{response:t}:(0,No.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,t=>new Error(`LiveShareHostDecorator: registering local client ID for reason: ${(0,No.isErrorLike)(t)?t.message:"unknown"}`),s1))})}}Nf.LiveShareHostDecorator=sQ;var Lf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Fm=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Lf,"__esModule",{value:!0});Lf.BackwardsCompatibilityHostDecorator=void 0;const oQ=Ka,aQ=Ga,zm=Ot,lQ=Ke,a1=[100,200,200,400,600],cQ=5*60*1e3;class uQ extends oQ.BaseHostDecorator{constructor(e){super(e),this._host=e,this._userRolesRequestCache=new aQ.RequestCache(cQ),this._totalTries=4,this._getClientInfoTriesRemaining=this._totalTries,this._getClientInfoExists=!1,this._hasWarnedPolyfill=!1,this.warmupCheckGetClientInfoExists()}getClientRoles(e){return Fm(this,void 0,void 0,function*(){if(!e)throw new Error("BackwardsCompatibilityHostDecorator: called getClientInfo() without a clientId");return this._userRolesRequestCache.cacheRequest(e,()=>(0,lQ.waitForResult)(()=>Fm(this,void 0,void 0,function*(){return yield this._host.getClientRoles(e)}),t=>(0,zm.isClientRolesResponse)(t)?{response:t}:(0,zm.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,()=>new Error("BackwardsCompatibilityHostDecorator: timed out getting roles for a remote client ID"),a1))})}getClientInfo(e){return Fm(this,void 0,void 0,function*(){if(this._getClientInfoExists)return yield this._host.getClientInfo(e);if(this._getClientInfoTriesRemaining<=0){this._hasWarnedPolyfill||(console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: using getClientInfo polyfill"),this._hasWarnedPolyfill=!0);const r=yield this.getClientRoles(e);return{userId:e,displayName:void 0,roles:r??[]}}const t=this.getClientRoles(e);try{const r=yield this._host.getClientInfo(e,()=>{this._getClientInfoExists=!0},this.getRetrySchedule());return this._getClientInfoExists=!0,r}catch(r){if((0,zm.isErrorLike)(r)&&r.message.includes("timed out")){this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining<=0&&console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill");const i=yield t;return{userId:e,displayName:void 0,roles:i??[]}}}return this._getClientInfoExists=!0,console.log("BackwardsCompatibilityHostDecorator: error, retryingWithActual"),yield this.getClientInfo(e)})}warmupCheckGetClientInfoExists(){this._getClientInfoExists||this._host.getClientInfo("fakeId",()=>{this._getClientInfoExists=!0},[]).catch(e=>{e.message.includes("timed out")?(this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining>0?this.warmupCheckGetClientInfoExists():console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill")):this._getClientInfoExists=!0})}getRetrySchedule(){const e=this._totalTries-Math.max(0,this._getClientInfoTriesRemaining);return a1.slice(0,e)}}Lf.BackwardsCompatibilityHostDecorator=uQ;var au={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(au,"__esModule",{value:!0});au.Deferred=void 0;class dQ{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}get resolve(){return this._resolve}get reject(){return this._reject}}au.Deferred=dQ;var nN={};Object.defineProperty(nN,"__esModule",{value:!0});var ml={},l1;function hQ(){if(l1)return ml;l1=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=G&&G.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(ml,"__esModule",{value:!0}),ml.LiveObjectManager=void 0;const e=Wa,t=Qa(),r=Jn();let i=class extends e.TypedEventEmitter{constructor(o,a){super(),this._liveRuntime=o,this._containerRuntime=a,this.objectStoreMap=new Map,this.updateInterval=1e4}start(){this.startReceivingSignalUpdates()}stop(){this.stopReceivingSignalUpdates(),this.objectStoreMap.clear()}registerObject(o,a,l,c,u){return n(this,void 0,void 0,function*(){this._synchronizer||(this._synchronizer=new r.ContainerSynchronizer(a,this._containerRuntime,this._liveRuntime,this)),this._synchronizer.registerObject(o,c,u);const d={clientId:yield(0,r.waitUntilConnected)(a),timestamp:0,data:l,name:r.ObjectSynchronizerEvents.update};this.updateEventLocallyInStore(o,d)})}unregisterObject(o){this._synchronizer&&this._synchronizer.unregisterObject(o)}getLatestEventForObject(o){var a;return(a=this.getEventsForObject(o))===null||a===void 0?void 0:a[0]}getLatestEventForObjectClient(o,a){var l;return(l=this.objectStoreMap.get(o))===null||l===void 0?void 0:l.get(a)}getEventsForObject(o){var a;const l=this.objectStoreMap.get(o);if(l)return(a=[...l.values()])===null||a===void 0?void 0:a.sort((c,u)=>u.timestamp-c.timestamp)}sendEventForObject(o,a){return n(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const l=yield this._synchronizer.sendEventForObject(o,a);return this.updateEventLocallyInStore(o,l),l})}sendThrottledEventForObject(o,a){return n(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const l=yield this._synchronizer.sendThrottledEventForObject(o,a);return this.updateEventLocallyInStore(o,l),l})}clientIdDidChange(o,a){this.objectStoreMap.forEach(l=>{const c=l.get(o);c&&(l.set(a,c),l.delete(o))})}__dangerouslySetContainerRuntime(o){var a;this._containerRuntime!==o&&(this.stopReceivingSignalUpdates(),this._containerRuntime=o,this.startReceivingSignalUpdates(),(a=this._synchronizer)===null||a===void 0||a.__dangerouslySetContainerRuntime(o))}setAudience(o){this._audience=o}onReceivedSignal(o,a){var l;a||!o.clientId||!(0,r.isILiveEvent)(o.content)||typeof o.content.data!="object"||(this.dispatchUpdates(r.ObjectSynchronizerEvents.update,o.clientId,o.content.data,a),o.type===r.ObjectSynchronizerEvents.connect&&((l=this._synchronizer)===null||l===void 0||l.onSendBackgroundUpdates()))}dispatchUpdates(o,a,l,c){for(const u in l){const d=l[u],h={clientId:a,timestamp:d.timestamp,data:(0,r.cloneValue)(d.data),name:o};this.updateEventLocallyInStore(u,h)&&this.emit(r.ObjectSynchronizerEvents.update,u,(0,r.cloneValue)(h),c)}}updateEventLocallyInStore(o,a){let l=this.objectStoreMap.get(o);if(l){const c=l.get(a.clientId);if(c&&!t.LiveEvent.isNewer(c,a))return!1;l.set(a.clientId,a),c||this.emitJoined(o,a)}else l=new Map,l.set(a.clientId,a),this.objectStoreMap.set(o,l),this.emitJoined(o,a);return!0}emitJoined(o,a){this.emit("joined",{objectId:o,clientId:a.clientId,timestamp:a.timestamp})}startReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this.stopReceivingSignalUpdates(),this._onBoundReceivedSignalListener=this.onReceivedSignal.bind(this),this._containerRuntime.on("signal",this._onBoundReceivedSignalListener)}stopReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this._containerRuntime.off("signal",this._onBoundReceivedSignalListener)}};return ml.LiveObjectManager=i,ml}var gl={},vl={},Hr={},c1;function wo(){if(c1)return Hr;c1=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.LiveDataObjectInitializeNotNeededError=Hr.LiveDataObjectNotInitializedError=Hr.UnexpectedError=void 0;const n=Jn(),e=Kn;class t extends Error{constructor(o,a){super(`${o} - ${a}
Please report this issue at ${n.LiveShareReportIssueLink}.`)}static assert(o,a,l){if(!o)throw new t(a,l)}}Hr.UnexpectedError=t;class r extends Error{constructor(o,a,l){super(`${o} - not initialized prior to calling \`${a}()\`. \`initializeState\` is \`${l}\` but must equal \`succeeded\`.
To fix this error, ensure \`.initialize()\` has resolved before calling this function.`)}static assert(o,a,l){if(l!==e.LiveDataObjectInitializeState.succeeded)throw new r(o,a,l)}}Hr.LiveDataObjectNotInitializedError=r;class i extends Error{constructor(o,a){super(`${o} -  initialization is not needed. \`initializeState\` is \`${a}\` but must equal \`needed\`.
To fix this error, ensure you only call \`.initialize()\` when \`initializeState\` equals \`needed\`.`)}static assert(o,a){if(a!==e.LiveDataObjectInitializeState.needed)throw new i(o,a)}}return Hr.LiveDataObjectInitializeNotNeededError=i,Hr}var u1;function fQ(){if(u1)return vl;u1=1;var n=G&&G.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(vl,"__esModule",{value:!0}),vl.ThrottledEventQueue=void 0;const e=au,t=Ar,r=wo();let i=class{constructor(o,a=50){this._events={},this._containerSynchronizer=o,this._throttleIntervalMilli=a}sendWithQueue(o,a){return n(this,void 0,void 0,function*(){this._events[o]=a,this._hTimer||(this._deferred=new e.Deferred,this._hTimer=setTimeout(()=>n(this,void 0,void 0,function*(){var c,u;try{const d=yield this._containerSynchronizer.sendEventUpdates(this._events,t.ObjectSynchronizerEvents.update);r.UnexpectedError.assert(!!d,"ThrottledEventQueue","unable to send empty set of updates, which should not occur."),(c=this._deferred)===null||c===void 0||c.resolve(d)}catch(d){(u=this._deferred)===null||u===void 0||u.reject(d)}finally{this._events={},this._hTimer=void 0}}),this._throttleIntervalMilli)),r.UnexpectedError.assert(!!this._deferred,"ThrottledEventQueue","no deferred set, which should not occur.");const l=yield this._deferred.promise;return{clientId:l.clientId,timestamp:l.data[o].timestamp,name:l.name,data:l.data[o].data}})}};return vl.ThrottledEventQueue=i,vl}var d1;function pQ(){if(d1)return gl;d1=1;var n=G&&G.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(gl,"__esModule",{value:!0}),gl.ContainerSynchronizer=void 0;const e=fQ(),t=Ar,r=Ke;let i=class{constructor(o,a,l,c){this._runtime=o,this._containerRuntime=a,this._liveRuntime=l,this._objectStore=c,this._objects=new Map,this._throttledEventsQueue=new e.ThrottledEventQueue(this),this._connectedKeys=[],this._ddsBackgroundUpdateEnabled=new Set,this.startListeningForConnected()}registerObject(o,a,l){var c;if(this._objects.has(o))throw new Error(`LiveObjectSynchronizer: too many calls to registerObject() for object '${o}'`);this._connectedKeys.push(o),this._objects.set(o,a),this._runtime.clientId&&this._runtime.clientId!==this._connectSentForClientId&&this.onConnected(this._runtime.clientId),(c=this._objectStore.getEventsForObject(o))===null||c===void 0||c.forEach(u=>{this.onReceiveUpdate(o,u,u.clientId===this._runtime.clientId)}),l&&(this._ddsBackgroundUpdateEnabled.add(o),this._ddsBackgroundUpdateEnabled.size==1&&this.startBackgroundObjectUpdates())}unregisterObject(o){return this._objects.has(o)&&(this._objects.delete(o),this._connectedKeys=this._connectedKeys.filter(l=>l!=o),this._ddsBackgroundUpdateEnabled.has(o)&&(this._ddsBackgroundUpdateEnabled.delete(o),this._ddsBackgroundUpdateEnabled.size==0))?(this.stopBackgroundObjectUpdates(),!0):!1}onSendBackgroundUpdates(){return n(this,void 0,void 0,function*(){this._liveRuntime.canSendBackgroundUpdates&&(yield this.sendGroupEvent(this._connectedKeys.filter(o=>this._ddsBackgroundUpdateEnabled.has(o)),t.ObjectSynchronizerEvents.update).catch(o=>console.error(o)))})}sendEventForObject(o,a){return n(this,void 0,void 0,function*(){const l=this._objects.get(o);if(!l)throw new Error("ContainerSynchronizer.sendEventForObject(): cannot send an event for an object that is not registered");if(!(yield l.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");const u=yield this.sendEventUpdates({[o]:{data:a,timestamp:this._liveRuntime.getTimestamp()}},t.ObjectSynchronizerEvents.update);if(!u)throw new Error("Unable to send an event with empty updates");return{clientId:u.clientId,timestamp:u.data[o].timestamp,name:u.name,data:u.data[o].data}})}sendThrottledEventForObject(o,a){return n(this,void 0,void 0,function*(){const l=this._objects.get(o);if(!l)throw new Error("ContainerSynchronizer.sendThrottledEventForObject(): cannot send an event for an object that is not registered");if(!(yield l.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");return yield this._throttledEventsQueue.sendWithQueue(o,{data:a,timestamp:this._liveRuntime.getTimestamp()})})}sendEventUpdates(o,a){return n(this,void 0,void 0,function*(){if(Object.keys(o).length>0){const c={clientId:yield this.waitUntilConnected(),data:o,timestamp:a===t.ObjectSynchronizerEvents.connect?0:this._liveRuntime.getTimestamp(),name:a};return this._containerRuntime.submitSignal(a,c),c}})}__dangerouslySetContainerRuntime(o){this._containerRuntime!==o&&(this._containerRuntime=o)}onConnected(o){return n(this,void 0,void 0,function*(){if(o!==this._connectSentForClientId){this._connectSentForClientId&&this._objectStore.clientIdDidChange(this._connectSentForClientId,o),this._connectSentForClientId=o,this._liveRuntime.host.registerClientId(o).catch(a=>{console.error(a)});try{yield this.sendGroupEvent(this._connectedKeys,t.ObjectSynchronizerEvents.connect)}catch(a){console.error(`LiveObjectSynchronizer: error sending update - ${a.toString()}`)}}})}sendGroupEvent(o,a){return n(this,void 0,void 0,function*(){const l=[],c={},u=yield this.waitUntilConnected();for(let h=0;h<o.length;h++){const f=o[h];try{const p=this._objects.get(f);if(p&&(yield p.getLocalUserCanSend(a===t.ObjectSynchronizerEvents.connect))){const g=this._objectStore.getLatestEventForObjectClient(f,u);if(typeof g=="object"){c[f]={data:g.data,timestamp:p.shouldUpdateTimestampPeriodically?this._liveRuntime.getTimestamp():a===t.ObjectSynchronizerEvents.connect?0:g.timestamp};continue}}}catch(p){console.error(`LiveObjectSynchronizer: error getting an objects state - ${p.toString()}`)}l.push(f)}const d=Object.keys(c);return yield this.sendEventUpdates(c,a),{sent:d,skipped:l}})}onReceiveUpdate(o,a,l){return n(this,void 0,void 0,function*(){const c=this._objects.get(o);!c||!(yield c.updateState(a,a.clientId,l))||this._objectStore.updateEventLocallyInStore.bind(this._objectStore)(o,Object.assign(Object.assign({},a),{clientId:yield this.waitUntilConnected()}))})}waitUntilConnected(){return(0,r.waitUntilConnected)(this._runtime)}startListeningForConnected(){this._onBoundConnectedListener&&this.stopListeningForConnected(),this._onBoundConnectedListener=this.onConnected.bind(this),this._runtime.on("connected",this._onBoundConnectedListener)}stopListeningForConnected(){this._onBoundConnectedListener&&this._runtime.off("connected",this._onBoundConnectedListener)}startBackgroundObjectUpdates(){this.stopBackgroundObjectUpdates(),this._onReceiveObjectUpdateListener=this.onReceiveUpdate.bind(this),this._objectStore.on(t.ObjectSynchronizerEvents.update,this._onReceiveObjectUpdateListener),this._onSendUpdatesIntervalCallback=this.onSendBackgroundUpdates.bind(this),this._hTimer=setInterval(this._onSendUpdatesIntervalCallback,this._liveRuntime.objectManager.updateInterval)}stopBackgroundObjectUpdates(){this._hTimer&&(clearInterval(this._hTimer),this._hTimer=void 0,this._onSendUpdatesIntervalCallback=void 0),this._onReceiveObjectUpdateListener&&(this._objectStore.off("update",this._onReceiveObjectUpdateListener),this._onReceiveObjectUpdateListener=void 0)}};return gl.ContainerSynchronizer=i,gl}var If={},mQ=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(If,"__esModule",{value:!0});If.FormatFixHostDecorator=void 0;const gQ=Ka,rN=Ot;class vQ extends gQ.BaseHostDecorator{getClientInfo(e){return mQ(this,void 0,void 0,function*(){const t=yield this._host.getClientInfo(e);if((0,rN.isIClientInfo)(e))return t;const r=yQ(t);return r||t})}}If.FormatFixHostDecorator=vQ;function yQ(n){if(n instanceof Object){let e,t,r;if(Object.keys(n).map(i=>n[i]).forEach(i=>{(0,rN.isClientRolesResponse)(i)?t=i:SQ(i)?e=i:typeof i=="string"&&(r=i)}),e&&t)return{userId:e,roles:t,displayName:r}}}function SQ(n){return typeof n=="string"?/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/.test(n):!1}var h1;function Jn(){return h1||(h1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=G&&G.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=G&&G.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Ar,n),t(vf,n),t(Ga,n),t(yf,n),t(Ke,n),t(Nf,n),t(Lf,n),t(au,n),t(Ot,n),t(nN,n),t(hQ(),n),t(pQ(),n),t(If,n)}(km)),km}var f1;function iN(){if(f1)return pl;f1=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=G&&G.__awaiter||function(o,a,l,c){function u(d){return d instanceof l?d:new l(function(h){h(d)})}return new(l||(l=Promise))(function(d,h){function f(S){try{g(c.next(S))}catch(m){h(m)}}function p(S){try{g(c.throw(S))}catch(m){h(m)}}function g(S){S.done?d(S.value):u(S.value).then(f,p)}g((c=c.apply(o,a||[])).next())})},e=G&&G.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(pl,"__esModule",{value:!0}),pl.LiveEventScope=void 0;const t=e(pn),r=Wa,i=Jn();let s=class extends r.TypedEventEmitter{constructor(a,l,c){super(),this._liveRuntime=l,this.emitter=new t.default,this.throwForEvents=[],this._runtime=a,this._allowedRoles=c||[],this.emitter.on("error",u=>{this.emit("error",u)}),this._runtime.on("signal",(u,d)=>{if(!u.clientId||!this._runtime.connected)return;const h=u.clientId;u.content.clientId=h,this.emitToListeners(h,u.content,d)})}get allowedRoles(){return this._allowedRoles}set allowedRoles(a){this._allowedRoles=a}get clientId(){return this._runtime.clientId}onEvent(a,l){return this.throwForEvents.push(a),this.emitter.on(a,l),this}offEvent(a,l){this.emitter.off(a,l);const c=this.throwForEvents.indexOf(a);return c>=0&&this.throwForEvents.splice(c,1),this}sendEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.createEvent(a,l);return this._runtime.submitSignal(a,c),c})}sendLocalEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.createEvent(a,l);return this.emitToListeners(c.clientId,c,!0),c})}createEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.waitUntilConnected();if(!(yield this._liveRuntime.verifyRolesAllowed(c,this._allowedRoles)))throw new Error(`The local user doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`);return{clientId:c,name:a,timestamp:this._liveRuntime.getTimestamp(),data:l}})}waitUntilConnected(){return(0,i.waitUntilConnected)(this._runtime)}emitToListeners(a,l,c){this._liveRuntime.verifyRolesAllowed(a,this._allowedRoles).then(u=>{u?this.emitter.emit(l.name,l,c):this.throwForEvents.includes(l.name)&&this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},new Error(`The clientId of "${a}" doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`))}).catch(u=>{this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},u)})}};return pl.LiveEventScope=s,pl}var lu={},cu={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var p1=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(cu,"__esModule",{value:!0});cu.LiveEventSource=void 0;class bQ{constructor(e,t){this._scope=e,this._eventName=t}sendEvent(e){return p1(this,void 0,void 0,function*(){return yield this._scope.sendEvent(this._eventName,e)})}sendLocalEvent(e){return p1(this,void 0,void 0,function*(){return yield this._scope.sendLocalEvent(this._eventName,e)})}}cu.LiveEventSource=bQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(lu,"__esModule",{value:!0});lu.LiveEventTarget=void 0;const wQ=cu;class CQ extends wQ.LiveEventSource{constructor(e,t,r){super(e,t),e.onEvent(t,r)}}lu.LiveEventTarget=CQ;var yl={},m1;function Ja(){if(m1)return yl;m1=1;var n=G&&G.__awaiter||function(o,a,l,c){function u(d){return d instanceof l?d:new l(function(h){h(d)})}return new(l||(l=Promise))(function(d,h){function f(S){try{g(c.next(S))}catch(m){h(m)}}function p(S){try{g(c.throw(S))}catch(m){h(m)}}function g(S){S.done?d(S.value):u(S.value).then(f,p)}g((c=c.apply(o,a||[])).next())})};Object.defineProperty(yl,"__esModule",{value:!0}),yl.LiveDataObject=void 0;const e=Va,t=Wa,r=Kn,i=Jn();let s=class extends e.DataObject{get liveRuntime(){return(0,t.assert)(this._liveRuntime!==null,`LiveShareRuntime not initialized. Ensure your Fluid \`ContainerSchema\` was first wrapped inside of \`getLiveContainerSchema()\` before calling \`client.getContainer()\` / \`client.createContainer()\` from your \`AzureClient\` (or equivalent) instance.
Alternatively, you can use the \`.joinContainer()\` in \`LiveShareClient\`, which does this for you.
If you are using \`LiveShareClient\` and are still encountering this issue, please report this issue at ${i.LiveShareReportIssueLink}.`),this._liveRuntime}get isInitialized(){return this.initializeState===r.LiveDataObjectInitializeState.succeeded}get initializeState(){return this._initializeState}set initializeState(a){this._initializeState=a}constructor(a){super(a),this._initializeState=r.LiveDataObjectInitializeState.needed,this._allowedRoles=[],this._liveRuntime=null}getClientInfo(a){return this.liveRuntime.getClientInfo(a)}waitUntilConnected(){return(0,i.waitUntilConnected)(this.runtime)}verifyLocalUserRoles(){var a;return n(this,void 0,void 0,function*(){const l=yield this.waitUntilConnected();return this.liveRuntime.verifyRolesAllowed(l,(a=this._allowedRoles)!==null&&a!==void 0?a:[])})}__dangerouslySetLiveRuntime(a){this._liveRuntime=a}onLocalUserAllowed(a){return n(this,void 0,void 0,function*(){(yield this.verifyLocalUserRoles())&&a()})}};return s.LiveEnabled=!0,yl.LiveDataObject=s,yl}var g1;function Qa(){return g1||(g1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=G&&G.__awaiter||function(h,f,p,g){function S(m){return m instanceof p?m:new p(function(v){v(m)})}return new(p||(p=Promise))(function(m,v){function y(T){try{w(g.next(T))}catch(E){v(E)}}function b(T){try{w(g.throw(T))}catch(E){v(E)}}function w(T){T.done?m(T.value):S(T.value).then(y,b)}w((g=g.apply(h,f||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveEvent=n.LiveEventEvents=void 0;const t=Va,r=Kn,i=iN(),s=lu,o=yi,a=Ja(),l=Jn(),c=wo();var u;(function(h){h.received="received"})(u=n.LiveEventEvents||(n.LiveEventEvents={}));class d extends a.LiveDataObject{initialize(f){c.LiveDataObjectInitializeNotNeededError.assert("LiveEvent:initialize",this.initializeState),this.initializeState=r.LiveDataObjectInitializeState.pending,this._allowedRoles=f??[];const p=new i.LiveEventScope(this.runtime,this.liveRuntime,f);return this._eventTarget=new s.LiveEventTarget(p,"event",(g,S)=>{this.emit(u.received,(0,l.cloneValue)(g.data),S,g.clientId,g.timestamp)}),this.initializeState=r.LiveDataObjectInitializeState.succeeded,Promise.resolve()}send(f){return e(this,void 0,void 0,function*(){return c.LiveDataObjectNotInitializedError.assert("LiveEvent:send","send",this.initializeState),c.UnexpectedError.assert(!!this._eventTarget,"LiveEvent:send","`this._eventTarget` is undefined, implying there was an error during initialization that should not occur."),yield this._eventTarget.sendEvent(f)})}static isNewer(f,p,g=0){if(f){if(f.timestamp==p.timestamp){if((f.clientId||"").localeCompare(p.clientId||"")<=0)return!1}else if(f.timestamp>p.timestamp){if(f.timestamp-p.timestamp>g)return!1}else if(p.timestamp-f.timestamp<g)return!1}return!0}}d.TypeName="@microsoft/live-share:LiveEvent",d.factory=new t.DataObjectFactory(d.TypeName,d,[],{}),n.LiveEvent=d,o.DynamicObjectRegistry.registerObjectClass(d,d.TypeName)}(Pm)),Pm}var Af={},Xa={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Xa,"__esModule",{value:!0});Xa.TimeInterval=void 0;class EQ{constructor(e){this._value=e}get milliseconds(){return this._value}set milliseconds(e){this._value=e}get seconds(){return this._value/1e3}set seconds(e){this._value=Math.floor(e*1e3)}}Xa.TimeInterval=EQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Af,"__esModule",{value:!0});Af.LiveEventTimer=void 0;const _Q=Xa;class TQ{constructor(e,t,r,i=!1){this._isRunning=!1,this._eventSource=e,this._createEvent=t,this._delay=new _Q.TimeInterval(r),this.repeat=i}get delay(){return this._delay.milliseconds}set delay(e){this._delay.milliseconds=e}get isRunning(){return this._isRunning}sendEvent(){const e=this._createEvent();return this._eventSource.sendEvent(e)}start(){this.stop(),this._isRunning=!0,this.delayedEmit(this.delay)}stop(){this._timer!=null&&(clearTimeout(this._timer),this._timer=void 0),this._isRunning=!1}delayedEmit(e){this._timer=setTimeout(()=>{this._timer=void 0;const t=new Date().getTime();if(this.sendEvent().catch(r=>{console.warn(r)}),this._isRunning&&this.repeat){const r=(new Date().getTime()-t)%this.delay;this.delayedEmit(this.delay-r)}},e)}}Af.LiveEventTimer=TQ;var FS={},$m={},Sl={},v1;function xQ(){if(v1)return Sl;v1=1,Object.defineProperty(Sl,"__esModule",{value:!0}),Sl.LivePresenceConnection=void 0;const n=Jn(),e=Qa(),t=Mf();let r=class{constructor(s,o,a,l){this._evt=s,this._isLocalConnection=o,this._expirationPeriod=a,this._liveRuntime=l}get isLocalConnection(){return this._isLocalConnection}get clientId(){return this._evt.clientId}get state(){return this.hasExpired()?t.PresenceState.offline:this._evt.data.state}get data(){return(0,n.cloneValue)(this._evt.data.data)}updateConnection(s){if(this._evt.clientId!==s.clientId)throw new Error("LivePresenceConnection.updateConnection called with event with different clientId");e.LiveEvent.isNewer(this._evt,s)&&(this._evt=s)}set expirationPeriod(s){this._expirationPeriod=s}hasExpired(){const o=this._liveRuntime.getTimestamp()-this._evt.timestamp;return!this._isLocalConnection&&o>this._expirationPeriod.milliseconds}};return Sl.LivePresenceConnection=r,Sl}var y1;function Mf(){return y1||(y1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresenceUser=n.PresenceState=void 0;const e=Qa(),t=Jn(),r=xQ();var i;(function(o){o.online="online",o.away="away",o.offline="offline"})(i=n.PresenceState||(n.PresenceState={}));class s{constructor(a,l,c,u,d){this._clientInfo=a,this._evt=l,this._expirationPeriod=c,this._liveRuntime=u,this._connections=new Map,this._isLocalUser=!1,this.updateClients(this._evt,d),this._lastUpdateTime=this._liveRuntime.getTimestamp()}get isLocalUser(){return this._isLocalUser}get userId(){return this._clientInfo.userId}get displayName(){return this._clientInfo.displayName}get state(){return this.hasExpired()?i.offline:this._evt.data.state}get data(){return(0,t.cloneValue)(this._evt.data.data)}get roles(){return this._clientInfo.roles}getConnections(a){const l=[];return this._connections.forEach(c=>{(a==null||c.state==a)&&l.push(c)}),l}getConnection(a){return this._connections.get(a)}isFromClient(a){return this._connections.get(a)!==void 0}updateReceived(a,l,c){const u=this.updateClients(a,c),d=this._evt,h=this._clientInfo;return e.LiveEvent.isNewer(d,a)?(this._evt=a,this._clientInfo=l,this._lastUpdateTime=this._liveRuntime.getTimestamp(),u||a.data.state!=d.data.state||JSON.stringify(l)!=JSON.stringify(h)||JSON.stringify(a.data.data)!=JSON.stringify(d.data.data)):u}set expirationPeriod(a){this._expirationPeriod=a,this._connections.forEach(l=>{l.expirationPeriod=a})}hasExpired(){const l=this._liveRuntime.getTimestamp()-this._lastUpdateTime;return!this._isLocalUser&&l>this._expirationPeriod.milliseconds}updateClients(a,l){const c=this._connections.get(a.clientId);return c?(c.updateConnection(a),!1):(this._connections.set(a.clientId,new r.LivePresenceConnection(a,l,this._expirationPeriod,this._liveRuntime)),l&&!this._isLocalUser?(this._isLocalUser=l,!0):!1)}}n.LivePresenceUser=s}($m)),$m}var Co={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Co,"__esModule",{value:!0});Co.LiveObjectSynchronizer=void 0;class OQ{constructor(e,t,r){this.id=e,this.runtime=t,this.liveRuntime=r,this._isDisposed=!1,this._joinedListener=()=>{}}start(e,t,r,i=!1,s=!0){return this.liveRuntime.objectManager.registerObject(this.id,this.runtime,e,{updateState:t,getLocalUserCanSend:r,shouldUpdateTimestampPeriodically:i},s)}dispose(){this._isDisposed||(this._isDisposed=!0,this.liveRuntime.objectManager.unregisterObject(this.id),this.liveRuntime.objectManager.off("joined",this._joinedListener))}getLatestEvent(){return this.liveRuntime.objectManager.getLatestEventForObject(this.id)}getLatestEventForClient(e){return this.liveRuntime.objectManager.getLatestEventForObjectClient(this.id,e)}getEvents(){return this.liveRuntime.objectManager.getEventsForObject(this.id)}sendEvent(e){return this.liveRuntime.objectManager.sendEventForObject(this.id,e)}sendThrottledEvent(e){return this.liveRuntime.objectManager.sendThrottledEventForObject(this.id,e)}set onJoinedListener(e){this.liveRuntime.objectManager.off("joined",this._joinedListener),this._joinedListener=e,this.liveRuntime.objectManager.on("joined",({objectId:t,clientId:r,timestamp:i})=>{t===this.id&&this._joinedListener(r,i)})}}Co.LiveObjectSynchronizer=OQ;var Eo={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Eo,"__esModule",{value:!0});Eo.LiveTelemetryLogger=void 0;class zS{constructor(e,t){this._liveRuntime=t,this._runtime=e}sendTelemetryEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendTelemetryEvent(i,t)}}sendErrorEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendErrorEvent(i,t)}}sendPerformanceEvent(e,t,r,i){if(this._runtime.logger){const s=Object.assign({duration:t},this.createTelemetryEvent(e,i));this._runtime.logger.sendPerformanceEvent(s,r)}}createTelemetryEvent(e,t){const r=this._liveRuntime.getTimestamp();return Object.assign({eventName:e,clientId:this._runtime.clientId,correlationId:zS.formatCorrelationId(this._runtime.clientId,r),timestamp:r},t)}static formatCorrelationId(e,t){return`${e}:${t}`}}Eo.LiveTelemetryLogger=zS;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=G&&G.__awaiter||function(p,g,S,m){function v(y){return y instanceof S?y:new S(function(b){b(y)})}return new(S||(S=Promise))(function(y,b){function w(O){try{E(m.next(O))}catch(A){b(A)}}function T(O){try{E(m.throw(O))}catch(A){b(A)}}function E(O){O.done?y(O.value):v(O.value).then(w,T)}E((m=m.apply(p,g||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresence=n.LivePresenceEvents=void 0;const t=Va,r=Mf(),i=Co,s=Eo,o=Jn(),a=wo(),l=Xa,c=yi,u=Kn,d=Ja();var h;(function(p){p.presenceChanged="presenceChanged"})(h=n.LivePresenceEvents||(n.LivePresenceEvents={}));class f extends d.LiveDataObject{constructor(){super(...arguments),this._expirationPeriod=new l.TimeInterval(2e4),this._users=[],this._lastEmitPresenceStateMap=new Map}get expirationPeriod(){return this._expirationPeriod.seconds}set expirationPeriod(g){this._expirationPeriod.seconds=g>.1?g:.1,this.getUsers().forEach(S=>{S.expirationPeriod=this._expirationPeriod})}get localUser(){var g;const S=(g=this._currentPresence)===null||g===void 0?void 0:g.clientId;if(S)return this.getUserForClient(S)}initialize(g,S=r.PresenceState.online,m){return e(this,void 0,void 0,function*(){a.LiveDataObjectInitializeNotNeededError.assert("LivePresence:initialize",this.initializeState),a.UnexpectedError.assert(!this._synchronizer,"LivePresence:initialize","_synchronizer already set, which is an unexpected error."),this.initializeState=u.LiveDataObjectInitializeState.pending,this._logger=new s.LiveTelemetryLogger(this.runtime,this.liveRuntime),this._allowedRoles=m||[],this._currentPresence={clientId:yield this.waitUntilConnected(),name:"UpdatePresence",timestamp:0,data:{state:S,data:g}},this._synchronizer=new i.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentPresence.data,(v,y,b)=>e(this,void 0,void 0,function*(){return yield this.updateMembersList(v,b),!1}),v=>e(this,void 0,void 0,function*(){if(v)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}),!0)}catch(v){throw this.initializeState=u.LiveDataObjectInitializeState.fatalError,v}this.initializeState=u.LiveDataObjectInitializeState.succeeded,yield this.updateInternal(this._currentPresence.data.data,this._currentPresence.data.state,!0,!0).catch(()=>{})})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}getUsers(g){return g?this._users.filter(S=>S.state==g):this._users}update(g,S){return e(this,void 0,void 0,function*(){return yield this.updateInternal(g,S)})}getUserForClient(g){return this._users.find(S=>S.isFromClient(g))}getUser(g){return this._users.find(S=>S.userId==g)}updateInternal(g,S,m=!1,v=!1){var y;return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LivePresence:updateInternal","update",this.initializeState),a.UnexpectedError.assert(!!this._synchronizer,"LivePresence:updateInternal","this._synchronizer is undefined, implying there was an error during initialization that should not occur."),a.UnexpectedError.assert(!!this._currentPresence,"LivePresence:updateInternal","this._currentPresence is undefined, implying there was an error during initialization that should not occur.");const b={state:S??this._currentPresence.data.state,data:(y=(0,o.cloneValue)(g))!==null&&y!==void 0?y:this._currentPresence.data.data};if(!v||this.liveRuntime.canSendBackgroundUpdates){const w=m?yield this._synchronizer.sendThrottledEvent(b):yield this._synchronizer.sendEvent(b);yield this.updateMembersList(w,!0)}else{const w={data:b,name:"",clientId:yield this.waitUntilConnected(),timestamp:1};yield this.updateMembersList(w,!0)}})}updateMembersList(g,S){var m;return e(this,void 0,void 0,function*(){try{if(!(yield this.liveRuntime.verifyRolesAllowed(g.clientId,this._allowedRoles)))return!1;S&&(this._currentPresence=g);const y=yield this.liveRuntime.getClientInfo(g.clientId);return y?this.useTransientParticipantWorkaround(y)?this.transientParticipantWorkaround(g,S,y):this.updateMembersListWithInfo(g,S,y):!1}catch(v){(m=this._logger)===null||m===void 0||m.sendErrorEvent(o.TelemetryEvents.LiveState.RoleVerificationError,v)}return!1})}useTransientParticipantWorkaround(g){const S={userId:g.userId,roles:[u.UserMeetingRole.guest],displayName:void 0};return JSON.stringify(g)===JSON.stringify(S)}transientParticipantWorkaround(g,S,m){const v=this._users.find(y=>y.userId===m.userId);if(v){const y={userId:v.userId,roles:v.roles,displayName:v.displayName};return this.updateMembersListWithInfo(g,S,y)}return this.updateMembersListWithInfo(g,S,m)}updateMembersListWithInfo(g,S,m){const v=T=>{var E,O;this._lastEmitPresenceStateMap.set(T.userId,T.state),this.emit(h.presenceChanged,T,S,g.clientId),S?(E=this._logger)===null||E===void 0||E.sendTelemetryEvent(o.TelemetryEvents.LivePresence.LocalPresenceChanged,null,{user:JSON.stringify(g)}):(O=this._logger)===null||O===void 0||O.sendTelemetryEvent(o.TelemetryEvents.LivePresence.RemotePresenceChanged,null,{user:JSON.stringify(g)})};let y=!1,b=!0;for(let T=0;T<this._users.length;T++){const E=this._users[T];m.userId===E.userId?(E.updateReceived(g,m,S)&&(v(E),y=!0),b=!1):this._lastEmitPresenceStateMap.get(E.userId)!==E.state&&(v(E),y=!0)}if(!b)return y;const w=new r.LivePresenceUser(m,g,this._expirationPeriod,this.liveRuntime,S);return this._users.push(w),v(w),!0}}f.TypeName="@microsoft/live-share:LivePresence",f.factory=new t.DataObjectFactory(f.TypeName,f,[],{}),n.LivePresence=f,c.DynamicObjectRegistry.registerObjectClass(f,f.TypeName)})(FS);var sN={},$S={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=G&&G.__awaiter||function(p,g,S,m){function v(y){return y instanceof S?y:new S(function(b){b(y)})}return new(S||(S=Promise))(function(y,b){function w(O){try{E(m.next(O))}catch(A){b(A)}}function T(O){try{E(m.throw(O))}catch(A){b(A)}}function E(O){O.done?y(O.value):v(O.value).then(w,T)}E((m=m.apply(p,g||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveState=n.LiveStateEvents=void 0;const t=Va,r=Wa,i=Kn,s=Jn(),o=wo(),a=Eo,l=Qa(),c=Co,u=yi,d=Ja();var h;(function(p){p.stateChanged="stateChanged"})(h=n.LiveStateEvents||(n.LiveStateEvents={}));class f extends d.LiveDataObject{get state(){return this.latestEvent.data}initialize(g,S){return e(this,void 0,void 0,function*(){o.LiveDataObjectInitializeNotNeededError.assert("LiveState:initialize",this.initializeState),o.UnexpectedError.assert(!this._synchronizer,"LiveState:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._logger=new a.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.latestEvent={clientId:"",name:"ChangeState",timestamp:0,data:g},this._allowedRoles=S||[],this._synchronizer=new c.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(g,(m,v,y)=>e(this,void 0,void 0,function*(){return yield this.onReceivedStateEvent(m,v,y)}),m=>e(this,void 0,void 0,function*(){if(m)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(m){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,m}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}set(g){return e(this,void 0,void 0,function*(){o.LiveDataObjectNotInitializedError.assert("LiveState:set","set",this.initializeState);const S=(0,s.cloneValue)(g),m=yield this._synchronizer.sendEvent(S);this.updateState(m,!0)})}get latestEvent(){return(0,r.assert)(this._latestEvent!==void 0,"LiveState is not initialized"),this._latestEvent}set latestEvent(g){this._latestEvent=g}onReceivedStateEvent(g,S,m){var v;return e(this,void 0,void 0,function*(){try{return!(yield this.liveRuntime.verifyRolesAllowed(S,this._allowedRoles))||!l.LiveEvent.isNewer(this.latestEvent,g)||JSON.stringify(this.latestEvent.data)===JSON.stringify(g.data)?!1:(this.updateState(g,m),!0)}catch(y){return(v=this._logger)===null||v===void 0||v.sendErrorEvent(s.TelemetryEvents.LiveState.RoleVerificationError,y),!1}})}updateState(g,S){var m;const v=this.latestEvent.data,y=g.data;this.latestEvent=g,this.emit(h.stateChanged,(0,s.cloneValue)(g.data),S,g.clientId,g.timestamp),(m=this._logger)===null||m===void 0||m.sendTelemetryEvent(s.TelemetryEvents.LiveState.StateChanged,null,{oldState:JSON.stringify(v),newState:JSON.stringify(y)})}}f.TypeName="@microsoft/live-share:LiveState",f.factory=new t.DataObjectFactory(f.TypeName,f,[],{}),n.LiveState=f,u.DynamicObjectRegistry.registerObjectClass(f,f.TypeName)})($S);(function(n){var e=G&&G.__awaiter||function(S,m,v,y){function b(w){return w instanceof v?w:new v(function(T){T(w)})}return new(v||(v=Promise))(function(w,T){function E(F){try{A(y.next(F))}catch(X){T(X)}}function O(F){try{A(y.throw(F))}catch(X){T(X)}}function A(F){F.done?w(F.value):b(F.value).then(E,O)}A((y=y.apply(S,m||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveFollowMode=n.FollowModeType=n.LiveFollowModeEvents=void 0;const t=Ja(),r=$S,i=FS,s=Va,o=Wa,a=Kn,l=Eo,c=Mf(),u=yi,d=wo();(function(S){S.stateChanged="stateChanged",S.presenceChanged="presenceChanged"})(n.LiveFollowModeEvents||(n.LiveFollowModeEvents={}));var h;(function(S){S.local="local",S.activeFollowers="activeFollowers",S.activePresenter="activePresenter",S.followPresenter="followPresenter",S.suspendFollowPresenter="suspendFollowPresenter",S.followUser="followUser",S.suspendFollowUser="suspendFollowUser"})(h=n.FollowModeType||(n.FollowModeType={}));const f="@microsoft/live-share:LiveFollowMode:LiveState",p="@microsoft/live-share:LiveFollowMode:LivePresence";class g extends t.LiveDataObject{constructor(){super(...arguments),this._suspended=!1}get state(){const m=this.presence.localUser;if(!m||!m.data)return;const v=this.presentingUserIdState.state?this.presence.getUser(this.presentingUserIdState.state):void 0;if(v&&v.data){const w=this.getUsers(c.PresenceState.online).length-1;return v.isLocalUser?{value:v.data.stateValue,followingUserId:v.userId,type:h.activePresenter,otherUsersCount:w,isLocalValue:!0}:this._suspended?{value:m.data.stateValue,followingUserId:v.userId,type:h.suspendFollowPresenter,otherUsersCount:w-1,isLocalValue:!0}:{value:v.data.stateValue,followingUserId:v.userId,type:h.followPresenter,otherUsersCount:w-1,isLocalValue:!1}}const y=m.data.followingUserId?this.presence.getUser(m.data.followingUserId):void 0;if(y&&y.data){const w=this.getUserFollowers(y.userId,c.PresenceState.online).length-1;return this._suspended?{value:m.data.stateValue,followingUserId:y.userId,type:h.suspendFollowUser,otherUsersCount:w,isLocalValue:!0}:{value:y.data.stateValue,followingUserId:y.userId,type:h.followUser,otherUsersCount:w,isLocalValue:!1}}const b=this.getUserFollowers(m.userId,c.PresenceState.online).length;return b>0?{value:m.data.stateValue,followingUserId:m.userId,type:h.activeFollowers,otherUsersCount:b,isLocalValue:!0}:{value:m.data.stateValue,followingUserId:m.userId,type:h.local,otherUsersCount:this.getUserFollowers(m.userId,c.PresenceState.online).length,isLocalValue:!0}}get localUser(){return this.presence.localUser}get presentingUserIdState(){return d.UnexpectedError.assert(this._presentingUserIdState!==void 0,"LiveFollowMode:presentingUserIdState","This happens when `hasInitialized()` has not yet resolved, which should not happen."),this._presentingUserIdState}get presence(){return(0,o.assert)(this._presence!==void 0,"_presence not initialized"),this._presence}initialize(m,v){return e(this,void 0,void 0,function*(){d.LiveDataObjectInitializeNotNeededError.assert("LiveFollowMode:initialize",this.initializeState),this.initializeState=a.LiveDataObjectInitializeState.pending,this._logger=new l.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.presentingUserIdState.on("stateChanged",(y,b,w)=>{this._suspended=!1,this.handlePotentialStateChange(b,w)}),this.presence.on("presenceChanged",(y,b,w)=>{this.handlePotentialStateChange(b,w),this.emit("presenceChanged",y,b,w)});try{yield Promise.all([this.presentingUserIdState.initialize(void 0,v),this.presence.initialize({stateValue:m,followingUserId:void 0})])}catch(y){throw this.initializeState=a.LiveDataObjectInitializeState.fatalError,y}this.initializeState=a.LiveDataObjectInitializeState.succeeded})}update(m){var v;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:update","update",this.initializeState),d.UnexpectedError.assert(!!(!((v=this.presence.localUser)===null||v===void 0)&&v.data),"LiveFollowMode:update","invalid local user's current state value when calling `.update()`, implying there was an error during initialization that should not occur."),yield this.presence.update({stateValue:m,followingUserId:this.presence.localUser.data.followingUserId})})}startPresenting(){var m;return e(this,void 0,void 0,function*(){if(d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:startPresenting","startPresenting",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:startPresenting","invalid local user's current state value when calling `.startPresenting()`, implying there was an error during initialization that should not occur."),this.presence.localUser.userId===this.presentingUserIdState.state)throw new Error("LiveFollowMode:startPresenting - the local user is already the active presenter. To stop presenting, use the `.stopPresenting()` function.");yield this.presentingUserIdState.set(this.presence.localUser.userId)})}stopPresenting(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopPresenting","stopPresenting",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:stopPresenting","invalid local user's current state value when calling `.stopPresenting()`, implying there was an error during initialization that should not occur."),yield this.presentingUserIdState.set(void 0)})}beginSuspension(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:beginSuspension","beginSuspension",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:beginSuspension","invalid local user's current state value when calling `.beginSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!0,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}endSuspension(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:endSuspension","endSuspension",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:endSuspension","invalid local user's current state value when calling `.endSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!1,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}followUser(m){var v;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:followUser","followUser",this.initializeState),d.UnexpectedError.assert(!!(!((v=this.presence.localUser)===null||v===void 0)&&v.data),"LiveFollowMode:followUser","invalid local user's current state value when calling `.followUser()`, implying there was an error during initialization that should not occur.");const y=this.presence.getUser(m);if(!y)throw new Error(`LiveFollowMode:followUser - cannot find user for provided \`userId\` of ${m}. Ensure remote user for this userId has also called \`.initialize()\`.`);if(y.isLocalUser)throw new Error("LiveFollowMode:followUser - local user cannot follow themselves. If you are trying to stop following another user, instead use the `.stopFollowing()` function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:m})})}stopFollowing(){var m;return e(this,void 0,void 0,function*(){if(d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopFollowing","stopFollowing",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:stopFollowing","invalid local user's current state value when calling `.stopFollowing()`, implying there was an error during initialization that should not occur."),!this.presence.localUser.data.followingUserId)throw new Error("LiveFollowMode:stopFollowing - the local user is not following another user.\nTo fix this error, ensure that `.followUser()` has resolved before calling this function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:void 0})})}getUsers(m){return this.presence.getUsers(m)}getUser(m){return this.presence.getUser(m)}getUserForClient(m){return this.presence.getUserForClient(m)}getUserFollowers(m,v){return this.getUsers(v).filter(b=>{var w;return((w=b.data)===null||w===void 0?void 0:w.followingUserId)===m})}dispose(){super.dispose(),this.presence.dispose(),this.presentingUserIdState.dispose()}initializingFirstTime(){return e(this,void 0,void 0,function*(){const m=r.LiveState.factory.createChildInstance(this.context),v=i.LivePresence.factory.createChildInstance(this.context);try{const[y,b]=yield Promise.all([m,v]);this.root.set(f,y.handle),this.root.set(p,b.handle)}catch(y){console.log(y)}})}hasInitialized(){return e(this,void 0,void 0,function*(){const m=this.root.get(f),v=this.root.get(p),[y,b]=yield Promise.all([m==null?void 0:m.get(),v==null?void 0:v.get()]);y==null||y.__dangerouslySetLiveRuntime(this.liveRuntime),b==null||b.__dangerouslySetLiveRuntime(this.liveRuntime),this._presentingUserIdState=y,this._presence=b})}handlePotentialStateChange(m,v){const y=this.state;JSON.stringify(y)!==JSON.stringify(this._recentState)&&(this._recentState=y,this.emit("stateChanged",y,m,v))}}g.TypeName="@microsoft/live-share:LiveFollowMode",g.factory=new s.DataObjectFactory(g.TypeName,g,[],{},new Map([r.LiveState.factory.registryEntry,i.LivePresence.factory.registryEntry])),n.LiveFollowMode=g,u.DynamicObjectRegistry.registerObjectClass(g,g.TypeName)})(sN);var Df={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class oN extends Sk{createServiceMember(e){const t=e.user;return er((t==null?void 0:t.name)!==void 0,'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Vv;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(Vv||(Vv={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ph;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(ph||(ph={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function kc(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ff(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const aN=(n,e)=>lN.from(n,e).buffer;function S1(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let lN=class Ls extends Uint8Array{toString(e){return Ff(this,e)}static from(e,t,r){if(typeof e=="string")return Ls.fromString(e,t);if(e!==null&&typeof e=="object"&&S1(e.buffer))return kc(e.byteOffset===0,0),kc(e.byteLength===e.buffer.byteLength,1),Ls.fromArrayBuffer(e.buffer,t,r);if(S1(e))return Ls.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ls(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Ls(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ls(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const PQ=n=>lN.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class RQ{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const kQ=2e3;class NQ{constructor(e,t,r,i){this.tenantId=e,this.id=t,this.deltaStorageService=r,this.documentStorageService=i,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,r,i,s){return i?P5:O5(this.getCore.bind(this),1,e,t,kQ,new RQ,r,s)}async getCore(e,t){const r=this.logtailSha?await mt(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,r.length>0){const i=r.filter(s=>s.sequenceNumber>=e);if(i.length>0)return{messages:i,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)}}class LQ{constructor(e,t,r,i=async()=>this.restWrapper,s=()=>this.url){this.url=e,this.restWrapper=t,this.logger=r,this.getRestWrapper=i,this.getDeltaStorageUrl=s}async get(e,t,r,i){return{messages:await ce.timedExecAsync(this.logger,{eventName:"getDeltas",from:r,to:i},async o=>{const a=await this.getRestWrapper(),l=this.getDeltaStorageUrl(),c=await a.get(l,{from:r-1,to:i});return o.end({count:c.length}),c}),partialResult:!1}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Lo extends Error{constructor(e,t,r,i,s){super(t),this.code=e,this.canRetry=r,this.isFatal=i,this.retryAfterMs=s,this.name="NetworkError",this.retryAfter=s!==void 0?s/1e3:void 0}get details(){return this.canRetry===void 0&&this.isFatal===void 0&&this.retryAfterMs===void 0?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function jm(n,e){var t;let r,i,s,o;switch(e&&typeof e=="object"?(r=(t=e.message)!==null&&t!==void 0?t:"Unknown Error",i=e.canRetry,s=e.isFatal,o=e.retryAfter):e&&typeof e=="string"?r=e:r="Unknown Error",n){case 401:case 403:case 404:return new Lo(n,r,!1,!1);case 413:case 422:return new Lo(n,r,i??!1,s??!1,i?o:void 0);case 429:return new Lo(n,r,!0,!1,o);case 500:return new Lo(n,r,i??!0,s??!1,i?o:void 0);case 502:case 503:case 504:return new Lo(n,r,!0,!1,o);default:return new Lo(n,r,!1,!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const qm="x-correlation-id";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qi(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jS(n,e){switch(e){case"base64":return ur(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const IQ=(n,e)=>rr.from(n,e).buffer;function b1(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}class rr extends Uint8Array{toString(e){return jS(this,e)}static from(e,t,r){if(typeof e=="string")return rr.fromString(e,t);if(e!==null&&typeof e=="object"&&b1(e.buffer))return qi(e.byteOffset===0,0),qi(e.byteLength===e.buffer.byteLength,1),rr.fromArrayBuffer(e.buffer,t,r);if(b1(e))return rr.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new rr(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new rr(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new rr(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}}async function AQ(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function MQ(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return ur(n)}}async function DQ(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return QO(()=>import("./hashFileNode-262cd1ec.js"),["assets/hashFileNode-262cd1ec.js","assets/sha256-492b8c35.js"]).then(async i=>i.hashFile(n,e,t));const r=await AQ(n,e);return MQ(r,t)}async function FQ(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=rr.from(t+n.toString());return DQ(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const zQ=n=>rr.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function cN(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Wv;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Wv||(Wv={}));var Fs;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Fs||(Fs={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var zn;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(zn||(zn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const $Q="@fluidframework/server-services-client",jQ="0.1036.5002";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Us=tv.debug("fluid:services-client");Us(`Package: ${$Q} - Version: ${jQ}`);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class w1{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(e,t){const r=await this.historian.getHeader(t);for(const i of r.blobs)this.blobCache.set(i.sha,i);return N0(r.tree)}async getFullTree(e){return this.historian.getFullTree(e)}async getCommit(e){return this.commitCache.has(e)?(Us(`Cache hit on ${e}`),this.commitCache.get(e)):this.historian.getCommit(e)}async getCommits(e,t){let r=e;if(this.refCache.has(e)&&(Us(`Commit cache hit on ${e}`),r=this.refCache.get(e),this.refCache.delete(e),!r))return[];if(this.commitCache.has(r)){const i=this.commitCache.get(r);return[{commit:{author:i.author,committer:i.committer,message:i.message,tree:i.tree,url:i.url},parents:i.parents,sha:i.sha,url:i.url}]}return this.historian.getCommits(r,t)}async getTree(e,t=!0){return this.treeCache.has(e)?(Us(`Tree cache hit on ${e}`),this.treeCache.get(e)):this.historian.getTree(e,t)}async getBlob(e){return this.blobCache.has(e)?(Us(`Blob cache hit on ${e}`),this.blobCache.get(e)):this.historian.getBlob(e)}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}async getContent(e,t){return this.historian.getContent(t,e)}async createBlob(e,t){const r={content:e,encoding:t};return this.historian.createBlob(r)}async createGitTree(e){return this.historian.createTree(e)}async createTree(e){return this.createTreeCore(e,0)}async createCommit(e){return this.historian.createCommit(e)}async createSummary(e){return this.historian.createSummary(e)}async deleteSummary(e){return this.historian.deleteSummary(e)}async getSummary(e){return this.historian.getSummary(e)}async getRef(e){return this.historian.getRef(`heads/${e}`).catch(t=>{if(t===400||t===404)return null;throw t})}async createRef(e,t){const r={ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}};return this.historian.createRef(r)}async upsertRef(e,t){const r={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef(`heads/${e}`,r)}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}async write(e,t,r,i){const s=await this.createTree(t),o={author:{date:new Date().toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:r,tree:s.sha},a=await this.historian.createCommit(o);return await this.getRef(e)?await this.upsertRef(e,a.sha):await this.createRef(e,a.sha),a}async createTreeCore(e,t){if(e.id)return this.getTree(e.id);const r=[];for(const l of e.entries)switch(Fs[l.type]){case Fs.Blob:{const c=l.value;l.mode===Wv.Symlink&&(c.contents=this.translateSymlink(c.contents,t));const u=this.createBlob(c.contents,c.encoding);r.push(u);break}case Fs.Tree:{const c=l.value,u=this.createTreeCore(c,t+1);r.push(u);break}default:throw new Error("Unknown entry type")}const i=await Promise.all(r),s=[];qi(i.length===e.entries.length,"File entries length is not correct");for(let l=0;l<e.entries.length;l++){const c=e.entries[l].type===Fs.Tree?"tree":e.entries[l].type===Fs.Blob?"blob":"commit";s.push({mode:e.entries[l].mode,path:e.entries[l].path,sha:i[l].sha,type:c})}const o={tree:s};return this.historian.createTree(o)}translateSymlink(e,t){let r="";for(let i=0;i<=t;i++)r+="../";return`${r}${e}`}}var bl=function(n){switch(typeof n){case"string":return n;case"boolean":return n?"true":"false";case"number":return isFinite(n)?n:"";default:return""}},qQ=function(n,e,t,r){return e=e||"&",t=t||"=",n===null&&(n=void 0),typeof n=="object"?Object.keys(n).map(function(i){var s=encodeURIComponent(bl(i))+t;return Array.isArray(n[i])?n[i].map(function(o){return s+encodeURIComponent(bl(o))}).join(e):s+encodeURIComponent(bl(n[i]))}).filter(Boolean).join(e):r?encodeURIComponent(bl(r))+t+encodeURIComponent(bl(n)):""},uN;uN=qQ;var Gv={exports:{}};(function(n,e){e=n.exports=t,e.getSerialize=r;function t(i,s,o,a){return JSON.stringify(i,r(s,a),o)}function r(i,s){var o=[],a=[];return s==null&&(s=function(l,c){return o[0]===c?"[Circular ~]":"[Circular ~."+a.slice(0,o.indexOf(c)).join(".")+"]"}),function(l,c){if(o.length>0){var u=o.indexOf(this);~u?o.splice(u+1):o.push(this),~u?a.splice(u,1/0,l):a.push(l),~o.indexOf(c)&&(c=s.call(this,l,c))}else o.push(c);return i==null?c:i.call(this,l,c)}}})(Gv,Gv.exports);var BQ=Gv.exports;const Kv=pi(BQ);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class dN{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=r,this.maxContentLength=i}async get(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(i,200)}async post(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(r)}`};return this.request(s,201)}async delete(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(i,204)}async patch(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(r)}`};return this.request(s,200)}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),r=uN(t);if(r!=="")return`?${r}`}return""}}class UQ extends dN{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024,s={},o=_R,a,l,c){super(e,t,r,i),this.defaultHeaders=s,this.axios=o,this.refreshDefaultQueryString=a,this.refreshDefaultHeaders=l,this.getCorrelationId=c}async request(e,t,r=!0){var i,s;const o=Object.assign({},e);return o.headers=this.generateHeaders(o.headers,(s=(i=this.getCorrelationId)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:ot()),new Promise((a,l)=>{this.axios.request(o).then(c=>{a(c.data)}).catch(c=>{var u,d,h,f,p,g,S,m,v,y,b,w,T,E;if(((u=c==null?void 0:c.response)===null||u===void 0?void 0:u.status)===t&&a((d=c==null?void 0:c.response)===null||d===void 0?void 0:d.data),c!=null&&c.config?Us(`[${c.config.method}] request to [${(h=c.config.baseURL)!==null&&h!==void 0?h:""}${(f=c.config.url)!==null&&f!==void 0?f:""}] failed with [${(p=c.response)===null||p===void 0?void 0:p.status}] [${Kv((g=c.response)===null||g===void 0?void 0:g.data,void 0,2)}]`):Us(`request to ${o.url} failed ${c?c.message:""}`),((S=c==null?void 0:c.response)===null||S===void 0?void 0:S.status)===429&&((v=(m=c==null?void 0:c.response)===null||m===void 0?void 0:m.data)===null||v===void 0?void 0:v.retryAfter)>0&&r)setTimeout(()=>{this.request(o,t).then(a).catch(l)},c.response.data.retryAfter*1e3);else if(((y=c==null?void 0:c.response)===null||y===void 0?void 0:y.status)===401&&r&&this.refreshOnAuthError()){const O=Object.assign({},e);O.headers=this.generateHeaders(O.headers,o.headers[qm]),this.request(O,t,!1).then(a).catch(l)}else if(c!=null&&c.response)l(jm((b=c==null?void 0:c.response)===null||b===void 0?void 0:b.status,(w=c==null?void 0:c.response)===null||w===void 0?void 0:w.data));else if(c!=null&&c.request)l(jm(502,`Network Error: ${(T=c==null?void 0:c.message)!==null&&T!==void 0?T:"undefined"}`));else{const O={canRetry:!1,isFatal:!1,message:(E=c==null?void 0:c.message)!==null&&E!==void 0?E:"Unknown Error"};l(jm(500,O))}})})}generateHeaders(e,t){let r=e??{};return this.defaultHeaders&&(r=Object.assign(Object.assign({},this.defaultHeaders),e)),r[qm]?r:Object.assign({[qm]:t},r)}refreshOnAuthError(){return this.refreshDefaultQueryString===void 0&&this.refreshDefaultHeaders===void 0?!1:(this.refreshDefaultHeaders!==void 0&&(this.defaultHeaders=this.refreshDefaultHeaders()),this.refreshDefaultQueryString!==void 0&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function HQ(n,e){for(const t of e)if(n.endsWith(t))return!0;return!1}const VQ=n=>`Basic ${zQ(`${n.user}:${n.password}`)}`;class C1{constructor(e,t,r,i){this.endpoint=e,this.historianApi=t,this.restWrapper=i,this.defaultQueryString={},r&&this.historianApi?(this.defaultQueryString.disableCache=r,this.cacheBust=!1):this.cacheBust=r,this.restWrapper===void 0&&(this.restWrapper=new UQ(this.endpoint))}async getHeader(e){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(e)}`,this.getQueryString()):this.getHeaderDirect(e)}async getFullTree(e){return this.restWrapper.get(`/tree/${encodeURIComponent(e)}`,this.getQueryString())}async getBlob(e){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,this.getQueryString())}async createBlob(e){return this.restWrapper.post("/git/blobs",e,this.getQueryString())}async getContent(e,t){return this.restWrapper.get(`/contents/${e}`,this.getQueryString({ref:t}))}async getCommits(e,t){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch(r=>r===400||r===404?[]:Promise.reject(r))}async getCommit(e){return this.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,this.getQueryString())}async createCommit(e){return this.restWrapper.post("/git/commits",e,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(e){return this.restWrapper.get(`/git/refs/${e}`,this.getQueryString())}async createRef(e){return this.restWrapper.post("/git/refs",e,this.getQueryString())}async updateRef(e,t){return this.restWrapper.patch(`/git/refs/${e}`,t,this.getQueryString())}async deleteRef(e){await this.restWrapper.delete(`/git/refs/${e}`,this.getQueryString())}async createTag(e){return this.restWrapper.post("/git/tags",e,this.getQueryString())}async getTag(e){return this.restWrapper.get(`/git/tags/${e}`,this.getQueryString())}async createTree(e){return this.restWrapper.post("/git/trees",e,this.getQueryString())}async getTree(e,t){return this.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,this.getQueryString({recursive:t?1:0}))}async createSummary(e){return this.restWrapper.post("/git/summaries",e,this.getQueryString())}async deleteSummary(e){const t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)}async getSummary(e){return this.restWrapper.get(`/git/summaries/${e}`,this.getQueryString())}async getHeaderDirect(e){const t=await this.getTree(e,!0),r=[".attributes",".blobs",".messages","header"],i=[];for(const o of t.tree)if(o.type==="blob"&&HQ(o.path,r)){const a=this.getBlob(o.sha);i.push(a)}return{blobs:await Promise.all(i),tree:t}}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Jl;(function(n){n.Method="method",n.Header="header",n.Body="body"})(Jl||(Jl={}));const WQ=(n,e)=>`${n}: ${e}`;class GQ{translate(e){var t,r;const i=Object.assign({},e),s=new URLSearchParams;if(s.append(Jl.Method,(t=i.method)!==null&&t!==void 0?t:"GET"),i.headers)for(const[o,a]of Object.entries(i.headers)){const l=WQ(o,a);s.append(Jl.Header,l)}if(i.data&&["post","put","patch"].includes((r=i.method)===null||r===void 0?void 0:r.toLowerCase())){const o=JSON.stringify(i.data);s.append(Jl.Body,o)}return i.data=s.toString(),i.method="POST",i.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},i}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Bm=(...n)=>n.map(e=>e.replace(/^\//,"").replace(/\/$/,"")).filter(e=>!!e).join("/");function hN(n,e,t="",r=""){const i={type:"tree",entries:[]},s=Object.keys(e.tree);for(const o of s){const a=e.tree[o];let l,c,u;const d=Bm(t===""?r:t,o);switch(a.type){case zn.Tree:{c=hN(n,a,d,r),u=a.unreferenced||void 0;break}case zn.Blob:{typeof a.content=="string"?c={type:"blob",content:a.content,encoding:"utf-8"}:c={type:"blob",content:jS(a.content,"base64"),encoding:"base64"};break}case zn.Handle:{if(a.embedded)l=a.handle;else{if(!n)throw Error("Parent summary does not exist to reference by handle.");l=Bm(n,r,a.handle)}break}case zn.Attachment:{l=a.id;break}default:cN(a,`Unknown type: ${a.type}`)}const h={path:encodeURIComponent(o),type:PP(a)};let f;if(c)qi(l===void 0,173),f=Object.assign({value:c,unreferenced:u},h);else if(l)f=Object.assign(Object.assign({},h),{id:l});else throw new Error(`Invalid tree entry for ${a.type}`);i.entries.push(f)}return i}function KQ(n,e){const t={},r={id:n.id,blobs:{},trees:{}};t[""]=r;for(const i of n.entries){const s=i.path.replace(new RegExp(`^${e}/`),""),o=s.lastIndexOf("/"),a=s.slice(0,Math.max(0,o)),l=s.slice(o+1),c=t[a];if(i.type==="tree"){const u={blobs:{},trees:{},unreferenced:i.unreferenced};c.trees[decodeURIComponent(l)]=u,t[s]=u}else if(i.type==="blob")c.blobs[decodeURIComponent(l)]=i.id;else throw new Error("Unknown entry type!!")}return r}function E1(n,e=".app"){var t;const r=new Map;n.blobs&&n.blobs.forEach(a=>{var l;r.set(a.id,IQ(a.content,(l=a.encoding)!==null&&l!==void 0?l:"utf-8"))});const i=(t=n.trees)===null||t===void 0?void 0:t[0],s=i==null?void 0:i.sequenceNumber,o=KQ(i,e);return{blobs:r,snapshotTree:o,sequenceNumber:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class JQ{constructor(e,t,r){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=r}async writeSummaryTree(e,t,r,i){const s=await this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,s??void 0)}async writeSummaryTreeCore(e,t){const r=await Promise.all(Object.keys(e.tree).map(async s=>{const o=e.tree[s],a=await this.writeSummaryTreeObject(o,t);return{mode:vH(o),path:encodeURIComponent(s),sha:a,type:PP(o)}}));return(await this.manager.createGitTree({tree:r})).sha}async writeSummaryTreeObject(e,t){switch(e.type){case zn.Blob:return this.writeSummaryBlob(e.content);case zn.Handle:{if(t===void 0)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t)}case zn.Tree:return this.writeSummaryTreeCore(e,t);case zn.Attachment:return e.id;default:cN(e,`Unknown type: ${e.type}`)}}async writeSummaryBlob(e){const{parsedContent:t,encoding:r}=typeof e=="string"?{parsedContent:e,encoding:"utf-8"}:{parsedContent:jS(e,"base64"),encoding:"base64"},i=await FQ(rr.from(t,r));if(!this.blobsShaCache.has(i)){this.blobsShaCache.set(i,"");const s=await this.manager.createBlob(t,r);qi(i===s.sha,182)}return i}getIdFromPath(e,t,r){const i=t.split("/").map(s=>decodeURIComponent(s));return i[0]===""&&i.shift(),i.length===0?r.id:this.getIdFromPathCore(e,i,r)}getIdFromPathCore(e,t,r){var i;qi(t.length>0,179);const s=t[0];if(t.length===1)switch(e){case zn.Blob:{const o=r.blobs[s];return qi(!!o,180),o}case zn.Tree:{const o=(i=r.trees[s])===null||i===void 0?void 0:i.id;return qi(!!o,181),o}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),r.trees[s])}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class QQ{constructor(e){this.manager=e}async writeSummaryTree(e,t,r,i){const s=await this.writeSummaryTreeCore(t,e,r,i??0);if(!s)throw new Error("Failed to write summary tree");return s}async writeSummaryTreeCore(e,t,r,i){const o={entries:hN(e,t,"",r==="channel"?".app":"").entries,message:void 0,sequenceNumber:i,type:r};return this.manager.createSummary(o).then(a=>a.id)}}const zr=Object.create(null);zr.open="0";zr.close="1";zr.ping="2";zr.pong="3";zr.message="4";zr.upgrade="5";zr.noop="6";const hd=Object.create(null);Object.keys(zr).forEach(n=>{hd[zr[n]]=n});const Jv={type:"error",data:"parser error"},fN=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",pN=typeof ArrayBuffer=="function",mN=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,qS=({type:n,data:e},t,r)=>fN&&e instanceof Blob?t?r(e):_1(e,r):pN&&(e instanceof ArrayBuffer||mN(e))?t?r(e):_1(new Blob([e]),r):r(zr[n]+(e||"")),_1=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function T1(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let Um;function XQ(n,e){if(fN&&n.data instanceof Blob)return n.data.arrayBuffer().then(T1).then(e);if(pN&&(n.data instanceof ArrayBuffer||mN(n.data)))return e(T1(n.data));qS(n,!1,t=>{Um||(Um=new TextEncoder),e(Um.encode(t))})}const x1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pl=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<x1.length;n++)Pl[x1.charCodeAt(n)]=n;const YQ=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,a,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(r=0;r<t;r+=4)s=Pl[n.charCodeAt(r)],o=Pl[n.charCodeAt(r+1)],a=Pl[n.charCodeAt(r+2)],l=Pl[n.charCodeAt(r+3)],u[i++]=s<<2|o>>4,u[i++]=(o&15)<<4|a>>2,u[i++]=(a&3)<<6|l&63;return c},ZQ=typeof ArrayBuffer=="function",BS=(n,e)=>{if(typeof n!="string")return{type:"message",data:gN(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:eX(n.substring(1),e)}:hd[t]?n.length>1?{type:hd[t],data:n.substring(1)}:{type:hd[t]}:Jv},eX=(n,e)=>{if(ZQ){const t=YQ(n);return gN(t,e)}else return{base64:!0,data:n}},gN=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},vN=String.fromCharCode(30),tX=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,o)=>{qS(s,!1,a=>{r[o]=a,++i===t&&e(r.join(vN))})})},nX=(n,e)=>{const t=n.split(vN),r=[];for(let i=0;i<t.length;i++){const s=BS(t[i],e);if(r.push(s),s.type==="error")break}return r};function rX(){return new TransformStream({transform(n,e){XQ(n,t=>{const r=t.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let Hm;function ju(n){return n.reduce((e,t)=>e+t.length,0)}function qu(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)t[i]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function iX(n,e){Hm||(Hm=new TextDecoder);const t=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(r===0){if(ju(t)<1)break;const l=qu(t,1);s=(l[0]&128)===128,i=l[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(ju(t)<2)break;const l=qu(t,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(ju(t)<8)break;const l=qu(t,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,53-32)-1){a.enqueue(Jv);break}i=u*Math.pow(2,32)+c.getUint32(4),r=3}else{if(ju(t)<i)break;const l=qu(t,i);a.enqueue(BS(s?l:Hm.decode(l),e)),r=0}if(i===0||i>n){a.enqueue(Jv);break}}}})}const yN=4;function ut(n){if(n)return sX(n)}function sX(n){for(var e in ut.prototype)n[e]=ut.prototype[e];return n}ut.prototype.on=ut.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};ut.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};ut.prototype.off=ut.prototype.removeListener=ut.prototype.removeAllListeners=ut.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};ut.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};ut.prototype.emitReserved=ut.prototype.emit;ut.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};ut.prototype.hasListeners=function(n){return!!this.listeners(n).length};const zf=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),$n=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),oX="arraybuffer";function SN(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const aX=$n.setTimeout,lX=$n.clearTimeout;function $f(n,e){e.useNativeTimers?(n.setTimeoutFn=aX.bind($n),n.clearTimeoutFn=lX.bind($n)):(n.setTimeoutFn=$n.setTimeout.bind($n),n.clearTimeoutFn=$n.clearTimeout.bind($n))}const cX=1.33;function uX(n){return typeof n=="string"?dX(n):Math.ceil((n.byteLength||n.size)*cX)}function dX(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function bN(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function hX(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function fX(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class pX extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class US extends ut{constructor(e){super(),this.writable=!1,$f(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new pX(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=BS(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=hX(e);return t.length?"?"+t:""}}class mX extends US{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};nX(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,tX(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=bN()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let wN=!1;try{wN=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const gX=wN;function vX(){}class yX extends mX{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Mr extends ut{constructor(e,t,r){super(),this.createRequest=e,$f(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=SN(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Mr.requestsCount++,Mr.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=vX,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Mr.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Mr.requestsCount=0;Mr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",O1);else if(typeof addEventListener=="function"){const n="onpagehide"in $n?"pagehide":"unload";addEventListener(n,O1,!1)}}function O1(){for(let n in Mr.requests)Mr.requests.hasOwnProperty(n)&&Mr.requests[n].abort()}const SX=function(){const n=CN({xdomain:!1});return n&&n.responseType!==null}();class bX extends yX{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=SX&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Mr(CN,this.uri(),e)}}function CN(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||gX))return new XMLHttpRequest}catch{}if(!e)try{return new $n[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const EN=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class wX extends US{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=EN?{}:SN(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;qS(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}i&&zf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=bN()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Vm=$n.WebSocket||$n.MozWebSocket;class CX extends wX{createSocket(e,t,r){return EN?new Vm(e,t,r):t?new Vm(e,t):new Vm(e)}doWrite(e,t){this.ws.send(t)}}class EX extends US{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=iX(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),i=rX();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const s=()=>{r.read().then(({done:a,value:l})=>{a||(this.onPacket(l),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;this._writer.write(r).then(()=>{i&&zf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const _X={websocket:CX,webtransport:EX,polling:bX},TX=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,xX=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Qv(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=TX.exec(n||""),s={},o=14;for(;o--;)s[xX[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=OX(s,s.path),s.queryKey=PX(s,s.query),s}function OX(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function PX(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}const Xv=typeof addEventListener=="function"&&typeof removeEventListener=="function",fd=[];Xv&&addEventListener("offline",()=>{fd.forEach(n=>n())},!1);class is extends ut{constructor(e,t){if(super(),this.binaryType=oX,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=Qv(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=Qv(t.host).host);$f(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const i=r.prototype.name;this.transports.push(i),this._transportsByName[i]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=fX(this.opts.query)),Xv&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},fd.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=yN,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&is.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",is.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(t+=uX(i)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,zf(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(is.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Xv&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=fd.indexOf(this._offlineEventListener);r!==-1&&fd.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}is.protocol=yN;class RX extends is{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;is.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;is.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=t.name,this.emitReserved("upgradeError",h)}}))};function s(){r||(r=!0,u(),t.close(),t=null)}const o=d=>{const h=new Error("probe error: "+d);h.transport=t.name,s(),this.emitReserved("upgradeError",h)};function a(){o("transport closed")}function l(){o("socket closed")}function c(d){t&&d.name!==t.name&&s()}const u=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let kX=class extends RX{constructor(e,t={}){const r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(i=>_X[i]).filter(i=>!!i)),super(e,r)}};function NX(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=Qv(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}const LX=typeof ArrayBuffer=="function",IX=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,_N=Object.prototype.toString,AX=typeof Blob=="function"||typeof Blob<"u"&&_N.call(Blob)==="[object BlobConstructor]",MX=typeof File=="function"||typeof File<"u"&&_N.call(File)==="[object FileConstructor]";function HS(n){return LX&&(n instanceof ArrayBuffer||IX(n))||AX&&n instanceof Blob||MX&&n instanceof File}function pd(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(pd(n[t]))return!0;return!1}if(HS(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return pd(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&pd(n[t]))return!0;return!1}function DX(n){const e=[],t=n.data,r=n;return r.data=Yv(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Yv(n,e){if(!n)return n;if(HS(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=Yv(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=Yv(n[r],e));return t}return n}function FX(n,e){return n.data=Zv(n.data,e),delete n.attachments,n}function Zv(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Zv(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Zv(n[t],e));return n}const zX=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],$X=5;var ve;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(ve||(ve={}));class jX{constructor(e){this.replacer=e}encode(e){return(e.type===ve.EVENT||e.type===ve.ACK)&&pd(e)?this.encodeAsBinary({type:e.type===ve.EVENT?ve.BINARY_EVENT:ve.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===ve.BINARY_EVENT||e.type===ve.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=DX(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function P1(n){return Object.prototype.toString.call(n)==="[object Object]"}class VS extends ut{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===ve.BINARY_EVENT;r||t.type===ve.BINARY_ACK?(t.type=r?ve.EVENT:ve.ACK,this.reconstructor=new qX(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(HS(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(ve[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===ve.BINARY_EVENT||r.type===ve.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(VS.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case ve.CONNECT:return P1(t);case ve.DISCONNECT:return t===void 0;case ve.CONNECT_ERROR:return typeof t=="string"||P1(t);case ve.EVENT:case ve.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&zX.indexOf(t[0])===-1);case ve.ACK:case ve.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class qX{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=FX(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const BX=Object.freeze(Object.defineProperty({__proto__:null,Decoder:VS,Encoder:jX,get PacketType(){return ve},protocol:$X},Symbol.toStringTag,{value:"Module"}));function tr(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const UX=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class TN extends ut{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[tr(e,"open",this.onopen.bind(this)),tr(e,"packet",this.onpacket.bind(this)),tr(e,"error",this.onerror.bind(this)),tr(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,i,s;if(UX.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:ve.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const u=this.ids++,d=t.pop();this._registerAckCallback(u,d),o.id=u}const a=(i=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||i===void 0?void 0:i.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(s),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((r,i)=>{const s=(o,a)=>o?i(o):r(a);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ve.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ve.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ve.EVENT:case ve.BINARY_EVENT:this.onevent(e);break;case ve.ACK:case ve.BINARY_ACK:this.onack(e);break;case ve.DISCONNECT:this.ondisconnect();break;case ve.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:ve.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ve.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Ya(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Ya.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};Ya.prototype.reset=function(){this.attempts=0};Ya.prototype.setMin=function(n){this.ms=n};Ya.prototype.setMax=function(n){this.max=n};Ya.prototype.setJitter=function(n){this.jitter=n};class ey extends ut{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,$f(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Ya({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||BX;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new kX(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=tr(t,"open",function(){r.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=tr(t,"error",s);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(tr(e,"ping",this.onping.bind(this)),tr(e,"data",this.ondata.bind(this)),tr(e,"error",this.onerror.bind(this)),tr(e,"close",this.onclose.bind(this)),tr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){zf(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new TN(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const wl={};function md(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=NX(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=wl[i]&&s in wl[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new ey(r,e):(wl[i]||(wl[i]=new ey(r,e)),l=wl[i]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(md,{Manager:ey,Socket:TN,io:md,connect:md});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Na{constructor(){this.cache=new Map}async get(e){return this.cache.get(e)}async put(e,t){this.cache.set(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const R1="latest";class HX{constructor(e,t,r,i={},s,o=new Na,a=new Na,l,c=async u=>u&&this.noCacheGitManager!==void 0?this.noCacheGitManager:this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.driverPolicies=s,this.blobCache=o,this.snapshotTreeCache=a,this.noCacheGitManager=l,this.getStorageManager=c,this.firstVersionsCall=!0}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new QQ(e)}async getVersions(e,t){var r;if(e!==this.id&&e!==null)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&t===1){this.firstVersionsCall=!1;const{id:o,snapshotTree:a}=!((r=this.driverPolicies)===null||r===void 0)&&r.enableDiscovery?await this.fetchAndCacheSnapshotTree(R1,!0):await this.fetchAndCacheSnapshotTree(R1,!1);return[{id:o,treeId:a.id}]}const i=e||this.id;return(await ce.timedExecAsync(this.logger,{eventName:"getVersions",versionId:i,count:t},async()=>(await this.getStorageManager()).getCommits(i,t))).map(o=>({date:o.commit.author.date,id:o.sha,treeId:o.commit.tree.sha}))}async getSnapshotTree(e){let t=e;if(!t){const r=await this.getVersions(this.id,1);if(r.length===0)return null;t=r[0]}return(await this.fetchAndCacheSnapshotTree(t.id)).snapshotTree}async readBlob(e){const t=await this.blobCache.get(this.getCacheKey(e));if(t!==void 0)return t;const r=await ce.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async s=>{const a=await(await this.getStorageManager()).getBlob(e);return s.end({size:a.size}),a}),i=aN(r.content,r.encoding);return await this.blobCache.put(this.getCacheKey(r.sha),i),i}async uploadSummaryWithContext(e,t){return await ce.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){const t=await ce.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},async s=>{var o;const l=await(await this.getStorageManager()).getSummary(e.handle);return s.end({size:(o=l.trees[0])===null||o===void 0?void 0:o.entries.length}),l}),{blobs:r,snapshotTree:i}=E1(t,"");return xR(i,r)}async createBlob(e){const t=new Uint8Array(e);return ce.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Ff(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async fetchAndCacheSnapshotTree(e,t){const r=await this.snapshotTreeCache.get(this.getCacheKey(e));if(r!==void 0)return{id:r.id,snapshotTree:r.snapshotTree};const i=await ce.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},async u=>{var d;const f=await(await this.getStorageManager(t)).getSummary(e);return u.end({size:(d=f.trees[0])===null||d===void 0?void 0:d.entries.length}),f}),s=E1(i),o=i.id,a=s.snapshotTree.id;kc(a!==void 0,629);const l={id:o,snapshotTree:s.snapshotTree},c=[this.snapshotTreeCache.put(this.getCacheKey(a),l),this.initBlobCache(s.blobs)];return a!==e&&c.push(this.snapshotTreeCache.put(this.getCacheKey(e),l)),await Promise.all(c),l}async initBlobCache(e){const t=[];e.forEach((r,i)=>{const s=this.getCacheKey(i);t.push(this.blobCache.put(s,r))}),await Promise.all(t)}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class VX{constructor(e,t){this.internalGitManager=e,this.logger=t}async getHeader(e,t){return this.runWithRetry(async()=>this.internalGitManager.getHeader(e,t),"gitManager_getHeader")}async getFullTree(e){return this.runWithRetry(async()=>this.internalGitManager.getFullTree(e),"gitManager_getFullTree")}async getCommit(e){return this.runWithRetry(async()=>this.internalGitManager.getCommit(e),"gitManager_getCommit")}async getCommits(e,t){return this.runWithRetry(async()=>this.internalGitManager.getCommits(e,t),"gitManager_getCommits")}async getTree(e,t){return this.runWithRetry(async()=>this.internalGitManager.getTree(e,t),"gitManager_getTree")}async getBlob(e){return this.runWithRetry(async()=>this.internalGitManager.getBlob(e),"gitManager_getBlob")}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}async getContent(e,t){return this.runWithRetry(async()=>this.internalGitManager.getContent(e,t),"gitManager_getContent")}async createBlob(e,t){return this.runWithRetry(async()=>this.internalGitManager.createBlob(e,t),"gitManager_createBlob")}async createGitTree(e){return this.runWithRetry(async()=>this.internalGitManager.createGitTree(e),"gitManager_createGitTree")}async createTree(e){return this.runWithRetry(async()=>this.internalGitManager.createTree(e),"gitManager_createTree")}async createCommit(e){return this.runWithRetry(async()=>this.internalGitManager.createCommit(e),"gitManager_createCommit")}async getRef(e){return this.runWithRetry(async()=>this.internalGitManager.getRef(e),"gitManager_getRef")}async createRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.createRef(e,t),"gitManager_createRef")}async upsertRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.upsertRef(e,t),"gitManager_upsertRef")}async write(e,t,r,i){return this.runWithRetry(async()=>this.internalGitManager.write(e,t,r,i),"gitManager_write")}async createSummary(e){return this.runWithRetry(async()=>this.internalGitManager.createSummary(e),"gitManager_createSummary")}async deleteSummary(e){return this.runWithRetry(async()=>this.internalGitManager.deleteSummary(e),"gitManager_deleteSummary")}async getSummary(e){return this.runWithRetry(async()=>this.internalGitManager.getSummary(e),"gitManager_getSummary")}async runWithRetry(e,t){return X0(e,t,this.logger,{})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const WX=typeof window>"u";class GX{constructor(e,t,r,i={},s,o,a,l=async()=>this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.getStorageManager=l,this.blobsShaCache=new Map,((s==null?void 0:s.enableRestLess)===!0||WX)&&(this.blobCache=o??new Na,this.snapshotTreeCache=a??new Na)}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new JQ(new VX(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}async getVersions(e,t){const r=e||this.id;return(await ce.timedExecAsync(this.logger,{eventName:"getVersions",versionId:r,count:t},async()=>(await this.getStorageManager()).getCommits(r,t))).map(s=>({date:s.commit.author.date,id:s.sha,treeId:s.commit.tree.sha}))}async getSnapshotTree(e){var t,r;let i=e;if(!i){const l=await this.getVersions(this.id,1);if(l.length===0)return null;i=l[0]}const s=await((t=this.snapshotTreeCache)===null||t===void 0?void 0:t.get(this.getCacheKey(i.treeId)));if(s)return s.snapshotTree;const o=await ce.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:i.treeId},async l=>{const u=await(await this.getStorageManager()).getTree(i.treeId);return l.end({size:u.tree.length}),u}),a=N0(o,this.blobsShaCache,!0);return await((r=this.snapshotTreeCache)===null||r===void 0?void 0:r.put(this.getCacheKey(a.id),{id:i.id,snapshotTree:a})),a}async readBlob(e){var t,r;const i=await((t=this.blobCache)===null||t===void 0?void 0:t.get(this.getCacheKey(e)));if(i)return i;const s=await ce.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async a=>{const c=await(await this.getStorageManager()).getBlob(e);return a.end({size:c.size}),c});this.blobsShaCache.set(s.sha,"");const o=aN(s.content,s.encoding);return await((r=this.blobCache)===null||r===void 0?void 0:r.put(this.getCacheKey(s.sha),o)),o}async uploadSummaryWithContext(e,t){return await ce.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){throw new Error("NOT IMPLEMENTED!")}async createBlob(e){const t=new Uint8Array(e);return ce.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Ff(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async getPreviousFullSnapshot(e){return e?this.getVersions(e,1).then(async t=>(this.blobsShaCache.clear(),this.getSnapshotTree(t[0]))):void 0}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class WS extends P0{constructor(e,t,r,i={},s,o,a,l,c){super(WS.loadInternalDocumentStorageService(e,t,r,i,s,o,a,l,c)),this.id=e,this.manager=t,this.noCacheGitManager=l,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,r,i,s,o,a,l,c){const u=s!=null&&s.enableWholeSummaryUpload?new HX(e,t,r,i,s,o,a,l,c):new GX(e,t,r,i,s,o,a,c);return!(s!=null&&s.enableWholeSummaryUpload)&&i.caching===_a.Prefetch?new R5(u):u}async getSnapshotTree(e){const t=await this.internalStorageService.getSnapshotTree(e);return t!==null&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function gn(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function KX(n){const e=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",t=(s,o)=>{const a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(e(n)){const{errorType:s,stack:o,name:a}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const l=typeof a=="string"?a:void 0;i.stack=t(o,l)}}return i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ty;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(ty||(ty={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const k1="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Bi extends T0{constructor(e,t,r,i=!1){super((s,o)=>{r.sendErrorEvent({eventName:"DeltaConnection:EventException",name:s},o)}),this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=i,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(s,o)=>{this.queuedMessages.push(...o)},this.earlySignalHandler=s=>{this.queuedSignals.push(s)},this.mc=qa(de.create(r,"DeltaConnection")),this.on("newListener",(s,o)=>{if(gn(!this.disposed,522),Bi.eventsAlwaysForwarded.includes(s)){gn(this.trackedListeners.has(s),581);return}if(!Bi.eventsToForward.includes(s))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${s}`);gn(this.listeners(s).length!==0===this.trackedListeners.has(s),523),this.trackedListeners.has(s)||this.addTrackedListener(s,(...a)=>{this.emit(s,...a)})})}get hasDetails(){return!!this._details}get disposed(){return gn(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){gn(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),gn(this.earlyOpHandlerAttached,142),gn(this.listeners("op").length!==0,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((e,t)=>e.sequenceNumber-t.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),gn(this.listeners("signal").length!==0,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submitCore(e,t){this.emitMessages(e,[t])}submit(e){this.checkNotClosed(),this.submitCore("submitOp",e)}submitSignal(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}dispose(){this.disposeCore(!1,Pa("Client closing delta connection",{canRetry:!0},{driverVersion:k1}))}disposeCore(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}disconnect(e,t){this.socket.disconnect()}async initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let r=0;const i=()=>this.socket.io.reconnection(),s=()=>i()?this.socket.io.reconnectionAttempts():0,o=()=>s()+1;this._details=await new Promise((a,l)=>{const c=(u,d)=>{this.disposeCore(u,d),l(d)};this.addConnectionListener("connect_error",u=>{var d;r++;let h=!1;try{const f=u==null?void 0:u.description;f&&typeof f=="object"&&(u.type==="TransportError"&&(h=!0),f.target=void 0)}catch{}h&&this.enableLongPollingDowngrades&&((d=this.socket.io.opts.transports)===null||d===void 0?void 0:d[0])!=="polling"&&(this.socket.io.opts.transports=["polling","websocket"],i()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),!(i()&&r<o())&&c(!0,this.createErrorObject("connect_error",u))}),this.addConnectionListener("connect_timeout",()=>{c(!0,this.createErrorObject("connect_timeout"))}),this.addConnectionListener("connect_document_success",u=>{if(e.nonce!==void 0&&u.nonce!==void 0&&u.nonce!==e.nonce)return;const d=e.mode,h=u.mode;if(u.claims.scopes.includes(ty.DocWrite)){if(h!==d){c(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1));return}}else if(h==="write"){c(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));return}this.checkpointSequenceNumber=u.checkpointSequenceNumber,this.removeConnectionListeners(),a(u)}),this.addTrackedListener("disconnect",u=>{const d=this.createErrorObject("disconnect",u);this.emit("disconnect",d),c(!0,d)}),this.addTrackedListener("error",u=>{const d=this.createErrorObject("error",u,u!=="Invalid namespace");this.emit("error",d),c(!0,d)}),this.addConnectionListener("connect_document_error",u=>{e.nonce!==void 0&&u.nonce!==void 0&&u.nonce!==e.nonce||c(!1,this.createErrorObject("connect_document_error",u))}),this.socket.emit("connect_document",e),this.socketConnectionTimeout=setTimeout(()=>{c(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))},t+2e3)}),gn(!this.disposed,582)}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(e,t){gn(!Bi.eventsAlwaysForwarded.includes(e),583),gn(!Bi.eventsToForward.includes(e),584),this.socket.on(e,t),gn(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),gn(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){this.socketConnectionTimeout!==void 0&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t,r=!0){let i;return(t==null?void 0:t.type)==="TransportError"?i=`${(t==null?void 0:t.message)!==void 0?`${t.message}: `:""}${JSON.stringify(t,oH())}`:i=KX(t).message,Pa(`socket.io (${e}): ${i}`,{canRetry:r},{driverVersion:k1})}}Bi.eventsToForward=["nack","op","signal","pong"];Bi.eventsAlwaysForwarded=["disconnect","error"];/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const jf="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ny;(function(n){n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"})(ny||(ny={}));function xN(n,e,t){const r={statusCode:e,driverVersion:jf};switch(e){case void 0:return new yv(n,n.startsWith("NetworkError"),r);case 401:case 403:return new g5(n,void 0,void 0,r);case 404:const i=ny.fileNotFoundOrAccessDeniedError;return new nf(n,i,r);case 429:return Pa(n,{canRetry:!0,retryAfterMs:t},r);case 500:case 502:return new yv(n,!0,r);default:return Pa(n,{canRetry:t!==void 0,retryAfterMs:t},r)}}function N1(n,e,t){throw xN(n,e,t)}function JX(n,e){const t=`R11s socket error (${e}): ${n.message}`;return xN(t,n.code,n.retryAfterMs)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const QX=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class GS extends Bi{static async create(e,t,r,i,s,o,a,l=2e4){const c=i(o,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:l}),u={client:s,id:t,mode:s.mode,tenantId:e,token:r,versions:QX,relayUserAgent:[s.details.environment,` driverVersion:${jf}`].join(";")},d=!0,h=new GS(c,t,a,d);return await h.initialize(u,l),h}createErrorObject(e,t,r=!0){return r&&Number.isInteger(t==null?void 0:t.code)&&typeof(t==null?void 0:t.message)=="string"?JX(t,e):super.createErrorObject(e,t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class XX{get repositoryUrl(){throw new Error("Invalid operation")}async getSnapshotTree(e){return e?Promise.reject(new Error("Invalid operation")):null}async getVersions(e,t){return[]}async uploadSummaryWithContext(e,t){return Promise.reject(new Error("Invalid operation"))}async downloadSummary(e){return Promise.reject(new Error("Invalid operation"))}async createBlob(e){return Promise.reject(new Error("Null blob storage can not create blob"))}async readBlob(e){return Promise.reject(new Error("Null blob storage can not read blob"))}}var ry={exports:{}};(function(n,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof s<"u"&&s||{},l={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function c(C){return C&&DataView.prototype.isPrototypeOf(C)}if(l.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(C){return C&&u.indexOf(Object.prototype.toString.call(C))>-1};function h(C){if(typeof C!="string"&&(C=String(C)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(C)||C==="")throw new TypeError('Invalid character in header field name: "'+C+'"');return C.toLowerCase()}function f(C){return typeof C!="string"&&(C=String(C)),C}function p(C){var k={next:function(){var V=C.shift();return{done:V===void 0,value:V}}};return l.iterable&&(k[Symbol.iterator]=function(){return k}),k}function g(C){this.map={},C instanceof g?C.forEach(function(k,V){this.append(V,k)},this):Array.isArray(C)?C.forEach(function(k){if(k.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+k.length);this.append(k[0],k[1])},this):C&&Object.getOwnPropertyNames(C).forEach(function(k){this.append(k,C[k])},this)}g.prototype.append=function(C,k){C=h(C),k=f(k);var V=this.map[C];this.map[C]=V?V+", "+k:k},g.prototype.delete=function(C){delete this.map[h(C)]},g.prototype.get=function(C){return C=h(C),this.has(C)?this.map[C]:null},g.prototype.has=function(C){return this.map.hasOwnProperty(h(C))},g.prototype.set=function(C,k){this.map[h(C)]=f(k)},g.prototype.forEach=function(C,k){for(var V in this.map)this.map.hasOwnProperty(V)&&C.call(k,this.map[V],V,this)},g.prototype.keys=function(){var C=[];return this.forEach(function(k,V){C.push(V)}),p(C)},g.prototype.values=function(){var C=[];return this.forEach(function(k){C.push(k)}),p(C)},g.prototype.entries=function(){var C=[];return this.forEach(function(k,V){C.push([V,k])}),p(C)},l.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function S(C){if(!C._noBody){if(C.bodyUsed)return Promise.reject(new TypeError("Already read"));C.bodyUsed=!0}}function m(C){return new Promise(function(k,V){C.onload=function(){k(C.result)},C.onerror=function(){V(C.error)}})}function v(C){var k=new FileReader,V=m(k);return k.readAsArrayBuffer(C),V}function y(C){var k=new FileReader,V=m(k),I=/charset=([A-Za-z0-9_-]+)/.exec(C.type),U=I?I[1]:"utf-8";return k.readAsText(C,U),V}function b(C){for(var k=new Uint8Array(C),V=new Array(k.length),I=0;I<k.length;I++)V[I]=String.fromCharCode(k[I]);return V.join("")}function w(C){if(C.slice)return C.slice(0);var k=new Uint8Array(C.byteLength);return k.set(new Uint8Array(C)),k.buffer}function T(){return this.bodyUsed=!1,this._initBody=function(C){this.bodyUsed=this.bodyUsed,this._bodyInit=C,C?typeof C=="string"?this._bodyText=C:l.blob&&Blob.prototype.isPrototypeOf(C)?this._bodyBlob=C:l.formData&&FormData.prototype.isPrototypeOf(C)?this._bodyFormData=C:l.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)?this._bodyText=C.toString():l.arrayBuffer&&l.blob&&c(C)?(this._bodyArrayBuffer=w(C.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):l.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(C)||d(C))?this._bodyArrayBuffer=w(C):this._bodyText=C=Object.prototype.toString.call(C):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof C=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):l.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},l.blob&&(this.blob=function(){var C=S(this);if(C)return C;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var C=S(this);return C||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(l.blob)return this.blob().then(v);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var C=S(this);if(C)return C;if(this._bodyBlob)return y(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},l.formData&&(this.formData=function(){return this.text().then(F)}),this.json=function(){return this.text().then(JSON.parse)},this}var E=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function O(C){var k=C.toUpperCase();return E.indexOf(k)>-1?k:C}function A(C,k){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');k=k||{};var V=k.body;if(C instanceof A){if(C.bodyUsed)throw new TypeError("Already read");this.url=C.url,this.credentials=C.credentials,k.headers||(this.headers=new g(C.headers)),this.method=C.method,this.mode=C.mode,this.signal=C.signal,!V&&C._bodyInit!=null&&(V=C._bodyInit,C.bodyUsed=!0)}else this.url=String(C);if(this.credentials=k.credentials||this.credentials||"same-origin",(k.headers||!this.headers)&&(this.headers=new g(k.headers)),this.method=O(k.method||this.method||"GET"),this.mode=k.mode||this.mode||null,this.signal=k.signal||this.signal||function(){if("AbortController"in a){var x=new AbortController;return x.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&V)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(V),(this.method==="GET"||this.method==="HEAD")&&(k.cache==="no-store"||k.cache==="no-cache")){var I=/([?&])_=[^&]*/;if(I.test(this.url))this.url=this.url.replace(I,"$1_="+new Date().getTime());else{var U=/\?/;this.url+=(U.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function F(C){var k=new FormData;return C.trim().split("&").forEach(function(V){if(V){var I=V.split("="),U=I.shift().replace(/\+/g," "),x=I.join("=").replace(/\+/g," ");k.append(decodeURIComponent(U),decodeURIComponent(x))}}),k}function X(C){var k=new g,V=C.replace(/\r?\n[\t ]+/g," ");return V.split("\r").map(function(I){return I.indexOf(`
`)===0?I.substr(1,I.length):I}).forEach(function(I){var U=I.split(":"),x=U.shift().trim();if(x){var j=U.join(":").trim();try{k.append(x,j)}catch(Q){console.warn("Response "+Q.message)}}}),k}T.call(A.prototype);function z(C,k){if(!(this instanceof z))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(k||(k={}),this.type="default",this.status=k.status===void 0?200:k.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=k.statusText===void 0?"":""+k.statusText,this.headers=new g(k.headers),this.url=k.url||"",this._initBody(C)}T.call(z.prototype),z.prototype.clone=function(){return new z(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},z.error=function(){var C=new z(null,{status:200,statusText:""});return C.ok=!1,C.status=0,C.type="error",C};var Z=[301,302,303,307,308];z.redirect=function(C,k){if(Z.indexOf(k)===-1)throw new RangeError("Invalid status code");return new z(null,{status:k,headers:{location:C}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(k,V){this.message=k,this.name=V;var I=Error(k);this.stack=I.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function W(C,k){return new Promise(function(V,I){var U=new A(C,k);if(U.signal&&U.signal.aborted)return I(new o.DOMException("Aborted","AbortError"));var x=new XMLHttpRequest;function j(){x.abort()}x.onload=function(){var _={statusText:x.statusText,headers:X(x.getAllResponseHeaders()||"")};U.url.indexOf("file://")===0&&(x.status<200||x.status>599)?_.status=200:_.status=x.status,_.url="responseURL"in x?x.responseURL:_.headers.get("X-Request-URL");var R="response"in x?x.response:x.responseText;setTimeout(function(){V(new z(R,_))},0)},x.onerror=function(){setTimeout(function(){I(new TypeError("Network request failed"))},0)},x.ontimeout=function(){setTimeout(function(){I(new TypeError("Network request timed out"))},0)},x.onabort=function(){setTimeout(function(){I(new o.DOMException("Aborted","AbortError"))},0)};function Q(_){try{return _===""&&a.location.href?a.location.href:_}catch{return _}}if(x.open(U.method,Q(U.url),!0),U.credentials==="include"?x.withCredentials=!0:U.credentials==="omit"&&(x.withCredentials=!1),"responseType"in x&&(l.blob?x.responseType="blob":l.arrayBuffer&&(x.responseType="arraybuffer")),k&&typeof k.headers=="object"&&!(k.headers instanceof g||a.Headers&&k.headers instanceof a.Headers)){var me=[];Object.getOwnPropertyNames(k.headers).forEach(function(_){me.push(h(_)),x.setRequestHeader(_,f(k.headers[_]))}),U.headers.forEach(function(_,R){me.indexOf(R)===-1&&x.setRequestHeader(R,_)})}else U.headers.forEach(function(_,R){x.setRequestHeader(R,_)});U.signal&&(U.signal.addEventListener("abort",j),x.onreadystatechange=function(){x.readyState===4&&U.signal.removeEventListener("abort",j)}),x.send(typeof U._bodyInit>"u"?null:U._bodyInit)})}return W.polyfill=!0,a.fetch||(a.fetch=W,a.Headers=g,a.Request=A,a.Response=z),o.Headers=g,o.Request=A,o.Response=z,o.fetch=W,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=t.fetch?t:r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(ry,ry.exports);var YX=ry.exports;const ZX=pi(YX),eY=n=>{var e,t;const r=n.baseURL!==void 0?`${n.baseURL}${(e=n.url)!==null&&e!==void 0?e:""}`:(t=n.url)!==null&&t!==void 0?t:"",i={method:n.method,headers:n.headers,body:n.data};return[r,i]};class ON extends dN{constructor(e,t,r,i,s,o={}){super(s,o),this.rateLimiter=t,this.getAuthorizationHeader=r,this.useRestLess=i,this.restLess=new GQ}async load(){this.authorizationHeader=await this.getAuthorizationHeader()}async request(e,t,r=!0){var i;const s=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),o=this.useRestLess?this.restLess.translate(s):s,a=eY(o),l=await this.rateLimiter.schedule(async()=>ZX(...a).catch(async d=>{const h=["TypeError","FetchError"].includes(d==null?void 0:d.name);N1(h?`NetworkError: ${d.message}`:Kv(d))})),c=!((i=l.headers.get("content-type"))===null||i===void 0)&&i.includes("application/json")?await l.json():await l.text();if(l.ok||l.status===t)return c;if(l.status===401&&r)return this.authorizationHeader=await this.getAuthorizationHeader(!0),this.request(s,t,!1);if(l.status===429&&(c==null?void 0:c.retryAfter)>0)return new Promise((d,h)=>setTimeout(()=>{this.request(s,t).then(d).catch(h)},c.retryAfter*1e3));const u=c!==void 0?typeof c=="string"?c:Kv(c):l.statusText;N1(`R11s fetch error: ${u}`,l.status,c==null?void 0:c.retryAfter)}generateHeaders(e){const t=(e==null?void 0:e["x-correlation-id"])||ot();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":jf,Authorization:this.authorizationHeader})}}class KS extends ON{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,a){const l={token:`${PQ(e)}`},c=async d=>ce.timedExecAsync(i,{eventName:"FetchStorageToken",docId:t},async()=>{const f={password:(await r.fetchStorageToken(e,t,d)).jwt,user:e};return VQ(f)}),u=new KS(i,s,c,o,a,l);try{await u.load()}catch(d){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},d),await u.load()}return u}}class Nc extends ON{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,a){const l=async u=>ce.timedExecAsync(i,{eventName:"FetchOrdererToken",docId:t},async()=>`Basic ${(await r.fetchOrdererToken(e,t,u)).jwt}`),c=new Nc(i,s,l,o,a);try{await c.load()}catch(u){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},u),await c.load()}return c}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const tY=5*6e4;class nY{constructor(e,t,r,i,s,o,a,l,c,u,d,h){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=r,this.storageUrl=i,this.logger=s,this.tokenProvider=o,this.tenantId=a,this.documentId=l,this.driverPolicies=c,this.blobCache=u,this.snapshotTreeCache=d,this.discoverFluidResolvedUrl=h,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}async connectToStorage(){if(this.documentStorageService!==void 0)return this.documentStorageService;if(this.storageUrl===void 0)return new XX;const e=async s=>{const o=this.shouldUpdateDiscoveredSessionInfo();if(o&&await this.refreshDiscovery(),!this.storageManager||!this.noCacheStorageManager||o){const a=new eh(this.driverPolicies.maxConcurrentStorageRequests),l=await KS.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,a,this.driverPolicies.enableRestLess,this.storageUrl),c=new C1(this.storageUrl,!0,!1,l);this.storageManager=new w1(c);const u=new C1(this.storageUrl,!0,!0,l);this.noCacheStorageManager=new w1(u)}return s?this.noCacheStorageManager:this.storageManager},t=await e(),r=await e(!0),i={caching:this.driverPolicies.enablePrefetch?_a.Prefetch:_a.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new WS(this.documentId,t,this.logger,i,this.driverPolicies,this.blobCache,this.snapshotTreeCache,r,e),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),kc(!!this.documentStorageService,177);const e=async()=>{const i=this.shouldUpdateDiscoveredSessionInfo();if(i&&await this.refreshDiscovery(),!this.ordererRestWrapper||i){const s=new eh(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=await Nc.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,s,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},t=await e(),r=new LQ(this.deltaStorageUrl,t,this.logger,e,()=>this.deltaStorageUrl);return new NQ(this.tenantId,this.documentId,r,this.documentStorageService)}async connectToDeltaStream(e){const t=async r=>{this.shouldUpdateDiscoveredSessionInfo()&&await this.refreshDiscovery();const i=await ce.timedExecAsync(this.logger,{eventName:"GetDeltaStreamToken",docId:this.documentId,details:JSON.stringify({refreshToken:r})},async()=>this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,r));return ce.timedExecAsync(this.logger,{eventName:"ConnectToDeltaStream",docId:this.documentId},async()=>GS.create(this.tenantId,this.documentId,i.jwt,md,e,this.ordererUrl,this.logger))};try{return await t()}catch(r){if((r==null?void 0:r.statusCode)===401)return t(!0);throw r}}async refreshDiscovery(){return this.discoverP||(this.discoverP=ce.timedExecAsync(this.logger,{eventName:"RefreshDiscovery"},async()=>this.refreshDiscoveryCore())),this.discoverP}async refreshDiscoveryCore(){const e=await this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const t=Date.now()-this.lastDiscoveredAt>tY;return t&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch(()=>{this.lastDiscoveredAt=0})),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ql;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Ql||(Ql={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function PN(n){const e=Object.keys(n.tree);for(const t of e){const r=n.tree[t];switch(r.type){case Ql.Tree:{n.tree[t]=PN(r);break}case Ql.Blob:{r.content=typeof r.content=="string"?r.content:Ff(r.content,"utf8");break}case Ql.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${r.type}`)}}return n}var rY=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},JS={},iY=Object.prototype.hasOwnProperty,sY;function L1(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function I1(n){try{return encodeURIComponent(n)}catch{return null}}function oY(n){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},r;r=e.exec(n);){var i=L1(r[1]),s=L1(r[2]);i===null||s===null||i in t||(t[i]=s)}return t}function aY(n,e){e=e||"";var t=[],r,i;typeof e!="string"&&(e="?");for(i in n)if(iY.call(n,i)){if(r=n[i],!r&&(r===null||r===sY||isNaN(r))&&(r=""),i=I1(i),r=I1(r),i===null||r===null)continue;t.push(i+"="+r)}return t.length?e+t.join("&"):""}JS.stringify=aY;JS.parse=oY;var RN=rY,qf=JS,lY=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,kN=/[\n\r\t]/g,cY=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,NN=/:\d+$/,uY=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,dY=/^[a-zA-Z]:/;function QS(n){return(n||"").toString().replace(lY,"")}var iy=[["#","hash"],["?","query"],function(e,t){return Dr(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],A1={hash:1,query:1};function LN(n){var e;typeof window<"u"?e=window:typeof globalThis<"u"?e=globalThis:typeof self<"u"?e=self:e={};var t=e.location||{};n=n||t;var r={},i=typeof n,s;if(n.protocol==="blob:")r=new $r(unescape(n.pathname),{});else if(i==="string"){r=new $r(n,{});for(s in A1)delete r[s]}else if(i==="object"){for(s in n)s in A1||(r[s]=n[s]);r.slashes===void 0&&(r.slashes=cY.test(n.href))}return r}function Dr(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function IN(n,e){n=QS(n),n=n.replace(kN,""),e=e||{};var t=uY.exec(n),r=t[1]?t[1].toLowerCase():"",i=!!t[2],s=!!t[3],o=0,a;return i?s?(a=t[2]+t[3]+t[4],o=t[2].length+t[3].length):(a=t[2]+t[4],o=t[2].length):s?(a=t[3]+t[4],o=t[3].length):a=t[4],r==="file:"?o>=2&&(a=a.slice(2)):Dr(r)?a=t[4]:r?i&&(a=a.slice(2)):o>=2&&Dr(e.protocol)&&(a=t[4]),{protocol:r,slashes:i||Dr(r),slashesCount:o,rest:a}}function hY(n,e){if(n==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(n.split("/")),r=t.length,i=t[r-1],s=!1,o=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),o++):o&&(r===0&&(s=!0),t.splice(r,1),o--);return s&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function $r(n,e,t){if(n=QS(n),n=n.replace(kN,""),!(this instanceof $r))return new $r(n,e,t);var r,i,s,o,a,l,c=iy.slice(),u=typeof e,d=this,h=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=qf.parse),e=LN(e),i=IN(n||"",e),r=!i.protocol&&!i.slashes,d.slashes=i.slashes||r&&e.slashes,d.protocol=i.protocol||e.protocol||"",n=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||dY.test(n))||!i.slashes&&(i.protocol||i.slashesCount<2||!Dr(d.protocol)))&&(c[3]=[/(.*)/,"pathname"]);h<c.length;h++){if(o=c[h],typeof o=="function"){n=o(n,d);continue}s=o[0],l=o[1],s!==s?d[l]=n:typeof s=="string"?(a=s==="@"?n.lastIndexOf(s):n.indexOf(s),~a&&(typeof o[2]=="number"?(d[l]=n.slice(0,a),n=n.slice(a+o[2])):(d[l]=n.slice(a),n=n.slice(0,a)))):(a=s.exec(n))&&(d[l]=a[1],n=n.slice(0,a.index)),d[l]=d[l]||r&&o[3]&&e[l]||"",o[4]&&(d[l]=d[l].toLowerCase())}t&&(d.query=t(d.query)),r&&e.slashes&&d.pathname.charAt(0)!=="/"&&(d.pathname!==""||e.pathname!=="")&&(d.pathname=hY(d.pathname,e.pathname)),d.pathname.charAt(0)!=="/"&&Dr(d.protocol)&&(d.pathname="/"+d.pathname),RN(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.indexOf(":"),~a?(d.username=d.auth.slice(0,a),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(a+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin=d.protocol!=="file:"&&Dr(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function fY(n,e,t){var r=this;switch(n){case"query":typeof e=="string"&&e.length&&(e=(t||qf.parse)(e)),r[n]=e;break;case"port":r[n]=e,RN(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[n]="");break;case"hostname":r[n]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[n]=e,NN.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(e){var i=n==="pathname"?"/":"#";r[n]=e.charAt(0)!==i?i+e:e}else r[n]=e;break;case"username":case"password":r[n]=encodeURIComponent(e);break;case"auth":var s=e.indexOf(":");~s?(r.username=e.slice(0,s),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(s+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var o=0;o<iy.length;o++){var a=iy[o];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&Dr(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function pY(n){(!n||typeof n!="function")&&(n=qf.stringify);var e,t=this,r=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var s=i+(t.protocol&&t.slashes||Dr(t.protocol)?"//":"");return t.username?(s+=t.username,t.password&&(s+=":"+t.password),s+="@"):t.password?(s+=":"+t.password,s+="@"):t.protocol!=="file:"&&Dr(t.protocol)&&!r&&t.pathname!=="/"&&(s+="@"),(r[r.length-1]===":"||NN.test(t.hostname)&&!t.port)&&(r+=":"),s+=r+t.pathname,e=typeof t.query=="object"?n(t.query):t.query,e&&(s+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(s+=t.hash),s}$r.prototype={set:fY,toString:pY};$r.extractProtocol=IN;$r.location=LN;$r.trimLeft=QS;$r.qs=qf;var mY=$r;const Do=pi(mY);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const gd=n=>new Do(n,!0),M1=(n,e)=>n.split("/").slice(0,-1).concat([e]).join("/"),D1=(n,e)=>{if(e){const t=new Do(e.ordererUrl),r=new Do(n.endpoints.deltaStorageUrl);r.set("host",t.host);const i=new Do(e.historianUrl),s=new Do(n.endpoints.storageUrl);s.set("host",i.host);const o=gd(n.url);return{endpoints:{deltaStorageUrl:r.toString(),ordererUrl:e.ordererUrl,storageUrl:s.toString()},id:n.id,tokens:n.tokens,type:n.type,url:new Do(`fluid://${t.host}${o.pathname}`).toString()}}else return n};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const gY={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class vY{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new Na,this.snapshotTreeCache=new Na,this.driverPolicies=Object.assign(Object.assign({},gY),t)}async createContainer(e,t,r,i){if(Fr(t),e===void 0)throw new Error("Empty file summary creation isn't supported in this driver.");kc(!!t.endpoints.ordererUrl,178);let s=gd(t.url);if(!s.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,o]=s.pathname.split("/"),a=e.tree[".protocol"],l=e.tree[".app"];if(!(a&&l))throw new Error("Protocol and App Summary required in the full summary");const c=b5(a),u=w5(a),d=de.create(r,"RouterliciousDriver"),h=new eh(this.driverPolicies.maxConcurrentOrdererRequests),f=await Nc.load(o,void 0,this.tokenProvider,d,h,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl),p=await ce.timedExecAsync(d,{eventName:"CreateNew",details:JSON.stringify({enableDiscovery:this.driverPolicies.enableDiscovery,sequenceNumber:c.sequenceNumber})},async b=>{const w=await f.post(`/documents/${o}`,{summary:PN(l),sequenceNumber:c.sequenceNumber,values:u,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:this.tokenProvider.documentPostCreateCallback!==void 0});return b.end({docId:typeof w=="string"?w:w.id}),w});let g,S,m;typeof p=="string"?g=p:(g=p.id,S=p.token,m=this.driverPolicies.enableDiscovery?p.session:void 0),s=gd(t.url);try{await ce.timedExecAsync(d,{eventName:"DocPostCreateCallback",docId:g},async()=>{if(S&&this.tokenProvider.documentPostCreateCallback!==void 0)return this.tokenProvider.documentPostCreateCallback(g,S)})}catch(b){throw new yY(b)}s.set("pathname",M1(s.pathname,g));const v=t.endpoints.deltaStorageUrl;if(!v)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${v}]`);const y=new URL(v);return y.pathname=M1(y.pathname,g),this.createDocumentService(Object.assign(Object.assign({},t),{url:s.toString(),id:g,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:y.toString()})}),r,i,m)}async createDocumentService(e,t,r,i){Fr(e);const s=gd(e.url),[,o,a]=s.pathname.split("/");if(!a||!o)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${a}][tenantId:${o}]`);const l=de.create(t,"RouterliciousDriver",{all:{driverVersion:jf}}),c=async()=>{if(!this.driverPolicies.enableDiscovery)return e;const p=new eh(this.driverPolicies.maxConcurrentOrdererRequests),g=await Nc.load(o,a,this.tokenProvider,l,p,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl),S=await ce.timedExecAsync(l,{eventName:"DiscoverSession",docId:a},async()=>g.get(`/documents/${o}/session/${a}`));return D1(e,S)},u=i!==void 0?D1(e,i):await c(),d=u.endpoints.storageUrl,h=u.endpoints.ordererUrl,f=u.endpoints.deltaStorageUrl;if(!h||!f)throw new Error(`All endpoints urls must be provided. [ordererUrl:${h}][deltaStorageUrl:${f}]`);return new nY(u,h,f,d,l,this.tokenProvider,o,a,this.driverPolicies,this.blobCache,this.snapshotTreeCache,c)}}class yY extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}class SY{constructor(){}async resolve(e){const{ordererUrl:t,storageUrl:r,tenantId:i,containerId:s}=bY(e.url);if(e.headers&&e.headers[Ta.createNew]===!0)return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/new`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:"",tokens:{},type:"fluid",url:`${t}/${i}/new`};if(s===void 0)throw new Error("Azure URL did not contain containerId");const o=`${t}/${i}/${s}`;return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/${s}`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:s,tokens:{},type:"fluid",url:o}}async getAbsoluteUrl(e,t){if(e.type!=="fluid")throw new Error("Invalid Resolved Url");return`${e.url}/${t}`}}function bY(n){const e=new URL(n),t=e.origin,r=e.searchParams,i=r.get("storage");if(i===null)throw new Error("Azure URL did not contain a storage URL");const s=r.get("tenantId");if(s===null)throw new Error("Azure URL did not contain a tenant ID");const o=decodeURIComponent(i),a=decodeURIComponent(s),l=r.get("containerId"),c=l!==null?decodeURIComponent(l):void 0;return{ordererUrl:t,storageUrl:o,tenantId:a,containerId:c}}const wY=(n,e)=>{const t=new URL(n);return t.searchParams.append("storage",encodeURIComponent(n)),t.searchParams.append("tenantId",encodeURIComponent(e)),{url:t.href,headers:{[Ta.createNew]:!0}}};function AN(n){return n.type==="remote"}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const CY="local",Bu=n=>AN(n)?n.tenantId:CY,EY=5;class _Y{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new SY;const t=AN(this.props.connection);this.documentServiceFactory=new vY(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}async createContainer(e){const r=await this.createLoader(e).createDetachedContainer({package:"no-dynamic-package",config:{}}),i=await this.createFluidContainer(r,this.props.connection),s=this.getContainerServices(r);return{container:i,services:s}}async copyContainer(e,t,r){var i;const s=this.createLoader(t),o=new URL(this.props.connection.endpoint);o.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),o.searchParams.append("tenantId",encodeURIComponent(Bu(this.props.connection))),o.searchParams.append("containerId",encodeURIComponent(e));const a=await s.resolve({url:o.href});if(a.resolvedUrl===void 0)throw new Error("Source container cannot resolve URL.");const c=await(await this.documentServiceFactory.createDocumentService(a.resolvedUrl)).connectToStorage(),u={type:ph.Handle,handleType:ph.Tree,handle:(i=r==null?void 0:r.id)!==null&&i!==void 0?i:"latest"},d=await c.downloadSummary(u),h=await s.rehydrateDetachedContainerFromSnapshot(JSON.stringify(d)),f=await this.createFluidContainer(h,this.props.connection),p=this.getContainerServices(h);return{container:f,services:p}}async getContainer(e,t){const r=this.createLoader(t),i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bu(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await r.resolve({url:i.href}),o=await wc(s,"/"),a=new Tv(s,o),l=this.getContainerServices(s);return{container:a,services:l}}async getContainerVersions(e,t){var r;const i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bu(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await this.urlResolver.resolve({url:i.href});if(!s)throw new Error("Unable to resolved URL");return(await(await(await this.documentServiceFactory.createDocumentService(s)).connectToStorage()).getVersions(null,(r=t==null?void 0:t.maxCount)!==null&&r!==void 0?r:EY)).map(c=>({id:c.id,date:c.date}))}getContainerServices(e){return{audience:new oN(e)}}createLoader(e){const t=new yk(e),i={load:async()=>({module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}})},s={details:{capabilities:{interactive:!0}},permission:[],scopes:[],user:{id:""},mode:"write"};return new V5({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:i,logger:this.props.logger,options:{client:s}})}async createFluidContainer(e,t){const r=wY(t.endpoint,Bu(t)),i=await wc(e,"/"),s=async()=>{if(e.attachState!==te.Detached)throw new Error("Cannot attach container. Container is not in detached state");await e.attach(r);const a=e.resolvedUrl;return Fr(a),a.id},o=new Tv(e,i);return o.attach=s,o}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class TY{constructor(e,t){this.azFunctionUrl=e,this.user=t}async fetchOrdererToken(e,t){return{jwt:await this.getToken(e,t)}}async fetchStorageToken(e,t){return{jwt:await this.getToken(e,t)}}async getToken(e,t){var r,i,s;return(await _R.get(this.azFunctionUrl,{params:{tenantId:e,documentId:t,userId:(r=this.user)===null||r===void 0?void 0:r.userId,userName:(i=this.user)===null||i===void 0?void 0:i.userName,additionalDetails:(s=this.user)===null||s===void 0?void 0:s.additionalDetails}})).data}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const xY=Object.freeze(Object.defineProperty({__proto__:null,AzureAudience:oN,AzureClient:_Y,AzureFunctionTokenProvider:TY,get ScopeType(){return Vv}},Symbol.toStringTag,{value:"Module"})),OY=Lc(xY);var uu={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(uu,"__esModule",{value:!0});uu.LocalTimestampProvider=void 0;class fa{constructor(e=!1){this._lastTimeSent=0,e&&(fa._warned=!0)}getTimestamp(){return fa._warned||(console.warn("LiveEvent is using a LocalTimestampProvider which could cause issues when used across multiple clients."),fa._warned=!0),this._lastTimeSent=Math.max(new Date().getTime(),this._lastTimeSent+1)}getMaxTimestampError(){return 0}}fa._warned=!1;uu.LocalTimestampProvider=fa;var du={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var F1=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(du,"__esModule",{value:!0});du.TestLiveShareHost=void 0;const Vr=Kn;class Yr{static create(e,t){return new Yr(e,t)}constructor(e,t){this._getLocalTestContainerId=e,this._setLocalTestContainerId=t,this.roleCache=new Map,this.defaultRemoteRoles=[Vr.UserMeetingRole.organizer,Vr.UserMeetingRole.presenter,Vr.UserMeetingRole.attendee],this.defaultLocalRoles=[Vr.UserMeetingRole.organizer,Vr.UserMeetingRole.presenter,Vr.UserMeetingRole.attendee]}getFluidTenantInfo(){return Yr.ensureWarned(),Promise.resolve({tenantId:"local",serviceEndpoint:"http://localhost:7070"})}getFluidToken(e){return Promise.resolve(Yr.LOCAL_MODE_TEST_TOKEN)}getFluidContainerId(){const e=this.getLocalTestContainerId();return Promise.resolve({containerState:e?Vr.ContainerState.alreadyExists:Vr.ContainerState.notFound,shouldCreate:!e,containerId:e,retryAfter:0})}setFluidContainerId(e){return this.setLocalTestContainerId(e),Promise.resolve({containerState:Vr.ContainerState.added,containerId:e,shouldCreate:!1,retryAfter:0})}getNtpTime(){const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})}registerClientId(e){if(this.roleCache.has(e))throw new Error("Already registered clientId");return this.addClient(e,this.defaultLocalRoles),Promise.resolve(this.defaultLocalRoles)}addClient(e,t){return this.roleCache.set(e,t),this}getClientInfo(e){return F1(this,void 0,void 0,function*(){const t={userId:e,roles:yield this.getClientRoles(e),displayName:e.substring(0,4)};return Promise.resolve(t)})}getClientRoles(e){return F1(this,void 0,void 0,function*(){if(!e)throw new Error("TestLiveShareHost: called getClientRoles() without a clientId");let t;return this.roleCache.has(e)?t=this.roleCache.get(e):t=this.defaultRemoteRoles,Promise.resolve(t)})}getLocalTestContainerId(){return this._getLocalTestContainerId?this._getLocalTestContainerId():window.location.hash?window.location.hash.substring(1):void 0}setLocalTestContainerId(e){this._setLocalTestContainerId?this._setLocalTestContainerId(e):window.location.hash=e}static ensureWarned(){Yr._warned||(console.warn("TestLiveShareHost is being used. This should only be used for local testing purposes."),Yr._warned=!0)}}Yr.LOCAL_MODE_TEST_TOKEN="test-token";Yr._warned=!1;du.TestLiveShareHost=Yr;var hu={},PY=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(hu,"__esModule",{value:!0});hu.LiveShareRuntime=void 0;const RY=Wa,Wm=iu,Xn=Jn();class kY{constructor(e,t,r=!0){var i,s,o;this._started=!1,this._objectManager=null,this._host=r?new Xn.BackwardsCompatibilityHostDecorator(new Xn.LiveShareHostDecorator(new Xn.FormatFixHostDecorator(e))):e,this._timestampProvider=(i=t==null?void 0:t.timestampProvider)!==null&&i!==void 0?i:new Wm.HostTimestampProvider(this._host),this._roleVerifier=(s=t==null?void 0:t.roleVerifier)!==null&&s!==void 0?s:new Xn.RoleVerifier(this._host),this._canSendBackgroundUpdates=(o=t==null?void 0:t.canSendBackgroundUpdates)!==null&&o!==void 0?o:!0}get objectManager(){return(0,RY.assert)(this._objectManager!==null,"LiveObjectSynchronizerManager not initialized."),this._objectManager}get timestampProvider(){return this._timestampProvider}get host(){return this._host}get canSendBackgroundUpdates(){return this._canSendBackgroundUpdates}set canSendBackgroundUpdates(e){this._canSendBackgroundUpdates=e}getTimestamp(){return this._timestampProvider.getTimestamp()}verifyRolesAllowed(e,t){return this._roleVerifier.verifyRolesAllowed(e,t)}getClientInfo(e){return this._host.getClientInfo(e)}setTimestampProvider(e){this._timestampProvider=e}setRoleVerifier(e){this._roleVerifier=e}setHost(e,t=!0){this._host=t?new Xn.BackwardsCompatibilityHostDecorator(new Xn.LiveShareHostDecorator(e)):e,this._timestampProvider instanceof Wm.HostTimestampProvider&&(this._timestampProvider.stop(),this.setTimestampProvider(new Wm.HostTimestampProvider(this._host))),this._roleVerifier instanceof Xn.RoleVerifier&&this.setRoleVerifier(new Xn.RoleVerifier(this._host))}setAudience(e){var t;this._audience=e,(t=this._objectManager)===null||t===void 0||t.setAudience(this._audience)}start(){return PY(this,void 0,void 0,function*(){if(this._started)throw new Error("LiveShareRuntime.start(): cannot call start when already started");this._started=!0,this._objectManager&&this.startObjectSynchronizerManager(),(0,Xn.isTimestampProvider)(this._timestampProvider)&&!this._timestampProvider.isRunning&&(yield this._timestampProvider.start())})}stop(){var e;if(!this._started)throw new Error("LiveShareRuntime.stop(): cannot call stop when not already started");this._started=!1,(0,Xn.isTimestampProvider)(this._timestampProvider)&&this._timestampProvider.isRunning&&this._timestampProvider.stop(),(e=this._objectManager)===null||e===void 0||e.stop()}__dangerouslySetContainerRuntime(e){if(this._containerRuntime!==e){if(this._containerRuntime=e,this._objectManager){this._objectManager.__dangerouslySetContainerRuntime(e);return}this._objectManager=new Xn.LiveObjectManager(this,this._containerRuntime),this.startObjectSynchronizerManager()}}startObjectSynchronizerManager(){this.objectManager.start()}}hu.LiveShareRuntime=kY;var oi={},NY=G&&G.__setFunctionName||function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};Object.defineProperty(oi,"__esModule",{value:!0});oi.getLiveDataObjectClass=oi.getLiveContainerSchemaProxy=oi.getLiveContainerSchema=void 0;function MN(n,e){var t;const r=new Map,i=Object.entries(n.initialObjects).map(([o,a])=>[o,sy(a,e,r)]);return{initialObjects:Object.fromEntries(i),dynamicObjectTypes:(t=n.dynamicObjectTypes)===null||t===void 0?void 0:t.map(o=>sy(o,e,r))}}oi.getLiveContainerSchema=MN;function LY(n,e){return MN(n,e)}oi.getLiveContainerSchemaProxy=LY;function sy(n,e,t=new Map){if(IY(n)){const r=n.TypeName,i=t.get(r);if(i!==void 0)return i;const s=AY(n,e);return t.set(r,s),s}return n}oi.getLiveDataObjectClass=sy;function IY(n){return n.LiveEnabled===!0}function AY(n,e){var t;class r extends n{constructor(o){if(super(o),this.__dangerouslySetLiveRuntime(e),!this.context||!this.context.containerRuntime)throw Error("getLiveDataObjectProxyClassInternal: required dependencies unknown");this.context.clientDetails.capabilities.interactive!==!1&&e.__dangerouslySetContainerRuntime(this.context.containerRuntime)}}return t=class extends n{},NY(t,"DynamicClass"),t.TypeName=n.TypeName,t.factory=new Proxy(n.factory,{get:function(s,o,a){return o==="ctor"?r:Reflect.get(s,o,a)}}),t}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Gm=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Df,"__esModule",{value:!0});Df.LiveShareClient=void 0;const z1=Jn(),MY=OY,DY=Kn,FY=uu,DN=du,zY=hu,$Y=oi,$1=new Map().set("https://alfred.westus2.fluidrelay.azure.com","https://us.fluidrelay.azure.com").set("https://alfred.westeurope.fluidrelay.azure.com","https://eu.fluidrelay.azure.com").set("https://alfred.southeastasia.fluidrelay.azure.com","https://globalThis.fluidrelay.azure.com");class jY{constructor(e,t){if(this._host=DN.TestLiveShareHost.create(void 0,void 0),this.maxContainerLookupTries=3,!e)throw new Error(`LiveShareClient: prop \`host\` is \`${e}\` when it is expected to be a non-optional value of type \`ILiveShareHost\`. Please ensure \`host\` is defined before initializing \`LiveShareClient\`.`);if(typeof e.getFluidTenantInfo!="function")throw new Error(`LiveShareClient: \`host.getFluidTenantInfo\` is of type \`${typeof e.getFluidTenantInfo}\` when it is expected to be a type of \`function\`. For more information, review the \`ILiveShareHost\` interface.`);this._host=e,this._options=Object.assign(Object.assign({},t),{timestampProvider:j1(e,t)?new FY.LocalTimestampProvider:t==null?void 0:t.timestampProvider}),this._runtime=new zY.LiveShareRuntime(this._host,this._options,!0)}get isTesting(){return j1(this._host,this._options)}get canSendBackgroundUpdates(){return this._runtime.canSendBackgroundUpdates}set canSendBackgroundUpdates(e){this._runtime.canSendBackgroundUpdates=e}joinContainer(e,t){return Gm(this,void 0,void 0,function*(){performance.mark("TeamsSync: join container");try{const r=this._runtime.start(),i=(0,$Y.getLiveContainerSchema)(e,this._runtime);let s=this._options.connection;if(!s){const c=yield this._host.getFluidTenantInfo();let u=c.serviceEndpoint;if(!u)if($1.has(c.serviceEndpoint))u=$1.get(c.serviceEndpoint);else throw new Error(`LiveShareClient:joinContainer - unable to find fluid endpoint for: ${c.serviceEndpoint}`);c.tenantId=="local"?s={type:"local",endpoint:u,tokenProvider:yield(0,z1.getInsecureTokenProvider)()}:s={type:"remote",tenantId:c.tenantId,endpoint:u,tokenProvider:new z1.LiveShareTokenProvider(this._host)}}const o=new MY.AzureClient({connection:s,logger:this._options.logger}),a=this.getOrCreateContainer(o,i,0,t),l=yield Promise.all([a,r]);return this._runtime.setAudience(l[0].services.audience),performance.mark("TeamsSync: container connecting"),this._results=Object.assign(Object.assign({},l[0]),{timestampProvider:this._runtime.timestampProvider}),this._results}finally{performance.measure("TeamsSync: container joined","TeamsSync: join container")}})}getOrCreateContainer(e,t,r,i){return Gm(this,void 0,void 0,function*(){const s=yield this._host.getFluidContainerId();if(s.shouldCreate)return yield this.createNewContainer(e,t,r,i);if(s.containerId)return Object.assign({created:!1},yield e.getContainer(s.containerId,t));if(r<this.maxContainerLookupTries&&s.retryAfter>0)return yield this.wait(s.retryAfter),yield this.getOrCreateContainer(e,t,r+1,i);throw new Error("LiveShareClient: timed out attempting to create or get container for current context.")})}createNewContainer(e,t,r,i){return Gm(this,void 0,void 0,function*(){const{container:s,services:o}=yield e.createContainer(t);i&&i(s);const a=yield s.attach(),l=yield this._host.setFluidContainerId(a);return l.containerState!=DY.ContainerState.added?(s.dispose(),Object.assign({created:!1},yield e.getContainer(l.containerId,t))):{container:s,services:o,created:!0}})}wait(e){return new Promise(t=>{setTimeout(()=>t(),e)})}}Df.LiveShareClient=jY;function j1(n,e){var t;return((t=e==null?void 0:e.connection)===null||t===void 0?void 0:t.type)=="local"||n instanceof DN.TestLiveShareHost}var FN={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=G&&G.__awaiter||function(d,h,f,p){function g(S){return S instanceof f?S:new f(function(m){m(S)})}return new(f||(f=Promise))(function(S,m){function v(w){try{b(p.next(w))}catch(T){m(T)}}function y(w){try{b(p.throw(w))}catch(T){m(T)}}function b(w){w.done?S(w.value):g(w.value).then(v,y)}b((p=p.apply(d,h||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveTimer=n.LiveTimerEvents=void 0;const t=Va,r=Co,i=Kn,s=Qa(),o=yi,a=Ja(),l=wo();var c;(function(d){d.started="started",d.played="played",d.paused="paused",d.finished="finished",d.onTick="onTick"})(c=n.LiveTimerEvents||(n.LiveTimerEvents={}));class u extends a.LiveDataObject{constructor(){super(...arguments),this._currentConfig={clientId:"",timestamp:0,data:{duration:0,position:0,running:!1}},this._defaultTickRate=20,this._tickRate=this._defaultTickRate}get tickRate(){return this._tickRate}set tickRate(h){this._tickRate=h}initialize(h){return e(this,void 0,void 0,function*(){l.LiveDataObjectInitializeNotNeededError.assert("LiveTimer:initialize",this.initializeState),l.UnexpectedError.assert(!this._synchronizer,"LiveTimer:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._allowedRoles=h||[],this._synchronizer=new r.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentConfig.data,(f,p)=>e(this,void 0,void 0,function*(){return yield this.remoteConfigReceived(f,p)}),f=>e(this,void 0,void 0,function*(){if(f)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(f){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,f}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}start(h){return e(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveTimer:start","start",this.initializeState),yield this.playInternal(h,0)})}play(){return e(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveTimer:play","play",this.initializeState),!this._currentConfig.data.running&&this._currentConfig.data.position<this._currentConfig.data.duration&&(yield this.playInternal(this._currentConfig.data.duration,this._currentConfig.data.position))})}playInternal(h,f){return e(this,void 0,void 0,function*(){const p={timestamp:this.liveRuntime.getTimestamp(),clientId:yield this.waitUntilConnected(),data:{duration:h,position:f,running:!0}};yield this.updateConfig(p,!0)})}pause(){return e(this,void 0,void 0,function*(){if(l.LiveDataObjectNotInitializedError.assert("LiveTimer:pause","pause",this.initializeState),this._currentConfig.data.running){const h=this.liveRuntime.getTimestamp(),f={timestamp:h,clientId:yield this.waitUntilConnected(),data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.position+(h-this._currentConfig.timestamp),running:!1}};yield this.updateConfig(f,!0)}})}remoteConfigReceived(h,f){return e(this,void 0,void 0,function*(){try{const p=yield this.liveRuntime.verifyRolesAllowed(f,this._allowedRoles),g={timestamp:this._currentConfig.timestamp,clientId:this._currentConfig.clientId},S=s.LiveEvent.isNewer(g,h),m=this.liveRuntime.getTimestamp(),v=this.endTimeFromConfig(h);if(p&&this._currentConfig.timestamp===0&&h.data.running===!0&&m>=v){const y={timestamp:v,clientId:h.clientId,data:{duration:h.data.duration,position:h.data.duration,running:!1}};return this.updateConfig(y,!1),!0}return JSON.stringify(this._currentConfig.data)===JSON.stringify(h.data)&&this._currentConfig.timestamp===h.timestamp?!1:p&&S?(this.updateConfig(h,!1),!0):!1}catch{return!1}})}updateConfig(h,f){return e(this,void 0,void 0,function*(){const p=Object.assign({clientId:h.clientId,configChangedAt:h.timestamp},h.data);if(this._currentConfig=h,h.data.position===0?this.emit(c.started,p,f):h.data.duration===h.data.position?this.emit(c.finished,p):h.data.running?this.emit(c.played,p,f):this.emit(c.paused,p,f),h.data.running&&this.startTicking(),f)return yield this._synchronizer.sendEvent(h.data)})}startTicking(){const h=()=>{if(this._currentConfig.data.running){const f=this.liveRuntime.getTimestamp(),p=this.endTimeFromConfig(this._currentConfig);if(f>=p){const g={timestamp:p,clientId:this._currentConfig.clientId,data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.duration,running:!1}};this.updateConfig(g,!1).catch(S=>{console.error(S)})}else this.emit(c.onTick,p-f),this.scheduleAnimationFrame(h)}};this.scheduleAnimationFrame(h)}scheduleAnimationFrame(h){this._tickRate<=this._defaultTickRate&&typeof requestAnimationFrame=="function"?requestAnimationFrame(h):setTimeout(h,this._tickRate)}endTimeFromConfig(h){return h.timestamp-h.data.position+h.data.duration}}u.TypeName="@microsoft/live-share:LiveTimer",u.factory=new t.DataObjectFactory(u.TypeName,u,[],{}),n.LiveTimer=u,o.DynamicObjectRegistry.registerObjectClass(u,u.TypeName)})(FN);var Bf={},Wr=G&&G.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Bf,"__esModule",{value:!0});Bf.AzureLiveShareHost=void 0;const q1=Kn,qY=Jn();class XS{constructor(e){this._shouldWarnLocalTimestamp=e,this._azureAudienceDeferred=new qY.Deferred,this.hasWarned=!1}static create(e=!0){return new XS(e)}setAudience(e){this._azureAudienceDeferred.resolve(e)}registerClientId(e){var t;return Wr(this,void 0,void 0,function*(){const r=yield this.getClientInfo(e);return(t=r==null?void 0:r.roles)!==null&&t!==void 0?t:[]})}getClientInfo(e){return Wr(this,void 0,void 0,function*(){const t=yield this.getAudienceMemberInfo(e);if(!t)throw new Error("AzureLiveShareHost.getClientInfo: audience member not found");return{userId:t.userId,roles:this.getRolesForAudienceMember(t),displayName:t.userName}})}getNtpTime(){return Wr(this,void 0,void 0,function*(){!this.hasWarned&&this._shouldWarnLocalTimestamp&&(console.warn(`AzureLiveShareHost is using a local timestamp, which could cause issues when use some LiveDataObject data structures across multiple clients.

                To disable this warning, set _shouldWarn in AzureLiveShareHost.create() to false.

                To resolve synchronization issues you may encounter, you should implement a service API to get this timestamp value and override this function.`),this.hasWarned=!0);const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})})}getClientRoles(e){return Wr(this,void 0,void 0,function*(){const t=yield this.getClientInfo(e);return t==null?void 0:t.roles})}getFluidTenantInfo(){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidTenantInfo: not implemented exception")})}getFluidToken(e){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidToken: not implemented exception")})}getFluidContainerId(){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidContainerId: not implemented exception")})}setFluidContainerId(e){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.setFluidContainerId: not implemented exception")})}getAudienceMemberInfo(e){return Wr(this,void 0,void 0,function*(){const r=[...(yield this._azureAudienceDeferred.promise).getMembers().values()];for(let i=0;i<r.length;i++){const s=r[i];if(s.connections.find(o=>o.id===e))return s}})}getRolesForAudienceMember(e){return e.connections.length===0?[]:e.connections[e.connections.length-1].mode==="write"?[q1.UserMeetingRole.presenter]:[q1.UserMeetingRole.attendee]}}Bf.AzureLiveShareHost=XS;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=G&&G.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=G&&G.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(yi,n),t(iu,n),t(Kn,n),t(Qa(),n),t(iN(),n),t(cu,n),t(lu,n),t(Af,n),t(FS,n),t(Mf(),n),t(sN,n),t(Df,n),t($S,n),t(Eo,n),t(FN,n),t(uu,n),t(du,n),t(Xa,n),t(su,n),t(oi,n),t(Ja(),n),t(hu,n),t(Bf,n),t(Co,n),t(wo(),n)})(Ud);const B1={initialObjects:{bus:Ud.LiveEvent,flags:xc,phase:Ud.LiveState}},zN=B.createContext({container:null,bus:null,flags:null,phase:null,loading:!0,error:null}),YS=()=>{const n=B.useContext(zN);if(!n)throw new Error("useLiveShare must be used within a LiveShareProvider");return n},$N=({children:n})=>{const[e,t]=B.useState(!0),[r,i]=B.useState(null),s=B.useRef(null),o=B.useRef(null),a=B.useRef(null),l=B.useRef(null);B.useEffect(()=>{let u=!0;return(async()=>{try{console.log("[LiveShareProvider] ==================== STARTING INITIALIZATION ===================="),console.log("[LiveShareProvider] Step 1: Initializing Teams SDK..."),await Ah(),console.log("[LiveShareProvider] ✅ Teams SDK initialized successfully"),console.log("[LiveShareProvider] Step 2: Creating LiveShareHost...");const h=s0.create();console.log("[LiveShareProvider] ✅ LiveShareHost created:",h),console.log("[LiveShareProvider] Step 3: Creating LiveShareClient...");const f=new Ud.LiveShareClient(h);console.log("[LiveShareProvider] ✅ LiveShareClient created:",f),console.log("[LiveShareProvider] Step 4: Joining container with schema:",B1);const{container:p}=await f.joinContainer(B1);if(console.log("[LiveShareProvider] ✅ Container joined successfully:",p),!u){console.log("[LiveShareProvider] ⚠️ Component unmounted during initialization, aborting");return}console.log("[LiveShareProvider] Step 5: Extracting Live Share objects..."),s.current=p,o.current=p.initialObjects.bus,a.current=p.initialObjects.flags,l.current=p.initialObjects.phase,console.log("[LiveShareProvider] ✅ Live Share objects extracted:"),console.log("[LiveShareProvider] - bus:",o.current),console.log("[LiveShareProvider] - flags:",a.current),console.log("[LiveShareProvider] - phase:",l.current);const g=o.current,S=a.current,m=l.current;if(console.log("[LiveShareProvider] Step 6: Initializing LiveEvent (bus)..."),g&&typeof g.initialize=="function"?(console.log("[LiveShareProvider] Calling bus.initialize()..."),await g.initialize(),console.log("[LiveShareProvider] ✅ LiveEvent initialized successfully")):console.log("[LiveShareProvider] ⚠️ Bus object missing or no initialize method:",g),console.log("[LiveShareProvider] Step 7: Initializing LiveState..."),m&&typeof m.initialize=="function"?(console.log("[LiveShareProvider] Calling phase.initialize('idle')..."),await m.initialize("idle"),console.log("[LiveShareProvider] ✅ LiveState initialized with 'idle'")):console.log("[LiveShareProvider] ⚠️ Phase object missing or no initialize method:",m),console.log("[LiveShareProvider] Step 8: Setting SharedMap defaults..."),S){const v=S.get("roundVisible"),y=S.get("editingEnabled"),b=S.get("clearAllCounter");console.log("[LiveShareProvider] Current SharedMap values:"),console.log("[LiveShareProvider] - roundVisible:",v),console.log("[LiveShareProvider] - editingEnabled:",y),console.log("[LiveShareProvider] - clearAllCounter:",b),v===void 0&&(console.log("[LiveShareProvider] Setting roundVisible = false"),S.set("roundVisible",!1)),y===void 0&&(console.log("[LiveShareProvider] Setting editingEnabled = false"),S.set("editingEnabled",!1)),b===void 0&&(console.log("[LiveShareProvider] Setting clearAllCounter = 0"),S.set("clearAllCounter",0)),console.log("[LiveShareProvider] ✅ SharedMap defaults set")}else console.log("[LiveShareProvider] ⚠️ Flags object is null/undefined");console.log("[LiveShareProvider] ==================== INITIALIZATION COMPLETE ====================")}catch(h){console.error("[LiveShareProvider] ❌ INITIALIZATION FAILED:"),console.error("[LiveShareProvider] Error type:",typeof h),console.error("[LiveShareProvider] Error message:",h instanceof Error?h.message:String(h)),console.error("[LiveShareProvider] Error stack:",h instanceof Error?h.stack:"No stack trace"),console.error("[LiveShareProvider] Full error object:",h),u&&i(h instanceof Error?h.message:String(h))}finally{u&&(console.log("[LiveShareProvider] Setting loading = false"),t(!1))}})(),()=>{u=!1}},[]);const c={container:s.current,bus:o.current,flags:a.current,phase:l.current,loading:e,error:r};return console.log("[LiveShareProvider] Context value update:"),console.log("[LiveShareProvider] - container:",c.container),console.log("[LiveShareProvider] - bus:",c.bus),console.log("[LiveShareProvider] - flags:",c.flags),console.log("[LiveShareProvider] - phase:",c.phase),console.log("[LiveShareProvider] - loading:",c.loading),console.log("[LiveShareProvider] - error:",c.error),D.jsx(zN.Provider,{value:c,children:n})};function BY({onCanvasReady:n,onControlsReady:e,userInfo:t}){console.log("[PrivateCanvas] ===== COMPONENT MOUNT/RENDER =====",{userInfo:t});const r=B.useRef(null),i=B.useRef(null),s=B.useRef(null),o=B.useRef(!1);B.useEffect(()=>(console.log("[PrivateCanvas] Component mounted!"),()=>{console.log("[PrivateCanvas] ===== COMPONENT UNMOUNTING =====")}),[]);const{bus:a,flags:l,loading:c}=YS(),[u,d]=B.useState(!0);B.useEffect(()=>{console.log("[PrivateCanvas] Canvas editing enabled state changed to:",u)},[u]);const[h,f]=B.useState([]),[p,g]=B.useState([]);B.useEffect(()=>{const _=r.current;_&&(f([_.toDataURL()]),g([]))},[]);const S=()=>{const _=r.current;_&&(f(R=>[...R,_.toDataURL()]),g([]))},[m,v]=B.useState({tool:"pen",color:"#000000",penSize:5,eraserSize:20,fontSize:16,isDrawing:!1,lastPoint:null}),[y,b]=B.useState({visible:!1,x:0,y:0,text:"",fontSize:16}),w=()=>y.visible?y.text.trim()?(console.log("[PrivateCanvas] commitOrHideActiveText: committing text due to navigation away"),O(y.text),!0):(console.log("[PrivateCanvas] commitOrHideActiveText: hiding empty text input due to navigation away"),b(_=>({..._,visible:!1})),!1):!1;B.useEffect(()=>{console.log("[PrivateCanvas] ===== CANVAS INITIALIZATION STARTING =====");const _=r.current;if(!_){console.log("[PrivateCanvas] ❌ No canvas ref available!");return}console.log("[PrivateCanvas] ✅ Canvas ref found:",_);const R=_.getContext("2d");if(!R){console.log("[PrivateCanvas] ❌ Failed to get 2D context!");return}console.log("[PrivateCanvas] ✅ Canvas context obtained:",R);const M=()=>{var se;const H=(se=_.parentElement)==null?void 0:se.getBoundingClientRect();if(H&&(_.width!==H.width||_.height!==H.height)){const ge=R.getImageData(0,0,_.width,_.height);_.width=H.width,_.height=H.height,R.putImageData(ge,0,0),R.lineCap="round",R.lineJoin="round",R.imageSmoothingEnabled=!0,console.log("[PrivateCanvas] Resized canvas to",_.width,_.height)}};return R.lineCap="round",R.lineJoin="round",R.imageSmoothingEnabled=!0,M(),window.addEventListener("resize",M),i.current=R,console.log("[PrivateCanvas] ✅ Canvas initialized successfully!",{canvasWidth:_.width,canvasHeight:_.height,hasContext:!!R,contextRef:!!i.current}),console.log("[PrivateCanvas] ===== CANVAS INITIALIZATION COMPLETE ====="),n==null||n(_,R),()=>{window.removeEventListener("resize",M)}},[n]),B.useEffect(()=>{if(!a||c){console.log("[PrivateCanvas] Live Share bus not ready yet, skipping event listener setup");return}console.log("[PrivateCanvas] Setting up Live Share event listeners");const _=R=>{switch(console.log("[PrivateCanvas] Received Live Share event:",R),R.type){case"clearAll":console.log("[PrivateCanvas] Handling clearAll event"),C();break;case"enableCanvas":console.log("[PrivateCanvas] Ignoring enableCanvas event - private canvas should always be enabled");break;case"disableCanvas":console.log("[PrivateCanvas] Ignoring disableCanvas event - private canvas should always be enabled");break;case"shareCanvas":console.log("[PrivateCanvas] Handling shareCanvas event - exporting canvas data");const M=k();M&&a&&(a.send({type:"canvasData",...M}),console.log("[PrivateCanvas] Canvas data sent to stage for user:",M.userName));break;default:console.log("[PrivateCanvas] Unhandled Live Share event type:",R.type)}};return a.on("received",_),()=>{console.log("[PrivateCanvas] Cleaning up Live Share event listeners"),a.off("received",_)}},[a,c,y.visible,y.text]),B.useEffect(()=>{console.log("[PrivateCanvas] Ensuring private canvas is always enabled"),d(!0)},[l,c]),B.useEffect(()=>{const _=setTimeout(()=>{var H;const R=r.current,M=i.current;if(R&&M){console.log("[PrivateCanvas] Force reinitializing canvas after delay...");const se=(H=R.parentElement)==null?void 0:H.getBoundingClientRect();se&&(R.width===0||R.height===0||R.width!==se.width||R.height!==se.height)?(console.log("[PrivateCanvas] Canvas has invalid size, forcing resize:",{currentSize:{width:R.width,height:R.height},targetSize:{width:se.width,height:se.height}}),R.width=se.width,R.height=se.height,M.lineCap="round",M.lineJoin="round",M.imageSmoothingEnabled=!0,console.log("[PrivateCanvas] ✅ Canvas force reinitialized successfully!")):console.log("[PrivateCanvas] Canvas size appears correct, no reinitialization needed")}},1e3);return()=>clearTimeout(_)},[]);const T=_=>{const R=r.current;if(!R)return console.log("[PrivateCanvas] ❌ getCanvasPoint: No canvas ref!"),{x:0,y:0};const M=R.getBoundingClientRect(),H=R.width/M.width,se=R.height/M.height;if(console.log("[PrivateCanvas] getCanvasPoint: canvas state check",{hasCanvas:!!R,canvasWidth:R.width,canvasHeight:R.height,rectWidth:M.width,rectHeight:M.height,scaleX:H,scaleY:se,hasContext:!!i.current}),"touches"in _&&_.touches.length>0){const ge={x:(_.touches[0].clientX-M.left)*H,y:(_.touches[0].clientY-M.top)*se};return console.log("[PrivateCanvas] Touch point:",ge,"from",_.touches[0].clientX,_.touches[0].clientY),ge}else{const ge=_,je={x:(ge.clientX-M.left)*H,y:(ge.clientY-M.top)*se};return console.log("[PrivateCanvas] Mouse point:",je,"from",ge.clientX,ge.clientY),je}},E=_=>{console.log("[PrivateCanvas] handleTextInput called, current textInput visible:",y.visible,"text:",y.text),y.visible&&y.text.trim()&&(console.log("[PrivateCanvas] Committing existing text before creating new input:",y.text),O(y.text));const R=T(_),M=r.current;if(!M)return;const H=M.getBoundingClientRect(),se=H.left+R.x*H.width/M.width,ge=H.top+R.y*H.height/M.height;b({visible:!0,x:se,y:ge,text:"",fontSize:m.fontSize}),setTimeout(()=>{var je;(je=s.current)==null||je.focus()},10),console.log("[PrivateCanvas] Showing text input at",{point:R,displayX:se,displayY:ge})},O=_=>{S();const R=i.current,M=r.current,H=_||y.text,se=y.fontSize,ge=y.x,je=y.y;if(console.log("[PrivateCanvas] commitText: Hiding text input, finalText:",H),b(mn=>({...mn,visible:!1})),!H.trim()||!R||!M){console.log("[PrivateCanvas] No text to commit or missing context/canvas");return}const qe=M.getBoundingClientRect(),dt=(ge-qe.left)/qe.width*M.width,Nt=(je-qe.top)/qe.height*M.height;R.globalCompositeOperation="source-over",R.fillStyle=m.color,R.font=`${se}px "Comic Sans MS", cursive, sans-serif`,R.textAlign="left",R.textBaseline="top",R.globalAlpha=1,R.fillText(H,dt,Nt),console.log("[PrivateCanvas] Added text:",H,"at",{canvasX:dt,canvasY:Nt},"fontSize:",se)},A=_=>{_.key==="Enter"?O():_.key==="Escape"&&(console.log("[PrivateCanvas] handleTextInputKeyDown: Escape pressed, hiding text input with text:",y.text),b(R=>({...R,visible:!1})))},F=_=>{_.preventDefault();const R=_.deltaY>0?-2:2,M=Math.max(10,Math.min(72,y.fontSize+R));b(H=>({...H,fontSize:M})),console.log("[PrivateCanvas] Mouse wheel font size changed to:",M)},X=_=>{console.log("[PrivateCanvas] handleTextInputBlur called! Event target:",_.target),setTimeout(()=>{var ge;const R=_.target.value||"",M=((ge=s.current)==null?void 0:ge.value)||"",H=y.text||"",se=R||M||H;console.log("[PrivateCanvas] Blur event - eventText:",R,"refText:",M,"stateText:",H,"using:",se),se.trim()?O(se):(console.log("[PrivateCanvas] handleTextInputBlur: No text to commit, hiding text input"),b(je=>({...je,visible:!1})))},0)},z=_=>{_.preventDefault(),console.log("[PrivateCanvas] startDrawing called - PRIVATE CANVAS ALWAYS ENABLED, tool:",m.tool);const R=T(_);if(console.log("[PrivateCanvas] Start drawing at",R,"with state",m),m.tool==="text"){E(_);return}w(),v(H=>({...H,isDrawing:!0,lastPoint:R}));const M=i.current;if(!M){console.log("[PrivateCanvas] ❌ No context available for drawing!");return}switch(console.log("[PrivateCanvas] ✅ Context available, starting drawing with tool:",m.tool),m.tool){case"pen":M.globalCompositeOperation="source-over",M.strokeStyle=m.color,M.lineWidth=m.penSize,M.globalAlpha=1;break;case"eraser":M.globalCompositeOperation="destination-out",M.lineWidth=m.eraserSize;break}M.beginPath(),M.moveTo(R.x,R.y)},Z=_=>{if((!m.isDrawing||m.tool==="text")&&!o.current)return;_.preventDefault();const R=T(_),M=i.current;M&&(M.lineTo(R.x,R.y),M.stroke(),console.log("[PrivateCanvas] Draw to",R,o.current?"(right-erase)":""),v(H=>({...H,lastPoint:R})))},W=()=>{m.isDrawing&&S(),v(M=>({...M,isDrawing:!1,lastPoint:null}));const _=i.current,R=r.current;!_||!R||(_.beginPath(),o.current&&(_.globalCompositeOperation="source-over",o.current=!1),console.log("[PrivateCanvas] Stop drawing"))},C=()=>{S();const _=i.current,R=r.current;!_||!R||(_.clearRect(0,0,R.width,R.height),console.log("[PrivateCanvas] Canvas cleared"))},k=()=>{const _=r.current;if(!_)return console.log("[PrivateCanvas] Cannot export canvas data - no canvas ref"),null;try{const M={imageData:_.toDataURL("image/png"),width:_.width,height:_.height,userName:(t==null?void 0:t.displayName)||(t==null?void 0:t.userPrincipalName)||"Unknown User",userId:(t==null?void 0:t.id)||(t==null?void 0:t.userObjectId)||(t==null?void 0:t.aadObjectId)||"unknown",timestamp:Date.now()};return console.log("[PrivateCanvas] Exported canvas data for user:",M.userName),M}catch(R){return console.error("[PrivateCanvas] Error exporting canvas data:",R),null}},V=()=>{const _=r.current,R=i.current;f(M=>{if(M.length<=1||!_||!R)return console.log("[PrivateCanvas] Undo: nothing to undo. Undo stack length:",M.length),M;const H=p.length;g(je=>[_.toDataURL(),...je]);const se=M[M.length-2],ge=new window.Image;return ge.onload=()=>{R.clearRect(0,0,_.width,_.height),R.drawImage(ge,0,0,_.width,_.height),console.log("[PrivateCanvas] Undo: restored previous state. Undo stack length:",M.length-1,"Redo stack length:",H+1)},ge.src=se,M.slice(0,-1)})},I=()=>{const _=r.current,R=i.current;g(M=>M.length===0||!_||!R?(console.log("[PrivateCanvas] Redo: nothing to redo. Redo stack length:",M.length),M):(f(H=>{const se=new window.Image;return se.onload=()=>{R.clearRect(0,0,_.width,_.height),R.drawImage(se,0,0,_.width,_.height),console.log("[PrivateCanvas] Redo: restored next state. Undo stack length:",H.length+1,"Redo stack length:",M.length-1)},se.src=M[0],[...H,M[0]]}),M.slice(1)))},U=_=>{console.log("[PrivateCanvas] Tool change requested to",_,"current textInput visible:",y.visible,"text:",y.text),y.visible&&y.text.trim()?(console.log("[PrivateCanvas] Committing active text before tool change:",y.text),O(y.text)):y.visible&&(console.log("[PrivateCanvas] Hiding empty text input before tool change"),b(R=>({...R,visible:!1}))),v(R=>(console.log("[PrivateCanvas] Tool changed to",_),{...R,tool:_}))},x=_=>{w(),v(R=>(console.log("[PrivateCanvas] Color changed to",_),{...R,color:_}))},j=_=>{w(),v(R=>(console.log("[PrivateCanvas] Pen size changed to",_),{...R,penSize:_}))},Q=_=>{w(),v(R=>(console.log("[PrivateCanvas] Eraser size changed to",_),{...R,eraserSize:_}))},me=_=>{w(),v(R=>(console.log("[PrivateCanvas] Font size changed to",_),{...R,fontSize:_}))};return B.useEffect(()=>{const _={setTool:U,setColor:x,setPenSize:j,setEraserSize:Q,setFontSize:me,clearCanvas:C,undo:V,redo:I,drawingState:m};console.log("[PrivateCanvas] Exposing controls to parent (one time only)"),e==null||e(_)},[]),B.useEffect(()=>{e&&e({setTool:U,setColor:x,setPenSize:j,setEraserSize:Q,setFontSize:me,clearCanvas:C,undo:V,redo:I,drawingState:m})},[m.tool,m.penSize,m.eraserSize,m.fontSize,m.color]),B.useEffect(()=>{if(!y.visible)return;const _=R=>{const M=r.current,H=s.current;M&&(H&&(H===R.target||H.contains(R.target))||M===R.target||M.contains(R.target)||w())};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[y.visible,y.text,y.x,y.y]),D.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[D.jsx("canvas",{ref:r,onContextMenu:_=>{_.preventDefault()},onMouseDown:_=>{if(console.log("[PrivateCanvas] Mouse down event - button:",_.button,"PRIVATE CANVAS ALWAYS ENABLED"),_.button===1){_.preventDefault(),y.visible&&y.text.trim()&&O(y.text),E(_);return}if(_.button===2){_.preventDefault();const R=T(_),M=i.current;M&&(o.current=!0,v(H=>({...H,isDrawing:!0,lastPoint:R})),M.globalCompositeOperation="destination-out",M.lineWidth=m.eraserSize,M.beginPath(),M.moveTo(R.x,R.y));return}z(_)},onMouseMove:_=>{Z(_)},onMouseUp:_=>{console.log("[PrivateCanvas] Mouse up event",_),W()},onMouseLeave:_=>{console.log("[PrivateCanvas] Mouse leave event",_),W()},onTouchStart:_=>{console.log("[PrivateCanvas] Touch start event - PRIVATE CANVAS ALWAYS ENABLED"),z(_)},onTouchMove:_=>{console.log("[PrivateCanvas] Touch move event",_),Z(_)},onTouchEnd:_=>{console.log("[PrivateCanvas] Touch end event",_),W()},style:{width:"100%",height:"100%",display:"block",touchAction:"none",cursor:m.tool==="eraser"?"grab":m.tool==="text"?"text":`url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23000' d='M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z'/%3E%3C/svg%3E") 2 22, crosshair`}}),y.visible&&D.jsxs("div",{style:{position:"fixed",left:y.x,top:y.y-30,zIndex:1e3},children:[D.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"11px",marginBottom:"2px",whiteSpace:"nowrap"},children:["Mouse wheel to resize (",y.fontSize,"px)"]}),D.jsx("input",{ref:s,type:"text",value:y.text,onChange:_=>b(R=>({...R,text:_.target.value})),onKeyDown:A,onBlur:X,onWheel:F,style:{border:"none",borderRadius:"0",padding:"0",fontSize:`${y.fontSize}px`,fontFamily:'"Comic Sans MS", cursive, sans-serif',color:m.color,backgroundColor:"transparent",outline:"none",minWidth:"120px"},placeholder:"Type text..."})]})]})}function UY({canvasControls:n,userInfo:e,meetingInfo:t}){const{setTool:r,setColor:i,setPenSize:s,setEraserSize:o,setFontSize:a,clearCanvas:l,drawingState:c}=n,[u,d]=B.useState(!1),[h,f]=B.useState(!1),[p,g]=B.useState(!1),[S,m]=B.useState(null),[v,y]=B.useState(null),[b,w]=B.useState(null),T=x=>{console.log("[PrivateToolbar] Tool button clicked:",x),r(x)},E=x=>{console.log("[PrivateToolbar] Color button clicked:",x),i(x)},O=x=>{const j=Number(x.target.value);console.log("[PrivateToolbar] Pen size changed:",j),c.tool!=="pen"&&T("pen"),s(j)},A=x=>{const j=Number(x.target.value);console.log("[PrivateToolbar] Eraser size changed:",j),c.tool!=="eraser"&&T("eraser"),o(j)},F=x=>{const j=Number(x.target.value);console.log("[PrivateToolbar] Font size changed:",j),c.tool!=="text"&&T("text"),a(j)},X=()=>{console.log("[PrivateToolbar] Clear button clicked"),l()},z=()=>{console.log("[PrivateToolbar] Undo button clicked"),n.undo?(console.log("[PrivateToolbar] Calling canvasControls.undo"),n.undo(),console.log("[PrivateToolbar] canvasControls.undo call finished")):console.log("[PrivateToolbar] canvasControls.undo is not defined")},Z=()=>{console.log("[PrivateToolbar] Redo button clicked"),n.redo?(console.log("[PrivateToolbar] Calling canvasControls.redo"),n.redo(),console.log("[PrivateToolbar] canvasControls.redo call finished")):console.log("[PrivateToolbar] canvasControls.redo is not defined")},W=()=>{S&&(clearTimeout(S),m(null)),f(!1),g(!1),v&&(clearTimeout(v),y(null)),b&&(clearTimeout(b),w(null)),d(!0)},C=()=>{const x=setTimeout(()=>{d(!1)},300);m(x)},k=()=>{v&&(clearTimeout(v),y(null)),d(!1),g(!1),S&&(clearTimeout(S),m(null)),b&&(clearTimeout(b),w(null)),f(!0)},V=()=>{const x=setTimeout(()=>{f(!1)},1e3);y(x)},I=()=>{b&&(clearTimeout(b),w(null)),d(!1),f(!1),S&&(clearTimeout(S),m(null)),v&&(clearTimeout(v),y(null)),g(!0)},U=()=>{const x=setTimeout(()=>{g(!1)},1e3);w(x)};return B.useEffect(()=>{const x=j=>{(j.ctrlKey||j.metaKey)&&!j.shiftKey&&j.key.toLowerCase()==="z"?(j.preventDefault(),z()):(j.ctrlKey||j.metaKey)&&j.key.toLowerCase()==="y"&&(j.preventDefault(),Z())};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[n]),D.jsxs("div",{className:"toolbar",children:[D.jsxs("div",{className:"tool-group",children:[D.jsxs("div",{style:{position:"relative",display:"inline-block"},onMouseEnter:W,onMouseLeave:C,children:[D.jsx("button",{className:c.tool==="pen"?"selected":"",onClick:()=>T("pen"),style:{padding:"8px 12px",margin:"2px",border:c.tool==="pen"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="pen"?"#e6f3ff":"white",cursor:"pointer"},children:"✏️ Pen"}),u&&D.jsxs("div",{style:{position:"absolute",top:"100%",left:"0",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[D.jsx("input",{type:"range",min:"1",max:"10",value:c.penSize,onChange:O,style:{width:"80px"}}),D.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.penSize,"px"]})]})]}),D.jsxs("div",{style:{position:"relative",display:"inline-block"},onMouseEnter:k,onMouseLeave:V,children:[D.jsx("button",{className:c.tool==="eraser"?"selected":"",onClick:()=>T("eraser"),style:{padding:"8px 12px",margin:"2px",border:c.tool==="eraser"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="eraser"?"#e6f3ff":"white",cursor:"pointer"},children:"🧽 Eraser"}),h&&D.jsxs("div",{style:{position:"absolute",top:"100%",left:"0",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[D.jsx("input",{type:"range",min:"5",max:"50",value:c.eraserSize,onChange:A,style:{width:"80px"}}),D.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.eraserSize,"px"]})]})]}),D.jsxs("div",{style:{position:"relative",display:"inline-block"},onMouseEnter:I,onMouseLeave:U,children:[D.jsx("button",{className:c.tool==="text"?"selected":"",onClick:()=>T("text"),style:{padding:"8px 12px",margin:"2px",border:c.tool==="text"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="text"?"#e6f3ff":"white",cursor:"pointer"},children:"📝 Text"}),p&&D.jsxs("div",{style:{position:"absolute",top:"100%",left:"0",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[D.jsx("input",{type:"range",min:"10",max:"72",value:c.fontSize,onChange:F,style:{width:"80px"}}),D.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.fontSize,"px"]})]})]})]}),D.jsxs("div",{className:"tool-group",children:[D.jsx("label",{style:{fontSize:"14px",fontWeight:"bold"},children:"Color:"}),D.jsx("input",{type:"color",value:c.color,onChange:x=>E(x.target.value),style:{width:"40px",height:"30px",margin:"2px",border:"1px solid #ccc",borderRadius:"4px",cursor:"pointer"}})]}),D.jsxs("div",{className:"tool-group",children:[D.jsx("button",{onClick:z,style:{padding:"8px 12px",margin:"2px",border:"1px solid #ccc",borderRadius:"4px",background:"white",cursor:"pointer"},children:"↩️ Undo"}),D.jsx("button",{onClick:Z,style:{padding:"8px 12px",margin:"2px",border:"1px solid #ccc",borderRadius:"4px",background:"white",cursor:"pointer"},children:"↪️ Redo"})]}),D.jsx("div",{className:"tool-group",children:D.jsx("button",{onClick:X,style:{padding:"8px 12px",margin:"2px",border:"1px solid #d13438",borderRadius:"4px",background:"#f8d7da",color:"#721c24",cursor:"pointer",fontWeight:"bold"},children:"🗑️ Clear All"})})]})}const HY=()=>{const[n,e]=B.useState(!1),t=B.useRef(null),[r,i]=B.useState(!1),[s,o]=B.useState(!0),{bus:a,flags:l,phase:c,loading:u,error:d}=YS();B.useEffect(()=>{let S=!0;(async()=>{var y,b;try{console.log("[HostActionsButton] ==================== STARTING AUTH INIT ===================="),console.log("[HostActionsButton] Initializing Teams SDK for user context..."),await Ah(),console.log("[HostActionsButton] ✅ Teams SDK initialized"),console.log("[HostActionsButton] Getting Teams context...");const w=await i0();console.log("[HostActionsButton] ✅ Teams context received:",w);const T=w==null?void 0:w.user,E=w==null?void 0:w.meeting;console.log("[HostActionsButton] User info:",T),console.log("[HostActionsButton] Meeting context:",E);const O=(b=(y=T==null?void 0:T.userPrincipalName)==null?void 0:y.toLowerCase)==null?void 0:b.call(y);console.log("[HostActionsButton] User email:",O);let A=!1;console.log("[HostActionsButton] Checking if user is vithoma@microsoft.com..."),O==="vithoma@microsoft.com"?(console.log("[HostActionsButton] ✅ User is vithoma@microsoft.com - granted host access"),A=!0):console.log("[HostActionsButton] ❌ User is not vithoma@microsoft.com - denied host access"),console.log("[HostActionsButton] Final host detection result:",A),S&&i(!!A),console.log("[HostActionsButton] ==================== AUTH INIT COMPLETE ====================")}catch(w){console.error("[HostActionsButton] ❌ AUTH INIT FAILED:",w)}finally{S&&(console.log("[HostActionsButton] Setting authLoading = false"),o(!1))}})();const m=y=>{t.current&&(t.current.contains(y.target)||e(!1))},v=y=>{y.key==="Escape"&&e(!1)};return document.addEventListener("mousedown",m),document.addEventListener("keydown",v),()=>{S=!1,document.removeEventListener("mousedown",m),document.removeEventListener("keydown",v)}},[]);async function h(S,m){if(console.log(`[HostActionsButton] ==================== BROADCASTING ACTION: ${S} ====================`),!a||!l||!c){console.error("[HostActionsButton] ❌ Live Share objects not available!"),console.error("[HostActionsButton] - bus:",a),console.error("[HostActionsButton] - flags:",l),console.error("[HostActionsButton] - phase:",c);return}console.log("[HostActionsButton] ✅ Live Share objects available, proceeding with broadcast"),console.log(`[HostActionsButton] Action type: ${S}`),console.log("[HostActionsButton] Payload:",m);try{const v={type:S,...m,ts:Date.now()};console.log("[HostActionsButton] Step 1: Sending LiveEvent with data:",v);const y=await a.send(v);console.log("[HostActionsButton] ✅ LiveEvent sent successfully:",y),console.log("[HostActionsButton] Step 2: Updating SharedMap and LiveState...");const b=Date.now();switch(S){case"clear-all":console.log("[HostActionsButton] Processing clear-all action..."),l.set("lastAction","clear-all"),l.set("lastActionAt",b);const w=(Number(l.get("clearAllCounter"))||0)+1;console.log("[HostActionsButton] Setting clearAllCounter to:",w),l.set("clearAllCounter",w),c.set&&(console.log("[HostActionsButton] Setting phase to 'idle'"),await c.set("idle"));break;case"share-all":console.log("[HostActionsButton] Processing share-all action..."),l.set("roundVisible",!0),l.set("lastAction","share-all"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'visible'"),await c.set("visible"));break;case"enable-editing":console.log("[HostActionsButton] Processing enable-editing action..."),l.set("editingEnabled",!0),l.set("lastAction","enable-editing"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'editing'"),await c.set("editing"));break;case"start-stage-page":console.log("[HostActionsButton] Processing start-stage-page action..."),l.set("stagePageActive",!0),l.set("lastAction","start-stage-page"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'stage'"),await c.set("stage"));break;case"send-content-to-all":console.log("[HostActionsButton] Processing send-content-to-all action..."),l.set("sendContentToAll",!0),l.set("lastAction","send-content-to-all"),l.set("lastActionAt",b);const T=(Number(l.get("sendContentCounter"))||0)+1;console.log("[HostActionsButton] Setting sendContentCounter to:",T),l.set("sendContentCounter",T);break}console.log("[HostActionsButton] ✅ SharedMap and LiveState updated"),console.log("[HostActionsButton] Final SharedMap state:"),console.log("[HostActionsButton] - roundVisible:",l.get("roundVisible")),console.log("[HostActionsButton] - editingEnabled:",l.get("editingEnabled")),console.log("[HostActionsButton] - lastAction:",l.get("lastAction")),console.log("[HostActionsButton] - lastActionAt:",l.get("lastActionAt")),console.log("[HostActionsButton] - clearAllCounter:",l.get("clearAllCounter")),console.log("[HostActionsButton] ==================== BROADCAST COMPLETE ====================")}catch(v){console.error(`[HostActionsButton] ❌ BROADCAST FAILED for action ${S}:`),console.error("[HostActionsButton] Error type:",typeof v),console.error("[HostActionsButton] Error message:",v instanceof Error?v.message:String(v)),console.error("[HostActionsButton] Error stack:",v instanceof Error?v.stack:"No stack trace"),console.error("[HostActionsButton] Full error object:",v)}}const f=()=>h("send-content-to-all"),p=async()=>{try{console.log("[HostActionsButton] Starting stage page..."),await h("start-stage-page",{active:!0}),console.log("[HostActionsButton] Sharing content to meeting stage...");const S=`${window.location.origin}${window.location.pathname}?page=stage`;console.log("[HostActionsButton] Stage page URL:",S),TO((m,v)=>{m?console.error("[HostActionsButton] Error sharing to stage:",m):console.log("[HostActionsButton] Successfully shared to stage:",v)},S)}catch(S){console.error("[HostActionsButton] Error in onStartStagePage:",S)}};return u||s?D.jsx("button",{className:"px-3 py-2 rounded-lg bg-gray-100 text-gray-400 cursor-not-allowed",disabled:!0,children:"Host Actions"}):d?D.jsx("button",{className:"px-3 py-2 rounded-lg bg-red-100 text-red-400 cursor-not-allowed",disabled:!0,children:"Live Share Error"}):r?D.jsxs("div",{className:"relative inline-block",ref:t,children:[D.jsxs("button",{type:"button",onClick:()=>e(S=>!S),className:"px-4 py-2 rounded-lg font-medium transition-colors bg-indigo-600 hover:bg-indigo-700 text-white","aria-haspopup":"menu","aria-expanded":n,children:["Host Actions",D.jsx("span",{className:"ml-2 inline-block align-middle",children:"▾"})]}),n&&D.jsxs("div",{role:"menu","aria-label":"Host actions",className:"absolute right-0 mt-2 w-56 rounded-xl border border-gray-200 bg-white shadow-lg overflow-hidden z-50",children:[D.jsx("button",{role:"menuitem",onClick:()=>{e(!1),f()},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Send Content to All Canvases"}),D.jsx("button",{role:"menuitem",onClick:()=>{e(!1),p()},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Start Stage Page"})]})]}):null};function VY({userInfo:n,meetingInfo:e}){const[t,r]=B.useState(null),i=B.useCallback((o,a)=>{console.log("[PrivateWhiteboardApp] Canvas ready:",o.width,"x",o.height,o,a)},[]),s=B.useCallback(o=>{console.log("[PrivateWhiteboardApp] Controls ready:",o),r(o)},[]);return console.log("[PrivateWhiteboardApp] Render",{canvasControls:t}),D.jsx($N,{children:D.jsxs("div",{className:"whiteboard-container private-whiteboard",children:[D.jsx(HY,{}),t&&D.jsx(UY,{canvasControls:t,userInfo:n,meetingInfo:e}),D.jsx("div",{className:"canvas-area",children:D.jsx("div",{className:"canvas-container",children:D.jsx(BY,{onCanvasReady:i,onControlsReady:s,userInfo:n})})})]})})}function U1({message:n="Loading..."}){return D.jsxs("div",{className:"loading-container",children:[D.jsx("div",{className:"spinner",style:{border:"4px solid #f3f3f3",borderTop:"4px solid #0078d4",borderRadius:"50%",width:"40px",height:"40px",animation:"spin 1s linear infinite"}}),D.jsx("p",{children:n}),D.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})}function WY({error:n}){return D.jsxs("div",{className:"error-container",children:[D.jsx("h2",{children:"Something went wrong"}),D.jsx("p",{children:n.message}),D.jsx("button",{onClick:()=>window.location.reload(),children:"Reload App"})]})}const GY=()=>{const{bus:n,flags:e,phase:t,loading:r,error:i}=YS(),[s,o]=B.useState(!1),[a,l]=B.useState(!0),[c,u]=B.useState(!1),[d,h]=B.useState(!1),[f,p]=B.useState(new Map),g=B.useRef(null),S=B.useRef(null),[m,v]=B.useState(!1),[y,b]=B.useState(null),w=B.useRef(!1),[T,E]=B.useState(1),[O,A]=B.useState({x:0,y:0}),[F,X]=B.useState(!1),[z,Z]=B.useState(null),[W,C]=B.useState(.6);B.useEffect(()=>{let N=!0;return(async()=>{var L,ee;try{console.log("[StagePage] ==================== STARTING HOST DETECTION ===================="),console.log("[StagePage] Initializing Teams SDK for user context..."),await Ah(),console.log("[StagePage] ✅ Teams SDK initialized"),console.log("[StagePage] Getting Teams context...");const he=await i0();console.log("[StagePage] ✅ Teams context received:",he);const ye=he==null?void 0:he.user,We=he==null?void 0:he.meeting;console.log("[StagePage] User info:",ye),console.log("[StagePage] Meeting context:",We);const Ne=(ee=(L=ye==null?void 0:ye.userPrincipalName)==null?void 0:L.toLowerCase)==null?void 0:ee.call(L);console.log("[StagePage] User email:",Ne);let Ht=!1;console.log("[StagePage] Checking if user is vithoma@microsoft.com..."),Ne==="vithoma@microsoft.com"?(console.log("[StagePage] ✅ User is vithoma@microsoft.com - granted host access"),Ht=!0):console.log("[StagePage] ❌ User is not vithoma@microsoft.com - denied host access"),console.log("[StagePage] Final host detection result:",Ht),N&&o(!!Ht),console.log("[StagePage] ==================== HOST DETECTION COMPLETE ====================")}catch(he){console.error("[StagePage] ❌ Error during host detection:",he),N&&o(!1)}finally{N&&l(!1)}})(),()=>{N=!1}},[]),B.useEffect(()=>{if(e){const N=e.get("editingEnabled");u(!!N)}},[e]),B.useEffect(()=>{const N=g.current;if(!N)return;const L=N.getContext("2d");if(!L)return;L.lineCap="round",L.lineJoin="round",L.imageSmoothingEnabled=!0,L.fillStyle="#ffffff",L.fillRect(0,0,N.width,N.height),S.current=L;const ee=()=>{(N.width!==1200||N.height!==800)&&(N.width=1200,N.height=800,L.fillStyle="#ffffff",L.fillRect(0,0,N.width,N.height),d&&f.size>0&&H())};return ee(),window.addEventListener("resize",ee),()=>{window.removeEventListener("resize",ee)}},[d,f]),B.useEffect(()=>{d&&f.size>0&&(console.log("[StagePage] Redrawing shared canvases"),H())},[f,d]),B.useEffect(()=>{const N=g.current,L=S.current;if(!N||!L)return;console.log("[StagePage] Applying zoom/pan transformation and redrawing:",{zoomLevel:T,panOffset:O});const ee=L.getImageData(0,0,N.width,N.height);L.setTransform(1,0,0,1,0,0),L.clearRect(0,0,N.width,N.height),L.fillStyle="#ffffff",L.fillRect(0,0,N.width,N.height),d&&f.size>0&&H(),L.translate(O.x,O.y),L.scale(T,T);const he=document.createElement("canvas");he.width=N.width,he.height=N.height;const ye=he.getContext("2d");ye&&(ye.putImageData(ee,0,0),L.globalAlpha=1,L.globalCompositeOperation="source-over")},[T,O,d,f]);const k=()=>{const N=S.current;N&&(N.setTransform(1,0,0,1,0,0),N.translate(O.x,O.y),N.scale(T,T))},V=N=>{const L=S.current;L&&(k(),N.isErase?(L.globalCompositeOperation="destination-out",L.lineWidth=N.lineWidth||20):(L.globalCompositeOperation="source-over",L.strokeStyle=N.strokeStyle||"#ff0000",L.lineWidth=N.lineWidth||3,L.globalAlpha=N.globalAlpha||.8),L.beginPath(),L.moveTo(N.point.x,N.point.y),console.log("[StagePage] Viewer: Replayed host draw start at",N.point))},I=N=>{const L=S.current;L&&(L.lineTo(N.point.x,N.point.y),L.stroke(),console.log("[StagePage] Viewer: Replayed host draw move to",N.point))},U=N=>{const L=S.current;L&&(L.beginPath(),N.wasErase&&(L.globalCompositeOperation="source-over"),console.log("[StagePage] Viewer: Replayed host draw end"))},x=N=>{const L=g.current,ee=S.current;!L||!ee||(console.log("[StagePage] Viewer: Replaying host clear operation:",N.clearType),ee.setTransform(1,0,0,1,0,0),ee.clearRect(0,0,L.width,L.height),ee.fillStyle="#ffffff",ee.fillRect(0,0,L.width,L.height),N.clearType==="annotations"&&d&&f.size>0&&H(),k(),console.log("[StagePage] Viewer: Host clear operation replayed"))},j=N=>{console.log("[StagePage] Viewer: Replaying host zoom/pan:",N),E(N.zoomLevel),A(N.panOffset)},Q=async(N,L,ee,he,ye)=>{if(!(!s||!n))try{await n.send({type:"hostDrawStart",point:N,isErase:L,strokeStyle:ee,lineWidth:he,globalAlpha:ye,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted draw start")}catch(We){console.error("[StagePage] Host: Failed to broadcast draw start:",We)}},me=async N=>{if(!(!s||!n))try{await n.send({type:"hostDrawMove",point:N,timestamp:Date.now()})}catch(L){console.error("[StagePage] Host: Failed to broadcast draw move:",L)}},_=async N=>{if(!(!s||!n))try{await n.send({type:"hostDrawEnd",wasErase:N,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted draw end")}catch(L){console.error("[StagePage] Host: Failed to broadcast draw end:",L)}},R=async N=>{if(!(!s||!n))try{await n.send({type:"hostClearCanvas",clearType:N,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted clear canvas:",N)}catch(L){console.error("[StagePage] Host: Failed to broadcast clear canvas:",L)}},M=async(N,L)=>{if(!(!s||!n))try{await n.send({type:"hostZoomPan",zoomLevel:N,panOffset:L,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted zoom/pan change")}catch(ee){console.error("[StagePage] Host: Failed to broadcast zoom/pan:",ee)}};B.useEffect(()=>{if(!n||r){console.log("[StagePage] Live Share bus not ready yet, skipping event listener setup");return}console.log("[StagePage] Setting up Live Share event listener for canvas data and host drawing");const N=L=>{switch(console.log("[StagePage] Received Live Share event:",L),L.type){case"canvasData":console.log("[StagePage] Received canvas data from:",L.userName),p(ee=>{const he=new Map(ee);return he.set(L.userId,{imageData:L.imageData,width:L.width,height:L.height,userName:L.userName,userId:L.userId,timestamp:L.timestamp}),console.log("[StagePage] Canvas collection updated, total canvases:",he.size),he});break;case"hostDrawStart":s||(console.log("[StagePage] Viewer: Received host draw start at",L.point),V(L));break;case"hostDrawMove":s||(console.log("[StagePage] Viewer: Received host draw move to",L.point),I(L));break;case"hostDrawEnd":s||(console.log("[StagePage] Viewer: Received host draw end"),U(L));break;case"hostClearCanvas":s||(console.log("[StagePage] Viewer: Received host clear canvas command"),x(L));break;case"hostZoomPan":s||(console.log("[StagePage] Viewer: Received host zoom/pan command"),j(L));break;default:console.log("[StagePage] Unhandled Live Share event type:",L.type)}};return n.on("received",N),()=>{console.log("[StagePage] Cleaning up Live Share event listener"),n.off("received",N)}},[n,r,s]),B.useEffect(()=>{d&&f.size>0&&(console.log("[StagePage] Redrawing canvas grid with",f.size,"canvases"),H())},[f,d]);const H=()=>{const N=g.current,L=S.current;if(!N||!L||f.size===0)return;L.save(),L.setTransform(1,0,0,1,0,0);const ee=Array.from(f.values()),he=ee.length,ye=Math.ceil(Math.sqrt(he)),We=Math.ceil(he/ye),Ne=480/640,Ht=20,vs=30,_o=N.width-(ye+1)*Ht,el=N.height-(We+1)*Ht-vs*We,Uf=_o/ye,Hf=el/We;let dr,bi;Uf/Hf>Ne?(bi=Hf*W,dr=bi*Ne):(dr=Uf*W,bi=dr/Ne),console.log("[StagePage] Drawing grid:",{cols:ye,rows:We,cellWidth:dr,cellHeight:bi,numCanvases:he,aspectRatio:Ne,maxCellWidth:Uf,maxCellHeight:Hf,resizeRatio:W}),ee.forEach((ZS,eb)=>{const BN=Math.floor(eb/ye),UN=eb%ye,HN=dr+Ht,VN=bi+Ht+vs,WN=ye*dr+(ye-1)*Ht,Vf=(N.width-WN)/2+UN*HN,Wf=Ht+vs+BN*VN;L.fillStyle="#333",L.font="16px sans-serif",L.textAlign="center",L.fillText(ZS.userName,Vf+dr/2,Wf-10);const ys=new Image;ys.onload=()=>{L.save(),L.setTransform(1,0,0,1,0,0);const tb=Math.min(dr/ys.width,bi/ys.height),nb=ys.width*tb,rb=ys.height*tb,GN=Vf+(dr-nb)/2,KN=Wf+(bi-rb)/2;L.strokeStyle="#ddd",L.lineWidth=2,L.strokeRect(Vf,Wf,dr,bi),L.drawImage(ys,GN,KN,nb,rb),L.restore()},ys.src=ZS.imageData}),L.restore()},se=N=>{const L=g.current;if(!L)return{x:0,y:0};const ee=L.getBoundingClientRect(),he=L.width/ee.width,ye=L.height/ee.height;let We,Ne;if("touches"in N&&N.touches.length>0)We=N.touches[0].clientX,Ne=N.touches[0].clientY;else{const _o=N;We=_o.clientX,Ne=_o.clientY}const Ht=((We-ee.left)*he-O.x)/T,vs=((Ne-ee.top)*ye-O.y)/T;return{x:Ht,y:vs}},ge=N=>({x:N.clientX,y:N.clientY}),je=N=>{N.preventDefault();const L=S.current;if(!L)return;if(!s){console.log("[StagePage] Viewer: Drawing interaction blocked - user is not host");return}if("button"in N&&N.button===1){X(!0);const Ne=ge(N);Z(Ne),console.log("[StagePage] Host: Started panning at",Ne);return}const ee=se(N);if("button"in N&&N.button===2){w.current=!0,v(!0),b(ee),k();const Ne=20;L.globalCompositeOperation="destination-out",L.lineWidth=Ne,L.beginPath(),L.moveTo(ee.x,ee.y),Q(ee,!0,void 0,Ne),console.log("[StagePage] Host: Started right-click erase at",ee);return}v(!0),b(ee),k();const he="#ff0000",ye=3,We=.8;L.globalCompositeOperation="source-over",L.strokeStyle=he,L.lineWidth=ye,L.globalAlpha=We,L.beginPath(),L.moveTo(ee.x,ee.y),Q(ee,!1,he,ye,We),console.log("[StagePage] Host: Started drawing at",ee)},qe=N=>{if(N.preventDefault(),!s)return;if(F&&z&&"button"in N){const he=ge(N),ye=he.x-z.x,We=he.y-z.y,Ne={x:O.x+ye,y:O.y+We};A(Ne),Z(he),M(T,Ne),console.log("[StagePage] Host: Panning by",{deltaX:ye,deltaY:We});return}if(!m&&!w.current)return;const L=se(N),ee=S.current;ee&&(ee.lineTo(L.x,L.y),ee.stroke(),b(L),me(L),w.current&&console.log("[StagePage] Host: Erasing at",L))},dt=()=>{if(!s)return;const N=m,L=w.current;v(!1),X(!1),b(null),Z(null);const ee=S.current;ee&&(ee.beginPath(),w.current&&(ee.globalCompositeOperation="source-over",w.current=!1,console.log("[StagePage] Host: Stopped erasing, reset composite mode"))),N&&(_(L),console.log("[StagePage] Host: Stopped drawing/erasing"))},Nt=N=>{if(N.preventDefault(),!s)return;const L=g.current;if(!L)return;const ee=L.getBoundingClientRect(),he=N.clientX-ee.left,ye=N.clientY-ee.top,We=N.deltaY>0?.9:1.1,Ne=Math.max(.1,Math.min(5,T*We)),Ht=Ne/T,vs=he-(he-O.x)*Ht,_o=ye-(ye-O.y)*Ht,el={x:vs,y:_o};E(Ne),A(el),M(Ne,el),console.log("[StagePage] Host: Zoom changed to",Ne,"pan offset",el)},mn=()=>{if(!s){console.log("[StagePage] Viewer: Clear operation blocked - user is not host");return}const N=g.current,L=S.current;if(!N||!L){console.error("[StagePage] Canvas or context not available for clearing");return}try{console.log("[StagePage] Host: Clearing stage canvas completely..."),L.setTransform(1,0,0,1,0,0),L.clearRect(0,0,N.width,N.height),L.fillStyle="#ffffff",L.fillRect(0,0,N.width,N.height),k(),R("all"),console.log("[StagePage] ✅ Host: Stage canvas cleared completely (including shared canvases)")}catch(ee){console.error("[StagePage] ❌ Failed to clear stage canvas:",ee)}},Br=()=>{if(!s){console.log("[StagePage] Viewer: Clear annotations blocked - user is not host");return}const N=g.current,L=S.current;if(!N||!L){console.error("[StagePage] Canvas or context not available for clearing annotations");return}try{console.log("[StagePage] Host: Clearing annotations only, preserving shared canvases..."),L.setTransform(1,0,0,1,0,0),L.clearRect(0,0,N.width,N.height),L.fillStyle="#ffffff",L.fillRect(0,0,N.width,N.height),d&&f.size>0&&H(),k(),R("annotations"),console.log("[StagePage] ✅ Host: Annotations cleared, shared canvases preserved")}catch(ee){console.error("[StagePage] ❌ Failed to clear annotations:",ee)}},Za=async()=>{if(!n||!e||!t){console.error("[StagePage] Live Share objects not available for toggle editing");return}try{const N=!c;console.log(`[StagePage] Broadcasting ${N?"enableCanvas":"disableCanvas"} event...`);const L={type:N?"enableCanvas":"disableCanvas",enabled:N,ts:Date.now()};await n.send(L),e.set("editingEnabled",N),e.set("lastAction",N?"enableCanvas":"disableCanvas"),e.set("lastActionAt",Date.now()),u(N),console.log(`[StagePage] ✅ ${N?"EnableCanvas":"DisableCanvas"} event broadcasted successfully`)}catch(N){console.error("[StagePage] ❌ Failed to broadcast toggle editing:",N)}},jN=async()=>{if(!n||!e||!t){console.error("[StagePage] Live Share objects not available for share canvases");return}try{console.log("[StagePage] Broadcasting shareCanvas event..."),p(new Map);const N={type:"shareCanvas",requestId:Date.now().toString(),ts:Date.now()};await n.send(N),e.set("canvasesVisible",!0),e.set("lastAction","shareCanvas"),e.set("lastActionAt",Date.now()),h(!0),console.log("[StagePage] ✅ ShareCanvas event broadcasted successfully")}catch(N){console.error("[StagePage] ❌ Failed to broadcast share canvases:",N)}};if(r||a)return D.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:D.jsxs("div",{className:"text-center",children:[D.jsx("div",{className:"text-2xl text-indigo-600 mb-4",children:a?"Detecting host permissions...":"Loading Live Share..."}),D.jsx("div",{className:"text-indigo-500",children:a?"Checking your role in this meeting":"Setting up real-time collaboration"})]})});if(i)return D.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center",children:D.jsxs("div",{className:"text-center",children:[D.jsx("div",{className:"text-2xl text-red-600 mb-4",children:"Live Share Error"}),D.jsx("div",{className:"text-red-500",children:i})]})});if(!s)return D.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:D.jsxs("div",{className:"text-center max-w-md mx-auto p-8",children:[D.jsx("div",{className:"text-6xl mb-6",children:"🚫"}),D.jsx("div",{className:"text-3xl text-orange-700 font-bold mb-4",children:"Host Access Required"}),D.jsx("div",{className:"text-lg text-orange-600 mb-6",children:"This stage page is only available to meeting hosts, organizers, and presenters."}),D.jsxs("div",{className:"text-sm text-orange-500 bg-orange-50 px-4 py-3 rounded-lg border border-orange-200",children:[D.jsx("strong",{children:"Note:"})," Only users with host permissions can control the shared stage and manage canvas interactions."]})]})});const qN=async()=>{try{console.log("[StagePage] Starting meeting stage...");const N="http://localhost:3000",L="https://vineeththomasalex.github.io/personal-whiteboard-app",ee=!0,ye=`${ee?L:N}/?page=stage`;console.log("[StagePage] Environment:",ee?"PRODUCTION":"DEVELOPMENT"),console.log("[StagePage] Sharing stage URL:",ye),await TO((We,Ne)=>{if(We){console.error("[StagePage] Failed to share app content to stage:",We);return}console.log("[StagePage] ✅ Successfully shared app content to stage:",Ne)},ye)}catch(N){console.error("[StagePage] ❌ Error starting meeting stage:",N)}};return D.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:[D.jsx("div",{className:"flex justify-center mb-6",children:D.jsx("button",{onClick:qN,className:"px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105",children:"Start Stage"})}),D.jsxs("div",{className:"flex gap-4 mb-8",children:[s?D.jsxs(D.Fragment,{children:[d?D.jsxs(D.Fragment,{children:[D.jsx("button",{onClick:Br,className:"px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors text-sm",title:"Clear only host annotations, keep shared canvases",children:"Clear Annotations"}),D.jsx("button",{onClick:mn,className:"px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors text-sm",title:"Clear everything including shared canvases",children:"Clear Everything"})]}):D.jsx("button",{onClick:mn,className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Clear Canvas"}),D.jsx("button",{onClick:Za,className:`px-6 py-3 font-medium rounded-lg transition-colors ${c?"bg-orange-600 hover:bg-orange-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:c?"Disable Editing":"Enable Editing"}),D.jsx("button",{onClick:jN,className:`px-6 py-3 font-medium rounded-lg transition-colors ${d?"bg-purple-600 hover:bg-purple-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:d?"Refresh Canvases":"Share all canvases"})]}):D.jsxs("div",{className:"flex flex-col gap-2",children:[D.jsxs("div",{className:"flex gap-4",children:[D.jsx("button",{className:"px-6 py-3 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed",disabled:!0,title:"Only the host can use this control",children:"Clear Canvas"}),D.jsx("button",{className:"px-6 py-3 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed",disabled:!0,title:"Only the host can use this control",children:"Toggle Editing"}),D.jsx("button",{className:"px-6 py-3 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed",disabled:!0,title:"Only the host can use this control",children:"Share Canvases"})]}),D.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200",children:["👀 ",D.jsx("strong",{children:"Viewer Mode:"})," You can watch the host's actions in real-time, but only the host can control the stage."]})]}),d&&D.jsxs("div",{className:"flex items-center gap-2 ml-4 border-l border-gray-300 pl-4",children:[D.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Canvas Size:"}),D.jsx("button",{onClick:()=>{if(!s)return;const N=Math.max(.2,W-.1);C(N),d&&f.size>0&&setTimeout(()=>H(),50)},className:`px-3 py-2 rounded-lg transition-colors text-sm ${s?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:s?"Make Canvases Smaller":"Host-only control",disabled:!s,children:"−"}),D.jsxs("span",{className:"text-sm font-medium text-gray-700 min-w-[50px] text-center",children:[Math.round(W*100),"%"]}),D.jsx("button",{onClick:()=>{if(!s)return;const N=Math.min(1,W+.1);C(N),d&&f.size>0&&setTimeout(()=>H(),50)},className:`px-3 py-2 rounded-lg transition-colors text-sm ${s?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:s?"Make Canvases Larger":"Host-only control",disabled:!s,children:"+"}),D.jsx("button",{onClick:()=>{s&&(C(.6),d&&f.size>0&&setTimeout(()=>H(),50))},className:`px-3 py-2 rounded-lg transition-colors text-sm ${s?"bg-orange-500 hover:bg-orange-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:s?"Reset Canvas Size":"Host-only control",disabled:!s,children:"Reset"})]})]}),D.jsx("div",{className:"border border-gray-300 rounded-lg mx-auto overflow-auto bg-white",style:{maxWidth:"100%",maxHeight:"60vh",backgroundColor:"#ffffff"},children:D.jsx("canvas",{ref:g,width:1200,height:800,className:`block ${s?"cursor-crosshair":"cursor-default"}`,onContextMenu:N=>{s&&N.preventDefault()},onWheel:s?Nt:void 0,onMouseDown:s?je:void 0,onMouseMove:s?qe:void 0,onMouseUp:s?dt:void 0,onMouseLeave:s?dt:void 0,onTouchStart:s?je:void 0,onTouchMove:s?qe:void 0,onTouchEnd:s?dt:void 0,style:{touchAction:s?"none":"auto",backgroundColor:"#ffffff",filter:"none",colorScheme:"light",minWidth:"800px",minHeight:"600px",cursor:s?F?"grabbing":"crosshair":"default",opacity:s?1:.95,border:s?"1px solid #ddd":"2px solid #3b82f6"}})})]})},H1=gD();function KY(){const n=B.useRef(!1),[e,t]=B.useState(!1),[r,i]=B.useState(H1),[s,o]=B.useState(null),[a,l]=B.useState(null),[c,u]=B.useState(null),[d,h]=B.useState(!1),f=()=>new URLSearchParams(window.location.search).get("page")||"main",[p,g]=B.useState(f());if(B.useEffect(()=>{const m=()=>{g(f())};return window.addEventListener("popstate",m),()=>window.removeEventListener("popstate",m)},[]),B.useEffect(()=>{n.current||(n.current=!0,(async()=>{var m,v;try{console.log("App: Attempting Teams SDK initialize"),await Ah(),i(!0);const y=await i0(),b=(y==null?void 0:y.user)||{},w=(y==null?void 0:y.meeting)||{},T=(m=y==null?void 0:y.page)==null?void 0:m.frameContext,E=new Set(["meetingStage","meetingSidePanel","meetingChatTab","meetingDetailsTab"]),O=T&&E.has(T)||Array.isArray((v=y==null?void 0:y.page)==null?void 0:v.contexts)&&y.page.contexts.some(z=>E.has(z));h(!!O);const A={displayName:b.displayName,userPrincipalName:b.userPrincipalName||b.loginHint,loginHint:b.loginHint,id:b.id,userObjectId:b.id||b.userObjectId||b.aadObjectId,aadObjectId:b.aadObjectId||b.id};if(!A.displayName&&A.userPrincipalName){const z=A.userPrincipalName.split("@")[0];A.displayName=z.replace(/\./g," ")}const F=new URLSearchParams(window.location.search);!A.displayName&&F.get("user")&&(A.displayName=F.get("user")||void 0),!A.userPrincipalName&&F.get("upn")&&(A.userPrincipalName=F.get("upn")||void 0),l(A);let X=!1;O&&Zw&&await new Promise(z=>{Zw((Z,W)=>{if(Z)return console.info("App: meeting.getMeetingDetails not available here:",Z),z();const C=(W==null?void 0:W.organizer)||{},k=(W==null?void 0:W.title)||(w==null?void 0:w.meetingTitle),V=!!(A.userPrincipalName&&(C!=null&&C.userPrincipalName)&&A.userPrincipalName.toLowerCase()===C.userPrincipalName.toLowerCase());u({title:k,organizer:{displayName:C==null?void 0:C.displayName,userPrincipalName:C==null?void 0:C.userPrincipalName,id:C==null?void 0:C.id},host:{displayName:C==null?void 0:C.displayName,userPrincipalName:C==null?void 0:C.userPrincipalName,id:C==null?void 0:C.id},isOrganizer:V}),X=!0,z()})}),!X&&(w!=null&&w.meetingTitle)&&u(z=>z||{title:w.meetingTitle}),MM(),DM(),t(!0),console.log("App: Teams client SDK initialized successfully")}catch(y){console.warn("App: Teams initialize failed; assuming non-Teams host.",y),i(!1),H1&&o(y)}})())},[]),r&&!e&&!s)return D.jsx(U1,{message:"Initializing Teams app..."});if(s)return D.jsx(WY,{error:s});const S=r&&e||!r;return p==="stage"?D.jsx("div",{className:"app-container",children:S?D.jsx(VY,{userInfo:a||(r?{displayName:"Unknown User"}:{displayName:"Local Browser"}),meetingInfo:c}):D.jsx(U1,{message:"Loading..."})}):D.jsx($N,{children:D.jsx(GY,{})})}Km.createRoot(document.getElementById("root")).render(D.jsx(uL.StrictMode,{children:D.jsx(KY,{})}));export{D0 as a,g0 as b,U6 as c,HP as d,O6 as e,Kh as f,jP as g,P6 as h,J6 as i,JP as j,pi as k,UP as r,m6 as s,Ba as t};
