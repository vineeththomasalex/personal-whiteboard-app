(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function pi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Lc(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var X1={exports:{}},mh={},Y1={exports:{}},ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ic=Symbol.for("react.element"),sL=Symbol.for("react.portal"),oL=Symbol.for("react.fragment"),aL=Symbol.for("react.strict_mode"),lL=Symbol.for("react.profiler"),cL=Symbol.for("react.provider"),uL=Symbol.for("react.context"),dL=Symbol.for("react.forward_ref"),hL=Symbol.for("react.suspense"),fL=Symbol.for("react.memo"),pL=Symbol.for("react.lazy"),lb=Symbol.iterator;function mL(n){return n===null||typeof n!="object"?null:(n=lb&&n[lb]||n["@@iterator"],typeof n=="function"?n:null)}var Z1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},eT=Object.assign,tT={};function La(n,e,t){this.props=n,this.context=e,this.refs=tT,this.updater=t||Z1}La.prototype.isReactComponent={};La.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};La.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function nT(){}nT.prototype=La.prototype;function cy(n,e,t){this.props=n,this.context=e,this.refs=tT,this.updater=t||Z1}var uy=cy.prototype=new nT;uy.constructor=cy;eT(uy,La.prototype);uy.isPureReactComponent=!0;var cb=Array.isArray,rT=Object.prototype.hasOwnProperty,dy={current:null},iT={key:!0,ref:!0,__self:!0,__source:!0};function sT(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)rT.call(e,r)&&!iT.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ic,type:n,key:s,ref:o,props:i,_owner:dy.current}}function gL(n,e){return{$$typeof:Ic,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function hy(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ic}function vL(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var ub=/\/+/g;function Gf(n,e){return typeof n=="object"&&n!==null&&n.key!=null?vL(""+n.key):e.toString(36)}function Uu(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ic:case sL:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+Gf(o,0):r,cb(i)?(t="",n!=null&&(t=n.replace(ub,"$&/")+"/"),Uu(i,e,t,"",function(c){return c})):i!=null&&(hy(i)&&(i=gL(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(ub,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",cb(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+Gf(s,a);o+=Uu(s,e,t,l,i)}else if(l=mL(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+Gf(s,a++),o+=Uu(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function fu(n,e,t){if(n==null)return n;var r=[],i=0;return Uu(n,r,"","",function(s){return e.call(t,s,i++)}),r}function yL(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var nn={current:null},Hu={transition:null},SL={ReactCurrentDispatcher:nn,ReactCurrentBatchConfig:Hu,ReactCurrentOwner:dy};function oT(){throw Error("act(...) is not supported in production builds of React.")}ve.Children={map:fu,forEach:function(n,e,t){fu(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return fu(n,function(){e++}),e},toArray:function(n){return fu(n,function(e){return e})||[]},only:function(n){if(!hy(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ve.Component=La;ve.Fragment=oL;ve.Profiler=lL;ve.PureComponent=cy;ve.StrictMode=aL;ve.Suspense=hL;ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SL;ve.act=oT;ve.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=eT({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=dy.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)rT.call(e,l)&&!iT.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Ic,type:n.type,key:i,ref:s,props:r,_owner:o}};ve.createContext=function(n){return n={$$typeof:uL,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:cL,_context:n},n.Consumer=n};ve.createElement=sT;ve.createFactory=function(n){var e=sT.bind(null,n);return e.type=n,e};ve.createRef=function(){return{current:null}};ve.forwardRef=function(n){return{$$typeof:dL,render:n}};ve.isValidElement=hy;ve.lazy=function(n){return{$$typeof:pL,_payload:{_status:-1,_result:n},_init:yL}};ve.memo=function(n,e){return{$$typeof:fL,type:n,compare:e===void 0?null:e}};ve.startTransition=function(n){var e=Hu.transition;Hu.transition={};try{n()}finally{Hu.transition=e}};ve.unstable_act=oT;ve.useCallback=function(n,e){return nn.current.useCallback(n,e)};ve.useContext=function(n){return nn.current.useContext(n)};ve.useDebugValue=function(){};ve.useDeferredValue=function(n){return nn.current.useDeferredValue(n)};ve.useEffect=function(n,e){return nn.current.useEffect(n,e)};ve.useId=function(){return nn.current.useId()};ve.useImperativeHandle=function(n,e,t){return nn.current.useImperativeHandle(n,e,t)};ve.useInsertionEffect=function(n,e){return nn.current.useInsertionEffect(n,e)};ve.useLayoutEffect=function(n,e){return nn.current.useLayoutEffect(n,e)};ve.useMemo=function(n,e){return nn.current.useMemo(n,e)};ve.useReducer=function(n,e,t){return nn.current.useReducer(n,e,t)};ve.useRef=function(n){return nn.current.useRef(n)};ve.useState=function(n){return nn.current.useState(n)};ve.useSyncExternalStore=function(n,e,t){return nn.current.useSyncExternalStore(n,e,t)};ve.useTransition=function(){return nn.current.useTransition()};ve.version="18.3.1";Y1.exports=ve;var U=Y1.exports;const bL=pi(U);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wL=U,CL=Symbol.for("react.element"),EL=Symbol.for("react.fragment"),_L=Object.prototype.hasOwnProperty,TL=wL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xL={key:!0,ref:!0,__self:!0,__source:!0};function aT(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)_L.call(e,r)&&!xL.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:CL,type:n,key:s,ref:o,props:i,_owner:TL.current}}mh.Fragment=EL;mh.jsx=aT;mh.jsxs=aT;X1.exports=mh;var M=X1.exports,Xm={},lT={exports:{}},In={},cT={exports:{}},uT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(I,B){var x=I.length;I.push(B);e:for(;0<x;){var j=x-1>>>1,Y=I[j];if(0<i(Y,B))I[j]=B,I[x]=Y,x=j;else break e}}function t(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var B=I[0],x=I.pop();if(x!==B){I[0]=x;e:for(var j=0,Y=I.length,ye=Y>>>1;j<ye;){var re=2*(j+1)-1,T=I[re],N=re+1,D=I[N];if(0>i(T,x))N<Y&&0>i(D,T)?(I[j]=D,I[N]=x,j=N):(I[j]=T,I[re]=x,j=re);else if(N<Y&&0>i(D,x))I[j]=D,I[N]=x,j=N;else break e}}return B}function i(I,B){var x=I.sortIndex-B.sortIndex;return x!==0?x:I.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,g=!1,S=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(I){for(var B=t(c);B!==null;){if(B.callback===null)r(c);else if(B.startTime<=I)r(c),B.sortIndex=B.expirationTime,e(l,B);else break;B=t(c)}}function b(I){if(g=!1,y(I),!p)if(t(l)!==null)p=!0,L(w);else{var B=t(c);B!==null&&H(b,B.startTime-I)}}function w(I,B){p=!1,g&&(g=!1,m(P),P=-1),f=!0;var x=h;try{for(y(B),d=t(l);d!==null&&(!(d.expirationTime>B)||I&&!X());){var j=d.callback;if(typeof j=="function"){d.callback=null,h=d.priorityLevel;var Y=j(d.expirationTime<=B);B=n.unstable_now(),typeof Y=="function"?d.callback=Y:d===t(l)&&r(l),y(B)}else r(l);d=t(l)}if(d!==null)var ye=!0;else{var re=t(c);re!==null&&H(b,re.startTime-B),ye=!1}return ye}finally{d=null,h=x,f=!1}}var _=!1,E=null,P=-1,A=5,F=-1;function X(){return!(n.unstable_now()-F<A)}function z(){if(E!==null){var I=n.unstable_now();F=I;var B=!0;try{B=E(!0,I)}finally{B?ee():(_=!1,E=null)}}else _=!1}var ee;if(typeof v=="function")ee=function(){v(z)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,C=W.port2;W.port1.onmessage=z,ee=function(){C.postMessage(null)}}else ee=function(){S(z,0)};function L(I){E=I,_||(_=!0,ee())}function H(I,B){P=S(function(){I(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(I){I.callback=null},n.unstable_continueExecution=function(){p||f||(p=!0,L(w))},n.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<I?Math.floor(1e3/I):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(I){switch(h){case 1:case 2:case 3:var B=3;break;default:B=h}var x=h;h=B;try{return I()}finally{h=x}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(I,B){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var x=h;h=I;try{return B()}finally{h=x}},n.unstable_scheduleCallback=function(I,B,x){var j=n.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?j+x:j):x=j,I){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=x+Y,I={id:u++,callback:B,priorityLevel:I,startTime:x,expirationTime:Y,sortIndex:-1},x>j?(I.sortIndex=x,e(c,I),t(l)===null&&I===t(c)&&(g?(m(P),P=-1):g=!0,H(b,x-j))):(I.sortIndex=Y,e(l,I),p||f||(p=!0,L(w))),I},n.unstable_shouldYield=X,n.unstable_wrapCallback=function(I){var B=h;return function(){var x=h;h=B;try{return I.apply(this,arguments)}finally{h=x}}}})(uT);cT.exports=uT;var OL=cT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PL=U,Rn=OL;function $(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dT=new Set,Xl={};function uo(n,e){pa(n,e),pa(n+"Capture",e)}function pa(n,e){for(Xl[n]=e,n=0;n<e.length;n++)dT.add(e[n])}var ai=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ym=Object.prototype.hasOwnProperty,RL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,db={},hb={};function kL(n){return Ym.call(hb,n)?!0:Ym.call(db,n)?!1:RL.test(n)?hb[n]=!0:(db[n]=!0,!1)}function NL(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function LL(n,e,t,r){if(e===null||typeof e>"u"||NL(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function rn(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Nt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Nt[n]=new rn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Nt[e]=new rn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Nt[n]=new rn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Nt[n]=new rn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Nt[n]=new rn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Nt[n]=new rn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Nt[n]=new rn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Nt[n]=new rn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Nt[n]=new rn(n,5,!1,n.toLowerCase(),null,!1,!1)});var fy=/[\-:]([a-z])/g;function py(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(fy,py);Nt[e]=new rn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(fy,py);Nt[e]=new rn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(fy,py);Nt[e]=new rn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Nt[n]=new rn(n,1,!1,n.toLowerCase(),null,!1,!1)});Nt.xlinkHref=new rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Nt[n]=new rn(n,1,!1,n.toLowerCase(),null,!0,!0)});function my(n,e,t,r){var i=Nt.hasOwnProperty(e)?Nt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(LL(e,t,i,r)&&(t=null),r||i===null?kL(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var mi=PL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pu=Symbol.for("react.element"),Fo=Symbol.for("react.portal"),zo=Symbol.for("react.fragment"),gy=Symbol.for("react.strict_mode"),Zm=Symbol.for("react.profiler"),hT=Symbol.for("react.provider"),fT=Symbol.for("react.context"),vy=Symbol.for("react.forward_ref"),eg=Symbol.for("react.suspense"),tg=Symbol.for("react.suspense_list"),yy=Symbol.for("react.memo"),Oi=Symbol.for("react.lazy"),pT=Symbol.for("react.offscreen"),fb=Symbol.iterator;function tl(n){return n===null||typeof n!="object"?null:(n=fb&&n[fb]||n["@@iterator"],typeof n=="function"?n:null)}var Ze=Object.assign,Kf;function Cl(n){if(Kf===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Kf=e&&e[1]||""}return`
`+Kf+n}var Jf=!1;function Qf(n,e){if(!n||Jf)return"";Jf=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Jf=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Cl(n):""}function IL(n){switch(n.tag){case 5:return Cl(n.type);case 16:return Cl("Lazy");case 13:return Cl("Suspense");case 19:return Cl("SuspenseList");case 0:case 2:case 15:return n=Qf(n.type,!1),n;case 11:return n=Qf(n.type.render,!1),n;case 1:return n=Qf(n.type,!0),n;default:return""}}function ng(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case zo:return"Fragment";case Fo:return"Portal";case Zm:return"Profiler";case gy:return"StrictMode";case eg:return"Suspense";case tg:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case fT:return(n.displayName||"Context")+".Consumer";case hT:return(n._context.displayName||"Context")+".Provider";case vy:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case yy:return e=n.displayName||null,e!==null?e:ng(n.type)||"Memo";case Oi:e=n._payload,n=n._init;try{return ng(n(e))}catch{}}return null}function AL(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ng(e);case 8:return e===gy?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ss(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function mT(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ML(n){var e=mT(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function mu(n){n._valueTracker||(n._valueTracker=ML(n))}function gT(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=mT(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function vd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function rg(n,e){var t=e.checked;return Ze({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function pb(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=ss(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function vT(n,e){e=e.checked,e!=null&&my(n,"checked",e,!1)}function ig(n,e){vT(n,e);var t=ss(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?sg(n,e.type,t):e.hasOwnProperty("defaultValue")&&sg(n,e.type,ss(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function mb(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function sg(n,e,t){(e!=="number"||vd(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var El=Array.isArray;function Xo(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+ss(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function og(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error($(91));return Ze({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function gb(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error($(92));if(El(t)){if(1<t.length)throw Error($(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ss(t)}}function yT(n,e){var t=ss(e.value),r=ss(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function vb(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function ST(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ag(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?ST(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var gu,bT=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(gu=gu||document.createElement("div"),gu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gu.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Yl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Rl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},DL=["Webkit","ms","Moz","O"];Object.keys(Rl).forEach(function(n){DL.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Rl[e]=Rl[n]})});function wT(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Rl.hasOwnProperty(n)&&Rl[n]?(""+e).trim():e+"px"}function CT(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=wT(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var FL=Ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lg(n,e){if(e){if(FL[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error($(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error($(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error($(61))}if(e.style!=null&&typeof e.style!="object")throw Error($(62))}}function cg(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ug=null;function Sy(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var dg=null,Yo=null,Zo=null;function yb(n){if(n=Dc(n)){if(typeof dg!="function")throw Error($(280));var e=n.stateNode;e&&(e=bh(e),dg(n.stateNode,n.type,e))}}function ET(n){Yo?Zo?Zo.push(n):Zo=[n]:Yo=n}function _T(){if(Yo){var n=Yo,e=Zo;if(Zo=Yo=null,yb(n),e)for(n=0;n<e.length;n++)yb(e[n])}}function TT(n,e){return n(e)}function xT(){}var Xf=!1;function OT(n,e,t){if(Xf)return n(e,t);Xf=!0;try{return TT(n,e,t)}finally{Xf=!1,(Yo!==null||Zo!==null)&&(xT(),_T())}}function Zl(n,e){var t=n.stateNode;if(t===null)return null;var r=bh(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error($(231,e,typeof t));return t}var hg=!1;if(ai)try{var nl={};Object.defineProperty(nl,"passive",{get:function(){hg=!0}}),window.addEventListener("test",nl,nl),window.removeEventListener("test",nl,nl)}catch{hg=!1}function zL(n,e,t,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var kl=!1,yd=null,Sd=!1,fg=null,$L={onError:function(n){kl=!0,yd=n}};function jL(n,e,t,r,i,s,o,a,l){kl=!1,yd=null,zL.apply($L,arguments)}function qL(n,e,t,r,i,s,o,a,l){if(jL.apply(this,arguments),kl){if(kl){var c=yd;kl=!1,yd=null}else throw Error($(198));Sd||(Sd=!0,fg=c)}}function ho(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function PT(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Sb(n){if(ho(n)!==n)throw Error($(188))}function BL(n){var e=n.alternate;if(!e){if(e=ho(n),e===null)throw Error($(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return Sb(i),n;if(s===r)return Sb(i),e;s=s.sibling}throw Error($(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error($(189))}}if(t.alternate!==r)throw Error($(190))}if(t.tag!==3)throw Error($(188));return t.stateNode.current===t?n:e}function RT(n){return n=BL(n),n!==null?kT(n):null}function kT(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=kT(n);if(e!==null)return e;n=n.sibling}return null}var NT=Rn.unstable_scheduleCallback,bb=Rn.unstable_cancelCallback,UL=Rn.unstable_shouldYield,HL=Rn.unstable_requestPaint,it=Rn.unstable_now,VL=Rn.unstable_getCurrentPriorityLevel,by=Rn.unstable_ImmediatePriority,LT=Rn.unstable_UserBlockingPriority,bd=Rn.unstable_NormalPriority,WL=Rn.unstable_LowPriority,IT=Rn.unstable_IdlePriority,gh=null,Or=null;function GL(n){if(Or&&typeof Or.onCommitFiberRoot=="function")try{Or.onCommitFiberRoot(gh,n,void 0,(n.current.flags&128)===128)}catch{}}var or=Math.clz32?Math.clz32:QL,KL=Math.log,JL=Math.LN2;function QL(n){return n>>>=0,n===0?32:31-(KL(n)/JL|0)|0}var vu=64,yu=4194304;function _l(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function wd(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=_l(a):(s&=o,s!==0&&(r=_l(s)))}else o=t&~i,o!==0?r=_l(o):s!==0&&(r=_l(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-or(e),i=1<<t,r|=n[t],e&=~i;return r}function XL(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function YL(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-or(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=XL(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function pg(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function AT(){var n=vu;return vu<<=1,!(vu&4194240)&&(vu=64),n}function Yf(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Ac(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-or(e),n[e]=t}function ZL(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-or(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function wy(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-or(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var ke=0;function MT(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var DT,Cy,FT,zT,$T,mg=!1,Su=[],Ui=null,Hi=null,Vi=null,ec=new Map,tc=new Map,Ni=[],eI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wb(n,e){switch(n){case"focusin":case"focusout":Ui=null;break;case"dragenter":case"dragleave":Hi=null;break;case"mouseover":case"mouseout":Vi=null;break;case"pointerover":case"pointerout":ec.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":tc.delete(e.pointerId)}}function rl(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Dc(e),e!==null&&Cy(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function tI(n,e,t,r,i){switch(e){case"focusin":return Ui=rl(Ui,n,e,t,r,i),!0;case"dragenter":return Hi=rl(Hi,n,e,t,r,i),!0;case"mouseover":return Vi=rl(Vi,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return ec.set(s,rl(ec.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,tc.set(s,rl(tc.get(s)||null,n,e,t,r,i)),!0}return!1}function jT(n){var e=zs(n.target);if(e!==null){var t=ho(e);if(t!==null){if(e=t.tag,e===13){if(e=PT(t),e!==null){n.blockedOn=e,$T(n.priority,function(){FT(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Vu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=gg(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);ug=r,t.target.dispatchEvent(r),ug=null}else return e=Dc(t),e!==null&&Cy(e),n.blockedOn=t,!1;e.shift()}return!0}function Cb(n,e,t){Vu(n)&&t.delete(e)}function nI(){mg=!1,Ui!==null&&Vu(Ui)&&(Ui=null),Hi!==null&&Vu(Hi)&&(Hi=null),Vi!==null&&Vu(Vi)&&(Vi=null),ec.forEach(Cb),tc.forEach(Cb)}function il(n,e){n.blockedOn===e&&(n.blockedOn=null,mg||(mg=!0,Rn.unstable_scheduleCallback(Rn.unstable_NormalPriority,nI)))}function nc(n){function e(i){return il(i,n)}if(0<Su.length){il(Su[0],n);for(var t=1;t<Su.length;t++){var r=Su[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ui!==null&&il(Ui,n),Hi!==null&&il(Hi,n),Vi!==null&&il(Vi,n),ec.forEach(e),tc.forEach(e),t=0;t<Ni.length;t++)r=Ni[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ni.length&&(t=Ni[0],t.blockedOn===null);)jT(t),t.blockedOn===null&&Ni.shift()}var ea=mi.ReactCurrentBatchConfig,Cd=!0;function rI(n,e,t,r){var i=ke,s=ea.transition;ea.transition=null;try{ke=1,Ey(n,e,t,r)}finally{ke=i,ea.transition=s}}function iI(n,e,t,r){var i=ke,s=ea.transition;ea.transition=null;try{ke=4,Ey(n,e,t,r)}finally{ke=i,ea.transition=s}}function Ey(n,e,t,r){if(Cd){var i=gg(n,e,t,r);if(i===null)lp(n,e,r,Ed,t),wb(n,r);else if(tI(i,n,e,t,r))r.stopPropagation();else if(wb(n,r),e&4&&-1<eI.indexOf(n)){for(;i!==null;){var s=Dc(i);if(s!==null&&DT(s),s=gg(n,e,t,r),s===null&&lp(n,e,r,Ed,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else lp(n,e,r,null,t)}}var Ed=null;function gg(n,e,t,r){if(Ed=null,n=Sy(r),n=zs(n),n!==null)if(e=ho(n),e===null)n=null;else if(t=e.tag,t===13){if(n=PT(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Ed=n,null}function qT(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(VL()){case by:return 1;case LT:return 4;case bd:case WL:return 16;case IT:return 536870912;default:return 16}default:return 16}}var Ai=null,_y=null,Wu=null;function BT(){if(Wu)return Wu;var n,e=_y,t=e.length,r,i="value"in Ai?Ai.value:Ai.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return Wu=i.slice(n,1<r?1-r:void 0)}function Gu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function bu(){return!0}function Eb(){return!1}function An(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?bu:Eb,this.isPropagationStopped=Eb,this}return Ze(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=bu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=bu)},persist:function(){},isPersistent:bu}),e}var Ia={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ty=An(Ia),Mc=Ze({},Ia,{view:0,detail:0}),sI=An(Mc),Zf,ep,sl,vh=Ze({},Mc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xy,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==sl&&(sl&&n.type==="mousemove"?(Zf=n.screenX-sl.screenX,ep=n.screenY-sl.screenY):ep=Zf=0,sl=n),Zf)},movementY:function(n){return"movementY"in n?n.movementY:ep}}),_b=An(vh),oI=Ze({},vh,{dataTransfer:0}),aI=An(oI),lI=Ze({},Mc,{relatedTarget:0}),tp=An(lI),cI=Ze({},Ia,{animationName:0,elapsedTime:0,pseudoElement:0}),uI=An(cI),dI=Ze({},Ia,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),hI=An(dI),fI=Ze({},Ia,{data:0}),Tb=An(fI),pI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vI(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=gI[n])?!!e[n]:!1}function xy(){return vI}var yI=Ze({},Mc,{key:function(n){if(n.key){var e=pI[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Gu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?mI[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xy,charCode:function(n){return n.type==="keypress"?Gu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Gu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),SI=An(yI),bI=Ze({},vh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xb=An(bI),wI=Ze({},Mc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xy}),CI=An(wI),EI=Ze({},Ia,{propertyName:0,elapsedTime:0,pseudoElement:0}),_I=An(EI),TI=Ze({},vh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),xI=An(TI),OI=[9,13,27,32],Oy=ai&&"CompositionEvent"in window,Nl=null;ai&&"documentMode"in document&&(Nl=document.documentMode);var PI=ai&&"TextEvent"in window&&!Nl,UT=ai&&(!Oy||Nl&&8<Nl&&11>=Nl),Ob=String.fromCharCode(32),Pb=!1;function HT(n,e){switch(n){case"keyup":return OI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function VT(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var $o=!1;function RI(n,e){switch(n){case"compositionend":return VT(e);case"keypress":return e.which!==32?null:(Pb=!0,Ob);case"textInput":return n=e.data,n===Ob&&Pb?null:n;default:return null}}function kI(n,e){if($o)return n==="compositionend"||!Oy&&HT(n,e)?(n=BT(),Wu=_y=Ai=null,$o=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return UT&&e.locale!=="ko"?null:e.data;default:return null}}var NI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!NI[n.type]:e==="textarea"}function WT(n,e,t,r){ET(r),e=_d(e,"onChange"),0<e.length&&(t=new Ty("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Ll=null,rc=null;function LI(n){rx(n,0)}function yh(n){var e=Bo(n);if(gT(e))return n}function II(n,e){if(n==="change")return e}var GT=!1;if(ai){var np;if(ai){var rp="oninput"in document;if(!rp){var kb=document.createElement("div");kb.setAttribute("oninput","return;"),rp=typeof kb.oninput=="function"}np=rp}else np=!1;GT=np&&(!document.documentMode||9<document.documentMode)}function Nb(){Ll&&(Ll.detachEvent("onpropertychange",KT),rc=Ll=null)}function KT(n){if(n.propertyName==="value"&&yh(rc)){var e=[];WT(e,rc,n,Sy(n)),OT(LI,e)}}function AI(n,e,t){n==="focusin"?(Nb(),Ll=e,rc=t,Ll.attachEvent("onpropertychange",KT)):n==="focusout"&&Nb()}function MI(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return yh(rc)}function DI(n,e){if(n==="click")return yh(e)}function FI(n,e){if(n==="input"||n==="change")return yh(e)}function zI(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ur=typeof Object.is=="function"?Object.is:zI;function ic(n,e){if(ur(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Ym.call(e,i)||!ur(n[i],e[i]))return!1}return!0}function Lb(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Ib(n,e){var t=Lb(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Lb(t)}}function JT(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?JT(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function QT(){for(var n=window,e=vd();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=vd(n.document)}return e}function Py(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function $I(n){var e=QT(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&JT(t.ownerDocument.documentElement,t)){if(r!==null&&Py(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=Ib(t,s);var o=Ib(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var jI=ai&&"documentMode"in document&&11>=document.documentMode,jo=null,vg=null,Il=null,yg=!1;function Ab(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;yg||jo==null||jo!==vd(r)||(r=jo,"selectionStart"in r&&Py(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Il&&ic(Il,r)||(Il=r,r=_d(vg,"onSelect"),0<r.length&&(e=new Ty("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=jo)))}function wu(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var qo={animationend:wu("Animation","AnimationEnd"),animationiteration:wu("Animation","AnimationIteration"),animationstart:wu("Animation","AnimationStart"),transitionend:wu("Transition","TransitionEnd")},ip={},XT={};ai&&(XT=document.createElement("div").style,"AnimationEvent"in window||(delete qo.animationend.animation,delete qo.animationiteration.animation,delete qo.animationstart.animation),"TransitionEvent"in window||delete qo.transitionend.transition);function Sh(n){if(ip[n])return ip[n];if(!qo[n])return n;var e=qo[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in XT)return ip[n]=e[t];return n}var YT=Sh("animationend"),ZT=Sh("animationiteration"),ex=Sh("animationstart"),tx=Sh("transitionend"),nx=new Map,Mb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function us(n,e){nx.set(n,e),uo(e,[n])}for(var sp=0;sp<Mb.length;sp++){var op=Mb[sp],qI=op.toLowerCase(),BI=op[0].toUpperCase()+op.slice(1);us(qI,"on"+BI)}us(YT,"onAnimationEnd");us(ZT,"onAnimationIteration");us(ex,"onAnimationStart");us("dblclick","onDoubleClick");us("focusin","onFocus");us("focusout","onBlur");us(tx,"onTransitionEnd");pa("onMouseEnter",["mouseout","mouseover"]);pa("onMouseLeave",["mouseout","mouseover"]);pa("onPointerEnter",["pointerout","pointerover"]);pa("onPointerLeave",["pointerout","pointerover"]);uo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));uo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));uo("onBeforeInput",["compositionend","keypress","textInput","paste"]);uo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));uo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));uo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Tl));function Db(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,qL(r,e,void 0,n),n.currentTarget=null}function rx(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Db(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Db(i,a,c),s=l}}}if(Sd)throw n=fg,Sd=!1,fg=null,n}function $e(n,e){var t=e[Eg];t===void 0&&(t=e[Eg]=new Set);var r=n+"__bubble";t.has(r)||(ix(e,n,2,!1),t.add(r))}function ap(n,e,t){var r=0;e&&(r|=4),ix(t,n,r,e)}var Cu="_reactListening"+Math.random().toString(36).slice(2);function sc(n){if(!n[Cu]){n[Cu]=!0,dT.forEach(function(t){t!=="selectionchange"&&(UI.has(t)||ap(t,!1,n),ap(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Cu]||(e[Cu]=!0,ap("selectionchange",!1,e))}}function ix(n,e,t,r){switch(qT(e)){case 1:var i=rI;break;case 4:i=iI;break;default:i=Ey}t=i.bind(null,e,t,n),i=void 0,!hg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function lp(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=zs(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}OT(function(){var c=s,u=Sy(t),d=[];e:{var h=nx.get(n);if(h!==void 0){var f=Ty,p=n;switch(n){case"keypress":if(Gu(t)===0)break e;case"keydown":case"keyup":f=SI;break;case"focusin":p="focus",f=tp;break;case"focusout":p="blur",f=tp;break;case"beforeblur":case"afterblur":f=tp;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=_b;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=aI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=CI;break;case YT:case ZT:case ex:f=uI;break;case tx:f=_I;break;case"scroll":f=sI;break;case"wheel":f=xI;break;case"copy":case"cut":case"paste":f=hI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=xb}var g=(e&4)!==0,S=!g&&n==="scroll",m=g?h!==null?h+"Capture":null:h;g=[];for(var v=c,y;v!==null;){y=v;var b=y.stateNode;if(y.tag===5&&b!==null&&(y=b,m!==null&&(b=Zl(v,m),b!=null&&g.push(oc(v,b,y)))),S)break;v=v.return}0<g.length&&(h=new f(h,p,null,t,u),d.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==ug&&(p=t.relatedTarget||t.fromElement)&&(zs(p)||p[li]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=c,p=p?zs(p):null,p!==null&&(S=ho(p),p!==S||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(g=_b,b="onMouseLeave",m="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(g=xb,b="onPointerLeave",m="onPointerEnter",v="pointer"),S=f==null?h:Bo(f),y=p==null?h:Bo(p),h=new g(b,v+"leave",f,t,u),h.target=S,h.relatedTarget=y,b=null,zs(u)===c&&(g=new g(m,v+"enter",p,t,u),g.target=y,g.relatedTarget=S,b=g),S=b,f&&p)t:{for(g=f,m=p,v=0,y=g;y;y=To(y))v++;for(y=0,b=m;b;b=To(b))y++;for(;0<v-y;)g=To(g),v--;for(;0<y-v;)m=To(m),y--;for(;v--;){if(g===m||m!==null&&g===m.alternate)break t;g=To(g),m=To(m)}g=null}else g=null;f!==null&&Fb(d,h,f,g,!1),p!==null&&S!==null&&Fb(d,S,p,g,!0)}}e:{if(h=c?Bo(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var w=II;else if(Rb(h))if(GT)w=FI;else{w=MI;var _=AI}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(w=DI);if(w&&(w=w(n,c))){WT(d,w,t,u);break e}_&&_(n,h,c),n==="focusout"&&(_=h._wrapperState)&&_.controlled&&h.type==="number"&&sg(h,"number",h.value)}switch(_=c?Bo(c):window,n){case"focusin":(Rb(_)||_.contentEditable==="true")&&(jo=_,vg=c,Il=null);break;case"focusout":Il=vg=jo=null;break;case"mousedown":yg=!0;break;case"contextmenu":case"mouseup":case"dragend":yg=!1,Ab(d,t,u);break;case"selectionchange":if(jI)break;case"keydown":case"keyup":Ab(d,t,u)}var E;if(Oy)e:{switch(n){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else $o?HT(n,t)&&(P="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(P="onCompositionStart");P&&(UT&&t.locale!=="ko"&&($o||P!=="onCompositionStart"?P==="onCompositionEnd"&&$o&&(E=BT()):(Ai=u,_y="value"in Ai?Ai.value:Ai.textContent,$o=!0)),_=_d(c,P),0<_.length&&(P=new Tb(P,n,null,t,u),d.push({event:P,listeners:_}),E?P.data=E:(E=VT(t),E!==null&&(P.data=E)))),(E=PI?RI(n,t):kI(n,t))&&(c=_d(c,"onBeforeInput"),0<c.length&&(u=new Tb("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=E))}rx(d,e)})}function oc(n,e,t){return{instance:n,listener:e,currentTarget:t}}function _d(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Zl(n,t),s!=null&&r.unshift(oc(n,s,i)),s=Zl(n,e),s!=null&&r.push(oc(n,s,i))),n=n.return}return r}function To(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Fb(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Zl(t,s),l!=null&&o.unshift(oc(t,l,a))):i||(l=Zl(t,s),l!=null&&o.push(oc(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var HI=/\r\n?/g,VI=/\u0000|\uFFFD/g;function zb(n){return(typeof n=="string"?n:""+n).replace(HI,`
`).replace(VI,"")}function Eu(n,e,t){if(e=zb(e),zb(n)!==e&&t)throw Error($(425))}function Td(){}var Sg=null,bg=null;function wg(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cg=typeof setTimeout=="function"?setTimeout:void 0,WI=typeof clearTimeout=="function"?clearTimeout:void 0,$b=typeof Promise=="function"?Promise:void 0,GI=typeof queueMicrotask=="function"?queueMicrotask:typeof $b<"u"?function(n){return $b.resolve(null).then(n).catch(KI)}:Cg;function KI(n){setTimeout(function(){throw n})}function cp(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),nc(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);nc(e)}function Wi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function jb(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Aa=Math.random().toString(36).slice(2),Cr="__reactFiber$"+Aa,ac="__reactProps$"+Aa,li="__reactContainer$"+Aa,Eg="__reactEvents$"+Aa,JI="__reactListeners$"+Aa,QI="__reactHandles$"+Aa;function zs(n){var e=n[Cr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[li]||t[Cr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=jb(n);n!==null;){if(t=n[Cr])return t;n=jb(n)}return e}n=t,t=n.parentNode}return null}function Dc(n){return n=n[Cr]||n[li],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Bo(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error($(33))}function bh(n){return n[ac]||null}var _g=[],Uo=-1;function ds(n){return{current:n}}function Be(n){0>Uo||(n.current=_g[Uo],_g[Uo]=null,Uo--)}function Fe(n,e){Uo++,_g[Uo]=n.current,n.current=e}var os={},Ut=ds(os),dn=ds(!1),Xs=os;function ma(n,e){var t=n.type.contextTypes;if(!t)return os;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function hn(n){return n=n.childContextTypes,n!=null}function xd(){Be(dn),Be(Ut)}function qb(n,e,t){if(Ut.current!==os)throw Error($(168));Fe(Ut,e),Fe(dn,t)}function sx(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error($(108,AL(n)||"Unknown",i));return Ze({},t,r)}function Od(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||os,Xs=Ut.current,Fe(Ut,n),Fe(dn,dn.current),!0}function Bb(n,e,t){var r=n.stateNode;if(!r)throw Error($(169));t?(n=sx(n,e,Xs),r.__reactInternalMemoizedMergedChildContext=n,Be(dn),Be(Ut),Fe(Ut,n)):Be(dn),Fe(dn,t)}var Xr=null,wh=!1,up=!1;function ox(n){Xr===null?Xr=[n]:Xr.push(n)}function XI(n){wh=!0,ox(n)}function hs(){if(!up&&Xr!==null){up=!0;var n=0,e=ke;try{var t=Xr;for(ke=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Xr=null,wh=!1}catch(i){throw Xr!==null&&(Xr=Xr.slice(n+1)),NT(by,hs),i}finally{ke=e,up=!1}}return null}var Ho=[],Vo=0,Pd=null,Rd=0,Dn=[],Fn=0,Ys=null,Zr=1,ei="";function bs(n,e){Ho[Vo++]=Rd,Ho[Vo++]=Pd,Pd=n,Rd=e}function ax(n,e,t){Dn[Fn++]=Zr,Dn[Fn++]=ei,Dn[Fn++]=Ys,Ys=n;var r=Zr;n=ei;var i=32-or(r)-1;r&=~(1<<i),t+=1;var s=32-or(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Zr=1<<32-or(e)+i|t<<i|r,ei=s+n}else Zr=1<<s|t<<i|r,ei=n}function Ry(n){n.return!==null&&(bs(n,1),ax(n,1,0))}function ky(n){for(;n===Pd;)Pd=Ho[--Vo],Ho[Vo]=null,Rd=Ho[--Vo],Ho[Vo]=null;for(;n===Ys;)Ys=Dn[--Fn],Dn[Fn]=null,ei=Dn[--Fn],Dn[Fn]=null,Zr=Dn[--Fn],Dn[Fn]=null}var Pn=null,xn=null,We=!1,rr=null;function lx(n,e){var t=Bn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Ub(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Pn=n,xn=Wi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Pn=n,xn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ys!==null?{id:Zr,overflow:ei}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Bn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Pn=n,xn=null,!0):!1;default:return!1}}function Tg(n){return(n.mode&1)!==0&&(n.flags&128)===0}function xg(n){if(We){var e=xn;if(e){var t=e;if(!Ub(n,e)){if(Tg(n))throw Error($(418));e=Wi(t.nextSibling);var r=Pn;e&&Ub(n,e)?lx(r,t):(n.flags=n.flags&-4097|2,We=!1,Pn=n)}}else{if(Tg(n))throw Error($(418));n.flags=n.flags&-4097|2,We=!1,Pn=n}}}function Hb(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Pn=n}function _u(n){if(n!==Pn)return!1;if(!We)return Hb(n),We=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!wg(n.type,n.memoizedProps)),e&&(e=xn)){if(Tg(n))throw cx(),Error($(418));for(;e;)lx(n,e),e=Wi(e.nextSibling)}if(Hb(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error($(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){xn=Wi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}xn=null}}else xn=Pn?Wi(n.stateNode.nextSibling):null;return!0}function cx(){for(var n=xn;n;)n=Wi(n.nextSibling)}function ga(){xn=Pn=null,We=!1}function Ny(n){rr===null?rr=[n]:rr.push(n)}var YI=mi.ReactCurrentBatchConfig;function ol(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error($(309));var r=t.stateNode}if(!r)throw Error($(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error($(284));if(!t._owner)throw Error($(290,n))}return n}function Tu(n,e){throw n=Object.prototype.toString.call(e),Error($(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Vb(n){var e=n._init;return e(n._payload)}function ux(n){function e(m,v){if(n){var y=m.deletions;y===null?(m.deletions=[v],m.flags|=16):y.push(v)}}function t(m,v){if(!n)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function r(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function i(m,v){return m=Qi(m,v),m.index=0,m.sibling=null,m}function s(m,v,y){return m.index=y,n?(y=m.alternate,y!==null?(y=y.index,y<v?(m.flags|=2,v):y):(m.flags|=2,v)):(m.flags|=1048576,v)}function o(m){return n&&m.alternate===null&&(m.flags|=2),m}function a(m,v,y,b){return v===null||v.tag!==6?(v=vp(y,m.mode,b),v.return=m,v):(v=i(v,y),v.return=m,v)}function l(m,v,y,b){var w=y.type;return w===zo?u(m,v,y.props.children,b,y.key):v!==null&&(v.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Oi&&Vb(w)===v.type)?(b=i(v,y.props),b.ref=ol(m,v,y),b.return=m,b):(b=ed(y.type,y.key,y.props,null,m.mode,b),b.ref=ol(m,v,y),b.return=m,b)}function c(m,v,y,b){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=yp(y,m.mode,b),v.return=m,v):(v=i(v,y.children||[]),v.return=m,v)}function u(m,v,y,b,w){return v===null||v.tag!==7?(v=Vs(y,m.mode,b,w),v.return=m,v):(v=i(v,y),v.return=m,v)}function d(m,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=vp(""+v,m.mode,y),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case pu:return y=ed(v.type,v.key,v.props,null,m.mode,y),y.ref=ol(m,null,v),y.return=m,y;case Fo:return v=yp(v,m.mode,y),v.return=m,v;case Oi:var b=v._init;return d(m,b(v._payload),y)}if(El(v)||tl(v))return v=Vs(v,m.mode,y,null),v.return=m,v;Tu(m,v)}return null}function h(m,v,y,b){var w=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return w!==null?null:a(m,v,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case pu:return y.key===w?l(m,v,y,b):null;case Fo:return y.key===w?c(m,v,y,b):null;case Oi:return w=y._init,h(m,v,w(y._payload),b)}if(El(y)||tl(y))return w!==null?null:u(m,v,y,b,null);Tu(m,y)}return null}function f(m,v,y,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return m=m.get(y)||null,a(v,m,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case pu:return m=m.get(b.key===null?y:b.key)||null,l(v,m,b,w);case Fo:return m=m.get(b.key===null?y:b.key)||null,c(v,m,b,w);case Oi:var _=b._init;return f(m,v,y,_(b._payload),w)}if(El(b)||tl(b))return m=m.get(y)||null,u(v,m,b,w,null);Tu(v,b)}return null}function p(m,v,y,b){for(var w=null,_=null,E=v,P=v=0,A=null;E!==null&&P<y.length;P++){E.index>P?(A=E,E=null):A=E.sibling;var F=h(m,E,y[P],b);if(F===null){E===null&&(E=A);break}n&&E&&F.alternate===null&&e(m,E),v=s(F,v,P),_===null?w=F:_.sibling=F,_=F,E=A}if(P===y.length)return t(m,E),We&&bs(m,P),w;if(E===null){for(;P<y.length;P++)E=d(m,y[P],b),E!==null&&(v=s(E,v,P),_===null?w=E:_.sibling=E,_=E);return We&&bs(m,P),w}for(E=r(m,E);P<y.length;P++)A=f(E,m,P,y[P],b),A!==null&&(n&&A.alternate!==null&&E.delete(A.key===null?P:A.key),v=s(A,v,P),_===null?w=A:_.sibling=A,_=A);return n&&E.forEach(function(X){return e(m,X)}),We&&bs(m,P),w}function g(m,v,y,b){var w=tl(y);if(typeof w!="function")throw Error($(150));if(y=w.call(y),y==null)throw Error($(151));for(var _=w=null,E=v,P=v=0,A=null,F=y.next();E!==null&&!F.done;P++,F=y.next()){E.index>P?(A=E,E=null):A=E.sibling;var X=h(m,E,F.value,b);if(X===null){E===null&&(E=A);break}n&&E&&X.alternate===null&&e(m,E),v=s(X,v,P),_===null?w=X:_.sibling=X,_=X,E=A}if(F.done)return t(m,E),We&&bs(m,P),w;if(E===null){for(;!F.done;P++,F=y.next())F=d(m,F.value,b),F!==null&&(v=s(F,v,P),_===null?w=F:_.sibling=F,_=F);return We&&bs(m,P),w}for(E=r(m,E);!F.done;P++,F=y.next())F=f(E,m,P,F.value,b),F!==null&&(n&&F.alternate!==null&&E.delete(F.key===null?P:F.key),v=s(F,v,P),_===null?w=F:_.sibling=F,_=F);return n&&E.forEach(function(z){return e(m,z)}),We&&bs(m,P),w}function S(m,v,y,b){if(typeof y=="object"&&y!==null&&y.type===zo&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case pu:e:{for(var w=y.key,_=v;_!==null;){if(_.key===w){if(w=y.type,w===zo){if(_.tag===7){t(m,_.sibling),v=i(_,y.props.children),v.return=m,m=v;break e}}else if(_.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Oi&&Vb(w)===_.type){t(m,_.sibling),v=i(_,y.props),v.ref=ol(m,_,y),v.return=m,m=v;break e}t(m,_);break}else e(m,_);_=_.sibling}y.type===zo?(v=Vs(y.props.children,m.mode,b,y.key),v.return=m,m=v):(b=ed(y.type,y.key,y.props,null,m.mode,b),b.ref=ol(m,v,y),b.return=m,m=b)}return o(m);case Fo:e:{for(_=y.key;v!==null;){if(v.key===_)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){t(m,v.sibling),v=i(v,y.children||[]),v.return=m,m=v;break e}else{t(m,v);break}else e(m,v);v=v.sibling}v=yp(y,m.mode,b),v.return=m,m=v}return o(m);case Oi:return _=y._init,S(m,v,_(y._payload),b)}if(El(y))return p(m,v,y,b);if(tl(y))return g(m,v,y,b);Tu(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(t(m,v.sibling),v=i(v,y),v.return=m,m=v):(t(m,v),v=vp(y,m.mode,b),v.return=m,m=v),o(m)):t(m,v)}return S}var va=ux(!0),dx=ux(!1),kd=ds(null),Nd=null,Wo=null,Ly=null;function Iy(){Ly=Wo=Nd=null}function Ay(n){var e=kd.current;Be(kd),n._currentValue=e}function Og(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ta(n,e){Nd=n,Ly=Wo=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(un=!0),n.firstContext=null)}function Gn(n){var e=n._currentValue;if(Ly!==n)if(n={context:n,memoizedValue:e,next:null},Wo===null){if(Nd===null)throw Error($(308));Wo=n,Nd.dependencies={lanes:0,firstContext:n}}else Wo=Wo.next=n;return e}var $s=null;function My(n){$s===null?$s=[n]:$s.push(n)}function hx(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,My(e)):(t.next=i.next,i.next=t),e.interleaved=t,ci(n,r)}function ci(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Pi=!1;function Dy(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fx(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ni(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Gi(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Ce&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ci(n,t)}return i=r.interleaved,i===null?(e.next=e,My(r)):(e.next=i.next,i.next=e),r.interleaved=e,ci(n,t)}function Ku(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,wy(n,t)}}function Wb(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ld(n,e,t,r){var i=n.updateQueue;Pi=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,f=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,g=a;switch(h=e,f=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=Ze({},d,h);break e;case 2:Pi=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);eo|=o,n.lanes=o,n.memoizedState=d}}function Gb(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error($(191,i));i.call(r)}}}var Fc={},Pr=ds(Fc),lc=ds(Fc),cc=ds(Fc);function js(n){if(n===Fc)throw Error($(174));return n}function Fy(n,e){switch(Fe(cc,e),Fe(lc,n),Fe(Pr,Fc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ag(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=ag(e,n)}Be(Pr),Fe(Pr,e)}function ya(){Be(Pr),Be(lc),Be(cc)}function px(n){js(cc.current);var e=js(Pr.current),t=ag(e,n.type);e!==t&&(Fe(lc,n),Fe(Pr,t))}function zy(n){lc.current===n&&(Be(Pr),Be(lc))}var Je=ds(0);function Id(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var dp=[];function $y(){for(var n=0;n<dp.length;n++)dp[n]._workInProgressVersionPrimary=null;dp.length=0}var Ju=mi.ReactCurrentDispatcher,hp=mi.ReactCurrentBatchConfig,Zs=0,Ye=null,pt=null,wt=null,Ad=!1,Al=!1,uc=0,ZI=0;function Lt(){throw Error($(321))}function jy(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!ur(n[t],e[t]))return!1;return!0}function qy(n,e,t,r,i,s){if(Zs=s,Ye=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ju.current=n===null||n.memoizedState===null?rA:iA,n=t(r,i),Al){s=0;do{if(Al=!1,uc=0,25<=s)throw Error($(301));s+=1,wt=pt=null,e.updateQueue=null,Ju.current=sA,n=t(r,i)}while(Al)}if(Ju.current=Md,e=pt!==null&&pt.next!==null,Zs=0,wt=pt=Ye=null,Ad=!1,e)throw Error($(300));return n}function By(){var n=uc!==0;return uc=0,n}function vr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wt===null?Ye.memoizedState=wt=n:wt=wt.next=n,wt}function Kn(){if(pt===null){var n=Ye.alternate;n=n!==null?n.memoizedState:null}else n=pt.next;var e=wt===null?Ye.memoizedState:wt.next;if(e!==null)wt=e,pt=n;else{if(n===null)throw Error($(310));pt=n,n={memoizedState:pt.memoizedState,baseState:pt.baseState,baseQueue:pt.baseQueue,queue:pt.queue,next:null},wt===null?Ye.memoizedState=wt=n:wt=wt.next=n}return wt}function dc(n,e){return typeof e=="function"?e(n):e}function fp(n){var e=Kn(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=n;var r=pt,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Zs&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,Ye.lanes|=u,eo|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,ur(r,e.memoizedState)||(un=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Ye.lanes|=s,eo|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function pp(n){var e=Kn(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);ur(s,e.memoizedState)||(un=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function mx(){}function gx(n,e){var t=Ye,r=Kn(),i=e(),s=!ur(r.memoizedState,i);if(s&&(r.memoizedState=i,un=!0),r=r.queue,Uy(Sx.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||wt!==null&&wt.memoizedState.tag&1){if(t.flags|=2048,hc(9,yx.bind(null,t,r,i,e),void 0,null),Ct===null)throw Error($(349));Zs&30||vx(t,e,i)}return i}function vx(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function yx(n,e,t,r){e.value=t,e.getSnapshot=r,bx(e)&&wx(n)}function Sx(n,e,t){return t(function(){bx(e)&&wx(n)})}function bx(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!ur(n,t)}catch{return!0}}function wx(n){var e=ci(n,1);e!==null&&ar(e,n,1,-1)}function Kb(n){var e=vr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dc,lastRenderedState:n},e.queue=n,n=n.dispatch=nA.bind(null,Ye,n),[e.memoizedState,n]}function hc(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Cx(){return Kn().memoizedState}function Qu(n,e,t,r){var i=vr();Ye.flags|=n,i.memoizedState=hc(1|e,t,void 0,r===void 0?null:r)}function Ch(n,e,t,r){var i=Kn();r=r===void 0?null:r;var s=void 0;if(pt!==null){var o=pt.memoizedState;if(s=o.destroy,r!==null&&jy(r,o.deps)){i.memoizedState=hc(e,t,s,r);return}}Ye.flags|=n,i.memoizedState=hc(1|e,t,s,r)}function Jb(n,e){return Qu(8390656,8,n,e)}function Uy(n,e){return Ch(2048,8,n,e)}function Ex(n,e){return Ch(4,2,n,e)}function _x(n,e){return Ch(4,4,n,e)}function Tx(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function xx(n,e,t){return t=t!=null?t.concat([n]):null,Ch(4,4,Tx.bind(null,e,n),t)}function Hy(){}function Ox(n,e){var t=Kn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&jy(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Px(n,e){var t=Kn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&jy(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Rx(n,e,t){return Zs&21?(ur(t,e)||(t=AT(),Ye.lanes|=t,eo|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,un=!0),n.memoizedState=t)}function eA(n,e){var t=ke;ke=t!==0&&4>t?t:4,n(!0);var r=hp.transition;hp.transition={};try{n(!1),e()}finally{ke=t,hp.transition=r}}function kx(){return Kn().memoizedState}function tA(n,e,t){var r=Ji(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Nx(n))Lx(e,t);else if(t=hx(n,e,t,r),t!==null){var i=Yt();ar(t,n,r,i),Ix(t,e,r)}}function nA(n,e,t){var r=Ji(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Nx(n))Lx(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,ur(a,o)){var l=e.interleaved;l===null?(i.next=i,My(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=hx(n,e,i,r),t!==null&&(i=Yt(),ar(t,n,r,i),Ix(t,e,r))}}function Nx(n){var e=n.alternate;return n===Ye||e!==null&&e===Ye}function Lx(n,e){Al=Ad=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Ix(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,wy(n,t)}}var Md={readContext:Gn,useCallback:Lt,useContext:Lt,useEffect:Lt,useImperativeHandle:Lt,useInsertionEffect:Lt,useLayoutEffect:Lt,useMemo:Lt,useReducer:Lt,useRef:Lt,useState:Lt,useDebugValue:Lt,useDeferredValue:Lt,useTransition:Lt,useMutableSource:Lt,useSyncExternalStore:Lt,useId:Lt,unstable_isNewReconciler:!1},rA={readContext:Gn,useCallback:function(n,e){return vr().memoizedState=[n,e===void 0?null:e],n},useContext:Gn,useEffect:Jb,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Qu(4194308,4,Tx.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Qu(4194308,4,n,e)},useInsertionEffect:function(n,e){return Qu(4,2,n,e)},useMemo:function(n,e){var t=vr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=vr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=tA.bind(null,Ye,n),[r.memoizedState,n]},useRef:function(n){var e=vr();return n={current:n},e.memoizedState=n},useState:Kb,useDebugValue:Hy,useDeferredValue:function(n){return vr().memoizedState=n},useTransition:function(){var n=Kb(!1),e=n[0];return n=eA.bind(null,n[1]),vr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Ye,i=vr();if(We){if(t===void 0)throw Error($(407));t=t()}else{if(t=e(),Ct===null)throw Error($(349));Zs&30||vx(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,Jb(Sx.bind(null,r,s,n),[n]),r.flags|=2048,hc(9,yx.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=vr(),e=Ct.identifierPrefix;if(We){var t=ei,r=Zr;t=(r&~(1<<32-or(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=uc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=ZI++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},iA={readContext:Gn,useCallback:Ox,useContext:Gn,useEffect:Uy,useImperativeHandle:xx,useInsertionEffect:Ex,useLayoutEffect:_x,useMemo:Px,useReducer:fp,useRef:Cx,useState:function(){return fp(dc)},useDebugValue:Hy,useDeferredValue:function(n){var e=Kn();return Rx(e,pt.memoizedState,n)},useTransition:function(){var n=fp(dc)[0],e=Kn().memoizedState;return[n,e]},useMutableSource:mx,useSyncExternalStore:gx,useId:kx,unstable_isNewReconciler:!1},sA={readContext:Gn,useCallback:Ox,useContext:Gn,useEffect:Uy,useImperativeHandle:xx,useInsertionEffect:Ex,useLayoutEffect:_x,useMemo:Px,useReducer:pp,useRef:Cx,useState:function(){return pp(dc)},useDebugValue:Hy,useDeferredValue:function(n){var e=Kn();return pt===null?e.memoizedState=n:Rx(e,pt.memoizedState,n)},useTransition:function(){var n=pp(dc)[0],e=Kn().memoizedState;return[n,e]},useMutableSource:mx,useSyncExternalStore:gx,useId:kx,unstable_isNewReconciler:!1};function Zn(n,e){if(n&&n.defaultProps){e=Ze({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Pg(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Ze({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Eh={isMounted:function(n){return(n=n._reactInternals)?ho(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Yt(),i=Ji(n),s=ni(r,i);s.payload=e,t!=null&&(s.callback=t),e=Gi(n,s,i),e!==null&&(ar(e,n,i,r),Ku(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Yt(),i=Ji(n),s=ni(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Gi(n,s,i),e!==null&&(ar(e,n,i,r),Ku(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Yt(),r=Ji(n),i=ni(t,r);i.tag=2,e!=null&&(i.callback=e),e=Gi(n,i,r),e!==null&&(ar(e,n,r,t),Ku(e,n,r))}};function Qb(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!ic(t,r)||!ic(i,s):!0}function Ax(n,e,t){var r=!1,i=os,s=e.contextType;return typeof s=="object"&&s!==null?s=Gn(s):(i=hn(e)?Xs:Ut.current,r=e.contextTypes,s=(r=r!=null)?ma(n,i):os),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Eh,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function Xb(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Eh.enqueueReplaceState(e,e.state,null)}function Rg(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Dy(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Gn(s):(s=hn(e)?Xs:Ut.current,i.context=ma(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Pg(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Eh.enqueueReplaceState(i,i.state,null),Ld(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Sa(n,e){try{var t="",r=e;do t+=IL(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function mp(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function kg(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var oA=typeof WeakMap=="function"?WeakMap:Map;function Mx(n,e,t){t=ni(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Fd||(Fd=!0,jg=r),kg(n,e)},t}function Dx(n,e,t){t=ni(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){kg(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){kg(n,e),typeof r!="function"&&(Ki===null?Ki=new Set([this]):Ki.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Yb(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new oA;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=bA.bind(null,n,e,t),e.then(n,n))}function Zb(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function ew(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ni(-1,1),e.tag=2,Gi(t,e,1))),t.lanes|=1),n)}var aA=mi.ReactCurrentOwner,un=!1;function Kt(n,e,t,r){e.child=n===null?dx(e,null,t,r):va(e,n.child,t,r)}function tw(n,e,t,r,i){t=t.render;var s=e.ref;return ta(e,i),r=qy(n,e,t,r,s,i),t=By(),n!==null&&!un?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ui(n,e,i)):(We&&t&&Ry(e),e.flags|=1,Kt(n,e,r,i),e.child)}function nw(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Yy(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,Fx(n,e,s,r,i)):(n=ed(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:ic,t(o,r)&&n.ref===e.ref)return ui(n,e,i)}return e.flags|=1,n=Qi(s,r),n.ref=e.ref,n.return=e,e.child=n}function Fx(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(ic(s,r)&&n.ref===e.ref)if(un=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(un=!0);else return e.lanes=n.lanes,ui(n,e,i)}return Ng(n,e,t,r,i)}function zx(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fe(Ko,Sn),Sn|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Fe(Ko,Sn),Sn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Fe(Ko,Sn),Sn|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Fe(Ko,Sn),Sn|=r;return Kt(n,e,i,t),e.child}function $x(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Ng(n,e,t,r,i){var s=hn(t)?Xs:Ut.current;return s=ma(e,s),ta(e,i),t=qy(n,e,t,r,s,i),r=By(),n!==null&&!un?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ui(n,e,i)):(We&&r&&Ry(e),e.flags|=1,Kt(n,e,t,i),e.child)}function rw(n,e,t,r,i){if(hn(t)){var s=!0;Od(e)}else s=!1;if(ta(e,i),e.stateNode===null)Xu(n,e),Ax(e,t,r),Rg(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Gn(c):(c=hn(t)?Xs:Ut.current,c=ma(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Xb(e,o,r,c),Pi=!1;var h=e.memoizedState;o.state=h,Ld(e,r,o,i),l=e.memoizedState,a!==r||h!==l||dn.current||Pi?(typeof u=="function"&&(Pg(e,t,u,r),l=e.memoizedState),(a=Pi||Qb(e,t,a,r,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,fx(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Zn(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Gn(l):(l=hn(t)?Xs:Ut.current,l=ma(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Xb(e,o,r,l),Pi=!1,h=e.memoizedState,o.state=h,Ld(e,r,o,i);var p=e.memoizedState;a!==d||h!==p||dn.current||Pi?(typeof f=="function"&&(Pg(e,t,f,r),p=e.memoizedState),(c=Pi||Qb(e,t,c,r,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return Lg(n,e,t,r,s,i)}function Lg(n,e,t,r,i,s){$x(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Bb(e,t,!1),ui(n,e,s);r=e.stateNode,aA.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=va(e,n.child,null,s),e.child=va(e,null,a,s)):Kt(n,e,a,s),e.memoizedState=r.state,i&&Bb(e,t,!0),e.child}function jx(n){var e=n.stateNode;e.pendingContext?qb(n,e.pendingContext,e.pendingContext!==e.context):e.context&&qb(n,e.context,!1),Fy(n,e.containerInfo)}function iw(n,e,t,r,i){return ga(),Ny(i),e.flags|=256,Kt(n,e,t,r),e.child}var Ig={dehydrated:null,treeContext:null,retryLane:0};function Ag(n){return{baseLanes:n,cachePool:null,transitions:null}}function qx(n,e,t){var r=e.pendingProps,i=Je.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Fe(Je,i&1),n===null)return xg(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=xh(o,r,0,null),n=Vs(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Ag(t),e.memoizedState=Ig,n):Vy(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return lA(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Qi(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Qi(a,s):(s=Vs(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?Ag(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=Ig,r}return s=n.child,n=s.sibling,r=Qi(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Vy(n,e){return e=xh({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function xu(n,e,t,r){return r!==null&&Ny(r),va(e,n.child,null,t),n=Vy(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function lA(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=mp(Error($(422))),xu(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=xh({mode:"visible",children:r.children},i,0,null),s=Vs(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&va(e,n.child,null,o),e.child.memoizedState=Ag(o),e.memoizedState=Ig,s);if(!(e.mode&1))return xu(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error($(419)),r=mp(s,r,void 0),xu(n,e,o,r)}if(a=(o&n.childLanes)!==0,un||a){if(r=Ct,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ci(n,i),ar(r,n,i,-1))}return Xy(),r=mp(Error($(421))),xu(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=wA.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,xn=Wi(i.nextSibling),Pn=e,We=!0,rr=null,n!==null&&(Dn[Fn++]=Zr,Dn[Fn++]=ei,Dn[Fn++]=Ys,Zr=n.id,ei=n.overflow,Ys=e),e=Vy(e,r.children),e.flags|=4096,e)}function sw(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Og(n.return,e,t)}function gp(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function Bx(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Kt(n,e,r.children,t),r=Je.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&sw(n,t,e);else if(n.tag===19)sw(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Fe(Je,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Id(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),gp(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Id(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}gp(e,!0,t,null,s);break;case"together":gp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Xu(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ui(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),eo|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error($(153));if(e.child!==null){for(n=e.child,t=Qi(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Qi(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function cA(n,e,t){switch(e.tag){case 3:jx(e),ga();break;case 5:px(e);break;case 1:hn(e.type)&&Od(e);break;case 4:Fy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Fe(kd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Fe(Je,Je.current&1),e.flags|=128,null):t&e.child.childLanes?qx(n,e,t):(Fe(Je,Je.current&1),n=ui(n,e,t),n!==null?n.sibling:null);Fe(Je,Je.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Bx(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Fe(Je,Je.current),r)break;return null;case 22:case 23:return e.lanes=0,zx(n,e,t)}return ui(n,e,t)}var Ux,Mg,Hx,Vx;Ux=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Mg=function(){};Hx=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,js(Pr.current);var s=null;switch(t){case"input":i=rg(n,i),r=rg(n,r),s=[];break;case"select":i=Ze({},i,{value:void 0}),r=Ze({},r,{value:void 0}),s=[];break;case"textarea":i=og(n,i),r=og(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Td)}lg(t,r);var o;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Xl.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Xl.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&$e("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Vx=function(n,e,t,r){t!==r&&(e.flags|=4)};function al(n,e){if(!We)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function It(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function uA(n,e,t){var r=e.pendingProps;switch(ky(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return It(e),null;case 1:return hn(e.type)&&xd(),It(e),null;case 3:return r=e.stateNode,ya(),Be(dn),Be(Ut),$y(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(_u(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,rr!==null&&(Ug(rr),rr=null))),Mg(n,e),It(e),null;case 5:zy(e);var i=js(cc.current);if(t=e.type,n!==null&&e.stateNode!=null)Hx(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error($(166));return It(e),null}if(n=js(Pr.current),_u(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[Cr]=e,r[ac]=s,n=(e.mode&1)!==0,t){case"dialog":$e("cancel",r),$e("close",r);break;case"iframe":case"object":case"embed":$e("load",r);break;case"video":case"audio":for(i=0;i<Tl.length;i++)$e(Tl[i],r);break;case"source":$e("error",r);break;case"img":case"image":case"link":$e("error",r),$e("load",r);break;case"details":$e("toggle",r);break;case"input":pb(r,s),$e("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},$e("invalid",r);break;case"textarea":gb(r,s),$e("invalid",r)}lg(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Eu(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Eu(r.textContent,a,n),i=["children",""+a]):Xl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&$e("scroll",r)}switch(t){case"input":mu(r),mb(r,s,!0);break;case"textarea":mu(r),vb(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Td)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=ST(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Cr]=e,n[ac]=r,Ux(n,e,!1,!1),e.stateNode=n;e:{switch(o=cg(t,r),t){case"dialog":$e("cancel",n),$e("close",n),i=r;break;case"iframe":case"object":case"embed":$e("load",n),i=r;break;case"video":case"audio":for(i=0;i<Tl.length;i++)$e(Tl[i],n);i=r;break;case"source":$e("error",n),i=r;break;case"img":case"image":case"link":$e("error",n),$e("load",n),i=r;break;case"details":$e("toggle",n),i=r;break;case"input":pb(n,r),i=rg(n,r),$e("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Ze({},r,{value:void 0}),$e("invalid",n);break;case"textarea":gb(n,r),i=og(n,r),$e("invalid",n);break;default:i=r}lg(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?CT(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&bT(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Yl(n,l):typeof l=="number"&&Yl(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Xl.hasOwnProperty(s)?l!=null&&s==="onScroll"&&$e("scroll",n):l!=null&&my(n,s,l,o))}switch(t){case"input":mu(n),mb(n,r,!1);break;case"textarea":mu(n),vb(n);break;case"option":r.value!=null&&n.setAttribute("value",""+ss(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Xo(n,!!r.multiple,s,!1):r.defaultValue!=null&&Xo(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Td)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return It(e),null;case 6:if(n&&e.stateNode!=null)Vx(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error($(166));if(t=js(cc.current),js(Pr.current),_u(e)){if(r=e.stateNode,t=e.memoizedProps,r[Cr]=e,(s=r.nodeValue!==t)&&(n=Pn,n!==null))switch(n.tag){case 3:Eu(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Eu(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Cr]=e,e.stateNode=r}return It(e),null;case 13:if(Be(Je),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(We&&xn!==null&&e.mode&1&&!(e.flags&128))cx(),ga(),e.flags|=98560,s=!1;else if(s=_u(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error($(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error($(317));s[Cr]=e}else ga(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;It(e),s=!1}else rr!==null&&(Ug(rr),rr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Je.current&1?gt===0&&(gt=3):Xy())),e.updateQueue!==null&&(e.flags|=4),It(e),null);case 4:return ya(),Mg(n,e),n===null&&sc(e.stateNode.containerInfo),It(e),null;case 10:return Ay(e.type._context),It(e),null;case 17:return hn(e.type)&&xd(),It(e),null;case 19:if(Be(Je),s=e.memoizedState,s===null)return It(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)al(s,!1);else{if(gt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Id(n),o!==null){for(e.flags|=128,al(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Fe(Je,Je.current&1|2),e.child}n=n.sibling}s.tail!==null&&it()>ba&&(e.flags|=128,r=!0,al(s,!1),e.lanes=4194304)}else{if(!r)if(n=Id(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),al(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!We)return It(e),null}else 2*it()-s.renderingStartTime>ba&&t!==1073741824&&(e.flags|=128,r=!0,al(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=it(),e.sibling=null,t=Je.current,Fe(Je,r?t&1|2:t&1),e):(It(e),null);case 22:case 23:return Qy(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Sn&1073741824&&(It(e),e.subtreeFlags&6&&(e.flags|=8192)):It(e),null;case 24:return null;case 25:return null}throw Error($(156,e.tag))}function dA(n,e){switch(ky(e),e.tag){case 1:return hn(e.type)&&xd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return ya(),Be(dn),Be(Ut),$y(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return zy(e),null;case 13:if(Be(Je),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error($(340));ga()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Be(Je),null;case 4:return ya(),null;case 10:return Ay(e.type._context),null;case 22:case 23:return Qy(),null;case 24:return null;default:return null}}var Ou=!1,qt=!1,hA=typeof WeakSet=="function"?WeakSet:Set,J=null;function Go(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){tt(n,e,r)}else t.current=null}function Dg(n,e,t){try{t()}catch(r){tt(n,e,r)}}var ow=!1;function fA(n,e){if(Sg=Cd,n=QT(),Py(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=n,h=null;t:for(;;){for(var f;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(bg={focusedElem:n,selectionRange:t},Cd=!1,J=e;J!==null;)if(e=J,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,J=n;else for(;J!==null;){e=J;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,S=p.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?g:Zn(e.type,g),S);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($(163))}}catch(b){tt(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,J=n;break}J=e.return}return p=ow,ow=!1,p}function Ml(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&Dg(e,t,s)}i=i.next}while(i!==r)}}function _h(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Fg(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Wx(n){var e=n.alternate;e!==null&&(n.alternate=null,Wx(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Cr],delete e[ac],delete e[Eg],delete e[JI],delete e[QI])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Gx(n){return n.tag===5||n.tag===3||n.tag===4}function aw(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Gx(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function zg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Td));else if(r!==4&&(n=n.child,n!==null))for(zg(n,e,t),n=n.sibling;n!==null;)zg(n,e,t),n=n.sibling}function $g(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for($g(n,e,t),n=n.sibling;n!==null;)$g(n,e,t),n=n.sibling}var Ot=null,er=!1;function wi(n,e,t){for(t=t.child;t!==null;)Kx(n,e,t),t=t.sibling}function Kx(n,e,t){if(Or&&typeof Or.onCommitFiberUnmount=="function")try{Or.onCommitFiberUnmount(gh,t)}catch{}switch(t.tag){case 5:qt||Go(t,e);case 6:var r=Ot,i=er;Ot=null,wi(n,e,t),Ot=r,er=i,Ot!==null&&(er?(n=Ot,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Ot.removeChild(t.stateNode));break;case 18:Ot!==null&&(er?(n=Ot,t=t.stateNode,n.nodeType===8?cp(n.parentNode,t):n.nodeType===1&&cp(n,t),nc(n)):cp(Ot,t.stateNode));break;case 4:r=Ot,i=er,Ot=t.stateNode.containerInfo,er=!0,wi(n,e,t),Ot=r,er=i;break;case 0:case 11:case 14:case 15:if(!qt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Dg(t,e,o),i=i.next}while(i!==r)}wi(n,e,t);break;case 1:if(!qt&&(Go(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){tt(t,e,a)}wi(n,e,t);break;case 21:wi(n,e,t);break;case 22:t.mode&1?(qt=(r=qt)||t.memoizedState!==null,wi(n,e,t),qt=r):wi(n,e,t);break;default:wi(n,e,t)}}function lw(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new hA),e.forEach(function(r){var i=CA.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Xn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ot=a.stateNode,er=!1;break e;case 3:Ot=a.stateNode.containerInfo,er=!0;break e;case 4:Ot=a.stateNode.containerInfo,er=!0;break e}a=a.return}if(Ot===null)throw Error($(160));Kx(s,o,i),Ot=null,er=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){tt(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Jx(e,n),e=e.sibling}function Jx(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Xn(e,n),fr(n),r&4){try{Ml(3,n,n.return),_h(3,n)}catch(g){tt(n,n.return,g)}try{Ml(5,n,n.return)}catch(g){tt(n,n.return,g)}}break;case 1:Xn(e,n),fr(n),r&512&&t!==null&&Go(t,t.return);break;case 5:if(Xn(e,n),fr(n),r&512&&t!==null&&Go(t,t.return),n.flags&32){var i=n.stateNode;try{Yl(i,"")}catch(g){tt(n,n.return,g)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&vT(i,s),cg(a,o);var c=cg(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?CT(i,d):u==="dangerouslySetInnerHTML"?bT(i,d):u==="children"?Yl(i,d):my(i,u,d,c)}switch(a){case"input":ig(i,s);break;case"textarea":yT(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Xo(i,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Xo(i,!!s.multiple,s.defaultValue,!0):Xo(i,!!s.multiple,s.multiple?[]:"",!1))}i[ac]=s}catch(g){tt(n,n.return,g)}}break;case 6:if(Xn(e,n),fr(n),r&4){if(n.stateNode===null)throw Error($(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(g){tt(n,n.return,g)}}break;case 3:if(Xn(e,n),fr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{nc(e.containerInfo)}catch(g){tt(n,n.return,g)}break;case 4:Xn(e,n),fr(n);break;case 13:Xn(e,n),fr(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Ky=it())),r&4&&lw(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(qt=(c=qt)||u,Xn(e,n),qt=c):Xn(e,n),fr(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(J=n,u=n.child;u!==null;){for(d=J=u;J!==null;){switch(h=J,f=h.child,h.tag){case 0:case 11:case 14:case 15:Ml(4,h,h.return);break;case 1:Go(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){tt(r,t,g)}}break;case 5:Go(h,h.return);break;case 22:if(h.memoizedState!==null){uw(d);continue}}f!==null?(f.return=h,J=f):uw(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=wT("display",o))}catch(g){tt(n,n.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){tt(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Xn(e,n),fr(n),r&4&&lw(n);break;case 21:break;default:Xn(e,n),fr(n)}}function fr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Gx(t)){var r=t;break e}t=t.return}throw Error($(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Yl(i,""),r.flags&=-33);var s=aw(n);$g(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=aw(n);zg(n,a,o);break;default:throw Error($(161))}}catch(l){tt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function pA(n,e,t){J=n,Qx(n)}function Qx(n,e,t){for(var r=(n.mode&1)!==0;J!==null;){var i=J,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Ou;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||qt;a=Ou;var c=qt;if(Ou=o,(qt=l)&&!c)for(J=i;J!==null;)o=J,l=o.child,o.tag===22&&o.memoizedState!==null?dw(i):l!==null?(l.return=o,J=l):dw(i);for(;s!==null;)J=s,Qx(s),s=s.sibling;J=i,Ou=a,qt=c}cw(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,J=s):cw(n)}}function cw(n){for(;J!==null;){var e=J;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qt||_h(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!qt)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Zn(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Gb(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Gb(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&nc(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($(163))}qt||e.flags&512&&Fg(e)}catch(h){tt(e,e.return,h)}}if(e===n){J=null;break}if(t=e.sibling,t!==null){t.return=e.return,J=t;break}J=e.return}}function uw(n){for(;J!==null;){var e=J;if(e===n){J=null;break}var t=e.sibling;if(t!==null){t.return=e.return,J=t;break}J=e.return}}function dw(n){for(;J!==null;){var e=J;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{_h(4,e)}catch(l){tt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){tt(e,i,l)}}var s=e.return;try{Fg(e)}catch(l){tt(e,s,l)}break;case 5:var o=e.return;try{Fg(e)}catch(l){tt(e,o,l)}}}catch(l){tt(e,e.return,l)}if(e===n){J=null;break}var a=e.sibling;if(a!==null){a.return=e.return,J=a;break}J=e.return}}var mA=Math.ceil,Dd=mi.ReactCurrentDispatcher,Wy=mi.ReactCurrentOwner,Hn=mi.ReactCurrentBatchConfig,Ce=0,Ct=null,ut=null,kt=0,Sn=0,Ko=ds(0),gt=0,fc=null,eo=0,Th=0,Gy=0,Dl=null,cn=null,Ky=0,ba=1/0,Gr=null,Fd=!1,jg=null,Ki=null,Pu=!1,Mi=null,zd=0,Fl=0,qg=null,Yu=-1,Zu=0;function Yt(){return Ce&6?it():Yu!==-1?Yu:Yu=it()}function Ji(n){return n.mode&1?Ce&2&&kt!==0?kt&-kt:YI.transition!==null?(Zu===0&&(Zu=AT()),Zu):(n=ke,n!==0||(n=window.event,n=n===void 0?16:qT(n.type)),n):1}function ar(n,e,t,r){if(50<Fl)throw Fl=0,qg=null,Error($(185));Ac(n,t,r),(!(Ce&2)||n!==Ct)&&(n===Ct&&(!(Ce&2)&&(Th|=t),gt===4&&Li(n,kt)),fn(n,r),t===1&&Ce===0&&!(e.mode&1)&&(ba=it()+500,wh&&hs()))}function fn(n,e){var t=n.callbackNode;YL(n,e);var r=wd(n,n===Ct?kt:0);if(r===0)t!==null&&bb(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&bb(t),e===1)n.tag===0?XI(hw.bind(null,n)):ox(hw.bind(null,n)),GI(function(){!(Ce&6)&&hs()}),t=null;else{switch(MT(r)){case 1:t=by;break;case 4:t=LT;break;case 16:t=bd;break;case 536870912:t=IT;break;default:t=bd}t=iO(t,Xx.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Xx(n,e){if(Yu=-1,Zu=0,Ce&6)throw Error($(327));var t=n.callbackNode;if(na()&&n.callbackNode!==t)return null;var r=wd(n,n===Ct?kt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=$d(n,r);else{e=r;var i=Ce;Ce|=2;var s=Zx();(Ct!==n||kt!==e)&&(Gr=null,ba=it()+500,Hs(n,e));do try{yA();break}catch(a){Yx(n,a)}while(1);Iy(),Dd.current=s,Ce=i,ut!==null?e=0:(Ct=null,kt=0,e=gt)}if(e!==0){if(e===2&&(i=pg(n),i!==0&&(r=i,e=Bg(n,i))),e===1)throw t=fc,Hs(n,0),Li(n,r),fn(n,it()),t;if(e===6)Li(n,r);else{if(i=n.current.alternate,!(r&30)&&!gA(i)&&(e=$d(n,r),e===2&&(s=pg(n),s!==0&&(r=s,e=Bg(n,s))),e===1))throw t=fc,Hs(n,0),Li(n,r),fn(n,it()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error($(345));case 2:ws(n,cn,Gr);break;case 3:if(Li(n,r),(r&130023424)===r&&(e=Ky+500-it(),10<e)){if(wd(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Yt(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Cg(ws.bind(null,n,cn,Gr),e);break}ws(n,cn,Gr);break;case 4:if(Li(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-or(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=it()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*mA(r/1960))-r,10<r){n.timeoutHandle=Cg(ws.bind(null,n,cn,Gr),r);break}ws(n,cn,Gr);break;case 5:ws(n,cn,Gr);break;default:throw Error($(329))}}}return fn(n,it()),n.callbackNode===t?Xx.bind(null,n):null}function Bg(n,e){var t=Dl;return n.current.memoizedState.isDehydrated&&(Hs(n,e).flags|=256),n=$d(n,e),n!==2&&(e=cn,cn=t,e!==null&&Ug(e)),n}function Ug(n){cn===null?cn=n:cn.push.apply(cn,n)}function gA(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!ur(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Li(n,e){for(e&=~Gy,e&=~Th,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-or(e),r=1<<t;n[t]=-1,e&=~r}}function hw(n){if(Ce&6)throw Error($(327));na();var e=wd(n,0);if(!(e&1))return fn(n,it()),null;var t=$d(n,e);if(n.tag!==0&&t===2){var r=pg(n);r!==0&&(e=r,t=Bg(n,r))}if(t===1)throw t=fc,Hs(n,0),Li(n,e),fn(n,it()),t;if(t===6)throw Error($(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ws(n,cn,Gr),fn(n,it()),null}function Jy(n,e){var t=Ce;Ce|=1;try{return n(e)}finally{Ce=t,Ce===0&&(ba=it()+500,wh&&hs())}}function to(n){Mi!==null&&Mi.tag===0&&!(Ce&6)&&na();var e=Ce;Ce|=1;var t=Hn.transition,r=ke;try{if(Hn.transition=null,ke=1,n)return n()}finally{ke=r,Hn.transition=t,Ce=e,!(Ce&6)&&hs()}}function Qy(){Sn=Ko.current,Be(Ko)}function Hs(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,WI(t)),ut!==null)for(t=ut.return;t!==null;){var r=t;switch(ky(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&xd();break;case 3:ya(),Be(dn),Be(Ut),$y();break;case 5:zy(r);break;case 4:ya();break;case 13:Be(Je);break;case 19:Be(Je);break;case 10:Ay(r.type._context);break;case 22:case 23:Qy()}t=t.return}if(Ct=n,ut=n=Qi(n.current,null),kt=Sn=e,gt=0,fc=null,Gy=Th=eo=0,cn=Dl=null,$s!==null){for(e=0;e<$s.length;e++)if(t=$s[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}$s=null}return n}function Yx(n,e){do{var t=ut;try{if(Iy(),Ju.current=Md,Ad){for(var r=Ye.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Ad=!1}if(Zs=0,wt=pt=Ye=null,Al=!1,uc=0,Wy.current=null,t===null||t.return===null){gt=1,fc=e,ut=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=kt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Zb(o);if(f!==null){f.flags&=-257,ew(f,o,a,s,e),f.mode&1&&Yb(s,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var g=new Set;g.add(l),e.updateQueue=g}else p.add(l);break e}else{if(!(e&1)){Yb(s,c,e),Xy();break e}l=Error($(426))}}else if(We&&a.mode&1){var S=Zb(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),ew(S,o,a,s,e),Ny(Sa(l,a));break e}}s=l=Sa(l,a),gt!==4&&(gt=2),Dl===null?Dl=[s]:Dl.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=Mx(s,l,e);Wb(s,m);break e;case 1:a=l;var v=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ki===null||!Ki.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var b=Dx(s,a,e);Wb(s,b);break e}}s=s.return}while(s!==null)}tO(t)}catch(w){e=w,ut===t&&t!==null&&(ut=t=t.return);continue}break}while(1)}function Zx(){var n=Dd.current;return Dd.current=Md,n===null?Md:n}function Xy(){(gt===0||gt===3||gt===2)&&(gt=4),Ct===null||!(eo&268435455)&&!(Th&268435455)||Li(Ct,kt)}function $d(n,e){var t=Ce;Ce|=2;var r=Zx();(Ct!==n||kt!==e)&&(Gr=null,Hs(n,e));do try{vA();break}catch(i){Yx(n,i)}while(1);if(Iy(),Ce=t,Dd.current=r,ut!==null)throw Error($(261));return Ct=null,kt=0,gt}function vA(){for(;ut!==null;)eO(ut)}function yA(){for(;ut!==null&&!UL();)eO(ut)}function eO(n){var e=rO(n.alternate,n,Sn);n.memoizedProps=n.pendingProps,e===null?tO(n):ut=e,Wy.current=null}function tO(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=dA(t,e),t!==null){t.flags&=32767,ut=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{gt=6,ut=null;return}}else if(t=uA(t,e,Sn),t!==null){ut=t;return}if(e=e.sibling,e!==null){ut=e;return}ut=e=n}while(e!==null);gt===0&&(gt=5)}function ws(n,e,t){var r=ke,i=Hn.transition;try{Hn.transition=null,ke=1,SA(n,e,t,r)}finally{Hn.transition=i,ke=r}return null}function SA(n,e,t,r){do na();while(Mi!==null);if(Ce&6)throw Error($(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error($(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(ZL(n,s),n===Ct&&(ut=Ct=null,kt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Pu||(Pu=!0,iO(bd,function(){return na(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Hn.transition,Hn.transition=null;var o=ke;ke=1;var a=Ce;Ce|=4,Wy.current=null,fA(n,t),Jx(t,n),$I(bg),Cd=!!Sg,bg=Sg=null,n.current=t,pA(t),HL(),Ce=a,ke=o,Hn.transition=s}else n.current=t;if(Pu&&(Pu=!1,Mi=n,zd=i),s=n.pendingLanes,s===0&&(Ki=null),GL(t.stateNode),fn(n,it()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Fd)throw Fd=!1,n=jg,jg=null,n;return zd&1&&n.tag!==0&&na(),s=n.pendingLanes,s&1?n===qg?Fl++:(Fl=0,qg=n):Fl=0,hs(),null}function na(){if(Mi!==null){var n=MT(zd),e=Hn.transition,t=ke;try{if(Hn.transition=null,ke=16>n?16:n,Mi===null)var r=!1;else{if(n=Mi,Mi=null,zd=0,Ce&6)throw Error($(331));var i=Ce;for(Ce|=4,J=n.current;J!==null;){var s=J,o=s.child;if(J.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(J=c;J!==null;){var u=J;switch(u.tag){case 0:case 11:case 15:Ml(8,u,s)}var d=u.child;if(d!==null)d.return=u,J=d;else for(;J!==null;){u=J;var h=u.sibling,f=u.return;if(Wx(u),u===c){J=null;break}if(h!==null){h.return=f,J=h;break}J=f}}}var p=s.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var S=g.sibling;g.sibling=null,g=S}while(g!==null)}}J=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,J=o;else e:for(;J!==null;){if(s=J,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ml(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,J=m;break e}J=s.return}}var v=n.current;for(J=v;J!==null;){o=J;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,J=y;else e:for(o=v;J!==null;){if(a=J,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:_h(9,a)}}catch(w){tt(a,a.return,w)}if(a===o){J=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,J=b;break e}J=a.return}}if(Ce=i,hs(),Or&&typeof Or.onPostCommitFiberRoot=="function")try{Or.onPostCommitFiberRoot(gh,n)}catch{}r=!0}return r}finally{ke=t,Hn.transition=e}}return!1}function fw(n,e,t){e=Sa(t,e),e=Mx(n,e,1),n=Gi(n,e,1),e=Yt(),n!==null&&(Ac(n,1,e),fn(n,e))}function tt(n,e,t){if(n.tag===3)fw(n,n,t);else for(;e!==null;){if(e.tag===3){fw(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ki===null||!Ki.has(r))){n=Sa(t,n),n=Dx(e,n,1),e=Gi(e,n,1),n=Yt(),e!==null&&(Ac(e,1,n),fn(e,n));break}}e=e.return}}function bA(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Yt(),n.pingedLanes|=n.suspendedLanes&t,Ct===n&&(kt&t)===t&&(gt===4||gt===3&&(kt&130023424)===kt&&500>it()-Ky?Hs(n,0):Gy|=t),fn(n,e)}function nO(n,e){e===0&&(n.mode&1?(e=yu,yu<<=1,!(yu&130023424)&&(yu=4194304)):e=1);var t=Yt();n=ci(n,e),n!==null&&(Ac(n,e,t),fn(n,t))}function wA(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),nO(n,t)}function CA(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error($(314))}r!==null&&r.delete(e),nO(n,t)}var rO;rO=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||dn.current)un=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return un=!1,cA(n,e,t);un=!!(n.flags&131072)}else un=!1,We&&e.flags&1048576&&ax(e,Rd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Xu(n,e),n=e.pendingProps;var i=ma(e,Ut.current);ta(e,t),i=qy(null,e,r,n,i,t);var s=By();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,hn(r)?(s=!0,Od(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Dy(e),i.updater=Eh,e.stateNode=i,i._reactInternals=e,Rg(e,r,n,t),e=Lg(null,e,r,!0,s,t)):(e.tag=0,We&&s&&Ry(e),Kt(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Xu(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=_A(r),n=Zn(r,n),i){case 0:e=Ng(null,e,r,n,t);break e;case 1:e=rw(null,e,r,n,t);break e;case 11:e=tw(null,e,r,n,t);break e;case 14:e=nw(null,e,r,Zn(r.type,n),t);break e}throw Error($(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),Ng(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),rw(n,e,r,i,t);case 3:e:{if(jx(e),n===null)throw Error($(387));r=e.pendingProps,s=e.memoizedState,i=s.element,fx(n,e),Ld(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Sa(Error($(423)),e),e=iw(n,e,r,t,i);break e}else if(r!==i){i=Sa(Error($(424)),e),e=iw(n,e,r,t,i);break e}else for(xn=Wi(e.stateNode.containerInfo.firstChild),Pn=e,We=!0,rr=null,t=dx(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ga(),r===i){e=ui(n,e,t);break e}Kt(n,e,r,t)}e=e.child}return e;case 5:return px(e),n===null&&xg(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,wg(r,i)?o=null:s!==null&&wg(r,s)&&(e.flags|=32),$x(n,e),Kt(n,e,o,t),e.child;case 6:return n===null&&xg(e),null;case 13:return qx(n,e,t);case 4:return Fy(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=va(e,null,r,t):Kt(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),tw(n,e,r,i,t);case 7:return Kt(n,e,e.pendingProps,t),e.child;case 8:return Kt(n,e,e.pendingProps.children,t),e.child;case 12:return Kt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Fe(kd,r._currentValue),r._currentValue=o,s!==null)if(ur(s.value,o)){if(s.children===i.children&&!dn.current){e=ui(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=ni(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),Og(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error($(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Og(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Kt(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ta(e,t),i=Gn(i),r=r(i),e.flags|=1,Kt(n,e,r,t),e.child;case 14:return r=e.type,i=Zn(r,e.pendingProps),i=Zn(r.type,i),nw(n,e,r,i,t);case 15:return Fx(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),Xu(n,e),e.tag=1,hn(r)?(n=!0,Od(e)):n=!1,ta(e,t),Ax(e,r,i),Rg(e,r,i,t),Lg(null,e,r,!0,n,t);case 19:return Bx(n,e,t);case 22:return zx(n,e,t)}throw Error($(156,e.tag))};function iO(n,e){return NT(n,e)}function EA(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bn(n,e,t,r){return new EA(n,e,t,r)}function Yy(n){return n=n.prototype,!(!n||!n.isReactComponent)}function _A(n){if(typeof n=="function")return Yy(n)?1:0;if(n!=null){if(n=n.$$typeof,n===vy)return 11;if(n===yy)return 14}return 2}function Qi(n,e){var t=n.alternate;return t===null?(t=Bn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function ed(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")Yy(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case zo:return Vs(t.children,i,s,e);case gy:o=8,i|=8;break;case Zm:return n=Bn(12,t,e,i|2),n.elementType=Zm,n.lanes=s,n;case eg:return n=Bn(13,t,e,i),n.elementType=eg,n.lanes=s,n;case tg:return n=Bn(19,t,e,i),n.elementType=tg,n.lanes=s,n;case pT:return xh(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case hT:o=10;break e;case fT:o=9;break e;case vy:o=11;break e;case yy:o=14;break e;case Oi:o=16,r=null;break e}throw Error($(130,n==null?n:typeof n,""))}return e=Bn(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Vs(n,e,t,r){return n=Bn(7,n,r,e),n.lanes=t,n}function xh(n,e,t,r){return n=Bn(22,n,r,e),n.elementType=pT,n.lanes=t,n.stateNode={isHidden:!1},n}function vp(n,e,t){return n=Bn(6,n,null,e),n.lanes=t,n}function yp(n,e,t){return e=Bn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function TA(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yf(0),this.expirationTimes=Yf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yf(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Zy(n,e,t,r,i,s,o,a,l){return n=new TA(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Bn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Dy(s),n}function xA(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fo,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function sO(n){if(!n)return os;n=n._reactInternals;e:{if(ho(n)!==n||n.tag!==1)throw Error($(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(hn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error($(171))}if(n.tag===1){var t=n.type;if(hn(t))return sx(n,t,e)}return e}function oO(n,e,t,r,i,s,o,a,l){return n=Zy(t,r,!0,n,i,s,o,a,l),n.context=sO(null),t=n.current,r=Yt(),i=Ji(t),s=ni(r,i),s.callback=e??null,Gi(t,s,i),n.current.lanes=i,Ac(n,i,r),fn(n,r),n}function Oh(n,e,t,r){var i=e.current,s=Yt(),o=Ji(i);return t=sO(t),e.context===null?e.context=t:e.pendingContext=t,e=ni(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Gi(i,e,o),n!==null&&(ar(n,i,o,s),Ku(n,i,o)),o}function jd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function pw(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function e0(n,e){pw(n,e),(n=n.alternate)&&pw(n,e)}function OA(){return null}var aO=typeof reportError=="function"?reportError:function(n){console.error(n)};function t0(n){this._internalRoot=n}Ph.prototype.render=t0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error($(409));Oh(n,e,null,null)};Ph.prototype.unmount=t0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;to(function(){Oh(null,n,null,null)}),e[li]=null}};function Ph(n){this._internalRoot=n}Ph.prototype.unstable_scheduleHydration=function(n){if(n){var e=zT();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ni.length&&e!==0&&e<Ni[t].priority;t++);Ni.splice(t,0,n),t===0&&jT(n)}};function n0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Rh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function mw(){}function PA(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=jd(o);s.call(c)}}var o=oO(e,r,n,0,null,!1,!1,"",mw);return n._reactRootContainer=o,n[li]=o.current,sc(n.nodeType===8?n.parentNode:n),to(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=jd(l);a.call(c)}}var l=Zy(n,0,!1,null,null,!1,!1,"",mw);return n._reactRootContainer=l,n[li]=l.current,sc(n.nodeType===8?n.parentNode:n),to(function(){Oh(e,l,t,r)}),l}function kh(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=jd(o);a.call(l)}}Oh(e,o,n,i)}else o=PA(t,e,n,i,r);return jd(o)}DT=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=_l(e.pendingLanes);t!==0&&(wy(e,t|1),fn(e,it()),!(Ce&6)&&(ba=it()+500,hs()))}break;case 13:to(function(){var r=ci(n,1);if(r!==null){var i=Yt();ar(r,n,1,i)}}),e0(n,1)}};Cy=function(n){if(n.tag===13){var e=ci(n,134217728);if(e!==null){var t=Yt();ar(e,n,134217728,t)}e0(n,134217728)}};FT=function(n){if(n.tag===13){var e=Ji(n),t=ci(n,e);if(t!==null){var r=Yt();ar(t,n,e,r)}e0(n,e)}};zT=function(){return ke};$T=function(n,e){var t=ke;try{return ke=n,e()}finally{ke=t}};dg=function(n,e,t){switch(e){case"input":if(ig(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=bh(r);if(!i)throw Error($(90));gT(r),ig(r,i)}}}break;case"textarea":yT(n,t);break;case"select":e=t.value,e!=null&&Xo(n,!!t.multiple,e,!1)}};TT=Jy;xT=to;var RA={usingClientEntryPoint:!1,Events:[Dc,Bo,bh,ET,_T,Jy]},ll={findFiberByHostInstance:zs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kA={bundleType:ll.bundleType,version:ll.version,rendererPackageName:ll.rendererPackageName,rendererConfig:ll.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=RT(n),n===null?null:n.stateNode},findFiberByHostInstance:ll.findFiberByHostInstance||OA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ru.isDisabled&&Ru.supportsFiber)try{gh=Ru.inject(kA),Or=Ru}catch{}}In.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RA;In.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!n0(e))throw Error($(200));return xA(n,e,null,t)};In.createRoot=function(n,e){if(!n0(n))throw Error($(299));var t=!1,r="",i=aO;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Zy(n,1,!1,null,null,t,!1,r,i),n[li]=e.current,sc(n.nodeType===8?n.parentNode:n),new t0(e)};In.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error($(188)):(n=Object.keys(n).join(","),Error($(268,n)));return n=RT(e),n=n===null?null:n.stateNode,n};In.flushSync=function(n){return to(n)};In.hydrate=function(n,e,t){if(!Rh(e))throw Error($(200));return kh(null,n,e,!0,t)};In.hydrateRoot=function(n,e,t){if(!n0(n))throw Error($(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=aO;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=oO(e,null,n,1,t??null,i,!1,s,o),n[li]=e.current,sc(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Ph(e)};In.render=function(n,e,t){if(!Rh(e))throw Error($(200));return kh(null,n,e,!1,t)};In.unmountComponentAtNode=function(n){if(!Rh(n))throw Error($(40));return n._reactRootContainer?(to(function(){kh(null,null,n,!1,function(){n._reactRootContainer=null,n[li]=null})}),!0):!1};In.unstable_batchedUpdates=Jy;In.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Rh(t))throw Error($(200));if(n==null||n._reactInternals===void 0)throw Error($(38));return kh(n,e,t,!1,r)};In.version="18.3.1-next-f1338f8080-20240426";function lO(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lO)}catch(n){console.error(n)}}lO(),lT.exports=In;var NA=lT.exports,gw=NA;Xm.createRoot=gw.createRoot,Xm.hydrateRoot=gw.hydrateRoot;function zc(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function gi(n,e,t,r){return new(t||(t=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?i(c.value):(u=c.value,u instanceof t?u:new t(function(d){d(u)})).then(o,a)}l((r=r.apply(n,e||[])).next())})}const LA={childProxyingCommunication:!1};function cO(){return LA.childProxyingCommunication}let IA={disableEnforceOriginMatchForChildResponses:!1};function AA(){return IA}var vw,yw,Sw,qd,bw,ww,Cw,Hg,Ew,_w;function MA(n){return(n==null?void 0:n.errorCode)!==void 0}(function(n){n.Inline="inline",n.Desktop="desktop",n.Web="web"})(vw||(vw={})),function(n){n.M365Content="m365content"}(yw||(yw={})),function(n){n.DriveId="driveId",n.GroupId="groupId",n.SiteId="siteId",n.UserId="userId"}(Sw||(Sw={})),function(n){n[n.NOT_SUPPORTED_ON_PLATFORM=100]="NOT_SUPPORTED_ON_PLATFORM",n[n.INTERNAL_ERROR=500]="INTERNAL_ERROR",n[n.NOT_SUPPORTED_IN_CURRENT_CONTEXT=501]="NOT_SUPPORTED_IN_CURRENT_CONTEXT",n[n.PERMISSION_DENIED=1e3]="PERMISSION_DENIED",n[n.NETWORK_ERROR=2e3]="NETWORK_ERROR",n[n.NO_HW_SUPPORT=3e3]="NO_HW_SUPPORT",n[n.INVALID_ARGUMENTS=4e3]="INVALID_ARGUMENTS",n[n.UNAUTHORIZED_USER_OPERATION=5e3]="UNAUTHORIZED_USER_OPERATION",n[n.INSUFFICIENT_RESOURCES=6e3]="INSUFFICIENT_RESOURCES",n[n.THROTTLE=7e3]="THROTTLE",n[n.USER_ABORT=8e3]="USER_ABORT",n[n.OPERATION_TIMED_OUT=8001]="OPERATION_TIMED_OUT",n[n.OLD_PLATFORM=9e3]="OLD_PLATFORM",n[n.FILE_NOT_FOUND=404]="FILE_NOT_FOUND",n[n.SIZE_EXCEEDED=1e4]="SIZE_EXCEEDED"}(qd||(qd={})),function(n){n.GeoLocation="geolocation",n.Media="media"}(bw||(bw={})),function(n){n.BCAIS="bcais",n.BCWAF="bcwaf",n.BCWBF="bcwbf"}(ww||(ww={})),function(n){n.Faculty="faculty",n.Student="student",n.Other="other"}(Cw||(Cw={})),function(n){n.Adult="adult",n.MinorNoParentalConsentRequired="minorNoParentalConsentRequired",n.MinorWithoutParentalConsent="minorWithoutParentalConsent",n.MinorWithParentalConsent="minorWithParentalConsent",n.NotAdult="notAdult",n.NonAdult="notAdult"}(Hg||(Hg={})),function(n){n.HigherEducation="higherEducation",n.K12="k12",n.Other="other"}(Ew||(Ew={})),function(n){n.TextPlain="text/plain",n.TextHtml="text/html",n.ImagePNG="image/png",n.ImageJPEG="image/jpeg"}(_w||(_w={}));var be,Vg,Un,Tw,xw,Ow,Pw,Rw;(function(n){n.desktop="desktop",n.web="web",n.android="android",n.ios="ios",n.ipados="ipados",n.macos="macos",n.visionOS="visionOS",n.rigel="rigel",n.surfaceHub="surfaceHub",n.teamsRoomsWindows="teamsRoomsWindows",n.teamsRoomsAndroid="teamsRoomsAndroid",n.teamsPhones="teamsPhones",n.teamsDisplays="teamsDisplays"})(be||(be={})),function(n){n.office="Office",n.outlook="Outlook",n.outlookWin32="OutlookWin32",n.orange="Orange",n.places="Places",n.teams="Teams",n.teamsModern="TeamsModern"}(Vg||(Vg={})),function(n){n.settings="settings",n.content="content",n.authentication="authentication",n.remove="remove",n.task="task",n.sidePanel="sidePanel",n.stage="stage",n.meetingStage="meetingStage"}(Un||(Un={})),function(n){n.copilotSidePanel="copilotSidePanel",n.copilotMainPane="copilotMainPane",n.copilotFullScreen="copilotFullScreen"}(Tw||(Tw={})),function(n){n[n.Standard=0]="Standard",n[n.Edu=1]="Edu",n[n.Class=2]="Class",n[n.Plc=3]="Plc",n[n.Staff=4]="Staff"}(xw||(xw={})),function(n){n[n.Admin=0]="Admin",n[n.User=1]="User",n[n.Guest=2]="Guest"}(Ow||(Ow={})),function(n){n.Large="large",n.Medium="medium",n.Small="small"}(Pw||(Pw={})),function(n){n.Regular="Regular",n.Private="Private",n.Shared="Shared"}(Rw||(Rw={}));const DA={errorCode:qd.NOT_SUPPORTED_ON_PLATFORM},uO={adaptiveCardSchemaVersion:{majorVersion:1,minorVersion:5}};var kw={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let ku;const FA=new Uint8Array(16);function zA(){if(!ku&&(ku=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ku))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ku(FA)}const _t=[];for(let n=0;n<256;++n)_t.push((n+256).toString(16).slice(1));function $A(n,e=0){return _t[n[e+0]]+_t[n[e+1]]+_t[n[e+2]]+_t[n[e+3]]+"-"+_t[n[e+4]]+_t[n[e+5]]+"-"+_t[n[e+6]]+_t[n[e+7]]+"-"+_t[n[e+8]]+_t[n[e+9]]+"-"+_t[n[e+10]]+_t[n[e+11]]+_t[n[e+12]]+_t[n[e+13]]+_t[n[e+14]]+_t[n[e+15]]}function jA(n,e,t){if(kw.randomUUID&&!e&&!n)return kw.randomUUID();const r=(n=n||{}).random||(n.rng||zA)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,$A(r)}var qA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function BA(n){return typeof n=="string"&&qA.test(n)}function dO(n,e){if(typeof n!="string"||typeof e!="string")return NaN;const t=n.split("."),r=e.split(".");function i(s){return/^\d+$/.test(s)}if(!t.every(i)||!r.every(i))return NaN;for(;t.length<r.length;)t.push("0");for(;r.length<t.length;)r.push("0");for(let s=0;s<t.length;++s)if(Number(t[s])!=Number(r[s]))return Number(t[s])>Number(r[s])?1:-1;return 0}function UA(){return jA()}function hO(n){return Object.keys(n).forEach(e=>{n[e]!==null&&n[e]!==void 0&&typeof n[e]=="object"&&hO(n[e])}),Object.freeze(n)}function HA(n,e,t){return new Promise((r,i)=>{const s=setTimeout(i,e,t);n().then(o=>{clearTimeout(s),r(o)}).catch(o=>{clearTimeout(s),i(o)})})}function VA(n){return n.protocol==="https:"}function WA(){if(Nh())throw new Error("window object undefined at SSR check");return window}function Nh(){return typeof window>"u"}function GA(n){return new RegExp(`${/<script[^>]*>|&lt;script[^&]*&gt;|%3Cscript[^%]*%3E/gi.source}|${/<\/script[^>]*>|&lt;\/script[^&]*&gt;|%3C\/script[^%]*%3E/gi.source}`,"gi").test(n)}function KA(n){if(!n)throw new Error("id must not be empty");if(BA(n)===!1)throw new Error("id must be a valid UUID")}const JA=!!performance&&"now"in performance;function r0(){return JA?performance.now()+performance.timeOrigin:void 0}function Nw(n){var e,t;if(!(!((t=(e=n.hostVersionsInfo)===null||e===void 0?void 0:e.appEligibilityInformation)===null||t===void 0)&&t.ageGroup))return n;const r=n.hostVersionsInfo.appEligibilityInformation.ageGroup;return(r==null?void 0:r.toLowerCase())!=="nonadult"?n:Object.assign(Object.assign({},n),{hostVersionsInfo:Object.assign(Object.assign({},n.hostVersionsInfo),{appEligibilityInformation:Object.assign(Object.assign({},n.hostVersionsInfo.appEligibilityInformation),{ageGroup:Hg.NotAdult})})})}let Ma=class{constructor(e=UA()){this.uuid=e,KA(e)}toString(){return this.uuid}serialize(){return this.toString()}};const fO=n=>{const{uuid:e}=n,t=zc(n,["uuid"]),r=e==null?void 0:e.toString();return Object.assign(Object.assign({},t),{uuidAsString:r})},QA=n=>{const{uuidAsString:e}=n,t=zc(n,["uuidAsString"]);return Object.assign(Object.assign({},t),{uuid:e?new Ma(e):void 0})},XA=n=>{const{uuidAsString:e}=n,t=zc(n,["uuidAsString"]);return Object.assign(Object.assign({},t),{uuid:e?new Ma(e):void 0})},YA=n=>{const{uuid:e}=n,t=zc(n,["uuid"]),r=e==null?void 0:e.toString();return Object.assign(Object.assign({},t),{uuidAsString:r})};var Wg={exports:{}},Lw,Iw;function ZA(){if(Iw)return Lw;Iw=1;var n=1e3,e=60*n,t=60*e,r=24*t,i=7*r,s=365.25*r;function o(a,l,c,u){var d=l>=1.5*c;return Math.round(a/c)+" "+u+(d?"s":"")}return Lw=function(a,l){l=l||{};var c=typeof a;if(c==="string"&&a.length>0)return function(u){if(!((u=String(u)).length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]);switch((d[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}(a);if(c==="number"&&isFinite(a))return l.long?function(u){var d=Math.abs(u);return d>=r?o(u,d,r,"day"):d>=t?o(u,d,t,"hour"):d>=e?o(u,d,e,"minute"):d>=n?o(u,d,n,"second"):u+" ms"}(a):function(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}var eM=function(n){function e(i){let s,o,a,l=null;function c(...u){if(!c.enabled)return;const d=c,h=Number(new Date),f=h-(s||h);d.diff=f,d.prev=s,d.curr=h,s=h,u[0]=e.coerce(u[0]),typeof u[0]!="string"&&u.unshift("%O");let p=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,(g,S)=>{if(g==="%%")return"%";p++;const m=e.formatters[S];if(typeof m=="function"){const v=u[p];g=m.call(d,v),u.splice(p,1),p--}return g}),e.formatArgs.call(d,u),(d.log||e.log).apply(d,u)}return c.namespace=i,c.useColors=e.useColors(),c.color=e.selectColor(i),c.extend=t,c.destroy=e.destroy,Object.defineProperty(c,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(o!==e.namespaces&&(o=e.namespaces,a=e.enabled(i)),a),set:u=>{l=u}}),typeof e.init=="function"&&e.init(c),c}function t(i,s){const o=e(this.namespace+(s===void 0?":":s)+i);return o.log=this.log,o}function r(i){return i.toString().substring(2,i.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(i){return i instanceof Error?i.stack||i.message:i},e.disable=function(){const i=[...e.names.map(r),...e.skips.map(r).map(s=>"-"+s)].join(",");return e.enable(""),i},e.enable=function(i){let s;e.save(i),e.namespaces=i,e.names=[],e.skips=[];const o=(typeof i=="string"?i:"").split(/[\s,]+/),a=o.length;for(s=0;s<a;s++)o[s]&&((i=o[s].replace(/\*/g,".*?"))[0]==="-"?e.skips.push(new RegExp("^"+i.slice(1)+"$")):e.names.push(new RegExp("^"+i+"$")))},e.enabled=function(i){if(i[i.length-1]==="*")return!0;let s,o;for(s=0,o=e.skips.length;s<o;s++)if(e.skips[s].test(i))return!1;for(s=0,o=e.names.length;s<o;s++)if(e.names[s].test(i))return!0;return!1},e.humanize=ZA(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(n).forEach(i=>{e[i]=n[i]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(i){let s=0;for(let o=0;o<i.length;o++)s=(s<<5)-s+i.charCodeAt(o),s|=0;return e.colors[Math.abs(s)%e.colors.length]},e.enable(e.load()),e};(function(n,e){e.formatArgs=function(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;r.splice(1,0,i,"color: inherit");let s=0,o=0;r[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(s++,a==="%c"&&(o=s))}),r.splice(o,0,i)},e.save=function(r){try{r?e.storage.setItem("debug",r):e.storage.removeItem("debug")}catch{}},e.load=function(){let r;try{r=e.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r={}.DEBUG),r},e.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch{}}(),e.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),n.exports=eM(e);const{formatters:t}=n.exports;t.j=function(r){try{return JSON.stringify(r)}catch(i){return"[UnexpectedJSONParseError]: "+i.message}}})(Wg,Wg.exports);var i0=Wg.exports;const tM=new Ma,nM=i0.debug.formatArgs;i0.debug.formatArgs=function(n){n[0]=`(${new Date().toISOString()}): ${n[0]} [${tM.toString()}]`,nM.call(this,n)};const rM=i0.debug("teamsJs");function qr(n){return rM.extend(n)}function Ee(n,e){return`${n}_${e}`}function pO(n){return/^v\d+_[\w.]+$/.test(n)}function Vn(n){return n.uuidAsString!==void 0?`${n.uuidAsString} (legacy id: ${n.id})`:n.uuid!==void 0?`${n.uuid.toString()} (legacy id: ${n.id})`:`legacy id: ${n.id} (no uuid)`}const iM=qr("flushMessageQueue");function s0(n,e,t,r){if(n&&e&&t.length!==0)for(;t.length>0;){const i=t.shift();if(i){const s=fO(i);iM("Flushing message %s from %s message queue via postMessage.",Vn(s),r),n.postMessage(s,e)}}}var sM=["teams.microsoft.com","teams.microsoft.us","gov.teams.microsoft.us","dod.teams.microsoft.us","int.teams.microsoft.com","outlook.office.com","outlook-sdf.office.com","outlook.office365.com","outlook-sdf.office365.com","outlook.office365.us","outlook-dod.office365.us","webmail.apps.mil","outlook.live.com","outlook-sdf.live.com","teams.live.com","local.teams.live.com","local.teams.live.com:8080","local.teams.office.com","local.teams.office.com:8080","devspaces.skype.com","*.www.office.com","www.office.com","word.office.com","excel.office.com","powerpoint.office.com","www.officeppe.com","*.www.microsoft365.com","www.microsoft365.com","bing.com","edgeservices.bing.com","work.bing.com","www.bing.com","www.staging-bing-int.com","*.cloud.microsoft","*.m365.cloud.microsoft","*.outlook.cloud.microsoft","chatuxmanager.svc.cloud.microsoft","copilot.microsoft.com","windows.msn.com","fa000000125.resources.office.net","fa000000129.resources.office.net","fa000000124.resources.office.net","fa000000128.resources.office.net","fa000000136.resources.office.net","fa000000125.officeapps.live.com","fa000000129.officeapps.live.com","fa000000124.officeapps.live.com","fa000000128.officeapps.live.com"];const Aw="2.0.1",td=sM,Mw=1500,oM=new URL("https://res.cdn.office.net/teams-js/validDomains/json/validDomains.json"),aM=/^https:\/\//,pc="The library has not yet been initialized",lM="The runtime has not yet been initialized",cM="The runtime version is not supported";let de=class{};de.initializeCalled=!1,de.initializeCompleted=!1,de.additionalValidOrigins=[],de.initializePromise=void 0,de.isFramelessWindow=!1,de.frameContext=void 0,de.hostClientType=void 0,de.printCapabilityEnabled=!1,de.teamsJsInstanceId=new Ma().toString();const mO=qr("runtime"),Lh=4;function gO(n){return n.apiVersion===Lh}function uM(n){if(gO(n))return!0;throw n.apiVersion===-1?new Error(lM):new Error(cM)}let pn={apiVersion:-1,supports:{}};const dM={apiVersion:4,isNAAChannelRecommended:!1,isDeeplyNestedAuthSupported:!1,hostVersionsInfo:uO,isLegacyTeams:!0,supports:{appInstallDialog:{},appEntity:{},call:{},chat:{},conversations:{},dialog:{card:{bot:{}},url:{bot:{},parentCommunication:{}},update:{}},interactive:{},logs:{},meetingRoom:{},menus:{},monetization:{},notifications:{},pages:{config:{},backStack:{},fullTrust:{}},remoteCamera:{},teams:{fullTrust:{}},teamsCore:{},video:{sharedFrame:{}}}},vO=[be.desktop,be.web,be.rigel,be.surfaceHub,be.teamsRoomsWindows,be.teamsRoomsAndroid,be.teamsPhones,be.teamsDisplays],hM=[be.android,be.ios,be.ipados,be.visionOS],Dw=[...vO,...hM];function fM(n){let e=n;if(e.apiVersion<Lh&&pM.forEach(t=>{e.apiVersion===t.versionToUpgradeFrom&&(e=t.upgradeToNextVersion(e))}),gO(e))return e;throw new Error("Received a runtime that could not be upgraded to the latest version")}const pM=[{versionToUpgradeFrom:1,upgradeToNextVersion:n=>{var e;return{apiVersion:2,hostVersionsInfo:void 0,isLegacyTeams:n.isLegacyTeams,supports:Object.assign(Object.assign({},n.supports),{dialog:n.supports.dialog?{card:void 0,url:n.supports.dialog,update:(e=n.supports.dialog)===null||e===void 0?void 0:e.update}:void 0})}}},{versionToUpgradeFrom:2,upgradeToNextVersion:n=>{const e=n.supports,t=zc(e,["appNotification"]);return Object.assign(Object.assign({},n),{apiVersion:3,supports:t})}},{versionToUpgradeFrom:3,upgradeToNextVersion:n=>{var e,t,r,i,s;return{apiVersion:4,hostVersionsInfo:n.hostVersionsInfo,isNAAChannelRecommended:n.isNAAChannelRecommended,isLegacyTeams:n.isLegacyTeams,supports:Object.assign(Object.assign({},n.supports),{dialog:n.supports.dialog?{card:(e=n.supports.dialog)===null||e===void 0?void 0:e.card,url:{bot:(r=(t=n.supports.dialog)===null||t===void 0?void 0:t.url)===null||r===void 0?void 0:r.bot,parentCommunication:!((i=n.supports.dialog)===null||i===void 0)&&i.url?{}:void 0},update:(s=n.supports.dialog)===null||s===void 0?void 0:s.update}:void 0})}}}],mM={"1.0.0":[{capability:{pages:{appButton:{},tabs:{}},stageView:{}},hostClientTypes:vO}],"1.9.0":[{capability:{location:{}},hostClientTypes:Dw}],"2.0.0":[{capability:{people:{}},hostClientTypes:Dw},{capability:{sharing:{}},hostClientTypes:[be.desktop,be.web]}],"2.0.1":[{capability:{teams:{fullTrust:{joinedTeams:{}}}},hostClientTypes:[be.android,be.desktop,be.ios,be.teamsRoomsAndroid,be.teamsPhones,be.teamsDisplays,be.web]},{capability:{webStorage:{}},hostClientTypes:[be.desktop]}],"2.0.5":[{capability:{webStorage:{}},hostClientTypes:[be.android,be.ios]}],"2.0.8":[{capability:{sharing:{}},hostClientTypes:[be.android,be.ios]}],"2.1.1":[{capability:{nestedAppAuth:{}},hostClientTypes:[be.android,be.ios,be.ipados,be.visionOS]}],"2.1.2":[]},Sp=mO.extend("generateBackCompatRuntimeConfig");function yO(n,e){const t=Object.assign({},n);for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(typeof e[r]!="object"||Array.isArray(e[r])?r in n||(t[r]=e[r]):t[r]=yO(n[r]||{},e[r]));return t}function gM(n,e,t){Sp("generating back compat runtime config for %s",n);let r=Object.assign({},e.supports);Sp("Supported capabilities in config before updating based on highestSupportedVersion: %o",r),Object.keys(t).forEach(s=>{dO(n,s)>=0&&t[s].forEach(o=>{de.hostClientType!==void 0&&o.hostClientTypes.includes(de.hostClientType)&&(r=yO(r,o.capability))})});const i={apiVersion:Lh,hostVersionsInfo:uO,isLegacyTeams:!0,supports:r};return Sp("Runtime config after updating based on highestSupportedVersion: %o",i),i}const bp=mO.extend("applyRuntimeConfig");function wp(n){typeof n.apiVersion=="string"&&(bp("Trying to apply runtime with string apiVersion, processing as v1: %o",n),n=Object.assign(Object.assign({},n),{apiVersion:1})),bp("Fast-forwarding runtime %o",n);const e=fM(n);bp("Applying runtime %o",e),pn=hO(e)}function vM(n){return n!=null&&n.serialize!==void 0&&typeof n.serialize=="function"}const mc="2.46.0";let Bd=class Io{static storeCallbackInformation(e,t){Io.callbackInformation.set(e,t)}static clearMessages(){Io.callbackInformation.clear()}static deleteMessageInformation(e){Io.callbackInformation.delete(e)}static handleOneWayPerformanceMetrics(e,t,r){const i=e.monotonicTimestamp;i&&r?Kw({actionName:e.func,messageDelay:r-i,requestStartedAt:i}):t("Unable to send performance metrics for event %s",e.func)}static handlePerformanceMetrics(e,t,r,i){const s=Io.callbackInformation.get(e);s&&t.monotonicTimestamp&&i?(Kw({actionName:s.name,messageDelay:i-t.monotonicTimestamp,requestStartedAt:s.calledAt}),Io.deleteMessageInformation(e)):r("Unable to send performance metrics for callback %s with arguments %o",e.toString(),t.args)}};Bd.callbackInformation=new Map;const SO=qr("nestedAppAuthUtils"),yM=SO.extend("tryPolyfillWithNestedAppAuthBridge"),SM="v2";function bM(n,e,t){var r;const i=yM;if(de.isFramelessWindow)return void i("Cannot polyfill nestedAppAuthBridge as current window is frameless");if(!e)return void i("Cannot polyfill nestedAppAuthBridge as current window does not exist");if(e.parent!==e.top)return void i("Default NAA bridge injection not supported in nested iframe. Use standalone NAA bridge instead.");const s=(()=>{try{return JSON.parse(n)}catch{return null}})();if(!s||!(!((r=s.supports)===null||r===void 0)&&r.nestedAppAuth))return void i("Cannot polyfill nestedAppAuthBridge as current hub does not support nested app auth");const o=e;if(o.nestedAppAuthBridge)return void i("nestedAppAuthBridge already exists on current window, skipping polyfill");const a=function(l,c){const u=wM;if(!l)return u("nestedAppAuthBridge cannot be created as current window does not exist"),null;const{onMessage:d,sendPostMessage:h}=c,f=p=>g=>d(g,p);return{addEventListener:(p,g)=>{p==="message"?l.addEventListener(p,f(g)):u(`Event ${p} is not supported by nestedAppAuthBridge`)},postMessage:p=>{const g=(()=>{try{return JSON.parse(p)}catch{return null}})();if(!g||typeof g!="object"||g.messageType!=="NestedAppAuthRequest")return void u("Unrecognized data format received by app, message being ignored. Message: %o",p);const S=Ee(SM,"nestedAppAuth.execute");h(p,S)},removeEventListener:(p,g)=>{l.removeEventListener(p,f(g))}}}(o,t);a&&(o.nestedAppAuthBridge=a)}const wM=SO.extend("createNestedAppAuthBridge");let Ri=[];const Ii=qr("validateOrigin");let xl;function CM(){return gi(this,void 0,void 0,function*(){xl||(yield wO())})}function bO(){return Ri.length===0}function wO(n=!1){return gi(this,void 0,void 0,function*(){if(!bO()&&!n)return Ri;if(xl)return xl;if(Nh())return Ri=td,td;{Ii("Initiating fetch call to acquire valid origins list from CDN");const e=new AbortController,t=setTimeout(()=>e.abort(),Mw);return xl=fetch(oM,{signal:e.signal}).then(r=>{if(clearTimeout(t),!r.ok)throw new Error("Invalid Response from Fetch Call");return Ii("Fetch call completed and retrieved valid origins list from CDN"),r.json().then(i=>{if(function(s){let o=JSON.parse(s);try{o=JSON.parse(s)}catch{return!1}if(!o.validOrigins)return!1;for(const a of o.validOrigins)try{new URL("https://"+a)}catch{return Ii("isValidOriginsFromCDN call failed to validate origin: %s",a),!1}return!0}(JSON.stringify(i)))return Ri=i.validOrigins,Ri;throw new Error("Valid origins list retrieved from CDN is invalid")})}).catch(r=>(r.name==="AbortError"?Ii(`validOrigins fetch call to CDN failed due to Timeout of ${Mw} ms. Defaulting to fallback list`):Ii("validOrigins fetch call to CDN failed with error: %s. Defaulting to fallback list",r),Ri=td,Ri)),xl}})}function Fw(n,e){if(n.substring(0,2)==="*."){const t=n.substring(1);if(e.length>t.length&&e.split(".").length===t.split(".").length&&e.substring(e.length-t.length)===t)return!0}else if(n===e)return!0;return!1}function EM(n,e){const t=bO()?td:Ri;return zw(n,t)?Promise.resolve(!0):(Ii("Origin %s is not in the local valid origins list, fetching from CDN",n),wO(e).then(r=>zw(n,r)))}function zw(n,e){if(!VA(n))return Ii("Origin %s is invalid because it is not using https protocol. Protocol being used: %s",n,n.protocol),!1;const t=n.host;if(e.some(r=>Fw(r,t)))return!0;for(const r of de.additionalValidOrigins)if(Fw(r.substring(0,8)==="https://"?r.substring(8):r,t))return!0;return Ii(`Origin %s is invalid because it is not an origin approved by this library or included in the call to app.initialize.
Origins approved by this library: %o
Origins included in app.initialize: %o`,n,e,de.additionalValidOrigins),!1}CM();const fo=qr("communication");let Z=class{},we=class{};function _M(n,e){if(we.messageListener=t=>function(r){return gi(this,void 0,void 0,function*(){if(!r||!r.data||typeof r.data!="object")return void $w("Unrecognized message format received by app, message being ignored. Message: %o",r);const i=r.source||r.originalEvent&&r.originalEvent.source,s=r.origin||r.originalEvent&&r.originalEvent.origin;return EO(i,s).then(o=>{o?(function(a,l){de.isFramelessWindow||Z.parentWindow&&!Z.parentWindow.closed&&a!==Z.parentWindow||(Z.parentWindow=a,Z.parentOrigin=l),Z.parentWindow&&Z.parentWindow.closed&&(Z.parentWindow=null,Z.parentOrigin=null),s0(Z.parentWindow,Z.parentOrigin,we.parentMessageQueue,"parent")}(i,s),i!==Z.parentWindow?ED(i,s)&&_D(r,i,o0,(a,l)=>we.callbacks.set(a,l)):qw(r)):$w("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin, message: %o, source: %o, origin: %o",r,i,s)})})}(t),Z.currentWindow=Z.currentWindow||WA(),Z.parentWindow=Z.currentWindow.parent!==Z.currentWindow.self?Z.currentWindow.parent:Z.currentWindow.opener,Z.topWindow=Z.currentWindow.top,(Z.parentWindow||n)&&Z.currentWindow.addEventListener("message",we.messageListener,!1),!Z.parentWindow){const t=Z.currentWindow;if(!t.nativeInterface)return Promise.reject(new Error("Initialization Failed. No Parent window found."));de.isFramelessWindow=!0,t.onNativeMessage=qw}try{return Z.parentOrigin="*",$c(e,"initialize",[mc,Lh,n]).then(([t,r,i,s])=>(bM(s,Z.currentWindow,{onMessage:AM,sendPostMessage:kM}),{context:t,clientType:r,runtimeConfig:i,clientSupportedSDKVersion:s}))}finally{Z.parentOrigin=null}}function TM(n,e,...t){return $c(n,e,t).then(([r])=>r)}function xM(n,e,t,...r){return $c(n,e,r).then(([i,s])=>{if(!i)throw new Error(s||t)})}function Ci(n,e,...t){return $c(n,e,t).then(([r,i])=>{if(r)throw r;return i})}function $c(n,e,t=void 0){if(!pO(n))throw Error(`apiVersionTag: ${n} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);return new Promise(r=>{const i=o0(n,e,t);var s;r((s=i.uuid,new Promise(o=>{we.promiseCallbacks.set(s,o)})))})}function OM(n){return n.map(e=>vM(e)?e.serialize():e)}function PM(n,e,t,r,i){var s;return gi(this,void 0,void 0,function*(){const o=OM(e),[a]=yield $c(r,n,o);if(i&&i(a)||!i&&MA(a))throw new Error(`${a.errorCode}, message: ${(s=a.message)!==null&&s!==void 0?s:"None"}`);if(t.validate(a))return t.deserialize(a);throw new Error(`${qd.INTERNAL_ERROR}, message: Invalid response from host - ${JSON.stringify(a)}`)})}function kn(n,e,t,r){let i;if(t instanceof Function?r=t:t instanceof Array&&(i=t),!pO(n))throw Error(`apiVersionTag: ${n} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);const s=o0(n,e,i);r&&we.callbacks.set(s.uuid,r)}we.parentMessageQueue=[],we.topMessageQueue=[],we.nextMessageId=0,we.callbacks=new Map,we.promiseCallbacks=new Map,we.portCallbacks=new Map,we.legacyMessageIdsToUuidMap={};const RM=fo.extend("sendNestedAuthRequestToTopWindow");function kM(n,e){const t=RM,r=Z.topWindow,i=function(s,o){const a=we.nextMessageId++,l=new Ma;return we.legacyMessageIdsToUuidMap[a]=l,{id:a,uuid:l,func:"nestedAppAuth.execute",timestamp:Date.now(),monotonicTimestamp:r0(),apiVersionTag:o,args:[],data:s}}(n,e);return t("Message %s information: %o",Vn(i),{actionName:i.func}),CO(r,i)}const NM=fo.extend("sendRequestToTargetWindowHelper");function CO(n,e){const t=NM,r=function(s){return s===Z.topWindow&&Gg()?"top":s===Z.parentWindow?"parent":null}(n),i=fO(e);if(de.isFramelessWindow)Z.currentWindow&&Z.currentWindow.nativeInterface&&(t("Sending message %s to %s via framelessPostMessage interface",Vn(i),r),Z.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(i)));else{const s=function(o){return o===Z.topWindow&&Gg()?Z.topOrigin:o===Z.parentWindow?Z.parentOrigin:null}(n);n&&s?(t("Sending message %s to %s via postMessage",Vn(i),r),n.postMessage(i,s)):(t("Adding message %s to %s message queue",Vn(i),r),MM(n).push(e))}return e}const LM=fo.extend("sendMessageToParentHelper");function o0(n,e,t,r,i){const s=LM,o=Z.parentWindow,a=function(l,c,u,d,h){const f=we.nextMessageId++,p=new Ma;we.legacyMessageIdsToUuidMap[f]=p;const g=d===!0?h:de.teamsJsInstanceId;return{id:f,uuid:p,func:c,timestamp:Date.now(),monotonicTimestamp:r0(),args:u||[],apiVersionTag:l,isProxiedFromChild:d!=null&&d,teamsJsInstanceId:g}}(n,e,t,r,i);return Bd.storeCallbackInformation(a.uuid,{name:e,calledAt:a.timestamp}),s("Message %s information: %o",Vn(a),{actionName:e,args:t}),CO(o,a)}const $w=fo.extend("processIncomingMessage"),IM=fo.extend("processAuthBridgeMessage");function AM(n,e){var t,r;const i=IM;if(!n||!n.data||typeof n.data!="object")return void i("Unrecognized message format received by app, message being ignored. Message: %o",n);const{args:s}=n.data,[,o]=s??[],a=(()=>{try{return JSON.parse(o)}catch{return null}})();if(!a||typeof a!="object"||a.messageType!=="NestedAppAuthResponse")return void i("Unrecognized data format received by app, message being ignored. Message: %o",n);const l=n.source||((t=n==null?void 0:n.originalEvent)===null||t===void 0?void 0:t.source),c=n.origin||((r=n==null?void 0:n.originalEvent)===null||r===void 0?void 0:r.origin);l?EO(l,c)?(Z.topWindow&&!Z.topWindow.closed&&l!==Z.topWindow||(Z.topWindow=l,Z.topOrigin=c),Z.topWindow&&Z.topWindow.closed&&(Z.topWindow=null,Z.topOrigin=null),s0(Z.topWindow,Z.topOrigin,we.topMessageQueue,"top"),e(o)):i("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin"):i("Message being ignored by app because it is coming for a target that is null")}const Cp=fo.extend("shouldProcessIncomingMessage");function EO(n,e){return gi(this,void 0,void 0,function*(){if(Z.currentWindow&&n===Z.currentWindow)return Cp("Should not process message because it is coming from the current window"),!1;if(Z.currentWindow&&Z.currentWindow.location&&e&&e===Z.currentWindow.location.origin)return!0;{let t;try{t=new URL(e)}catch{return Cp("Message has an invalid origin of %s",e),!1}const r=yield EM(t);return r||Cp("Message has an invalid origin of %s",e),r}})}const jw=fo.extend("handleIncomingMessageFromParent");function nd(n,e){if(e){const t=[...n].find(([r,i])=>r.toString()===e.toString());if(t)return t[0]}}function Ep(n,e){const t=nd(e,n.uuid);t&&e.delete(t),n.uuid?we.legacyMessageIdsToUuidMap={}:delete we.legacyMessageIdsToUuidMap[n.id]}function qw(n){const e=jw,t=r0();if("id"in n.data&&typeof n.data.id=="number"){const r=n.data,i=XA(r),s=function(o){const a=jw;if(!o.uuid)return we.legacyMessageIdsToUuidMap[o.id];{const l=o.uuid,c=nd(we.callbacks,l);if(c)return c;const u=nd(we.promiseCallbacks,l);if(u)return u;const d=nd(we.portCallbacks,l);if(d)return d}a("Received message %s that failed to produce a callbackId",Vn(o))}(i);if(s){const o=we.callbacks.get(s);e("Received a response from parent for message %s",s.toString()),Bd.handlePerformanceMetrics(s,i,e,t),o&&(e("Invoking the registered callback for message %s with arguments %o",s.toString(),i.args),o.apply(null,[...i.args,i.isPartialResponse]),function(c){return c.data.isPartialResponse===!0}(n)||(e("Removing registered callback for message %s",s.toString()),Ep(i,we.callbacks)));const a=we.promiseCallbacks.get(s);a&&(e("Invoking the registered promise callback for message %s with arguments %o",s.toString(),i.args),a(i.args),e("Removing registered promise callback for message %s",s.toString()),Ep(i,we.promiseCallbacks));const l=we.portCallbacks.get(s);if(l){let c;e("Invoking the registered port callback for message %s with arguments %o",s.toString(),i.args),n.ports&&n.ports[0]instanceof MessagePort&&(c=n.ports[0]),l(c,i.args),e("Removing registered port callback for message %s",s.toString()),Ep(i,we.portCallbacks)}i.uuid&&(we.legacyMessageIdsToUuidMap={})}}else if("func"in n.data&&typeof n.data.func=="string"){const r=n.data;Bd.handleOneWayPerformanceMetrics(r,e,t),e('Received a message from parent %s, action: "%s"',Vn(r),r.func),RO(r.func,r.args)}else e("Received an unknown message: %O",n)}function Gg(){return Z.topWindow!==Z.parentWindow}function MM(n){return n===Z.topWindow&&Gg()?we.topMessageQueue:n===Z.parentWindow?we.parentMessageQueue:[]}const _O=qr("internal"),DM=_O.extend("ensureInitializeCalled"),FM=_O.extend("ensureInitialized");function TO(){if(!de.initializeCalled)throw DM(pc),new Error(pc)}function vi(n,...e){if(!de.initializeCompleted)throw FM("%s. initializeCalled: %s",pc,de.initializeCalled.toString()),new Error(pc);if(e&&e.length>0){let t=!1;for(let r=0;r<e.length;r++)if(e[r]===de.frameContext){t=!0;break}if(!t)throw new Error(`This call is only allowed in following contexts: ${JSON.stringify(e)}. Current context: "${de.frameContext}".`)}return uM(n)}function zM(n){let e=de.additionalValidOrigins.concat(n.filter(r=>typeof r=="string"&&aM.test(r)));const t={};e=e.filter(r=>!t[r]&&(t[r]=!0,!0)),de.additionalValidOrigins=e}function $M(n){if(!qM(n))throw new Error(`Potential app id (${n}) is invalid; its length ${n.length} is not within the length limits (${xO}-${OO}).`)}function jM(n){if(GA(n))throw new Error(`Potential app id (${n}) is invalid; it contains script tags.`);if(BM(n))throw new Error(`Potential app id (${n}) is invalid; it contains non-printable characters.`)}const xO=4,OO=256;function qM(n){return n.length<OO&&n.length>xO}function BM(n){return[...n].some(e=>{const t=e.charCodeAt(0);return t<32||t>126})}let UM=class{constructor(e){this.idAsString=e,jM(e)}serialize(){return this.toString()}toString(){return this.idAsString}},HM=class extends UM{constructor(e){super(e),$M(e)}toJSON(){return{appIdAsString:this.toString()}}};const Ih="v2",_p=qr("app"),Kg={AppLoaded:"appInitialization.appLoaded",Success:"appInitialization.success",Failure:"appInitialization.failure",ExpectedFailure:"appInitialization.expectedFailure"};var Bw,Uw;function Ah(n){return lD(Ee(Ih,"app.initialize"),n)}function a0(){return new Promise(n=>{TO(),n(TM(Ee(Ih,"app.getContext"),"getContext"))}).then(n=>function(e){var t;return{actionInfo:e.actionInfo,app:{locale:e.locale,sessionId:e.appSessionId?e.appSessionId:"",theme:e.theme?e.theme:"default",iconPositionVertical:e.appIconPosition,osLocaleInfo:e.osLocaleInfo,messageId:e.messageId,parentMessageId:e.parentMessageId,userClickTime:e.userClickTime,userClickTimeV2:e.userClickTimeV2,userFileOpenPreference:e.userFileOpenPreference,host:{name:e.hostName?e.hostName:Vg.teams,clientType:e.hostClientType?e.hostClientType:be.web,sessionId:e.sessionId?e.sessionId:"",ringId:e.ringId},appLaunchId:e.appLaunchId,appId:e.appId?new HM(e.appId):void 0,manifestVersion:e.manifestVersion},page:{id:e.entityId,frameContext:e.frameContext?e.frameContext:de.frameContext,renderingSurface:e.renderingSurface?e.renderingSurface:void 0,subPageId:e.subEntityId,isFullScreen:e.isFullScreen,isMultiWindow:e.isMultiWindow,isBackgroundLoad:e.isBackgroundLoad,sourceOrigin:e.sourceOrigin},user:{id:(t=e.userObjectId)!==null&&t!==void 0?t:"",displayName:e.userDisplayName,isCallingAllowed:e.isCallingAllowed,isPSTNCallingAllowed:e.isPSTNCallingAllowed,licenseType:e.userLicenseType,loginHint:e.loginHint,userPrincipalName:e.userPrincipalName,tenant:e.tid?{id:e.tid,teamsSku:e.tenantSKU}:void 0},channel:e.channelId?{id:e.channelId,displayName:e.channelName,relativeUrl:e.channelRelativeUrl,membershipType:e.channelType,defaultOneNoteSectionId:e.defaultOneNoteSectionId,ownerGroupId:e.hostTeamGroupId,ownerTenantId:e.hostTeamTenantId}:void 0,chat:e.chatId?{id:e.chatId}:void 0,meeting:e.meetingId?{id:e.meetingId}:void 0,sharepoint:e.sharepoint,team:e.teamId?{internalId:e.teamId,displayName:e.teamName,type:e.teamType,groupId:e.groupId,templateId:e.teamTemplateId,isArchived:e.isTeamArchived,userRole:e.userTeamRole}:void 0,sharePointSite:e.teamSiteUrl||e.teamSiteDomain||e.teamSitePath||e.mySitePath||e.mySiteDomain?{teamSiteUrl:e.teamSiteUrl,teamSiteDomain:e.teamSiteDomain,teamSitePath:e.teamSitePath,teamSiteId:e.teamSiteId,mySitePath:e.mySitePath,mySiteDomain:e.mySiteDomain}:void 0,dialogParameters:e.dialogParameters||{}}}(n))}function VM(){TO(),cD(Ee(Ih,"app.notifyAppLoaded"))}function WM(){return uD(Ee(Ih,"app.notifySuccess"))}(function(n){n.AuthFailed="AuthFailed",n.Timeout="Timeout",n.Other="Other"})(Bw||(Bw={})),function(n){n.PermissionError="PermissionError",n.NotFound="NotFound",n.Throttling="Throttling",n.Offline="Offline",n.Other="Other"}(Uw||(Uw={})),_p("teamsjs instance is version %s, starting at %s UTC (%s local)",mc,new Date().toISOString(),new Date().toLocaleString()),function(){if(Nh())return;const n=document.getElementsByTagName("script"),e=n&&n[n.length-1]&&n[n.length-1].src,t="Today, teamsjs can only be used from a single script or you may see undefined behavior. This log line is used to help detect cases where teamsjs is loaded multiple times -- it is always written. The presence of the log itself does not indicate a multi-load situation, but multiples of these log lines will. If you would like to use teamjs from more than one script at the same time, please open an issue at https://github.com/OfficeDev/microsoft-teams-library-js/issues";e&&e.length!==0?_p("teamsjs is being used from %s. %s",e,t):_p("teamsjs is being used from a script tag embedded directly in your html. %s",t)}();const GM="v2",KM=[];function JM(n){de.frameContext&&(de.frameContext===Un.task?KM.push(n):yD("messageForChild"))}function QM(){Ws(Ee(GM,"dialog.registerMessageForChildHandler"),"messageForChild",JM,!1)}const ra="v2";var Hw,Vw;(function(n){n[n.ifRoom=0]="ifRoom",n[n.overflowOnly=1]="overflowOnly"})(Hw||(Hw={}));function XM(){Ws(Ee(ra,"menus.registerNavBarMenuItemPressHandler"),"navBarMenuItemPress",ZM,!1),Ws(Ee(ra,"menus.registerActionMenuItemPressHandler"),"actionMenuItemPress",eD,!1),Ws(Ee(ra,"menus.registerSetModuleViewHandler"),"setModuleView",YM,!1)}function YM(n){vi(pn),kn(Ee(ra,"menus.handleViewConfigItemPress"),"viewConfigItemPress",[n])}function ZM(n){vi(pn),kn(Ee(ra,"menus.handleNavBarMenuItemPress"),"handleNavBarMenuItemPress",[n])}function eD(n){vi(pn),kn(Ee(ra,"menus.handleActionMenuItemPress"),"handleActionMenuItemPress",[n])}(function(n){n.dropDown="dropDown",n.popOver="popOver"})(Vw||(Vw={}));class tD{}class nD extends tD{validate(e){return!0}deserialize(e){return e}}function rD(){Ws(Ee(no,"pages.config.registerSettingsSaveHandler"),"settings.save",iD,!1),Ws(Ee(no,"pages.config.registerSettingsRemoveHandler"),"settings.remove",oD,!1)}function iD(n){const e=new sD(n);di()?hi("settings.save",[n]):e.notifySuccess()}let sD=class{constructor(e){this.notified=!1,this.result=e||{}}notifySuccess(){this.ensureNotNotified(),kn(Ee(no,"pages.saveEvent.notifySuccess"),"settings.save.success"),this.notified=!0}notifyFailure(e){this.ensureNotNotified(),kn(Ee(no,"pages.saveEvent.notifyFailure"),"settings.save.failure",[e]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The SaveEvent may only notify success or failure once.")}};function oD(){const n=new aD;di()?hi("settings.remove",[]):n.notifySuccess()}class aD{constructor(){this.notified=!1}notifySuccess(){this.ensureNotNotified(),kn(Ee(no,"pages.removeEvent.notifySuccess"),"settings.remove.success"),this.notified=!0}notifyFailure(e){this.ensureNotNotified(),kn(Ee(no,"pages.removeEvent.notifyFailure"),"settings.remove.failure",[e]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The removeEventType may only notify success or failure once.")}}const PO=qr("app");function lD(n,e){return Nh()?(PO.extend("initialize")("window object undefined at initialization"),Promise.resolve()):HA(()=>function(t,r){return new Promise(i=>{de.initializeCalled||(de.initializeCalled=!0,vD(),de.initializePromise=_M(r,t).then(({context:s,clientType:o,runtimeConfig:a,clientSupportedSDKVersion:l=Aw})=>{de.frameContext=s,de.hostClientType=o,de.clientSupportedSDKVersion=l;try{cl("Parsing %s",a);let c=JSON.parse(a);if(cl("Checking if %o is a valid runtime object",c??"null"),!c||!c.apiVersion)throw new Error("Received runtime config is invalid");c=Nw(c),a&&wp(c)}catch(c){if(!(c instanceof SyntaxError))throw c;try{cl("Attempting to parse %s as an SDK version",a),isNaN(dO(a,Aw))||(de.clientSupportedSDKVersion=a);let u=JSON.parse(l);if(cl("givenRuntimeConfig parsed to %o",u??"null"),!u)throw new Error("givenRuntimeConfig string was successfully parsed. However, it parsed to value of null");u=Nw(u),wp(u)}catch(u){if(!(u instanceof SyntaxError))throw u;wp(gM(de.clientSupportedSDKVersion,dM,mM))}}de.initializeCompleted=!0}),XM(),rD(),QM()),Array.isArray(r)&&zM(r),de.initializePromise!==void 0?i(de.initializePromise):cl("GlobalVars.initializePromise is unexpectedly undefined")})}(n,e),6e4,new Error("SDK initialization timed out."))}function cD(n){kn(n,Kg.AppLoaded,[mc])}function uD(n){return gi(this,void 0,void 0,function*(){if(de.initializeCompleted)return Ww(n);if(!de.initializePromise)throw new Error(pc);return de.initializePromise.then(()=>Ww(n))})}function Ww(n){return gi(this,void 0,void 0,function*(){return vi(pn)&&(!((e=pn.supports.app)===null||e===void 0)&&e.notifySuccessResponse)?PM(Kg.Success,[mc],new nD,n).then(()=>({hasFinishedSuccessfully:!0})):(kn(n,Kg.Success,[mc]),{hasFinishedSuccessfully:"unknown"});var e})}const cl=PO.extend("initializeHelper");function dD(){return fD(Ee(no,"pages.backStack.navigateBack"))}function hD(){return!(!vi(pn)||!pn.supports.pages)&&!!pn.supports.pages.backStack}const no="v2";function fD(n){return new Promise(e=>{if(vi(pn),!hD())throw DA;e(xM(n,"navigateBack","Back navigation is not supported in the current client or context."))})}function pD(){Ws(Ee("v2","pages.backStack.registerBackButtonPressHandler"),"backButtonPress",mD,!1)}function mD(){di()?hi("backButtonPress",[]):dD()}const gD=qr("handlers");let Ve=class gr{static initializeHandlers(){gr.handlers.themeChange=SD,gr.handlers.load=bD,gr.handlers.beforeUnload=wD,pD()}static uninitializeHandlers(){gr.handlers={},gr.themeChangeHandler=null,gr.loadHandler=null,gr.beforeUnloadHandler=null,gr.beforeSuspendOrTerminateHandler=null,gr.resumeHandler=null}};function vD(){Ve.initializeHandlers()}Ve.handlers={},Ve.themeChangeHandler=null,Ve.loadHandler=null,Ve.beforeUnloadHandler=null,Ve.beforeSuspendOrTerminateHandler=null,Ve.resumeHandler=null,Ve.hostToAppPerformanceMetricsHandler=null;const Gw=gD.extend("callHandler");function RO(n,e){const t=Ve.handlers[n];return t?(Gw("Invoking the registered handler for message %s with arguments %o",n,e),[!0,t.apply(this,e)]):di()?(hi(n,e),[!1,void 0]):(Gw("Handler for action message %s not found.",n),[!1,void 0])}function Ws(n,e,t,r=!0,i=[]){t?(Ve.handlers[e]=t,r&&kn(n,"registerHandler",[e,...i])):delete Ve.handlers[e]}function yD(n){delete Ve.handlers[n]}function SD(n){Ve.themeChangeHandler&&Ve.themeChangeHandler(n),di()&&hi("themeChange",[n])}function Kw(n){Ve.hostToAppPerformanceMetricsHandler&&Ve.hostToAppPerformanceMetricsHandler(n)}function bD(n){const e={entityId:(t=n).entityId,contentUrl:new URL(t.contentUrl)};var t;Ve.resumeHandler?(Ve.resumeHandler(e),di()&&hi("load",[e])):Ve.loadHandler&&(Ve.loadHandler(n),di()&&hi("load",[n]))}function wD(){return gi(this,void 0,void 0,function*(){const n=()=>{kn(Ee("v2","handleBeforeUnload"),"readyToUnload",[])};Ve.beforeSuspendOrTerminateHandler?(yield Ve.beforeSuspendOrTerminateHandler(),di()?hi("beforeUnload"):n()):Ve.beforeUnloadHandler&&Ve.beforeUnloadHandler(n)||(di()?hi("beforeUnload"):n())})}const CD=qr("childProxyingCommunication");let Ue=class{};function di(){return!!cO()&&!!Ue.window}function ED(n,e){return!!cO()&&(Ue.window&&!Ue.window.closed&&n!==Ue.window||(Ue.window=n,Ue.origin=e),Ue.window&&Ue.window.closed?(Ue.window=null,Ue.origin=null,!1):Ue.window===n)}function _D(n,e,t,r){return gi(this,void 0,void 0,function*(){Ue.window===e&&(s0(Ue.window,Ue.origin,Ue.messageQueue,"child"),function(i,s,o){if(i.data.id===void 0||i.data.func===void 0)return;const a=QA(i.data),[l,c]=RO(a.func,a.args);if(l&&c!==void 0)return Ol("Handler called in response to message %s from child. Returning response from handler to child, action: %s.",Vn(a),a.func),void Jw(a.id,a.uuid,Array.isArray(c)?c:[c]);Ol("No handler for message %s from child found; relaying message on to parent, action: %s. Relayed message will have a new id.",Vn(a),a.func),function(u,d,h){const f=d(Ee("v2","tasks.startTask"),u.func,u.args,!0,u.teamsJsInstanceId),p=Ue.origin;h(f.uuid,(...g)=>{if(!Ue.window)return;if(!AA().disableEnforceOriginMatchForChildResponses&&p!==Ue.origin)return void Ol("Origin of child window has changed, not sending response back to child window");const S=g.pop();Ol("Message from parent being relayed to child, id: %s",Vn(u)),Jw(u.id,u.uuid,g,S)})}(a,s,o)}(n,t,r))})}Ue.messageQueue=[];const Ol=CD.extend("handleIncomingMessageFromChild");function Jw(n,e,t,r){const i=Ue.window,s=function(l,c,u,d){return{id:l,uuid:c,args:u||[],isPartialResponse:d}}(n,e,t,r),o=YA(s),a=Ue.origin;i&&a&&(Ol("Sending message %s to %s via postMessage, args = %o",Vn(o),"child",o.args),i.postMessage(o,a))}function hi(n,e){const t=Ue.window,r=function(s,o){return{func:s,args:o||[]}}(n,e),i=Ue.origin;t&&i?t.postMessage(r,i):Ue.messageQueue.push(r)}const Ei="v2";var Qw,Xw;function TD(){return!(!vi(pn,Un.meetingStage,Un.sidePanel,Un.content)||!pn.supports.interactive)}(function(n){n.guest="Guest",n.attendee="Attendee",n.presenter="Presenter",n.organizer="Organizer"})(Qw||(Qw={})),function(n){n.added="Added",n.alreadyExists="AlreadyExists",n.conflict="Conflict",n.notFound="NotFound"}(Xw||(Xw={}));class l0{getFluidTenantInfo(){return Ur(),new Promise(e=>{e(Ci(Ee(Ei,"interactive.getFluidTenantInfo"),"interactive.getFluidTenantInfo"))})}getFluidToken(e){return Ur(),new Promise(t=>{t(Ci(Ee(Ei,"interactive.getFluidToken"),"interactive.getFluidToken",e))})}getFluidContainerId(){return Ur(),new Promise(e=>{e(Ci(Ee(Ei,"interactive.getFluidContainerId"),"interactive.getFluidContainerId"))})}setFluidContainerId(e){return Ur(),new Promise(t=>{t(Ci(Ee(Ei,"interactive.setFluidContainerId"),"interactive.setFluidContainerId",e))})}getNtpTime(){return Ur(),new Promise(e=>{e(Ci(Ee(Ei,"interactive.getNtpTime"),"interactive.getNtpTime"))})}registerClientId(e){return Ur(),new Promise(t=>{t(Ci(Ee(Ei,"interactive.registerClientId"),"interactive.registerClientId",e))})}getClientRoles(e){return Ur(),new Promise(t=>{t(Ci(Ee(Ei,"interactive.getClientRoles"),"interactive.getClientRoles",e))})}getClientInfo(e){return Ur(),new Promise(t=>{t(Ci(Ee(Ei,"interactive.getClientInfo"),"interactive.getClientInfo",e))})}static create(){return Ur(),new l0}}function Ur(){if(!TD())throw new Error("LiveShareHost Not supported")}const kO="v1";var Yw,Zw,eC,tC,Jg,nC;function rC(n){if(!n)throw new Error("[get meeting details] Callback cannot be null");vi(pn,Un.sidePanel,Un.meetingStage,Un.settings,Un.content),kn(Ee(kO,"meeting.getMeetingDetails"),"meeting.getMeetingDetails",n)}function NO(n,e,t={sharingProtocol:Jg.Collaborative}){if(!n)throw new Error("[share app content to stage] Callback cannot be null");vi(pn,Un.sidePanel,Un.meetingStage),kn(Ee(kO,"meeting.shareAppContentToStage"),"meeting.shareAppContentToStage",[e,t],n)}(function(n){n[n.HostInitiated=0]="HostInitiated",n[n.AppInitiated=1]="AppInitiated",n[n.AppDeclinedToChange=2]="AppDeclinedToChange",n[n.AppFailedToChange=3]="AppFailedToChange"})(Yw||(Yw={})),function(n){n.like="like",n.heart="heart",n.laugh="laugh",n.surprised="surprised",n.applause="applause"}(Zw||(Zw={})),function(n){n.Unknown="Unknown",n.Adhoc="Adhoc",n.Scheduled="Scheduled",n.Recurring="Recurring",n.Broadcast="Broadcast",n.MeetNow="MeetNow"}(eC||(eC={})),function(n){n.OneOnOneCall="oneOnOneCall",n.GroupCall="groupCall"}(tC||(tC={})),function(n){n.Collaborative="Collaborative",n.ScreenShare="ScreenShare"}(Jg||(Jg={})),function(n){n.M365CalendarGridContextMenu="m365_calendar_grid_context_menu",n.M365CalendarGridPeek="m365_calendar_grid_peek",n.M365CalendarGridEventCardJoinButton="m365_calendar_grid_event_card_join_button",n.M365CalendarFormRibbonJoinButton="m365_calendar_form_ribbon_join_button",n.M365CalendarFormJoinTeamsMeetingButton="m365_calendar_form_join_teams_meeting_button",n.Other="other"}(nC||(nC={}));function xD(){return!!new URLSearchParams(window.location.search).get("inTeams")}var Ud={},yi={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const LO=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string"&&typeof(n==null?void 0:n.fluid)=="object",iC=n=>{const e=n;return typeof e=="object"&&(typeof(e==null?void 0:e.package)=="string"||LO(e==null?void 0:e.package))&&((e==null?void 0:e.config)===void 0||typeof(e==null?void 0:e.config)=="object")};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var as;(function(n){n.genericError="genericError",n.throttlingError="throttlingError",n.dataCorruptionError="dataCorruptionError",n.dataProcessingError="dataProcessingError",n.usageError="usageError",n.clientSessionExpiredError="clientSessionExpiredError"})(as||(as={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ge;(function(n){n.cache="fluid-cache",n.clientDetails="fluid-client-details",n.loadMode="loadMode",n.reconnect="fluid-reconnect",n.sequenceNumber="fluid-sequence-number",n.version="version"})(Ge||(Ge={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var te;(function(n){n.Detached="Detached",n.Attaching="Attaching",n.Attached="Attached"})(te||(te={}));var Cn;(function(n){n.NotBound="NotBound",n.Binding="Binding",n.Bound="Bound"})(Cn||(Cn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Oe;(function(n){n[n.Disconnected=0]="Disconnected",n[n.EstablishingConnection=3]="EstablishingConnection",n[n.Connecting=1]="Connecting",n[n.CatchingUp=1]="CatchingUp",n[n.Connected=2]="Connected"})(Oe||(Oe={}));function OD(){this.__data__=[],this.size=0}var PD=OD;function RD(n,e){return n===e||n!==n&&e!==e}var Mh=RD,kD=Mh;function ND(n,e){for(var t=n.length;t--;)if(kD(n[t][0],e))return t;return-1}var Dh=ND,LD=Dh,ID=Array.prototype,AD=ID.splice;function MD(n){var e=this.__data__,t=LD(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():AD.call(e,t,1),--this.size,!0}var DD=MD,FD=Dh;function zD(n){var e=this.__data__,t=FD(e,n);return t<0?void 0:e[t][1]}var $D=zD,jD=Dh;function qD(n){return jD(this.__data__,n)>-1}var BD=qD,UD=Dh;function HD(n,e){var t=this.__data__,r=UD(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}var VD=HD,WD=PD,GD=DD,KD=$D,JD=BD,QD=VD;function Da(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Da.prototype.clear=WD;Da.prototype.delete=GD;Da.prototype.get=KD;Da.prototype.has=JD;Da.prototype.set=QD;var Fh=Da,XD=Fh;function YD(){this.__data__=new XD,this.size=0}var ZD=YD;function eF(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}var tF=eF;function nF(n){return this.__data__.get(n)}var rF=nF;function iF(n){return this.__data__.has(n)}var sF=iF,oF=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,IO=oF,aF=IO,lF=typeof self=="object"&&self&&self.Object===Object&&self,cF=aF||lF||Function("return this")(),Br=cF,uF=Br,dF=uF.Symbol,c0=dF,sC=c0,AO=Object.prototype,hF=AO.hasOwnProperty,fF=AO.toString,ul=sC?sC.toStringTag:void 0;function pF(n){var e=hF.call(n,ul),t=n[ul];try{n[ul]=void 0;var r=!0}catch{}var i=fF.call(n);return r&&(e?n[ul]=t:delete n[ul]),i}var mF=pF,gF=Object.prototype,vF=gF.toString;function yF(n){return vF.call(n)}var SF=yF,oC=c0,bF=mF,wF=SF,CF="[object Null]",EF="[object Undefined]",aC=oC?oC.toStringTag:void 0;function _F(n){return n==null?n===void 0?EF:CF:aC&&aC in Object(n)?bF(n):wF(n)}var jc=_F;function TF(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var fs=TF,xF=jc,OF=fs,PF="[object AsyncFunction]",RF="[object Function]",kF="[object GeneratorFunction]",NF="[object Proxy]";function LF(n){if(!OF(n))return!1;var e=xF(n);return e==RF||e==kF||e==PF||e==NF}var u0=LF,IF=Br,AF=IF["__core-js_shared__"],MF=AF,Tp=MF,lC=function(){var n=/[^.]+$/.exec(Tp&&Tp.keys&&Tp.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function DF(n){return!!lC&&lC in n}var FF=DF,zF=Function.prototype,$F=zF.toString;function jF(n){if(n!=null){try{return $F.call(n)}catch{}try{return n+""}catch{}}return""}var MO=jF,qF=u0,BF=FF,UF=fs,HF=MO,VF=/[\\^$.*+?()[\]{}|]/g,WF=/^\[object .+?Constructor\]$/,GF=Function.prototype,KF=Object.prototype,JF=GF.toString,QF=KF.hasOwnProperty,XF=RegExp("^"+JF.call(QF).replace(VF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function YF(n){if(!UF(n)||BF(n))return!1;var e=qF(n)?XF:WF;return e.test(HF(n))}var ZF=YF;function ez(n,e){return n==null?void 0:n[e]}var tz=ez,nz=ZF,rz=tz;function iz(n,e){var t=rz(n,e);return nz(t)?t:void 0}var po=iz,sz=po,oz=Br,az=sz(oz,"Map"),d0=az,lz=po,cz=lz(Object,"create"),zh=cz,cC=zh;function uz(){this.__data__=cC?cC(null):{},this.size=0}var dz=uz;function hz(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var fz=hz,pz=zh,mz="__lodash_hash_undefined__",gz=Object.prototype,vz=gz.hasOwnProperty;function yz(n){var e=this.__data__;if(pz){var t=e[n];return t===mz?void 0:t}return vz.call(e,n)?e[n]:void 0}var Sz=yz,bz=zh,wz=Object.prototype,Cz=wz.hasOwnProperty;function Ez(n){var e=this.__data__;return bz?e[n]!==void 0:Cz.call(e,n)}var _z=Ez,Tz=zh,xz="__lodash_hash_undefined__";function Oz(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Tz&&e===void 0?xz:e,this}var Pz=Oz,Rz=dz,kz=fz,Nz=Sz,Lz=_z,Iz=Pz;function Fa(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Fa.prototype.clear=Rz;Fa.prototype.delete=kz;Fa.prototype.get=Nz;Fa.prototype.has=Lz;Fa.prototype.set=Iz;var Az=Fa,uC=Az,Mz=Fh,Dz=d0;function Fz(){this.size=0,this.__data__={hash:new uC,map:new(Dz||Mz),string:new uC}}var zz=Fz;function $z(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var jz=$z,qz=jz;function Bz(n,e){var t=n.__data__;return qz(e)?t[typeof e=="string"?"string":"hash"]:t.map}var $h=Bz,Uz=$h;function Hz(n){var e=Uz(this,n).delete(n);return this.size-=e?1:0,e}var Vz=Hz,Wz=$h;function Gz(n){return Wz(this,n).get(n)}var Kz=Gz,Jz=$h;function Qz(n){return Jz(this,n).has(n)}var Xz=Qz,Yz=$h;function Zz(n,e){var t=Yz(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}var e$=Zz,t$=zz,n$=Vz,r$=Kz,i$=Xz,s$=e$;function za(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}za.prototype.clear=t$;za.prototype.delete=n$;za.prototype.get=r$;za.prototype.has=i$;za.prototype.set=s$;var o$=za,a$=Fh,l$=d0,c$=o$,u$=200;function d$(n,e){var t=this.__data__;if(t instanceof a$){var r=t.__data__;if(!l$||r.length<u$-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new c$(r)}return t.set(n,e),this.size=t.size,this}var h$=d$,f$=Fh,p$=ZD,m$=tF,g$=rF,v$=sF,y$=h$;function $a(n){var e=this.__data__=new f$(n);this.size=e.size}$a.prototype.clear=p$;$a.prototype.delete=m$;$a.prototype.get=g$;$a.prototype.has=v$;$a.prototype.set=y$;var DO=$a,S$=po,b$=function(){try{var n=S$(Object,"defineProperty");return n({},"",{}),n}catch{}}(),FO=b$,dC=FO;function w$(n,e,t){e=="__proto__"&&dC?dC(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var h0=w$,C$=h0,E$=Mh;function _$(n,e,t){(t!==void 0&&!E$(n[e],t)||t===void 0&&!(e in n))&&C$(n,e,t)}var zO=_$;function T$(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var l=o[n?a:++i];if(t(s[l],l,s)===!1)break}return e}}var x$=T$,O$=x$,P$=O$(),R$=P$,Hd={exports:{}};Hd.exports;(function(n,e){var t=Br,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s?t.Buffer:void 0,a=o?o.allocUnsafe:void 0;function l(c,u){if(u)return c.slice();var d=c.length,h=a?a(d):new c.constructor(d);return c.copy(h),h}n.exports=l})(Hd,Hd.exports);var $O=Hd.exports,k$=Br,N$=k$.Uint8Array,L$=N$,hC=L$;function I$(n){var e=new n.constructor(n.byteLength);return new hC(e).set(new hC(n)),e}var f0=I$,A$=f0;function M$(n,e){var t=e?A$(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var jO=M$;function D$(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var qO=D$,F$=fs,fC=Object.create,z$=function(){function n(){}return function(e){if(!F$(e))return{};if(fC)return fC(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}(),$$=z$;function j$(n,e){return function(t){return n(e(t))}}var BO=j$,q$=BO,B$=q$(Object.getPrototypeOf,Object),p0=B$,U$=Object.prototype;function H$(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||U$;return n===t}var m0=H$,V$=$$,W$=p0,G$=m0;function K$(n){return typeof n.constructor=="function"&&!G$(n)?V$(W$(n)):{}}var UO=K$;function J$(n){return n!=null&&typeof n=="object"}var mo=J$,Q$=jc,X$=mo,Y$="[object Arguments]";function Z$(n){return X$(n)&&Q$(n)==Y$}var ej=Z$,pC=ej,tj=mo,HO=Object.prototype,nj=HO.hasOwnProperty,rj=HO.propertyIsEnumerable,ij=pC(function(){return arguments}())?pC:function(n){return tj(n)&&nj.call(n,"callee")&&!rj.call(n,"callee")},VO=ij,sj=Array.isArray,jh=sj,oj=9007199254740991;function aj(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=oj}var WO=aj,lj=u0,cj=WO;function uj(n){return n!=null&&cj(n.length)&&!lj(n)}var qh=uj,dj=qh,hj=mo;function fj(n){return hj(n)&&dj(n)}var pj=fj,Vd={exports:{}};function mj(){return!1}var gj=mj;Vd.exports;(function(n,e){var t=Br,r=gj,i=e&&!e.nodeType&&e,s=i&&!0&&n&&!n.nodeType&&n,o=s&&s.exports===i,a=o?t.Buffer:void 0,l=a?a.isBuffer:void 0,c=l||r;n.exports=c})(Vd,Vd.exports);var g0=Vd.exports,vj=jc,yj=p0,Sj=mo,bj="[object Object]",wj=Function.prototype,Cj=Object.prototype,GO=wj.toString,Ej=Cj.hasOwnProperty,_j=GO.call(Object);function Tj(n){if(!Sj(n)||vj(n)!=bj)return!1;var e=yj(n);if(e===null)return!0;var t=Ej.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&GO.call(t)==_j}var xj=Tj,Oj=jc,Pj=WO,Rj=mo,kj="[object Arguments]",Nj="[object Array]",Lj="[object Boolean]",Ij="[object Date]",Aj="[object Error]",Mj="[object Function]",Dj="[object Map]",Fj="[object Number]",zj="[object Object]",$j="[object RegExp]",jj="[object Set]",qj="[object String]",Bj="[object WeakMap]",Uj="[object ArrayBuffer]",Hj="[object DataView]",Vj="[object Float32Array]",Wj="[object Float64Array]",Gj="[object Int8Array]",Kj="[object Int16Array]",Jj="[object Int32Array]",Qj="[object Uint8Array]",Xj="[object Uint8ClampedArray]",Yj="[object Uint16Array]",Zj="[object Uint32Array]",je={};je[Vj]=je[Wj]=je[Gj]=je[Kj]=je[Jj]=je[Qj]=je[Xj]=je[Yj]=je[Zj]=!0;je[kj]=je[Nj]=je[Uj]=je[Lj]=je[Hj]=je[Ij]=je[Aj]=je[Mj]=je[Dj]=je[Fj]=je[zj]=je[$j]=je[jj]=je[qj]=je[Bj]=!1;function eq(n){return Rj(n)&&Pj(n.length)&&!!je[Oj(n)]}var tq=eq;function nq(n){return function(e){return n(e)}}var v0=nq,Wd={exports:{}};Wd.exports;(function(n,e){var t=IO,r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s&&t.process,a=function(){try{var l=i&&i.require&&i.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();n.exports=a})(Wd,Wd.exports);var y0=Wd.exports,rq=tq,iq=v0,mC=y0,gC=mC&&mC.isTypedArray,sq=gC?iq(gC):rq,KO=sq;function oq(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}var JO=oq,aq=h0,lq=Mh,cq=Object.prototype,uq=cq.hasOwnProperty;function dq(n,e,t){var r=n[e];(!(uq.call(n,e)&&lq(r,t))||t===void 0&&!(e in n))&&aq(n,e,t)}var QO=dq,hq=QO,fq=h0;function pq(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=r?r(t[a],n[a],a,t,n):void 0;l===void 0&&(l=n[a]),i?fq(t,a,l):hq(t,a,l)}return t}var qc=pq;function mq(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var gq=mq,vq=9007199254740991,yq=/^(?:0|[1-9]\d*)$/;function Sq(n,e){var t=typeof n;return e=e??vq,!!e&&(t=="number"||t!="symbol"&&yq.test(n))&&n>-1&&n%1==0&&n<e}var XO=Sq,bq=gq,wq=VO,Cq=jh,Eq=g0,_q=XO,Tq=KO,xq=Object.prototype,Oq=xq.hasOwnProperty;function Pq(n,e){var t=Cq(n),r=!t&&wq(n),i=!t&&!r&&Eq(n),s=!t&&!r&&!i&&Tq(n),o=t||r||i||s,a=o?bq(n.length,String):[],l=a.length;for(var c in n)(e||Oq.call(n,c))&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||_q(c,l)))&&a.push(c);return a}var YO=Pq;function Rq(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var kq=Rq,Nq=fs,Lq=m0,Iq=kq,Aq=Object.prototype,Mq=Aq.hasOwnProperty;function Dq(n){if(!Nq(n))return Iq(n);var e=Lq(n),t=[];for(var r in n)r=="constructor"&&(e||!Mq.call(n,r))||t.push(r);return t}var Fq=Dq,zq=YO,$q=Fq,jq=qh;function qq(n){return jq(n)?zq(n,!0):$q(n)}var Bc=qq,Bq=qc,Uq=Bc;function Hq(n){return Bq(n,Uq(n))}var Vq=Hq,vC=zO,Wq=$O,Gq=jO,Kq=qO,Jq=UO,yC=VO,SC=jh,Qq=pj,Xq=g0,Yq=u0,Zq=fs,eB=xj,tB=KO,bC=JO,nB=Vq;function rB(n,e,t,r,i,s,o){var a=bC(n,t),l=bC(e,t),c=o.get(l);if(c){vC(n,t,c);return}var u=s?s(a,l,t+"",n,e,o):void 0,d=u===void 0;if(d){var h=SC(l),f=!h&&Xq(l),p=!h&&!f&&tB(l);u=l,h||f||p?SC(a)?u=a:Qq(a)?u=Kq(a):f?(d=!1,u=Wq(l,!0)):p?(d=!1,u=Gq(l,!0)):u=[]:eB(l)||yC(l)?(u=a,yC(a)?u=nB(a):(!Zq(a)||Yq(a))&&(u=Jq(l))):d=!1}d&&(o.set(l,u),i(u,l,r,s,o),o.delete(l)),vC(n,t,u)}var iB=rB,sB=DO,oB=zO,aB=R$,lB=iB,cB=fs,uB=Bc,dB=JO;function ZO(n,e,t,r,i){n!==e&&aB(e,function(s,o){if(i||(i=new sB),cB(s))lB(n,e,o,t,ZO,r,i);else{var a=r?r(dB(n,o),s,o+"",n,e,i):void 0;a===void 0&&(a=s),oB(n,o,a)}},uB)}var hB=ZO;function fB(n){return n}var eP=fB;function pB(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}var mB=pB,gB=mB,wC=Math.max;function vB(n,e,t){return e=wC(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=wC(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(o),gB(n,this,a)}}var yB=vB;function SB(n){return function(){return n}}var bB=SB,wB=bB,CC=FO,CB=eP,EB=CC?function(n,e){return CC(n,"toString",{configurable:!0,enumerable:!1,value:wB(e),writable:!0})}:CB,_B=EB,TB=800,xB=16,OB=Date.now;function PB(n){var e=0,t=0;return function(){var r=OB(),i=xB-(r-t);if(t=r,i>0){if(++e>=TB)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}var RB=PB,kB=_B,NB=RB,LB=NB(kB),IB=LB,AB=eP,MB=yB,DB=IB;function FB(n,e){return DB(MB(n,e,AB),n+"")}var zB=FB,$B=Mh,jB=qh,qB=XO,BB=fs;function UB(n,e,t){if(!BB(t))return!1;var r=typeof e;return(r=="number"?jB(t)&&qB(e,t.length):r=="string"&&e in t)?$B(t[e],n):!1}var HB=UB,VB=zB,WB=HB;function GB(n){return VB(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&WB(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,s)}return e})}var KB=GB,JB=hB,QB=KB,XB=QB(function(n,e,t){JB(n,e,t)}),YB=XB;const ZB=pi(YB);var Nu,e2=new Uint8Array(16);function t2(){if(!Nu&&(Nu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Nu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nu(e2)}const n2=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function r2(n){return typeof n=="string"&&n2.test(n)}var Tt=[];for(var xp=0;xp<256;++xp)Tt.push((xp+256).toString(16).substr(1));function i2(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Tt[n[e+0]]+Tt[n[e+1]]+Tt[n[e+2]]+Tt[n[e+3]]+"-"+Tt[n[e+4]]+Tt[n[e+5]]+"-"+Tt[n[e+6]]+Tt[n[e+7]]+"-"+Tt[n[e+8]]+Tt[n[e+9]]+"-"+Tt[n[e+10]]+Tt[n[e+11]]+Tt[n[e+12]]+Tt[n[e+13]]+Tt[n[e+14]]+Tt[n[e+15]]).toLowerCase();if(!r2(t))throw TypeError("Stringified UUID is invalid");return t}function ot(n,e,t){n=n||{};var r=n.random||(n.rng||t2)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return i2(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function q(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}var S0={};S0.byteLength=a2;var Si=S0.toByteArray=c2,dr=S0.fromByteArray=h2,Er=[],Mn=[],s2=typeof Uint8Array<"u"?Uint8Array:Array,Op="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var xo=0,o2=Op.length;xo<o2;++xo)Er[xo]=Op[xo],Mn[Op.charCodeAt(xo)]=xo;Mn["-".charCodeAt(0)]=62;Mn["_".charCodeAt(0)]=63;function tP(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function a2(n){var e=tP(n),t=e[0],r=e[1];return(t+r)*3/4-r}function l2(n,e,t){return(e+t)*3/4-t}function c2(n){var e,t=tP(n),r=t[0],i=t[1],s=new s2(l2(n,r,i)),o=0,a=i>0?r-4:r,l;for(l=0;l<a;l+=4)e=Mn[n.charCodeAt(l)]<<18|Mn[n.charCodeAt(l+1)]<<12|Mn[n.charCodeAt(l+2)]<<6|Mn[n.charCodeAt(l+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Mn[n.charCodeAt(l)]<<2|Mn[n.charCodeAt(l+1)]>>4,s[o++]=e&255),i===1&&(e=Mn[n.charCodeAt(l)]<<10|Mn[n.charCodeAt(l+1)]<<4|Mn[n.charCodeAt(l+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function u2(n){return Er[n>>18&63]+Er[n>>12&63]+Er[n>>6&63]+Er[n&63]}function d2(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(u2(r));return i.join("")}function h2(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(d2(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(Er[e>>2]+Er[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Er[e>>10]+Er[e>>4&63]+Er[e<<2&63]+"=")),i.join("")}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function f2(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const p2=(n,e)=>m2.from(n,e).buffer;function EC(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let m2=class Cs extends Uint8Array{toString(e){return f2(this,e)}static from(e,t,r){if(typeof e=="string")return Cs.fromString(e,t);if(e!==null&&typeof e=="object"&&EC(e.buffer))return q(e.byteOffset===0,0),q(e.byteLength===e.buffer.byteLength,1),Cs.fromArrayBuffer(e.buffer,t,r);if(EC(e))return Cs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Cs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Cs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Cs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};const g2="modulepreload",v2=function(n){return"/personal-whiteboard-app/"+n},_C={},nP=function(e,t,r){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=v2(s),s in _C)return;_C[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":g2,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const zt=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dl(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}var b0={exports:{}},ia=typeof Reflect=="object"?Reflect:null,TC=ia&&typeof ia.apply=="function"?ia.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},rd;ia&&typeof ia.ownKeys=="function"?rd=ia.ownKeys:Object.getOwnPropertySymbols?rd=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:rd=function(e){return Object.getOwnPropertyNames(e)};function y2(n){console&&console.warn&&console.warn(n)}var rP=Number.isNaN||function(e){return e!==e};function Le(){Le.init.call(this)}b0.exports=Le;b0.exports.once=C2;Le.EventEmitter=Le;Le.prototype._events=void 0;Le.prototype._eventsCount=0;Le.prototype._maxListeners=void 0;var xC=10;function Bh(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Le,"defaultMaxListeners",{enumerable:!0,get:function(){return xC},set:function(n){if(typeof n!="number"||n<0||rP(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");xC=n}});Le.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Le.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||rP(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function iP(n){return n._maxListeners===void 0?Le.defaultMaxListeners:n._maxListeners}Le.prototype.getMaxListeners=function(){return iP(this)};Le.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")TC(l,this,t);else for(var c=l.length,u=cP(l,c),r=0;r<c;++r)TC(u[r],this,t);return!0};function sP(n,e,t,r){var i,s,o;if(Bh(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=r?[t,o]:[o,t]:r?o.unshift(t):o.push(t),i=iP(n),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=e,a.count=o.length,y2(a)}return n}Le.prototype.addListener=function(e,t){return sP(this,e,t,!1)};Le.prototype.on=Le.prototype.addListener;Le.prototype.prependListener=function(e,t){return sP(this,e,t,!0)};function S2(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function oP(n,e,t){var r={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=S2.bind(r);return i.listener=t,r.wrapFn=i,i}Le.prototype.once=function(e,t){return Bh(t),this.on(e,oP(this,e,t)),this};Le.prototype.prependOnceListener=function(e,t){return Bh(t),this.prependListener(e,oP(this,e,t)),this};Le.prototype.removeListener=function(e,t){var r,i,s,o,a;if(Bh(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():b2(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Le.prototype.off=Le.prototype.removeListener;Le.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function aP(n,e,t){var r=n._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?w2(i):cP(i,i.length)}Le.prototype.listeners=function(e){return aP(this,e,!0)};Le.prototype.rawListeners=function(e){return aP(this,e,!1)};Le.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):lP.call(n,e)};Le.prototype.listenerCount=lP;function lP(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Le.prototype.eventNames=function(){return this._eventsCount>0?rd(this._events):[]};function cP(n,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=n[r];return t}function b2(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function w2(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function C2(n,e){return new Promise(function(t,r){function i(o){n.removeListener(e,s),r(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}uP(n,e,s,{once:!0}),e!=="error"&&E2(n,i,{once:!0})})}function E2(n,e,t){typeof n.on=="function"&&uP(n,"error",e,t)}function uP(n,e,t,r){if(typeof n.on=="function")r.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(s){r.once&&n.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var mn=b0.exports;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Uh=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Uc=class Es extends Uh{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(Es.removeListenerEvent,t),this.on(Es.newListenerEvent,r)}}static isEmitterEvent(e){return e===Es.newListenerEvent||e===Es.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!Es.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!Es.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};Uc.newListenerEvent="newListener";Uc.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let _2=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};function T2(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var x2=T2,O2=BO,P2=O2(Object.keys,Object),R2=P2,k2=m0,N2=R2,L2=Object.prototype,I2=L2.hasOwnProperty;function A2(n){if(!k2(n))return N2(n);var e=[];for(var t in Object(n))I2.call(n,t)&&t!="constructor"&&e.push(t);return e}var M2=A2,D2=YO,F2=M2,z2=qh;function $2(n){return z2(n)?D2(n):F2(n)}var w0=$2,j2=qc,q2=w0;function B2(n,e){return n&&j2(e,q2(e),n)}var U2=B2,H2=qc,V2=Bc;function W2(n,e){return n&&H2(e,V2(e),n)}var G2=W2;function K2(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var o=n[t];e(o,t,n)&&(s[i++]=o)}return s}var J2=K2;function Q2(){return[]}var dP=Q2,X2=J2,Y2=dP,Z2=Object.prototype,eU=Z2.propertyIsEnumerable,OC=Object.getOwnPropertySymbols,tU=OC?function(n){return n==null?[]:(n=Object(n),X2(OC(n),function(e){return eU.call(n,e)}))}:Y2,C0=tU,nU=qc,rU=C0;function iU(n,e){return nU(n,rU(n),e)}var sU=iU;function oU(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var hP=oU,aU=hP,lU=p0,cU=C0,uU=dP,dU=Object.getOwnPropertySymbols,hU=dU?function(n){for(var e=[];n;)aU(e,cU(n)),n=lU(n);return e}:uU,fP=hU,fU=qc,pU=fP;function mU(n,e){return fU(n,pU(n),e)}var gU=mU,vU=hP,yU=jh;function SU(n,e,t){var r=e(n);return yU(n)?r:vU(r,t(n))}var pP=SU,bU=pP,wU=C0,CU=w0;function EU(n){return bU(n,CU,wU)}var _U=EU,TU=pP,xU=fP,OU=Bc;function PU(n){return TU(n,OU,xU)}var RU=PU,kU=po,NU=Br,LU=kU(NU,"DataView"),IU=LU,AU=po,MU=Br,DU=AU(MU,"Promise"),FU=DU,zU=po,$U=Br,jU=zU($U,"Set"),qU=jU,BU=po,UU=Br,HU=BU(UU,"WeakMap"),VU=HU,Qg=IU,Xg=d0,Yg=FU,Zg=qU,ev=VU,mP=jc,ja=MO,PC="[object Map]",WU="[object Object]",RC="[object Promise]",kC="[object Set]",NC="[object WeakMap]",LC="[object DataView]",GU=ja(Qg),KU=ja(Xg),JU=ja(Yg),QU=ja(Zg),XU=ja(ev),_s=mP;(Qg&&_s(new Qg(new ArrayBuffer(1)))!=LC||Xg&&_s(new Xg)!=PC||Yg&&_s(Yg.resolve())!=RC||Zg&&_s(new Zg)!=kC||ev&&_s(new ev)!=NC)&&(_s=function(n){var e=mP(n),t=e==WU?n.constructor:void 0,r=t?ja(t):"";if(r)switch(r){case GU:return LC;case KU:return PC;case JU:return RC;case QU:return kC;case XU:return NC}return e});var E0=_s,YU=Object.prototype,ZU=YU.hasOwnProperty;function e3(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&ZU.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var t3=e3,n3=f0;function r3(n,e){var t=e?n3(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}var i3=r3,s3=/\w*$/;function o3(n){var e=new n.constructor(n.source,s3.exec(n));return e.lastIndex=n.lastIndex,e}var a3=o3,IC=c0,AC=IC?IC.prototype:void 0,MC=AC?AC.valueOf:void 0;function l3(n){return MC?Object(MC.call(n)):{}}var c3=l3,u3=f0,d3=i3,h3=a3,f3=c3,p3=jO,m3="[object Boolean]",g3="[object Date]",v3="[object Map]",y3="[object Number]",S3="[object RegExp]",b3="[object Set]",w3="[object String]",C3="[object Symbol]",E3="[object ArrayBuffer]",_3="[object DataView]",T3="[object Float32Array]",x3="[object Float64Array]",O3="[object Int8Array]",P3="[object Int16Array]",R3="[object Int32Array]",k3="[object Uint8Array]",N3="[object Uint8ClampedArray]",L3="[object Uint16Array]",I3="[object Uint32Array]";function A3(n,e,t){var r=n.constructor;switch(e){case E3:return u3(n);case m3:case g3:return new r(+n);case _3:return d3(n,t);case T3:case x3:case O3:case P3:case R3:case k3:case N3:case L3:case I3:return p3(n,t);case v3:return new r;case y3:case w3:return new r(n);case S3:return h3(n);case b3:return new r;case C3:return f3(n)}}var M3=A3,D3=E0,F3=mo,z3="[object Map]";function $3(n){return F3(n)&&D3(n)==z3}var j3=$3,q3=j3,B3=v0,DC=y0,FC=DC&&DC.isMap,U3=FC?B3(FC):q3,H3=U3,V3=E0,W3=mo,G3="[object Set]";function K3(n){return W3(n)&&V3(n)==G3}var J3=K3,Q3=J3,X3=v0,zC=y0,$C=zC&&zC.isSet,Y3=$C?X3($C):Q3,Z3=Y3,e4=DO,t4=x2,n4=QO,r4=U2,i4=G2,s4=$O,o4=qO,a4=sU,l4=gU,c4=_U,u4=RU,d4=E0,h4=t3,f4=M3,p4=UO,m4=jh,g4=g0,v4=H3,y4=fs,S4=Z3,b4=w0,w4=Bc,C4=1,E4=2,_4=4,gP="[object Arguments]",T4="[object Array]",x4="[object Boolean]",O4="[object Date]",P4="[object Error]",vP="[object Function]",R4="[object GeneratorFunction]",k4="[object Map]",N4="[object Number]",yP="[object Object]",L4="[object RegExp]",I4="[object Set]",A4="[object String]",M4="[object Symbol]",D4="[object WeakMap]",F4="[object ArrayBuffer]",z4="[object DataView]",$4="[object Float32Array]",j4="[object Float64Array]",q4="[object Int8Array]",B4="[object Int16Array]",U4="[object Int32Array]",H4="[object Uint8Array]",V4="[object Uint8ClampedArray]",W4="[object Uint16Array]",G4="[object Uint32Array]",Ae={};Ae[gP]=Ae[T4]=Ae[F4]=Ae[z4]=Ae[x4]=Ae[O4]=Ae[$4]=Ae[j4]=Ae[q4]=Ae[B4]=Ae[U4]=Ae[k4]=Ae[N4]=Ae[yP]=Ae[L4]=Ae[I4]=Ae[A4]=Ae[M4]=Ae[H4]=Ae[V4]=Ae[W4]=Ae[G4]=!0;Ae[P4]=Ae[vP]=Ae[D4]=!1;function id(n,e,t,r,i,s){var o,a=e&C4,l=e&E4,c=e&_4;if(t&&(o=i?t(n,r,i,s):t(n)),o!==void 0)return o;if(!y4(n))return n;var u=m4(n);if(u){if(o=h4(n),!a)return o4(n,o)}else{var d=d4(n),h=d==vP||d==R4;if(g4(n))return s4(n,a);if(d==yP||d==gP||h&&!i){if(o=l||h?{}:p4(n),!a)return l?l4(n,i4(o,n)):a4(n,r4(o,n))}else{if(!Ae[d])return i?n:{};o=f4(n,d,a)}}s||(s=new e4);var f=s.get(n);if(f)return f;s.set(n,o),S4(n)?n.forEach(function(S){o.add(id(S,e,t,S,n,s))}):v4(n)&&n.forEach(function(S,m){o.set(m,id(S,e,t,m,n,s))});var p=c?l?u4:c4:l?w4:b4,g=u?void 0:p(n);return t4(g||n,function(S,m){g&&(m=S,S=n[m]),n4(o,m,id(S,e,t,m,n,s))}),o}var K4=id,J4=K4,Q4=1,X4=4;function Y4(n){return J4(n,Q4|X4)}var Z4=Y4;const wa=pi(Z4);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let tv=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){q(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function nv(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function eH(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const gc=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let tH=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let nH=class{send(e){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let rH=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};var rv={exports:{}},Pp,jC;function iH(){if(jC)return Pp;jC=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;Pp=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return o(u);if(h==="number"&&isFinite(u))return d.long?l(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=r?c(u,d,r,"day"):d>=t?c(u,d,t,"hour"):d>=e?c(u,d,e,"minute"):d>=n?c(u,d,n,"second"):u+" ms"}function c(u,d,h,f){var p=d>=h*1.5;return Math.round(u/h)+" "+f+(p?"s":"")}return Pp}function sH(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=a,t.humanize=iH(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,f,p;function g(...S){if(!g.enabled)return;const m=g,v=Number(new Date),y=v-(d||v);m.diff=y,m.prev=d,m.curr=v,d=v,S[0]=t.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let b=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(_,E)=>{if(_==="%%")return"%";b++;const P=t.formatters[E];if(typeof P=="function"){const A=S[b];_=P.call(m,A),S.splice(b,1),b--}return _}),t.formatArgs.call(m,S),(m.log||t.log).apply(m,S)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==t.namespaces&&(f=t.namespaces,p=t.enabled(u)),p),set:S=>{h=S}}),typeof t.init=="function"&&t.init(g),g}function r(u,d){const h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];const d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const h of d)h[0]==="-"?t.skips.push(h.slice(1)):t.names.push(h)}function s(u,d){let h=0,f=0,p=-1,g=0;for(;h<u.length;)if(f<d.length&&(d[f]===u[h]||d[f]==="*"))d[f]==="*"?(p=f,g=h,f++):(h++,f++);else if(p!==-1)f=p+1,g++,h=g;else return!1;for(;f<d.length&&d[f]==="*";)f++;return f===d.length}function o(){const u=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),u}function a(u){for(const d of t.skips)if(s(u,d))return!1;for(const d of t.names)if(s(u,d))return!0;return!1}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var oH=sH;(function(n,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let u=0,d=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(u++,h==="%c"&&(d=u))}),l.splice(d,0,c)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function o(){try{return localStorage}catch{}}n.exports=oH(e);const{formatters:a}=n.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(rv,rv.exports);var iv=rv.exports;const SP=new rH(()=>lH(cH())),aH={getRawConfig:()=>{}},lH=n=>n!=null?new Hc({getRawConfig:e=>{var t,r;try{return(r=bP((t=n.getItem(e))!==null&&t!==void 0?t:void 0))===null||r===void 0?void 0:r.raw}catch{}}}):aH;function qC(n){switch(n){case"boolean":case"number":case"string":return!0;default:return!1}}function bP(n){let e=n,t;if(typeof n=="string")try{e=JSON.parse(n),t={raw:n,string:n}}catch{}if(e===void 0)return t;const r=typeof e;if(qC(r))return Object.assign(Object.assign({},t),{raw:n,[r]:e});if(Array.isArray(e)){const i=typeof e[0];if(!qC(i))return t;for(const s of e)if(typeof s!==i)return t;return Object.assign(Object.assign({},t),{raw:n,[`${i}[]`]:e})}return t}const cH=()=>{try{return sessionStorage!==null?sessionStorage:void 0}catch{return}};class Hc{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,r=[...e];for(;r.length>0;){const i=r.shift();i!==void 0&&wP(i)&&!t.has(i)&&(t.add(i),i instanceof Hc?r.push(...i.orderedBaseProviders):this.orderedBaseProviders.push(i))}}getBoolean(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.boolean}getNumber(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.number}getString(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.string}getBooleanArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["boolean[]"]}getNumberArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["number[]"]}getStringArray(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t["string[]"]}getRawConfig(e){var t;return(t=this.getCacheEntry(e))===null||t===void 0?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const r=bP(t==null?void 0:t.getRawConfig(e));if(r!==void 0)return this.configCache.set(e,r),r}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function _0(n){const e=n;return wP(e==null?void 0:e.config)&&(e==null?void 0:e.logger)!==void 0}function qa(n){return _0(n)?n:T0(n,SP.value)}function T0(n,...e){if(_0(n))throw new Error("Logger is already a monitoring context");const t=n;return t.config=new Hc(...e),t.logger=n,t}function wP(n){const e=n;return typeof(e==null?void 0:e.getRawConfig)=="function"}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const CP=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function"&&typeof(n==null?void 0:n.addTelemetryProperties)=="function",EP=n=>typeof(n==null?void 0:n.errorInstanceId)=="string";function _P(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&EP(n)&&CP(n)}function TP(n){return typeof(n==null?void 0:n.errorType)=="string"&&typeof(n==null?void 0:n.message)=="string"&&CP(n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const uH=n=>n!==null&&!Array.isArray(n)&&typeof n=="object";function x0(n,e){const t=(s,o)=>{if(!e)return s;const a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(uH(n)){const{errorType:s,stack:o,name:a}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const l=typeof a=="string"?a:void 0;i.stack=t(o,l)}}return i}const O0=n=>typeof(n==null?void 0:n.getTelemetryProperties)=="function";function dH(n,e){for(const t of Object.keys(e))n[t]===void 0&&(n[t]=e[t])}function hH(n){const e=n;e.errorInstanceId===void 0&&(e.errorInstanceId=ot())}function lr(n,e={}){var t;if(TP(n)&&hH(n),_P(n))return n.addTelemetryProperties((t=e.props)!==null&&t!==void 0?t:{}),n;const{message:r,stack:i}=x0(n,!1),s=new Vc({message:r,stack:i});if(typeof n=="object"&&n!==null){const{canRetry:a,retryAfterSeconds:l}=n;Object.assign(lr,{canRetry:a,retryAfterSeconds:l})}typeof n!="object"&&s.addTelemetryProperties({typeofError:typeof n});const o=O0(n)?n.getTelemetryProperties():{};return s.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},o),e.props),{untrustedOrigin:1})),s}let Rp;function Hh(){const n=new Error("<<generated stack>>");if(Rp===void 0&&(Rp=n.stack!==void 0),Rp)return n;try{throw n}catch(e){return e}}function fH(){return Hh().stack}function Vh(n,e){const{message:t,stack:r}=x0(n,!1),i=e(t);return r!==void 0&&OP(i,r),PP(n)&&i.addTelemetryProperties({untrustedOrigin:1}),EP(n)&&(i.overwriteErrorInstanceId(n.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:n.errorInstanceId})),O0(n)&&i.addTelemetryProperties(n.getTelemetryProperties()),i}function xP(n,e,t){const r=Vh(n,e),i=r.errorInstanceId,s=i;return t.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:s},n),r}function OP(n,e){try{Object.assign(n,{stack:e})}catch{n.addTelemetryProperties({stack2:e})}}function PP(n){return!TP(n)||n.getTelemetryProperties().untrustedOrigin===1&&n.errorType===Vc.normalizedErrorType}function pH(n){return typeof(n==null?void 0:n.value)!="object"&&typeof(n==null?void 0:n.tag)=="string"}function mH(n,e){const t={};for(const r of Object.keys(n)){if(e.has(r))continue;const i=n[r];switch(typeof i){case"string":case"number":case"boolean":case"undefined":t[r]=i;break;default:{pH(i)?t[r]=i:t[r]="REDACTED (arbitrary object)";break}}}return t}const gH=()=>{const n=new WeakSet;return(e,t)=>{if(typeof t=="object"&&t!==null){if(n.has(t))return"<removed/circular>";n.add(t)}return t}};class ue extends Error{constructor(e,t,r=new Set){super(e),this.omitPropsFromLogging=r,this._errorInstanceId=ot(),this.fluidErrorCode="-",r.add("omitPropsFromLogging"),r.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){dH(this,e)}getTelemetryProperties(){const e=mH(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class Vc extends ue{constructor(e){super(e.message),this.errorType=Vc.normalizedErrorType,e.stack!==void 0&&OP(this,e.stack)}}Vc.normalizedErrorType="genericError";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var De;(function(n){n.PackageData="PackageData",n.CodeArtifact="CodeArtifact",n.UserData="UserData"})(De||(De={}));class Qe{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(e==null)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,r){const{message:i,errorType:s,stack:o}=x0(t,!0);if(e.stack=o,e.error=i,e.errorType=s,O0(t)){const a=t.getTelemetryProperties();for(const l of Object.keys(a))e[l]===void 0&&(e[l]=a[l])}e.stack===void 0&&r&&(e.stack=fH())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=Object.assign({},e);t!==void 0&&Qe.prepareErrorObject(r,t,!1),typeof r.duration=="number"&&(r.duration=Qe.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const i=Object.assign(Object.assign({},e),{category:(r=e.category)!==null&&r!==void 0?r:"performance"});this.sendTelemetryEventCore(i,t)}prepareEvent(e){const t=e.category==="error"||e.error!==void 0,r=Object.assign({},e);if(this.namespace!==void 0&&(r.eventName=`${this.namespace}${Qe.eventNamespaceSeparator}${r.eventName}`),this.properties){const i=[];i.push(this.properties.all),t&&i.push(this.properties.error);for(const s of i)if(s!==void 0)for(const o of Object.keys(s)){if(e[o]!==void 0)continue;const a=s[o],l=typeof a=="function"?a():a;l!==void 0&&(r[o]=l)}}return r}}Qe.eventNamespaceSeparator=":";class vH{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const r of Object.keys(e)){const i=e[r],{value:s,tag:o}=typeof i=="object"?i:{value:i,tag:void 0};switch(o){case void 0:t[r]=s;break;case De.PackageData:t[r]=s;break;case De.UserData:t[r]="REDACTED (UserData)";break;default:t[r]="REDACTED (unknown tag)";break}}this.logger.send(t)}}class pe extends Qe{constructor(e,t,r){super(t,r),this.baseLogger=e,_0(e)&&T0(this,new Hc(e.config))}static create(e,t,r){if(e instanceof pe){const i={};for(const o of[e.properties,r])o!==void 0&&(o.all!==void 0&&(i.all=Object.assign(Object.assign({},i.all),o.all)),o.error!==void 0&&(i.error=Object.assign(Object.assign({},i.error),o.error)));const s=e.namespace===void 0?t:t===void 0?e.namespace:`${e.namespace}${Qe.eventNamespaceSeparator}${t}`;return new pe(e.baseLogger,s,i)}return new pe(e||new nH,t,r)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class yH extends Qe{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){e!=null&&this.loggers.push(e)}send(e){const t=this.prepareEvent(e);this.loggers.forEach(r=>{r.send(t)})}}class he{constructor(e,t,r={end:!0,cancel:"generic"}){this.logger=e,this.markers=r,this.startTime=gc.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),typeof window=="object"&&window!=null&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,r){return new he(e,t,r)}static timedExec(e,t,r,i){const s=he.start(e,t,i);try{const o=r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}static async timedExecAsync(e,t,r,i){const s=he.start(e,t,i);try{const o=await r(s);return s.autoEnd(),o}catch(o){throw s.cancel(void 0,o),o}}get duration(){return gc.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){this.markers.cancel!==void 0&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,r){if(!this.event)return;const i=Object.assign(Object.assign({},this.event),t);i.eventName=`${i.eventName}_${e}`,e!=="start"&&(i.duration=this.duration),this.logger.sendPerformanceEvent(i,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zl extends Qe{constructor(e,t,r){super(void 0,r),this.debug=e,this.debugErr=t}static create(e,t){const r=iv.debug(e),i=iv.debug(e);return i.log=console.error.bind(console),i.enabled=!0,new zl(r,i,t)}static mixinDebugLogger(e,t,r){if(!t)return zl.create(e,r);const i=new yH(void 0,r);return i.addLogger(zl.create(e,this.tryGetBaseLoggerProps(t))),i.addLogger(pe.create(t,e)),i}static tryGetBaseLoggerProps(e){if(e instanceof Qe)return e.properties}send(e){const t=this.prepareEvent(e),r=t.category==="error";let i=r?this.debugErr:this.debug;const s=e.eventName.lastIndexOf(Qe.eventNamespaceSeparator),o=e.eventName.substring(s+1);s>0&&(i=i.extend(e.eventName.substring(0,s))),t.eventName=void 0;let a="";a=`tick=${Qe.formatTick(gc.now())}`;const l=t.stack?t.stack:"";t.stack=void 0;let c;try{c=JSON.stringify(t)}catch{t.error=void 0,c=JSON.stringify(t)}c==="{}"&&(c=""),r&&(i.enabled=!0),i(`${o} ${c} ${a} ${l}`)}}class P0 extends tH{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(r){return this.errorHandler(e,r),!0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const RP="connected",kP="disconnected";function SH(n,e,t,...r){try{n.emit(t,...r)}catch(i){e.sendErrorEvent({eventName:"RaiseEventError",event:t},i)}}function R0(n,e,t,r){try{t?e.emit(RP,r):e.emit(kP)}catch(i){n.sendErrorEvent({eventName:"RaiseConnectedEventError"},i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class NP{constructor(e,t,r=e){this.threshold=e,this.logger=t,this.thresholdMultiple=r}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=this.thresholdMultiple*2)}}function bH(n,e,t){if(n)return!0;const r=typeof t=="string"?{eventName:t,category:"error"}:Object.assign({category:"error"},t);return e.send(r),!1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class BC{constructor(e,t,r,i=!1,s=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=r,this.includeAggregateMetrics=i,this.perBucketProperties=s,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var r,i,s;const o=gc.now(),a=e(),l=gc.now()-o;let c=this.measurementsMap.get(t);return c===void 0&&(c={count:0,duration:-1},this.measurementsMap.set(t,c)),c.count++,c.duration=l,this.includeAggregateMetrics&&(c.totalDuration=((r=c.totalDuration)!==null&&r!==void 0?r:0)+l,c.minDuration=Math.min((i=c.minDuration)!==null&&i!==void 0?i:l,l),c.maxDuration=Math.max((s=c.maxDuration)!==null&&s!==void 0?s:0,l)),c.count>=this.sampleThreshold&&this.flushBucket(t),a}flushBucket(e){const t=this.measurementsMap.get(e);if(t!==void 0&&t.count!==0){const r=this.perBucketProperties.get(e),i=Object.assign(Object.assign(Object.assign({},this.eventBase),r),t);this.logger.sendPerformanceEvent(i),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach((t,r)=>this.flushBucket(r))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ti extends ue{constructor(e,t,r){super(e,r,new Set(["error"])),this.error=t,this.errorType=as.genericError}}class k0 extends ue{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=as.throttlingError}static wrap(e,t,r){return xP(e,s=>new k0(s,t),r)}}class Te extends ue{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class wH extends ue{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=as.clientSessionExpiredError}}class Rr extends ue{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=as.dataCorruptionError,this.canRetry=!1}}class Nn extends ue{constructor(e){super(e),this.errorType=as.dataProcessingError,this.canRetry=!1}static create(e,t,r,i={}){const s=Nn.wrapIfUnrecognized(e,t,r);return s.addTelemetryProperties(i),s}static wrapIfUnrecognized(e,t,r){const i=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},r===void 0?void 0:ro(r)),s=lr(e,{props:i});if(!PP(s))return s;const o=Vh(s,a=>new Nn(a));return o.addTelemetryProperties(s.getTelemetryProperties()),o}}const ro=n=>({messageClientId:n.clientId,messageSequenceNumber:n.sequenceNumber,messageClientSequenceNumber:n.clientSequenceNumber,messageReferenceSequenceNumber:n.referenceSequenceNumber,messageMinimumSequenceNumber:n.minimumSequenceNumber,messageTimestamp:n.timestamp});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class N0{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return(e=this._policies)!==null&&e!==void 0?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.internalStorageService.getSnapshotTree(e,t)}async getVersions(e,t,r){return this.internalStorageService.getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.internalStorageService.downloadSummary(e)}async createBlob(e){return this.internalStorageService.createBlob(e)}async readBlob(e){return this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class CH extends N0{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}async readBlob(e){const t=this.blobs.get(e);return t!==void 0?t:this.internalStorageService.readBlob(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gs;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Gs||(Gs={}));var UC;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(UC||(UC={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gd;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Gd||(Gd={}));var $l;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})($l||($l={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var qs;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(qs||(qs={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ne(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function EH(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const _H=(n,e)=>L0.from(n,e).buffer,TH=(n,e)=>L0.from(n).toString(e);function HC(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let L0=class Ts extends Uint8Array{toString(e){return EH(this,e)}static from(e,t,r){if(typeof e=="string")return Ts.fromString(e,t);if(e!==null&&typeof e=="object"&&HC(e.buffer))return Ne(e.byteOffset===0,0),Ne(e.byteLength===e.buffer.byteLength,1),Ts.fromArrayBuffer(e.buffer,t,r);if(HC(e))return Ts.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ts(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Ts(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ts(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Di=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let LP=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const xH=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fi;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Fi||(Fi={}));var VC;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(VC||(VC={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var io;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(io||(io={}));var vc;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(vc||(vc={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var _r;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(_r||(_r={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function sv(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let I0=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function IP(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function OH(n){const e=n.type===_r.Handle?n.handleType:n.type;switch(e){case _r.Blob:case _r.Attachment:return io.File;case _r.Tree:return io.Directory;default:IP(e,`Unknown type: ${e}`)}}function AP(n){const e=n.type===_r.Handle?n.handleType:n.type;switch(e){case _r.Blob:case _r.Attachment:return"blob";case _r.Tree:return"tree";default:IP(e,`Unknown type: ${e}`)}}function A0(n,e=new Map,t=!1){const r={},i={id:n.sha,blobs:{},trees:{}};r[""]=i;for(const s of n.tree){const o=t?s.path.replace(/^\.app\//,""):s.path,a=o.lastIndexOf("/"),l=o.slice(0,Math.max(0,a)),c=o.slice(a+1),u=r[l];if(s.type==="tree"){const d={id:s.sha,blobs:{},commits:{},trees:{}};u.trees[decodeURIComponent(c)]=d,r[o]=d}else if(s.type==="blob")u.blobs[decodeURIComponent(c)]=s.sha,e.set(s.sha,`/${o}`);else throw new Error("Unknown entry type!!")}return i}class MP{constructor(e,t,r="utf-8"){this.path=e,this.mode=io.File,this.type=vc.Blob,this.value={contents:t,encoding:r}}}class PH{constructor(e,t){this.path=e,this.value=t,this.mode=io.Directory,this.type=vc.Tree}}class RH{constructor(e,t){this.path=e,this.id=t,this.mode=io.File,this.type=vc.Attachment,this.value={id:t}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class WC{constructor(e,t,r,i){this.sequenceNumber=e,this.key=t,this.value=r,this.local=i}}class kH extends I0{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return(e=this.snapshotCache)!==null&&e!==void 0||(this.snapshotCache=wa(Array.from(this.members))),this.snapshotCache}addMember(e,t){sv(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){sv(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class NH extends I0{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new mn.EventEmitter,this.proposals=new Map(e.proposals.map(([,r])=>[r.sequenceNumber,new WC(r.sequenceNumber,r.key,r.value,!1)])),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return(e=this.proposalsSnapshotCache)!==null&&e!==void 0||(this.proposalsSnapshotCache=Array.from(this.proposals).map(([r,i])=>[r,{sequenceNumber:r,key:i.key,value:i.value},[]])),(t=this.valuesSnapshotCache)!==null&&t!==void 0||(this.valuesSnapshotCache=wa(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return(t=this.values.get(e))===null||t===void 0?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?wa(t):void 0}async propose(e,t){const r=this.sendProposal(e,t);if(r<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise((i,s)=>{let o;const a=(h,f)=>{h===r&&(o=f,this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("disconnected",c),this.stateEvents.on("localProposalApproved",l))},l=h=>{h===o&&(i(),d())},c=()=>{o===void 0&&this.stateEvents.once("connected",()=>{o===void 0&&(s(new Error("Client disconnected without successfully sending proposal")),d())})},u=()=>{s(new Error("QuorumProposals was disposed")),d()},d=()=>{this.stateEvents.off("localProposalSequenced",a),this.stateEvents.off("localProposalApproved",l),this.stateEvents.off("disconnected",c),this.stateEvents.off("disposed",u)};this.stateEvents.on("localProposalSequenced",a),this.stateEvents.on("disconnected",c),this.stateEvents.on("disposed",u)})}addProposal(e,t,r,i,s){sv(!this.proposals.has(r),464);const o=new WC(r,e,t,i);this.proposals.set(r,o),this.emit("addProposal",o),i&&this.stateEvents.emit("localProposalSequenced",s,r),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,r=[];for(const[i,s]of this.proposals)i<=t&&r.push(s);r.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);for(const i of r){const s={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:i.key,sequenceNumber:i.sequenceNumber,value:i.value};this.values.set(s.key,s),this.valuesSnapshotCache=void 0,this.emit("approveProposal",s.sequenceNumber,s.key,s.value,s.approvalSequenceNumber),this.proposals.delete(i.sequenceNumber),this.proposalsSnapshotCache=void 0,i.local&&this.stateEvents.emit("localProposalApproved",i.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class LH extends I0{constructor(e,t,r,i){super(),this.isDisposed=!1,this.quorumClients=new kH(e),this.quorumClients.on("addMember",(s,o)=>{this.emit("addMember",s,o)}),this.quorumClients.on("removeMember",s=>{this.emit("removeMember",s)}),this.quorumProposals=new NH({proposals:t,values:r},i),this.quorumProposals.on("addProposal",s=>{this.emit("addProposal",s)}),this.quorumProposals.on("approveProposal",(s,o,a,l)=>{this.emit("approveProposal",s,o,a,l)})}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:r}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:r}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}async propose(e,t){return this.quorumProposals.propose(e,t)}addProposal(e,t,r,i,s){return this.quorumProposals.addProposal(e,t,r,i,s)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class IH{constructor(e,t,r,i,s,o,a){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=r??1,this._quorum=new LH(i,s,o,a)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let r=!1;switch(e.type){case Fi.ClientJoin:const i=e,s=JSON.parse(i.data),o={client:s.detail,sequenceNumber:i.sequenceNumber};this._quorum.addMember(s.clientId,o);break;case Fi.ClientLeave:const l=JSON.parse(e.data);this._quorum.removeMember(l);break;case Fi.Propose:const c=e.contents;this._quorum.addProposal(c.key,c.value,e.sequenceNumber,t,e.clientSequenceNumber),r=!0;break;case Fi.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:r}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}class AH extends IH{processMessage(e,t){const r=this._quorum.getMember(e.clientId);if(e.clientId!=null){if(r===void 0&&e.type!==Fi.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if((r==null?void 0:r.shouldHaveLeft)===!0&&e.type!==Fi.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function DP(n,e,t){const r=[];for(const i of e){const s=`${n}${i.path}`;if(i.type===$l.Blob){const o=i.value,a=_H(o.contents,o.encoding),l=ot();t.set(l,a);const c={mode:Gd[i.mode],path:s,sha:l,size:0,type:"blob",url:""};r.push(c)}else if(i.type===$l.Tree){Ne(i.type===$l.Tree,257);const o=i.value,a={mode:Gd[i.mode],path:s,sha:"",size:-1,type:"tree",url:""};r.push(a);const l=DP(`${s}/`,o.entries,t);r.push(...l)}}return r}function MH(n,e){return{sha:"",tree:DP("",n,e),url:""}}function FP(n,e){const t=MH(n,e);return A0(t)}var Kd={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Kd.exports;(function(n,e){(function(t){var r=e&&!e.nodeType&&e,i=n&&!n.nodeType&&n,s=typeof globalThis=="object"&&globalThis;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,c=1,u=26,d=38,h=700,f=72,p=128,g="-",S=/^xn--/,m=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=l-c,w=Math.floor,_=String.fromCharCode,E;function P(x){throw new RangeError(y[x])}function A(x,j){for(var Y=x.length,ye=[];Y--;)ye[Y]=j(x[Y]);return ye}function F(x,j){var Y=x.split("@"),ye="";Y.length>1&&(ye=Y[0]+"@",x=Y[1]),x=x.replace(v,".");var re=x.split("."),T=A(re,j).join(".");return ye+T}function X(x){for(var j=[],Y=0,ye=x.length,re,T;Y<ye;)re=x.charCodeAt(Y++),re>=55296&&re<=56319&&Y<ye?(T=x.charCodeAt(Y++),(T&64512)==56320?j.push(((re&1023)<<10)+(T&1023)+65536):(j.push(re),Y--)):j.push(re);return j}function z(x){return A(x,function(j){var Y="";return j>65535&&(j-=65536,Y+=_(j>>>10&1023|55296),j=56320|j&1023),Y+=_(j),Y}).join("")}function ee(x){return x-48<10?x-22:x-65<26?x-65:x-97<26?x-97:l}function W(x,j){return x+22+75*(x<26)-((j!=0)<<5)}function C(x,j,Y){var ye=0;for(x=Y?w(x/h):x>>1,x+=w(x/j);x>b*u>>1;ye+=l)x=w(x/b);return w(ye+(b+1)*x/(x+d))}function L(x){var j=[],Y=x.length,ye,re=0,T=p,N=f,D,G,se,ae,_e,lt,Et,sn,gn;for(D=x.lastIndexOf(g),D<0&&(D=0),G=0;G<D;++G)x.charCodeAt(G)>=128&&P("not-basic"),j.push(x.charCodeAt(G));for(se=D>0?D+1:0;se<Y;){for(ae=re,_e=1,lt=l;se>=Y&&P("invalid-input"),Et=ee(x.charCodeAt(se++)),(Et>=l||Et>w((a-re)/_e))&&P("overflow"),re+=Et*_e,sn=lt<=N?c:lt>=N+u?u:lt-N,!(Et<sn);lt+=l)gn=l-sn,_e>w(a/gn)&&P("overflow"),_e*=gn;ye=j.length+1,N=C(re-ae,ye,ae==0),w(re/ye)>a-T&&P("overflow"),T+=w(re/ye),re%=ye,j.splice(re++,0,T)}return z(j)}function H(x){var j,Y,ye,re,T,N,D,G,se,ae,_e,lt=[],Et,sn,gn,Za;for(x=X(x),Et=x.length,j=p,Y=0,T=f,N=0;N<Et;++N)_e=x[N],_e<128&&lt.push(_(_e));for(ye=re=lt.length,re&&lt.push(g);ye<Et;){for(D=a,N=0;N<Et;++N)_e=x[N],_e>=j&&_e<D&&(D=_e);for(sn=ye+1,D-j>w((a-Y)/sn)&&P("overflow"),Y+=(D-j)*sn,j=D,N=0;N<Et;++N)if(_e=x[N],_e<j&&++Y>a&&P("overflow"),_e==j){for(G=Y,se=l;ae=se<=T?c:se>=T+u?u:se-T,!(G<ae);se+=l)Za=G-ae,gn=l-ae,lt.push(_(W(ae+Za%gn,0))),G=w(Za/gn);lt.push(_(W(G,0))),T=C(Y,sn,ye==re),Y=0,++ye}++Y,++j}return lt.join("")}function I(x){return F(x,function(j){return S.test(j)?L(j.slice(4).toLowerCase()):j})}function B(x){return F(x,function(j){return m.test(j)?"xn--"+H(j):j})}if(o={version:"1.4.1",ucs2:{decode:X,encode:z},decode:L,encode:H,toASCII:B,toUnicode:I},r&&i)if(n.exports==r)i.exports=o;else for(E in o)o.hasOwnProperty(E)&&(r[E]=o[E]);else t.punycode=o})(K)})(Kd,Kd.exports);var DH=Kd.exports,Ba=TypeError;const FH={},zH=Object.freeze(Object.defineProperty({__proto__:null,default:FH},Symbol.toStringTag,{value:"Module"})),$H=Lc(zH);var M0=typeof Map=="function"&&Map.prototype,kp=Object.getOwnPropertyDescriptor&&M0?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Jd=M0&&kp&&typeof kp.get=="function"?kp.get:null,GC=M0&&Map.prototype.forEach,D0=typeof Set=="function"&&Set.prototype,Np=Object.getOwnPropertyDescriptor&&D0?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Qd=D0&&Np&&typeof Np.get=="function"?Np.get:null,KC=D0&&Set.prototype.forEach,jH=typeof WeakMap=="function"&&WeakMap.prototype,jl=jH?WeakMap.prototype.has:null,qH=typeof WeakSet=="function"&&WeakSet.prototype,ql=qH?WeakSet.prototype.has:null,BH=typeof WeakRef=="function"&&WeakRef.prototype,JC=BH?WeakRef.prototype.deref:null,UH=Boolean.prototype.valueOf,HH=Object.prototype.toString,VH=Function.prototype.toString,WH=String.prototype.match,F0=String.prototype.slice,zi=String.prototype.replace,GH=String.prototype.toUpperCase,QC=String.prototype.toLowerCase,zP=RegExp.prototype.test,XC=Array.prototype.concat,br=Array.prototype.join,KH=Array.prototype.slice,YC=Math.floor,ov=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Lp=Object.getOwnPropertySymbols,av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ca=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Bl=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ca||"symbol")?Symbol.toStringTag:null,$P=Object.prototype.propertyIsEnumerable,ZC=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function eE(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||zP.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var r=n<0?-YC(-n):YC(n);if(r!==n){var i=String(r),s=F0.call(e,i.length+1);return zi.call(i,t,"$&_")+"."+zi.call(zi.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return zi.call(e,t,"$&_")}var lv=$H,tE=lv.custom,nE=BP(tE)?tE:null,jP={__proto__:null,double:'"',single:"'"},JH={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Wh=function n(e,t,r,i){var s=t||{};if(Kr(s,"quoteStyle")&&!Kr(jP,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Kr(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Kr(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Kr(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Kr(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return HP(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return a?eE(e,l):l}if(typeof e=="bigint"){var c=String(e)+"n";return a?eE(e,c):c}var u=typeof s.depth>"u"?5:s.depth;if(typeof r>"u"&&(r=0),r>=u&&u>0&&typeof e=="object")return cv(e)?"[Array]":"[Object]";var d=f6(s,r);if(typeof i>"u")i=[];else if(UP(i,e)>=0)return"[Circular]";function h(ee,W,C){if(W&&(i=KH.call(i),i.push(W)),C){var L={depth:s.depth};return Kr(s,"quoteStyle")&&(L.quoteStyle=s.quoteStyle),n(ee,L,r+1,i)}return n(ee,s,r+1,i)}if(typeof e=="function"&&!rE(e)){var f=i6(e),p=Lu(e,h);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+br.call(p,", ")+" }":"")}if(BP(e)){var g=Ca?zi.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):av.call(e);return typeof e=="object"&&!Ca?hl(g):g}if(u6(e)){for(var S="<"+QC.call(String(e.nodeName)),m=e.attributes||[],v=0;v<m.length;v++)S+=" "+m[v].name+"="+qP(QH(m[v].value),"double",s);return S+=">",e.childNodes&&e.childNodes.length&&(S+="..."),S+="</"+QC.call(String(e.nodeName))+">",S}if(cv(e)){if(e.length===0)return"[]";var y=Lu(e,h);return d&&!h6(y)?"["+uv(y,d)+"]":"[ "+br.call(y,", ")+" ]"}if(YH(e)){var b=Lu(e,h);return!("cause"in Error.prototype)&&"cause"in e&&!$P.call(e,"cause")?"{ ["+String(e)+"] "+br.call(XC.call("[cause]: "+h(e.cause),b),", ")+" }":b.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+br.call(b,", ")+" }"}if(typeof e=="object"&&o){if(nE&&typeof e[nE]=="function"&&lv)return lv(e,{depth:u-r});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(s6(e)){var w=[];return GC&&GC.call(e,function(ee,W){w.push(h(W,e,!0)+" => "+h(ee,e))}),iE("Map",Jd.call(e),w,d)}if(l6(e)){var _=[];return KC&&KC.call(e,function(ee){_.push(h(ee,e))}),iE("Set",Qd.call(e),_,d)}if(o6(e))return Ip("WeakMap");if(c6(e))return Ip("WeakSet");if(a6(e))return Ip("WeakRef");if(e6(e))return hl(h(Number(e)));if(n6(e))return hl(h(ov.call(e)));if(t6(e))return hl(UH.call(e));if(ZH(e))return hl(h(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof globalThis<"u"&&e===globalThis)return"{ [object globalThis] }";if(!XH(e)&&!rE(e)){var E=Lu(e,h),P=ZC?ZC(e)===Object.prototype:e instanceof Object||e.constructor===Object,A=e instanceof Object?"":"null prototype",F=!P&&Bl&&Object(e)===e&&Bl in e?F0.call(ps(e),8,-1):A?"Object":"",X=P||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",z=X+(F||A?"["+br.call(XC.call([],F||[],A||[]),": ")+"] ":"");return E.length===0?z+"{}":d?z+"{"+uv(E,d)+"}":z+"{ "+br.call(E,", ")+" }"}return String(e)};function qP(n,e,t){var r=t.quoteStyle||e,i=jP[r];return i+n+i}function QH(n){return zi.call(String(n),/"/g,"&quot;")}function go(n){return!Bl||!(typeof n=="object"&&(Bl in n||typeof n[Bl]<"u"))}function cv(n){return ps(n)==="[object Array]"&&go(n)}function XH(n){return ps(n)==="[object Date]"&&go(n)}function rE(n){return ps(n)==="[object RegExp]"&&go(n)}function YH(n){return ps(n)==="[object Error]"&&go(n)}function ZH(n){return ps(n)==="[object String]"&&go(n)}function e6(n){return ps(n)==="[object Number]"&&go(n)}function t6(n){return ps(n)==="[object Boolean]"&&go(n)}function BP(n){if(Ca)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!av)return!1;try{return av.call(n),!0}catch{}return!1}function n6(n){if(!n||typeof n!="object"||!ov)return!1;try{return ov.call(n),!0}catch{}return!1}var r6=Object.prototype.hasOwnProperty||function(n){return n in this};function Kr(n,e){return r6.call(n,e)}function ps(n){return HH.call(n)}function i6(n){if(n.name)return n.name;var e=WH.call(VH.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function UP(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,r=n.length;t<r;t++)if(n[t]===e)return t;return-1}function s6(n){if(!Jd||!n||typeof n!="object")return!1;try{Jd.call(n);try{Qd.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function o6(n){if(!jl||!n||typeof n!="object")return!1;try{jl.call(n,jl);try{ql.call(n,ql)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function a6(n){if(!JC||!n||typeof n!="object")return!1;try{return JC.call(n),!0}catch{}return!1}function l6(n){if(!Qd||!n||typeof n!="object")return!1;try{Qd.call(n);try{Jd.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function c6(n){if(!ql||!n||typeof n!="object")return!1;try{ql.call(n,ql);try{jl.call(n,jl)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function u6(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function HP(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,r="... "+t+" more character"+(t>1?"s":"");return HP(F0.call(n,0,e.maxStringLength),e)+r}var i=JH[e.quoteStyle||"single"];i.lastIndex=0;var s=zi.call(zi.call(n,i,"\\$1"),/[\x00-\x1f]/g,d6);return qP(s,"single",e)}function d6(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+GH.call(e.toString(16))}function hl(n){return"Object("+n+")"}function Ip(n){return n+" { ? }"}function iE(n,e,t,r){var i=r?uv(t,r):br.call(t,", ");return n+" ("+e+") {"+i+"}"}function h6(n){for(var e=0;e<n.length;e++)if(UP(n[e],`
`)>=0)return!1;return!0}function f6(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=br.call(Array(n.indent+1)," ");else return null;return{base:t,prev:br.call(Array(e+1),t)}}function uv(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+br.call(n,","+t)+`
`+e.prev}function Lu(n,e){var t=cv(n),r=[];if(t){r.length=n.length;for(var i=0;i<n.length;i++)r[i]=Kr(n,i)?e(n[i],n):""}var s=typeof Lp=="function"?Lp(n):[],o;if(Ca){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in n)Kr(n,l)&&(t&&String(Number(l))===l&&l<n.length||Ca&&o["$"+l]instanceof Symbol||(zP.call(/[^\w$]/,l)?r.push(e(l,n)+": "+e(n[l],n)):r.push(l+": "+e(n[l],n))));if(typeof Lp=="function")for(var c=0;c<s.length;c++)$P.call(n,s[c])&&r.push("["+e(s[c])+"]: "+e(n[s[c]],n));return r}var p6=Wh,m6=Ba,Gh=function(n,e,t){for(var r=n,i;(i=r.next)!=null;r=i)if(i.key===e)return r.next=i.next,t||(i.next=n.next,n.next=i),i},g6=function(n,e){if(n){var t=Gh(n,e);return t&&t.value}},v6=function(n,e,t){var r=Gh(n,e);r?r.value=t:n.next={key:e,next:n.next,value:t}},y6=function(n,e){return n?!!Gh(n,e):!1},S6=function(n,e){if(n)return Gh(n,e,!0)},b6=function(){var e,t={assert:function(r){if(!t.has(r))throw new m6("Side channel does not contain "+p6(r))},delete:function(r){var i=e&&e.next,s=S6(e,r);return s&&i&&i===s&&(e=void 0),!!s},get:function(r){return g6(e,r)},has:function(r){return y6(e,r)},set:function(r,i){e||(e={next:void 0}),v6(e,r,i)}};return t},VP=Object,w6=Error,C6=EvalError,E6=RangeError,_6=ReferenceError,T6=SyntaxError,x6=URIError,O6=Math.abs,P6=Math.floor,R6=Math.max,k6=Math.min,N6=Math.pow,L6=Math.round,I6=Number.isNaN||function(e){return e!==e},A6=I6,M6=function(e){return A6(e)||e===0?e:e<0?-1:1},D6=Object.getOwnPropertyDescriptor,sd=D6;if(sd)try{sd([],"length")}catch{sd=null}var WP=sd,od=Object.defineProperty||!1;if(od)try{od({},"a",{value:1})}catch{od=!1}var F6=od,Ap,sE;function z6(){return sE||(sE=1,Ap=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Ap}var Mp,oE;function $6(){if(oE)return Mp;oE=1;var n=typeof Symbol<"u"&&Symbol,e=z6();return Mp=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Mp}var Dp,aE;function GP(){return aE||(aE=1,Dp=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Dp}var Fp,lE;function KP(){if(lE)return Fp;lE=1;var n=VP;return Fp=n.getPrototypeOf||null,Fp}var zp,cE;function j6(){if(cE)return zp;cE=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(l,c){for(var u=[],d=0;d<l.length;d+=1)u[d]=l[d];for(var h=0;h<c.length;h+=1)u[h+l.length]=c[h];return u},s=function(l,c){for(var u=[],d=c||0,h=0;d<l.length;d+=1,h+=1)u[h]=l[d];return u},o=function(a,l){for(var c="",u=0;u<a.length;u+=1)c+=a[u],u+1<a.length&&(c+=l);return c};return zp=function(l){var c=this;if(typeof c!="function"||e.apply(c)!==r)throw new TypeError(n+c);for(var u=s(arguments,1),d,h=function(){if(this instanceof d){var m=c.apply(this,i(u,arguments));return Object(m)===m?m:this}return c.apply(l,i(u,arguments))},f=t(0,c.length-u.length),p=[],g=0;g<f;g++)p[g]="$"+g;if(d=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(h),c.prototype){var S=function(){};S.prototype=c.prototype,d.prototype=new S,S.prototype=null}return d},zp}var $p,uE;function Kh(){if(uE)return $p;uE=1;var n=j6();return $p=Function.prototype.bind||n,$p}var jp,dE;function z0(){return dE||(dE=1,jp=Function.prototype.call),jp}var qp,hE;function JP(){return hE||(hE=1,qp=Function.prototype.apply),qp}var q6=typeof Reflect<"u"&&Reflect&&Reflect.apply,B6=Kh(),U6=JP(),H6=z0(),V6=q6,W6=V6||B6.call(H6,U6),G6=Kh(),K6=Ba,J6=z0(),Q6=W6,QP=function(e){if(e.length<1||typeof e[0]!="function")throw new K6("a function is required");return Q6(G6,J6,e)},Bp,fE;function X6(){if(fE)return Bp;fE=1;var n=QP,e=WP,t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return Bp=r&&typeof r.get=="function"?n([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,Bp}var Up,pE;function Y6(){if(pE)return Up;pE=1;var n=GP(),e=KP(),t=X6();return Up=n?function(i){return n(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,Up}var Hp,mE;function Z6(){if(mE)return Hp;mE=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Kh();return Hp=t.call(n,e),Hp}var ge,e8=VP,t8=w6,n8=C6,r8=E6,i8=_6,Ea=T6,sa=Ba,s8=x6,o8=O6,a8=P6,l8=R6,c8=k6,u8=N6,d8=L6,h8=M6,XP=Function,Vp=function(n){try{return XP('"use strict"; return ('+n+").constructor;")()}catch{}},yc=WP,f8=F6,Wp=function(){throw new sa},p8=yc?function(){try{return arguments.callee,Wp}catch{try{return yc(arguments,"callee").get}catch{return Wp}}}():Wp,Oo=$6()(),St=Y6(),m8=KP(),g8=GP(),YP=JP(),Wc=z0(),Ao={},v8=typeof Uint8Array>"u"||!St?ge:St(Uint8Array),Ks={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?ge:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?ge:ArrayBuffer,"%ArrayIteratorPrototype%":Oo&&St?St([][Symbol.iterator]()):ge,"%AsyncFromSyncIteratorPrototype%":ge,"%AsyncFunction%":Ao,"%AsyncGenerator%":Ao,"%AsyncGeneratorFunction%":Ao,"%AsyncIteratorPrototype%":Ao,"%Atomics%":typeof Atomics>"u"?ge:Atomics,"%BigInt%":typeof BigInt>"u"?ge:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?ge:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?ge:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?ge:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t8,"%eval%":eval,"%EvalError%":n8,"%Float16Array%":typeof Float16Array>"u"?ge:Float16Array,"%Float32Array%":typeof Float32Array>"u"?ge:Float32Array,"%Float64Array%":typeof Float64Array>"u"?ge:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?ge:FinalizationRegistry,"%Function%":XP,"%GeneratorFunction%":Ao,"%Int8Array%":typeof Int8Array>"u"?ge:Int8Array,"%Int16Array%":typeof Int16Array>"u"?ge:Int16Array,"%Int32Array%":typeof Int32Array>"u"?ge:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Oo&&St?St(St([][Symbol.iterator]())):ge,"%JSON%":typeof JSON=="object"?JSON:ge,"%Map%":typeof Map>"u"?ge:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Oo||!St?ge:St(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e8,"%Object.getOwnPropertyDescriptor%":yc,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?ge:Promise,"%Proxy%":typeof Proxy>"u"?ge:Proxy,"%RangeError%":r8,"%ReferenceError%":i8,"%Reflect%":typeof Reflect>"u"?ge:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?ge:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Oo||!St?ge:St(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?ge:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Oo&&St?St(""[Symbol.iterator]()):ge,"%Symbol%":Oo?Symbol:ge,"%SyntaxError%":Ea,"%ThrowTypeError%":p8,"%TypedArray%":v8,"%TypeError%":sa,"%Uint8Array%":typeof Uint8Array>"u"?ge:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?ge:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?ge:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?ge:Uint32Array,"%URIError%":s8,"%WeakMap%":typeof WeakMap>"u"?ge:WeakMap,"%WeakRef%":typeof WeakRef>"u"?ge:WeakRef,"%WeakSet%":typeof WeakSet>"u"?ge:WeakSet,"%Function.prototype.call%":Wc,"%Function.prototype.apply%":YP,"%Object.defineProperty%":f8,"%Object.getPrototypeOf%":m8,"%Math.abs%":o8,"%Math.floor%":a8,"%Math.max%":l8,"%Math.min%":c8,"%Math.pow%":u8,"%Math.round%":d8,"%Math.sign%":h8,"%Reflect.getPrototypeOf%":g8};if(St)try{null.error}catch(n){var y8=St(St(n));Ks["%Error.prototype%"]=y8}var S8=function n(e){var t;if(e==="%AsyncFunction%")t=Vp("async function () {}");else if(e==="%GeneratorFunction%")t=Vp("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Vp("async function* () {}");else if(e==="%AsyncGenerator%"){var r=n("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=n("%AsyncGenerator%");i&&St&&(t=St(i.prototype))}return Ks[e]=t,t},gE={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Gc=Kh(),Xd=Z6(),b8=Gc.call(Wc,Array.prototype.concat),w8=Gc.call(YP,Array.prototype.splice),vE=Gc.call(Wc,String.prototype.replace),Yd=Gc.call(Wc,String.prototype.slice),C8=Gc.call(Wc,RegExp.prototype.exec),E8=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,_8=/\\(\\)?/g,T8=function(e){var t=Yd(e,0,1),r=Yd(e,-1);if(t==="%"&&r!=="%")throw new Ea("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new Ea("invalid intrinsic syntax, expected opening `%`");var i=[];return vE(e,E8,function(s,o,a,l){i[i.length]=a?vE(l,_8,"$1"):o||s}),i},x8=function(e,t){var r=e,i;if(Xd(gE,r)&&(i=gE[r],r="%"+i[0]+"%"),Xd(Ks,r)){var s=Ks[r];if(s===Ao&&(s=S8(r)),typeof s>"u"&&!t)throw new sa("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:s}}throw new Ea("intrinsic "+e+" does not exist!")},$0=function(e,t){if(typeof e!="string"||e.length===0)throw new sa("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new sa('"allowMissing" argument must be a boolean');if(C8(/^%?[^%]*%?$/,e)===null)throw new Ea("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=T8(e),i=r.length>0?r[0]:"",s=x8("%"+i+"%",t),o=s.name,a=s.value,l=!1,c=s.alias;c&&(i=c[0],w8(r,b8([0,1],c)));for(var u=1,d=!0;u<r.length;u+=1){var h=r[u],f=Yd(h,0,1),p=Yd(h,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new Ea("property names with quotes must have matching quotes");if((h==="constructor"||!d)&&(l=!0),i+="."+h,o="%"+i+"%",Xd(Ks,o))a=Ks[o];else if(a!=null){if(!(h in a)){if(!t)throw new sa("base intrinsic for "+e+" exists, but the property is not available.");return}if(yc&&u+1>=r.length){var g=yc(a,h);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[h]}else d=Xd(a,h),a=a[h];d&&!l&&(Ks[o]=a)}}return a},ZP=$0,eR=QP,O8=eR([ZP("%String.prototype.indexOf%")]),tR=function(e,t){var r=ZP(e,!!t);return typeof r=="function"&&O8(e,".prototype.")>-1?eR([r]):r},P8=$0,Kc=tR,R8=Wh,k8=Ba,yE=P8("%Map%",!0),N8=Kc("Map.prototype.get",!0),L8=Kc("Map.prototype.set",!0),I8=Kc("Map.prototype.has",!0),A8=Kc("Map.prototype.delete",!0),M8=Kc("Map.prototype.size",!0),nR=!!yE&&function(){var e,t={assert:function(r){if(!t.has(r))throw new k8("Side channel does not contain "+R8(r))},delete:function(r){if(e){var i=A8(e,r);return M8(e)===0&&(e=void 0),i}return!1},get:function(r){if(e)return N8(e,r)},has:function(r){return e?I8(e,r):!1},set:function(r,i){e||(e=new yE),L8(e,r,i)}};return t},D8=$0,Jh=tR,F8=Wh,Iu=nR,z8=Ba,Po=D8("%WeakMap%",!0),$8=Jh("WeakMap.prototype.get",!0),j8=Jh("WeakMap.prototype.set",!0),q8=Jh("WeakMap.prototype.has",!0),B8=Jh("WeakMap.prototype.delete",!0),U8=Po?function(){var e,t,r={assert:function(i){if(!r.has(i))throw new z8("Side channel does not contain "+F8(i))},delete:function(i){if(Po&&i&&(typeof i=="object"||typeof i=="function")){if(e)return B8(e,i)}else if(Iu&&t)return t.delete(i);return!1},get:function(i){return Po&&i&&(typeof i=="object"||typeof i=="function")&&e?$8(e,i):t&&t.get(i)},has:function(i){return Po&&i&&(typeof i=="object"||typeof i=="function")&&e?q8(e,i):!!t&&t.has(i)},set:function(i,s){Po&&i&&(typeof i=="object"||typeof i=="function")?(e||(e=new Po),j8(e,i,s)):Iu&&(t||(t=Iu()),t.set(i,s))}};return r}:Iu,H8=Ba,V8=Wh,W8=b6,G8=nR,K8=U8,J8=K8||G8||W8,Q8=function(){var e,t={assert:function(r){if(!t.has(r))throw new H8("Side channel does not contain "+V8(r))},delete:function(r){return!!e&&e.delete(r)},get:function(r){return e&&e.get(r)},has:function(r){return!!e&&e.has(r)},set:function(r,i){e||(e=J8()),e.set(r,i)}};return t},X8=String.prototype.replace,Y8=/%20/g,Gp={RFC1738:"RFC1738",RFC3986:"RFC3986"},j0={default:Gp.RFC3986,formatters:{RFC1738:function(n){return X8.call(n,Y8,"+")},RFC3986:function(n){return String(n)}},RFC1738:Gp.RFC1738,RFC3986:Gp.RFC3986},Z8=j0,Kp=Object.prototype.hasOwnProperty,Is=Array.isArray,pr=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),eV=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Is(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);t.obj[t.prop]=i}}},rR=function(e,t){for(var r=t&&t.plainObjects?{__proto__:null}:{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},tV=function n(e,t,r){if(!t)return e;if(typeof t!="object"&&typeof t!="function"){if(Is(e))e.push(t);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Kp.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return Is(e)&&!Is(t)&&(i=rR(e,r)),Is(e)&&Is(t)?(t.forEach(function(s,o){if(Kp.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=n(a,s,r):e.push(s)}else e[o]=s}),e):Object.keys(t).reduce(function(s,o){var a=t[o];return Kp.call(s,o)?s[o]=n(s[o],a,r):s[o]=a,s},i)},nV=function(e,t){return Object.keys(t).reduce(function(r,i){return r[i]=t[i],r},e)},rV=function(n,e,t){var r=n.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Jp=1024,iV=function(e,t,r,i,s){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});for(var a="",l=0;l<o.length;l+=Jp){for(var c=o.length>=Jp?o.slice(l,l+Jp):o,u=[],d=0;d<c.length;++d){var h=c.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===Z8.RFC1738&&(h===40||h===41)){u[u.length]=c.charAt(d);continue}if(h<128){u[u.length]=pr[h];continue}if(h<2048){u[u.length]=pr[192|h>>6]+pr[128|h&63];continue}if(h<55296||h>=57344){u[u.length]=pr[224|h>>12]+pr[128|h>>6&63]+pr[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|c.charCodeAt(d)&1023),u[u.length]=pr[240|h>>18]+pr[128|h>>12&63]+pr[128|h>>6&63]+pr[128|h&63]}a+=u.join("")}return a},sV=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],o=s.obj[s.prop],a=Object.keys(o),l=0;l<a.length;++l){var c=a[l],u=o[c];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(t.push({obj:o,prop:c}),r.push(u))}return eV(t),e},oV=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},aV=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},lV=function(e,t){return[].concat(e,t)},cV=function(e,t){if(Is(e)){for(var r=[],i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)},iR={arrayToObject:rR,assign:nV,combine:lV,compact:sV,decode:rV,encode:iV,isBuffer:aV,isRegExp:oV,maybeMap:cV,merge:tV},sR=Q8,ad=iR,Ul=j0,uV=Object.prototype.hasOwnProperty,oR={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},Sr=Array.isArray,dV=Array.prototype.push,aR=function(n,e){dV.apply(n,Sr(e)?e:[e])},hV=Date.prototype.toISOString,SE=Ul.default,ht={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ad.encode,encodeValuesOnly:!1,filter:void 0,format:SE,formatter:Ul.formatters[SE],indices:!1,serializeDate:function(e){return hV.call(e)},skipNulls:!1,strictNullHandling:!1},fV=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Qp={},pV=function n(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g,S,m,v){for(var y=e,b=v,w=0,_=!1;(b=b.get(Qp))!==void 0&&!_;){var E=b.get(e);if(w+=1,typeof E<"u"){if(E===w)throw new RangeError("Cyclic object value");_=!0}typeof b.get(Qp)>"u"&&(w=0)}if(typeof u=="function"?y=u(t,y):y instanceof Date?y=f(y):r==="comma"&&Sr(y)&&(y=ad.maybeMap(y,function(x){return x instanceof Date?f(x):x})),y===null){if(o)return c&&!S?c(t,ht.encoder,m,"key",p):t;y=""}if(fV(y)||ad.isBuffer(y)){if(c){var P=S?t:c(t,ht.encoder,m,"key",p);return[g(P)+"="+g(c(y,ht.encoder,m,"value",p))]}return[g(t)+"="+g(String(y))]}var A=[];if(typeof y>"u")return A;var F;if(r==="comma"&&Sr(y))S&&c&&(y=ad.maybeMap(y,c)),F=[{value:y.length>0?y.join(",")||null:void 0}];else if(Sr(u))F=u;else{var X=Object.keys(y);F=d?X.sort(d):X}var z=l?String(t).replace(/\./g,"%2E"):String(t),ee=i&&Sr(y)&&y.length===1?z+"[]":z;if(s&&Sr(y)&&y.length===0)return ee+"[]";for(var W=0;W<F.length;++W){var C=F[W],L=typeof C=="object"&&C&&typeof C.value<"u"?C.value:y[C];if(!(a&&L===null)){var H=h&&l?String(C).replace(/\./g,"%2E"):String(C),I=Sr(y)?typeof r=="function"?r(ee,H):ee:ee+(h?"."+H:"["+H+"]");v.set(e,w);var B=sR();B.set(Qp,v),aR(A,n(L,I,r,i,s,o,a,l,r==="comma"&&S&&Sr(y)?null:c,u,d,h,f,p,g,S,m,B))}}return A},mV=function(e){if(!e)return ht;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||ht.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=Ul.default;if(typeof e.format<"u"){if(!uV.call(Ul.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=Ul.formatters[r],s=ht.filter;(typeof e.filter=="function"||Sr(e.filter))&&(s=e.filter);var o;if(e.arrayFormat in oR?o=e.arrayFormat:"indices"in e?o=e.indices?"indices":"repeat":o=ht.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:ht.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:ht.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:ht.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:ht.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?ht.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:ht.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:ht.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:ht.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:ht.encodeValuesOnly,filter:s,format:r,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:ht.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:ht.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:ht.strictNullHandling}},gV=function(n,e){var t=n,r=mV(e),i,s;typeof r.filter=="function"?(s=r.filter,t=s("",t)):Sr(r.filter)&&(s=r.filter,i=s);var o=[];if(typeof t!="object"||t===null)return"";var a=oR[r.arrayFormat],l=a==="comma"&&r.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);for(var c=sR(),u=0;u<i.length;++u){var d=i[u],h=t[d];r.skipNulls&&h===null||aR(o,pV(h,d,a,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}var f=o.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},so=iR,dv=Object.prototype.hasOwnProperty,bE=Array.isArray,et={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:so.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},vV=function(n){return n.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},lR=function(n,e,t){if(n&&typeof n=="string"&&e.comma&&n.indexOf(",")>-1)return n.split(",");if(e.throwOnLimitExceeded&&t>=e.arrayLimit)throw new RangeError("Array limit exceeded. Only "+e.arrayLimit+" element"+(e.arrayLimit===1?"":"s")+" allowed in an array.");return n},yV="utf8=%26%2310003%3B",SV="utf8=%E2%9C%93",bV=function(e,t){var r={__proto__:null},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;i=i.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=i.split(t.delimiter,t.throwOnLimitExceeded?s+1:s);if(t.throwOnLimitExceeded&&o.length>s)throw new RangeError("Parameter limit exceeded. Only "+s+" parameter"+(s===1?"":"s")+" allowed.");var a=-1,l,c=t.charset;if(t.charsetSentinel)for(l=0;l<o.length;++l)o[l].indexOf("utf8=")===0&&(o[l]===SV?c="utf-8":o[l]===yV&&(c="iso-8859-1"),a=l,l=o.length);for(l=0;l<o.length;++l)if(l!==a){var u=o[l],d=u.indexOf("]="),h=d===-1?u.indexOf("="):d+1,f,p;h===-1?(f=t.decoder(u,et.decoder,c,"key"),p=t.strictNullHandling?null:""):(f=t.decoder(u.slice(0,h),et.decoder,c,"key"),p=so.maybeMap(lR(u.slice(h+1),t,bE(r[f])?r[f].length:0),function(S){return t.decoder(S,et.decoder,c,"value")})),p&&t.interpretNumericEntities&&c==="iso-8859-1"&&(p=vV(String(p))),u.indexOf("[]=")>-1&&(p=bE(p)?[p]:p);var g=dv.call(r,f);g&&t.duplicates==="combine"?r[f]=so.combine(r[f],p):(!g||t.duplicates==="last")&&(r[f]=p)}return r},wV=function(n,e,t,r){var i=0;if(n.length>0&&n[n.length-1]==="[]"){var s=n.slice(0,-1).join("");i=Array.isArray(e)&&e[s]?e[s].length:0}for(var o=r?e:lR(e,t,i),a=n.length-1;a>=0;--a){var l,c=n[a];if(c==="[]"&&t.parseArrays)l=t.allowEmptyArrays&&(o===""||t.strictNullHandling&&o===null)?[]:so.combine([],o);else{l=t.plainObjects?{__proto__:null}:{};var u=c.charAt(0)==="["&&c.charAt(c.length-1)==="]"?c.slice(1,-1):c,d=t.decodeDotInKeys?u.replace(/%2E/g,"."):u,h=parseInt(d,10);!t.parseArrays&&d===""?l={0:o}:!isNaN(h)&&c!==d&&String(h)===d&&h>=0&&t.parseArrays&&h<=t.arrayLimit?(l=[],l[h]=o):d!=="__proto__"&&(l[d]=o)}o=l}return o},CV=function(e,t,r,i){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=r.depth>0&&o.exec(s),c=l?s.slice(0,l.index):s,u=[];if(c){if(!r.plainObjects&&dv.call(Object.prototype,c)&&!r.allowPrototypes)return;u.push(c)}for(var d=0;r.depth>0&&(l=a.exec(s))!==null&&d<r.depth;){if(d+=1,!r.plainObjects&&dv.call(Object.prototype,l[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(l[1])}if(l){if(r.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");u.push("["+s.slice(l.index)+"]")}return wV(u,t,r,i)}},EV=function(e){if(!e)return et;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof e.throwOnLimitExceeded<"u"&&typeof e.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var t=typeof e.charset>"u"?et.charset:e.charset,r=typeof e.duplicates>"u"?et.duplicates:e.duplicates;if(r!=="combine"&&r!=="first"&&r!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var i=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:et.allowDots:!!e.allowDots;return{allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:et.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:et.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:et.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:et.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:et.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:et.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:et.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:et.decoder,delimiter:typeof e.delimiter=="string"||so.isRegExp(e.delimiter)?e.delimiter:et.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:et.depth,duplicates:r,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:et.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:et.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:et.plainObjects,strictDepth:typeof e.strictDepth=="boolean"?!!e.strictDepth:et.strictDepth,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:et.strictNullHandling,throwOnLimitExceeded:typeof e.throwOnLimitExceeded=="boolean"?e.throwOnLimitExceeded:!1}},_V=function(n,e){var t=EV(e);if(n===""||n===null||typeof n>"u")return t.plainObjects?{__proto__:null}:{};for(var r=typeof n=="string"?bV(n,t):n,i=t.plainObjects?{__proto__:null}:{},s=Object.keys(r),o=0;o<s.length;++o){var a=s[o],l=CV(a,r[a],t,typeof n=="string");i=so.merge(i,l,t)}return t.allowSparse===!0?i:so.compact(i)},TV=gV,xV=_V,OV=j0,PV={formats:OV,parse:xV,stringify:TV},RV=DH;function ri(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var kV=/^([a-z0-9.+-]+:)/i,NV=/:[0-9]*$/,LV=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,IV=["<",">",'"',"`"," ","\r",`
`,"	"],AV=["{","}","|","\\","^","`"].concat(IV),hv=["'"].concat(AV),wE=["%","/","?",";","#"].concat(hv),CE=["/","?","#"],MV=255,EE=/^[+a-z0-9A-Z_-]{0,63}$/,DV=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,FV={javascript:!0,"javascript:":!0},fv={javascript:!0,"javascript:":!0},oa={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},pv=PV;function cR(n,e,t){if(n&&typeof n=="object"&&n instanceof ri)return n;var r=new ri;return r.parse(n,e,t),r}ri.prototype.parse=function(n,e,t){if(typeof n!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof n);var r=n.indexOf("?"),i=r!==-1&&r<n.indexOf("#")?"?":"#",s=n.split(i),o=/\\/g;s[0]=s[0].replace(o,"/"),n=s.join(i);var a=n;if(a=a.trim(),!t&&n.split("#").length===1){var l=LV.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=pv.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=kV.exec(a);if(c){c=c[0];var u=c.toLowerCase();this.protocol=u,a=a.substr(c.length)}if(t||c||a.match(/^\/\/[^@/]+@[^@/]+/)){var d=a.substr(0,2)==="//";d&&!(c&&fv[c])&&(a=a.substr(2),this.slashes=!0)}if(!fv[c]&&(d||c&&!oa[c])){for(var h=-1,f=0;f<CE.length;f++){var p=a.indexOf(CE[f]);p!==-1&&(h===-1||p<h)&&(h=p)}var g,S;h===-1?S=a.lastIndexOf("@"):S=a.lastIndexOf("@",h),S!==-1&&(g=a.slice(0,S),a=a.slice(S+1),this.auth=decodeURIComponent(g)),h=-1;for(var f=0;f<wE.length;f++){var p=a.indexOf(wE[f]);p!==-1&&(h===-1||p<h)&&(h=p)}h===-1&&(h=a.length),this.host=a.slice(0,h),a=a.slice(h),this.parseHost(),this.hostname=this.hostname||"";var m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!m)for(var v=this.hostname.split(/\./),f=0,y=v.length;f<y;f++){var b=v[f];if(b&&!b.match(EE)){for(var w="",_=0,E=b.length;_<E;_++)b.charCodeAt(_)>127?w+="x":w+=b[_];if(!w.match(EE)){var P=v.slice(0,f),A=v.slice(f+1),F=b.match(DV);F&&(P.push(F[1]),A.unshift(F[2])),A.length&&(a="/"+A.join(".")+a),this.hostname=P.join(".");break}}}this.hostname.length>MV?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=RV.toASCII(this.hostname));var X=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+X,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!FV[u])for(var f=0,y=hv.length;f<y;f++){var ee=hv[f];if(a.indexOf(ee)!==-1){var W=encodeURIComponent(ee);W===ee&&(W=escape(ee)),a=a.split(ee).join(W)}}var C=a.indexOf("#");C!==-1&&(this.hash=a.substr(C),a=a.slice(0,C));var L=a.indexOf("?");if(L!==-1?(this.search=a.substr(L),this.query=a.substr(L+1),e&&(this.query=pv.parse(this.query)),a=a.slice(0,L)):e&&(this.search="",this.query={}),a&&(this.pathname=a),oa[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var X=this.pathname||"",H=this.search||"";this.path=X+H}return this.href=this.format(),this};ri.prototype.format=function(){var n=this.auth||"";n&&(n=encodeURIComponent(n),n=n.replace(/%3A/i,":"),n+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=n+this.host:this.hostname&&(i=n+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=pv.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||oa[e])&&i!==!1?(i="//"+(i||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):i||(i=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+i+t+o+r};ri.prototype.resolve=function(n){return this.resolveObject(cR(n,!1,!0)).format()};ri.prototype.resolveObject=function(n){if(typeof n=="string"){var e=new ri;e.parse(n,!1,!0),n=e}for(var t=new ri,r=Object.keys(this),i=0;i<r.length;i++){var s=r[i];t[s]=this[s]}if(t.hash=n.hash,n.href==="")return t.href=t.format(),t;if(n.slashes&&!n.protocol){for(var o=Object.keys(n),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(t[l]=n[l])}return oa[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(n.protocol&&n.protocol!==t.protocol){if(!oa[n.protocol]){for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];t[d]=n[d]}return t.href=t.format(),t}if(t.protocol=n.protocol,!n.host&&!fv[n.protocol]){for(var y=(n.pathname||"").split("/");y.length&&!(n.host=y.shift()););n.host||(n.host=""),n.hostname||(n.hostname=""),y[0]!==""&&y.unshift(""),y.length<2&&y.unshift(""),t.pathname=y.join("/")}else t.pathname=n.pathname;if(t.search=n.search,t.query=n.query,t.host=n.host||"",t.auth=n.auth,t.hostname=n.hostname||n.host,t.port=n.port,t.pathname||t.search){var h=t.pathname||"",f=t.search||"";t.path=h+f}return t.slashes=t.slashes||n.slashes,t.href=t.format(),t}var p=t.pathname&&t.pathname.charAt(0)==="/",g=n.host||n.pathname&&n.pathname.charAt(0)==="/",S=g||p||t.host&&n.pathname,m=S,v=t.pathname&&t.pathname.split("/")||[],y=n.pathname&&n.pathname.split("/")||[],b=t.protocol&&!oa[t.protocol];if(b&&(t.hostname="",t.port=null,t.host&&(v[0]===""?v[0]=t.host:v.unshift(t.host)),t.host="",n.protocol&&(n.hostname=null,n.port=null,n.host&&(y[0]===""?y[0]=n.host:y.unshift(n.host)),n.host=null),S=S&&(y[0]===""||v[0]==="")),g)t.host=n.host||n.host===""?n.host:t.host,t.hostname=n.hostname||n.hostname===""?n.hostname:t.hostname,t.search=n.search,t.query=n.query,v=y;else if(y.length)v||(v=[]),v.pop(),v=v.concat(y),t.search=n.search,t.query=n.query;else if(n.search!=null){if(b){t.host=v.shift(),t.hostname=t.host;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return t.search=n.search,t.query=n.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!v.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var _=v.slice(-1)[0],E=(t.host||n.host||v.length>1)&&(_==="."||_==="..")||_==="",P=0,A=v.length;A>=0;A--)_=v[A],_==="."?v.splice(A,1):_===".."?(v.splice(A,1),P++):P&&(v.splice(A,1),P--);if(!S&&!m)for(;P--;P)v.unshift("..");S&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),E&&v.join("/").substr(-1)!=="/"&&v.push("");var F=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(b){t.hostname=F?"":v.length?v.shift():"",t.host=t.hostname;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return S=S||t.host&&v.length,S&&!F&&v.unshift(""),v.length>0?t.pathname=v.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=n.auth||t.auth,t.slashes=t.slashes||n.slashes,t.href=t.format(),t};ri.prototype.parseHost=function(){var n=this.host,e=NV.exec(n);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),n=n.substr(0,n.length-e.length)),n&&(this.hostname=n)};var mv=cR;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ln;(function(n){n.genericError="genericError",n.genericNetworkError="genericNetworkError",n.authorizationError="authorizationError",n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",n.throttlingError="throttlingError",n.offlineError="offlineError",n.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",n.writeError="writeError",n.fetchFailure="fetchFailure",n.incorrectServerResponse="incorrectServerResponse",n.fileOverwrittenInStorage="fileOverwrittenInStorage",n.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",n.locationRedirection="locationRedirection"})(Ln||(Ln={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var _a;(function(n){n[n.NoCaching=0]="NoCaching",n[n.Prefetch=1]="Prefetch"})(_a||(_a={}));var Ta;(function(n){n.summarizingClient="fluid-client-summarizer",n.createNew="createNew"})(Ta||(Ta={}));var q0={exports:{}},uR=function(e,t){return function(){return e.apply(t,arguments)}},zV=uR,B0=Object.prototype.toString,U0=function(n){return function(e){var t=B0.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())}}(Object.create(null));function ms(n){return n=n.toLowerCase(),function(t){return U0(t)===n}}function Qh(n){return Array.isArray(n)}function gv(n){return typeof n>"u"}function $V(n){return n!==null&&!gv(n)&&n.constructor!==null&&!gv(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}var dR=ms("ArrayBuffer");function jV(n){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&dR(n.buffer),e}function qV(n){return typeof n=="string"}function hR(n){return typeof n=="number"}function fR(n){return n!==null&&typeof n=="object"}function ld(n){if(U0(n)!=="object")return!1;var e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}function BV(n){return n&&Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}var UV=ms("Date"),HV=ms("File"),VV=ms("Blob"),WV=ms("FileList");function H0(n){return B0.call(n)==="[object Function]"}function GV(n){return fR(n)&&H0(n.pipe)}function KV(n){var e="[object FormData]";return n&&(typeof FormData=="function"&&n instanceof FormData||B0.call(n)===e||H0(n.toString)&&n.toString()===e)}var JV=ms("URLSearchParams");function QV(n){return n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function XV(){var n;return typeof navigator<"u"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window<"u"&&typeof document<"u"}function V0(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),Qh(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.call(null,n[i],i,n)}function vv(){var n={};function e(i,s){ld(n[s])&&ld(i)?n[s]=vv(n[s],i):ld(i)?n[s]=vv({},i):Qh(i)?n[s]=i.slice():n[s]=i}for(var t=0,r=arguments.length;t<r;t++)V0(arguments[t],e);return n}function YV(n,e,t){return V0(e,function(i,s){t&&typeof i=="function"?n[s]=zV(i,t):n[s]=i}),n}function ZV(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n}function eW(n,e,t,r){n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,t&&Object.assign(n.prototype,t)}function tW(n,e,t,r){var i,s,o,a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&Object.getPrototypeOf(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e}function nW(n,e,t){n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return r!==-1&&r===t}function rW(n){if(!n)return null;if(Qh(n))return n;var e=n.length;if(!hR(e))return null;for(var t=new Array(e);e-- >0;)t[e]=n[e];return t}var iW=function(n){return function(e){return n&&e instanceof n}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array));function sW(n,e){for(var t=n&&n[Symbol.iterator],r=t.call(n),i;(i=r.next())&&!i.done;){var s=i.value;e.call(n,s[0],s[1])}}function oW(n,e){for(var t,r=[];(t=n.exec(e))!==null;)r.push(t);return r}var aW=ms("HTMLFormElement"),lW=function(e){return function(t,r){return e.call(t,r)}}(Object.prototype.hasOwnProperty),vt={isArray:Qh,isArrayBuffer:dR,isBuffer:$V,isFormData:KV,isArrayBufferView:jV,isString:qV,isNumber:hR,isObject:fR,isPlainObject:ld,isEmptyObject:BV,isUndefined:gv,isDate:UV,isFile:HV,isBlob:VV,isFunction:H0,isStream:GV,isURLSearchParams:JV,isStandardBrowserEnv:XV,forEach:V0,merge:vv,extend:YV,trim:QV,stripBOM:ZV,inherits:eW,toFlatObject:tW,kindOf:U0,kindOfTest:ms,endsWith:nW,toArray:rW,isTypedArray:iW,isFileList:WV,forEachEntry:sW,matchAll:oW,isHTMLForm:aW,hasOwnProperty:lW},pR=vt;function xa(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}pR.inherits(xa,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var mR=xa.prototype,gR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(function(n){gR[n]={value:n}});Object.defineProperties(xa,gR);Object.defineProperty(mR,"isAxiosError",{value:!0});xa.from=function(n,e,t,r,i,s){var o=Object.create(mR);return pR.toFlatObject(n,o,function(l){return l!==Error.prototype}),xa.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};var vo=xa,cW=typeof self=="object"?self.FormData:window.FormData,uW=cW,Me=vt,dW=vo,hW=uW;function yv(n){return Me.isPlainObject(n)||Me.isArray(n)}function vR(n){return Me.endsWith(n,"[]")?n.slice(0,-2):n}function _E(n,e,t){return n?n.concat(e).map(function(i,s){return i=vR(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function fW(n){return Me.isArray(n)&&!n.some(yv)}var pW=Me.toFlatObject(Me,{},null,function(e){return/^is[A-Z]/.test(e)});function mW(n){return n&&Me.isFunction(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator]}function gW(n,e,t){if(!Me.isObject(n))throw new TypeError("target must be an object");e=e||new(hW||FormData),t=Me.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,S){return!Me.isUndefined(S[g])});var r=t.metaTokens,i=t.visitor||u,s=t.dots,o=t.indexes,a=t.Blob||typeof Blob<"u"&&Blob,l=a&&mW(e);if(!Me.isFunction(i))throw new TypeError("visitor must be a function");function c(p){if(p===null)return"";if(Me.isDate(p))return p.toISOString();if(!l&&Me.isBlob(p))throw new dW("Blob is not supported. Use a Buffer instead.");return Me.isArrayBuffer(p)||Me.isTypedArray(p)?l&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function u(p,g,S){var m=p;if(p&&!S&&typeof p=="object"){if(Me.endsWith(g,"{}"))g=r?g:g.slice(0,-2),p=JSON.stringify(p);else if(Me.isArray(p)&&fW(p)||Me.isFileList(p)||Me.endsWith(g,"[]")&&(m=Me.toArray(p)))return g=vR(g),m.forEach(function(y,b){!Me.isUndefined(y)&&e.append(o===!0?_E([g],b,s):o===null?g:g+"[]",c(y))}),!1}return yv(p)?!0:(e.append(_E(S,g,s),c(p)),!1)}var d=[],h=Object.assign(pW,{defaultVisitor:u,convertValue:c,isVisitable:yv});function f(p,g){if(!Me.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(p),Me.forEach(p,function(m,v){var y=!Me.isUndefined(m)&&i.call(e,m,Me.isString(v)?v.trim():v,g,h);y===!0&&f(m,g?g.concat(v):[v])}),d.pop()}}if(!Me.isObject(n))throw new TypeError("data must be an object");return f(n),e}var Xh=gW,vW=Xh;function TE(n){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'\(\)~]|%20|%00/g,function(r){return e[r]})}function yR(n,e){this._pairs=[],n&&vW(n,this,e)}var SR=yR.prototype;SR.append=function(e,t){this._pairs.push([e,t])};SR.toString=function(e){var t=e?function(r){return e.call(this,r,TE)}:TE;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var bR=yR,yW=vt,SW=bR;function bW(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var wR=function(e,t,r){if(!t)return e;var i=e.indexOf("#");i!==-1&&(e=e.slice(0,i));var s=r&&r.encode||bW,o=r&&r.serialize,a;return o?a=o(t,r):a=yW.isURLSearchParams(t)?t.toString():new SW(t,r).toString(s),a&&(e+=(e.indexOf("?")===-1?"?":"&")+a),e},wW=vt;function Jc(){this.handlers=[]}Jc.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};Jc.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Jc.prototype.clear=function(){this.handlers&&(this.handlers=[])};Jc.prototype.forEach=function(e){wW.forEach(this.handlers,function(r){r!==null&&e(r)})};var CW=Jc,EW=vt,CR=function(e,t){EW.forEach(e,function(i,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[s])})},ER={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_W=bR,TW=typeof URLSearchParams<"u"?URLSearchParams:_W,xW=FormData,OW={isBrowser:!0,classes:{URLSearchParams:TW,FormData:xW,Blob},protocols:["http","https","file","blob","url","data"]},W0=OW,PW=vt,RW=Xh,xE=W0,kW=function(e,t){return RW(e,new xE.classes.URLSearchParams,Object.assign({visitor:function(r,i,s,o){return xE.isNode&&PW.isBuffer(r)?(this.append(i,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))},Ti=vt;function NW(n){return Ti.matchAll(/\w+|\[(\w*)]/g,n).map(function(e){return e[0]==="[]"?"":e[1]||e[0]})}function LW(n){var e={},t=Object.keys(n),r,i=t.length,s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function IW(n){function e(r,i,s,o){var a=r[o++],l=Number.isFinite(+a),c=o>=r.length;if(a=!a&&Ti.isArray(s)?s.length:a,c)return Ti.hasOwnProperty(s,a)?s[a]=[s[a],i]:s[a]=i,!l;(!s[a]||!Ti.isObject(s[a]))&&(s[a]=[]);var u=e(r,i,s[a],o);return u&&Ti.isArray(s[a])&&(s[a]=LW(s[a])),!l}if(Ti.isFormData(n)&&Ti.isFunction(n.entries)){var t={};return Ti.forEachEntry(n,function(r,i){e(NW(r),i,t,0)}),t}return null}var _R=IW,Xp,OE;function AW(){if(OE)return Xp;OE=1;var n=vo;return Xp=function(t,r,i){var s=i.config.validateStatus;!i.status||!s||s(i.status)?t(i):r(new n("Request failed with status code "+i.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))},Xp}var Yp,PE;function MW(){if(PE)return Yp;PE=1;var n=vt;return Yp=n.isStandardBrowserEnv()?function(){return{write:function(r,i,s,o,a,l){var c=[];c.push(r+"="+encodeURIComponent(i)),n.isNumber(s)&&c.push("expires="+new Date(s).toGMTString()),n.isString(o)&&c.push("path="+o),n.isString(a)&&c.push("domain="+a),l===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Yp}var DW=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},FW=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},zW=DW,$W=FW,TR=function(e,t){return e&&!zW(t)?$W(e,t):t},Zp,RE;function jW(){if(RE)return Zp;RE=1;var n=vt,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Zp=function(r){var i={},s,o,a;return r&&n.forEach(r.split(`
`),function(c){if(a=c.indexOf(":"),s=n.trim(c.slice(0,a)).toLowerCase(),o=n.trim(c.slice(a+1)),s){if(i[s]&&e.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},Zp}var em,kE;function qW(){if(kE)return em;kE=1;var n=vt;return em=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),i;function s(o){var a=o;return t&&(r.setAttribute("href",a),a=r.href),r.setAttribute("href",a),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=s(window.location.href),function(a){var l=n.isString(a)?s(a):a;return l.protocol===i.protocol&&l.host===i.host}}():function(){return function(){return!0}}(),em}var tm,NE;function Yh(){if(NE)return tm;NE=1;var n=vo,e=vt;function t(r,i,s){n.call(this,r??"canceled",n.ERR_CANCELED,i,s),this.name="CanceledError"}return e.inherits(t,n,{__CANCEL__:!0}),tm=t,tm}var nm,LE;function BW(){return LE||(LE=1,nm=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}),nm}var rm,IE;function AE(){if(IE)return rm;IE=1;var n=vt,e=AW(),t=MW(),r=wR,i=TR,s=jW(),o=qW(),a=ER,l=vo,c=Yh(),u=BW(),d=W0;return rm=function(f){return new Promise(function(g,S){var m=f.data,v=f.headers,y=f.responseType,b=f.withXSRFToken,w;function _(){f.cancelToken&&f.cancelToken.unsubscribe(w),f.signal&&f.signal.removeEventListener("abort",w)}n.isFormData(m)&&n.isStandardBrowserEnv()&&delete v["Content-Type"];var E=new XMLHttpRequest;if(f.auth){var P=f.auth.username||"",A=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";v.Authorization="Basic "+btoa(P+":"+A)}var F=i(f.baseURL,f.url);E.open(f.method.toUpperCase(),r(F,f.params,f.paramsSerializer),!0),E.timeout=f.timeout;function X(){if(E){var W="getAllResponseHeaders"in E?s(E.getAllResponseHeaders()):null,C=!y||y==="text"||y==="json"?E.responseText:E.response,L={data:C,status:E.status,statusText:E.statusText,headers:W,config:f,request:E};e(function(I){g(I),_()},function(I){S(I),_()},L),E=null}}if("onloadend"in E?E.onloadend=X:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(X)},E.onabort=function(){E&&(S(new l("Request aborted",l.ECONNABORTED,f,E)),E=null)},E.onerror=function(){S(new l("Network Error",l.ERR_NETWORK,f,E)),E=null},E.ontimeout=function(){var C=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",L=f.transitional||a;f.timeoutErrorMessage&&(C=f.timeoutErrorMessage),S(new l(C,L.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,f,E)),E=null},n.isStandardBrowserEnv()&&(b&&n.isFunction(b)&&(b=b(f)),b||b!==!1&&o(F))){var z=f.xsrfHeaderName&&f.xsrfCookieName&&t.read(f.xsrfCookieName);z&&(v[f.xsrfHeaderName]=z)}"setRequestHeader"in E&&n.forEach(v,function(C,L){typeof m>"u"&&L.toLowerCase()==="content-type"?delete v[L]:E.setRequestHeader(L,C)}),n.isUndefined(f.withCredentials)||(E.withCredentials=!!f.withCredentials),y&&y!=="json"&&(E.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&E.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&E.upload&&E.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(w=function(W){E&&(S(!W||W.type?new c(null,f,E):W),E.abort(),E=null)},f.cancelToken&&f.cancelToken.subscribe(w),f.signal&&(f.signal.aborted?w():f.signal.addEventListener("abort",w))),!m&&m!==!1&&m!==0&&m!==""&&(m=null);var ee=u(F);if(ee&&d.protocols.indexOf(ee)===-1){S(new l("Unsupported protocol "+ee+":",l.ERR_BAD_REQUEST,f));return}E.send(m)})},rm}var ft=vt,ME=CR,DE=vo,UW=ER,HW=Xh,VW=kW,FE=W0,WW=_R,GW={"Content-Type":"application/x-www-form-urlencoded"};function zE(n,e){!ft.isUndefined(n)&&ft.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}function KW(){var n;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(n=AE()),n}function JW(n,e,t){if(ft.isString(n))try{return(e||JSON.parse)(n),ft.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var Zh={transitional:UW,adapter:KW(),transformRequest:[function(e,t){ME(t,"Accept"),ME(t,"Content-Type");var r=t&&t["Content-Type"]||"",i=r.indexOf("application/json")>-1,s=ft.isObject(e);s&&ft.isHTMLForm(e)&&(e=new FormData(e));var o=ft.isFormData(e);if(o)return i?JSON.stringify(WW(e)):e;if(ft.isArrayBuffer(e)||ft.isBuffer(e)||ft.isStream(e)||ft.isFile(e)||ft.isBlob(e))return e;if(ft.isArrayBufferView(e))return e.buffer;if(ft.isURLSearchParams(e))return zE(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var a;if(s){if(r.indexOf("application/x-www-form-urlencoded")!==-1)return VW(e,this.formSerializer).toString();if((a=ft.isFileList(e))||r.indexOf("multipart/form-data")>-1){var l=this.env&&this.env.FormData;return HW(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||i?(zE(t,"application/json"),JW(e)):e}],transformResponse:[function(e){var t=this.transitional||Zh.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&ft.isString(e)&&(r&&!this.responseType||i)){var s=t&&t.silentJSONParsing,o=!s&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?DE.from(a,DE.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:FE.classes.FormData,Blob:FE.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ft.forEach(["delete","get","head"],function(e){Zh.headers[e]={}});ft.forEach(["post","put","patch"],function(e){Zh.headers[e]=ft.merge(GW)});var G0=Zh,QW=vt,XW=G0,YW=function(e,t,r,i){var s=this||XW;return QW.forEach(i,function(a){e=a.call(s,e,t,r)}),e},im,$E;function xR(){return $E||($E=1,im=function(e){return!!(e&&e.__CANCEL__)}),im}var jE=vt,sm=YW,ZW=xR(),e5=G0,t5=Yh(),qE=CR;function om(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new t5}var n5=function(e){om(e),e.headers=e.headers||{},e.data=sm.call(e,e.data,e.headers,null,e.transformRequest),qE(e.headers,"Accept"),qE(e.headers,"Content-Type"),e.headers=jE.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),jE.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var t=e.adapter||e5.adapter;return t(e).then(function(i){return om(e),i.data=sm.call(e,i.data,i.headers,i.status,e.transformResponse),i},function(i){return ZW(i)||(om(e),i&&i.response&&(i.response.data=sm.call(e,i.response.data,i.response.headers,i.response.status,e.transformResponse))),Promise.reject(i)})},Vt=vt,OR=function(e,t){t=t||{};var r={};function i(u,d){return Vt.isPlainObject(u)&&Vt.isPlainObject(d)?Vt.merge(u,d):Vt.isEmptyObject(d)?Vt.merge({},u):Vt.isPlainObject(d)?Vt.merge({},d):Vt.isArray(d)?d.slice():d}function s(u){if(Vt.isUndefined(t[u])){if(!Vt.isUndefined(e[u]))return i(void 0,e[u])}else return i(e[u],t[u])}function o(u){if(!Vt.isUndefined(t[u]))return i(void 0,t[u])}function a(u){if(Vt.isUndefined(t[u])){if(!Vt.isUndefined(e[u]))return i(void 0,e[u])}else return i(void 0,t[u])}function l(u){if(u in t)return i(e[u],t[u]);if(u in e)return i(void 0,e[u])}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l};return Vt.forEach(Object.keys(e).concat(Object.keys(t)),function(d){var h=c[d]||s,f=h(d);Vt.isUndefined(f)&&h!==l||(r[d]=f)}),r},am,BE;function PR(){return BE||(BE=1,am={version:"0.28.1"}),am}var r5=PR().version,ki=vo,K0={};["object","boolean","number","function","string","symbol"].forEach(function(n,e){K0[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var UE={};K0.transitional=function(e,t,r){function i(s,o){return"[Axios v"+r5+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return function(s,o,a){if(e===!1)throw new ki(i(o," has been removed"+(t?" in "+t:"")),ki.ERR_DEPRECATED);return t&&!UE[o]&&(UE[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function i5(n,e,t){if(typeof n!="object")throw new ki("options must be an object",ki.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(n),i=r.length;i-- >0;){var s=r[i],o=e[s];if(o){var a=n[s],l=a===void 0||o(a,s,n);if(l!==!0)throw new ki("option "+s+" must be "+l,ki.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ki("Unknown option "+s,ki.ERR_BAD_OPTION)}}var s5={assertOptions:i5,validators:K0},J0=vt,o5=wR,HE=CW,VE=n5,ef=OR,a5=TR,Sv=s5,_i=Sv.validators;function Oa(n){this.defaults=n,this.interceptors={request:new HE,response:new HE}}Oa.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ef(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;r!==void 0&&Sv.assertOptions(r,{silentJSONParsing:_i.transitional(_i.boolean),forcedJSONParsing:_i.transitional(_i.boolean),clarifyTimeoutError:_i.transitional(_i.boolean)},!1);var i=t.paramsSerializer;i!==void 0&&Sv.assertOptions(i,{encode:_i.function,serialize:_i.function},!0),J0.isFunction(i)&&(t.paramsSerializer={serialize:i});var s=[],o=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(o=o&&p.synchronous,s.unshift(p.fulfilled,p.rejected))});var a=[];this.interceptors.response.forEach(function(p){a.push(p.fulfilled,p.rejected)});var l;if(!o){var c=[VE,void 0];for(Array.prototype.unshift.apply(c,s),c=c.concat(a),l=Promise.resolve(t);c.length;)l=l.then(c.shift(),c.shift());return l}for(var u=t;s.length;){var d=s.shift(),h=s.shift();try{u=d(u)}catch(f){h(f);break}}try{l=VE(u)}catch(f){return Promise.reject(f)}for(;a.length;)l=l.then(a.shift(),a.shift());return l};Oa.prototype.getUri=function(e){e=ef(this.defaults,e);var t=a5(e.baseURL,e.url);return o5(t,e.params,e.paramsSerializer)};J0.forEach(["delete","get","head","options"],function(e){Oa.prototype[e]=function(t,r){return this.request(ef(r||{},{method:e,url:t,data:(r||{}).data}))}});J0.forEach(["post","put","patch"],function(e){function t(r){return function(s,o,a){return this.request(ef(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Oa.prototype[e]=t(),Oa.prototype[e+"Form"]=t(!0)});var l5=Oa,lm,WE;function c5(){if(WE)return lm;WE=1;var n=Yh();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(o){r=o});var i=this;this.promise.then(function(s){if(i._listeners){for(var o=i._listeners.length;o-- >0;)i._listeners[o](s);i._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(l){i.subscribe(l),o=l}).then(s);return a.cancel=function(){i.unsubscribe(o)},a},t(function(o,a,l){i.reason||(i.reason=new n(o,a,l),r(i.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(this._listeners){var i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}},e.source=function(){var r,i=new e(function(o){r=o});return{token:i,cancel:r}},lm=e,lm}var cm,GE;function u5(){return GE||(GE=1,cm=function(e){return function(r){return e.apply(null,r)}}),cm}var um,KE;function d5(){if(KE)return um;KE=1;var n=vt;return um=function(t){return n.isObject(t)&&t.isAxiosError===!0},um}var bv=vt,h5=uR,cd=l5,f5=OR,p5=G0,m5=_R;function RR(n){var e=new cd(n),t=h5(cd.prototype.request,e);return bv.extend(t,cd.prototype,e),bv.extend(t,e),t.create=function(i){return RR(f5(n,i))},t}var en=RR(p5);en.Axios=cd;en.CanceledError=Yh();en.CancelToken=c5();en.isCancel=xR();en.VERSION=PR().version;en.toFormData=Xh;en.AxiosError=vo;en.Cancel=en.CanceledError;en.all=function(e){return Promise.all(e)};en.spread=u5();en.isAxiosError=d5();en.formToJSON=function(n){return m5(bv.isHTMLForm(n)?new FormData(n):n)};q0.exports=en;q0.exports.default=en;var g5=q0.exports,v5=g5;const kR=pi(v5);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Q0=n=>(n==null?void 0:n.type)==="fluid";function zr(n){if(!Q0(n))throw new Error(`resolved is not a Fluid url. Type: ${n==null?void 0:n.type}`)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class X0{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach(t=>{this.protocolToDocumentFactoryMap.set(t.protocolName,t)})}static create(e){if(Array.isArray(e)){const t=[];return e.forEach(r=>{const i=r;i.protocolToDocumentFactoryMap!==void 0?t.push(...i.protocolToDocumentFactoryMap.values()):t.push(r)}),t.length===1?t[0]:new X0(t)}return e}async createDocumentService(e,t,r){zr(e);const i=mv(e.url);if(i.protocol===void 0||i.protocol===null)throw new Error("No protocol provided");const s=this.protocolToDocumentFactoryMap.get(i.protocol);if(s===void 0)throw new Error("Unknown Fluid protocol");return s.createDocumentService(e,t,r)}async createContainer(e,t,r,i){zr(t);const s=mv(t.url);if(s.protocol===void 0||s.protocol===null)throw new Error("No protocol provided");const o=this.protocolToDocumentFactoryMap.get(s.protocol);if(o===void 0)throw new Error("Unknown Fluid protocol");return o.createContainer(e,t,r,i)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function y5(n,e){let t;for(const r of n)if(t=await r.resolve(Object.assign({},e)),t!==void 0)return t}class Y0{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?e.length===1?e[0]:new Y0(e):e}async resolve(e){return y5(this.urlResolvers,e)}async getAbsoluteUrl(e,t){throw new Error("Not implmented")}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var dm,Xi;(function(n){n[n.Offline=0]="Offline",n[n.Online=1]="Online",n[n.Unknown=2]="Unknown"})(Xi||(Xi={}));function Z0(){return typeof navigator=="object"&&navigator!==null&&typeof navigator.onLine=="boolean"?navigator.onLine?Xi.Online:Xi.Offline:Xi.Unknown}class wv extends ue{constructor(e,t,r){super(e,r),this.canRetry=t,this.errorType=Ln.genericNetworkError}}const JE="deltaStreamConnectionForbidden";class tf extends ue{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=tf.errorType,this.canRetry=!1}}tf.errorType=(dm=Ln[JE])!==null&&dm!==void 0?dm:JE;class S5 extends ue{constructor(e,t,r,i){super(e,i,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=r,this.errorType=Ln.authorizationError,this.canRetry=!1}}class b5 extends ue{constructor(e,t,r,i){super(e,i),this.errorType=t,this.canRetry=r}}class nf extends b5{constructor(e,t,r){super(e,t,!1,r),this.errorType=t}}class w5 extends ue{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=Ln.throttlingError,this.canRetry=!0}}const C5=(n,e)=>new nf(n,Ln.writeError,e);function Pa(n,e,t){return e.retryAfterMs!==void 0&&e.canRetry?new w5(n,e.retryAfterMs/1e3,t):new wv(n,e.canRetry,t)}const Qc=n=>(n==null?void 0:n.canRetry)===!0,QE=n=>n==null?void 0:n.retryAfterSeconds,Zd=n=>(n==null?void 0:n.retryAfterSeconds)!==void 0?n.retryAfterSeconds*1e3:void 0;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function mt(n,e){const t=await n.readBlob(e),r=TH(t,"utf8");return JSON.parse(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ud(n,e){return{type:qs.Tree,tree:{".protocol":e,".app":n}}}function E5(n){var e;const t=n.tree.attributes,r=JSON.parse(t.content);return r.term=(e=r.term)!==null&&e!==void 0?e:1,r}function _5(n){const e=n.tree.quorumValues;return JSON.parse(e.content)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Cv(n,e,t){var r,i;const s=Object.assign({},e),o=t.online;if(s.online=typeof o=="string"?o:Xi[Z0()],typeof navigator=="object"&&navigator!==null){const a=navigator,l=(i=(r=a.connection)!==null&&r!==void 0?r:a.mozConnection)!==null&&i!==void 0?i:a.webkitConnection;l!==null&&typeof l=="object"&&(s.connectionType=l.type)}s.category=Qc(t)?"generic":"error",n.sendTelemetryEvent(s,t)}function Ev(n){return new Promise(t=>{let r=t,i=n;Z0()===Xi.Offline&&(window==null?void 0:window.addEventListener)!==void 0&&(r=()=>{t(),window.removeEventListener("online",r)},window.addEventListener("online",r,!1),i=Math.max(n,3e4)),setTimeout(r,i)})}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const NR="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const T5=1e4,x5=100;class O5{constructor(e,t,r,i,s,o){this.to=t,this.payloadSize=r,this.logger=i,this.requestCallback=s,this.responseCallback=o,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new LP,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=t!==void 0}get working(){return this.workingState==="working"}get canceled(){return this.workingState==="canceled"}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(e){Ne(e>0,258),Ne(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){Ne(this.to!==void 0,260),Ne(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(e===void 0)break;this.results.delete(this.nextToDeliver),Ne(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(this.requestsInFlight===0?(Ne(this.results.size===0,263),this.done()):this.to!==void 0&&this.nextToDeliver>=this.to&&(Ne(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;if(!(this.to!==void 0&&this.to<=e))return this.latestRequested+=this.payloadSize,this.to!==void 0&&(this.latestRequested=Math.min(this.to,this.latestRequested)),Ne(e<this.latestRequested,265),{from:e,to:this.latestRequested}}addRequest(){const e=this.getNextChunk();e!==void 0&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}async addRequestCore(e,t){Ne(this.working,266);let r=e,i=t;for(this.requestsInFlight++;this.working;){const s=i-r;Ne(s>0,267),this.to!==void 0&&(Ne(r<this.to,268),Ne(i<=this.to,269)),this.requests++;const o=this.requestCallback(this.requests,r,i,this.to!==void 0,{});this.dispatch();const{payload:a,cancel:l,partial:c}=await o;if(l&&this.cancel(),this.to!==void 0&&r>=this.to){Ne(!this.knewTo,270),a.length!==0&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:r,to:i,end:this.to,length:a.length});break}if(this.working){const u=r,d=a.length;let h=s<=d;if(d!==0){s<d&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:r,to:i,length:d});const f=a.splice(0,s);this.results.set(r,f),r+=f.length}else Ne(!c,271),Ne(!this.knewTo,272);if(!c&&!h){if(!this.knewTo){(this.to===void 0||this.to>r)&&(this.to=r);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:u,to:i,length:d})}if(i===this.latestRequested&&(a.length!==0&&(this.results.set(r,a),r+=a.length),this.latestRequested=r,h=!0),h){const f=this.getNextChunk();if(f===void 0)break;r=f.from,i=f.to}}}this.requestsInFlight--,this.dispatch()}}class P5{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){Ne(!this.done,274),this.deferred?(Ne(this.queue.length===0,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}async read(){Ne(this.deferred===void 0,276);const e=this.queue.shift();return e!==void 0?e:(Ne(!this.done,277),this.deferred=new LP,this.deferred.promise)}}async function R5(n,e,t,r,i,s){let o,a=0;const l=[],c={partial:!1,cancel:!0,payload:[]};for(;(i==null?void 0:i.aborted)!==!0;){a++;let u=Math.min(T5,x5*Math.pow(2,a));const d=Di.now();try{const h=n(Object.assign(Object.assign({},e),{retry:a})),{messages:f,partialResult:p}=await h;if(l.push(...f),f.length!==0||!t)return{payload:l,cancel:!1,partial:p};if(o===void 0)o=Di.now();else if(Di.now()-o>3e4)throw Pa("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:a,driverVersion:NR},e))}catch(h){const f=Qc(h);o=void 0;const p=Zd(h);if(Cv(r,Object.assign(Object.assign({eventName:"GetDeltas_Error"},e),{retry:a,duration:Di.now()-d,retryAfter:p,reason:s}),h),!f)throw h;p!==void 0&&p>=0&&(u=p)}await Ev(u)}return c}function k5(n,e,t,r,i,s,o,a){let l=0,c,u=0;const d=new P5,h={fromTotal:t,toTotal:r},f=he.start(s,Object.assign(Object.assign({eventName:"GetDeltas"},h),{reason:a})),p=new O5(t,r,i,s,async(S,m,v,y,b)=>(l++,R5(async w=>n(m,v,w),Object.assign(Object.assign({request:S,from:m,to:v},h),b),y,s,o,a)),S=>{c===void 0?Ne(S[0].sequenceNumber===t,621):Ne(S[0].sequenceNumber===c+1,622),c=S[S.length-1].sequenceNumber,Ne(c-S[0].sequenceNumber+1===S.length,623),u+=S.length,d.pushValue(S)}),g=S=>{p.cancel()};return o!==void 0&&o.addEventListener("abort",g),p.run(e).finally(()=>{o!==void 0&&o.removeEventListener("abort",g)}).then(()=>{const S={lastFetch:c,length:u,requests:l};p.canceled?f.cancel(Object.assign(Object.assign({},S),{error:"ops request cancelled by client"})):(Ne(r===void 0||c!==void 0&&c>=r-1,624),f.end(S)),d.pushDone()}).catch(S=>{f.cancel({lastFetch:c,length:u,requests:l},S),d.pushError(S)}),d}const N5={read:async()=>({done:!0})};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class L5 extends N0{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:_a.NoCaching})}async getSnapshotTree(e){const t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then(r=>{r!=null&&this.prefetchTree(r)}),t}async readBlob(e){return this.cachedRead(e)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(e){if(this.prefetchEnabled){const t=this.prefetchCache.get(e);if(t!==void 0)return t;const r=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,r.catch(i=>{throw Qc(i)&&this.prefetchCache.delete(e),i})),r}return this.internalStorageService.readBlob(e)}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const r of t)this.cachedRead(r)}prefetchTreeCore(e,t){for(const r of Object.keys(e.blobs)){const i=e.blobs[r];r.startsWith(".")||r==="header"||r.startsWith("quorum")?i!==null&&this.cachedRead(i):r.startsWith("deltas")||i!==null&&t.push(i)}for(const r of Object.keys(e.trees))this.prefetchTreeCore(e.trees[r],t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let eh=class{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const t=this.tasks.shift();if(t!==void 0)return t();this.maxRequests++},Ne(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(this.maxRequests>0){this.maxRequests--;return}return new Promise(e=>{this.tasks.push(e)})}async schedule(e){return await this.acquire(),e().finally(this.release)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function eS(n,e,t,r){var i,s;let o,a=!1,l=1e3,c=0;const u=Di.now();let d;do try{o=await n(r.cancel),a=!0}catch(h){if(!Qc(h))throw t.sendTelemetryEvent({eventName:`${e}_cancel`,retry:c,duration:Di.now()-u,fetchCallName:e},h),h;if(((i=r.cancel)===null||i===void 0?void 0:i.aborted)===!0)throw t.sendTelemetryEvent({eventName:`${e}_runWithRetryAborted`,retry:c,duration:Di.now()-u,fetchCallName:e},h),new nf("runWithRetry was Aborted",Ln.genericError,{driverVersion:NR,fetchCallName:e});c++,d=h,l=(s=Zd(h))!==null&&s!==void 0?s:Math.min(l*2,8e3),r.onRetry&&r.onRetry(l,h),await xH(l)}while(!a);return c>0&&t.sendTelemetryEvent({eventName:`${e}_lastError`,retry:c,duration:Di.now()-u,fetchCallName:e},d),o}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class I5{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:qs.Tree,tree:Object.assign({},this.summaryTree),unreferenced:(e=this.props)===null||e===void 0?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:qs.Blob,content:t}}addHandle(e,t,r){this.summaryTree[e]={type:qs.Handle,handleType:t,handle:r}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:qs.Attachment}}}function LR(n,e){const t=new I5({unreferenced:n.unreferenced});for(const[r,i]of Object.entries(n.blobs)){const s=e.get(i);Ne(s!==void 0,733),t.addBlob(r,L0.from(s).toString("utf-8"))}for(const[r,i]of Object.entries(n.trees)){const s=LR(i,e);t.addTree(r,s)}return t.summary}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function A5(n){if(Sc(n))return!0;switch(n.type){case Gs.Propose:case Gs.Reject:case Gs.NoOp:return!0;default:return!1}}function Sc(n){return n.type===Gs.Operation||n.type===Gs.Summarize}var _v;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(_v||(_v={}));function bc(n){return!!Object.values(_v).includes(n.type)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var zn;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(zn||(zn={}));var XE;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(XE||(XE={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var wn;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(wn||(wn={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var th;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(th||(th={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class M5 extends mn.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return t!==void 0?(this.members.delete(e),this.emit("removeMember",e,t),!0):!1}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const D5="Code package does not implement IRuntimeFactory";class tS{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g){this.container=e,this.scope=t,this.codeLoader=r,this._codeDetails=i,this._baseSnapshot=s,this.deltaManager=o,this.loader=l,this.submitFn=c,this.submitSignalFn=u,this.closeFn=d,this.version=h,this.updateDirtyContainerState=f,this.existing=p,this.pendingLocalState=g,this._disposed=!1,this._quorum=a,this.taggedLogger=e.subLogger,this._fluidModuleP=new _2(async()=>this.loadCodeModule(i)),this.attachListener()}static async createOrLoad(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g){const S=new tS(e,t,r,i,s,o,a,l,c,u,d,h,f,p,g);return await S.instantiateRuntime(p),S}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return Q0(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(this._runtime===void 0)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return(e=this._quorum.get("code"))!==null&&e!==void 0?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const r=this.runtime;q(e===this.connected,222),r.setConnectionState(e,t)}process(e,t,r){this.runtime.process(e,t,r)}processSignal(e,t){this.runtime.processSignal(e,t)}async request(e){return this.runtime.request(e)}async getAbsoluteUrl(e){return this.container.getAbsoluteUrl(e)}getPendingLocalState(){return this.runtime.getPendingLocalState()}async satisfies(e){var t;const r=[],i=this.codeLoader;i.IFluidCodeDetailsComparer!==void 0&&r.push(i.IFluidCodeDetailsComparer);const s=await this._fluidModuleP,o=(t=s.module)===null||t===void 0?void 0:t.fluidExport;if((o==null?void 0:o.IFluidCodeDetailsComparer)!==void 0&&r.push(o.IFluidCodeDetailsComparer),r.length===0)return!1;for(const a of r)if(await a.satisfies(s.details,e)===!1)return!1;return!0}notifyAttaching(e){var t,r;this._baseSnapshot=e,(r=(t=this.runtime).notifyAttaching)===null||r===void 0||r.call(t,e),this.runtime.setAttachState(te.Attaching)}async getRuntimeFactory(){var e;const t=(e=(await this._fluidModuleP).module)===null||e===void 0?void 0:e.fluidExport,r=t==null?void 0:t.IRuntimeFactory;if(r===void 0)throw new Error(D5);return r}async instantiateRuntime(e){const t=await this.getRuntimeFactory();this._runtime=await t.instantiateRuntime(this,e)}attachListener(){this.container.once("attached",()=>{this.runtime.setAttachState(te.Attached)})}async loadCodeModule(e){const t=await he.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},async()=>this.codeLoader.load(e));if("module"in t){const{module:r,details:i}=t;return{module:r,details:i??e}}else return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Gt;(function(n){n.Never="Never",n.Disabled="Disabled",n.Enabled="Enabled"})(Gt||(Gt={}));const F5=n=>{let e;return n&&"name"in n?e=n:LO(n==null?void 0:n.package)?e=n==null?void 0:n.package.name:e=n==null?void 0:n.package,{name:e}};var rf={exports:{}};const{AbortController:IR,AbortSignal:z5}=typeof self<"u"?self:typeof window<"u"?window:void 0;rf.exports=IR;rf.exports.AbortSignal=z5;rf.exports.default=IR;var $5=rf.exports;const Tv=pi($5);function xe(n){if(this._capacity=MR(n),this._length=0,this._front=0,AR(n)){for(var e=n.length,t=0;t<e;++t)this[t]=n[t];this._length=e}}xe.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,i=this._capacity,s=0;s<e;++s)t[s]=this[r+s&i-1];return t};xe.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var i=this._capacity;if(r+t>i){for(var o=0;o<t;++o){this._checkCapacity(r+1);var s=this._front+r&this._capacity-1;this[s]=arguments[o],r++,this._length=r}return r}else{for(var s=this._front,o=0;o<t;++o)this[s+r&i-1]=arguments[o],s++;return this._length=r+t,r+t}}if(t===0)return r;this._checkCapacity(r+1);var o=this._front+r&this._capacity-1;return this[o]=e,this._length=r+1,r+1};xe.prototype.pop=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}};xe.prototype.shift=function(){var e=this._length;if(e!==0){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}};xe.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){var o=this._capacity;if(t+r>o){for(var a=r-1;a>=0;a--){this._checkCapacity(t+1);var o=this._capacity,i=(this._front-1&o-1^o)-o;this[i]=arguments[a],t++,this._length=t,this._front=i}return t}else{for(var s=this._front,a=r-1;a>=0;a--){var i=(s-1&o-1^o)-o;this[i]=arguments[a],s=i}return this._front=s,this._length=t+r,t+r}}if(r===0)return t;this._checkCapacity(t+1);var o=this._capacity,a=(this._front-1&o-1^o)-o;return this[a]=e,this._length=t+1,this._front=a,t+1};xe.prototype.peekBack=function(){var e=this._length;if(e!==0){var t=this._front+e-1&this._capacity-1;return this[t]}};xe.prototype.peekFront=function(){if(this._length!==0)return this[this._front]};xe.prototype.get=function(e){var t=e;if(t===(t|0)){var r=this._length;if(t<0&&(t=t+r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}};xe.prototype.isEmpty=function(){return this._length===0};xe.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,i=0;i<e;++i)this[t+i&r-1]=void 0;this._length=0,this._front=0};xe.prototype.toString=function(){return this.toArray().toString()};xe.prototype.valueOf=xe.prototype.toString;xe.prototype.removeFront=xe.prototype.shift;xe.prototype.removeBack=xe.prototype.pop;xe.prototype.insertFront=xe.prototype.unshift;xe.prototype.insertBack=xe.prototype.push;xe.prototype.enqueue=xe.prototype.push;xe.prototype.dequeue=xe.prototype.shift;xe.prototype.toJSON=xe.prototype.toArray;Object.defineProperty(xe.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}});xe.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(MR(this._capacity*1.5+16))};xe.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,i=this._length;if(r+i>t){var s=r+i&t-1;j5(this,0,this,t,s)}};var AR=Array.isArray;function j5(n,e,t,r,i){for(var s=0;s<i;++s)t[s+r]=n[s+e],n[s+e]=void 0}function q5(n){return n=n>>>0,n=n-1,n=n|n>>1,n=n|n>>2,n=n|n>>4,n=n|n>>8,n=n|n>>16,n+1}function MR(n){if(typeof n!="number")if(AR(n))n=n.length;else return 16;return q5(Math.min(Math.max(16,n),1073741824))}var B5=xe;const xv=pi(B5);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Ov extends Uh{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new xv,this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return this.pauseCount!==0}get length(){return this.q.length}get idle(){return this.processingPromise===void 0&&this.q.length===0}async waitTillProcessingDone(){var e;return(e=this.processingPromise)!==null&&e!==void 0?e:{count:0,duration:0}}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){q(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&this.processingPromise===void 0&&(this.processingPromise=Promise.resolve().then(()=>{q(this.processingPromise!==void 0,"reentrancy?");const e=this.processDeltas();return q(this.processingPromise!==void 0,"reentrancy?"),this.processingPromise=void 0,e}).catch(e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0})),q(this.processingPromise!==void 0,"processDeltas() should run async"))}anythingToProcess(){return this.q.length!==0&&!this.paused&&this.error===void 0}processDeltas(){const e=zt.now();let t=0;for(;this.anythingToProcess();){const i=this.q.shift();t++,this.worker(i),this.emit("op",i)}const r=zt.now()-e;return this.q.length===0&&this.emit("idle",t,r),{count:t,duration:r}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class U5 extends Uh{constructor(e,t,r,i){super(),this.serviceProvider=e,this.logger=t,this._active=r,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new Tv,this.deltaStorageDelayId=ot(),this.deltaStreamDelayId=ot(),this.messageBuffer=[];const s={incomingOpHandler:(o,a)=>{try{this.enqueueMessages(o,a)}catch(l){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},l),this.close(lr(l))}},signalHandler:o=>this._inboundSignal.push(o),reconnectionDelayHandler:(o,a)=>this.emitDelayInfo(this.deltaStreamDelayId,o,a),closeHandler:o=>this.close(o),disconnectHandler:o=>this.disconnectHandler(o),connectHandler:o=>this.connectHandler(o),pongHandler:o=>this.emit("pong",o),readonlyChangeHandler:o=>SH(this,this.logger,"readonly",o)};this.connectionManager=i(s),this._inbound=new Ov(o=>{this.processInboundMessage(o)}),this._inbound.on("error",o=>{this.close(Nn.wrapIfUnrecognized(o,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new Ov(o=>{if(this.handler===void 0)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:o.clientId,content:JSON.parse(o.content)})}),this._inboundSignal.on("error",o=>{this.close(lr(o))})}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return q(this.connectionManager.connected,223),this._checkpointSequenceNumber!==void 0}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,r=!1,i){const s={contents:JSON.stringify(t),metadata:i,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};r||this.flush();const o=this.connectionManager.prepareMessageToSend(s);return o===void 0?-1:(this.opsSize+=o.contents.length,this.messageBuffer.push(o),this.emit("submitOp",o),r||this.flush(),o.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){this.messageBuffer.length!==0&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;q(this.connectionManager.connected,568);const r=this.pending.sort((i,s)=>i.sequenceNumber-s.sequenceNumber);this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:(t=r[0])===null||t===void 0?void 0:t.sequenceNumber,haveHandler:this.handler!==void 0,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const r=e.checkpointSequenceNumber;this._checkpointSequenceNumber=r,r!==void 0&&this.updateLatestKnownOpSeqNumber(r),q(this.messageBuffer.length===0,233),this.opsSize=0,this.emit("connect",e,r!==void 0?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),r!==void 0?r>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):e.mode==="read"&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}async attachOpHandler(e,t,r,i,s="none"){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=r,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,q(this.handler===void 0,226),this.handler=i,q(!!this.handler,227),q(this.fetchReason===void 0,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),s!=="none"){const o=s==="cached";await this.fetchMissingDeltasCore(`DocumentOpen_${s}`,o),o&&this.fetchMissingDeltas("PostDocumentOpen")}q(this.fetchReason!==void 0||this.pending.length===0,617)}}connect(e){var t;const r=(t=e.fetchOpsFromStorage)!==null&&t!==void 0?t:!0;bH(this.handler!==void 0||!r,this.logger,"CantFetchWithoutBaseline"),r&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}async getDeltas(e,t,r,i,s){const o=this.serviceProvider();if(o===void 0)throw new Error("Delta manager is not attached");this.deltaStorage===void 0&&(this.deltaStorage=await o.connectToDeltaStorage());let a;if(t!==void 0){const d=t-1;if(this.lastQueuedSequenceNumber>=d){this.logger.sendPerformanceEvent(Object.assign({reason:r,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));return}a=h=>h.sequenceNumber>=d}else a=d=>d.sequenceNumber>=this.lastObservedSeqNumber;const l=new Tv;let c=!1;const u=d=>{q(d.sequenceNumber===this.lastQueuedSequenceNumber,570),!c&&a(d)&&(l.abort(),this._inbound.off("push",u))};try{this._inbound.on("push",u),q(this.closeAbortController.signal.onabort===null,488),this.closeAbortController.signal.onabort=()=>l.abort();const d=this.deltaStorage.fetchMessages(e,t,l.signal,s,r);for(;;){const h=await d.read();if(h.done)break;try{c=!0,i(h.value)}finally{c=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",u),q(!c,649)}}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),this.throttlingIdSet.size===0&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,r){const i=Date.now();if(this.throttlingIdSet.add(e),t>0&&i+t>this.timeTillThrottling){this.timeTillThrottling=i+t;const s=k0.wrap(r,t/1e3,this.logger);this.emit("throttled",s)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,r=!1){var i,s;if(this.handler===void 0){this.pending=this.pending.concat(e);return}if(q(this.pending.length===0||this.fetchReason!==void 0,489),e.length===0)return;const o=e[0].sequenceNumber,a=e[e.length-1].sequenceNumber;if(a>this.lastQueuedSequenceNumber){let c=o-1;const u=c-this.lastQueuedSequenceNumber;let d,h=0,f=0;for(const g of e)g.sequenceNumber===c?h++:g.sequenceNumber!==c+1&&(f++,d===void 0&&(d=c+1)),c=g.sequenceNumber;let p;h!==0||f!==0&&!r||u>0&&this.fetchReason===void 0?p="enqueueMessages":this.fetchReason!==void 0&&this.fetchReason!==t&&o<=this.lastQueuedSequenceNumber+1&&a>this.lastQueuedSequenceNumber&&(p="enqueueMessagesExtraFetch"),p!==void 0&&this.logger.sendPerformanceEvent(Object.assign({eventName:p,reason:t,previousReason:this.prevEnqueueMessagesReason,from:o,to:a+1,length:e.length,fetchReason:this.fetchReason,duplicate:h>0?h:void 0,initialGap:u!==0?u:void 0,gap:f>0?f:void 0,firstMissing:d,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const l=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;q(l===void 0||l===this.lastQueuedSequenceNumber,236);for(const c of e)if(c.sequenceNumber<=this.lastQueuedSequenceNumber){if(((s=this.previouslyProcessedMessage)===null||s===void 0?void 0:s.sequenceNumber)===c.sequenceNumber){const u=this.comparableMessagePayload(this.previouslyProcessedMessage),d=this.comparableMessagePayload(c);if(u!==d){const h=new nf("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",Ln.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:c.sequenceNumber,message1:u,message2:d,driverVersion:void 0});this.close(h)}}}else c.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(c),this.fetchMissingDeltas(t,c.sequenceNumber)):(this.lastQueuedSequenceNumber=c.sequenceNumber,this.previouslyProcessedMessage=c,this._inbound.push(c));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,q(e.clientId!==void 0||!A5(e),237),typeof e.contents=="string"&&e.contents!==""&&e.type!==zn.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new Rr("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},ro(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new Rr("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},ro(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,q(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),e.term===void 0&&(e.term=1),this.baseTerm=e.term,this.handler===void 0)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const r=Date.now();this.emit("op",e,r-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch(r=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},r)})}async fetchMissingDeltasCore(e,t,r){var i;if(this.fetchReason===void 0){if(this.closed){this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});return}if(this.handler===void 0){q(this.lastQueuedSequenceNumber===0,619);return}try{let s=this.lastQueuedSequenceNumber+1;const o=(i=this.previouslyProcessedMessage)===null||i===void 0?void 0:i.sequenceNumber;o!==void 0&&(q(o===this.lastQueuedSequenceNumber,242),q(s>1,243),s--);const a=`${e}_fetch`;this.fetchReason=a,await this.getDeltas(s,r,a,l=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(l,a)},t)}catch(s){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},s),this.close(lr(s))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}}}processPendingOps(e){if(this.closed)return;q(this.handler!==void 0,620);const t=this.pending.sort((r,i)=>r.sequenceNumber-i.sequenceNumber);this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),this.fetchReason===void 0&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hm extends Uc{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}async systemPause(){return this.pause()}async pause(){return this.queue.pause()}async systemResume(){return this.resume()}async resume(){this.queue.resume()}async waitTillProcessingDone(){return this.queue.waitTillProcessingDone()}}class H5 extends Uc{constructor(e){super(e),this.deltaManager=e,this.inbound=new hm(e.inbound),this.outbound=new hm(e.outbound),this.inboundSignal=new hm(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function fm(n){var e;const t=mv(n,!0);if(typeof t.pathname!="string")throw new ue("Failed to parse pathname");const r=(e=t.search)!==null&&e!==void 0?e:"",s=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(t.pathname);return(s==null?void 0:s.length)===3?{id:s[1],path:s[2],query:r,version:t.query.version}:void 0}function DR(n){const e={blobs:{},blobsContents:{},trees:{},id:ot(),unreferenced:n.unreferenced},t=Object.keys(n.tree);for(const r of t){const i=n.tree[r];switch(i.type){case wn.Tree:{e.trees[r]=DR(i);break}case wn.Attachment:e.blobs[r]=i.id;break;case wn.Blob:{const s=ot();e.blobs[r]=s;const o=typeof i.content=="string"?p2(i.content,"utf8"):eH(i.content);e.blobsContents[s]=o;break}case wn.Handle:throw new ue("No handles should be there in summary in detached container!!");default:nv(i,`Unknown tree type ${i.type}`)}}return e}function V5(n,e){const t={type:wn.Tree,tree:Object.assign({},e.tree)};return t.tree[".protocol"]=n,DR(t)}const pm=n=>{const e=n.tree[".protocol"],t=n.tree[".app"];return q(e!==void 0&&t!==void 0,480),V5(e,t)};function YE(n){return".protocol"in n.trees?n.trees[".protocol"]:n}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const FR="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function zR(n){return n.headers===void 0?!0:n.headers[Ge.cache]!==!1}class W5{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}async resolve(e){var t,r,i,s,o;if(e.url.startsWith("/")){if(zR(e))return this.container;{const a=this.container.resolvedUrl;return zr(a),await Tr.load(this.loader,{canReconnect:(t=e.headers)===null||t===void 0?void 0:t[Ge.reconnect],clientDetailsOverride:(r=e.headers)===null||r===void 0?void 0:r[Ge.clientDetails],resolvedUrl:Object.assign({},a),version:(s=(i=e.headers)===null||i===void 0?void 0:i[Ge.version])!==null&&s!==void 0?s:void 0,loadMode:(o=e.headers)===null||o===void 0?void 0:o[Ge.loadMode]})}}if(this.loader===void 0)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)}async request(e){return e.url.startsWith("/")?(await this.resolve(e)).request(e):this.loader===void 0?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)}}function G5(n){const e=Object.create(n),t=new Map;return e.resolve=async r=>zR(r)?(t.has(r.url)||t.set(r.url,n.resolve(r)),t.get(r.url)):n.resolve(r),e}class K5{constructor(e){var t,r;this.containers=new Map;const i=Object.assign({},e.scope);((t=e.options)===null||t===void 0?void 0:t.provideScopeLoader)!==!1&&(i.ILoader=this);const s={loaderId:ot(),loaderVersion:FR},o=T0(zl.mixinDebugLogger("fluid:telemetry",e.logger,{all:s}),SP.value,e.configProvider);this.services={urlResolver:G5(Y0.create(e.urlResolver)),documentServiceFactory:X0.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:(r=e.options)!==null&&r!==void 0?r:{},scope:i,subLogger:o.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=qa(pe.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}async createDetachedContainer(e){const t=await Tr.createDetached(this,e);return this.cachingEnabled&&t.once("attached",()=>{zr(t.resolvedUrl);const r=fm(t.resolvedUrl.url);r!==void 0&&this.addToContainerCache(r.id,Promise.resolve(t))}),t}async rehydrateDetachedContainerFromSnapshot(e){return Tr.rehydrateDetachedFromSnapshot(this,e)}async resolve(e,t){const r=t===void 0?"Resolve":"ResolveWithPendingState";return he.timedExecAsync(this.mc.logger,{eventName:r},async()=>(await this.resolveCore(e,t!==void 0?JSON.parse(t):void 0)).container)}async request(e){return he.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>{const t=await this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))})}getKeyForContainerCache(e,t){var r;return((r=e.headers)===null||r===void 0?void 0:r[Ge.version])!==void 0?`${t.id}@${e.headers[Ge.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then(r=>{r.closed?this.containers.delete(e):r.once("closed",()=>{this.containers.delete(e)})}).catch(r=>{})}async resolveCore(e,t){const r=await this.services.urlResolver.resolve(e);zr(r);const i=fm(r.url);if(i===void 0)throw new Error(`Invalid URL ${r.url}`);if(t!==void 0){const c=fm(t.url);if((c==null?void 0:c.id)!==i.id||(c==null?void 0:c.path.replace(/\/$/,""))!==i.path.replace(/\/$/,"")){const u=`URL ${r.url} does not match pending state URL ${t.url}`;throw new Error(u)}}const{canCache:s,fromSequenceNumber:o}=this.parseHeader(i,e),a=t!==void 0?!1:s;let l;if(a){const c=this.getKeyForContainerCache(e,i),u=await this.containers.get(c);if(u!==void 0)l=u;else{const d=this.loadContainer(e,r);this.addToContainerCache(c,d),l=await d}}else l=await this.loadContainer(e,r,t);return l.deltaManager.lastSequenceNumber<=o&&await new Promise((c,u)=>{function d(h){h.sequenceNumber>o&&(c(),l.removeListener("op",d))}l.on("op",d)}),{container:l,parsed:i}}get cachingEnabled(){return this.services.options.cache!==!1}canCacheForRequest(e){return this.cachingEnabled&&e[Ge.cache]!==!1}parseHeader(e,t){var r,i;let s=-1;t.headers=(r=t.headers)!==null&&r!==void 0?r:{};const o=t.headers[Ge.sequenceNumber];return o!==void 0&&(s=o),t.headers[Ge.version]=(i=e.version)!==null&&i!==void 0?i:t.headers[Ge.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:s}}async loadContainer(e,t,r){var i,s,o,a,l;return Tr.load(this,{canReconnect:(i=e.headers)===null||i===void 0?void 0:i[Ge.reconnect],clientDetailsOverride:(s=e.headers)===null||s===void 0?void 0:s[Ge.clientDetails],resolvedUrl:t,version:(a=(o=e.headers)===null||o===void 0?void 0:o[Ge.version])!==null&&a!==void 0?a:void 0,loadMode:(l=e.headers)===null||l===void 0?void 0:l[Ge.loadMode]},r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const J5=45e3;class Q5{constructor(e,t,r){var i;this.handler=e,this.logger=t,this._clientId=r,this._connectionState=Oe.Disconnected,this.prevClientLeftTimer=new tv((i=this.handler.maxClientLeaveWaitTime)!==null&&i!==void 0?i:3e5,()=>{q(!this.connected,684),this.applyForConnectedState("timeout")}),this.joinOpTimer=new tv(J5,()=>{var s;if(this.connectionState!==Oe.CatchingUp)return;const o=this.handler.quorumClients(),a={quorumInitialized:o!==void 0,hasPendingClientId:this.pendingClientId!==void 0,inQuorum:(o==null?void 0:o.getMember((s=this.pendingClientId)!==null&&s!==void 0?s:""))!==void 0,waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",a)})}get connectionState(){return this._connectionState}get connected(){return this.connectionState===Oe.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){q(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){q(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){q(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=he.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,r;const i=this.handler.quorumClients();q(i!==void 0,566),q(this.waitingForLeaveOp===!1||this.clientId!==void 0&&i.getMember(this.clientId)!==void 0,738),this.pendingClientId!==this.clientId&&this.pendingClientId!==void 0&&i.getMember(this.pendingClientId)!==void 0&&!this.waitingForLeaveOp?((t=this.waitEvent)===null||t===void 0||t.end({source:e}),this.setConnectionState(Oe.Connected)):this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:e==="timeout"?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:(i==null?void 0:i.getMember((r=this.pendingClientId)!==null&&r!==void 0?r:""))!==void 0})})}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(Oe.Disconnected,e)}receivedConnectEvent(e,t){const r=this._connectionState;this._connectionState=Oe.CatchingUp;const i=e==="write";q(i||!this.handler.shouldClientJoinWrite(),778),q(i||!this.waitingForLeaveOp,678);const s=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(Oe.CatchingUp,r),i&&(s==null?void 0:s.getMember(this._pendingClientId))===void 0?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(Oe.Connected)}setConnectionState(e,t){if(this.connectionState===e){this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});return}const r=this._connectionState;this._connectionState=e;const i=this.handler.quorumClients();let s;this._clientId!==void 0&&(s=i==null?void 0:i.getMember(this._clientId)),e===Oe.Connected?(q(r===Oe.CatchingUp,472),s!==void 0&&(s.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===Oe.Disconnected&&(this._pendingClientId=void 0,s!==void 0&&this.handler.shouldClientJoinWrite()&&this.prevClientLeftTimer.hasTimer===!1?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:s!==void 0,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,r,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",(t,r)=>{this.receivedAddMemberEvent(t)}),e.quorum.on("removeMember",t=>{this.receivedRemoveMemberEvent(t)}),this.clientId!==void 0&&e.quorum.getMember(this.clientId)!==void 0&&this.prevClientLeftTimer.restart()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class X5{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.runWithRetry(async()=>this.internalStorageService.getSnapshotTree(e,t),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry(async()=>this.internalStorageService.readBlob(e),"storage_readBlob")}async getVersions(e,t,r){return this.runWithRetry(async()=>this.internalStorageService.getVersions(e,t,r),"storage_getVersions")}async uploadSummaryWithContext(e,t){return q(t.referenceSequenceNumber===0==(t.ackHandle===void 0),593),t.referenceSequenceNumber!==0?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry(async()=>this.internalStorageService.uploadSummaryWithContext(e,t),"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry(async()=>this.internalStorageService.downloadSummary(e),"storage_downloadSummary")}async createBlob(e){return this.runWithRetry(async()=>this.internalStorageService.createBlob(e),"storage_createBlob")}checkStorageDisposed(){if(this._disposed)throw new ti("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return eS(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Y5{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(ud(e,this.generateProtocolTree()),t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Z5{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,r]of Object.entries(e.blobsContents))this.blobContents[t]=r;for(const[t,r]of Object.entries(e.trees))this.getBlobContents(r)}get policies(){try{return this.storageGetter().policies}catch{}}get repositoryUrl(){return this.storageGetter().repositoryUrl}async getSnapshotTree(e,t){return this.storageGetter().getSnapshotTree(e,t)}async readBlob(e){const t=this.blobContents[e];return t!==void 0?t:this.storageGetter().readBlob(e)}async getVersions(e,t,r){return this.storageGetter().getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.storageGetter().uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storageGetter().downloadSummary(e)}async createBlob(e){return this.storageGetter().createBlob(e)}}class eG{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(e){return this.blobStorage.createBlob(e)}async readBlob(e){return this.blobStorage.readBlob(e)}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class tG extends Uc{constructor(e){super(e),super.setMaxListeners(50),this.propose=dl(this,e.propose.bind(e)),this.has=dl(this,e.has.bind(e)),this.get=dl(this,e.get.bind(e)),this.getMembers=dl(this,e.getMembers.bind(e)),this.getMember=dl(this,e.getMember.bind(e))}}function nG(n){const t=new Map(n).get("code");return q(t!==void 0,732),t==null?void 0:t.value}function ZE(n){return[["code",{key:"code",value:n,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const rG=2e3,iG=50;class sG{constructor(e,t=rG,r=iG){this.submit=e,this.NoopCountFrequency=r,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new tv(t,()=>{this.opsCountSinceNoop!==0&&this.submitNoop(!1)}))}scheduleSequenceNumberUpdate(e,t){if(t){this.submitNoop(!0);return}if(Sc(e)){if(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency){this.submitNoop(!1);return}this.timer!==void 0&&(this.opsCountSinceNoop===1&&this.timer.restart(),q(this.timer.hasTimer,578))}}submitNoop(e){this.submit(zn.NoOp,e?"":null),q(this.opsCountSinceNoop===0,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const oG=8e3,aG=1e3,lG=16*1024,e_={fatalConnectError:!0};function cG(n){const e=`Nack (${n.type}): ${n.message}`,t=n.code!==403,r=n.retryAfter!==void 0?n.retryAfter*1e3:void 0;return Pa(e,{canRetry:t,retryAfterMs:r},{statusCode:n.code,driverVersion:void 0})}class mm extends Uh{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[th.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map(t=>({operation:t,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class nS{constructor(e,t,r,i,s){this.serviceProvider=e,this.client=t,this.logger=i,this.props=s,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(o,a)=>{const l=Array.isArray(a)?a:[a];this.props.incomingOpHandler(l,"opHandler")},this.nackHandler=(o,a)=>{const l=a[0];if(this._readonlyPermissions===!0){this.props.closeHandler(C5("writeOnReadOnlyDocument",{driverVersion:void 0}));return}const c=cG(l.content);if(!c.canRetry){this.props.closeHandler(c);return}this.reconnectOnError("write",c)},this.disconnectHandlerInternal=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.errorHandler=o=>{this.reconnectOnError(this.defaultReconnectionMode,o)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=r?Gt.Enabled:Gt.Never,this._outbound=new Ov(o=>{if(this.connection===void 0)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(o)}),this._outbound.on("error",o=>{this.props.closeHandler(lr(o))})}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return(t=(e=this.connection)===null||e===void 0?void 0:e.mode)!==null&&t!==void 0?t:"read"}get connected(){return this.connection!==void 0}get clientId(){var e;return(e=this.connection)===null||e===void 0?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,r;return(r=(t=(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration)===null||t===void 0?void 0:t.maxMessageSize)!==null&&r!==void 0?r:lG}get version(){if(this.connection===void 0)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return(e=this.connection)===null||e===void 0?void 0:e.serviceConfiguration}get scopes(){var e;return(e=this.connection)===null||e===void 0?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return this.connection!==void 0?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return this._forceReadonly?!0:this._readonlyPermissions}get readOnlyInfo(){const e=this.connection!==void 0&&this.connection instanceof mm;return e||this._forceReadonly||this._readonlyPermissions===!0?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=Gt.Never,this._outbound.clear();const t=e!==void 0?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){q(e!==Gt.Never&&this._reconnectMode!==Gt.Never,632),this._reconnectMode=e,e!==Gt.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===Gt.Never)throw new Te("API is not supported for non-connecting or closed container");let r=!1;this.readonly===!0&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),r=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),r&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch(t=>{const r=lr(t,{props:e_});this.props.closeHandler(r)})}async connectCore(e){var t,r;if(q(!this.closed,618),this.connection!==void 0)return;let i;this.pendingConnection!==void 0&&(i=this.pendingConnection.connectionMode,this.cancelConnection(),q(this.pendingConnection===void 0,836));let s=(t=e??i)!==null&&t!==void 0?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(s="write");const o=this.serviceProvider();q(o!==void 0,679);let a;if(((r=o.policies)===null||r===void 0?void 0:r.storageOnly)===!0){a=new mm,this.setupNewSuccessfulConnection(a,"read"),q(this.pendingConnection===void 0,691);return}let l=aG,c=0;const u=zt.now();let d;const h=new Tv,f=h.signal;for(this.pendingConnection={abort:()=>{h.abort()},connectionMode:s};a===void 0;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(f.aborted===!0){this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:Qe.formatTick(zt.now()-u),connectionEstablished:!1});return}c++;try{this.client.mode=s,a=await o.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:s})),a.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),a=void 0)}catch(p){if(typeof p=="object"&&p!==null&&(p==null?void 0:p.errorType)===tf.errorType){a=new mm,s="read";break}if(!Qc(p)){const S=lr(p,{props:e_});throw this.props.closeHandler(S),S}Cv(this.logger,{attempts:c,delay:l,eventName:"DeltaConnectionFailureToConnect",duration:Qe.formatTick(zt.now()-u)},p),d=p;const g=Zd(p);l=g??Math.min(l*2,oG),g!==void 0&&this.props.reconnectionDelayHandler(g,p),await Ev(l)}}if(c>1&&Cv(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:c,duration:Qe.formatTick(zt.now()-u)},d),f.aborted===!0){a.dispose(),this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:Qe.formatTick(zt.now()-u),connectionEstablished:!0});return}this.setupNewSuccessfulConnection(a,s)}triggerConnect(e){q(this.connection===void 0,569),this.reconnectMode===Gt.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,this.connection===void 0)return this.pendingConnection!==void 0?(this.cancelConnection(),!0):!1;q(this.pendingConnection===void 0,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){q(this.pendingConnection!==void 0,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){q(this.connection===void 0,230),q(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const r=!e.claims.scopes.includes(th.DocWrite);if(q(t==="read"||r===(this.connectionMode==="read"),231),q(!r||this.connectionMode==="read",232),this.set_readonlyPermissions(r),this.closed){this.disconnectFromDeltaStream("ConnectionManager already closed");return}this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const i=e.initialMessages.sort((l,c)=>l.sequenceNumber-c.sequenceNumber);let s=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},e.relayServiceAgent!==void 0&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let o=-1;if(i.length!==0&&(this._connectionVerboseProps.connectionInitialOpsFrom=i[0].sequenceNumber,o=i[i.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=o+1,(s===void 0||s<o)&&(s=o)),this.props.incomingOpHandler(i,this.connectFirstConnection?"InitialOps":"ReconnectOps"),e.initialSignals!==void 0)for(const l of e.initialSignals)this.props.signalHandler(l);const a=nS.detailsFromConnection(e);a.checkpointSequenceNumber=s,this.props.connectHandler(a),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}async reconnect(e,t,r){if(q(this.connection!==void 0,235),this.disconnectFromDeltaStream(t),r!==void 0&&!r.canRetry&&this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},r),this.reconnectMode===Gt.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==Gt.Enabled)return;const i=Zd(r);r!==void 0&&i!==void 0&&(this.props.reconnectionDelayHandler(i,r),await Ev(i)),this.triggerConnect(e)}prepareMessageToSend(e){var t,r;if(this.readonly===!0){q(this.readOnlyInfo.readonly===!0,496);const i=new ti("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(i);return}return q(!!this.connection,228),this.lastSubmittedClientId!==((t=this.connection)===null||t===void 0?void 0:t.clientId)&&(this.lastSubmittedClientId=(r=this.connection)===null||r===void 0?void 0:r.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===zn.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber})}submitSignal(e){this.connection!==void 0?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){if(q(this.connected,692),this.connectionMode==="read"){this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then(async()=>{this.pendingReconnect&&await this.reconnect("write","Switch to write")}).catch(()=>{}));return}q(!this.pendingReconnect,693),this._outbound.push(e)}beforeProcessingIncomingOp(e){if(q(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),this.lastSubmittedClientId!==void 0&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;q(this.clientSequenceNumberObserved<t,239),q(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}e.type===zn.ClientLeave&&JSON.parse(e.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch(i=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},i)}))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const uG=0,t_="dirty",gm="saved",dG=n=>{var e;return(e=n.get("code"))!==null&&e!==void 0?e:n.get("code2")};async function n_(n,e,t){const r=he.start(n,{eventName:e}),i=await t();r.duration>1e3&&r.end(i)}const r_="summarizer";class Tr extends P0{constructor(e,t){var r,i;super((u,d)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:typeof u=="string"?u:void 0},d)}),this.loader=e,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=te.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=zt.now(),this._audience=new M5,this.clientDetailsOverride=t.clientDetailsOverride,this._resolvedUrl=t.resolvedUrl,t.canReconnect!==void 0&&(this._canReconnect=t.canReconnect);const s=this.client.details.type,a=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${s!==void 0&&s!==""?`/${s}`:""}`;this.subLogger=pe.create(e.services.subLogger,void 0,{all:{clientType:a,containerId:ot(),docId:()=>{var u,d;return(d=(u=this._resolvedUrl)===null||u===void 0?void 0:u.id)!==null&&d!==void 0?d:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>Oe[this.connectionState],serializedContainer:t.serializedContainerState!==void 0},error:{dmInitialSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var u;return(u=this._deltaManager)===null||u===void 0?void 0:u.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var u;return(u=this.loadedFromVersion)===null||u===void 0?void 0:u.id},containerLoadedFromVersionDate:()=>{var u;return(u=this.loadedFromVersion)===null||u===void 0?void 0:u.date},dmLastMsqSeqNumber:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.timestamp},dmLastMsqSeqClientId:()=>{var u,d;return(d=(u=this.deltaManager)===null||u===void 0?void 0:u.lastMessage)===null||d===void 0?void 0:d.clientId},connectionStateDuration:()=>zt.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=qa(pe.create(this.subLogger,"Container"));const l=(r=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))!==null&&r!==void 0?r:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:l}),this.connectionStateHandler=new Q5({quorumClients:()=>{var u;return(u=this._protocolHandler)===null||u===void 0?void 0:u.quorum},logConnectionStateChangeTelemetry:(u,d,h)=>this.logConnectionStateChangeTelemetry(u,d,h),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(u,d)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:u,duration:zt.now()-this.connectionTransitionTimes[Oe.CatchingUp]},d===void 0?{}:{details:JSON.stringify(d)}))},connectionStateChanged:()=>{this._lifecycleState==="loaded"&&this.propagateConnectionState()}},this.mc.logger,(i=t.serializedContainerState)===null||i===void 0?void 0:i.clientId),this.on(gm,()=>{this.connectionStateHandler.containerSaved()}),this._deltaManager=this.createDeltaManager(),this._storage=new Z5(()=>{if(this.attachState!==te.Attached){if(this.loader.services.detachedBlobStorage!==void 0)return new eG(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService}),typeof document=="object"&&document!==null&&typeof document.addEventListener=="function"&&document.addEventListener!==null&&(this.lastVisible=document.hidden?zt.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=zt.now():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",(u,d)=>{Promise.resolve().then(()=>{switch(u){case t_:this._dirtyContainer&&d();break;case gm:this._dirtyContainer||d();break;case RP:this.connected&&d(this.clientId);break;case kP:this.connected||d();break}}).catch(h=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},h)})})}static async load(e,t,r){const i=new Tr(e,{clientDetailsOverride:t.clientDetailsOverride,resolvedUrl:t.resolvedUrl,canReconnect:t.canReconnect,serializedContainerState:r});return he.timedExecAsync(i.mc.logger,{eventName:"Load"},async s=>new Promise((o,a)=>{var l,c;const u=t.version,d={opsBeforeReturn:"cached"},h=r?Object.assign(Object.assign({},(l=t.loadMode)!==null&&l!==void 0?l:d),{opsBeforeReturn:void 0}):(c=t.loadMode)!==null&&c!==void 0?c:d,f=p=>{a(p??new ti("Container closed without error during load"))};i.on("closed",f),i.load(u,h,r).finally(()=>{i.removeListener("closed",f)}).then(p=>{s.end(Object.assign(Object.assign({},p),t.loadMode)),o(i)},p=>{const g=lr(p);i.close(g),f(g)})}),{start:!0,end:!0,cancel:"generic"})}static async createDetached(e,t){const r=new Tr(e,{});return he.timedExecAsync(r.mc.logger,{eventName:"CreateDetached"},async i=>(await r.createDetached(t),r),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(e,t){const r=new Tr(e,{});return he.timedExecAsync(r.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},async i=>{const s=JSON.parse(t);return await r.rehydrateDetachedFromSnapshot(s),r},{start:!0,end:!0,cancel:"generic"})}setLoaded(){this._lifecycleState==="loading"&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return this._lifecycleState==="closing"||this._lifecycleState==="closed"}get storage(){return this._storage}get storageService(){if(this._storageService===void 0)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(this._context===void 0)throw new ti("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(this._protocolHandler===void 0)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(e){this._deltaManager.connectionManager.forceReadonly(e)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var e;return(e=this._context)===null||e===void 0?void 0:e.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(e){this._deltaManager.close(e),q(this.connectionState===Oe.Disconnected,207),q(this._lifecycleState==="closed",788)}closeCore(e){var t,r,i,s;q(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:e===void 0?"generic":"error"},e),this._lifecycleState="closing",(t=this._protocolHandler)===null||t===void 0||t.close(),this.connectionStateHandler.dispose(),(r=this._context)===null||r===void 0||r.dispose(e!==void 0?new Error(e.message):void 0),(i=this._storageService)===null||i===void 0||i.dispose(),(s=this.service)===null||s===void 0||s.dispose(e)}catch(o){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},o)}this.emit("closed",e),this.removeAllListeners(),this.visibilityEventHandler!==void 0&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){q(this.attachState===te.Attached,209),q(this.resolvedUrl!==void 0&&this.resolvedUrl.type==="fluid",210),q(!!this._protocolHandler,739),q(this._protocolHandler.attributes.term!==void 0,779);const e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}get attachState(){return this._attachState}serialize(){q(this.attachState===te.Detached,211);const e=this.context.createSummary(),t=this.captureProtocolSummary(),r=ud(e,t);return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(r.tree[".hasAttachmentBlobs"]={type:wn.Blob,content:"true"}),JSON.stringify(r)}async attach(e){await he.timedExecAsync(this.mc.logger,{eventName:"Attach"},async()=>{if(this._lifecycleState!=="loaded")throw new Te(`The Container is not in a valid state for attach [${this._lifecycleState}]`);q(this._attachState===te.Detached&&!this.attachStarted,517),this.attachStarted=!0;const t=this.loader.services.detachedBlobStorage!==void 0&&this.loader.services.detachedBlobStorage.size>0;try{q(this.deltaManager.inbound.length===0,214);let r;if(!t){const o=this.context.createSummary(),a=this.captureProtocolSummary();r=ud(o,a),this._attachState=te.Attaching,this.context.notifyAttaching(pm(r))}const i=await this.urlResolver.resolve(e);zr(i),this.service===void 0&&(q(this.client.details.type!==r_,708),this.service=await eS(async()=>this.serviceFactory.createContainer(r,i,this.subLogger,!1),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));const s=this.service.resolvedUrl;if(zr(s),this._resolvedUrl=s,await this.connectStorageService(),t){q(!!this.loader.services.detachedBlobStorage,590);const o=new Map;for(;o.size<this.loader.services.detachedBlobStorage.size;){const c=this.loader.services.detachedBlobStorage.getBlobIds().filter(u=>!o.has(u));for(const u of c){const d=await this.loader.services.detachedBlobStorage.readBlob(u),h=await this.storageService.createBlob(d);o.set(u,h.id)}}const a=this.context.createSummary(o),l=this.captureProtocolSummary();r=ud(a,l),this._attachState=te.Attaching,this.context.notifyAttaching(pm(r)),await this.storageService.uploadSummaryWithContext(r,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=te.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(r){const i=lr(r),s=this.resolvedUrl;throw Q0(s)&&i.addTelemetryProperties({resolvedUrl:s.url}),this.close(i),i}},{start:!0,end:!0,cancel:"generic"})}async request(e){return he.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>this.context.request(e),{end:!0,cancel:"error"})}setAutoReconnectInternal(e){if(this._deltaManager.connectionManager.reconnectMode===e)return;const r=zt.now(),i=r-this.setAutoReconnectTime;this.setAutoReconnectTime=r,this.mc.logger.sendTelemetryEvent({eventName:e===Gt.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:Oe[this.connectionState],duration:i}),this._deltaManager.connectionManager.setAutoReconnect(e)}connect(){if(this.closed)throw new Te("The Container is closed and cannot be connected");if(this._attachState!==te.Attached)throw new Te("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(e){q(!this.closed,709),q(this._attachState===te.Attached,710),this.resumeInternal(e);const t=Gt.Enabled;this.setAutoReconnectInternal(t)}disconnect(){if(this.closed)throw new Te("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){q(!this.closed,711);const e=Gt.Disabled;this.setAutoReconnectInternal(e)}resumeInternal(e){q(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}async getAbsoluteUrl(e){var t;if(this.resolvedUrl!==void 0)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,e,F5((t=this._context)===null||t===void 0?void 0:t.codeDetails))}async proposeCodeDetails(e){if(!iC(e))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const t=await this.codeLoader.IFluidCodeDetailsComparer.compare(e,this.getCodeDetailsFromQuorum());if(t!==void 0&&t<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",e).then(()=>!0).catch(()=>!1)}async processCodeProposal(){const e=this.getCodeDetailsFromQuorum();if(await Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),await this.context.satisfies(e)===!0){this.deltaManager.inbound.resume(),this.deltaManager.inboundSignal.resume();return}this.close(new ti("Existing context does not satisfy incoming proposal"))}async getVersion(e){return(await this.storageService.getVersions(e,1))[0]}recordConnectStartTime(){this.connectionTransitionTimes[Oe.Disconnected]===void 0&&(this.connectionTransitionTimes[Oe.Disconnected]=zt.now())}connectToDeltaStream(e){this.recordConnectStartTime(),(!this._canReconnect||!this.client.details.capabilities.interactive)&&(e.mode="write"),this._deltaManager.connect(e)}async load(e,t,r){if(this._resolvedUrl===void 0)throw new Error("Attempting to load without a resolved url");this.service=await this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===r_);const i={reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1};t.deltaConnection===void 0&&this.connectToDeltaStream(i),r?this.connectStorageService().catch(u=>this.close(u)):await this.connectStorageService(),this._attachState=te.Attached;const{snapshot:s,versionId:o}=r===void 0?await this.fetchSnapshotTree(e):{snapshot:void 0,versionId:void 0};q(s!==void 0||r!==void 0,567);const a=r===void 0?await this.getDocumentAttributes(this.storageService,s):{sequenceNumber:r.protocol.sequenceNumber,minimumSequenceNumber:r.protocol.minimumSequenceNumber,term:r.term};let l;switch(t.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(a,t.deltaConnection!=="none"?"all":"none");break;case"cached":l=this.attachDeltaManagerOpHandler(a,"cached");break;case"all":l=this.attachDeltaManagerOpHandler(a,"all");break;default:nv(t.opsBeforeReturn)}this._protocolHandler=r===void 0?await this.initializeProtocolStateFromSnapshot(a,this.storageService,s):await this.initializeProtocolState(a,r.protocol.members,r.protocol.proposals,r.protocol.values);const c=this.getCodeDetailsFromQuorum();if(await this.instantiateContext(!0,c,s,r==null?void 0:r.pendingRuntimeState),!this.closed)switch(l!==void 0&&(this._deltaManager.inbound.resume(),await n_(this.mc.logger,"WaitOps",async()=>(await l,{})),await n_(this.mc.logger,"WaitOpProcessing",async()=>this._deltaManager.inbound.waitTillProcessingDone()),this._deltaManager.inbound.pause()),t.deltaConnection){case void 0:case"delayed":q(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:nv(t.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:a.sequenceNumber,version:o,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(e){const t={sequenceNumber:uG,term:1,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(t);const r=ZE(e);this._protocolHandler=await this.initializeProtocolState(t,[],[],r),await this.instantiateContextDetached(!1),this.setLoaded()}async rehydrateDetachedFromSnapshot(e){e.tree[".hasAttachmentBlobs"]!==void 0&&(q(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete e.tree[".hasAttachmentBlobs"]);const t=pm(e);this._storage.loadSnapshotForRehydratingContainer(t);const r=await this.getDocumentAttributes(this._storage,t);await this.attachDeltaManagerOpHandler(r);const i=YE(t),s=await mt(this._storage,i.blobs.quorumValues),o=nG(s);this._protocolHandler=await this.initializeProtocolState(r,[],[],o!==void 0?ZE(o):[]),await this.instantiateContextDetached(!0,t),this.setLoaded()}async connectStorageService(){var e,t;if(this._storageService!==void 0)return;q(this.service!==void 0,495);const r=await this.service.connectToStorage();this._storageService=new X5(r,this.mc.logger),this.options.summarizeProtocolTree===!0&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new Y5(this._storageService,()=>this.captureProtocolSummary())),q(((e=r.policies)===null||e===void 0?void 0:e.minBlobSize)===((t=this.storageService.policies)===null||t===void 0?void 0:t.minBlobSize),224)}async getDocumentAttributes(e,t){if(t===void 0)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const r=".protocol"in t.trees?t.trees[".protocol"].blobs.attributes:t.blobs[".attributes"],i=await mt(e,r);return i.term===void 0&&(i.term=1),i}async initializeProtocolStateFromSnapshot(e,t,r){let i=[],s=[],o=[];if(r!==void 0){const l=YE(r);[i,s,o]=await Promise.all([mt(t,l.blobs.quorumMembers),mt(t,l.blobs.quorumProposals),mt(t,l.blobs.quorumValues)])}return await this.initializeProtocolState(e,i,s,o)}async initializeProtocolState(e,t,r,i){const s=new AH(e.minimumSequenceNumber,e.sequenceNumber,e.term,t,r,i,(a,l)=>this.submitMessage(zn.Propose,{key:a,value:l})),o=pe.create(this.subLogger,"ProtocolHandler");return s.quorum.on("error",a=>{o.sendErrorEvent(a)}),this.connectionStateHandler.initProtocol(s),s.quorum.on("addProposal",a=>{(a.key==="code"||a.key==="code2")&&this.emit("codeDetailsProposed",a.value,a)}),s.quorum.on("approveProposal",(a,l,c)=>{(l==="code"||l==="code2")&&(iC(c)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch(u=>{throw this.close(lr(u)),u}))}),s}captureProtocolSummary(){const e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:wn.Blob},quorumMembers:{content:JSON.stringify(e.members),type:wn.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:wn.Blob},quorumValues:{content:JSON.stringify(e.values),type:wn.Blob}},type:wn.Tree}}getCodeDetailsFromQuorum(){const e=this.protocolHandler.quorum;return dG(e)}get client(){var e;const t=((e=this.options)===null||e===void 0?void 0:e.client)!==void 0?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return this.clientDetailsOverride!==void 0&&ZB(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment,` loaderVersion:${FR}`].join(";"),t}activeConnection(){return this.connectionState===Oe.Connected&&this.connectionMode==="write"}createDeltaManager(){const e=()=>this.service,t=new U5(e,pe.create(this.subLogger,"DeltaManager"),()=>this.activeConnection(),r=>new nS(e,this.client,this._canReconnect,pe.create(this.subLogger,"ConnectionManager"),r));return t.inbound.pause(),t.inboundSignal.pause(),t.on("connect",(r,i)=>{var s;this._audience.clear();for(const o of(s=r.initialClients)!==null&&s!==void 0?s:[])this._audience.addMember(o.clientId,o.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,r)}),t.on("disconnect",r=>{var i;(i=this.collabWindowTracker)===null||i===void 0||i.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(r)}),t.on("throttled",r=>{const i=r;i.logged!==!0&&this.logContainerError(i),this.emit("warning",i)}),t.on("readonly",r=>{this.emit("readonly",r)}),t.on("closed",r=>{this.closeCore(r)}),t}async attachDeltaManagerOpHandler(e,t){var r;return this._deltaManager.attachOpHandler(e.minimumSequenceNumber,e.sequenceNumber,(r=e.term)!==null&&r!==void 0?r:1,{process:i=>this.processRemoteMessage(i),processSignal:i=>{this.processSignal(i)}},t)}logConnectionStateChangeTelemetry(e,t,r){var i;const s=zt.now();this.connectionTransitionTimes[e]=s;const o=s-this.connectionTransitionTimes[t];let a,l,c,u,d;e===Oe.Disconnected?c=this._deltaManager.connectionManager.reconnectMode:(e===Oe.Connected?(a=s-this.connectionTransitionTimes[Oe.Disconnected],a=Qe.formatTick(a)):(u=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(d=u-this.deltaManager.lastSequenceNumber)),this.firstConnection?l="InitialConnect":l="AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${Oe[e]}`,from:Oe[t],duration:o,durationFromDisconnected:a,reason:r,connectionInitiationReason:l,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:c,opsBehind:d,online:Xi[Z0()],lastVisible:this.lastVisible!==void 0?zt.now()-this.lastVisible:void 0,checkpointSequenceNumber:u,quorumSize:(i=this._protocolHandler)===null||i===void 0?void 0:i.quorum.getMembers().size},this._deltaManager.connectionProps)),e===Oe.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var e;const t=this.connectionState===Oe.Connected&&!this.firstConnection&&this.connectionMode==="write";t&&(this.messageCountAfterDisconnection=0);const r=this.connectionState===Oe.Connected;((e=this._context)===null||e===void 0?void 0:e.disposed)===!1&&this.context.setConnectionState(r,this.clientId),this.protocolHandler.setConnectionState(r,this.clientId),R0(this.mc.logger,this,r,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(e,t,r,i){switch(e){case zn.Operation:case zn.RemoteHelp:break;case zn.Summarize:{const o=t;o.details===void 0&&(o.details={}),o.details.includesProtocolTree=this.options.summarizeProtocolTree===!0;break}default:return this.close(new ti("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,r,i)}submitMessage(e,t,r,i){var s;return this.connectionState!==Oe.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,(s=this.collabWindowTracker)===null||s===void 0||s.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,r,i))}processRemoteMessage(e){const t=this.clientId===e.clientId;let r={immediateNoOp:!1};try{r=this.protocolHandler.processMessage(e,t)}catch(i){this.close(Vh(i,s=>new Rr(s,ro(e))))}return bc(e)&&!Sc(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),(Sc(e)||bc(e))&&this.context.process(e,t,void 0),this.activeConnection()&&(this.collabWindowTracker===void 0&&(q(this.serviceConfiguration!==void 0,740),this.collabWindowTracker=new sG((i,s)=>{q(this.activeConnection(),577),this.submitMessage(i,s)},this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,r.immediateNoOp===!0)),this.emit("op",e),r}submitSignal(e){this._deltaManager.submitSignal(JSON.stringify(e))}processSignal(e){if(e.clientId===null){const t=e.content;if(t.type===zn.ClientJoin){const r=t.content;this._audience.addMember(r.clientId,r.client)}else if(t.type===zn.ClientLeave){const r=t.content;this._audience.removeMember(r)}}else{const t=this.clientId===e.clientId;this.context.processSignal(e,t)}}async fetchSnapshotTree(e){var t;const r=await this.getVersion(e??null);r===void 0&&e!==void 0&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:e}),this._loadedFromVersion=r;const i=(t=await this.storageService.getSnapshotTree(r))!==null&&t!==void 0?t:void 0;return i===void 0&&r!==void 0&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:r.id}),{snapshot:i,versionId:r==null?void 0:r.id}}async instantiateContextDetached(e,t){const r=this.getCodeDetailsFromQuorum();if(r===void 0)throw new Error("pkg should be provided in create flow!!");await this.instantiateContext(e,r,t)}async instantiateContext(e,t,r,i){var s;q(((s=this._context)===null||s===void 0?void 0:s.disposed)!==!1,221);const o=new W5(this,this.loader);this._context=await tS.createOrLoad(this,this.scope,this.codeLoader,t,r,new H5(this._deltaManager),new tG(this.protocolHandler.quorum),o,(a,l,c,u)=>this.submitContainerMessage(a,l,c,u),a=>this.submitSignal(a),a=>this.close(a),Tr.version,a=>this.updateDirtyContainerState(a),e,i),this.emit("contextChanged",t)}updateDirtyContainerState(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?t_:gm))}logContainerError(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}Tr.version="^0.1.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let $R=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Pv extends $R{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=r=>this.emit("disposed",r),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(){throw new Error("Cannot attach container. Container is not in detached state")}async connect(){var e,t;(t=(e=this.container).connect)===null||t===void 0||t.call(e)}async disconnect(){var e,t;(t=(e=this.container).disconnect)===null||t===void 0||t.call(e)}async create(e){return this.rootDataObject.create(e)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var nh;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(nh||(nh={}));var i_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(i_||(i_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Xc(n,e){if(n==="")return e===void 0?"":e.absolutePath;{let t=n.startsWith("/")?n.slice(1):n;return t=t.endsWith("/")?t.slice(0,-1):t,e===void 0?`/${t}`:`${e.absolutePath==="/"?"":e.absolutePath}/${t}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Re(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jR(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const hG=(n,e)=>rS.from(n).toString(e);function s_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let rS=class xs extends Uint8Array{toString(e){return jR(this,e)}static from(e,t,r){if(typeof e=="string")return xs.fromString(e,t);if(e!==null&&typeof e=="object"&&s_(e.buffer))return Re(e.byteOffset===0,0),Re(e.byteLength===e.buffer.byteLength,1),xs.fromArrayBuffer(e.buffer,t,r);if(s_(e))return xs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new xs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new xs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new xs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const fG=n=>rS.from(n,"base64").toString("utf-8");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let pG=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qR(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function rh(n){if(n!==null&&typeof n=="object"&&n.errorFromRequestFluidObject===!0){const r=n;return{mimeType:"text/plain",status:r.code,value:r.message,get stack(){return r.stack}}}const t=Hh();return{mimeType:"text/plain",status:500,value:`${n}`,get stack(){var r;return(r=n==null?void 0:n.stack)!==null&&r!==void 0?r:t.stack}}}function sf(n,e){const t=n.value,r=Hh();return{errorFromRequestFluidObject:!0,message:t,name:"Error",code:n.status,get stack(){var s;return(s=n.stack)!==null&&s!==void 0?s:r.stack}}}async function wc(n,e){const t=typeof e=="string"?{url:e}:e,r=await n.request(t);if(r.status!==200||r.mimeType!=="fluid/object")throw sf(r);return Re(r.value,410),r.value}const qn=n=>ih(404,"not found",n);function ih(n,e,t){var r;Re(n!==200,411);const i=(r=t.url)===null||r===void 0?void 0:r.split("?")[0],s=Hh();return{mimeType:"text/plain",status:n,value:i===void 0?e:`${e}: ${i}`,get stack(){return s.stack}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class mG{constructor(e,t){this.storage=e,this.path=t,Re(!t.endsWith("/"),412)}async readBlob(e){return this.storage.readBlob(`${this.path}/${e}`)}async contains(e){return this.storage.contains(`${this.path}/${e}`)}async list(e){return this.storage.list(`${this.path}/${e}`)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function gG(n){let e=n;return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e.length>0?e.split("/"):[]}class kr{constructor(e){this.request=e;const t=this.request.url.indexOf("?");t>=0?this.query=this.request.url.substring(t):this.query=""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((r,i)=>(i!==void 0&&i.length>0&&r.push(decodeURIComponent(i)),r),[])}static create(e){return e instanceof kr?e:new kr(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return this.requestPathParts===void 0&&(this.requestPathParts=kr.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return this.query===""&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const r=`/${this.pathParts.slice(e).join("/")}`;return{url:this.query===""?r:`${r}/${this.query}`,headers:this.headers}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class vG{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const r=t===void 0?e.existing===!0:t,i=await this.preInitialize(e,r);return r?await this.instantiateFromExisting(i):await this.instantiateFirstTime(i),await this.hasInitialized(i),i}async instantiateFirstTime(e){}async instantiateFromExisting(e){}async hasInitialized(e){}}var ie={},of={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(of,"__esModule",{value:!0});of.IFluidDataStoreFactory=void 0;of.IFluidDataStoreFactory="IFluidDataStoreFactory";var af={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(af,"__esModule",{value:!0});af.IFluidDataStoreRegistry=void 0;af.IFluidDataStoreRegistry="IFluidDataStoreRegistry";var BR={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.VisibilityState=n.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(n.FlushMode||(n.FlushMode={})),n.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}})(BR);var lf={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(lf,"__esModule",{value:!0});lf.gcBlobKey=void 0;lf.gcBlobKey="gc";var UR={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(UR,"__esModule",{value:!0});var HR={};(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.totalBlobSizePropertyName=n.blobCountPropertyName=n.channelsTreeName=n.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(n.CreateSummarizerNodeSource||(n.CreateSummarizerNodeSource={})),n.channelsTreeName=".channels",n.blobCountPropertyName="BlobCount",n.totalBlobSizePropertyName="TotalBlobSize"})(HR);(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(of,n),t(af,n),t(BR,n),t(lf,n),t(UR,n),t(HR,n)})(ie);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var o_;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(o_||(o_={}));var Hl;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Hl||(Hl={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var at;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(at||(at={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ls(...n){const e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const t of n)e.treeNodeCount+=t.treeNodeCount,e.blobNodeCount+=t.blobNodeCount,e.handleNodeCount+=t.handleNodeCount,e.totalBlobSize+=t.totalBlobSize,e.unreferencedBlobSize+=t.unreferencedBlobSize;return e}function yG(n){let e=n.length;for(let t=n.length-1;t>=0;t--){const r=n.charCodeAt(t);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&t--}return e}function VR(n){return typeof n=="string"?yG(n):n.byteLength}function WR(n,e){switch(n.type){case at.Tree:{e.treeNodeCount++;for(const t of Object.values(n.tree))WR(t,e);return}case at.Handle:{e.handleNodeCount++;return}case at.Blob:{e.blobNodeCount++,e.totalBlobSize+=VR(n.content);return}default:return}}function GR(n){const e=ls();return WR(n,e),e}function xr(n,e,t){const r={type:at.Blob,content:t};n.summary.tree[e]=r,n.stats.blobNodeCount++,n.stats.totalBlobSize+=VR(t)}function SG(n,e,t){n.summary.tree[e]=t.summary,n.stats=ls(n.stats,t.stats)}function bG(n,e,t){n.summary.tree[e]=t.summary,n.stats=ls(n.stats,t.stats)}class tn{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=ls(),this.summaryStats.treeNodeCount++}get summary(){return{type:at.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){xr({summary:{type:at.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,r){this.summaryTree[e]={type:at.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=ls(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:at.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function wG(n,e=!1){const t=new tn;for(const i of n.entries)switch(i.type){case Hl.Blob:{const s=i.value;let o;s.encoding==="base64"?o=rS.from(s.contents,"base64"):o=s.contents,t.addBlob(i.path,o);break}case Hl.Tree:{const s=iS(i.value,e);t.addWithStats(i.path,s);break}case Hl.Attachment:{const s=i.value.id;t.addAttachment(s);break}default:throw new Error("Unexpected TreeEntry type")}const r=t.getSummaryTree();return r.summary.unreferenced=n.unreferenced,r}function iS(n,e=!1){if(n.id&&!e){const t=ls();return t.handleNodeCount++,{summary:{handle:n.id,handleType:at.Tree,type:at.Handle},stats:t}}else return wG(n,e)}function sS(n){const e=new tn;for(const[r,i]of Object.entries(n.blobs)){let s;if(n.blobsContents!==void 0){const o=n.blobsContents[i];o!==void 0&&(s=hG(o,"utf-8"))}else n.blobs[i]!==void 0&&(s=fG(n.blobs[i]));s!==void 0&&e.addBlob(r,s)}for(const[r,i]of Object.entries(n.trees)){const s=sS(i);e.addWithStats(r,s)}const t=e.getSummaryTree();return t.summary.unreferenced=n.unreferenced,t}function oS(n){const e=[];for(const[t,r]of Object.entries(n.tree))switch(r.type){case at.Blob:{let i,s="utf-8";typeof r.content=="string"?i=r.content:(i=jR(r.content,"base64"),s="base64"),e.push(new MP(t,i,s));break}case at.Tree:{e.push(new PH(t,oS(r)));break}case at.Attachment:{e.push(new RH(t,r.id));break}case at.Handle:throw new Error("Should not have Handle type in summary tree");default:qR(r,"Unexpected summary tree type")}return{entries:e,unreferenced:n.unreferenced}}class CG{constructor(){this.telemetry=new Map}set(e,t,r){this.telemetry.set(`${e}${t}`,r)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach((t,r)=>{e[r]=t}),JSON.stringify(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Vl="_baseSummary",KR="_outstandingOps",a_=100;class $t{constructor(e){this.path=e}static create(e){return new $t(encodeURIComponent(e))}static createAndConcat(e){var t;let r=$t.create((t=e[0])!==null&&t!==void 0?t:"");for(let i=1;i<e.length;i++)r=r.concat($t.create(e[i]));return r}toString(){return this.path}concat(e){return new $t(`${this.path}/${e.path}`)}}class Yi{constructor(e){this.summary=e}static createForRoot(e){return new Yi({referenceSequenceNumber:e,basePath:void 0,localPath:$t.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return(t=(e=this.basePath)===null||e===void 0?void 0:e.concat(this.localPath))!==null&&t!==void 0?t:this.localPath}get fullPathForChildren(){return this.additionalPath!==void 0?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new Yi({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:$t.create(e)})}}function l_(n,e){let t=n;const r=[],i=[];for(let s=0;;s++){s>a_&&e.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:a_});const o=t.blobs[KR],a=t.trees[Vl];if(o===void 0&&a===void 0)return{baseSummary:t,pathParts:r,async getOutstandingOps(l){let c=[];for(const u of i){const d=await l(u);if(c.length>0&&d.length>0){const h=c[c.length-1].sequenceNumber,f=d[0].sequenceNumber;if(f<=h)for(e.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${f} <= ${h}`});d.length>0&&d[0].sequenceNumber<=h;)d.shift()}c=c.concat(d)}return c}};Re(!!o,431),Re(a!==void 0,432),t=a,r.push(Vl),i.unshift(o)}}function EG(n,e){let t=$t.create(Vl);const r=new tn;if(r.addBlob(KR,JSON.stringify(e)),n.fromSummary){const s=n.summaryNode;s.additionalPath!==void 0&&(t=t.concat(s.additionalPath)),r.addHandle(Vl,at.Tree,s.fullPath.path)}else r.addWithStats(Vl,n.initialSummary);const i=r.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:t})}function vm(n){const e=n.trees[ie.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:ie.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}function _G(n){const e=n.tree[ie.channelsTreeName];return e!==void 0?{childrenTree:e,childrenPathPart:ie.channelsTreeName}:{childrenTree:n,childrenPathPart:void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class aS{constructor(e,t,r,i,s,o,a){var l;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=i,this._latestSummary=s,this.initialSummary=o,this.wipSummaryLogger=a,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=(l=r.canReuseHandle)!==null&&l!==void 0?l:!0,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return(t=(e=this._latestSummary)===null||e===void 0?void 0:e.referenceSequenceNumber)!==null&&t!==void 0?t:0}startSummary(e,t){Re(this.wipSummaryLogger===void 0,415),Re(this.wipReferenceSequenceNumber===void 0,416),this.wipSummaryLogger=t;for(const r of this.children.values())r.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}async summarize(e,t=!0,r){if(Re(this.isTrackingInProgress(),417),Re(this.wipSummaryLogger!==void 0,418),this.canReuseHandle&&!e&&!this.hasChanged()){const i=this._latestSummary;if(i!==void 0){this.wipLocalPaths={localPath:i.localPath,additionalPath:i.additionalPath},this.wipSkipRecursion=!0;const s=ls();return s.handleNodeCount++,{summary:{type:at.Handle,handle:i.fullPath.path,handleType:at.Tree},stats:s}}}try{const i=await this.summarizeInternalFn(e,!0,r);return this.wipLocalPaths={localPath:$t.create(i.id)},i.pathPartsForChildren!==void 0&&(this.wipLocalPaths.additionalPath=$t.createAndConcat(i.pathPartsForChildren)),{summary:i.summary,stats:i.stats}}catch(i){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw i;const s=this._latestSummary,o=this.initialSummary;let a,l;if(s!==void 0)a={fromSummary:!0,summaryNode:s},l=s.localPath;else if((o==null?void 0:o.summary)!==void 0)a={fromSummary:!1,initialSummary:o.summary},l=$t.create(o.id);else throw i;this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},i);const c=EG(a,this.outstandingOps);return this.wipLocalPaths={localPath:l,additionalPath:c.additionalPath},this.wipSkipRecursion=!0,{summary:c.summary,stats:c.stats}}}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,r){Re(this.wipSummaryLogger!==void 0,419),Re(this.wipReferenceSequenceNumber!==void 0,420);let i=this.wipLocalPaths;if(r){const a=this._latestSummary;if(a!==void 0)i={localPath:a.localPath,additionalPath:a.additionalPath};else{this.clearSummary();return}}Re(!!i,421);const s=new Yi(Object.assign(Object.assign({},i),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),o=s.fullPathForChildren;for(const a of this.children.values())a.completeSummaryCore(e,o,this.wipSkipRecursion||r);this.pendingSummaries.set(e,s),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}async refreshLatestSummary(e,t,r,i,s){if(e!==void 0){const a=this.pendingSummaries.get(e);if(a!==void 0)return this.refreshLatestSummaryFromPending(e,a.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const o=await r();return await this.refreshLatestSummaryFromSnapshot(t,o,void 0,$t.create(""),s,i),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:o}}refreshLatestSummaryFromPending(e,t){const r=this.pendingSummaries.get(e);if(r===void 0){Re(this._latestSummary===void 0,422);return}else Re(t===r.referenceSequenceNumber,423),this.pendingSummaries.delete(e);this.refreshLatestSummaryCore(t),this._latestSummary=r;for(const i of this.children.values())i.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);const{baseSummary:a,pathParts:l}=l_(t,s);this._latestSummary=new Yi({referenceSequenceNumber:e,basePath:r,localPath:i});const{childrenTree:c,childrenPathPart:u}=vm(a);u!==void 0&&l.push(u),l.length>0&&(this._latestSummary.additionalPath=$t.createAndConcat(l));const d=this._latestSummary.fullPathForChildren;await Promise.all(Array.from(this.children).filter(([h])=>c.trees[h]!==void 0).map(async([h,f])=>f.refreshLatestSummaryFromSnapshot(e,c.trees[h],d,$t.create(h),s,o)))}refreshLatestSummaryCore(e){for(const[t,r]of this.pendingSummaries)r.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=vm(e);t!==void 0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=$t.create(t))}async loadBaseSummary(e,t){const r=l_(e,this.defaultLogger),i=await r.getOutstandingOps(t),{childrenPathPart:s}=vm(r.baseSummary);if(s!==void 0&&r.pathParts.push(s),r.pathParts.length>0&&this._latestSummary!==void 0&&(this._latestSummary.additionalPath=$t.createAndConcat(r.pathParts)),i.length>0){const o=i[i.length-1].sequenceNumber;Re(o<=this.trackingSequenceNumber,425)}return{baseSummary:r.baseSummary,outstandingOps:i}}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];t!==void 0&&Re(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,r,i={}){Re(!this.children.has(t),427);const s=this.getCreateDetailsForChild(t,r),o=new aS(this.defaultLogger,e,i,s.changeSequenceNumber,s.latestSummary,s.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(o),this.children.set(t,o),o}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var r;let i,s,o;const a=this._latestSummary;switch(t.type){case ie.CreateSummarizerNodeSource.FromAttach:{if(a!==void 0&&t.sequenceNumber<=a.referenceSequenceNumber)s=a.createForChild(e);else{const l=iS(t.snapshot);i={sequenceNumber:t.sequenceNumber,id:e,summary:l}}o=t.sequenceNumber;break}case ie.CreateSummarizerNodeSource.FromSummary:this.initialSummary===void 0&&Re(!!a,428);case ie.CreateSummarizerNodeSource.Local:{const l=this.initialSummary;if(l!==void 0){let c;if(l.summary!==void 0){const{childrenTree:d}=_G(l.summary.summary);Re(d.type===at.Tree,470),c=d.tree[e]}t.type===ie.CreateSummarizerNodeSource.FromSummary&&Re(!!c,429);let u;c!==void 0&&(Re(c.type===at.Tree,430),u={summary:c,stats:GR(c)}),i={sequenceNumber:l.sequenceNumber,id:e,summary:u}}s=a==null?void 0:a.createForChild(e),o=(r=a==null?void 0:a.referenceSequenceNumber)!==null&&r!==void 0?r:-1;break}default:{const l=t.type;qR(t,`Unexpected CreateSummarizerNodeSource: ${l}`)}}return{initialSummary:i,latestSummary:s,changeSequenceNumber:o}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),e._latestSummary!==void 0)for(const[t,r]of this.pendingSummaries.entries()){const i=new Yi({referenceSequenceNumber:r.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,i)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return this.wipReferenceSequenceNumber!==void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ym(n,e){const t=new Set,r=[...e];for(const o of r){if(t.has(o))continue;t.add(o);const a=n[o];a!==void 0&&r.push(...a)}const i=[],s=[];for(const o of Object.keys(n))t.has(o)?i.push(o):s.push(o);return{referencedNodeIds:i,deletedNodeIds:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Jo(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function TG(n){return n.replace(/^\/+|\/+$/g,"")}function xG(n){return n.replace(/^\/+/g,"")}function OG(n){return n.replace(/\/+$/g,"")}function Wl(n){const e={};for(const[t,r]of Object.entries(n.gcNodes))e[t]=Array.from(r);return{gcNodes:e}}function JR(n){const e=new Map;if(n.gcData===void 0)return e;const t=n.gcData.gcNodes;delete t["/"];for(const[i,s]of Object.entries(t)){Jo(i.startsWith("/"),686);const o=i.split("/")[1];let a=i.slice(o.length+1);a===""&&(a="/");let l=e.get(o);l===void 0&&(l={gcData:{gcNodes:{}},usedRoutes:[]}),Jo(l.gcData!==void 0,687),l.gcData.gcNodes[a]=[...new Set(s)],e.set(o,l)}if(n.usedRoutes===void 0)return e;const r=n.usedRoutes.filter(i=>i!==""&&i!=="/");for(const i of r){Jo(i.startsWith("/"),688);const s=i.split("/")[1],o=i.slice(s.length+1),a=e.get(s);Jo((a==null?void 0:a.usedRoutes)!==void 0,689),a.usedRoutes.push(o),e.set(s,a)}return e}function QR(n){const e=n.filter(r=>r!==""&&r!=="/"),t=new Map;for(const r of e){Jo(r.startsWith("/"),408);const i=r.split("/")[1],s=r.slice(i.length+1),o=t.get(i);o!==void 0?o.push(s):t.set(i,[s])}return t}function PG(n,e){const t=Object.entries(n);for(const[r,i]of t){const s=new Set(i);s.delete(e),n[r]=[...s]}}function RG(n,e){var t;const r={};for(const[i,s]of Object.entries(n.gcNodes))r[i]={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs};for(const[i,s]of Object.entries(e.gcNodes)){let o=r[i];o===void 0?o={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs}:(s.unreferencedTimestampMs!==void 0&&o.unreferencedTimestampMs!==void 0&&Jo(s.unreferencedTimestampMs===o.unreferencedTimestampMs,690),o={outboundRoutes:[...new Set([...s.outboundRoutes,...o.outboundRoutes])],unreferencedTimestampMs:(t=s.unreferencedTimestampMs)!==null&&t!==void 0?t:o.unreferencedTimestampMs}),r[i]=o}return{gcNodes:r}}function kG(n,e){const t=Wl(n);for(const[r,i]of Object.entries(e.gcNodes))if(t.gcNodes[r]===void 0)t.gcNodes[r]=Array.from(i);else{const s=[...i,...t.gcNodes[r]];t.gcNodes[r]=[...new Set(s)]}return t}class lS{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,r]of Object.entries(this.gcNodesSet))e[t]=[...r];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[r,i]of Object.entries(t)){let s=xG(r);s=`/${e}/${s}`,s=OG(s),this.gcNodesSet[s]=new Set(i)}}addNodes(e){for(const[t,r]of Object.entries(e))this.gcNodesSet[t]=new Set(r)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class NG extends Yi{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class cS extends aS{constructor(e,t,r,i,s,o,a,l,c){super(e,async(u,d,h)=>t(u,!0,h),r,i,s,o,a),this.summarizeFn=t,this.getGCDataFn=l,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=r.gcDisabled===!0,this.baseGCDetailsP=new pG(async()=>{var u;return(u=await(c==null?void 0:c()))!==null&&u!==void 0?u:{usedRoutes:[]}})}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}async loadBaseGCDetails(){var e;const t=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,t.gcData!==void 0&&(this.gcData=Wl(t.gcData)),this.referenceUsedRoutes=(e=t.usedRoutes)===null||e===void 0?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)}async summarize(e,t=!0,r){return!this.gcDisabled&&this.isTrackingInProgress()&&Re(this.wipSerializedUsedRoutes!==void 0,433),t?super.summarize(e,!0,r):this.summarizeFn(e,t,r)}async getGCData(e=!1){if(Re(!this.gcDisabled,434),Re(this.getGCDataFn!==void 0,435),await this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&this.gcData!==void 0)return Wl(this.gcData);const t=await this.getGCDataFn(e);return this.gcData=Wl(t),t}startSummary(e,t){this.gcDisabled||Re(this.wipSerializedUsedRoutes===void 0,436),super.startSummary(e,t)}completeSummaryCore(e,t,r){let i;if(this.gcDisabled||(i=this.wipSerializedUsedRoutes,Re(i!==void 0,437)),super.completeSummaryCore(e,t,r),!this.gcDisabled){const s=this.pendingSummaries.get(e);if(s!==void 0){const o=new NG(i,s);this.pendingSummaries.set(e,o)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const r=this.pendingSummaries.get(e);r!==void 0&&(this.referenceUsedRoutes=JSON.parse(r.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,i,s,o){if(!this.gcDisabled){const a=t.blobs[ie.gcBlobKey];if(a!==void 0){const l=await o(a);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=l.usedRoutes}}return super.refreshLatestSummaryFromSnapshot(e,t,r,i,s,o)}createChild(e,t,r,i={},s,o){var a;Re(!this.children.has(t),438);const l=this.getCreateDetailsForChild(t,r),c=new cS(this.defaultLogger,e,Object.assign(Object.assign({},i),{gcDisabled:(a=i.gcDisabled)!==null&&a!==void 0?a:this.gcDisabled}),l.changeSequenceNumber,l.latestSummary,l.initialSummary,this.wipSummaryLogger,s,o);return this.maybeUpdateChildState(c),this.children.set(t,c),c}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){if(this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()){this.unreferencedTimestampMs=void 0;return}this.unreferencedTimestampMs===void 0&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return this.gcDisabled?!1:this.referenceUsedRoutes===void 0||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes)}}const LG=(n,e,t,r,i={},s,o)=>new cS(n,e,i,t,r===void 0?void 0:Yi.createForRoot(r),void 0,void 0,s,o);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function IG(n,e){const t=n.trees[".protocol"].blobs.attributes;return(await e(t)).sequenceNumber}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Js(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function k(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function AG(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const MG=(n,e)=>XR.from(n,e).buffer,c_=(n,e)=>XR.from(n).toString(e);function u_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let XR=class Os extends Uint8Array{toString(e){return AG(this,e)}static from(e,t,r){if(typeof e=="string")return Os.fromString(e,t);if(e!==null&&typeof e=="object"&&u_(e.buffer))return k(e.byteOffset===0,0),k(e.byteLength===e.buffer.byteLength,1),Os.fromArrayBuffer(e.buffer,t,r);if(u_(e))return Os.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Os(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Os(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Os(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const En=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ua=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Bt=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},aa=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let cf=class{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){k(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}},DG=class{constructor(e,t){this.timer=new cf(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Bt,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),k(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let d_=class YR{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=En.now();return new YR(e)}trace(){const e=En.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Rv(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let uS=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const FG=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var st;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(st||(st={}));var h_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(h_||(h_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Zi;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Zi||(Zi={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class zG{constructor(e,t,r){this.path=e,this.runtime=t,this.routeContext=r,this.absolutePath=Xc(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==te.Detached}async resolveHandle(e){return this.runtime.resolveHandle(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class dS{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new Te("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}async get(e){if(this.map.has(e))return this.map.get(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const an="summarizer";class la extends Ua{constructor(e,t,r,i,s){super(),this.logger=e,this.summaryCollection=t,this.clientElection=r,this.maxOpsSinceLastSummary=i,this.electionEnabled=s,this.lastReportedSeq=0,this.summaryCollection.on("default",({sequenceNumber:o})=>{var a,l,c;const u=this.electedClientId;if(u===void 0){this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(o);return}let d=this.clientElection.electionSequenceNumber;if(o-((a=this.lastSummaryAckSeqForClient)!==null&&a!==void 0?a:d)>this.maxOpsSinceLastSummary){const f=o-this.lastReportedSeq;if(f>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:u,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:d,nextElectedClientId:(l=this.clientElection.peekNextElectedClient())===null||l===void 0?void 0:l.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=o),this.electionEnabled){const p=this.electedParentId;this.clientElection.incrementElectedClient(o),d=this.clientElection.electionSequenceNumber,o>((c=this.lastSummaryAckSeqForClient)!==null&&c!==void 0?c:d)&&f>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:d,sequenceNumber:o,previousClientId:u,previousParentId:p,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:f,maxOpsSinceLastSummary:i})}}}),this.summaryCollection.on(st.SummaryAck,o=>{this.lastSummaryAckSeqForClient=o.sequenceNumber}),this.clientElection.on("election",(o,a)=>{this.lastSummaryAckSeqForClient=void 0,o===void 0&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(a),this.emit("electedSummarizerChanged")})}get electedClientId(){var e;return(e=this.clientElection.electedClient)===null||e===void 0?void 0:e.clientId}get electedParentId(){var e;return(e=this.clientElection.electedParent)===null||e===void 0?void 0:e.clientId}serialize(){var e;const{electedClientId:t,electedParentId:r,electionSequenceNumber:i}=this.clientElection.serialize();return{electedClientId:t,electedParentId:r,electionSequenceNumber:(e=this.lastSummaryAckSeqForClient)!==null&&e!==void 0?e:i}}static isClientEligible(e){const t=e.client.details;return t===void 0?!0:la.clientDetailsPermitElection(t)}}la.clientDetailsPermitElection=n=>n.capabilities.interactive||n.type===an;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ce(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let $G=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let fl=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}},jG=class{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qG(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let ZR=class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var kv;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(kv||(kv={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class BG{constructor(e,t,r,i,s){this.objectId=e,this._connected=t,this.submit=r,this.dirty=i,this.addedGCOutboundReference=s}get handler(){return ce(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){ce(this._handler===void 0,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,r){try{this.handler.process(e,t,r)}catch(i){throw Nn.wrapIfUnrecognized(i,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(this.handler.rollback===void 0)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class sh{constructor(e,t,r,i){this.tree=e,this.storage=t,this.logger=r,this.extraBlobs=i,this.flattenedTree={},e!==void 0&&sh.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,r){for(const i in t.trees)sh.flattenTree(`${e}${i}/`,t.trees[i],r);for(const i in t.blobs)r[`${e}${i}`]=t.blobs[i]}async contains(e){return this.flattenedTree[e]!==void 0}async readBlob(e){const t=await this.getIdForPath(e),r=this.extraBlobs!==void 0?this.extraBlobs.get(t):void 0;if(r!==void 0)return r;const i=this.storage.readBlob(t);return i.catch(s=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},s)),i}async list(e){var t;let r=this.tree;const i=gG(e);for(;r!==void 0&&i.length>0;){const s=i.shift();r=r.trees[s]}if(r===void 0||i.length!==0)throw new Error("path does not exist");return Object.keys((t=r==null?void 0:r.blobs)!==null&&t!==void 0?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const oh=".attributes";function hS(n,e,t,r,i,s,o,a,l){const c=new BG(n,e,(d,h)=>t(d,h),r,i),u=new sh(a,s,o,l);return{deltaConnection:c,objectStorage:u}}function ek(n,e=!1,t=!1,r){const i=n.getAttachSummary(e,t,r);return xr(i,oh,JSON.stringify(n.attributes)),i}async function tk(n,e=!1,t=!1,r){const i=await n.summarize(e,t,r);return xr(i,oh,JSON.stringify(n.attributes)),i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class fS{constructor(e,t,r,i){this.id=e,this.registry=t,this.runtime=r,this.servicesGetter=i,this.globallyVisible=!1,this.pending=[],ce(!this.id.includes("/"),783)}async getChannel(){return ce(this.channel!==void 0,519),this.channel}get isLoaded(){return this.channel!==void 0}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,r){ce(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,r):(ce(t===!1,393),this.pending.push(e))}reSubmit(e,t){ce(this.isLoaded,394),ce(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){ce(this.isLoaded,750),ce(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,r){return ce(this.isLoaded&&this.channel!==void 0,396),tk(this.channel,e,t,r)}getAttachSummary(e){return ce(this.isLoaded&&this.channel!==void 0,397),ek(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(ce(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return ce(this.isLoaded&&this.channel!==void 0,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class UG extends fS{constructor(e,t,r,i,s,o,a,l,c,u){super(e,t,r,()=>this.services),this.snapshotTree=u;const d=new Map,h=wa(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(h,d)&&this.sanitizeSnapshot(h),this.services=new ZR(()=>hS(this.id,i.connected,a,this.dirtyFn,c,s,o,h,d)),this.dirtyFn=()=>{l(e)}}async getChannel(){return this.channel===void 0&&(this.channel=await this.loadChannel().catch(e=>{throw Nn.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)})),this.channel}async loadChannel(){ce(!this.isLoaded,398),ce(await this.services.value.objectStorage.contains(".attributes"),400);const e=await mt(this.services.value.objectStorage,".attributes");if(ce(this.factory===void 0,520),this.factory=this.registry.get(e.type),this.factory===void 0)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const r of this.pending)this.services.value.deltaConnection.process(r,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let r=!1;const i=e.blobsContents;Object.entries(i).forEach(([s,o])=>{t.set(s,o),e.blobs[s]!==void 0&&(r=!0)});for(const s of Object.values(e.trees))r=r||this.isSnapshotInOldFormatAndCollectBlobs(s,t);return r}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[r,i]of t.entries())t.get(i)===void 0&&delete e.blobs[r];for(const r of Object.values(e.trees))this.sanitizeSnapshot(r)}}class HG extends fS{constructor(e,t,r,i,s,o,a,l,c,u){if(super(e,t,i,()=>this.services),ce(r!==void 0,521),this.factory=t.get(r),this.factory===void 0)throw new Error(`Channel Factory ${r} not registered`);this.channel=this.factory.create(i,e),this.services=new ZR(()=>hS(this.id,s.connected,l,this.dirtyFn,u,o,a)),this.dirtyFn=()=>{c(e)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Cc{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f){this.runtime=e,this.dataStoreContext=t,this.id=a,this.registry=c,this.attachMessageType=f,this.isLoaded=!1,this.pending=[],ce(!this.id.includes("/"),784),this.subLogger=pe.create(this.runtime.logger,"RemoteChannelContext"),this.services=hS(this.id,this.dataStoreContext.connected,i,()=>s(this.id),o,r,this.subLogger,l,u);const p=async(g,S,m)=>this.summarizeInternal(g,S,m);this.summarizerNode=d(p,async g=>this.getGCDataInternal(g),async()=>h()),this.thresholdOpsCounter=new NP(Cc.pendingOpsCountThreshold,this.subLogger)}getChannel(){return this.channelP===void 0&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return ce(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,r){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,r):(ce(!t,405),ce(this.pending!==void 0,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){ce(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){ce(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){const i=await this.getChannel(),s=await tk(i,e,t,r);return Object.assign(Object.assign({},s),{id:this.id})}async loadChannel(){ce(!this.isLoaded,407);let e;await this.services.objectStorage.contains(oh)&&(e=await mt(this.services.objectStorage,oh));let t;if(e===void 0){if(this.attachMessageType===void 0)throw new Rr("channelTypeNotAvailable",{channelId:{value:this.id,tag:De.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:De.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),t===void 0)throw new Rr("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:De.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:De.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),t===void 0)throw new Rr("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:De.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:De.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});e.snapshotFormatVersion!==void 0&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:De.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:De.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:De.PackageData}});const r=await t.load(this.runtime,this.id,this.services,e);ce(this.pending!==void 0,575);for(const i of this.pending)this.services.deltaConnection.process(i,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=r,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}Cc.pendingOpsCountThreshold=1e3;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Jr;(function(n){n.Attach="attach",n.ChannelOp="op"})(Jr||(Jr={}));class Yc extends $G{constructor(e,t,r){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new fl,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,ce(!e.id.includes("/"),782),this.logger=pe.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:ot()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const i=e.baseSnapshot;this.channelsBaseGCDetails=new jG(async()=>{var s,o,a;const l=await((a=(o=(s=this.dataStoreContext).getBaseGCDetails)===null||o===void 0?void 0:o.call(s))!==null&&a!==void 0?a:this.dataStoreContext.getInitialGCSummaryDetails());return JR(l)}),(i==null?void 0:i.trees)!==void 0&&Object.keys(i.trees).forEach(s=>{if(s==="_search")return;let o;e.isLocalDataStore?(o=new UG(s,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(l,c)=>this.submitChannelOp(s,l,c),l=>this.setChannelDirty(l),(l,c)=>this.addedGCOutboundReference(l,c),i.trees[s]),e.attachState!==te.Detached?o.makeVisible():this.localChannelContextQueue.set(s,o)):o=new Cc(this,e,e.storage,(l,c)=>this.submitChannelOp(s,l,c),l=>this.setChannelDirty(l),(l,c)=>this.addedGCOutboundReference(l,c),s,i.trees[s],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:ie.CreateSummarizerNodeSource.FromSummary}),async()=>this.getChannelBaseGCDetails(s));const a=new fl;a.resolve(o),this.contexts.set(s,o),this.contextsDeferred.set(s,a)}),this.attachListener(),this.bindState=r?Cn.Bound:Cn.NotBound,this._attachState=e.attachState,r?this.visibilityState=e.attachState===te.Detached?ie.VisibilityState.LocallyVisible:ie.VisibilityState.GloballyVisible:this.visibilityState=ie.VisibilityState.NotVisible,r&&this.deferredAttached.resolve()}static load(e,t,r){return new Yc(e,t,r)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==te.Detached}get attachState(){return this._attachState}get absolutePath(){return Xc(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const t=kr.create(e),r=t.pathParts[0];if(r==="_channels"||r==="_custom")return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(r)&&t.isLeaf(1))try{return{mimeType:"fluid/object",status:200,value:await(await this.contextsDeferred.get(r).promise).getChannel()}}catch(i){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},i),ih(500,`Failed to get Channel: ${i}`,e)}return qn(e)}catch(t){return rh(t)}}async getChannel(e){return this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new fl),await(await this.contextsDeferred.get(e).promise).getChannel()}createChannel(e=ot(),t){if(e.includes("/"))throw new Te(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),ce(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const r=new HG(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(i,s)=>this.submitChannelOp(e,i,s),i=>this.setChannelDirty(i),(i,s)=>this.addedGCOutboundReference(i,s));if(this.contexts.set(e,r),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(r);else{const i=new fl;i.resolve(r),this.contextsDeferred.set(e,i)}return ce(!!r.channel,378),r.channel}bindChannel(e){if(ce(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached){this.attachChannel(e);return}this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===ie.VisibilityState.NotVisible&&(this.visibilityState=ie.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===Cn.NotBound&&(this.bindState=Cn.Binding,this.dataStoreContext.bindToContext(),this.bindState=Cn.Bound)}bind(e){if(this.visibilityState!==ie.VisibilityState.NotVisible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}setConnectionState(e,t){this.verifyNotClosed();for(const[,r]of this.contexts)r.setConnectionState(e,t);R0(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,r){this.verifyNotClosed();try{switch(e.type){case Jr.Attach:{const i=e.contents,s=i.id;if(t)ce(this.pendingAttach.has(s),380),this.pendingAttach.delete(s);else{ce(!this.contexts.has(s),381);const o=new Map,a=FP(i.snapshot.entries,o),l=new Cc(this,this.dataStoreContext,this.dataStoreContext.storage,(c,u)=>this.submitChannelOp(s,c,u),c=>this.setChannelDirty(c),(c,u)=>this.addedGCOutboundReference(c,u),s,a,this.sharedObjectRegistry,o,this.dataStoreContext.getCreateChildSummarizerNodeFn(s,{type:ie.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),async()=>this.getChannelBaseGCDetails(s),i.type);if(this.contexts.set(s,l),this.contextsDeferred.has(s))this.contextsDeferred.get(s).resolve(l);else{const c=new fl;c.resolve(l),this.contextsDeferred.set(s,c)}}break}case Jr.ChannelOp:this.processChannelOp(e,t,r);break;default:}this.emit("op",e)}catch(i){throw Nn.wrapIfUnrecognized(i,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new lS;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>this.isChannelAttached(r)).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var r;const i=QR(e);for(const[s]of i)ce(this.contexts.has(s),382);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}addedGCOutboundReference(e,t){var r,i;(i=(r=this.dataStoreContext).addedGCOutboundReference)===null||i===void 0||i.call(r,e,t)}async getChannelBaseGCDetails(e){var t;let r=(await this.channelsBaseGCDetails).get(e);return r===void 0?r={}:((t=r.gcData)===null||t===void 0?void 0:t.gcNodes)!==void 0&&PG(r.gcData.gcNodes,this.absolutePath),(r.usedRoutes===void 0||r.usedRoutes.length===0)&&(r.usedRoutes=[""]),r}async summarize(e=!1,t=!0,r){const i=new tn;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>{const a=this.isChannelAttached(s);return ce(a,383),a}).map(async([s,o])=>{const a=await o.summarize(e,t,r);i.addWithStats(s,a)})),i.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new tn;for(const[r,i]of this.contexts){if(!(i instanceof fS))throw new ue("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(r)){let s;if(i.isLoaded){const o=i.getAttachSummary(e);ce(o.summary.type===kv.Tree,384),s={stats:o.stats,summary:o.summary}}else ce(!!this.dataStoreContext.baseSnapshot,385),s=sS(this.dataStoreContext.baseSnapshot.trees[r]);t.addWithStats(r,s)}}return t.getSummaryTree()}submitMessage(e,t,r){this.submit(e,t,r)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),ce(this.isAttached,386),ce(this.visibilityState===ie.VisibilityState.GloballyVisible,720);const t=ek(e,!0,!1),r=oS(t.summary),i={id:e.id,snapshot:r,type:e.attributes.type};this.pendingAttach.set(e.id,i),this.submit(Jr.Attach,i),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,r){const i={address:e,contents:t};this.submit(Jr.ChannelOp,i,r)}submit(e,t,r=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,r)}reSubmit(e,t,r){switch(this.verifyNotClosed(),e){case Jr.ChannelOp:{const i=t,s=this.contexts.get(i.address);ce(!!s,387),s.reSubmit(i.contents,r);break}case Jr.Attach:this.submit(e,t,r);break;default:qG()}}rollback(e,t,r){switch(this.verifyNotClosed(),e){case Jr.ChannelOp:{const i=t,s=this.contexts.get(i.address);ce(!!s,749),s.rollback(i.contents,r);break}default:throw new ue(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return ce(!!r,388),await r.getChannel(),r.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,r){this.verifyNotClosed();const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);return ce(!!o,389),o.processOp(s,t,r),o}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",()=>{this.attachGraph(),this._attachState=te.Attaching,ce(this.visibilityState===ie.VisibilityState.LocallyVisible,721),this.visibilityState=ie.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach(e=>{e.makeVisible()}),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")}),this.dataStoreContext.once("attached",()=>{ce(this.visibilityState===ie.VisibilityState.GloballyVisible,722),this._attachState=te.Attached,this.emit("attached")})}verifyNotClosed(){if(this._disposed)throw new ue("Runtime is closed")}}const VG=(n,e=Yc)=>class extends e{async request(r){const i=await super.request(r);return i.status===404?n(r,this):i}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ca{constructor(e,t,r){this.value=e,this.path=t,this.routeContext=r,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=Xc(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){if(this.visible){e.attachGraph();return}this.pendingHandlesToMakeVisible.add(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class WG extends ca{async get(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")}attach(){}bind(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class GG{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:e??this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class KG{constructor(e,t,r,i){this.heuristicData=e,this.configuration=t,this.trySummarize=r,this.logger=i,this.idleTimer=new cf(this.configuration.idleTime,()=>this.trySummarize("idle")),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function Nv(n,e,t){const r=[n.then(i=>({result:"done",value:i})),e.then(({timerResult:i})=>({result:i}))];return t!==void 0&&r.push(t.waitCancelled.then(()=>({result:"cancelled"}))),Promise.race(r)}const f_=2e4,JG=5,p_={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class Gl{constructor(){this.summarySubmitted=new Bt,this.summaryOpBroadcasted=new Bt,this.receivedSummaryAckOrNack=new Bt}fail(e,t,r,i){k(!this.receivedSummaryAckOrNack.isCompleted,606);const s={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:i};this.summarySubmitted.resolve(s),this.summaryOpBroadcasted.resolve(s),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},s),{data:r}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class QG{constructor(e,t,r,i,s,o,a){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=r,this.raiseSummarizingError=i,this.successfulSummaryCallback=s,this.summaryWatcher=o,this.logger=a,this.summarizeTimer=new cf(f_,()=>this.summarizeTimerHandler(f_,1))}summarize(e,t,r,i=new Gl){return this.summarizeCore(e,t,i,r).catch(s=>{const o="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:o},e),s),i.fail(o,s)}),i.build()}async summarizeCore(e,t,r,i){const{refreshLatestAck:s,fullTree:o}=t,a=pe.create(this.logger,void 0,{all:e}),l=Date.now()-this.heuristicData.lastAttempt.summaryTime,c=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime;let u={fullTree:o,timeSinceLastAttempt:l,timeSinceLastSummary:c};const d=he.start(a,Object.assign({eventName:"Summarize",refreshLatestAck:s},u)),h=g=>`${g}: ${p_[g]}`,f=(g,S,m,v)=>{this.raiseSummarizingError(p_[g]);const y=QE(S),b=i.cancelled||(S==null?void 0:S.errorType)===Ln.offlineError?"generic":"error";d.cancel(Object.assign(Object.assign({},m),{reason:g,category:b,retryAfterSeconds:y}),S),r.fail(h(g),S,v,y)};this.summarizeTimer.start();let p;try{p=await this.submitSummaryCallback({fullTree:o,refreshLatestAck:s,summaryLogger:a,cancellationToken:i});const g=p.referenceSequenceNumber,S=g-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(u=Object.assign(Object.assign({},u),{referenceSequenceNumber:g,minimumSequenceNumber:p.minimumSequenceNumber,opsSinceLastAttempt:g-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:S}),p.stage!=="base"&&(u=Object.assign(Object.assign(Object.assign({},u),p.summaryStats),{generateDuration:p.generateDuration}),p.stage!=="generate"&&(u=Object.assign(Object.assign({},u),{handle:p.handle,uploadDuration:p.uploadDuration}),p.stage!=="upload"&&(u=Object.assign(Object.assign({},u),{clientSequenceNumber:p.clientSequenceNumber})))),p.stage!=="submit")return f("submitSummaryFailure",p.error,u);if(!o&&!p.forcedFullTree){const{summarizedDataStoreCount:m,gcStateUpdatedDataStoreCount:v=0}=p.summaryStats;m>v+S&&a.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:m,gcStateUpdatedDataStoreCount:v,opsSinceLastSummary:S})}d.reportEvent("generate",Object.assign({},u)),r.summarySubmitted.resolve({success:!0,data:p})}catch(g){return f("submitSummaryFailure",g)}finally{this.heuristicData.recordAttempt(p==null?void 0:p.referenceSequenceNumber),this.summarizeTimer.clear()}try{const g=this.pendingAckTimer.start(),S=this.summaryWatcher.watchSummary(p.clientSequenceNumber),m=await Nv(S.waitBroadcast(),g,i);if(m.result==="cancelled")return f("disconnect");if(m.result!=="done")return f("summaryOpWaitTimeout");const v=m.value,y=Date.now()-this.heuristicData.lastAttempt.summaryTime;r.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:v,broadcastDuration:y}}),this.heuristicData.lastAttempt.summarySequenceNumber=v.sequenceNumber,a.sendTelemetryEvent({eventName:"Summarize_Op",duration:y,referenceSequenceNumber:v.referenceSequenceNumber,summarySequenceNumber:v.sequenceNumber,handle:v.contents.handle});const b=await Nv(S.waitAckNack(),g,i);if(b.result==="cancelled")return f("disconnect");if(b.result!=="done")return f("summaryAckWaitTimeout");const w=b.value;this.pendingAckTimer.clear();const _=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(u=Object.assign({ackWaitDuration:_,ackNackSequenceNumber:w.sequenceNumber,summarySequenceNumber:w.contents.summaryProposal.summarySequenceNumber},u),w.type===st.SummaryAck)this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),d.end(Object.assign(Object.assign({},u),{handle:w.contents.handle})),r.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:w,ackNackDuration:_}});else{k(w.type===st.SummaryNack,628);const E=w.contents,P=E==null?void 0:E.message,A=E==null?void 0:E.retryAfter,F=new ue(`Received summaryNack: ${P}`,{retryAfterSeconds:A});return k(QE(F)===A,607),f("summaryNack",F,Object.assign(Object.assign({},u),{nackRetryAfter:A}),{summaryNackOp:w,ackNackDuration:_})}}finally{this.pendingAckTimer.clear()}}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<JG){const r=e*2;this.summarizeTimer.start(r,()=>this.summarizeTimerHandler(r,t+1))}}dispose(){this.summarizeTimer.clear()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Sm=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const XG=10*60*1e3;class pS{constructor(e,t,r,i,s,o,a,l,c){this.summaryWatcher=t,this.configuration=r,this.submitSummaryCallback=i,this.heuristicData=s,this.raiseSummarizingError=o,this.summaryCollection=a,this.cancellationToken=l,this.stopSummarizerCallback=c,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=h=>this.heuristicData.lastAttempt.refSequenceNumber===h?this.logger:void 0;const u={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=pe.create(e,"Running",{all:u}),r.state!=="disableHeuristics"&&(k(this.configuration.state==="enabled",746),this.heuristicRunner=new KG(s,this.configuration,h=>this.trySummarize(h),this.logger)),k(this.configuration.state!=="disabled",747);const d=Math.min(this.configuration.maxAckWaitTime,XG);this.pendingAckTimer=new DG(d,()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:d,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})}),a.setPendingAckTimerTimeoutCallback(d,()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())}),this.generator=new QG(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,()=>{this.totalSuccessfulAttempts++},this.summaryWatcher,this.logger)}static async start(e,t,r,i,s,o,a,l,c){var u;const d=new pS(e,t,r,i,s,o,a,l,c);return await d.waitStart(),(u=d.heuristicRunner)===null||u===void 0||u.run(),d}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),(e=this.heuristicRunner)===null||e===void 0||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case st.ClientLeave:case st.ClientJoin:case st.Propose:{this.handleOp(void 0,e);return}default:return}}handleOp(e,{sequenceNumber:t,type:r,clientId:i,contents:s}){var o;e===void 0&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||(o=this.heuristicRunner)===null||o===void 0||o.run())}async waitStop(e){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(!((t=this.heuristicRunner)===null||t===void 0)&&t.shouldRunLastSummary())&&this.summarizingLock===void 0&&this.trySummarizeOnce({reason:"lastSummary"},{}),await this.summarizingLock)}async waitStart(){const e=await Nv(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),e.result==="done"&&e.value!==void 0&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})}async lockedRefreshSummaryAckAction(e){k(this.refreshSummaryAckLock===void 0,"Refresh Summary Ack - Caller is responsible for checking lock");const t=new Bt;return this.refreshSummaryAckLock=t.promise,e().finally(()=>{t.resolve(),this.refreshSummaryAckLock=void 0})}async lockedSummaryAction(e){k(this.summarizingLock===void 0,603);const t=new Bt;return this.summarizingLock=t.promise,this.summarizeCount++,await this.refreshSummaryAckLock,e().finally(()=>{var r;t.resolve(),this.summarizingLock=void 0;const i=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,!this.stopping&&!this.tryRunEnqueuedSummary()&&i&&((r=this.heuristicRunner)===null||r===void 0||r.run())})}trySummarizeOnce(e,t,r=this.cancellationToken,i=new Gl){return this.lockedSummaryAction(async()=>this.generator.summarize(e,t,r,i).receivedSummaryAckOrNack).catch(s=>{}),i.build()}trySummarize(e,t=this.cancellationToken){if(this.summarizingLock!==void 0){this.tryWhileSummarizing=!0;return}this.lockedSummaryAction(async()=>{const r=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let i,s=0,o=0,a;for(let l=0;l<r.length;){if(this.cancellationToken.cancelled||++s>1&&e==="lastSummary")return;o++;const c=r[l],{delaySeconds:u=0}=c,d=Sm(c,["delaySeconds"]),h=i??u,f=Object.assign({reason:e,summaryAttempts:s,summaryAttemptsPerPhase:o,summaryAttemptPhase:l+1},d);h>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:h,summaryNackDelay:i!==void 0},f)),await FG(h*1e3)),await this.refreshSummaryAckLock;const g=await this.generator.summarize(f,d,t).receivedSummaryAckOrNack;if(g.success)return;i=g.retryAfterSeconds,(i===void 0||o>1)&&(l++,o=0),a=g}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:a==null?void 0:a.message},a==null?void 0:a.error),this.stopSummarizerCallback("failToSummarize")}).catch(r=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},r)})}summarizeOnDemand(e=new Gl,t){var{reason:r}=t,i=Sm(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(this.summarizingLock!==void 0)throw new Te("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${r}`},i,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:r=0,override:i=!1}=e,s=Sm(e,["reason","afterSequenceNumber","override"]);const o=`enqueue;${t}`;let a=!1;if(this.enqueuedSummary!==void 0){if(!i)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,a=!0}this.enqueuedSummary={reason:o,afterSequenceNumber:r,options:s,resultsBuilder:new Gl};const l=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),a?Object.assign(Object.assign({},l),{alreadyEnqueued:!0,overridden:!0}):l}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(this.enqueuedSummary===void 0||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||this.summarizingLock!==void 0)return!1;const{reason:e,resultsBuilder:t,options:r}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},r,this.cancellationToken,t),!0}disposeEnqueuedSummary(){this.enqueuedSummary!==void 0&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const YG="summarizingError";class Ec extends ue{constructor(e,t=!1){super(e),this.logged=t,this.errorType=YG,this.canRetry=!0}static wrap(e,t=!1,r){return xP(e,s=>new Ec(s,t),r)}}const ZG=(n,e)=>new Ec(n,e);class mS extends mn.EventEmitter{constructor(e,t,r,i,s,o,a){super(),this.runtime=t,this.configurationGetter=r,this.internalsProvider=i,this.summaryCollection=o,this.runCoordinatorCreateFn=a,this._disposed=!1,this.starting=!1,this.stopDeferred=new Bt,this.summarizeOnDemand=(...l)=>{var c;try{if(this._disposed||!((c=this.runningSummarizer)===null||c===void 0)&&c.disposed)throw new Te("Summarizer is already disposed.");if(this.runtime.summarizerClientId!==void 0&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new Te("On-demand summary attempted while an elected summarizer is present");const u=new Gl;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(u,...l):(this.runCoordinatorCreateFn(this.runtime).then(h=>{this.start(this.runtime.clientId,h).then(async p=>{p.summarizeOnDemand(u,...l);const g=await Promise.race([this.stopDeferred.promise,h.waitCancelled]);await p.waitStop(!1),h.stop(g),this.close()}).catch(p=>{u.fail("Failed to start summarizer",p)})}).catch(h=>{u.fail("Failed to create cancellation token",h)}),u.build())}catch(u){throw Ec.wrap(u,!1,this.logger)}},this.enqueueSummarize=(...l)=>{if(this._disposed||this.runningSummarizer===void 0||this.runningSummarizer.disposed)throw new Te("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...l)},this.logger=pe.create(this.runtime.logger,"Summarizer"),this.innerHandle=new WG(this,e,s)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static async create(e,t){const r={headers:{[Ge.cache]:!1,[Ge.clientDetails]:{capabilities:{interactive:!1},type:an},[Ta.summarizingClient]:!0,[Ge.reconnect]:!1},url:t},i=await e.resolve(r),s=await wc(i,{url:"_summarizer"});if(s.ISummarizer===void 0)throw new Te("Fluid object does not implement ISummarizer");return s.ISummarizer}async run(e){try{return await this.runCore(e)}catch(t){throw this.stop("summarizerException"),Ec.wrap(t,!1,this.logger)}finally{this.close()}}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}async runCore(e){const t=await this.runCoordinatorCreateFn(this.runtime),r=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(r.then(o=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:o})}),t.cancelled)return t.waitCancelled;const i=await this.start(e,t),s=await r;return await i.waitStop(!t.cancelled&&mS.stopReasonCanRunLastSummary(s)),t.stop(s),s}static stopReasonCanRunLastSummary(e){return e==="parentNotConnected"}async start(e,t){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new Te("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new Te("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const r=this.runtime.clientId;if(r===void 0)throw new Te("clientId should be defined if connected.");const i=await pS.start(this.logger,this.summaryCollection.createWatcher(r),this.configurationGetter(),async(...s)=>this.internalsProvider.submitSummary(...s),new GG(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),s=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},ZG(s,!0))},this.summaryCollection,t,s=>t.stop(s));return this.runningSummarizer=i,this.starting=!1,this.handleSummaryAcks().catch(s=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},s)}),this.systemOpListener=s=>i.handleSystemOp(s),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(s,o)=>i.handleOp(s,o),this.runtime.on("batchEnd",this.opListener),i}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}async handleSummaryAcks(){var e,t,r,i,s;let o=this.runtime.deltaManager.initialSequenceNumber,a;for(;this.runningSummarizer;){const l=(e=this.runningSummarizer.tryGetCorrelatedLogger(o))!==null&&e!==void 0?e:this.logger;try{a=void 0,a=await this.summaryCollection.waitSummaryAck(o),o=a.summaryOp.referenceSequenceNumber;const c=a.summaryOp.contents.handle,u=a.summaryAck.contents.handle;await this.runningSummarizer.lockedRefreshSummaryAckAction(async()=>this.internalsProvider.refreshLatestSummaryAck(c,u,o,l).catch(async d=>{if(_P(d)&&d.errorType===Ln.fileNotFoundOrAccessDeniedError)l.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:o,proposalHandle:c,ackHandle:u},d);else throw d}))}catch(c){l.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:o,handle:(r=(t=a==null?void 0:a.summaryOp)===null||t===void 0?void 0:t.contents)===null||r===void 0?void 0:r.handle,ackHandle:(s=(i=a==null?void 0:a.summaryAck)===null||i===void 0?void 0:i.contents)===null||s===void 0?void 0:s.handle},c)}o++}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const e9=5e3,t9=4e3;var yt;(function(n){n[n.Off=0]="Off",n[n.Starting=1]="Starting",n[n.Running=2]="Running",n[n.Stopping=3]="Stopping"})(yt||(yt={}));class uf{constructor(e,t,r,i,s,o,{initialDelayMs:a=e9,opsToBypassInitialDelay:l=t9}={},c){this.clientElection=e,this.connectedState=t,this.summaryCollection=r,this.requestSummarizerFn=s,this.startThrottler=o,this.disableHeuristics=c,this.state=yt.Off,this._disposed=!1,this.handleConnected=u=>{this.latestClientId=u,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const u=this.getShouldSummarizeState();switch(this.state){case yt.Off:{u.shouldSummarize&&this.startSummarization();return}case yt.Starting:return;case yt.Running:{u.shouldSummarize===!1&&this.stop(u.stopReason);return}case yt.Stopping:return;default:return}},this.summarizeOnDemand=(...u)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...u)},this.enqueueSummarize=(...u)=>{if(this.summarizer===void 0)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...u)},this.logger=pe.create(i,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=l,this.initialDelayMs=a}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){if(this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==yt.Running&&this.connectedState.clientId!==this.clientElection.electedClientId)return{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"};if(this.connectedState.connected)if(this.disposed)k(!1,608);else return{shouldSummarize:!0};else return{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){k(this.state===yt.Off,609),this.state=yt.Starting,k(this.summarizer===void 0,610),this.delayBeforeCreatingSummarizer().then(async e=>{if(e&&this.getShouldSummarizeState().shouldSummarize===!1)return"early exit";k(this.state===yt.Starting,611),this.state=yt.Running;const t=await this.requestSummarizerFn();this.summarizer=t;const r=this.getShouldSummarizeState();if(r.shouldSummarize===!1)return this.state=yt.Starting,t.stop(r.stopReason),"early exit after starting summarizer";const i=this.latestClientId;return he.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},async()=>t.run(i,this.disableHeuristics))}).then(e=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:e})}).catch(e=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},e),this.getShouldSummarizeState().shouldSummarize||this.summarizer!==void 0){const t=(e==null?void 0:e.errorType)===Ln.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:t},e)}}).finally(()=>{var e;k(this.state!==yt.Off,612),this.state=yt.Off,(e=this.summarizer)===null||e===void 0||e.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()})}stop(e){var t;uf.isStartingOrRunning(this.state)&&(this.state=yt.Stopping,(t=this.summarizer)===null||t===void 0||t.stop(e))}async delayBeforeCreatingSummarizer(){let e=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:e,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let t=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(t=!0,e=Math.max(e,this.initialDelayMs)),e>0){let r,i;const s=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(r),i())},o=new Promise(l=>{r=setTimeout(()=>l(),e)}),a=new Promise(l=>{i=l});this.summaryCollection.addOpListener(s),await Promise.race([o,a]),this.summaryCollection.removeOpListener(s)}return t}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}uf.isStartingOrRunning=n=>n===yt.Starting||n===yt.Running;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _c{constructor(e,t){this.logger=t,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=_c.processingTime,this.schedulingCount=0,this.deltaManager=e,this.deltaManager.inbound.on("idle",()=>{this.inboundQueueIdle()})}batchBegin(e){this.processingStartTime||(this.processingStartTime=En.now()),this.schedulingLog===void 0&&this.schedulingCount%500===0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:En.now()})}batchEnd(e){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const t=En.now(),r=t-this.processingStartTime;r>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=r),setTimeout(()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:Qe.formatTick(r),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:Qe.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:Qe.formatTick(En.now()-t)}),this.deltaManager.inbound.resume()}),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const e=En.now();this.schedulingLog.totalProcessingTime+=e-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:Qe.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:Qe.formatTick(e-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=_c.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}_c.processingTime=50;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const nk=5e3;class n9{constructor(e,t,r){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=En.now(),this.connectionStartTime=0,this.gap=0,this.logger=pe.create(r,"OpPerf"),this.deltaManager.on("pong",i=>this.recordPingTime(i)),this.deltaManager.on("submitOp",i=>this.beforeOpSubmit(i)),this.deltaManager.on("op",i=>this.afterProcessingOp(i)),this.deltaManager.on("connect",(i,s)=>{this.clientId=i.clientId,s!==void 0&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=s,this.connectionStartTime=En.now(),this.gap<=0&&this.reportGettingUpToDate())}),this.deltaManager.on("disconnect",()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0}),this.deltaManager.outbound.on("push",i=>{for(const s of i)s.type===st.Operation&&this.clientSequenceNumberForLatencyStatistics===s.clientSequenceNumber&&(k(this.opProcessingTimes.outboundPushEventTime===void 0,712),k(this.opPerfData.durationNetwork===void 0,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),k(this.opPerfData.durationOutboundBatching===void 0,714),k(this.opProcessingTimes.submitOpEventTime!==void 0,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)}),this.deltaManager.inbound.on("push",i=>{this.clientId===i.clientId&&i.type===st.Operation&&this.clientSequenceNumberForLatencyStatistics===i.clientSequenceNumber&&this.opProcessingTimes.outboundPushEventTime!==void 0&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)}),this.deltaManager.inbound.on("idle",(i,s)=>{typeof i=="number"&&i>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:i,duration:s})})}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:En.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?Qe.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100===0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){this.clientSequenceNumberForLatencyStatistics===void 0&&e.clientSequenceNumber%500===1&&(k(this.opProcessingTimes.outboundPushEventTime===void 0,716),k(this.opPerfData.durationNetwork===void 0,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),this.sequenceNumberForMsnTracking===void 0&&t%1e3===0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),this.sequenceNumberForMsnTracking!==void 0&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(k(this.msnTrackingTimestamp!==void 0,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){k(this.opProcessingTimes.submitOpEventTime!==void 0,288);const r=Date.now();this.opProcessingTimes.inboundPushEventTime!==void 0&&(this.opPerfData.durationInboundToProcessing=r-this.opProcessingTimes.inboundPushEventTime);const i=r-this.opProcessingTimes.submitOpEventTime,s=i>nk?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:i,category:s,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}function r9(n,e,t){new n9(n,e,t)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class i9{constructor(e,t,r){var i;this.stateHandler=e,this.pendingStates=new xv,this.disposeOnce=new uS(()=>{this.initialStates.clear(),this.pendingStates.clear()}),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new xv((i=r==null?void 0:r.pendingStates)!==null&&i!==void 0?i:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return this._pendingMessagesCount!==0||!this.initialStates.isEmpty()}getLocalState(){if(k(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map(e=>e.type==="message"?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e)}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,r,i,s,o){const a={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:r,content:i,localOpMetadata:s,opMetadata:o};this.pendingStates.push(a),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===ie.FlushMode.Immediate)return;const e=this.pendingStates.peekBack();(e==null?void 0:e.type)==="message"&&this.pendingStates.push({type:"flush"})}async applyStashedOpsAt(e){for(;!this.initialStates.isEmpty();){const t=this.initialStates.peekFront();if(t.type==="message"){if(e!==void 0){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const r=await this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=r}this.pendingStates.push(this.initialStates.shift())}}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if(k(t.type==="message",361),this.pendingStates.shift(),t.clientSequenceNumber!==e.clientSequenceNumber){const r=Nn.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(r);return}return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata}maybeProcessBatchBegin(e){let t,r=!1,i=this.peekNextPendingState();for(;i.type!=="message";)i.type==="flushMode"&&(t=i.flushMode),i.type==="flush"&&(r=!0),this.pendingStates.shift(),i=this.peekNextPendingState();t!==void 0&&(this.flushModeForNextMessage=t),t!==ie.FlushMode.Immediate&&(t===ie.FlushMode.TurnBased||r)&&(k(!this.isProcessingBatch&&this.pendingBatchBeginMessage===void 0,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,r;if(!this.isProcessingBatch)return;const i=this.peekNextPendingState();if(i.type==="message")return;k(i.type!=="flushMode",701),k(this.pendingBatchBeginMessage!==void 0,365);const s=(t=this.pendingBatchBeginMessage.metadata)===null||t===void 0?void 0:t.batch;if(this.pendingBatchBeginMessage===e)k(s===void 0,366);else{const o=(r=e.metadata)===null||r===void 0?void 0:r.batch;k(s===!0,367),k(o===!1,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(t){const r=Vh(t,i=>Nn.create(`RollbackError: ${i}`,"checkpointRollback",void 0));throw this.stateHandler.close(r),r}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return k(!!e,369),e}rollbackNextPendingState(){if(this.pendingStates.length===0)return;this._pendingMessagesCount--;const t=this.pendingStates.pop();switch(t.type){case"message":this.stateHandler.rollback(t.messageType,t.content,t.localOpMetadata);break;default:throw new Error(`Can't rollback state ${t.type}`)}}replayPendingStates(){k(this.stateHandler.connected(),370),k(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),k(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(e===0)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const r=this.pendingStates.shift();switch(r.type){case"message":this.stateHandler.reSubmit(r.messageType,r.content,r.localOpMetadata,r.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(r.flushMode);break;case"flush":this.stateHandler.flush();break}e--}this.stateHandler.setFlushMode(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const dd="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class m_{constructor(e,t,r){this.path=e,this.routeContext=t,this.get=r,this.attached=!1,this.absolutePath=Xc(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}class _n{constructor(e,t,r,i,s,o,a){this.routeContext=e,this.getStorage=r,this.attachBlobCallback=i,this.gcNodeUpdated=s,this.runtime=o,this.logger=a,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",()=>{for(const l of this.pendingBlobIds.values())l.reject(new Error("runtime disposed while blobAttach op in flight"))}),this.load(t)}hasBlob(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}getBlobGCNodePath(e){return`/${_n.basePath}/${e}`}async getBlob(e){var t,r;const i=(r=(t=this.redirectTable)===null||t===void 0?void 0:t.get(e))!==null&&r!==void 0?r:e;return k(this.hasBlob(i),287),this.gcNodeUpdated(this.getBlobGCNodePath(e)),new m_(`${_n.basePath}/${i}`,this.routeContext,async()=>he.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:i},async()=>this.getStorage().readBlob(i),{end:!0,cancel:"error"}))}async createBlob(e){var t,r;this.runtime.attachState===te.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise(o=>this.runtime.once("attached",o))),!this.runtime.connected&&this.runtime.attachState===te.Attached&&await new Promise(o=>this.runtime.once("connected",o));const i=await he.timedExecAsync(this.logger,{eventName:"createBlob"},async()=>this.getStorage().createBlob(e),{end:!0,cancel:"error"}),s=new m_(`${_n.basePath}/${i.id}`,this.routeContext,async()=>this.getBlob(i.id).then(async o=>o.get()));return this.runtime.attachState===te.Detached?(this.detachedBlobIds.add(i.id),s):(this.pendingBlobIds.has(i.id)?await((t=this.pendingBlobIds.get(i.id))===null||t===void 0?void 0:t.promise):this.blobIds.has(i.id)||(this.pendingBlobIds.set(i.id,new Bt),this.attachBlobCallback(i.id),await((r=this.pendingBlobIds.get(i.id))===null||r===void 0?void 0:r.promise)),s)}processBlobAttachOp(e,t){if(t){const r=this.pendingBlobIds.get(e);k(r!==void 0,504),r.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}static async load(e,t){if(!e)return{};let r;const i=e.blobs[this.redirectTableBlobName];return i&&(r=await t(i)),{ids:Object.entries(e.blobs).filter(([o,a])=>o!==this.redirectTableBlobName).map(([o,a])=>a),redirectTable:r}}load(e){var t,r,i;if(e.ids){const s=this.runtime.attachState===te.Detached;e.ids.map(o=>s?this.detachedBlobIds.add(o):this.blobIds.add(o))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:(r=(t=e.ids)===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:0,redirectTable:(i=e.redirectTable)===null||i===void 0?void 0:i.length})}getGCData(e=!1){const t={gcNodes:{}};if(this.blobIds.forEach(r=>{t.gcNodes[this.getBlobGCNodePath(r)]=[]}),this.redirectTable!==void 0)for(const[r,i]of this.redirectTable)t.gcNodes[this.getBlobGCNodePath(r)]=[this.getBlobGCNodePath(i)];return t}deleteUnusedRoutes(e){var t;for(const r of e){const i=r.split("/");k(i.length===3&&i[1]===_n.basePath,725);const s=i[2];if(!((t=this.redirectTable)===null||t===void 0)&&t.has(s)){this.redirectTable.delete(s);continue}this.blobIds.delete(s)}}summarize(e){const r=!!this.redirectTable||this.runtime.attachState!==te.Detached?this.blobIds:this.detachedBlobIds,i=new tn;return r.forEach(s=>{i.addAttachment(s)}),this.redirectTable&&this.redirectTable.size>0&&i.addBlob(_n.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),i.getSummaryTree()}setRedirectTable(e){k(this.runtime.attachState===te.Detached,594),k(!this.redirectTable,595);for(const[t,r]of e)k(this.detachedBlobIds.delete(t),596),this.blobIds.add(r);k(this.detachedBlobIds.size===0,597),this.redirectTable=e}}_n.basePath="_blobs";_n.redirectTableBlobName=".redirectTable";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class s9{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new uS(()=>{for(const[t,r]of this.deferredContexts)r.promise.then(i=>{i.dispose()}).catch(i=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:t},i)})}),this.dispose=()=>this.disposeOnce.value,this._logger=pe.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(!(this._contexts.get(e)===void 0||!this.notBoundContexts.has(e)))return this._contexts.get(e)}addUnbound(e){const t=e.id;k(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}async getBoundOrRemoted(e,t){const r=this.ensureDeferred(e);if(!(!t&&!r.isCompleted))return r.promise}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const r=new Bt;return this.deferredContexts.set(e,r),r}bind(e){const t=this.notBoundContexts.delete(e);k(t,345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);k(!!t,346),k(!this.notBoundContexts.has(e),347);const r=this.deferredContexts.get(e);k(!!r,348),r.resolve(t)}addBoundOrRemoted(e){const t=e.id;k(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var o9=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const a9=1,$i="gc",rk="__gc",l9="Fluid.GarbageCollection.RunGC",c9="Fluid.GarbageCollection.RunSweep",u9="Fluid.GarbageCollection.GCTestMode",d9="Fluid.GarbageCollection.WriteDataAtRoot",h9="Fluid.GarbageCollection.RunSessionExpiry",f9="Fluid.GarbageCollection.DisableSessionExpiry",p9="Fluid.GarbageCollection.TrackGCState",m9="Fluid.GarbageCollection.DisableSweepLog",gS=1*24*60*60*1e3,g9=7*gS,v9=30*gS,Jt={DataStore:"DataStore",SubDataStore:"SubDataStore",Blob:"Blob",Other:"Other"},bn={Active:"Active",Inactive:"Inactive",SweepReady:"SweepReady"};class g_{constructor(e,t,r,i){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=r,this._state=bn.Active,i!==void 0&&this.updateTracking(i)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(this.sweepTimeoutMs!==void 0&&t>=this.sweepTimeoutMs){this._state=bn.SweepReady,this.clearTimers();return}if(t>=this.inactiveTimeoutMs){this._state=bn.Inactive,this.clearTimers(),this.sweepTimeoutMs!==void 0&&ah(this.sweepTimeoutMs-t,()=>{this._state=bn.SweepReady},i=>{this.sweepTimer=i});return}const r=this.inactiveTimeoutMs-t;if(this.inactiveTimer===void 0){const i=()=>{this._state=bn.Inactive,this.sweepTimeoutMs!==void 0&&ah(this.sweepTimeoutMs-this.inactiveTimeoutMs,()=>{this._state=bn.SweepReady},s=>{this.sweepTimer=s})};this.inactiveTimer=new cf(r,()=>i())}this.inactiveTimer.restart(r)}clearTimers(){var e;(e=this.inactiveTimer)===null||e===void 0||e.clear(),this.sweepTimer!==void 0&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=bn.Active}}let y9=class ik{constructor(e){var t,r,i,s,o,a,l;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=a9,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const c=e.baseSnapshot,u=e.metadata,d=e.readAndParseBlob;this.mc=qa(pe.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}}));let h;if(e.existing)h=w_(u),this.gcEnabled=h>0,this.sweepEnabled=(t=u==null?void 0:u.sweepEnabled)!==null&&t!==void 0?t:!1,this.sessionExpiryTimeoutMs=u==null?void 0:u.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&this.gcOptions.gcAllowed===!1)throw new Te("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=this.gcOptions.gcAllowed!==!1,this.sweepEnabled=this.gcOptions.sweepAllowed===!0,this.mc.config.getBoolean(h9)&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=v9)}if(this.sessionExpiryTimeoutMs!==void 0&&this.mc.config.getBoolean(f9)!==!0){const g=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),S=g??this.sessionExpiryTimeoutMs;ah(S,()=>{this.runtime.closeFn(new wH("Client session expired.",S))},m=>{this.sessionExpiryTimer=m}),e.snapshotCacheExpiryMs!==void 0&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+gS)}if(this.latestSummaryGCVersion=h??this.currentGCVersion,this.shouldRunGC=(r=this.mc.config.getBoolean(l9))!==null&&r!==void 0?r:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&this.sweepTimeoutMs!==void 0&&((i=this.mc.config.getBoolean(c9))!==null&&i!==void 0?i:this.sweepEnabled),this.trackGCState=this.mc.config.getBoolean(p9)===!0,this.inactiveTimeoutMs=(o=(s=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))!==null&&s!==void 0?s:this.gcOptions.inactiveTimeoutMs)!==null&&o!==void 0?o:g9,this.sweepTimeoutMs!==void 0&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new Te("inactive timeout should not be greated than the sweep timeout");if(this.testMode=(a=this.mc.config.getBoolean(u9))!==null&&a!==void 0?a:this.gcOptions.runGCInTestMode===!0,this._writeDataAtRoot=(l=this.mc.config.getBoolean(d9))!==null&&l!==void 0?l:!0,this._writeDataAtRoot){const g=(c==null?void 0:c.trees[$i])!==void 0;this.initialStateNeedsReset=g!==this.shouldRunGC}const f=new aa(async()=>{var g;if(c===void 0)return;const S=c.trees[$i];if(S!==void 0){this._writeDataAtRoot=!0;const y=await v_(S,d);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(bm(y))),y}const m={gcNodes:{"/":{outboundRoutes:[]}}},v=ck(c,u);k(v!==void 0,680);for(const[y,b]of Object.entries(v.trees)){const w=b.blobs[ie.gcBlobKey];if(w===void 0)continue;const _=await d(w);if(((g=_.gcData)===null||g===void 0?void 0:g.gcNodes)===void 0)continue;const E=`/${y}`;(await d(b.blobs[oo])).isRootDataStore&&m.gcNodes["/"].outboundRoutes.push(E);for(const[A,F]of Object.entries(_.gcData.gcNodes)){const X=A==="/"?E:`${E}${A}`;m.gcNodes[X]={outboundRoutes:Array.from(F)}}k(m.gcNodes[E]!==void 0,681),m.gcNodes[E].unreferencedTimestampMs=_.unrefTimestamp}return Object.keys(m.gcNodes).length===1?void 0:m});this.initializeBaseStateP=new aa(async()=>{const g=this.runtime.getCurrentReferenceTimestampMs(),S=await f;if(S===void 0)return;const m={};for(const[v,y]of Object.entries(S.gcNodes))y.unreferencedTimestampMs!==void 0&&this.unreferencedNodesState.set(v,new g_(y.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,g)),m[v]=Array.from(y.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:m}}),this.baseGCDetailsP=new aa(async()=>{const g=await f;if(g===void 0)return new Map;const S={};for(const[y,b]of Object.entries(g.gcNodes))S[y]=Array.from(b.outboundRoutes);const m=ym(S,["/"]).referencedNodeIds,v=JR({gcData:{gcNodes:S},usedRoutes:m});for(const[y,b]of Object.entries(g.gcNodes))if(b.unreferencedTimestampMs!==void 0){const w=v.get(y.slice(1));w!==void 0&&(w.unrefTimestamp=b.unreferencedTimestampMs)}return v});const p=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:p}),this.shouldRunGC&&this.initializeBaseStateP.catch(g=>{const S=Nn.wrapIfUnrecognized(g,"FailedToInitializeGC");throw S.addTelemetryProperties({gcConfigs:p}),S})}static create(e){return new ik(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}async collectGarbage(e){const{fullGC:t=this.gcOptions.runFullGC===!0||this.summaryStateNeedsReset}=e,r=e.logger?pe.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return he.timedExecAsync(r,{eventName:"GarbageCollection"},async i=>{await this.runPreGCSteps();const s=await this.runtime.getGCData(t),o=ym(s.gcNodes,["/"]),a=await this.runPostGCSteps(s,o,r);return i.end(Object.assign({},a)),this.completedRuns++,a},{end:!0,cancel:"error"})}async runPreGCSteps(){await this.initializeBaseStateP,await this.runtime.updateStateBeforeGC()}async runPostGCSteps(e,t,r){const i=this.generateStats(t);this.updateStateSinceLastRun(e,r);const s=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,s),this.runtime.updateUsedRoutes(t.referencedNodeIds,s),this.logSweepEvents(r,s),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),await this.logUnreferencedEvents(r),i}summarize(e,t,r){var i;if(!this.shouldRunGC||this.previousGCDataFromLastRun===void 0)return;const s={gcNodes:{}};for(const[l,c]of Object.entries(this.previousGCDataFromLastRun.gcNodes))s.gcNodes[l]={outboundRoutes:c,unreferencedTimestampMs:(i=this.unreferencedNodesState.get(l))===null||i===void 0?void 0:i.unreferencedTimestampMs};const o=JSON.stringify(bm(s));if(this.trackGCState&&(this.pendingSerializedSummaryState=o,this.latestSerializedSummaryState!==void 0&&this.latestSerializedSummaryState===o&&!e&&t)){const l=ls();return l.handleNodeCount++,{summary:{type:Zi.Handle,handle:`/${$i}`,handleType:Zi.Tree},stats:l}}const a=new tn;return a.addBlob(`${rk}_root`,o),a.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}async getBaseGCDetails(){return this.baseGCDetailsP}async latestSummaryStateRefreshed(e,t){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked){this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0);return}const r=e.snapshot,i=r.blobs[Lv];if(i){const o=await t(i);this.latestSummaryGCVersion=w_(o)}const s=r.trees[$i];if(s!==void 0&&this.trackGCState){const o=await v_(s,t);this.latestSerializedSummaryState=JSON.stringify(bm(o))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0}nodeUpdated(e,t,r,i,s){if(!this.shouldRunGC)return;const o=this.unreferencedNodesState.get(e);o&&o.state!==bn.Active&&this.inactiveNodeUsed(t,e,o,void 0,i,r,s)}addedOutboundReference(e,t){var r;if(!this.shouldRunGC)return;const i=(r=this.newReferencesSinceLastRun.get(e))!==null&&r!==void 0?r:[];i.push(t),this.newReferencesSinceLastRun.set(e,i);const s=this.unreferencedNodesState.get(t);s&&s.state!==bn.Active&&this.inactiveNodeUsed("Revived",t,s,e)}dispose(){this.sessionExpiryTimer!==void 0&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,r){this.previousGCDataFromLastRun=Wl(e),this.newReferencesSinceLastRun.clear();for(const i of t.referencedNodeIds){const s=this.unreferencedNodesState.get(i);s!==void 0&&(s.stopTracking(),this.unreferencedNodesState.delete(i))}if(r!==void 0)for(const i of t.deletedNodeIds){const s=this.unreferencedNodesState.get(i);s===void 0?this.unreferencedNodesState.set(i,new g_(r,this.inactiveTimeoutMs,this.sweepTimeoutMs,r)):s.updateTracking(r)}}updateStateSinceLastRun(e,t){if(this.previousGCDataFromLastRun===void 0)return;const r=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&r.length>0&&r.forEach(o=>{const a={eventName:"gcUnknownOutboundReferences",gcNodeId:o[0],gcRoutes:JSON.stringify(o[1])};t.sendPerformanceEvent(a)}),this.newReferencesSinceLastRun.size===0)return;const i=kG(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach((o,a)=>{i.gcNodes[a]===void 0?i.gcNodes[a]=o:i.gcNodes[a].push(...o)});const s=ym(i.gcNodes,["/"]);for(const o of s.referencedNodeIds){const a=this.unreferencedNodesState.get(o);a!==void 0&&(a.stopTracking(),this.unreferencedNodesState.delete(o))}}findMissingExplicitReferences(e,t,r){k(t!==void 0,695);const i=Object.entries(e.gcNodes),s=[];return i.forEach(([o,a])=>{var l,c;const u=(l=t.gcNodes[o])!==null&&l!==void 0?l:[],d=(c=r.get(o))!==null&&c!==void 0?c:[],h=[];a.forEach(f=>{const p=this.runtime.getNodeType(f)===Jt.Blob||this.runtime.getNodeType(f)===Jt.DataStore,g=!o.startsWith(f);p&&g&&!u.includes(f)&&!d.includes(f)&&h.push(f)}),h.length>0&&s.push([o,h])}),s}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},r=(i,s)=>{t.nodeCount++;const o=this.previousGCDataFromLastRun===void 0||this.unreferencedNodesState.has(i)===s;o&&t.updatedNodeCount++,s||t.unrefNodeCount++,this.runtime.getNodeType(i)===Jt.DataStore&&(t.dataStoreCount++,o&&t.updatedDataStoreCount++,s||t.unrefDataStoreCount++),this.runtime.getNodeType(i)===Jt.Blob&&(t.attachmentBlobCount++,o&&t.updatedAttachmentBlobCount++,s||t.unrefAttachmentBlobCount++)};for(const i of e.referencedNodeIds)r(i,!0);for(const i of e.deletedNodeIds)r(i,!1);return t}logSweepEvents(e,t){this.mc.config.getBoolean(m9)===!0||t===void 0||this.sweepTimeoutMs===void 0||this.unreferencedNodesState.forEach((r,i)=>{if(r.state!==bn.SweepReady)return;const s=this.runtime.getNodeType(i);if(s!==Jt.DataStore&&s!==Jt.Blob)return;const o=`Deleted-${i}`;this.loggedUnreferencedEvents.has(o)||(this.loggedUnreferencedEvents.add(o),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:i,type:s,age:t-r.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))})}inactiveNodeUsed(e,t,r,i,s,o=this.runtime.getCurrentReferenceTimestampMs(),a){if(o===void 0||r.state===bn.Active||!this.isSummarizerClient&&e!=="Loaded")return;const l=this.runtime.getNodeType(t);if(l!==Jt.DataStore&&l!==Jt.Blob)return;const c=r.state,u=`${c}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(u))return;this.loggedUnreferencedEvents.add(u);const d={id:t,type:l,unrefTime:r.unreferencedTimestampMs,age:o-r.unreferencedTimestampMs,timeout:r.state===bn.Inactive?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:a==null?void 0:a[es.externalRequest],viaHandle:a==null?void 0:a[es.viaHandle],fromId:i};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},d),{usageType:e,state:c})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},d),{eventName:`${c}Object_${e}`,pkg:s?{value:s.join("/"),tag:De.CodeArtifact}:void 0}))}async logUnreferencedEvents(e){for(const t of this.pendingEventsQueue){const{usageType:r,state:i}=t,s=o9(t,["usageType","state"]),o=this.unreferencedNodesState.get(t.id),a=o===void 0||o.state===bn.Active;if(r==="Revived"===a){const l=await this.getNodePackagePath(t.id),c=t.fromId?await this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},s),{eventName:`${i}Object_${r}`,pkg:l?{value:l.join("/"),tag:De.CodeArtifact}:void 0,fromPkg:c?{value:c.join("/"),tag:De.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]}};async function v_(n,e){let t={gcNodes:{}};for(const r of Object.keys(n.blobs)){if(!r.startsWith(rk))continue;const i=n.blobs[r];if(i===void 0)continue;const s=await e(i);k(s!==void 0,685),t=RG(t,s)}return t}function bm(n){const e=Object.entries(n.gcNodes);e.sort(([r],[i])=>r.localeCompare(i));const t={gcNodes:{}};for(const[r,i]of e)i.outboundRoutes.sort(),t.gcNodes[r]=i;return t}function ah(n,e,t){let i;if(n>2147483647){const s=n-2147483647;i=setTimeout(()=>ah(s,e,t),2147483647)}else i=setTimeout(()=>e(),n);t(i)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function sk(n){return n.summaryFormatVersion?n.summaryFormatVersion:n.snapshotFormatVersion==="0.1"?1:0}function ok(n){return!!n.summaryFormatVersion&&!n.disableIsolatedChannels}const S9=n=>n===void 0?void 0:{clientId:n.clientId,clientSequenceNumber:n.clientSequenceNumber,minimumSequenceNumber:n.minimumSequenceNumber,referenceSequenceNumber:n.referenceSequenceNumber,sequenceNumber:n.sequenceNumber,timestamp:n.timestamp,type:n.type},y_=".aliases",Lv=".metadata",S_=".chunks",b_=".electedSummarizer",Iv=".blobs";function b9(n){return!!n&&!n.disableIsolatedChannels}function w_(n){var e;return n&&(e=n.gcFeature)!==null&&e!==void 0?e:0}const w9=".protocol",C9=[w9,".logTail",".serviceProtocol",Iv,$i],oo=".component";function lh(n){n.summary={type:Zi.Tree,tree:{[ie.channelsTreeName]:n.summary}},n.stats.treeNodeCount++}async function E9(n,e){const t=await mt(n,e.blobs[oo]),r=sk(t);return k(r>0,469),t}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function vS(n,e,t){const r=JSON.stringify(n);return t?{pkg:r,snapshotFormatVersion:"0.1",isRootDataStore:e}:{pkg:r,summaryFormatVersion:2,isRootDataStore:e}}function _9(n,e,t){const r=vS(n,e,t);return new MP(oo,JSON.stringify(r))}class Zc extends Ua{constructor(e,t,r,i,s){super(),this.existing=t,this.bindState=r,this.isLocalDataStore=i,this.makeLocallyVisibleFn=s,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=e.runtime,this.id=e.id,this.storage=e.storage,this.scope=e.scope,this.writeGCDataAtRoot=e.writeGCDataAtRoot,this.disableIsolatedChannels=e.disableIsolatedChannels,this.pkg=e.pkg,k(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==te.Detached&&this.existing?this.containerRuntime.attachState:te.Detached,this.bindToContext=()=>{k(this.bindState===Cn.NotBound,315),this.bindState=Cn.Binding,k(this.channel!==void 0,316),this.makeLocallyVisible(),this.bindState=Cn.Bound};const o=async(a,l,c)=>this.summarizeInternal(a,l,c);this.summarizerNode=e.createSummarizerNodeFn(o,async a=>this.getGCDataInternal(a),async()=>this.getBaseGCDetails()),this.subLogger=pe.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new NP(Zc.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return k(this.pkg!==void 0,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}async isRoot(){return this.isInMemoryRoot()||(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then(e=>{e.dispose()}).catch(e=>{}))}rejectDeferredRealize(e,t){throw new ue(e,{packageName:{value:t,tag:De.PackageData}})}async realize(){return k(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new Bt,this.realizeCore(this.existing).catch(e=>{var t;const r=Nn.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");r.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"RealizeError"},r)})),this.channelDeferred.promise}async factoryFromPackagePath(e){k(this.pkg===e,318),e===void 0&&this.rejectDeferredRealize("packages is undefined");let t,r=this._containerRuntime.IFluidDataStoreRegistry,i;for(const o of e)r||this.rejectDeferredRealize("No registry for package",i),i=o,t=await r.get(o),t||this.rejectDeferredRealize("Registry does not contain entry for the package",o),r=t.IFluidDataStoreRegistry;const s=t==null?void 0:t.IFluidDataStoreFactory;return s===void 0&&this.rejectDeferredRealize("Can't find factory for package",i),{factory:s,registry:r}}async realizeCore(e){const t=await this.getInitialSnapshotDetails();this._baseSnapshot=t.snapshot;const r=t.pkg,{factory:i,registry:s}=await this.factoryFromPackagePath(r);k(this.registry===void 0,319),this.registry=s;const o=await i.instantiateDataStore(this,e);k(o!==void 0,320),this.bindRuntime(o)}setConnectionState(e,t){this.verifyNotClosed(),this.loaded&&(k(this.connected===e,321),this.channel.setConnectionState(e,t))}process(e,t,r){var i;this.verifyNotClosed();const s=e.contents,o=Object.assign(Object.assign({},e),{type:s.type,contents:s.content});if(this.summarizerNode.recordChange(o),this.loaded)return(i=this.channel)===null||i===void 0?void 0:i.process(o,t,r);k(!t,322),k(this.pending!==void 0,573),this.pending.push(o),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(e,t){var r;this.verifyNotClosed(),this.loaded&&((r=this.channel)===null||r===void 0||r.processSignal(e,t))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){await this.realize();const i=await this.channel.summarize(e,t,r);let s;this.disableIsolatedChannels||(lh(i),s=[ie.channelsTreeName]);const{pkg:o}=await this.getInitialSnapshotDetails(),a=await this.isRoot(),l=vS(o,a,this.disableIsolatedChannels);return xr(i,oo,JSON.stringify(l)),this.writeGCDataAtRoot||xr(i,ie.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(i.summary.unreferenced=!0,i.stats.unreferencedBlobSize=i.stats.totalBlobSize),Object.assign(Object.assign({},i),{id:this.id,pathPartsForChildren:s})}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return await this.realize(),k(this.channel!==void 0,323),this.channel.getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}updateChannelUsedRoutes(){if(k(this.loaded,324),k(this.channel!==void 0,325),this.lastUsedState===void 0)return;const e=this.lastUsedState.usedRoutes.filter(t=>t!=="/"&&t!=="");this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}async request(e){return(await this.realize()).request(e)}submitMessage(e,t,r){this.verifyNotClosed(),k(!!this.channel,326);const i={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,i,r)}setChannelDirty(e){this.verifyNotClosed();const t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);const r=this.summarizerNode.getChild(e);r&&r.invalidate(t)}submitSignal(e,t){return this.verifyNotClosed(),k(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}makeLocallyVisible(){k(this.channel!==void 0,719),this.makeLocallyVisibleFn()}bindRuntime(e){var t;if(this.channel)throw new Error("Runtime already bound");try{k(!this.detachedRuntimeCreation,328),k(this.channelDeferred!==void 0,329),k(this.pkg!==void 0,330);const r=this.pending;for(const i of r)e.process(i,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",r.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(r){(t=this.channelDeferred)===null||t===void 0||t.reject(r),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},r)}}async getAbsoluteUrl(e){if(this.attachState===te.Attached)return this._containerRuntime.getAbsoluteUrl(e)}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(e,t){k(!!this.channel,331);const r=e;this.channel.reSubmit(r.type,r.content,t)}rollback(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");const r=e;this.channel.rollback(r.type,r.content,t)}async applyStashedOp(e){this.channel||await this.realize(),k(!!this.channel,332);const t=e;return this.channel.applyStashedOp(t.content)}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(e,t){return(r,i,s)=>this.summarizerNode.createChild(r,e,t,{throwOnFailure:!0},i,s)}async uploadBlob(e){return this.containerRuntime.uploadBlob(e)}}Zc.pendingOpsCountThreshold=1e3;class C_ extends Zc{constructor(e){super(e,!0,Cn.Bound,!1,()=>{throw new Error("Already attached")}),this.initialSnapshotDetailsP=new aa(async()=>{var t,r;let i,s=!0;if(typeof this.initSnapshotValue=="string"){const a=(await this.storage.getVersions(this.initSnapshotValue,1))[0];i=(t=await this.storage.getSnapshotTree(a))!==null&&t!==void 0?t:void 0}else i=this.initSnapshotValue;const o=async a=>mt(this.storage,a);if(i){const a=await this.summarizerNode.loadBaseSummary(i,o);i=a.baseSummary,this.pending=a.outstandingOps.concat(this.pending)}if(i&&i.blobs[oo]!==void 0){const a=await o(i.blobs[oo]);let l;sk(a)<1?a.pkg.startsWith('["')&&a.pkg.endsWith('"]')?l=JSON.parse(a.pkg):l=[a.pkg]:l=JSON.parse(a.pkg),this.pkg=l,s=(r=a.isRootDataStore)!==null&&r!==void 0?r:!0,ok(a)&&(i=i.trees[ie.channelsTreeName],k(i!==void 0,510))}return{pkg:this.pkg,isRootDataStore:s,snapshot:i}}),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new aa(async()=>{var t;return(t=await e.getBaseGCDetails())!==null&&t!==void 0?t:{}})}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}async getInitialGCSummaryDetails(){return this.getBaseGCDetails()}async getBaseGCDetails(){return this.baseGCDetailsP}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class ak extends Zc{constructor(e){super(e,e.snapshotTree!==void 0,e.snapshotTree?Cn.Bound:Cn.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,e.isRootDataStore===!0&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",()=>{k(this.attachState===te.Detached,333),this._attachState=te.Attaching}),this.once("attached",()=>{k(this.attachState===te.Attaching,334),this._attachState=te.Attached})}generateAttachMessage(){k(this.channel!==void 0,335),k(this.pkg!==void 0,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||lh(e);const t=vS(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);xr(e,oo,JSON.stringify(t));const r=oS(e.summary);return{id:this.id,snapshot:r,type:this.pkg[this.pkg.length-1]}}async getInitialSnapshotDetails(){var e;let t=this.snapshotTree,r,i=!1;return t!==void 0&&(r=await E9(this.storage,t),ok(r)&&(t=t.trees[ie.channelsTreeName],k(t!==void 0,511)),this.pkg===void 0&&(this.pkg=JSON.parse(r.pkg),(!((e=r.isRootDataStore)!==null&&e!==void 0)||e)&&(i=!0,this.setInMemoryRoot()))),k(this.pkg!==void 0,338),{pkg:this.pkg,isRootDataStore:i,snapshot:t}}async getInitialGCSummaryDetails(){return{}}async getBaseGCDetails(){return{}}}class E_ extends ak{constructor(e){super(e)}}class T9 extends ak{constructor(e){super(e),this.detachedRuntimeCreation=!0}async attachRuntime(e,t){k(this.detachedRuntimeCreation,340),k(this.channelDeferred===void 0,341);const r=e.IFluidDataStoreFactory,i=await this.factoryFromPackagePath(this.pkg);k(i.factory===r,342),k(this.registry===void 0,343),this.registry=i.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new Bt,super.bindRuntime(t),await this.isRoot()&&(t.makeVisibleAndAttachGraph!==void 0?t.makeVisibleAndAttachGraph():t.bindToContext())}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const lk=n=>typeof(n==null?void 0:n.internalId)=="string"&&typeof(n==null?void 0:n.alias)=="string",wm=(n,e,t,r,i)=>new x9(n,e,t,r,i);var yr;(function(n){n.Aliased="Aliased",n.Aliasing="Aliasing",n.None="None"})(yr||(yr={}));class x9{constructor(e,t,r,i,s){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=r,this.datastores=i,this.logger=s,this.aliasState=yr.None}async trySetAlias(e){if(e.includes("/"))throw new Te(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case yr.Aliasing:return k(this.aliasResult!==void 0,790),await this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case yr.Aliased:return this.alias===e?"Success":"AlreadyAliased";case yr.None:break;default:Rv(this.aliasState)}return this.aliasState=yr.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult}async trySetAliasInternal(e){const t={internalId:this.internalId,alias:e};if(this.fluidDataStoreChannel.makeVisibleAndAttachGraph!==void 0?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===te.Detached){const i=this.datastores.processAliasMessageCore(t);return this.aliasState=yr.Aliased,i?"Success":"Conflict"}return await this.ackBasedPromise(i=>{this.runtime.submitDataStoreAliasOp(t,i)}).then(i=>(this.aliasState=yr.Aliased,i&&(this.alias=e),i)).catch(i=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:De.UserData},internalId:{value:this.internalId,tag:De.PackageData}},i),this.aliasState=yr.None,!1))?"Success":"Conflict"}async request(e){return this.fluidDataStoreChannel.request(e)}get IFluidRouter(){return this.fluidDataStoreChannel}async ackBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class O9{constructor(e,t,r,i,s,o,a,l,c,u,d=new s9(o)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=r,this.getCreateChildSummarizerNodeFn=i,this.deleteChildSummarizerNodeFn=s,this.gcNodeUpdated=l,this.aliasMap=c,this.writeGCDataAtRoot=u,this.contexts=d,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new uS(()=>this.contexts.dispose()),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=pe.create(o),this.containerRuntimeHandle=new ca(this.runtime,"/",this.runtime.IFluidHandleContext);const h=new aa(async()=>a()),f=async S=>(await h).get(S),p=new Map;if(e)for(const[S,m]of Object.entries(e.trees))p.set(S,m);let g=0;for(const[S,m]of p){let v;if(m.unreferenced&&g++,this.runtime.attachState!==te.Detached)v=new C_({id:S,snapshotTree:m,getBaseGCDetails:async()=>f(S),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(S,{type:ie.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if(typeof m!="object")throw new ue("Snapshot should be there to load from!!");const y=m;v=new E_({id:S,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(S,{type:ie.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(S),snapshotTree:y,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(v)}this.containerLoadStats={containerLoadDataStoreCount:p.size,referencedDataStoreCount:p.size-g}}aliases(){return this.aliasMap}processAttachMessage(e,t){var r,i;const s=e.contents;if(this.dataStoresSinceLastGC.push(s.id),t){k(this.pendingAttach.has(s.id),350),(r=this.contexts.get(s.id))===null||r===void 0||r.emit("attached"),this.pendingAttach.delete(s.id);return}if(this.alreadyProcessed(s.id))throw new Rr("Duplicate DataStore created with existing id",Object.assign(Object.assign({},ro(e)),{dataStoreId:{value:s.id,tag:De.PackageData}}));const o=new Map;let a;s.snapshot&&(a=FP(s.snapshot.entries,o));const l=[s.type],c=new C_({id:s.id,snapshotTree:a,getBaseGCDetails:async()=>({}),runtime:this.runtime,storage:new CH(this.runtime.storage,o),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(s.id,{type:ie.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:(i=s.snapshot)!==null&&i!==void 0?i:{entries:[_9(l,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:l});this.contexts.addBoundOrRemoted(c)}processAliasMessage(e,t,r){const i=e.contents;if(!lk(i))throw new Rr("malformedDataStoreAliasMessage",Object.assign({},ro(e)));const s=t,o=this.processAliasMessageCore(i);r&&s(o)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(t===void 0)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const r=new ca(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return this.aliasMap.get(e)!==void 0||this.contexts.get(e)!==void 0}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if(k(!!t,351),this.runtime.attachState!==te.Detached){t.emit("attaching");const r=t.generateAttachMessage();this.pendingAttach.set(e,r),this.submitAttachFn(r),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,r=ot()){k(!r.includes("/"),780);const i=new T9({id:r,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(r,{type:ie.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(r),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(i),i}_createFluidDataStoreContext(e,t,r,i){k(!t.includes("/"),781);const s=new E_({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:ie.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:r,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:i});return this.contexts.addUnbound(s),s}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);k(!!i,352),i.reSubmit(r.contents,t)}rollbackDataStoreOp(e,t){const r=e,i=this.contexts.get(r.address);k(!!i,744),i.rollback(r.contents,t)}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return k(!!r,353),r.applyStashedOp(t.contents)}async applyStashedAttachOp(e){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)}processFluidDataStoreOp(e,t,r){const i=e.contents,s=Object.assign(Object.assign({},e),{contents:i.contents}),o=this.contexts.get(i.address);k(!!o,354),o.process(s,t,r),this.gcNodeUpdated(`/${i.address}`,e.timestamp,o.isLoaded?o.packagePath:void 0)}async getDataStore(e,t){const r=await this.contexts.getBoundOrRemoted(e,t);if(r===void 0)throw sf(qn({url:e}));return r}processSignal(e,t,r){const i=this.contexts.get(e);if(!i){k(!r,355),this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:De.PackageData}});return}i.processSignal(t,r)}setConnectionState(e,t){for(const[r,i]of this.contexts)try{i.setConnectionState(e,t)}catch(s){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:r},s)}}setAttachState(e){let t;e===te.Attaching?t="attaching":t="attached";for(const[,r]of this.contexts)this.contexts.isNotBound(r.id)||r.emit(t)}get size(){return this.contexts.size}async summarize(e,t,r){const i=new tn;return await Promise.all(Array.from(this.contexts).filter(([s,o])=>(k(o.attachState!==te.Attaching,357),o.attachState===te.Attached)).map(async([s,o])=>{const a=await o.summarize(e,t,r);i.addWithStats(s,a)})),i.getSummaryTree()}createSummary(e){const t=new tn;let r;do{const i=t.summary.tree;r=this.contexts.notBoundLength(),Array.from(this.contexts).filter(([s,o])=>!(this.contexts.isNotBound(s)||i[s]||this.attachOpFiredForDataStore.has(s))).map(([s,o])=>{let a;if(o.isLoaded){const l=o.generateAttachMessage().snapshot;a=iS(l,!0)}else k(!!this.baseSnapshot,358),a=sS(this.baseSnapshot.trees[s]);t.addWithStats(s,a)})}while(r!==this.contexts.notBoundLength());return t.getSummaryTree()}async updateStateBeforeGC(){for(const e of this.dataStoresSinceLastGC){const t=this.contexts.get(e);if(k(t!==void 0,694),await t.isRoot()){const r=new ca(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r)}}this.dataStoresSinceLastGC=[]}async getGCData(e=!1){const t=new lS;return await Promise.all(Array.from(this.contexts).filter(([r,i])=>i.attachState===te.Attached).map(async([r,i])=>{const s=await i.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)})),t.addNode("/",await this.getOutboundRoutes()),t.getGCData()}updateUsedRoutes(e,t){var r;const i=QR(e);for(const[s]of i)k(this.contexts.has(s),359);for(const[s,o]of this.contexts)o.updateUsedRoutes((r=i.get(s))!==null&&r!==void 0?r:[],t)}deleteUnusedRoutes(e){for(const t of e){const r=t.split("/");if(r.length>2)continue;const i=r[1];k(this.contexts.has(i),727),this.contexts.delete(i),this.deleteChildSummarizerNodeFn(i)}}async getOutboundRoutes(){const e=[];for(const[t,r]of this.contexts)await r.isRoot()&&e.push(`/${t}`);return e}async getDataStorePackagePath(e){var t;const r=this.contexts.get(e.split("/")[1]);return(t=await(r==null?void 0:r.getInitialSnapshotDetails()))===null||t===void 0?void 0:t.pkg}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return t.length===2?Jt.DataStore:Jt.SubDataStore}}function ck(n,e){if(n)if(b9(e)){const t=n.trees[ie.channelsTreeName];return k(!!t,360),t}else{const t={};for(const[r,i]of Object.entries(n.trees))C9.includes(r)||(t[r]=i);return Object.assign(Object.assign({},n),{trees:t})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Qr;(function(n){n[n.Local=0]="Local",n[n.Broadcast=1]="Broadcast",n[n.Acked=2]="Acked",n[n.Nacked=-1]="Nacked"})(Qr||(Qr={}));class Tc{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=Qr.Local,this.defSummaryOp=new Bt,this.defSummaryAck=new Bt}static createLocal(e,t){return new Tc(e,t)}static createFromOp(e){const t=new Tc(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===Qr.Acked}broadcast(e){return k(this.state===Qr.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=Qr.Broadcast,!0}ackNack(e){return k(this.state===Qr.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===st.SummaryAck?Qr.Acked:Qr.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class P9{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=Tc.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class R9 extends Ua{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new Bt,this.deltaManager.on("op",r=>this.handleOp(r))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-((t=(e=this.lastAck)===null||e===void 0?void 0:e.summaryAck.sequenceNumber)!==null&&t!==void 0?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new P9(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const e=Array.from(this.pendingSummaries,([,t])=>t.waitAckNack());await Promise.all(e)}return this.lastAck}async waitSummaryAck(e){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)await this.refreshWaitNextAck.promise;return this.lastAck}handleOp(e){var t;switch(e.type){case st.Summarize:{this.handleSummaryOp(e);return}case st.SummaryAck:{this.handleSummaryAck(e);return}case st.SummaryNack:{this.handleSummaryNack(e);return}default:{const r=e.timestamp;this.lastSummaryTimestamp!==void 0&&this.maxAckWaitTime!==void 0&&r-this.lastSummaryTimestamp>=this.maxAckWaitTime&&((t=this.pendingAckTimerTimeoutCallback)===null||t===void 0||t.call(this)),this.emit("default",e);return}}}handleSummaryOp(e){let t;const r=this.summaryWatchers.get(e.clientId);r&&(t=r.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=Tc.createFromOp(e),r&&r.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(st.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);if(!r||r.summaryOp===void 0){t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber});return}r.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:r.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new Bt,this.emit(st.SummaryAck,e))}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);r&&(r.ackNack(e),this.pendingSummaries.delete(t),this.emit(st.SummaryNack,e))}}class k9 extends Ua{constructor(e,t,r){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=pe.create(e,"OrderedClientCollection");const i=r.getMembers();for(const[s,o]of i)this.addClient(s,o);r.on("addMember",(s,o)=>{const a=this.addClient(s,o);this.emit("addClient",a,t.lastSequenceNumber)}),r.on("removeMember",s=>{const o=t.lastSequenceNumber,a=this.removeClient(s);a===void 0?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:s,sequenceNumber:o}):this.emit("removeClient",a,o)})}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){k(t.sequenceNumber>-1,502);let r=this._youngestClient;for(;r.sequenceNumber>t.sequenceNumber;)k(r.olderClient!==void 0,503),r=r.olderClient;const i={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:r,youngerClient:r.youngerClient};return i.olderClient.youngerClient=i,i.youngerClient===void 0?this._youngestClient=i:i.youngerClient.olderClient=i,this.clientMap.set(e,i),i}removeClient(e){const t=this.clientMap.get(e);if(t!==void 0)return t.olderClient.youngerClient=t.youngerClient,t.youngerClient===void 0?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;t.youngerClient!==void 0;)e.push(t.youngerClient),t=t.youngerClient;return e}}class N9 extends Ua{constructor(e,t,r,i){super(),this.orderedClientCollection=t,this.isEligibleFn=i,this._eligibleCount=0;let s,o;for(const a of t.getAllClients())this.addClient(a,0),typeof r!="number"&&(a.clientId===r.electedClientId&&(s=a,r.electedParentId===void 0&&a.client.details.type!==an&&(o=a)),a.clientId===r.electedParentId&&(o=a));t.on("addClient",(a,l)=>this.addClient(a,l)),t.on("removeClient",(a,l)=>this.removeClient(a,l)),typeof r=="number"?this._electionSequenceNumber=r:((s==null?void 0:s.clientId)!==r.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId,clientCount:t.count}):s!==void 0&&!i(s)&&(s=o=this.findFirstEligibleParent(o),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:s==null?void 0:s.clientId})),this._electedParent=o,this._electedClient=s,this._electionSequenceNumber=r.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let r=!1;const i=(e==null?void 0:e.client.details.type)===an,s=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,r=!0),this._electedParent!==e&&!i&&(this._electedParent=e,r=!0),r&&this.emit("election",e,t,s)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;t!==void 0&&(!this.isEligibleFn(t)||t.client.details.type===an);)t=t.youngerClient;return t}addClient(e,t){var r;if(this.isEligibleFn(e)){this._eligibleCount++;const i=e.client.details.type===an,s=((r=this._electedClient)===null||r===void 0?void 0:r.client.details.type)===an;this._electedClient===void 0||!s&&i?this.tryElectingClient(e,t):this._electedParent===void 0&&!i&&this.tryElectingParent(e,t)}}removeClient(e,t){var r,i,s,o,a;if(this.isEligibleFn(e)){if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==an)throw new Te("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const l=(i=this.findFirstEligibleParent((r=this._electedParent)===null||r===void 0?void 0:r.youngerClient))!==null&&i!==void 0?i:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(l,t)}else if(this._electedParent===e){if(((s=this._electedClient)===null||s===void 0?void 0:s.client.details.type)!==an)throw new Te("Elected client should be a summarizer client 2");const l=(a=this.findFirstEligibleParent((o=this._electedParent)===null||o===void 0?void 0:o.youngerClient))!==null&&a!==void 0?a:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(l,t)}}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,r;const i=(r=this.findFirstEligibleParent((t=this._electedParent)===null||t===void 0?void 0:t.youngerClient))!==null&&r!==void 0?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(i,e):this.tryElectingParent(i,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return(t=this.findFirstEligibleParent((e=this._electedParent)===null||e===void 0?void 0:e.youngerClient))!==null&&t!==void 0?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:(e=this.electedClient)===null||e===void 0?void 0:e.clientId,electedParentId:(t=this.electedParent)===null||t===void 0?void 0:t.clientId}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class L9{constructor(e,t,r){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=r,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(t!==void 0){const i=t-e;i>0&&(this.startTimes=this.startTimes.map(s=>s-i))}this.startTimes=this.startTimes.filter(i=>e-i<this.delayWindowMs);const r=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map(i=>i+r),r===this.maxDelayMs&&this.startTimes.shift(),r}}const I9=({multiplier:n=2,coefficient:e=1,offset:t=0,initialDelay:r=void 0}={})=>i=>Math.max(0,i<=0&&r!==void 0?r:e*Math.pow(n,i)+t);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */new Promise(()=>{});class yS{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new Bt}get cancelled(){return this._cancelled||k(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(e){const t=new yS(e);return await t.waitStart(),t}async waitStart(){if(this.runtime.disposed){this.stop("summarizerClientDisconnected");return}if(this.runtime.once("dispose",()=>this.stop("summarizerClientDisconnected")),!this.runtime.connected){const e=new Promise(t=>this.runtime.once("connected",t));await Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",()=>this.stop("summarizerClientDisconnected"))}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class A9{constructor(e,t,r,i,s=()=>En.now()){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=pe.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",o=>{this.startBatchSequenceNumber=o.sequenceNumber,this.batchProcessingStartTimeStamp=s(),this.trackedBatchCount++}),this.batchEventEmitter.on("batchEnd",(o,a)=>{k(this.startBatchSequenceNumber!==void 0&&this.batchProcessingStartTimeStamp!==void 0,698);const l=a.sequenceNumber-this.startBatchSequenceNumber+1;l>=r&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:l,threshold:r,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp,batchError:o!==void 0}),this.trackedBatchCount%i===0&&this.logger.sendPerformanceEvent({eventName:"Length",length:l,samplingRate:i,batchEndSequenceNumber:a.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0})}}const M9=(n,e,t=1e3,r=1e3)=>new A9(n,e,t,r);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Cm{constructor(e,t){this.storageGetter=e,this.blobs=t}static async serializeTree(e,t){const r={};return await this.serializeTreeCore(e,r,t),r}static async serializeTreeCore(e,t,r){const i=[];for(const s of Object.values(e.trees))i.push(this.serializeTreeCore(s,t,r));for(const s of Object.values(e.blobs)){const o=await r.readBlob(s);t[s]=c_(o,"utf8")}return Promise.all(i)}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const r of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(r,t);for(const r of Object.values(e.blobs)){const i=e.blobsContents[r];k(!!i,748),t[r]=c_(i,"utf8")}}get storage(){return this._storage?this._storage:(this._storage=this.storageGetter(),this._storage)}get repositoryUrl(){return this.storage.repositoryUrl}async readBlob(e){return this.blobs[e]!==void 0?MG(this.blobs[e],"utf8"):this.storage.readBlob(e)}async getSnapshotTree(e){return this.storage.getSnapshotTree(e)}async getVersions(e,t){return this.storage.getVersions(e,t)}async createBlob(e){return this.storage.createBlob(e)}async uploadSummaryWithContext(e,t){return this.storage.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storage.downloadSummary(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Kl{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,!t&&(e.inbound.on("push",r=>{var i;const s=typeof r.contents=="string"?r.contents:(i=JSON.stringify(r.contents))!==null&&i!==void 0?i:"",o=Kl.messageHasData(r)?r.data:"";this.messageSize[Kl.messageId(r)]=s.length+o.length}),e.on("op",r=>{var i;this._nonSystemOpCount+=Sc(r)?1:0;const s=Kl.messageId(r);this._opsSizeAccumulator+=(i=this.messageSize[s])!==null&&i!==void 0?i:0,this.messageSize.delete(s)}))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return e.data!==void 0}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}var Pe;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias"})(Pe||(Pe={}));const D9={state:"enabled",idleTime:5e3*3,maxTime:5e3*12,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6*10*1e3,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var es;(function(n){n.wait="wait",n.externalRequest="externalRequest",n.viaHandle="viaHandle"})(es||(es={}));const F9="Fluid.ContainerRuntime.UseDataStoreAliasing",z9="Fluid.ContainerRuntime.MaxConsecutiveReconnects",$9="Fluid.ContainerRuntime.MaxOpSizeInBytes",j9=768e3,q9="Fluid.ContainerRuntime.DisableOpTracking",B9=ie.FlushMode.TurnBased;var __;(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.Operation="op"})(__||(__={}));function U9(n){if(n.type===st.Operation){if(n.contents.address!==void 0&&n.contents.type===void 0)n.type=Pe.FluidDataStoreOp;else{const e=n.contents;k(e.type!==void 0,289),n.type=e.type,n.contents=e.contents}k(bc(n),290)}return n}class H9{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",i=>{if(i.length===0)return;const s=i[0].metadata;if(!(s!=null&&s.batch))return;if(i.length===1){delete s.batch;return}const o=i[i.length-1];o.metadata=Object.assign(Object.assign({},o.metadata),{batch:!1})}),this.deltaManager.inbound.on("push",i=>{this.trackPending(i)}),k(!this.localPaused,659);const r=this.deltaManager.inbound.toArray();for(const i of r)this.trackPending(i);this.deltaManager.on("op",i=>this.afterOpProcessing(i.sequenceNumber))}afterOpProcessing(e){if(k(!this.localPaused,660),this.deltaManager.inbound.length===0){k(this.pauseSequenceNumber===void 0,661);return}this.pauseSequenceNumber!==void 0&&(k(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue())}pauseQueue(){k(!this.localPaused,663),this.localPaused=!0,this.timePaused=En.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const r=t.sequenceNumber,i=this.localPaused?En.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3===1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:r,length:r-e+1,msnDistance:r-t.minimumSequenceNumber,duration:i,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,i!==void 0&&i>nk&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:i,sequenceNumber:r,length:r-e}),this.deltaManager.inbound.resume())}trackPending(e){k(this.deltaManager.inbound.length!==0,664),k(this.currentBatchClientId===void 0==(this.pauseSequenceNumber===void 0),665);const t=e.metadata,r=t==null?void 0:t.batch;if(!bc(e)){k(this.currentBatchClientId===void 0,666),k(r===void 0,667),k(!this.localPaused,668);return}if(this.currentBatchClientId===void 0&&r===void 0){k(!this.localPaused,669);return}if((this.currentBatchClientId!==void 0||r===!1)&&this.currentBatchClientId!==e.clientId)throw new Rr("OpBatchIncomplete",Object.assign({runtimeVersion:dd,batchClientId:this.currentBatchClientId},ro(e)));r?(k(this.currentBatchClientId===void 0,670),k(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,this.deltaManager.inbound.length===1&&this.pauseQueue()):r===!1?(k(this.pauseSequenceNumber!==void 0,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):k(this.currentBatchClientId!==void 0,673)}}class V9{constructor(e,t,r){this.deltaManager=e,this.emitter=t,this.logger=r,this.hitError=!1,this.deltaScheduler=new _c(this.deltaManager,pe.create(this.logger,"DeltaScheduler")),new H9(e,r)}beforeOpProcessing(e){var t;this.batchClientId!==e.clientId&&(k(this.batchClientId===void 0,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e),((t=e==null?void 0:e.metadata)===null||t===void 0?void 0:t.batch)?this.batchClientId=e.clientId:this.batchClientId=void 0)}afterOpProcessing(e,t){var r;if(k(!this.hitError,675),e){this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),this.deltaScheduler.batchEnd(t);return}const i=(r=t==null?void 0:t.metadata)===null||r===void 0?void 0:r.batch;if(this.batchClientId===void 0||i===!1){this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),this.deltaScheduler.batchEnd(t);return}}}const T_="_scheduler";function W9(){try{if(typeof navigator=="object"&&navigator!==null)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch{}return{}}class SS extends Ua{constructor(e,t,r,i,s,o,a,l,c,u,d,h,f,p){var g,S,m,v,y,b,w,_,E;p===void 0&&(p=Object.assign(Object.assign({},D9),(g=a.summaryOptions)===null||g===void 0?void 0:g.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=a,this.containerScope=l,this.logger=c,this._storage=h,this.requestHandler=f,this.summaryConfiguration=p,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...z)=>{if(this.clientDetails.type===an)return this.summarizer.summarizeOnDemand(...z);if(this.summaryManager!==void 0)return this.summaryManager.summarizeOnDemand(...z);throw new Te(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...z)=>{if(this.clientDetails.type===an)return this.summarizer.enqueueSummarize(...z);if(this.summaryManager!==void 0)return this.summaryManager.enqueueSummarize(...z);throw new Te(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=r==null?void 0:r.message,this.disableIsolatedChannels=(S=this.runtimeOptions.summaryOptions.disableIsolatedChannels)!==null&&S!==void 0?S:!1,this._connected=this.context.connected,this.chunkMap=new Map(s),this.handleContext=new zG("",this),this.mc=qa(pe.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=((m=this.mc.config.getBoolean(F9))!==null&&m!==void 0?m:!1)||((v=a.useDataStoreAliasing)!==null&&v!==void 0?v:!1),this._maxOpSizeInBytes=(y=this.mc.config.getNumber($9))!==null&&y!==void 0?y:j9,this.maxConsecutiveReconnects=(b=this.mc.config.getNumber(z9))!==null&&b!==void 0?b:this.defaultMaxConsecutiveReconnects,this._flushMode=a.flushMode;const P=e.pendingLocalState,A=(w=P==null?void 0:P.baseSnapshot)!==null&&w!==void 0?w:e.baseSnapshot;this.garbageCollector=y9.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:A,baseLogger:this.mc.logger,existing:u,metadata:r,isSummarizerClient:this.context.clientDetails.type===an,getNodePackagePath:async z=>this.getGCNodePackagePath(z),getLastSummaryTimestampMs:()=>{var z;return(z=this.messageAtLastSummary)===null||z===void 0?void 0:z.timestamp},readAndParseBlob:async z=>mt(this.storage,z)});const F=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=LG(pe.create(this.logger,"SummarizerNode"),async(z,ee,W)=>this.summarizeInternal(z,ee,W),F,A?F:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),A&&this.summarizerNode.loadBaseSummaryWithoutDifferential(A),this.dataStores=new O9(ck(A,r),this,z=>this.submit(Pe.Attach,z),(z,ee)=>(W,C,L)=>this.summarizerNode.createChild(W,z,ee,void 0,C,L),z=>this.summarizerNode.deleteChild(z),this.mc.logger,async()=>this.garbageCollector.getBaseGCDetails(),(z,ee,W)=>this.garbageCollector.nodeUpdated(z,"Changed",ee,W),new Map(o),this.garbageCollector.writeDataAtRoot),this.blobManager=new _n(this.handleContext,d,()=>this.storage,z=>this.submit(Pe.BlobAttach,void 0,void 0,{blobId:z}),z=>this.garbageCollector.nodeUpdated(z,"Loaded"),this,this.logger),this.scheduleManager=new V9(e.deltaManager,this,pe.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new i9({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:z=>this.setFlushMode(z)},this._flushMode,P==null?void 0:P.pending),this.context.quorum.on("removeMember",z=>{this.clearPartialChunks(z)}),this.summaryCollection=new R9(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==te.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const z=pe.create(this.logger,"OrderedClientElection"),ee=new k9(z,this.context.deltaManager,this.context.quorum),W=new N9(z,ee,i??this.context.deltaManager.lastSequenceNumber,la.isClientEligible);if(this.summarizerClientElection=new la(z,this.summaryCollection,W,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===an)this._summarizer=new mS("/_summarizer",this,()=>this.summaryConfiguration,this,this.handleContext,this.summaryCollection,async C=>yS.create(C));else if(la.clientDetailsPermitElection(this.context.clientDetails)){const C=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(st.SummaryAck,()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",C)}),this.summaryCollection.off("default",C))};this.summaryCollection.on("default",C),this.summaryManager=new uf(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new L9(60*1e3,30*1e3,I9({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}this.deltaManager.on("readonly",z=>{k(z===this.deltaManager.readOnlyInfo.readonly,292),k(!z||!this.connected,293),this.replayPendingStates()}),c.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},W9()));let X;u?(this.createContainerMetadata={createContainerRuntimeVersion:r==null?void 0:r.createContainerRuntimeVersion,createContainerTimestamp:r==null?void 0:r.createContainerTimestamp},X=(E=(_=r==null?void 0:r.summaryNumber)!==null&&_!==void 0?_:r==null?void 0:r.summaryCount)!==null&&E!==void 0?E:0):(this.createContainerMetadata={createContainerRuntimeVersion:dd,createContainerTimestamp:Date.now()},X=0),this.nextSummaryNumber=X+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:X,summaryFormatVersion:r==null?void 0:r.summaryFormatVersion,disableIsolatedChannels:r==null?void 0:r.disableIsolatedChannels,gcVersion:r==null?void 0:r.gcFeature})),r9(this.context.clientId,this.deltaManager,this.logger),M9(this,this.logger),this.opTracker=new Kl(this.deltaManager,this.mc.config.getBoolean(q9)===!0)}get IContainerRuntime(){return this}get IFluidRouter(){return this}static async load(e,t,r,i={},s=e.scope,o){var a,l,c;const u=e,d=(a=u.taggedLogger)!==null&&a!==void 0?a:new vH(u.logger),h=pe.create(d,void 0,{all:{runtimeVersion:dd}}),{summaryOptions:f={},gcOptions:p={},loadSequenceNumberVerification:g="close",useDataStoreAliasing:S=!1,flushMode:m=B9,enableOfflineLoad:v=!1}=i,y=e.pendingLocalState,b=(l=y==null?void 0:y.baseSnapshot)!==null&&l!==void 0?l:e.baseSnapshot,w=y?new Cm(()=>e.storage,y.snapshotBlobs):e.storage,_=new dS(t),E=async L=>{const H=b==null?void 0:b.blobs[L];if(b&&H)return k(w!==void 0,501),mt(w,H)},[P,A,F,X]=await Promise.all([E(S_),E(Lv),E(b_),E(y_)]),z=o===!0||e.existing===!0,ee=await _n.load(b==null?void 0:b.trees[Iv],async L=>(k(w!==void 0,598),mt(w,L))),W=(c=A==null?void 0:A.message)===null||c===void 0?void 0:c.sequenceNumber;if(!y&&W!==void 0){const L=e.deltaManager.initialSequenceNumber;if(g!=="bypass"&&W!==L){const H=new Rr("Summary metadata mismatch",{runtimeVersion:dd,runtimeSequenceNumber:W,protocolSequenceNumber:L});g==="log"?h.sendErrorEvent({eventName:"SequenceNumberMismatch"},H):e.closeFn(H)}}const C=new SS(e,_,A,F,P??[],X??[],{summaryOptions:f,gcOptions:p,loadSequenceNumberVerification:g,useDataStoreAliasing:S,flushMode:m,enableOfflineLoad:v},s,h,z,ee,w,r);return y&&(await C.processSavedOps(y),y.savedOps=[]),await C.getSnapshotBlobs(),C}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return(e=this.summarizerClientElection)===null||e===void 0?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return k(this._summarizer!==void 0,599),this._summarizer}isSummariesDisabled(){return this.runtimeOptions.summaryOptions.disableSummaries===!0?!0:this.summaryConfiguration.state==="disabled"}isHeuristicsDisabled(){var e;return((e=this.runtimeOptions.summaryOptions.summarizerOptions)===null||e===void 0?void 0:e.disableHeuristics)===!0?!0:this.summaryConfiguration.state==="disableHeuristics"}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))!==null&&e!==void 0?e:!0:this.runtimeOptions.summaryOptions.summarizerClientElection===!0?!0:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.summarizerClientElection===!0:!1}getMaxOpsSinceLastSummary(){return this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary!==void 0?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return this.runtimeOptions.summaryOptions.initialSummarizerDelayMs!==void 0?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:this.summaryConfiguration.state!=="disabled"?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),this.summaryManager!==void 0&&this.summaryManager.dispose(),this.garbageCollector.dispose(),(t=this._summarizer)===null||t===void 0||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(!((e=this.options)===null||e===void 0)&&e.intelligence)return{intelligence:this.options.intelligence}}async request(e){try{const t=kr.create(e);return t.pathParts[0]==="_summarizer"&&t.pathParts.length===1?this._summarizer!==void 0?{status:200,mimeType:"fluid/object",value:this.summarizer}:qn(e):this.requestHandler!==void 0?this.requestHandler(t,this):qn(e)}catch(t){return rh(t)}}async resolveHandle(e){try{const t=kr.create(e),r=t.pathParts[0];if(r==="_channels")return this.resolveHandle(t.createSubRequest(1));if(r===_n.basePath&&t.isLeaf(2)){const i=await this.blobManager.getBlob(t.pathParts[1]);return i?{status:200,mimeType:"fluid/object",value:i.get()}:qn(e)}else if(t.pathParts.length>0){const i=await this.getDataStoreFromRequest(r,e),s=t.createSubRequest(1);return k(s.url.startsWith("/"),294),i.IFluidRouter.request(s)}return qn(e)}catch(t){return rh(t)}}internalId(e){var t;return(t=this.dataStores.aliases().get(e))!==null&&t!==void 0?t:e}async getDataStoreFromRequest(e,t){var r,i,s;const o=typeof((r=t.headers)===null||r===void 0?void 0:r[es.wait])=="boolean"?(i=t.headers)===null||i===void 0?void 0:i[es.wait]:!0,a=this.internalId(e),l=await this.dataStores.getDataStore(a,o);if(!((s=t.headers)===null||s===void 0)&&s[es.externalRequest]&&this.garbageCollector.shouldRunGC){const d=(await l.getBaseGCDetails()).usedRoutes;if(!(d===void 0||d.includes("")||d.includes("/")))throw sf(qn(t))}const c=await l.realize(),u=TG(t.url.split("?")[0]);return this.garbageCollector.nodeUpdated(`/${u}`,"Loaded",void 0,l.packagePath,t==null?void 0:t.headers),c}addMetadataToSummary(e){var t;const r=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:(t=S9(this.deltaManager.lastMessage))!==null&&t!==void 0?t:this.messageAtLastSummary});xr(e,Lv,JSON.stringify(r))}addContainerStateToSummary(e,t,r,i){var s;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const l=JSON.stringify([...this.chunkMap]);xr(e,S_,l)}const o=this.dataStores.aliases();if(o.size>0&&xr(e,y_,JSON.stringify([...o])),this.summarizerClientElection){const l=JSON.stringify((s=this.summarizerClientElection)===null||s===void 0?void 0:s.serialize());xr(e,b_,l)}const a=this.blobManager.summarize();if(Object.keys(a.summary.tree).length>0&&SG(e,Iv,a),this.garbageCollector.writeDataAtRoot){const l=this.garbageCollector.summarize(t,r,i);l!==void 0&&bG(e,$i,l)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0?!0:this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0)}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;this.dirtyContainer=!1,k(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;let t;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}async applyStashedOp(e,t){switch(e){case Pe.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case Pe.Attach:return this.dataStores.applyStashedAttachOp(t);case Pe.Alias:case Pe.BlobAttach:return;case Pe.ChunkedOp:throw new Error("chunkedOp not expected here");case Pe.Rejoin:throw new Error("rejoin not expected here");default:Rv(e,`Unknown ContainerMessageType: ${e}`)}}setConnectionState(e,t){this.verifyNotClosed();const r=this._connected!==e,i=r&&e;if(this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),i&&(this.consecutiveReconnects++,!this.shouldContinueReconnecting())){this.closeFn(Nn.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}));return}r&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),R0(this.mc.logger,this,e,t)}process(e,t){var r,i;if(this.verifyNotClosed(),!bc(e))return;((r=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&r!==void 0?r:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let s=Object.assign({},e);this.scheduleManager.beforeOpProcessing(s);try{s=U9(s),s=this.processRemoteChunkedMessage(s);let o;switch(t&&s.type!==Pe.ChunkedOp&&(o=this.pendingStateManager.processPendingLocalMessage(s)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),s.type){case Pe.Attach:this.dataStores.processAttachMessage(s,t);break;case Pe.Alias:this.processAliasMessage(s,o,t);break;case Pe.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(s,t,o);break;case Pe.BlobAttach:k((i=s==null?void 0:s.metadata)===null||i===void 0?void 0:i.blobId,298),this.blobManager.processBlobAttachOp(s.metadata.blobId,t);break;default:}this.emit("op",s),this.scheduleManager.afterOpProcessing(void 0,s),t&&this.resetReconnectCount()}catch(o){throw this.scheduleManager.afterOpProcessing(o,s),o}}processAliasMessage(e,t,r){this.dataStores.processAliasMessage(e,t,r)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const r=e.content,i={clientId:e.clientId,content:r.contents.content,type:r.contents.type};if(e.clientId===this.clientId&&this.connected&&(this._perfSignalData.trackingSignalSequenceNumber!==void 0&&r.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:r.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:r.clientSignalSequenceNumber})):r.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(r.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),r.address===void 0){this.emit("signal",i,t);return}this.dataStores.processSignal(r.address,i,t)}async getRootDataStore(e,t=!0){const r=this.internalId(e),i=await this.dataStores.getDataStore(r,t);return k(await i.isRoot(),299),i.realize()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===ie.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(k(this._orderSequentiallyCalls===0,588),!!this.deltaSender&&(this.pendingStateManager.onFlush(),!!this.needsFlush&&(this.needsFlush=!1,!!this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===ie.FlushMode.TurnBased){this.trackOrderSequentiallyCalls(e);return}const t=this.flushMode;this.setFlushMode(ie.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(r){throw t?t.rollback():this.closeFn(new ti("orderSequentially callback exception",r)),r}finally{this._orderSequentiallyCalls--}}async createDataStore(e){const t=ot();return wm(await this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)}async createRootDataStoreLegacy(e,t){const r=await this._createDataStore(e,!0,t);return r.makeVisibleAndAttachGraph!==void 0?r.makeVisibleAndAttachGraph():r.bindToContext(),r}async createRootDataStore(e,t){if(t.includes("/"))throw new Te(`Id cannot contain slashes: '${t}'`);return this._aliasingEnabled===!0?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)}async createAndAliasDataStore(e,t,r){const i=ot(),s=await this._createDataStore(e,!1,i,r),o=wm(s,i,this,this.dataStores,this.mc.logger),a=await o.trySetAlias(t);if(a!=="Success")throw new ti("dataStoreAliasFailure",void 0,{alias:{value:t,tag:De.UserData},internalId:{value:i,tag:De.PackageData},aliasResult:a});return o}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new Te(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}async _createDataStoreWithPropsLegacy(e,t,r=ot(),i=!1){const s=await this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,i,t).realize();return i&&(s.makeVisibleAndAttachGraph!==void 0?s.makeVisibleAndAttachGraph():s.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:t!==void 0})),wm(s,r,this,this.dataStores,this.mc.logger)}async _createDataStoreWithProps(e,t,r=ot(),i=!1){return this._aliasingEnabled===!0&&i?this.createAndAliasDataStore(e,r,t):this._createDataStoreWithPropsLegacy(e,t,r,i)}async _createDataStore(e,t,r=ot(),i){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,t,i).realize()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===Pe.Attach){if(t.id===T_)return!1}else if(e===Pe.FluidDataStoreOp&&t.address===T_)return!1;return!0}createNewSignalEnvelope(e,t,r){const i=++this._perfSignalData.signalSequenceNumber,s={address:e,clientSignalSequenceNumber:i,contents:{type:t,content:r}};return i%this.defaultTelemetrySignalSampleCount===1&&this._perfSignalData.trackingSignalSequenceNumber===void 0&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=i),s}submitSignal(e,t){this.verifyNotClosed();const r=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(r)}submitDataStoreSignal(e,t,r){const i=this.createNewSignalEnvelope(e,t,r);return this.context.submitSignalFn(i)}setAttachState(e){e===te.Attaching?k(this.attachState===te.Attaching,301):(k(this.attachState===te.Attached,302),this.emit("attached")),e===te.Attached&&!this.pendingStateManager.hasPendingMessages()&&this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const r=this.dataStores.createSummary(t);return this.disableIsolatedChannels||lh(r),this.addContainerStateToSummary(r,!0,!1,t),r.summary}async getAbsoluteUrl(e){if(this.context.getAbsoluteUrl===void 0)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===te.Attached)return this.context.getAbsoluteUrl(e)}async summarizeInternal(e,t,r){const i=await this.dataStores.summarize(e,t,r);let s;return this.disableIsolatedChannels||(lh(i),s=[ie.channelsTreeName]),this.addContainerStateToSummary(i,e,t,r),Object.assign(Object.assign({},i),{id:"",pathPartsForChildren:s})}async summarize(e){this.verifyNotClosed();const{fullTree:t=!1,trackState:r=!0,summaryLogger:i=this.mc.logger,runGC:s=this.garbageCollector.shouldRunGC,runSweep:o,fullGC:a}=e;let l;s&&(l=await this.collectGarbage({logger:i,runSweep:o,fullGC:a}));const c=new CG,{stats:u,summary:d}=await this.summarizerNode.summarize(t,r,c);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:c.serialize()}),k(d.type===Zi.Tree,303),{stats:u,summary:d,gcStats:l}}async updateStateBeforeGC(){return this.dataStores.updateStateBeforeGC()}async getGCData(e){const t=new lS,r=await this.dataStores.getGCData(e);t.addNodes(r.gcNodes);const i=this.blobManager.getGCData(e);return t.addNodes(i.gcNodes),t.getGCData()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const r=[];for(const i of e)i.split("/")[1]!==_n.basePath&&r.push(i);return this.dataStores.updateUsedRoutes(r,t)}deleteUnusedRoutes(e){const t=[],r=[];for(const i of e)this.isBlobPath(i)?t.push(i):r.push(i);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(r)}getCurrentReferenceTimestampMs(){var e,t,r;return(t=(e=this.deltaManager.lastMessage)===null||e===void 0?void 0:e.timestamp)!==null&&t!==void 0?t:(r=this.messageAtLastSummary)===null||r===void 0?void 0:r.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?Jt.Blob:(t=this.dataStores.getGCNodeType(e))!==null&&t!==void 0?t:Jt.Other}async getGCNodePackagePath(e){switch(this.getNodeType(e)){case Jt.Blob:return["_blobs"];case Jt.DataStore:case Jt.SubDataStore:return this.dataStores.getDataStorePackagePath(e);default:k(!1,734)}}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==_n.basePath)}async collectGarbage(e){return this.garbageCollector.collectGarbage(e)}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}async submitSummary(e){var t,r,i;const{fullTree:s,refreshLatestAck:o,summaryLogger:a}=e,l=this.nextSummaryNumber,c=pe.create(a,void 0,{all:{summaryNumber:l}});let u;if(o){const d=await this.refreshLatestSummaryAckFromServer(pe.create(c,void 0,{all:{safeSummary:!0}})),h=d.latestSnapshotRefSeq;u=d.latestSnapshotVersionId,h>this.deltaManager.lastSequenceNumber&&await he.timedExecAsync(c,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:h,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},async()=>G9(this.deltaManager,h),{start:!0,end:!0,cancel:"error"})}try{await this.deltaManager.inbound.pause();const d=this.deltaManager.lastSequenceNumber,h=this.deltaManager.minimumSequenceNumber,f=`Summary @${d}:${this.deltaManager.minimumSequenceNumber}`;d!==((t=this.deltaManager.lastMessage)===null||t===void 0?void 0:t.sequenceNumber)&&c.sendErrorEvent({eventName:"LastSequenceMismatch",error:f}),this.summarizerNode.startSummary(d,c);const p=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(k(this.connected,600),this.deltaManager.lastSequenceNumber!==d?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${d}`}:{continue:!0});let g=p();if(!g.continue)return{stage:"base",referenceSequenceNumber:d,minimumSequenceNumber:h,error:g.error};const S=d_.start();let m;const v=this.garbageCollector.summaryStateNeedsReset;try{m=await this.summarize({fullTree:s||v,trackState:!0,summaryLogger:c,runGC:this.garbageCollector.shouldRunGC})}catch(I){return{stage:"base",referenceSequenceNumber:d,minimumSequenceNumber:h,error:I}}const{summary:y,stats:b}=m;this.messageAtLastSummary=this.deltaManager.lastMessage;const w=this.disableIsolatedChannels?y:y.tree[ie.channelsTreeName];k(w.type===Zi.Tree,508);const _=Object.values(w.tree).filter(I=>I.type===Zi.Handle).length,E=y.tree[$i]?GR(y.tree[$i]):void 0,P=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-_,gcStateUpdatedDataStoreCount:(r=m.gcStats)===null||r===void 0?void 0:r.updatedDataStoreCount,gcBlobNodeCount:E==null?void 0:E.blobNodeCount,gcTotalBlobsSize:E==null?void 0:E.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:l},b),A={referenceSequenceNumber:d,minimumSequenceNumber:h,summaryTree:y,summaryStats:P,generateDuration:S.trace().duration,forcedFullTree:v};if(g=p(),!g.continue)return Object.assign(Object.assign({stage:"generate"},A),{error:g.error});const F=this.summaryCollection.latestAck;let X;(F==null?void 0:F.summaryAck.contents.handle)!==u&&u!==void 0?X={proposalHandle:void 0,ackHandle:u,referenceSequenceNumber:d}:F===void 0?X={proposalHandle:void 0,ackHandle:(i=this.context.getLoadedFromVersion())===null||i===void 0?void 0:i.id,referenceSequenceNumber:d}:X={proposalHandle:F.summaryOp.contents.handle,ackHandle:F.summaryAck.contents.handle,referenceSequenceNumber:d};let z;try{z=await this.storage.uploadSummaryWithContext(m.summary,X)}catch(I){return Object.assign(Object.assign({stage:"generate"},A),{error:I})}const ee=X.ackHandle,W={handle:z,head:ee,message:f,parents:ee?[ee]:[]},C=Object.assign(Object.assign({},A),{handle:z,uploadDuration:S.trace().duration});if(g=p(),!g.continue)return Object.assign(Object.assign({stage:"upload"},C),{error:g.error});let L;try{L=this.submitSystemMessage(st.Summarize,W)}catch(I){return Object.assign(Object.assign({stage:"upload"},C),{error:I})}const H=Object.assign(Object.assign({stage:"submit"},C),{clientSequenceNumber:L,submitOpDuration:S.trace().duration});return this.summarizerNode.completeSummary(z),this.opTracker.reset(),H}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}}processRemoteChunkedMessage(e){if(e.type!==Pe.ChunkedOp)return e;const t=e.clientId,r=e.contents;if(this.addChunk(t,r),r.chunkId===r.totalChunks){const i=Object.assign({},e),s=this.chunkMap.get(t).join("");return i.contents=JSON.parse(s),i.type=r.originalType,this.clearPartialChunks(t),i}return e}addChunk(e,t){let r=this.chunkMap.get(e);r===void 0&&(r=[],this.chunkMap.set(e,r)),k(t.chunkId===r.length+1,305),r.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,r=void 0){const i={address:e,contents:t};this.submit(Pe.FluidDataStoreOp,i,r)}submitDataStoreAliasOp(e,t){if(!lk(e))throw new Te("malformedDataStoreAliasMessage");this.submit(Pe.Alias,e,t)}async uploadBlob(e){return this.verifyNotClosed(),this.blobManager.createBlob(e)}submit(e,t,r=void 0,i=void 0){this.verifyNotClosed(),k(this.attachState!==te.Detached,306);let s=-1,o=i;if(this.canSendOps()){const a=JSON.stringify(t),l=this.context.deltaManager.maxMessageSize;this.flushMode===ie.FlushMode.TurnBased&&!this.needsFlush&&(o=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then(()=>{this.flushTrigger=!1,this.flush()})),s=this.submitMaybeChunkedMessages(e,t,a,l,this._flushMode===ie.FlushMode.TurnBased,o)}this.pendingStateManager.onSubmitMessage(e,s,this.deltaManager.lastSequenceNumber,t,r,o),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,r,i,s,o=void 0){return this._maxOpSizeInBytes>=0?!r||r.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,s,o):(this.closeFn(new ti("OpTooLarge",void 0,{length:{value:r.length,tag:De.PackageData},limit:{value:this._maxOpSizeInBytes,tag:De.PackageData}})),-1):!r||r.length<=i?this.submitRuntimeMessage(e,t,s,o):this.submitChunkedMessage(e,r,i)}submitChunkedMessage(e,t,r){const i=t.length,s=Math.floor((i-1)/r)+1;let o=0,a=0;for(let l=1;l<=s;l=l+1){const c={chunkId:l,contents:t.substr(o,r),originalType:e,totalChunks:s};o+=r,a=this.submitRuntimeMessage(Pe.ChunkedOp,c,!1)}return a}submitSystemMessage(e,t){this.verifyNotClosed(),k(this.connected,307);const r=this.flushMode===ie.FlushMode.TurnBased&&this.needsFlush;return r&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,r)}submitRuntimeMessage(e,t,r,i){this.verifyNotClosed(),k(this.connected,601);const s={type:e,contents:t};return this.context.submitFn(st.Operation,s,r,i)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,r,i){switch(e){case Pe.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,r);break;case Pe.Attach:case Pe.Alias:this.submit(e,t,r);break;case Pe.ChunkedOp:throw new Error("chunkedOp not expected here");case Pe.BlobAttach:this.submit(e,t,r,i);break;case Pe.Rejoin:this.submit(e,t);break;default:Rv(e,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,r){switch(e){case Pe.FluidDataStoreOp:this.dataStores.rollbackDataStoreOp(t,r);break;default:throw new Error(`Can't rollback ${e}`)}}async refreshLatestSummaryAck(e,t,r,i){const s=async l=>mt(this.storage,l),{snapshotTree:o}=await this.fetchSnapshotFromStorage(t,i,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:r,fetchLatest:!1}),a=await this.summarizerNode.refreshLatestSummary(e,r,async()=>o,s,i);await this.garbageCollector.latestSummaryStateRefreshed(a,s)}async refreshLatestSummaryAckFromServer(e){const{snapshotTree:t,versionId:r}=await this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),i=async a=>mt(this.storage,a),s=await IG(t,i),o=await this.summarizerNode.refreshLatestSummary(void 0,s,async()=>t,i,e);return await this.garbageCollector.latestSummaryStateRefreshed(o,i),{latestSnapshotRefSeq:s,latestSnapshotVersionId:r}}async fetchSnapshotFromStorage(e,t,r){return he.timedExecAsync(t,r,async i=>{const s={},o=d_.start(),a=await this.storage.getVersions(e,1);k(!!a&&!!a[0],311),s.getVersionDuration=o.trace().duration;const l=await this.storage.getSnapshotTree(a[0]);return k(!!l,312),s.getSnapshotDuration=o.trace().duration,i.end(s),{snapshotTree:l,versionId:a[0].id}})}notifyAttaching(e){var t;((t=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&t!==void 0?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=Cm.serializeTreeWithBlobContents(e))}async getSnapshotBlobs(){var e;!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad)||this.attachState!==te.Attached||this.context.pendingLocalState||(k(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=await Cm.serializeTree(this.context.baseSnapshot,this.storage))}getPendingLocalState(){var e;if(!((e=this.mc.config.getBoolean("enableOfflineLoad"))!==null&&e!==void 0?e:this.runtimeOptions.enableOfflineLoad))throw new Te("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(k(!!this.context.baseSnapshot,742),k(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return async()=>{const t={headers:{[Ge.cache]:!1,[Ge.clientDetails]:{capabilities:{interactive:!1},type:an},[Ta.summarizingClient]:!0,[Ge.reconnect]:!1},url:"/_summarizer"},i=(await wc(e,t)).ISummarizer;if(!i)throw new Te("Fluid object does not implement ISummarizer");return i}}async processSavedOps(e){for(const t of e.savedOps)this.process(t,!1),await this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);await this.pendingStateManager.applyStashedOpsAt()}}const G9=async(n,e)=>new Promise((t,r)=>{n.on("closed",r);const i=s=>{s.sequenceNumber>=e&&(t(),n.off("op",i))};n.on("op",i)});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class K9{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,Js(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(this.objectP===void 0){const e={url:this.absolutePath,headers:{[es.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then(t=>{if(t.mimeType==="fluid/object")return t.value;throw sf(t)})}return this.objectP}attachGraph(){}bind(e){e.attachGraph()}async request(e){try{const r=(await this.get()).IFluidRouter;return r!==void 0?r.request(e):qn(e)}catch(t){return rh(t)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const J9=n=>(n==null?void 0:n.type)==="__fluid_handle__";class uk{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(r,i)=>{const s=r==null?void 0:r.IFluidHandle;return s!==void 0?this.serializeHandle(s,i):r},this.decodeValue=r=>{if(J9(r)){const i=r.url.startsWith("/")?r.url:Xc(r.url,this.context),s=new K9(i,this.root);return this.handleParsedCb(s),s}else return r},this.root=this.context;this.root.routeContext!==void 0;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&typeof e=="object"?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&typeof e=="object"?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,(r,i)=>this.encodeValue(i,t))}parse(e){return JSON.parse(e,(t,r)=>this.decodeValue(r))}recursivelyReplace(e,t,r){const i=t(e,r);if(i!==e)return i;let s;for(const o of Object.keys(e)){const a=e[o];if(a&&typeof a=="object"){const l=this.recursivelyReplace(a,t,r);l!==a&&(s=s??(Array.isArray(e)?[...e]:Object.assign({},e)),s[o]=l)}}return s??e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Q9 extends ca{get isAttached(){return this.value.isAttached()}constructor(e,t,r){super(e,t,r)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class X9 extends uk{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Y9 extends P0{constructor(e,t,r){super((i,s)=>this.eventListenerErrorHandler(i,s)),this.id=e,this.runtime=t,this.attributes=r,this._connected=!1,this._isBoundToContext=!1,Js(!e.includes("/"),772),this.handle=new Q9(this,e,t.IFluidHandleContext),this.logger=pe.create(t.logger,void 0,{all:{sharedObjectId:ot(),ddsType:{value:this.attributes.type,tag:De.CodeArtifact}}}),this.mc=qa(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;Js(this.mc!==void 0&&this.logger!==void 0,"this.mc and/or this.logger has not been set");const r=new BC({eventName:"ddsOpProcessing",category:"performance"},this.logger,(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))!==null&&e!==void 0?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new BC({eventName:"ddsEventCallbacks",category:"performance"},this.logger,(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))!==null&&t!==void 0?t:100,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),[r,i]}closeWithError(e){this.closeError===void 0&&(this.closeError=e)}verifyNotClosed(){if(this.closeError!==void 0)throw this.closeError}eventListenerErrorHandler(e,t){const r=Nn.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw r.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(r),r}attachListeners(){this.isAttached()||this.runtime.once("attaching",()=>{this.didAttach()})}async load(e){this.runtime.attachState!==te.Detached&&(this.services=e),await this.loadCore(e.objectStorage),this.runtime.attachState!==te.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return this.services!==void 0&&this.runtime.attachState!==te.Detached}handleDecoded(e){var t,r,i;this.isAttached()&&((i=(t=this.services)===null||t===void 0?void 0:(r=t.deltaConnection).addedGCOutboundReference)===null||i===void 0||i.call(r,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}async newAckBasedPromise(e){let t;return new Promise((r,i)=>{if(t=()=>i(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){t();return}this.runtime.on("dispose",t),e(r,i)}).finally(()=>{this.runtime.off("dispose",t)})}attachDeltaHandler(){Js(this.services!==void 0,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,r)=>{this.process(e,t,r)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,r){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure(()=>{this.processCore(e,t,r)},t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure(()=>super.emit(e,...t))}emitInternal(e,...t){return super.emit(e,...t)}}class df extends Y9{constructor(e,t,r,i){super(e,t,r),this.telemetryContextPrefix=i,this._isGCing=!1,this._serializer=new uk(this.runtime.channelsRoutingContext,s=>this.handleDecoded(s))}get serializer(){return Js(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(ie.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(ie.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}async summarize(e=!1,t=!1,r){const i=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(ie.blobCountPropertyName,i.stats.blobNodeCount,r),this.incrementTelemetryMetric(ie.totalBlobSizePropertyName,i.stats.totalBlobSize,r),i}getGCData(e=!1){Js(!this._isGCing,120),this._isGCing=!0;let t;try{const r=new X9(this.runtime.channelsRoutingContext,i=>this.handleDecoded(i));this.processGCDataCore(r),t={gcNodes:{"/":r.getSerializedRoutes()}},Js(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,r){var i;const s=(i=r==null?void 0:r.get(this.telemetryContextPrefix,e))!==null&&i!==void 0?i:0;r==null||r.set(this.telemetryContextPrefix,e,s+t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dk(n,e,t){return n!==void 0?e.stringify(n,t):n}function hk(n,e,t){return e.encode(n,t)}function ch(n,e){return n!==void 0?e.parse(JSON.stringify(n)):n}function Z9(n,e){const t=new tn;return t.addBlob(n,e),t.getSummaryTree()}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var He;(function(n){n[n.Shared=0]="Shared",n[n.Plain=1]="Plain"})(He||(He={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qe(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let e7=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Av(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class x_{constructor(e){this.value=e}get type(){return He[He.Plain]}makeSerialized(e,t){const r=dk(this.value,e,t);return{type:this.type,value:r}}}class bS{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===He[He.Shared]){e.type=He[He.Plain];const r={type:"__fluid_handle__",url:e.value};e.value=r}const t=ch(e.value,this.serializer);return new x_(t)}fromInMemory(e){return new x_(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Em(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit")}function O_(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"}function t7(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="add"||n.type==="edit"||n.type==="clear")}class n7{constructor(e,t,r,i,s){this.serializer=e,this.handle=t,this.submitMessage=r,this.isAttached=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new bS(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){const t=this.data.get(e);return t===void 0?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(e==null)throw new Error("Undefined and null keys are not supported");const r=this.localValueMaker.fromInMemory(t),i=Av(r,this.serializer,this.handle),s=this.setCore(e,r,!0);if(!this.isAttached())return;const o={key:e,type:"set",value:i};this.submitMapKeyMessage(o,s)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return t!==void 0;const r={key:e,type:"delete"};return this.submitMapKeyMessage(r,t),t!==void 0}clear(){const e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),!this.isAttached())return;const t={type:"clear"};this.submitMapClearMessage(t,e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=Av(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){const i={key:t,value:this.makeLocal(t,r)};this.data.set(i.key,i.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const r=this.messageHandlers.get(e.type);return r===void 0?!1:(r.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(t===void 0)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,r){const i=this.messageHandlers.get(e.type);return i===void 0?!1:(i.process(e,t,r),!0)}rollback(e,t){if(!t7(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){if(t.previousMap===void 0)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if(e.type==="delete"||e.type==="set"){if(t.type==="add")this.deleteCore(e.key,!0);else if(t.type==="edit"&&t.previousValue!==void 0)this.setCore(e.key,t.previousValue,!0);else throw new Error("Cannot rollback without previous value");const r=this.pendingKeys.get(e.key),i=r==null?void 0:r.pop();if(!r||i!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");r.length===0&&this.pendingKeys.delete(e.key)}else throw new Error("Unsupported op for rollback")}setCore(e,t,r){const i=this.data.get(e),s=i==null?void 0:i.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:s},r,this.eventEmitter),i}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const r=this.data.get(e),i=r==null?void 0:r.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},t,this.eventEmitter),r}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r)=>{e.set(r,this.data.get(r))}),this.clearCore(!1),e.forEach((t,r)=>{this.setCore(r,t,!0)})}makeLocal(e,t){if(t.type===He[He.Plain]||t.type===He[He.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&qe(r!==void 0&&Em(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){qe(r!==void 0&&Em(r),20);const s=this.pendingKeys.get(e.key);qe(s!==void 0&&s[0]===r.pendingMessageId,762),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(t,r,i)=>{if(r){qe(O_(i),21);const s=this.pendingClearMessageIds.shift();qe(s===i.pendingMessageId,763);return}if(this.pendingKeys.size!==0){this.clearExceptPendingKeys();return}this.clearCore(r)},submit:(t,r)=>{qe(O_(r),764);const i=this.pendingClearMessageIds.shift();qe(i===r.pendingMessageId,765),this.submitMapClearMessage(t,r.previousMap)},getStashedOpLocalMetadata:t=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(t,r,i)=>{this.needProcessKeyOperation(t,r,i)&&this.deleteCore(t.key,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e.set("set",{process:(t,r,i)=>{if(!this.needProcessKeyOperation(t,r,i))return;const s=this.makeLocal(t.key,t.value);this.setCore(t.key,s,r)},submit:(t,r)=>{this.resubmitMapKeyMessage(t,r)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const r={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,r)}getMapKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const r=this.getMapKeyMessageId(e),i=t?{type:"edit",pendingMessageId:r,previousValue:t}:{type:"add",pendingMessageId:r};this.submitMessage(e,i)}resubmitMapKeyMessage(e,t){qe(Em(t),766);const r=this.pendingKeys.get(e.key);qe(r!==void 0&&r[0]===t.pendingMessageId,767),r.shift(),r.length===0&&this.pendingKeys.delete(e.key);const i=this.getMapKeyMessageId(e),s=t.type==="edit"?{type:"edit",pendingMessageId:i,previousValue:t.previousValue}:{type:"add",pendingMessageId:i};this.submitMessage(e,s)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const fk="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var P_;const R_="header";class Wn{get type(){return Wn.Type}get attributes(){return Wn.Attributes}async load(e,t,r,i){const s=new xc(t,e,i);return await s.load(r),s}create(e,t){const r=new xc(t,e,Wn.Attributes);return r.initializeLocal(),r}}Wn.Type="https://graph.microsoft.com/types/map";Wn.Attributes={type:Wn.Type,snapshotFormatVersion:"0.2",packageVersion:fk};class xc extends df{constructor(e,t,r){super(e,t,r,"fluid_map_"),this[P_]="SharedMap",this.kernel=new n7(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),()=>this.isAttached(),this)}static create(e,t){return e.createChannel(t,Wn.Type)}static getFactory(){return new Wn}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(P_=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let r=0,i=0,s={};const o=[],a=new tn,l=this.kernel.getSerializedStorage(e),c=8*1024,u=16*1024;for(const h of Object.keys(l)){const f=l[h];if(f.value&&f.value.length>=c){const p=`blob${i}`;i++,o.push(p);const g={[h]:{type:f.type,value:JSON.parse(f.value)}};a.addBlob(p,JSON.stringify(g))}else{if(r+=f.type.length+21,f.value&&(r+=f.value.length),r>u){const p=`blob${i}`;i++,o.push(p),a.addBlob(p,JSON.stringify(s)),s={},r=0}s[h]={type:f.type,value:f.value===void 0?void 0:JSON.parse(f.value)}}}const d={blobs:o,content:s};return a.addBlob(R_,JSON.stringify(d)),a.getSummaryTree()}async loadCore(e){const t=await mt(e,R_),r=t;Array.isArray(r.blobs)?(this.kernel.populateFromSerializable(r.content),await Promise.all(r.blobs.map(async i=>{const s=await mt(e,i);this.kernel.populateFromSerializable(s)}))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,r){e.type===nh.Operation&&this.kernel.tryProcessMessage(e.contents,t,r)}rollback(e,t){this.kernel.rollback(e,t)}}function mr(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function k_(n,e){for(var t="",r=0,i=-1,s=0,o,a=0;a<=n.length;++a){if(a<n.length)o=n.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(i+1,a):t=n.slice(i+1,a),r=a-i-1;i=a,s=0}else o===46&&s!==-1?++s:s=-1}return t}function r7(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var ua={resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var s;i>=0?s=arguments[i]:(r===void 0&&(r=process.cwd()),s=r),mr(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=k_(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(mr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=k_(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return mr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];mr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":ua.normalize(e)},relative:function(e,t){if(mr(e),mr(t),e===t||(e=ua.resolve(e),t=ua.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,s=i-r,o=1;o<t.length&&t.charCodeAt(o)===47;++o);for(var a=t.length,l=a-o,c=s<l?s:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(t.charCodeAt(o+d)===47)return t.slice(o+d+1);if(d===0)return t.slice(o+d)}else s>c&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var h=e.charCodeAt(r+d),f=t.charCodeAt(o+d);if(h!==f)break;h===47&&(u=d)}var p="";for(d=r+u+1;d<=i;++d)(d===i||e.charCodeAt(d)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+t.slice(o+u):(o+=u,t.charCodeAt(o)===47&&++o,t.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(mr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,s=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!s){i=o;break}}else s=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');mr(e);var r=0,i=-1,s=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(o=e.length-1;o>=0;--o){var c=e.charCodeAt(o);if(c===47){if(!s){r=o+1;break}}else l===-1&&(s=!1,l=o+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(i=o):(a=-1,i=l))}return r===i?i=l:i===-1&&(i=e.length),e.slice(r,i)}else{for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!s){r=o+1;break}}else i===-1&&(s=!1,i=o+1);return i===-1?"":e.slice(r,i)}},extname:function(e){mr(e);for(var t=-1,r=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}i===-1&&(s=!1,i=a+1),l===46?t===-1?t=a:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return r7("/",e)},parse:function(e){mr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,s;i?(t.root="/",s=1):s=0;for(var o=-1,a=0,l=-1,c=!0,u=e.length-1,d=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?o===-1?o=u:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||l===-1||d===0||d===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&i?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&i?(t.name=e.slice(1,o),t.base=e.slice(1,l)):(t.name=e.slice(a,o),t.base=e.slice(a,l)),t.ext=e.slice(o,l)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};ua.posix=ua;var i7=ua;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var N_,L_;const on=i7.posix,I_="header";class cr{get type(){return cr.Type}get attributes(){return cr.Attributes}async load(e,t,r,i){const s=new Oc(t,e,i);return await s.load(r),s}create(e,t){const r=new Oc(t,e,cr.Attributes);return r.initializeLocal(),r}}cr.Type="https://graph.microsoft.com/types/directory";cr.Attributes={type:cr.Type,snapshotFormatVersion:"0.1",packageVersion:fk};class Oc extends df{constructor(e,t,r){super(e,t,r,"fluid_directory_"),this[N_]="SharedDirectory",this.root=new uh(this,this.runtime,this.serializer,on.sep),this.messageHandlers=new Map,this.localValueMaker=new bS(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",(i,s)=>{this.emit("containedValueChanged",i,s,this)}),this.root.on("subDirectoryCreated",(i,s)=>{this.emit("subDirectoryCreated",i,s,this)}),this.root.on("subDirectoryDeleted",(i,s)=>{this.emit("subDirectoryDeleted",i,s,this)})}static create(e,t){return e.createChannel(t,cr.Type)}static getFactory(){return new cr}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(N_=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===on.sep)return this.root;let r=this.root;const i=t.substr(1).split(on.sep);for(const s of i)if(r=r.getSubDirectory(s),!r)return;return r}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const r=e,i=this.messageHandlers.get(r.type);qe(i!==void 0,13),i.submit(r,t)}async loadCore(e){const t=await mt(e,I_),r=t;Array.isArray(r.blobs)?(this.populate(r.content),await Promise.all(r.blobs.map(async i=>{const s=await mt(e,i);this.populate(s)}))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[r,i]=t.pop();if(i.subdirectories)for(const[s,o]of Object.entries(i.subdirectories)){let a=r.getSubDirectory(s);a||(a=new uh(this,this.runtime,this.serializer,on.join(r.absolutePath,s)),r.populateSubDirectory(s,a)),t.push([a,o])}if(i.storage)for(const[s,o]of Object.entries(i.storage)){const a=this.makeLocal(s,r.absolutePath,o);r.populateStorage(s,a)}}}processCore(e,t,r){if(e.type===nh.Operation){const i=e.contents,s=this.messageHandlers.get(i.type);qe(s!==void 0,14),s.process(i,t,r)}}rollback(e,t){const r=e,i=this.getWorkingDirectory(r.path);i&&i.rollback(r,t)}makeAbsolute(e){return on.resolve(on.sep,e)}makeLocal(e,t,r){return qe(r.type===He[He.Plain]||r.type===He[He.Shared],484),this.localValueMaker.fromSerializable(r)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processClearMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);if(i){const s=t?void 0:this.makeLocal(e.key,e.path,e.value);i.processSetMessage(e,s,t,r)}},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processCreateSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,r)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,r){const s=new tn;let o=0;const a=[],l=[],c={};for(l.push([e,c]);l.length>0;){const[d,h]=l.pop();for(const[f,p]of d.getSerializedStorage(t)){h.storage||(h.storage={});const g={type:p.type,value:p.value&&JSON.parse(p.value)};if(p.value&&p.value.length>=8192){const S={};let m=S;if(d.absolutePath!==on.sep)for(const y of d.absolutePath.substr(1).split(on.sep)){const b={};m.subdirectories={[y]:b},m=b}m.storage={[f]:g};const v=`blob${o}`;o++,a.push(v),s.addBlob(v,JSON.stringify(S))}else h.storage[f]=g}for(const[f,p]of d.subdirectories()){h.subdirectories||(h.subdirectories={});const g={};h.subdirectories[f]=g,l.push([p,g])}}const u={blobs:a,content:c};return s.addBlob(I_,JSON.stringify(u)),s.getSummaryTree()}}function _m(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&n.type==="edit"}function A_(n){return n!==void 0&&n.type==="clear"&&typeof n.pendingMessageId=="number"&&typeof n.previousStorage=="object"}function M_(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean"||n.type==="deleteSubDir")}function s7(n){return n!==void 0&&typeof n.pendingMessageId=="number"&&(n.type==="edit"||n.type==="deleteSubDir"||n.type==="clear"&&typeof n.previousStorage=="object"||n.type==="createSubDir"&&typeof n.previouslyExisted=="boolean")}class uh extends e7{constructor(e,t,r,i){super(),this.directory=e,this.runtime=t,this.serializer=r,this.absolutePath=i,this._deleted=!1,this[L_]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new Te("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),(t=this._storage.get(e))===null||t===void 0?void 0:t.value}set(e,t){if(this.throwIfDisposed(),e==null)throw new Error("Undefined and null keys are not supported");const r=this.directory.localValueMaker.fromInMemory(t),i=Av(r,this.serializer,this.directory.handle),s=this.setCore(e,r,!0);if(!this.directory.isAttached())return this;const o={key:e,path:this.absolutePath,type:"set",value:i};return this.submitKeyMessage(o,s),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),e==null)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(on.sep))throw new Error(`SubDirectory name may not contain ${on.sep}`);const t=this.createSubDirectoryCore(e,!0),r=this._subdirectories.get(e);if(!this.directory.isAttached())return r;const i={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(i,!t),r}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(r,t),t!==void 0}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return t!==void 0;const r={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(r,t),t!==void 0}clear(){if(this.throwIfDisposed(),!this.directory.isAttached()){this.clearCore(!0);return}const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach((t,r,i)=>{e(t.value,r,i)})}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[(L_=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,r){if(this.throwIfDisposed(),t){qe(A_(r),15);const i=this.pendingClearMessageIds.shift();qe(i===r.pendingMessageId,810);return}this.clearExceptPendingKeys()}processDeleteMessage(e,t,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,r)&&this.deleteCore(e.key,t)}processSetMessage(e,t,r,i){this.throwIfDisposed(),this.needProcessStorageOperation(e,r,i)&&this.setCore(e.key,t,r)}processCreateSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const r=++this.pendingMessageId;this.pendingClearMessageIds.push(r);const i={type:"clear",pendingMessageId:r,previousStorage:t};this.directory.submitDirectoryMessage(e,i)}resubmitClearMessage(e,t){qe(A_(t),811);const r=this.pendingClearMessageIds.shift();qe(r===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return r!==void 0?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const i={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,i)}resubmitKeyMessage(e,t){qe(_m(t),813);const r=this.pendingKeys.get(e.key);qe(r!==void 0&&r[0]===t.pendingMessageId,814),r.shift(),r.length===0&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,r=this.pendingSubDirectories.get(e.subdirName);return r!==void 0?r.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,i)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,i)}resubmitSubDirectoryMessage(e,t){qe(M_(t),815);const r=this.pendingSubDirectories.get(e.subdirName);qe(r!==void 0&&r[0]===t.pendingMessageId,816),r.shift(),r.length===0&&this.pendingSubDirectories.delete(e.subdirName),t.type==="createSubDir"?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,r]of this._storage){const i=r.makeSerialized(e,this.directory.handle);yield[t,i]}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,r){const i=e.get(t),s=i==null?void 0:i.pop();if(!i||s!==r)throw new Error("Rollback op does not match last pending");i.length===0&&e.delete(t)}rollback(e,t){if(!s7(t))throw new Error("Invalid localOpMetadata");if(e.type==="clear"&&t.type==="clear"){t.previousStorage.forEach((i,s)=>{this.setCore(s,i,!0)});const r=this.pendingClearMessageIds.pop();if(r===void 0||r!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if((e.type==="delete"||e.type==="set")&&t.type==="edit")t.previousValue===void 0?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId);else if(e.type==="createSubDirectory"&&t.type==="createSubDir")t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else if(e.type==="deleteSubDirectory"&&t.type==="deleteSubDir")t.subDirectory!==void 0&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else throw new Error("Unsupported op for rollback")}makeAbsolute(e){return on.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&qe(r!==void 0&&_m(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(this.pendingKeys.get(e.key)!==void 0){if(t){qe(r!==void 0&&_m(r),17);const s=this.pendingKeys.get(e.key);qe(s!==void 0&&s[0]===r.pendingMessageId,817),s.shift(),s.length===0&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,r){if(this.pendingSubDirectories.get(e.subdirName)!==void 0){if(t){qe(M_(r),18);const s=this.pendingSubDirectories.get(e.subdirName);qe(s!==void 0&&s[0]===r.pendingMessageId,818),s.shift(),s.length===0&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,r,i)=>{e.set(r,this._storage.get(r))}),this.clearCore(!1),e.forEach((t,r,i)=>{this.setCore(r,t,!0)})}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const r=this._storage.get(e),i=r==null?void 0:r.value;if(this._storage.delete(e)){const o={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",o,t,this.directory);const a={key:e,previousValue:i};this.emit("containedValueChanged",a,t,this)}return r}setCore(e,t,r){const i=this._storage.get(e),s=i==null?void 0:i.value;this._storage.set(e,t);const o={key:e,path:this.absolutePath,previousValue:s};this.directory.emit("valueChanged",o,r,this.directory);const a={key:e,previousValue:s};return this.emit("containedValueChanged",a,r,this),i}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const r=on.join(this.absolutePath,e),i=new uh(this.directory,this.runtime,this.serializer,r);return this.registerEventsOnSubDirectory(i,e),this._subdirectories.set(e,i),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",(r,i)=>{this.emit("subDirectoryCreated",on.join(t,r),i,this)}),e.on("subDirectoryDeleted",(r,i)=>{this.emit("subDirectoryDeleted",on.join(t,r),i,this)})}deleteSubDirectoryCore(e,t){const r=this._subdirectories.get(e);return r!==void 0&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(r),this.emit("subDirectoryDeleted",e,t,this)),r}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[r,i]of t)this.disposeSubDirectoryTree(i);typeof e.dispose=="function"&&e.dispose()}undeleteSubDirectoryTree(e){for(const[t,r]of this._subdirectories.entries())this.undeleteSubDirectoryTree(r);e.undispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const D_="IFluidDependencySynthesizer";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hf{constructor(...e){this.providers=new Map,this.parents=e.filter(t=>t!==void 0)}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const r={};return this.generateRequired(r,t),this.generateOptional(r,e),Object.defineProperty(r,D_,{get:()=>this}),r}has(e,t){return this.providers.has(e)?!0:t!==!0?this.parents.some(r=>r.has(e)):!1}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof hf)return t.getProvider(e);{const r=t;if((r==null?void 0:r.getProvider)!==void 0)return r.getProvider(e)}}}}generateRequired(e,t){if(t!==void 0)for(const r of Object.keys(t)){const i=this.resolveProvider(r);if(i===void 0)throw new Error(`Object attempted to be created without registered required provider ${r}`);Object.defineProperty(e,r,i)}}generateOptional(e,t){var r;if(t!==void 0)for(const i of Object.keys(t)){const s=(r=this.resolveProvider(i))!==null&&r!==void 0?r:{get:async()=>{}};Object.defineProperty(e,i,s)}}resolveProvider(e){const t=this.providers.get(e);if(t===void 0){for(const r of this.parents){const i={[e]:e},s=r.synthesize(i,{}),o=Object.getOwnPropertyDescriptor(s,e);if(o!==void 0)return o}return}return typeof t=="function"?{get(){if(t&&typeof t=="function")return Promise.resolve(this[D_]).then(async r=>t(r)).then(r=>r==null?void 0:r[e])}}:{get(){if(t)return Promise.resolve(t).then(r=>{if(r)return r[e]})}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Tm(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let o7=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let wS=class Ps extends o7{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(Ps.removeListenerEvent,t),this.on(Ps.newListenerEvent,r)}}static isEmitterEvent(e){return e===Ps.newListenerEvent||e===Ps.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!Ps.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!Ps.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if(i!=null&&i.has(e)&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}};wS.newListenerEvent="newListener";wS.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function a7(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class l7{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){a7(!1,202)}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(e.status===200&&e.mimeType==="fluid/object")return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}function c7(n,e){return new l7(n,e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class u7{constructor(){this.handlers=[]}pushHandler(...e){e!==void 0&&this.handlers.push(...e)}async handleRequest(e,t){const r=kr.create(e);for(const i of this.handlers){const s=await i(r,t);if(s!==void 0)return s}return qn(e)}}function pk(...n){const e=new u7;return e.pushHandler(...n),async(t,r)=>e.handleRequest(t,r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const CS="_services";class d7{constructor(e){this.runtime=e}get IFluidRouter(){return this}async request(e){return{status:200,mimeType:"fluid/object",value:this}}}class h7{constructor(e){this.serviceFn=e}async getService(e){return this.service||(this.service=this.serviceFn(e)),this.service}}const f7=n=>{const e=new Map;return new Map(n).forEach((t,r)=>{e.set(r,new h7(t))}),async(t,r)=>{if(t.pathParts[0]!==CS)return;if(t.pathParts.length<2)return ih(400,"request did not specify a service to route to",t);const i=e.get(t.pathParts[1]);if(!i)return qn(t);const s=await i.getService(r),o=s.IFluidRouter,a=t.createSubRequest(2);return o?o.request(a):t.isLeaf(2)?{status:200,mimeType:"fluid/object",value:s}:ih(400,"request sub-url for service that doesn't support routing",t)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const p7=(n,e)=>{const t=pk(...e);return async(r,i)=>{var s;const o=((s=r.headers)===null||s===void 0?void 0:s.mountableView)===!0;let a=r;if(o){const c=Object.assign({},r.headers);delete c.mountableView,a={url:r.url,headers:c}}const l=await t(a,i);return o&&l.status===200&&n.canMount(l.value)?{status:200,mimeType:"fluid/object",value:new n(l.value)}:l}},ES=n=>async(e,t)=>{const r=kr.create(e);if(r.pathParts.length===0)return t.IFluidHandleContext.resolveHandle({url:`/${n}${r.query}`,headers:e.headers})};function mk(n,e){return e.url===""||e.url==="/"||e.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:n}:qn(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class _S extends wS{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,Tm(this.runtime._dataObject===void 0,189),this.runtime._dataObject=this,this.innerHandle=new ca(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",()=>{this._disposed=!0,this.dispose()})}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return Tm(t!==void 0,188),await t.finishInitialization(!0),t}async request(e){return mk(this,e)}async finishInitialization(e){return this.initializeP!==void 0?this.initializeP:(this.initializeP=this.initializeInternal(e),this.initializeP)}async initializeInternal(e){var t;await this.preInitialize(),e?(Tm(this.initProps===void 0,190),await this.initializingFromExisting()):await this.initializingFirstTime((t=this.context.createProps)!==null&&t!==void 0?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,r){const i=r?r(e,t):t.get(e),s=i==null?void 0:i.IFluidHandle;if(s)return s.get()}async getService(e){return c7(`/${CS}/${e}`,this.context.containerRuntime).get()}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class gk extends _S{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=kr.create(e);if(t.pathParts[0]==="bigBlobs"){const i=this.root.get(t.pathParts.join("/"));return i===void 0?qn(t):{mimeType:"fluid/object",status:200,value:i}}else return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===Wn.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=Oc.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function F_(n,e,t,r,i,s,o){let a=i;a=VG(async(f,p)=>(await _S.getDataObject(p)).request(f),a);const l=new a(e,t,s),c=e.scope,d=new hf(c.IFluidDependencySynthesizer).synthesize(r,{}),h=new n({runtime:l,context:e,providers:d,initProps:o});return s||await h.finishInitialization(s),{instance:h,runtime:l}}class vk{constructor(e,t,r,i,s,o=Yc){if(this.type=e,this.ctor=t,this.optionalProviders=i,this.runtimeClass=o,this.type==="")throw new Error("undefined type member");s!==void 0&&(this.registry=new dS(s)),this.sharedObjectRegistry=new Map(r.map(a=>[a.type,a]))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:r}=await F_(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return r}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,r){const i=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(i,r)}async createNonRootInstanceCore(e,t,r){const i=e.createDetachedDataStore(t);return this.createInstanceCore(i,r)}async createInstanceCore(e,t){const{instance:r,runtime:i}=await F_(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,i),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class yk extends vk{constructor(e,t,r=[],i,s,o=Yc){const a=[...r];r.find(l=>l.type===cr.Type)||a.push(Oc.getFactory()),r.find(l=>l.type===Wn.Type)||a.push(xc.getFactory()),super(e,t,a,i,s,o)}}var Sk={},ff={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ff,"__esModule",{value:!0});ff.IContainerRuntime=void 0;ff.IContainerRuntime="IContainerRuntime";(function(n){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(ff,n)})(Sk);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class TS extends vG{constructor(e,t,r=[],i){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=r,this.runtimeOptions=i,this.registry=new dS(e)}get IFluidDataStoreRegistry(){return this.registry}async instantiateFirstTime(e){await this.containerInitializingFirstTime(e),await this.containerHasInitialized(e)}async instantiateFromExisting(e){await this.containerHasInitialized(e)}async preInitialize(e,t){const r=e.scope,i=new hf(this.dependencyContainer,r.IFluidDependencySynthesizer);r.IFluidDependencySynthesizer=i;const s=await SS.load(e,this.registryEntries,pk(...this.requestHandlers),this.runtimeOptions,r,t);return i.register(Sk.IContainerRuntime,s),s}async containerInitializingFirstTime(e){}async containerHasInitialized(e){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Mv="default";class bk extends TS{constructor(e,t,r,i=[],s){super(t,r,[ES(Mv),...i],s),this.defaultFactory=e}async containerInitializingFirstTime(e){await(await e.createDataStore(this.defaultFactory.type)).trySetAlias(Mv)}}bk.defaultDataStoreId=Mv;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function m7(n){if(n.attachState!==te.Attached)return new Promise(e=>{n.once("attached",()=>{Promise.resolve().then(()=>e()).catch(()=>{})})})}async function g7(n){const e="/",t=await n.request({url:e});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object at URL: "${e}"`);if(t.value===void 0)throw new Error(`Empty response from URL: "${e}"`);return t.value}async function v7(n,e){const t=`/${n}`,r=await e.request({url:t});if(r.status!==200||r.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with ID: "${n}" from URL: "${t}"`);if(r.value===void 0)throw new Error(`Empty response for ID: "${n}" from URL: "${t}"`);return r.value}async function y7(n,e){const t=await e.request({url:n});if(t.status!==200||t.mimeType!=="fluid/object")throw new Error(`Unable to retrieve Fluid object with from URL: "${n}"`);if(t.value===void 0)throw new Error(`Empty response for from URL: "${n}"`);return t.value}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const S7=Object.freeze(Object.defineProperty({__proto__:null,BaseContainerRuntimeFactory:TS,BaseContainerService:d7,ContainerRuntimeFactoryWithDefaultDataStore:bk,DataObject:gk,DataObjectFactory:yk,PureDataObject:_S,PureDataObjectFactory:vk,defaultFluidObjectRequestHandler:mk,defaultRouteRequestHandler:ES,generateContainerServicesRequestHandler:f7,getDefaultObjectFromContainer:g7,getObjectFromContainer:y7,getObjectWithIdFromContainer:v7,mountableViewRequestHandler:p7,serviceRoutePathRoot:CS,waitForAttach:m7},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const wk=n=>(n==null?void 0:n.factory)!==void 0,Ck=n=>(n==null?void 0:n.getFactory)!==void 0,b7=n=>{var e;const t=new Set,r=new Set,i=o=>{if(Ck(o))r.add(o.getFactory());else if(wk(o))t.add([o.factory.type,Promise.resolve(o.factory)]);else throw new Error("Entry is neither a DataObject or a SharedObject")};if(new Set([...Object.values(n.initialObjects),...(e=n.dynamicObjectTypes)!==null&&e!==void 0?e:[]]).forEach(i),t.size===0&&r.size===0)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(t),Array.from(r)]};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Ek extends gk{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(e===void 0)throw new Error("InitialObjects sub-directory was not initialized");return e}async initializingFirstTime(e){this.root.createSubDirectory(this.initialObjectsDirKey);const t=[];Object.entries(e.initialObjects).forEach(([r,i])=>{const s=async()=>{const o=await this.create(i);this.initialObjectsDir.set(r,o.handle)};t.push(s())}),await Promise.all(t)}async hasInitialized(){const e=[];for(const[t,r]of Array.from(this.initialObjectsDir.entries())){const i=async()=>{const s=await r.get();Object.assign(this._initialObjects,{[t]:s})};e.push(i())}await Promise.all(e)}get initialObjects(){if(Object.keys(this._initialObjects).length===0)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(e){if(wk(e))return this.createDataObject(e);if(Ck(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")}async createDataObject(e){const t=e.factory,r=[...this.context.packagePath,t.type],i=await this.context.containerRuntime.createDataStore(r);return wc(i,"/")}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}const z_="rootDOId";class _k extends TS{constructor(e){const[t,r]=b7(e),i=new yk("rootDO",Ek,r,{},t);super([i.registryEntry],void 0,[ES(z_)],{flushMode:ie.FlushMode.Immediate}),this.rootDataObjectFactory=i,this.initialObjects=e.initialObjects}async containerInitializingFirstTime(e){await this.rootDataObjectFactory.createRootInstance(z_,e,{initialObjects:this.initialObjects})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Tk extends $R{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",(t,r)=>{if(this.shouldIncludeAsMember(r)){const i=this.getMember(t);this.emit("memberAdded",t,i),this.emit("membersChanged")}}),this.audience.on("removeMember",t=>{this.lastMembers.has(t)&&(this.emit("memberRemoved",t,this.lastMembers.get(t)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach((r,i)=>{if(this.shouldIncludeAsMember(r)){const s=r.user.id;let o=e.get(s);o===void 0&&(o=this.createServiceMember(r),e.set(s,o)),o.connections.push({id:i,mode:r.mode}),t.set(i,o)}}),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(e!==void 0)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(t===void 0)return;const i=this.getMembers().get(t==null?void 0:t.user.id);if(i===void 0)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return i}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function On(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function w7(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const xk=(n,e)=>C7.from(n).toString(e);function $_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let C7=class Rs extends Uint8Array{toString(e){return w7(this,e)}static from(e,t,r){if(typeof e=="string")return Rs.fromString(e,t);if(e!==null&&typeof e=="object"&&$_(e.buffer))return On(e.byteOffset===0,0),On(e.byteLength===e.buffer.byteLength,1),Rs.fromArrayBuffer(e.buffer,t,r);if($_(e))return Rs.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Rs(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Rs(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Rs(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ok=class extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let E7=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Dv;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(Dv||(Dv={}));var j_;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(j_||(j_={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Q(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function _7(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const Fv=(n,e)=>T7.from(n).toString(e);function q_(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let T7=class ks extends Uint8Array{toString(e){return _7(this,e)}static from(e,t,r){if(typeof e=="string")return ks.fromString(e,t);if(e!==null&&typeof e=="object"&&q_(e.buffer))return Q(e.byteOffset===0,0),Q(e.byteLength===e.buffer.byteLength,1),ks.fromArrayBuffer(e.buffer,t,r);if(q_(e))return ks.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new ks(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new ks(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new ks(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const B_=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ro=class Pk{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=B_.now();return new Pk(e)}trace(){const e=B_.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function x7(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class xS{constructor(){this.items=[]}push(e){this.items.push(e)}empty(){return this.items.length===0}top(){return this.items[this.items.length-1]}pop(){return this.items.pop()}}function Rk(n){if(n!==void 0){{if(n.isHead)return;n.next.prev=n.prev,n.prev.next=n.next}return n}}function U_(n){return new kk(!1,n)}function Qo(){return new kk(!0,void 0)}class kk{constructor(e,t){this.isHead=e,this.data=t,this.prev=this,this.next=this}clear(){this.isHead&&(this.prev=this,this.next=this)}add(e){const t=U_(e);return this.prev.next=t,t.next=this,t.prev=this.prev,this.prev=t,t}dequeue(){if(!this.empty())return Rk(this.next).data}enqueue(e){return this.add(e)}walk(e){for(let t=this.next;!t.isHead;t=t.next)e(t.data,t)}some(e,t){const r=[],i=t?this.prev:this.next;for(let s=i;!s.isHead;s=t?s.prev:s.next){const o=s.data;e(o,s)&&(t?r.unshift(o):r.push(o))}return r}count(){let e,t;for(e=this.next,t=0;!e.isHead;t++)e=e.next;return t}first(){if(!this.empty())return this.next.data}last(){if(!this.empty())return this.prev.data}empty(){return this.next===this}push(e){this.unshift(e)}unshift(e){const t=U_(e);t.data=e,t.isHead=!1,t.next=this.next,t.prev=this,this.next=t,t.next.prev=t}[Symbol.iterator](){let e=this;return{next(){for(;e&&e.next.isHead===!1;)if(e=e.next,e.data!==void 0)return{value:e.data,done:!1};return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}}let H_=class{constructor(e,t){this.comp=t,this.L=[t.min];for(let r=0,i=e.length;r<i;r++)this.add(e[r])}count(){return this.L.length-1}peek(){return this.L[1]}get(){const e=this.L[1];return this.L[1]=this.L[this.count()],this.L.pop(),this.fixDown(1),e}add(e){this.L.push(e),this.fixup(this.count())}fixup(e){let t=e;for(;t>1&&this.comp.compare(this.L[t>>1],this.L[t])>0;){const r=this.L[t>>1];this.L[t>>1]=this.L[t],this.L[t]=r,t=t>>1}}fixDown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r],this.L[r+1])>0&&r++,this.comp.compare(this.L[t],this.L[r])<=0)break;const i=this.L[t];this.L[t]=this.L[r],this.L[r]=i,t=r}}};const Wt={RED:0,BLACK:1};class Pc{constructor(e,t){this.compareKeys=e,this.aug=t}makeNode(e,t,r,i){return{key:e,data:t,color:r,size:i}}isRed(e){return!!e&&e.color===Wt.RED}nodeSize(e){return e?e.size:0}size(){return this.nodeSize(this.root)}isEmpty(){return!this.root}get(e){if(e!==void 0)return this.nodeGet(this.root,e)}nodeGet(e,t){let r=e;for(;r;){const i=this.compareKeys(t,r.key);if(i<0)r=r.left;else if(i>0)r=r.right;else return r}}contains(e){return this.get(e)}gather(e,t){const r=[];return e!==void 0&&this.nodeGather(this.root,r,e,t),r}nodeGather(e,t,r,i){e&&(i.continueSubtree(e.left,r)&&this.nodeGather(e.left,t,r,i),i.matchNode(e,r)&&t.push(e),i.continueSubtree(e.right,r)&&this.nodeGather(e.right,t,r,i))}walkExactMatchesForward(e,t,r,i){this.nodeWalkExactMatchesForward(this.root,e,t,r,i)}nodeWalkExactMatchesForward(e,t,r,i,s){if(!e)return;const o=t(e);i(o)&&this.nodeWalkExactMatchesForward(e.left,t,r,i,s),o===0&&r(e),s(o)&&this.nodeWalkExactMatchesForward(e.right,t,r,i,s)}walkExactMatchesBackward(e,t,r,i){this.nodeWalkExactMatchesBackward(this.root,e,t,r,i)}nodeWalkExactMatchesBackward(e,t,r,i,s){if(!e)return;const o=t(e);s(o)&&this.nodeWalkExactMatchesBackward(e.right,t,r,i,s),o===0&&r(e),i(o)&&this.nodeWalkExactMatchesBackward(e.left,t,r,i,s)}put(e,t,r){e!==void 0&&(t===void 0?this.remove(e):(this.root=this.nodePut(this.root,e,t,r),this.root.color=Wt.BLACK))}nodePut(e,t,r,i){let s=e;if(s){const o=this.compareKeys(t,s.key);if(o<0)s.left=this.nodePut(s.left,t,r,i);else if(o>0)s.right=this.nodePut(s.right,t,r,i);else if(i){const a=i(t,s.key,r,s.data);a.key&&(s.key=a.key),a.data?s.data=a.data:s.data=r}else s.data=r;return this.isRed(s.right)&&!this.isRed(s.left)&&(s=this.rotateLeft(s)),this.isRed(s.left)&&this.isRed(s.left.left)&&(s=this.rotateRight(s)),this.isRed(s.left)&&this.isRed(s.right)&&this.flipColors(s),s.size=this.nodeSize(s.left)+this.nodeSize(s.right)+1,this.aug&&this.updateLocal(s),s}else return this.makeNode(t,r,Wt.RED,1)}updateLocal(e){this.aug&&(this.isRed(e.left)&&this.aug.update(e.left),this.isRed(e.right)&&this.aug.update(e.right),this.aug.update(e))}nodeRemoveMin(e){let t=e;if(t.left)return!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.nodeRemoveMin(t.left),this.balance(t)}remove(e){if(e!==void 0){if(!this.contains(e))return;this.removeExisting(e)}}removeExisting(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.color=Wt.RED),this.root=this.nodeRemove(this.root,e)}nodeRemove(e,t){let r=e;if(this.compareKeys(t,r.key)<0)!this.isRed(r.left)&&!this.isRed(r.left.left)&&(r=this.moveRedLeft(r)),r.left=this.nodeRemove(r.left,t);else{if(this.isRed(r.left)&&(r=this.rotateRight(r)),this.compareKeys(t,r.key)===0&&!r.right)return;if(!this.isRed(r.right)&&!this.isRed(r.right.left)&&(r=this.moveRedRight(r)),this.compareKeys(t,r.key)===0){const i=this.nodeMin(r.right);r.key=i.key,r.data=i.data,r.right=this.nodeRemoveMin(r.right)}else r.right=this.nodeRemove(r.right,t)}return this.balance(r)}floor(e){if(!this.isEmpty())return this.nodeFloor(this.root,e)}nodeFloor(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r<0)return this.nodeFloor(e.left,t);{const i=this.nodeFloor(e.right,t);return i||e}}}ceil(e){if(!this.isEmpty())return this.nodeCeil(this.root,e)}nodeCeil(e,t){if(e){const r=this.compareKeys(t,e.key);if(r===0)return e;if(r>0)return this.nodeCeil(e.right,t);{const i=this.nodeCeil(e.left,t);return i||e}}}min(){if(this.root)return this.nodeMin(this.root)}nodeMin(e){return e.left?this.nodeMin(e.left):e}max(){if(this.root)return this.nodeMax(this.root)}nodeMax(e){return e.right?this.nodeMax(e.right):e}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.color=t.right.color,t.right.color=Wt.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.color=t.left.color,t.left.color=Wt.RED,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}oppositeColor(e){return e===Wt.BLACK?Wt.RED:Wt.BLACK}flipColors(e){e.color=this.oppositeColor(e.color),e.left.color=this.oppositeColor(e.left.color),e.right.color=this.oppositeColor(e.right.color)}moveRedLeft(e){let t=e;return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(e){let t=e;return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}balance(e){let t=e;return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&this.aug.update(t),t}mapRange(e,t,r,i){this.nodeMap(this.root,e,r,i)}map(e,t){this.nodeMap(this.root,e,t)}keys(){const e=[],t={showStructure:!0,infix:r=>(e.push(r.key),!0)};return this.walk(t),e}walk(e){this.nodeWalk(this.root,e)}walkBackward(e){this.nodeWalkBackward(this.root,e)}nodeWalk(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.pre(e)),e.left&&(r=this.nodeWalk(e.left,t)),r&&t.infix&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalk(e.right,t)),r&&t.post&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.post(e))),r}nodeWalkBackward(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.pre(e)),e.right&&(r=this.nodeWalkBackward(e.right,t)),r&&t.infix&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.infix(e)),r&&(r=this.nodeWalkBackward(e.left,t)),r&&t.post&&(t.showStructure||e.color===Wt.BLACK)&&(r=t.post(e))),r}nodeMap(e,t,r,i,s){let o=i,a=s;if(!e)return!0;o===void 0&&(o=this.nodeMin(e).key),a===void 0&&(a=this.nodeMax(e).key);const l=this.compareKeys(o,e.key),c=this.compareKeys(a,e.key);let u=!0;return l<0&&(u=this.nodeMap(e.left,t,r,o,a)),u&&l<=0&&c>=0&&(u=t(e,r)),u&&c>0&&(u=this.nodeMap(e.right,t,r,o,a)),u}}const O7=(n,e)=>n.compare(e);class P7{constructor(){this.intervals=new Pc(O7,this)}remove(e){this.intervals.remove(e)}removeExisting(e){this.intervals.removeExisting(e)}put(e,t){let r;t&&(r=(i,s)=>({key:t(i,s)})),this.intervals.put(e,{minmax:e.clone()},r)}map(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walk(t)}mapUntil(e){const t={infix:r=>e(r.key),showStructure:!0};this.intervals.walk(t)}mapBackward(e){const t={infix:r=>(e(r.key),!0),showStructure:!0};this.intervals.walkBackward(t)}match(e){return this.intervals.gather(e,this)}matchNode(e,t){return!!e&&e.key.overlaps(t)}continueSubtree(e,t){return!!e&&e.data.minmax.overlaps(t)}update(e){e.left&&e.right?e.data.minmax=e.key.union(e.left.data.minmax.union(e.right.data.minmax)):e.left?e.data.minmax=e.key.union(e.left.data.minmax):e.right?e.data.minmax=e.key.union(e.right.data.minmax):e.data.minmax=e.key.clone()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Qt=0,oe=-1,Ss=-2,As=-1,Bs=-2;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ne;(function(n){n[n.Simple=0]="Simple",n[n.Tile=1]="Tile",n[n.NestBegin=2]="NestBegin",n[n.NestEnd=4]="NestEnd",n[n.RangeBegin=16]="RangeBegin",n[n.RangeEnd=32]="RangeEnd",n[n.SlideOnRemove=64]="SlideOnRemove",n[n.StayOnRemove=128]="StayOnRemove",n[n.Transient=256]="Transient"})(ne||(ne={}));const fe={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Nk(n,e,t,r){let i=e;switch(i===void 0&&(i=n.defaultValue),n.name){case"incr":i+=t,n.minValue&&i<n.minValue&&(i=n.minValue);break;case"consensus":if(i===void 0)i={value:t,seq:r};else{const s=i;s.seq===-1&&(s.seq=r)}break}return i}function eu(n,e){if(n)if(e){for(const t in n){if(e[t]===void 0)return!1;if(typeof e[t]=="object"){if(!eu(n[t],e[t]))return!1}else if(e[t]!==n[t])return!1}for(const t in e)if(n[t]===void 0)return!1}else return!1;else if(e)return!1;return!0}function Lk(n,e,t,r){if(e!==void 0)for(const i in e){const s=e[i];s===null?delete n[i]:t&&t.name!=="rewrite"?n[i]=Nk(t,n[i],s,r):n[i]=s}return n}function R7(n){if(n===void 0)return;const e=Zt();for(const t in n){const r=n[t];r!==null&&(e[t]=r)}return e}function Ik(n,e,t,r){let i=n;return(!i||t&&t.name==="rewrite")&&(i=Zt()),Lk(i,e,t,r),i}function k7(n,e){if(e!==void 0)for(const t in e)n[t]===void 0&&(n[t]=e[t]);return n}function Zt(){return Object.create(null)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const N7="referenceTileLabels",tu="referenceRangeLabels";function Xe(n,e){return((typeof n=="number"?n:n.refType)&e)!==0}const ao=n=>Xe(n,ne.Tile)&&n.properties?n.properties[N7]:void 0,lo=n=>Xe(n,ne.NestBegin|ne.NestEnd)&&n.properties?n.properties[tu]:void 0;function pf(n,e){const t=ao(n);if(t){for(const r of t)if(e===r)return!0}return!1}function OS(n,e){const t=lo(n);if(t){for(const r of t)if(e===r)return!0}return!1}function Ms(n){return ao(n)!==void 0}function Ds(n){return lo(n)!==void 0}function L7(n,e){return PS(n,e)<0?n:e}function I7(n,e){return PS(n,e)>0?n:e}function PS(n,e){const t=n.getSegment(),r=e.getSegment();return t===r?n.getOffset()-e.getOffset():t===void 0||r!==void 0&&t.ordinal<r.ordinal?-1:1}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function A7(n){let e=0;if(Xe(n,ne.Transient)&&++e,Xe(n,ne.SlideOnRemove)&&++e,Xe(n,ne.StayOnRemove)&&++e,e>1)throw new Te("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}class yo{constructor(e,t,r=0,i=ne.Simple,s){this.client=e,this.offset=r,this.refType=i,A7(i),this.segment=t,this.properties=s}min(e){return L7(this,e)}max(e){return I7(this,e)}compare(e){return PS(this,e)}toPosition(){return this.getClient().localReferencePositionToPosition(this)}hasTileLabels(){return Ms(this)}hasRangeLabels(){return Ds(this)}hasTileLabel(e){return pf(this,e)}hasRangeLabel(e){return OS(this,e)}getTileLabels(){return ao(this)}getRangeLabels(){return lo(this)}isLeaf(){return!1}addProperties(e,t){this.properties=Ik(this.properties,e,t)}getClient(){return this.client}getSegment(){return this.segment}getOffset(){return this.offset}getProperties(){return this.properties}}yo.DetachedPosition=-1;function Au(n){Q(n instanceof yo,736)}class ii{constructor(e,t=new Array(e.cachedLength)){this.segment=e,this.hierRefCount=0,this.refCount=0,this.refsByOffset=t}static append(e,t){t.localRefs&&!t.localRefs.empty?(e.localRefs||(e.localRefs=new ii(e)),Q(e.localRefs.refsByOffset.length===e.cachedLength,702),e.localRefs.append(t.localRefs)):e.localRefs&&(e.localRefs.refsByOffset.length+=t.cachedLength)}[Symbol.iterator](){const e=[];for(const r of this.refsByOffset)r&&(r.before&&e.push(r.before[Symbol.iterator]()),r.at&&e.push(r.at[Symbol.iterator]()),r.after&&e.push(r.after[Symbol.iterator]()));return{next(){for(;e.length>0;){const r=e[0].next();if(r.done===!0)e.shift();else return r}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}clear(){this.refCount=0,this.hierRefCount=0;const e=t=>{if(t)for(const r of t)r.segment===this.segment&&(r.segment=void 0)};for(let t=0;t<this.refsByOffset.length;t++){const r=this.refsByOffset[t];r&&(e(r.before),e(r.at),e(r.before),this.refsByOffset[t]=void 0)}}get empty(){return this.refCount===0}createLocalRef(e,t,r,i){const s=new yo(i,this.segment,e,t,r);return Xe(s,ne.Transient)||this.addLocalRef(s),s}addLocalRef(e){var t,r;Q(!Xe(e,ne.Transient),735),Au(e);const i=this.refsByOffset[e.offset]=(t=this.refsByOffset[e.offset])!==null&&t!==void 0?t:{at:Qo()};(i.at=(r=i.at)!==null&&r!==void 0?r:Qo()).enqueue(e),(Ds(e)||Ms(e))&&this.hierRefCount++,this.refCount++}removeLocalRef(e){Au(e);const t=i=>{if(i){let s=i;do if(s=s.next,s.data===e)return Rk(s),(Ds(e)||Ms(e))&&this.hierRefCount--,this.refCount--,e;while(!s.isHead)}},r=this.refsByOffset[e.offset];if(r!==void 0){let i=t(r.before);if(i||(i=t(r.at),i)||(i=t(r.after),i))return i}}append(e){if(!(!e||e.empty)){this.hierRefCount+=e.hierRefCount,this.refCount+=e.refCount,e.hierRefCount=0;for(const t of e)t.segment=this.segment,t.offset+=this.refsByOffset.length;this.refsByOffset.push(...e.refsByOffset)}}split(e,t){if(this.empty)this.refsByOffset.length=e;else{const r=new ii(t,this.refsByOffset.splice(e,this.refsByOffset.length-e));t.localRefs=r;for(const i of r)i.segment=t,i.offset-=e,(Ds(i)||Ms(i))&&(this.hierRefCount--,r.hierRefCount++),this.refCount--,r.refCount++}}addBeforeTombstones(...e){var t,r,i,s,o;const a=(r=(t=this.refsByOffset[0])===null||t===void 0?void 0:t.before)!==null&&r!==void 0?r:Qo();for(const l of e)for(const c of l)Au(c),Xe(c,ne.SlideOnRemove)?(a.push(c),c.segment=this.segment,c.offset=0,(Ds(c)||Ms(c))&&this.hierRefCount++,this.refCount++):c.segment=void 0;if(!a.empty()&&((i=this.refsByOffset[0])===null||i===void 0?void 0:i.before)===void 0){const l=this.refsByOffset[0]=(s=this.refsByOffset[0])!==null&&s!==void 0?s:{before:a};l.before=(o=l.before)!==null&&o!==void 0?o:a}}addAfterTombstones(...e){var t,r,i,s,o;const a=this.refsByOffset.length-1,l=(r=(t=this.refsByOffset[a])===null||t===void 0?void 0:t.after)!==null&&r!==void 0?r:Qo();for(const c of e)for(const u of c)Au(u),Xe(u,ne.SlideOnRemove)?(l.push(u),u.segment=this.segment,u.offset=this.segment.cachedLength-1,(Ds(u)||Ms(u))&&this.hierRefCount++,this.refCount++):u.segment=void 0;if(!l.empty()&&((i=this.refsByOffset[a])===null||i===void 0?void 0:i.after)===void 0){const c=this.refsByOffset[a]=(s=this.refsByOffset[a])!==null&&s!==void 0?s:{after:l};c.after=(o=c.after)!==null&&o!==void 0?o:l}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Mu={APPEND:-1,SPLIT:-2,UNLINK:-3,ACKNOWLEDGED:-4};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class M7{constructor(){this.ordinalSortedItems=[]}get size(){return this.ordinalSortedItems.length}get items(){return this.ordinalSortedItems}addOrUpdate(e,t){const r=this.findOrdinalPosition(this.getOrdinal(e));r.exists?t&&t(this.ordinalSortedItems[r.index],e):this.ordinalSortedItems.splice(r.index,0,e)}remove(e){const t=this.findOrdinalPosition(this.getOrdinal(e));return t.exists?(this.ordinalSortedItems.splice(t.index,1),!0):!1}has(e){return this.findOrdinalPosition(this.getOrdinal(e)).exists}getOrdinal(e){const t=e;return t!=null&&t.segment?t.segment.ordinal:e.ordinal}findOrdinalPosition(e,t,r){if(this.ordinalSortedItems.length===0)return{exists:!1,index:0};if(t===void 0||r===void 0)return this.findOrdinalPosition(e,0,this.ordinalSortedItems.length-1);const i=t+Math.floor((r-t)/2);return this.getOrdinal(this.ordinalSortedItems[i])>e?t===i?{exists:!1,index:i}:this.findOrdinalPosition(e,t,i-1):this.getOrdinal(this.ordinalSortedItems[i])<e?i===r?{exists:!1,index:i+1}:this.findOrdinalPosition(e,i+1,r):{exists:!0,index:i}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class D7{constructor(e){this.segment=e,this.trackingGroups=new Set}link(e){e&&(this.trackingGroups.has(e)||this.trackingGroups.add(e),e.has(this.segment)||e.link(this.segment))}unlink(e){e.has(this.segment)&&e.unlink(this.segment),this.trackingGroups.delete(e)}copyTo(e){this.trackingGroups.forEach(t=>e.trackingCollection.link(t))}get empty(){return this.trackingGroups.size===0}matches(e){if(!e||this.trackingGroups.size!==e.trackingGroups.size)return!1;for(const t of this.trackingGroups.values())if(!e.trackingGroups.has(t))return!1;return!0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ko(n,e){let t=-1,r=0,i=n.length-1;for(;r<=i;){const s=r+Math.floor((i-r)/2);n[s].seq<=e?((t<0||n[t].seq<n[s].seq)&&(t=s),r=s+1):i=s-1}return t}class rt{constructor(e){this.minSeq=e,this.minLength=0,this.segmentCount=0,this.partialLengths=[],this.clientSeqNumbers=[]}static combine(e,t,r,i=!1){return rt.combineBranch(e,t,r,i)}static combineBranch(e,t,r,i=!1){let s=new rt(r.minSeq);rt.fromLeaves(s,t,r);let o;function a(h){if(!h)return;const f=new Pc(K_);return h.map(p=>(f.put(p.data.clientId,Object.assign({},p.data)),!0)),f}function l(h,f){const p=h.overlapRemoveClients;p?f.overlapRemoveClients&&f.overlapRemoveClients.map(g=>{const S=p.get(g.key);return S?S.data.seglen+=g.data.seglen:p.put(g.data.clientId,Object.assign({},g.data)),!0}):h.overlapRemoveClients=a(f.overlapRemoveClients)}function c(h){const f=h.seq;let p=0;if(o)if(o.seq===h.seq){o.seglen+=h.seglen,o.len+=h.seglen,l(o,h);return}else p=o.len,s.addClientSeqNumberFromPartial(o);o={clientId:h.clientId,len:p+h.seglen,overlapRemoveClients:a(h.overlapRemoveClients),seglen:h.seglen,seq:f},s.partialLengths.push(o)}const u=[];for(let h=0;h<t.childCount;h++){const f=t.children[h];if(!f.isLeaf()){const p=f;i&&(p.partialLengths=rt.combine(e,p,r,!0)),u.push(p.partialLengths)}}let d=u.length;if(d!==0){s.partialLengths.length>0&&(u.push(s),d++,s=new rt(r.minSeq));const h=new Array(d),f=new Array(d);for(let S=0;S<d;S++)h[S]=0,f[S]=u[S].partialLengths.length,s.minLength+=u[S].minLength,s.segmentCount+=u[S].segmentCount;let p=0,g;for(;p>=0;){p=-1;for(let S=0;S<d;S++)if(h[S]<f[S]){const m=u[S].partialLengths[h[S]];(p<0||m.seq<g.seq)&&(p=S,g=m)}p>=0&&(c(g),h[p]++)}o&&s.addClientSeqNumberFromPartial(o)}return rt.options.zamboni&&s.zamboni(r),rt.options.verify&&s.verify(),s}static fromLeaves(e,t,r){e.minLength=0,e.segmentCount=t.childCount;function i(l,c){return l!==void 0&&l!==oe&&l<=c}for(let l=0;l<t.childCount;l++){const c=t.children[l];if(c.isLeaf()){const u=c;i(u.seq,r.minSeq)?e.minLength+=u.cachedLength:u.seq!==oe&&rt.insertSegment(e,u);const d=ts(u);i(d==null?void 0:d.removedSeq,r.minSeq)?e.minLength-=u.cachedLength:d!==void 0&&d.removedSeq!==oe&&rt.insertSegment(e,u,d)}}const s=e.partialLengths,o=s.length;let a=0;for(let l=0;l<o;l++)s[l].len=a+s[l].seglen,a=s[l].len,e.addClientSeqNumberFromPartial(s[l]);rt.options.verify&&e.verify()}static getOverlapClients(e,t){const r=new Pc(K_);for(const i of e)r.put(i,{clientId:i,seglen:t});return r}static accumulateRemoveClientOverlap(e,t,r){if(e.overlapRemoveClients)for(const i of t){const s=e.overlapRemoveClients.get(i);s?s.data.seglen+=r:e.overlapRemoveClients.put(i,{clientId:i,seglen:r})}else e.overlapRemoveClients=rt.getOverlapClients(t,r)}static insertSegment(e,t,r){let i=t.seq,s=t.cachedLength,o=t.clientId,a;r&&(i=r.removedSeq,s=-s,o=r.removedClientIds[0],a=r.removedClientIds.length>1?r.removedClientIds.slice(1):void 0);const l=e.partialLengths,c=l.length;let u=0;for(;u<c&&!(l[u].seq>=i);u++);if(u<c&&l[u].seq===i)l[u].seglen+=s,a&&rt.accumulateRemoveClientOverlap(l[u],a,s);else{let d;if(a){const h=rt.getOverlapClients(a,s);d={seq:i,clientId:o,len:0,seglen:s,overlapRemoveClients:h}}else d={seq:i,clientId:o,len:0,seglen:s};if(u<c){for(let h=c;h>u;h--)l[h]=l[h-1];l[u]=d}else l.push(d)}}static addSeq(e,t,r,i){let s,o,a=ko(e,t);if(a>=0){const l=e[a];l.seq===t?(s=l,a=ko(e,t-1),a>=0&&(o=e[a])):o=l}s===void 0?(s={clientId:i,seglen:r,seq:t},e.push(s)):s.seglen=r,o!==void 0?s.len=s.seglen+o.len:s.len=s.seglen}update(e,t,r,i,s){let o=0,a=0;for(let l=0;l<t.childCount;l++){const c=t.children[l];if(c.isLeaf()){const u=c,d=ts(u);u.seq===r?(d==null?void 0:d.removedSeq)!==r&&(o+=u.cachedLength):(d==null?void 0:d.removedSeq)===r&&(o-=u.cachedLength),a++}else{const d=c.partialLengths,h=d.partialLengths,f=ko(h,r);if(f>=0){const p=h[f];p.seq===r&&(o+=p.seglen)}a+=d.segmentCount}}this.segmentCount=a,rt.addSeq(this.partialLengths,r,o,i),this.clientSeqNumbers[i]===void 0&&(this.clientSeqNumbers[i]=[]),rt.addSeq(this.clientSeqNumbers[i],r,o),rt.options.zamboni&&this.zamboni(s),rt.options.verify&&this.verify()}getPartialLength(e,t){let r=this.minLength;const i=ko(this.partialLengths,e),s=this.cliLatest(t),o=this.clientSeqNumbers[t];if(i>=0){if(r+=this.partialLengths[i].len,s>=0){const a=o[s];if(a.seq>e){r+=a.len;const l=this.cliLatestLEQ(t,e);l>=0&&(r-=o[l].len)}}}else if(s>=0){const a=o[s];r+=a.len}return r}toString(e,t=0){let r="";for(const i of this.partialLengths)r+=`(${i.seq},${i.len}) `;for(const i in this.clientSeqNumbers)if(this.clientSeqNumbers[i].length>0){r+="Client ",e?r+=`${e(+i)}`:r+=`${i}`,r+="[";for(const s of this.clientSeqNumbers[i])r+=`(${s.seq},${s.len})`;r+="]"}return r=`min(seq ${this.minSeq}): ${this.minLength}; sc: ${this.segmentCount};${r}`,r}zamboni(e){function t(r){const i=ko(r,e.minSeq);let s=0;if(i>=0){s=r[i].len;const o=r.length;if(i<=o-1){const a=o-i-1;for(let l=0;l<a;l++)r[l]=r[l+i+1],r[l].len-=s;r.length=a}}return s}this.minLength+=t(this.partialLengths);for(const r in this.clientSeqNumbers){const i=this.clientSeqNumbers[r];i&&t(i)}}addClientSeqNumber(e,t,r){this.clientSeqNumbers[e]===void 0&&(this.clientSeqNumbers[e]=[]);const i=this.clientSeqNumbers[e];let s=r;i.length>0&&(s+=i[i.length-1].len),i.push({seq:t,len:s,seglen:r})}addClientSeqNumberFromPartial(e){this.addClientSeqNumber(e.clientId,e.seq,e.seglen),e.overlapRemoveClients&&e.overlapRemoveClients.map(t=>(this.addClientSeqNumber(t.data.clientId,e.seq,t.data.seglen),!0))}cliLatestLEQ(e,t){const r=this.clientSeqNumbers[e];return r?ko(r,t):-1}cliLatest(e){const t=this.clientSeqNumbers[e];return t&&t.length>0?t.length-1:-1}verifyPartialLengths(e,t){if(e.length===0)return 0;let r=0,i=0,s=0;for(const o of e)s++,Q(this.minSeq<=o.seq,84),Q(r<o.seq,85),r=o.seq,i+=o.seglen,i!==o.len&&Q(!1,86),t||this.minLength+o.len<0&&Q(!1,87),o.overlapRemoveClients&&(Q(!t,88),s+=o.overlapRemoveClients.size());return s}verify(){if(this.clientSeqNumbers){let e=0;for(const r of this.clientSeqNumbers)r&&(e+=this.verifyPartialLengths(r,!0));Q(!!this.partialLengths,89);const t=this.verifyPartialLengths(this.partialLengths,!1);Q(t===e,90)}else Q(!this.partialLengths,91)}}rt.options={verify:!1,zamboni:!0};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class F7{constructor(e){this.segment=e,this.segmentGroups=Qo()}get size(){return this.segmentGroups.count()}get empty(){return this.segmentGroups.empty()}enqueue(e){this.segmentGroups.enqueue(e),e.segments.push(this.segment)}dequeue(){return this.segmentGroups.dequeue()}clear(){this.segmentGroups.clear()}copyTo(e){this.segmentGroups.walk(t=>e.segmentGroups.enqueue(t))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Ra{constructor(){this.pendingRewriteCount=0}ackPendingProperties(e){var t,r;e.combiningOp&&e.combiningOp.name==="rewrite"&&this.pendingRewriteCount--;for(const i of Object.keys(e.props))((t=this.pendingKeyUpdateCount)===null||t===void 0?void 0:t[i])!==void 0&&(Q(this.pendingKeyUpdateCount[i]>0,92),this.pendingKeyUpdateCount[i]--,((r=this.pendingKeyUpdateCount)===null||r===void 0?void 0:r[i])===0&&delete this.pendingKeyUpdateCount[i])}addProperties(e,t,r,i,s=!1){var o;if(this.pendingKeyUpdateCount||(this.pendingKeyUpdateCount=Zt()),this.pendingRewriteCount>0&&i!==oe&&s)return;const a=r&&r.name==="rewrite",l=a?void 0:r||void 0,c=d=>{var h;return!!(i===oe||((h=this.pendingKeyUpdateCount)===null||h===void 0?void 0:h[d])===void 0||l)},u={};if(a){s&&i===oe&&this.pendingRewriteCount++;for(const d of Object.keys(e))!t[d]&&c(d)&&(u[d]=e[d],delete e[d])}for(const d of Object.keys(t)){if(s){if(i===oe)((o=this.pendingKeyUpdateCount)===null||o===void 0?void 0:o[d])===void 0&&(this.pendingKeyUpdateCount[d]=0),this.pendingKeyUpdateCount[d]++;else if(!c(d))continue}const h=e[d];u[d]=h===void 0?null:h;let f;l?f=Nk(l,h,f,i):f=t[d],f===null?delete e[d]:e[d]=f}return u}copyTo(e,t,r){if(e){if(t||(t=Zt()),!r)throw new Error("Must provide new PropertyManager");for(const i of Object.keys(e))t[i]=e[i];r.pendingRewriteCount=this.pendingRewriteCount,r.pendingKeyUpdateCount=Zt();for(const i of Object.keys(this.pendingKeyUpdateCount))r.pendingKeyUpdateCount[i]=this.pendingKeyUpdateCount[i]}return t}hasPendingProperties(){return this.pendingRewriteCount>0||Object.keys(this.pendingKeyUpdateCount).length>0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ts(n){if((n==null?void 0:n.removedClientIds)!==void 0&&(n==null?void 0:n.removedSeq)!==void 0)return n;Q((n==null?void 0:n.removedClientIds)===void 0&&(n==null?void 0:n.removedSeq)===void 0,703)}function z7(n){return ts(n)!==void 0}function xm(n){const e=ts(n);return e!==void 0&&e.removedSeq!==oe}class Ak{constructor(){this.index=0,this.ordinal="",this.cachedLength=0}isLeaf(){return!1}}function V_(n,e){const t=ao(n);if(t)for(const r of t)e[r]=n}function W_(n,e){const t=ao(n);if(t)for(const r of t)e[r]===void 0&&(e[r]=n)}function Mk(n,e){for(const t in e){const r=e[t];if(!r.empty()){let i=n[t];i===void 0&&(i=new xS,n[t]=i);for(const s of r.items)RS(i,s)}}}function RS(n,e){if(Xe(e,ne.NestBegin))return n.push(e),!0;{const t=n.top();return t&&Xe(t,ne.NestBegin)?n.pop():n.push(e),!1}}function $7(n,e,t,r,i){var s;function o(a,l){let c=i[a];c===void 0&&(c=new xS,i[a]=c),RS(c,l)}if(e.isLeaf()){const a=e;if(((s=n.localNetLength(a))!==null&&s!==void 0?s:0)>0)if(Rt.is(a)){const l=a.getId();if(l&&n.mapIdToSegment(l,a),Xe(a,ne.Tile)&&(V_(a,t),W_(a,r)),a.refType&(ne.NestBegin|ne.NestEnd)){const c=lo(a);if(c)for(const u of c)o(u,a)}}else{const l=e;if(l.localRefs&&l.localRefs.hierRefCount!==void 0&&l.localRefs.hierRefCount>0){for(const c of l.localRefs)if(Xe(c,ne.Tile)&&(V_(c,t),W_(c,r)),c.refType&(ne.NestBegin|ne.NestEnd))for(const u of lo(c))o(u,c)}}}else{const a=e;Mk(i,a.rangeStacks),Lk(t,a.rightmostTiles),k7(r,a.leftmostTiles)}}const yn=8;class j7 extends Ak{constructor(e){super(),this.childCount=e,this.children=new Array(yn)}hierBlock(){}setOrdinal(e,t){let r=this.childCount;r===8&&(r=7),Q(r>=1&&r<=7,64);let i;const s=1<<yn-(r+1);if(t===0)i=s-1;else{const o=this.children[t-1].ordinal;i=o.charCodeAt(o.length-1)+s}e.ordinal=this.ordinal+String.fromCharCode(i),Q(e.ordinal.length===this.ordinal.length+1,65),t>0&&Q(e.ordinal>this.children[t-1].ordinal,66)}assignChild(e,t,r=!0){e.parent=this,e.index=t,r&&this.setOrdinal(e,t),this.children[t]=e}}class q7 extends j7{constructor(e){super(e),this.rightmostTiles=Zt(),this.leftmostTiles=Zt(),this.rangeStacks=Zt()}addNodeReferences(e,t){$7(e,t,this.rightmostTiles,this.leftmostTiles,this.rangeStacks)}hierBlock(){return this}hierToString(e){let t="";for(const r in this.rangeStacks){const i=this.rangeStacks[r];t+=G7(e),t+=`${r}: `;for(const s of i.items)t+=`${s.toString()} `;t+=`
`}return t}}function B7(n,e){return e.isLeaf()?n.localNetLength(e):e.cachedLength}class mf extends Ak{constructor(){super(...arguments),this.clientId=As,this.seq=Qt,this.segmentGroups=new F7(this),this.trackingCollection=new D7(this)}addProperties(e,t,r,i){return this.propertyManager||(this.propertyManager=new Ra),this.properties||(this.properties=Zt()),this.propertyManager.addProperties(this.properties,e,t,r,i&&i.collaborating)}hasProperty(e){return!!this.properties&&this.properties[e]!==void 0}isLeaf(){return!0}cloneInto(e){var t;e.clientId=this.clientId,e.properties=R7(this.properties),e.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),e.removedSeq=this.removedSeq,e.seq=this.seq}canAppend(e){return!1}addSerializedProps(e){this.properties&&(e.props=this.properties)}ack(e,t,r){const i=this.segmentGroups.dequeue();switch(Q(i===e,67),t.op.type){case fe.ANNOTATE:return Q(!!this.propertyManager,68),this.propertyManager.ackPendingProperties(t.op),!0;case fe.INSERT:return Q(this.seq===oe,69),this.seq=t.sequencedMessage.sequenceNumber,this.localSeq=void 0,!0;case fe.REMOVE:const s=ts(this);return Q(s!==void 0,70),this.localRemovedSeq=void 0,s.removedSeq===oe?(s.removedSeq=t.sequencedMessage.sequenceNumber,!0):!1;default:throw new Error(`${t.op.type} is in unrecognized operation type`)}}splitAt(e){var t;if(e>0){const r=this.createSplitSegmentAt(e);return r&&(this.copyPropertiesTo(r),r.parent=this.parent,r.ordinal=this.ordinal+String.fromCharCode(0),r.removedClientIds=(t=this.removedClientIds)===null||t===void 0?void 0:t.slice(),r.removedSeq=this.removedSeq,r.localRemovedSeq=this.localRemovedSeq,r.seq=this.seq,r.localSeq=this.localSeq,r.clientId=this.clientId,this.segmentGroups.copyTo(r),this.trackingCollection.copyTo(r),this.localRefs&&this.localRefs.split(e,r)),r}}copyPropertiesTo(e){this.propertyManager&&this.properties&&(e.propertyManager=new Ra,e.properties=this.propertyManager.copyTo(this.properties,e.properties,e.propertyManager))}}const G_="markerId",U7="markerSimpleType";class Rt extends mf{constructor(e){super(),this.refType=e,this.type=Rt.type,this.cachedLength=1}static is(e){return e.type===Rt.type}static make(e,t){const r=new Rt(e);return t&&r.addProperties(t),r}toJSONObject(){const e={marker:{refType:this.refType}};return super.addSerializedProps(e),e}static fromJSONObject(e){if(e&&typeof e=="object"&&"marker"in e)return Rt.make(e.marker.refType,e.props)}clone(){const e=Rt.make(this.refType,this.properties);return this.cloneInto(e),e}getSegment(){return this}getOffset(){return 0}hasSimpleType(e){return!!this.properties&&this.properties[U7]===e}getProperties(){return this.properties}getId(){if(this.properties&&this.properties[G_])return this.properties[G_]}hasTileLabels(){return Ms(this)}hasRangeLabels(){return Ds(this)}hasTileLabel(e){return pf(this,e)}hasRangeLabel(e){return OS(this,e)}getTileLabels(){return ao(this)}getRangeLabels(){return lo(this)}toString(){let e="";Xe(this,ne.Tile)&&(e+="Tile"),Xe(this,ne.NestBegin)&&(e.length>0&&(e+="; "),e+="RangeBegin"),Xe(this,ne.NestEnd)&&(e.length>0&&(e+="; "),e+="RangeEnd");let t="";const r=this.getId();r&&(e+=` (${r}) `);const i=ao(this);if(i){t+="tile -- ";for(let a=0,l=i.length;a<l;a++){const c=i[a];a>0&&(t+="; "),t+=c}}const s=lo(this);if(s){let a="begin";Xe(this,ne.NestEnd)&&(a="end"),i&&(t+=" "),t+=`range ${a} -- `;const l=s;for(let c=0,u=l.length;c<u;c++){const d=l[c];c>0&&(t+="; "),t+=d}}let o="";return this.properties&&(o+=JSON.stringify(this.properties,(a,l)=>{const c=!!l&&l.IFluidHandle;return c?`#Handle(${c.routeContext.path}/${c.path})`:l})),`M ${e}: ${t} ${o}`}createSplitSegmentAt(e){}canAppend(e){return!1}append(){throw new Error("Can not append to marker")}}Rt.type="Marker";var da;(function(n){n[n.Go=0]="Go",n[n.Stop=1]="Stop",n[n.Yield=2]="Yield"})(da||(da={}));class H7{constructor(e,t,r,i,s,o,a,l,c=0){this.block=e,this.actions=t,this.pos=r,this.refSeq=i,this.clientId=s,this.context=o,this.start=a,this.end=l,this.childIndex=c,this.op=da.Go}}class V7{constructor(){this.clientId=As,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0}loadFrom(e){this.clientId=e.clientId,this.collaborating=e.collaborating,this.minSeq=e.minSeq,this.currentSeq=e.currentSeq}}const K_=(n,e)=>n-e,W7=(n,e)=>n.localeCompare(e),Du=[""," ","  "];function G7(n){if(Du[n]===void 0){Du[n]="";for(let e=0;e<n;e++)Du[n]+=" "}return Du[n]}const K7={min:{maxSeq:-2},compare:(n,e)=>n.maxSeq-e.maxSeq};function Dk(n,e){for(const t of e.rangeLabels)if(OS(n,t)){let r=e.stacks[t];r===void 0&&(r=new xS,e.stacks[t]=r),RS(r,n)}}function J7(n,e,t,r,i,s,o){return Rt.is(n)&&n.refType&(ne.NestBegin|ne.NestEnd)&&Dk(n,o),!1}function Q7(n,e,t,r,i,s,o){var a;if(n.isLeaf()){const l=n;((a=o.mergeTree.localNetLength(l))!==null&&a!==void 0?a:0)>0&&Rt.is(l)&&l.refType&(ne.NestBegin|ne.NestEnd)&&Dk(l,o)}else{const l=n;Mk(o.stacks,l.rangeStacks)}return!0}function J_(n,e,t,r,i,s,o){return Rt.is(n)&&pf(n,o.tileLabel)&&(o.tile=n),!1}function Q_(n,e,t,r,i,s,o){if(n.isLeaf()){const a=n;o.mergeTree.localNetLength(a)>0&&Rt.is(a)&&pf(a,o.tileLabel)&&(o.tile=a)}else{const a=n;let l;o.posPrecedesTile?l=a.rightmostTiles[o.tileLabel]:l=a.leftmostTiles[o.tileLabel],l!==void 0&&(o.tile=l)}return!0}const X7={min:{minRequired:Number.MIN_VALUE,onMinGE:()=>{Q(!1,72)}},compare:(n,e)=>n.minRequired-e.minRequired};class ct{constructor(e){this.options=e,this.blockUpdateActions=ct.initBlockUpdateActions,this.collabWindow=new V7,this.idToSegment=new Map,this.splitLeafSegment=(t,r)=>{if(!(r>0&&t))return{};const i=t.splitAt(r);return this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Mu.SPLIT,deltaSegments:[{segment:t},{segment:i}]},void 0),{next:i}},this.root=this.makeBlock(0)}makeBlock(e){const t=new q7(e);return t.ordinal="",t}clone(){const e=new ct(this.options);e.root=e.blockClone(this.root)}blockClone(e,t){const r=this.makeBlock(e.childCount);for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=this.segmentClone(s);r.assignChild(o,i),t&&t.push(o)}else r.assignChild(this.blockClone(s,t),i)}return this.nodeUpdateLengthNewStructure(r),this.nodeUpdateOrdinals(r),r}segmentClone(e){return e.clone()}localNetLength(e){return ts(e)!==void 0?0:e.cachedLength}mapIdToSegment(e,t){this.idToSegment.set(e,t)}addNode(e,t){const r=e.childCount++;return e.assignChild(t,r,!1),r}reloadFromSegments(e){Q(!this.collabWindow.collaborating,73);const t=yn-1,r=i=>{const s=Math.ceil(i.length/t),o=new Array(s);for(let a=0,l=0;l<s;l++){const c=o[l]=this.makeBlock(0);for(let u=0;u<t&&a<i.length;u++,a++)this.addNode(c,i[a]);this.blockUpdate(c)}return o.length===1?o[0]:r(o)};e.length>0?(this.root=r(e),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}startCollaboration(e,t,r){this.collabWindow.clientId=e,this.collabWindow.minSeq=t,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=r,this.segmentsToScour=new H_([],K7),this.pendingSegments=Qo(),this.nodeUpdateLengthNewStructure(this.root,!0)}addToLRUSet(e,t){e.parent.needsScour!==!0&&t>this.collabWindow.currentSeq&&(e.parent.needsScour=!0,this.segmentsToScour.add({segment:e,maxSeq:t}))}underflow(e){return e.childCount<yn/2}scourNode(e,t){let r;for(let i=0;i<e.childCount;i++){const s=e.children[i];if(s.isLeaf()){const o=s;o.segmentGroups.empty?o.removedSeq!==void 0?(o.removedSeq>this.collabWindow.minSeq?t.push(o):o.trackingCollection.empty?(this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Mu.UNLINK,deltaSegments:[{segment:o}]},void 0),o.parent=void 0):t.push(o),r=void 0):o.seq<=this.collabWindow.minSeq?r&&r.canAppend(o)&&eu(r.properties,o.properties)&&r.trackingCollection.matches(o.trackingCollection)&&this.localNetLength(o)>0?(r.append(o),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:Mu.APPEND,deltaSegments:[{segment:r},{segment:o}]},void 0),o.parent=void 0,o.trackingCollection.trackingGroups.forEach(l=>l.unlink(o))):(t.push(o),this.localNetLength(o)>0?r=o:r=void 0):(t.push(o),r=void 0):(t.push(o),r=void 0)}else t.push(s),r=void 0}}packParent(e){const t=e.children;let r,i;const s=[];for(r=0;r<e.childCount;r++)i=t[r],this.scourNode(i,s),i.parent=void 0;const o=s.length,a=yn/2;let l=Math.min(yn-1,Math.floor(o/a));l<1&&(l=1);const c=Math.floor(o/l);let u=o%l;const d=new Array(yn);let h=0;for(let f=0;f<l;f++){let p=c;u>0&&(p++,u--);const g=this.makeBlock(p);for(let S=0;S<p;S++){const m=s[h++];g.assignChild(m,S,!1)}g.parent=e,d[f]=g,this.nodeUpdateLengthNewStructure(g)}e.children=d;for(let f=0;f<l;f++)e.assignChild(d[f],f,!1);e.childCount=l,this.underflow(e)&&e.parent?this.packParent(e.parent):(this.nodeUpdateOrdinals(e),this.blockUpdatePathLengths(e,oe,-1,!0))}zamboniSegments(e=ct.zamboniSegmentsMaxCount){if(this.collabWindow.collaborating)for(let t=0;t<e;t++){let r=this.segmentsToScour.peek();if(!r||r.maxSeq>this.collabWindow.minSeq)break;if(r=this.segmentsToScour.get(),r.segment.parent&&r.segment.parent.needsScour!==!1){const i=r.segment.parent,s=[];this.scourNode(i,s),i.needsScour=!1;const o=s.length;if(o<i.childCount){i.childCount=o,i.children=s;for(let a=0;a<o;a++)i.assignChild(s[a],a,!1);this.underflow(i)&&i.parent?this.packParent(i.parent):(this.nodeUpdateOrdinals(i),this.blockUpdatePathLengths(i,oe,-1,!0))}}}}getCollabWindow(){return this.collabWindow}getStats(){const e=r=>{const i={maxHeight:0,nodeCount:0,leafCount:0,removedLeafCount:0,liveCount:0,histo:[]};for(let s=0;s<yn;s++)i.histo[s]=0;for(let s=0;s<r.childCount;s++){const o=r.children[s];let a=1;if(o.isLeaf())i.leafCount++,o.removedSeq!==void 0&&i.removedLeafCount++;else{const l=e(o);a=1+l.maxHeight,i.nodeCount+=l.nodeCount,i.leafCount+=l.leafCount,i.removedLeafCount+=l.removedLeafCount,i.liveCount+=l.liveCount;for(let c=0;c<yn;c++)i.histo[c]+=l.histo[c]}a>i.maxHeight&&(i.maxHeight=a)}return i.histo[r.childCount]++,i.nodeCount++,i.liveCount+=r.childCount,i};return e(this.root)}getLength(e,t){return this.blockLength(this.root,e,t)}get length(){return this.root.cachedLength}getPosition(e,t,r){var i;let s=0,o=e.parent,a;for(;o;){const l=o.children;for(let c=0;c<o.childCount;c++){const u=l[c];if(a&&u===a||u===e)break;s+=(i=this.nodeLength(u,t,r))!==null&&i!==void 0?i:0}a=o,o=o.parent}return s}getContainingSegment(e,t,r){let i,s;const o=(a,l,c,u,d)=>(i=a,s=d,!1);return this.searchBlock(this.root,e,0,t,r,{leaf:o},void 0),{segment:i,offset:s}}_getSlideToSegment(e){if(!e.segment||!xm(e.segment))return e;let t;const r=i=>i.seq!==oe&&!xm(i)?(t=i,!1):!0;return this.rightExcursion(e.segment,r),t?{segment:t,offset:0}:(this.leftExcursion(e.segment,r),t=t,t?{segment:t,offset:t.cachedLength-1}:{segment:void 0,offset:0})}slideReferences(e,t){var r,i,s,o,a;Q(xm(e),753),Q(!!e.localRefs,754);const l=this._getSlideToSegment({segment:e,offset:0}),c=l.segment;c&&!c.localRefs&&(c.localRefs=new ii(c));for(const u of t){(i=(r=u.callbacks)===null||r===void 0?void 0:r.beforeSlide)===null||i===void 0||i.call(r);const d=e.localRefs.removeLocalRef(u);Q(u===d,755),c?(u.segment=c,u.offset=(s=l.offset)!==null&&s!==void 0?s:0,Q(!!c.localRefs,756),c.localRefs.addLocalRef(u)):(u.segment=void 0,u.offset=0),(a=(o=u.callbacks)===null||o===void 0?void 0:o.afterSlide)===null||a===void 0||a.call(o)}c&&this.blockUpdatePathLengths(c.parent,Ss,As)}updateSegmentRefsAfterMarkRemoved(e,t){if(!e.localRefs||e.localRefs.empty)return;const r=[],i=[];for(const s of e.localRefs)Xe(s,ne.StayOnRemove)?i.push(s):Xe(s,ne.SlideOnRemove)&&(t?i.push(s):r.push(s));t||this.slideReferences(e,r),e.localRefs.clear();for(const s of i)s.segment=e,e.localRefs.addLocalRef(s)}blockLength(e,t,r){return this.collabWindow.collaborating&&r!==this.collabWindow.clientId?e.partialLengths.getPartialLength(t,r):e.cachedLength}nodeLength(e,t,r){if(!this.collabWindow.collaborating||this.collabWindow.clientId===r)return e.isLeaf()?this.localNetLength(e):e.cachedLength;if(e.isLeaf()){const i=e,s=ts(i);return s!==void 0&&s.removedSeq!==oe&&s.removedSeq<=t?void 0:i.clientId===r||i.seq!==oe&&i.seq<=t?s!==void 0&&s.removedClientIds.includes(r)?0:i.cachedLength:s!==void 0&&s.removedSeq!==oe?void 0:0}else return e.partialLengths.getPartialLength(t,r)}addMinSeqListener(e,t){this.minSeqListeners||(this.minSeqListeners=new H_([],X7)),this.minSeqListeners.add({minRequired:e,onMinGE:t})}notifyMinSeqListeners(){if(this.minSeqListeners)for(;this.minSeqListeners.count()>0&&this.minSeqListeners.peek().minRequired<=this.collabWindow.minSeq;)this.minSeqListeners.get().onMinGE(this.collabWindow.minSeq)}setMinSeq(e){Q(e<=this.collabWindow.currentSeq,78),Q(this.collabWindow.minSeq<=e,79),e>this.collabWindow.minSeq&&(this.collabWindow.minSeq=e,ct.options.zamboniSegments&&this.zamboniSegments(),this.notifyMinSeqListeners())}referencePositionToLocalPosition(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){const i=e.getSegment();return i&&i.parent?(i.removedSeq?0:e.getOffset())+this.getPosition(i,t,r):yo.DetachedPosition}getStackContext(e,t,r){const i={mergeTree:this,stacks:Zt(),rangeLabels:r};return this.search(e,Qt,t,{leaf:J7,shift:Q7},i),i.stacks}findTile(e,t,r,i=!0){const s={mergeTree:this,posPrecedesTile:i,tileLabel:r};if(i?this.search(e,Qt,t,{leaf:J_,shift:Q_},s):this.backwardSearch(e,Qt,t,{leaf:J_,shift:Q_},s),s.tile){let o;if(s.tile.isLeaf()){const a=s.tile;o=this.getPosition(a,Qt,t)}else o=s.tile.toPosition();return{tile:s.tile,pos:o}}}search(e,t,r,i,s){return this.searchBlock(this.root,e,0,t,r,i,s)}searchBlock(e,t,r,i,s,o,a){var l;let c=t,u=r;const d=e.children;o&&o.pre&&o.pre(e,u,i,s,void 0,void 0,a);const h=o&&o.contains;for(let f=0;f<e.childCount;f++){const p=d[f],g=(l=this.nodeLength(p,i,s))!==null&&l!==void 0?l:0;if(!h&&c<g||h&&h(p,c,i,s,void 0,void 0,a))return p.isLeaf()?(o&&o.leaf&&o.leaf(p,u,i,s,c,-1,a),p):this.searchBlock(p,c,u,i,s,o,a);o&&o.shift&&o.shift(p,u,i,s,c,void 0,a),c-=g,u+=g}o&&o.post&&o.post(e,u,i,s,void 0,void 0,a)}backwardSearch(e,t,r,i,s){const o=this.getLength(t,r);if(!(e>o))return this.backwardSearchBlock(this.root,e,o,t,r,i,s)}backwardSearchBlock(e,t,r,i,s,o,a){var l;let c=r;const u=e.children;o&&o.pre&&o.pre(e,c,i,s,void 0,void 0,a);const d=o&&o.contains;for(let h=e.childCount-1;h>=0;h--){const f=u[h],p=(l=this.nodeLength(f,i,s))!==null&&l!==void 0?l:0,g=c-p;if(!d&&t>=g||d&&d(f,t,i,s,void 0,void 0,a))return f.isLeaf()?(o&&o.leaf&&o.leaf(f,g,i,s,t,-1,a),f):this.backwardSearchBlock(f,t,c,i,s,o,a);o&&o.shift&&o.shift(f,g,i,s,t,void 0,a),c=g}o&&o.post&&o.post(e,c,i,s,void 0,void 0,a)}updateRoot(e){if(e!==void 0){const t=this.makeBlock(2);t.assignChild(this.root,0,!1),t.assignChild(e,1,!1),this.root=t,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}}ackPendingSegment(e){const t=e.sequencedMessage.sequenceNumber,r=this.pendingSegments.dequeue(),i=[];let s=!1;if(r!==void 0){const o=[];r.segments.map(l=>{const c=!l.ack(r,e,this);s=c||s,!c&&e.op.type===fe.REMOVE&&this.updateSegmentRefsAfterMarkRemoved(l,!1),ct.options.zamboniSegments&&this.addToLRUSet(l,t),i.includes(l.parent)||i.push(l.parent),o.push({segment:l})}),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({deltaSegments:o,operation:Mu.ACKNOWLEDGED},e);const a=this.collabWindow.clientId;for(const l of i)this.blockUpdatePathLengths(l,t,a,s)}ct.options.zamboniSegments&&this.zamboniSegments()}addToPendingList(e,t,r){let i=t;return i===void 0&&(i={segments:[],localSeq:r},this.pendingSegments.enqueue(i)),e.segmentGroups.enqueue(i),i}getMarkerFromId(e){return this.idToSegment.get(e)}posFromRelativePos(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){let i=-1,s;return e.id&&(s=this.getMarkerFromId(e.id)),s&&(i=this.getPosition(s,t,r),e.before?e.offset!==void 0&&(i-=e.offset):(i+=s.cachedLength,e.offset!==void 0&&(i+=e.offset))),i}insertSegments(e,t,r,i,s,o){this.ensureIntervalBoundary(e,r,i);const a=s===oe?++this.collabWindow.localSeq:void 0;this.blockInsert(e,r,i,s,a,t),this.mergeTreeDeltaCallback&&o!==void 0&&this.mergeTreeDeltaCallback(o,{operation:fe.INSERT,deltaSegments:t.map(l=>({segment:l}))}),this.collabWindow.collaborating&&ct.options.zamboniSegments&&s!==oe&&this.zamboniSegments()}insertAtReferencePosition(e,t,r){if(t.cachedLength===0)return;if(t.parent||t.removedSeq||t.seq!==Qt)throw new Error("Cannot insert segment that has already been inserted.");const i=u=>{let d=u.parent,h=d;for(;d!==void 0;){if(d.childCount>=yn){const f=this.split(d);d===this.root?(this.updateRoot(f),h=void 0):(this.insertChildNode(d.parent,f,d.index+1),h=f.parent,this.blockUpdateLength(d.parent,oe,s))}else this.blockUpdateLength(d,oe,s);d=d.parent}h&&this.nodeUpdateOrdinals(h)},s=this.collabWindow.clientId,o=e.getSegment(),a=e.getOffset(),l=this.nodeLength(o,this.collabWindow.currentSeq,s);let c=o;if(a!==0&&l!==void 0&&l!==0){const u=this.splitLeafSegment(o,a);Q(!!u.next,80),this.insertChildNode(o.parent,u.next,o.index+1),i(u.next),c=u.next}if(this.leftExcursion(c,u=>{if(!u.isLeaf())return!0;const d=this.nodeLength(u,this.collabWindow.currentSeq,s);return d===void 0?!0:d===0?(this.breakTie(0,u,oe)&&(c=u),!0):!1}),this.collabWindow.collaborating?(t.localSeq=++this.collabWindow.localSeq,t.seq=oe):t.seq=Qt,t.clientId=s,Rt.is(t)){const u=t.getId();u&&this.mapIdToSegment(u,t)}this.insertChildNode(c.parent,t,c.index),i(t),this.mergeTreeDeltaCallback&&this.mergeTreeDeltaCallback(r,{deltaSegments:[{segment:t}],operation:fe.INSERT}),this.collabWindow.collaborating&&this.addToPendingList(t,void 0,t.localSeq)}resolveRemoteClientPosition(e,t,r){if(t<this.collabWindow.minSeq)return;const i=this.getContainingSegment(e,t,r),s=this.getCollabWindow();if(i&&i.segment)return this.getPosition(i.segment,s.currentSeq,s.clientId)+i.offset;if(e===this.getLength(t,r))return this.getLength(s.currentSeq,s.clientId)}insertChildNode(e,t,r){Q(e.childCount<yn,81);for(let i=e.childCount;i>r;i--)e.children[i]=e.children[i-1],e.children[i].index=i;e.childCount++,e.assignChild(t,r,!1)}blockInsert(e,t,r,i,s,o){let a=!1;const l=p=>(p.seq===oe&&(a=!0),!1),c=p=>(a=!1,this.rightExcursion(p,l),a);let u;const d=p=>{this.collabWindow.collaborating&&(p.seq===oe&&r===this.collabWindow.clientId?u=this.addToPendingList(p,u,s):p.seq>this.collabWindow.minSeq&&ct.options.zamboniSegments&&this.addToLRUSet(p,p.seq))},h=(p,g,S)=>{const m={};return p?(m.replaceCurrent=S.candidateSegment,m.next=p):m.next=S.candidateSegment,m};let f=e;for(const p of o)if(a=!1,p.cachedLength>0){if(p.seq=i,p.localSeq=s,p.clientId=r,Rt.is(p)){const S=p.getId();S&&this.mapIdToSegment(S,p)}const g=this.insertingWalk(this.root,f,t,r,i,{leaf:h,candidateSegment:p,continuePredicate:c});if(p.parent===void 0)throw new Error(`MergeTree insert failed: ${JSON.stringify({currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:p.seq})}`);this.updateRoot(g),d(p),f+=p.cachedLength}}ensureIntervalBoundary(e,t,r){const i=this.insertingWalk(this.root,e,t,r,Ss,{leaf:this.splitLeafSegment});this.updateRoot(i)}breakTie(e,t,r){var i;if(t.isLeaf()){if(e===0){const s=r===oe?Number.MAX_SAFE_INTEGER:r,o=t.seq===oe?Number.MAX_SAFE_INTEGER-1:(i=t.seq)!==null&&i!==void 0?i:0;return s>o}return!1}else return!0}leftExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let a,l,c=!1;for(a=s.childCount-1;a>=0;a--)if(l=o[a],c){if(l.isLeaf())r=t(l,0,Qt,this.collabWindow.clientId,0,0,void 0);else{const u=l;r=this.nodeMapReverse(u,t,0,Qt,this.collabWindow.clientId)}if(!r)return}else c=i===l;i=s,s=s.parent}}rightExcursion(e,t){let r=!0,i=e,s=i.parent;for(;s;){const o=s.children;let a,l,c=!1;for(a=0;a<s.childCount;a++)if(l=o[a],c){if(l.isLeaf())r=t(l);else{const u=l;r=this.walkAllSegments(u,t)}if(!r)return}else c=i===l;i=s,s=s.parent}}insertingWalk(e,t,r,i,s,o){let a=t;const l=e.children;let c,u,d,h;for(c=0;c<e.childCount;c++){u=l[c];const f=this.nodeLength(u,r,i);if(f!==void 0)if(a<f||a===f&&this.breakTie(a,u,s)){if(u.isLeaf()){const p=u,g=o.leaf(p,a,o);if(g.replaceCurrent&&(e.assignChild(g.replaceCurrent,c,!1),g.replaceCurrent.ordinal=u.ordinal),g.next)d=g.next,c++;else{o.structureChange&&this.nodeUpdateLengthNewStructure(e);return}}else{const p=u,g=this.insertingWalk(p,a,r,i,s,o);if(g===void 0){o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else if(g===ct.theUnfinishedNode){a-=f;continue}else d=g,h=g,c++}break}else a-=f}if(!d&&a===0){if(s!==oe&&o.continuePredicate&&o.continuePredicate(e))return ct.theUnfinishedNode;d=o.leaf(void 0,a,o).next}if(d){for(let f=e.childCount;f>c;f--)e.children[f]=e.children[f-1],e.children[f].index=f;if(e.assignChild(d,c,!1),e.childCount++,e.setOrdinal(d,c),e.childCount<yn){h&&this.nodeUpdateOrdinals(h),o.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,i);return}else return this.split(e)}else return}split(e){const t=yn/2,r=this.makeBlock(t);e.childCount=t,this.nodeUpdateOrdinals(e);for(let i=0;i<t;i++)r.assignChild(e.children[t+i],i,!1),e.children[t+i]=void 0;return this.nodeUpdateLengthNewStructure(e),this.nodeUpdateLengthNewStructure(r),r}nodeUpdateOrdinals(e){for(let t=0;t<e.childCount;t++){const r=e.children[t];e.setOrdinal(r,t),r.isLeaf()||this.nodeUpdateOrdinals(r)}}annotateRange(e,t,r,i,s,o,a,l){this.ensureIntervalBoundary(e,s,o),this.ensureIntervalBoundary(t,s,o);const c=[],u=a===oe?++this.collabWindow.localSeq:void 0;let d;const h=f=>{const p=f.addProperties(r,i,a,this.collabWindow);return c.push({segment:f,propertyDeltas:p}),this.collabWindow.collaborating&&(a===oe?d=this.addToPendingList(f,d,u):ct.options.zamboniSegments&&this.addToLRUSet(f,a)),!0};this.mapRange({leaf:h},s,o,void 0,e,t),this.mergeTreeDeltaCallback&&c.length>0&&this.mergeTreeDeltaCallback(l,{operation:fe.ANNOTATE,deltaSegments:c}),this.collabWindow.collaborating&&a!==oe&&ct.options.zamboniSegments&&this.zamboniSegments()}markRangeRemoved(e,t,r,i,s,o=!1,a){let l=o;this.ensureIntervalBoundary(e,r,i),this.ensureIntervalBoundary(t,r,i);let c;const u=[],d=[],h=s===oe?++this.collabWindow.localSeq:void 0,f=(S,m,v,y)=>{const b=ts(S);return b!==void 0?(l=!0,b.removedSeq===oe?(b.removedClientIds.unshift(i),b.removedSeq=s,S.localRemovedSeq=void 0):b.removedClientIds.push(i)):(S.removedClientIds=[i],S.removedSeq=s,S.localRemovedSeq=h,u.push({segment:S})),S.localRefs&&!S.localRefs.empty&&d.push(S),this.collabWindow.collaborating&&(S.removedSeq===oe&&i===this.collabWindow.clientId?c=this.addToPendingList(S,c,h):ct.options.zamboniSegments&&this.addToLRUSet(S,s)),!0},p=(S,m,v,y)=>(l?this.nodeUpdateLengthNewStructure(S):this.blockUpdateLength(S,s,i),!0);this.mapRange({leaf:f,post:p},r,i,void 0,e,t);const g=this.collabWindow.collaborating&&i===this.collabWindow.clientId;for(const S of d)this.updateSegmentRefsAfterMarkRemoved(S,g);this.mergeTreeDeltaCallback&&u.length>0&&this.mergeTreeDeltaCallback(a,{operation:fe.REMOVE,deltaSegments:u}),this.collabWindow.collaborating&&s!==oe&&ct.options.zamboniSegments&&this.zamboniSegments()}nodeUpdateLengthNewStructure(e,t=!1){this.blockUpdate(e),this.collabWindow.collaborating&&(e.partialLengths=rt.combine(this,e,this.collabWindow,t))}removeLocalReferencePosition(e){var t;const r=e.getSegment();if(r){const i=(t=r==null?void 0:r.localRefs)===null||t===void 0?void 0:t.removeLocalRef(e);return i!==void 0&&this.blockUpdatePathLengths(r.parent,Ss,As),i}}createLocalReferencePosition(e,t,r,i,s){var o;if(z7(e)&&!Xe(r,ne.SlideOnRemove|ne.Transient))throw new Te("Can only create SlideOnRemove or Transient local reference position on a removed segment");const a=(o=e.localRefs)!==null&&o!==void 0?o:new ii(e);e.localRefs=a;const l=a.createLocalRef(t,r,i,s);return this.blockUpdatePathLengths(e.parent,Ss,As),l}removeLocalReference(e,t){e.localRefs&&e.localRefs.removeLocalRef(t)&&this.blockUpdatePathLengths(e.parent,Ss,As)}addLocalReference(e){const t=e.segment;let r=t.localRefs;r||(r=new ii(t),t.localRefs=r),r.addLocalRef(e),this.blockUpdatePathLengths(t.parent,Ss,As)}blockUpdate(e){var t;let r=0;const i=e.hierBlock();i&&(i.rightmostTiles=Zt(),i.leftmostTiles=Zt(),i.rangeStacks={});for(let s=0;s<e.childCount;s++){const o=e.children[s];r+=(t=B7(this,o))!==null&&t!==void 0?t:0,i&&i.addNodeReferences(this,o),this.blockUpdateActions&&this.blockUpdateActions.child(e,s)}e.cachedLength=r}blockUpdatePathLengths(e,t,r,i=!1){let s=e;for(;s!==void 0;)i?this.nodeUpdateLengthNewStructure(s):this.blockUpdateLength(s,t,r),s=s.parent}blockUpdateLength(e,t,r){this.blockUpdate(e),this.collabWindow.collaborating&&t!==oe&&t!==Ss&&(e.partialLengths!==void 0&&ct.options.incrementalUpdate&&r!==Bs?e.partialLengths.update(this,e,t,r,this.collabWindow):e.partialLengths=rt.combine(this,e,this.collabWindow))}map(e,t,r,i){this.nodeMap(this.root,e,0,t,r,i)}mapRange(e,t,r,i,s,o,a=!1){a&&(s&&this.ensureIntervalBoundary(s,t,r),o&&this.ensureIntervalBoundary(o,t,r)),this.nodeMap(this.root,e,0,t,r,i,s,o)}incrementalBlockMap(e){for(var t;!e.empty();){const r=e.top();if(r.op!==da.Go)return;if(r.childIndex===0&&(r.start===void 0&&(r.start=0),r.end===void 0&&(r.end=this.blockLength(r.block,r.refSeq,r.clientId)),r.actions.pre&&r.actions.pre(r)),r.op===da.Go&&r.childIndex<r.block.childCount){const i=r.block.children[r.childIndex],s=(t=this.nodeLength(i,r.refSeq,r.clientId))!==null&&t!==void 0?t:0;if(s>0&&r.start<s&&r.end>0)if(i.isLeaf())r.actions.leaf(i,r);else{const o=new H7(i,r.actions,r.pos,r.refSeq,r.clientId,r.context,r.start,r.end,0);e.push(o)}r.pos+=s,r.start-=s,r.end-=s,r.childIndex++}else r.childIndex===r.block.childCount&&(r.op===da.Go&&r.actions.post&&r.actions.post(r),e.pop())}}nodeMap(e,t,r,i,s,o,a,l){var c;let u=a,d=l,h=r;u===void 0&&(u=0),d===void 0&&(d=this.blockLength(e,i,s));let f=!0;if(t.pre&&(f=t.pre(e,h,i,s,u,d,o),!f))return!0;const p=e.children;for(let g=0;g<e.childCount;g++){const S=p[g],m=(c=this.nodeLength(S,i,s))!==null&&c!==void 0?c:0;if(f&&d>0&&m>0&&u<m&&(S.isLeaf()?t.leaf&&(f=t.leaf(S,h,i,s,u,d,o)):f&&(f=this.nodeMap(S,t,h,i,s,o,u,d))),!f)break;t.shift&&t.shift(S,h,i,s,u,d,o),h+=m,u-=m,d-=m}return f&&t.post&&(f=t.post(e,h,i,s,u,d,o)),f}walkAllSegments(e,t,r){let i=!0;const s=e.children;for(let o=0;i&&o<e.childCount;o++){const a=s[o];i=a.isLeaf()?t(a,r):this.walkAllSegments(a,t,r)}return i}nodeMapReverse(e,t,r,i,s){let o=!0;const a=e.children;for(let l=e.childCount-1;l>=0;l--){const c=a[l];if(o&&(c.isLeaf()?o=t(c,r,i,s,0,0,void 0):o&&(o=this.nodeMapReverse(c,t,r,i,s))),!o)break}return o}}ct.zamboniSegmentsMaxCount=2;ct.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0};ct.theUnfinishedNode={childCount:-1};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Y7(n,e,t){const r=n.getId();if(r)return{combiningOp:t,props:e,relativePos1:{id:r,before:!0},relativePos2:{id:r},type:fe.ANNOTATE}}function zv(n,e,t,r){return{combiningOp:r,pos1:n,pos2:e,props:t,type:fe.ANNOTATE}}function $v(n,e){return{pos1:n,pos2:e,type:fe.REMOVE}}function Om(n,e){return Fk(n,e.toJSONObject())}function Fk(n,e){return{pos1:n,seg:e,type:fe.INSERT}}function dh(...n){return{ops:n,type:fe.GROUP}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Z7(n){return!!n&&typeof n=="object"&&"json"in n}function X_(n,e,t,r,i,s){let o;switch(e.version!==void 0&&t.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:e.version,toChunkVersion:void 0}),e.version){case void 0:o=e,o.headerMetadata=$k(n,o);break;case"1":const a=e,l=n===nt.header?a.headerMetadata:void 0;o={version:void 0,chunkStartSegmentIndex:a.startIndex,chunkLengthChars:a.length,chunkSegmentCount:a.segmentCount,segmentTexts:a.segments,totalLengthChars:l==null?void 0:l.totalLength,totalSegmentCount:l==null?void 0:l.totalSegmentCount,chunkSequenceNumber:l==null?void 0:l.sequenceNumber,chunkMinSequenceNumber:l==null?void 0:l.minSequenceNumber,headerMetadata:l};break;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}return i.stringify(o,s)}function Y_(n,e,t,r,i,s){const o=zk(n,e);return i.stringify(o,s)}function zk(n,e,t,r){switch(e.version){case void 0:{const i=e;return{version:"1",length:i.chunkLengthChars,segmentCount:i.chunkSegmentCount,headerMetadata:$k(n,i),segments:i.segmentTexts,startIndex:i.chunkStartSegmentIndex}}case"1":return e;default:throw new Error(`Unsupported chunk path: ${n} version: ${e.version}`)}}function $k(n,e,t){if(n===nt.header){if(e.headerMetadata!==void 0)return e.headerMetadata;const r=[{id:nt.header}];return e.chunkLengthChars<e.totalLengthChars&&r.push({id:nt.body}),{orderedChunkMetadata:r,minSequenceNumber:e.chunkMinSequenceNumber,sequenceNumber:e.chunkSequenceNumber,totalLength:e.totalLengthChars,totalSegmentCount:e.totalSegmentCount}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class nt{constructor(e,t,r,i){var s,o;this.mergeTree=e,this.filename=r,this.onCompletion=i,this.logger=pe.create(t,"Snapshot"),this.chunkSize=(o=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.mergeTreeSnapshotChunkSize)!==null&&o!==void 0?o:nt.sizeOfFirstChunk}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,a=0;for(;o<r&&i+a<e.length;){const l=e[i+a];s.push(l),o+=t[i+a],a++}return{version:void 0,chunkStartSegmentIndex:i,chunkSegmentCount:a,chunkLengthChars:o,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:e.length,chunkSequenceNumber:this.header.seq,segmentTexts:s}}emit(e,t,r){var i,s;const o=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize);let a=o.chunkLengthChars,l=o.chunkSegmentCount;const c=new tn;if(c.addBlob(nt.header,X_(nt.header,o,this.logger,this.mergeTree.options,t,r)),o.chunkSegmentCount<o.totalSegmentCount){const u=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.header.segmentsTotalLength,o.chunkSegmentCount);a+=u.chunkLengthChars,l+=u.chunkSegmentCount,c.addBlob(nt.body,X_(nt.body,u,this.logger,this.mergeTree.options,t,r))}return Q(a===this.header.segmentsTotalLength,93),Q(l===o.totalSegmentCount,94),e!==void 0&&e.length>0&&c.addBlob((s=(i=this.mergeTree.options)===null||i===void 0?void 0:i.catchUpBlobName)!==null&&s!==void 0?s:nt.catchupOps,t?t.stringify(e,r):JSON.stringify(e)),c.getSummaryTree()}extractSync(){const e=this.mergeTree.getCollabWindow();this.seq=e.minSeq,this.header={segmentsTotalLength:this.mergeTree.getLength(this.mergeTree.collabWindow.minSeq,Bs),seq:this.mergeTree.collabWindow.minSeq};const t=[];let r;const i=(o,a,l,c,u,d)=>(o.seq!==oe&&o.seq<=this.seq&&(o.removedSeq===void 0||o.removedSeq===oe||o.removedSeq>this.seq)&&(r!=null&&r.canAppend(o)&&eu(r.properties,o.properties)?(r=r.clone(),r.append(o.clone())):(r&&t.push(r),r=o)),!0);this.mergeTree.map({leaf:i},this.seq,Bs,void 0),r&&t.push(r),this.segments=[],this.segmentLengths=[];let s=0;return t.map(o=>{s+=o.cachedLength,this.segments.push(o.toJSONObject()),this.segmentLengths.push(o.cachedLength)}),this.header.segmentsTotalLength!==s&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:s,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=s),this.segments}}nt.header="header";nt.body="body";nt.catchupOps="catchupOps";nt.sizeOfFirstChunk=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class co{constructor(e,t,r,i,s){var o,a;this.mergeTree=e,this.getLongClientId=r,this.filename=i,this.onCompletion=s,this.logger=pe.create(t,"Snapshot"),this.chunkSize=(a=(o=e==null?void 0:e.options)===null||o===void 0?void 0:o.mergeTreeSnapshotChunkSize)!==null&&a!==void 0?a:co.chunkSize;const{currentSeq:l,minSeq:c}=e.getCollabWindow();this.header={minSequenceNumber:c,sequenceNumber:l,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[]}getSeqLengthSegs(e,t,r,i=0){const s=[];let o=0,a=0;for(;o<r&&i+a<e.length;){const l=e[i+a];s.push(l),o+=t[i+a],a++}return{version:"1",segmentCount:a,length:o,segments:s,startIndex:i,headerMetadata:void 0}}emit(e,t){const r=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{const a=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize,this.header.totalSegmentCount);r.push(a),this.header.totalSegmentCount+=a.segmentCount,this.header.totalLength+=a.length}while(this.header.totalSegmentCount<this.segments.length);const i=r.shift();i.headerMetadata=this.header,i.headerMetadata.orderedChunkMetadata=[{id:nt.header}];const s=[];r.forEach((a,l)=>{const c=`${nt.body}_${l}`;this.header.orderedChunkMetadata.push({id:c}),s.push([c,Y_(c,a,this.logger,this.mergeTree.options,e,t)])});const o=new tn;return o.addBlob(nt.header,Y_(nt.header,i,this.logger,this.mergeTree.options,e,t)),s.forEach(a=>{o.addBlob(a[0],a[1])}),o.getSummaryTree()}extractSync(){const e=this.mergeTree,t=this.header.minSequenceNumber,r=(a,l)=>{this.segments.push(a),this.segmentLengths.push(l)},i=a=>{a&&r(a.toJSONObject(),a.cachedLength)};let s;const o=a=>{var l;if(a.seq===oe||a.removedSeq<=t)return!0;if(a.seq<=t&&(a.removedSeq===void 0||a.removedSeq===oe))s?s.canAppend(a)&&eu(s.properties,a.properties)?(s=s.clone(),s.append(a.clone())):(i(s),s=a):s=a;else{i(s),s=void 0;const c={json:a.toJSONObject()};a.seq>t&&(c.seq=a.seq,c.client=this.getLongClientId(a.clientId)),a.removedSeq!==void 0&&(Q(a.removedSeq!==oe&&a.removedSeq>t,101),c.removedSeq=a.removedSeq,c.removedClient=a.removedClientIds!==void 0?this.getLongClientId(a.removedClientIds[0]):void 0,c.removedClientIds=(l=a.removedClientIds)===null||l===void 0?void 0:l.map(u=>this.getLongClientId(u))),Q(c.seq!==void 0&&c.client!==void 0||c.removedSeq!==void 0&&c.removedClient!==void 0,102),r(c,a.cachedLength)}return!0};return e.walkAllSegments(e.root,o,this),i(s),this.segments}static async loadChunk(e,t,r,i,s){const o=await e.readBlob(t),a=Fv(o,"utf8");return co.processChunk(t,a,r,i,s)}static processChunk(e,t,r,i,s){const o=s?s.parse(t):JSON.parse(t);return zk(e,o)}}co.chunkSize=1e4;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class eK{constructor(e,t,r,i,s){this.runtime=e,this.client=t,this.mergeTree=r,this.serializer=s,this.specToSegment=o=>{var a;let l;return Z7(o)?(l=this.client.specToSegment(o.json),l.clientId=o.client!==void 0?this.client.getOrAddShortClientId(o.client):Bs,l.seq=o.seq!==void 0?o.seq:Qt,o.removedSeq!==void 0&&(l.removedSeq=o.removedSeq),o.removedClient!==void 0&&(l.removedClientIds=[this.client.getOrAddShortClientId(o.removedClient)]),o.removedClientIds!==void 0&&(l.removedClientIds=(a=o.removedClientIds)===null||a===void 0?void 0:a.map(c=>this.client.getOrAddShortClientId(c)))):(l=this.client.specToSegment(o),l.seq=Qt,l.clientId=Bs),l},this.logger=pe.create(i,"SnapshotLoader")}async initialize(e){const t=e.readBlob(nt.header).then(i=>(Q(!!i,95),this.loadHeader(Fv(i,"utf8")))),r=this.loadBodyAndCatchupOps(t,e);return r.catch(i=>this.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},i)),await t,{catchupOpsP:r}}async loadBodyAndCatchupOps(e,t){const r=t.list(""),i=await e;await this.loadBody(i,t);const s=await r;if(s.length===i.headerMetadata.orderedChunkMetadata.length+1)return i.headerMetadata.orderedChunkMetadata.forEach(o=>s.splice(s.indexOf(o.id),1)),Q(s.length===1,96),this.loadCatchupOps(t.readBlob(s[0]));if(s.length!==i.headerMetadata.orderedChunkMetadata.length)throw new Error("Unexpected blobs in snapshot");return[]}loadHeader(e){var t;const r=co.processChunk(nt.header,e,this.logger,this.mergeTree.options,this.serializer),i=r.segments.map(this.specToSegment);if(this.mergeTree.reloadFromSegments(i),r.headerMetadata===void 0)throw new Error("header metadata not available");return this.runtime.attachState!==te.Detached&&this.client.startOrUpdateCollaboration((t=this.runtime.clientId)!==null&&t!==void 0?t:"snapshot",r.headerMetadata.minSequenceNumber!==void 0?r.headerMetadata.minSequenceNumber:r.headerMetadata.sequenceNumber,r.headerMetadata.sequenceNumber),r}async loadBody(e,t){if(Q(e.length<=e.headerMetadata.totalLength,97),Q(e.segmentCount<=e.headerMetadata.totalSegmentCount,98),e.segmentCount===e.headerMetadata.totalSegmentCount)return;const r=[];let i=e.length;for(let c=1;c<e.headerMetadata.orderedChunkMetadata.length;c++){const u=await co.loadChunk(t,e.headerMetadata.orderedChunkMetadata[c].id,this.logger,this.mergeTree.options,this.serializer);i+=u.length,r.push(...u.segments.map(this.specToSegment))}Q(i===e.headerMetadata.totalLength,99),Q(e.segmentCount+r.length===e.headerMetadata.totalSegmentCount,100);const s=this.mergeTree,o=(c,u,d)=>{s.insertSegments(s.root.cachedLength,c,Qt,u,d,void 0)},a=[],l=()=>{a.length>0&&o(a,Bs,Qt)};for(const c of r){const u=c.clientId,d=c.seq;u===Bs&&d===Qt?a.push(c):(l(),o([c],u,d))}l()}async loadCatchupOps(e){return JSON.parse(Fv(await e,"utf8"))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Z_=256;class bt extends mf{constructor(e){super(),this.text=e,this.type=bt.type,this.cachedLength=e.length}static is(e){return e.type===bt.type}static make(e,t){const r=new bt(e);return t&&r.addProperties(t),r}static fromJSONObject(e){if(typeof e=="string")return new bt(e);if(e&&typeof e=="object"&&"text"in e){const t=e;return bt.make(t.text,t.props)}}toJSONObject(){return this.properties?{text:this.text,props:this.properties}:this.text}clone(e=0,t){const r=this.text.substring(e,t),i=bt.make(r,this.properties);return this.cloneInto(i),i}canAppend(e){return!this.text.endsWith(`
`)&&bt.is(e)&&(this.cachedLength<=Z_||e.cachedLength<=Z_)}toString(){return this.text}append(e){if(bt.is(e))ii.append(this,e),this.text+=e.text,this.cachedLength=this.text.length;else throw new Error("can only append text segment")}removeRange(e,t){let r="";const i=this.text.length;return e>0&&(r+=this.text.substring(0,e)),t<i&&(r+=this.text.substring(t)),this.text=r,this.cachedLength=r.length,r.length===0}createSplitSegmentAt(e){if(e>0){const t=this.text.substring(e);return this.text=this.text.substring(0,e),this.cachedLength=this.text.length,new bt(t)}}}bt.type="TextSegment";function e1(n){return n.parallelArrays===!0}class tK{constructor(e){this.mergeTree=e,this.gatherText=(t,r,i,s,o,a,l)=>{var c,u;let d=o;if(bt.is(t)){let h="",f="";if(e1(l)){const p=[],g=[];!((c=t.properties)===null||c===void 0)&&c["font-weight"]&&p.push("b"),!((u=t.properties)===null||u===void 0)&&u["text-decoration"]&&p.push("u");const S=[];if(p.length>0){for(const m of p)l.tagsInProgress.includes(m)||(h+=`<${m}>`,g.push(m));for(const m of l.tagsInProgress)p.includes(m)||(f+=`</${m}>`,S.push(m));for(const m of g.reverse())l.tagsInProgress.push(m)}else for(const m of l.tagsInProgress)f+=`</${m}>`,S.push(m);for(const m of S){const v=l.tagsInProgress.indexOf(m);v>=0&&l.tagsInProgress.splice(v,1)}}l.textSegment.text+=f,l.textSegment.text+=h,d<=0&&a>=t.text.length?l.textSegment.text+=t.text:(d<0&&(d=0),a>=t.text.length?l.textSegment.text+=t.text.substring(d):l.textSegment.text+=t.text.substring(d,a))}else if(l.placeholder&&l.placeholder.length>0)if(l.placeholder==="*"){const h=t;l.textSegment.text+=`
${h.toString()}`}else for(let h=0;h<t.cachedLength;h++)l.textSegment.text+=l.placeholder;else if(e1(l)){const h=t;h.hasTileLabel(l.parallelMarkerLabel)&&(l.parallelMarkers.push(h),l.parallelText.push(l.textSegment.text),l.textSegment.text="")}return!0}}getTextAndMarkers(e,t,r,i,s){const o=this.getValidRange(i,s,e,t),a={parallelArrays:!0,parallelMarkerLabel:r,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new bt("")};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),{parallelText:a.parallelText,parallelMarkers:a.parallelMarkers}}getText(e,t,r="",i,s){const o=this.getValidRange(i,s,e,t),a={textSegment:new bt(""),placeholder:r};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),a.textSegment.text}getValidRange(e,t,r,i){return{end:t??this.mergeTree.getLength(r,i),start:e??0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Fu(n){return n.trace().duration*1e3}class kS{constructor(e,t,r){this.specToSegment=e,this.logger=t,this.measureOps=!1,this.accumTime=0,this.localTime=0,this.localOps=0,this.accumWindowTime=0,this.accumWindow=0,this.accumOps=0,this.maxWindowTime=0,this.clientNameToIds=new Pc(W7),this.shortClientIdMap=[],this.pendingConsensus=new Map,this.mergeTree=new ct(r)}get mergeTreeDeltaCallback(){return this.mergeTree.mergeTreeDeltaCallback}set mergeTreeDeltaCallback(e){this.mergeTree.mergeTreeDeltaCallback=e}get mergeTreeMaintenanceCallback(){return this.mergeTree.mergeTreeMaintenanceCallback}set mergeTreeMaintenanceCallback(e){this.mergeTree.mergeTreeMaintenanceCallback=e}peekPendingSegmentGroups(e=1){var t,r;if(e===1)return(t=this.mergeTree.pendingSegments)===null||t===void 0?void 0:t.last();let i=0;return(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.some(()=>i<e?(i++,!0):!1,!0)}annotateMarkerNotifyConsensus(e,t,r){const i={name:"consensus"},s=this.annotateMarker(e,t,i);if(s){const o={callback:r,marker:e};return this.pendingConsensus.set(e.getId(),o),s}else return}annotateMarker(e,t,r){const i=Y7(e,t,r);if(this.applyAnnotateRangeOp({op:i}))return i}annotateRangeLocal(e,t,r,i){const s=zv(e,t,r,i);if(this.applyAnnotateRangeOp({op:s}))return s}removeRangeLocal(e,t){const r=$v(e,t);if(this.applyRemoveRangeOp({op:r}))return r}insertSegmentLocal(e,t){if(t.cachedLength<=0)return;const r=Om(e,t);if(this.applyInsertOp({op:r}))return r}insertAtReferencePositionLocal(e,t){const r=this.mergeTree.referencePositionToLocalPosition(e,this.getCurrentSeq(),this.getClientId());if(r===yo.DetachedPosition)return;const i=Om(r,t),s={op:i};let o;return this.measureOps&&(o=Ro.start()),this.mergeTree.insertAtReferencePosition(e,t,s),this.completeAndLogOp(s,this.getClientSequenceArgs(s),{start:i.pos1},o),i}walkSegments(e,t,r,i,s=!1){this.mergeTree.mapRange({leaf:e},this.getCurrentSeq(),this.getClientId(),i,t,r,s)}serializeGCData(e,t){this.mergeTree.walkAllSegments(this.mergeTree.root,r=>(r.removedSeq===void 0&&t.stringify(r.clone().toJSONObject(),e),!0))}getCollabWindow(){return this.mergeTree.getCollabWindow()}getPosition(e){return(e==null?void 0:e.parent)===void 0?-1:this.mergeTree.getPosition(e,this.getCurrentSeq(),this.getClientId())}addLocalReference(e){return this.mergeTree.addLocalReference(e)}removeLocalReference(e){return this.removeLocalReferencePosition(e)}createLocalReferencePosition(e,t,r,i){return this.mergeTree.createLocalReferencePosition(e,t,r,i,this)}removeLocalReferencePosition(e){return this.mergeTree.removeLocalReferencePosition(e)}localReferencePositionToPosition(e){return this.mergeTree.referencePositionToLocalPosition(e)}posFromRelativePos(e){return this.mergeTree.posFromRelativePos(e)}getMarkerFromId(e){return this.mergeTree.getMarkerFromId(e)}applyRemoveRangeOp(e){Q(e.op.type===fe.REMOVE,45);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=Ro.start()),this.mergeTree.markRangeRemoved(i.start,i.end,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,!1,e),this.completeAndLogOp(e,r,i,s),!0}applyAnnotateRangeOp(e){Q(e.op.type===fe.ANNOTATE,46);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;return this.measureOps&&(s=Ro.start()),this.mergeTree.annotateRange(i.start,i.end,t.props,t.combiningOp,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,s),!0}applyInsertOp(e){Q(e.op.type===fe.INSERT,47);const t=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(t,r);if(!i)return!1;let s;if(t.seg&&(s=[this.specToSegment(t.seg)]),!s||s.length===0)return!1;let o;return this.measureOps&&(o=Ro.start()),this.mergeTree.insertSegments(i.start,s,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,o),!0}completeAndLogOp(e,t,r,i){e.sequencedMessage?(Q(this.mergeTree.getCollabWindow().currentSeq<t.sequenceNumber,48),Q(this.mergeTree.getCollabWindow().minSeq<=e.sequencedMessage.minimumSequenceNumber,49),i&&(this.accumTime+=Fu(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)):i&&(this.localTime+=Fu(i),this.localOps++)}getValidOpRange(e,t){let r=e.pos1;r===void 0&&e.relativePos1&&(r=this.mergeTree.posFromRelativePos(e.relativePos1,t.referenceSequenceNumber,t.clientId));let i=e.pos2;if(i===void 0&&e.relativePos2&&(i=this.mergeTree.posFromRelativePos(e.relativePos2,t.referenceSequenceNumber,t.clientId)),t.clientId===this.getClientId()){const s=this.getLength(),o=[];if((r===void 0||r<0||r>s||r===s&&e.type!==fe.INSERT)&&o.push("start"),(e.type!==fe.INSERT||i!==void 0)&&(i===void 0||i<=r)&&o.push("end"),o.length>0)throw new ue("RangeOutOfBounds",{usageError:!0,end:i,invalidPositions:o.toString(),length:s,opPos1:e.pos1,opPos1Relative:e.relativePos1!==void 0,opPos2:e.pos2,opPos2Relative:e.relativePos2!==void 0,opType:e.type,start:r})}return{start:r,end:i}}getClientSequenceArgsForMessage(e){if(e)return{clientId:this.getOrAddShortClientId(e.clientId),referenceSequenceNumber:e.referenceSequenceNumber,sequenceNumber:e.sequenceNumber};{const t=this.getCollabWindow();return{clientId:t.clientId,referenceSequenceNumber:t.currentSeq,sequenceNumber:this.getLocalSequenceNumber()}}}getClientSequenceArgs(e){return this.getClientSequenceArgsForMessage(e.sequencedMessage)}ackPendingSegment(e){const t=r=>{let i;this.measureOps&&(i=Ro.start()),this.mergeTree.ackPendingSegment(r),r.op.type===fe.ANNOTATE&&r.op.combiningOp&&r.op.combiningOp.name==="consensus"&&this.updateConsensusProperty(r.op,r.sequencedMessage),i&&(this.accumTime+=Fu(i),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)};if(e.op.type===fe.GROUP)for(const r of e.op.ops)t({groupOp:e.op,op:r,sequencedMessage:e.sequencedMessage});else t(e)}cloneFromSegments(){const e=new kS(this.specToSegment,this.logger,this.mergeTree.options),t=[],r=this.mergeTree.blockClone(this.mergeTree.root,t);return e.mergeTree.root=r,e}getOrAddShortClientId(e){return this.clientNameToIds.get(e)||this.addLongClientId(e),this.getShortClientId(e)}getShortClientId(e){return this.clientNameToIds.get(e).data}getLongClientId(e){return e>=0?this.shortClientIdMap[e]:"original"}addLongClientId(e){this.clientNameToIds.put(e,this.shortClientIdMap.length),this.shortClientIdMap.push(e)}findReconnectionPosition(e,t){Q(t<=this.mergeTree.collabWindow.localSeq,50);let r=0;return this.mergeTree.walkAllSegments(this.mergeTree.root,i=>i===e?!1:((i.localSeq===void 0||i.localSeq<=t)&&(i.removedSeq===void 0||i.localRemovedSeq>t)&&(r+=i.cachedLength),!0)),r}rebasePosition(e,t,r){Q(r<=this.mergeTree.collabWindow.localSeq,768);let i,s=0,o=e;const a=u=>u.seq!==void 0&&u.seq!==oe&&u.seq<=t||u.localSeq!==void 0&&u.localSeq<=r,l=({removedSeq:u,localRemovedSeq:d})=>u!==void 0&&u!==oe&&u<=t||d!==void 0&&d<=r;this.mergeTree.walkAllSegments(this.mergeTree.root,u=>(Q(u.seq!==void 0||u.localSeq!==void 0,769),i=u,a(u)&&!l(u)&&(s+=u.cachedLength,o>=u.cachedLength&&(o-=u.cachedLength)),s<=e)),Q(i!==void 0,770);const c=this.getCollabWindow().currentSeq;return(i.removedSeq!==void 0&&i.removedSeq!==oe&&i.removedSeq<=c||i.localRemovedSeq!==void 0&&i.localRemovedSeq<=r)&&(o=0),Q(0<=o&&o<i.cachedLength,771),this.findReconnectionPosition(i,r)+o}resetPendingDeltaToOps(e,t){var r,i;Q(!!t,51);const s=(r=this.mergeTree.pendingSegments)===null||r===void 0?void 0:r.dequeue();Q(t===s,52);const o=[];for(const a of t.segments.sort((l,c)=>l.ordinal<c.ordinal?-1:1)){const l=a.segmentGroups.dequeue();Q(t===l,53);const c=this.findReconnectionPosition(a,t.localSeq);let u;switch(e.type){case fe.ANNOTATE:Q(((i=a.propertyManager)===null||i===void 0?void 0:i.hasPendingProperties())===!0,54),(a.removedSeq===void 0||a.localRemovedSeq!==void 0)&&(u=zv(c,c+a.cachedLength,e.props,e.combiningOp));break;case fe.INSERT:Q(a.seq===oe,55);let d=a;typeof e.seg=="object"&&e.seg.props!==void 0&&(d=a.clone(),d.properties=e.seg.props),u=Om(c,d);break;case fe.REMOVE:a.localRemovedSeq!==void 0&&(u=$v(c,c+a.cachedLength));break;default:throw new Error("Invalid op type")}if(u){const d={segments:[],localSeq:t.localSeq};a.segmentGroups.enqueue(d),this.mergeTree.pendingSegments.enqueue(d),o.push(u)}}return o}applyRemoteOp(e){const t=e.op,r=e.sequencedMessage;switch(this.getOrAddShortClientId(r.clientId),t.type){case fe.INSERT:this.applyInsertOp(e);break;case fe.REMOVE:this.applyRemoveRangeOp(e);break;case fe.ANNOTATE:this.applyAnnotateRangeOp(e);break;case fe.GROUP:{for(const i of t.ops)this.applyRemoteOp({op:i,groupOp:t,sequencedMessage:r});break}}}applyStashedOp(e){let t;switch(e.type){case fe.INSERT:this.applyInsertOp({op:e}),t=this.peekPendingSegmentGroups();break;case fe.REMOVE:this.applyRemoveRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case fe.ANNOTATE:this.applyAnnotateRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case fe.GROUP:return e.ops.map(r=>this.applyStashedOp(r));default:x7(e,"unrecognized op type")}return Q(!!t,731),t}applyMsg(e,t=!1){var r;if(this.getOrAddShortClientId(e.clientId),e.type===Dv.Operation){const i={op:e.contents,sequencedMessage:e};((r=i.sequencedMessage)===null||r===void 0?void 0:r.clientId)===this.longClientId||t?this.ackPendingSegment(i):this.applyRemoteOp(i)}this.updateSeqNumbers(e.minimumSequenceNumber,e.sequenceNumber)}updateSeqNumbers(e,t){const r=this.mergeTree.getCollabWindow();Q(r.currentSeq<=t,56),r.currentSeq=t,Q(e<=t,57),this.updateMinSeq(e)}resolveRemoteClientPosition(e,t,r){const i=this.getOrAddShortClientId(r);return this.mergeTree.resolveRemoteClientPosition(e,t,i)}regeneratePendingOp(e,t){const r=[];if(e.type===fe.GROUP)if(Array.isArray(t)){Q(e.ops.length===t.length,58);for(let i=0;i<e.ops.length;i++)r.push(...this.resetPendingDeltaToOps(e.ops[i],t[i]))}else Q(e.ops.length===1,59),r.push(...this.resetPendingDeltaToOps(e.ops[0],t));else Q(e.type!==fe.GROUP,60),Q(!Array.isArray(t),61),r.push(...this.resetPendingDeltaToOps(e,t));return r.length===1?r[0]:dh(...r)}createTextHelper(){return new tK(this.mergeTree)}summarize(e,t,r,i){var s;const o=e.deltaManager,a=o.minimumSequenceNumber;if(this.updateSeqNumbers(a,o.lastSequenceNumber),Q(this.getCollabWindow().minSeq===a,62),((s=this.mergeTree.options)===null||s===void 0?void 0:s.newMergeTreeSnapshotFormat)===!0){Q(i===void 0||i.length===0,63);const l=new co(this.mergeTree,this.logger,c=>this.getLongClientId(c));return l.extractSync(),l.emit(r,t)}else{const l=new nt(this.mergeTree,this.logger);return l.extractSync(),l.emit(i,r,t)}}async load(e,t,r){return new eK(e,this,this.mergeTree,this.logger,r).initialize(t)}getStackContext(e,t){return this.mergeTree.getStackContext(e,this.getCollabWindow().clientId,t)}getLocalSequenceNumber(){return this.getCollabWindow().collaborating?oe:Qt}localTransaction(e){for(const t of e.ops){const r={op:t,groupOp:e};switch(t.type){case fe.INSERT:this.applyInsertOp(r);break;case fe.ANNOTATE:this.applyAnnotateRangeOp(r);break;case fe.REMOVE:this.applyRemoveRangeOp(r);break}}}updateConsensusProperty(e,t){const r=e.relativePos1.id,i=this.pendingConsensus.get(r);i&&i.marker.addProperties(e.props,e.combiningOp,t.sequenceNumber),this.mergeTree.addMinSeqListener(t.sequenceNumber,()=>i.callback(i.marker))}updateMinSeq(e){let t;if(this.measureOps&&(t=Ro.start()),this.mergeTree.setMinSeq(e),t){const r=Fu(t);this.accumWindowTime+=r,r>this.maxWindowTime&&(this.maxWindowTime=r)}}getContainingSegment(e,t){const r=this.getClientSequenceArgsForMessage(t);return this.mergeTree.getContainingSegment(e,r.referenceSequenceNumber,r.clientId)}getSlideToSegment(e){return this.mergeTree._getSlideToSegment(e)}getPropertiesAtPosition(e){let t;const i=this.getContainingSegment(e).segment;return i&&(t=i.properties),t}getRangeExtentsOfPosition(e){let t,r;const s=this.getContainingSegment(e).segment;return s&&(t=this.getPosition(s),r=t+s.cachedLength),{posStart:t,posAfterEnd:r}}getCurrentSeq(){return this.getCollabWindow().currentSeq}getClientId(){return this.getCollabWindow().clientId}getLength(){return this.mergeTree.length}startOrUpdateCollaboration(e,t=0,r=0){if(e!==void 0)if(this.longClientId===void 0)this.longClientId=e,this.addLongClientId(this.longClientId),this.mergeTree.startCollaboration(this.getShortClientId(this.longClientId),t,r);else{const i=this.longClientId,s=this.clientNameToIds.get(i).data;this.longClientId=e,this.clientNameToIds.put(e,s),this.shortClientIdMap[s]=e}}findTile(e,t,r=!0){const i=this.getClientId();return this.mergeTree.findTile(e,i,t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var nK=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const jt="intervalId";var sr;(function(n){n[n.Simple=0]="Simple",n[n.Nest=1]="Nest",n[n.SlideOnRemove=2]="SlideOnRemove",n[n.Transient=4]="Transient"})(sr||(sr={}));function rK(n,e){return{start:n[0],end:n[1],sequenceNumber:n[2],intervalType:n[3],properties:Object.assign(Object.assign({},n[4]),{[tu]:e})}}function iK(n){const{start:e,end:t,sequenceNumber:r,intervalType:i,properties:s}=n;return[e,t,r,i,Object.assign(Object.assign({},s),{[tu]:void 0})]}class ha{constructor(e,t,r){this.start=e,this.end=t,this.propertyManager=new Ra,this.properties={},r&&this.addProperties(r)}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[jt];if(t!==void 0)return`${t}`}getAdditionalPropertySets(){return this.auxProps}addPropertySet(e){this.auxProps===void 0&&(this.auxProps=[]),this.auxProps.push(e)}serialize(e){let t=0;e&&(t=e.getCurrentSeq());const r={end:this.end,intervalType:0,sequenceNumber:t,start:this.start};return this.properties&&(r.properties=this.properties),r}clone(){return new ha(this.start,this.end,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start-e.start}compareEnd(e){return this.end-e.end}overlaps(e){return this.start<=e.end&&this.end>=e.start}union(e){return new ha(Math.min(this.start,e.start),Math.max(this.end,e.end),this.properties)}getProperties(){return this.properties}addProperties(e,t=!1,r,i){if(e)return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}modify(e,t,r,i){const s=t??this.start,o=r??this.end;if(this.start===s&&this.end===o)return;const a=new ha(s,o);return this.properties&&(a.initializeProperties(),this.propertyManager.copyTo(this.properties,a.properties,a.propertyManager)),a}initializeProperties(){this.propertyManager||(this.propertyManager=new Ra),this.properties||(this.properties=Zt())}}class si{constructor(e,t,r,i){this.start=e,this.end=t,this.intervalType=r,this.propertyManager=new Ra,this.properties={},i&&this.addProperties(i)}addPositionChangeListeners(e,t){var r,i,s,o;if(this.callbacks===void 0){this.callbacks={beforePositionChange:e,afterPositionChange:t};const a=(r=(s=this.start).callbacks)!==null&&r!==void 0?r:s.callbacks={},l=(i=(o=this.end).callbacks)!==null&&i!==void 0?i:o.callbacks={};a.beforeSlide=l.beforeSlide=e,a.afterSlide=l.afterSlide=t}}removePositionChangeListeners(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}serialize(e){const t=this.start.toPosition(),i={end:this.end.toPosition(),intervalType:this.intervalType,sequenceNumber:e.getCurrentSeq(),start:t};return this.properties&&(i.properties=this.properties),i}clone(){return new si(this.start,this.end,this.intervalType,this.properties)}compare(e){const t=this.compareStart(e);if(t===0){const r=this.compareEnd(e);if(r===0){const i=this.getIntervalId();if(i){const s=e.getIntervalId();return s?i>s?1:i<s?-1:0:0}return 0}else return r}else return t}compareStart(e){return this.start.compare(e.start)}compareEnd(e){return this.end.compare(e.end)}overlaps(e){return this.start.compare(e.end)<=0&&this.end.compare(e.start)>=0}getIntervalId(){var e;const t=(e=this.properties)===null||e===void 0?void 0:e[jt];if(t!==void 0)return`${t}`}union(e){return new si(this.start.min(e.start),this.end.max(e.end),this.intervalType)}addProperties(e,t=!1,r,i){return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,i,r,t)}overlapsPos(e,t){const r=this.start.toPosition();return this.start.toPosition()>e&&r<t}modify(e,t,r,i){const s=c=>{let u=c;return i===void 0&&(u&=~ne.SlideOnRemove,u|=ne.StayOnRemove),u};let o=this.start;t!==void 0&&(o=hh(this.start.getClient(),t,s(this.start.refType),i),o.addProperties(this.start.properties));let a=this.end;r!==void 0&&(a=hh(this.end.getClient(),r,s(this.end.refType),i),a.addProperties(this.end.properties)),o.pairedRef=a,a.pairedRef=o;const l=new si(o,a,this.intervalType);return this.properties&&(l.initializeProperties(),this.propertyManager.copyTo(this.properties,l.properties,l.propertyManager)),l}initializeProperties(){this.propertyManager||(this.propertyManager=new Ra),this.properties||(this.properties=Zt())}}function jv(n,e,t,r){if(e.segment)return n.createLocalReferencePosition(e.segment,e.offset,t,void 0);if(!r&&!Xe(t,ne.Transient))throw new Te("Non-transient references need segment");return new yo(n,void 0,0,t)}function hh(n,e,t,r){let i;return r?(On((t&ne.SlideOnRemove)!==0,757),i=n.getContainingSegment(e,r),i=n.getSlideToSegment(i)):(On((t&ne.SlideOnRemove)===0,758),i=n.getContainingSegment(e)),jv(n,i,t,r)}function sK(n,e,t,r,i,s){let o=ne.RangeBegin,a=ne.RangeEnd;i===sr.Transient?(o=ne.Transient,a=ne.Transient):(i===sr.Nest&&(o=ne.NestBegin,a=ne.NestEnd),s?(o|=ne.SlideOnRemove,a|=ne.SlideOnRemove):(o|=ne.StayOnRemove,a|=ne.StayOnRemove));const l=hh(r,e,o,s),c=hh(r,t,a,s);l.pairedRef=c,c.pairedRef=l;const u={[tu]:[n]};return l.addProperties(u),c.addProperties(u),new si(l,c,i,u)}class gf{constructor(e,t,r,i){this.client=e,this.label=t,this.helpers=r,this.onPositionChange=i,this.intervalTree=new P7,this.intervalIdMap=new Map,this.endIntervalTree=new Pc(r.compareEnds)}addConflictResolver(e){this.conflictResolver=e,this.endConflictResolver=(t,r)=>{const i=e(t,r);return{data:i,key:i}}}map(e){this.intervalTree.map(e)}createLegacyId(e,t){return`${gf.legacyIdPrefix}${e}-${t}`}ensureSerializedId(e){var t;let r=(t=e.properties)===null||t===void 0?void 0:t[jt];if(r===void 0){r=this.createLegacyId(e.start,e.end);const i={[jt]:r};e.properties=Ik(e.properties,i)}return Object.defineProperty(e.properties,jt,{configurable:!1,enumerable:!0,writable:!1}),r}mapUntil(e){this.intervalTree.mapUntil(e)}gatherIterationResults(e,t,r,i){if(!this.intervalTree.intervals.isEmpty())if(r===void 0&&i===void 0)t?this.intervalTree.map(s=>{e.push(s)}):this.intervalTree.mapBackward(s=>{e.push(s)});else{const s=this.helpers.create("transient",r,i,this.client,sr.Transient);if(r===void 0)t?this.intervalTree.map(o=>{s.compareEnd(o)===0&&e.push(o)}):this.intervalTree.mapBackward(o=>{s.compareEnd(o)===0&&e.push(o)});else{const o=i===void 0?u=>s.compareStart(u.key):u=>s.compare(u.key),a=u=>u<=0,l=u=>u>=0,c=u=>{e.push(u.key)};t?this.intervalTree.intervals.walkExactMatchesForward(o,c,a,l):this.intervalTree.intervals.walkExactMatchesBackward(o,c,a,l)}}}findOverlappingIntervals(e,t){if(t<e||this.intervalTree.intervals.isEmpty())return[];const r=this.helpers.create("transient",e,t,this.client,sr.Transient);return this.intervalTree.match(r).map(s=>s.key)}previousInterval(e){const t=this.helpers.create("transient",e,e,this.client,sr.Transient),r=this.endIntervalTree.floor(t);if(r)return r.data}nextInterval(e){const t=this.helpers.create("transient",e,e,this.client,sr.Transient),r=this.endIntervalTree.ceil(t);if(r)return r.data}removeInterval(e,t){const r=this.helpers.create("transient",e,t,this.client,sr.Transient);return this.intervalTree.remove(r),this.endIntervalTree.remove(r),r}removeIntervalFromIndex(e){this.intervalTree.removeExisting(e),this.endIntervalTree.remove(e);const t=e.getIntervalId();On(t!==void 0,785),this.intervalIdMap.delete(t)}removeExistingInterval(e){this.removeIntervalFromIndex(e),this.removeIntervalListeners(e)}createInterval(e,t,r,i){return this.helpers.create(this.label,e,t,this.client,r,i)}addInterval(e,t,r,i,s){const o=this.createInterval(e,t,r,s);return o&&(o.properties||(o.properties=Zt()),i&&o.addProperties(i),o.properties[jt]===void 0&&(o.properties[jt]=ot()),this.add(o)),o}addIntervalToIndex(e){const t=e.getIntervalId();On(t!==void 0,704),Object.defineProperty(e.properties,jt,{configurable:!1,enumerable:!0,writable:!1}),this.intervalTree.put(e,this.conflictResolver),this.endIntervalTree.put(e,e,this.endConflictResolver),this.intervalIdMap.set(t,e)}add(e){this.addIntervalToIndex(e),this.addIntervalListeners(e)}getIntervalById(e){return this.intervalIdMap.get(e)}changeInterval(e,t,r,i){const s=e.modify(this.label,t,r,i);return s&&(this.removeExistingInterval(e),this.add(s)),s}serialize(){const e=this.client,t=this.intervalTree.intervals.keys();return{label:this.label,intervals:t.map(r=>iK(r.serialize(e))),version:2}}addIntervalListeners(e){e instanceof si&&e.addPositionChangeListeners(()=>this.removeIntervalFromIndex(e),()=>{var t;this.addIntervalToIndex(e),(t=this.onPositionChange)===null||t===void 0||t.call(this,e)})}removeIntervalListeners(e){e instanceof si&&e.removePositionChangeListeners()}}gf.legacyIdPrefix="legacy";const oK=(n,e)=>n.end.compare(e.end);class aK{load(e,t=[]){const r={compareEnds:oK,create:sK};return new NS(r,!0,e,t)}store(e){return e.serializeInternal()}}class ns{get name(){return ns.Name}get factory(){return ns._factory}get ops(){return ns._ops}}ns.Name="sharedStringIntervalCollection";ns._factory=new aK;ns._ops=jk();const lK=(n,e)=>n.end-e.end;function cK(n,e,t,r){const i={};return n&&n.length>0&&(i[tu]=[n]),new ha(e,t,i)}class uK{load(e,t=[]){const r={compareEnds:lK,create:cK},i=new NS(r,!1,e,t);return i.attachGraph(void 0,""),i}store(e){return e.serializeInternal()}}class rs{get name(){return rs.Name}get factory(){return rs._factory}get ops(){return rs._ops}}rs.Name="sharedIntervalCollection";rs._factory=new uK;rs._ops=jk();function jk(){const n=(e,t,r)=>{const{localSeq:i}=r,s=e.rebaseLocalInterval(t.opName,t.value,i);return{rebasedOp:Object.assign(Object.assign({},t),{value:s}),rebasedLocalOpMetadata:r}};return new Map([["add",{process:(e,t,r,i)=>{e.ackAdd(t,r,i)},rebase:n}],["delete",{process:(e,t,r,i)=>{e.ackDelete(t,r,i)},rebase:(e,t,r)=>({rebasedOp:t,rebasedLocalOpMetadata:r})}],["change",{process:(e,t,r,i)=>{e.ackChange(t,r,i)},rebase:n}]])}class Mo{constructor(e,t=!0,r,i){this.results=[],this.index=0,e.gatherIterationResults(this.results,t,r,i)}next(){let e,t=!0;return this.index<this.results.length&&(e=this.results[this.index++],t=!1),{value:e,done:t}}}class NS extends Ok{constructor(e,t,r,i){super(),this.helpers=e,this.requiresClient=t,this.emitter=r,this.pendingChangesStart=new Map,this.pendingChangesEnd=new Map,Array.isArray(i)?this.savedSerializedIntervals=i:this.savedSerializedIntervals=i.intervals.map(s=>rK(s,i.label))}get attached(){return!!this.localCollection}attachGraph(e,t){if(this.attached)throw new ue("Only supports one Sequence attach");if(e===void 0&&this.requiresClient)throw new ue("Client required for this collection");if(this.client=e,this.localCollection=new gf(e,t,this.helpers,r=>this.emit("changeInterval",r,!0,void 0)),this.savedSerializedIntervals)for(const r of this.savedSerializedIntervals)this.localCollection.ensureSerializedId(r),this.localCollection.addInterval(r.start,r.end,r.intervalType,r.properties);this.savedSerializedIntervals=void 0}getNextLocalSeq(){return++this.client.getCollabWindow().localSeq}getIntervalById(e){if(!this.attached)throw new ue("attach must be called before accessing intervals");return this.localCollection.getIntervalById(e)}add(e,t,r,i){var s,o;if(!this.attached)throw new ue("attach must be called prior to adding intervals");if(r&sr.Transient)throw new ue("Can not add transient intervals");const a=this.localCollection.addInterval(e,t,r,i);if(a){const l={end:t,intervalType:r,properties:a.properties,sequenceNumber:(o=(s=this.client)===null||s===void 0?void 0:s.getCurrentSeq())!==null&&o!==void 0?o:0,start:e};this.emitter.emit("add",void 0,l,{localSeq:this.getNextLocalSeq()})}return this.emit("addInterval",a,!0,void 0),a}deleteExistingInterval(e,t,r){this.localCollection.removeExistingInterval(e),e&&(t?this.emitter.emit("delete",void 0,e.serialize(this.client),{localSeq:this.getNextLocalSeq()}):this.onDeserialize&&this.onDeserialize(e)),this.emit("deleteInterval",e,t,r)}removeIntervalById(e){const t=this.localCollection.getIntervalById(e);return t&&this.deleteExistingInterval(t,!0,void 0),t}changeProperties(e,t){if(!this.attached)throw new ue("Attach must be called before accessing intervals");if(typeof e!="string")throw new ue("Change API requires an ID that is a string");if(!t)throw new ue("changeProperties should be called with a property set");const r=this.getIntervalById(e);if(r){const i=r.addProperties(t,!0,oe),s=r.serialize(this.client);s.start=void 0,s.end=void 0,s.properties=t,s.properties[jt]=r.getIntervalId(),this.emitter.emit("change",void 0,s,{localSeq:this.getNextLocalSeq()}),this.emit("propertyChanged",r,i)}this.emit("changeInterval",r,!0,void 0)}change(e,t,r){if(!this.attached)throw new ue("Attach must be called before accessing intervals");if(typeof e!="string")throw new ue("Change API requires an ID that is a string");const i=this.getIntervalById(e);if(i){const s=this.localCollection.changeInterval(i,t,r),o=i.serialize(this.client);return o.start=t,o.end=r,o.properties={[jt]:i.getIntervalId()},this.emitter.emit("change",void 0,o,{localSeq:this.getNextLocalSeq()}),this.addPendingChange(e,o),this.emit("changeInterval",s,!0,void 0),s}}addPendingChange(e,t){t.start!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesStart,t),t.end!==void 0&&this.addPendingChangeHelper(e,this.pendingChangesEnd,t)}addPendingChangeHelper(e,t,r){let i=t.get(e);i||(i=[],t.set(e,i)),i.push(r)}removePendingChange(e){var t;const r=(t=e.properties)===null||t===void 0?void 0:t[jt];e.start!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesStart,e),e.end!==void 0&&this.removePendingChangeHelper(r,this.pendingChangesEnd,e)}removePendingChangeHelper(e,t,r){const i=t.get(e);if(i){const s=i.shift();if(i.length===0&&t.delete(e),(s==null?void 0:s.start)!==r.start||(s==null?void 0:s.end)!==r.end)throw new ue("Mismatch in pending changes")}}hasPendingChangeStart(e){const t=this.pendingChangesStart.get(e);return t&&t.length!==0}hasPendingChangeEnd(e){const t=this.pendingChangesEnd.get(e);return t&&t.length!==0}changeInterval(e,t,r){return this.ackChange(e,t,r)}ackChange(e,t,r){var i,s,o,a;if(!this.attached)throw new ue("Attach must be called before accessing intervals");let l;if(t){this.removePendingChange(e);const c=(i=e.properties)===null||i===void 0?void 0:i[jt];l=this.getIntervalById(c),l&&((s=l.propertyManager)===null||s===void 0||s.ackPendingProperties({type:fe.ANNOTATE,props:(o=e.properties)!==null&&o!==void 0?o:{}}),this.ackInterval(l,r))}else{const c=e.properties,u=jt,d=c[u],h=nK(c,[u+""]);if(l=this.getIntervalById(d),l){let f,p;this.hasPendingChangeStart(d)||(f=e.start),this.hasPendingChangeEnd(d)||(p=e.end),(f!==void 0||p!==void 0)&&(l=(a=this.localCollection.changeInterval(l,f,p,r))!==null&&a!==void 0?a:l);const g=l.addProperties(h,!0,r.sequenceNumber);this.onDeserialize&&this.onDeserialize(l),this.emit("propertyChanged",l,g)}}l&&this.emit("changeInterval",l,t,r)}addConflictResolver(e){if(!this.attached)throw new ue("attachSequence must be called");this.localCollection.addConflictResolver(e)}attachDeserializer(e){e&&(this.onDeserialize=e,this.localCollection.map(t=>{e(t)}))}rebaseLocalInterval(e,t,r){var i,s;if(!this.attached)throw new ue("attachSequence must be called");const{start:o,end:a,intervalType:l,properties:c,sequenceNumber:u}=t,d=o===void 0?void 0:this.client.rebasePosition(o,u,r),h=a===void 0?void 0:this.client.rebasePosition(a,u,r),f=c==null?void 0:c[jt],p={start:d,end:h,intervalType:l,sequenceNumber:(s=(i=this.client)===null||i===void 0?void 0:i.getCurrentSeq())!==null&&s!==void 0?s:0,properties:c};return e==="change"&&(this.hasPendingChangeStart(f)||this.hasPendingChangeEnd(f))&&(this.removePendingChange(t),this.addPendingChange(f,p)),p}getSlideToSegment(e){const t={segment:e.segment,offset:e.offset},r=this.client.getSlideToSegment(t);return t.segment===r.segment&&t.offset===r.offset?void 0:r}setSlideOnRemove(e){let t=e.refType;t=t&~ne.StayOnRemove,t=t|ne.SlideOnRemove,e.refType=t}ackInterval(e,t){if(!(e instanceof si)||!Xe(e.start,ne.StayOnRemove)&&!Xe(e.end,ne.StayOnRemove))return;const r=this.getSlideToSegment(e.start),i=this.getSlideToSegment(e.end),s=e.properties[jt],o=this.hasPendingChangeStart(s),a=this.hasPendingChangeEnd(s);o||this.setSlideOnRemove(e.start),a||this.setSlideOnRemove(e.end);const l=r!==void 0&&!o,c=i!==void 0&&!a;if(l||c){if(this.localCollection.removeExistingInterval(e),l){const u=e.start.properties;this.client.removeLocalReferencePosition(e.start),e.start=jv(this.client,r,e.start.refType,t),u&&e.start.addProperties(u)}if(c){const u=e.end.properties;this.client.removeLocalReferencePosition(e.end),e.end=jv(this.client,i,e.end.refType,t),u&&e.end.addProperties(u)}this.localCollection.add(e)}}addInternal(e,t,r){return this.ackAdd(e,t,r)}ackAdd(e,t,r){var i;if(t){const o=(i=e.properties)===null||i===void 0?void 0:i[jt],a=this.getIntervalById(o);a&&this.ackInterval(a,r);return}if(!this.attached)throw new ue("attachSequence must be called");this.localCollection.ensureSerializedId(e);const s=this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties,r);return s&&this.onDeserialize&&this.onDeserialize(s),this.emit("addInterval",s,t,r),s}deleteInterval(e,t,r){return this.ackDelete(e,t,r)}ackDelete(e,t,r){if(t)return;if(!this.attached)throw new ue("attach must be called prior to deleting intervals");const i=this.localCollection.ensureSerializedId(e),s=this.localCollection.getIntervalById(i);s&&this.deleteExistingInterval(s,t,r)}serializeInternal(){if(!this.attached)throw new ue("attachSequence must be called");return this.localCollection.serialize()}[Symbol.iterator](){return new Mo(this)}CreateForwardIteratorWithStartPosition(e){return new Mo(this,!0,e)}CreateBackwardIteratorWithStartPosition(e){return new Mo(this,!1,e)}CreateForwardIteratorWithEndPosition(e){return new Mo(this,!0,void 0,e)}CreateBackwardIteratorWithEndPosition(e){return new Mo(this,!1,void 0,e)}gatherIterationResults(e,t,r,i){this.attached&&this.localCollection.gatherIterationResults(e,t,r,i)}findOverlappingIntervals(e,t){if(!this.attached)throw new ue("attachSequence must be called");return this.localCollection.findOverlappingIntervals(e,t)}map(e){if(!this.attached)throw new ue("attachSequence must be called");this.localCollection.map(e)}previousInterval(e){if(!this.attached)throw new ue("attachSequence must be called");return this.localCollection.previousInterval(e)}nextInterval(e){if(!this.attached)throw new ue("attachSequence must be called");return this.localCollection.nextInterval(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var fh;(function(n){n.NoOp="noop",n.ClientJoin="join",n.ClientLeave="leave",n.Propose="propose",n.Reject="reject",n.Summarize="summarize",n.SummaryAck="summaryAck",n.SummaryNack="summaryNack",n.Operation="op",n.RemoteHelp="remoteHelp",n.NoClient="noClient",n.RoundTrip="tripComplete",n.Control="control"})(fh||(fh={}));var t1;(function(n){n.ThrottlingError="ThrottlingError",n.InvalidScopeError="InvalidScopeError",n.BadRequestError="BadRequestError",n.LimitExceededError="LimitExceededError"})(t1||(t1={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dK(n,e,t){const r=n.makeSerialized(e,t);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class n1{constructor(e,t){this.value=e,this.valueType=t}get type(){return this.valueType.name}makeSerialized(e,t){const r=this.valueType.factory.store(this.value),i=dk(r,e,t);return{type:this.type,value:i}}getOpHandler(e){const t=this.valueType.ops.get(e);if(!t)throw new Error("Unknown type message");return t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class qk{constructor(e,t,r,i,s=new Ok){this.serializer=e,this.handle=t,this.submitMessage=r,this.type=i,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:[r.value[0],r.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const r=e.next();return r.done?{value:void 0,done:!0}:{value:r.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,r,i)=>{e(t.value,r,i)})}get(e){var t;return((t=this.data.get(e))!==null&&t!==void 0?t:this.createCore(e,!0)).value}has(e){return this.data.has(e)}getSerializedStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=r.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((r,i)=>{t[i]=dK(r,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){if(r.type===He[He.Plain]||r.type===He[He.Shared])continue;const s={key:t.startsWith("intervalCollections/")?t.substring(20):t,value:this.makeLocal(t,r)};this.data.set(s.key,s.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}tryResubmitMessage(e,t){const r=e.type,i=this.messageHandlers.get(r);return i!==void 0?(i.resubmit(e,t),!0):!1}tryGetStashedOpLocalMetadata(e){const t=e.type;if(this.messageHandlers.has(t))return this.messageHandlers.get(t).getStashedOpLocalMetadata(e);throw new Error("no apply stashed op handler")}tryProcessMessage(e,t,r,i){const s=this.messageHandlers.get(e.type);return s!==void 0?(s.process(e,t,r,i),!0):!1}createCore(e,t){const r=new n1(this.type.factory.load(this.makeMapValueOpEmitter(e),void 0),this.type),i=this.data.get(e);this.data.set(e,r);const s={key:e,previousValue:i};return this.eventEmitter.emit("create",s,t,this.eventEmitter),r}makeLocal(e,t){On(t.type!==He[He.Plain]&&t.type!==He[He.Shared],737),t.value=ch(t.value,this.serializer);const r=this.type.factory.load(this.makeMapValueOpEmitter(e),t.value);return new n1(r,this.type)}getMessageHandlers(){const e=new Map;return e.set("act",{process:(t,r,i,s)=>{var o;const a=(o=this.data.get(t.key))!==null&&o!==void 0?o:this.createCore(t.key,r),l=a.getOpHandler(t.value.opName),c=a.value,u=ch(t.value.value,this.serializer);l.process(c,u,r,i,s);const d={key:t.key,previousValue:c};this.eventEmitter.emit("valueChanged",d,r,i,this.eventEmitter)},submit:(t,r)=>{this.submitMessage(t,r)},resubmit:(t,r)=>{const i=this.data.get(t.key),s=i.getOpHandler(t.value.opName),{rebasedOp:o,rebasedLocalOpMetadata:a}=s.rebase(i.value,t.value,r);this.submitMessage(Object.assign(Object.assign({},t),{value:o}),a)},getStashedOpLocalMetadata:t=>{On(!1,22)}}),e}makeMapValueOpEmitter(e){return{emit:(r,i,s,o)=>{const a=hk(s,this.serializer,this.handle),l={key:e,type:"act",value:{opName:r,value:a}};this.submitMessage(l,o);const c={key:e,previousValue:i};this.eventEmitter.emit("valueChanged",c,!0,null,this.eventEmitter)}}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class LS{constructor(e,t){this.deltaArgs=e,this.mergeTreeClient=t,On(e.deltaSegments.length>0,728),this.isEmpty=!1,this.deltaOperation=e.operation,this.sortedRanges=new Pm(()=>{const r=new M7;return this.deltaArgs.deltaSegments.forEach(i=>{const s={operation:this.deltaArgs.operation,position:this.mergeTreeClient.getPosition(i.segment),propertyDeltas:i.propertyDeltas,segment:i.segment};r.addOrUpdate(s)}),r}),this.pFirst=new Pm(()=>this.sortedRanges.value.items[0]),this.pLast=new Pm(()=>this.sortedRanges.value.items[this.sortedRanges.value.size-1])}get ranges(){return this.sortedRanges.value.items}get clientId(){return this.mergeTreeClient.longClientId}get first(){return this.pFirst.value}get last(){return this.pLast.value}}class Bk extends LS{constructor(e,t,r){super(t,r),this.opArgs=e,this.isLocal=e.sequencedMessage===void 0}}class Uk extends LS{constructor(e,t,r){super(t,r),this.opArgs=e}}let Pm=class{constructor(e){this.valueGenerator=e,this.pEvaluated=!1}get evaluated(){return this.pEvaluated}get value(){return this.pEvaluated||(this.pEvaluated=!0,this.pValue=this.valueGenerator()),this.pValue}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Rm="header",r1="content";class Ha extends df{constructor(e,t,r,i){super(t,e,r,"fluid_sequence_"),this.dataStoreRuntime=e,this.id=t,this.segmentFromSpec=i,this.loadedDeferred=new E7,this.loadedDeferredOutgoingOps=[],this.deferIncomingOps=!0,this.loadedDeferredIncomingOps=[],this.messagesSinceMSNChange=[],this.loadedDeferred.promise.catch(s=>{this.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},s)}),this.client=new kS(i,pe.create(this.logger,"SharedSegmentSequence.MergeTreeClient"),e.options),super.on("newListener",s=>{switch(s){case"sequenceDelta":this.client.mergeTreeDeltaCallback||(this.client.mergeTreeDeltaCallback=(o,a)=>{this.emit("sequenceDelta",new Bk(o,a,this.client),this)});break;case"maintenance":this.client.mergeTreeMaintenanceCallback||(this.client.mergeTreeMaintenanceCallback=(o,a)=>{this.emit("maintenance",new Uk(a,o,this.client),this)});break}}),super.on("removeListener",s=>{switch(s){case"sequenceDelta":super.listenerCount(s)===0&&(this.client.mergeTreeDeltaCallback=void 0);break;case"maintenance":super.listenerCount(s)===0&&(this.client.mergeTreeMaintenanceCallback=void 0);break}}),this.intervalCollections=new qk(this.serializer,this.handle,(s,o)=>this.submitLocalMessage(s,o),new ns)}get loaded(){return this.loadedDeferred.promise}static createOpsFromDelta(e){var t,r;const i=[];for(const s of e.ranges)switch(e.deltaOperation){case fe.ANNOTATE:{const o=i[i.length-1],a={};for(const l of Object.keys(s.propertyDeltas))a[l]=(r=(t=s.segment.properties)===null||t===void 0?void 0:t[l])!==null&&r!==void 0?r:null;o&&o.pos2===s.position&&eu(o.props,a)?o.pos2+=s.segment.cachedLength:i.push(zv(s.position,s.position+s.segment.cachedLength,a,void 0));break}case fe.INSERT:i.push(Fk(s.position,s.segment.clone().toJSONObject()));break;case fe.REMOVE:{const o=i[i.length-1];(o==null?void 0:o.pos1)===s.position?o.pos2+=s.segment.cachedLength:i.push($v(s.position,s.position+s.segment.cachedLength));break}}return i}removeRange(e,t){const r=this.client.removeRangeLocal(e,t);return r&&this.submitSequenceMessage(r),r}groupOperation(e){this.client.localTransaction(e),this.submitSequenceMessage(e)}getContainingSegment(e){return this.client.getContainingSegment(e)}getLength(){return this.client.getLength()}getPosition(e){return this.client.getPosition(e)}annotateRange(e,t,r,i){const s=this.client.annotateRangeLocal(e,t,r,i);s&&this.submitSequenceMessage(s)}getPropertiesAtPosition(e){return this.client.getPropertiesAtPosition(e)}getRangeExtentsOfPosition(e){return this.client.getRangeExtentsOfPosition(e)}createPositionReference(e,t,r){const i=new yo(this.client,e,t,r);return r!==ne.Transient&&this.addLocalReference(i),i}createLocalReferencePosition(e,t,r,i){return this.client.createLocalReferencePosition(e,t,r,i)}localRefToPos(e){return this.client.localReferencePositionToPosition(e)}localReferencePositionToPosition(e){return this.client.localReferencePositionToPosition(e)}resolveRemoteClientPosition(e,t,r){return this.client.resolveRemoteClientPosition(e,t,r)}submitSequenceMessage(e){if(!this.isAttached())return;const t=hk(e,this.serializer,this.handle),r=this.client.peekPendingSegmentGroups(e.type===fe.GROUP?e.ops.length:1);this.loadedDeferred.isCompleted?this.submitLocalMessage(t,r):this.loadedDeferredOutgoingOps.push([t,r])}addLocalReference(e){return this.client.addLocalReference(e)}removeLocalReference(e){return this.client.removeLocalReferencePosition(e)}removeLocalReferencePosition(e){return this.client.removeLocalReferencePosition(e)}posFromRelativePos(e){return this.client.posFromRelativePos(e)}walkSegments(e,t,r,i,s=!1){return this.client.walkSegments(e,t,r,i,s)}getStackContext(e,t){return this.client.getStackContext(e,t)}getCurrentSeq(){return this.client.getCurrentSeq()}insertAtReferencePosition(e,t){const r=this.client.insertAtReferencePositionLocal(e,t);r&&this.submitSequenceMessage(r)}async waitIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollectionLabels(){return this.intervalCollections.keys()}summarizeCore(e,t){const r=new tn;return this.intervalCollections.size>0&&r.addBlob(Rm,this.intervalCollections.serialize(e)),r.addWithStats(r1,this.summarizeMergeTree(e)),r.getSummaryTree()}processGCDataCore(e){this.intervalCollections.size>0&&this.intervalCollections.serialize(e),this.client.serializeGCData(this.handle,e)}replaceRange(e,t,r){const i=Math.max(e,t),s=this.client.insertSegmentLocal(i,r);if(s)if(e<t){const o=this.client.removeRangeLocal(e,t);this.submitSequenceMessage(dh(s,o))}else this.submitSequenceMessage(s)}onConnect(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}onDisconnect(){}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)||this.submitSequenceMessage(this.client.regeneratePendingOp(e,t))}async loadCore(e){var t;if(await e.contains(Rm)){const r=await e.readBlob(Rm),i=xk(r,"utf8");this.intervalCollections.populate(i)}try{const{catchupOpsP:r}=await this.client.load(this.runtime,new mG(e,r1),this.serializer),i=r.then(s=>{s.forEach(o=>{const a=this.client.getCollabWindow();if(o.minimumSequenceNumber<a.minSeq||o.referenceSequenceNumber<a.minSeq||o.sequenceNumber<=a.minSeq||o.sequenceNumber<=a.currentSeq)throw new Error(`Invalid catchup operations in snapshot: ${JSON.stringify({op:{seq:o.sequenceNumber,minSeq:o.minimumSequenceNumber,refSeq:o.referenceSequenceNumber},collabWindow:{seq:a.currentSeq,minSeq:a.minSeq}})}`);this.processMergeTreeMsg(o)}),this.loadFinished()}).catch(s=>{this.loadFinished(s)});((t=this.dataStoreRuntime.options)===null||t===void 0?void 0:t.sequenceInitializeFromHeaderOnly)!==!0&&await i}catch(r){this.loadFinished(r)}}processCore(e,t,r){this.deferIncomingOps?(On(!t,114),this.loadedDeferredIncomingOps.push(e)):(On(e.type===fh.Operation,115),this.intervalCollections.tryProcessMessage(e.contents,t,e,r)||this.processMergeTreeMsg(e,t))}didAttach(){var e;this.isAttached()&&this.client.startOrUpdateCollaboration((e=this.runtime.clientId)!==null&&e!==void 0?e:"attached")}initializeLocalCore(){super.initializeLocalCore(),this.loadFinished()}applyStashedOp(e){return this.client.applyStashedOp(e)}summarizeMergeTree(e){On(this.loadedDeferred.isCompleted,116);const t=this.runtime.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(t),this.messagesSinceMSNChange.forEach(r=>{r.minimumSequenceNumber=t}),this.client.summarize(this.runtime,this.handle,e,this.messagesSinceMSNChange)}processMergeTreeMsg(e,t){var r,i;const s=ch(e,this.serializer),o=[];function a(u){o.push(...Ha.createOpsFromDelta(u))}const l=s.referenceSequenceNumber!==s.sequenceNumber-1;let c=s;((r=this.runtime.options)===null||r===void 0?void 0:r.newMergeTreeSnapshotFormat)!==!0&&l&&this.on("sequenceDelta",a),this.client.applyMsg(s,t),((i=this.runtime.options)===null||i===void 0?void 0:i.newMergeTreeSnapshotFormat)!==!0&&(l&&(this.removeListener("sequenceDelta",a),c=Object.assign(Object.assign({},s),{referenceSequenceNumber:c.sequenceNumber-1,contents:o.length!==1?dh(...o):o[0]})),this.messagesSinceMSNChange.push(c),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<s.minimumSequenceNumber&&this.processMinSequenceNumberChanged(s.minimumSequenceNumber))}processMinSequenceNumberChanged(e){let t=0;for(;t<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[t].sequenceNumber>e);t++);t!==0&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(t))}loadFinished(e){if(!this.loadedDeferred.isCompleted){if(this.initializeIntervalCollections(),e)throw this.loadedDeferred.reject(e),e;this.deferIncomingOps=!1;for(const t of this.loadedDeferredIncomingOps)this.processCore(t,!1,void 0);this.loadedDeferredIncomingOps.length=0,this.loadedDeferred.resolve();for(const[t,r]of this.loadedDeferredOutgoingOps)this.reSubmitCore(t,r);this.loadedDeferredOutgoingOps.length=0}}initializeIntervalCollections(){this.intervalCollections.eventEmitter.on("create",({key:e,previousValue:t},r)=>{const i=this.intervalCollections.get(e);i.attached||i.attachGraph(this.client,e),On(t===void 0,705),this.emit("createIntervalCollection",e,r,this)});for(const e of this.intervalCollections.keys())this.intervalCollections.get(e).attachGraph(this.client,e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const nu="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const i1=128;class Xt extends mf{constructor(e){super(),this.items=e,this.type=Xt.typeString,this.cachedLength=e.length}static is(e){return e.type===Xt.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new Xt(e.items);return e.props&&t.addProperties(e.props),t}}toJSONObject(){const e={items:this.items};return super.addSerializedProps(e),e}clone(e=0,t){const r=this.items.slice(e,t),i=new Xt(r);return this.cloneInto(i),i}canAppend(e){return Xt.is(e)&&(this.cachedLength<=i1||e.cachedLength<=i1)}toString(){return this.items.toString()}append(e){if(!Xt.is(e))throw new Error("can only append another run segment");ii.append(this,e),this.items=this.items.concat(e.items),this.cachedLength=this.items.length}removeRange(e,t){let r=[];const i=this.items.length;return e>0&&(r=r.concat(this.items.slice(0,e))),t<i&&(r=r.concat(this.items.slice(t))),this.items=r,this.cachedLength=this.items.length,this.items.length===0}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);return this.items=this.items.slice(0,e),this.cachedLength=this.items.length,new Xt(t)}}}Xt.typeString="SubSequence";class IS extends Ha{constructor(e,t,r,i){super(e,t,r,i),this.id=t}insert(e,t,r){const i=new Xt(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}remove(e,t){this.removeRange(e,t)}getItemCount(){return this.getLength()}getItems(e,t){const r=[];let i;return t!==void 0&&t<=e||(this.walkSegments(s=>(Xt.is(s)&&(i===void 0&&(i=s),r.push(...s.items)),!0),e,t),i!==void 0&&r.splice(0,e-this.getPosition(i)),t!==void 0&&r.splice(t-e)),r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class qv extends IS{constructor(e,t,r){super(e,t,r,Ir.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Ir.Type)}static getFactory(){return new Ir}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Bv extends IS{constructor(e,t,r){super(e,t,r,Lr.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Lr.Type)}static getFactory(){return new Lr}getRange(e,t){return this.getItems(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Nr{static segmentFromSpec(e){const t=bt.fromJSONObject(e);if(t)return t;const r=Rt.fromJSONObject(e);if(r)return r}get type(){return Nr.Type}get attributes(){return Nr.Attributes}async load(e,t,r,i){const s=new Uv(e,t,i);return await s.load(r),s}create(e,t){const r=new Uv(e,t,this.attributes);return r.initializeLocal(),r}}Nr.Type="https://graph.microsoft.com/types/mergeTree";Nr.Attributes={type:Nr.Type,snapshotFormatVersion:"0.1",packageVersion:nu};class Lr{static segmentFromSpec(e){const t=e;if(t.items){const r=new Xt(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return Lr.Type}get attributes(){return Lr.Attributes}async load(e,t,r,i){const s=new Bv(e,t,i);return await s.load(r),s}create(e,t){const r=new Bv(e,t,this.attributes);return r.initializeLocal(),r}}Lr.Type="https://graph.microsoft.com/types/mergeTree/object-sequence";Lr.Attributes={type:Lr.Type,snapshotFormatVersion:"0.1",packageVersion:nu};class Ir{static segmentFromSpec(e){const t=e;if(t.items){const r=new Xt(t.items);return t.props&&r.addProperties(t.props),r}}get type(){return Ir.Type}get attributes(){return Ir.Attributes}async load(e,t,r,i){const s=new qv(e,t,i);return await s.load(r),s}create(e,t){const r=new qv(e,t,this.attributes);return r.initializeLocal(),r}}Ir.Type="https://graph.microsoft.com/types/mergeTree/number-sequence";Ir.Attributes={type:Ir.Type,snapshotFormatVersion:"0.1",packageVersion:nu};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Uv extends Ha{constructor(e,t,r){super(e,t,r,Nr.segmentFromSpec),this.id=t,this.mergeTreeTextHelper=this.client.createTextHelper()}static create(e,t){return e.createChannel(t,Nr.Type)}static getFactory(){return new Nr}get ISharedString(){return this}insertMarkerRelative(e,t,r){const i=new Rt(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertMarker(e,t,r){const i=new Rt(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);return s&&this.submitSequenceMessage(s),s}insertTextRelative(e,t,r){const i=new bt(t);r&&i.addProperties(r);const s=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(s,i);o&&this.submitSequenceMessage(o)}insertText(e,t,r){const i=new bt(t);r&&i.addProperties(r);const s=this.client.insertSegmentLocal(e,i);s&&this.submitSequenceMessage(s)}replaceText(e,t,r,i){this.replaceRange(e,t,bt.make(r,i))}removeText(e,t){return this.removeRange(e,t)}annotateMarkerNotifyConsensus(e,t,r){const i=this.client.annotateMarkerNotifyConsensus(e,t,r);i&&this.submitSequenceMessage(i)}annotateMarker(e,t,r){const i=this.client.annotateMarker(e,t,r);i&&this.submitSequenceMessage(i)}findTile(e,t,r=!0){return this.client.findTile(e,t,r)}getTextAndMarkers(e){const t=this.client.getCollabWindow();return this.mergeTreeTextHelper.getTextAndMarkers(t.currentSeq,t.clientId,e)}getText(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"",e,t)}getTextWithPlaceholders(){const e=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(e.currentSeq,e.clientId," ")}getTextRangeWithPlaceholders(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId," ",e,t)}getTextRangeWithMarkers(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"*",e,t)}getMarkerFromId(e){return this.client.getMarkerFromId(e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ln extends mf{constructor(e){super(),this.type=ln.typeString,this.cachedLength=e}static is(e){return e.type===ln.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"pad"in e){const t=new ln(e.pad);return e.props&&t.addProperties(e.props),t}}toJSONObject(){return{pad:this.cachedLength,props:this.properties}}clone(e=0,t){const r=new ln(this.cachedLength);return this.cloneInto(r),r}canAppend(e){return ln.is(e)}toString(){return`[padding: ${this.cachedLength}]`}append(e){if(!ln.is(e))throw new Error("can only append padding segment");ii.append(this,e),this.cachedLength+=e.cachedLength}removeRange(e,t){return this.cachedLength-=t-e,this.cachedLength===0}createSplitSegmentAt(e){const t=e,r=this.cachedLength-e;return this.cachedLength=t,new ln(r)}}ln.typeString="PaddingSegment";class Tn extends Xt{constructor(e){super(e),this.items=e,this.type=Tn.typeString,this.tags=new Array(e.length).fill(void 0)}static is(e){return e.type===Tn.typeString}static fromJSONObject(e){if(e&&typeof e=="object"&&"items"in e){const t=new Tn(e.items);return e.props&&t.addProperties(e.props),t}}clone(e=0,t){const r=new Tn(this.items.slice(e,t));return this.tags&&(r.tags=this.tags.slice(e,t)),this.cloneInto(r),r}append(e){super.append(e);const t=e;return t.tags&&this.tags&&this.tags.splice(this.items.length,0,...t.tags),this}removeRange(e,t){return this.tags.splice(e,t-e),super.removeRange(e,t)}getTag(e){return this.tags[e]}setTag(e,t){this.tags[e]=t}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);this.items=this.items.slice(0,e),this.cachedLength=this.items.length;const r=new Tn(t);return r.tags=this.tags.slice(e),this.tags.length=e,r}}}Tn.typeString="RunSegment";const Rc=2097152,Qs=Rc+1,AS=4294967295,hK=AS+1,fK=Rc*AS,xi=(n,e)=>n*Qs+e;function Hk(n){const e=Math.floor(n/Qs),t=n-e*Qs;return{row:e,col:t}}class Hv extends Ha{constructor(e,t,r){super(e,t,r,Ar.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Ar.Type)}static getFactory(){return new Ar}get numRows(){return Hk(this.getLength()).row}setItems(e,t,r,i){const s=xi(e,t),o=s+r.length,a=new Tn(r);i&&a.addProperties(i),this.replaceRange(s,o,a)}getItem(e,t){const r=xi(e,t),{segment:i,offset:s}=this.getContainingSegment(r);if(i&&Tn.is(i))return i.items[s];if(i&&ln.is(i))return;throw new Error("Unrecognized Segment type")}getTag(e,t){const{segment:r,offset:i}=this.getSegment(e,t);if(Tn.is(r))return r.getTag(i)}setTag(e,t,r){const{segment:i,offset:s}=this.getSegment(e,t);if(Tn.is(i))i.setTag(s,r);else if(r!==void 0)throw new Error(`Must not attempt to set tags on '${i.constructor.name}'.`)}insertRows(e,t){const r=xi(e,0),i=Qs*t,s=new ln(i),o=this.client.insertSegmentLocal(r,s);o&&this.submitSequenceMessage(o)}removeRows(e,t){const r=xi(e,0),i=Qs*t;this.removeRange(r,r+i)}insertCols(e,t){this.moveAsPadding(Rc-t,e,t)}removeCols(e,t){this.moveAsPadding(e,Rc-t,t)}annotatePosition(e,t,r){const i=xi(e,t);this.annotateRange(i,i+1,r)}getPositionProperties(e,t){const r=xi(e,t);return this.getPropertiesAtPosition(r)}moveAsPadding(e,t,r){const i=e,s=e+r,o=[];for(let a=0,l=0;a<this.numRows;a++,l+=Qs){o.push(this.client.removeRangeLocal(l+i,l+s));const c=l+t,u=new ln(r);o.push(this.client.insertSegmentLocal(c,u))}this.submitSequenceMessage(dh(...o))}getSegment(e,t){const r=xi(e,t);return this.getContainingSegment(r)}}class Ar{static segmentFromSpec(e){const t=ln.fromJSONObject(e);if(t)return t;const r=Tn.fromJSONObject(e);if(r)return r;throw new Error(`Unrecognized IJSONObject: '${JSON.stringify(e)}'`)}get type(){return Ar.Type}get attributes(){return Ar.Attributes}async load(e,t,r,i){const s=new Hv(e,t,i);return await s.load(r),s}create(e,t){const r=new Hv(e,t,this.attributes);return r.initializeLocal(),r}}Ar.Type="https://graph.microsoft.com/types/mergeTree/sparse-matrix";Ar.Attributes={type:Ar.Type,snapshotFormatVersion:"0.1",packageVersion:nu};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Vk;const s1="header";class fi{get type(){return fi.Type}get attributes(){return fi.Attributes}async load(e,t,r,i){const s=new Vv(t,e,i);return await s.load(r),s}create(e,t){const r=new Vv(t,e,this.attributes);return r.initializeLocal(),r}}fi.Type="https://graph.microsoft.com/types/sharedIntervalCollection";fi.Attributes={type:fi.Type,snapshotFormatVersion:"0.1",packageVersion:nu};class Vv extends df{constructor(e,t,r){super(e,t,r,"fluid_sharedIntervalCollection_"),this[Vk]="SharedIntervalCollection",this.intervalCollections=new qk(this.serializer,this.handle,(i,s)=>this.submitLocalMessage(i,s),new rs)}static create(e,t){return e.createChannel(t,fi.Type)}static getFactory(){return new fi}async waitIntervalCollection(e){return this.intervalCollections.get(this.getIntervalCollectionPath(e))}getIntervalCollection(e){const t=this.getIntervalCollectionPath(e);return this.intervalCollections.get(t)}summarizeCore(e){return Z9(s1,this.intervalCollections.serialize(e))}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)}onDisconnect(){}async loadCore(e){const t=await e.readBlob(s1),r=xk(t,"utf8");this.intervalCollections.populate(r)}processCore(e,t,r){e.type===fh.Operation&&this.intervalCollections.tryProcessMessage(e.contents,t,e,r)}getIntervalCollectionPath(e){return e}applyStashedOp(){throw new Error("not implemented")}}Vk=Symbol.toStringTag;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const pK=Object.freeze(Object.defineProperty({__proto__:null,get AttachState(){return te},get ConnectionState(){return Oe},get ContainerErrorType(){return as},DOProviderContainerRuntimeFactory:_k,DirectoryFactory:cr,get DriverErrorType(){return Ln},FluidContainer:Pv,Interval:ha,IntervalCollection:NS,IntervalCollectionIterator:Mo,get IntervalType(){return sr},LocalValueMaker:bS,MapFactory:Wn,PaddingSegment:ln,RootDataObject:Ek,RunSegment:Tn,SequenceDeltaEvent:Bk,SequenceEvent:LS,SequenceInterval:si,SequenceMaintenanceEvent:Uk,ServiceAudience:Tk,SharedDirectory:Oc,SharedIntervalCollection:Vv,SharedIntervalCollectionFactory:fi,SharedMap:xc,SharedNumberSequence:qv,SharedNumberSequenceFactory:Ir,SharedObjectSequence:Bv,SharedObjectSequenceFactory:Lr,SharedSegmentSequence:Ha,SharedSequence:IS,SharedString:Uv,SharedStringFactory:Nr,SparseMatrix:Hv,SparseMatrixFactory:Ar,SubSequence:Xt,maxCellPosition:fK,maxCol:Rc,maxCols:Qs,maxRow:AS,maxRows:hK,positionToRowCol:Hk,rowColToPosition:xi},Symbol.toStringTag,{value:"Module"})),mK=Lc(pK);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(yi,"__esModule",{value:!0});yi.DynamicObjectRegistry=void 0;const ka=mK,o1="@microsoft/live-share:DYNAMIC-LOADABLE-OBJECTS";class ru{static get dynamicLoadableObjects(){return typeof window>"u"?this._dynamicLoadableObjects:window[o1]||this._dynamicLoadableObjects}static registerObjectClass(e,t){const r=this.dynamicLoadableObjects;r.has(t)||(r.set(t,e),typeof window<"u"&&(window[o1]=r))}}ru._dynamicLoadableObjects=new Map;yi.DynamicObjectRegistry=ru;ru.registerObjectClass(ka.SharedMap,ka.SharedMap.getFactory().type);ru.registerObjectClass(ka.SharedString,ka.SharedString.getFactory().type);ru.registerObjectClass(ka.SharedDirectory,ka.SharedDirectory.getFactory().type);var iu={},su={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var km=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(su,"__esModule",{value:!0});su.TimestampProvider=void 0;const gK=5*1e3,vK=5;class yK{constructor(){this._retries=0,this._lastTimeSent=0}get isRunning(){return!!this._serverTime}getTimestamp(){if(!this._serverTime)throw new Error("TimestampProvider: can't call getTimestamp() before calling start().");return this._lastTimeSent=Math.max(new Date().getTime()+this._serverTime.offset,this._lastTimeSent+1)}getMaxTimestampError(){if(!this._serverTime)throw new Error("DefaultTimestampProvider: can't call getMaxTimestampError() before calling initialize().");return Math.floor(this._serverTime.requestLatency/2)}start(){return km(this,void 0,void 0,function*(){this.stop(),performance.mark("TeamsSync: starting clock");try{yield this.improveAccuracy()}finally{performance.measure("TeamsSync: clock startup","TeamsSync: starting clock")}})}stop(){this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._serverTime=void 0,this._retries=0}improveAccuracy(){return km(this,void 0,void 0,function*(){const e=yield this.getSessionTimeOffset();!this._serverTime||e.requestLatency<this._serverTime.requestLatency?(this._serverTime=e,this._retries=0):this._retries++,this._retries<=vK?this._syncTimer=setTimeout(this.improveAccuracy.bind(this),gK):this._syncTimer=void 0})}getSessionTimeOffset(){return km(this,void 0,void 0,function*(){const e=performance.now(),t=yield this.getNtpTime(),r=performance.now(),i=new Date().getTime(),s=r-e,o=t.ntpTimeInUTC+Math.floor(s/2);return{serverTimeInUtc:o,localTimeInUtc:i,requestLatency:s,offset:o-i}})}}su.TimestampProvider=yK;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(iu,"__esModule",{value:!0});iu.HostTimestampProvider=void 0;const SK=su;class bK extends SK.TimestampProvider{constructor(e){super(),this._host=e}getNtpTime(){return this._host.getNtpTime()}}iu.HostTimestampProvider=bK;var Jn={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.LiveDataObjectInitializeState=n.ContainerState=n.UserMeetingRole=void 0,function(e){e.guest="Guest",e.attendee="Attendee",e.presenter="Presenter",e.organizer="Organizer"}(n.UserMeetingRole||(n.UserMeetingRole={})),function(e){e.added="Added",e.alreadyExists="AlreadyExists",e.conflict="Conflict",e.notFound="NotFound"}(n.ContainerState||(n.ContainerState={})),function(e){e.needed="needed",e.pending="pending",e.succeeded="succeeded",e.fatalError="fatalError"}(n.LiveDataObjectInitializeState||(n.LiveDataObjectInitializeState={}))})(Jn);var Nm={};const Va=Lc(S7);var pl={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function tr(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Wk(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const wK=(n,e)=>So.from(n,e).buffer,CK=(n,e)=>So.from(n).toString(e);function Wv(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let So=class Ns extends Uint8Array{toString(e){return Wk(this,e)}static from(e,t,r){if(typeof e=="string")return Ns.fromString(e,t);if(e!==null&&typeof e=="object"&&Wv(e.buffer))return Ns.fromArrayBuffer(e.buffer,e.byteOffset,e.byteLength);if(Wv(e))return Ns.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ns(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Ns(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ns(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};async function EK(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function _K(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return dr(n)}}async function Gk(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return nP(()=>import("./hashFileNode-d138b5a0.js"),["assets/hashFileNode-d138b5a0.js","assets/sha256-2b2d765b.js"]).then(async i=>i.hashFile(n,e,t));const r=await EK(n,e);return _K(r,t)}async function TK(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=So.from(t+n.toString());return Gk(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Gv=globalThis.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const xK=n=>So.from(n,"base64").toString("utf-8"),OK=n=>So.from(n,"utf8").toString("base64"),PK=(n,e)=>{switch(e){case"utf8":case"utf-8":return n;default:return So.from(n,e).toString()}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function RK(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const kK=async n=>new Promise(e=>setTimeout(()=>e(),n));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function NK(n,e){return(...t)=>{if(n.disposed)throw new Error("Already disposed");return e(...t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Kk extends mn.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class wr extends Kk{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,e!==void 0){const t=i=>this.unforwardEvent(e,i),r=i=>this.forwardEvent(e,i);this.on(wr.removeListenerEvent,t),this.on(wr.newListenerEvent,r)}}static isEmitterEvent(e){return e===wr.newListenerEvent||e===wr.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(e!==void 0&&r!==void 0&&!wr.isEmitterEvent(r)){let i=this.forwardingEvents.get(r);if(i===void 0&&(i=new Map,this.forwardingEvents.set(r,i)),!i.has(e)){const s=(...o)=>this.emit(r,...o);i.set(e,()=>e.off(r,s)),e.on(r,s)}}}unforwardEvent(e,...t){for(const r of t)if(r!==void 0&&!wr.isEmitterEvent(r)){const i=this.forwardingEvents.get(r);if((i==null?void 0:i.has(e))===!0&&this.listenerCount(r)===0){const s=i.get(e);s!==void 0&&s(),i.delete(e),i.size===0&&this.forwardingEvents.delete(r)}}}}wr.newListenerEvent="newListener";wr.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const LK={compare:(n,e)=>n-e,min:Number.MIN_VALUE};class IK{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const e=this.L.pop();return this.fixdown(1),e.value}add(e){const t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){const t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){const t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){const r=t>>1;this.swap(t,r),t=r}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let r=t<<1;if(r<this.count()&&this.comp.compare(this.L[r].value,this.L[r+1].value)>0&&r++,this.comp.compare(this.L[t].value,this.L[r].value)<=0)break;this.swap(t,r),t=r}}swap(e,t){const r=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=r,this.L[t].position=t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class AK{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class MK{send(e){}}let DK=class{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class FK{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(e,setTimeout(()=>{this.cleanup(e),this.cancel(e)},this.expiry.durationMs))}cancel(e){const t=this.gcTimeouts.get(e);t!==void 0&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){this.expiry.policy==="sliding"&&(this.cancel(e),this.schedule(e))}}class zK{constructor({expiry:e={policy:"indefinite"},removeOnError:t=()=>!0}={}){this.cache=new Map,this.removeOnError=t,this.gc=new FK(e,r=>this.remove(r))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}async addOrGet(e,t){let r=this.get(e);return r===void 0&&(r=(async()=>t())(),this.cache.set(e,r),r.catch(s=>{this.removeOnError(s)&&this.remove(e)}),this.gc.schedule(e)),r}add(e,t){const r=this.has(e);return this.addOrGet(e,t).catch(()=>{}),!r}async addValueOrGet(e,t){return this.addOrGet(e,async()=>t)}addValue(e,t){return this.add(e,async()=>t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Jk=class{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){this.res!==void 0&&(this.completed=!0,this.res(e))}reject(e){this.rej!==void 0&&(this.completed=!0,this.rej(e))}};class $K{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class jK{constructor(e,t){typeof e=="number"?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=wa(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:wa(this.ranges)}}add(e,t){tr(e>=this.lastPrimary,3),this.lastSecondary!==void 0&&tr(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;const r=this.ranges[this.ranges.length-1],i=r.primary+r.length,s=r.secondary+r.length;t!==s&&(e===i?r.length===0?r.secondary=t:(r.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&s+1===t?r.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){tr(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);tr(e>=this.ranges[t-1].primary,6);const r=this.ranges[t-1];return Math.min(e-r.primary,r.length)+r.secondary}updateBase(e){tr(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);tr(e>=this.ranges[t-1].primary,8);const r=this.ranges[t-1],i=e-r.primary;r.secondary=r.secondary+Math.min(i,r.length),r.length=Math.max(r.length-i,0),r.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,tr(e===this.ranges[0].primary,9)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class qK{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){const r=[],i=Date.now();for(const s of t){const o=`${e}/${s}`;if(!this.requestMap.has(o))this.requestMap.set(o,i),r.push(s);else{if(this.requestMap.get(o)+this.windowMSec>i)continue;this.requestMap.set(o,i),r.push(s)}}return r}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function BK(n){let e;try{e=JSON.parse(n)}catch{return}return e}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Lm=2147483647;function MS(n,e,t){let r;if(e>Lm){const i=e-Lm;r=setTimeout(()=>MS(n,i,t),Lm)}else r=setTimeout(()=>n(),Math.max(e,0));return t==null||t(r),r}class Qk{constructor(e,t,r=()=>Date.now()){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,i;if(!this.runningState)this.start(e,t);else{const s=e??this.runningState.intendedDuration,o=(i=t??((r=this.runningState.restart)===null||r===void 0?void 0:r.handler))!==null&&i!==void 0?i:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);s<a?this.start(s,o):s===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:o}}}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:MS(()=>this.handler(),e,i=>{this.runningState!==void 0&&(this.runningState.timeout=i)})}}handler(){tr(!!this.runningState,10);const e=this.runningState.restart;if(e!==void 0){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class UK{constructor(e,t){this.timer=new Qk(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new Jk,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),tr(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class DS{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=Gv.now();return new DS(e)}trace(){const e=Gv.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function HK(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const VK=Object.freeze(Object.defineProperty({__proto__:null,BaseTelemetryNullLogger:MK,Deferred:Jk,EventForwarder:wr,Heap:IK,IsoBuffer:So,Lazy:AK,LazyPromise:$K,NumberComparer:LK,PromiseCache:zK,PromiseTimer:UK,RangeTracker:jK,RateLimiter:qK,TelemetryNullLogger:DK,Timer:Qk,Trace:DS,TypedEventEmitter:Kk,Uint8ArrayToArrayBuffer:RK,Uint8ArrayToString:Wk,assert:tr,bufferToString:CK,delay:kK,doIfNotDisposed:NK,fromBase64ToUtf8:xK,fromUtf8ToBase64:OK,gitHashFile:TK,hashFile:Gk,isArrayBuffer:Wv,performance:Gv,safelyParseJSON:BK,setLongTimeout:MS,stringToBuffer:wK,toUtf8:PK,unreachableCase:HK},Symbol.toStringTag,{value:"Module"})),Wa=Lc(VK);var Im={},Mr={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Mr,"__esModule",{value:!0});Mr.LiveShareReportIssueLink=Mr.ObjectSynchronizerEvents=Mr.TelemetryEvents=void 0;Mr.TelemetryEvents={LivePresence:{LocalPresenceChanged:"LivePresence:LocalPresenceChange",RemotePresenceChanged:"LivePresence:RemotePresenceChange",GetClientInfoError:"LivePresence:GetClientInfoError",RoleVerificationError:"LivePresence:RoleVerificationError"},LiveState:{StateChanged:"LiveState:StateChanged",RoleVerificationError:"LiveState:RoleVerificationError"}};Mr.ObjectSynchronizerEvents={update:"update",connect:"connect"};Mr.LiveShareReportIssueLink="https://aka.ms/teamsliveshare/issue";var vf={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Am=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(vf,"__esModule",{value:!0});vf.LiveShareTokenProvider=void 0;class WK{constructor(e){this._host=e}fetchOrdererToken(e,t,r){return Am(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchStorageToken(e,t,r){return Am(this,void 0,void 0,function*(){return yield this.fetchFluidToken(e,t,r)})}fetchFluidToken(e,t,r){return Am(this,void 0,void 0,function*(){let i;return!this._frsToken||r||this._tenantId!==e||this._documentId!==t?(this._frsToken=yield this._host.getFluidToken(t),i=!1):i=!0,this._tenantId=e,t&&(this._documentId=t),{jwt:this._frsToken,fromCache:i}})}}vf.LiveShareTokenProvider=WK;var Ga={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Ga,"__esModule",{value:!0});Ga.RequestCache=void 0;class GK{constructor(e){this._cache=new Map,this._cacheLifetime=e}cacheRequest(e,t){const r=new Date().getTime();let i;if(this._cache.has(e)){i=this._cache.get(e);const o=i.startTime+this._cacheLifetime;if(r<o)return i.promise}const s=t();return this._cache.set(e,{startTime:r,promise:s}),s}has(e){return this._cache.has(e)}}Ga.RequestCache=GK;var yf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var KK=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(yf,"__esModule",{value:!0});yf.RoleVerifier=void 0;class JK{constructor(e){this._host=e}verifyRolesAllowed(e,t){var r;return KK(this,void 0,void 0,function*(){if(!e)throw new Error("RoleVerifier: called verifyRolesAllowed() without a clientId");if(Array.isArray(t)&&t.length>0){const i=yield this._host.getClientInfo(e),s=(r=i==null?void 0:i.roles)!==null&&r!==void 0?r:[];for(let o=0;o<t.length;o++){const a=t[o];if(s.indexOf(a)>=0)return!0}return!1}return!0})}}yf.RoleVerifier=JK;var Ke={},Xk={},Sf={},bf={};Object.defineProperty(bf,"__esModule",{value:!0});bf.default=XK;let zu;const QK=new Uint8Array(16);function XK(){if(!zu&&(zu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!zu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zu(QK)}var gs={},bo={},wf={};Object.defineProperty(wf,"__esModule",{value:!0});wf.default=void 0;var YK=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;wf.default=YK;Object.defineProperty(bo,"__esModule",{value:!0});bo.default=void 0;var ZK=eJ(wf);function eJ(n){return n&&n.__esModule?n:{default:n}}function tJ(n){return typeof n=="string"&&ZK.default.test(n)}var nJ=tJ;bo.default=nJ;Object.defineProperty(gs,"__esModule",{value:!0});gs.default=void 0;gs.unsafeStringify=Yk;var rJ=iJ(bo);function iJ(n){return n&&n.__esModule?n:{default:n}}const xt=[];for(let n=0;n<256;++n)xt.push((n+256).toString(16).slice(1));function Yk(n,e=0){return xt[n[e+0]]+xt[n[e+1]]+xt[n[e+2]]+xt[n[e+3]]+"-"+xt[n[e+4]]+xt[n[e+5]]+"-"+xt[n[e+6]]+xt[n[e+7]]+"-"+xt[n[e+8]]+xt[n[e+9]]+"-"+xt[n[e+10]]+xt[n[e+11]]+xt[n[e+12]]+xt[n[e+13]]+xt[n[e+14]]+xt[n[e+15]]}function sJ(n,e=0){const t=Yk(n,e);if(!(0,rJ.default)(t))throw TypeError("Stringified UUID is invalid");return t}var oJ=sJ;gs.default=oJ;Object.defineProperty(Sf,"__esModule",{value:!0});Sf.default=void 0;var aJ=cJ(bf),lJ=gs;function cJ(n){return n&&n.__esModule?n:{default:n}}let a1,Mm,Dm=0,Fm=0;function uJ(n,e,t){let r=e&&t||0;const i=e||new Array(16);n=n||{};let s=n.node||a1,o=n.clockseq!==void 0?n.clockseq:Mm;if(s==null||o==null){const h=n.random||(n.rng||aJ.default)();s==null&&(s=a1=[h[0]|1,h[1],h[2],h[3],h[4],h[5]]),o==null&&(o=Mm=(h[6]<<8|h[7])&16383)}let a=n.msecs!==void 0?n.msecs:Date.now(),l=n.nsecs!==void 0?n.nsecs:Fm+1;const c=a-Dm+(l-Fm)/1e4;if(c<0&&n.clockseq===void 0&&(o=o+1&16383),(c<0||a>Dm)&&n.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Dm=a,Fm=l,Mm=o,a+=122192928e5;const u=((a&268435455)*1e4+l)%4294967296;i[r++]=u>>>24&255,i[r++]=u>>>16&255,i[r++]=u>>>8&255,i[r++]=u&255;const d=a/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=d&255,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(let h=0;h<6;++h)i[r+h]=s[h];return e||(0,lJ.unsafeStringify)(i)}var dJ=uJ;Sf.default=dJ;var Cf={},cs={},ou={};Object.defineProperty(ou,"__esModule",{value:!0});ou.default=void 0;var hJ=fJ(bo);function fJ(n){return n&&n.__esModule?n:{default:n}}function pJ(n){if(!(0,hJ.default)(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var mJ=pJ;ou.default=mJ;Object.defineProperty(cs,"__esModule",{value:!0});cs.URL=cs.DNS=void 0;cs.default=bJ;var gJ=gs,vJ=yJ(ou);function yJ(n){return n&&n.__esModule?n:{default:n}}function SJ(n){n=unescape(encodeURIComponent(n));const e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}const Zk="6ba7b810-9dad-11d1-80b4-00c04fd430c8";cs.DNS=Zk;const eN="6ba7b811-9dad-11d1-80b4-00c04fd430c8";cs.URL=eN;function bJ(n,e,t){function r(i,s,o,a){var l;if(typeof i=="string"&&(i=SJ(i)),typeof s=="string"&&(s=(0,vJ.default)(s)),((l=s)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=c[u];return o}return(0,gJ.unsafeStringify)(c)}try{r.name=n}catch{}return r.DNS=Zk,r.URL=eN,r}var Ef={};Object.defineProperty(Ef,"__esModule",{value:!0});Ef.default=void 0;function wJ(n){if(typeof n=="string"){const e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return CJ(EJ(_J(n),n.length*8))}function CJ(n){const e=[],t=n.length*32,r="0123456789abcdef";for(let i=0;i<t;i+=8){const s=n[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);e.push(o)}return e}function tN(n){return(n+64>>>9<<4)+14+1}function EJ(n,e){n[e>>5]|=128<<e%32,n[tN(e)-1]=e;let t=1732584193,r=-271733879,i=-1732584194,s=271733878;for(let o=0;o<n.length;o+=16){const a=t,l=r,c=i,u=s;t=At(t,r,i,s,n[o],7,-680876936),s=At(s,t,r,i,n[o+1],12,-389564586),i=At(i,s,t,r,n[o+2],17,606105819),r=At(r,i,s,t,n[o+3],22,-1044525330),t=At(t,r,i,s,n[o+4],7,-176418897),s=At(s,t,r,i,n[o+5],12,1200080426),i=At(i,s,t,r,n[o+6],17,-1473231341),r=At(r,i,s,t,n[o+7],22,-45705983),t=At(t,r,i,s,n[o+8],7,1770035416),s=At(s,t,r,i,n[o+9],12,-1958414417),i=At(i,s,t,r,n[o+10],17,-42063),r=At(r,i,s,t,n[o+11],22,-1990404162),t=At(t,r,i,s,n[o+12],7,1804603682),s=At(s,t,r,i,n[o+13],12,-40341101),i=At(i,s,t,r,n[o+14],17,-1502002290),r=At(r,i,s,t,n[o+15],22,1236535329),t=Mt(t,r,i,s,n[o+1],5,-165796510),s=Mt(s,t,r,i,n[o+6],9,-1069501632),i=Mt(i,s,t,r,n[o+11],14,643717713),r=Mt(r,i,s,t,n[o],20,-373897302),t=Mt(t,r,i,s,n[o+5],5,-701558691),s=Mt(s,t,r,i,n[o+10],9,38016083),i=Mt(i,s,t,r,n[o+15],14,-660478335),r=Mt(r,i,s,t,n[o+4],20,-405537848),t=Mt(t,r,i,s,n[o+9],5,568446438),s=Mt(s,t,r,i,n[o+14],9,-1019803690),i=Mt(i,s,t,r,n[o+3],14,-187363961),r=Mt(r,i,s,t,n[o+8],20,1163531501),t=Mt(t,r,i,s,n[o+13],5,-1444681467),s=Mt(s,t,r,i,n[o+2],9,-51403784),i=Mt(i,s,t,r,n[o+7],14,1735328473),r=Mt(r,i,s,t,n[o+12],20,-1926607734),t=Dt(t,r,i,s,n[o+5],4,-378558),s=Dt(s,t,r,i,n[o+8],11,-2022574463),i=Dt(i,s,t,r,n[o+11],16,1839030562),r=Dt(r,i,s,t,n[o+14],23,-35309556),t=Dt(t,r,i,s,n[o+1],4,-1530992060),s=Dt(s,t,r,i,n[o+4],11,1272893353),i=Dt(i,s,t,r,n[o+7],16,-155497632),r=Dt(r,i,s,t,n[o+10],23,-1094730640),t=Dt(t,r,i,s,n[o+13],4,681279174),s=Dt(s,t,r,i,n[o],11,-358537222),i=Dt(i,s,t,r,n[o+3],16,-722521979),r=Dt(r,i,s,t,n[o+6],23,76029189),t=Dt(t,r,i,s,n[o+9],4,-640364487),s=Dt(s,t,r,i,n[o+12],11,-421815835),i=Dt(i,s,t,r,n[o+15],16,530742520),r=Dt(r,i,s,t,n[o+2],23,-995338651),t=Ft(t,r,i,s,n[o],6,-198630844),s=Ft(s,t,r,i,n[o+7],10,1126891415),i=Ft(i,s,t,r,n[o+14],15,-1416354905),r=Ft(r,i,s,t,n[o+5],21,-57434055),t=Ft(t,r,i,s,n[o+12],6,1700485571),s=Ft(s,t,r,i,n[o+3],10,-1894986606),i=Ft(i,s,t,r,n[o+10],15,-1051523),r=Ft(r,i,s,t,n[o+1],21,-2054922799),t=Ft(t,r,i,s,n[o+8],6,1873313359),s=Ft(s,t,r,i,n[o+15],10,-30611744),i=Ft(i,s,t,r,n[o+6],15,-1560198380),r=Ft(r,i,s,t,n[o+13],21,1309151649),t=Ft(t,r,i,s,n[o+4],6,-145523070),s=Ft(s,t,r,i,n[o+11],10,-1120210379),i=Ft(i,s,t,r,n[o+2],15,718787259),r=Ft(r,i,s,t,n[o+9],21,-343485551),t=ji(t,a),r=ji(r,l),i=ji(i,c),s=ji(s,u)}return[t,r,i,s]}function _J(n){if(n.length===0)return[];const e=n.length*8,t=new Uint32Array(tN(e));for(let r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function ji(n,e){const t=(n&65535)+(e&65535);return(n>>16)+(e>>16)+(t>>16)<<16|t&65535}function TJ(n,e){return n<<e|n>>>32-e}function _f(n,e,t,r,i,s){return ji(TJ(ji(ji(e,n),ji(r,s)),i),t)}function At(n,e,t,r,i,s,o){return _f(e&t|~e&r,n,e,i,s,o)}function Mt(n,e,t,r,i,s,o){return _f(e&r|t&~r,n,e,i,s,o)}function Dt(n,e,t,r,i,s,o){return _f(e^t^r,n,e,i,s,o)}function Ft(n,e,t,r,i,s,o){return _f(t^(e|~r),n,e,i,s,o)}var xJ=wJ;Ef.default=xJ;Object.defineProperty(Cf,"__esModule",{value:!0});Cf.default=void 0;var OJ=nN(cs),PJ=nN(Ef);function nN(n){return n&&n.__esModule?n:{default:n}}const RJ=(0,OJ.default)("v3",48,PJ.default);var kJ=RJ;Cf.default=kJ;var Tf={},xf={};Object.defineProperty(xf,"__esModule",{value:!0});xf.default=void 0;const NJ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var LJ={randomUUID:NJ};xf.default=LJ;Object.defineProperty(Tf,"__esModule",{value:!0});Tf.default=void 0;var l1=rN(xf),IJ=rN(bf),AJ=gs;function rN(n){return n&&n.__esModule?n:{default:n}}function MJ(n,e,t){if(l1.default.randomUUID&&!e&&!n)return l1.default.randomUUID();n=n||{};const r=n.random||(n.rng||IJ.default)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return(0,AJ.unsafeStringify)(r)}var DJ=MJ;Tf.default=DJ;var Of={},Pf={};Object.defineProperty(Pf,"__esModule",{value:!0});Pf.default=void 0;function FJ(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function zm(n,e){return n<<e|n>>>32-e}function zJ(n){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let a=0;a<o.length;++a)n.push(o.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const r=n.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(let o=0;o<i;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=n[o*64+l*4]<<24|n[o*64+l*4+1]<<16|n[o*64+l*4+2]<<8|n[o*64+l*4+3];s[o]=a}s[i-1][14]=(n.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<i;++o){const a=new Uint32Array(80);for(let f=0;f<16;++f)a[f]=s[o][f];for(let f=16;f<80;++f)a[f]=zm(a[f-3]^a[f-8]^a[f-14]^a[f-16],1);let l=t[0],c=t[1],u=t[2],d=t[3],h=t[4];for(let f=0;f<80;++f){const p=Math.floor(f/20),g=zm(l,5)+FJ(p,c,u,d)+h+e[p]+a[f]>>>0;h=d,d=u,u=zm(c,30)>>>0,c=l,l=g}t[0]=t[0]+l>>>0,t[1]=t[1]+c>>>0,t[2]=t[2]+u>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+h>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var $J=zJ;Pf.default=$J;Object.defineProperty(Of,"__esModule",{value:!0});Of.default=void 0;var jJ=iN(cs),qJ=iN(Pf);function iN(n){return n&&n.__esModule?n:{default:n}}const BJ=(0,jJ.default)("v5",80,qJ.default);var UJ=BJ;Of.default=UJ;var Rf={};Object.defineProperty(Rf,"__esModule",{value:!0});Rf.default=void 0;var HJ="00000000-0000-0000-0000-000000000000";Rf.default=HJ;var kf={};Object.defineProperty(kf,"__esModule",{value:!0});kf.default=void 0;var VJ=WJ(bo);function WJ(n){return n&&n.__esModule?n:{default:n}}function GJ(n){if(!(0,VJ.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}var KJ=GJ;kf.default=KJ;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return o.default}});var e=u(Sf),t=u(Cf),r=u(Tf),i=u(Of),s=u(Rf),o=u(kf),a=u(bo),l=u(gs),c=u(ou);function u(d){return d&&d.__esModule?d:{default:d}}})(Xk);/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var FS=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.waitUntilConnected=Ke.getInsecureTokenProvider=Ke.timeoutRequest=Ke.waitForResult=Ke.TimeoutError=Ke.waitForDelay=Ke.parseJwt=Ke.decodeBase64=Ke.cloneValue=void 0;const JJ=Xk;function QJ(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n}Ke.cloneValue=QJ;function sN(n){return typeof atob=="function"?atob(n):Buffer.from(n,"base64").toString()}Ke.decodeBase64=sN;const XJ=n=>{try{return JSON.parse(sN(n.split(".")[1]))}catch{return null}};Ke.parseJwt=XJ;function oN(n){return new Promise(e=>{setTimeout(()=>e(),n)})}Ke.waitForDelay=oN;class zS extends Error{constructor(){super("timed out")}}Ke.TimeoutError=zS;function YJ(n,e,t,r,i,s,o=1e3){let a=0;return new Promise((l,c)=>FS(this,void 0,void 0,function*(){for(;;){try{const u=yield aN(n,Math.max(o*(a+1),o*3),s),d=e(u);if(d!==null){l(d.response);break}else if(a>=r.length){c(new Error("waitForResult: invalid response"));break}}catch(u){if(a>=r.length){c(t(u));break}if(i&&!(u instanceof zS)){const d=i(u);if(d!==null){c(d);break}}}yield oN(r[a++])}}))}Ke.waitForResult=YJ;function aN(n,e,t){return new Promise((r,i)=>FS(this,void 0,void 0,function*(){let s=setTimeout(()=>{i(new zS),s=null},e);try{const o=yield n();r(o),s==null&&(t==null||t())}catch(o){i(o),s==null&&(t==null||t())}clearTimeout(s)}))}Ke.timeoutRequest=aN;function ZJ(){var n,e;return FS(this,void 0,void 0,function*(){try{const{InsecureTokenProvider:t}=yield require("@fluidframework/test-client-utils"),r=(e=(n=new URL(window.location.href))===null||n===void 0?void 0:n.searchParams)===null||e===void 0?void 0:e.get("userId");return new t("",{id:r??(0,JJ.v4)(),name:"Test User"})}catch{throw new Error("@microsoft/live-share: when using 'local' connection type, you must have @fluidframework/test-client-utils installed")}})}Ke.getInsecureTokenProvider=ZJ;function eQ(n){return new Promise(e=>{const t=r=>{n.off("connected",t),e(r)};n.clientId?e(n.clientId):n.on("connected",t)})}Ke.waitUntilConnected=eQ;var Nf={},Ka={},$m=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Ka,"__esModule",{value:!0});Ka.BaseHostDecorator=void 0;class tQ{constructor(e){this._host=e}registerClientId(e){return $m(this,void 0,void 0,function*(){return this._host.registerClientId(e)})}getClientRoles(e){return $m(this,void 0,void 0,function*(){return this._host.getClientRoles(e)})}getClientInfo(e){return $m(this,void 0,void 0,function*(){return this._host.getClientInfo(e)})}getFluidTenantInfo(){return this._host.getFluidTenantInfo()}getFluidToken(e){return this._host.getFluidToken(e)}getFluidContainerId(){return this._host.getFluidContainerId()}setFluidContainerId(e){return this._host.setFluidContainerId(e)}getNtpTime(){return this._host.getNtpTime()}}Ka.BaseHostDecorator=tQ;var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.isTimestampProvider=Pt.isILiveEvent=Pt.isErrorLike=Pt.isIClientInfo=Pt.isClientRolesResponse=Pt.isMobileWorkaroundRolesResponse=void 0;function nQ(n){return $S(n==null?void 0:n.userRoles)}Pt.isMobileWorkaroundRolesResponse=nQ;function $S(n){return Array.isArray(n)&&n.every(e=>typeof e=="string")}Pt.isClientRolesResponse=$S;function rQ(n){return n===void 0||(n==null?void 0:n.userId)!==void 0&&$S(n==null?void 0:n.roles)}Pt.isIClientInfo=rQ;function iQ(n){return typeof(n==null?void 0:n.message)=="string"}Pt.isErrorLike=iQ;function sQ(n){return typeof n=="object"&&typeof n.clientId=="string"&&typeof n.timestamp=="number"&&typeof n.name=="string"}Pt.isILiveEvent=sQ;function oQ(n){return typeof(n==null?void 0:n.start)=="function"}Pt.isTimestampProvider=oQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var $u=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Nf,"__esModule",{value:!0});Nf.LiveShareHostDecorator=void 0;const aQ=Ka,c1=Ga,No=Pt,u1=Ke,d1=[100,200,200,400,600],h1=4*1e3;class lQ extends aQ.BaseHostDecorator{constructor(){super(...arguments),this._registerRequestCache=new c1.RequestCache(h1),this._userInfoRequestCache=new c1.RequestCache(h1)}getClientInfo(e,t,r){return $u(this,void 0,void 0,function*(){if(!e)throw new Error("LiveShareHostDecorator: called getClientInfo() without a clientId");const i=r?`${e}backwardsCompat`:e;return this._userInfoRequestCache.cacheRequest(i,()=>(0,u1.waitForResult)(()=>$u(this,void 0,void 0,function*(){return yield this._host.getClientInfo(e)}),s=>(0,No.isIClientInfo)(s)?{response:s}:null,s=>new Error(`LiveShareHostDecorator: getting client info for a remote client ID for reason: ${(0,No.isErrorLike)(s)?s.message:"unknown"}`),r??d1,s=>e==="fakeId"?new Error((0,No.isErrorLike)(s)?s.message:"an unknown error occurred"):null,t))})}registerClientId(e){return $u(this,void 0,void 0,function*(){return this._registerRequestCache.cacheRequest(e,()=>(0,u1.waitForResult)(()=>$u(this,void 0,void 0,function*(){return yield this._host.registerClientId(e)}),t=>(0,No.isClientRolesResponse)(t)?{response:t}:(0,No.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,t=>new Error(`LiveShareHostDecorator: registering local client ID for reason: ${(0,No.isErrorLike)(t)?t.message:"unknown"}`),d1))})}}Nf.LiveShareHostDecorator=lQ;var Lf={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var jm=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Lf,"__esModule",{value:!0});Lf.BackwardsCompatibilityHostDecorator=void 0;const cQ=Ka,uQ=Ga,qm=Pt,dQ=Ke,f1=[100,200,200,400,600],hQ=5*60*1e3;class fQ extends cQ.BaseHostDecorator{constructor(e){super(e),this._host=e,this._userRolesRequestCache=new uQ.RequestCache(hQ),this._totalTries=4,this._getClientInfoTriesRemaining=this._totalTries,this._getClientInfoExists=!1,this._hasWarnedPolyfill=!1,this.warmupCheckGetClientInfoExists()}getClientRoles(e){return jm(this,void 0,void 0,function*(){if(!e)throw new Error("BackwardsCompatibilityHostDecorator: called getClientInfo() without a clientId");return this._userRolesRequestCache.cacheRequest(e,()=>(0,dQ.waitForResult)(()=>jm(this,void 0,void 0,function*(){return yield this._host.getClientRoles(e)}),t=>(0,qm.isClientRolesResponse)(t)?{response:t}:(0,qm.isMobileWorkaroundRolesResponse)(t)?{response:t.userRoles}:null,()=>new Error("BackwardsCompatibilityHostDecorator: timed out getting roles for a remote client ID"),f1))})}getClientInfo(e){return jm(this,void 0,void 0,function*(){if(this._getClientInfoExists)return yield this._host.getClientInfo(e);if(this._getClientInfoTriesRemaining<=0){this._hasWarnedPolyfill||(console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: using getClientInfo polyfill"),this._hasWarnedPolyfill=!0);const r=yield this.getClientRoles(e);return{userId:e,displayName:void 0,roles:r??[]}}const t=this.getClientRoles(e);try{const r=yield this._host.getClientInfo(e,()=>{this._getClientInfoExists=!0},this.getRetrySchedule());return this._getClientInfoExists=!0,r}catch(r){if((0,qm.isErrorLike)(r)&&r.message.includes("timed out")){this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining<=0&&console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill");const i=yield t;return{userId:e,displayName:void 0,roles:i??[]}}}return this._getClientInfoExists=!0,console.log("BackwardsCompatibilityHostDecorator: error, retryingWithActual"),yield this.getClientInfo(e)})}warmupCheckGetClientInfoExists(){this._getClientInfoExists||this._host.getClientInfo("fakeId",()=>{this._getClientInfoExists=!0},[]).catch(e=>{e.message.includes("timed out")?(this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining>0?this.warmupCheckGetClientInfoExists():console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill")):this._getClientInfoExists=!0})}getRetrySchedule(){const e=this._totalTries-Math.max(0,this._getClientInfoTriesRemaining);return f1.slice(0,e)}}Lf.BackwardsCompatibilityHostDecorator=fQ;var au={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(au,"__esModule",{value:!0});au.Deferred=void 0;class pQ{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}get resolve(){return this._resolve}get reject(){return this._reject}}au.Deferred=pQ;var lN={};Object.defineProperty(lN,"__esModule",{value:!0});var ml={},p1;function mQ(){if(p1)return ml;p1=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=K&&K.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(ml,"__esModule",{value:!0}),ml.LiveObjectManager=void 0;const e=Wa,t=Qa(),r=Qn();let i=class extends e.TypedEventEmitter{constructor(o,a){super(),this._liveRuntime=o,this._containerRuntime=a,this.objectStoreMap=new Map,this.updateInterval=1e4}start(){this.startReceivingSignalUpdates()}stop(){this.stopReceivingSignalUpdates(),this.objectStoreMap.clear()}registerObject(o,a,l,c,u){return n(this,void 0,void 0,function*(){this._synchronizer||(this._synchronizer=new r.ContainerSynchronizer(a,this._containerRuntime,this._liveRuntime,this)),this._synchronizer.registerObject(o,c,u);const d={clientId:yield(0,r.waitUntilConnected)(a),timestamp:0,data:l,name:r.ObjectSynchronizerEvents.update};this.updateEventLocallyInStore(o,d)})}unregisterObject(o){this._synchronizer&&this._synchronizer.unregisterObject(o)}getLatestEventForObject(o){var a;return(a=this.getEventsForObject(o))===null||a===void 0?void 0:a[0]}getLatestEventForObjectClient(o,a){var l;return(l=this.objectStoreMap.get(o))===null||l===void 0?void 0:l.get(a)}getEventsForObject(o){var a;const l=this.objectStoreMap.get(o);if(l)return(a=[...l.values()])===null||a===void 0?void 0:a.sort((c,u)=>u.timestamp-c.timestamp)}sendEventForObject(o,a){return n(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const l=yield this._synchronizer.sendEventForObject(o,a);return this.updateEventLocallyInStore(o,l),l})}sendThrottledEventForObject(o,a){return n(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const l=yield this._synchronizer.sendThrottledEventForObject(o,a);return this.updateEventLocallyInStore(o,l),l})}clientIdDidChange(o,a){this.objectStoreMap.forEach(l=>{const c=l.get(o);c&&(l.set(a,c),l.delete(o))})}__dangerouslySetContainerRuntime(o){var a;this._containerRuntime!==o&&(this.stopReceivingSignalUpdates(),this._containerRuntime=o,this.startReceivingSignalUpdates(),(a=this._synchronizer)===null||a===void 0||a.__dangerouslySetContainerRuntime(o))}setAudience(o){this._audience=o}onReceivedSignal(o,a){var l;a||!o.clientId||!(0,r.isILiveEvent)(o.content)||typeof o.content.data!="object"||(this.dispatchUpdates(r.ObjectSynchronizerEvents.update,o.clientId,o.content.data,a),o.type===r.ObjectSynchronizerEvents.connect&&((l=this._synchronizer)===null||l===void 0||l.onSendBackgroundUpdates()))}dispatchUpdates(o,a,l,c){for(const u in l){const d=l[u],h={clientId:a,timestamp:d.timestamp,data:(0,r.cloneValue)(d.data),name:o};this.updateEventLocallyInStore(u,h)&&this.emit(r.ObjectSynchronizerEvents.update,u,(0,r.cloneValue)(h),c)}}updateEventLocallyInStore(o,a){let l=this.objectStoreMap.get(o);if(l){const c=l.get(a.clientId);if(c&&!t.LiveEvent.isNewer(c,a))return!1;l.set(a.clientId,a),c||this.emitJoined(o,a)}else l=new Map,l.set(a.clientId,a),this.objectStoreMap.set(o,l),this.emitJoined(o,a);return!0}emitJoined(o,a){this.emit("joined",{objectId:o,clientId:a.clientId,timestamp:a.timestamp})}startReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this.stopReceivingSignalUpdates(),this._onBoundReceivedSignalListener=this.onReceivedSignal.bind(this),this._containerRuntime.on("signal",this._onBoundReceivedSignalListener)}stopReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this._containerRuntime.off("signal",this._onBoundReceivedSignalListener)}};return ml.LiveObjectManager=i,ml}var gl={},vl={},Hr={},m1;function wo(){if(m1)return Hr;m1=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.LiveDataObjectInitializeNotNeededError=Hr.LiveDataObjectNotInitializedError=Hr.UnexpectedError=void 0;const n=Qn(),e=Jn;class t extends Error{constructor(o,a){super(`${o} - ${a}
Please report this issue at ${n.LiveShareReportIssueLink}.`)}static assert(o,a,l){if(!o)throw new t(a,l)}}Hr.UnexpectedError=t;class r extends Error{constructor(o,a,l){super(`${o} - not initialized prior to calling \`${a}()\`. \`initializeState\` is \`${l}\` but must equal \`succeeded\`.
To fix this error, ensure \`.initialize()\` has resolved before calling this function.`)}static assert(o,a,l){if(l!==e.LiveDataObjectInitializeState.succeeded)throw new r(o,a,l)}}Hr.LiveDataObjectNotInitializedError=r;class i extends Error{constructor(o,a){super(`${o} -  initialization is not needed. \`initializeState\` is \`${a}\` but must equal \`needed\`.
To fix this error, ensure you only call \`.initialize()\` when \`initializeState\` equals \`needed\`.`)}static assert(o,a){if(a!==e.LiveDataObjectInitializeState.needed)throw new i(o,a)}}return Hr.LiveDataObjectInitializeNotNeededError=i,Hr}var g1;function gQ(){if(g1)return vl;g1=1;var n=K&&K.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(vl,"__esModule",{value:!0}),vl.ThrottledEventQueue=void 0;const e=au,t=Mr,r=wo();let i=class{constructor(o,a=50){this._events={},this._containerSynchronizer=o,this._throttleIntervalMilli=a}sendWithQueue(o,a){return n(this,void 0,void 0,function*(){this._events[o]=a,this._hTimer||(this._deferred=new e.Deferred,this._hTimer=setTimeout(()=>n(this,void 0,void 0,function*(){var c,u;try{const d=yield this._containerSynchronizer.sendEventUpdates(this._events,t.ObjectSynchronizerEvents.update);r.UnexpectedError.assert(!!d,"ThrottledEventQueue","unable to send empty set of updates, which should not occur."),(c=this._deferred)===null||c===void 0||c.resolve(d)}catch(d){(u=this._deferred)===null||u===void 0||u.reject(d)}finally{this._events={},this._hTimer=void 0}}),this._throttleIntervalMilli)),r.UnexpectedError.assert(!!this._deferred,"ThrottledEventQueue","no deferred set, which should not occur.");const l=yield this._deferred.promise;return{clientId:l.clientId,timestamp:l.data[o].timestamp,name:l.name,data:l.data[o].data}})}};return vl.ThrottledEventQueue=i,vl}var v1;function vQ(){if(v1)return gl;v1=1;var n=K&&K.__awaiter||function(s,o,a,l){function c(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function h(g){try{p(l.next(g))}catch(S){d(S)}}function f(g){try{p(l.throw(g))}catch(S){d(S)}}function p(g){g.done?u(g.value):c(g.value).then(h,f)}p((l=l.apply(s,o||[])).next())})};Object.defineProperty(gl,"__esModule",{value:!0}),gl.ContainerSynchronizer=void 0;const e=gQ(),t=Mr,r=Ke;let i=class{constructor(o,a,l,c){this._runtime=o,this._containerRuntime=a,this._liveRuntime=l,this._objectStore=c,this._objects=new Map,this._throttledEventsQueue=new e.ThrottledEventQueue(this),this._connectedKeys=[],this._ddsBackgroundUpdateEnabled=new Set,this.startListeningForConnected()}registerObject(o,a,l){var c;if(this._objects.has(o))throw new Error(`LiveObjectSynchronizer: too many calls to registerObject() for object '${o}'`);this._connectedKeys.push(o),this._objects.set(o,a),this._runtime.clientId&&this._runtime.clientId!==this._connectSentForClientId&&this.onConnected(this._runtime.clientId),(c=this._objectStore.getEventsForObject(o))===null||c===void 0||c.forEach(u=>{this.onReceiveUpdate(o,u,u.clientId===this._runtime.clientId)}),l&&(this._ddsBackgroundUpdateEnabled.add(o),this._ddsBackgroundUpdateEnabled.size==1&&this.startBackgroundObjectUpdates())}unregisterObject(o){return this._objects.has(o)&&(this._objects.delete(o),this._connectedKeys=this._connectedKeys.filter(l=>l!=o),this._ddsBackgroundUpdateEnabled.has(o)&&(this._ddsBackgroundUpdateEnabled.delete(o),this._ddsBackgroundUpdateEnabled.size==0))?(this.stopBackgroundObjectUpdates(),!0):!1}onSendBackgroundUpdates(){return n(this,void 0,void 0,function*(){this._liveRuntime.canSendBackgroundUpdates&&(yield this.sendGroupEvent(this._connectedKeys.filter(o=>this._ddsBackgroundUpdateEnabled.has(o)),t.ObjectSynchronizerEvents.update).catch(o=>console.error(o)))})}sendEventForObject(o,a){return n(this,void 0,void 0,function*(){const l=this._objects.get(o);if(!l)throw new Error("ContainerSynchronizer.sendEventForObject(): cannot send an event for an object that is not registered");if(!(yield l.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");const u=yield this.sendEventUpdates({[o]:{data:a,timestamp:this._liveRuntime.getTimestamp()}},t.ObjectSynchronizerEvents.update);if(!u)throw new Error("Unable to send an event with empty updates");return{clientId:u.clientId,timestamp:u.data[o].timestamp,name:u.name,data:u.data[o].data}})}sendThrottledEventForObject(o,a){return n(this,void 0,void 0,function*(){const l=this._objects.get(o);if(!l)throw new Error("ContainerSynchronizer.sendThrottledEventForObject(): cannot send an event for an object that is not registered");if(!(yield l.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");return yield this._throttledEventsQueue.sendWithQueue(o,{data:a,timestamp:this._liveRuntime.getTimestamp()})})}sendEventUpdates(o,a){return n(this,void 0,void 0,function*(){if(Object.keys(o).length>0){const c={clientId:yield this.waitUntilConnected(),data:o,timestamp:a===t.ObjectSynchronizerEvents.connect?0:this._liveRuntime.getTimestamp(),name:a};return this._containerRuntime.submitSignal(a,c),c}})}__dangerouslySetContainerRuntime(o){this._containerRuntime!==o&&(this._containerRuntime=o)}onConnected(o){return n(this,void 0,void 0,function*(){if(o!==this._connectSentForClientId){this._connectSentForClientId&&this._objectStore.clientIdDidChange(this._connectSentForClientId,o),this._connectSentForClientId=o,this._liveRuntime.host.registerClientId(o).catch(a=>{console.error(a)});try{yield this.sendGroupEvent(this._connectedKeys,t.ObjectSynchronizerEvents.connect)}catch(a){console.error(`LiveObjectSynchronizer: error sending update - ${a.toString()}`)}}})}sendGroupEvent(o,a){return n(this,void 0,void 0,function*(){const l=[],c={},u=yield this.waitUntilConnected();for(let h=0;h<o.length;h++){const f=o[h];try{const p=this._objects.get(f);if(p&&(yield p.getLocalUserCanSend(a===t.ObjectSynchronizerEvents.connect))){const g=this._objectStore.getLatestEventForObjectClient(f,u);if(typeof g=="object"){c[f]={data:g.data,timestamp:p.shouldUpdateTimestampPeriodically?this._liveRuntime.getTimestamp():a===t.ObjectSynchronizerEvents.connect?0:g.timestamp};continue}}}catch(p){console.error(`LiveObjectSynchronizer: error getting an objects state - ${p.toString()}`)}l.push(f)}const d=Object.keys(c);return yield this.sendEventUpdates(c,a),{sent:d,skipped:l}})}onReceiveUpdate(o,a,l){return n(this,void 0,void 0,function*(){const c=this._objects.get(o);!c||!(yield c.updateState(a,a.clientId,l))||this._objectStore.updateEventLocallyInStore.bind(this._objectStore)(o,Object.assign(Object.assign({},a),{clientId:yield this.waitUntilConnected()}))})}waitUntilConnected(){return(0,r.waitUntilConnected)(this._runtime)}startListeningForConnected(){this._onBoundConnectedListener&&this.stopListeningForConnected(),this._onBoundConnectedListener=this.onConnected.bind(this),this._runtime.on("connected",this._onBoundConnectedListener)}stopListeningForConnected(){this._onBoundConnectedListener&&this._runtime.off("connected",this._onBoundConnectedListener)}startBackgroundObjectUpdates(){this.stopBackgroundObjectUpdates(),this._onReceiveObjectUpdateListener=this.onReceiveUpdate.bind(this),this._objectStore.on(t.ObjectSynchronizerEvents.update,this._onReceiveObjectUpdateListener),this._onSendUpdatesIntervalCallback=this.onSendBackgroundUpdates.bind(this),this._hTimer=setInterval(this._onSendUpdatesIntervalCallback,this._liveRuntime.objectManager.updateInterval)}stopBackgroundObjectUpdates(){this._hTimer&&(clearInterval(this._hTimer),this._hTimer=void 0,this._onSendUpdatesIntervalCallback=void 0),this._onReceiveObjectUpdateListener&&(this._objectStore.off("update",this._onReceiveObjectUpdateListener),this._onReceiveObjectUpdateListener=void 0)}};return gl.ContainerSynchronizer=i,gl}var If={},yQ=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(If,"__esModule",{value:!0});If.FormatFixHostDecorator=void 0;const SQ=Ka,cN=Pt;class bQ extends SQ.BaseHostDecorator{getClientInfo(e){return yQ(this,void 0,void 0,function*(){const t=yield this._host.getClientInfo(e);if((0,cN.isIClientInfo)(e))return t;const r=wQ(t);return r||t})}}If.FormatFixHostDecorator=bQ;function wQ(n){if(n instanceof Object){let e,t,r;if(Object.keys(n).map(i=>n[i]).forEach(i=>{(0,cN.isClientRolesResponse)(i)?t=i:CQ(i)?e=i:typeof i=="string"&&(r=i)}),e&&t)return{userId:e,roles:t,displayName:r}}}function CQ(n){return typeof n=="string"?/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/.test(n):!1}var y1;function Qn(){return y1||(y1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Mr,n),t(vf,n),t(Ga,n),t(yf,n),t(Ke,n),t(Nf,n),t(Lf,n),t(au,n),t(Pt,n),t(lN,n),t(mQ(),n),t(vQ(),n),t(If,n)}(Im)),Im}var S1;function uN(){if(S1)return pl;S1=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=K&&K.__awaiter||function(o,a,l,c){function u(d){return d instanceof l?d:new l(function(h){h(d)})}return new(l||(l=Promise))(function(d,h){function f(S){try{g(c.next(S))}catch(m){h(m)}}function p(S){try{g(c.throw(S))}catch(m){h(m)}}function g(S){S.done?d(S.value):u(S.value).then(f,p)}g((c=c.apply(o,a||[])).next())})},e=K&&K.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(pl,"__esModule",{value:!0}),pl.LiveEventScope=void 0;const t=e(mn),r=Wa,i=Qn();let s=class extends r.TypedEventEmitter{constructor(a,l,c){super(),this._liveRuntime=l,this.emitter=new t.default,this.throwForEvents=[],this._runtime=a,this._allowedRoles=c||[],this.emitter.on("error",u=>{this.emit("error",u)}),this._runtime.on("signal",(u,d)=>{if(!u.clientId||!this._runtime.connected)return;const h=u.clientId;u.content.clientId=h,this.emitToListeners(h,u.content,d)})}get allowedRoles(){return this._allowedRoles}set allowedRoles(a){this._allowedRoles=a}get clientId(){return this._runtime.clientId}onEvent(a,l){return this.throwForEvents.push(a),this.emitter.on(a,l),this}offEvent(a,l){this.emitter.off(a,l);const c=this.throwForEvents.indexOf(a);return c>=0&&this.throwForEvents.splice(c,1),this}sendEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.createEvent(a,l);return this._runtime.submitSignal(a,c),c})}sendLocalEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.createEvent(a,l);return this.emitToListeners(c.clientId,c,!0),c})}createEvent(a,l){return n(this,void 0,void 0,function*(){const c=yield this.waitUntilConnected();if(!(yield this._liveRuntime.verifyRolesAllowed(c,this._allowedRoles)))throw new Error(`The local user doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`);return{clientId:c,name:a,timestamp:this._liveRuntime.getTimestamp(),data:l}})}waitUntilConnected(){return(0,i.waitUntilConnected)(this._runtime)}emitToListeners(a,l,c){this._liveRuntime.verifyRolesAllowed(a,this._allowedRoles).then(u=>{u?this.emitter.emit(l.name,l,c):this.throwForEvents.includes(l.name)&&this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},new Error(`The clientId of "${a}" doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`))}).catch(u=>{this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},u)})}};return pl.LiveEventScope=s,pl}var lu={},cu={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var b1=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(cu,"__esModule",{value:!0});cu.LiveEventSource=void 0;class EQ{constructor(e,t){this._scope=e,this._eventName=t}sendEvent(e){return b1(this,void 0,void 0,function*(){return yield this._scope.sendEvent(this._eventName,e)})}sendLocalEvent(e){return b1(this,void 0,void 0,function*(){return yield this._scope.sendLocalEvent(this._eventName,e)})}}cu.LiveEventSource=EQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(lu,"__esModule",{value:!0});lu.LiveEventTarget=void 0;const _Q=cu;class TQ extends _Q.LiveEventSource{constructor(e,t,r){super(e,t),e.onEvent(t,r)}}lu.LiveEventTarget=TQ;var yl={},w1;function Ja(){if(w1)return yl;w1=1;var n=K&&K.__awaiter||function(o,a,l,c){function u(d){return d instanceof l?d:new l(function(h){h(d)})}return new(l||(l=Promise))(function(d,h){function f(S){try{g(c.next(S))}catch(m){h(m)}}function p(S){try{g(c.throw(S))}catch(m){h(m)}}function g(S){S.done?d(S.value):u(S.value).then(f,p)}g((c=c.apply(o,a||[])).next())})};Object.defineProperty(yl,"__esModule",{value:!0}),yl.LiveDataObject=void 0;const e=Va,t=Wa,r=Jn,i=Qn();let s=class extends e.DataObject{get liveRuntime(){return(0,t.assert)(this._liveRuntime!==null,`LiveShareRuntime not initialized. Ensure your Fluid \`ContainerSchema\` was first wrapped inside of \`getLiveContainerSchema()\` before calling \`client.getContainer()\` / \`client.createContainer()\` from your \`AzureClient\` (or equivalent) instance.
Alternatively, you can use the \`.joinContainer()\` in \`LiveShareClient\`, which does this for you.
If you are using \`LiveShareClient\` and are still encountering this issue, please report this issue at ${i.LiveShareReportIssueLink}.`),this._liveRuntime}get isInitialized(){return this.initializeState===r.LiveDataObjectInitializeState.succeeded}get initializeState(){return this._initializeState}set initializeState(a){this._initializeState=a}constructor(a){super(a),this._initializeState=r.LiveDataObjectInitializeState.needed,this._allowedRoles=[],this._liveRuntime=null}getClientInfo(a){return this.liveRuntime.getClientInfo(a)}waitUntilConnected(){return(0,i.waitUntilConnected)(this.runtime)}verifyLocalUserRoles(){var a;return n(this,void 0,void 0,function*(){const l=yield this.waitUntilConnected();return this.liveRuntime.verifyRolesAllowed(l,(a=this._allowedRoles)!==null&&a!==void 0?a:[])})}__dangerouslySetLiveRuntime(a){this._liveRuntime=a}onLocalUserAllowed(a){return n(this,void 0,void 0,function*(){(yield this.verifyLocalUserRoles())&&a()})}};return s.LiveEnabled=!0,yl.LiveDataObject=s,yl}var C1;function Qa(){return C1||(C1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(h,f,p,g){function S(m){return m instanceof p?m:new p(function(v){v(m)})}return new(p||(p=Promise))(function(m,v){function y(_){try{w(g.next(_))}catch(E){v(E)}}function b(_){try{w(g.throw(_))}catch(E){v(E)}}function w(_){_.done?m(_.value):S(_.value).then(y,b)}w((g=g.apply(h,f||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveEvent=n.LiveEventEvents=void 0;const t=Va,r=Jn,i=uN(),s=lu,o=yi,a=Ja(),l=Qn(),c=wo();var u;(function(h){h.received="received"})(u=n.LiveEventEvents||(n.LiveEventEvents={}));class d extends a.LiveDataObject{initialize(f){c.LiveDataObjectInitializeNotNeededError.assert("LiveEvent:initialize",this.initializeState),this.initializeState=r.LiveDataObjectInitializeState.pending,this._allowedRoles=f??[];const p=new i.LiveEventScope(this.runtime,this.liveRuntime,f);return this._eventTarget=new s.LiveEventTarget(p,"event",(g,S)=>{this.emit(u.received,(0,l.cloneValue)(g.data),S,g.clientId,g.timestamp)}),this.initializeState=r.LiveDataObjectInitializeState.succeeded,Promise.resolve()}send(f){return e(this,void 0,void 0,function*(){return c.LiveDataObjectNotInitializedError.assert("LiveEvent:send","send",this.initializeState),c.UnexpectedError.assert(!!this._eventTarget,"LiveEvent:send","`this._eventTarget` is undefined, implying there was an error during initialization that should not occur."),yield this._eventTarget.sendEvent(f)})}static isNewer(f,p,g=0){if(f){if(f.timestamp==p.timestamp){if((f.clientId||"").localeCompare(p.clientId||"")<=0)return!1}else if(f.timestamp>p.timestamp){if(f.timestamp-p.timestamp>g)return!1}else if(p.timestamp-f.timestamp<g)return!1}return!0}}d.TypeName="@microsoft/live-share:LiveEvent",d.factory=new t.DataObjectFactory(d.TypeName,d,[],{}),n.LiveEvent=d,o.DynamicObjectRegistry.registerObjectClass(d,d.TypeName)}(Nm)),Nm}var Af={},Xa={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Xa,"__esModule",{value:!0});Xa.TimeInterval=void 0;class xQ{constructor(e){this._value=e}get milliseconds(){return this._value}set milliseconds(e){this._value=e}get seconds(){return this._value/1e3}set seconds(e){this._value=Math.floor(e*1e3)}}Xa.TimeInterval=xQ;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Af,"__esModule",{value:!0});Af.LiveEventTimer=void 0;const OQ=Xa;class PQ{constructor(e,t,r,i=!1){this._isRunning=!1,this._eventSource=e,this._createEvent=t,this._delay=new OQ.TimeInterval(r),this.repeat=i}get delay(){return this._delay.milliseconds}set delay(e){this._delay.milliseconds=e}get isRunning(){return this._isRunning}sendEvent(){const e=this._createEvent();return this._eventSource.sendEvent(e)}start(){this.stop(),this._isRunning=!0,this.delayedEmit(this.delay)}stop(){this._timer!=null&&(clearTimeout(this._timer),this._timer=void 0),this._isRunning=!1}delayedEmit(e){this._timer=setTimeout(()=>{this._timer=void 0;const t=new Date().getTime();if(this.sendEvent().catch(r=>{console.warn(r)}),this._isRunning&&this.repeat){const r=(new Date().getTime()-t)%this.delay;this.delayedEmit(this.delay-r)}},e)}}Af.LiveEventTimer=PQ;var jS={},Bm={},Sl={},E1;function RQ(){if(E1)return Sl;E1=1,Object.defineProperty(Sl,"__esModule",{value:!0}),Sl.LivePresenceConnection=void 0;const n=Qn(),e=Qa(),t=Mf();let r=class{constructor(s,o,a,l){this._evt=s,this._isLocalConnection=o,this._expirationPeriod=a,this._liveRuntime=l}get isLocalConnection(){return this._isLocalConnection}get clientId(){return this._evt.clientId}get state(){return this.hasExpired()?t.PresenceState.offline:this._evt.data.state}get data(){return(0,n.cloneValue)(this._evt.data.data)}updateConnection(s){if(this._evt.clientId!==s.clientId)throw new Error("LivePresenceConnection.updateConnection called with event with different clientId");e.LiveEvent.isNewer(this._evt,s)&&(this._evt=s)}set expirationPeriod(s){this._expirationPeriod=s}hasExpired(){const o=this._liveRuntime.getTimestamp()-this._evt.timestamp;return!this._isLocalConnection&&o>this._expirationPeriod.milliseconds}};return Sl.LivePresenceConnection=r,Sl}var _1;function Mf(){return _1||(_1=1,function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresenceUser=n.PresenceState=void 0;const e=Qa(),t=Qn(),r=RQ();var i;(function(o){o.online="online",o.away="away",o.offline="offline"})(i=n.PresenceState||(n.PresenceState={}));class s{constructor(a,l,c,u,d){this._clientInfo=a,this._evt=l,this._expirationPeriod=c,this._liveRuntime=u,this._connections=new Map,this._isLocalUser=!1,this.updateClients(this._evt,d),this._lastUpdateTime=this._liveRuntime.getTimestamp()}get isLocalUser(){return this._isLocalUser}get userId(){return this._clientInfo.userId}get displayName(){return this._clientInfo.displayName}get state(){return this.hasExpired()?i.offline:this._evt.data.state}get data(){return(0,t.cloneValue)(this._evt.data.data)}get roles(){return this._clientInfo.roles}getConnections(a){const l=[];return this._connections.forEach(c=>{(a==null||c.state==a)&&l.push(c)}),l}getConnection(a){return this._connections.get(a)}isFromClient(a){return this._connections.get(a)!==void 0}updateReceived(a,l,c){const u=this.updateClients(a,c),d=this._evt,h=this._clientInfo;return e.LiveEvent.isNewer(d,a)?(this._evt=a,this._clientInfo=l,this._lastUpdateTime=this._liveRuntime.getTimestamp(),u||a.data.state!=d.data.state||JSON.stringify(l)!=JSON.stringify(h)||JSON.stringify(a.data.data)!=JSON.stringify(d.data.data)):u}set expirationPeriod(a){this._expirationPeriod=a,this._connections.forEach(l=>{l.expirationPeriod=a})}hasExpired(){const l=this._liveRuntime.getTimestamp()-this._lastUpdateTime;return!this._isLocalUser&&l>this._expirationPeriod.milliseconds}updateClients(a,l){const c=this._connections.get(a.clientId);return c?(c.updateConnection(a),!1):(this._connections.set(a.clientId,new r.LivePresenceConnection(a,l,this._expirationPeriod,this._liveRuntime)),l&&!this._isLocalUser?(this._isLocalUser=l,!0):!1)}}n.LivePresenceUser=s}(Bm)),Bm}var Co={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Co,"__esModule",{value:!0});Co.LiveObjectSynchronizer=void 0;class kQ{constructor(e,t,r){this.id=e,this.runtime=t,this.liveRuntime=r,this._isDisposed=!1,this._joinedListener=()=>{}}start(e,t,r,i=!1,s=!0){return this.liveRuntime.objectManager.registerObject(this.id,this.runtime,e,{updateState:t,getLocalUserCanSend:r,shouldUpdateTimestampPeriodically:i},s)}dispose(){this._isDisposed||(this._isDisposed=!0,this.liveRuntime.objectManager.unregisterObject(this.id),this.liveRuntime.objectManager.off("joined",this._joinedListener))}getLatestEvent(){return this.liveRuntime.objectManager.getLatestEventForObject(this.id)}getLatestEventForClient(e){return this.liveRuntime.objectManager.getLatestEventForObjectClient(this.id,e)}getEvents(){return this.liveRuntime.objectManager.getEventsForObject(this.id)}sendEvent(e){return this.liveRuntime.objectManager.sendEventForObject(this.id,e)}sendThrottledEvent(e){return this.liveRuntime.objectManager.sendThrottledEventForObject(this.id,e)}set onJoinedListener(e){this.liveRuntime.objectManager.off("joined",this._joinedListener),this._joinedListener=e,this.liveRuntime.objectManager.on("joined",({objectId:t,clientId:r,timestamp:i})=>{t===this.id&&this._joinedListener(r,i)})}}Co.LiveObjectSynchronizer=kQ;var Eo={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(Eo,"__esModule",{value:!0});Eo.LiveTelemetryLogger=void 0;class qS{constructor(e,t){this._liveRuntime=t,this._runtime=e}sendTelemetryEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendTelemetryEvent(i,t)}}sendErrorEvent(e,t,r){if(this._runtime.logger){const i=this.createTelemetryEvent(e,r);this._runtime.logger.sendErrorEvent(i,t)}}sendPerformanceEvent(e,t,r,i){if(this._runtime.logger){const s=Object.assign({duration:t},this.createTelemetryEvent(e,i));this._runtime.logger.sendPerformanceEvent(s,r)}}createTelemetryEvent(e,t){const r=this._liveRuntime.getTimestamp();return Object.assign({eventName:e,clientId:this._runtime.clientId,correlationId:qS.formatCorrelationId(this._runtime.clientId,r),timestamp:r},t)}static formatCorrelationId(e,t){return`${e}:${t}`}}Eo.LiveTelemetryLogger=qS;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(p,g,S,m){function v(y){return y instanceof S?y:new S(function(b){b(y)})}return new(S||(S=Promise))(function(y,b){function w(P){try{E(m.next(P))}catch(A){b(A)}}function _(P){try{E(m.throw(P))}catch(A){b(A)}}function E(P){P.done?y(P.value):v(P.value).then(w,_)}E((m=m.apply(p,g||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LivePresence=n.LivePresenceEvents=void 0;const t=Va,r=Mf(),i=Co,s=Eo,o=Qn(),a=wo(),l=Xa,c=yi,u=Jn,d=Ja();var h;(function(p){p.presenceChanged="presenceChanged"})(h=n.LivePresenceEvents||(n.LivePresenceEvents={}));class f extends d.LiveDataObject{constructor(){super(...arguments),this._expirationPeriod=new l.TimeInterval(2e4),this._users=[],this._lastEmitPresenceStateMap=new Map}get expirationPeriod(){return this._expirationPeriod.seconds}set expirationPeriod(g){this._expirationPeriod.seconds=g>.1?g:.1,this.getUsers().forEach(S=>{S.expirationPeriod=this._expirationPeriod})}get localUser(){var g;const S=(g=this._currentPresence)===null||g===void 0?void 0:g.clientId;if(S)return this.getUserForClient(S)}initialize(g,S=r.PresenceState.online,m){return e(this,void 0,void 0,function*(){a.LiveDataObjectInitializeNotNeededError.assert("LivePresence:initialize",this.initializeState),a.UnexpectedError.assert(!this._synchronizer,"LivePresence:initialize","_synchronizer already set, which is an unexpected error."),this.initializeState=u.LiveDataObjectInitializeState.pending,this._logger=new s.LiveTelemetryLogger(this.runtime,this.liveRuntime),this._allowedRoles=m||[],this._currentPresence={clientId:yield this.waitUntilConnected(),name:"UpdatePresence",timestamp:0,data:{state:S,data:g}},this._synchronizer=new i.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentPresence.data,(v,y,b)=>e(this,void 0,void 0,function*(){return yield this.updateMembersList(v,b),!1}),v=>e(this,void 0,void 0,function*(){if(v)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}),!0)}catch(v){throw this.initializeState=u.LiveDataObjectInitializeState.fatalError,v}this.initializeState=u.LiveDataObjectInitializeState.succeeded,yield this.updateInternal(this._currentPresence.data.data,this._currentPresence.data.state,!0,!0).catch(()=>{})})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}getUsers(g){return g?this._users.filter(S=>S.state==g):this._users}update(g,S){return e(this,void 0,void 0,function*(){return yield this.updateInternal(g,S)})}getUserForClient(g){return this._users.find(S=>S.isFromClient(g))}getUser(g){return this._users.find(S=>S.userId==g)}updateInternal(g,S,m=!1,v=!1){var y;return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LivePresence:updateInternal","update",this.initializeState),a.UnexpectedError.assert(!!this._synchronizer,"LivePresence:updateInternal","this._synchronizer is undefined, implying there was an error during initialization that should not occur."),a.UnexpectedError.assert(!!this._currentPresence,"LivePresence:updateInternal","this._currentPresence is undefined, implying there was an error during initialization that should not occur.");const b={state:S??this._currentPresence.data.state,data:(y=(0,o.cloneValue)(g))!==null&&y!==void 0?y:this._currentPresence.data.data};if(!v||this.liveRuntime.canSendBackgroundUpdates){const w=m?yield this._synchronizer.sendThrottledEvent(b):yield this._synchronizer.sendEvent(b);yield this.updateMembersList(w,!0)}else{const w={data:b,name:"",clientId:yield this.waitUntilConnected(),timestamp:1};yield this.updateMembersList(w,!0)}})}updateMembersList(g,S){var m;return e(this,void 0,void 0,function*(){try{if(!(yield this.liveRuntime.verifyRolesAllowed(g.clientId,this._allowedRoles)))return!1;S&&(this._currentPresence=g);const y=yield this.liveRuntime.getClientInfo(g.clientId);return y?this.useTransientParticipantWorkaround(y)?this.transientParticipantWorkaround(g,S,y):this.updateMembersListWithInfo(g,S,y):!1}catch(v){(m=this._logger)===null||m===void 0||m.sendErrorEvent(o.TelemetryEvents.LiveState.RoleVerificationError,v)}return!1})}useTransientParticipantWorkaround(g){const S={userId:g.userId,roles:[u.UserMeetingRole.guest],displayName:void 0};return JSON.stringify(g)===JSON.stringify(S)}transientParticipantWorkaround(g,S,m){const v=this._users.find(y=>y.userId===m.userId);if(v){const y={userId:v.userId,roles:v.roles,displayName:v.displayName};return this.updateMembersListWithInfo(g,S,y)}return this.updateMembersListWithInfo(g,S,m)}updateMembersListWithInfo(g,S,m){const v=_=>{var E,P;this._lastEmitPresenceStateMap.set(_.userId,_.state),this.emit(h.presenceChanged,_,S,g.clientId),S?(E=this._logger)===null||E===void 0||E.sendTelemetryEvent(o.TelemetryEvents.LivePresence.LocalPresenceChanged,null,{user:JSON.stringify(g)}):(P=this._logger)===null||P===void 0||P.sendTelemetryEvent(o.TelemetryEvents.LivePresence.RemotePresenceChanged,null,{user:JSON.stringify(g)})};let y=!1,b=!0;for(let _=0;_<this._users.length;_++){const E=this._users[_];m.userId===E.userId?(E.updateReceived(g,m,S)&&(v(E),y=!0),b=!1):this._lastEmitPresenceStateMap.get(E.userId)!==E.state&&(v(E),y=!0)}if(!b)return y;const w=new r.LivePresenceUser(m,g,this._expirationPeriod,this.liveRuntime,S);return this._users.push(w),v(w),!0}}f.TypeName="@microsoft/live-share:LivePresence",f.factory=new t.DataObjectFactory(f.TypeName,f,[],{}),n.LivePresence=f,c.DynamicObjectRegistry.registerObjectClass(f,f.TypeName)})(jS);var dN={},BS={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(p,g,S,m){function v(y){return y instanceof S?y:new S(function(b){b(y)})}return new(S||(S=Promise))(function(y,b){function w(P){try{E(m.next(P))}catch(A){b(A)}}function _(P){try{E(m.throw(P))}catch(A){b(A)}}function E(P){P.done?y(P.value):v(P.value).then(w,_)}E((m=m.apply(p,g||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveState=n.LiveStateEvents=void 0;const t=Va,r=Wa,i=Jn,s=Qn(),o=wo(),a=Eo,l=Qa(),c=Co,u=yi,d=Ja();var h;(function(p){p.stateChanged="stateChanged"})(h=n.LiveStateEvents||(n.LiveStateEvents={}));class f extends d.LiveDataObject{get state(){return this.latestEvent.data}initialize(g,S){return e(this,void 0,void 0,function*(){o.LiveDataObjectInitializeNotNeededError.assert("LiveState:initialize",this.initializeState),o.UnexpectedError.assert(!this._synchronizer,"LiveState:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._logger=new a.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.latestEvent={clientId:"",name:"ChangeState",timestamp:0,data:g},this._allowedRoles=S||[],this._synchronizer=new c.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(g,(m,v,y)=>e(this,void 0,void 0,function*(){return yield this.onReceivedStateEvent(m,v,y)}),m=>e(this,void 0,void 0,function*(){if(m)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(m){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,m}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}set(g){return e(this,void 0,void 0,function*(){o.LiveDataObjectNotInitializedError.assert("LiveState:set","set",this.initializeState);const S=(0,s.cloneValue)(g),m=yield this._synchronizer.sendEvent(S);this.updateState(m,!0)})}get latestEvent(){return(0,r.assert)(this._latestEvent!==void 0,"LiveState is not initialized"),this._latestEvent}set latestEvent(g){this._latestEvent=g}onReceivedStateEvent(g,S,m){var v;return e(this,void 0,void 0,function*(){try{return!(yield this.liveRuntime.verifyRolesAllowed(S,this._allowedRoles))||!l.LiveEvent.isNewer(this.latestEvent,g)||JSON.stringify(this.latestEvent.data)===JSON.stringify(g.data)?!1:(this.updateState(g,m),!0)}catch(y){return(v=this._logger)===null||v===void 0||v.sendErrorEvent(s.TelemetryEvents.LiveState.RoleVerificationError,y),!1}})}updateState(g,S){var m;const v=this.latestEvent.data,y=g.data;this.latestEvent=g,this.emit(h.stateChanged,(0,s.cloneValue)(g.data),S,g.clientId,g.timestamp),(m=this._logger)===null||m===void 0||m.sendTelemetryEvent(s.TelemetryEvents.LiveState.StateChanged,null,{oldState:JSON.stringify(v),newState:JSON.stringify(y)})}}f.TypeName="@microsoft/live-share:LiveState",f.factory=new t.DataObjectFactory(f.TypeName,f,[],{}),n.LiveState=f,u.DynamicObjectRegistry.registerObjectClass(f,f.TypeName)})(BS);(function(n){var e=K&&K.__awaiter||function(S,m,v,y){function b(w){return w instanceof v?w:new v(function(_){_(w)})}return new(v||(v=Promise))(function(w,_){function E(F){try{A(y.next(F))}catch(X){_(X)}}function P(F){try{A(y.throw(F))}catch(X){_(X)}}function A(F){F.done?w(F.value):b(F.value).then(E,P)}A((y=y.apply(S,m||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveFollowMode=n.FollowModeType=n.LiveFollowModeEvents=void 0;const t=Ja(),r=BS,i=jS,s=Va,o=Wa,a=Jn,l=Eo,c=Mf(),u=yi,d=wo();(function(S){S.stateChanged="stateChanged",S.presenceChanged="presenceChanged"})(n.LiveFollowModeEvents||(n.LiveFollowModeEvents={}));var h;(function(S){S.local="local",S.activeFollowers="activeFollowers",S.activePresenter="activePresenter",S.followPresenter="followPresenter",S.suspendFollowPresenter="suspendFollowPresenter",S.followUser="followUser",S.suspendFollowUser="suspendFollowUser"})(h=n.FollowModeType||(n.FollowModeType={}));const f="@microsoft/live-share:LiveFollowMode:LiveState",p="@microsoft/live-share:LiveFollowMode:LivePresence";class g extends t.LiveDataObject{constructor(){super(...arguments),this._suspended=!1}get state(){const m=this.presence.localUser;if(!m||!m.data)return;const v=this.presentingUserIdState.state?this.presence.getUser(this.presentingUserIdState.state):void 0;if(v&&v.data){const w=this.getUsers(c.PresenceState.online).length-1;return v.isLocalUser?{value:v.data.stateValue,followingUserId:v.userId,type:h.activePresenter,otherUsersCount:w,isLocalValue:!0}:this._suspended?{value:m.data.stateValue,followingUserId:v.userId,type:h.suspendFollowPresenter,otherUsersCount:w-1,isLocalValue:!0}:{value:v.data.stateValue,followingUserId:v.userId,type:h.followPresenter,otherUsersCount:w-1,isLocalValue:!1}}const y=m.data.followingUserId?this.presence.getUser(m.data.followingUserId):void 0;if(y&&y.data){const w=this.getUserFollowers(y.userId,c.PresenceState.online).length-1;return this._suspended?{value:m.data.stateValue,followingUserId:y.userId,type:h.suspendFollowUser,otherUsersCount:w,isLocalValue:!0}:{value:y.data.stateValue,followingUserId:y.userId,type:h.followUser,otherUsersCount:w,isLocalValue:!1}}const b=this.getUserFollowers(m.userId,c.PresenceState.online).length;return b>0?{value:m.data.stateValue,followingUserId:m.userId,type:h.activeFollowers,otherUsersCount:b,isLocalValue:!0}:{value:m.data.stateValue,followingUserId:m.userId,type:h.local,otherUsersCount:this.getUserFollowers(m.userId,c.PresenceState.online).length,isLocalValue:!0}}get localUser(){return this.presence.localUser}get presentingUserIdState(){return d.UnexpectedError.assert(this._presentingUserIdState!==void 0,"LiveFollowMode:presentingUserIdState","This happens when `hasInitialized()` has not yet resolved, which should not happen."),this._presentingUserIdState}get presence(){return(0,o.assert)(this._presence!==void 0,"_presence not initialized"),this._presence}initialize(m,v){return e(this,void 0,void 0,function*(){d.LiveDataObjectInitializeNotNeededError.assert("LiveFollowMode:initialize",this.initializeState),this.initializeState=a.LiveDataObjectInitializeState.pending,this._logger=new l.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.presentingUserIdState.on("stateChanged",(y,b,w)=>{this._suspended=!1,this.handlePotentialStateChange(b,w)}),this.presence.on("presenceChanged",(y,b,w)=>{this.handlePotentialStateChange(b,w),this.emit("presenceChanged",y,b,w)});try{yield Promise.all([this.presentingUserIdState.initialize(void 0,v),this.presence.initialize({stateValue:m,followingUserId:void 0})])}catch(y){throw this.initializeState=a.LiveDataObjectInitializeState.fatalError,y}this.initializeState=a.LiveDataObjectInitializeState.succeeded})}update(m){var v;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:update","update",this.initializeState),d.UnexpectedError.assert(!!(!((v=this.presence.localUser)===null||v===void 0)&&v.data),"LiveFollowMode:update","invalid local user's current state value when calling `.update()`, implying there was an error during initialization that should not occur."),yield this.presence.update({stateValue:m,followingUserId:this.presence.localUser.data.followingUserId})})}startPresenting(){var m;return e(this,void 0,void 0,function*(){if(d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:startPresenting","startPresenting",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:startPresenting","invalid local user's current state value when calling `.startPresenting()`, implying there was an error during initialization that should not occur."),this.presence.localUser.userId===this.presentingUserIdState.state)throw new Error("LiveFollowMode:startPresenting - the local user is already the active presenter. To stop presenting, use the `.stopPresenting()` function.");yield this.presentingUserIdState.set(this.presence.localUser.userId)})}stopPresenting(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopPresenting","stopPresenting",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:stopPresenting","invalid local user's current state value when calling `.stopPresenting()`, implying there was an error during initialization that should not occur."),yield this.presentingUserIdState.set(void 0)})}beginSuspension(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:beginSuspension","beginSuspension",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:beginSuspension","invalid local user's current state value when calling `.beginSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!0,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}endSuspension(){var m;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:endSuspension","endSuspension",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:endSuspension","invalid local user's current state value when calling `.endSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!1,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}followUser(m){var v;return e(this,void 0,void 0,function*(){d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:followUser","followUser",this.initializeState),d.UnexpectedError.assert(!!(!((v=this.presence.localUser)===null||v===void 0)&&v.data),"LiveFollowMode:followUser","invalid local user's current state value when calling `.followUser()`, implying there was an error during initialization that should not occur.");const y=this.presence.getUser(m);if(!y)throw new Error(`LiveFollowMode:followUser - cannot find user for provided \`userId\` of ${m}. Ensure remote user for this userId has also called \`.initialize()\`.`);if(y.isLocalUser)throw new Error("LiveFollowMode:followUser - local user cannot follow themselves. If you are trying to stop following another user, instead use the `.stopFollowing()` function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:m})})}stopFollowing(){var m;return e(this,void 0,void 0,function*(){if(d.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopFollowing","stopFollowing",this.initializeState),d.UnexpectedError.assert(!!(!((m=this.presence.localUser)===null||m===void 0)&&m.data),"LiveFollowMode:stopFollowing","invalid local user's current state value when calling `.stopFollowing()`, implying there was an error during initialization that should not occur."),!this.presence.localUser.data.followingUserId)throw new Error("LiveFollowMode:stopFollowing - the local user is not following another user.\nTo fix this error, ensure that `.followUser()` has resolved before calling this function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:void 0})})}getUsers(m){return this.presence.getUsers(m)}getUser(m){return this.presence.getUser(m)}getUserForClient(m){return this.presence.getUserForClient(m)}getUserFollowers(m,v){return this.getUsers(v).filter(b=>{var w;return((w=b.data)===null||w===void 0?void 0:w.followingUserId)===m})}dispose(){super.dispose(),this.presence.dispose(),this.presentingUserIdState.dispose()}initializingFirstTime(){return e(this,void 0,void 0,function*(){const m=r.LiveState.factory.createChildInstance(this.context),v=i.LivePresence.factory.createChildInstance(this.context);try{const[y,b]=yield Promise.all([m,v]);this.root.set(f,y.handle),this.root.set(p,b.handle)}catch(y){console.log(y)}})}hasInitialized(){return e(this,void 0,void 0,function*(){const m=this.root.get(f),v=this.root.get(p),[y,b]=yield Promise.all([m==null?void 0:m.get(),v==null?void 0:v.get()]);y==null||y.__dangerouslySetLiveRuntime(this.liveRuntime),b==null||b.__dangerouslySetLiveRuntime(this.liveRuntime),this._presentingUserIdState=y,this._presence=b})}handlePotentialStateChange(m,v){const y=this.state;JSON.stringify(y)!==JSON.stringify(this._recentState)&&(this._recentState=y,this.emit("stateChanged",y,m,v))}}g.TypeName="@microsoft/live-share:LiveFollowMode",g.factory=new s.DataObjectFactory(g.TypeName,g,[],{},new Map([r.LiveState.factory.registryEntry,i.LivePresence.factory.registryEntry])),n.LiveFollowMode=g,u.DynamicObjectRegistry.registerObjectClass(g,g.TypeName)})(dN);var Df={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class hN extends Tk{createServiceMember(e){const t=e.user;return tr((t==null?void 0:t.name)!==void 0,'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Kv;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(Kv||(Kv={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var ph;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(ph||(ph={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function kc(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Ff(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const fN=(n,e)=>pN.from(n,e).buffer;function T1(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}let pN=class Ls extends Uint8Array{toString(e){return Ff(this,e)}static from(e,t,r){if(typeof e=="string")return Ls.fromString(e,t);if(e!==null&&typeof e=="object"&&T1(e.buffer))return kc(e.byteOffset===0,0),kc(e.byteLength===e.buffer.byteLength,1),Ls.fromArrayBuffer(e.buffer,t,r);if(T1(e))return Ls.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new Ls(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new Ls(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new Ls(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const NQ=n=>pN.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class LQ{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const IQ=2e3;class AQ{constructor(e,t,r,i){this.tenantId=e,this.id=t,this.deltaStorageService=r,this.documentStorageService=i,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,r,i,s){return i?N5:k5(this.getCore.bind(this),1,e,t,IQ,new LQ,r,s)}async getCore(e,t){const r=this.logtailSha?await mt(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,r.length>0){const i=r.filter(s=>s.sequenceNumber>=e);if(i.length>0)return{messages:i,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)}}class MQ{constructor(e,t,r,i=async()=>this.restWrapper,s=()=>this.url){this.url=e,this.restWrapper=t,this.logger=r,this.getRestWrapper=i,this.getDeltaStorageUrl=s}async get(e,t,r,i){return{messages:await he.timedExecAsync(this.logger,{eventName:"getDeltas",from:r,to:i},async o=>{const a=await this.getRestWrapper(),l=this.getDeltaStorageUrl(),c=await a.get(l,{from:r-1,to:i});return o.end({count:c.length}),c}),partialResult:!1}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Lo extends Error{constructor(e,t,r,i,s){super(t),this.code=e,this.canRetry=r,this.isFatal=i,this.retryAfterMs=s,this.name="NetworkError",this.retryAfter=s!==void 0?s/1e3:void 0}get details(){return this.canRetry===void 0&&this.isFatal===void 0&&this.retryAfterMs===void 0?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function Um(n,e){var t;let r,i,s,o;switch(e&&typeof e=="object"?(r=(t=e.message)!==null&&t!==void 0?t:"Unknown Error",i=e.canRetry,s=e.isFatal,o=e.retryAfter):e&&typeof e=="string"?r=e:r="Unknown Error",n){case 401:case 403:case 404:return new Lo(n,r,!1,!1);case 413:case 422:return new Lo(n,r,i??!1,s??!1,i?o:void 0);case 429:return new Lo(n,r,!0,!1,o);case 500:return new Lo(n,r,i??!0,s??!1,i?o:void 0);case 502:case 503:case 504:return new Lo(n,r,!0,!1,o);default:return new Lo(n,r,!1,!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Hm="x-correlation-id";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qi(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function US(n,e){switch(e){case"base64":return dr(n);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(n);default:throw new Error("invalid/unsupported encoding")}}const DQ=(n,e)=>ir.from(n,e).buffer;function x1(n){const e=n;return n instanceof ArrayBuffer||typeof e=="object"&&e!==null&&typeof e.byteLength=="number"&&typeof e.slice=="function"&&e.byteOffset===void 0&&e.buffer===void 0}class ir extends Uint8Array{toString(e){return US(this,e)}static from(e,t,r){if(typeof e=="string")return ir.fromString(e,t);if(e!==null&&typeof e=="object"&&x1(e.buffer))return qi(e.byteOffset===0,0),qi(e.byteLength===e.buffer.byteLength,1),ir.fromArrayBuffer(e.buffer,t,r);if(x1(e))return ir.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const i=t??0,s=r??e.byteLength-i;if(i<0||i>e.byteLength||s<0||s+i>e.byteLength)throw new RangeError;return new ir(e,i,s)}static fromString(e,t){switch(t){case"base64":{const r=this.sanitizeBase64(e),i=Si(r);return new ir(i.buffer)}case"utf8":case"utf-8":case void 0:{const r=new TextEncoder().encode(e);return new ir(r.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!==0&&(t+=["","===","==","="][t.length%4]),t}}async function FQ(n,e){const t=await crypto.subtle.digest(e,n);return new Uint8Array(t)}function zQ(n,e){switch(e){case"hex":return Array.prototype.map.call(n,r=>r.toString(16).padStart(2,"0")).join("");case"base64":return dr(n)}}async function $Q(n,e="SHA-1",t="hex"){if(crypto.subtle===void 0)return nP(()=>import("./hashFileNode-4c7775c7.js"),["assets/hashFileNode-4c7775c7.js","assets/sha256-2b2d765b.js"]).then(async i=>i.hashFile(n,e,t));const r=await FQ(n,e);return zQ(r,t)}async function jQ(n){const t=`blob ${n.byteLength.toString()}${String.fromCharCode(0)}`,r=ir.from(t+n.toString());return $Q(r)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const qQ=n=>ir.from(n,"utf8").toString("base64");/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function mN(n,e="Unreachable Case"){throw new Error(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Jv;(function(n){n.File="100644",n.Executable="100755",n.Directory="040000",n.Symlink="120000"})(Jv||(Jv={}));var Fs;(function(n){n.Blob="Blob",n.Tree="Tree",n.Attachment="Attachment"})(Fs||(Fs={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var $n;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})($n||($n={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const BQ="@fluidframework/server-services-client",UQ="0.1036.5002";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Us=iv.debug("fluid:services-client");Us(`Package: ${BQ} - Version: ${UQ}`);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class O1{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(e,t){const r=await this.historian.getHeader(t);for(const i of r.blobs)this.blobCache.set(i.sha,i);return A0(r.tree)}async getFullTree(e){return this.historian.getFullTree(e)}async getCommit(e){return this.commitCache.has(e)?(Us(`Cache hit on ${e}`),this.commitCache.get(e)):this.historian.getCommit(e)}async getCommits(e,t){let r=e;if(this.refCache.has(e)&&(Us(`Commit cache hit on ${e}`),r=this.refCache.get(e),this.refCache.delete(e),!r))return[];if(this.commitCache.has(r)){const i=this.commitCache.get(r);return[{commit:{author:i.author,committer:i.committer,message:i.message,tree:i.tree,url:i.url},parents:i.parents,sha:i.sha,url:i.url}]}return this.historian.getCommits(r,t)}async getTree(e,t=!0){return this.treeCache.has(e)?(Us(`Tree cache hit on ${e}`),this.treeCache.get(e)):this.historian.getTree(e,t)}async getBlob(e){return this.blobCache.has(e)?(Us(`Blob cache hit on ${e}`),this.blobCache.get(e)):this.historian.getBlob(e)}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}async getContent(e,t){return this.historian.getContent(t,e)}async createBlob(e,t){const r={content:e,encoding:t};return this.historian.createBlob(r)}async createGitTree(e){return this.historian.createTree(e)}async createTree(e){return this.createTreeCore(e,0)}async createCommit(e){return this.historian.createCommit(e)}async createSummary(e){return this.historian.createSummary(e)}async deleteSummary(e){return this.historian.deleteSummary(e)}async getSummary(e){return this.historian.getSummary(e)}async getRef(e){return this.historian.getRef(`heads/${e}`).catch(t=>{if(t===400||t===404)return null;throw t})}async createRef(e,t){const r={ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}};return this.historian.createRef(r)}async upsertRef(e,t){const r={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef(`heads/${e}`,r)}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}async write(e,t,r,i){const s=await this.createTree(t),o={author:{date:new Date().toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:r,tree:s.sha},a=await this.historian.createCommit(o);return await this.getRef(e)?await this.upsertRef(e,a.sha):await this.createRef(e,a.sha),a}async createTreeCore(e,t){if(e.id)return this.getTree(e.id);const r=[];for(const l of e.entries)switch(Fs[l.type]){case Fs.Blob:{const c=l.value;l.mode===Jv.Symlink&&(c.contents=this.translateSymlink(c.contents,t));const u=this.createBlob(c.contents,c.encoding);r.push(u);break}case Fs.Tree:{const c=l.value,u=this.createTreeCore(c,t+1);r.push(u);break}default:throw new Error("Unknown entry type")}const i=await Promise.all(r),s=[];qi(i.length===e.entries.length,"File entries length is not correct");for(let l=0;l<e.entries.length;l++){const c=e.entries[l].type===Fs.Tree?"tree":e.entries[l].type===Fs.Blob?"blob":"commit";s.push({mode:e.entries[l].mode,path:e.entries[l].path,sha:i[l].sha,type:c})}const o={tree:s};return this.historian.createTree(o)}translateSymlink(e,t){let r="";for(let i=0;i<=t;i++)r+="../";return`${r}${e}`}}var bl=function(n){switch(typeof n){case"string":return n;case"boolean":return n?"true":"false";case"number":return isFinite(n)?n:"";default:return""}},HQ=function(n,e,t,r){return e=e||"&",t=t||"=",n===null&&(n=void 0),typeof n=="object"?Object.keys(n).map(function(i){var s=encodeURIComponent(bl(i))+t;return Array.isArray(n[i])?n[i].map(function(o){return s+encodeURIComponent(bl(o))}).join(e):s+encodeURIComponent(bl(n[i]))}).filter(Boolean).join(e):r?encodeURIComponent(bl(r))+t+encodeURIComponent(bl(n)):""},gN;gN=HQ;var Qv={exports:{}};(function(n,e){e=n.exports=t,e.getSerialize=r;function t(i,s,o,a){return JSON.stringify(i,r(s,a),o)}function r(i,s){var o=[],a=[];return s==null&&(s=function(l,c){return o[0]===c?"[Circular ~]":"[Circular ~."+a.slice(0,o.indexOf(c)).join(".")+"]"}),function(l,c){if(o.length>0){var u=o.indexOf(this);~u?o.splice(u+1):o.push(this),~u?a.splice(u,1/0,l):a.push(l),~o.indexOf(c)&&(c=s.call(this,l,c))}else o.push(c);return i==null?c:i.call(this,l,c)}}})(Qv,Qv.exports);var VQ=Qv.exports;const Xv=pi(VQ);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class vN{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=r,this.maxContentLength=i}async get(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(i,200)}async post(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(r)}`};return this.request(s,201)}async delete(e,t,r){const i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(i,204)}async patch(e,t,r,i){const s={baseURL:this.baseurl,data:t,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(r)}`};return this.request(s,200)}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),r=gN(t);if(r!=="")return`?${r}`}return""}}class WQ extends vN{constructor(e,t={},r=1e3*1024*1024,i=1e3*1024*1024,s={},o=kR,a,l,c){super(e,t,r,i),this.defaultHeaders=s,this.axios=o,this.refreshDefaultQueryString=a,this.refreshDefaultHeaders=l,this.getCorrelationId=c}async request(e,t,r=!0){var i,s;const o=Object.assign({},e);return o.headers=this.generateHeaders(o.headers,(s=(i=this.getCorrelationId)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:ot()),new Promise((a,l)=>{this.axios.request(o).then(c=>{a(c.data)}).catch(c=>{var u,d,h,f,p,g,S,m,v,y,b,w,_,E;if(((u=c==null?void 0:c.response)===null||u===void 0?void 0:u.status)===t&&a((d=c==null?void 0:c.response)===null||d===void 0?void 0:d.data),c!=null&&c.config?Us(`[${c.config.method}] request to [${(h=c.config.baseURL)!==null&&h!==void 0?h:""}${(f=c.config.url)!==null&&f!==void 0?f:""}] failed with [${(p=c.response)===null||p===void 0?void 0:p.status}] [${Xv((g=c.response)===null||g===void 0?void 0:g.data,void 0,2)}]`):Us(`request to ${o.url} failed ${c?c.message:""}`),((S=c==null?void 0:c.response)===null||S===void 0?void 0:S.status)===429&&((v=(m=c==null?void 0:c.response)===null||m===void 0?void 0:m.data)===null||v===void 0?void 0:v.retryAfter)>0&&r)setTimeout(()=>{this.request(o,t).then(a).catch(l)},c.response.data.retryAfter*1e3);else if(((y=c==null?void 0:c.response)===null||y===void 0?void 0:y.status)===401&&r&&this.refreshOnAuthError()){const P=Object.assign({},e);P.headers=this.generateHeaders(P.headers,o.headers[Hm]),this.request(P,t,!1).then(a).catch(l)}else if(c!=null&&c.response)l(Um((b=c==null?void 0:c.response)===null||b===void 0?void 0:b.status,(w=c==null?void 0:c.response)===null||w===void 0?void 0:w.data));else if(c!=null&&c.request)l(Um(502,`Network Error: ${(_=c==null?void 0:c.message)!==null&&_!==void 0?_:"undefined"}`));else{const P={canRetry:!1,isFatal:!1,message:(E=c==null?void 0:c.message)!==null&&E!==void 0?E:"Unknown Error"};l(Um(500,P))}})})}generateHeaders(e,t){let r=e??{};return this.defaultHeaders&&(r=Object.assign(Object.assign({},this.defaultHeaders),e)),r[Hm]?r:Object.assign({[Hm]:t},r)}refreshOnAuthError(){return this.refreshDefaultQueryString===void 0&&this.refreshDefaultHeaders===void 0?!1:(this.refreshDefaultHeaders!==void 0&&(this.defaultHeaders=this.refreshDefaultHeaders()),this.refreshDefaultQueryString!==void 0&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function GQ(n,e){for(const t of e)if(n.endsWith(t))return!0;return!1}const KQ=n=>`Basic ${qQ(`${n.user}:${n.password}`)}`;class P1{constructor(e,t,r,i){this.endpoint=e,this.historianApi=t,this.restWrapper=i,this.defaultQueryString={},r&&this.historianApi?(this.defaultQueryString.disableCache=r,this.cacheBust=!1):this.cacheBust=r,this.restWrapper===void 0&&(this.restWrapper=new WQ(this.endpoint))}async getHeader(e){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(e)}`,this.getQueryString()):this.getHeaderDirect(e)}async getFullTree(e){return this.restWrapper.get(`/tree/${encodeURIComponent(e)}`,this.getQueryString())}async getBlob(e){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,this.getQueryString())}async createBlob(e){return this.restWrapper.post("/git/blobs",e,this.getQueryString())}async getContent(e,t){return this.restWrapper.get(`/contents/${e}`,this.getQueryString({ref:t}))}async getCommits(e,t){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch(r=>r===400||r===404?[]:Promise.reject(r))}async getCommit(e){return this.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,this.getQueryString())}async createCommit(e){return this.restWrapper.post("/git/commits",e,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(e){return this.restWrapper.get(`/git/refs/${e}`,this.getQueryString())}async createRef(e){return this.restWrapper.post("/git/refs",e,this.getQueryString())}async updateRef(e,t){return this.restWrapper.patch(`/git/refs/${e}`,t,this.getQueryString())}async deleteRef(e){await this.restWrapper.delete(`/git/refs/${e}`,this.getQueryString())}async createTag(e){return this.restWrapper.post("/git/tags",e,this.getQueryString())}async getTag(e){return this.restWrapper.get(`/git/tags/${e}`,this.getQueryString())}async createTree(e){return this.restWrapper.post("/git/trees",e,this.getQueryString())}async getTree(e,t){return this.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,this.getQueryString({recursive:t?1:0}))}async createSummary(e){return this.restWrapper.post("/git/summaries",e,this.getQueryString())}async deleteSummary(e){const t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)}async getSummary(e){return this.restWrapper.get(`/git/summaries/${e}`,this.getQueryString())}async getHeaderDirect(e){const t=await this.getTree(e,!0),r=[".attributes",".blobs",".messages","header"],i=[];for(const o of t.tree)if(o.type==="blob"&&GQ(o.path,r)){const a=this.getBlob(o.sha);i.push(a)}return{blobs:await Promise.all(i),tree:t}}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Jl;(function(n){n.Method="method",n.Header="header",n.Body="body"})(Jl||(Jl={}));const JQ=(n,e)=>`${n}: ${e}`;class QQ{translate(e){var t,r;const i=Object.assign({},e),s=new URLSearchParams;if(s.append(Jl.Method,(t=i.method)!==null&&t!==void 0?t:"GET"),i.headers)for(const[o,a]of Object.entries(i.headers)){const l=JQ(o,a);s.append(Jl.Header,l)}if(i.data&&["post","put","patch"].includes((r=i.method)===null||r===void 0?void 0:r.toLowerCase())){const o=JSON.stringify(i.data);s.append(Jl.Body,o)}return i.data=s.toString(),i.method="POST",i.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},i}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Vm=(...n)=>n.map(e=>e.replace(/^\//,"").replace(/\/$/,"")).filter(e=>!!e).join("/");function yN(n,e,t="",r=""){const i={type:"tree",entries:[]},s=Object.keys(e.tree);for(const o of s){const a=e.tree[o];let l,c,u;const d=Vm(t===""?r:t,o);switch(a.type){case $n.Tree:{c=yN(n,a,d,r),u=a.unreferenced||void 0;break}case $n.Blob:{typeof a.content=="string"?c={type:"blob",content:a.content,encoding:"utf-8"}:c={type:"blob",content:US(a.content,"base64"),encoding:"base64"};break}case $n.Handle:{if(a.embedded)l=a.handle;else{if(!n)throw Error("Parent summary does not exist to reference by handle.");l=Vm(n,r,a.handle)}break}case $n.Attachment:{l=a.id;break}default:mN(a,`Unknown type: ${a.type}`)}const h={path:encodeURIComponent(o),type:AP(a)};let f;if(c)qi(l===void 0,173),f=Object.assign({value:c,unreferenced:u},h);else if(l)f=Object.assign(Object.assign({},h),{id:l});else throw new Error(`Invalid tree entry for ${a.type}`);i.entries.push(f)}return i}function XQ(n,e){const t={},r={id:n.id,blobs:{},trees:{}};t[""]=r;for(const i of n.entries){const s=i.path.replace(new RegExp(`^${e}/`),""),o=s.lastIndexOf("/"),a=s.slice(0,Math.max(0,o)),l=s.slice(o+1),c=t[a];if(i.type==="tree"){const u={blobs:{},trees:{},unreferenced:i.unreferenced};c.trees[decodeURIComponent(l)]=u,t[s]=u}else if(i.type==="blob")c.blobs[decodeURIComponent(l)]=i.id;else throw new Error("Unknown entry type!!")}return r}function R1(n,e=".app"){var t;const r=new Map;n.blobs&&n.blobs.forEach(a=>{var l;r.set(a.id,DQ(a.content,(l=a.encoding)!==null&&l!==void 0?l:"utf-8"))});const i=(t=n.trees)===null||t===void 0?void 0:t[0],s=i==null?void 0:i.sequenceNumber,o=XQ(i,e);return{blobs:r,snapshotTree:o,sequenceNumber:s}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class YQ{constructor(e,t,r){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=r}async writeSummaryTree(e,t,r,i){const s=await this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,s??void 0)}async writeSummaryTreeCore(e,t){const r=await Promise.all(Object.keys(e.tree).map(async s=>{const o=e.tree[s],a=await this.writeSummaryTreeObject(o,t);return{mode:OH(o),path:encodeURIComponent(s),sha:a,type:AP(o)}}));return(await this.manager.createGitTree({tree:r})).sha}async writeSummaryTreeObject(e,t){switch(e.type){case $n.Blob:return this.writeSummaryBlob(e.content);case $n.Handle:{if(t===void 0)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t)}case $n.Tree:return this.writeSummaryTreeCore(e,t);case $n.Attachment:return e.id;default:mN(e,`Unknown type: ${e.type}`)}}async writeSummaryBlob(e){const{parsedContent:t,encoding:r}=typeof e=="string"?{parsedContent:e,encoding:"utf-8"}:{parsedContent:US(e,"base64"),encoding:"base64"},i=await jQ(ir.from(t,r));if(!this.blobsShaCache.has(i)){this.blobsShaCache.set(i,"");const s=await this.manager.createBlob(t,r);qi(i===s.sha,182)}return i}getIdFromPath(e,t,r){const i=t.split("/").map(s=>decodeURIComponent(s));return i[0]===""&&i.shift(),i.length===0?r.id:this.getIdFromPathCore(e,i,r)}getIdFromPathCore(e,t,r){var i;qi(t.length>0,179);const s=t[0];if(t.length===1)switch(e){case $n.Blob:{const o=r.blobs[s];return qi(!!o,180),o}case $n.Tree:{const o=(i=r.trees[s])===null||i===void 0?void 0:i.id;return qi(!!o,181),o}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),r.trees[s])}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class ZQ{constructor(e){this.manager=e}async writeSummaryTree(e,t,r,i){const s=await this.writeSummaryTreeCore(t,e,r,i??0);if(!s)throw new Error("Failed to write summary tree");return s}async writeSummaryTreeCore(e,t,r,i){const o={entries:yN(e,t,"",r==="channel"?".app":"").entries,message:void 0,sequenceNumber:i,type:r};return this.manager.createSummary(o).then(a=>a.id)}}const $r=Object.create(null);$r.open="0";$r.close="1";$r.ping="2";$r.pong="3";$r.message="4";$r.upgrade="5";$r.noop="6";const hd=Object.create(null);Object.keys($r).forEach(n=>{hd[$r[n]]=n});const Yv={type:"error",data:"parser error"},SN=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",bN=typeof ArrayBuffer=="function",wN=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,HS=({type:n,data:e},t,r)=>SN&&e instanceof Blob?t?r(e):k1(e,r):bN&&(e instanceof ArrayBuffer||wN(e))?t?r(e):k1(new Blob([e]),r):r($r[n]+(e||"")),k1=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function N1(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let Wm;function eX(n,e){if(SN&&n.data instanceof Blob)return n.data.arrayBuffer().then(N1).then(e);if(bN&&(n.data instanceof ArrayBuffer||wN(n.data)))return e(N1(n.data));HS(n,!1,t=>{Wm||(Wm=new TextEncoder),e(Wm.encode(t))})}const L1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pl=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<L1.length;n++)Pl[L1.charCodeAt(n)]=n;const tX=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,a,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(r=0;r<t;r+=4)s=Pl[n.charCodeAt(r)],o=Pl[n.charCodeAt(r+1)],a=Pl[n.charCodeAt(r+2)],l=Pl[n.charCodeAt(r+3)],u[i++]=s<<2|o>>4,u[i++]=(o&15)<<4|a>>2,u[i++]=(a&3)<<6|l&63;return c},nX=typeof ArrayBuffer=="function",VS=(n,e)=>{if(typeof n!="string")return{type:"message",data:CN(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:rX(n.substring(1),e)}:hd[t]?n.length>1?{type:hd[t],data:n.substring(1)}:{type:hd[t]}:Yv},rX=(n,e)=>{if(nX){const t=tX(n);return CN(t,e)}else return{base64:!0,data:n}},CN=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},EN=String.fromCharCode(30),iX=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,o)=>{HS(s,!1,a=>{r[o]=a,++i===t&&e(r.join(EN))})})},sX=(n,e)=>{const t=n.split(EN),r=[];for(let i=0;i<t.length;i++){const s=VS(t[i],e);if(r.push(s),s.type==="error")break}return r};function oX(){return new TransformStream({transform(n,e){eX(n,t=>{const r=t.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let Gm;function ju(n){return n.reduce((e,t)=>e+t.length,0)}function qu(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)t[i]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function aX(n,e){Gm||(Gm=new TextDecoder);const t=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(r===0){if(ju(t)<1)break;const l=qu(t,1);s=(l[0]&128)===128,i=l[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(ju(t)<2)break;const l=qu(t,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(ju(t)<8)break;const l=qu(t,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,53-32)-1){a.enqueue(Yv);break}i=u*Math.pow(2,32)+c.getUint32(4),r=3}else{if(ju(t)<i)break;const l=qu(t,i);a.enqueue(VS(s?l:Gm.decode(l),e)),r=0}if(i===0||i>n){a.enqueue(Yv);break}}}})}const _N=4;function dt(n){if(n)return lX(n)}function lX(n){for(var e in dt.prototype)n[e]=dt.prototype[e];return n}dt.prototype.on=dt.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};dt.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};dt.prototype.off=dt.prototype.removeListener=dt.prototype.removeAllListeners=dt.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};dt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};dt.prototype.emitReserved=dt.prototype.emit;dt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};dt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const zf=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),jn=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),cX="arraybuffer";function TN(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const uX=jn.setTimeout,dX=jn.clearTimeout;function $f(n,e){e.useNativeTimers?(n.setTimeoutFn=uX.bind(jn),n.clearTimeoutFn=dX.bind(jn)):(n.setTimeoutFn=jn.setTimeout.bind(jn),n.clearTimeoutFn=jn.clearTimeout.bind(jn))}const hX=1.33;function fX(n){return typeof n=="string"?pX(n):Math.ceil((n.byteLength||n.size)*hX)}function pX(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function xN(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function mX(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function gX(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class vX extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class WS extends dt{constructor(e){super(),this.writable=!1,$f(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new vX(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=VS(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=mX(e);return t.length?"?"+t:""}}class yX extends WS{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};sX(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,iX(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=xN()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let ON=!1;try{ON=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const SX=ON;function bX(){}class wX extends yX{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Dr extends dt{constructor(e,t,r){super(),this.createRequest=e,$f(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=TN(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Dr.requestsCount++,Dr.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=bX,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Dr.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Dr.requestsCount=0;Dr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",I1);else if(typeof addEventListener=="function"){const n="onpagehide"in jn?"pagehide":"unload";addEventListener(n,I1,!1)}}function I1(){for(let n in Dr.requests)Dr.requests.hasOwnProperty(n)&&Dr.requests[n].abort()}const CX=function(){const n=PN({xdomain:!1});return n&&n.responseType!==null}();class EX extends wX{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=CX&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Dr(PN,this.uri(),e)}}function PN(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||SX))return new XMLHttpRequest}catch{}if(!e)try{return new jn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const RN=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class _X extends WS{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=RN?{}:TN(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;HS(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}i&&zf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=xN()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Km=jn.WebSocket||jn.MozWebSocket;class TX extends _X{createSocket(e,t,r){return RN?new Km(e,t,r):t?new Km(e,t):new Km(e)}doWrite(e,t){this.ws.send(t)}}class xX extends WS{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=aX(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),i=oX();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const s=()=>{r.read().then(({done:a,value:l})=>{a||(this.onPacket(l),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;this._writer.write(r).then(()=>{i&&zf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const OX={websocket:TX,webtransport:xX,polling:EX},PX=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,RX=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Zv(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=PX.exec(n||""),s={},o=14;for(;o--;)s[RX[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=kX(s,s.path),s.queryKey=NX(s,s.query),s}function kX(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function NX(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}const ey=typeof addEventListener=="function"&&typeof removeEventListener=="function",fd=[];ey&&addEventListener("offline",()=>{fd.forEach(n=>n())},!1);class is extends dt{constructor(e,t){if(super(),this.binaryType=cX,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=Zv(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=Zv(t.host).host);$f(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const i=r.prototype.name;this.transports.push(i),this._transportsByName[i]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=gX(this.opts.query)),ey&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},fd.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=_N,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&is.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",is.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(t+=fX(i)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,zf(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(is.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ey&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=fd.indexOf(this._offlineEventListener);r!==-1&&fd.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}is.protocol=_N;class LX extends is{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;is.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;is.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=t.name,this.emitReserved("upgradeError",h)}}))};function s(){r||(r=!0,u(),t.close(),t=null)}const o=d=>{const h=new Error("probe error: "+d);h.transport=t.name,s(),this.emitReserved("upgradeError",h)};function a(){o("transport closed")}function l(){o("socket closed")}function c(d){t&&d.name!==t.name&&s()}const u=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let IX=class extends LX{constructor(e,t={}){const r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(i=>OX[i]).filter(i=>!!i)),super(e,r)}};function AX(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=Zv(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}const MX=typeof ArrayBuffer=="function",DX=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,kN=Object.prototype.toString,FX=typeof Blob=="function"||typeof Blob<"u"&&kN.call(Blob)==="[object BlobConstructor]",zX=typeof File=="function"||typeof File<"u"&&kN.call(File)==="[object FileConstructor]";function GS(n){return MX&&(n instanceof ArrayBuffer||DX(n))||FX&&n instanceof Blob||zX&&n instanceof File}function pd(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(pd(n[t]))return!0;return!1}if(GS(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return pd(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&pd(n[t]))return!0;return!1}function $X(n){const e=[],t=n.data,r=n;return r.data=ty(t,e),r.attachments=e.length,{packet:r,buffers:e}}function ty(n,e){if(!n)return n;if(GS(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=ty(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=ty(n[r],e));return t}return n}function jX(n,e){return n.data=ny(n.data,e),delete n.attachments,n}function ny(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=ny(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=ny(n[t],e));return n}const qX=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],BX=5;var Se;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Se||(Se={}));class UX{constructor(e){this.replacer=e}encode(e){return(e.type===Se.EVENT||e.type===Se.ACK)&&pd(e)?this.encodeAsBinary({type:e.type===Se.EVENT?Se.BINARY_EVENT:Se.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Se.BINARY_EVENT||e.type===Se.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=$X(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function A1(n){return Object.prototype.toString.call(n)==="[object Object]"}class KS extends dt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Se.BINARY_EVENT;r||t.type===Se.BINARY_ACK?(t.type=r?Se.EVENT:Se.ACK,this.reconstructor=new HX(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(GS(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Se[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Se.BINARY_EVENT||r.type===Se.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(KS.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case Se.CONNECT:return A1(t);case Se.DISCONNECT:return t===void 0;case Se.CONNECT_ERROR:return typeof t=="string"||A1(t);case Se.EVENT:case Se.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&qX.indexOf(t[0])===-1);case Se.ACK:case Se.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class HX{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=jX(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const VX=Object.freeze(Object.defineProperty({__proto__:null,Decoder:KS,Encoder:UX,get PacketType(){return Se},protocol:BX},Symbol.toStringTag,{value:"Module"}));function nr(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const WX=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class NN extends dt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[nr(e,"open",this.onopen.bind(this)),nr(e,"packet",this.onpacket.bind(this)),nr(e,"error",this.onerror.bind(this)),nr(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,i,s;if(WX.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:Se.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const u=this.ids++,d=t.pop();this._registerAckCallback(u,d),o.id=u}const a=(i=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||i===void 0?void 0:i.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(s),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((r,i)=>{const s=(o,a)=>o?i(o):r(a);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Se.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Se.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Se.EVENT:case Se.BINARY_EVENT:this.onevent(e);break;case Se.ACK:case Se.BINARY_ACK:this.onack(e);break;case Se.DISCONNECT:this.ondisconnect();break;case Se.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Se.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Se.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Ya(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Ya.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};Ya.prototype.reset=function(){this.attempts=0};Ya.prototype.setMin=function(n){this.ms=n};Ya.prototype.setMax=function(n){this.max=n};Ya.prototype.setJitter=function(n){this.jitter=n};class ry extends dt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,$f(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Ya({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||VX;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new IX(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=nr(t,"open",function(){r.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=nr(t,"error",s);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(nr(e,"ping",this.onping.bind(this)),nr(e,"data",this.ondata.bind(this)),nr(e,"error",this.onerror.bind(this)),nr(e,"close",this.onclose.bind(this)),nr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){zf(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new NN(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const wl={};function md(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=AX(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=wl[i]&&s in wl[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new ry(r,e):(wl[i]||(wl[i]=new ry(r,e)),l=wl[i]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(md,{Manager:ry,Socket:NN,io:md,connect:md});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Na{constructor(){this.cache=new Map}async get(e){return this.cache.get(e)}async put(e,t){this.cache.set(e,t)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const M1="latest";class GX{constructor(e,t,r,i={},s,o=new Na,a=new Na,l,c=async u=>u&&this.noCacheGitManager!==void 0?this.noCacheGitManager:this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.driverPolicies=s,this.blobCache=o,this.snapshotTreeCache=a,this.noCacheGitManager=l,this.getStorageManager=c,this.firstVersionsCall=!0}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new ZQ(e)}async getVersions(e,t){var r;if(e!==this.id&&e!==null)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&t===1){this.firstVersionsCall=!1;const{id:o,snapshotTree:a}=!((r=this.driverPolicies)===null||r===void 0)&&r.enableDiscovery?await this.fetchAndCacheSnapshotTree(M1,!0):await this.fetchAndCacheSnapshotTree(M1,!1);return[{id:o,treeId:a.id}]}const i=e||this.id;return(await he.timedExecAsync(this.logger,{eventName:"getVersions",versionId:i,count:t},async()=>(await this.getStorageManager()).getCommits(i,t))).map(o=>({date:o.commit.author.date,id:o.sha,treeId:o.commit.tree.sha}))}async getSnapshotTree(e){let t=e;if(!t){const r=await this.getVersions(this.id,1);if(r.length===0)return null;t=r[0]}return(await this.fetchAndCacheSnapshotTree(t.id)).snapshotTree}async readBlob(e){const t=await this.blobCache.get(this.getCacheKey(e));if(t!==void 0)return t;const r=await he.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async s=>{const a=await(await this.getStorageManager()).getBlob(e);return s.end({size:a.size}),a}),i=fN(r.content,r.encoding);return await this.blobCache.put(this.getCacheKey(r.sha),i),i}async uploadSummaryWithContext(e,t){return await he.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){const t=await he.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},async s=>{var o;const l=await(await this.getStorageManager()).getSummary(e.handle);return s.end({size:(o=l.trees[0])===null||o===void 0?void 0:o.entries.length}),l}),{blobs:r,snapshotTree:i}=R1(t,"");return LR(i,r)}async createBlob(e){const t=new Uint8Array(e);return he.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Ff(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async fetchAndCacheSnapshotTree(e,t){const r=await this.snapshotTreeCache.get(this.getCacheKey(e));if(r!==void 0)return{id:r.id,snapshotTree:r.snapshotTree};const i=await he.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},async u=>{var d;const f=await(await this.getStorageManager(t)).getSummary(e);return u.end({size:(d=f.trees[0])===null||d===void 0?void 0:d.entries.length}),f}),s=R1(i),o=i.id,a=s.snapshotTree.id;kc(a!==void 0,629);const l={id:o,snapshotTree:s.snapshotTree},c=[this.snapshotTreeCache.put(this.getCacheKey(a),l),this.initBlobCache(s.blobs)];return a!==e&&c.push(this.snapshotTreeCache.put(this.getCacheKey(e),l)),await Promise.all(c),l}async initBlobCache(e){const t=[];e.forEach((r,i)=>{const s=this.getCacheKey(i);t.push(this.blobCache.put(s,r))}),await Promise.all(t)}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class KX{constructor(e,t){this.internalGitManager=e,this.logger=t}async getHeader(e,t){return this.runWithRetry(async()=>this.internalGitManager.getHeader(e,t),"gitManager_getHeader")}async getFullTree(e){return this.runWithRetry(async()=>this.internalGitManager.getFullTree(e),"gitManager_getFullTree")}async getCommit(e){return this.runWithRetry(async()=>this.internalGitManager.getCommit(e),"gitManager_getCommit")}async getCommits(e,t){return this.runWithRetry(async()=>this.internalGitManager.getCommits(e,t),"gitManager_getCommits")}async getTree(e,t){return this.runWithRetry(async()=>this.internalGitManager.getTree(e,t),"gitManager_getTree")}async getBlob(e){return this.runWithRetry(async()=>this.internalGitManager.getBlob(e),"gitManager_getBlob")}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}async getContent(e,t){return this.runWithRetry(async()=>this.internalGitManager.getContent(e,t),"gitManager_getContent")}async createBlob(e,t){return this.runWithRetry(async()=>this.internalGitManager.createBlob(e,t),"gitManager_createBlob")}async createGitTree(e){return this.runWithRetry(async()=>this.internalGitManager.createGitTree(e),"gitManager_createGitTree")}async createTree(e){return this.runWithRetry(async()=>this.internalGitManager.createTree(e),"gitManager_createTree")}async createCommit(e){return this.runWithRetry(async()=>this.internalGitManager.createCommit(e),"gitManager_createCommit")}async getRef(e){return this.runWithRetry(async()=>this.internalGitManager.getRef(e),"gitManager_getRef")}async createRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.createRef(e,t),"gitManager_createRef")}async upsertRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.upsertRef(e,t),"gitManager_upsertRef")}async write(e,t,r,i){return this.runWithRetry(async()=>this.internalGitManager.write(e,t,r,i),"gitManager_write")}async createSummary(e){return this.runWithRetry(async()=>this.internalGitManager.createSummary(e),"gitManager_createSummary")}async deleteSummary(e){return this.runWithRetry(async()=>this.internalGitManager.deleteSummary(e),"gitManager_deleteSummary")}async getSummary(e){return this.runWithRetry(async()=>this.internalGitManager.getSummary(e),"gitManager_getSummary")}async runWithRetry(e,t){return eS(e,t,this.logger,{})}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const JX=typeof window>"u";class QX{constructor(e,t,r,i={},s,o,a,l=async()=>this.manager){this.id=e,this.manager=t,this.logger=r,this.policies=i,this.getStorageManager=l,this.blobsShaCache=new Map,((s==null?void 0:s.enableRestLess)===!0||JX)&&(this.blobCache=o??new Na,this.snapshotTreeCache=a??new Na)}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new YQ(new KX(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}async getVersions(e,t){const r=e||this.id;return(await he.timedExecAsync(this.logger,{eventName:"getVersions",versionId:r,count:t},async()=>(await this.getStorageManager()).getCommits(r,t))).map(s=>({date:s.commit.author.date,id:s.sha,treeId:s.commit.tree.sha}))}async getSnapshotTree(e){var t,r;let i=e;if(!i){const l=await this.getVersions(this.id,1);if(l.length===0)return null;i=l[0]}const s=await((t=this.snapshotTreeCache)===null||t===void 0?void 0:t.get(this.getCacheKey(i.treeId)));if(s)return s.snapshotTree;const o=await he.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:i.treeId},async l=>{const u=await(await this.getStorageManager()).getTree(i.treeId);return l.end({size:u.tree.length}),u}),a=A0(o,this.blobsShaCache,!0);return await((r=this.snapshotTreeCache)===null||r===void 0?void 0:r.put(this.getCacheKey(a.id),{id:i.id,snapshotTree:a})),a}async readBlob(e){var t,r;const i=await((t=this.blobCache)===null||t===void 0?void 0:t.get(this.getCacheKey(e)));if(i)return i;const s=await he.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async a=>{const c=await(await this.getStorageManager()).getBlob(e);return a.end({size:c.size}),c});this.blobsShaCache.set(s.sha,"");const o=fN(s.content,s.encoding);return await((r=this.blobCache)===null||r===void 0?void 0:r.put(this.getCacheKey(s.sha),o)),o}async uploadSummaryWithContext(e,t){return await he.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var i;return(await this.getSummaryUploadManager()).writeSummaryTree(e,(i=t.ackHandle)!==null&&i!==void 0?i:"","channel")})}async downloadSummary(e){throw new Error("NOT IMPLEMENTED!")}async createBlob(e){const t=new Uint8Array(e);return he.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async r=>{const s=await(await this.getStorageManager()).createBlob(Ff(t,"base64"),"base64").then(o=>({id:o.sha,url:o.url}));return r.end({blobId:s.id}),s})}async getPreviousFullSnapshot(e){return e?this.getVersions(e,1).then(async t=>(this.blobsShaCache.clear(),this.getSnapshotTree(t[0]))):void 0}getCacheKey(e){return`${this.id}:${e}`}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class JS extends N0{constructor(e,t,r,i={},s,o,a,l,c){super(JS.loadInternalDocumentStorageService(e,t,r,i,s,o,a,l,c)),this.id=e,this.manager=t,this.noCacheGitManager=l,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,r,i,s,o,a,l,c){const u=s!=null&&s.enableWholeSummaryUpload?new GX(e,t,r,i,s,o,a,l,c):new QX(e,t,r,i,s,o,a,c);return!(s!=null&&s.enableWholeSummaryUpload)&&i.caching===_a.Prefetch?new L5(u):u}async getSnapshotTree(e){const t=await this.internalStorageService.getSnapshotTree(e);return t!==null&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function vn(n,e){if(!n)throw new Error(typeof e=="number"?`0x${e.toString(16).padStart(3,"0")}`:e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function XX(n){const e=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",t=(s,o)=>{const a=s.split(`
`);return a.shift(),o!==void 0&&a.unshift(o),a.join(`
`)},i={message:typeof(n==null?void 0:n.message)=="string"?n.message:String(n)};if(e(n)){const{errorType:s,stack:o,name:a}=n;if(typeof s=="string"&&(i.errorType=s),typeof o=="string"){const l=typeof a=="string"?a:void 0;i.stack=t(o,l)}}return i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var iy;(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(iy||(iy={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const D1="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Bi extends P0{constructor(e,t,r,i=!1){super((s,o)=>{r.sendErrorEvent({eventName:"DeltaConnection:EventException",name:s},o)}),this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=i,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(s,o)=>{this.queuedMessages.push(...o)},this.earlySignalHandler=s=>{this.queuedSignals.push(s)},this.mc=qa(pe.create(r,"DeltaConnection")),this.on("newListener",(s,o)=>{if(vn(!this.disposed,522),Bi.eventsAlwaysForwarded.includes(s)){vn(this.trackedListeners.has(s),581);return}if(!Bi.eventsToForward.includes(s))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${s}`);vn(this.listeners(s).length!==0===this.trackedListeners.has(s),523),this.trackedListeners.has(s)||this.addTrackedListener(s,(...a)=>{this.emit(s,...a)})})}get hasDetails(){return!!this._details}get disposed(){return vn(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){vn(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),vn(this.earlyOpHandlerAttached,142),vn(this.listeners("op").length!==0,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((e,t)=>e.sequenceNumber-t.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),vn(this.listeners("signal").length!==0,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submitCore(e,t){this.emitMessages(e,[t])}submit(e){this.checkNotClosed(),this.submitCore("submitOp",e)}submitSignal(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}dispose(){this.disposeCore(!1,Pa("Client closing delta connection",{canRetry:!0},{driverVersion:D1}))}disposeCore(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}disconnect(e,t){this.socket.disconnect()}async initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let r=0;const i=()=>this.socket.io.reconnection(),s=()=>i()?this.socket.io.reconnectionAttempts():0,o=()=>s()+1;this._details=await new Promise((a,l)=>{const c=(u,d)=>{this.disposeCore(u,d),l(d)};this.addConnectionListener("connect_error",u=>{var d;r++;let h=!1;try{const f=u==null?void 0:u.description;f&&typeof f=="object"&&(u.type==="TransportError"&&(h=!0),f.target=void 0)}catch{}h&&this.enableLongPollingDowngrades&&((d=this.socket.io.opts.transports)===null||d===void 0?void 0:d[0])!=="polling"&&(this.socket.io.opts.transports=["polling","websocket"],i()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),!(i()&&r<o())&&c(!0,this.createErrorObject("connect_error",u))}),this.addConnectionListener("connect_timeout",()=>{c(!0,this.createErrorObject("connect_timeout"))}),this.addConnectionListener("connect_document_success",u=>{if(e.nonce!==void 0&&u.nonce!==void 0&&u.nonce!==e.nonce)return;const d=e.mode,h=u.mode;if(u.claims.scopes.includes(iy.DocWrite)){if(h!==d){c(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1));return}}else if(h==="write"){c(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));return}this.checkpointSequenceNumber=u.checkpointSequenceNumber,this.removeConnectionListeners(),a(u)}),this.addTrackedListener("disconnect",u=>{const d=this.createErrorObject("disconnect",u);this.emit("disconnect",d),c(!0,d)}),this.addTrackedListener("error",u=>{const d=this.createErrorObject("error",u,u!=="Invalid namespace");this.emit("error",d),c(!0,d)}),this.addConnectionListener("connect_document_error",u=>{e.nonce!==void 0&&u.nonce!==void 0&&u.nonce!==e.nonce||c(!1,this.createErrorObject("connect_document_error",u))}),this.socket.emit("connect_document",e),this.socketConnectionTimeout=setTimeout(()=>{c(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))},t+2e3)}),vn(!this.disposed,582)}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(e,t){vn(!Bi.eventsAlwaysForwarded.includes(e),583),vn(!Bi.eventsToForward.includes(e),584),this.socket.on(e,t),vn(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),vn(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){this.socketConnectionTimeout!==void 0&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t,r=!0){let i;return(t==null?void 0:t.type)==="TransportError"?i=`${(t==null?void 0:t.message)!==void 0?`${t.message}: `:""}${JSON.stringify(t,gH())}`:i=XX(t).message,Pa(`socket.io (${e}): ${i}`,{canRetry:r},{driverVersion:D1})}}Bi.eventsToForward=["nack","op","signal","pong"];Bi.eventsAlwaysForwarded=["disconnect","error"];/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const jf="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var sy;(function(n){n.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"})(sy||(sy={}));function LN(n,e,t){const r={statusCode:e,driverVersion:jf};switch(e){case void 0:return new wv(n,n.startsWith("NetworkError"),r);case 401:case 403:return new S5(n,void 0,void 0,r);case 404:const i=sy.fileNotFoundOrAccessDeniedError;return new nf(n,i,r);case 429:return Pa(n,{canRetry:!0,retryAfterMs:t},r);case 500:case 502:return new wv(n,!0,r);default:return Pa(n,{canRetry:t!==void 0,retryAfterMs:t},r)}}function F1(n,e,t){throw LN(n,e,t)}function YX(n,e){const t=`R11s socket error (${e}): ${n.message}`;return LN(t,n.code,n.retryAfterMs)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const ZX=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class QS extends Bi{static async create(e,t,r,i,s,o,a,l=2e4){const c=i(o,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:l}),u={client:s,id:t,mode:s.mode,tenantId:e,token:r,versions:ZX,relayUserAgent:[s.details.environment,` driverVersion:${jf}`].join(";")},d=!0,h=new QS(c,t,a,d);return await h.initialize(u,l),h}createErrorObject(e,t,r=!0){return r&&Number.isInteger(t==null?void 0:t.code)&&typeof(t==null?void 0:t.message)=="string"?YX(t,e):super.createErrorObject(e,t,r)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class eY{get repositoryUrl(){throw new Error("Invalid operation")}async getSnapshotTree(e){return e?Promise.reject(new Error("Invalid operation")):null}async getVersions(e,t){return[]}async uploadSummaryWithContext(e,t){return Promise.reject(new Error("Invalid operation"))}async downloadSummary(e){return Promise.reject(new Error("Invalid operation"))}async createBlob(e){return Promise.reject(new Error("Null blob storage can not create blob"))}async readBlob(e){return Promise.reject(new Error("Null blob storage can not read blob"))}}var oy={exports:{}};(function(n,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof s<"u"&&s||{},l={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function c(C){return C&&DataView.prototype.isPrototypeOf(C)}if(l.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(C){return C&&u.indexOf(Object.prototype.toString.call(C))>-1};function h(C){if(typeof C!="string"&&(C=String(C)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(C)||C==="")throw new TypeError('Invalid character in header field name: "'+C+'"');return C.toLowerCase()}function f(C){return typeof C!="string"&&(C=String(C)),C}function p(C){var L={next:function(){var H=C.shift();return{done:H===void 0,value:H}}};return l.iterable&&(L[Symbol.iterator]=function(){return L}),L}function g(C){this.map={},C instanceof g?C.forEach(function(L,H){this.append(H,L)},this):Array.isArray(C)?C.forEach(function(L){if(L.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+L.length);this.append(L[0],L[1])},this):C&&Object.getOwnPropertyNames(C).forEach(function(L){this.append(L,C[L])},this)}g.prototype.append=function(C,L){C=h(C),L=f(L);var H=this.map[C];this.map[C]=H?H+", "+L:L},g.prototype.delete=function(C){delete this.map[h(C)]},g.prototype.get=function(C){return C=h(C),this.has(C)?this.map[C]:null},g.prototype.has=function(C){return this.map.hasOwnProperty(h(C))},g.prototype.set=function(C,L){this.map[h(C)]=f(L)},g.prototype.forEach=function(C,L){for(var H in this.map)this.map.hasOwnProperty(H)&&C.call(L,this.map[H],H,this)},g.prototype.keys=function(){var C=[];return this.forEach(function(L,H){C.push(H)}),p(C)},g.prototype.values=function(){var C=[];return this.forEach(function(L){C.push(L)}),p(C)},g.prototype.entries=function(){var C=[];return this.forEach(function(L,H){C.push([H,L])}),p(C)},l.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function S(C){if(!C._noBody){if(C.bodyUsed)return Promise.reject(new TypeError("Already read"));C.bodyUsed=!0}}function m(C){return new Promise(function(L,H){C.onload=function(){L(C.result)},C.onerror=function(){H(C.error)}})}function v(C){var L=new FileReader,H=m(L);return L.readAsArrayBuffer(C),H}function y(C){var L=new FileReader,H=m(L),I=/charset=([A-Za-z0-9_-]+)/.exec(C.type),B=I?I[1]:"utf-8";return L.readAsText(C,B),H}function b(C){for(var L=new Uint8Array(C),H=new Array(L.length),I=0;I<L.length;I++)H[I]=String.fromCharCode(L[I]);return H.join("")}function w(C){if(C.slice)return C.slice(0);var L=new Uint8Array(C.byteLength);return L.set(new Uint8Array(C)),L.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(C){this.bodyUsed=this.bodyUsed,this._bodyInit=C,C?typeof C=="string"?this._bodyText=C:l.blob&&Blob.prototype.isPrototypeOf(C)?this._bodyBlob=C:l.formData&&FormData.prototype.isPrototypeOf(C)?this._bodyFormData=C:l.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)?this._bodyText=C.toString():l.arrayBuffer&&l.blob&&c(C)?(this._bodyArrayBuffer=w(C.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):l.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(C)||d(C))?this._bodyArrayBuffer=w(C):this._bodyText=C=Object.prototype.toString.call(C):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof C=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):l.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},l.blob&&(this.blob=function(){var C=S(this);if(C)return C;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var C=S(this);return C||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(l.blob)return this.blob().then(v);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var C=S(this);if(C)return C;if(this._bodyBlob)return y(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},l.formData&&(this.formData=function(){return this.text().then(F)}),this.json=function(){return this.text().then(JSON.parse)},this}var E=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function P(C){var L=C.toUpperCase();return E.indexOf(L)>-1?L:C}function A(C,L){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');L=L||{};var H=L.body;if(C instanceof A){if(C.bodyUsed)throw new TypeError("Already read");this.url=C.url,this.credentials=C.credentials,L.headers||(this.headers=new g(C.headers)),this.method=C.method,this.mode=C.mode,this.signal=C.signal,!H&&C._bodyInit!=null&&(H=C._bodyInit,C.bodyUsed=!0)}else this.url=String(C);if(this.credentials=L.credentials||this.credentials||"same-origin",(L.headers||!this.headers)&&(this.headers=new g(L.headers)),this.method=P(L.method||this.method||"GET"),this.mode=L.mode||this.mode||null,this.signal=L.signal||this.signal||function(){if("AbortController"in a){var x=new AbortController;return x.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&H)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(H),(this.method==="GET"||this.method==="HEAD")&&(L.cache==="no-store"||L.cache==="no-cache")){var I=/([?&])_=[^&]*/;if(I.test(this.url))this.url=this.url.replace(I,"$1_="+new Date().getTime());else{var B=/\?/;this.url+=(B.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function F(C){var L=new FormData;return C.trim().split("&").forEach(function(H){if(H){var I=H.split("="),B=I.shift().replace(/\+/g," "),x=I.join("=").replace(/\+/g," ");L.append(decodeURIComponent(B),decodeURIComponent(x))}}),L}function X(C){var L=new g,H=C.replace(/\r?\n[\t ]+/g," ");return H.split("\r").map(function(I){return I.indexOf(`
`)===0?I.substr(1,I.length):I}).forEach(function(I){var B=I.split(":"),x=B.shift().trim();if(x){var j=B.join(":").trim();try{L.append(x,j)}catch(Y){console.warn("Response "+Y.message)}}}),L}_.call(A.prototype);function z(C,L){if(!(this instanceof z))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(L||(L={}),this.type="default",this.status=L.status===void 0?200:L.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=L.statusText===void 0?"":""+L.statusText,this.headers=new g(L.headers),this.url=L.url||"",this._initBody(C)}_.call(z.prototype),z.prototype.clone=function(){return new z(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},z.error=function(){var C=new z(null,{status:200,statusText:""});return C.ok=!1,C.status=0,C.type="error",C};var ee=[301,302,303,307,308];z.redirect=function(C,L){if(ee.indexOf(L)===-1)throw new RangeError("Invalid status code");return new z(null,{status:L,headers:{location:C}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(L,H){this.message=L,this.name=H;var I=Error(L);this.stack=I.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function W(C,L){return new Promise(function(H,I){var B=new A(C,L);if(B.signal&&B.signal.aborted)return I(new o.DOMException("Aborted","AbortError"));var x=new XMLHttpRequest;function j(){x.abort()}x.onload=function(){var re={statusText:x.statusText,headers:X(x.getAllResponseHeaders()||"")};B.url.indexOf("file://")===0&&(x.status<200||x.status>599)?re.status=200:re.status=x.status,re.url="responseURL"in x?x.responseURL:re.headers.get("X-Request-URL");var T="response"in x?x.response:x.responseText;setTimeout(function(){H(new z(T,re))},0)},x.onerror=function(){setTimeout(function(){I(new TypeError("Network request failed"))},0)},x.ontimeout=function(){setTimeout(function(){I(new TypeError("Network request timed out"))},0)},x.onabort=function(){setTimeout(function(){I(new o.DOMException("Aborted","AbortError"))},0)};function Y(re){try{return re===""&&a.location.href?a.location.href:re}catch{return re}}if(x.open(B.method,Y(B.url),!0),B.credentials==="include"?x.withCredentials=!0:B.credentials==="omit"&&(x.withCredentials=!1),"responseType"in x&&(l.blob?x.responseType="blob":l.arrayBuffer&&(x.responseType="arraybuffer")),L&&typeof L.headers=="object"&&!(L.headers instanceof g||a.Headers&&L.headers instanceof a.Headers)){var ye=[];Object.getOwnPropertyNames(L.headers).forEach(function(re){ye.push(h(re)),x.setRequestHeader(re,f(L.headers[re]))}),B.headers.forEach(function(re,T){ye.indexOf(T)===-1&&x.setRequestHeader(T,re)})}else B.headers.forEach(function(re,T){x.setRequestHeader(T,re)});B.signal&&(B.signal.addEventListener("abort",j),x.onreadystatechange=function(){x.readyState===4&&B.signal.removeEventListener("abort",j)}),x.send(typeof B._bodyInit>"u"?null:B._bodyInit)})}return W.polyfill=!0,a.fetch||(a.fetch=W,a.Headers=g,a.Request=A,a.Response=z),o.Headers=g,o.Request=A,o.Response=z,o.fetch=W,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=t.fetch?t:r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(oy,oy.exports);var tY=oy.exports;const nY=pi(tY),rY=n=>{var e,t;const r=n.baseURL!==void 0?`${n.baseURL}${(e=n.url)!==null&&e!==void 0?e:""}`:(t=n.url)!==null&&t!==void 0?t:"",i={method:n.method,headers:n.headers,body:n.data};return[r,i]};class IN extends vN{constructor(e,t,r,i,s,o={}){super(s,o),this.rateLimiter=t,this.getAuthorizationHeader=r,this.useRestLess=i,this.restLess=new QQ}async load(){this.authorizationHeader=await this.getAuthorizationHeader()}async request(e,t,r=!0){var i;const s=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),o=this.useRestLess?this.restLess.translate(s):s,a=rY(o),l=await this.rateLimiter.schedule(async()=>nY(...a).catch(async d=>{const h=["TypeError","FetchError"].includes(d==null?void 0:d.name);F1(h?`NetworkError: ${d.message}`:Xv(d))})),c=!((i=l.headers.get("content-type"))===null||i===void 0)&&i.includes("application/json")?await l.json():await l.text();if(l.ok||l.status===t)return c;if(l.status===401&&r)return this.authorizationHeader=await this.getAuthorizationHeader(!0),this.request(s,t,!1);if(l.status===429&&(c==null?void 0:c.retryAfter)>0)return new Promise((d,h)=>setTimeout(()=>{this.request(s,t).then(d).catch(h)},c.retryAfter*1e3));const u=c!==void 0?typeof c=="string"?c:Xv(c):l.statusText;F1(`R11s fetch error: ${u}`,l.status,c==null?void 0:c.retryAfter)}generateHeaders(e){const t=(e==null?void 0:e["x-correlation-id"])||ot();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":jf,Authorization:this.authorizationHeader})}}class XS extends IN{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,a){const l={token:`${NQ(e)}`},c=async d=>he.timedExecAsync(i,{eventName:"FetchStorageToken",docId:t},async()=>{const f={password:(await r.fetchStorageToken(e,t,d)).jwt,user:e};return KQ(f)}),u=new XS(i,s,c,o,a,l);try{await u.load()}catch(d){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},d),await u.load()}return u}}class Nc extends IN{constructor(e,t,r,i,s,o={}){super(e,t,r,i,s,o)}static async load(e,t,r,i,s,o,a){const l=async u=>he.timedExecAsync(i,{eventName:"FetchOrdererToken",docId:t},async()=>`Basic ${(await r.fetchOrdererToken(e,t,u)).jwt}`),c=new Nc(i,s,l,o,a);try{await c.load()}catch(u){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},u),await c.load()}return c}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const iY=5*6e4;class sY{constructor(e,t,r,i,s,o,a,l,c,u,d,h){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=r,this.storageUrl=i,this.logger=s,this.tokenProvider=o,this.tenantId=a,this.documentId=l,this.driverPolicies=c,this.blobCache=u,this.snapshotTreeCache=d,this.discoverFluidResolvedUrl=h,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}async connectToStorage(){if(this.documentStorageService!==void 0)return this.documentStorageService;if(this.storageUrl===void 0)return new eY;const e=async s=>{const o=this.shouldUpdateDiscoveredSessionInfo();if(o&&await this.refreshDiscovery(),!this.storageManager||!this.noCacheStorageManager||o){const a=new eh(this.driverPolicies.maxConcurrentStorageRequests),l=await XS.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,a,this.driverPolicies.enableRestLess,this.storageUrl),c=new P1(this.storageUrl,!0,!1,l);this.storageManager=new O1(c);const u=new P1(this.storageUrl,!0,!0,l);this.noCacheStorageManager=new O1(u)}return s?this.noCacheStorageManager:this.storageManager},t=await e(),r=await e(!0),i={caching:this.driverPolicies.enablePrefetch?_a.Prefetch:_a.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new JS(this.documentId,t,this.logger,i,this.driverPolicies,this.blobCache,this.snapshotTreeCache,r,e),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),kc(!!this.documentStorageService,177);const e=async()=>{const i=this.shouldUpdateDiscoveredSessionInfo();if(i&&await this.refreshDiscovery(),!this.ordererRestWrapper||i){const s=new eh(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=await Nc.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,s,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},t=await e(),r=new MQ(this.deltaStorageUrl,t,this.logger,e,()=>this.deltaStorageUrl);return new AQ(this.tenantId,this.documentId,r,this.documentStorageService)}async connectToDeltaStream(e){const t=async r=>{this.shouldUpdateDiscoveredSessionInfo()&&await this.refreshDiscovery();const i=await he.timedExecAsync(this.logger,{eventName:"GetDeltaStreamToken",docId:this.documentId,details:JSON.stringify({refreshToken:r})},async()=>this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,r));return he.timedExecAsync(this.logger,{eventName:"ConnectToDeltaStream",docId:this.documentId},async()=>QS.create(this.tenantId,this.documentId,i.jwt,md,e,this.ordererUrl,this.logger))};try{return await t()}catch(r){if((r==null?void 0:r.statusCode)===401)return t(!0);throw r}}async refreshDiscovery(){return this.discoverP||(this.discoverP=he.timedExecAsync(this.logger,{eventName:"RefreshDiscovery"},async()=>this.refreshDiscoveryCore())),this.discoverP}async refreshDiscoveryCore(){const e=await this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const t=Date.now()-this.lastDiscoveredAt>iY;return t&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch(()=>{this.lastDiscoveredAt=0})),t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Ql;(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(Ql||(Ql={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function AN(n){const e=Object.keys(n.tree);for(const t of e){const r=n.tree[t];switch(r.type){case Ql.Tree:{n.tree[t]=AN(r);break}case Ql.Blob:{r.content=typeof r.content=="string"?r.content:Ff(r.content,"utf8");break}case Ql.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${r.type}`)}}return n}var oY=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},YS={},aY=Object.prototype.hasOwnProperty,lY;function z1(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function $1(n){try{return encodeURIComponent(n)}catch{return null}}function cY(n){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},r;r=e.exec(n);){var i=z1(r[1]),s=z1(r[2]);i===null||s===null||i in t||(t[i]=s)}return t}function uY(n,e){e=e||"";var t=[],r,i;typeof e!="string"&&(e="?");for(i in n)if(aY.call(n,i)){if(r=n[i],!r&&(r===null||r===lY||isNaN(r))&&(r=""),i=$1(i),r=$1(r),i===null||r===null)continue;t.push(i+"="+r)}return t.length?e+t.join("&"):""}YS.stringify=uY;YS.parse=cY;var MN=oY,qf=YS,dY=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,DN=/[\n\r\t]/g,hY=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,FN=/:\d+$/,fY=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,pY=/^[a-zA-Z]:/;function ZS(n){return(n||"").toString().replace(dY,"")}var ay=[["#","hash"],["?","query"],function(e,t){return Fr(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],j1={hash:1,query:1};function zN(n){var e;typeof window<"u"?e=window:typeof globalThis<"u"?e=globalThis:typeof self<"u"?e=self:e={};var t=e.location||{};n=n||t;var r={},i=typeof n,s;if(n.protocol==="blob:")r=new jr(unescape(n.pathname),{});else if(i==="string"){r=new jr(n,{});for(s in j1)delete r[s]}else if(i==="object"){for(s in n)s in j1||(r[s]=n[s]);r.slashes===void 0&&(r.slashes=hY.test(n.href))}return r}function Fr(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function $N(n,e){n=ZS(n),n=n.replace(DN,""),e=e||{};var t=fY.exec(n),r=t[1]?t[1].toLowerCase():"",i=!!t[2],s=!!t[3],o=0,a;return i?s?(a=t[2]+t[3]+t[4],o=t[2].length+t[3].length):(a=t[2]+t[4],o=t[2].length):s?(a=t[3]+t[4],o=t[3].length):a=t[4],r==="file:"?o>=2&&(a=a.slice(2)):Fr(r)?a=t[4]:r?i&&(a=a.slice(2)):o>=2&&Fr(e.protocol)&&(a=t[4]),{protocol:r,slashes:i||Fr(r),slashesCount:o,rest:a}}function mY(n,e){if(n==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(n.split("/")),r=t.length,i=t[r-1],s=!1,o=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),o++):o&&(r===0&&(s=!0),t.splice(r,1),o--);return s&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function jr(n,e,t){if(n=ZS(n),n=n.replace(DN,""),!(this instanceof jr))return new jr(n,e,t);var r,i,s,o,a,l,c=ay.slice(),u=typeof e,d=this,h=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=qf.parse),e=zN(e),i=$N(n||"",e),r=!i.protocol&&!i.slashes,d.slashes=i.slashes||r&&e.slashes,d.protocol=i.protocol||e.protocol||"",n=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||pY.test(n))||!i.slashes&&(i.protocol||i.slashesCount<2||!Fr(d.protocol)))&&(c[3]=[/(.*)/,"pathname"]);h<c.length;h++){if(o=c[h],typeof o=="function"){n=o(n,d);continue}s=o[0],l=o[1],s!==s?d[l]=n:typeof s=="string"?(a=s==="@"?n.lastIndexOf(s):n.indexOf(s),~a&&(typeof o[2]=="number"?(d[l]=n.slice(0,a),n=n.slice(a+o[2])):(d[l]=n.slice(a),n=n.slice(0,a)))):(a=s.exec(n))&&(d[l]=a[1],n=n.slice(0,a.index)),d[l]=d[l]||r&&o[3]&&e[l]||"",o[4]&&(d[l]=d[l].toLowerCase())}t&&(d.query=t(d.query)),r&&e.slashes&&d.pathname.charAt(0)!=="/"&&(d.pathname!==""||e.pathname!=="")&&(d.pathname=mY(d.pathname,e.pathname)),d.pathname.charAt(0)!=="/"&&Fr(d.protocol)&&(d.pathname="/"+d.pathname),MN(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.indexOf(":"),~a?(d.username=d.auth.slice(0,a),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(a+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin=d.protocol!=="file:"&&Fr(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function gY(n,e,t){var r=this;switch(n){case"query":typeof e=="string"&&e.length&&(e=(t||qf.parse)(e)),r[n]=e;break;case"port":r[n]=e,MN(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[n]="");break;case"hostname":r[n]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[n]=e,FN.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(e){var i=n==="pathname"?"/":"#";r[n]=e.charAt(0)!==i?i+e:e}else r[n]=e;break;case"username":case"password":r[n]=encodeURIComponent(e);break;case"auth":var s=e.indexOf(":");~s?(r.username=e.slice(0,s),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(s+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var o=0;o<ay.length;o++){var a=ay[o];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&Fr(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function vY(n){(!n||typeof n!="function")&&(n=qf.stringify);var e,t=this,r=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var s=i+(t.protocol&&t.slashes||Fr(t.protocol)?"//":"");return t.username?(s+=t.username,t.password&&(s+=":"+t.password),s+="@"):t.password?(s+=":"+t.password,s+="@"):t.protocol!=="file:"&&Fr(t.protocol)&&!r&&t.pathname!=="/"&&(s+="@"),(r[r.length-1]===":"||FN.test(t.hostname)&&!t.port)&&(r+=":"),s+=r+t.pathname,e=typeof t.query=="object"?n(t.query):t.query,e&&(s+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(s+=t.hash),s}jr.prototype={set:gY,toString:vY};jr.extractProtocol=$N;jr.location=zN;jr.trimLeft=ZS;jr.qs=qf;var yY=jr;const Do=pi(yY);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const gd=n=>new Do(n,!0),q1=(n,e)=>n.split("/").slice(0,-1).concat([e]).join("/"),B1=(n,e)=>{if(e){const t=new Do(e.ordererUrl),r=new Do(n.endpoints.deltaStorageUrl);r.set("host",t.host);const i=new Do(e.historianUrl),s=new Do(n.endpoints.storageUrl);s.set("host",i.host);const o=gd(n.url);return{endpoints:{deltaStorageUrl:r.toString(),ordererUrl:e.ordererUrl,storageUrl:s.toString()},id:n.id,tokens:n.tokens,type:n.type,url:new Do(`fluid://${t.host}${o.pathname}`).toString()}}else return n};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const SY={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class bY{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new Na,this.snapshotTreeCache=new Na,this.driverPolicies=Object.assign(Object.assign({},SY),t)}async createContainer(e,t,r,i){if(zr(t),e===void 0)throw new Error("Empty file summary creation isn't supported in this driver.");kc(!!t.endpoints.ordererUrl,178);let s=gd(t.url);if(!s.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,o]=s.pathname.split("/"),a=e.tree[".protocol"],l=e.tree[".app"];if(!(a&&l))throw new Error("Protocol and App Summary required in the full summary");const c=E5(a),u=_5(a),d=pe.create(r,"RouterliciousDriver"),h=new eh(this.driverPolicies.maxConcurrentOrdererRequests),f=await Nc.load(o,void 0,this.tokenProvider,d,h,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl),p=await he.timedExecAsync(d,{eventName:"CreateNew",details:JSON.stringify({enableDiscovery:this.driverPolicies.enableDiscovery,sequenceNumber:c.sequenceNumber})},async b=>{const w=await f.post(`/documents/${o}`,{summary:AN(l),sequenceNumber:c.sequenceNumber,values:u,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:this.tokenProvider.documentPostCreateCallback!==void 0});return b.end({docId:typeof w=="string"?w:w.id}),w});let g,S,m;typeof p=="string"?g=p:(g=p.id,S=p.token,m=this.driverPolicies.enableDiscovery?p.session:void 0),s=gd(t.url);try{await he.timedExecAsync(d,{eventName:"DocPostCreateCallback",docId:g},async()=>{if(S&&this.tokenProvider.documentPostCreateCallback!==void 0)return this.tokenProvider.documentPostCreateCallback(g,S)})}catch(b){throw new wY(b)}s.set("pathname",q1(s.pathname,g));const v=t.endpoints.deltaStorageUrl;if(!v)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${v}]`);const y=new URL(v);return y.pathname=q1(y.pathname,g),this.createDocumentService(Object.assign(Object.assign({},t),{url:s.toString(),id:g,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:y.toString()})}),r,i,m)}async createDocumentService(e,t,r,i){zr(e);const s=gd(e.url),[,o,a]=s.pathname.split("/");if(!a||!o)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${a}][tenantId:${o}]`);const l=pe.create(t,"RouterliciousDriver",{all:{driverVersion:jf}}),c=async()=>{if(!this.driverPolicies.enableDiscovery)return e;const p=new eh(this.driverPolicies.maxConcurrentOrdererRequests),g=await Nc.load(o,a,this.tokenProvider,l,p,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl),S=await he.timedExecAsync(l,{eventName:"DiscoverSession",docId:a},async()=>g.get(`/documents/${o}/session/${a}`));return B1(e,S)},u=i!==void 0?B1(e,i):await c(),d=u.endpoints.storageUrl,h=u.endpoints.ordererUrl,f=u.endpoints.deltaStorageUrl;if(!h||!f)throw new Error(`All endpoints urls must be provided. [ordererUrl:${h}][deltaStorageUrl:${f}]`);return new sY(u,h,f,d,l,this.tokenProvider,o,a,this.driverPolicies,this.blobCache,this.snapshotTreeCache,c)}}class wY extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}class CY{constructor(){}async resolve(e){const{ordererUrl:t,storageUrl:r,tenantId:i,containerId:s}=EY(e.url);if(e.headers&&e.headers[Ta.createNew]===!0)return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/new`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:"",tokens:{},type:"fluid",url:`${t}/${i}/new`};if(s===void 0)throw new Error("Azure URL did not contain containerId");const o=`${t}/${i}/${s}`;return{endpoints:{deltaStorageUrl:`${t}/deltas/${i}/${s}`,ordererUrl:t,storageUrl:`${r}/repos/${i}`},id:s,tokens:{},type:"fluid",url:o}}async getAbsoluteUrl(e,t){if(e.type!=="fluid")throw new Error("Invalid Resolved Url");return`${e.url}/${t}`}}function EY(n){const e=new URL(n),t=e.origin,r=e.searchParams,i=r.get("storage");if(i===null)throw new Error("Azure URL did not contain a storage URL");const s=r.get("tenantId");if(s===null)throw new Error("Azure URL did not contain a tenant ID");const o=decodeURIComponent(i),a=decodeURIComponent(s),l=r.get("containerId"),c=l!==null?decodeURIComponent(l):void 0;return{ordererUrl:t,storageUrl:o,tenantId:a,containerId:c}}const _Y=(n,e)=>{const t=new URL(n);return t.searchParams.append("storage",encodeURIComponent(n)),t.searchParams.append("tenantId",encodeURIComponent(e)),{url:t.href,headers:{[Ta.createNew]:!0}}};function jN(n){return n.type==="remote"}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const TY="local",Bu=n=>jN(n)?n.tenantId:TY,xY=5;class OY{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new CY;const t=jN(this.props.connection);this.documentServiceFactory=new bY(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}async createContainer(e){const r=await this.createLoader(e).createDetachedContainer({package:"no-dynamic-package",config:{}}),i=await this.createFluidContainer(r,this.props.connection),s=this.getContainerServices(r);return{container:i,services:s}}async copyContainer(e,t,r){var i;const s=this.createLoader(t),o=new URL(this.props.connection.endpoint);o.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),o.searchParams.append("tenantId",encodeURIComponent(Bu(this.props.connection))),o.searchParams.append("containerId",encodeURIComponent(e));const a=await s.resolve({url:o.href});if(a.resolvedUrl===void 0)throw new Error("Source container cannot resolve URL.");const c=await(await this.documentServiceFactory.createDocumentService(a.resolvedUrl)).connectToStorage(),u={type:ph.Handle,handleType:ph.Tree,handle:(i=r==null?void 0:r.id)!==null&&i!==void 0?i:"latest"},d=await c.downloadSummary(u),h=await s.rehydrateDetachedContainerFromSnapshot(JSON.stringify(d)),f=await this.createFluidContainer(h,this.props.connection),p=this.getContainerServices(h);return{container:f,services:p}}async getContainer(e,t){const r=this.createLoader(t),i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bu(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await r.resolve({url:i.href}),o=await wc(s,"/"),a=new Pv(s,o),l=this.getContainerServices(s);return{container:a,services:l}}async getContainerVersions(e,t){var r;const i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(Bu(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const s=await this.urlResolver.resolve({url:i.href});if(!s)throw new Error("Unable to resolved URL");return(await(await(await this.documentServiceFactory.createDocumentService(s)).connectToStorage()).getVersions(null,(r=t==null?void 0:t.maxCount)!==null&&r!==void 0?r:xY)).map(c=>({id:c.id,date:c.date}))}getContainerServices(e){return{audience:new hN(e)}}createLoader(e){const t=new _k(e),i={load:async()=>({module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}})},s={details:{capabilities:{interactive:!0}},permission:[],scopes:[],user:{id:""},mode:"write"};return new K5({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:i,logger:this.props.logger,options:{client:s}})}async createFluidContainer(e,t){const r=_Y(t.endpoint,Bu(t)),i=await wc(e,"/"),s=async()=>{if(e.attachState!==te.Detached)throw new Error("Cannot attach container. Container is not in detached state");await e.attach(r);const a=e.resolvedUrl;return zr(a),a.id},o=new Pv(e,i);return o.attach=s,o}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class PY{constructor(e,t){this.azFunctionUrl=e,this.user=t}async fetchOrdererToken(e,t){return{jwt:await this.getToken(e,t)}}async fetchStorageToken(e,t){return{jwt:await this.getToken(e,t)}}async getToken(e,t){var r,i,s;return(await kR.get(this.azFunctionUrl,{params:{tenantId:e,documentId:t,userId:(r=this.user)===null||r===void 0?void 0:r.userId,userName:(i=this.user)===null||i===void 0?void 0:i.userName,additionalDetails:(s=this.user)===null||s===void 0?void 0:s.additionalDetails}})).data}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const RY=Object.freeze(Object.defineProperty({__proto__:null,AzureAudience:hN,AzureClient:OY,AzureFunctionTokenProvider:PY,get ScopeType(){return Kv}},Symbol.toStringTag,{value:"Module"})),kY=Lc(RY);var uu={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(uu,"__esModule",{value:!0});uu.LocalTimestampProvider=void 0;class fa{constructor(e=!1){this._lastTimeSent=0,e&&(fa._warned=!0)}getTimestamp(){return fa._warned||(console.warn("LiveEvent is using a LocalTimestampProvider which could cause issues when used across multiple clients."),fa._warned=!0),this._lastTimeSent=Math.max(new Date().getTime(),this._lastTimeSent+1)}getMaxTimestampError(){return 0}}fa._warned=!1;uu.LocalTimestampProvider=fa;var du={};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var U1=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(du,"__esModule",{value:!0});du.TestLiveShareHost=void 0;const Vr=Jn;class Yr{static create(e,t){return new Yr(e,t)}constructor(e,t){this._getLocalTestContainerId=e,this._setLocalTestContainerId=t,this.roleCache=new Map,this.defaultRemoteRoles=[Vr.UserMeetingRole.organizer,Vr.UserMeetingRole.presenter,Vr.UserMeetingRole.attendee],this.defaultLocalRoles=[Vr.UserMeetingRole.organizer,Vr.UserMeetingRole.presenter,Vr.UserMeetingRole.attendee]}getFluidTenantInfo(){return Yr.ensureWarned(),Promise.resolve({tenantId:"local",serviceEndpoint:"http://localhost:7070"})}getFluidToken(e){return Promise.resolve(Yr.LOCAL_MODE_TEST_TOKEN)}getFluidContainerId(){const e=this.getLocalTestContainerId();return Promise.resolve({containerState:e?Vr.ContainerState.alreadyExists:Vr.ContainerState.notFound,shouldCreate:!e,containerId:e,retryAfter:0})}setFluidContainerId(e){return this.setLocalTestContainerId(e),Promise.resolve({containerState:Vr.ContainerState.added,containerId:e,shouldCreate:!1,retryAfter:0})}getNtpTime(){const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})}registerClientId(e){if(this.roleCache.has(e))throw new Error("Already registered clientId");return this.addClient(e,this.defaultLocalRoles),Promise.resolve(this.defaultLocalRoles)}addClient(e,t){return this.roleCache.set(e,t),this}getClientInfo(e){return U1(this,void 0,void 0,function*(){const t={userId:e,roles:yield this.getClientRoles(e),displayName:e.substring(0,4)};return Promise.resolve(t)})}getClientRoles(e){return U1(this,void 0,void 0,function*(){if(!e)throw new Error("TestLiveShareHost: called getClientRoles() without a clientId");let t;return this.roleCache.has(e)?t=this.roleCache.get(e):t=this.defaultRemoteRoles,Promise.resolve(t)})}getLocalTestContainerId(){return this._getLocalTestContainerId?this._getLocalTestContainerId():window.location.hash?window.location.hash.substring(1):void 0}setLocalTestContainerId(e){this._setLocalTestContainerId?this._setLocalTestContainerId(e):window.location.hash=e}static ensureWarned(){Yr._warned||(console.warn("TestLiveShareHost is being used. This should only be used for local testing purposes."),Yr._warned=!0)}}Yr.LOCAL_MODE_TEST_TOKEN="test-token";Yr._warned=!1;du.TestLiveShareHost=Yr;var hu={},NY=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(hu,"__esModule",{value:!0});hu.LiveShareRuntime=void 0;const LY=Wa,Jm=iu,Yn=Qn();class IY{constructor(e,t,r=!0){var i,s,o;this._started=!1,this._objectManager=null,this._host=r?new Yn.BackwardsCompatibilityHostDecorator(new Yn.LiveShareHostDecorator(new Yn.FormatFixHostDecorator(e))):e,this._timestampProvider=(i=t==null?void 0:t.timestampProvider)!==null&&i!==void 0?i:new Jm.HostTimestampProvider(this._host),this._roleVerifier=(s=t==null?void 0:t.roleVerifier)!==null&&s!==void 0?s:new Yn.RoleVerifier(this._host),this._canSendBackgroundUpdates=(o=t==null?void 0:t.canSendBackgroundUpdates)!==null&&o!==void 0?o:!0}get objectManager(){return(0,LY.assert)(this._objectManager!==null,"LiveObjectSynchronizerManager not initialized."),this._objectManager}get timestampProvider(){return this._timestampProvider}get host(){return this._host}get canSendBackgroundUpdates(){return this._canSendBackgroundUpdates}set canSendBackgroundUpdates(e){this._canSendBackgroundUpdates=e}getTimestamp(){return this._timestampProvider.getTimestamp()}verifyRolesAllowed(e,t){return this._roleVerifier.verifyRolesAllowed(e,t)}getClientInfo(e){return this._host.getClientInfo(e)}setTimestampProvider(e){this._timestampProvider=e}setRoleVerifier(e){this._roleVerifier=e}setHost(e,t=!0){this._host=t?new Yn.BackwardsCompatibilityHostDecorator(new Yn.LiveShareHostDecorator(e)):e,this._timestampProvider instanceof Jm.HostTimestampProvider&&(this._timestampProvider.stop(),this.setTimestampProvider(new Jm.HostTimestampProvider(this._host))),this._roleVerifier instanceof Yn.RoleVerifier&&this.setRoleVerifier(new Yn.RoleVerifier(this._host))}setAudience(e){var t;this._audience=e,(t=this._objectManager)===null||t===void 0||t.setAudience(this._audience)}start(){return NY(this,void 0,void 0,function*(){if(this._started)throw new Error("LiveShareRuntime.start(): cannot call start when already started");this._started=!0,this._objectManager&&this.startObjectSynchronizerManager(),(0,Yn.isTimestampProvider)(this._timestampProvider)&&!this._timestampProvider.isRunning&&(yield this._timestampProvider.start())})}stop(){var e;if(!this._started)throw new Error("LiveShareRuntime.stop(): cannot call stop when not already started");this._started=!1,(0,Yn.isTimestampProvider)(this._timestampProvider)&&this._timestampProvider.isRunning&&this._timestampProvider.stop(),(e=this._objectManager)===null||e===void 0||e.stop()}__dangerouslySetContainerRuntime(e){if(this._containerRuntime!==e){if(this._containerRuntime=e,this._objectManager){this._objectManager.__dangerouslySetContainerRuntime(e);return}this._objectManager=new Yn.LiveObjectManager(this,this._containerRuntime),this.startObjectSynchronizerManager()}}startObjectSynchronizerManager(){this.objectManager.start()}}hu.LiveShareRuntime=IY;var oi={},AY=K&&K.__setFunctionName||function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};Object.defineProperty(oi,"__esModule",{value:!0});oi.getLiveDataObjectClass=oi.getLiveContainerSchemaProxy=oi.getLiveContainerSchema=void 0;function qN(n,e){var t;const r=new Map,i=Object.entries(n.initialObjects).map(([o,a])=>[o,ly(a,e,r)]);return{initialObjects:Object.fromEntries(i),dynamicObjectTypes:(t=n.dynamicObjectTypes)===null||t===void 0?void 0:t.map(o=>ly(o,e,r))}}oi.getLiveContainerSchema=qN;function MY(n,e){return qN(n,e)}oi.getLiveContainerSchemaProxy=MY;function ly(n,e,t=new Map){if(DY(n)){const r=n.TypeName,i=t.get(r);if(i!==void 0)return i;const s=FY(n,e);return t.set(r,s),s}return n}oi.getLiveDataObjectClass=ly;function DY(n){return n.LiveEnabled===!0}function FY(n,e){var t;class r extends n{constructor(o){if(super(o),this.__dangerouslySetLiveRuntime(e),!this.context||!this.context.containerRuntime)throw Error("getLiveDataObjectProxyClassInternal: required dependencies unknown");this.context.clientDetails.capabilities.interactive!==!1&&e.__dangerouslySetContainerRuntime(this.context.containerRuntime)}}return t=class extends n{},AY(t,"DynamicClass"),t.TypeName=n.TypeName,t.factory=new Proxy(n.factory,{get:function(s,o,a){return o==="ctor"?r:Reflect.get(s,o,a)}}),t}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Qm=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Df,"__esModule",{value:!0});Df.LiveShareClient=void 0;const H1=Qn(),zY=kY,$Y=Jn,jY=uu,BN=du,qY=hu,BY=oi,V1=new Map().set("https://alfred.westus2.fluidrelay.azure.com","https://us.fluidrelay.azure.com").set("https://alfred.westeurope.fluidrelay.azure.com","https://eu.fluidrelay.azure.com").set("https://alfred.southeastasia.fluidrelay.azure.com","https://globalThis.fluidrelay.azure.com");class UY{constructor(e,t){if(this._host=BN.TestLiveShareHost.create(void 0,void 0),this.maxContainerLookupTries=3,!e)throw new Error(`LiveShareClient: prop \`host\` is \`${e}\` when it is expected to be a non-optional value of type \`ILiveShareHost\`. Please ensure \`host\` is defined before initializing \`LiveShareClient\`.`);if(typeof e.getFluidTenantInfo!="function")throw new Error(`LiveShareClient: \`host.getFluidTenantInfo\` is of type \`${typeof e.getFluidTenantInfo}\` when it is expected to be a type of \`function\`. For more information, review the \`ILiveShareHost\` interface.`);this._host=e,this._options=Object.assign(Object.assign({},t),{timestampProvider:W1(e,t)?new jY.LocalTimestampProvider:t==null?void 0:t.timestampProvider}),this._runtime=new qY.LiveShareRuntime(this._host,this._options,!0)}get isTesting(){return W1(this._host,this._options)}get canSendBackgroundUpdates(){return this._runtime.canSendBackgroundUpdates}set canSendBackgroundUpdates(e){this._runtime.canSendBackgroundUpdates=e}joinContainer(e,t){return Qm(this,void 0,void 0,function*(){performance.mark("TeamsSync: join container");try{const r=this._runtime.start(),i=(0,BY.getLiveContainerSchema)(e,this._runtime);let s=this._options.connection;if(!s){const c=yield this._host.getFluidTenantInfo();let u=c.serviceEndpoint;if(!u)if(V1.has(c.serviceEndpoint))u=V1.get(c.serviceEndpoint);else throw new Error(`LiveShareClient:joinContainer - unable to find fluid endpoint for: ${c.serviceEndpoint}`);c.tenantId=="local"?s={type:"local",endpoint:u,tokenProvider:yield(0,H1.getInsecureTokenProvider)()}:s={type:"remote",tenantId:c.tenantId,endpoint:u,tokenProvider:new H1.LiveShareTokenProvider(this._host)}}const o=new zY.AzureClient({connection:s,logger:this._options.logger}),a=this.getOrCreateContainer(o,i,0,t),l=yield Promise.all([a,r]);return this._runtime.setAudience(l[0].services.audience),performance.mark("TeamsSync: container connecting"),this._results=Object.assign(Object.assign({},l[0]),{timestampProvider:this._runtime.timestampProvider}),this._results}finally{performance.measure("TeamsSync: container joined","TeamsSync: join container")}})}getOrCreateContainer(e,t,r,i){return Qm(this,void 0,void 0,function*(){const s=yield this._host.getFluidContainerId();if(s.shouldCreate)return yield this.createNewContainer(e,t,r,i);if(s.containerId)return Object.assign({created:!1},yield e.getContainer(s.containerId,t));if(r<this.maxContainerLookupTries&&s.retryAfter>0)return yield this.wait(s.retryAfter),yield this.getOrCreateContainer(e,t,r+1,i);throw new Error("LiveShareClient: timed out attempting to create or get container for current context.")})}createNewContainer(e,t,r,i){return Qm(this,void 0,void 0,function*(){const{container:s,services:o}=yield e.createContainer(t);i&&i(s);const a=yield s.attach(),l=yield this._host.setFluidContainerId(a);return l.containerState!=$Y.ContainerState.added?(s.dispose(),Object.assign({created:!1},yield e.getContainer(l.containerId,t))):{container:s,services:o,created:!0}})}wait(e){return new Promise(t=>{setTimeout(()=>t(),e)})}}Df.LiveShareClient=UY;function W1(n,e){var t;return((t=e==null?void 0:e.connection)===null||t===void 0?void 0:t.type)=="local"||n instanceof BN.TestLiveShareHost}var UN={};(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__awaiter||function(d,h,f,p){function g(S){return S instanceof f?S:new f(function(m){m(S)})}return new(f||(f=Promise))(function(S,m){function v(w){try{b(p.next(w))}catch(_){m(_)}}function y(w){try{b(p.throw(w))}catch(_){m(_)}}function b(w){w.done?S(w.value):g(w.value).then(v,y)}b((p=p.apply(d,h||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.LiveTimer=n.LiveTimerEvents=void 0;const t=Va,r=Co,i=Jn,s=Qa(),o=yi,a=Ja(),l=wo();var c;(function(d){d.started="started",d.played="played",d.paused="paused",d.finished="finished",d.onTick="onTick"})(c=n.LiveTimerEvents||(n.LiveTimerEvents={}));class u extends a.LiveDataObject{constructor(){super(...arguments),this._currentConfig={clientId:"",timestamp:0,data:{duration:0,position:0,running:!1}},this._defaultTickRate=20,this._tickRate=this._defaultTickRate}get tickRate(){return this._tickRate}set tickRate(h){this._tickRate=h}initialize(h){return e(this,void 0,void 0,function*(){l.LiveDataObjectInitializeNotNeededError.assert("LiveTimer:initialize",this.initializeState),l.UnexpectedError.assert(!this._synchronizer,"LiveTimer:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._allowedRoles=h||[],this._synchronizer=new r.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentConfig.data,(f,p)=>e(this,void 0,void 0,function*(){return yield this.remoteConfigReceived(f,p)}),f=>e(this,void 0,void 0,function*(){if(f)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(f){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,f}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}start(h){return e(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveTimer:start","start",this.initializeState),yield this.playInternal(h,0)})}play(){return e(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveTimer:play","play",this.initializeState),!this._currentConfig.data.running&&this._currentConfig.data.position<this._currentConfig.data.duration&&(yield this.playInternal(this._currentConfig.data.duration,this._currentConfig.data.position))})}playInternal(h,f){return e(this,void 0,void 0,function*(){const p={timestamp:this.liveRuntime.getTimestamp(),clientId:yield this.waitUntilConnected(),data:{duration:h,position:f,running:!0}};yield this.updateConfig(p,!0)})}pause(){return e(this,void 0,void 0,function*(){if(l.LiveDataObjectNotInitializedError.assert("LiveTimer:pause","pause",this.initializeState),this._currentConfig.data.running){const h=this.liveRuntime.getTimestamp(),f={timestamp:h,clientId:yield this.waitUntilConnected(),data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.position+(h-this._currentConfig.timestamp),running:!1}};yield this.updateConfig(f,!0)}})}remoteConfigReceived(h,f){return e(this,void 0,void 0,function*(){try{const p=yield this.liveRuntime.verifyRolesAllowed(f,this._allowedRoles),g={timestamp:this._currentConfig.timestamp,clientId:this._currentConfig.clientId},S=s.LiveEvent.isNewer(g,h),m=this.liveRuntime.getTimestamp(),v=this.endTimeFromConfig(h);if(p&&this._currentConfig.timestamp===0&&h.data.running===!0&&m>=v){const y={timestamp:v,clientId:h.clientId,data:{duration:h.data.duration,position:h.data.duration,running:!1}};return this.updateConfig(y,!1),!0}return JSON.stringify(this._currentConfig.data)===JSON.stringify(h.data)&&this._currentConfig.timestamp===h.timestamp?!1:p&&S?(this.updateConfig(h,!1),!0):!1}catch{return!1}})}updateConfig(h,f){return e(this,void 0,void 0,function*(){const p=Object.assign({clientId:h.clientId,configChangedAt:h.timestamp},h.data);if(this._currentConfig=h,h.data.position===0?this.emit(c.started,p,f):h.data.duration===h.data.position?this.emit(c.finished,p):h.data.running?this.emit(c.played,p,f):this.emit(c.paused,p,f),h.data.running&&this.startTicking(),f)return yield this._synchronizer.sendEvent(h.data)})}startTicking(){const h=()=>{if(this._currentConfig.data.running){const f=this.liveRuntime.getTimestamp(),p=this.endTimeFromConfig(this._currentConfig);if(f>=p){const g={timestamp:p,clientId:this._currentConfig.clientId,data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.duration,running:!1}};this.updateConfig(g,!1).catch(S=>{console.error(S)})}else this.emit(c.onTick,p-f),this.scheduleAnimationFrame(h)}};this.scheduleAnimationFrame(h)}scheduleAnimationFrame(h){this._tickRate<=this._defaultTickRate&&typeof requestAnimationFrame=="function"?requestAnimationFrame(h):setTimeout(h,this._tickRate)}endTimeFromConfig(h){return h.timestamp-h.data.position+h.data.duration}}u.TypeName="@microsoft/live-share:LiveTimer",u.factory=new t.DataObjectFactory(u.TypeName,u,[],{}),n.LiveTimer=u,o.DynamicObjectRegistry.registerObjectClass(u,u.TypeName)})(UN);var Bf={},Wr=K&&K.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(Bf,"__esModule",{value:!0});Bf.AzureLiveShareHost=void 0;const G1=Jn,HY=Qn();class eb{constructor(e){this._shouldWarnLocalTimestamp=e,this._azureAudienceDeferred=new HY.Deferred,this.hasWarned=!1}static create(e=!0){return new eb(e)}setAudience(e){this._azureAudienceDeferred.resolve(e)}registerClientId(e){var t;return Wr(this,void 0,void 0,function*(){const r=yield this.getClientInfo(e);return(t=r==null?void 0:r.roles)!==null&&t!==void 0?t:[]})}getClientInfo(e){return Wr(this,void 0,void 0,function*(){const t=yield this.getAudienceMemberInfo(e);if(!t)throw new Error("AzureLiveShareHost.getClientInfo: audience member not found");return{userId:t.userId,roles:this.getRolesForAudienceMember(t),displayName:t.userName}})}getNtpTime(){return Wr(this,void 0,void 0,function*(){!this.hasWarned&&this._shouldWarnLocalTimestamp&&(console.warn(`AzureLiveShareHost is using a local timestamp, which could cause issues when use some LiveDataObject data structures across multiple clients.

                To disable this warning, set _shouldWarn in AzureLiveShareHost.create() to false.

                To resolve synchronization issues you may encounter, you should implement a service API to get this timestamp value and override this function.`),this.hasWarned=!0);const e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})})}getClientRoles(e){return Wr(this,void 0,void 0,function*(){const t=yield this.getClientInfo(e);return t==null?void 0:t.roles})}getFluidTenantInfo(){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidTenantInfo: not implemented exception")})}getFluidToken(e){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidToken: not implemented exception")})}getFluidContainerId(){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidContainerId: not implemented exception")})}setFluidContainerId(e){return Wr(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.setFluidContainerId: not implemented exception")})}getAudienceMemberInfo(e){return Wr(this,void 0,void 0,function*(){const r=[...(yield this._azureAudienceDeferred.promise).getMembers().values()];for(let i=0;i<r.length;i++){const s=r[i];if(s.connections.find(o=>o.id===e))return s}})}getRolesForAudienceMember(e){return e.connections.length===0?[]:e.connections[e.connections.length-1].mode==="write"?[G1.UserMeetingRole.presenter]:[G1.UserMeetingRole.attendee]}}Bf.AzureLiveShareHost=eb;(function(n){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=K&&K.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),t=K&&K.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(yi,n),t(iu,n),t(Jn,n),t(Qa(),n),t(uN(),n),t(cu,n),t(lu,n),t(Af,n),t(jS,n),t(Mf(),n),t(dN,n),t(Df,n),t(BS,n),t(Eo,n),t(UN,n),t(uu,n),t(du,n),t(Xa,n),t(su,n),t(oi,n),t(Ja(),n),t(hu,n),t(Bf,n),t(Co,n),t(wo(),n)})(Ud);const K1={initialObjects:{bus:Ud.LiveEvent,flags:xc,phase:Ud.LiveState}},HN=U.createContext({container:null,bus:null,flags:null,phase:null,loading:!0,error:null}),tb=()=>{const n=U.useContext(HN);if(!n)throw new Error("useLiveShare must be used within a LiveShareProvider");return n},VN=({children:n})=>{const[e,t]=U.useState(!0),[r,i]=U.useState(null),s=U.useRef(null),o=U.useRef(null),a=U.useRef(null),l=U.useRef(null);U.useEffect(()=>{let u=!0;return(async()=>{try{console.log("[LiveShareProvider] ==================== STARTING INITIALIZATION ===================="),console.log("[LiveShareProvider] Step 1: Initializing Teams SDK..."),await Ah(),console.log("[LiveShareProvider] ✅ Teams SDK initialized successfully"),console.log("[LiveShareProvider] Step 2: Creating LiveShareHost...");const h=l0.create();console.log("[LiveShareProvider] ✅ LiveShareHost created:",h),console.log("[LiveShareProvider] Step 3: Creating LiveShareClient...");const f=new Ud.LiveShareClient(h);console.log("[LiveShareProvider] ✅ LiveShareClient created:",f),console.log("[LiveShareProvider] Step 4: Joining container with schema:",K1);const{container:p}=await f.joinContainer(K1);if(console.log("[LiveShareProvider] ✅ Container joined successfully:",p),!u){console.log("[LiveShareProvider] ⚠️ Component unmounted during initialization, aborting");return}console.log("[LiveShareProvider] Step 5: Extracting Live Share objects..."),s.current=p,o.current=p.initialObjects.bus,a.current=p.initialObjects.flags,l.current=p.initialObjects.phase,console.log("[LiveShareProvider] ✅ Live Share objects extracted:"),console.log("[LiveShareProvider] - bus:",o.current),console.log("[LiveShareProvider] - flags:",a.current),console.log("[LiveShareProvider] - phase:",l.current);const g=o.current,S=a.current,m=l.current;if(console.log("[LiveShareProvider] Step 6: Initializing LiveEvent (bus)..."),g&&typeof g.initialize=="function"?(console.log("[LiveShareProvider] Calling bus.initialize()..."),await g.initialize(),console.log("[LiveShareProvider] ✅ LiveEvent initialized successfully")):console.log("[LiveShareProvider] ⚠️ Bus object missing or no initialize method:",g),console.log("[LiveShareProvider] Step 7: Initializing LiveState..."),m&&typeof m.initialize=="function"?(console.log("[LiveShareProvider] Calling phase.initialize('idle')..."),await m.initialize("idle"),console.log("[LiveShareProvider] ✅ LiveState initialized with 'idle'")):console.log("[LiveShareProvider] ⚠️ Phase object missing or no initialize method:",m),console.log("[LiveShareProvider] Step 8: Setting SharedMap defaults..."),S){const v=S.get("roundVisible"),y=S.get("editingEnabled"),b=S.get("clearAllCounter");console.log("[LiveShareProvider] Current SharedMap values:"),console.log("[LiveShareProvider] - roundVisible:",v),console.log("[LiveShareProvider] - editingEnabled:",y),console.log("[LiveShareProvider] - clearAllCounter:",b),v===void 0&&(console.log("[LiveShareProvider] Setting roundVisible = false"),S.set("roundVisible",!1)),y===void 0&&(console.log("[LiveShareProvider] Setting editingEnabled = false"),S.set("editingEnabled",!1)),b===void 0&&(console.log("[LiveShareProvider] Setting clearAllCounter = 0"),S.set("clearAllCounter",0)),console.log("[LiveShareProvider] ✅ SharedMap defaults set")}else console.log("[LiveShareProvider] ⚠️ Flags object is null/undefined");console.log("[LiveShareProvider] ==================== INITIALIZATION COMPLETE ====================")}catch(h){console.error("[LiveShareProvider] ❌ INITIALIZATION FAILED:"),console.error("[LiveShareProvider] Error type:",typeof h),console.error("[LiveShareProvider] Error message:",h instanceof Error?h.message:String(h)),console.error("[LiveShareProvider] Error stack:",h instanceof Error?h.stack:"No stack trace"),console.error("[LiveShareProvider] Full error object:",h),u&&i(h instanceof Error?h.message:String(h))}finally{u&&(console.log("[LiveShareProvider] Setting loading = false"),t(!1))}})(),()=>{u=!1}},[]);const c={container:s.current,bus:o.current,flags:a.current,phase:l.current,loading:e,error:r};return console.log("[LiveShareProvider] Context value update:"),console.log("[LiveShareProvider] - container:",c.container),console.log("[LiveShareProvider] - bus:",c.bus),console.log("[LiveShareProvider] - flags:",c.flags),console.log("[LiveShareProvider] - phase:",c.phase),console.log("[LiveShareProvider] - loading:",c.loading),console.log("[LiveShareProvider] - error:",c.error),M.jsx(HN.Provider,{value:c,children:n})};function VY({onCanvasReady:n,onControlsReady:e,userInfo:t}){console.log("[PrivateCanvas] ===== COMPONENT MOUNT/RENDER =====",{userInfo:t});const r=U.useRef(null),i=U.useRef(null),s=U.useRef(null),o=U.useRef(!1);U.useEffect(()=>(console.log("[PrivateCanvas] Component mounted!"),()=>{console.log("[PrivateCanvas] ===== COMPONENT UNMOUNTING =====")}),[]);const{bus:a,flags:l,loading:c}=tb(),[u,d]=U.useState(!0);U.useEffect(()=>{console.log("[PrivateCanvas] Canvas editing enabled state changed to:",u)},[u]);const[h,f]=U.useState([]),[p,g]=U.useState([]);U.useEffect(()=>{const T=r.current;T&&(f([T.toDataURL()]),g([]))},[]);const S=()=>{const T=r.current;T&&(f(N=>[...N,T.toDataURL()]),g([]))},[m,v]=U.useState({tool:"pen",color:"#000000",penSize:5,eraserSize:20,fontSize:16,isDrawing:!1,lastPoint:null}),[y,b]=U.useState({visible:!1,x:0,y:0,text:"",fontSize:16}),w=()=>y.visible?y.text.trim()?(console.log("[PrivateCanvas] commitOrHideActiveText: committing text due to navigation away"),P(y.text),!0):(console.log("[PrivateCanvas] commitOrHideActiveText: hiding empty text input due to navigation away"),b(T=>({...T,visible:!1})),!1):!1;U.useEffect(()=>{console.log("[PrivateCanvas] ===== CANVAS INITIALIZATION STARTING =====");const T=r.current;if(!T){console.log("[PrivateCanvas] ❌ No canvas ref available!");return}console.log("[PrivateCanvas] ✅ Canvas ref found:",T);const N=T.getContext("2d");if(!N){console.log("[PrivateCanvas] ❌ Failed to get 2D context!");return}console.log("[PrivateCanvas] ✅ Canvas context obtained:",N);const D=()=>{var se;const G=(se=T.parentElement)==null?void 0:se.getBoundingClientRect();if(G&&(T.width!==G.width||T.height!==G.height)){const ae=N.getImageData(0,0,T.width,T.height);T.width=G.width,T.height=G.height,N.putImageData(ae,0,0),N.lineCap="round",N.lineJoin="round",N.imageSmoothingEnabled=!0,console.log("[PrivateCanvas] Resized canvas to",T.width,T.height)}};return N.lineCap="round",N.lineJoin="round",N.imageSmoothingEnabled=!0,D(),window.addEventListener("resize",D),i.current=N,console.log("[PrivateCanvas] ✅ Canvas initialized successfully!",{canvasWidth:T.width,canvasHeight:T.height,hasContext:!!N,contextRef:!!i.current}),console.log("[PrivateCanvas] ===== CANVAS INITIALIZATION COMPLETE ====="),n==null||n(T,N),()=>{window.removeEventListener("resize",D)}},[n]),U.useEffect(()=>{if(!a||c){console.log("[PrivateCanvas] Live Share bus not ready yet, skipping event listener setup");return}console.log("[PrivateCanvas] Setting up Live Share event listeners");const T=N=>{var D,G;switch(console.log("[PrivateCanvas] Received Live Share event:",N),N.type){case"clearAll":console.log("[PrivateCanvas] Handling clearAll event"),C();break;case"enableCanvas":console.log("[PrivateCanvas] Ignoring enableCanvas event - private canvas should always be enabled");break;case"disableCanvas":console.log("[PrivateCanvas] Ignoring disableCanvas event - private canvas should always be enabled");break;case"shareCanvas":console.log("[PrivateCanvas] Handling shareCanvas event - exporting canvas data");const se=L();se&&a&&(a.send({type:"canvasData",...se}),console.log("[PrivateCanvas] Canvas data sent to stage for user:",se.userName));break;case"send-content-to-all":if(console.log("[PrivateCanvas] Handling send-content-to-all event"),((D=t==null?void 0:t.userPrincipalName)==null?void 0:D.toLowerCase())==="vithoma@microsoft.com"){console.log("[PrivateCanvas] Host detected - exporting canvas content to share with all");const ae=L();ae&&a&&(a.send({type:"host-canvas-content",...ae,isFromHost:!0}),console.log("[PrivateCanvas] Host canvas content broadcasted to all clients"))}else console.log("[PrivateCanvas] Non-host user - will wait for host canvas content to apply");break;case"host-canvas-content":console.log("[PrivateCanvas] Received host canvas content"),((G=t==null?void 0:t.userPrincipalName)==null?void 0:G.toLowerCase())!=="vithoma@microsoft.com"&&N.isFromHost?(console.log("[PrivateCanvas] Applying host canvas content to overwrite current canvas"),H(N)):console.log("[PrivateCanvas] Ignoring host canvas content - either this is the host or content not from host");break;default:console.log("[PrivateCanvas] Unhandled Live Share event type:",N.type)}};return a.on("received",T),()=>{console.log("[PrivateCanvas] Cleaning up Live Share event listeners"),a.off("received",T)}},[a,c,y.visible,y.text]),U.useEffect(()=>{console.log("[PrivateCanvas] Ensuring private canvas is always enabled"),d(!0)},[l,c]),U.useEffect(()=>{const T=setTimeout(()=>{var G;const N=r.current,D=i.current;if(N&&D){console.log("[PrivateCanvas] Force reinitializing canvas after delay...");const se=(G=N.parentElement)==null?void 0:G.getBoundingClientRect();se&&(N.width===0||N.height===0||N.width!==se.width||N.height!==se.height)?(console.log("[PrivateCanvas] Canvas has invalid size, forcing resize:",{currentSize:{width:N.width,height:N.height},targetSize:{width:se.width,height:se.height}}),N.width=se.width,N.height=se.height,D.lineCap="round",D.lineJoin="round",D.imageSmoothingEnabled=!0,console.log("[PrivateCanvas] ✅ Canvas force reinitialized successfully!")):console.log("[PrivateCanvas] Canvas size appears correct, no reinitialization needed")}},1e3);return()=>clearTimeout(T)},[]);const _=T=>{const N=r.current;if(!N)return console.log("[PrivateCanvas] ❌ getCanvasPoint: No canvas ref!"),{x:0,y:0};const D=N.getBoundingClientRect(),G=N.width/D.width,se=N.height/D.height;if(console.log("[PrivateCanvas] getCanvasPoint: canvas state check",{hasCanvas:!!N,canvasWidth:N.width,canvasHeight:N.height,rectWidth:D.width,rectHeight:D.height,scaleX:G,scaleY:se,hasContext:!!i.current}),"touches"in T&&T.touches.length>0){const ae={x:(T.touches[0].clientX-D.left)*G,y:(T.touches[0].clientY-D.top)*se};return console.log("[PrivateCanvas] Touch point:",ae,"from",T.touches[0].clientX,T.touches[0].clientY),ae}else{const ae=T,_e={x:(ae.clientX-D.left)*G,y:(ae.clientY-D.top)*se};return console.log("[PrivateCanvas] Mouse point:",_e,"from",ae.clientX,ae.clientY),_e}},E=T=>{console.log("[PrivateCanvas] handleTextInput called, current textInput visible:",y.visible,"text:",y.text),y.visible&&y.text.trim()&&(console.log("[PrivateCanvas] Committing existing text before creating new input:",y.text),P(y.text));const N=_(T),D=r.current;if(!D)return;const G=D.getBoundingClientRect(),se=G.left+N.x*G.width/D.width,ae=G.top+N.y*G.height/D.height;b({visible:!0,x:se,y:ae,text:"",fontSize:m.fontSize}),setTimeout(()=>{var _e;(_e=s.current)==null||_e.focus()},10),console.log("[PrivateCanvas] Showing text input at",{point:N,displayX:se,displayY:ae})},P=T=>{S();const N=i.current,D=r.current,G=T||y.text,se=y.fontSize,ae=y.x,_e=y.y;if(console.log("[PrivateCanvas] commitText: Hiding text input, finalText:",G),b(gn=>({...gn,visible:!1})),!G.trim()||!N||!D){console.log("[PrivateCanvas] No text to commit or missing context/canvas");return}const lt=D.getBoundingClientRect(),Et=(ae-lt.left)/lt.width*D.width,sn=(_e-lt.top)/lt.height*D.height;N.globalCompositeOperation="source-over",N.fillStyle=m.color,N.font=`${se}px "Comic Sans MS", cursive, sans-serif`,N.textAlign="left",N.textBaseline="top",N.globalAlpha=1,N.fillText(G,Et,sn),console.log("[PrivateCanvas] Added text:",G,"at",{canvasX:Et,canvasY:sn},"fontSize:",se)},A=T=>{T.key==="Enter"?P():T.key==="Escape"&&(console.log("[PrivateCanvas] handleTextInputKeyDown: Escape pressed, hiding text input with text:",y.text),b(N=>({...N,visible:!1})))},F=T=>{T.preventDefault();const N=T.deltaY>0?-2:2,D=Math.max(10,Math.min(72,y.fontSize+N));b(G=>({...G,fontSize:D})),console.log("[PrivateCanvas] Mouse wheel font size changed to:",D)},X=T=>{console.log("[PrivateCanvas] handleTextInputBlur called! Event target:",T.target),setTimeout(()=>{var ae;const N=T.target.value||"",D=((ae=s.current)==null?void 0:ae.value)||"",G=y.text||"",se=N||D||G;console.log("[PrivateCanvas] Blur event - eventText:",N,"refText:",D,"stateText:",G,"using:",se),se.trim()?P(se):(console.log("[PrivateCanvas] handleTextInputBlur: No text to commit, hiding text input"),b(_e=>({..._e,visible:!1})))},0)},z=T=>{T.preventDefault(),console.log("[PrivateCanvas] startDrawing called - PRIVATE CANVAS ALWAYS ENABLED, tool:",m.tool);const N=_(T);if(console.log("[PrivateCanvas] Start drawing at",N,"with state",m),m.tool==="text"){E(T);return}w(),v(G=>({...G,isDrawing:!0,lastPoint:N}));const D=i.current;if(!D){console.log("[PrivateCanvas] ❌ No context available for drawing!");return}switch(console.log("[PrivateCanvas] ✅ Context available, starting drawing with tool:",m.tool),m.tool){case"pen":D.globalCompositeOperation="source-over",D.strokeStyle=m.color,D.lineWidth=m.penSize,D.globalAlpha=1;break;case"eraser":D.globalCompositeOperation="destination-out",D.lineWidth=m.eraserSize;break}D.beginPath(),D.moveTo(N.x,N.y)},ee=T=>{if((!m.isDrawing||m.tool==="text")&&!o.current)return;T.preventDefault();const N=_(T),D=i.current;D&&(D.lineTo(N.x,N.y),D.stroke(),console.log("[PrivateCanvas] Draw to",N,o.current?"(right-erase)":""),v(G=>({...G,lastPoint:N})))},W=()=>{m.isDrawing&&S(),v(D=>({...D,isDrawing:!1,lastPoint:null}));const T=i.current,N=r.current;!T||!N||(T.beginPath(),o.current&&(T.globalCompositeOperation="source-over",o.current=!1),console.log("[PrivateCanvas] Stop drawing"))},C=()=>{S();const T=i.current,N=r.current;!T||!N||(T.clearRect(0,0,N.width,N.height),console.log("[PrivateCanvas] Canvas cleared"))},L=()=>{const T=r.current;if(!T)return console.log("[PrivateCanvas] Cannot export canvas data - no canvas ref"),null;try{const D={imageData:T.toDataURL("image/png"),width:T.width,height:T.height,userName:(t==null?void 0:t.displayName)||(t==null?void 0:t.userPrincipalName)||"Unknown User",userId:(t==null?void 0:t.id)||(t==null?void 0:t.userObjectId)||(t==null?void 0:t.aadObjectId)||"unknown",timestamp:Date.now()};return console.log("[PrivateCanvas] Exported canvas data for user:",D.userName),D}catch(N){return console.error("[PrivateCanvas] Error exporting canvas data:",N),null}},H=T=>{const N=r.current,D=i.current;if(!N||!D||!(T!=null&&T.imageData)){console.log("[PrivateCanvas] Cannot import canvas data - missing canvas, context, or image data");return}console.log("[PrivateCanvas] Importing canvas data from:",T.userName||"Unknown User");try{S();const G=new window.Image;G.onload=()=>{D.clearRect(0,0,N.width,N.height),D.drawImage(G,0,0,N.width,N.height),console.log("[PrivateCanvas] ✅ Canvas content successfully imported and applied")},G.onerror=se=>{console.error("[PrivateCanvas] ❌ Failed to load imported image:",se)},G.src=T.imageData}catch(G){console.error("[PrivateCanvas] ❌ Error importing canvas data:",G)}},I=()=>{const T=r.current,N=i.current;f(D=>{if(D.length<=1||!T||!N)return console.log("[PrivateCanvas] Undo: nothing to undo. Undo stack length:",D.length),D;const G=p.length;g(_e=>[T.toDataURL(),..._e]);const se=D[D.length-2],ae=new window.Image;return ae.onload=()=>{N.clearRect(0,0,T.width,T.height),N.drawImage(ae,0,0,T.width,T.height),console.log("[PrivateCanvas] Undo: restored previous state. Undo stack length:",D.length-1,"Redo stack length:",G+1)},ae.src=se,D.slice(0,-1)})},B=()=>{const T=r.current,N=i.current;g(D=>D.length===0||!T||!N?(console.log("[PrivateCanvas] Redo: nothing to redo. Redo stack length:",D.length),D):(f(G=>{const se=new window.Image;return se.onload=()=>{N.clearRect(0,0,T.width,T.height),N.drawImage(se,0,0,T.width,T.height),console.log("[PrivateCanvas] Redo: restored next state. Undo stack length:",G.length+1,"Redo stack length:",D.length-1)},se.src=D[0],[...G,D[0]]}),D.slice(1)))},x=T=>{console.log("[PrivateCanvas] Tool change requested to",T,"current textInput visible:",y.visible,"text:",y.text),y.visible&&y.text.trim()?(console.log("[PrivateCanvas] Committing active text before tool change:",y.text),P(y.text)):y.visible&&(console.log("[PrivateCanvas] Hiding empty text input before tool change"),b(N=>({...N,visible:!1}))),v(N=>(console.log("[PrivateCanvas] Tool changed to",T),{...N,tool:T}))},j=T=>{w(),v(N=>(console.log("[PrivateCanvas] Color changed to",T),{...N,color:T}))},Y=T=>{w(),v(N=>(console.log("[PrivateCanvas] Pen size changed to",T),{...N,penSize:T}))},ye=T=>{w(),v(N=>(console.log("[PrivateCanvas] Eraser size changed to",T),{...N,eraserSize:T}))},re=T=>{w(),v(N=>(console.log("[PrivateCanvas] Font size changed to",T),{...N,fontSize:T}))};return U.useEffect(()=>{const T={setTool:x,setColor:j,setPenSize:Y,setEraserSize:ye,setFontSize:re,clearCanvas:C,undo:I,redo:B,drawingState:m};console.log("[PrivateCanvas] Exposing controls to parent (one time only)"),e==null||e(T)},[]),U.useEffect(()=>{e&&e({setTool:x,setColor:j,setPenSize:Y,setEraserSize:ye,setFontSize:re,clearCanvas:C,undo:I,redo:B,drawingState:m})},[m.tool,m.penSize,m.eraserSize,m.fontSize,m.color]),U.useEffect(()=>{if(!y.visible)return;const T=N=>{const D=r.current,G=s.current;D&&(G&&(G===N.target||G.contains(N.target))||D===N.target||D.contains(N.target)||w())};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[y.visible,y.text,y.x,y.y]),M.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[M.jsx("canvas",{ref:r,onContextMenu:T=>{T.preventDefault()},onMouseDown:T=>{if(console.log("[PrivateCanvas] Mouse down event - button:",T.button,"PRIVATE CANVAS ALWAYS ENABLED"),T.button===1){T.preventDefault(),y.visible&&y.text.trim()&&P(y.text),E(T);return}if(T.button===2){T.preventDefault();const N=_(T),D=i.current;D&&(o.current=!0,v(G=>({...G,isDrawing:!0,lastPoint:N})),D.globalCompositeOperation="destination-out",D.lineWidth=m.eraserSize,D.beginPath(),D.moveTo(N.x,N.y));return}z(T)},onMouseMove:T=>{ee(T)},onMouseUp:T=>{console.log("[PrivateCanvas] Mouse up event",T),W()},onMouseLeave:T=>{console.log("[PrivateCanvas] Mouse leave event",T),W()},onTouchStart:T=>{console.log("[PrivateCanvas] Touch start event - PRIVATE CANVAS ALWAYS ENABLED"),z(T)},onTouchMove:T=>{console.log("[PrivateCanvas] Touch move event",T),ee(T)},onTouchEnd:T=>{console.log("[PrivateCanvas] Touch end event",T),W()},style:{width:"100%",height:"100%",display:"block",touchAction:"none",cursor:m.tool==="eraser"?"grab":m.tool==="text"?"text":`url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23000' d='M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z'/%3E%3C/svg%3E") 2 22, crosshair`}}),y.visible&&M.jsxs("div",{style:{position:"fixed",left:y.x,top:y.y-30,zIndex:1e3},children:[M.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"11px",marginBottom:"2px",whiteSpace:"nowrap"},children:["Mouse wheel to resize (",y.fontSize,"px)"]}),M.jsx("input",{ref:s,type:"text",value:y.text,onChange:T=>b(N=>({...N,text:T.target.value})),onKeyDown:A,onBlur:X,onWheel:F,style:{border:"none",borderRadius:"0",padding:"0",fontSize:`${y.fontSize}px`,fontFamily:'"Comic Sans MS", cursive, sans-serif',color:m.color,backgroundColor:"transparent",outline:"none",minWidth:"120px"},placeholder:"Type text..."})]})]})}function WY({canvasControls:n,userInfo:e,meetingInfo:t}){const{setTool:r,setColor:i,setPenSize:s,setEraserSize:o,setFontSize:a,clearCanvas:l,drawingState:c}=n,[u,d]=U.useState(!1),[h,f]=U.useState(!1),[p,g]=U.useState(!1),[S,m]=U.useState(null),[v,y]=U.useState(null),[b,w]=U.useState(null),_=x=>{console.log("[PrivateToolbar] Tool button clicked:",x),r(x)},E=x=>{console.log("[PrivateToolbar] Color button clicked:",x),i(x)},P=x=>{const j=Number(x.target.value);console.log("[PrivateToolbar] Pen size changed:",j),c.tool!=="pen"&&_("pen"),s(j)},A=x=>{const j=Number(x.target.value);console.log("[PrivateToolbar] Eraser size changed:",j),c.tool!=="eraser"&&_("eraser"),o(j)},F=x=>{const j=Number(x.target.value);console.log("[PrivateToolbar] Font size changed:",j),c.tool!=="text"&&_("text"),a(j)},X=()=>{console.log("[PrivateToolbar] Clear button clicked"),l()},z=()=>{console.log("[PrivateToolbar] Undo button clicked"),n.undo?(console.log("[PrivateToolbar] Calling canvasControls.undo"),n.undo(),console.log("[PrivateToolbar] canvasControls.undo call finished")):console.log("[PrivateToolbar] canvasControls.undo is not defined")},ee=()=>{console.log("[PrivateToolbar] Redo button clicked"),n.redo?(console.log("[PrivateToolbar] Calling canvasControls.redo"),n.redo(),console.log("[PrivateToolbar] canvasControls.redo call finished")):console.log("[PrivateToolbar] canvasControls.redo is not defined")},W=()=>{S&&(clearTimeout(S),m(null)),f(!1),g(!1),v&&(clearTimeout(v),y(null)),b&&(clearTimeout(b),w(null)),d(!0)},C=()=>{const x=setTimeout(()=>{d(!1)},300);m(x)},L=()=>{v&&(clearTimeout(v),y(null)),d(!1),g(!1),S&&(clearTimeout(S),m(null)),b&&(clearTimeout(b),w(null)),f(!0)},H=()=>{const x=setTimeout(()=>{f(!1)},1e3);y(x)},I=()=>{b&&(clearTimeout(b),w(null)),d(!1),f(!1),S&&(clearTimeout(S),m(null)),v&&(clearTimeout(v),y(null)),g(!0)},B=()=>{const x=setTimeout(()=>{g(!1)},1e3);w(x)};return U.useEffect(()=>{const x=j=>{(j.ctrlKey||j.metaKey)&&!j.shiftKey&&j.key.toLowerCase()==="z"?(j.preventDefault(),z()):(j.ctrlKey||j.metaKey)&&j.key.toLowerCase()==="y"&&(j.preventDefault(),ee())};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[n]),M.jsxs("div",{className:"toolbar",children:[M.jsxs("div",{className:"tool-group",children:[M.jsx("label",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:"Tools:"}),M.jsxs("div",{style:{position:"relative",display:"block",width:"100%"},onMouseEnter:W,onMouseLeave:C,children:[M.jsx("button",{className:c.tool==="pen"?"selected":"",onClick:()=>_("pen"),style:{padding:"8px 12px",margin:"2px 0",border:c.tool==="pen"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="pen"?"#e6f3ff":"white",cursor:"pointer",width:"100%",textAlign:"left"},children:"✏️ Pen"}),u&&M.jsxs("div",{style:{position:"absolute",top:"0",left:"100%",marginLeft:"5px",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[M.jsx("input",{type:"range",min:"1",max:"10",value:c.penSize,onChange:P,style:{width:"80px"}}),M.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.penSize,"px"]})]})]}),M.jsxs("div",{style:{position:"relative",display:"block",width:"100%"},onMouseEnter:L,onMouseLeave:H,children:[M.jsx("button",{className:c.tool==="eraser"?"selected":"",onClick:()=>_("eraser"),style:{padding:"8px 12px",margin:"2px 0",border:c.tool==="eraser"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="eraser"?"#e6f3ff":"white",cursor:"pointer",width:"100%",textAlign:"left"},children:"🧽 Eraser"}),h&&M.jsxs("div",{style:{position:"absolute",top:"0",left:"100%",marginLeft:"5px",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[M.jsx("input",{type:"range",min:"5",max:"50",value:c.eraserSize,onChange:A,style:{width:"80px"}}),M.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.eraserSize,"px"]})]})]}),M.jsxs("div",{style:{position:"relative",display:"block",width:"100%"},onMouseEnter:I,onMouseLeave:B,children:[M.jsx("button",{className:c.tool==="text"?"selected":"",onClick:()=>_("text"),style:{padding:"8px 12px",margin:"2px 0",border:c.tool==="text"?"2px solid #0078d4":"1px solid #ccc",borderRadius:"4px",background:c.tool==="text"?"#e6f3ff":"white",cursor:"pointer",width:"100%",textAlign:"left"},children:"📝 Text"}),p&&M.jsxs("div",{style:{position:"absolute",top:"0",left:"100%",marginLeft:"5px",zIndex:10,background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[M.jsx("input",{type:"range",min:"10",max:"72",value:c.fontSize,onChange:F,style:{width:"80px"}}),M.jsxs("div",{style:{fontSize:"12px",textAlign:"center"},children:[c.fontSize,"px"]})]})]})]}),M.jsxs("div",{className:"tool-group",children:[M.jsx("label",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:"Color:"}),M.jsx("input",{type:"color",value:c.color,onChange:x=>E(x.target.value),style:{width:"100%",height:"40px",margin:"2px 0",border:"1px solid #ccc",borderRadius:"4px",cursor:"pointer"}})]}),M.jsxs("div",{className:"tool-group",children:[M.jsx("label",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:"Actions:"}),M.jsx("button",{onClick:z,style:{padding:"8px 12px",margin:"2px 0",border:"1px solid #ccc",borderRadius:"4px",background:"white",cursor:"pointer",width:"100%"},children:"↩️ Undo"}),M.jsx("button",{onClick:ee,style:{padding:"8px 12px",margin:"2px 0",border:"1px solid #ccc",borderRadius:"4px",background:"white",cursor:"pointer",width:"100%"},children:"↪️ Redo"})]}),M.jsx("div",{className:"tool-group",children:M.jsx("button",{onClick:X,style:{padding:"8px 12px",margin:"2px 0",border:"1px solid #d13438",borderRadius:"4px",background:"#f8d7da",color:"#721c24",cursor:"pointer",fontWeight:"bold",width:"100%"},children:"🗑️ Clear All"})})]})}const GY=()=>{const[n,e]=U.useState(!1),t=U.useRef(null),[r,i]=U.useState(!1),[s,o]=U.useState(!0),{bus:a,flags:l,phase:c,loading:u,error:d}=tb();U.useEffect(()=>{let S=!0;(async()=>{var y,b;try{console.log("[HostActionsButton] ==================== STARTING AUTH INIT ===================="),console.log("[HostActionsButton] Initializing Teams SDK for user context..."),await Ah(),console.log("[HostActionsButton] ✅ Teams SDK initialized"),console.log("[HostActionsButton] Getting Teams context...");const w=await a0();console.log("[HostActionsButton] ✅ Teams context received:",w);const _=w==null?void 0:w.user,E=w==null?void 0:w.meeting;console.log("[HostActionsButton] User info:",_),console.log("[HostActionsButton] Meeting context:",E);const P=(b=(y=_==null?void 0:_.userPrincipalName)==null?void 0:y.toLowerCase)==null?void 0:b.call(y);console.log("[HostActionsButton] User email:",P);let A=!1;console.log("[HostActionsButton] Checking if user is vithoma@microsoft.com..."),P==="vithoma@microsoft.com"?(console.log("[HostActionsButton] ✅ User is vithoma@microsoft.com - granted host access"),A=!0):console.log("[HostActionsButton] ❌ User is not vithoma@microsoft.com - denied host access"),console.log("[HostActionsButton] Final host detection result:",A),S&&i(!!A),console.log("[HostActionsButton] ==================== AUTH INIT COMPLETE ====================")}catch(w){console.error("[HostActionsButton] ❌ AUTH INIT FAILED:",w)}finally{S&&(console.log("[HostActionsButton] Setting authLoading = false"),o(!1))}})();const m=y=>{t.current&&(t.current.contains(y.target)||e(!1))},v=y=>{y.key==="Escape"&&e(!1)};return document.addEventListener("mousedown",m),document.addEventListener("keydown",v),()=>{S=!1,document.removeEventListener("mousedown",m),document.removeEventListener("keydown",v)}},[]);async function h(S,m){if(console.log(`[HostActionsButton] ==================== BROADCASTING ACTION: ${S} ====================`),!a||!l||!c){console.error("[HostActionsButton] ❌ Live Share objects not available!"),console.error("[HostActionsButton] - bus:",a),console.error("[HostActionsButton] - flags:",l),console.error("[HostActionsButton] - phase:",c);return}console.log("[HostActionsButton] ✅ Live Share objects available, proceeding with broadcast"),console.log(`[HostActionsButton] Action type: ${S}`),console.log("[HostActionsButton] Payload:",m);try{const v={type:S,...m,ts:Date.now()};console.log("[HostActionsButton] Step 1: Sending LiveEvent with data:",v);const y=await a.send(v);console.log("[HostActionsButton] ✅ LiveEvent sent successfully:",y),console.log("[HostActionsButton] Step 2: Updating SharedMap and LiveState...");const b=Date.now();switch(S){case"clear-all":console.log("[HostActionsButton] Processing clear-all action..."),l.set("lastAction","clear-all"),l.set("lastActionAt",b);const w=(Number(l.get("clearAllCounter"))||0)+1;console.log("[HostActionsButton] Setting clearAllCounter to:",w),l.set("clearAllCounter",w),c.set&&(console.log("[HostActionsButton] Setting phase to 'idle'"),await c.set("idle"));break;case"share-all":console.log("[HostActionsButton] Processing share-all action..."),l.set("roundVisible",!0),l.set("lastAction","share-all"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'visible'"),await c.set("visible"));break;case"enable-editing":console.log("[HostActionsButton] Processing enable-editing action..."),l.set("editingEnabled",!0),l.set("lastAction","enable-editing"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'editing'"),await c.set("editing"));break;case"start-stage-page":console.log("[HostActionsButton] Processing start-stage-page action..."),l.set("stagePageActive",!0),l.set("lastAction","start-stage-page"),l.set("lastActionAt",b),c.set&&(console.log("[HostActionsButton] Setting phase to 'stage'"),await c.set("stage"));break;case"send-content-to-all":console.log("[HostActionsButton] Processing send-content-to-all action..."),l.set("sendContentToAll",!0),l.set("lastAction","send-content-to-all"),l.set("lastActionAt",b);const _=(Number(l.get("sendContentCounter"))||0)+1;console.log("[HostActionsButton] Setting sendContentCounter to:",_),l.set("sendContentCounter",_);break}console.log("[HostActionsButton] ✅ SharedMap and LiveState updated"),console.log("[HostActionsButton] Final SharedMap state:"),console.log("[HostActionsButton] - roundVisible:",l.get("roundVisible")),console.log("[HostActionsButton] - editingEnabled:",l.get("editingEnabled")),console.log("[HostActionsButton] - lastAction:",l.get("lastAction")),console.log("[HostActionsButton] - lastActionAt:",l.get("lastActionAt")),console.log("[HostActionsButton] - clearAllCounter:",l.get("clearAllCounter")),console.log("[HostActionsButton] ==================== BROADCAST COMPLETE ====================")}catch(v){console.error(`[HostActionsButton] ❌ BROADCAST FAILED for action ${S}:`),console.error("[HostActionsButton] Error type:",typeof v),console.error("[HostActionsButton] Error message:",v instanceof Error?v.message:String(v)),console.error("[HostActionsButton] Error stack:",v instanceof Error?v.stack:"No stack trace"),console.error("[HostActionsButton] Full error object:",v)}}const f=()=>h("send-content-to-all"),p=async()=>{try{console.log("[HostActionsButton] Starting stage page..."),await h("start-stage-page",{active:!0}),console.log("[HostActionsButton] Sharing content to meeting stage...");const S=`${window.location.origin}${window.location.pathname}?page=stage`;console.log("[HostActionsButton] Stage page URL:",S),NO((m,v)=>{m?console.error("[HostActionsButton] Error sharing to stage:",m):console.log("[HostActionsButton] Successfully shared to stage:",v)},S)}catch(S){console.error("[HostActionsButton] Error in onStartStagePage:",S)}};return u||s?M.jsx("button",{className:"px-3 py-2 rounded-lg bg-gray-100 text-gray-400 cursor-not-allowed",disabled:!0,children:"Host Actions"}):d?M.jsx("button",{className:"px-3 py-2 rounded-lg bg-red-100 text-red-400 cursor-not-allowed",disabled:!0,children:"Live Share Error"}):r?M.jsxs("div",{className:"relative inline-block",ref:t,children:[M.jsxs("button",{type:"button",onClick:()=>e(S=>!S),className:"px-4 py-2 rounded-lg font-medium transition-colors bg-indigo-600 hover:bg-indigo-700 text-white","aria-haspopup":"menu","aria-expanded":n,children:["Host Actions",M.jsx("span",{className:"ml-2 inline-block align-middle",children:"▾"})]}),n&&M.jsxs("div",{role:"menu","aria-label":"Host actions",className:"absolute right-0 mt-2 w-56 rounded-xl border border-gray-200 bg-white shadow-lg overflow-hidden z-50",children:[M.jsx("button",{role:"menuitem",onClick:()=>{e(!1),f()},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Send Content to All Canvases"}),M.jsx("button",{role:"menuitem",onClick:()=>{e(!1),p()},className:"w-full text-left px-4 py-2 hover:bg-gray-50",children:"Start Stage Page"})]})]}):null};function KY({userInfo:n,meetingInfo:e}){const[t,r]=U.useState(null),i=U.useCallback((o,a)=>{console.log("[PrivateWhiteboardApp] Canvas ready:",o.width,"x",o.height,o,a)},[]),s=U.useCallback(o=>{console.log("[PrivateWhiteboardApp] Controls ready:",o),r(o)},[]);return console.log("[PrivateWhiteboardApp] Render",{canvasControls:t}),M.jsx(VN,{children:M.jsxs("div",{className:"whiteboard-container private-whiteboard",children:[t&&M.jsx(WY,{canvasControls:t,userInfo:n,meetingInfo:e}),M.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[M.jsx(GY,{}),M.jsx("div",{className:"canvas-area",children:M.jsx("div",{className:"canvas-container",children:M.jsx(VY,{onCanvasReady:i,onControlsReady:s,userInfo:n})})})]})]})})}function J1({message:n="Loading..."}){return M.jsxs("div",{className:"loading-container",children:[M.jsx("div",{className:"spinner",style:{border:"4px solid #f3f3f3",borderTop:"4px solid #0078d4",borderRadius:"50%",width:"40px",height:"40px",animation:"spin 1s linear infinite"}}),M.jsx("p",{children:n}),M.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})}function JY({error:n}){return M.jsxs("div",{className:"error-container",children:[M.jsx("h2",{children:"Something went wrong"}),M.jsx("p",{children:n.message}),M.jsx("button",{onClick:()=>window.location.reload(),children:"Reload App"})]})}const QY=()=>{const{bus:n,flags:e,phase:t,loading:r,error:i}=tb(),[s,o]=U.useState(!1),[a,l]=U.useState(!0),[c,u]=U.useState(!1),[d,h]=U.useState(!1),[f,p]=U.useState(new Map),g=U.useRef(null),S=U.useRef(null),[m,v]=U.useState(!1),[y,b]=U.useState(null),w=U.useRef(!1),[_,E]=U.useState(1),[P,A]=U.useState({x:0,y:0}),[F,X]=U.useState(!1),[z,ee]=U.useState(null),[W,C]=U.useState(.6),[L,H]=U.useState(3),I=[{label:"1 per row",value:1},{label:"2 per row",value:2},{label:"3 per row",value:3},{label:"4 per row",value:4},{label:"5 per row",value:5},{label:"6 per row",value:6},{label:"8 per row",value:8},{label:"Auto (Square)",value:0}];U.useEffect(()=>{let O=!0;return(async()=>{var R,V;try{console.log("[StagePage] ==================== STARTING HOST DETECTION ===================="),console.log("[StagePage] Initializing Teams SDK for user context..."),await Ah(),console.log("[StagePage] ✅ Teams SDK initialized"),console.log("[StagePage] Getting Teams context...");const le=await a0();console.log("[StagePage] ✅ Teams context received:",le);const me=le==null?void 0:le.user,ze=le==null?void 0:le.meeting;console.log("[StagePage] User info:",me),console.log("[StagePage] Meeting context:",ze);const Ie=(V=(R=me==null?void 0:me.userPrincipalName)==null?void 0:R.toLowerCase)==null?void 0:V.call(R);console.log("[StagePage] User email:",Ie);let Ht=!1;console.log("[StagePage] Checking if user is vithoma@microsoft.com..."),Ie==="vithoma@microsoft.com"?(console.log("[StagePage] ✅ User is vithoma@microsoft.com - granted host access"),Ht=!0):console.log("[StagePage] ❌ User is not vithoma@microsoft.com - denied host access"),console.log("[StagePage] Final host detection result:",Ht),O&&o(!!Ht),console.log("[StagePage] ==================== HOST DETECTION COMPLETE ====================")}catch(le){console.error("[StagePage] ❌ Error during host detection:",le),O&&o(!1)}finally{O&&l(!1)}})(),()=>{O=!1}},[]),U.useEffect(()=>{if(e){const O=e.get("editingEnabled");u(!!O)}},[e]),U.useEffect(()=>{const O=g.current;if(!O)return;const R=O.getContext("2d");if(!R)return;R.lineCap="round",R.lineJoin="round",R.imageSmoothingEnabled=!0,R.fillStyle="#ffffff",R.fillRect(0,0,O.width,O.height),S.current=R;const V=()=>{(O.width!==1200||O.height!==800)&&(O.width=1200,O.height=800,R.fillStyle="#ffffff",R.fillRect(0,0,O.width,O.height),d&&f.size>0&&ae())};return V(),window.addEventListener("resize",V),()=>{window.removeEventListener("resize",V)}},[d,f]),U.useEffect(()=>{d&&f.size>0&&(console.log("[StagePage] Redrawing shared canvases"),ae())},[f,d]),U.useEffect(()=>{const O=g.current,R=S.current;if(!O||!R)return;console.log("[StagePage] Applying zoom/pan transformation and redrawing:",{zoomLevel:_,panOffset:P});const V=R.getImageData(0,0,O.width,O.height);R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,O.width,O.height),R.fillStyle="#ffffff",R.fillRect(0,0,O.width,O.height),d&&f.size>0&&ae(),R.translate(P.x,P.y),R.scale(_,_);const le=document.createElement("canvas");le.width=O.width,le.height=O.height;const me=le.getContext("2d");me&&(me.putImageData(V,0,0),R.globalAlpha=1,R.globalCompositeOperation="source-over")},[_,P,d,f]);const B=()=>{const O=S.current;O&&(O.setTransform(1,0,0,1,0,0),O.translate(P.x,P.y),O.scale(_,_))},x=O=>{const R=S.current;R&&(B(),O.isErase?(R.globalCompositeOperation="destination-out",R.lineWidth=O.lineWidth||20):(R.globalCompositeOperation="source-over",R.strokeStyle=O.strokeStyle||"#ff0000",R.lineWidth=O.lineWidth||3,R.globalAlpha=O.globalAlpha||.8),R.beginPath(),R.moveTo(O.point.x,O.point.y),console.log("[StagePage] Viewer: Replayed host draw start at",O.point))},j=O=>{const R=S.current;R&&(R.lineTo(O.point.x,O.point.y),R.stroke(),console.log("[StagePage] Viewer: Replayed host draw move to",O.point))},Y=O=>{const R=S.current;R&&(R.beginPath(),O.wasErase&&(R.globalCompositeOperation="source-over"),console.log("[StagePage] Viewer: Replayed host draw end"))},ye=O=>{const R=g.current,V=S.current;!R||!V||(console.log("[StagePage] Viewer: Replaying host clear operation:",O.clearType),V.setTransform(1,0,0,1,0,0),V.clearRect(0,0,R.width,R.height),V.fillStyle="#ffffff",V.fillRect(0,0,R.width,R.height),O.clearType==="annotations"&&d&&f.size>0&&ae(),B(),console.log("[StagePage] Viewer: Host clear operation replayed"))},re=O=>{console.log("[StagePage] Viewer: Replaying host zoom/pan:",O),E(O.zoomLevel),A(O.panOffset)},T=async(O,R,V,le,me)=>{if(!(!s||!n))try{await n.send({type:"hostDrawStart",point:O,isErase:R,strokeStyle:V,lineWidth:le,globalAlpha:me,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted draw start")}catch(ze){console.error("[StagePage] Host: Failed to broadcast draw start:",ze)}},N=async O=>{if(!(!s||!n))try{await n.send({type:"hostDrawMove",point:O,timestamp:Date.now()})}catch(R){console.error("[StagePage] Host: Failed to broadcast draw move:",R)}},D=async O=>{if(!(!s||!n))try{await n.send({type:"hostDrawEnd",wasErase:O,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted draw end")}catch(R){console.error("[StagePage] Host: Failed to broadcast draw end:",R)}},G=async O=>{if(!(!s||!n))try{await n.send({type:"hostClearCanvas",clearType:O,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted clear canvas:",O)}catch(R){console.error("[StagePage] Host: Failed to broadcast clear canvas:",R)}},se=async(O,R)=>{if(!(!s||!n))try{await n.send({type:"hostZoomPan",zoomLevel:O,panOffset:R,timestamp:Date.now()}),console.log("[StagePage] Host: Broadcasted zoom/pan change")}catch(V){console.error("[StagePage] Host: Failed to broadcast zoom/pan:",V)}};U.useEffect(()=>{if(!n||r){console.log("[StagePage] Live Share bus not ready yet, skipping event listener setup");return}console.log("[StagePage] Setting up Live Share event listener for canvas data and host drawing");const O=R=>{switch(console.log("[StagePage] Received Live Share event:",R),R.type){case"canvasData":console.log("[StagePage] Received canvas data from:",R.userName),p(V=>{const le=new Map(V);return le.set(R.userId,{imageData:R.imageData,width:R.width,height:R.height,userName:R.userName,userId:R.userId,timestamp:R.timestamp}),console.log("[StagePage] Canvas collection updated, total canvases:",le.size),le});break;case"hostDrawStart":s||(console.log("[StagePage] Viewer: Received host draw start at",R.point),x(R));break;case"hostDrawMove":s||(console.log("[StagePage] Viewer: Received host draw move to",R.point),j(R));break;case"hostDrawEnd":s||(console.log("[StagePage] Viewer: Received host draw end"),Y(R));break;case"hostClearCanvas":s||(console.log("[StagePage] Viewer: Received host clear canvas command"),ye(R));break;case"hostZoomPan":s||(console.log("[StagePage] Viewer: Received host zoom/pan command"),re(R));break;case"send-content-to-all":if(console.log("[StagePage] Handling send-content-to-all event"),s){console.log("[StagePage] Host detected - exporting stage canvas content to share with all");const V=JN();V&&n&&(n.send({type:"host-canvas-content",...V,isFromHost:!0,source:"stage"}),console.log("[StagePage] Host stage canvas content broadcasted to all clients"))}else console.log("[StagePage] Non-host user - will wait for host canvas content to apply");break;case"host-canvas-content":console.log("[StagePage] Received host canvas content"),!s&&R.isFromHost&&R.source==="stage"?(console.log("[StagePage] Applying host stage canvas content to overwrite current stage canvas"),QN(R)):console.log("[StagePage] Ignoring host canvas content - either this is the host or content not from stage");break;default:console.log("[StagePage] Unhandled Live Share event type:",R.type)}};return n.on("received",O),()=>{console.log("[StagePage] Cleaning up Live Share event listener"),n.off("received",O)}},[n,r,s]),U.useEffect(()=>{d&&f.size>0&&(console.log("[StagePage] Redrawing canvas grid with",f.size,"canvases, grid cols:",L),ae())},[f,d,L]);const ae=()=>{const O=g.current,R=S.current;if(!O||!R||f.size===0)return;R.save(),R.setTransform(1,0,0,1,0,0);const V=Array.from(f.values()),le=V.length;let me,ze;L===0?(me=Math.ceil(Math.sqrt(le)),ze=Math.ceil(le/me)):(me=L,ze=Math.ceil(le/me));const Ie=480/640,Ht=20,vs=30,_o=O.width-(me+1)*Ht,el=O.height-(ze+1)*Ht-vs*ze,Uf=_o/me,Hf=el/ze;let hr,bi;Uf/Hf>Ie?(bi=Hf*W,hr=bi*Ie):(hr=Uf*W,bi=hr/Ie),console.log("[StagePage] Drawing grid:",{cols:me,rows:ze,cellWidth:hr,cellHeight:bi,numCanvases:le,aspectRatio:Ie,maxCellWidth:Uf,maxCellHeight:Hf,resizeRatio:W}),V.forEach((rb,ib)=>{const YN=Math.floor(ib/me),ZN=ib%me,eL=hr+Ht,tL=bi+Ht+vs,nL=me*hr+(me-1)*Ht,Vf=(O.width-nL)/2+ZN*eL,Wf=Ht+vs+YN*tL;R.fillStyle="#333",R.font="16px sans-serif",R.textAlign="center",R.fillText(rb.userName,Vf+hr/2,Wf-10);const ys=new Image;ys.onload=()=>{R.save(),R.setTransform(1,0,0,1,0,0);const sb=Math.min(hr/ys.width,bi/ys.height),ob=ys.width*sb,ab=ys.height*sb,rL=Vf+(hr-ob)/2,iL=Wf+(bi-ab)/2;R.strokeStyle="#ddd",R.lineWidth=2,R.strokeRect(Vf,Wf,hr,bi),R.drawImage(ys,rL,iL,ob,ab),R.restore()},ys.src=rb.imageData}),R.restore()},_e=O=>{const R=g.current;if(!R)return{x:0,y:0};const V=R.getBoundingClientRect(),le=R.width/V.width,me=R.height/V.height;let ze,Ie;if("touches"in O&&O.touches.length>0)ze=O.touches[0].clientX,Ie=O.touches[0].clientY;else{const _o=O;ze=_o.clientX,Ie=_o.clientY}const Ht=((ze-V.left)*le-P.x)/_,vs=((Ie-V.top)*me-P.y)/_;return{x:Ht,y:vs}},lt=O=>({x:O.clientX,y:O.clientY}),Et=O=>{O.preventDefault();const R=S.current;if(!R)return;if(!s){console.log("[StagePage] Viewer: Drawing interaction blocked - user is not host");return}if("button"in O&&O.button===1){X(!0);const Ie=lt(O);ee(Ie),console.log("[StagePage] Host: Started panning at",Ie);return}const V=_e(O);if("button"in O&&O.button===2){w.current=!0,v(!0),b(V),B();const Ie=20;R.globalCompositeOperation="destination-out",R.lineWidth=Ie,R.beginPath(),R.moveTo(V.x,V.y),T(V,!0,void 0,Ie),console.log("[StagePage] Host: Started right-click erase at",V);return}v(!0),b(V),B();const le="#ff0000",me=3,ze=.8;R.globalCompositeOperation="source-over",R.strokeStyle=le,R.lineWidth=me,R.globalAlpha=ze,R.beginPath(),R.moveTo(V.x,V.y),T(V,!1,le,me,ze),console.log("[StagePage] Host: Started drawing at",V)},sn=O=>{if(O.preventDefault(),!s)return;if(F&&z&&"button"in O){const le=lt(O),me=le.x-z.x,ze=le.y-z.y,Ie={x:P.x+me,y:P.y+ze};A(Ie),ee(le),se(_,Ie),console.log("[StagePage] Host: Panning by",{deltaX:me,deltaY:ze});return}if(!m&&!w.current)return;const R=_e(O),V=S.current;V&&(V.lineTo(R.x,R.y),V.stroke(),b(R),N(R),w.current&&console.log("[StagePage] Host: Erasing at",R))},gn=()=>{if(!s)return;const O=m,R=w.current;v(!1),X(!1),b(null),ee(null);const V=S.current;V&&(V.beginPath(),w.current&&(V.globalCompositeOperation="source-over",w.current=!1,console.log("[StagePage] Host: Stopped erasing, reset composite mode"))),O&&(D(R),console.log("[StagePage] Host: Stopped drawing/erasing"))},Za=O=>{if(O.preventDefault(),!s)return;const R=g.current;if(!R)return;const V=R.getBoundingClientRect(),le=O.clientX-V.left,me=O.clientY-V.top,ze=O.deltaY>0?.9:1.1,Ie=Math.max(.1,Math.min(5,_*ze)),Ht=Ie/_,vs=le-(le-P.x)*Ht,_o=me-(me-P.y)*Ht,el={x:vs,y:_o};E(Ie),A(el),se(Ie,el),console.log("[StagePage] Host: Zoom changed to",Ie,"pan offset",el)},nb=()=>{if(!s){console.log("[StagePage] Viewer: Clear operation blocked - user is not host");return}const O=g.current,R=S.current;if(!O||!R){console.error("[StagePage] Canvas or context not available for clearing");return}try{console.log("[StagePage] Host: Clearing stage canvas completely..."),R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,O.width,O.height),R.fillStyle="#ffffff",R.fillRect(0,0,O.width,O.height),B(),G("all"),console.log("[StagePage] ✅ Host: Stage canvas cleared completely (including shared canvases)")}catch(V){console.error("[StagePage] ❌ Failed to clear stage canvas:",V)}},WN=()=>{if(!s){console.log("[StagePage] Viewer: Clear annotations blocked - user is not host");return}const O=g.current,R=S.current;if(!O||!R){console.error("[StagePage] Canvas or context not available for clearing annotations");return}try{console.log("[StagePage] Host: Clearing annotations only, preserving shared canvases..."),R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,O.width,O.height),R.fillStyle="#ffffff",R.fillRect(0,0,O.width,O.height),d&&f.size>0&&ae(),B(),G("annotations"),console.log("[StagePage] ✅ Host: Annotations cleared, shared canvases preserved")}catch(V){console.error("[StagePage] ❌ Failed to clear annotations:",V)}},GN=async()=>{if(!n||!e||!t){console.error("[StagePage] Live Share objects not available for toggle editing");return}try{const O=!c;console.log(`[StagePage] Broadcasting ${O?"enableCanvas":"disableCanvas"} event...`);const R={type:O?"enableCanvas":"disableCanvas",enabled:O,ts:Date.now()};await n.send(R),e.set("editingEnabled",O),e.set("lastAction",O?"enableCanvas":"disableCanvas"),e.set("lastActionAt",Date.now()),u(O),console.log(`[StagePage] ✅ ${O?"EnableCanvas":"DisableCanvas"} event broadcasted successfully`)}catch(O){console.error("[StagePage] ❌ Failed to broadcast toggle editing:",O)}},KN=async()=>{if(!n||!e||!t){console.error("[StagePage] Live Share objects not available for share canvases");return}try{console.log("[StagePage] Broadcasting shareCanvas event..."),p(new Map);const O={type:"shareCanvas",requestId:Date.now().toString(),ts:Date.now()};await n.send(O),e.set("canvasesVisible",!0),e.set("lastAction","shareCanvas"),e.set("lastActionAt",Date.now()),h(!0),console.log("[StagePage] ✅ ShareCanvas event broadcasted successfully")}catch(O){console.error("[StagePage] ❌ Failed to broadcast share canvases:",O)}},JN=()=>{const O=g.current;if(!O)return console.log("[StagePage] Cannot export stage canvas data - no canvas ref"),null;try{const V={imageData:O.toDataURL("image/png"),width:O.width,height:O.height,userName:"Host (Stage)",userId:"host-stage",timestamp:Date.now()};return console.log("[StagePage] Exported stage canvas data"),V}catch(R){return console.error("[StagePage] Error exporting stage canvas data:",R),null}},QN=O=>{const R=g.current,V=S.current;if(!R||!V||!(O!=null&&O.imageData)){console.log("[StagePage] Cannot import stage canvas data - missing canvas, context, or image data");return}console.log("[StagePage] Importing stage canvas data from:",O.userName||"Unknown User");try{const le=new window.Image;le.onload=()=>{V.setTransform(1,0,0,1,0,0),V.clearRect(0,0,R.width,R.height),V.fillStyle="#ffffff",V.fillRect(0,0,R.width,R.height),V.drawImage(le,0,0,R.width,R.height),B(),console.log("[StagePage] ✅ Stage canvas content successfully imported and applied")},le.onerror=me=>{console.error("[StagePage] ❌ Failed to load imported stage image:",me)},le.src=O.imageData}catch(le){console.error("[StagePage] ❌ Error importing stage canvas data:",le)}};if(r||a)return M.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:M.jsxs("div",{className:"text-center",children:[M.jsx("div",{className:"text-2xl text-indigo-600 mb-4",children:a?"Detecting host permissions...":"Loading Live Share..."}),M.jsx("div",{className:"text-indigo-500",children:a?"Checking your role in this meeting":"Setting up real-time collaboration"})]})});if(i)return M.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center",children:M.jsxs("div",{className:"text-center",children:[M.jsx("div",{className:"text-2xl text-red-600 mb-4",children:"Live Share Error"}),M.jsx("div",{className:"text-red-500",children:i})]})});if(!s)return M.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:M.jsxs("div",{className:"text-center max-w-md mx-auto p-8",children:[M.jsx("div",{className:"text-6xl mb-6",children:"🚫"}),M.jsx("div",{className:"text-3xl text-orange-700 font-bold mb-4",children:"Host Access Required"}),M.jsx("div",{className:"text-lg text-orange-600 mb-6",children:"This stage page is only available to meeting hosts, organizers, and presenters."}),M.jsxs("div",{className:"text-sm text-orange-500 bg-orange-50 px-4 py-3 rounded-lg border border-orange-200",children:[M.jsx("strong",{children:"Note:"})," Only users with host permissions can control the shared stage and manage canvas interactions."]})]})});const XN=async()=>{try{console.log("[StagePage] Starting meeting stage...");const O="http://localhost:3000",R="https://vineeththomasalex.github.io/personal-whiteboard-app",V=!0,me=`${V?R:O}/?page=stage`;console.log("[StagePage] Environment:",V?"PRODUCTION":"DEVELOPMENT"),console.log("[StagePage] Sharing stage URL:",me),await NO((ze,Ie)=>{if(ze){console.error("[StagePage] Failed to share app content to stage:",ze);return}console.log("[StagePage] ✅ Successfully shared app content to stage:",Ie)},me)}catch(O){console.error("[StagePage] ❌ Error starting meeting stage:",O)}};return M.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:[M.jsx("div",{className:"flex justify-center mb-6",children:M.jsx("button",{onClick:XN,className:"px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105",children:"Start Stage"})}),M.jsxs("div",{className:"flex gap-4 mb-8",children:[s?M.jsxs(M.Fragment,{children:[d?M.jsxs(M.Fragment,{children:[M.jsx("button",{onClick:WN,className:"px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors text-sm",title:"Clear only host annotations, keep shared canvases",children:"Clear Annotations"}),M.jsx("button",{onClick:nb,className:"px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors text-sm",title:"Clear everything including shared canvases",children:"Clear Everything"})]}):M.jsx("button",{onClick:nb,className:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",children:"Clear Canvas"}),M.jsx("button",{onClick:GN,className:`px-6 py-3 font-medium rounded-lg transition-colors ${c?"bg-orange-600 hover:bg-orange-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:c?"Disable Editing":"Enable Editing"}),M.jsx("button",{onClick:KN,className:`px-6 py-3 font-medium rounded-lg transition-colors ${d?"bg-purple-600 hover:bg-purple-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:d?"Refresh Canvases":"Share all canvases"})]}):M.jsxs("div",{className:"flex flex-col gap-2",children:[M.jsxs("div",{className:"flex gap-4",children:[M.jsx("button",{className:"px-6 py-3 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed",disabled:!0,title:"Only the host can use this control",children:"Clear Canvas"}),M.jsx("button",{className:"px-6 py-3 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed",disabled:!0,title:"Only the host can use this control",children:"Toggle Editing"}),M.jsx("button",{className:"px-6 py-3 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed",disabled:!0,title:"Only the host can use this control",children:"Share Canvases"})]}),M.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200",children:["👀 ",M.jsx("strong",{children:"Viewer Mode:"})," You can watch the host's actions in real-time, but only the host can control the stage."]})]}),d&&M.jsxs("div",{className:"flex items-center gap-2 ml-4 border-l border-gray-300 pl-4",children:[M.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Grid Layout:"}),M.jsx("select",{value:L,onChange:O=>{if(!s)return;const R=parseInt(O.target.value);H(R),d&&f.size>0&&setTimeout(()=>ae(),50)},className:`px-3 py-2 rounded-lg text-sm border ${s?"bg-white border-gray-300 text-gray-700 hover:border-gray-400":"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed"}`,disabled:!s,title:s?"Select grid layout":"Host-only control",children:I.map(O=>M.jsx("option",{value:O.value,children:O.label},O.value))})]}),d&&M.jsxs("div",{className:"flex items-center gap-2 ml-4 border-l border-gray-300 pl-4",children:[M.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Canvas Size:"}),M.jsx("button",{onClick:()=>{if(!s)return;const O=Math.max(.2,W-.1);C(O),d&&f.size>0&&setTimeout(()=>ae(),50)},className:`px-3 py-2 rounded-lg transition-colors text-sm ${s?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:s?"Make Canvases Smaller":"Host-only control",disabled:!s,children:"−"}),M.jsxs("span",{className:"text-sm font-medium text-gray-700 min-w-[50px] text-center",children:[Math.round(W*100),"%"]}),M.jsx("button",{onClick:()=>{if(!s)return;const O=Math.min(1,W+.1);C(O),d&&f.size>0&&setTimeout(()=>ae(),50)},className:`px-3 py-2 rounded-lg transition-colors text-sm ${s?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:s?"Make Canvases Larger":"Host-only control",disabled:!s,children:"+"}),M.jsx("button",{onClick:()=>{s&&(C(.6),d&&f.size>0&&setTimeout(()=>ae(),50))},className:`px-3 py-2 rounded-lg transition-colors text-sm ${s?"bg-orange-500 hover:bg-orange-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:s?"Reset Canvas Size":"Host-only control",disabled:!s,children:"Reset"})]})]}),M.jsx("div",{className:"border border-gray-300 rounded-lg mx-auto overflow-auto bg-white",style:{maxWidth:"100%",maxHeight:"60vh",backgroundColor:"#ffffff"},children:M.jsx("canvas",{ref:g,width:1200,height:800,className:`block ${s?"cursor-crosshair":"cursor-default"}`,onContextMenu:O=>{s&&O.preventDefault()},onWheel:s?Za:void 0,onMouseDown:s?Et:void 0,onMouseMove:s?sn:void 0,onMouseUp:s?gn:void 0,onMouseLeave:s?gn:void 0,onTouchStart:s?Et:void 0,onTouchMove:s?sn:void 0,onTouchEnd:s?gn:void 0,style:{touchAction:s?"none":"auto",backgroundColor:"#ffffff",filter:"none",colorScheme:"light",minWidth:"800px",minHeight:"600px",cursor:s?F?"grabbing":"crosshair":"default",opacity:s?1:.95,border:s?"1px solid #ddd":"2px solid #3b82f6"}})})]})},Q1=xD();function XY(){const n=U.useRef(!1),[e,t]=U.useState(!1),[r,i]=U.useState(Q1),[s,o]=U.useState(null),[a,l]=U.useState(null),[c,u]=U.useState(null),[d,h]=U.useState(!1),f=()=>new URLSearchParams(window.location.search).get("page")||"main",[p,g]=U.useState(f());if(U.useEffect(()=>{const m=()=>{g(f())};return window.addEventListener("popstate",m),()=>window.removeEventListener("popstate",m)},[]),U.useEffect(()=>{n.current||(n.current=!0,(async()=>{var m,v;try{console.log("App: Attempting Teams SDK initialize"),await Ah(),i(!0);const y=await a0(),b=(y==null?void 0:y.user)||{},w=(y==null?void 0:y.meeting)||{},_=(m=y==null?void 0:y.page)==null?void 0:m.frameContext,E=new Set(["meetingStage","meetingSidePanel","meetingChatTab","meetingDetailsTab"]),P=_&&E.has(_)||Array.isArray((v=y==null?void 0:y.page)==null?void 0:v.contexts)&&y.page.contexts.some(z=>E.has(z));h(!!P);const A={displayName:b.displayName,userPrincipalName:b.userPrincipalName||b.loginHint,loginHint:b.loginHint,id:b.id,userObjectId:b.id||b.userObjectId||b.aadObjectId,aadObjectId:b.aadObjectId||b.id};if(!A.displayName&&A.userPrincipalName){const z=A.userPrincipalName.split("@")[0];A.displayName=z.replace(/\./g," ")}const F=new URLSearchParams(window.location.search);!A.displayName&&F.get("user")&&(A.displayName=F.get("user")||void 0),!A.userPrincipalName&&F.get("upn")&&(A.userPrincipalName=F.get("upn")||void 0),l(A);let X=!1;P&&rC&&await new Promise(z=>{rC((ee,W)=>{if(ee)return console.info("App: meeting.getMeetingDetails not available here:",ee),z();const C=(W==null?void 0:W.organizer)||{},L=(W==null?void 0:W.title)||(w==null?void 0:w.meetingTitle),H=!!(A.userPrincipalName&&(C!=null&&C.userPrincipalName)&&A.userPrincipalName.toLowerCase()===C.userPrincipalName.toLowerCase());u({title:L,organizer:{displayName:C==null?void 0:C.displayName,userPrincipalName:C==null?void 0:C.userPrincipalName,id:C==null?void 0:C.id},host:{displayName:C==null?void 0:C.displayName,userPrincipalName:C==null?void 0:C.userPrincipalName,id:C==null?void 0:C.id},isOrganizer:H}),X=!0,z()})}),!X&&(w!=null&&w.meetingTitle)&&u(z=>z||{title:w.meetingTitle}),VM(),WM(),t(!0),console.log("App: Teams client SDK initialized successfully")}catch(y){console.warn("App: Teams initialize failed; assuming non-Teams host.",y),i(!1),Q1&&o(y)}})())},[]),r&&!e&&!s)return M.jsx(J1,{message:"Initializing Teams app..."});if(s)return M.jsx(JY,{error:s});const S=r&&e||!r;return p==="stage"?M.jsx("div",{className:"app-container",children:S?M.jsx(KY,{userInfo:a||(r?{displayName:"Unknown User"}:{displayName:"Local Browser"}),meetingInfo:c}):M.jsx(J1,{message:"Loading..."})}):M.jsx(VN,{children:M.jsx(QY,{})})}Xm.createRoot(document.getElementById("root")).render(M.jsx(bL.StrictMode,{children:M.jsx(XY,{})}));export{$0 as a,S0 as b,JP as c,W6 as d,F6 as e,QP as f,WP as g,z6 as h,Y6 as i,tR as j,pi as k,Kh as r,T6 as s,Ba as t};
