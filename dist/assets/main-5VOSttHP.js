const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hashFileNode-DhY5-l_s.js","assets/sha256-D57OEOvS.js","assets/hashFileNode-BxIUnjPt.js"])))=>i.map(i=>d[i]);
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function a(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(i){if(i.ep)return;i.ep=!0;const r=a(i);fetch(i.href,r)}})();var ud=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function iE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function sE(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var n=e.default;if(typeof n=="function"){var a=function t(){var i=!1;try{i=this instanceof t}catch{}return i?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};a.prototype=n.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(a,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}),a}var sF={exports:{}},fv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d3;function ile(){if(d3)return fv;d3=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(t,i,r){var s=null;if(r!==void 0&&(s=""+r),i.key!==void 0&&(s=""+i.key),"key"in i){r={};for(var o in i)o!=="key"&&(r[o]=i[o])}else r=i;return i=r.ref,{$$typeof:e,type:t,key:s,ref:i!==void 0?i:null,props:r}}return fv.Fragment=n,fv.jsx=a,fv.jsxs=a,fv}var l3;function sle(){return l3||(l3=1,sF.exports=ile()),sF.exports}var Dt=sle(),aF={exports:{}},vn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f3;function ale(){if(f3)return vn;f3=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),t=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),l=Symbol.iterator;function f(re){return re===null||typeof re!="object"?null:(re=l&&re[l]||re["@@iterator"],typeof re=="function"?re:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,v={};function m(re,fe,oe){this.props=re,this.context=fe,this.refs=v,this.updater=oe||b}m.prototype.isReactComponent={},m.prototype.setState=function(re,fe){if(typeof re!="object"&&typeof re!="function"&&re!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,re,fe,"setState")},m.prototype.forceUpdate=function(re){this.updater.enqueueForceUpdate(this,re,"forceUpdate")};function h(){}h.prototype=m.prototype;function g(re,fe,oe){this.props=re,this.context=fe,this.refs=v,this.updater=oe||b}var _=g.prototype=new h;_.constructor=g,C(_,m.prototype),_.isPureReactComponent=!0;var S=Array.isArray,p={H:null,A:null,T:null,S:null,V:null},w=Object.prototype.hasOwnProperty;function O(re,fe,oe,pe,de,ge){return oe=ge.ref,{$$typeof:e,type:re,key:fe,ref:oe!==void 0?oe:null,props:ge}}function E(re,fe){return O(re.type,fe,void 0,void 0,void 0,re.props)}function F(re){return typeof re=="object"&&re!==null&&re.$$typeof===e}function R(re){var fe={"=":"=0",":":"=2"};return"$"+re.replace(/[=:]/g,function(oe){return fe[oe]})}var M=/\/+/g;function j(re,fe){return typeof re=="object"&&re!==null&&re.key!=null?R(""+re.key):fe.toString(36)}function k(){}function x(re){switch(re.status){case"fulfilled":return re.value;case"rejected":throw re.reason;default:switch(typeof re.status=="string"?re.then(k,k):(re.status="pending",re.then(function(fe){re.status==="pending"&&(re.status="fulfilled",re.value=fe)},function(fe){re.status==="pending"&&(re.status="rejected",re.reason=fe)})),re.status){case"fulfilled":return re.value;case"rejected":throw re.reason}}throw re}function L(re,fe,oe,pe,de){var ge=typeof re;(ge==="undefined"||ge==="boolean")&&(re=null);var Ce=!1;if(re===null)Ce=!0;else switch(ge){case"bigint":case"string":case"number":Ce=!0;break;case"object":switch(re.$$typeof){case e:case n:Ce=!0;break;case d:return Ce=re._init,L(Ce(re._payload),fe,oe,pe,de)}}if(Ce)return de=de(re),Ce=pe===""?"."+j(re,0):pe,S(de)?(oe="",Ce!=null&&(oe=Ce.replace(M,"$&/")+"/"),L(de,fe,oe,"",function(Ze){return Ze})):de!=null&&(F(de)&&(de=E(de,oe+(de.key==null||re&&re.key===de.key?"":(""+de.key).replace(M,"$&/")+"/")+Ce)),fe.push(de)),1;Ce=0;var Fe=pe===""?".":pe+":";if(S(re))for(var We=0;We<re.length;We++)pe=re[We],ge=Fe+j(pe,We),Ce+=L(pe,fe,oe,ge,de);else if(We=f(re),typeof We=="function")for(re=We.call(re),We=0;!(pe=re.next()).done;)pe=pe.value,ge=Fe+j(pe,We++),Ce+=L(pe,fe,oe,ge,de);else if(ge==="object"){if(typeof re.then=="function")return L(x(re),fe,oe,pe,de);throw fe=String(re),Error("Objects are not valid as a React child (found: "+(fe==="[object Object]"?"object with keys {"+Object.keys(re).join(", ")+"}":fe)+"). If you meant to render a collection of children, use an array instead.")}return Ce}function V(re,fe,oe){if(re==null)return re;var pe=[],de=0;return L(re,pe,"","",function(ge){return fe.call(oe,ge,de++)}),pe}function G(re){if(re._status===-1){var fe=re._result;fe=fe(),fe.then(function(oe){(re._status===0||re._status===-1)&&(re._status=1,re._result=oe)},function(oe){(re._status===0||re._status===-1)&&(re._status=2,re._result=oe)}),re._status===-1&&(re._status=0,re._result=fe)}if(re._status===1)return re._result.default;throw re._result}var ee=typeof reportError=="function"?reportError:function(re){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var fe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof re=="object"&&re!==null&&typeof re.message=="string"?String(re.message):String(re),error:re});if(!window.dispatchEvent(fe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",re);return}console.error(re)};function se(){}return vn.Children={map:V,forEach:function(re,fe,oe){V(re,function(){fe.apply(this,arguments)},oe)},count:function(re){var fe=0;return V(re,function(){fe++}),fe},toArray:function(re){return V(re,function(fe){return fe})||[]},only:function(re){if(!F(re))throw Error("React.Children.only expected to receive a single React element child.");return re}},vn.Component=m,vn.Fragment=a,vn.Profiler=i,vn.PureComponent=g,vn.StrictMode=t,vn.Suspense=u,vn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=p,vn.__COMPILER_RUNTIME={__proto__:null,c:function(re){return p.H.useMemoCache(re)}},vn.cache=function(re){return function(){return re.apply(null,arguments)}},vn.cloneElement=function(re,fe,oe){if(re==null)throw Error("The argument must be a React element, but you passed "+re+".");var pe=C({},re.props),de=re.key,ge=void 0;if(fe!=null)for(Ce in fe.ref!==void 0&&(ge=void 0),fe.key!==void 0&&(de=""+fe.key),fe)!w.call(fe,Ce)||Ce==="key"||Ce==="__self"||Ce==="__source"||Ce==="ref"&&fe.ref===void 0||(pe[Ce]=fe[Ce]);var Ce=arguments.length-2;if(Ce===1)pe.children=oe;else if(1<Ce){for(var Fe=Array(Ce),We=0;We<Ce;We++)Fe[We]=arguments[We+2];pe.children=Fe}return O(re.type,de,void 0,void 0,ge,pe)},vn.createContext=function(re){return re={$$typeof:s,_currentValue:re,_currentValue2:re,_threadCount:0,Provider:null,Consumer:null},re.Provider=re,re.Consumer={$$typeof:r,_context:re},re},vn.createElement=function(re,fe,oe){var pe,de={},ge=null;if(fe!=null)for(pe in fe.key!==void 0&&(ge=""+fe.key),fe)w.call(fe,pe)&&pe!=="key"&&pe!=="__self"&&pe!=="__source"&&(de[pe]=fe[pe]);var Ce=arguments.length-2;if(Ce===1)de.children=oe;else if(1<Ce){for(var Fe=Array(Ce),We=0;We<Ce;We++)Fe[We]=arguments[We+2];de.children=Fe}if(re&&re.defaultProps)for(pe in Ce=re.defaultProps,Ce)de[pe]===void 0&&(de[pe]=Ce[pe]);return O(re,ge,void 0,void 0,null,de)},vn.createRef=function(){return{current:null}},vn.forwardRef=function(re){return{$$typeof:o,render:re}},vn.isValidElement=F,vn.lazy=function(re){return{$$typeof:d,_payload:{_status:-1,_result:re},_init:G}},vn.memo=function(re,fe){return{$$typeof:c,type:re,compare:fe===void 0?null:fe}},vn.startTransition=function(re){var fe=p.T,oe={};p.T=oe;try{var pe=re(),de=p.S;de!==null&&de(oe,pe),typeof pe=="object"&&pe!==null&&typeof pe.then=="function"&&pe.then(se,ee)}catch(ge){ee(ge)}finally{p.T=fe}},vn.unstable_useCacheRefresh=function(){return p.H.useCacheRefresh()},vn.use=function(re){return p.H.use(re)},vn.useActionState=function(re,fe,oe){return p.H.useActionState(re,fe,oe)},vn.useCallback=function(re,fe){return p.H.useCallback(re,fe)},vn.useContext=function(re){return p.H.useContext(re)},vn.useDebugValue=function(){},vn.useDeferredValue=function(re,fe){return p.H.useDeferredValue(re,fe)},vn.useEffect=function(re,fe,oe){var pe=p.H;if(typeof oe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return pe.useEffect(re,fe)},vn.useId=function(){return p.H.useId()},vn.useImperativeHandle=function(re,fe,oe){return p.H.useImperativeHandle(re,fe,oe)},vn.useInsertionEffect=function(re,fe){return p.H.useInsertionEffect(re,fe)},vn.useLayoutEffect=function(re,fe){return p.H.useLayoutEffect(re,fe)},vn.useMemo=function(re,fe){return p.H.useMemo(re,fe)},vn.useOptimistic=function(re,fe){return p.H.useOptimistic(re,fe)},vn.useReducer=function(re,fe,oe){return p.H.useReducer(re,fe,oe)},vn.useRef=function(re){return p.H.useRef(re)},vn.useState=function(re){return p.H.useState(re)},vn.useSyncExternalStore=function(re,fe,oe){return p.H.useSyncExternalStore(re,fe,oe)},vn.useTransition=function(){return p.H.useTransition()},vn.version="19.1.1",vn}var h3;function $k(){return h3||(h3=1,aF.exports=ale()),aF.exports}var Et=$k();const hs=iE(Et);var oF={exports:{}},hv={},cF={exports:{}},uF={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m3;function ole(){return m3||(m3=1,(function(e){function n(V,G){var ee=V.length;V.push(G);e:for(;0<ee;){var se=ee-1>>>1,re=V[se];if(0<i(re,G))V[se]=G,V[ee]=re,ee=se;else break e}}function a(V){return V.length===0?null:V[0]}function t(V){if(V.length===0)return null;var G=V[0],ee=V.pop();if(ee!==G){V[0]=ee;e:for(var se=0,re=V.length,fe=re>>>1;se<fe;){var oe=2*(se+1)-1,pe=V[oe],de=oe+1,ge=V[de];if(0>i(pe,ee))de<re&&0>i(ge,pe)?(V[se]=ge,V[de]=ee,se=de):(V[se]=pe,V[oe]=ee,se=oe);else if(de<re&&0>i(ge,ee))V[se]=ge,V[de]=ee,se=de;else break e}}return G}function i(V,G){var ee=V.sortIndex-G.sortIndex;return ee!==0?ee:V.id-G.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;e.unstable_now=function(){return r.now()}}else{var s=Date,o=s.now();e.unstable_now=function(){return s.now()-o}}var u=[],c=[],d=1,l=null,f=3,b=!1,C=!1,v=!1,m=!1,h=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function S(V){for(var G=a(c);G!==null;){if(G.callback===null)t(c);else if(G.startTime<=V)t(c),G.sortIndex=G.expirationTime,n(u,G);else break;G=a(c)}}function p(V){if(v=!1,S(V),!C)if(a(u)!==null)C=!0,w||(w=!0,j());else{var G=a(c);G!==null&&L(p,G.startTime-V)}}var w=!1,O=-1,E=5,F=-1;function R(){return m?!0:!(e.unstable_now()-F<E)}function M(){if(m=!1,w){var V=e.unstable_now();F=V;var G=!0;try{e:{C=!1,v&&(v=!1,g(O),O=-1),b=!0;var ee=f;try{t:{for(S(V),l=a(u);l!==null&&!(l.expirationTime>V&&R());){var se=l.callback;if(typeof se=="function"){l.callback=null,f=l.priorityLevel;var re=se(l.expirationTime<=V);if(V=e.unstable_now(),typeof re=="function"){l.callback=re,S(V),G=!0;break t}l===a(u)&&t(u),S(V)}else t(u);l=a(u)}if(l!==null)G=!0;else{var fe=a(c);fe!==null&&L(p,fe.startTime-V),G=!1}}break e}finally{l=null,f=ee,b=!1}G=void 0}}finally{G?j():w=!1}}}var j;if(typeof _=="function")j=function(){_(M)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,x=k.port2;k.port1.onmessage=M,j=function(){x.postMessage(null)}}else j=function(){h(M,0)};function L(V,G){O=h(function(){V(e.unstable_now())},G)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(V){V.callback=null},e.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<V?Math.floor(1e3/V):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_next=function(V){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var ee=f;f=G;try{return V()}finally{f=ee}},e.unstable_requestPaint=function(){m=!0},e.unstable_runWithPriority=function(V,G){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var ee=f;f=V;try{return G()}finally{f=ee}},e.unstable_scheduleCallback=function(V,G,ee){var se=e.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?se+ee:se):ee=se,V){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=ee+re,V={id:d++,callback:G,priorityLevel:V,startTime:ee,expirationTime:re,sortIndex:-1},ee>se?(V.sortIndex=ee,n(c,V),a(u)===null&&V===a(c)&&(v?(g(O),O=-1):v=!0,L(p,ee-se))):(V.sortIndex=re,n(u,V),C||b||(C=!0,w||(w=!0,j()))),V},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(V){var G=f;return function(){var ee=f;f=G;try{return V.apply(this,arguments)}finally{f=ee}}}})(uF)),uF}var p3;function cle(){return p3||(p3=1,cF.exports=ole()),cF.exports}var dF={exports:{}},fs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g3;function ule(){if(g3)return fs;g3=1;var e=$k();function n(u){var c="https://react.dev/errors/"+u;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+u+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var t={d:{f:a,r:function(){throw Error(n(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},i=Symbol.for("react.portal");function r(u,c,d){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:l==null?null:""+l,children:u,containerInfo:c,implementation:d}}var s=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(u,c){if(u==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return fs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=t,fs.createPortal=function(u,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(n(299));return r(u,c,null,d)},fs.flushSync=function(u){var c=s.T,d=t.p;try{if(s.T=null,t.p=2,u)return u()}finally{s.T=c,t.p=d,t.d.f()}},fs.preconnect=function(u,c){typeof u=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,t.d.C(u,c))},fs.prefetchDNS=function(u){typeof u=="string"&&t.d.D(u)},fs.preinit=function(u,c){if(typeof u=="string"&&c&&typeof c.as=="string"){var d=c.as,l=o(d,c.crossOrigin),f=typeof c.integrity=="string"?c.integrity:void 0,b=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;d==="style"?t.d.S(u,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:l,integrity:f,fetchPriority:b}):d==="script"&&t.d.X(u,{crossOrigin:l,integrity:f,fetchPriority:b,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},fs.preinitModule=function(u,c){if(typeof u=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var d=o(c.as,c.crossOrigin);t.d.M(u,{crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&t.d.M(u)},fs.preload=function(u,c){if(typeof u=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var d=c.as,l=o(d,c.crossOrigin);t.d.L(u,d,{crossOrigin:l,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},fs.preloadModule=function(u,c){if(typeof u=="string")if(c){var d=o(c.as,c.crossOrigin);t.d.m(u,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else t.d.m(u)},fs.requestFormReset=function(u){t.d.r(u)},fs.unstable_batchedUpdates=function(u,c){return u(c)},fs.useFormState=function(u,c,d){return s.H.useFormState(u,c,d)},fs.useFormStatus=function(){return s.H.useHostTransitionStatus()},fs.version="19.1.1",fs}var y3;function dle(){if(y3)return dF.exports;y3=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),dF.exports=ule(),dF.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b3;function lle(){if(b3)return hv;b3=1;var e=cle(),n=$k(),a=dle();function t(y){var T="https://react.dev/errors/"+y;if(1<arguments.length){T+="?args[]="+encodeURIComponent(arguments[1]);for(var I=2;I<arguments.length;I++)T+="&args[]="+encodeURIComponent(arguments[I])}return"Minified React error #"+y+"; visit "+T+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(y){return!(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)}function r(y){var T=y,I=y;if(y.alternate)for(;T.return;)T=T.return;else{y=T;do T=y,(T.flags&4098)!==0&&(I=T.return),y=T.return;while(y)}return T.tag===3?I:null}function s(y){if(y.tag===13){var T=y.memoizedState;if(T===null&&(y=y.alternate,y!==null&&(T=y.memoizedState)),T!==null)return T.dehydrated}return null}function o(y){if(r(y)!==y)throw Error(t(188))}function u(y){var T=y.alternate;if(!T){if(T=r(y),T===null)throw Error(t(188));return T!==y?null:y}for(var I=y,D=T;;){var z=I.return;if(z===null)break;var $=z.alternate;if($===null){if(D=z.return,D!==null){I=D;continue}break}if(z.child===$.child){for($=z.child;$;){if($===I)return o(z),y;if($===D)return o(z),T;$=$.sibling}throw Error(t(188))}if(I.return!==D.return)I=z,D=$;else{for(var ye=!1,De=z.child;De;){if(De===I){ye=!0,I=z,D=$;break}if(De===D){ye=!0,D=z,I=$;break}De=De.sibling}if(!ye){for(De=$.child;De;){if(De===I){ye=!0,I=$,D=z;break}if(De===D){ye=!0,D=$,I=z;break}De=De.sibling}if(!ye)throw Error(t(189))}}if(I.alternate!==D)throw Error(t(190))}if(I.tag!==3)throw Error(t(188));return I.stateNode.current===I?y:T}function c(y){var T=y.tag;if(T===5||T===26||T===27||T===6)return y;for(y=y.child;y!==null;){if(T=c(y),T!==null)return T;y=y.sibling}return null}var d=Object.assign,l=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),g=Symbol.for("react.consumer"),_=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),R=Symbol.for("react.memo_cache_sentinel"),M=Symbol.iterator;function j(y){return y===null||typeof y!="object"?null:(y=M&&y[M]||y["@@iterator"],typeof y=="function"?y:null)}var k=Symbol.for("react.client.reference");function x(y){if(y==null)return null;if(typeof y=="function")return y.$$typeof===k?null:y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case C:return"Fragment";case m:return"Profiler";case v:return"StrictMode";case p:return"Suspense";case w:return"SuspenseList";case F:return"Activity"}if(typeof y=="object")switch(y.$$typeof){case b:return"Portal";case _:return(y.displayName||"Context")+".Provider";case g:return(y._context.displayName||"Context")+".Consumer";case S:var T=y.render;return y=y.displayName,y||(y=T.displayName||T.name||"",y=y!==""?"ForwardRef("+y+")":"ForwardRef"),y;case O:return T=y.displayName||null,T!==null?T:x(y.type)||"Memo";case E:T=y._payload,y=y._init;try{return x(y(T))}catch{}}return null}var L=Array.isArray,V=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},se=[],re=-1;function fe(y){return{current:y}}function oe(y){0>re||(y.current=se[re],se[re]=null,re--)}function pe(y,T){re++,se[re]=y.current,y.current=T}var de=fe(null),ge=fe(null),Ce=fe(null),Fe=fe(null);function We(y,T){switch(pe(Ce,T),pe(ge,y),pe(de,null),T.nodeType){case 9:case 11:y=(y=T.documentElement)&&(y=y.namespaceURI)?qB(y):0;break;default:if(y=T.tagName,T=T.namespaceURI)T=qB(T),y=LB(T,y);else switch(y){case"svg":y=1;break;case"math":y=2;break;default:y=0}}oe(de),pe(de,y)}function Ze(){oe(de),oe(ge),oe(Ce)}function lt(y){y.memoizedState!==null&&pe(Fe,y);var T=de.current,I=LB(T,y.type);T!==I&&(pe(ge,y),pe(de,I))}function ut(y){ge.current===y&&(oe(de),oe(ge)),Fe.current===y&&(oe(Fe),ov._currentValue=ee)}var pt=Object.prototype.hasOwnProperty,Nt=e.unstable_scheduleCallback,Ke=e.unstable_cancelCallback,Ge=e.unstable_shouldYield,Re=e.unstable_requestPaint,Qe=e.unstable_now,Y=e.unstable_getCurrentPriorityLevel,Me=e.unstable_ImmediatePriority,K=e.unstable_UserBlockingPriority,Z=e.unstable_NormalPriority,me=e.unstable_LowPriority,we=e.unstable_IdlePriority,qe=e.log,xe=e.unstable_setDisableYieldValue,Oe=null,He=null;function Se(y){if(typeof qe=="function"&&xe(y),He&&typeof He.setStrictMode=="function")try{He.setStrictMode(Oe,y)}catch{}}var Ve=Math.clz32?Math.clz32:he,ot=Math.log,mt=Math.LN2;function he(y){return y>>>=0,y===0?32:31-(ot(y)/mt|0)|0}var Ue=256,Pe=4194304;function Ye(y){var T=y&42;if(T!==0)return T;switch(y&-y){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return y&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return y}}function ke(y,T,I){var D=y.pendingLanes;if(D===0)return 0;var z=0,$=y.suspendedLanes,ye=y.pingedLanes;y=y.warmLanes;var De=D&134217727;return De!==0?(D=De&~$,D!==0?z=Ye(D):(ye&=De,ye!==0?z=Ye(ye):I||(I=De&~y,I!==0&&(z=Ye(I))))):(De=D&~$,De!==0?z=Ye(De):ye!==0?z=Ye(ye):I||(I=D&~y,I!==0&&(z=Ye(I)))),z===0?0:T!==0&&T!==z&&(T&$)===0&&($=z&-z,I=T&-T,$>=I||$===32&&(I&4194048)!==0)?T:z}function Rt(y,T){return(y.pendingLanes&~(y.suspendedLanes&~y.pingedLanes)&T)===0}function Ft(y,T){switch(y){case 1:case 2:case 4:case 8:case 64:return T+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return T+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xt(){var y=Ue;return Ue<<=1,(Ue&4194048)===0&&(Ue=256),y}function zt(){var y=Pe;return Pe<<=1,(Pe&62914560)===0&&(Pe=4194304),y}function fn(y){for(var T=[],I=0;31>I;I++)T.push(y);return T}function je(y,T){y.pendingLanes|=T,T!==268435456&&(y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0)}function Ne(y,T,I,D,z,$){var ye=y.pendingLanes;y.pendingLanes=I,y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0,y.expiredLanes&=I,y.entangledLanes&=I,y.errorRecoveryDisabledLanes&=I,y.shellSuspendCounter=0;var De=y.entanglements,et=y.expirationTimes,vt=y.hiddenUpdates;for(I=ye&~I;0<I;){var It=31-Ve(I),At=1<<It;De[It]=0,et[It]=-1;var St=vt[It];if(St!==null)for(vt[It]=null,It=0;It<St.length;It++){var Ct=St[It];Ct!==null&&(Ct.lane&=-536870913)}I&=~At}D!==0&&Kt(y,D,0),$!==0&&z===0&&y.tag!==0&&(y.suspendedLanes|=$&~(ye&~T))}function Kt(y,T,I){y.pendingLanes|=T,y.suspendedLanes&=~T;var D=31-Ve(T);y.entangledLanes|=T,y.entanglements[D]=y.entanglements[D]|1073741824|I&4194090}function mn(y,T){var I=y.entangledLanes|=T;for(y=y.entanglements;I;){var D=31-Ve(I),z=1<<D;z&T|y[D]&T&&(y[D]|=T),I&=~z}}function er(y){switch(y){case 2:y=1;break;case 8:y=4;break;case 32:y=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:y=128;break;case 268435456:y=134217728;break;default:y=0}return y}function ji(y){return y&=-y,2<y?8<y?(y&134217727)!==0?32:268435456:8:2}function Qs(){var y=G.p;return y!==0?y:(y=window.event,y===void 0?32:i3(y.type))}function Qr(y,T){var I=G.p;try{return G.p=y,T()}finally{G.p=I}}var Br=Math.random().toString(36).slice(2),wr="__reactFiber$"+Br,qn="__reactProps$"+Br,qi="__reactContainer$"+Br,Ys="__reactEvents$"+Br,In="__reactListeners$"+Br,Si="__reactHandles$"+Br,xa="__reactResources$"+Br,os="__reactMarker$"+Br;function bs(y){delete y[wr],delete y[qn],delete y[Ys],delete y[In],delete y[Si]}function Yr(y){var T=y[wr];if(T)return T;for(var I=y.parentNode;I;){if(T=I[qi]||I[wr]){if(I=T.alternate,T.child!==null||I!==null&&I.child!==null)for(y=VB(y);y!==null;){if(I=y[wr])return I;y=VB(y)}return T}y=I,I=y.parentNode}return null}function ni(y){if(y=y[wr]||y[qi]){var T=y.tag;if(T===5||T===6||T===13||T===26||T===27||T===3)return y}return null}function cs(y){var T=y.tag;if(T===5||T===26||T===27||T===6)return y.stateNode;throw Error(t(33))}function Mi(y){var T=y[xa];return T||(T=y[xa]={hoistableStyles:new Map,hoistableScripts:new Map}),T}function $n(y){y[os]=!0}var Xs=new Set,vs={};function Xr(y,T){us(y,T),us(y+"Capture",T)}function us(y,T){for(vs[y]=T,y=0;y<T.length;y++)Xs.add(T[y])}var Ss=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ci={},ds={};function Gt(y){return pt.call(ds,y)?!0:pt.call(Ci,y)?!1:Ss.test(y)?ds[y]=!0:(Ci[y]=!0,!1)}function gn(y,T,I){if(Gt(T))if(I===null)y.removeAttribute(T);else{switch(typeof I){case"undefined":case"function":case"symbol":y.removeAttribute(T);return;case"boolean":var D=T.toLowerCase().slice(0,5);if(D!=="data-"&&D!=="aria-"){y.removeAttribute(T);return}}y.setAttribute(T,""+I)}}function wn(y,T,I){if(I===null)y.removeAttribute(T);else{switch(typeof I){case"undefined":case"function":case"symbol":case"boolean":y.removeAttribute(T);return}y.setAttribute(T,""+I)}}function Or(y,T,I,D){if(D===null)y.removeAttribute(I);else{switch(typeof D){case"undefined":case"function":case"symbol":case"boolean":y.removeAttribute(I);return}y.setAttributeNS(T,I,""+D)}}var Zs,$a;function Ga(y){if(Zs===void 0)try{throw Error()}catch(I){var T=I.stack.trim().match(/\n( *(at )?)/);Zs=T&&T[1]||"",$a=-1<I.stack.indexOf(`
    at`)?" (<anonymous>)":-1<I.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Zs+y+$a}var Tl=!1;function wl(y,T){if(!y||Tl)return"";Tl=!0;var I=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var D={DetermineComponentFrameRoot:function(){try{if(T){var At=function(){throw Error()};if(Object.defineProperty(At.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(At,[])}catch(Ct){var St=Ct}Reflect.construct(y,[],At)}else{try{At.call()}catch(Ct){St=Ct}y.call(At.prototype)}}else{try{throw Error()}catch(Ct){St=Ct}(At=y())&&typeof At.catch=="function"&&At.catch(function(){})}}catch(Ct){if(Ct&&St&&typeof Ct.stack=="string")return[Ct.stack,St.stack]}return[null,null]}};D.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var z=Object.getOwnPropertyDescriptor(D.DetermineComponentFrameRoot,"name");z&&z.configurable&&Object.defineProperty(D.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var $=D.DetermineComponentFrameRoot(),ye=$[0],De=$[1];if(ye&&De){var et=ye.split(`
`),vt=De.split(`
`);for(z=D=0;D<et.length&&!et[D].includes("DetermineComponentFrameRoot");)D++;for(;z<vt.length&&!vt[z].includes("DetermineComponentFrameRoot");)z++;if(D===et.length||z===vt.length)for(D=et.length-1,z=vt.length-1;1<=D&&0<=z&&et[D]!==vt[z];)z--;for(;1<=D&&0<=z;D--,z--)if(et[D]!==vt[z]){if(D!==1||z!==1)do if(D--,z--,0>z||et[D]!==vt[z]){var It=`
`+et[D].replace(" at new "," at ");return y.displayName&&It.includes("<anonymous>")&&(It=It.replace("<anonymous>",y.displayName)),It}while(1<=D&&0<=z);break}}}finally{Tl=!1,Error.prepareStackTrace=I}return(I=y?y.displayName||y.name:"")?Ga(I):""}function _b(y){switch(y.tag){case 26:case 27:case 5:return Ga(y.type);case 16:return Ga("Lazy");case 13:return Ga("Suspense");case 19:return Ga("SuspenseList");case 0:case 15:return wl(y.type,!1);case 11:return wl(y.type.render,!1);case 1:return wl(y.type,!0);case 31:return Ga("Activity");default:return""}}function Mc(y){try{var T="";do T+=_b(y),y=y.return;while(y);return T}catch(I){return`
Error generating stack: `+I.message+`
`+I.stack}}function Li(y){switch(typeof y){case"bigint":case"boolean":case"number":case"string":case"undefined":return y;case"object":return y;default:return""}}function ri(y){var T=y.type;return(y=y.nodeName)&&y.toLowerCase()==="input"&&(T==="checkbox"||T==="radio")}function Tb(y){var T=ri(y)?"checked":"value",I=Object.getOwnPropertyDescriptor(y.constructor.prototype,T),D=""+y[T];if(!y.hasOwnProperty(T)&&typeof I<"u"&&typeof I.get=="function"&&typeof I.set=="function"){var z=I.get,$=I.set;return Object.defineProperty(y,T,{configurable:!0,get:function(){return z.call(this)},set:function(ye){D=""+ye,$.call(this,ye)}}),Object.defineProperty(y,T,{enumerable:I.enumerable}),{getValue:function(){return D},setValue:function(ye){D=""+ye},stopTracking:function(){y._valueTracker=null,delete y[T]}}}}function bd(y){y._valueTracker||(y._valueTracker=Tb(y))}function ay(y){if(!y)return!1;var T=y._valueTracker;if(!T)return!0;var I=T.getValue(),D="";return y&&(D=ri(y)?y.checked?"true":"false":y.value),y=D,y!==I?(T.setValue(y),!0):!1}function Jo(y){if(y=y||(typeof document<"u"?document:void 0),typeof y>"u")return null;try{return y.activeElement||y.body}catch{return y.body}}var oy=/[\n"\\]/g;function Bi(y){return y.replace(oy,function(T){return"\\"+T.charCodeAt(0).toString(16)+" "})}function ea(y,T,I,D,z,$,ye,De){y.name="",ye!=null&&typeof ye!="function"&&typeof ye!="symbol"&&typeof ye!="boolean"?y.type=ye:y.removeAttribute("type"),T!=null?ye==="number"?(T===0&&y.value===""||y.value!=T)&&(y.value=""+Li(T)):y.value!==""+Li(T)&&(y.value=""+Li(T)):ye!=="submit"&&ye!=="reset"||y.removeAttribute("value"),T!=null?Ac(y,ye,Li(T)):I!=null?Ac(y,ye,Li(I)):D!=null&&y.removeAttribute("value"),z==null&&$!=null&&(y.defaultChecked=!!$),z!=null&&(y.checked=z&&typeof z!="function"&&typeof z!="symbol"),De!=null&&typeof De!="function"&&typeof De!="symbol"&&typeof De!="boolean"?y.name=""+Li(De):y.removeAttribute("name")}function Nc(y,T,I,D,z,$,ye,De){if($!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(y.type=$),T!=null||I!=null){if(!($!=="submit"&&$!=="reset"||T!=null))return;I=I!=null?""+Li(I):"",T=T!=null?""+Li(T):I,De||T===y.value||(y.value=T),y.defaultValue=T}D=D??z,D=typeof D!="function"&&typeof D!="symbol"&&!!D,y.checked=De?y.checked:!!D,y.defaultChecked=!!D,ye!=null&&typeof ye!="function"&&typeof ye!="symbol"&&typeof ye!="boolean"&&(y.name=ye)}function Ac(y,T,I){T==="number"&&Jo(y.ownerDocument)===y||y.defaultValue===""+I||(y.defaultValue=""+I)}function Zr(y,T,I,D){if(y=y.options,T){T={};for(var z=0;z<I.length;z++)T["$"+I[z]]=!0;for(I=0;I<y.length;I++)z=T.hasOwnProperty("$"+y[I].value),y[I].selected!==z&&(y[I].selected=z),z&&D&&(y[I].defaultSelected=!0)}else{for(I=""+Li(I),T=null,z=0;z<y.length;z++){if(y[z].value===I){y[z].selected=!0,D&&(y[z].defaultSelected=!0);return}T!==null||y[z].disabled||(T=y[z])}T!==null&&(T.selected=!0)}}function ei(y,T,I){if(T!=null&&(T=""+Li(T),T!==y.value&&(y.value=T),I==null)){y.defaultValue!==T&&(y.defaultValue=T);return}y.defaultValue=I!=null?""+Li(I):""}function cy(y,T,I,D){if(T==null){if(D!=null){if(I!=null)throw Error(t(92));if(L(D)){if(1<D.length)throw Error(t(93));D=D[0]}I=D}I==null&&(I=""),T=I}I=Li(T),y.defaultValue=I,D=y.textContent,D===I&&D!==""&&D!==null&&(y.value=D)}function qa(y,T){if(T){var I=y.firstChild;if(I&&I===y.lastChild&&I.nodeType===3){I.nodeValue=T;return}}y.textContent=T}var Cs=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ol(y,T,I){var D=T.indexOf("--")===0;I==null||typeof I=="boolean"||I===""?D?y.setProperty(T,""):T==="float"?y.cssFloat="":y[T]="":D?y.setProperty(T,I):typeof I!="number"||I===0||Cs.has(T)?T==="float"?y.cssFloat=I:y[T]=(""+I).trim():y[T]=I+"px"}function vd(y,T,I){if(T!=null&&typeof T!="object")throw Error(t(62));if(y=y.style,I!=null){for(var D in I)!I.hasOwnProperty(D)||T!=null&&T.hasOwnProperty(D)||(D.indexOf("--")===0?y.setProperty(D,""):D==="float"?y.cssFloat="":y[D]="");for(var z in T)D=T[z],T.hasOwnProperty(z)&&I[z]!==D&&Ol(y,z,D)}else for(var $ in T)T.hasOwnProperty($)&&Ol(y,$,T[$])}function Dc(y){if(y.indexOf("-")===-1)return!1;switch(y){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wb=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Us(y){return wb.test(""+y)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":y}var ii=null;function rn(y){return y=y.target||y.srcElement||window,y.correspondingUseElement&&(y=y.correspondingUseElement),y.nodeType===3?y.parentNode:y}var Qo=null,Yo=null;function Pl(y){var T=ni(y);if(T&&(y=T.stateNode)){var I=y[qn]||null;e:switch(y=T.stateNode,T.type){case"input":if(ea(y,I.value,I.defaultValue,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name),T=I.name,I.type==="radio"&&T!=null){for(I=y;I.parentNode;)I=I.parentNode;for(I=I.querySelectorAll('input[name="'+Bi(""+T)+'"][type="radio"]'),T=0;T<I.length;T++){var D=I[T];if(D!==y&&D.form===y.form){var z=D[qn]||null;if(!z)throw Error(t(90));ea(D,z.value,z.defaultValue,z.defaultValue,z.checked,z.defaultChecked,z.type,z.name)}}for(T=0;T<I.length;T++)D=I[T],D.form===y.form&&ay(D)}break e;case"textarea":ei(y,I.value,I.defaultValue);break e;case"select":T=I.value,T!=null&&Zr(y,!!I.multiple,T,!1)}}}var kc=!1;function El(y,T,I){if(kc)return y(T,I);kc=!0;try{var D=y(T);return D}finally{if(kc=!1,(Qo!==null||Yo!==null)&&(pw(),Qo&&(T=Qo,y=Yo,Yo=Qo=null,Pl(T),y)))for(T=0;T<y.length;T++)Pl(y[T])}}function xc(y,T){var I=y.stateNode;if(I===null)return null;var D=I[qn]||null;if(D===null)return null;I=D[T];e:switch(T){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(y=y.type,D=!(y==="button"||y==="input"||y==="select"||y==="textarea")),y=!D;break e;default:y=!1}if(y)return null;if(I&&typeof I!="function")throw Error(t(231,T,typeof I));return I}var Qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qc=!1;if(Qn)try{var Xo={};Object.defineProperty(Xo,"passive",{get:function(){qc=!0}}),window.addEventListener("test",Xo,Xo),window.removeEventListener("test",Xo,Xo)}catch{qc=!1}var ta=null,Zo=null,Lc=null;function uy(){if(Lc)return Lc;var y,T=Zo,I=T.length,D,z="value"in ta?ta.value:ta.textContent,$=z.length;for(y=0;y<I&&T[y]===z[y];y++);var ye=I-y;for(D=1;D<=ye&&T[I-D]===z[$-D];D++);return Lc=z.slice(y,1<D?1-D:void 0)}function Wa(y){var T=y.keyCode;return"charCode"in y?(y=y.charCode,y===0&&T===13&&(y=13)):y=T,y===10&&(y=13),32<=y||y===13?y:0}function Ui(){return!0}function Sn(){return!1}function si(y){function T(I,D,z,$,ye){this._reactName=I,this._targetInst=z,this.type=D,this.nativeEvent=$,this.target=ye,this.currentTarget=null;for(var De in y)y.hasOwnProperty(De)&&(I=y[De],this[De]=I?I($):$[De]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?Ui:Sn,this.isPropagationStopped=Sn,this}return d(T.prototype,{preventDefault:function(){this.defaultPrevented=!0;var I=this.nativeEvent;I&&(I.preventDefault?I.preventDefault():typeof I.returnValue!="unknown"&&(I.returnValue=!1),this.isDefaultPrevented=Ui)},stopPropagation:function(){var I=this.nativeEvent;I&&(I.stopPropagation?I.stopPropagation():typeof I.cancelBubble!="unknown"&&(I.cancelBubble=!0),this.isPropagationStopped=Ui)},persist:function(){},isPersistent:Ui}),T}var na={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(y){return y.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cd=si(na),Bc=d({},na,{view:0,detail:0}),Ob=si(Bc),Uc,Il,ec,yr=d({},Bc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sn,button:0,buttons:0,relatedTarget:function(y){return y.relatedTarget===void 0?y.fromElement===y.srcElement?y.toElement:y.fromElement:y.relatedTarget},movementX:function(y){return"movementX"in y?y.movementX:(y!==ec&&(ec&&y.type==="mousemove"?(Uc=y.screenX-ec.screenX,Il=y.screenY-ec.screenY):Il=Uc=0,ec=y),Uc)},movementY:function(y){return"movementY"in y?y.movementY:Il}}),be=si(yr),Ee=d({},yr,{dataTransfer:0}),Le=si(Ee),$e=d({},Bc,{relatedTarget:0}),Xe=si($e),gt=d({},na,{animationName:0,elapsedTime:0,pseudoElement:0}),ft=si(gt),kt=d({},na,{clipboardData:function(y){return"clipboardData"in y?y.clipboardData:window.clipboardData}}),Wt=si(kt),dt=d({},na,{data:0}),B=si(dt),en={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ur={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lt(y){var T=this.nativeEvent;return T.getModifierState?T.getModifierState(y):(y=Ur[y])?!!T[y]:!1}function sn(){return Lt}var Qt=d({},Bc,{key:function(y){if(y.key){var T=en[y.key]||y.key;if(T!=="Unidentified")return T}return y.type==="keypress"?(y=Wa(y),y===13?"Enter":String.fromCharCode(y)):y.type==="keydown"||y.type==="keyup"?tr[y.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sn,charCode:function(y){return y.type==="keypress"?Wa(y):0},keyCode:function(y){return y.type==="keydown"||y.type==="keyup"?y.keyCode:0},which:function(y){return y.type==="keypress"?Wa(y):y.type==="keydown"||y.type==="keyup"?y.keyCode:0}}),zr=si(Qt),ai=d({},yr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),br=si(ai),kn=d({},Bc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sn}),On=si(kn),_s=d({},na,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pr=si(_s),Rl=d({},yr,{deltaX:function(y){return"deltaX"in y?y.deltaX:"wheelDeltaX"in y?-y.wheelDeltaX:0},deltaY:function(y){return"deltaY"in y?y.deltaY:"wheelDeltaY"in y?-y.wheelDeltaY:"wheelDelta"in y?-y.wheelDelta:0},deltaZ:0,deltaMode:0}),_d=si(Rl),zc=d({},na,{newState:0,oldState:0}),Ln=si(zc),Td=[9,13,27,32],Ja=Qn&&"CompositionEvent"in window,lr=null;Qn&&"documentMode"in document&&(lr=document.documentMode);var Ts=Qn&&"TextEvent"in window&&!lr,zi=Qn&&(!Ja||lr&&8<lr&&11>=lr),Fl=" ",ls=!1;function wd(y,T){switch(y){case"keyup":return Td.indexOf(T.keyCode)!==-1;case"keydown":return T.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dy(y){return y=y.detail,typeof y=="object"&&"data"in y?y.data:null}var Yn=!1;function nr(y,T){switch(y){case"compositionend":return dy(T);case"keypress":return T.which!==32?null:(ls=!0,Fl);case"textInput":return y=T.data,y===Fl&&ls?null:y;default:return null}}function jl(y,T){if(Yn)return y==="compositionend"||!Ja&&wd(y,T)?(y=uy(),Lc=Zo=ta=null,Yn=!1,y):null;switch(y){case"paste":return null;case"keypress":if(!(T.ctrlKey||T.altKey||T.metaKey)||T.ctrlKey&&T.altKey){if(T.char&&1<T.char.length)return T.char;if(T.which)return String.fromCharCode(T.which)}return null;case"compositionend":return zi&&T.locale!=="ko"?null:T.data;default:return null}}var Od={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ml(y){var T=y&&y.nodeName&&y.nodeName.toLowerCase();return T==="input"?!!Od[y.type]:T==="textarea"}function ly(y,T,I,D){Qo?Yo?Yo.push(D):Yo=[D]:Qo=D,T=Cw(T,"onChange"),0<T.length&&(I=new Cd("onChange","change",null,I,D),y.push({event:I,listeners:T}))}var Nl=null,Pd=null;function FI(y){NB(y,0)}function fy(y){var T=cs(y);if(ay(T))return y}function Pb(y,T){if(y==="change")return T}var Al=!1;if(Qn){var Ed;if(Qn){var Dl="oninput"in document;if(!Dl){var hy=document.createElement("div");hy.setAttribute("oninput","return;"),Dl=typeof hy.oninput=="function"}Ed=Dl}else Ed=!1;Al=Ed&&(!document.documentMode||9<document.documentMode)}function kl(){Nl&&(Nl.detachEvent("onpropertychange",Eb),Pd=Nl=null)}function Eb(y){if(y.propertyName==="value"&&fy(Pd)){var T=[];ly(T,Pd,y,rn(y)),El(FI,T)}}function Ib(y,T,I){y==="focusin"?(kl(),Nl=T,Pd=I,Nl.attachEvent("onpropertychange",Eb)):y==="focusout"&&kl()}function UT(y){if(y==="selectionchange"||y==="keyup"||y==="keydown")return fy(Pd)}function Rb(y,T){if(y==="click")return fy(T)}function my(y,T){if(y==="input"||y==="change")return fy(T)}function jI(y,T){return y===T&&(y!==0||1/y===1/T)||y!==y&&T!==T}var ws=typeof Object.is=="function"?Object.is:jI;function Id(y,T){if(ws(y,T))return!0;if(typeof y!="object"||y===null||typeof T!="object"||T===null)return!1;var I=Object.keys(y),D=Object.keys(T);if(I.length!==D.length)return!1;for(D=0;D<I.length;D++){var z=I[D];if(!pt.call(T,z)||!ws(y[z],T[z]))return!1}return!0}function py(y){for(;y&&y.firstChild;)y=y.firstChild;return y}function gy(y,T){var I=py(y);y=0;for(var D;I;){if(I.nodeType===3){if(D=y+I.textContent.length,y<=T&&D>=T)return{node:I,offset:T-y};y=D}e:{for(;I;){if(I.nextSibling){I=I.nextSibling;break e}I=I.parentNode}I=void 0}I=py(I)}}function zT(y,T){return y&&T?y===T?!0:y&&y.nodeType===3?!1:T&&T.nodeType===3?zT(y,T.parentNode):"contains"in y?y.contains(T):y.compareDocumentPosition?!!(y.compareDocumentPosition(T)&16):!1:!1}function VT(y){y=y!=null&&y.ownerDocument!=null&&y.ownerDocument.defaultView!=null?y.ownerDocument.defaultView:window;for(var T=Jo(y.document);T instanceof y.HTMLIFrameElement;){try{var I=typeof T.contentWindow.location.href=="string"}catch{I=!1}if(I)y=T.contentWindow;else break;T=Jo(y.document)}return T}function yy(y){var T=y&&y.nodeName&&y.nodeName.toLowerCase();return T&&(T==="input"&&(y.type==="text"||y.type==="search"||y.type==="tel"||y.type==="url"||y.type==="password")||T==="textarea"||y.contentEditable==="true")}var by=Qn&&"documentMode"in document&&11>=document.documentMode,Vc=null,Hc=null,tc=null,vy=!1;function Fb(y,T,I){var D=I.window===I?I.document:I.nodeType===9?I:I.ownerDocument;vy||Vc==null||Vc!==Jo(D)||(D=Vc,"selectionStart"in D&&yy(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),tc&&Id(tc,D)||(tc=D,D=Cw(Hc,"onSelect"),0<D.length&&(T=new Cd("onSelect","select",null,T,I),y.push({event:T,listeners:D}),T.target=Vc)))}function nc(y,T){var I={};return I[y.toLowerCase()]=T.toLowerCase(),I["Webkit"+y]="webkit"+T,I["Moz"+y]="moz"+T,I}var Rd={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionrun:nc("Transition","TransitionRun"),transitionstart:nc("Transition","TransitionStart"),transitioncancel:nc("Transition","TransitionCancel"),transitionend:nc("Transition","TransitionEnd")},Fd={},rr={};Qn&&(rr=document.createElement("div").style,"AnimationEvent"in window||(delete Rd.animationend.animation,delete Rd.animationiteration.animation,delete Rd.animationstart.animation),"TransitionEvent"in window||delete Rd.transitionend.transition);function wt(y){if(Fd[y])return Fd[y];if(!Rd[y])return y;var T=Rd[y],I;for(I in T)if(T.hasOwnProperty(I)&&I in rr)return Fd[y]=T[I];return y}var Cn=wt("animationend"),jb=wt("animationiteration"),Mb=wt("animationstart"),HT=wt("transitionrun"),an=wt("transitionstart"),MI=wt("transitioncancel"),P=wt("transitionend"),N=new Map,A="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");A.push("scrollEnd");function q(y,T){N.set(y,T),Xr(T,[y])}var H=new WeakMap;function U(y,T){if(typeof y=="object"&&y!==null){var I=H.get(y);return I!==void 0?I:(T={value:y,source:T,stack:Mc(T)},H.set(y,T),T)}return{value:y,source:T,stack:Mc(T)}}var Q=[],J=0,ae=0;function te(){for(var y=J,T=ae=J=0;T<y;){var I=Q[T];Q[T++]=null;var D=Q[T];Q[T++]=null;var z=Q[T];Q[T++]=null;var $=Q[T];if(Q[T++]=null,D!==null&&z!==null){var ye=D.pending;ye===null?z.next=z:(z.next=ye.next,ye.next=z),D.pending=z}$!==0&&ne(I,z,$)}}function le(y,T,I,D){Q[J++]=y,Q[J++]=T,Q[J++]=I,Q[J++]=D,ae|=D,y.lanes|=D,y=y.alternate,y!==null&&(y.lanes|=D)}function ce(y,T,I,D){return le(y,T,I,D),X(y)}function W(y,T){return le(y,null,null,T),X(y)}function ne(y,T,I){y.lanes|=I;var D=y.alternate;D!==null&&(D.lanes|=I);for(var z=!1,$=y.return;$!==null;)$.childLanes|=I,D=$.alternate,D!==null&&(D.childLanes|=I),$.tag===22&&(y=$.stateNode,y===null||y._visibility&1||(z=!0)),y=$,$=$.return;return y.tag===3?($=y.stateNode,z&&T!==null&&(z=31-Ve(I),y=$.hiddenUpdates,D=y[z],D===null?y[z]=[T]:D.push(T),T.lane=I|536870912),$):null}function X(y){if(50<Zb)throw Zb=0,RR=null,Error(t(185));for(var T=y.return;T!==null;)y=T,T=y.return;return y.tag===3?y.stateNode:null}var ie={};function ue(y,T,I,D){this.tag=y,this.key=I,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=T,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ve(y,T,I,D){return new ue(y,T,I,D)}function ze(y){return y=y.prototype,!(!y||!y.isReactComponent)}function tt(y,T){var I=y.alternate;return I===null?(I=ve(y.tag,T,y.key,y.mode),I.elementType=y.elementType,I.type=y.type,I.stateNode=y.stateNode,I.alternate=y,y.alternate=I):(I.pendingProps=T,I.type=y.type,I.flags=0,I.subtreeFlags=0,I.deletions=null),I.flags=y.flags&65011712,I.childLanes=y.childLanes,I.lanes=y.lanes,I.child=y.child,I.memoizedProps=y.memoizedProps,I.memoizedState=y.memoizedState,I.updateQueue=y.updateQueue,T=y.dependencies,I.dependencies=T===null?null:{lanes:T.lanes,firstContext:T.firstContext},I.sibling=y.sibling,I.index=y.index,I.ref=y.ref,I.refCleanup=y.refCleanup,I}function nt(y,T){y.flags&=65011714;var I=y.alternate;return I===null?(y.childLanes=0,y.lanes=T,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=I.childLanes,y.lanes=I.lanes,y.child=I.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=I.memoizedProps,y.memoizedState=I.memoizedState,y.updateQueue=I.updateQueue,y.type=I.type,T=I.dependencies,y.dependencies=T===null?null:{lanes:T.lanes,firstContext:T.firstContext}),y}function it(y,T,I,D,z,$){var ye=0;if(D=y,typeof y=="function")ze(y)&&(ye=1);else if(typeof y=="string")ye=Kde(y,I,de.current)?26:y==="html"||y==="head"||y==="body"?27:5;else e:switch(y){case F:return y=ve(31,I,T,z),y.elementType=F,y.lanes=$,y;case C:return _e(I.children,z,$,T);case v:ye=8,z|=24;break;case m:return y=ve(12,I,T,z|2),y.elementType=m,y.lanes=$,y;case p:return y=ve(13,I,T,z),y.elementType=p,y.lanes=$,y;case w:return y=ve(19,I,T,z),y.elementType=w,y.lanes=$,y;default:if(typeof y=="object"&&y!==null)switch(y.$$typeof){case h:case _:ye=10;break e;case g:ye=9;break e;case S:ye=11;break e;case O:ye=14;break e;case E:ye=16,D=null;break e}ye=29,I=Error(t(130,y===null?"null":typeof y,"")),D=null}return T=ve(ye,I,T,z),T.elementType=y,T.type=D,T.lanes=$,T}function _e(y,T,I,D){return y=ve(7,y,D,T),y.lanes=I,y}function Ie(y,T,I){return y=ve(6,y,null,T),y.lanes=I,y}function Ae(y,T,I){return T=ve(4,y.children!==null?y.children:[],y.key,T),T.lanes=I,T.stateNode={containerInfo:y.containerInfo,pendingChildren:null,implementation:y.implementation},T}var Te=[],Be=0,rt=null,ct=0,Tt=[],st=0,yt=null,Pt=1,jt="";function kr(y,T){Te[Be++]=ct,Te[Be++]=rt,rt=y,ct=T}function Er(y,T,I){Tt[st++]=Pt,Tt[st++]=jt,Tt[st++]=yt,yt=y;var D=Pt;y=jt;var z=32-Ve(D)-1;D&=~(1<<z),I+=1;var $=32-Ve(T)+z;if(30<$){var ye=z-z%5;$=(D&(1<<ye)-1).toString(32),D>>=ye,z-=ye,Pt=1<<32-Ve(T)+z|I<<z|D,jt=$+y}else Pt=1<<$|I<<z|D,jt=y}function ir(y){y.return!==null&&(kr(y,1),Er(y,1,0))}function xr(y){for(;y===rt;)rt=Te[--Be],Te[Be]=null,ct=Te[--Be],Te[Be]=null;for(;y===yt;)yt=Tt[--st],Tt[st]=null,jt=Tt[--st],Tt[st]=null,Pt=Tt[--st],Tt[st]=null}var Vn=null,_n=null,dn=!1,ra=null,Ir=!1,Tn=Error(t(519));function Fn(y){var T=Error(t(418,""));throw ia(U(T,y)),Tn}function Rr(y){var T=y.stateNode,I=y.type,D=y.memoizedProps;switch(T[wr]=y,T[qn]=D,I){case"dialog":Mn("cancel",T),Mn("close",T);break;case"iframe":case"object":case"embed":Mn("load",T);break;case"video":case"audio":for(I=0;I<tv.length;I++)Mn(tv[I],T);break;case"source":Mn("error",T);break;case"img":case"image":case"link":Mn("error",T),Mn("load",T);break;case"details":Mn("toggle",T);break;case"input":Mn("invalid",T),Nc(T,D.value,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name,!0),bd(T);break;case"select":Mn("invalid",T);break;case"textarea":Mn("invalid",T),cy(T,D.value,D.defaultValue,D.children),bd(T)}I=D.children,typeof I!="string"&&typeof I!="number"&&typeof I!="bigint"||T.textContent===""+I||D.suppressHydrationWarning===!0||xB(T.textContent,I)?(D.popover!=null&&(Mn("beforetoggle",T),Mn("toggle",T)),D.onScroll!=null&&Mn("scroll",T),D.onScrollEnd!=null&&Mn("scrollend",T),D.onClick!=null&&(T.onclick=_w),T=!0):T=!1,T||Fn(y)}function Fr(y){for(Vn=y.return;Vn;)switch(Vn.tag){case 5:case 13:Ir=!1;return;case 27:case 3:Ir=!0;return;default:Vn=Vn.return}}function fi(y){if(y!==Vn)return!1;if(!dn)return Fr(y),dn=!0,!1;var T=y.tag,I;if((I=T!==3&&T!==27)&&((I=T===5)&&(I=y.type,I=!(I!=="form"&&I!=="button")||KR(y.type,y.memoizedProps)),I=!I),I&&_n&&Fn(y),Fr(y),T===13){if(y=y.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(t(317));e:{for(y=y.nextSibling,T=0;y;){if(y.nodeType===8)if(I=y.data,I==="/$"){if(T===0){_n=eo(y.nextSibling);break e}T--}else I!=="$"&&I!=="$!"&&I!=="$?"||T++;y=y.nextSibling}_n=null}}else T===27?(T=_n,$d(y.type)?(y=JR,JR=null,_n=y):_n=T):_n=Vn?eo(y.stateNode.nextSibling):null;return!0}function fr(){_n=Vn=null,dn=!1}function jd(){var y=ra;return y!==null&&(Ks===null?Ks=y:Ks.push.apply(Ks,y),ra=null),y}function ia(y){ra===null?ra=[y]:ra.push(y)}var Os=fe(null),hi=null,sa=null;function Vi(y,T,I){pe(Os,T._currentValue),T._currentValue=I}function Qa(y){y._currentValue=Os.current,oe(Os)}function zs(y,T,I){for(;y!==null;){var D=y.alternate;if((y.childLanes&T)!==T?(y.childLanes|=T,D!==null&&(D.childLanes|=T)):D!==null&&(D.childLanes&T)!==T&&(D.childLanes|=T),y===I)break;y=y.return}}function Ya(y,T,I,D){var z=y.child;for(z!==null&&(z.return=y);z!==null;){var $=z.dependencies;if($!==null){var ye=z.child;$=$.firstContext;e:for(;$!==null;){var De=$;$=z;for(var et=0;et<T.length;et++)if(De.context===T[et]){$.lanes|=I,De=$.alternate,De!==null&&(De.lanes|=I),zs($.return,I,y),D||(ye=null);break e}$=De.next}}else if(z.tag===18){if(ye=z.return,ye===null)throw Error(t(341));ye.lanes|=I,$=ye.alternate,$!==null&&($.lanes|=I),zs(ye,I,y),ye=null}else ye=z.child;if(ye!==null)ye.return=z;else for(ye=z;ye!==null;){if(ye===y){ye=null;break}if(z=ye.sibling,z!==null){z.return=ye.return,ye=z;break}ye=ye.return}z=ye}}function xl(y,T,I,D){y=null;for(var z=T,$=!1;z!==null;){if(!$){if((z.flags&524288)!==0)$=!0;else if((z.flags&262144)!==0)break}if(z.tag===10){var ye=z.alternate;if(ye===null)throw Error(t(387));if(ye=ye.memoizedProps,ye!==null){var De=z.type;ws(z.pendingProps.value,ye.value)||(y!==null?y.push(De):y=[De])}}else if(z===Fe.current){if(ye=z.alternate,ye===null)throw Error(t(387));ye.memoizedState.memoizedState!==z.memoizedState.memoizedState&&(y!==null?y.push(ov):y=[ov])}z=z.return}y!==null&&Ya(T,y,I,D),T.flags|=262144}function ql(y){for(y=y.firstContext;y!==null;){if(!ws(y.context._currentValue,y.memoizedValue))return!0;y=y.next}return!1}function Gn(y){hi=y,sa=null,y=y.dependencies,y!==null&&(y.firstContext=null)}function vr(y){return Xa(hi,y)}function xn(y,T){return hi===null&&Gn(y),Xa(y,T)}function Xa(y,T){var I=T._currentValue;if(T={context:T,memoizedValue:I,next:null},sa===null){if(y===null)throw Error(t(308));sa=T,y.dependencies={lanes:0,firstContext:T},y.flags|=524288}else sa=sa.next=T;return I}var Hue=typeof AbortController<"u"?AbortController:function(){var y=[],T=this.signal={aborted:!1,addEventListener:function(I,D){y.push(D)}};this.abort=function(){T.aborted=!0,y.forEach(function(I){return I()})}},Kue=e.unstable_scheduleCallback,$ue=e.unstable_NormalPriority,_i={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function NI(){return{controller:new Hue,data:new Map,refCount:0}}function Nb(y){y.refCount--,y.refCount===0&&Kue($ue,function(){y.controller.abort()})}var Ab=null,AI=0,Sy=0,Cy=null;function Gue(y,T){if(Ab===null){var I=Ab=[];AI=0,Sy=kR(),Cy={status:"pending",value:void 0,then:function(D){I.push(D)}}}return AI++,T.then(wL,wL),T}function wL(){if(--AI===0&&Ab!==null){Cy!==null&&(Cy.status="fulfilled");var y=Ab;Ab=null,Sy=0,Cy=null;for(var T=0;T<y.length;T++)(0,y[T])()}}function Wue(y,T){var I=[],D={status:"pending",value:null,reason:null,then:function(z){I.push(z)}};return y.then(function(){D.status="fulfilled",D.value=T;for(var z=0;z<I.length;z++)(0,I[z])(T)},function(z){for(D.status="rejected",D.reason=z,z=0;z<I.length;z++)(0,I[z])(void 0)}),D}var OL=V.S;V.S=function(y,T){typeof T=="object"&&T!==null&&typeof T.then=="function"&&Gue(y,T),OL!==null&&OL(y,T)};var Ll=fe(null);function DI(){var y=Ll.current;return y!==null?y:jr.pooledCache}function KT(y,T){T===null?pe(Ll,Ll.current):pe(Ll,T.pool)}function PL(){var y=DI();return y===null?null:{parent:_i._currentValue,pool:y}}var Db=Error(t(460)),EL=Error(t(474)),$T=Error(t(542)),kI={then:function(){}};function IL(y){return y=y.status,y==="fulfilled"||y==="rejected"}function GT(){}function RL(y,T,I){switch(I=y[I],I===void 0?y.push(T):I!==T&&(T.then(GT,GT),T=I),T.status){case"fulfilled":return T.value;case"rejected":throw y=T.reason,jL(y),y;default:if(typeof T.status=="string")T.then(GT,GT);else{if(y=jr,y!==null&&100<y.shellSuspendCounter)throw Error(t(482));y=T,y.status="pending",y.then(function(D){if(T.status==="pending"){var z=T;z.status="fulfilled",z.value=D}},function(D){if(T.status==="pending"){var z=T;z.status="rejected",z.reason=D}})}switch(T.status){case"fulfilled":return T.value;case"rejected":throw y=T.reason,jL(y),y}throw kb=T,Db}}var kb=null;function FL(){if(kb===null)throw Error(t(459));var y=kb;return kb=null,y}function jL(y){if(y===Db||y===$T)throw Error(t(483))}var Md=!1;function xI(y){y.updateQueue={baseState:y.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function qI(y,T){y=y.updateQueue,T.updateQueue===y&&(T.updateQueue={baseState:y.baseState,firstBaseUpdate:y.firstBaseUpdate,lastBaseUpdate:y.lastBaseUpdate,shared:y.shared,callbacks:null})}function Nd(y){return{lane:y,tag:0,payload:null,callback:null,next:null}}function Ad(y,T,I){var D=y.updateQueue;if(D===null)return null;if(D=D.shared,(or&2)!==0){var z=D.pending;return z===null?T.next=T:(T.next=z.next,z.next=T),D.pending=T,T=X(y),ne(y,null,I),T}return le(y,D,T,I),X(y)}function xb(y,T,I){if(T=T.updateQueue,T!==null&&(T=T.shared,(I&4194048)!==0)){var D=T.lanes;D&=y.pendingLanes,I|=D,T.lanes=I,mn(y,I)}}function LI(y,T){var I=y.updateQueue,D=y.alternate;if(D!==null&&(D=D.updateQueue,I===D)){var z=null,$=null;if(I=I.firstBaseUpdate,I!==null){do{var ye={lane:I.lane,tag:I.tag,payload:I.payload,callback:null,next:null};$===null?z=$=ye:$=$.next=ye,I=I.next}while(I!==null);$===null?z=$=T:$=$.next=T}else z=$=T;I={baseState:D.baseState,firstBaseUpdate:z,lastBaseUpdate:$,shared:D.shared,callbacks:D.callbacks},y.updateQueue=I;return}y=I.lastBaseUpdate,y===null?I.firstBaseUpdate=T:y.next=T,I.lastBaseUpdate=T}var BI=!1;function qb(){if(BI){var y=Cy;if(y!==null)throw y}}function Lb(y,T,I,D){BI=!1;var z=y.updateQueue;Md=!1;var $=z.firstBaseUpdate,ye=z.lastBaseUpdate,De=z.shared.pending;if(De!==null){z.shared.pending=null;var et=De,vt=et.next;et.next=null,ye===null?$=vt:ye.next=vt,ye=et;var It=y.alternate;It!==null&&(It=It.updateQueue,De=It.lastBaseUpdate,De!==ye&&(De===null?It.firstBaseUpdate=vt:De.next=vt,It.lastBaseUpdate=et))}if($!==null){var At=z.baseState;ye=0,It=vt=et=null,De=$;do{var St=De.lane&-536870913,Ct=St!==De.lane;if(Ct?(Hn&St)===St:(D&St)===St){St!==0&&St===Sy&&(BI=!0),It!==null&&(It=It.next={lane:0,tag:De.tag,payload:De.payload,callback:null,next:null});e:{var hn=y,un=De;St=T;var pr=I;switch(un.tag){case 1:if(hn=un.payload,typeof hn=="function"){At=hn.call(pr,At,St);break e}At=hn;break e;case 3:hn.flags=hn.flags&-65537|128;case 0:if(hn=un.payload,St=typeof hn=="function"?hn.call(pr,At,St):hn,St==null)break e;At=d({},At,St);break e;case 2:Md=!0}}St=De.callback,St!==null&&(y.flags|=64,Ct&&(y.flags|=8192),Ct=z.callbacks,Ct===null?z.callbacks=[St]:Ct.push(St))}else Ct={lane:St,tag:De.tag,payload:De.payload,callback:De.callback,next:null},It===null?(vt=It=Ct,et=At):It=It.next=Ct,ye|=St;if(De=De.next,De===null){if(De=z.shared.pending,De===null)break;Ct=De,De=Ct.next,Ct.next=null,z.lastBaseUpdate=Ct,z.shared.pending=null}}while(!0);It===null&&(et=At),z.baseState=et,z.firstBaseUpdate=vt,z.lastBaseUpdate=It,$===null&&(z.shared.lanes=0),zd|=ye,y.lanes=ye,y.memoizedState=At}}function ML(y,T){if(typeof y!="function")throw Error(t(191,y));y.call(T)}function NL(y,T){var I=y.callbacks;if(I!==null)for(y.callbacks=null,y=0;y<I.length;y++)ML(I[y],T)}var _y=fe(null),WT=fe(0);function AL(y,T){y=Yc,pe(WT,y),pe(_y,T),Yc=y|T.baseLanes}function UI(){pe(WT,Yc),pe(_y,_y.current)}function zI(){Yc=WT.current,oe(_y),oe(WT)}var Dd=0,Pn=null,hr=null,mi=null,JT=!1,Ty=!1,Bl=!1,QT=0,Bb=0,wy=null,Jue=0;function oi(){throw Error(t(321))}function VI(y,T){if(T===null)return!1;for(var I=0;I<T.length&&I<y.length;I++)if(!ws(y[I],T[I]))return!1;return!0}function HI(y,T,I,D,z,$){return Dd=$,Pn=T,T.memoizedState=null,T.updateQueue=null,T.lanes=0,V.H=y===null||y.memoizedState===null?y2:b2,Bl=!1,$=I(D,z),Bl=!1,Ty&&($=kL(T,I,D,z)),DL(y),$}function DL(y){V.H=nw;var T=hr!==null&&hr.next!==null;if(Dd=0,mi=hr=Pn=null,JT=!1,Bb=0,wy=null,T)throw Error(t(300));y===null||Ni||(y=y.dependencies,y!==null&&ql(y)&&(Ni=!0))}function kL(y,T,I,D){Pn=y;var z=0;do{if(Ty&&(wy=null),Bb=0,Ty=!1,25<=z)throw Error(t(301));if(z+=1,mi=hr=null,y.updateQueue!=null){var $=y.updateQueue;$.lastEffect=null,$.events=null,$.stores=null,$.memoCache!=null&&($.memoCache.index=0)}V.H=nde,$=T(I,D)}while(Ty);return $}function Que(){var y=V.H,T=y.useState()[0];return T=typeof T.then=="function"?Ub(T):T,y=y.useState()[0],(hr!==null?hr.memoizedState:null)!==y&&(Pn.flags|=1024),T}function KI(){var y=QT!==0;return QT=0,y}function $I(y,T,I){T.updateQueue=y.updateQueue,T.flags&=-2053,y.lanes&=~I}function GI(y){if(JT){for(y=y.memoizedState;y!==null;){var T=y.queue;T!==null&&(T.pending=null),y=y.next}JT=!1}Dd=0,mi=hr=Pn=null,Ty=!1,Bb=QT=0,wy=null}function Vs(){var y={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mi===null?Pn.memoizedState=mi=y:mi=mi.next=y,mi}function pi(){if(hr===null){var y=Pn.alternate;y=y!==null?y.memoizedState:null}else y=hr.next;var T=mi===null?Pn.memoizedState:mi.next;if(T!==null)mi=T,hr=y;else{if(y===null)throw Pn.alternate===null?Error(t(467)):Error(t(310));hr=y,y={memoizedState:hr.memoizedState,baseState:hr.baseState,baseQueue:hr.baseQueue,queue:hr.queue,next:null},mi===null?Pn.memoizedState=mi=y:mi=mi.next=y}return mi}function WI(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ub(y){var T=Bb;return Bb+=1,wy===null&&(wy=[]),y=RL(wy,y,T),T=Pn,(mi===null?T.memoizedState:mi.next)===null&&(T=T.alternate,V.H=T===null||T.memoizedState===null?y2:b2),y}function YT(y){if(y!==null&&typeof y=="object"){if(typeof y.then=="function")return Ub(y);if(y.$$typeof===_)return vr(y)}throw Error(t(438,String(y)))}function JI(y){var T=null,I=Pn.updateQueue;if(I!==null&&(T=I.memoCache),T==null){var D=Pn.alternate;D!==null&&(D=D.updateQueue,D!==null&&(D=D.memoCache,D!=null&&(T={data:D.data.map(function(z){return z.slice()}),index:0})))}if(T==null&&(T={data:[],index:0}),I===null&&(I=WI(),Pn.updateQueue=I),I.memoCache=T,I=T.data[T.index],I===void 0)for(I=T.data[T.index]=Array(y),D=0;D<y;D++)I[D]=R;return T.index++,I}function Kc(y,T){return typeof T=="function"?T(y):T}function XT(y){var T=pi();return QI(T,hr,y)}function QI(y,T,I){var D=y.queue;if(D===null)throw Error(t(311));D.lastRenderedReducer=I;var z=y.baseQueue,$=D.pending;if($!==null){if(z!==null){var ye=z.next;z.next=$.next,$.next=ye}T.baseQueue=z=$,D.pending=null}if($=y.baseState,z===null)y.memoizedState=$;else{T=z.next;var De=ye=null,et=null,vt=T,It=!1;do{var At=vt.lane&-536870913;if(At!==vt.lane?(Hn&At)===At:(Dd&At)===At){var St=vt.revertLane;if(St===0)et!==null&&(et=et.next={lane:0,revertLane:0,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null}),At===Sy&&(It=!0);else if((Dd&St)===St){vt=vt.next,St===Sy&&(It=!0);continue}else At={lane:0,revertLane:vt.revertLane,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null},et===null?(De=et=At,ye=$):et=et.next=At,Pn.lanes|=St,zd|=St;At=vt.action,Bl&&I($,At),$=vt.hasEagerState?vt.eagerState:I($,At)}else St={lane:At,revertLane:vt.revertLane,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null},et===null?(De=et=St,ye=$):et=et.next=St,Pn.lanes|=At,zd|=At;vt=vt.next}while(vt!==null&&vt!==T);if(et===null?ye=$:et.next=De,!ws($,y.memoizedState)&&(Ni=!0,It&&(I=Cy,I!==null)))throw I;y.memoizedState=$,y.baseState=ye,y.baseQueue=et,D.lastRenderedState=$}return z===null&&(D.lanes=0),[y.memoizedState,D.dispatch]}function YI(y){var T=pi(),I=T.queue;if(I===null)throw Error(t(311));I.lastRenderedReducer=y;var D=I.dispatch,z=I.pending,$=T.memoizedState;if(z!==null){I.pending=null;var ye=z=z.next;do $=y($,ye.action),ye=ye.next;while(ye!==z);ws($,T.memoizedState)||(Ni=!0),T.memoizedState=$,T.baseQueue===null&&(T.baseState=$),I.lastRenderedState=$}return[$,D]}function xL(y,T,I){var D=Pn,z=pi(),$=dn;if($){if(I===void 0)throw Error(t(407));I=I()}else I=T();var ye=!ws((hr||z).memoizedState,I);ye&&(z.memoizedState=I,Ni=!0),z=z.queue;var De=BL.bind(null,D,z,y);if(zb(2048,8,De,[y]),z.getSnapshot!==T||ye||mi!==null&&mi.memoizedState.tag&1){if(D.flags|=2048,Oy(9,ZT(),LL.bind(null,D,z,I,T),null),jr===null)throw Error(t(349));$||(Dd&124)!==0||qL(D,T,I)}return I}function qL(y,T,I){y.flags|=16384,y={getSnapshot:T,value:I},T=Pn.updateQueue,T===null?(T=WI(),Pn.updateQueue=T,T.stores=[y]):(I=T.stores,I===null?T.stores=[y]:I.push(y))}function LL(y,T,I,D){T.value=I,T.getSnapshot=D,UL(T)&&zL(y)}function BL(y,T,I){return I(function(){UL(T)&&zL(y)})}function UL(y){var T=y.getSnapshot;y=y.value;try{var I=T();return!ws(y,I)}catch{return!0}}function zL(y){var T=W(y,2);T!==null&&da(T,y,2)}function XI(y){var T=Vs();if(typeof y=="function"){var I=y;if(y=I(),Bl){Se(!0);try{I()}finally{Se(!1)}}}return T.memoizedState=T.baseState=y,T.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kc,lastRenderedState:y},T}function VL(y,T,I,D){return y.baseState=I,QI(y,hr,typeof D=="function"?D:Kc)}function Yue(y,T,I,D,z){if(tw(y))throw Error(t(485));if(y=T.action,y!==null){var $={payload:z,action:y,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ye){$.listeners.push(ye)}};V.T!==null?I(!0):$.isTransition=!1,D($),I=T.pending,I===null?($.next=T.pending=$,HL(T,$)):($.next=I.next,T.pending=I.next=$)}}function HL(y,T){var I=T.action,D=T.payload,z=y.state;if(T.isTransition){var $=V.T,ye={};V.T=ye;try{var De=I(z,D),et=V.S;et!==null&&et(ye,De),KL(y,T,De)}catch(vt){ZI(y,T,vt)}finally{V.T=$}}else try{$=I(z,D),KL(y,T,$)}catch(vt){ZI(y,T,vt)}}function KL(y,T,I){I!==null&&typeof I=="object"&&typeof I.then=="function"?I.then(function(D){$L(y,T,D)},function(D){return ZI(y,T,D)}):$L(y,T,I)}function $L(y,T,I){T.status="fulfilled",T.value=I,GL(T),y.state=I,T=y.pending,T!==null&&(I=T.next,I===T?y.pending=null:(I=I.next,T.next=I,HL(y,I)))}function ZI(y,T,I){var D=y.pending;if(y.pending=null,D!==null){D=D.next;do T.status="rejected",T.reason=I,GL(T),T=T.next;while(T!==D)}y.action=null}function GL(y){y=y.listeners;for(var T=0;T<y.length;T++)(0,y[T])()}function WL(y,T){return T}function JL(y,T){if(dn){var I=jr.formState;if(I!==null){e:{var D=Pn;if(dn){if(_n){t:{for(var z=_n,$=Ir;z.nodeType!==8;){if(!$){z=null;break t}if(z=eo(z.nextSibling),z===null){z=null;break t}}$=z.data,z=$==="F!"||$==="F"?z:null}if(z){_n=eo(z.nextSibling),D=z.data==="F!";break e}}Fn(D)}D=!1}D&&(T=I[0])}}return I=Vs(),I.memoizedState=I.baseState=T,D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:WL,lastRenderedState:T},I.queue=D,I=m2.bind(null,Pn,D),D.dispatch=I,D=XI(!1),$=iR.bind(null,Pn,!1,D.queue),D=Vs(),z={state:T,dispatch:null,action:y,pending:null},D.queue=z,I=Yue.bind(null,Pn,z,$,I),z.dispatch=I,D.memoizedState=y,[T,I,!1]}function QL(y){var T=pi();return YL(T,hr,y)}function YL(y,T,I){if(T=QI(y,T,WL)[0],y=XT(Kc)[0],typeof T=="object"&&T!==null&&typeof T.then=="function")try{var D=Ub(T)}catch(ye){throw ye===Db?$T:ye}else D=T;T=pi();var z=T.queue,$=z.dispatch;return I!==T.memoizedState&&(Pn.flags|=2048,Oy(9,ZT(),Xue.bind(null,z,I),null)),[D,$,y]}function Xue(y,T){y.action=T}function XL(y){var T=pi(),I=hr;if(I!==null)return YL(T,I,y);pi(),T=T.memoizedState,I=pi();var D=I.queue.dispatch;return I.memoizedState=y,[T,D,!1]}function Oy(y,T,I,D){return y={tag:y,create:I,deps:D,inst:T,next:null},T=Pn.updateQueue,T===null&&(T=WI(),Pn.updateQueue=T),I=T.lastEffect,I===null?T.lastEffect=y.next=y:(D=I.next,I.next=y,y.next=D,T.lastEffect=y),y}function ZT(){return{destroy:void 0,resource:void 0}}function ZL(){return pi().memoizedState}function ew(y,T,I,D){var z=Vs();D=D===void 0?null:D,Pn.flags|=y,z.memoizedState=Oy(1|T,ZT(),I,D)}function zb(y,T,I,D){var z=pi();D=D===void 0?null:D;var $=z.memoizedState.inst;hr!==null&&D!==null&&VI(D,hr.memoizedState.deps)?z.memoizedState=Oy(T,$,I,D):(Pn.flags|=y,z.memoizedState=Oy(1|T,$,I,D))}function e2(y,T){ew(8390656,8,y,T)}function t2(y,T){zb(2048,8,y,T)}function n2(y,T){return zb(4,2,y,T)}function r2(y,T){return zb(4,4,y,T)}function i2(y,T){if(typeof T=="function"){y=y();var I=T(y);return function(){typeof I=="function"?I():T(null)}}if(T!=null)return y=y(),T.current=y,function(){T.current=null}}function s2(y,T,I){I=I!=null?I.concat([y]):null,zb(4,4,i2.bind(null,T,y),I)}function eR(){}function a2(y,T){var I=pi();T=T===void 0?null:T;var D=I.memoizedState;return T!==null&&VI(T,D[1])?D[0]:(I.memoizedState=[y,T],y)}function o2(y,T){var I=pi();T=T===void 0?null:T;var D=I.memoizedState;if(T!==null&&VI(T,D[1]))return D[0];if(D=y(),Bl){Se(!0);try{y()}finally{Se(!1)}}return I.memoizedState=[D,T],D}function tR(y,T,I){return I===void 0||(Dd&1073741824)!==0?y.memoizedState=T:(y.memoizedState=I,y=dB(),Pn.lanes|=y,zd|=y,I)}function c2(y,T,I,D){return ws(I,T)?I:_y.current!==null?(y=tR(y,I,D),ws(y,T)||(Ni=!0),y):(Dd&42)===0?(Ni=!0,y.memoizedState=I):(y=dB(),Pn.lanes|=y,zd|=y,T)}function u2(y,T,I,D,z){var $=G.p;G.p=$!==0&&8>$?$:8;var ye=V.T,De={};V.T=De,iR(y,!1,T,I);try{var et=z(),vt=V.S;if(vt!==null&&vt(De,et),et!==null&&typeof et=="object"&&typeof et.then=="function"){var It=Wue(et,D);Vb(y,T,It,ua(y))}else Vb(y,T,D,ua(y))}catch(At){Vb(y,T,{then:function(){},status:"rejected",reason:At},ua())}finally{G.p=$,V.T=ye}}function Zue(){}function nR(y,T,I,D){if(y.tag!==5)throw Error(t(476));var z=d2(y).queue;u2(y,z,T,ee,I===null?Zue:function(){return l2(y),I(D)})}function d2(y){var T=y.memoizedState;if(T!==null)return T;T={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kc,lastRenderedState:ee},next:null};var I={};return T.next={memoizedState:I,baseState:I,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kc,lastRenderedState:I},next:null},y.memoizedState=T,y=y.alternate,y!==null&&(y.memoizedState=T),T}function l2(y){var T=d2(y).next.queue;Vb(y,T,{},ua())}function rR(){return vr(ov)}function f2(){return pi().memoizedState}function h2(){return pi().memoizedState}function ede(y){for(var T=y.return;T!==null;){switch(T.tag){case 24:case 3:var I=ua();y=Nd(I);var D=Ad(T,y,I);D!==null&&(da(D,T,I),xb(D,T,I)),T={cache:NI()},y.payload=T;return}T=T.return}}function tde(y,T,I){var D=ua();I={lane:D,revertLane:0,action:I,hasEagerState:!1,eagerState:null,next:null},tw(y)?p2(T,I):(I=ce(y,T,I,D),I!==null&&(da(I,y,D),g2(I,T,D)))}function m2(y,T,I){var D=ua();Vb(y,T,I,D)}function Vb(y,T,I,D){var z={lane:D,revertLane:0,action:I,hasEagerState:!1,eagerState:null,next:null};if(tw(y))p2(T,z);else{var $=y.alternate;if(y.lanes===0&&($===null||$.lanes===0)&&($=T.lastRenderedReducer,$!==null))try{var ye=T.lastRenderedState,De=$(ye,I);if(z.hasEagerState=!0,z.eagerState=De,ws(De,ye))return le(y,T,z,0),jr===null&&te(),!1}catch{}finally{}if(I=ce(y,T,z,D),I!==null)return da(I,y,D),g2(I,T,D),!0}return!1}function iR(y,T,I,D){if(D={lane:2,revertLane:kR(),action:D,hasEagerState:!1,eagerState:null,next:null},tw(y)){if(T)throw Error(t(479))}else T=ce(y,I,D,2),T!==null&&da(T,y,2)}function tw(y){var T=y.alternate;return y===Pn||T!==null&&T===Pn}function p2(y,T){Ty=JT=!0;var I=y.pending;I===null?T.next=T:(T.next=I.next,I.next=T),y.pending=T}function g2(y,T,I){if((I&4194048)!==0){var D=T.lanes;D&=y.pendingLanes,I|=D,T.lanes=I,mn(y,I)}}var nw={readContext:vr,use:YT,useCallback:oi,useContext:oi,useEffect:oi,useImperativeHandle:oi,useLayoutEffect:oi,useInsertionEffect:oi,useMemo:oi,useReducer:oi,useRef:oi,useState:oi,useDebugValue:oi,useDeferredValue:oi,useTransition:oi,useSyncExternalStore:oi,useId:oi,useHostTransitionStatus:oi,useFormState:oi,useActionState:oi,useOptimistic:oi,useMemoCache:oi,useCacheRefresh:oi},y2={readContext:vr,use:YT,useCallback:function(y,T){return Vs().memoizedState=[y,T===void 0?null:T],y},useContext:vr,useEffect:e2,useImperativeHandle:function(y,T,I){I=I!=null?I.concat([y]):null,ew(4194308,4,i2.bind(null,T,y),I)},useLayoutEffect:function(y,T){return ew(4194308,4,y,T)},useInsertionEffect:function(y,T){ew(4,2,y,T)},useMemo:function(y,T){var I=Vs();T=T===void 0?null:T;var D=y();if(Bl){Se(!0);try{y()}finally{Se(!1)}}return I.memoizedState=[D,T],D},useReducer:function(y,T,I){var D=Vs();if(I!==void 0){var z=I(T);if(Bl){Se(!0);try{I(T)}finally{Se(!1)}}}else z=T;return D.memoizedState=D.baseState=z,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:y,lastRenderedState:z},D.queue=y,y=y.dispatch=tde.bind(null,Pn,y),[D.memoizedState,y]},useRef:function(y){var T=Vs();return y={current:y},T.memoizedState=y},useState:function(y){y=XI(y);var T=y.queue,I=m2.bind(null,Pn,T);return T.dispatch=I,[y.memoizedState,I]},useDebugValue:eR,useDeferredValue:function(y,T){var I=Vs();return tR(I,y,T)},useTransition:function(){var y=XI(!1);return y=u2.bind(null,Pn,y.queue,!0,!1),Vs().memoizedState=y,[!1,y]},useSyncExternalStore:function(y,T,I){var D=Pn,z=Vs();if(dn){if(I===void 0)throw Error(t(407));I=I()}else{if(I=T(),jr===null)throw Error(t(349));(Hn&124)!==0||qL(D,T,I)}z.memoizedState=I;var $={value:I,getSnapshot:T};return z.queue=$,e2(BL.bind(null,D,$,y),[y]),D.flags|=2048,Oy(9,ZT(),LL.bind(null,D,$,I,T),null),I},useId:function(){var y=Vs(),T=jr.identifierPrefix;if(dn){var I=jt,D=Pt;I=(D&~(1<<32-Ve(D)-1)).toString(32)+I,T=""+T+"R"+I,I=QT++,0<I&&(T+="H"+I.toString(32)),T+=""}else I=Jue++,T=""+T+"r"+I.toString(32)+"";return y.memoizedState=T},useHostTransitionStatus:rR,useFormState:JL,useActionState:JL,useOptimistic:function(y){var T=Vs();T.memoizedState=T.baseState=y;var I={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return T.queue=I,T=iR.bind(null,Pn,!0,I),I.dispatch=T,[y,T]},useMemoCache:JI,useCacheRefresh:function(){return Vs().memoizedState=ede.bind(null,Pn)}},b2={readContext:vr,use:YT,useCallback:a2,useContext:vr,useEffect:t2,useImperativeHandle:s2,useInsertionEffect:n2,useLayoutEffect:r2,useMemo:o2,useReducer:XT,useRef:ZL,useState:function(){return XT(Kc)},useDebugValue:eR,useDeferredValue:function(y,T){var I=pi();return c2(I,hr.memoizedState,y,T)},useTransition:function(){var y=XT(Kc)[0],T=pi().memoizedState;return[typeof y=="boolean"?y:Ub(y),T]},useSyncExternalStore:xL,useId:f2,useHostTransitionStatus:rR,useFormState:QL,useActionState:QL,useOptimistic:function(y,T){var I=pi();return VL(I,hr,y,T)},useMemoCache:JI,useCacheRefresh:h2},nde={readContext:vr,use:YT,useCallback:a2,useContext:vr,useEffect:t2,useImperativeHandle:s2,useInsertionEffect:n2,useLayoutEffect:r2,useMemo:o2,useReducer:YI,useRef:ZL,useState:function(){return YI(Kc)},useDebugValue:eR,useDeferredValue:function(y,T){var I=pi();return hr===null?tR(I,y,T):c2(I,hr.memoizedState,y,T)},useTransition:function(){var y=YI(Kc)[0],T=pi().memoizedState;return[typeof y=="boolean"?y:Ub(y),T]},useSyncExternalStore:xL,useId:f2,useHostTransitionStatus:rR,useFormState:XL,useActionState:XL,useOptimistic:function(y,T){var I=pi();return hr!==null?VL(I,hr,y,T):(I.baseState=y,[y,I.queue.dispatch])},useMemoCache:JI,useCacheRefresh:h2},Py=null,Hb=0;function rw(y){var T=Hb;return Hb+=1,Py===null&&(Py=[]),RL(Py,y,T)}function Kb(y,T){T=T.props.ref,y.ref=T!==void 0?T:null}function iw(y,T){throw T.$$typeof===l?Error(t(525)):(y=Object.prototype.toString.call(T),Error(t(31,y==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":y)))}function v2(y){var T=y._init;return T(y._payload)}function S2(y){function T(ht,at){if(y){var bt=ht.deletions;bt===null?(ht.deletions=[at],ht.flags|=16):bt.push(at)}}function I(ht,at){if(!y)return null;for(;at!==null;)T(ht,at),at=at.sibling;return null}function D(ht){for(var at=new Map;ht!==null;)ht.key!==null?at.set(ht.key,ht):at.set(ht.index,ht),ht=ht.sibling;return at}function z(ht,at){return ht=tt(ht,at),ht.index=0,ht.sibling=null,ht}function $(ht,at,bt){return ht.index=bt,y?(bt=ht.alternate,bt!==null?(bt=bt.index,bt<at?(ht.flags|=67108866,at):bt):(ht.flags|=67108866,at)):(ht.flags|=1048576,at)}function ye(ht){return y&&ht.alternate===null&&(ht.flags|=67108866),ht}function De(ht,at,bt,Mt){return at===null||at.tag!==6?(at=Ie(bt,ht.mode,Mt),at.return=ht,at):(at=z(at,bt),at.return=ht,at)}function et(ht,at,bt,Mt){var Jt=bt.type;return Jt===C?It(ht,at,bt.props.children,Mt,bt.key):at!==null&&(at.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===E&&v2(Jt)===at.type)?(at=z(at,bt.props),Kb(at,bt),at.return=ht,at):(at=it(bt.type,bt.key,bt.props,null,ht.mode,Mt),Kb(at,bt),at.return=ht,at)}function vt(ht,at,bt,Mt){return at===null||at.tag!==4||at.stateNode.containerInfo!==bt.containerInfo||at.stateNode.implementation!==bt.implementation?(at=Ae(bt,ht.mode,Mt),at.return=ht,at):(at=z(at,bt.children||[]),at.return=ht,at)}function It(ht,at,bt,Mt,Jt){return at===null||at.tag!==7?(at=_e(bt,ht.mode,Mt,Jt),at.return=ht,at):(at=z(at,bt),at.return=ht,at)}function At(ht,at,bt){if(typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint")return at=Ie(""+at,ht.mode,bt),at.return=ht,at;if(typeof at=="object"&&at!==null){switch(at.$$typeof){case f:return bt=it(at.type,at.key,at.props,null,ht.mode,bt),Kb(bt,at),bt.return=ht,bt;case b:return at=Ae(at,ht.mode,bt),at.return=ht,at;case E:var Mt=at._init;return at=Mt(at._payload),At(ht,at,bt)}if(L(at)||j(at))return at=_e(at,ht.mode,bt,null),at.return=ht,at;if(typeof at.then=="function")return At(ht,rw(at),bt);if(at.$$typeof===_)return At(ht,xn(ht,at),bt);iw(ht,at)}return null}function St(ht,at,bt,Mt){var Jt=at!==null?at.key:null;if(typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint")return Jt!==null?null:De(ht,at,""+bt,Mt);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case f:return bt.key===Jt?et(ht,at,bt,Mt):null;case b:return bt.key===Jt?vt(ht,at,bt,Mt):null;case E:return Jt=bt._init,bt=Jt(bt._payload),St(ht,at,bt,Mt)}if(L(bt)||j(bt))return Jt!==null?null:It(ht,at,bt,Mt,null);if(typeof bt.then=="function")return St(ht,at,rw(bt),Mt);if(bt.$$typeof===_)return St(ht,at,xn(ht,bt),Mt);iw(ht,bt)}return null}function Ct(ht,at,bt,Mt,Jt){if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint")return ht=ht.get(bt)||null,De(at,ht,""+Mt,Jt);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case f:return ht=ht.get(Mt.key===null?bt:Mt.key)||null,et(at,ht,Mt,Jt);case b:return ht=ht.get(Mt.key===null?bt:Mt.key)||null,vt(at,ht,Mt,Jt);case E:var Rn=Mt._init;return Mt=Rn(Mt._payload),Ct(ht,at,bt,Mt,Jt)}if(L(Mt)||j(Mt))return ht=ht.get(bt)||null,It(at,ht,Mt,Jt,null);if(typeof Mt.then=="function")return Ct(ht,at,bt,rw(Mt),Jt);if(Mt.$$typeof===_)return Ct(ht,at,bt,xn(at,Mt),Jt);iw(at,Mt)}return null}function hn(ht,at,bt,Mt){for(var Jt=null,Rn=null,nn=at,ln=at=0,Di=null;nn!==null&&ln<bt.length;ln++){nn.index>ln?(Di=nn,nn=null):Di=nn.sibling;var Xn=St(ht,nn,bt[ln],Mt);if(Xn===null){nn===null&&(nn=Di);break}y&&nn&&Xn.alternate===null&&T(ht,nn),at=$(Xn,at,ln),Rn===null?Jt=Xn:Rn.sibling=Xn,Rn=Xn,nn=Di}if(ln===bt.length)return I(ht,nn),dn&&kr(ht,ln),Jt;if(nn===null){for(;ln<bt.length;ln++)nn=At(ht,bt[ln],Mt),nn!==null&&(at=$(nn,at,ln),Rn===null?Jt=nn:Rn.sibling=nn,Rn=nn);return dn&&kr(ht,ln),Jt}for(nn=D(nn);ln<bt.length;ln++)Di=Ct(nn,ht,ln,bt[ln],Mt),Di!==null&&(y&&Di.alternate!==null&&nn.delete(Di.key===null?ln:Di.key),at=$(Di,at,ln),Rn===null?Jt=Di:Rn.sibling=Di,Rn=Di);return y&&nn.forEach(function(Yd){return T(ht,Yd)}),dn&&kr(ht,ln),Jt}function un(ht,at,bt,Mt){if(bt==null)throw Error(t(151));for(var Jt=null,Rn=null,nn=at,ln=at=0,Di=null,Xn=bt.next();nn!==null&&!Xn.done;ln++,Xn=bt.next()){nn.index>ln?(Di=nn,nn=null):Di=nn.sibling;var Yd=St(ht,nn,Xn.value,Mt);if(Yd===null){nn===null&&(nn=Di);break}y&&nn&&Yd.alternate===null&&T(ht,nn),at=$(Yd,at,ln),Rn===null?Jt=Yd:Rn.sibling=Yd,Rn=Yd,nn=Di}if(Xn.done)return I(ht,nn),dn&&kr(ht,ln),Jt;if(nn===null){for(;!Xn.done;ln++,Xn=bt.next())Xn=At(ht,Xn.value,Mt),Xn!==null&&(at=$(Xn,at,ln),Rn===null?Jt=Xn:Rn.sibling=Xn,Rn=Xn);return dn&&kr(ht,ln),Jt}for(nn=D(nn);!Xn.done;ln++,Xn=bt.next())Xn=Ct(nn,ht,ln,Xn.value,Mt),Xn!==null&&(y&&Xn.alternate!==null&&nn.delete(Xn.key===null?ln:Xn.key),at=$(Xn,at,ln),Rn===null?Jt=Xn:Rn.sibling=Xn,Rn=Xn);return y&&nn.forEach(function(rle){return T(ht,rle)}),dn&&kr(ht,ln),Jt}function pr(ht,at,bt,Mt){if(typeof bt=="object"&&bt!==null&&bt.type===C&&bt.key===null&&(bt=bt.props.children),typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case f:e:{for(var Jt=bt.key;at!==null;){if(at.key===Jt){if(Jt=bt.type,Jt===C){if(at.tag===7){I(ht,at.sibling),Mt=z(at,bt.props.children),Mt.return=ht,ht=Mt;break e}}else if(at.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===E&&v2(Jt)===at.type){I(ht,at.sibling),Mt=z(at,bt.props),Kb(Mt,bt),Mt.return=ht,ht=Mt;break e}I(ht,at);break}else T(ht,at);at=at.sibling}bt.type===C?(Mt=_e(bt.props.children,ht.mode,Mt,bt.key),Mt.return=ht,ht=Mt):(Mt=it(bt.type,bt.key,bt.props,null,ht.mode,Mt),Kb(Mt,bt),Mt.return=ht,ht=Mt)}return ye(ht);case b:e:{for(Jt=bt.key;at!==null;){if(at.key===Jt)if(at.tag===4&&at.stateNode.containerInfo===bt.containerInfo&&at.stateNode.implementation===bt.implementation){I(ht,at.sibling),Mt=z(at,bt.children||[]),Mt.return=ht,ht=Mt;break e}else{I(ht,at);break}else T(ht,at);at=at.sibling}Mt=Ae(bt,ht.mode,Mt),Mt.return=ht,ht=Mt}return ye(ht);case E:return Jt=bt._init,bt=Jt(bt._payload),pr(ht,at,bt,Mt)}if(L(bt))return hn(ht,at,bt,Mt);if(j(bt)){if(Jt=j(bt),typeof Jt!="function")throw Error(t(150));return bt=Jt.call(bt),un(ht,at,bt,Mt)}if(typeof bt.then=="function")return pr(ht,at,rw(bt),Mt);if(bt.$$typeof===_)return pr(ht,at,xn(ht,bt),Mt);iw(ht,bt)}return typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint"?(bt=""+bt,at!==null&&at.tag===6?(I(ht,at.sibling),Mt=z(at,bt),Mt.return=ht,ht=Mt):(I(ht,at),Mt=Ie(bt,ht.mode,Mt),Mt.return=ht,ht=Mt),ye(ht)):I(ht,at)}return function(ht,at,bt,Mt){try{Hb=0;var Jt=pr(ht,at,bt,Mt);return Py=null,Jt}catch(nn){if(nn===Db||nn===$T)throw nn;var Rn=ve(29,nn,null,ht.mode);return Rn.lanes=Mt,Rn.return=ht,Rn}finally{}}}var Ey=S2(!0),C2=S2(!1),La=fe(null),rc=null;function kd(y){var T=y.alternate;pe(Ti,Ti.current&1),pe(La,y),rc===null&&(T===null||_y.current!==null||T.memoizedState!==null)&&(rc=y)}function _2(y){if(y.tag===22){if(pe(Ti,Ti.current),pe(La,y),rc===null){var T=y.alternate;T!==null&&T.memoizedState!==null&&(rc=y)}}else xd()}function xd(){pe(Ti,Ti.current),pe(La,La.current)}function $c(y){oe(La),rc===y&&(rc=null),oe(Ti)}var Ti=fe(0);function sw(y){for(var T=y;T!==null;){if(T.tag===13){var I=T.memoizedState;if(I!==null&&(I=I.dehydrated,I===null||I.data==="$?"||WR(I)))return T}else if(T.tag===19&&T.memoizedProps.revealOrder!==void 0){if((T.flags&128)!==0)return T}else if(T.child!==null){T.child.return=T,T=T.child;continue}if(T===y)break;for(;T.sibling===null;){if(T.return===null||T.return===y)return null;T=T.return}T.sibling.return=T.return,T=T.sibling}return null}function sR(y,T,I,D){T=y.memoizedState,I=I(D,T),I=I==null?T:d({},T,I),y.memoizedState=I,y.lanes===0&&(y.updateQueue.baseState=I)}var aR={enqueueSetState:function(y,T,I){y=y._reactInternals;var D=ua(),z=Nd(D);z.payload=T,I!=null&&(z.callback=I),T=Ad(y,z,D),T!==null&&(da(T,y,D),xb(T,y,D))},enqueueReplaceState:function(y,T,I){y=y._reactInternals;var D=ua(),z=Nd(D);z.tag=1,z.payload=T,I!=null&&(z.callback=I),T=Ad(y,z,D),T!==null&&(da(T,y,D),xb(T,y,D))},enqueueForceUpdate:function(y,T){y=y._reactInternals;var I=ua(),D=Nd(I);D.tag=2,T!=null&&(D.callback=T),T=Ad(y,D,I),T!==null&&(da(T,y,I),xb(T,y,I))}};function T2(y,T,I,D,z,$,ye){return y=y.stateNode,typeof y.shouldComponentUpdate=="function"?y.shouldComponentUpdate(D,$,ye):T.prototype&&T.prototype.isPureReactComponent?!Id(I,D)||!Id(z,$):!0}function w2(y,T,I,D){y=T.state,typeof T.componentWillReceiveProps=="function"&&T.componentWillReceiveProps(I,D),typeof T.UNSAFE_componentWillReceiveProps=="function"&&T.UNSAFE_componentWillReceiveProps(I,D),T.state!==y&&aR.enqueueReplaceState(T,T.state,null)}function Ul(y,T){var I=T;if("ref"in T){I={};for(var D in T)D!=="ref"&&(I[D]=T[D])}if(y=y.defaultProps){I===T&&(I=d({},I));for(var z in y)I[z]===void 0&&(I[z]=y[z])}return I}var aw=typeof reportError=="function"?reportError:function(y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var T=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof y=="object"&&y!==null&&typeof y.message=="string"?String(y.message):String(y),error:y});if(!window.dispatchEvent(T))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",y);return}console.error(y)};function O2(y){aw(y)}function P2(y){console.error(y)}function E2(y){aw(y)}function ow(y,T){try{var I=y.onUncaughtError;I(T.value,{componentStack:T.stack})}catch(D){setTimeout(function(){throw D})}}function I2(y,T,I){try{var D=y.onCaughtError;D(I.value,{componentStack:I.stack,errorBoundary:T.tag===1?T.stateNode:null})}catch(z){setTimeout(function(){throw z})}}function oR(y,T,I){return I=Nd(I),I.tag=3,I.payload={element:null},I.callback=function(){ow(y,T)},I}function R2(y){return y=Nd(y),y.tag=3,y}function F2(y,T,I,D){var z=I.type.getDerivedStateFromError;if(typeof z=="function"){var $=D.value;y.payload=function(){return z($)},y.callback=function(){I2(T,I,D)}}var ye=I.stateNode;ye!==null&&typeof ye.componentDidCatch=="function"&&(y.callback=function(){I2(T,I,D),typeof z!="function"&&(Vd===null?Vd=new Set([this]):Vd.add(this));var De=D.stack;this.componentDidCatch(D.value,{componentStack:De!==null?De:""})})}function rde(y,T,I,D,z){if(I.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){if(T=I.alternate,T!==null&&xl(T,I,z,!0),I=La.current,I!==null){switch(I.tag){case 13:return rc===null?jR():I.alternate===null&&ti===0&&(ti=3),I.flags&=-257,I.flags|=65536,I.lanes=z,D===kI?I.flags|=16384:(T=I.updateQueue,T===null?I.updateQueue=new Set([D]):T.add(D),NR(y,D,z)),!1;case 22:return I.flags|=65536,D===kI?I.flags|=16384:(T=I.updateQueue,T===null?(T={transitions:null,markerInstances:null,retryQueue:new Set([D])},I.updateQueue=T):(I=T.retryQueue,I===null?T.retryQueue=new Set([D]):I.add(D)),NR(y,D,z)),!1}throw Error(t(435,I.tag))}return NR(y,D,z),jR(),!1}if(dn)return T=La.current,T!==null?((T.flags&65536)===0&&(T.flags|=256),T.flags|=65536,T.lanes=z,D!==Tn&&(y=Error(t(422),{cause:D}),ia(U(y,I)))):(D!==Tn&&(T=Error(t(423),{cause:D}),ia(U(T,I))),y=y.current.alternate,y.flags|=65536,z&=-z,y.lanes|=z,D=U(D,I),z=oR(y.stateNode,D,z),LI(y,z),ti!==4&&(ti=2)),!1;var $=Error(t(520),{cause:D});if($=U($,I),Xb===null?Xb=[$]:Xb.push($),ti!==4&&(ti=2),T===null)return!0;D=U(D,I),I=T;do{switch(I.tag){case 3:return I.flags|=65536,y=z&-z,I.lanes|=y,y=oR(I.stateNode,D,y),LI(I,y),!1;case 1:if(T=I.type,$=I.stateNode,(I.flags&128)===0&&(typeof T.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(Vd===null||!Vd.has($))))return I.flags|=65536,z&=-z,I.lanes|=z,z=R2(z),F2(z,y,I,D),LI(I,z),!1}I=I.return}while(I!==null);return!1}var j2=Error(t(461)),Ni=!1;function Hi(y,T,I,D){T.child=y===null?C2(T,null,I,D):Ey(T,y.child,I,D)}function M2(y,T,I,D,z){I=I.render;var $=T.ref;if("ref"in D){var ye={};for(var De in D)De!=="ref"&&(ye[De]=D[De])}else ye=D;return Gn(T),D=HI(y,T,I,ye,$,z),De=KI(),y!==null&&!Ni?($I(y,T,z),Gc(y,T,z)):(dn&&De&&ir(T),T.flags|=1,Hi(y,T,D,z),T.child)}function N2(y,T,I,D,z){if(y===null){var $=I.type;return typeof $=="function"&&!ze($)&&$.defaultProps===void 0&&I.compare===null?(T.tag=15,T.type=$,A2(y,T,$,D,z)):(y=it(I.type,null,D,T,T.mode,z),y.ref=T.ref,y.return=T,T.child=y)}if($=y.child,!pR(y,z)){var ye=$.memoizedProps;if(I=I.compare,I=I!==null?I:Id,I(ye,D)&&y.ref===T.ref)return Gc(y,T,z)}return T.flags|=1,y=tt($,D),y.ref=T.ref,y.return=T,T.child=y}function A2(y,T,I,D,z){if(y!==null){var $=y.memoizedProps;if(Id($,D)&&y.ref===T.ref)if(Ni=!1,T.pendingProps=D=$,pR(y,z))(y.flags&131072)!==0&&(Ni=!0);else return T.lanes=y.lanes,Gc(y,T,z)}return cR(y,T,I,D,z)}function D2(y,T,I){var D=T.pendingProps,z=D.children,$=y!==null?y.memoizedState:null;if(D.mode==="hidden"){if((T.flags&128)!==0){if(D=$!==null?$.baseLanes|I:I,y!==null){for(z=T.child=y.child,$=0;z!==null;)$=$|z.lanes|z.childLanes,z=z.sibling;T.childLanes=$&~D}else T.childLanes=0,T.child=null;return k2(y,T,D,I)}if((I&536870912)!==0)T.memoizedState={baseLanes:0,cachePool:null},y!==null&&KT(T,$!==null?$.cachePool:null),$!==null?AL(T,$):UI(),_2(T);else return T.lanes=T.childLanes=536870912,k2(y,T,$!==null?$.baseLanes|I:I,I)}else $!==null?(KT(T,$.cachePool),AL(T,$),xd(),T.memoizedState=null):(y!==null&&KT(T,null),UI(),xd());return Hi(y,T,z,I),T.child}function k2(y,T,I,D){var z=DI();return z=z===null?null:{parent:_i._currentValue,pool:z},T.memoizedState={baseLanes:I,cachePool:z},y!==null&&KT(T,null),UI(),_2(T),y!==null&&xl(y,T,D,!0),null}function cw(y,T){var I=T.ref;if(I===null)y!==null&&y.ref!==null&&(T.flags|=4194816);else{if(typeof I!="function"&&typeof I!="object")throw Error(t(284));(y===null||y.ref!==I)&&(T.flags|=4194816)}}function cR(y,T,I,D,z){return Gn(T),I=HI(y,T,I,D,void 0,z),D=KI(),y!==null&&!Ni?($I(y,T,z),Gc(y,T,z)):(dn&&D&&ir(T),T.flags|=1,Hi(y,T,I,z),T.child)}function x2(y,T,I,D,z,$){return Gn(T),T.updateQueue=null,I=kL(T,D,I,z),DL(y),D=KI(),y!==null&&!Ni?($I(y,T,$),Gc(y,T,$)):(dn&&D&&ir(T),T.flags|=1,Hi(y,T,I,$),T.child)}function q2(y,T,I,D,z){if(Gn(T),T.stateNode===null){var $=ie,ye=I.contextType;typeof ye=="object"&&ye!==null&&($=vr(ye)),$=new I(D,$),T.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,$.updater=aR,T.stateNode=$,$._reactInternals=T,$=T.stateNode,$.props=D,$.state=T.memoizedState,$.refs={},xI(T),ye=I.contextType,$.context=typeof ye=="object"&&ye!==null?vr(ye):ie,$.state=T.memoizedState,ye=I.getDerivedStateFromProps,typeof ye=="function"&&(sR(T,I,ye,D),$.state=T.memoizedState),typeof I.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(ye=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),ye!==$.state&&aR.enqueueReplaceState($,$.state,null),Lb(T,D,$,z),qb(),$.state=T.memoizedState),typeof $.componentDidMount=="function"&&(T.flags|=4194308),D=!0}else if(y===null){$=T.stateNode;var De=T.memoizedProps,et=Ul(I,De);$.props=et;var vt=$.context,It=I.contextType;ye=ie,typeof It=="object"&&It!==null&&(ye=vr(It));var At=I.getDerivedStateFromProps;It=typeof At=="function"||typeof $.getSnapshotBeforeUpdate=="function",De=T.pendingProps!==De,It||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(De||vt!==ye)&&w2(T,$,D,ye),Md=!1;var St=T.memoizedState;$.state=St,Lb(T,D,$,z),qb(),vt=T.memoizedState,De||St!==vt||Md?(typeof At=="function"&&(sR(T,I,At,D),vt=T.memoizedState),(et=Md||T2(T,I,et,D,St,vt,ye))?(It||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(T.flags|=4194308)):(typeof $.componentDidMount=="function"&&(T.flags|=4194308),T.memoizedProps=D,T.memoizedState=vt),$.props=D,$.state=vt,$.context=ye,D=et):(typeof $.componentDidMount=="function"&&(T.flags|=4194308),D=!1)}else{$=T.stateNode,qI(y,T),ye=T.memoizedProps,It=Ul(I,ye),$.props=It,At=T.pendingProps,St=$.context,vt=I.contextType,et=ie,typeof vt=="object"&&vt!==null&&(et=vr(vt)),De=I.getDerivedStateFromProps,(vt=typeof De=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(ye!==At||St!==et)&&w2(T,$,D,et),Md=!1,St=T.memoizedState,$.state=St,Lb(T,D,$,z),qb();var Ct=T.memoizedState;ye!==At||St!==Ct||Md||y!==null&&y.dependencies!==null&&ql(y.dependencies)?(typeof De=="function"&&(sR(T,I,De,D),Ct=T.memoizedState),(It=Md||T2(T,I,It,D,St,Ct,et)||y!==null&&y.dependencies!==null&&ql(y.dependencies))?(vt||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(D,Ct,et),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(D,Ct,et)),typeof $.componentDidUpdate=="function"&&(T.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(T.flags|=1024)):(typeof $.componentDidUpdate!="function"||ye===y.memoizedProps&&St===y.memoizedState||(T.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||ye===y.memoizedProps&&St===y.memoizedState||(T.flags|=1024),T.memoizedProps=D,T.memoizedState=Ct),$.props=D,$.state=Ct,$.context=et,D=It):(typeof $.componentDidUpdate!="function"||ye===y.memoizedProps&&St===y.memoizedState||(T.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||ye===y.memoizedProps&&St===y.memoizedState||(T.flags|=1024),D=!1)}return $=D,cw(y,T),D=(T.flags&128)!==0,$||D?($=T.stateNode,I=D&&typeof I.getDerivedStateFromError!="function"?null:$.render(),T.flags|=1,y!==null&&D?(T.child=Ey(T,y.child,null,z),T.child=Ey(T,null,I,z)):Hi(y,T,I,z),T.memoizedState=$.state,y=T.child):y=Gc(y,T,z),y}function L2(y,T,I,D){return fr(),T.flags|=256,Hi(y,T,I,D),T.child}var uR={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function dR(y){return{baseLanes:y,cachePool:PL()}}function lR(y,T,I){return y=y!==null?y.childLanes&~I:0,T&&(y|=Ba),y}function B2(y,T,I){var D=T.pendingProps,z=!1,$=(T.flags&128)!==0,ye;if((ye=$)||(ye=y!==null&&y.memoizedState===null?!1:(Ti.current&2)!==0),ye&&(z=!0,T.flags&=-129),ye=(T.flags&32)!==0,T.flags&=-33,y===null){if(dn){if(z?kd(T):xd(),dn){var De=_n,et;if(et=De){e:{for(et=De,De=Ir;et.nodeType!==8;){if(!De){De=null;break e}if(et=eo(et.nextSibling),et===null){De=null;break e}}De=et}De!==null?(T.memoizedState={dehydrated:De,treeContext:yt!==null?{id:Pt,overflow:jt}:null,retryLane:536870912,hydrationErrors:null},et=ve(18,null,null,0),et.stateNode=De,et.return=T,T.child=et,Vn=T,_n=null,et=!0):et=!1}et||Fn(T)}if(De=T.memoizedState,De!==null&&(De=De.dehydrated,De!==null))return WR(De)?T.lanes=32:T.lanes=536870912,null;$c(T)}return De=D.children,D=D.fallback,z?(xd(),z=T.mode,De=uw({mode:"hidden",children:De},z),D=_e(D,z,I,null),De.return=T,D.return=T,De.sibling=D,T.child=De,z=T.child,z.memoizedState=dR(I),z.childLanes=lR(y,ye,I),T.memoizedState=uR,D):(kd(T),fR(T,De))}if(et=y.memoizedState,et!==null&&(De=et.dehydrated,De!==null)){if($)T.flags&256?(kd(T),T.flags&=-257,T=hR(y,T,I)):T.memoizedState!==null?(xd(),T.child=y.child,T.flags|=128,T=null):(xd(),z=D.fallback,De=T.mode,D=uw({mode:"visible",children:D.children},De),z=_e(z,De,I,null),z.flags|=2,D.return=T,z.return=T,D.sibling=z,T.child=D,Ey(T,y.child,null,I),D=T.child,D.memoizedState=dR(I),D.childLanes=lR(y,ye,I),T.memoizedState=uR,T=z);else if(kd(T),WR(De)){if(ye=De.nextSibling&&De.nextSibling.dataset,ye)var vt=ye.dgst;ye=vt,D=Error(t(419)),D.stack="",D.digest=ye,ia({value:D,source:null,stack:null}),T=hR(y,T,I)}else if(Ni||xl(y,T,I,!1),ye=(I&y.childLanes)!==0,Ni||ye){if(ye=jr,ye!==null&&(D=I&-I,D=(D&42)!==0?1:er(D),D=(D&(ye.suspendedLanes|I))!==0?0:D,D!==0&&D!==et.retryLane))throw et.retryLane=D,W(y,D),da(ye,y,D),j2;De.data==="$?"||jR(),T=hR(y,T,I)}else De.data==="$?"?(T.flags|=192,T.child=y.child,T=null):(y=et.treeContext,_n=eo(De.nextSibling),Vn=T,dn=!0,ra=null,Ir=!1,y!==null&&(Tt[st++]=Pt,Tt[st++]=jt,Tt[st++]=yt,Pt=y.id,jt=y.overflow,yt=T),T=fR(T,D.children),T.flags|=4096);return T}return z?(xd(),z=D.fallback,De=T.mode,et=y.child,vt=et.sibling,D=tt(et,{mode:"hidden",children:D.children}),D.subtreeFlags=et.subtreeFlags&65011712,vt!==null?z=tt(vt,z):(z=_e(z,De,I,null),z.flags|=2),z.return=T,D.return=T,D.sibling=z,T.child=D,D=z,z=T.child,De=y.child.memoizedState,De===null?De=dR(I):(et=De.cachePool,et!==null?(vt=_i._currentValue,et=et.parent!==vt?{parent:vt,pool:vt}:et):et=PL(),De={baseLanes:De.baseLanes|I,cachePool:et}),z.memoizedState=De,z.childLanes=lR(y,ye,I),T.memoizedState=uR,D):(kd(T),I=y.child,y=I.sibling,I=tt(I,{mode:"visible",children:D.children}),I.return=T,I.sibling=null,y!==null&&(ye=T.deletions,ye===null?(T.deletions=[y],T.flags|=16):ye.push(y)),T.child=I,T.memoizedState=null,I)}function fR(y,T){return T=uw({mode:"visible",children:T},y.mode),T.return=y,y.child=T}function uw(y,T){return y=ve(22,y,null,T),y.lanes=0,y.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},y}function hR(y,T,I){return Ey(T,y.child,null,I),y=fR(T,T.pendingProps.children),y.flags|=2,T.memoizedState=null,y}function U2(y,T,I){y.lanes|=T;var D=y.alternate;D!==null&&(D.lanes|=T),zs(y.return,T,I)}function mR(y,T,I,D,z){var $=y.memoizedState;$===null?y.memoizedState={isBackwards:T,rendering:null,renderingStartTime:0,last:D,tail:I,tailMode:z}:($.isBackwards=T,$.rendering=null,$.renderingStartTime=0,$.last=D,$.tail=I,$.tailMode=z)}function z2(y,T,I){var D=T.pendingProps,z=D.revealOrder,$=D.tail;if(Hi(y,T,D.children,I),D=Ti.current,(D&2)!==0)D=D&1|2,T.flags|=128;else{if(y!==null&&(y.flags&128)!==0)e:for(y=T.child;y!==null;){if(y.tag===13)y.memoizedState!==null&&U2(y,I,T);else if(y.tag===19)U2(y,I,T);else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===T)break e;for(;y.sibling===null;){if(y.return===null||y.return===T)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}D&=1}switch(pe(Ti,D),z){case"forwards":for(I=T.child,z=null;I!==null;)y=I.alternate,y!==null&&sw(y)===null&&(z=I),I=I.sibling;I=z,I===null?(z=T.child,T.child=null):(z=I.sibling,I.sibling=null),mR(T,!1,z,I,$);break;case"backwards":for(I=null,z=T.child,T.child=null;z!==null;){if(y=z.alternate,y!==null&&sw(y)===null){T.child=z;break}y=z.sibling,z.sibling=I,I=z,z=y}mR(T,!0,I,null,$);break;case"together":mR(T,!1,null,null,void 0);break;default:T.memoizedState=null}return T.child}function Gc(y,T,I){if(y!==null&&(T.dependencies=y.dependencies),zd|=T.lanes,(I&T.childLanes)===0)if(y!==null){if(xl(y,T,I,!1),(I&T.childLanes)===0)return null}else return null;if(y!==null&&T.child!==y.child)throw Error(t(153));if(T.child!==null){for(y=T.child,I=tt(y,y.pendingProps),T.child=I,I.return=T;y.sibling!==null;)y=y.sibling,I=I.sibling=tt(y,y.pendingProps),I.return=T;I.sibling=null}return T.child}function pR(y,T){return(y.lanes&T)!==0?!0:(y=y.dependencies,!!(y!==null&&ql(y)))}function ide(y,T,I){switch(T.tag){case 3:We(T,T.stateNode.containerInfo),Vi(T,_i,y.memoizedState.cache),fr();break;case 27:case 5:lt(T);break;case 4:We(T,T.stateNode.containerInfo);break;case 10:Vi(T,T.type,T.memoizedProps.value);break;case 13:var D=T.memoizedState;if(D!==null)return D.dehydrated!==null?(kd(T),T.flags|=128,null):(I&T.child.childLanes)!==0?B2(y,T,I):(kd(T),y=Gc(y,T,I),y!==null?y.sibling:null);kd(T);break;case 19:var z=(y.flags&128)!==0;if(D=(I&T.childLanes)!==0,D||(xl(y,T,I,!1),D=(I&T.childLanes)!==0),z){if(D)return z2(y,T,I);T.flags|=128}if(z=T.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),pe(Ti,Ti.current),D)break;return null;case 22:case 23:return T.lanes=0,D2(y,T,I);case 24:Vi(T,_i,y.memoizedState.cache)}return Gc(y,T,I)}function V2(y,T,I){if(y!==null)if(y.memoizedProps!==T.pendingProps)Ni=!0;else{if(!pR(y,I)&&(T.flags&128)===0)return Ni=!1,ide(y,T,I);Ni=(y.flags&131072)!==0}else Ni=!1,dn&&(T.flags&1048576)!==0&&Er(T,ct,T.index);switch(T.lanes=0,T.tag){case 16:e:{y=T.pendingProps;var D=T.elementType,z=D._init;if(D=z(D._payload),T.type=D,typeof D=="function")ze(D)?(y=Ul(D,y),T.tag=1,T=q2(null,T,D,y,I)):(T.tag=0,T=cR(null,T,D,y,I));else{if(D!=null){if(z=D.$$typeof,z===S){T.tag=11,T=M2(null,T,D,y,I);break e}else if(z===O){T.tag=14,T=N2(null,T,D,y,I);break e}}throw T=x(D)||D,Error(t(306,T,""))}}return T;case 0:return cR(y,T,T.type,T.pendingProps,I);case 1:return D=T.type,z=Ul(D,T.pendingProps),q2(y,T,D,z,I);case 3:e:{if(We(T,T.stateNode.containerInfo),y===null)throw Error(t(387));D=T.pendingProps;var $=T.memoizedState;z=$.element,qI(y,T),Lb(T,D,null,I);var ye=T.memoizedState;if(D=ye.cache,Vi(T,_i,D),D!==$.cache&&Ya(T,[_i],I,!0),qb(),D=ye.element,$.isDehydrated)if($={element:D,isDehydrated:!1,cache:ye.cache},T.updateQueue.baseState=$,T.memoizedState=$,T.flags&256){T=L2(y,T,D,I);break e}else if(D!==z){z=U(Error(t(424)),T),ia(z),T=L2(y,T,D,I);break e}else{switch(y=T.stateNode.containerInfo,y.nodeType){case 9:y=y.body;break;default:y=y.nodeName==="HTML"?y.ownerDocument.body:y}for(_n=eo(y.firstChild),Vn=T,dn=!0,ra=null,Ir=!0,I=C2(T,null,D,I),T.child=I;I;)I.flags=I.flags&-3|4096,I=I.sibling}else{if(fr(),D===z){T=Gc(y,T,I);break e}Hi(y,T,D,I)}T=T.child}return T;case 26:return cw(y,T),y===null?(I=GB(T.type,null,T.pendingProps,null))?T.memoizedState=I:dn||(I=T.type,y=T.pendingProps,D=Tw(Ce.current).createElement(I),D[wr]=T,D[qn]=y,$i(D,I,y),$n(D),T.stateNode=D):T.memoizedState=GB(T.type,y.memoizedProps,T.pendingProps,y.memoizedState),null;case 27:return lt(T),y===null&&dn&&(D=T.stateNode=HB(T.type,T.pendingProps,Ce.current),Vn=T,Ir=!0,z=_n,$d(T.type)?(JR=z,_n=eo(D.firstChild)):_n=z),Hi(y,T,T.pendingProps.children,I),cw(y,T),y===null&&(T.flags|=4194304),T.child;case 5:return y===null&&dn&&((z=D=_n)&&(D=Mde(D,T.type,T.pendingProps,Ir),D!==null?(T.stateNode=D,Vn=T,_n=eo(D.firstChild),Ir=!1,z=!0):z=!1),z||Fn(T)),lt(T),z=T.type,$=T.pendingProps,ye=y!==null?y.memoizedProps:null,D=$.children,KR(z,$)?D=null:ye!==null&&KR(z,ye)&&(T.flags|=32),T.memoizedState!==null&&(z=HI(y,T,Que,null,null,I),ov._currentValue=z),cw(y,T),Hi(y,T,D,I),T.child;case 6:return y===null&&dn&&((y=I=_n)&&(I=Nde(I,T.pendingProps,Ir),I!==null?(T.stateNode=I,Vn=T,_n=null,y=!0):y=!1),y||Fn(T)),null;case 13:return B2(y,T,I);case 4:return We(T,T.stateNode.containerInfo),D=T.pendingProps,y===null?T.child=Ey(T,null,D,I):Hi(y,T,D,I),T.child;case 11:return M2(y,T,T.type,T.pendingProps,I);case 7:return Hi(y,T,T.pendingProps,I),T.child;case 8:return Hi(y,T,T.pendingProps.children,I),T.child;case 12:return Hi(y,T,T.pendingProps.children,I),T.child;case 10:return D=T.pendingProps,Vi(T,T.type,D.value),Hi(y,T,D.children,I),T.child;case 9:return z=T.type._context,D=T.pendingProps.children,Gn(T),z=vr(z),D=D(z),T.flags|=1,Hi(y,T,D,I),T.child;case 14:return N2(y,T,T.type,T.pendingProps,I);case 15:return A2(y,T,T.type,T.pendingProps,I);case 19:return z2(y,T,I);case 31:return D=T.pendingProps,I=T.mode,D={mode:D.mode,children:D.children},y===null?(I=uw(D,I),I.ref=T.ref,T.child=I,I.return=T,T=I):(I=tt(y.child,D),I.ref=T.ref,T.child=I,I.return=T,T=I),T;case 22:return D2(y,T,I);case 24:return Gn(T),D=vr(_i),y===null?(z=DI(),z===null&&(z=jr,$=NI(),z.pooledCache=$,$.refCount++,$!==null&&(z.pooledCacheLanes|=I),z=$),T.memoizedState={parent:D,cache:z},xI(T),Vi(T,_i,z)):((y.lanes&I)!==0&&(qI(y,T),Lb(T,null,null,I),qb()),z=y.memoizedState,$=T.memoizedState,z.parent!==D?(z={parent:D,cache:D},T.memoizedState=z,T.lanes===0&&(T.memoizedState=T.updateQueue.baseState=z),Vi(T,_i,D)):(D=$.cache,Vi(T,_i,D),D!==z.cache&&Ya(T,[_i],I,!0))),Hi(y,T,T.pendingProps.children,I),T.child;case 29:throw T.pendingProps}throw Error(t(156,T.tag))}function Wc(y){y.flags|=4}function H2(y,T){if(T.type!=="stylesheet"||(T.state.loading&4)!==0)y.flags&=-16777217;else if(y.flags|=16777216,!XB(T)){if(T=La.current,T!==null&&((Hn&4194048)===Hn?rc!==null:(Hn&62914560)!==Hn&&(Hn&536870912)===0||T!==rc))throw kb=kI,EL;y.flags|=8192}}function dw(y,T){T!==null&&(y.flags|=4),y.flags&16384&&(T=y.tag!==22?zt():536870912,y.lanes|=T,jy|=T)}function $b(y,T){if(!dn)switch(y.tailMode){case"hidden":T=y.tail;for(var I=null;T!==null;)T.alternate!==null&&(I=T),T=T.sibling;I===null?y.tail=null:I.sibling=null;break;case"collapsed":I=y.tail;for(var D=null;I!==null;)I.alternate!==null&&(D=I),I=I.sibling;D===null?T||y.tail===null?y.tail=null:y.tail.sibling=null:D.sibling=null}}function Vr(y){var T=y.alternate!==null&&y.alternate.child===y.child,I=0,D=0;if(T)for(var z=y.child;z!==null;)I|=z.lanes|z.childLanes,D|=z.subtreeFlags&65011712,D|=z.flags&65011712,z.return=y,z=z.sibling;else for(z=y.child;z!==null;)I|=z.lanes|z.childLanes,D|=z.subtreeFlags,D|=z.flags,z.return=y,z=z.sibling;return y.subtreeFlags|=D,y.childLanes=I,T}function sde(y,T,I){var D=T.pendingProps;switch(xr(T),T.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vr(T),null;case 1:return Vr(T),null;case 3:return I=T.stateNode,D=null,y!==null&&(D=y.memoizedState.cache),T.memoizedState.cache!==D&&(T.flags|=2048),Qa(_i),Ze(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(y===null||y.child===null)&&(fi(T)?Wc(T):y===null||y.memoizedState.isDehydrated&&(T.flags&256)===0||(T.flags|=1024,jd())),Vr(T),null;case 26:return I=T.memoizedState,y===null?(Wc(T),I!==null?(Vr(T),H2(T,I)):(Vr(T),T.flags&=-16777217)):I?I!==y.memoizedState?(Wc(T),Vr(T),H2(T,I)):(Vr(T),T.flags&=-16777217):(y.memoizedProps!==D&&Wc(T),Vr(T),T.flags&=-16777217),null;case 27:ut(T),I=Ce.current;var z=T.type;if(y!==null&&T.stateNode!=null)y.memoizedProps!==D&&Wc(T);else{if(!D){if(T.stateNode===null)throw Error(t(166));return Vr(T),null}y=de.current,fi(T)?Rr(T):(y=HB(z,D,I),T.stateNode=y,Wc(T))}return Vr(T),null;case 5:if(ut(T),I=T.type,y!==null&&T.stateNode!=null)y.memoizedProps!==D&&Wc(T);else{if(!D){if(T.stateNode===null)throw Error(t(166));return Vr(T),null}if(y=de.current,fi(T))Rr(T);else{switch(z=Tw(Ce.current),y){case 1:y=z.createElementNS("http://www.w3.org/2000/svg",I);break;case 2:y=z.createElementNS("http://www.w3.org/1998/Math/MathML",I);break;default:switch(I){case"svg":y=z.createElementNS("http://www.w3.org/2000/svg",I);break;case"math":y=z.createElementNS("http://www.w3.org/1998/Math/MathML",I);break;case"script":y=z.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof D.is=="string"?z.createElement("select",{is:D.is}):z.createElement("select"),D.multiple?y.multiple=!0:D.size&&(y.size=D.size);break;default:y=typeof D.is=="string"?z.createElement(I,{is:D.is}):z.createElement(I)}}y[wr]=T,y[qn]=D;e:for(z=T.child;z!==null;){if(z.tag===5||z.tag===6)y.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===T)break e;for(;z.sibling===null;){if(z.return===null||z.return===T)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}T.stateNode=y;e:switch($i(y,I,D),I){case"button":case"input":case"select":case"textarea":y=!!D.autoFocus;break e;case"img":y=!0;break e;default:y=!1}y&&Wc(T)}}return Vr(T),T.flags&=-16777217,null;case 6:if(y&&T.stateNode!=null)y.memoizedProps!==D&&Wc(T);else{if(typeof D!="string"&&T.stateNode===null)throw Error(t(166));if(y=Ce.current,fi(T)){if(y=T.stateNode,I=T.memoizedProps,D=null,z=Vn,z!==null)switch(z.tag){case 27:case 5:D=z.memoizedProps}y[wr]=T,y=!!(y.nodeValue===I||D!==null&&D.suppressHydrationWarning===!0||xB(y.nodeValue,I)),y||Fn(T)}else y=Tw(y).createTextNode(D),y[wr]=T,T.stateNode=y}return Vr(T),null;case 13:if(D=T.memoizedState,y===null||y.memoizedState!==null&&y.memoizedState.dehydrated!==null){if(z=fi(T),D!==null&&D.dehydrated!==null){if(y===null){if(!z)throw Error(t(318));if(z=T.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(t(317));z[wr]=T}else fr(),(T.flags&128)===0&&(T.memoizedState=null),T.flags|=4;Vr(T),z=!1}else z=jd(),y!==null&&y.memoizedState!==null&&(y.memoizedState.hydrationErrors=z),z=!0;if(!z)return T.flags&256?($c(T),T):($c(T),null)}if($c(T),(T.flags&128)!==0)return T.lanes=I,T;if(I=D!==null,y=y!==null&&y.memoizedState!==null,I){D=T.child,z=null,D.alternate!==null&&D.alternate.memoizedState!==null&&D.alternate.memoizedState.cachePool!==null&&(z=D.alternate.memoizedState.cachePool.pool);var $=null;D.memoizedState!==null&&D.memoizedState.cachePool!==null&&($=D.memoizedState.cachePool.pool),$!==z&&(D.flags|=2048)}return I!==y&&I&&(T.child.flags|=8192),dw(T,T.updateQueue),Vr(T),null;case 4:return Ze(),y===null&&BR(T.stateNode.containerInfo),Vr(T),null;case 10:return Qa(T.type),Vr(T),null;case 19:if(oe(Ti),z=T.memoizedState,z===null)return Vr(T),null;if(D=(T.flags&128)!==0,$=z.rendering,$===null)if(D)$b(z,!1);else{if(ti!==0||y!==null&&(y.flags&128)!==0)for(y=T.child;y!==null;){if($=sw(y),$!==null){for(T.flags|=128,$b(z,!1),y=$.updateQueue,T.updateQueue=y,dw(T,y),T.subtreeFlags=0,y=I,I=T.child;I!==null;)nt(I,y),I=I.sibling;return pe(Ti,Ti.current&1|2),T.child}y=y.sibling}z.tail!==null&&Qe()>hw&&(T.flags|=128,D=!0,$b(z,!1),T.lanes=4194304)}else{if(!D)if(y=sw($),y!==null){if(T.flags|=128,D=!0,y=y.updateQueue,T.updateQueue=y,dw(T,y),$b(z,!0),z.tail===null&&z.tailMode==="hidden"&&!$.alternate&&!dn)return Vr(T),null}else 2*Qe()-z.renderingStartTime>hw&&I!==536870912&&(T.flags|=128,D=!0,$b(z,!1),T.lanes=4194304);z.isBackwards?($.sibling=T.child,T.child=$):(y=z.last,y!==null?y.sibling=$:T.child=$,z.last=$)}return z.tail!==null?(T=z.tail,z.rendering=T,z.tail=T.sibling,z.renderingStartTime=Qe(),T.sibling=null,y=Ti.current,pe(Ti,D?y&1|2:y&1),T):(Vr(T),null);case 22:case 23:return $c(T),zI(),D=T.memoizedState!==null,y!==null?y.memoizedState!==null!==D&&(T.flags|=8192):D&&(T.flags|=8192),D?(I&536870912)!==0&&(T.flags&128)===0&&(Vr(T),T.subtreeFlags&6&&(T.flags|=8192)):Vr(T),I=T.updateQueue,I!==null&&dw(T,I.retryQueue),I=null,y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(I=y.memoizedState.cachePool.pool),D=null,T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(D=T.memoizedState.cachePool.pool),D!==I&&(T.flags|=2048),y!==null&&oe(Ll),null;case 24:return I=null,y!==null&&(I=y.memoizedState.cache),T.memoizedState.cache!==I&&(T.flags|=2048),Qa(_i),Vr(T),null;case 25:return null;case 30:return null}throw Error(t(156,T.tag))}function ade(y,T){switch(xr(T),T.tag){case 1:return y=T.flags,y&65536?(T.flags=y&-65537|128,T):null;case 3:return Qa(_i),Ze(),y=T.flags,(y&65536)!==0&&(y&128)===0?(T.flags=y&-65537|128,T):null;case 26:case 27:case 5:return ut(T),null;case 13:if($c(T),y=T.memoizedState,y!==null&&y.dehydrated!==null){if(T.alternate===null)throw Error(t(340));fr()}return y=T.flags,y&65536?(T.flags=y&-65537|128,T):null;case 19:return oe(Ti),null;case 4:return Ze(),null;case 10:return Qa(T.type),null;case 22:case 23:return $c(T),zI(),y!==null&&oe(Ll),y=T.flags,y&65536?(T.flags=y&-65537|128,T):null;case 24:return Qa(_i),null;case 25:return null;default:return null}}function K2(y,T){switch(xr(T),T.tag){case 3:Qa(_i),Ze();break;case 26:case 27:case 5:ut(T);break;case 4:Ze();break;case 13:$c(T);break;case 19:oe(Ti);break;case 10:Qa(T.type);break;case 22:case 23:$c(T),zI(),y!==null&&oe(Ll);break;case 24:Qa(_i)}}function Gb(y,T){try{var I=T.updateQueue,D=I!==null?I.lastEffect:null;if(D!==null){var z=D.next;I=z;do{if((I.tag&y)===y){D=void 0;var $=I.create,ye=I.inst;D=$(),ye.destroy=D}I=I.next}while(I!==z)}}catch(De){Sr(T,T.return,De)}}function qd(y,T,I){try{var D=T.updateQueue,z=D!==null?D.lastEffect:null;if(z!==null){var $=z.next;D=$;do{if((D.tag&y)===y){var ye=D.inst,De=ye.destroy;if(De!==void 0){ye.destroy=void 0,z=T;var et=I,vt=De;try{vt()}catch(It){Sr(z,et,It)}}}D=D.next}while(D!==$)}}catch(It){Sr(T,T.return,It)}}function $2(y){var T=y.updateQueue;if(T!==null){var I=y.stateNode;try{NL(T,I)}catch(D){Sr(y,y.return,D)}}}function G2(y,T,I){I.props=Ul(y.type,y.memoizedProps),I.state=y.memoizedState;try{I.componentWillUnmount()}catch(D){Sr(y,T,D)}}function Wb(y,T){try{var I=y.ref;if(I!==null){switch(y.tag){case 26:case 27:case 5:var D=y.stateNode;break;case 30:D=y.stateNode;break;default:D=y.stateNode}typeof I=="function"?y.refCleanup=I(D):I.current=D}}catch(z){Sr(y,T,z)}}function ic(y,T){var I=y.ref,D=y.refCleanup;if(I!==null)if(typeof D=="function")try{D()}catch(z){Sr(y,T,z)}finally{y.refCleanup=null,y=y.alternate,y!=null&&(y.refCleanup=null)}else if(typeof I=="function")try{I(null)}catch(z){Sr(y,T,z)}else I.current=null}function W2(y){var T=y.type,I=y.memoizedProps,D=y.stateNode;try{e:switch(T){case"button":case"input":case"select":case"textarea":I.autoFocus&&D.focus();break e;case"img":I.src?D.src=I.src:I.srcSet&&(D.srcset=I.srcSet)}}catch(z){Sr(y,y.return,z)}}function gR(y,T,I){try{var D=y.stateNode;Ede(D,y.type,I,T),D[qn]=T}catch(z){Sr(y,y.return,z)}}function J2(y){return y.tag===5||y.tag===3||y.tag===26||y.tag===27&&$d(y.type)||y.tag===4}function yR(y){e:for(;;){for(;y.sibling===null;){if(y.return===null||J2(y.return))return null;y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&y.tag!==18;){if(y.tag===27&&$d(y.type)||y.flags&2||y.child===null||y.tag===4)continue e;y.child.return=y,y=y.child}if(!(y.flags&2))return y.stateNode}}function bR(y,T,I){var D=y.tag;if(D===5||D===6)y=y.stateNode,T?(I.nodeType===9?I.body:I.nodeName==="HTML"?I.ownerDocument.body:I).insertBefore(y,T):(T=I.nodeType===9?I.body:I.nodeName==="HTML"?I.ownerDocument.body:I,T.appendChild(y),I=I._reactRootContainer,I!=null||T.onclick!==null||(T.onclick=_w));else if(D!==4&&(D===27&&$d(y.type)&&(I=y.stateNode,T=null),y=y.child,y!==null))for(bR(y,T,I),y=y.sibling;y!==null;)bR(y,T,I),y=y.sibling}function lw(y,T,I){var D=y.tag;if(D===5||D===6)y=y.stateNode,T?I.insertBefore(y,T):I.appendChild(y);else if(D!==4&&(D===27&&$d(y.type)&&(I=y.stateNode),y=y.child,y!==null))for(lw(y,T,I),y=y.sibling;y!==null;)lw(y,T,I),y=y.sibling}function Q2(y){var T=y.stateNode,I=y.memoizedProps;try{for(var D=y.type,z=T.attributes;z.length;)T.removeAttributeNode(z[0]);$i(T,D,I),T[wr]=y,T[qn]=I}catch($){Sr(y,y.return,$)}}var Jc=!1,ci=!1,vR=!1,Y2=typeof WeakSet=="function"?WeakSet:Set,Ai=null;function ode(y,T){if(y=y.containerInfo,VR=Rw,y=VT(y),yy(y)){if("selectionStart"in y)var I={start:y.selectionStart,end:y.selectionEnd};else e:{I=(I=y.ownerDocument)&&I.defaultView||window;var D=I.getSelection&&I.getSelection();if(D&&D.rangeCount!==0){I=D.anchorNode;var z=D.anchorOffset,$=D.focusNode;D=D.focusOffset;try{I.nodeType,$.nodeType}catch{I=null;break e}var ye=0,De=-1,et=-1,vt=0,It=0,At=y,St=null;t:for(;;){for(var Ct;At!==I||z!==0&&At.nodeType!==3||(De=ye+z),At!==$||D!==0&&At.nodeType!==3||(et=ye+D),At.nodeType===3&&(ye+=At.nodeValue.length),(Ct=At.firstChild)!==null;)St=At,At=Ct;for(;;){if(At===y)break t;if(St===I&&++vt===z&&(De=ye),St===$&&++It===D&&(et=ye),(Ct=At.nextSibling)!==null)break;At=St,St=At.parentNode}At=Ct}I=De===-1||et===-1?null:{start:De,end:et}}else I=null}I=I||{start:0,end:0}}else I=null;for(HR={focusedElem:y,selectionRange:I},Rw=!1,Ai=T;Ai!==null;)if(T=Ai,y=T.child,(T.subtreeFlags&1024)!==0&&y!==null)y.return=T,Ai=y;else for(;Ai!==null;){switch(T=Ai,$=T.alternate,y=T.flags,T.tag){case 0:break;case 11:case 15:break;case 1:if((y&1024)!==0&&$!==null){y=void 0,I=T,z=$.memoizedProps,$=$.memoizedState,D=I.stateNode;try{var hn=Ul(I.type,z,I.elementType===I.type);y=D.getSnapshotBeforeUpdate(hn,$),D.__reactInternalSnapshotBeforeUpdate=y}catch(un){Sr(I,I.return,un)}}break;case 3:if((y&1024)!==0){if(y=T.stateNode.containerInfo,I=y.nodeType,I===9)GR(y);else if(I===1)switch(y.nodeName){case"HEAD":case"HTML":case"BODY":GR(y);break;default:y.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((y&1024)!==0)throw Error(t(163))}if(y=T.sibling,y!==null){y.return=T.return,Ai=y;break}Ai=T.return}}function X2(y,T,I){var D=I.flags;switch(I.tag){case 0:case 11:case 15:Ld(y,I),D&4&&Gb(5,I);break;case 1:if(Ld(y,I),D&4)if(y=I.stateNode,T===null)try{y.componentDidMount()}catch(ye){Sr(I,I.return,ye)}else{var z=Ul(I.type,T.memoizedProps);T=T.memoizedState;try{y.componentDidUpdate(z,T,y.__reactInternalSnapshotBeforeUpdate)}catch(ye){Sr(I,I.return,ye)}}D&64&&$2(I),D&512&&Wb(I,I.return);break;case 3:if(Ld(y,I),D&64&&(y=I.updateQueue,y!==null)){if(T=null,I.child!==null)switch(I.child.tag){case 27:case 5:T=I.child.stateNode;break;case 1:T=I.child.stateNode}try{NL(y,T)}catch(ye){Sr(I,I.return,ye)}}break;case 27:T===null&&D&4&&Q2(I);case 26:case 5:Ld(y,I),T===null&&D&4&&W2(I),D&512&&Wb(I,I.return);break;case 12:Ld(y,I);break;case 13:Ld(y,I),D&4&&tB(y,I),D&64&&(y=I.memoizedState,y!==null&&(y=y.dehydrated,y!==null&&(I=gde.bind(null,I),Ade(y,I))));break;case 22:if(D=I.memoizedState!==null||Jc,!D){T=T!==null&&T.memoizedState!==null||ci,z=Jc;var $=ci;Jc=D,(ci=T)&&!$?Bd(y,I,(I.subtreeFlags&8772)!==0):Ld(y,I),Jc=z,ci=$}break;case 30:break;default:Ld(y,I)}}function Z2(y){var T=y.alternate;T!==null&&(y.alternate=null,Z2(T)),y.child=null,y.deletions=null,y.sibling=null,y.tag===5&&(T=y.stateNode,T!==null&&bs(T)),y.stateNode=null,y.return=null,y.dependencies=null,y.memoizedProps=null,y.memoizedState=null,y.pendingProps=null,y.stateNode=null,y.updateQueue=null}var qr=null,Hs=!1;function Qc(y,T,I){for(I=I.child;I!==null;)eB(y,T,I),I=I.sibling}function eB(y,T,I){if(He&&typeof He.onCommitFiberUnmount=="function")try{He.onCommitFiberUnmount(Oe,I)}catch{}switch(I.tag){case 26:ci||ic(I,T),Qc(y,T,I),I.memoizedState?I.memoizedState.count--:I.stateNode&&(I=I.stateNode,I.parentNode.removeChild(I));break;case 27:ci||ic(I,T);var D=qr,z=Hs;$d(I.type)&&(qr=I.stateNode,Hs=!1),Qc(y,T,I),rv(I.stateNode),qr=D,Hs=z;break;case 5:ci||ic(I,T);case 6:if(D=qr,z=Hs,qr=null,Qc(y,T,I),qr=D,Hs=z,qr!==null)if(Hs)try{(qr.nodeType===9?qr.body:qr.nodeName==="HTML"?qr.ownerDocument.body:qr).removeChild(I.stateNode)}catch($){Sr(I,T,$)}else try{qr.removeChild(I.stateNode)}catch($){Sr(I,T,$)}break;case 18:qr!==null&&(Hs?(y=qr,zB(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,I.stateNode),lv(y)):zB(qr,I.stateNode));break;case 4:D=qr,z=Hs,qr=I.stateNode.containerInfo,Hs=!0,Qc(y,T,I),qr=D,Hs=z;break;case 0:case 11:case 14:case 15:ci||qd(2,I,T),ci||qd(4,I,T),Qc(y,T,I);break;case 1:ci||(ic(I,T),D=I.stateNode,typeof D.componentWillUnmount=="function"&&G2(I,T,D)),Qc(y,T,I);break;case 21:Qc(y,T,I);break;case 22:ci=(D=ci)||I.memoizedState!==null,Qc(y,T,I),ci=D;break;default:Qc(y,T,I)}}function tB(y,T){if(T.memoizedState===null&&(y=T.alternate,y!==null&&(y=y.memoizedState,y!==null&&(y=y.dehydrated,y!==null))))try{lv(y)}catch(I){Sr(T,T.return,I)}}function cde(y){switch(y.tag){case 13:case 19:var T=y.stateNode;return T===null&&(T=y.stateNode=new Y2),T;case 22:return y=y.stateNode,T=y._retryCache,T===null&&(T=y._retryCache=new Y2),T;default:throw Error(t(435,y.tag))}}function SR(y,T){var I=cde(y);T.forEach(function(D){var z=yde.bind(null,y,D);I.has(D)||(I.add(D),D.then(z,z))})}function aa(y,T){var I=T.deletions;if(I!==null)for(var D=0;D<I.length;D++){var z=I[D],$=y,ye=T,De=ye;e:for(;De!==null;){switch(De.tag){case 27:if($d(De.type)){qr=De.stateNode,Hs=!1;break e}break;case 5:qr=De.stateNode,Hs=!1;break e;case 3:case 4:qr=De.stateNode.containerInfo,Hs=!0;break e}De=De.return}if(qr===null)throw Error(t(160));eB($,ye,z),qr=null,Hs=!1,$=z.alternate,$!==null&&($.return=null),z.return=null}if(T.subtreeFlags&13878)for(T=T.child;T!==null;)nB(T,y),T=T.sibling}var Za=null;function nB(y,T){var I=y.alternate,D=y.flags;switch(y.tag){case 0:case 11:case 14:case 15:aa(T,y),oa(y),D&4&&(qd(3,y,y.return),Gb(3,y),qd(5,y,y.return));break;case 1:aa(T,y),oa(y),D&512&&(ci||I===null||ic(I,I.return)),D&64&&Jc&&(y=y.updateQueue,y!==null&&(D=y.callbacks,D!==null&&(I=y.shared.hiddenCallbacks,y.shared.hiddenCallbacks=I===null?D:I.concat(D))));break;case 26:var z=Za;if(aa(T,y),oa(y),D&512&&(ci||I===null||ic(I,I.return)),D&4){var $=I!==null?I.memoizedState:null;if(D=y.memoizedState,I===null)if(D===null)if(y.stateNode===null){e:{D=y.type,I=y.memoizedProps,z=z.ownerDocument||z;t:switch(D){case"title":$=z.getElementsByTagName("title")[0],(!$||$[os]||$[wr]||$.namespaceURI==="http://www.w3.org/2000/svg"||$.hasAttribute("itemprop"))&&($=z.createElement(D),z.head.insertBefore($,z.querySelector("head > title"))),$i($,D,I),$[wr]=y,$n($),D=$;break e;case"link":var ye=QB("link","href",z).get(D+(I.href||""));if(ye){for(var De=0;De<ye.length;De++)if($=ye[De],$.getAttribute("href")===(I.href==null||I.href===""?null:I.href)&&$.getAttribute("rel")===(I.rel==null?null:I.rel)&&$.getAttribute("title")===(I.title==null?null:I.title)&&$.getAttribute("crossorigin")===(I.crossOrigin==null?null:I.crossOrigin)){ye.splice(De,1);break t}}$=z.createElement(D),$i($,D,I),z.head.appendChild($);break;case"meta":if(ye=QB("meta","content",z).get(D+(I.content||""))){for(De=0;De<ye.length;De++)if($=ye[De],$.getAttribute("content")===(I.content==null?null:""+I.content)&&$.getAttribute("name")===(I.name==null?null:I.name)&&$.getAttribute("property")===(I.property==null?null:I.property)&&$.getAttribute("http-equiv")===(I.httpEquiv==null?null:I.httpEquiv)&&$.getAttribute("charset")===(I.charSet==null?null:I.charSet)){ye.splice(De,1);break t}}$=z.createElement(D),$i($,D,I),z.head.appendChild($);break;default:throw Error(t(468,D))}$[wr]=y,$n($),D=$}y.stateNode=D}else YB(z,y.type,y.stateNode);else y.stateNode=JB(z,D,y.memoizedProps);else $!==D?($===null?I.stateNode!==null&&(I=I.stateNode,I.parentNode.removeChild(I)):$.count--,D===null?YB(z,y.type,y.stateNode):JB(z,D,y.memoizedProps)):D===null&&y.stateNode!==null&&gR(y,y.memoizedProps,I.memoizedProps)}break;case 27:aa(T,y),oa(y),D&512&&(ci||I===null||ic(I,I.return)),I!==null&&D&4&&gR(y,y.memoizedProps,I.memoizedProps);break;case 5:if(aa(T,y),oa(y),D&512&&(ci||I===null||ic(I,I.return)),y.flags&32){z=y.stateNode;try{qa(z,"")}catch(Ct){Sr(y,y.return,Ct)}}D&4&&y.stateNode!=null&&(z=y.memoizedProps,gR(y,z,I!==null?I.memoizedProps:z)),D&1024&&(vR=!0);break;case 6:if(aa(T,y),oa(y),D&4){if(y.stateNode===null)throw Error(t(162));D=y.memoizedProps,I=y.stateNode;try{I.nodeValue=D}catch(Ct){Sr(y,y.return,Ct)}}break;case 3:if(Pw=null,z=Za,Za=ww(T.containerInfo),aa(T,y),Za=z,oa(y),D&4&&I!==null&&I.memoizedState.isDehydrated)try{lv(T.containerInfo)}catch(Ct){Sr(y,y.return,Ct)}vR&&(vR=!1,rB(y));break;case 4:D=Za,Za=ww(y.stateNode.containerInfo),aa(T,y),oa(y),Za=D;break;case 12:aa(T,y),oa(y);break;case 13:aa(T,y),oa(y),y.child.flags&8192&&y.memoizedState!==null!=(I!==null&&I.memoizedState!==null)&&(PR=Qe()),D&4&&(D=y.updateQueue,D!==null&&(y.updateQueue=null,SR(y,D)));break;case 22:z=y.memoizedState!==null;var et=I!==null&&I.memoizedState!==null,vt=Jc,It=ci;if(Jc=vt||z,ci=It||et,aa(T,y),ci=It,Jc=vt,oa(y),D&8192)e:for(T=y.stateNode,T._visibility=z?T._visibility&-2:T._visibility|1,z&&(I===null||et||Jc||ci||zl(y)),I=null,T=y;;){if(T.tag===5||T.tag===26){if(I===null){et=I=T;try{if($=et.stateNode,z)ye=$.style,typeof ye.setProperty=="function"?ye.setProperty("display","none","important"):ye.display="none";else{De=et.stateNode;var At=et.memoizedProps.style,St=At!=null&&At.hasOwnProperty("display")?At.display:null;De.style.display=St==null||typeof St=="boolean"?"":(""+St).trim()}}catch(Ct){Sr(et,et.return,Ct)}}}else if(T.tag===6){if(I===null){et=T;try{et.stateNode.nodeValue=z?"":et.memoizedProps}catch(Ct){Sr(et,et.return,Ct)}}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===y)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===y)break e;for(;T.sibling===null;){if(T.return===null||T.return===y)break e;I===T&&(I=null),T=T.return}I===T&&(I=null),T.sibling.return=T.return,T=T.sibling}D&4&&(D=y.updateQueue,D!==null&&(I=D.retryQueue,I!==null&&(D.retryQueue=null,SR(y,I))));break;case 19:aa(T,y),oa(y),D&4&&(D=y.updateQueue,D!==null&&(y.updateQueue=null,SR(y,D)));break;case 30:break;case 21:break;default:aa(T,y),oa(y)}}function oa(y){var T=y.flags;if(T&2){try{for(var I,D=y.return;D!==null;){if(J2(D)){I=D;break}D=D.return}if(I==null)throw Error(t(160));switch(I.tag){case 27:var z=I.stateNode,$=yR(y);lw(y,$,z);break;case 5:var ye=I.stateNode;I.flags&32&&(qa(ye,""),I.flags&=-33);var De=yR(y);lw(y,De,ye);break;case 3:case 4:var et=I.stateNode.containerInfo,vt=yR(y);bR(y,vt,et);break;default:throw Error(t(161))}}catch(It){Sr(y,y.return,It)}y.flags&=-3}T&4096&&(y.flags&=-4097)}function rB(y){if(y.subtreeFlags&1024)for(y=y.child;y!==null;){var T=y;rB(T),T.tag===5&&T.flags&1024&&T.stateNode.reset(),y=y.sibling}}function Ld(y,T){if(T.subtreeFlags&8772)for(T=T.child;T!==null;)X2(y,T.alternate,T),T=T.sibling}function zl(y){for(y=y.child;y!==null;){var T=y;switch(T.tag){case 0:case 11:case 14:case 15:qd(4,T,T.return),zl(T);break;case 1:ic(T,T.return);var I=T.stateNode;typeof I.componentWillUnmount=="function"&&G2(T,T.return,I),zl(T);break;case 27:rv(T.stateNode);case 26:case 5:ic(T,T.return),zl(T);break;case 22:T.memoizedState===null&&zl(T);break;case 30:zl(T);break;default:zl(T)}y=y.sibling}}function Bd(y,T,I){for(I=I&&(T.subtreeFlags&8772)!==0,T=T.child;T!==null;){var D=T.alternate,z=y,$=T,ye=$.flags;switch($.tag){case 0:case 11:case 15:Bd(z,$,I),Gb(4,$);break;case 1:if(Bd(z,$,I),D=$,z=D.stateNode,typeof z.componentDidMount=="function")try{z.componentDidMount()}catch(vt){Sr(D,D.return,vt)}if(D=$,z=D.updateQueue,z!==null){var De=D.stateNode;try{var et=z.shared.hiddenCallbacks;if(et!==null)for(z.shared.hiddenCallbacks=null,z=0;z<et.length;z++)ML(et[z],De)}catch(vt){Sr(D,D.return,vt)}}I&&ye&64&&$2($),Wb($,$.return);break;case 27:Q2($);case 26:case 5:Bd(z,$,I),I&&D===null&&ye&4&&W2($),Wb($,$.return);break;case 12:Bd(z,$,I);break;case 13:Bd(z,$,I),I&&ye&4&&tB(z,$);break;case 22:$.memoizedState===null&&Bd(z,$,I),Wb($,$.return);break;case 30:break;default:Bd(z,$,I)}T=T.sibling}}function CR(y,T){var I=null;y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(I=y.memoizedState.cachePool.pool),y=null,T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(y=T.memoizedState.cachePool.pool),y!==I&&(y!=null&&y.refCount++,I!=null&&Nb(I))}function _R(y,T){y=null,T.alternate!==null&&(y=T.alternate.memoizedState.cache),T=T.memoizedState.cache,T!==y&&(T.refCount++,y!=null&&Nb(y))}function sc(y,T,I,D){if(T.subtreeFlags&10256)for(T=T.child;T!==null;)iB(y,T,I,D),T=T.sibling}function iB(y,T,I,D){var z=T.flags;switch(T.tag){case 0:case 11:case 15:sc(y,T,I,D),z&2048&&Gb(9,T);break;case 1:sc(y,T,I,D);break;case 3:sc(y,T,I,D),z&2048&&(y=null,T.alternate!==null&&(y=T.alternate.memoizedState.cache),T=T.memoizedState.cache,T!==y&&(T.refCount++,y!=null&&Nb(y)));break;case 12:if(z&2048){sc(y,T,I,D),y=T.stateNode;try{var $=T.memoizedProps,ye=$.id,De=$.onPostCommit;typeof De=="function"&&De(ye,T.alternate===null?"mount":"update",y.passiveEffectDuration,-0)}catch(et){Sr(T,T.return,et)}}else sc(y,T,I,D);break;case 13:sc(y,T,I,D);break;case 23:break;case 22:$=T.stateNode,ye=T.alternate,T.memoizedState!==null?$._visibility&2?sc(y,T,I,D):Jb(y,T):$._visibility&2?sc(y,T,I,D):($._visibility|=2,Iy(y,T,I,D,(T.subtreeFlags&10256)!==0)),z&2048&&CR(ye,T);break;case 24:sc(y,T,I,D),z&2048&&_R(T.alternate,T);break;default:sc(y,T,I,D)}}function Iy(y,T,I,D,z){for(z=z&&(T.subtreeFlags&10256)!==0,T=T.child;T!==null;){var $=y,ye=T,De=I,et=D,vt=ye.flags;switch(ye.tag){case 0:case 11:case 15:Iy($,ye,De,et,z),Gb(8,ye);break;case 23:break;case 22:var It=ye.stateNode;ye.memoizedState!==null?It._visibility&2?Iy($,ye,De,et,z):Jb($,ye):(It._visibility|=2,Iy($,ye,De,et,z)),z&&vt&2048&&CR(ye.alternate,ye);break;case 24:Iy($,ye,De,et,z),z&&vt&2048&&_R(ye.alternate,ye);break;default:Iy($,ye,De,et,z)}T=T.sibling}}function Jb(y,T){if(T.subtreeFlags&10256)for(T=T.child;T!==null;){var I=y,D=T,z=D.flags;switch(D.tag){case 22:Jb(I,D),z&2048&&CR(D.alternate,D);break;case 24:Jb(I,D),z&2048&&_R(D.alternate,D);break;default:Jb(I,D)}T=T.sibling}}var Qb=8192;function Ry(y){if(y.subtreeFlags&Qb)for(y=y.child;y!==null;)sB(y),y=y.sibling}function sB(y){switch(y.tag){case 26:Ry(y),y.flags&Qb&&y.memoizedState!==null&&Gde(Za,y.memoizedState,y.memoizedProps);break;case 5:Ry(y);break;case 3:case 4:var T=Za;Za=ww(y.stateNode.containerInfo),Ry(y),Za=T;break;case 22:y.memoizedState===null&&(T=y.alternate,T!==null&&T.memoizedState!==null?(T=Qb,Qb=16777216,Ry(y),Qb=T):Ry(y));break;default:Ry(y)}}function aB(y){var T=y.alternate;if(T!==null&&(y=T.child,y!==null)){T.child=null;do T=y.sibling,y.sibling=null,y=T;while(y!==null)}}function Yb(y){var T=y.deletions;if((y.flags&16)!==0){if(T!==null)for(var I=0;I<T.length;I++){var D=T[I];Ai=D,cB(D,y)}aB(y)}if(y.subtreeFlags&10256)for(y=y.child;y!==null;)oB(y),y=y.sibling}function oB(y){switch(y.tag){case 0:case 11:case 15:Yb(y),y.flags&2048&&qd(9,y,y.return);break;case 3:Yb(y);break;case 12:Yb(y);break;case 22:var T=y.stateNode;y.memoizedState!==null&&T._visibility&2&&(y.return===null||y.return.tag!==13)?(T._visibility&=-3,fw(y)):Yb(y);break;default:Yb(y)}}function fw(y){var T=y.deletions;if((y.flags&16)!==0){if(T!==null)for(var I=0;I<T.length;I++){var D=T[I];Ai=D,cB(D,y)}aB(y)}for(y=y.child;y!==null;){switch(T=y,T.tag){case 0:case 11:case 15:qd(8,T,T.return),fw(T);break;case 22:I=T.stateNode,I._visibility&2&&(I._visibility&=-3,fw(T));break;default:fw(T)}y=y.sibling}}function cB(y,T){for(;Ai!==null;){var I=Ai;switch(I.tag){case 0:case 11:case 15:qd(8,I,T);break;case 23:case 22:if(I.memoizedState!==null&&I.memoizedState.cachePool!==null){var D=I.memoizedState.cachePool.pool;D!=null&&D.refCount++}break;case 24:Nb(I.memoizedState.cache)}if(D=I.child,D!==null)D.return=I,Ai=D;else e:for(I=y;Ai!==null;){D=Ai;var z=D.sibling,$=D.return;if(Z2(D),D===I){Ai=null;break e}if(z!==null){z.return=$,Ai=z;break e}Ai=$}}}var ude={getCacheForType:function(y){var T=vr(_i),I=T.data.get(y);return I===void 0&&(I=y(),T.data.set(y,I)),I}},dde=typeof WeakMap=="function"?WeakMap:Map,or=0,jr=null,jn=null,Hn=0,cr=0,ca=null,Ud=!1,Fy=!1,TR=!1,Yc=0,ti=0,zd=0,Vl=0,wR=0,Ba=0,jy=0,Xb=null,Ks=null,OR=!1,PR=0,hw=1/0,mw=null,Vd=null,Ki=0,Hd=null,My=null,Ny=0,ER=0,IR=null,uB=null,Zb=0,RR=null;function ua(){if((or&2)!==0&&Hn!==0)return Hn&-Hn;if(V.T!==null){var y=Sy;return y!==0?y:kR()}return Qs()}function dB(){Ba===0&&(Ba=(Hn&536870912)===0||dn?xt():536870912);var y=La.current;return y!==null&&(y.flags|=32),Ba}function da(y,T,I){(y===jr&&(cr===2||cr===9)||y.cancelPendingCommit!==null)&&(Ay(y,0),Kd(y,Hn,Ba,!1)),je(y,I),((or&2)===0||y!==jr)&&(y===jr&&((or&2)===0&&(Vl|=I),ti===4&&Kd(y,Hn,Ba,!1)),ac(y))}function lB(y,T,I){if((or&6)!==0)throw Error(t(327));var D=!I&&(T&124)===0&&(T&y.expiredLanes)===0||Rt(y,T),z=D?hde(y,T):MR(y,T,!0),$=D;do{if(z===0){Fy&&!D&&Kd(y,T,0,!1);break}else{if(I=y.current.alternate,$&&!lde(I)){z=MR(y,T,!1),$=!1;continue}if(z===2){if($=T,y.errorRecoveryDisabledLanes&$)var ye=0;else ye=y.pendingLanes&-536870913,ye=ye!==0?ye:ye&536870912?536870912:0;if(ye!==0){T=ye;e:{var De=y;z=Xb;var et=De.current.memoizedState.isDehydrated;if(et&&(Ay(De,ye).flags|=256),ye=MR(De,ye,!1),ye!==2){if(TR&&!et){De.errorRecoveryDisabledLanes|=$,Vl|=$,z=4;break e}$=Ks,Ks=z,$!==null&&(Ks===null?Ks=$:Ks.push.apply(Ks,$))}z=ye}if($=!1,z!==2)continue}}if(z===1){Ay(y,0),Kd(y,T,0,!0);break}e:{switch(D=y,$=z,$){case 0:case 1:throw Error(t(345));case 4:if((T&4194048)!==T)break;case 6:Kd(D,T,Ba,!Ud);break e;case 2:Ks=null;break;case 3:case 5:break;default:throw Error(t(329))}if((T&62914560)===T&&(z=PR+300-Qe(),10<z)){if(Kd(D,T,Ba,!Ud),ke(D,0,!0)!==0)break e;D.timeoutHandle=BB(fB.bind(null,D,I,Ks,mw,OR,T,Ba,Vl,jy,Ud,$,2,-0,0),z);break e}fB(D,I,Ks,mw,OR,T,Ba,Vl,jy,Ud,$,0,-0,0)}}break}while(!0);ac(y)}function fB(y,T,I,D,z,$,ye,De,et,vt,It,At,St,Ct){if(y.timeoutHandle=-1,At=T.subtreeFlags,(At&8192||(At&16785408)===16785408)&&(av={stylesheets:null,count:0,unsuspend:$de},sB(T),At=Wde(),At!==null)){y.cancelPendingCommit=At(vB.bind(null,y,T,$,I,D,z,ye,De,et,It,1,St,Ct)),Kd(y,$,ye,!vt);return}vB(y,T,$,I,D,z,ye,De,et)}function lde(y){for(var T=y;;){var I=T.tag;if((I===0||I===11||I===15)&&T.flags&16384&&(I=T.updateQueue,I!==null&&(I=I.stores,I!==null)))for(var D=0;D<I.length;D++){var z=I[D],$=z.getSnapshot;z=z.value;try{if(!ws($(),z))return!1}catch{return!1}}if(I=T.child,T.subtreeFlags&16384&&I!==null)I.return=T,T=I;else{if(T===y)break;for(;T.sibling===null;){if(T.return===null||T.return===y)return!0;T=T.return}T.sibling.return=T.return,T=T.sibling}}return!0}function Kd(y,T,I,D){T&=~wR,T&=~Vl,y.suspendedLanes|=T,y.pingedLanes&=~T,D&&(y.warmLanes|=T),D=y.expirationTimes;for(var z=T;0<z;){var $=31-Ve(z),ye=1<<$;D[$]=-1,z&=~ye}I!==0&&Kt(y,I,T)}function pw(){return(or&6)===0?(ev(0),!1):!0}function FR(){if(jn!==null){if(cr===0)var y=jn.return;else y=jn,sa=hi=null,GI(y),Py=null,Hb=0,y=jn;for(;y!==null;)K2(y.alternate,y),y=y.return;jn=null}}function Ay(y,T){var I=y.timeoutHandle;I!==-1&&(y.timeoutHandle=-1,Rde(I)),I=y.cancelPendingCommit,I!==null&&(y.cancelPendingCommit=null,I()),FR(),jr=y,jn=I=tt(y.current,null),Hn=T,cr=0,ca=null,Ud=!1,Fy=Rt(y,T),TR=!1,jy=Ba=wR=Vl=zd=ti=0,Ks=Xb=null,OR=!1,(T&8)!==0&&(T|=T&32);var D=y.entangledLanes;if(D!==0)for(y=y.entanglements,D&=T;0<D;){var z=31-Ve(D),$=1<<z;T|=y[z],D&=~$}return Yc=T,te(),I}function hB(y,T){Pn=null,V.H=nw,T===Db||T===$T?(T=FL(),cr=3):T===EL?(T=FL(),cr=4):cr=T===j2?8:T!==null&&typeof T=="object"&&typeof T.then=="function"?6:1,ca=T,jn===null&&(ti=1,ow(y,U(T,y.current)))}function mB(){var y=V.H;return V.H=nw,y===null?nw:y}function pB(){var y=V.A;return V.A=ude,y}function jR(){ti=4,Ud||(Hn&4194048)!==Hn&&La.current!==null||(Fy=!0),(zd&134217727)===0&&(Vl&134217727)===0||jr===null||Kd(jr,Hn,Ba,!1)}function MR(y,T,I){var D=or;or|=2;var z=mB(),$=pB();(jr!==y||Hn!==T)&&(mw=null,Ay(y,T)),T=!1;var ye=ti;e:do try{if(cr!==0&&jn!==null){var De=jn,et=ca;switch(cr){case 8:FR(),ye=6;break e;case 3:case 2:case 9:case 6:La.current===null&&(T=!0);var vt=cr;if(cr=0,ca=null,Dy(y,De,et,vt),I&&Fy){ye=0;break e}break;default:vt=cr,cr=0,ca=null,Dy(y,De,et,vt)}}fde(),ye=ti;break}catch(It){hB(y,It)}while(!0);return T&&y.shellSuspendCounter++,sa=hi=null,or=D,V.H=z,V.A=$,jn===null&&(jr=null,Hn=0,te()),ye}function fde(){for(;jn!==null;)gB(jn)}function hde(y,T){var I=or;or|=2;var D=mB(),z=pB();jr!==y||Hn!==T?(mw=null,hw=Qe()+500,Ay(y,T)):Fy=Rt(y,T);e:do try{if(cr!==0&&jn!==null){T=jn;var $=ca;t:switch(cr){case 1:cr=0,ca=null,Dy(y,T,$,1);break;case 2:case 9:if(IL($)){cr=0,ca=null,yB(T);break}T=function(){cr!==2&&cr!==9||jr!==y||(cr=7),ac(y)},$.then(T,T);break e;case 3:cr=7;break e;case 4:cr=5;break e;case 7:IL($)?(cr=0,ca=null,yB(T)):(cr=0,ca=null,Dy(y,T,$,7));break;case 5:var ye=null;switch(jn.tag){case 26:ye=jn.memoizedState;case 5:case 27:var De=jn;if(!ye||XB(ye)){cr=0,ca=null;var et=De.sibling;if(et!==null)jn=et;else{var vt=De.return;vt!==null?(jn=vt,gw(vt)):jn=null}break t}}cr=0,ca=null,Dy(y,T,$,5);break;case 6:cr=0,ca=null,Dy(y,T,$,6);break;case 8:FR(),ti=6;break e;default:throw Error(t(462))}}mde();break}catch(It){hB(y,It)}while(!0);return sa=hi=null,V.H=D,V.A=z,or=I,jn!==null?0:(jr=null,Hn=0,te(),ti)}function mde(){for(;jn!==null&&!Ge();)gB(jn)}function gB(y){var T=V2(y.alternate,y,Yc);y.memoizedProps=y.pendingProps,T===null?gw(y):jn=T}function yB(y){var T=y,I=T.alternate;switch(T.tag){case 15:case 0:T=x2(I,T,T.pendingProps,T.type,void 0,Hn);break;case 11:T=x2(I,T,T.pendingProps,T.type.render,T.ref,Hn);break;case 5:GI(T);default:K2(I,T),T=jn=nt(T,Yc),T=V2(I,T,Yc)}y.memoizedProps=y.pendingProps,T===null?gw(y):jn=T}function Dy(y,T,I,D){sa=hi=null,GI(T),Py=null,Hb=0;var z=T.return;try{if(rde(y,z,T,I,Hn)){ti=1,ow(y,U(I,y.current)),jn=null;return}}catch($){if(z!==null)throw jn=z,$;ti=1,ow(y,U(I,y.current)),jn=null;return}T.flags&32768?(dn||D===1?y=!0:Fy||(Hn&536870912)!==0?y=!1:(Ud=y=!0,(D===2||D===9||D===3||D===6)&&(D=La.current,D!==null&&D.tag===13&&(D.flags|=16384))),bB(T,y)):gw(T)}function gw(y){var T=y;do{if((T.flags&32768)!==0){bB(T,Ud);return}y=T.return;var I=sde(T.alternate,T,Yc);if(I!==null){jn=I;return}if(T=T.sibling,T!==null){jn=T;return}jn=T=y}while(T!==null);ti===0&&(ti=5)}function bB(y,T){do{var I=ade(y.alternate,y);if(I!==null){I.flags&=32767,jn=I;return}if(I=y.return,I!==null&&(I.flags|=32768,I.subtreeFlags=0,I.deletions=null),!T&&(y=y.sibling,y!==null)){jn=y;return}jn=y=I}while(y!==null);ti=6,jn=null}function vB(y,T,I,D,z,$,ye,De,et){y.cancelPendingCommit=null;do yw();while(Ki!==0);if((or&6)!==0)throw Error(t(327));if(T!==null){if(T===y.current)throw Error(t(177));if($=T.lanes|T.childLanes,$|=ae,Ne(y,I,$,ye,De,et),y===jr&&(jn=jr=null,Hn=0),My=T,Hd=y,Ny=I,ER=$,IR=z,uB=D,(T.subtreeFlags&10256)!==0||(T.flags&10256)!==0?(y.callbackNode=null,y.callbackPriority=0,bde(Z,function(){return wB(),null})):(y.callbackNode=null,y.callbackPriority=0),D=(T.flags&13878)!==0,(T.subtreeFlags&13878)!==0||D){D=V.T,V.T=null,z=G.p,G.p=2,ye=or,or|=4;try{ode(y,T,I)}finally{or=ye,G.p=z,V.T=D}}Ki=1,SB(),CB(),_B()}}function SB(){if(Ki===1){Ki=0;var y=Hd,T=My,I=(T.flags&13878)!==0;if((T.subtreeFlags&13878)!==0||I){I=V.T,V.T=null;var D=G.p;G.p=2;var z=or;or|=4;try{nB(T,y);var $=HR,ye=VT(y.containerInfo),De=$.focusedElem,et=$.selectionRange;if(ye!==De&&De&&De.ownerDocument&&zT(De.ownerDocument.documentElement,De)){if(et!==null&&yy(De)){var vt=et.start,It=et.end;if(It===void 0&&(It=vt),"selectionStart"in De)De.selectionStart=vt,De.selectionEnd=Math.min(It,De.value.length);else{var At=De.ownerDocument||document,St=At&&At.defaultView||window;if(St.getSelection){var Ct=St.getSelection(),hn=De.textContent.length,un=Math.min(et.start,hn),pr=et.end===void 0?un:Math.min(et.end,hn);!Ct.extend&&un>pr&&(ye=pr,pr=un,un=ye);var ht=gy(De,un),at=gy(De,pr);if(ht&&at&&(Ct.rangeCount!==1||Ct.anchorNode!==ht.node||Ct.anchorOffset!==ht.offset||Ct.focusNode!==at.node||Ct.focusOffset!==at.offset)){var bt=At.createRange();bt.setStart(ht.node,ht.offset),Ct.removeAllRanges(),un>pr?(Ct.addRange(bt),Ct.extend(at.node,at.offset)):(bt.setEnd(at.node,at.offset),Ct.addRange(bt))}}}}for(At=[],Ct=De;Ct=Ct.parentNode;)Ct.nodeType===1&&At.push({element:Ct,left:Ct.scrollLeft,top:Ct.scrollTop});for(typeof De.focus=="function"&&De.focus(),De=0;De<At.length;De++){var Mt=At[De];Mt.element.scrollLeft=Mt.left,Mt.element.scrollTop=Mt.top}}Rw=!!VR,HR=VR=null}finally{or=z,G.p=D,V.T=I}}y.current=T,Ki=2}}function CB(){if(Ki===2){Ki=0;var y=Hd,T=My,I=(T.flags&8772)!==0;if((T.subtreeFlags&8772)!==0||I){I=V.T,V.T=null;var D=G.p;G.p=2;var z=or;or|=4;try{X2(y,T.alternate,T)}finally{or=z,G.p=D,V.T=I}}Ki=3}}function _B(){if(Ki===4||Ki===3){Ki=0,Re();var y=Hd,T=My,I=Ny,D=uB;(T.subtreeFlags&10256)!==0||(T.flags&10256)!==0?Ki=5:(Ki=0,My=Hd=null,TB(y,y.pendingLanes));var z=y.pendingLanes;if(z===0&&(Vd=null),ji(I),T=T.stateNode,He&&typeof He.onCommitFiberRoot=="function")try{He.onCommitFiberRoot(Oe,T,void 0,(T.current.flags&128)===128)}catch{}if(D!==null){T=V.T,z=G.p,G.p=2,V.T=null;try{for(var $=y.onRecoverableError,ye=0;ye<D.length;ye++){var De=D[ye];$(De.value,{componentStack:De.stack})}}finally{V.T=T,G.p=z}}(Ny&3)!==0&&yw(),ac(y),z=y.pendingLanes,(I&4194090)!==0&&(z&42)!==0?y===RR?Zb++:(Zb=0,RR=y):Zb=0,ev(0)}}function TB(y,T){(y.pooledCacheLanes&=T)===0&&(T=y.pooledCache,T!=null&&(y.pooledCache=null,Nb(T)))}function yw(y){return SB(),CB(),_B(),wB()}function wB(){if(Ki!==5)return!1;var y=Hd,T=ER;ER=0;var I=ji(Ny),D=V.T,z=G.p;try{G.p=32>I?32:I,V.T=null,I=IR,IR=null;var $=Hd,ye=Ny;if(Ki=0,My=Hd=null,Ny=0,(or&6)!==0)throw Error(t(331));var De=or;if(or|=4,oB($.current),iB($,$.current,ye,I),or=De,ev(0,!1),He&&typeof He.onPostCommitFiberRoot=="function")try{He.onPostCommitFiberRoot(Oe,$)}catch{}return!0}finally{G.p=z,V.T=D,TB(y,T)}}function OB(y,T,I){T=U(I,T),T=oR(y.stateNode,T,2),y=Ad(y,T,2),y!==null&&(je(y,2),ac(y))}function Sr(y,T,I){if(y.tag===3)OB(y,y,I);else for(;T!==null;){if(T.tag===3){OB(T,y,I);break}else if(T.tag===1){var D=T.stateNode;if(typeof T.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(Vd===null||!Vd.has(D))){y=U(I,y),I=R2(2),D=Ad(T,I,2),D!==null&&(F2(I,D,T,y),je(D,2),ac(D));break}}T=T.return}}function NR(y,T,I){var D=y.pingCache;if(D===null){D=y.pingCache=new dde;var z=new Set;D.set(T,z)}else z=D.get(T),z===void 0&&(z=new Set,D.set(T,z));z.has(I)||(TR=!0,z.add(I),y=pde.bind(null,y,T,I),T.then(y,y))}function pde(y,T,I){var D=y.pingCache;D!==null&&D.delete(T),y.pingedLanes|=y.suspendedLanes&I,y.warmLanes&=~I,jr===y&&(Hn&I)===I&&(ti===4||ti===3&&(Hn&62914560)===Hn&&300>Qe()-PR?(or&2)===0&&Ay(y,0):wR|=I,jy===Hn&&(jy=0)),ac(y)}function PB(y,T){T===0&&(T=zt()),y=W(y,T),y!==null&&(je(y,T),ac(y))}function gde(y){var T=y.memoizedState,I=0;T!==null&&(I=T.retryLane),PB(y,I)}function yde(y,T){var I=0;switch(y.tag){case 13:var D=y.stateNode,z=y.memoizedState;z!==null&&(I=z.retryLane);break;case 19:D=y.stateNode;break;case 22:D=y.stateNode._retryCache;break;default:throw Error(t(314))}D!==null&&D.delete(T),PB(y,I)}function bde(y,T){return Nt(y,T)}var bw=null,ky=null,AR=!1,vw=!1,DR=!1,Hl=0;function ac(y){y!==ky&&y.next===null&&(ky===null?bw=ky=y:ky=ky.next=y),vw=!0,AR||(AR=!0,Sde())}function ev(y,T){if(!DR&&vw){DR=!0;do for(var I=!1,D=bw;D!==null;){if(y!==0){var z=D.pendingLanes;if(z===0)var $=0;else{var ye=D.suspendedLanes,De=D.pingedLanes;$=(1<<31-Ve(42|y)+1)-1,$&=z&~(ye&~De),$=$&201326741?$&201326741|1:$?$|2:0}$!==0&&(I=!0,FB(D,$))}else $=Hn,$=ke(D,D===jr?$:0,D.cancelPendingCommit!==null||D.timeoutHandle!==-1),($&3)===0||Rt(D,$)||(I=!0,FB(D,$));D=D.next}while(I);DR=!1}}function vde(){EB()}function EB(){vw=AR=!1;var y=0;Hl!==0&&(Ide()&&(y=Hl),Hl=0);for(var T=Qe(),I=null,D=bw;D!==null;){var z=D.next,$=IB(D,T);$===0?(D.next=null,I===null?bw=z:I.next=z,z===null&&(ky=I)):(I=D,(y!==0||($&3)!==0)&&(vw=!0)),D=z}ev(y)}function IB(y,T){for(var I=y.suspendedLanes,D=y.pingedLanes,z=y.expirationTimes,$=y.pendingLanes&-62914561;0<$;){var ye=31-Ve($),De=1<<ye,et=z[ye];et===-1?((De&I)===0||(De&D)!==0)&&(z[ye]=Ft(De,T)):et<=T&&(y.expiredLanes|=De),$&=~De}if(T=jr,I=Hn,I=ke(y,y===T?I:0,y.cancelPendingCommit!==null||y.timeoutHandle!==-1),D=y.callbackNode,I===0||y===T&&(cr===2||cr===9)||y.cancelPendingCommit!==null)return D!==null&&D!==null&&Ke(D),y.callbackNode=null,y.callbackPriority=0;if((I&3)===0||Rt(y,I)){if(T=I&-I,T===y.callbackPriority)return T;switch(D!==null&&Ke(D),ji(I)){case 2:case 8:I=K;break;case 32:I=Z;break;case 268435456:I=we;break;default:I=Z}return D=RB.bind(null,y),I=Nt(I,D),y.callbackPriority=T,y.callbackNode=I,T}return D!==null&&D!==null&&Ke(D),y.callbackPriority=2,y.callbackNode=null,2}function RB(y,T){if(Ki!==0&&Ki!==5)return y.callbackNode=null,y.callbackPriority=0,null;var I=y.callbackNode;if(yw()&&y.callbackNode!==I)return null;var D=Hn;return D=ke(y,y===jr?D:0,y.cancelPendingCommit!==null||y.timeoutHandle!==-1),D===0?null:(lB(y,D,T),IB(y,Qe()),y.callbackNode!=null&&y.callbackNode===I?RB.bind(null,y):null)}function FB(y,T){if(yw())return null;lB(y,T,!0)}function Sde(){Fde(function(){(or&6)!==0?Nt(Me,vde):EB()})}function kR(){return Hl===0&&(Hl=xt()),Hl}function jB(y){return y==null||typeof y=="symbol"||typeof y=="boolean"?null:typeof y=="function"?y:Us(""+y)}function MB(y,T){var I=T.ownerDocument.createElement("input");return I.name=T.name,I.value=T.value,y.id&&I.setAttribute("form",y.id),T.parentNode.insertBefore(I,T),y=new FormData(y),I.parentNode.removeChild(I),y}function Cde(y,T,I,D,z){if(T==="submit"&&I&&I.stateNode===z){var $=jB((z[qn]||null).action),ye=D.submitter;ye&&(T=(T=ye[qn]||null)?jB(T.formAction):ye.getAttribute("formAction"),T!==null&&($=T,ye=null));var De=new Cd("action","action",null,D,z);y.push({event:De,listeners:[{instance:null,listener:function(){if(D.defaultPrevented){if(Hl!==0){var et=ye?MB(z,ye):new FormData(z);nR(I,{pending:!0,data:et,method:z.method,action:$},null,et)}}else typeof $=="function"&&(De.preventDefault(),et=ye?MB(z,ye):new FormData(z),nR(I,{pending:!0,data:et,method:z.method,action:$},$,et))},currentTarget:z}]})}}for(var xR=0;xR<A.length;xR++){var qR=A[xR],_de=qR.toLowerCase(),Tde=qR[0].toUpperCase()+qR.slice(1);q(_de,"on"+Tde)}q(Cn,"onAnimationEnd"),q(jb,"onAnimationIteration"),q(Mb,"onAnimationStart"),q("dblclick","onDoubleClick"),q("focusin","onFocus"),q("focusout","onBlur"),q(HT,"onTransitionRun"),q(an,"onTransitionStart"),q(MI,"onTransitionCancel"),q(P,"onTransitionEnd"),us("onMouseEnter",["mouseout","mouseover"]),us("onMouseLeave",["mouseout","mouseover"]),us("onPointerEnter",["pointerout","pointerover"]),us("onPointerLeave",["pointerout","pointerover"]),Xr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var tv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wde=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(tv));function NB(y,T){T=(T&4)!==0;for(var I=0;I<y.length;I++){var D=y[I],z=D.event;D=D.listeners;e:{var $=void 0;if(T)for(var ye=D.length-1;0<=ye;ye--){var De=D[ye],et=De.instance,vt=De.currentTarget;if(De=De.listener,et!==$&&z.isPropagationStopped())break e;$=De,z.currentTarget=vt;try{$(z)}catch(It){aw(It)}z.currentTarget=null,$=et}else for(ye=0;ye<D.length;ye++){if(De=D[ye],et=De.instance,vt=De.currentTarget,De=De.listener,et!==$&&z.isPropagationStopped())break e;$=De,z.currentTarget=vt;try{$(z)}catch(It){aw(It)}z.currentTarget=null,$=et}}}}function Mn(y,T){var I=T[Ys];I===void 0&&(I=T[Ys]=new Set);var D=y+"__bubble";I.has(D)||(AB(T,y,2,!1),I.add(D))}function LR(y,T,I){var D=0;T&&(D|=4),AB(I,y,D,T)}var Sw="_reactListening"+Math.random().toString(36).slice(2);function BR(y){if(!y[Sw]){y[Sw]=!0,Xs.forEach(function(I){I!=="selectionchange"&&(wde.has(I)||LR(I,!1,y),LR(I,!0,y))});var T=y.nodeType===9?y:y.ownerDocument;T===null||T[Sw]||(T[Sw]=!0,LR("selectionchange",!1,T))}}function AB(y,T,I,D){switch(i3(T)){case 2:var z=Yde;break;case 8:z=Xde;break;default:z=eF}I=z.bind(null,T,I,y),z=void 0,!qc||T!=="touchstart"&&T!=="touchmove"&&T!=="wheel"||(z=!0),D?z!==void 0?y.addEventListener(T,I,{capture:!0,passive:z}):y.addEventListener(T,I,!0):z!==void 0?y.addEventListener(T,I,{passive:z}):y.addEventListener(T,I,!1)}function UR(y,T,I,D,z){var $=D;if((T&1)===0&&(T&2)===0&&D!==null)e:for(;;){if(D===null)return;var ye=D.tag;if(ye===3||ye===4){var De=D.stateNode.containerInfo;if(De===z)break;if(ye===4)for(ye=D.return;ye!==null;){var et=ye.tag;if((et===3||et===4)&&ye.stateNode.containerInfo===z)return;ye=ye.return}for(;De!==null;){if(ye=Yr(De),ye===null)return;if(et=ye.tag,et===5||et===6||et===26||et===27){D=$=ye;continue e}De=De.parentNode}}D=D.return}El(function(){var vt=$,It=rn(I),At=[];e:{var St=N.get(y);if(St!==void 0){var Ct=Cd,hn=y;switch(y){case"keypress":if(Wa(I)===0)break e;case"keydown":case"keyup":Ct=zr;break;case"focusin":hn="focus",Ct=Xe;break;case"focusout":hn="blur",Ct=Xe;break;case"beforeblur":case"afterblur":Ct=Xe;break;case"click":if(I.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ct=be;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ct=Le;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ct=On;break;case Cn:case jb:case Mb:Ct=ft;break;case P:Ct=Pr;break;case"scroll":case"scrollend":Ct=Ob;break;case"wheel":Ct=_d;break;case"copy":case"cut":case"paste":Ct=Wt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ct=br;break;case"toggle":case"beforetoggle":Ct=Ln}var un=(T&4)!==0,pr=!un&&(y==="scroll"||y==="scrollend"),ht=un?St!==null?St+"Capture":null:St;un=[];for(var at=vt,bt;at!==null;){var Mt=at;if(bt=Mt.stateNode,Mt=Mt.tag,Mt!==5&&Mt!==26&&Mt!==27||bt===null||ht===null||(Mt=xc(at,ht),Mt!=null&&un.push(nv(at,Mt,bt))),pr)break;at=at.return}0<un.length&&(St=new Ct(St,hn,null,I,It),At.push({event:St,listeners:un}))}}if((T&7)===0){e:{if(St=y==="mouseover"||y==="pointerover",Ct=y==="mouseout"||y==="pointerout",St&&I!==ii&&(hn=I.relatedTarget||I.fromElement)&&(Yr(hn)||hn[qi]))break e;if((Ct||St)&&(St=It.window===It?It:(St=It.ownerDocument)?St.defaultView||St.parentWindow:window,Ct?(hn=I.relatedTarget||I.toElement,Ct=vt,hn=hn?Yr(hn):null,hn!==null&&(pr=r(hn),un=hn.tag,hn!==pr||un!==5&&un!==27&&un!==6)&&(hn=null)):(Ct=null,hn=vt),Ct!==hn)){if(un=be,Mt="onMouseLeave",ht="onMouseEnter",at="mouse",(y==="pointerout"||y==="pointerover")&&(un=br,Mt="onPointerLeave",ht="onPointerEnter",at="pointer"),pr=Ct==null?St:cs(Ct),bt=hn==null?St:cs(hn),St=new un(Mt,at+"leave",Ct,I,It),St.target=pr,St.relatedTarget=bt,Mt=null,Yr(It)===vt&&(un=new un(ht,at+"enter",hn,I,It),un.target=bt,un.relatedTarget=pr,Mt=un),pr=Mt,Ct&&hn)t:{for(un=Ct,ht=hn,at=0,bt=un;bt;bt=xy(bt))at++;for(bt=0,Mt=ht;Mt;Mt=xy(Mt))bt++;for(;0<at-bt;)un=xy(un),at--;for(;0<bt-at;)ht=xy(ht),bt--;for(;at--;){if(un===ht||ht!==null&&un===ht.alternate)break t;un=xy(un),ht=xy(ht)}un=null}else un=null;Ct!==null&&DB(At,St,Ct,un,!1),hn!==null&&pr!==null&&DB(At,pr,hn,un,!0)}}e:{if(St=vt?cs(vt):window,Ct=St.nodeName&&St.nodeName.toLowerCase(),Ct==="select"||Ct==="input"&&St.type==="file")var Jt=Pb;else if(Ml(St))if(Al)Jt=my;else{Jt=UT;var Rn=Ib}else Ct=St.nodeName,!Ct||Ct.toLowerCase()!=="input"||St.type!=="checkbox"&&St.type!=="radio"?vt&&Dc(vt.elementType)&&(Jt=Pb):Jt=Rb;if(Jt&&(Jt=Jt(y,vt))){ly(At,Jt,I,It);break e}Rn&&Rn(y,St,vt),y==="focusout"&&vt&&St.type==="number"&&vt.memoizedProps.value!=null&&Ac(St,"number",St.value)}switch(Rn=vt?cs(vt):window,y){case"focusin":(Ml(Rn)||Rn.contentEditable==="true")&&(Vc=Rn,Hc=vt,tc=null);break;case"focusout":tc=Hc=Vc=null;break;case"mousedown":vy=!0;break;case"contextmenu":case"mouseup":case"dragend":vy=!1,Fb(At,I,It);break;case"selectionchange":if(by)break;case"keydown":case"keyup":Fb(At,I,It)}var nn;if(Ja)e:{switch(y){case"compositionstart":var ln="onCompositionStart";break e;case"compositionend":ln="onCompositionEnd";break e;case"compositionupdate":ln="onCompositionUpdate";break e}ln=void 0}else Yn?wd(y,I)&&(ln="onCompositionEnd"):y==="keydown"&&I.keyCode===229&&(ln="onCompositionStart");ln&&(zi&&I.locale!=="ko"&&(Yn||ln!=="onCompositionStart"?ln==="onCompositionEnd"&&Yn&&(nn=uy()):(ta=It,Zo="value"in ta?ta.value:ta.textContent,Yn=!0)),Rn=Cw(vt,ln),0<Rn.length&&(ln=new B(ln,y,null,I,It),At.push({event:ln,listeners:Rn}),nn?ln.data=nn:(nn=dy(I),nn!==null&&(ln.data=nn)))),(nn=Ts?nr(y,I):jl(y,I))&&(ln=Cw(vt,"onBeforeInput"),0<ln.length&&(Rn=new B("onBeforeInput","beforeinput",null,I,It),At.push({event:Rn,listeners:ln}),Rn.data=nn)),Cde(At,y,vt,I,It)}NB(At,T)})}function nv(y,T,I){return{instance:y,listener:T,currentTarget:I}}function Cw(y,T){for(var I=T+"Capture",D=[];y!==null;){var z=y,$=z.stateNode;if(z=z.tag,z!==5&&z!==26&&z!==27||$===null||(z=xc(y,I),z!=null&&D.unshift(nv(y,z,$)),z=xc(y,T),z!=null&&D.push(nv(y,z,$))),y.tag===3)return D;y=y.return}return[]}function xy(y){if(y===null)return null;do y=y.return;while(y&&y.tag!==5&&y.tag!==27);return y||null}function DB(y,T,I,D,z){for(var $=T._reactName,ye=[];I!==null&&I!==D;){var De=I,et=De.alternate,vt=De.stateNode;if(De=De.tag,et!==null&&et===D)break;De!==5&&De!==26&&De!==27||vt===null||(et=vt,z?(vt=xc(I,$),vt!=null&&ye.unshift(nv(I,vt,et))):z||(vt=xc(I,$),vt!=null&&ye.push(nv(I,vt,et)))),I=I.return}ye.length!==0&&y.push({event:T,listeners:ye})}var Ode=/\r\n?/g,Pde=/\u0000|\uFFFD/g;function kB(y){return(typeof y=="string"?y:""+y).replace(Ode,`
`).replace(Pde,"")}function xB(y,T){return T=kB(T),kB(y)===T}function _w(){}function mr(y,T,I,D,z,$){switch(I){case"children":typeof D=="string"?T==="body"||T==="textarea"&&D===""||qa(y,D):(typeof D=="number"||typeof D=="bigint")&&T!=="body"&&qa(y,""+D);break;case"className":wn(y,"class",D);break;case"tabIndex":wn(y,"tabindex",D);break;case"dir":case"role":case"viewBox":case"width":case"height":wn(y,I,D);break;case"style":vd(y,D,$);break;case"data":if(T!=="object"){wn(y,"data",D);break}case"src":case"href":if(D===""&&(T!=="a"||I!=="href")){y.removeAttribute(I);break}if(D==null||typeof D=="function"||typeof D=="symbol"||typeof D=="boolean"){y.removeAttribute(I);break}D=Us(""+D),y.setAttribute(I,D);break;case"action":case"formAction":if(typeof D=="function"){y.setAttribute(I,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof $=="function"&&(I==="formAction"?(T!=="input"&&mr(y,T,"name",z.name,z,null),mr(y,T,"formEncType",z.formEncType,z,null),mr(y,T,"formMethod",z.formMethod,z,null),mr(y,T,"formTarget",z.formTarget,z,null)):(mr(y,T,"encType",z.encType,z,null),mr(y,T,"method",z.method,z,null),mr(y,T,"target",z.target,z,null)));if(D==null||typeof D=="symbol"||typeof D=="boolean"){y.removeAttribute(I);break}D=Us(""+D),y.setAttribute(I,D);break;case"onClick":D!=null&&(y.onclick=_w);break;case"onScroll":D!=null&&Mn("scroll",y);break;case"onScrollEnd":D!=null&&Mn("scrollend",y);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(t(61));if(I=D.__html,I!=null){if(z.children!=null)throw Error(t(60));y.innerHTML=I}}break;case"multiple":y.multiple=D&&typeof D!="function"&&typeof D!="symbol";break;case"muted":y.muted=D&&typeof D!="function"&&typeof D!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(D==null||typeof D=="function"||typeof D=="boolean"||typeof D=="symbol"){y.removeAttribute("xlink:href");break}I=Us(""+D),y.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",I);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":D!=null&&typeof D!="function"&&typeof D!="symbol"?y.setAttribute(I,""+D):y.removeAttribute(I);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":D&&typeof D!="function"&&typeof D!="symbol"?y.setAttribute(I,""):y.removeAttribute(I);break;case"capture":case"download":D===!0?y.setAttribute(I,""):D!==!1&&D!=null&&typeof D!="function"&&typeof D!="symbol"?y.setAttribute(I,D):y.removeAttribute(I);break;case"cols":case"rows":case"size":case"span":D!=null&&typeof D!="function"&&typeof D!="symbol"&&!isNaN(D)&&1<=D?y.setAttribute(I,D):y.removeAttribute(I);break;case"rowSpan":case"start":D==null||typeof D=="function"||typeof D=="symbol"||isNaN(D)?y.removeAttribute(I):y.setAttribute(I,D);break;case"popover":Mn("beforetoggle",y),Mn("toggle",y),gn(y,"popover",D);break;case"xlinkActuate":Or(y,"http://www.w3.org/1999/xlink","xlink:actuate",D);break;case"xlinkArcrole":Or(y,"http://www.w3.org/1999/xlink","xlink:arcrole",D);break;case"xlinkRole":Or(y,"http://www.w3.org/1999/xlink","xlink:role",D);break;case"xlinkShow":Or(y,"http://www.w3.org/1999/xlink","xlink:show",D);break;case"xlinkTitle":Or(y,"http://www.w3.org/1999/xlink","xlink:title",D);break;case"xlinkType":Or(y,"http://www.w3.org/1999/xlink","xlink:type",D);break;case"xmlBase":Or(y,"http://www.w3.org/XML/1998/namespace","xml:base",D);break;case"xmlLang":Or(y,"http://www.w3.org/XML/1998/namespace","xml:lang",D);break;case"xmlSpace":Or(y,"http://www.w3.org/XML/1998/namespace","xml:space",D);break;case"is":gn(y,"is",D);break;case"innerText":case"textContent":break;default:(!(2<I.length)||I[0]!=="o"&&I[0]!=="O"||I[1]!=="n"&&I[1]!=="N")&&(I=Sd.get(I)||I,gn(y,I,D))}}function zR(y,T,I,D,z,$){switch(I){case"style":vd(y,D,$);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(t(61));if(I=D.__html,I!=null){if(z.children!=null)throw Error(t(60));y.innerHTML=I}}break;case"children":typeof D=="string"?qa(y,D):(typeof D=="number"||typeof D=="bigint")&&qa(y,""+D);break;case"onScroll":D!=null&&Mn("scroll",y);break;case"onScrollEnd":D!=null&&Mn("scrollend",y);break;case"onClick":D!=null&&(y.onclick=_w);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!vs.hasOwnProperty(I))e:{if(I[0]==="o"&&I[1]==="n"&&(z=I.endsWith("Capture"),T=I.slice(2,z?I.length-7:void 0),$=y[qn]||null,$=$!=null?$[I]:null,typeof $=="function"&&y.removeEventListener(T,$,z),typeof D=="function")){typeof $!="function"&&$!==null&&(I in y?y[I]=null:y.hasAttribute(I)&&y.removeAttribute(I)),y.addEventListener(T,D,z);break e}I in y?y[I]=D:D===!0?y.setAttribute(I,""):gn(y,I,D)}}}function $i(y,T,I){switch(T){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mn("error",y),Mn("load",y);var D=!1,z=!1,$;for($ in I)if(I.hasOwnProperty($)){var ye=I[$];if(ye!=null)switch($){case"src":D=!0;break;case"srcSet":z=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(t(137,T));default:mr(y,T,$,ye,I,null)}}z&&mr(y,T,"srcSet",I.srcSet,I,null),D&&mr(y,T,"src",I.src,I,null);return;case"input":Mn("invalid",y);var De=$=ye=z=null,et=null,vt=null;for(D in I)if(I.hasOwnProperty(D)){var It=I[D];if(It!=null)switch(D){case"name":z=It;break;case"type":ye=It;break;case"checked":et=It;break;case"defaultChecked":vt=It;break;case"value":$=It;break;case"defaultValue":De=It;break;case"children":case"dangerouslySetInnerHTML":if(It!=null)throw Error(t(137,T));break;default:mr(y,T,D,It,I,null)}}Nc(y,$,De,et,vt,ye,z,!1),bd(y);return;case"select":Mn("invalid",y),D=ye=$=null;for(z in I)if(I.hasOwnProperty(z)&&(De=I[z],De!=null))switch(z){case"value":$=De;break;case"defaultValue":ye=De;break;case"multiple":D=De;default:mr(y,T,z,De,I,null)}T=$,I=ye,y.multiple=!!D,T!=null?Zr(y,!!D,T,!1):I!=null&&Zr(y,!!D,I,!0);return;case"textarea":Mn("invalid",y),$=z=D=null;for(ye in I)if(I.hasOwnProperty(ye)&&(De=I[ye],De!=null))switch(ye){case"value":D=De;break;case"defaultValue":z=De;break;case"children":$=De;break;case"dangerouslySetInnerHTML":if(De!=null)throw Error(t(91));break;default:mr(y,T,ye,De,I,null)}cy(y,D,z,$),bd(y);return;case"option":for(et in I)if(I.hasOwnProperty(et)&&(D=I[et],D!=null))switch(et){case"selected":y.selected=D&&typeof D!="function"&&typeof D!="symbol";break;default:mr(y,T,et,D,I,null)}return;case"dialog":Mn("beforetoggle",y),Mn("toggle",y),Mn("cancel",y),Mn("close",y);break;case"iframe":case"object":Mn("load",y);break;case"video":case"audio":for(D=0;D<tv.length;D++)Mn(tv[D],y);break;case"image":Mn("error",y),Mn("load",y);break;case"details":Mn("toggle",y);break;case"embed":case"source":case"link":Mn("error",y),Mn("load",y);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(vt in I)if(I.hasOwnProperty(vt)&&(D=I[vt],D!=null))switch(vt){case"children":case"dangerouslySetInnerHTML":throw Error(t(137,T));default:mr(y,T,vt,D,I,null)}return;default:if(Dc(T)){for(It in I)I.hasOwnProperty(It)&&(D=I[It],D!==void 0&&zR(y,T,It,D,I,void 0));return}}for(De in I)I.hasOwnProperty(De)&&(D=I[De],D!=null&&mr(y,T,De,D,I,null))}function Ede(y,T,I,D){switch(T){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var z=null,$=null,ye=null,De=null,et=null,vt=null,It=null;for(Ct in I){var At=I[Ct];if(I.hasOwnProperty(Ct)&&At!=null)switch(Ct){case"checked":break;case"value":break;case"defaultValue":et=At;default:D.hasOwnProperty(Ct)||mr(y,T,Ct,null,D,At)}}for(var St in D){var Ct=D[St];if(At=I[St],D.hasOwnProperty(St)&&(Ct!=null||At!=null))switch(St){case"type":$=Ct;break;case"name":z=Ct;break;case"checked":vt=Ct;break;case"defaultChecked":It=Ct;break;case"value":ye=Ct;break;case"defaultValue":De=Ct;break;case"children":case"dangerouslySetInnerHTML":if(Ct!=null)throw Error(t(137,T));break;default:Ct!==At&&mr(y,T,St,Ct,D,At)}}ea(y,ye,De,et,vt,It,$,z);return;case"select":Ct=ye=De=St=null;for($ in I)if(et=I[$],I.hasOwnProperty($)&&et!=null)switch($){case"value":break;case"multiple":Ct=et;default:D.hasOwnProperty($)||mr(y,T,$,null,D,et)}for(z in D)if($=D[z],et=I[z],D.hasOwnProperty(z)&&($!=null||et!=null))switch(z){case"value":St=$;break;case"defaultValue":De=$;break;case"multiple":ye=$;default:$!==et&&mr(y,T,z,$,D,et)}T=De,I=ye,D=Ct,St!=null?Zr(y,!!I,St,!1):!!D!=!!I&&(T!=null?Zr(y,!!I,T,!0):Zr(y,!!I,I?[]:"",!1));return;case"textarea":Ct=St=null;for(De in I)if(z=I[De],I.hasOwnProperty(De)&&z!=null&&!D.hasOwnProperty(De))switch(De){case"value":break;case"children":break;default:mr(y,T,De,null,D,z)}for(ye in D)if(z=D[ye],$=I[ye],D.hasOwnProperty(ye)&&(z!=null||$!=null))switch(ye){case"value":St=z;break;case"defaultValue":Ct=z;break;case"children":break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(t(91));break;default:z!==$&&mr(y,T,ye,z,D,$)}ei(y,St,Ct);return;case"option":for(var hn in I)if(St=I[hn],I.hasOwnProperty(hn)&&St!=null&&!D.hasOwnProperty(hn))switch(hn){case"selected":y.selected=!1;break;default:mr(y,T,hn,null,D,St)}for(et in D)if(St=D[et],Ct=I[et],D.hasOwnProperty(et)&&St!==Ct&&(St!=null||Ct!=null))switch(et){case"selected":y.selected=St&&typeof St!="function"&&typeof St!="symbol";break;default:mr(y,T,et,St,D,Ct)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var un in I)St=I[un],I.hasOwnProperty(un)&&St!=null&&!D.hasOwnProperty(un)&&mr(y,T,un,null,D,St);for(vt in D)if(St=D[vt],Ct=I[vt],D.hasOwnProperty(vt)&&St!==Ct&&(St!=null||Ct!=null))switch(vt){case"children":case"dangerouslySetInnerHTML":if(St!=null)throw Error(t(137,T));break;default:mr(y,T,vt,St,D,Ct)}return;default:if(Dc(T)){for(var pr in I)St=I[pr],I.hasOwnProperty(pr)&&St!==void 0&&!D.hasOwnProperty(pr)&&zR(y,T,pr,void 0,D,St);for(It in D)St=D[It],Ct=I[It],!D.hasOwnProperty(It)||St===Ct||St===void 0&&Ct===void 0||zR(y,T,It,St,D,Ct);return}}for(var ht in I)St=I[ht],I.hasOwnProperty(ht)&&St!=null&&!D.hasOwnProperty(ht)&&mr(y,T,ht,null,D,St);for(At in D)St=D[At],Ct=I[At],!D.hasOwnProperty(At)||St===Ct||St==null&&Ct==null||mr(y,T,At,St,D,Ct)}var VR=null,HR=null;function Tw(y){return y.nodeType===9?y:y.ownerDocument}function qB(y){switch(y){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function LB(y,T){if(y===0)switch(T){case"svg":return 1;case"math":return 2;default:return 0}return y===1&&T==="foreignObject"?0:y}function KR(y,T){return y==="textarea"||y==="noscript"||typeof T.children=="string"||typeof T.children=="number"||typeof T.children=="bigint"||typeof T.dangerouslySetInnerHTML=="object"&&T.dangerouslySetInnerHTML!==null&&T.dangerouslySetInnerHTML.__html!=null}var $R=null;function Ide(){var y=window.event;return y&&y.type==="popstate"?y===$R?!1:($R=y,!0):($R=null,!1)}var BB=typeof setTimeout=="function"?setTimeout:void 0,Rde=typeof clearTimeout=="function"?clearTimeout:void 0,UB=typeof Promise=="function"?Promise:void 0,Fde=typeof queueMicrotask=="function"?queueMicrotask:typeof UB<"u"?function(y){return UB.resolve(null).then(y).catch(jde)}:BB;function jde(y){setTimeout(function(){throw y})}function $d(y){return y==="head"}function zB(y,T){var I=T,D=0,z=0;do{var $=I.nextSibling;if(y.removeChild(I),$&&$.nodeType===8)if(I=$.data,I==="/$"){if(0<D&&8>D){I=D;var ye=y.ownerDocument;if(I&1&&rv(ye.documentElement),I&2&&rv(ye.body),I&4)for(I=ye.head,rv(I),ye=I.firstChild;ye;){var De=ye.nextSibling,et=ye.nodeName;ye[os]||et==="SCRIPT"||et==="STYLE"||et==="LINK"&&ye.rel.toLowerCase()==="stylesheet"||I.removeChild(ye),ye=De}}if(z===0){y.removeChild($),lv(T);return}z--}else I==="$"||I==="$?"||I==="$!"?z++:D=I.charCodeAt(0)-48;else D=0;I=$}while(I);lv(T)}function GR(y){var T=y.firstChild;for(T&&T.nodeType===10&&(T=T.nextSibling);T;){var I=T;switch(T=T.nextSibling,I.nodeName){case"HTML":case"HEAD":case"BODY":GR(I),bs(I);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(I.rel.toLowerCase()==="stylesheet")continue}y.removeChild(I)}}function Mde(y,T,I,D){for(;y.nodeType===1;){var z=I;if(y.nodeName.toLowerCase()!==T.toLowerCase()){if(!D&&(y.nodeName!=="INPUT"||y.type!=="hidden"))break}else if(D){if(!y[os])switch(T){case"meta":if(!y.hasAttribute("itemprop"))break;return y;case"link":if($=y.getAttribute("rel"),$==="stylesheet"&&y.hasAttribute("data-precedence"))break;if($!==z.rel||y.getAttribute("href")!==(z.href==null||z.href===""?null:z.href)||y.getAttribute("crossorigin")!==(z.crossOrigin==null?null:z.crossOrigin)||y.getAttribute("title")!==(z.title==null?null:z.title))break;return y;case"style":if(y.hasAttribute("data-precedence"))break;return y;case"script":if($=y.getAttribute("src"),($!==(z.src==null?null:z.src)||y.getAttribute("type")!==(z.type==null?null:z.type)||y.getAttribute("crossorigin")!==(z.crossOrigin==null?null:z.crossOrigin))&&$&&y.hasAttribute("async")&&!y.hasAttribute("itemprop"))break;return y;default:return y}}else if(T==="input"&&y.type==="hidden"){var $=z.name==null?null:""+z.name;if(z.type==="hidden"&&y.getAttribute("name")===$)return y}else return y;if(y=eo(y.nextSibling),y===null)break}return null}function Nde(y,T,I){if(T==="")return null;for(;y.nodeType!==3;)if((y.nodeType!==1||y.nodeName!=="INPUT"||y.type!=="hidden")&&!I||(y=eo(y.nextSibling),y===null))return null;return y}function WR(y){return y.data==="$!"||y.data==="$?"&&y.ownerDocument.readyState==="complete"}function Ade(y,T){var I=y.ownerDocument;if(y.data!=="$?"||I.readyState==="complete")T();else{var D=function(){T(),I.removeEventListener("DOMContentLoaded",D)};I.addEventListener("DOMContentLoaded",D),y._reactRetry=D}}function eo(y){for(;y!=null;y=y.nextSibling){var T=y.nodeType;if(T===1||T===3)break;if(T===8){if(T=y.data,T==="$"||T==="$!"||T==="$?"||T==="F!"||T==="F")break;if(T==="/$")return null}}return y}var JR=null;function VB(y){y=y.previousSibling;for(var T=0;y;){if(y.nodeType===8){var I=y.data;if(I==="$"||I==="$!"||I==="$?"){if(T===0)return y;T--}else I==="/$"&&T++}y=y.previousSibling}return null}function HB(y,T,I){switch(T=Tw(I),y){case"html":if(y=T.documentElement,!y)throw Error(t(452));return y;case"head":if(y=T.head,!y)throw Error(t(453));return y;case"body":if(y=T.body,!y)throw Error(t(454));return y;default:throw Error(t(451))}}function rv(y){for(var T=y.attributes;T.length;)y.removeAttributeNode(T[0]);bs(y)}var Ua=new Map,KB=new Set;function ww(y){return typeof y.getRootNode=="function"?y.getRootNode():y.nodeType===9?y:y.ownerDocument}var Xc=G.d;G.d={f:Dde,r:kde,D:xde,C:qde,L:Lde,m:Bde,X:zde,S:Ude,M:Vde};function Dde(){var y=Xc.f(),T=pw();return y||T}function kde(y){var T=ni(y);T!==null&&T.tag===5&&T.type==="form"?l2(T):Xc.r(y)}var qy=typeof document>"u"?null:document;function $B(y,T,I){var D=qy;if(D&&typeof T=="string"&&T){var z=Bi(T);z='link[rel="'+y+'"][href="'+z+'"]',typeof I=="string"&&(z+='[crossorigin="'+I+'"]'),KB.has(z)||(KB.add(z),y={rel:y,crossOrigin:I,href:T},D.querySelector(z)===null&&(T=D.createElement("link"),$i(T,"link",y),$n(T),D.head.appendChild(T)))}}function xde(y){Xc.D(y),$B("dns-prefetch",y,null)}function qde(y,T){Xc.C(y,T),$B("preconnect",y,T)}function Lde(y,T,I){Xc.L(y,T,I);var D=qy;if(D&&y&&T){var z='link[rel="preload"][as="'+Bi(T)+'"]';T==="image"&&I&&I.imageSrcSet?(z+='[imagesrcset="'+Bi(I.imageSrcSet)+'"]',typeof I.imageSizes=="string"&&(z+='[imagesizes="'+Bi(I.imageSizes)+'"]')):z+='[href="'+Bi(y)+'"]';var $=z;switch(T){case"style":$=Ly(y);break;case"script":$=By(y)}Ua.has($)||(y=d({rel:"preload",href:T==="image"&&I&&I.imageSrcSet?void 0:y,as:T},I),Ua.set($,y),D.querySelector(z)!==null||T==="style"&&D.querySelector(iv($))||T==="script"&&D.querySelector(sv($))||(T=D.createElement("link"),$i(T,"link",y),$n(T),D.head.appendChild(T)))}}function Bde(y,T){Xc.m(y,T);var I=qy;if(I&&y){var D=T&&typeof T.as=="string"?T.as:"script",z='link[rel="modulepreload"][as="'+Bi(D)+'"][href="'+Bi(y)+'"]',$=z;switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":$=By(y)}if(!Ua.has($)&&(y=d({rel:"modulepreload",href:y},T),Ua.set($,y),I.querySelector(z)===null)){switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(I.querySelector(sv($)))return}D=I.createElement("link"),$i(D,"link",y),$n(D),I.head.appendChild(D)}}}function Ude(y,T,I){Xc.S(y,T,I);var D=qy;if(D&&y){var z=Mi(D).hoistableStyles,$=Ly(y);T=T||"default";var ye=z.get($);if(!ye){var De={loading:0,preload:null};if(ye=D.querySelector(iv($)))De.loading=5;else{y=d({rel:"stylesheet",href:y,"data-precedence":T},I),(I=Ua.get($))&&QR(y,I);var et=ye=D.createElement("link");$n(et),$i(et,"link",y),et._p=new Promise(function(vt,It){et.onload=vt,et.onerror=It}),et.addEventListener("load",function(){De.loading|=1}),et.addEventListener("error",function(){De.loading|=2}),De.loading|=4,Ow(ye,T,D)}ye={type:"stylesheet",instance:ye,count:1,state:De},z.set($,ye)}}}function zde(y,T){Xc.X(y,T);var I=qy;if(I&&y){var D=Mi(I).hoistableScripts,z=By(y),$=D.get(z);$||($=I.querySelector(sv(z)),$||(y=d({src:y,async:!0},T),(T=Ua.get(z))&&YR(y,T),$=I.createElement("script"),$n($),$i($,"link",y),I.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},D.set(z,$))}}function Vde(y,T){Xc.M(y,T);var I=qy;if(I&&y){var D=Mi(I).hoistableScripts,z=By(y),$=D.get(z);$||($=I.querySelector(sv(z)),$||(y=d({src:y,async:!0,type:"module"},T),(T=Ua.get(z))&&YR(y,T),$=I.createElement("script"),$n($),$i($,"link",y),I.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},D.set(z,$))}}function GB(y,T,I,D){var z=(z=Ce.current)?ww(z):null;if(!z)throw Error(t(446));switch(y){case"meta":case"title":return null;case"style":return typeof I.precedence=="string"&&typeof I.href=="string"?(T=Ly(I.href),I=Mi(z).hoistableStyles,D=I.get(T),D||(D={type:"style",instance:null,count:0,state:null},I.set(T,D)),D):{type:"void",instance:null,count:0,state:null};case"link":if(I.rel==="stylesheet"&&typeof I.href=="string"&&typeof I.precedence=="string"){y=Ly(I.href);var $=Mi(z).hoistableStyles,ye=$.get(y);if(ye||(z=z.ownerDocument||z,ye={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},$.set(y,ye),($=z.querySelector(iv(y)))&&!$._p&&(ye.instance=$,ye.state.loading=5),Ua.has(y)||(I={rel:"preload",as:"style",href:I.href,crossOrigin:I.crossOrigin,integrity:I.integrity,media:I.media,hrefLang:I.hrefLang,referrerPolicy:I.referrerPolicy},Ua.set(y,I),$||Hde(z,y,I,ye.state))),T&&D===null)throw Error(t(528,""));return ye}if(T&&D!==null)throw Error(t(529,""));return null;case"script":return T=I.async,I=I.src,typeof I=="string"&&T&&typeof T!="function"&&typeof T!="symbol"?(T=By(I),I=Mi(z).hoistableScripts,D=I.get(T),D||(D={type:"script",instance:null,count:0,state:null},I.set(T,D)),D):{type:"void",instance:null,count:0,state:null};default:throw Error(t(444,y))}}function Ly(y){return'href="'+Bi(y)+'"'}function iv(y){return'link[rel="stylesheet"]['+y+"]"}function WB(y){return d({},y,{"data-precedence":y.precedence,precedence:null})}function Hde(y,T,I,D){y.querySelector('link[rel="preload"][as="style"]['+T+"]")?D.loading=1:(T=y.createElement("link"),D.preload=T,T.addEventListener("load",function(){return D.loading|=1}),T.addEventListener("error",function(){return D.loading|=2}),$i(T,"link",I),$n(T),y.head.appendChild(T))}function By(y){return'[src="'+Bi(y)+'"]'}function sv(y){return"script[async]"+y}function JB(y,T,I){if(T.count++,T.instance===null)switch(T.type){case"style":var D=y.querySelector('style[data-href~="'+Bi(I.href)+'"]');if(D)return T.instance=D,$n(D),D;var z=d({},I,{"data-href":I.href,"data-precedence":I.precedence,href:null,precedence:null});return D=(y.ownerDocument||y).createElement("style"),$n(D),$i(D,"style",z),Ow(D,I.precedence,y),T.instance=D;case"stylesheet":z=Ly(I.href);var $=y.querySelector(iv(z));if($)return T.state.loading|=4,T.instance=$,$n($),$;D=WB(I),(z=Ua.get(z))&&QR(D,z),$=(y.ownerDocument||y).createElement("link"),$n($);var ye=$;return ye._p=new Promise(function(De,et){ye.onload=De,ye.onerror=et}),$i($,"link",D),T.state.loading|=4,Ow($,I.precedence,y),T.instance=$;case"script":return $=By(I.src),(z=y.querySelector(sv($)))?(T.instance=z,$n(z),z):(D=I,(z=Ua.get($))&&(D=d({},I),YR(D,z)),y=y.ownerDocument||y,z=y.createElement("script"),$n(z),$i(z,"link",D),y.head.appendChild(z),T.instance=z);case"void":return null;default:throw Error(t(443,T.type))}else T.type==="stylesheet"&&(T.state.loading&4)===0&&(D=T.instance,T.state.loading|=4,Ow(D,I.precedence,y));return T.instance}function Ow(y,T,I){for(var D=I.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),z=D.length?D[D.length-1]:null,$=z,ye=0;ye<D.length;ye++){var De=D[ye];if(De.dataset.precedence===T)$=De;else if($!==z)break}$?$.parentNode.insertBefore(y,$.nextSibling):(T=I.nodeType===9?I.head:I,T.insertBefore(y,T.firstChild))}function QR(y,T){y.crossOrigin==null&&(y.crossOrigin=T.crossOrigin),y.referrerPolicy==null&&(y.referrerPolicy=T.referrerPolicy),y.title==null&&(y.title=T.title)}function YR(y,T){y.crossOrigin==null&&(y.crossOrigin=T.crossOrigin),y.referrerPolicy==null&&(y.referrerPolicy=T.referrerPolicy),y.integrity==null&&(y.integrity=T.integrity)}var Pw=null;function QB(y,T,I){if(Pw===null){var D=new Map,z=Pw=new Map;z.set(I,D)}else z=Pw,D=z.get(I),D||(D=new Map,z.set(I,D));if(D.has(y))return D;for(D.set(y,null),I=I.getElementsByTagName(y),z=0;z<I.length;z++){var $=I[z];if(!($[os]||$[wr]||y==="link"&&$.getAttribute("rel")==="stylesheet")&&$.namespaceURI!=="http://www.w3.org/2000/svg"){var ye=$.getAttribute(T)||"";ye=y+ye;var De=D.get(ye);De?De.push($):D.set(ye,[$])}}return D}function YB(y,T,I){y=y.ownerDocument||y,y.head.insertBefore(I,T==="title"?y.querySelector("head > title"):null)}function Kde(y,T,I){if(I===1||T.itemProp!=null)return!1;switch(y){case"meta":case"title":return!0;case"style":if(typeof T.precedence!="string"||typeof T.href!="string"||T.href==="")break;return!0;case"link":if(typeof T.rel!="string"||typeof T.href!="string"||T.href===""||T.onLoad||T.onError)break;switch(T.rel){case"stylesheet":return y=T.disabled,typeof T.precedence=="string"&&y==null;default:return!0}case"script":if(T.async&&typeof T.async!="function"&&typeof T.async!="symbol"&&!T.onLoad&&!T.onError&&T.src&&typeof T.src=="string")return!0}return!1}function XB(y){return!(y.type==="stylesheet"&&(y.state.loading&3)===0)}var av=null;function $de(){}function Gde(y,T,I){if(av===null)throw Error(t(475));var D=av;if(T.type==="stylesheet"&&(typeof I.media!="string"||matchMedia(I.media).matches!==!1)&&(T.state.loading&4)===0){if(T.instance===null){var z=Ly(I.href),$=y.querySelector(iv(z));if($){y=$._p,y!==null&&typeof y=="object"&&typeof y.then=="function"&&(D.count++,D=Ew.bind(D),y.then(D,D)),T.state.loading|=4,T.instance=$,$n($);return}$=y.ownerDocument||y,I=WB(I),(z=Ua.get(z))&&QR(I,z),$=$.createElement("link"),$n($);var ye=$;ye._p=new Promise(function(De,et){ye.onload=De,ye.onerror=et}),$i($,"link",I),T.instance=$}D.stylesheets===null&&(D.stylesheets=new Map),D.stylesheets.set(T,y),(y=T.state.preload)&&(T.state.loading&3)===0&&(D.count++,T=Ew.bind(D),y.addEventListener("load",T),y.addEventListener("error",T))}}function Wde(){if(av===null)throw Error(t(475));var y=av;return y.stylesheets&&y.count===0&&XR(y,y.stylesheets),0<y.count?function(T){var I=setTimeout(function(){if(y.stylesheets&&XR(y,y.stylesheets),y.unsuspend){var D=y.unsuspend;y.unsuspend=null,D()}},6e4);return y.unsuspend=T,function(){y.unsuspend=null,clearTimeout(I)}}:null}function Ew(){if(this.count--,this.count===0){if(this.stylesheets)XR(this,this.stylesheets);else if(this.unsuspend){var y=this.unsuspend;this.unsuspend=null,y()}}}var Iw=null;function XR(y,T){y.stylesheets=null,y.unsuspend!==null&&(y.count++,Iw=new Map,T.forEach(Jde,y),Iw=null,Ew.call(y))}function Jde(y,T){if(!(T.state.loading&4)){var I=Iw.get(y);if(I)var D=I.get(null);else{I=new Map,Iw.set(y,I);for(var z=y.querySelectorAll("link[data-precedence],style[data-precedence]"),$=0;$<z.length;$++){var ye=z[$];(ye.nodeName==="LINK"||ye.getAttribute("media")!=="not all")&&(I.set(ye.dataset.precedence,ye),D=ye)}D&&I.set(null,D)}z=T.instance,ye=z.getAttribute("data-precedence"),$=I.get(ye)||D,$===D&&I.set(null,z),I.set(ye,z),this.count++,D=Ew.bind(this),z.addEventListener("load",D),z.addEventListener("error",D),$?$.parentNode.insertBefore(z,$.nextSibling):(y=y.nodeType===9?y.head:y,y.insertBefore(z,y.firstChild)),T.state.loading|=4}}var ov={$$typeof:_,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function Qde(y,T,I,D,z,$,ye,De){this.tag=1,this.containerInfo=y,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fn(0),this.hiddenUpdates=fn(null),this.identifierPrefix=D,this.onUncaughtError=z,this.onCaughtError=$,this.onRecoverableError=ye,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=De,this.incompleteTransitions=new Map}function ZB(y,T,I,D,z,$,ye,De,et,vt,It,At){return y=new Qde(y,T,I,ye,De,et,vt,At),T=1,$===!0&&(T|=24),$=ve(3,null,null,T),y.current=$,$.stateNode=y,T=NI(),T.refCount++,y.pooledCache=T,T.refCount++,$.memoizedState={element:D,isDehydrated:I,cache:T},xI($),y}function e3(y){return y?(y=ie,y):ie}function t3(y,T,I,D,z,$){z=e3(z),D.context===null?D.context=z:D.pendingContext=z,D=Nd(T),D.payload={element:I},$=$===void 0?null:$,$!==null&&(D.callback=$),I=Ad(y,D,T),I!==null&&(da(I,y,T),xb(I,y,T))}function n3(y,T){if(y=y.memoizedState,y!==null&&y.dehydrated!==null){var I=y.retryLane;y.retryLane=I!==0&&I<T?I:T}}function ZR(y,T){n3(y,T),(y=y.alternate)&&n3(y,T)}function r3(y){if(y.tag===13){var T=W(y,67108864);T!==null&&da(T,y,67108864),ZR(y,67108864)}}var Rw=!0;function Yde(y,T,I,D){var z=V.T;V.T=null;var $=G.p;try{G.p=2,eF(y,T,I,D)}finally{G.p=$,V.T=z}}function Xde(y,T,I,D){var z=V.T;V.T=null;var $=G.p;try{G.p=8,eF(y,T,I,D)}finally{G.p=$,V.T=z}}function eF(y,T,I,D){if(Rw){var z=tF(D);if(z===null)UR(y,T,D,Fw,I),s3(y,D);else if(ele(z,y,T,I,D))D.stopPropagation();else if(s3(y,D),T&4&&-1<Zde.indexOf(y)){for(;z!==null;){var $=ni(z);if($!==null)switch($.tag){case 3:if($=$.stateNode,$.current.memoizedState.isDehydrated){var ye=Ye($.pendingLanes);if(ye!==0){var De=$;for(De.pendingLanes|=2,De.entangledLanes|=2;ye;){var et=1<<31-Ve(ye);De.entanglements[1]|=et,ye&=~et}ac($),(or&6)===0&&(hw=Qe()+500,ev(0))}}break;case 13:De=W($,2),De!==null&&da(De,$,2),pw(),ZR($,2)}if($=tF(D),$===null&&UR(y,T,D,Fw,I),$===z)break;z=$}z!==null&&D.stopPropagation()}else UR(y,T,D,null,I)}}function tF(y){return y=rn(y),nF(y)}var Fw=null;function nF(y){if(Fw=null,y=Yr(y),y!==null){var T=r(y);if(T===null)y=null;else{var I=T.tag;if(I===13){if(y=s(T),y!==null)return y;y=null}else if(I===3){if(T.stateNode.current.memoizedState.isDehydrated)return T.tag===3?T.stateNode.containerInfo:null;y=null}else T!==y&&(y=null)}}return Fw=y,null}function i3(y){switch(y){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Y()){case Me:return 2;case K:return 8;case Z:case me:return 32;case we:return 268435456;default:return 32}default:return 32}}var rF=!1,Gd=null,Wd=null,Jd=null,cv=new Map,uv=new Map,Qd=[],Zde="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function s3(y,T){switch(y){case"focusin":case"focusout":Gd=null;break;case"dragenter":case"dragleave":Wd=null;break;case"mouseover":case"mouseout":Jd=null;break;case"pointerover":case"pointerout":cv.delete(T.pointerId);break;case"gotpointercapture":case"lostpointercapture":uv.delete(T.pointerId)}}function dv(y,T,I,D,z,$){return y===null||y.nativeEvent!==$?(y={blockedOn:T,domEventName:I,eventSystemFlags:D,nativeEvent:$,targetContainers:[z]},T!==null&&(T=ni(T),T!==null&&r3(T)),y):(y.eventSystemFlags|=D,T=y.targetContainers,z!==null&&T.indexOf(z)===-1&&T.push(z),y)}function ele(y,T,I,D,z){switch(T){case"focusin":return Gd=dv(Gd,y,T,I,D,z),!0;case"dragenter":return Wd=dv(Wd,y,T,I,D,z),!0;case"mouseover":return Jd=dv(Jd,y,T,I,D,z),!0;case"pointerover":var $=z.pointerId;return cv.set($,dv(cv.get($)||null,y,T,I,D,z)),!0;case"gotpointercapture":return $=z.pointerId,uv.set($,dv(uv.get($)||null,y,T,I,D,z)),!0}return!1}function a3(y){var T=Yr(y.target);if(T!==null){var I=r(T);if(I!==null){if(T=I.tag,T===13){if(T=s(I),T!==null){y.blockedOn=T,Qr(y.priority,function(){if(I.tag===13){var D=ua();D=er(D);var z=W(I,D);z!==null&&da(z,I,D),ZR(I,D)}});return}}else if(T===3&&I.stateNode.current.memoizedState.isDehydrated){y.blockedOn=I.tag===3?I.stateNode.containerInfo:null;return}}}y.blockedOn=null}function jw(y){if(y.blockedOn!==null)return!1;for(var T=y.targetContainers;0<T.length;){var I=tF(y.nativeEvent);if(I===null){I=y.nativeEvent;var D=new I.constructor(I.type,I);ii=D,I.target.dispatchEvent(D),ii=null}else return T=ni(I),T!==null&&r3(T),y.blockedOn=I,!1;T.shift()}return!0}function o3(y,T,I){jw(y)&&I.delete(T)}function tle(){rF=!1,Gd!==null&&jw(Gd)&&(Gd=null),Wd!==null&&jw(Wd)&&(Wd=null),Jd!==null&&jw(Jd)&&(Jd=null),cv.forEach(o3),uv.forEach(o3)}function Mw(y,T){y.blockedOn===T&&(y.blockedOn=null,rF||(rF=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,tle)))}var Nw=null;function c3(y){Nw!==y&&(Nw=y,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Nw===y&&(Nw=null);for(var T=0;T<y.length;T+=3){var I=y[T],D=y[T+1],z=y[T+2];if(typeof D!="function"){if(nF(D||I)===null)continue;break}var $=ni(I);$!==null&&(y.splice(T,3),T-=3,nR($,{pending:!0,data:z,method:I.method,action:D},D,z))}}))}function lv(y){function T(et){return Mw(et,y)}Gd!==null&&Mw(Gd,y),Wd!==null&&Mw(Wd,y),Jd!==null&&Mw(Jd,y),cv.forEach(T),uv.forEach(T);for(var I=0;I<Qd.length;I++){var D=Qd[I];D.blockedOn===y&&(D.blockedOn=null)}for(;0<Qd.length&&(I=Qd[0],I.blockedOn===null);)a3(I),I.blockedOn===null&&Qd.shift();if(I=(y.ownerDocument||y).$$reactFormReplay,I!=null)for(D=0;D<I.length;D+=3){var z=I[D],$=I[D+1],ye=z[qn]||null;if(typeof $=="function")ye||c3(I);else if(ye){var De=null;if($&&$.hasAttribute("formAction")){if(z=$,ye=$[qn]||null)De=ye.formAction;else if(nF(z)!==null)continue}else De=ye.action;typeof De=="function"?I[D+1]=De:(I.splice(D,3),D-=3),c3(I)}}}function iF(y){this._internalRoot=y}Aw.prototype.render=iF.prototype.render=function(y){var T=this._internalRoot;if(T===null)throw Error(t(409));var I=T.current,D=ua();t3(I,D,y,T,null,null)},Aw.prototype.unmount=iF.prototype.unmount=function(){var y=this._internalRoot;if(y!==null){this._internalRoot=null;var T=y.containerInfo;t3(y.current,2,null,y,null,null),pw(),T[qi]=null}};function Aw(y){this._internalRoot=y}Aw.prototype.unstable_scheduleHydration=function(y){if(y){var T=Qs();y={blockedOn:null,target:y,priority:T};for(var I=0;I<Qd.length&&T!==0&&T<Qd[I].priority;I++);Qd.splice(I,0,y),I===0&&a3(y)}};var u3=n.version;if(u3!=="19.1.1")throw Error(t(527,u3,"19.1.1"));G.findDOMNode=function(y){var T=y._reactInternals;if(T===void 0)throw typeof y.render=="function"?Error(t(188)):(y=Object.keys(y).join(","),Error(t(268,y)));return y=u(T),y=y!==null?c(y):null,y=y===null?null:y.stateNode,y};var nle={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dw.isDisabled&&Dw.supportsFiber)try{Oe=Dw.inject(nle),He=Dw}catch{}}return hv.createRoot=function(y,T){if(!i(y))throw Error(t(299));var I=!1,D="",z=O2,$=P2,ye=E2,De=null;return T!=null&&(T.unstable_strictMode===!0&&(I=!0),T.identifierPrefix!==void 0&&(D=T.identifierPrefix),T.onUncaughtError!==void 0&&(z=T.onUncaughtError),T.onCaughtError!==void 0&&($=T.onCaughtError),T.onRecoverableError!==void 0&&(ye=T.onRecoverableError),T.unstable_transitionCallbacks!==void 0&&(De=T.unstable_transitionCallbacks)),T=ZB(y,1,!1,null,null,I,D,z,$,ye,De,null),y[qi]=T.current,BR(y),new iF(T)},hv.hydrateRoot=function(y,T,I){if(!i(y))throw Error(t(299));var D=!1,z="",$=O2,ye=P2,De=E2,et=null,vt=null;return I!=null&&(I.unstable_strictMode===!0&&(D=!0),I.identifierPrefix!==void 0&&(z=I.identifierPrefix),I.onUncaughtError!==void 0&&($=I.onUncaughtError),I.onCaughtError!==void 0&&(ye=I.onCaughtError),I.onRecoverableError!==void 0&&(De=I.onRecoverableError),I.unstable_transitionCallbacks!==void 0&&(et=I.unstable_transitionCallbacks),I.formState!==void 0&&(vt=I.formState)),T=ZB(y,1,!0,T,I??null,D,z,$,ye,De,et,vt),T.context=e3(null),I=T.current,D=ua(),D=er(D),z=Nd(D),z.callback=null,Ad(I,z,D),I=D,T.current.lanes=I,je(T,I),ac(T),y[qi]=T.current,BR(y),new Aw(T)},hv.version="19.1.1",hv}var v3;function fle(){if(v3)return oF.exports;v3=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),oF.exports=lle(),oF.exports}var hle=fle();/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var S3="popstate";function mle(e={}){function n(i,r){let{pathname:s="/",search:o="",hash:u=""}=Vg(i.location.hash.substring(1));return!s.startsWith("/")&&!s.startsWith(".")&&(s="/"+s),pk("",{pathname:s,search:o,hash:u},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function a(i,r){let s=i.document.querySelector("base"),o="";if(s&&s.getAttribute("href")){let u=i.location.href,c=u.indexOf("#");o=c===-1?u:u.slice(0,c)}return o+"#"+(typeof r=="string"?r:Q1(r))}function t(i,r){zo(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(r)})`)}return gle(n,a,t,e)}function Jr(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function zo(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function ple(){return Math.random().toString(36).substring(2,10)}function C3(e,n){return{usr:e.state,key:e.key,idx:n}}function pk(e,n,a=null,t){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof n=="string"?Vg(n):n,state:a,key:n&&n.key||t||ple()}}function Q1({pathname:e="/",search:n="",hash:a=""}){return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),a&&a!=="#"&&(e+=a.charAt(0)==="#"?a:"#"+a),e}function Vg(e){let n={};if(e){let a=e.indexOf("#");a>=0&&(n.hash=e.substring(a),e=e.substring(0,a));let t=e.indexOf("?");t>=0&&(n.search=e.substring(t),e=e.substring(0,t)),e&&(n.pathname=e)}return n}function gle(e,n,a,t={}){let{window:i=document.defaultView,v5Compat:r=!1}=t,s=i.history,o="POP",u=null,c=d();c==null&&(c=0,s.replaceState({...s.state,idx:c},""));function d(){return(s.state||{idx:null}).idx}function l(){o="POP";let m=d(),h=m==null?null:m-c;c=m,u&&u({action:o,location:v.location,delta:h})}function f(m,h){o="PUSH";let g=pk(v.location,m,h);a&&a(g,m),c=d()+1;let _=C3(g,c),S=v.createHref(g);try{s.pushState(_,"",S)}catch(p){if(p instanceof DOMException&&p.name==="DataCloneError")throw p;i.location.assign(S)}r&&u&&u({action:o,location:v.location,delta:1})}function b(m,h){o="REPLACE";let g=pk(v.location,m,h);a&&a(g,m),c=d();let _=C3(g,c),S=v.createHref(g);s.replaceState(_,"",S),r&&u&&u({action:o,location:v.location,delta:0})}function C(m){return yle(m)}let v={get action(){return o},get location(){return e(i,s)},listen(m){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(S3,l),u=m,()=>{i.removeEventListener(S3,l),u=null}},createHref(m){return n(i,m)},createURL:C,encodeLocation(m){let h=C(m);return{pathname:h.pathname,search:h.search,hash:h.hash}},push:f,replace:b,go(m){return s.go(m)}};return v}function yle(e,n=!1){let a="http://localhost";typeof window<"u"&&(a=window.location.origin!=="null"?window.location.origin:window.location.href),Jr(a,"No window.location.(origin|href) available to create URL");let t=typeof e=="string"?e:Q1(e);return t=t.replace(/ $/,"%20"),!n&&t.startsWith("//")&&(t=a+t),new URL(t,a)}function Tre(e,n,a="/"){return ble(e,n,a,!1)}function ble(e,n,a,t){let i=typeof n=="string"?Vg(n):n,r=ld(i.pathname||"/",a);if(r==null)return null;let s=wre(e);vle(s);let o=null;for(let u=0;o==null&&u<s.length;++u){let c=Fle(r);o=Ile(s[u],c,t)}return o}function wre(e,n=[],a=[],t="",i=!1){let r=(s,o,u=i,c)=>{let d={relativePath:c===void 0?s.path||"":c,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(t)&&u)return;Jr(d.relativePath.startsWith(t),`Absolute route path "${d.relativePath}" nested under path "${t}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(t.length)}let l=dd([t,d.relativePath]),f=a.concat(d);s.children&&s.children.length>0&&(Jr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),wre(s.children,n,f,l,u)),!(s.path==null&&!s.index)&&n.push({path:l,score:Ple(l,s.index),routesMeta:f})};return e.forEach((s,o)=>{if(s.path===""||!s.path?.includes("?"))r(s,o);else for(let u of Ore(s.path))r(s,o,!0,u)}),n}function Ore(e){let n=e.split("/");if(n.length===0)return[];let[a,...t]=n,i=a.endsWith("?"),r=a.replace(/\?$/,"");if(t.length===0)return i?[r,""]:[r];let s=Ore(t.join("/")),o=[];return o.push(...s.map(u=>u===""?r:[r,u].join("/"))),i&&o.push(...s),o.map(u=>e.startsWith("/")&&u===""?"/":u)}function vle(e){e.sort((n,a)=>n.score!==a.score?a.score-n.score:Ele(n.routesMeta.map(t=>t.childrenIndex),a.routesMeta.map(t=>t.childrenIndex)))}var Sle=/^:[\w-]+$/,Cle=3,_le=2,Tle=1,wle=10,Ole=-2,_3=e=>e==="*";function Ple(e,n){let a=e.split("/"),t=a.length;return a.some(_3)&&(t+=Ole),n&&(t+=_le),a.filter(i=>!_3(i)).reduce((i,r)=>i+(Sle.test(r)?Cle:r===""?Tle:wle),t)}function Ele(e,n){return e.length===n.length&&e.slice(0,-1).every((t,i)=>t===n[i])?e[e.length-1]-n[n.length-1]:0}function Ile(e,n,a=!1){let{routesMeta:t}=e,i={},r="/",s=[];for(let o=0;o<t.length;++o){let u=t[o],c=o===t.length-1,d=r==="/"?n:n.slice(r.length)||"/",l=JP({path:u.relativePath,caseSensitive:u.caseSensitive,end:c},d),f=u.route;if(!l&&c&&a&&!t[t.length-1].route.index&&(l=JP({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},d)),!l)return null;Object.assign(i,l.params),s.push({params:i,pathname:dd([r,l.pathname]),pathnameBase:Ale(dd([r,l.pathnameBase])),route:f}),l.pathnameBase!=="/"&&(r=dd([r,l.pathnameBase]))}return s}function JP(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[a,t]=Rle(e.path,e.caseSensitive,e.end),i=n.match(a);if(!i)return null;let r=i[0],s=r.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:t.reduce((c,{paramName:d,isOptional:l},f)=>{if(d==="*"){let C=o[f]||"";s=r.slice(0,r.length-C.length).replace(/(.)\/+$/,"$1")}const b=o[f];return l&&!b?c[d]=void 0:c[d]=(b||"").replace(/%2F/g,"/"),c},{}),pathname:r,pathnameBase:s,pattern:e}}function Rle(e,n=!1,a=!0){zo(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let t=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,o,u)=>(t.push({paramName:o,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(t.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,n?void 0:"i"),t]}function Fle(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return zo(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),e}}function ld(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let a=n.endsWith("/")?n.length-1:n.length,t=e.charAt(a);return t&&t!=="/"?null:e.slice(a)||"/"}function jle(e,n="/"){let{pathname:a,search:t="",hash:i=""}=typeof e=="string"?Vg(e):e;return{pathname:a?a.startsWith("/")?a:Mle(a,n):n,search:Dle(t),hash:kle(i)}}function Mle(e,n){let a=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?a.length>1&&a.pop():i!=="."&&a.push(i)}),a.length>1?a.join("/"):"/"}function lF(e,n,a,t){return`Cannot include a '${e}' character in a manually specified \`to.${n}\` field [${JSON.stringify(t)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Nle(e){return e.filter((n,a)=>a===0||n.route.path&&n.route.path.length>0)}function Pre(e){let n=Nle(e);return n.map((a,t)=>t===n.length-1?a.pathname:a.pathnameBase)}function Ere(e,n,a,t=!1){let i;typeof e=="string"?i=Vg(e):(i={...e},Jr(!i.pathname||!i.pathname.includes("?"),lF("?","pathname","search",i)),Jr(!i.pathname||!i.pathname.includes("#"),lF("#","pathname","hash",i)),Jr(!i.search||!i.search.includes("#"),lF("#","search","hash",i)));let r=e===""||i.pathname==="",s=r?"/":i.pathname,o;if(s==null)o=a;else{let l=n.length-1;if(!t&&s.startsWith("..")){let f=s.split("/");for(;f[0]==="..";)f.shift(),l-=1;i.pathname=f.join("/")}o=l>=0?n[l]:"/"}let u=jle(i,o),c=s&&s!=="/"&&s.endsWith("/"),d=(r||s===".")&&a.endsWith("/");return!u.pathname.endsWith("/")&&(c||d)&&(u.pathname+="/"),u}var dd=e=>e.join("/").replace(/\/\/+/g,"/"),Ale=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Dle=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,kle=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function xle(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var Ire=["POST","PUT","PATCH","DELETE"];new Set(Ire);var qle=["GET",...Ire];new Set(qle);var rb=Et.createContext(null);rb.displayName="DataRouter";var aE=Et.createContext(null);aE.displayName="DataRouterState";Et.createContext(!1);var Rre=Et.createContext({isTransitioning:!1});Rre.displayName="ViewTransition";var Lle=Et.createContext(new Map);Lle.displayName="Fetchers";var Ble=Et.createContext(null);Ble.displayName="Await";var _c=Et.createContext(null);_c.displayName="Navigation";var eT=Et.createContext(null);eT.displayName="Location";var fd=Et.createContext({outlet:null,matches:[],isDataRoute:!1});fd.displayName="Route";var Gk=Et.createContext(null);Gk.displayName="RouteError";function Ule(e,{relative:n}={}){Jr(tT(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:t}=Et.useContext(_c),{hash:i,pathname:r,search:s}=nT(e,{relative:n}),o=r;return a!=="/"&&(o=r==="/"?a:dd([a,r])),t.createHref({pathname:o,search:s,hash:i})}function tT(){return Et.useContext(eT)!=null}function Hg(){return Jr(tT(),"useLocation() may be used only in the context of a <Router> component."),Et.useContext(eT).location}var Fre="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function jre(e){Et.useContext(_c).static||Et.useLayoutEffect(e)}function zle(){let{isDataRoute:e}=Et.useContext(fd);return e?tfe():Vle()}function Vle(){Jr(tT(),"useNavigate() may be used only in the context of a <Router> component.");let e=Et.useContext(rb),{basename:n,navigator:a}=Et.useContext(_c),{matches:t}=Et.useContext(fd),{pathname:i}=Hg(),r=JSON.stringify(Pre(t)),s=Et.useRef(!1);return jre(()=>{s.current=!0}),Et.useCallback((u,c={})=>{if(zo(s.current,Fre),!s.current)return;if(typeof u=="number"){a.go(u);return}let d=Ere(u,JSON.parse(r),i,c.relative==="path");e==null&&n!=="/"&&(d.pathname=d.pathname==="/"?n:dd([n,d.pathname])),(c.replace?a.replace:a.push)(d,c.state,c)},[n,a,r,i,e])}Et.createContext(null);function nT(e,{relative:n}={}){let{matches:a}=Et.useContext(fd),{pathname:t}=Hg(),i=JSON.stringify(Pre(a));return Et.useMemo(()=>Ere(e,JSON.parse(i),t,n==="path"),[e,i,t,n])}function Hle(e,n){return Mre(e,n)}function Mre(e,n,a,t,i){Jr(tT(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=Et.useContext(_c),{matches:s}=Et.useContext(fd),o=s[s.length-1],u=o?o.params:{},c=o?o.pathname:"/",d=o?o.pathnameBase:"/",l=o&&o.route;{let g=l&&l.path||"";Nre(c,!l||g.endsWith("*")||g.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${g}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${g}"> to <Route path="${g==="/"?"*":`${g}/*`}">.`)}let f=Hg(),b;if(n){let g=typeof n=="string"?Vg(n):n;Jr(d==="/"||g.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${g.pathname}" was given in the \`location\` prop.`),b=g}else b=f;let C=b.pathname||"/",v=C;if(d!=="/"){let g=d.replace(/^\//,"").split("/");v="/"+C.replace(/^\//,"").split("/").slice(g.length).join("/")}let m=Tre(e,{pathname:v});zo(l||m!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),zo(m==null||m[m.length-1].route.element!==void 0||m[m.length-1].route.Component!==void 0||m[m.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let h=Jle(m&&m.map(g=>Object.assign({},g,{params:Object.assign({},u,g.params),pathname:dd([d,r.encodeLocation?r.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?d:dd([d,r.encodeLocation?r.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),s,a,t,i);return n&&h?Et.createElement(eT.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},h):h}function Kle(){let e=efe(),n=xle(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),a=e instanceof Error?e.stack:null,t="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:t},r={padding:"2px 4px",backgroundColor:t},s=null;return console.error("Error handled by React Router default ErrorBoundary:",e),s=Et.createElement(Et.Fragment,null,Et.createElement("p",null," Hey developer "),Et.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Et.createElement("code",{style:r},"ErrorBoundary")," or"," ",Et.createElement("code",{style:r},"errorElement")," prop on your route.")),Et.createElement(Et.Fragment,null,Et.createElement("h2",null,"Unexpected Application Error!"),Et.createElement("h3",{style:{fontStyle:"italic"}},n),a?Et.createElement("pre",{style:i},a):null,s)}var $le=Et.createElement(Kle,null),Gle=class extends Et.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){this.props.unstable_onError?this.props.unstable_onError(e,n):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?Et.createElement(fd.Provider,{value:this.props.routeContext},Et.createElement(Gk.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Wle({routeContext:e,match:n,children:a}){let t=Et.useContext(rb);return t&&t.static&&t.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(t.staticContext._deepestRenderedBoundaryId=n.route.id),Et.createElement(fd.Provider,{value:e},a)}function Jle(e,n=[],a=null,t=null,i=null){if(e==null){if(!a)return null;if(a.errors)e=a.matches;else if(n.length===0&&!a.initialized&&a.matches.length>0)e=a.matches;else return null}let r=e,s=a?.errors;if(s!=null){let c=r.findIndex(d=>d.route.id&&s?.[d.route.id]!==void 0);Jr(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,c+1))}let o=!1,u=-1;if(a)for(let c=0;c<r.length;c++){let d=r[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:l,errors:f}=a,b=d.route.loader&&!l.hasOwnProperty(d.route.id)&&(!f||f[d.route.id]===void 0);if(d.route.lazy||b){o=!0,u>=0?r=r.slice(0,u+1):r=[r[0]];break}}}return r.reduceRight((c,d,l)=>{let f,b=!1,C=null,v=null;a&&(f=s&&d.route.id?s[d.route.id]:void 0,C=d.route.errorElement||$le,o&&(u<0&&l===0?(Nre("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,v=null):u===l&&(b=!0,v=d.route.hydrateFallbackElement||null)));let m=n.concat(r.slice(0,l+1)),h=()=>{let g;return f?g=C:b?g=v:d.route.Component?g=Et.createElement(d.route.Component,null):d.route.element?g=d.route.element:g=c,Et.createElement(Wle,{match:d,routeContext:{outlet:c,matches:m,isDataRoute:a!=null},children:g})};return a&&(d.route.ErrorBoundary||d.route.errorElement||l===0)?Et.createElement(Gle,{location:a.location,revalidation:a.revalidation,component:C,error:f,children:h(),routeContext:{outlet:null,matches:m,isDataRoute:!0},unstable_onError:t}):h()},null)}function Wk(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Qle(e){let n=Et.useContext(rb);return Jr(n,Wk(e)),n}function Yle(e){let n=Et.useContext(aE);return Jr(n,Wk(e)),n}function Xle(e){let n=Et.useContext(fd);return Jr(n,Wk(e)),n}function Jk(e){let n=Xle(e),a=n.matches[n.matches.length-1];return Jr(a.route.id,`${e} can only be used on routes that contain a unique "id"`),a.route.id}function Zle(){return Jk("useRouteId")}function efe(){let e=Et.useContext(Gk),n=Yle("useRouteError"),a=Jk("useRouteError");return e!==void 0?e:n.errors?.[a]}function tfe(){let{router:e}=Qle("useNavigate"),n=Jk("useNavigate"),a=Et.useRef(!1);return jre(()=>{a.current=!0}),Et.useCallback(async(i,r={})=>{zo(a.current,Fre),a.current&&(typeof i=="number"?e.navigate(i):await e.navigate(i,{fromRouteId:n,...r}))},[e,n])}var T3={};function Nre(e,n,a){!n&&!T3[e]&&(T3[e]=!0,zo(!1,a))}Et.memo(nfe);function nfe({routes:e,future:n,state:a,unstable_onError:t}){return Mre(e,void 0,a,t,n)}function L1(e){Jr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function rfe({basename:e="/",children:n=null,location:a,navigationType:t="POP",navigator:i,static:r=!1}){Jr(!tT(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=e.replace(/^\/*/,"/"),o=Et.useMemo(()=>({basename:s,navigator:i,static:r,future:{}}),[s,i,r]);typeof a=="string"&&(a=Vg(a));let{pathname:u="/",search:c="",hash:d="",state:l=null,key:f="default"}=a,b=Et.useMemo(()=>{let C=ld(u,s);return C==null?null:{location:{pathname:C,search:c,hash:d,state:l,key:f},navigationType:t}},[s,u,c,d,l,f,t]);return zo(b!=null,`<Router basename="${s}"> is not able to match the URL "${u}${c}${d}" because it does not start with the basename, so the <Router> won't render anything.`),b==null?null:Et.createElement(_c.Provider,{value:o},Et.createElement(eT.Provider,{children:n,value:b}))}function ife({children:e,location:n}){return Hle(gk(e),n)}function gk(e,n=[]){let a=[];return Et.Children.forEach(e,(t,i)=>{if(!Et.isValidElement(t))return;let r=[...n,i];if(t.type===Et.Fragment){a.push.apply(a,gk(t.props.children,r));return}Jr(t.type===L1,`[${typeof t.type=="string"?t.type:t.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Jr(!t.props.index||!t.props.children,"An index route cannot have child routes.");let s={id:t.props.id||r.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,hydrateFallbackElement:t.props.hydrateFallbackElement,HydrateFallback:t.props.HydrateFallback,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:t.props.hasErrorBoundary===!0||t.props.ErrorBoundary!=null||t.props.errorElement!=null,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(s.children=gk(t.props.children,r)),a.push(s)}),a}var LP="get",BP="application/x-www-form-urlencoded";function oE(e){return e!=null&&typeof e.tagName=="string"}function sfe(e){return oE(e)&&e.tagName.toLowerCase()==="button"}function afe(e){return oE(e)&&e.tagName.toLowerCase()==="form"}function ofe(e){return oE(e)&&e.tagName.toLowerCase()==="input"}function cfe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function ufe(e,n){return e.button===0&&(!n||n==="_self")&&!cfe(e)}var kw=null;function dfe(){if(kw===null)try{new FormData(document.createElement("form"),0),kw=!1}catch{kw=!0}return kw}var lfe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function fF(e){return e!=null&&!lfe.has(e)?(zo(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${BP}"`),null):e}function ffe(e,n){let a,t,i,r,s;if(afe(e)){let o=e.getAttribute("action");t=o?ld(o,n):null,a=e.getAttribute("method")||LP,i=fF(e.getAttribute("enctype"))||BP,r=new FormData(e)}else if(sfe(e)||ofe(e)&&(e.type==="submit"||e.type==="image")){let o=e.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=e.getAttribute("formaction")||o.getAttribute("action");if(t=u?ld(u,n):null,a=e.getAttribute("formmethod")||o.getAttribute("method")||LP,i=fF(e.getAttribute("formenctype"))||fF(o.getAttribute("enctype"))||BP,r=new FormData(o,e),!dfe()){let{name:c,type:d,value:l}=e;if(d==="image"){let f=c?`${c}.`:"";r.append(`${f}x`,"0"),r.append(`${f}y`,"0")}else c&&r.append(c,l)}}else{if(oE(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=LP,t=null,i=BP,s=e}return r&&i==="text/plain"&&(s=r,r=void 0),{action:t,method:a.toLowerCase(),encType:i,formData:r,body:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Qk(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function hfe(e,n,a){let t=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return t.pathname==="/"?t.pathname=`_root.${a}`:n&&ld(t.pathname,n)==="/"?t.pathname=`${n.replace(/\/$/,"")}/_root.${a}`:t.pathname=`${t.pathname.replace(/\/$/,"")}.${a}`,t}async function mfe(e,n){if(e.id in n)return n[e.id];try{let a=await import(e.module);return n[e.id]=a,a}catch(a){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function pfe(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function gfe(e,n,a){let t=await Promise.all(e.map(async i=>{let r=n.routes[i.route.id];if(r){let s=await mfe(r,a);return s.links?s.links():[]}return[]}));return Sfe(t.flat(1).filter(pfe).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function w3(e,n,a,t,i,r){let s=(u,c)=>a[c]?u.route.id!==a[c].route.id:!0,o=(u,c)=>a[c].pathname!==u.pathname||a[c].route.path?.endsWith("*")&&a[c].params["*"]!==u.params["*"];return r==="assets"?n.filter((u,c)=>s(u,c)||o(u,c)):r==="data"?n.filter((u,c)=>{let d=t.routes[u.route.id];if(!d||!d.hasLoader)return!1;if(s(u,c)||o(u,c))return!0;if(u.route.shouldRevalidate){let l=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:a[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof l=="boolean")return l}return!0}):[]}function yfe(e,n,{includeHydrateFallback:a}={}){return bfe(e.map(t=>{let i=n.routes[t.route.id];if(!i)return[];let r=[i.module];return i.clientActionModule&&(r=r.concat(i.clientActionModule)),i.clientLoaderModule&&(r=r.concat(i.clientLoaderModule)),a&&i.hydrateFallbackModule&&(r=r.concat(i.hydrateFallbackModule)),i.imports&&(r=r.concat(i.imports)),r}).flat(1))}function bfe(e){return[...new Set(e)]}function vfe(e){let n={},a=Object.keys(e).sort();for(let t of a)n[t]=e[t];return n}function Sfe(e,n){let a=new Set;return new Set(n),e.reduce((t,i)=>{let r=JSON.stringify(vfe(i));return a.has(r)||(a.add(r),t.push({key:r,link:i})),t},[])}function Are(){let e=Et.useContext(rb);return Qk(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function Cfe(){let e=Et.useContext(aE);return Qk(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Yk=Et.createContext(void 0);Yk.displayName="FrameworkContext";function Dre(){let e=Et.useContext(Yk);return Qk(e,"You must render this element inside a <HydratedRouter> element"),e}function _fe(e,n){let a=Et.useContext(Yk),[t,i]=Et.useState(!1),[r,s]=Et.useState(!1),{onFocus:o,onBlur:u,onMouseEnter:c,onMouseLeave:d,onTouchStart:l}=n,f=Et.useRef(null);Et.useEffect(()=>{if(e==="render"&&s(!0),e==="viewport"){let v=h=>{h.forEach(g=>{s(g.isIntersecting)})},m=new IntersectionObserver(v,{threshold:.5});return f.current&&m.observe(f.current),()=>{m.disconnect()}}},[e]),Et.useEffect(()=>{if(t){let v=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(v)}}},[t]);let b=()=>{i(!0)},C=()=>{i(!1),s(!1)};return a?e!=="intent"?[r,f,{}]:[r,f,{onFocus:mv(o,b),onBlur:mv(u,C),onMouseEnter:mv(c,b),onMouseLeave:mv(d,C),onTouchStart:mv(l,b)}]:[!1,f,{}]}function mv(e,n){return a=>{e&&e(a),a.defaultPrevented||n(a)}}function Tfe({page:e,...n}){let{router:a}=Are(),t=Et.useMemo(()=>Tre(a.routes,e,a.basename),[a.routes,e,a.basename]);return t?Et.createElement(Ofe,{page:e,matches:t,...n}):null}function wfe(e){let{manifest:n,routeModules:a}=Dre(),[t,i]=Et.useState([]);return Et.useEffect(()=>{let r=!1;return gfe(e,n,a).then(s=>{r||i(s)}),()=>{r=!0}},[e,n,a]),t}function Ofe({page:e,matches:n,...a}){let t=Hg(),{manifest:i,routeModules:r}=Dre(),{basename:s}=Are(),{loaderData:o,matches:u}=Cfe(),c=Et.useMemo(()=>w3(e,n,u,i,t,"data"),[e,n,u,i,t]),d=Et.useMemo(()=>w3(e,n,u,i,t,"assets"),[e,n,u,i,t]),l=Et.useMemo(()=>{if(e===t.pathname+t.search+t.hash)return[];let C=new Set,v=!1;if(n.forEach(h=>{let g=i.routes[h.route.id];!g||!g.hasLoader||(!c.some(_=>_.route.id===h.route.id)&&h.route.id in o&&r[h.route.id]?.shouldRevalidate||g.hasClientLoader?v=!0:C.add(h.route.id))}),C.size===0)return[];let m=hfe(e,s,"data");return v&&C.size>0&&m.searchParams.set("_routes",n.filter(h=>C.has(h.route.id)).map(h=>h.route.id).join(",")),[m.pathname+m.search]},[s,o,t,i,c,n,e,r]),f=Et.useMemo(()=>yfe(d,i),[d,i]),b=wfe(d);return Et.createElement(Et.Fragment,null,l.map(C=>Et.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...a})),f.map(C=>Et.createElement("link",{key:C,rel:"modulepreload",href:C,...a})),b.map(({key:C,link:v})=>Et.createElement("link",{key:C,nonce:a.nonce,...v})))}function Pfe(...e){return n=>{e.forEach(a=>{typeof a=="function"?a(n):a!=null&&(a.current=n)})}}var kre=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{kre&&(window.__reactRouterVersion="7.9.1")}catch{}function Efe({basename:e,children:n,window:a}){let t=Et.useRef();t.current==null&&(t.current=mle({window:a,v5Compat:!0}));let i=t.current,[r,s]=Et.useState({action:i.action,location:i.location}),o=Et.useCallback(u=>{Et.startTransition(()=>s(u))},[s]);return Et.useLayoutEffect(()=>i.listen(o),[i,o]),Et.createElement(rfe,{basename:e,children:n,location:r.location,navigationType:r.action,navigator:i})}var xre=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qre=Et.forwardRef(function({onClick:n,discover:a="render",prefetch:t="none",relative:i,reloadDocument:r,replace:s,state:o,target:u,to:c,preventScrollReset:d,viewTransition:l,...f},b){let{basename:C}=Et.useContext(_c),v=typeof c=="string"&&xre.test(c),m,h=!1;if(typeof c=="string"&&v&&(m=c,kre))try{let F=new URL(window.location.href),R=c.startsWith("//")?new URL(F.protocol+c):new URL(c),M=ld(R.pathname,C);R.origin===F.origin&&M!=null?c=M+R.search+R.hash:h=!0}catch{zo(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let g=Ule(c,{relative:i}),[_,S,p]=_fe(t,f),w=jfe(c,{replace:s,state:o,target:u,preventScrollReset:d,relative:i,viewTransition:l});function O(F){n&&n(F),F.defaultPrevented||w(F)}let E=Et.createElement("a",{...f,...p,href:m||g,onClick:h||r?n:O,ref:Pfe(b,S),target:u,"data-discover":!v&&a==="render"?"true":void 0});return _&&!v?Et.createElement(Et.Fragment,null,E,Et.createElement(Tfe,{page:g})):E});qre.displayName="Link";var Ife=Et.forwardRef(function({"aria-current":n="page",caseSensitive:a=!1,className:t="",end:i=!1,style:r,to:s,viewTransition:o,children:u,...c},d){let l=nT(s,{relative:c.relative}),f=Hg(),b=Et.useContext(aE),{navigator:C,basename:v}=Et.useContext(_c),m=b!=null&&kfe(l)&&o===!0,h=C.encodeLocation?C.encodeLocation(l).pathname:l.pathname,g=f.pathname,_=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;a||(g=g.toLowerCase(),_=_?_.toLowerCase():null,h=h.toLowerCase()),_&&v&&(_=ld(_,v)||_);const S=h!=="/"&&h.endsWith("/")?h.length-1:h.length;let p=g===h||!i&&g.startsWith(h)&&g.charAt(S)==="/",w=_!=null&&(_===h||!i&&_.startsWith(h)&&_.charAt(h.length)==="/"),O={isActive:p,isPending:w,isTransitioning:m},E=p?n:void 0,F;typeof t=="function"?F=t(O):F=[t,p?"active":null,w?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let R=typeof r=="function"?r(O):r;return Et.createElement(qre,{...c,"aria-current":E,className:F,ref:d,style:R,to:s,viewTransition:o},typeof u=="function"?u(O):u)});Ife.displayName="NavLink";var Rfe=Et.forwardRef(({discover:e="render",fetcherKey:n,navigate:a,reloadDocument:t,replace:i,state:r,method:s=LP,action:o,onSubmit:u,relative:c,preventScrollReset:d,viewTransition:l,...f},b)=>{let C=Afe(),v=Dfe(o,{relative:c}),m=s.toLowerCase()==="get"?"get":"post",h=typeof o=="string"&&xre.test(o),g=_=>{if(u&&u(_),_.defaultPrevented)return;_.preventDefault();let S=_.nativeEvent.submitter,p=S?.getAttribute("formmethod")||s;C(S||_.currentTarget,{fetcherKey:n,method:p,navigate:a,replace:i,state:r,relative:c,preventScrollReset:d,viewTransition:l})};return Et.createElement("form",{ref:b,method:m,action:v,onSubmit:t?u:g,...f,"data-discover":!h&&e==="render"?"true":void 0})});Rfe.displayName="Form";function Ffe(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Lre(e){let n=Et.useContext(rb);return Jr(n,Ffe(e)),n}function jfe(e,{target:n,replace:a,state:t,preventScrollReset:i,relative:r,viewTransition:s}={}){let o=zle(),u=Hg(),c=nT(e,{relative:r});return Et.useCallback(d=>{if(ufe(d,n)){d.preventDefault();let l=a!==void 0?a:Q1(u)===Q1(c);o(e,{replace:l,state:t,preventScrollReset:i,relative:r,viewTransition:s})}},[u,o,c,a,t,n,e,i,r,s])}var Mfe=0,Nfe=()=>`__${String(++Mfe)}__`;function Afe(){let{router:e}=Lre("useSubmit"),{basename:n}=Et.useContext(_c),a=Zle();return Et.useCallback(async(t,i={})=>{let{action:r,method:s,encType:o,formData:u,body:c}=ffe(t,n);if(i.navigate===!1){let d=i.fetcherKey||Nfe();await e.fetch(d,a,i.action||r,{preventScrollReset:i.preventScrollReset,formData:u,body:c,formMethod:i.method||s,formEncType:i.encType||o,flushSync:i.flushSync})}else await e.navigate(i.action||r,{preventScrollReset:i.preventScrollReset,formData:u,body:c,formMethod:i.method||s,formEncType:i.encType||o,replace:i.replace,state:i.state,fromRouteId:a,flushSync:i.flushSync,viewTransition:i.viewTransition})},[e,n,a])}function Dfe(e,{relative:n}={}){let{basename:a}=Et.useContext(_c),t=Et.useContext(fd);Jr(t,"useFormAction must be used inside a RouteContext");let[i]=t.matches.slice(-1),r={...nT(e||".",{relative:n})},s=Hg();if(e==null){r.search=s.search;let o=new URLSearchParams(r.search),u=o.getAll("index");if(u.some(d=>d==="")){o.delete("index"),u.filter(l=>l).forEach(l=>o.append("index",l));let d=o.toString();r.search=d?`?${d}`:""}}return(!e||e===".")&&i.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(r.pathname=r.pathname==="/"?a:dd([a,r.pathname])),Q1(r)}function kfe(e,{relative:n}={}){let a=Et.useContext(Rre);Jr(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:t}=Lre("useViewTransitionState"),i=nT(e,{relative:n});if(!a.isTransitioning)return!1;let r=ld(a.currentLocation.pathname,t)||a.currentLocation.pathname,s=ld(a.nextLocation.pathname,t)||a.nextLocation.pathname;return JP(i.pathname,s)!=null||JP(i.pathname,r)!=null}function xfe(e){return!e||typeof e.errorCode!="number"?!1:e.message===void 0?!0:typeof e.message=="string"}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var pv={},O3;function Xk(){if(O3)return pv;O3=1,pv.byteLength=o,pv.toByteArray=c,pv.fromByteArray=f;for(var e=[],n=[],a=typeof Uint8Array<"u"?Uint8Array:Array,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,r=t.length;i<r;++i)e[i]=t[i],n[t.charCodeAt(i)]=i;n[45]=62,n[95]=63;function s(b){var C=b.length;if(C%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=b.indexOf("=");v===-1&&(v=C);var m=v===C?0:4-v%4;return[v,m]}function o(b){var C=s(b),v=C[0],m=C[1];return(v+m)*3/4-m}function u(b,C,v){return(C+v)*3/4-v}function c(b){var C,v=s(b),m=v[0],h=v[1],g=new a(u(b,m,h)),_=0,S=h>0?m-4:m,p;for(p=0;p<S;p+=4)C=n[b.charCodeAt(p)]<<18|n[b.charCodeAt(p+1)]<<12|n[b.charCodeAt(p+2)]<<6|n[b.charCodeAt(p+3)],g[_++]=C>>16&255,g[_++]=C>>8&255,g[_++]=C&255;return h===2&&(C=n[b.charCodeAt(p)]<<2|n[b.charCodeAt(p+1)]>>4,g[_++]=C&255),h===1&&(C=n[b.charCodeAt(p)]<<10|n[b.charCodeAt(p+1)]<<4|n[b.charCodeAt(p+2)]>>2,g[_++]=C>>8&255,g[_++]=C&255),g}function d(b){return e[b>>18&63]+e[b>>12&63]+e[b>>6&63]+e[b&63]}function l(b,C,v){for(var m,h=[],g=C;g<v;g+=3)m=(b[g]<<16&16711680)+(b[g+1]<<8&65280)+(b[g+2]&255),h.push(d(m));return h.join("")}function f(b){for(var C,v=b.length,m=v%3,h=[],g=16383,_=0,S=v-m;_<S;_+=g)h.push(l(b,_,_+g>S?S:_+g));return m===1?(C=b[v-1],h.push(e[C>>2]+e[C<<4&63]+"==")):m===2&&(C=(b[v-2]<<8)+b[v-1],h.push(e[C>>10]+e[C>>4&63]+e[C<<2&63]+"=")),h.join("")}return pv}var rT=Xk();const qfe="modulepreload",Lfe=function(e){return"/personal-whiteboard-app/dist/"+e},P3={},Zk=function(n,a,t){let i=Promise.resolve();if(a&&a.length>0){let u=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=s?.nonce||s?.getAttribute("nonce");i=u(a.map(c=>{if(c=Lfe(c),c in P3)return;P3[c]=!0;const d=c.endsWith(".css"),l=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${l}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":qfe,d||(f.as="script"),f.crossOrigin="",f.href=c,o&&f.setAttribute("nonce",o),document.head.appendChild(f),d)return new Promise((b,C)=>{f.addEventListener("load",b),f.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&r(o.reason);return n().catch(r)})};var xw={exports:{}},E3;function Bre(){if(E3)return xw.exports;E3=1;var e=typeof Reflect=="object"?Reflect:null,n=e&&typeof e.apply=="function"?e.apply:function(p,w,O){return Function.prototype.apply.call(p,w,O)},a;e&&typeof e.ownKeys=="function"?a=e.ownKeys:Object.getOwnPropertySymbols?a=function(p){return Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p))}:a=function(p){return Object.getOwnPropertyNames(p)};function t(S){console&&console.warn&&console.warn(S)}var i=Number.isNaN||function(p){return p!==p};function r(){r.init.call(this)}xw.exports=r,xw.exports.once=h,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var s=10;function o(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(S){if(typeof S!="number"||S<0||i(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");s=S}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(p){if(typeof p!="number"||p<0||i(p))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+p+".");return this._maxListeners=p,this};function u(S){return S._maxListeners===void 0?r.defaultMaxListeners:S._maxListeners}r.prototype.getMaxListeners=function(){return u(this)},r.prototype.emit=function(p){for(var w=[],O=1;O<arguments.length;O++)w.push(arguments[O]);var E=p==="error",F=this._events;if(F!==void 0)E=E&&F.error===void 0;else if(!E)return!1;if(E){var R;if(w.length>0&&(R=w[0]),R instanceof Error)throw R;var M=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw M.context=R,M}var j=F[p];if(j===void 0)return!1;if(typeof j=="function")n(j,this,w);else for(var k=j.length,x=C(j,k),O=0;O<k;++O)n(x[O],this,w);return!0};function c(S,p,w,O){var E,F,R;if(o(w),F=S._events,F===void 0?(F=S._events=Object.create(null),S._eventsCount=0):(F.newListener!==void 0&&(S.emit("newListener",p,w.listener?w.listener:w),F=S._events),R=F[p]),R===void 0)R=F[p]=w,++S._eventsCount;else if(typeof R=="function"?R=F[p]=O?[w,R]:[R,w]:O?R.unshift(w):R.push(w),E=u(S),E>0&&R.length>E&&!R.warned){R.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(p)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=S,M.type=p,M.count=R.length,t(M)}return S}r.prototype.addListener=function(p,w){return c(this,p,w,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(p,w){return c(this,p,w,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(S,p,w){var O={fired:!1,wrapFn:void 0,target:S,type:p,listener:w},E=d.bind(O);return E.listener=w,O.wrapFn=E,E}r.prototype.once=function(p,w){return o(w),this.on(p,l(this,p,w)),this},r.prototype.prependOnceListener=function(p,w){return o(w),this.prependListener(p,l(this,p,w)),this},r.prototype.removeListener=function(p,w){var O,E,F,R,M;if(o(w),E=this._events,E===void 0)return this;if(O=E[p],O===void 0)return this;if(O===w||O.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete E[p],E.removeListener&&this.emit("removeListener",p,O.listener||w));else if(typeof O!="function"){for(F=-1,R=O.length-1;R>=0;R--)if(O[R]===w||O[R].listener===w){M=O[R].listener,F=R;break}if(F<0)return this;F===0?O.shift():v(O,F),O.length===1&&(E[p]=O[0]),E.removeListener!==void 0&&this.emit("removeListener",p,M||w)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(p){var w,O,E;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[p]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[p]),this;if(arguments.length===0){var F=Object.keys(O),R;for(E=0;E<F.length;++E)R=F[E],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=O[p],typeof w=="function")this.removeListener(p,w);else if(w!==void 0)for(E=w.length-1;E>=0;E--)this.removeListener(p,w[E]);return this};function f(S,p,w){var O=S._events;if(O===void 0)return[];var E=O[p];return E===void 0?[]:typeof E=="function"?w?[E.listener||E]:[E]:w?m(E):C(E,E.length)}r.prototype.listeners=function(p){return f(this,p,!0)},r.prototype.rawListeners=function(p){return f(this,p,!1)},r.listenerCount=function(S,p){return typeof S.listenerCount=="function"?S.listenerCount(p):b.call(S,p)},r.prototype.listenerCount=b;function b(S){var p=this._events;if(p!==void 0){var w=p[S];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]};function C(S,p){for(var w=new Array(p),O=0;O<p;++O)w[O]=S[O];return w}function v(S,p){for(;p+1<S.length;p++)S[p]=S[p+1];S.pop()}function m(S){for(var p=new Array(S.length),w=0;w<p.length;++w)p[w]=S[w].listener||S[w];return p}function h(S,p){return new Promise(function(w,O){function E(R){S.removeListener(p,F),O(R)}function F(){typeof S.removeListener=="function"&&S.removeListener("error",E),w([].slice.call(arguments))}_(S,p,F,{once:!0}),p!=="error"&&g(S,E,{once:!0})})}function g(S,p,w){typeof S.on=="function"&&_(S,"error",p,w)}function _(S,p,w,O){if(typeof S.on=="function")O.once?S.once(p,w):S.on(p,w);else if(typeof S.addEventListener=="function")S.addEventListener(p,function E(F){O.once&&S.removeEventListener(p,E),w(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S)}return xw.exports}const ts=[];for(let e=0;e<256;++e)ts.push((e+256).toString(16).slice(1));function Bfe(e,n=0){return(ts[e[n+0]]+ts[e[n+1]]+ts[e[n+2]]+ts[e[n+3]]+"-"+ts[e[n+4]]+ts[e[n+5]]+"-"+ts[e[n+6]]+ts[e[n+7]]+"-"+ts[e[n+8]]+ts[e[n+9]]+"-"+ts[e[n+10]]+ts[e[n+11]]+ts[e[n+12]]+ts[e[n+13]]+ts[e[n+14]]+ts[e[n+15]]).toLowerCase()}let hF;const Ufe=new Uint8Array(16);function zfe(){if(!hF){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");hF=crypto.getRandomValues.bind(crypto)}return hF(Ufe)}const Vfe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I3={randomUUID:Vfe};function QP(e,n,a){if(I3.randomUUID&&!e)return I3.randomUUID();e=e||{};const t=e.random??e.rng?.()??zfe();if(t.length<16)throw new Error("Random bytes length must be >= 16");return t[6]=t[6]&15|64,t[8]=t[8]&63|128,Bfe(t)}function Ure(e,n){return function(){return e.apply(n,arguments)}}const{toString:Hfe}=Object.prototype,{getPrototypeOf:ex}=Object,{iterator:cE,toStringTag:zre}=Symbol,uE=(e=>n=>{const a=Hfe.call(n);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Ho=e=>(e=e.toLowerCase(),n=>uE(n)===e),dE=e=>n=>typeof n===e,{isArray:ib}=Array,nb=dE("undefined");function iT(e){return e!==null&&!nb(e)&&e.constructor!==null&&!nb(e.constructor)&&$s(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Vre=Ho("ArrayBuffer");function Kfe(e){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(e):n=e&&e.buffer&&Vre(e.buffer),n}const $fe=dE("string"),$s=dE("function"),Hre=dE("number"),sT=e=>e!==null&&typeof e=="object",Gfe=e=>e===!0||e===!1,UP=e=>{if(uE(e)!=="object")return!1;const n=ex(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(zre in e)&&!(cE in e)},Wfe=e=>{if(!sT(e)||iT(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Jfe=Ho("Date"),Qfe=Ho("File"),Yfe=Ho("Blob"),Xfe=Ho("FileList"),Zfe=e=>sT(e)&&$s(e.pipe),ehe=e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||$s(e.append)&&((n=uE(e))==="formdata"||n==="object"&&$s(e.toString)&&e.toString()==="[object FormData]"))},the=Ho("URLSearchParams"),[nhe,rhe,ihe,she]=["ReadableStream","Request","Response","Headers"].map(Ho),ahe=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function aT(e,n,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let t,i;if(typeof e!="object"&&(e=[e]),ib(e))for(t=0,i=e.length;t<i;t++)n.call(null,e[t],t,e);else{if(iT(e))return;const r=a?Object.getOwnPropertyNames(e):Object.keys(e),s=r.length;let o;for(t=0;t<s;t++)o=r[t],n.call(null,e[o],o,e)}}function Kre(e,n){if(iT(e))return null;n=n.toLowerCase();const a=Object.keys(e);let t=a.length,i;for(;t-- >0;)if(i=a[t],n===i.toLowerCase())return i;return null}const xg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,$re=e=>!nb(e)&&e!==xg;function yk(){const{caseless:e,skipUndefined:n}=$re(this)&&this||{},a={},t=(i,r)=>{const s=e&&Kre(a,r)||r;UP(a[s])&&UP(i)?a[s]=yk(a[s],i):UP(i)?a[s]=yk({},i):ib(i)?a[s]=i.slice():(!n||!nb(i))&&(a[s]=i)};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&aT(arguments[i],t);return a}const ohe=(e,n,a,{allOwnKeys:t}={})=>(aT(n,(i,r)=>{a&&$s(i)?e[r]=Ure(i,a):e[r]=i},{allOwnKeys:t}),e),che=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),uhe=(e,n,a,t)=>{e.prototype=Object.create(n.prototype,t),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),a&&Object.assign(e.prototype,a)},dhe=(e,n,a,t)=>{let i,r,s;const o={};if(n=n||{},e==null)return n;do{for(i=Object.getOwnPropertyNames(e),r=i.length;r-- >0;)s=i[r],(!t||t(s,e,n))&&!o[s]&&(n[s]=e[s],o[s]=!0);e=a!==!1&&ex(e)}while(e&&(!a||a(e,n))&&e!==Object.prototype);return n},lhe=(e,n,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=n.length;const t=e.indexOf(n,a);return t!==-1&&t===a},fhe=e=>{if(!e)return null;if(ib(e))return e;let n=e.length;if(!Hre(n))return null;const a=new Array(n);for(;n-- >0;)a[n]=e[n];return a},hhe=(e=>n=>e&&n instanceof e)(typeof Uint8Array<"u"&&ex(Uint8Array)),mhe=(e,n)=>{const t=(e&&e[cE]).call(e);let i;for(;(i=t.next())&&!i.done;){const r=i.value;n.call(e,r[0],r[1])}},phe=(e,n)=>{let a;const t=[];for(;(a=e.exec(n))!==null;)t.push(a);return t},ghe=Ho("HTMLFormElement"),yhe=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,t,i){return t.toUpperCase()+i}),R3=(({hasOwnProperty:e})=>(n,a)=>e.call(n,a))(Object.prototype),bhe=Ho("RegExp"),Gre=(e,n)=>{const a=Object.getOwnPropertyDescriptors(e),t={};aT(a,(i,r)=>{let s;(s=n(i,r,e))!==!1&&(t[r]=s||i)}),Object.defineProperties(e,t)},vhe=e=>{Gre(e,(n,a)=>{if($s(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const t=e[a];if($s(t)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},She=(e,n)=>{const a={},t=i=>{i.forEach(r=>{a[r]=!0})};return ib(e)?t(e):t(String(e).split(n)),a},Che=()=>{},_he=(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n;function The(e){return!!(e&&$s(e.append)&&e[zre]==="FormData"&&e[cE])}const whe=e=>{const n=new Array(10),a=(t,i)=>{if(sT(t)){if(n.indexOf(t)>=0)return;if(iT(t))return t;if(!("toJSON"in t)){n[i]=t;const r=ib(t)?[]:{};return aT(t,(s,o)=>{const u=a(s,i+1);!nb(u)&&(r[o]=u)}),n[i]=void 0,r}}return t};return a(e,0)},Ohe=Ho("AsyncFunction"),Phe=e=>e&&(sT(e)||$s(e))&&$s(e.then)&&$s(e.catch),Wre=((e,n)=>e?setImmediate:n?((a,t)=>(xg.addEventListener("message",({source:i,data:r})=>{i===xg&&r===a&&t.length&&t.shift()()},!1),i=>{t.push(i),xg.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",$s(xg.postMessage)),Ehe=typeof queueMicrotask<"u"?queueMicrotask.bind(xg):typeof process<"u"&&process.nextTick||Wre,Ihe=e=>e!=null&&$s(e[cE]),_t={isArray:ib,isArrayBuffer:Vre,isBuffer:iT,isFormData:ehe,isArrayBufferView:Kfe,isString:$fe,isNumber:Hre,isBoolean:Gfe,isObject:sT,isPlainObject:UP,isEmptyObject:Wfe,isReadableStream:nhe,isRequest:rhe,isResponse:ihe,isHeaders:she,isUndefined:nb,isDate:Jfe,isFile:Qfe,isBlob:Yfe,isRegExp:bhe,isFunction:$s,isStream:Zfe,isURLSearchParams:the,isTypedArray:hhe,isFileList:Xfe,forEach:aT,merge:yk,extend:ohe,trim:ahe,stripBOM:che,inherits:uhe,toFlatObject:dhe,kindOf:uE,kindOfTest:Ho,endsWith:lhe,toArray:fhe,forEachEntry:mhe,matchAll:phe,isHTMLForm:ghe,hasOwnProperty:R3,hasOwnProp:R3,reduceDescriptors:Gre,freezeMethods:vhe,toObjectSet:She,toCamelCase:yhe,noop:Che,toFiniteNumber:_he,findKey:Kre,global:xg,isContextDefined:$re,isSpecCompliantForm:The,toJSONObject:whe,isAsyncFn:Ohe,isThenable:Phe,setImmediate:Wre,asap:Ehe,isIterable:Ihe};function yn(e,n,a,t,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),a&&(this.config=a),t&&(this.request=t),i&&(this.response=i,this.status=i.status?i.status:null)}_t.inherits(yn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_t.toJSONObject(this.config),code:this.code,status:this.status}}});const Jre=yn.prototype,Qre={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Qre[e]={value:e}});Object.defineProperties(yn,Qre);Object.defineProperty(Jre,"isAxiosError",{value:!0});yn.from=(e,n,a,t,i,r)=>{const s=Object.create(Jre);_t.toFlatObject(e,s,function(d){return d!==Error.prototype},c=>c!=="isAxiosError");const o=e&&e.message?e.message:"Error",u=n==null&&e?e.code:n;return yn.call(s,o,u,a,t,i),e&&s.cause==null&&Object.defineProperty(s,"cause",{value:e,configurable:!0}),s.name=e&&e.name||"Error",r&&Object.assign(s,r),s};const Rhe=null;function bk(e){return _t.isPlainObject(e)||_t.isArray(e)}function Yre(e){return _t.endsWith(e,"[]")?e.slice(0,-2):e}function F3(e,n,a){return e?e.concat(n).map(function(i,r){return i=Yre(i),!a&&r?"["+i+"]":i}).join(a?".":""):n}function Fhe(e){return _t.isArray(e)&&!e.some(bk)}const jhe=_t.toFlatObject(_t,{},null,function(n){return/^is[A-Z]/.test(n)});function lE(e,n,a){if(!_t.isObject(e))throw new TypeError("target must be an object");n=n||new FormData,a=_t.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,m){return!_t.isUndefined(m[v])});const t=a.metaTokens,i=a.visitor||d,r=a.dots,s=a.indexes,u=(a.Blob||typeof Blob<"u"&&Blob)&&_t.isSpecCompliantForm(n);if(!_t.isFunction(i))throw new TypeError("visitor must be a function");function c(C){if(C===null)return"";if(_t.isDate(C))return C.toISOString();if(_t.isBoolean(C))return C.toString();if(!u&&_t.isBlob(C))throw new yn("Blob is not supported. Use a Buffer instead.");return _t.isArrayBuffer(C)||_t.isTypedArray(C)?u&&typeof Blob=="function"?new Blob([C]):Buffer.from(C):C}function d(C,v,m){let h=C;if(C&&!m&&typeof C=="object"){if(_t.endsWith(v,"{}"))v=t?v:v.slice(0,-2),C=JSON.stringify(C);else if(_t.isArray(C)&&Fhe(C)||(_t.isFileList(C)||_t.endsWith(v,"[]"))&&(h=_t.toArray(C)))return v=Yre(v),h.forEach(function(_,S){!(_t.isUndefined(_)||_===null)&&n.append(s===!0?F3([v],S,r):s===null?v:v+"[]",c(_))}),!1}return bk(C)?!0:(n.append(F3(m,v,r),c(C)),!1)}const l=[],f=Object.assign(jhe,{defaultVisitor:d,convertValue:c,isVisitable:bk});function b(C,v){if(!_t.isUndefined(C)){if(l.indexOf(C)!==-1)throw Error("Circular reference detected in "+v.join("."));l.push(C),_t.forEach(C,function(h,g){(!(_t.isUndefined(h)||h===null)&&i.call(n,h,_t.isString(g)?g.trim():g,v,f))===!0&&b(h,v?v.concat(g):[g])}),l.pop()}}if(!_t.isObject(e))throw new TypeError("data must be an object");return b(e),n}function j3(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(t){return n[t]})}function tx(e,n){this._pairs=[],e&&lE(e,this,n)}const Xre=tx.prototype;Xre.append=function(n,a){this._pairs.push([n,a])};Xre.toString=function(n){const a=n?function(t){return n.call(this,t,j3)}:j3;return this._pairs.map(function(i){return a(i[0])+"="+a(i[1])},"").join("&")};function Mhe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Zre(e,n,a){if(!n)return e;const t=a&&a.encode||Mhe;_t.isFunction(a)&&(a={serialize:a});const i=a&&a.serialize;let r;if(i?r=i(n,a):r=_t.isURLSearchParams(n)?n.toString():new tx(n,a).toString(t),r){const s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+r}return e}class M3{constructor(){this.handlers=[]}use(n,a,t){return this.handlers.push({fulfilled:n,rejected:a,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){_t.forEach(this.handlers,function(t){t!==null&&n(t)})}}const eie={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Nhe=typeof URLSearchParams<"u"?URLSearchParams:tx,Ahe=typeof FormData<"u"?FormData:null,Dhe=typeof Blob<"u"?Blob:null,khe={isBrowser:!0,classes:{URLSearchParams:Nhe,FormData:Ahe,Blob:Dhe},protocols:["http","https","file","blob","url","data"]},nx=typeof window<"u"&&typeof document<"u",vk=typeof navigator=="object"&&navigator||void 0,xhe=nx&&(!vk||["ReactNative","NativeScript","NS"].indexOf(vk.product)<0),qhe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Lhe=nx&&window.location.href||"http://localhost",Bhe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:nx,hasStandardBrowserEnv:xhe,hasStandardBrowserWebWorkerEnv:qhe,navigator:vk,origin:Lhe},Symbol.toStringTag,{value:"Module"})),ps={...Bhe,...khe};function Uhe(e,n){return lE(e,new ps.classes.URLSearchParams,{visitor:function(a,t,i,r){return ps.isNode&&_t.isBuffer(a)?(this.append(t,a.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...n})}function zhe(e){return _t.matchAll(/\w+|\[(\w*)]/g,e).map(n=>n[0]==="[]"?"":n[1]||n[0])}function Vhe(e){const n={},a=Object.keys(e);let t;const i=a.length;let r;for(t=0;t<i;t++)r=a[t],n[r]=e[r];return n}function tie(e){function n(a,t,i,r){let s=a[r++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),u=r>=a.length;return s=!s&&_t.isArray(i)?i.length:s,u?(_t.hasOwnProp(i,s)?i[s]=[i[s],t]:i[s]=t,!o):((!i[s]||!_t.isObject(i[s]))&&(i[s]=[]),n(a,t,i[s],r)&&_t.isArray(i[s])&&(i[s]=Vhe(i[s])),!o)}if(_t.isFormData(e)&&_t.isFunction(e.entries)){const a={};return _t.forEachEntry(e,(t,i)=>{n(zhe(t),i,a,0)}),a}return null}function Hhe(e,n,a){if(_t.isString(e))try{return(n||JSON.parse)(e),_t.trim(e)}catch(t){if(t.name!=="SyntaxError")throw t}return(a||JSON.stringify)(e)}const oT={transitional:eie,adapter:["xhr","http","fetch"],transformRequest:[function(n,a){const t=a.getContentType()||"",i=t.indexOf("application/json")>-1,r=_t.isObject(n);if(r&&_t.isHTMLForm(n)&&(n=new FormData(n)),_t.isFormData(n))return i?JSON.stringify(tie(n)):n;if(_t.isArrayBuffer(n)||_t.isBuffer(n)||_t.isStream(n)||_t.isFile(n)||_t.isBlob(n)||_t.isReadableStream(n))return n;if(_t.isArrayBufferView(n))return n.buffer;if(_t.isURLSearchParams(n))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let o;if(r){if(t.indexOf("application/x-www-form-urlencoded")>-1)return Uhe(n,this.formSerializer).toString();if((o=_t.isFileList(n))||t.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return lE(o?{"files[]":n}:n,u&&new u,this.formSerializer)}}return r||i?(a.setContentType("application/json",!1),Hhe(n)):n}],transformResponse:[function(n){const a=this.transitional||oT.transitional,t=a&&a.forcedJSONParsing,i=this.responseType==="json";if(_t.isResponse(n)||_t.isReadableStream(n))return n;if(n&&_t.isString(n)&&(t&&!this.responseType||i)){const s=!(a&&a.silentJSONParsing)&&i;try{return JSON.parse(n,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?yn.from(o,yn.ERR_BAD_RESPONSE,this,null,this.response):o}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ps.classes.FormData,Blob:ps.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_t.forEach(["delete","get","head","post","put","patch"],e=>{oT.headers[e]={}});const Khe=_t.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$he=e=>{const n={};let a,t,i;return e&&e.split(`
`).forEach(function(s){i=s.indexOf(":"),a=s.substring(0,i).trim().toLowerCase(),t=s.substring(i+1).trim(),!(!a||n[a]&&Khe[a])&&(a==="set-cookie"?n[a]?n[a].push(t):n[a]=[t]:n[a]=n[a]?n[a]+", "+t:t)}),n},N3=Symbol("internals");function gv(e){return e&&String(e).trim().toLowerCase()}function zP(e){return e===!1||e==null?e:_t.isArray(e)?e.map(zP):String(e)}function Ghe(e){const n=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=a.exec(e);)n[t[1]]=t[2];return n}const Whe=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function mF(e,n,a,t,i){if(_t.isFunction(t))return t.call(this,n,a);if(i&&(n=a),!!_t.isString(n)){if(_t.isString(t))return n.indexOf(t)!==-1;if(_t.isRegExp(t))return t.test(n)}}function Jhe(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,a,t)=>a.toUpperCase()+t)}function Qhe(e,n){const a=_t.toCamelCase(" "+n);["get","set","has"].forEach(t=>{Object.defineProperty(e,t+a,{value:function(i,r,s){return this[t].call(this,n,i,r,s)},configurable:!0})})}let Gs=class{constructor(n){n&&this.set(n)}set(n,a,t){const i=this;function r(o,u,c){const d=gv(u);if(!d)throw new Error("header name must be a non-empty string");const l=_t.findKey(i,d);(!l||i[l]===void 0||c===!0||c===void 0&&i[l]!==!1)&&(i[l||u]=zP(o))}const s=(o,u)=>_t.forEach(o,(c,d)=>r(c,d,u));if(_t.isPlainObject(n)||n instanceof this.constructor)s(n,a);else if(_t.isString(n)&&(n=n.trim())&&!Whe(n))s($he(n),a);else if(_t.isObject(n)&&_t.isIterable(n)){let o={},u,c;for(const d of n){if(!_t.isArray(d))throw TypeError("Object iterator must return a key-value pair");o[c=d[0]]=(u=o[c])?_t.isArray(u)?[...u,d[1]]:[u,d[1]]:d[1]}s(o,a)}else n!=null&&r(a,n,t);return this}get(n,a){if(n=gv(n),n){const t=_t.findKey(this,n);if(t){const i=this[t];if(!a)return i;if(a===!0)return Ghe(i);if(_t.isFunction(a))return a.call(this,i,t);if(_t.isRegExp(a))return a.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,a){if(n=gv(n),n){const t=_t.findKey(this,n);return!!(t&&this[t]!==void 0&&(!a||mF(this,this[t],t,a)))}return!1}delete(n,a){const t=this;let i=!1;function r(s){if(s=gv(s),s){const o=_t.findKey(t,s);o&&(!a||mF(t,t[o],o,a))&&(delete t[o],i=!0)}}return _t.isArray(n)?n.forEach(r):r(n),i}clear(n){const a=Object.keys(this);let t=a.length,i=!1;for(;t--;){const r=a[t];(!n||mF(this,this[r],r,n,!0))&&(delete this[r],i=!0)}return i}normalize(n){const a=this,t={};return _t.forEach(this,(i,r)=>{const s=_t.findKey(t,r);if(s){a[s]=zP(i),delete a[r];return}const o=n?Jhe(r):String(r).trim();o!==r&&delete a[r],a[o]=zP(i),t[o]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const a=Object.create(null);return _t.forEach(this,(t,i)=>{t!=null&&t!==!1&&(a[i]=n&&_t.isArray(t)?t.join(", "):t)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,a])=>n+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...a){const t=new this(n);return a.forEach(i=>t.set(i)),t}static accessor(n){const t=(this[N3]=this[N3]={accessors:{}}).accessors,i=this.prototype;function r(s){const o=gv(s);t[o]||(Qhe(i,s),t[o]=!0)}return _t.isArray(n)?n.forEach(r):r(n),this}};Gs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);_t.reduceDescriptors(Gs.prototype,({value:e},n)=>{let a=n[0].toUpperCase()+n.slice(1);return{get:()=>e,set(t){this[a]=t}}});_t.freezeMethods(Gs);function pF(e,n){const a=this||oT,t=n||a,i=Gs.from(t.headers);let r=t.data;return _t.forEach(e,function(o){r=o.call(a,r,i.normalize(),n?n.status:void 0)}),i.normalize(),r}function nie(e){return!!(e&&e.__CANCEL__)}function sb(e,n,a){yn.call(this,e??"canceled",yn.ERR_CANCELED,n,a),this.name="CanceledError"}_t.inherits(sb,yn,{__CANCEL__:!0});function rie(e,n,a){const t=a.config.validateStatus;!a.status||!t||t(a.status)?e(a):n(new yn("Request failed with status code "+a.status,[yn.ERR_BAD_REQUEST,yn.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function Yhe(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}function Xhe(e,n){e=e||10;const a=new Array(e),t=new Array(e);let i=0,r=0,s;return n=n!==void 0?n:1e3,function(u){const c=Date.now(),d=t[r];s||(s=c),a[i]=u,t[i]=c;let l=r,f=0;for(;l!==i;)f+=a[l++],l=l%e;if(i=(i+1)%e,i===r&&(r=(r+1)%e),c-s<n)return;const b=d&&c-d;return b?Math.round(f*1e3/b):void 0}}function Zhe(e,n){let a=0,t=1e3/n,i,r;const s=(c,d=Date.now())=>{a=d,i=null,r&&(clearTimeout(r),r=null),e(...c)};return[(...c)=>{const d=Date.now(),l=d-a;l>=t?s(c,d):(i=c,r||(r=setTimeout(()=>{r=null,s(i)},t-l)))},()=>i&&s(i)]}const YP=(e,n,a=3)=>{let t=0;const i=Xhe(50,250);return Zhe(r=>{const s=r.loaded,o=r.lengthComputable?r.total:void 0,u=s-t,c=i(u),d=s<=o;t=s;const l={loaded:s,total:o,progress:o?s/o:void 0,bytes:u,rate:c||void 0,estimated:c&&o&&d?(o-s)/c:void 0,event:r,lengthComputable:o!=null,[n?"download":"upload"]:!0};e(l)},a)},A3=(e,n)=>{const a=e!=null;return[t=>n[0]({lengthComputable:a,total:e,loaded:t}),n[1]]},D3=e=>(...n)=>_t.asap(()=>e(...n)),eme=ps.hasStandardBrowserEnv?((e,n)=>a=>(a=new URL(a,ps.origin),e.protocol===a.protocol&&e.host===a.host&&(n||e.port===a.port)))(new URL(ps.origin),ps.navigator&&/(msie|trident)/i.test(ps.navigator.userAgent)):()=>!0,tme=ps.hasStandardBrowserEnv?{write(e,n,a,t,i,r){const s=[e+"="+encodeURIComponent(n)];_t.isNumber(a)&&s.push("expires="+new Date(a).toGMTString()),_t.isString(t)&&s.push("path="+t),_t.isString(i)&&s.push("domain="+i),r===!0&&s.push("secure"),document.cookie=s.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function nme(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function rme(e,n){return n?e.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):e}function iie(e,n,a){let t=!nme(n);return e&&(t||a==!1)?rme(e,n):n}const k3=e=>e instanceof Gs?{...e}:e;function zg(e,n){n=n||{};const a={};function t(c,d,l,f){return _t.isPlainObject(c)&&_t.isPlainObject(d)?_t.merge.call({caseless:f},c,d):_t.isPlainObject(d)?_t.merge({},d):_t.isArray(d)?d.slice():d}function i(c,d,l,f){if(_t.isUndefined(d)){if(!_t.isUndefined(c))return t(void 0,c,l,f)}else return t(c,d,l,f)}function r(c,d){if(!_t.isUndefined(d))return t(void 0,d)}function s(c,d){if(_t.isUndefined(d)){if(!_t.isUndefined(c))return t(void 0,c)}else return t(void 0,d)}function o(c,d,l){if(l in n)return t(c,d);if(l in e)return t(void 0,c)}const u={url:r,method:r,data:r,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(c,d,l)=>i(k3(c),k3(d),l,!0)};return _t.forEach(Object.keys({...e,...n}),function(d){const l=u[d]||i,f=l(e[d],n[d],d);_t.isUndefined(f)&&l!==o||(a[d]=f)}),a}const sie=e=>{const n=zg({},e);let{data:a,withXSRFToken:t,xsrfHeaderName:i,xsrfCookieName:r,headers:s,auth:o}=n;if(n.headers=s=Gs.from(s),n.url=Zre(iie(n.baseURL,n.url,n.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),_t.isFormData(a)){if(ps.hasStandardBrowserEnv||ps.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(_t.isFunction(a.getHeaders)){const u=a.getHeaders(),c=["content-type","content-length"];Object.entries(u).forEach(([d,l])=>{c.includes(d.toLowerCase())&&s.set(d,l)})}}if(ps.hasStandardBrowserEnv&&(t&&_t.isFunction(t)&&(t=t(n)),t||t!==!1&&eme(n.url))){const u=i&&r&&tme.read(r);u&&s.set(i,u)}return n},ime=typeof XMLHttpRequest<"u",sme=ime&&function(e){return new Promise(function(a,t){const i=sie(e);let r=i.data;const s=Gs.from(i.headers).normalize();let{responseType:o,onUploadProgress:u,onDownloadProgress:c}=i,d,l,f,b,C;function v(){b&&b(),C&&C(),i.cancelToken&&i.cancelToken.unsubscribe(d),i.signal&&i.signal.removeEventListener("abort",d)}let m=new XMLHttpRequest;m.open(i.method.toUpperCase(),i.url,!0),m.timeout=i.timeout;function h(){if(!m)return;const _=Gs.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders()),p={data:!o||o==="text"||o==="json"?m.responseText:m.response,status:m.status,statusText:m.statusText,headers:_,config:e,request:m};rie(function(O){a(O),v()},function(O){t(O),v()},p),m=null}"onloadend"in m?m.onloadend=h:m.onreadystatechange=function(){!m||m.readyState!==4||m.status===0&&!(m.responseURL&&m.responseURL.indexOf("file:")===0)||setTimeout(h)},m.onabort=function(){m&&(t(new yn("Request aborted",yn.ECONNABORTED,e,m)),m=null)},m.onerror=function(S){const p=S&&S.message?S.message:"Network Error",w=new yn(p,yn.ERR_NETWORK,e,m);w.event=S||null,t(w),m=null},m.ontimeout=function(){let S=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const p=i.transitional||eie;i.timeoutErrorMessage&&(S=i.timeoutErrorMessage),t(new yn(S,p.clarifyTimeoutError?yn.ETIMEDOUT:yn.ECONNABORTED,e,m)),m=null},r===void 0&&s.setContentType(null),"setRequestHeader"in m&&_t.forEach(s.toJSON(),function(S,p){m.setRequestHeader(p,S)}),_t.isUndefined(i.withCredentials)||(m.withCredentials=!!i.withCredentials),o&&o!=="json"&&(m.responseType=i.responseType),c&&([f,C]=YP(c,!0),m.addEventListener("progress",f)),u&&m.upload&&([l,b]=YP(u),m.upload.addEventListener("progress",l),m.upload.addEventListener("loadend",b)),(i.cancelToken||i.signal)&&(d=_=>{m&&(t(!_||_.type?new sb(null,e,m):_),m.abort(),m=null)},i.cancelToken&&i.cancelToken.subscribe(d),i.signal&&(i.signal.aborted?d():i.signal.addEventListener("abort",d)));const g=Yhe(i.url);if(g&&ps.protocols.indexOf(g)===-1){t(new yn("Unsupported protocol "+g+":",yn.ERR_BAD_REQUEST,e));return}m.send(r||null)})},ame=(e,n)=>{const{length:a}=e=e?e.filter(Boolean):[];if(n||a){let t=new AbortController,i;const r=function(c){if(!i){i=!0,o();const d=c instanceof Error?c:this.reason;t.abort(d instanceof yn?d:new sb(d instanceof Error?d.message:d))}};let s=n&&setTimeout(()=>{s=null,r(new yn(`timeout ${n} of ms exceeded`,yn.ETIMEDOUT))},n);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(c=>{c.unsubscribe?c.unsubscribe(r):c.removeEventListener("abort",r)}),e=null)};e.forEach(c=>c.addEventListener("abort",r));const{signal:u}=t;return u.unsubscribe=()=>_t.asap(o),u}},ome=function*(e,n){let a=e.byteLength;if(a<n){yield e;return}let t=0,i;for(;t<a;)i=t+n,yield e.slice(t,i),t=i},cme=async function*(e,n){for await(const a of ume(e))yield*ome(a,n)},ume=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const n=e.getReader();try{for(;;){const{done:a,value:t}=await n.read();if(a)break;yield t}}finally{await n.cancel()}},x3=(e,n,a,t)=>{const i=cme(e,n);let r=0,s,o=u=>{s||(s=!0,t&&t(u))};return new ReadableStream({async pull(u){try{const{done:c,value:d}=await i.next();if(c){o(),u.close();return}let l=d.byteLength;if(a){let f=r+=l;a(f)}u.enqueue(new Uint8Array(d))}catch(c){throw o(c),c}},cancel(u){return o(u),i.return()}},{highWaterMark:2})},q3=64*1024,{isFunction:qw}=_t,dme=(({Request:e,Response:n})=>({Request:e,Response:n}))(_t.global),{ReadableStream:L3,TextEncoder:B3}=_t.global,U3=(e,...n)=>{try{return!!e(...n)}catch{return!1}},lme=e=>{e=_t.merge.call({skipUndefined:!0},dme,e);const{fetch:n,Request:a,Response:t}=e,i=n?qw(n):typeof fetch=="function",r=qw(a),s=qw(t);if(!i)return!1;const o=i&&qw(L3),u=i&&(typeof B3=="function"?(C=>v=>C.encode(v))(new B3):async C=>new Uint8Array(await new a(C).arrayBuffer())),c=r&&o&&U3(()=>{let C=!1;const v=new a(ps.origin,{body:new L3,method:"POST",get duplex(){return C=!0,"half"}}).headers.has("Content-Type");return C&&!v}),d=s&&o&&U3(()=>_t.isReadableStream(new t("").body)),l={stream:d&&(C=>C.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(C=>{!l[C]&&(l[C]=(v,m)=>{let h=v&&v[C];if(h)return h.call(v);throw new yn(`Response type '${C}' is not supported`,yn.ERR_NOT_SUPPORT,m)})});const f=async C=>{if(C==null)return 0;if(_t.isBlob(C))return C.size;if(_t.isSpecCompliantForm(C))return(await new a(ps.origin,{method:"POST",body:C}).arrayBuffer()).byteLength;if(_t.isArrayBufferView(C)||_t.isArrayBuffer(C))return C.byteLength;if(_t.isURLSearchParams(C)&&(C=C+""),_t.isString(C))return(await u(C)).byteLength},b=async(C,v)=>{const m=_t.toFiniteNumber(C.getContentLength());return m??f(v)};return async C=>{let{url:v,method:m,data:h,signal:g,cancelToken:_,timeout:S,onDownloadProgress:p,onUploadProgress:w,responseType:O,headers:E,withCredentials:F="same-origin",fetchOptions:R}=sie(C),M=n||fetch;O=O?(O+"").toLowerCase():"text";let j=ame([g,_&&_.toAbortSignal()],S),k=null;const x=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let L;try{if(w&&c&&m!=="get"&&m!=="head"&&(L=await b(E,h))!==0){let fe=new a(v,{method:"POST",body:h,duplex:"half"}),oe;if(_t.isFormData(h)&&(oe=fe.headers.get("content-type"))&&E.setContentType(oe),fe.body){const[pe,de]=A3(L,YP(D3(w)));h=x3(fe.body,q3,pe,de)}}_t.isString(F)||(F=F?"include":"omit");const V=r&&"credentials"in a.prototype,G={...R,signal:j,method:m.toUpperCase(),headers:E.normalize().toJSON(),body:h,duplex:"half",credentials:V?F:void 0};k=r&&new a(v,G);let ee=await(r?M(k,R):M(v,G));const se=d&&(O==="stream"||O==="response");if(d&&(p||se&&x)){const fe={};["status","statusText","headers"].forEach(ge=>{fe[ge]=ee[ge]});const oe=_t.toFiniteNumber(ee.headers.get("content-length")),[pe,de]=p&&A3(oe,YP(D3(p),!0))||[];ee=new t(x3(ee.body,q3,pe,()=>{de&&de(),x&&x()}),fe)}O=O||"text";let re=await l[_t.findKey(l,O)||"text"](ee,C);return!se&&x&&x(),await new Promise((fe,oe)=>{rie(fe,oe,{data:re,headers:Gs.from(ee.headers),status:ee.status,statusText:ee.statusText,config:C,request:k})})}catch(V){throw x&&x(),V&&V.name==="TypeError"&&/Load failed|fetch/i.test(V.message)?Object.assign(new yn("Network Error",yn.ERR_NETWORK,C,k),{cause:V.cause||V}):yn.from(V,V&&V.code,C,k)}}},fme=new Map,aie=e=>{let n=e?e.env:{};const{fetch:a,Request:t,Response:i}=n,r=[t,i,a];let s=r.length,o=s,u,c,d=fme;for(;o--;)u=r[o],c=d.get(u),c===void 0&&d.set(u,c=o?new Map:lme(n)),d=c;return c};aie();const Sk={http:Rhe,xhr:sme,fetch:{get:aie}};_t.forEach(Sk,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const z3=e=>`- ${e}`,hme=e=>_t.isFunction(e)||e===null||e===!1,oie={getAdapter:(e,n)=>{e=_t.isArray(e)?e:[e];const{length:a}=e;let t,i;const r={};for(let s=0;s<a;s++){t=e[s];let o;if(i=t,!hme(t)&&(i=Sk[(o=String(t)).toLowerCase()],i===void 0))throw new yn(`Unknown adapter '${o}'`);if(i&&(_t.isFunction(i)||(i=i.get(n))))break;r[o||"#"+s]=i}if(!i){const s=Object.entries(r).map(([u,c])=>`adapter ${u} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=a?s.length>1?`since :
`+s.map(z3).join(`
`):" "+z3(s[0]):"as no adapter specified";throw new yn("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i},adapters:Sk};function gF(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new sb(null,e)}function V3(e){return gF(e),e.headers=Gs.from(e.headers),e.data=pF.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),oie.getAdapter(e.adapter||oT.adapter,e)(e).then(function(t){return gF(e),t.data=pF.call(e,e.transformResponse,t),t.headers=Gs.from(t.headers),t},function(t){return nie(t)||(gF(e),t&&t.response&&(t.response.data=pF.call(e,e.transformResponse,t.response),t.response.headers=Gs.from(t.response.headers))),Promise.reject(t)})}const cie="1.12.2",fE={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{fE[e]=function(t){return typeof t===e||"a"+(n<1?"n ":" ")+e}});const H3={};fE.transitional=function(n,a,t){function i(r,s){return"[Axios v"+cie+"] Transitional option '"+r+"'"+s+(t?". "+t:"")}return(r,s,o)=>{if(n===!1)throw new yn(i(s," has been removed"+(a?" in "+a:"")),yn.ERR_DEPRECATED);return a&&!H3[s]&&(H3[s]=!0,console.warn(i(s," has been deprecated since v"+a+" and will be removed in the near future"))),n?n(r,s,o):!0}};fE.spelling=function(n){return(a,t)=>(console.warn(`${t} is likely a misspelling of ${n}`),!0)};function mme(e,n,a){if(typeof e!="object")throw new yn("options must be an object",yn.ERR_BAD_OPTION_VALUE);const t=Object.keys(e);let i=t.length;for(;i-- >0;){const r=t[i],s=n[r];if(s){const o=e[r],u=o===void 0||s(o,r,e);if(u!==!0)throw new yn("option "+r+" must be "+u,yn.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new yn("Unknown option "+r,yn.ERR_BAD_OPTION)}}const VP={assertOptions:mme,validators:fE},oc=VP.validators;let Lg=class{constructor(n){this.defaults=n||{},this.interceptors={request:new M3,response:new M3}}async request(n,a){try{return await this._request(n,a)}catch(t){if(t instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{t.stack?r&&!String(t.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+r):t.stack=r}catch{}}throw t}}_request(n,a){typeof n=="string"?(a=a||{},a.url=n):a=n||{},a=zg(this.defaults,a);const{transitional:t,paramsSerializer:i,headers:r}=a;t!==void 0&&VP.assertOptions(t,{silentJSONParsing:oc.transitional(oc.boolean),forcedJSONParsing:oc.transitional(oc.boolean),clarifyTimeoutError:oc.transitional(oc.boolean)},!1),i!=null&&(_t.isFunction(i)?a.paramsSerializer={serialize:i}:VP.assertOptions(i,{encode:oc.function,serialize:oc.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),VP.assertOptions(a,{baseUrl:oc.spelling("baseURL"),withXsrfToken:oc.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let s=r&&_t.merge(r.common,r[a.method]);r&&_t.forEach(["delete","get","head","post","put","patch","common"],C=>{delete r[C]}),a.headers=Gs.concat(s,r);const o=[];let u=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(a)===!1||(u=u&&v.synchronous,o.unshift(v.fulfilled,v.rejected))});const c=[];this.interceptors.response.forEach(function(v){c.push(v.fulfilled,v.rejected)});let d,l=0,f;if(!u){const C=[V3.bind(this),void 0];for(C.unshift(...o),C.push(...c),f=C.length,d=Promise.resolve(a);l<f;)d=d.then(C[l++],C[l++]);return d}f=o.length;let b=a;for(;l<f;){const C=o[l++],v=o[l++];try{b=C(b)}catch(m){v.call(this,m);break}}try{d=V3.call(this,b)}catch(C){return Promise.reject(C)}for(l=0,f=c.length;l<f;)d=d.then(c[l++],c[l++]);return d}getUri(n){n=zg(this.defaults,n);const a=iie(n.baseURL,n.url,n.allowAbsoluteUrls);return Zre(a,n.params,n.paramsSerializer)}};_t.forEach(["delete","get","head","options"],function(n){Lg.prototype[n]=function(a,t){return this.request(zg(t||{},{method:n,url:a,data:(t||{}).data}))}});_t.forEach(["post","put","patch"],function(n){function a(t){return function(r,s,o){return this.request(zg(o||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:s}))}}Lg.prototype[n]=a(),Lg.prototype[n+"Form"]=a(!0)});let pme=class uie{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(r){a=r});const t=this;this.promise.then(i=>{if(!t._listeners)return;let r=t._listeners.length;for(;r-- >0;)t._listeners[r](i);t._listeners=null}),this.promise.then=i=>{let r;const s=new Promise(o=>{t.subscribe(o),r=o}).then(i);return s.cancel=function(){t.unsubscribe(r)},s},n(function(r,s,o){t.reason||(t.reason=new sb(r,s,o),a(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const a=this._listeners.indexOf(n);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const n=new AbortController,a=t=>{n.abort(t)};return this.subscribe(a),n.signal.unsubscribe=()=>this.unsubscribe(a),n.signal}static source(){let n;return{token:new uie(function(i){n=i}),cancel:n}}};function gme(e){return function(a){return e.apply(null,a)}}function yme(e){return _t.isObject(e)&&e.isAxiosError===!0}const Ck={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ck).forEach(([e,n])=>{Ck[n]=e});function die(e){const n=new Lg(e),a=Ure(Lg.prototype.request,n);return _t.extend(a,Lg.prototype,n,{allOwnKeys:!0}),_t.extend(a,n,null,{allOwnKeys:!0}),a.create=function(i){return die(zg(e,i))},a}const Dr=die(oT);Dr.Axios=Lg;Dr.CanceledError=sb;Dr.CancelToken=pme;Dr.isCancel=nie;Dr.VERSION=cie;Dr.toFormData=lE;Dr.AxiosError=yn;Dr.Cancel=Dr.CanceledError;Dr.all=function(n){return Promise.all(n)};Dr.spread=gme;Dr.isAxiosError=yme;Dr.mergeConfig=zg;Dr.AxiosHeaders=Gs;Dr.formToJSON=e=>tie(_t.isHTMLForm(e)?new FormData(e):e);Dr.getAdapter=oie.getAdapter;Dr.HttpStatusCode=Ck;Dr.default=Dr;const{Axios:xIe,AxiosError:qIe,CanceledError:LIe,isCancel:BIe,CancelToken:UIe,VERSION:zIe,all:VIe,Cancel:HIe,isAxiosError:KIe,spread:$Ie,toFormData:GIe,AxiosHeaders:WIe,HttpStatusCode:JIe,formToJSON:QIe,getAdapter:YIe,mergeConfig:XIe}=Dr;var yF={},bF={},Kl={},K3;function lie(){return K3||(K3=1,Kl.hashU32=function(n){return n=n|0,n=n+2127912214+(n<<12)|0,n=n^-949894596^n>>>19,n=n+374761393+(n<<5)|0,n=n+-744332180^n<<9,n=n+-42973499+(n<<3)|0,n^-1252372727^n>>>16|0},Kl.readU64=function(n,a){var t=0;return t|=n[a++]<<0,t|=n[a++]<<8,t|=n[a++]<<16,t|=n[a++]<<24,t|=n[a++]<<32,t|=n[a++]<<40,t|=n[a++]<<48,t|=n[a++]<<56,t},Kl.readU32=function(n,a){var t=0;return t|=n[a++]<<0,t|=n[a++]<<8,t|=n[a++]<<16,t|=n[a++]<<24,t},Kl.writeU32=function(n,a,t){n[a++]=t>>0&255,n[a++]=t>>8&255,n[a++]=t>>16&255,n[a++]=t>>24&255},Kl.imul=function(n,a){var t=n>>>16,i=n&65535,r=a>>>16,s=a&65535;return i*s+(t*s+i*r<<16)|0}),Kl}var $3;function bme(){if($3)return bF;$3=1;var e=lie(),n=2654435761,a=2246822519,t=3266489917,i=668265263,r=374761393;function s(C,v){return C=C|0,v=v|0,C>>>(32-v|0)|C<<v|0}function o(C,v,m){return C=C|0,v=v|0,m=m|0,e.imul(C>>>(32-v|0)|C<<v,m)|0}function u(C,v){return C=C|0,v=v|0,C>>>v^C|0}function c(C,v,m,h,g){return o(e.imul(v,m)+C,h,g)}function d(C,v,m){return o(C+e.imul(v[m],r),11,n)}function l(C,v,m){return c(C,e.readU32(v,m),t,17,i)}function f(C,v,m){return[c(C[0],e.readU32(v,m+0),a,13,n),c(C[1],e.readU32(v,m+4),a,13,n),c(C[2],e.readU32(v,m+8),a,13,n),c(C[3],e.readU32(v,m+12),a,13,n)]}function b(C,v,m,h){var g,_;if(_=h,h>=16){for(g=[C+n+a,C+a,C,C-n];h>=16;)g=f(g,v,m),m+=16,h-=16;g=s(g[0],1)+s(g[1],7)+s(g[2],12)+s(g[3],18)+_}else g=C+r+h>>>0;for(;h>=4;)g=l(g,v,m),m+=4,h-=4;for(;h>0;)g=d(g,v,m),m++,h--;return g=u(e.imul(u(e.imul(u(g,15),a),13),t),16),g>>>0}return bF.hash=b,bF}var G3;function rx(){return G3||(G3=1,(function(e){var n=bme(),a=lie(),t=4,i=13,r=5,s=6,o=65536,u=4,c=(1<<u)-1,d=4,l=(1<<d)-1,f=M(5<<20),b=F(),C=407708164,v=4,m=8,h=16,g=64,_=192,S=2147483648,p=7,w=4,O=7,E={4:65536,5:262144,6:1048576,7:4194304};function F(){try{return new Uint32Array(o)}catch{for(var k=new Array(o),x=0;x<o;x++)k[x]=0;return k}}function R(k){for(var x=0;x<o;x++)b[x]=0}function M(k){try{return new Uint8Array(k)}catch{for(var x=new Array(k),L=0;L<k;L++)x[L]=0;return x}}function j(k,x,L){if(typeof k.buffer!==void 0){if(Uint8Array.prototype.slice)return k.slice(x,L);var V=k.length;x=x|0,x=x<0?Math.max(V+x,0):Math.min(x,V),L=L===void 0?V:L|0,L=L<0?Math.max(V+L,0):Math.min(L,V);for(var G=new Uint8Array(L-x),ee=x,se=0;ee<L;)G[se++]=k[ee++];return G}else return k.slice(x,L)}e.compressBound=function(x){return x+x/255+16|0},e.decompressBound=function(x){var L=0;if(a.readU32(x,L)!==C)throw new Error("invalid magic number");L+=4;var V=x[L++];if((V&_)!==g)throw new Error("incompatible descriptor version "+(V&_));var G=(V&h)!==0,ee=(V&m)!==0,se=x[L++]>>w&O;if(E[se]===void 0)throw new Error("invalid block size "+se);var re=E[se];if(ee)return a.readU64(x,L);L++;for(var fe=0;;){var oe=a.readU32(x,L);if(L+=4,oe&S?(oe&=~S,fe+=oe):fe+=re,oe===0)return fe;G&&(L+=4),L+=oe}},e.makeBuffer=M,e.decompressBlock=function(x,L,V,G,ee){var se,re,fe,oe,pe;for(fe=V+G;V<fe;){var de=x[V++],ge=de>>4;if(ge>0){if(ge===15)for(;ge+=x[V],x[V++]===255;);for(oe=V+ge;V<oe;)L[ee++]=x[V++]}if(V>=fe)break;if(se=de&15,re=x[V++]|x[V++]<<8,se===15)for(;se+=x[V],x[V++]===255;);for(se+=t,pe=ee-re,oe=pe+se;pe<oe;)L[ee++]=L[pe++]|0}return ee},e.compressBlock=function(x,L,V,G,ee){var se,re,fe,oe,pe,de,ge,Ce,Fe;if(ge=0,Ce=G+V,re=V,G>=i)for(var We=(1<<s)+3;V+t<Ce-r;){var Ze=a.readU32(x,V),lt=a.hashU32(Ze)>>>0;if(lt=(lt>>16^lt)>>>0&65535,se=ee[lt]-1,ee[lt]=V+1,se<0||V-se>>>16>0||a.readU32(x,se)!==Ze){pe=We++>>s,V+=pe;continue}for(We=(1<<s)+3,de=V-re,oe=V-se,V+=t,se+=t,fe=V;V<Ce-r&&x[V]===x[se];)V++,se++;fe=V-fe;var ut=fe<c?fe:c;if(de>=l){for(L[ge++]=(l<<u)+ut,Fe=de-l;Fe>=255;Fe-=255)L[ge++]=255;L[ge++]=Fe}else L[ge++]=(de<<u)+ut;for(var pt=0;pt<de;pt++)L[ge++]=x[re+pt];if(L[ge++]=oe,L[ge++]=oe>>8,fe>=c){for(Fe=fe-c;Fe>=255;Fe-=255)L[ge++]=255;L[ge++]=Fe}re=V}if(re===0)return 0;if(de=Ce-re,de>=l){for(L[ge++]=l<<u,Fe=de-l;Fe>=255;Fe-=255)L[ge++]=255;L[ge++]=Fe}else L[ge++]=de<<u;for(V=re;V<Ce;)L[ge++]=x[V++];return ge},e.decompressFrame=function(x,L){var V,G,ee,se,re=0,fe=0;if(a.readU32(x,re)!==C)throw new Error("invalid magic number");if(re+=4,se=x[re++],(se&_)!==g)throw new Error("incompatible descriptor version");V=(se&h)!==0,G=(se&v)!==0,ee=(se&m)!==0;var oe=x[re++]>>w&O;if(E[oe]===void 0)throw new Error("invalid block size");for(ee&&(re+=8),re++;;){var pe;if(pe=a.readU32(x,re),re+=4,pe===0)break;if(V&&(re+=4),(pe&S)!==0){pe&=~S;for(var de=0;de<pe;de++)L[fe++]=x[re++]}else fe=e.decompressBlock(x,L,re,pe,fe),re+=pe}return G&&(re+=4),fe},e.compressFrame=function(x,L){var V=0;a.writeU32(L,V,C),V+=4,L[V++]=g,L[V++]=p<<w,L[V]=n.hash(0,L,4,V-4)>>8,V++;var G=E[p],ee=x.length,se=0;for(R();ee>0;){var re=0,fe=ee>G?G:ee;if(re=e.compressBlock(x,f,se,fe,b),re>fe||re===0){a.writeU32(L,V,2147483648|fe),V+=4;for(var oe=se+fe;se<oe;)L[V++]=x[se++];ee-=fe}else{a.writeU32(L,V,re),V+=4;for(var pe=0;pe<re;)L[V++]=f[pe++];se+=fe,ee-=fe}}return a.writeU32(L,V,0),V+=4,V},e.decompress=function(x,L){var V,G;return L===void 0&&(L=e.decompressBound(x)),V=e.makeBuffer(L),G=e.decompressFrame(x,V),G!==L&&(V=j(V,0,G)),V},e.compress=function(x,L){var V,G;return L===void 0&&(L=e.compressBound(x.length)),V=e.makeBuffer(L),G=e.compressFrame(x,V),G!==L&&(V=j(V,0,G)),V}})(yF)),yF}var vF,W3;function ix(){if(W3)return vF;W3=1;function e(r){if(this._capacity=i(r),this._length=0,this._front=0,n(r)){for(var s=r.length,o=0;o<s;++o)this[o]=r[o];this._length=s}}e.prototype.toArray=function(){for(var s=this._length,o=new Array(s),u=this._front,c=this._capacity,d=0;d<s;++d)o[d]=this[u+d&c-1];return o},e.prototype.push=function(s){var o=arguments.length,u=this._length;if(o>1){var c=this._capacity;if(u+o>c){for(var l=0;l<o;++l){this._checkCapacity(u+1);var d=this._front+u&this._capacity-1;this[d]=arguments[l],u++,this._length=u}return u}else{for(var d=this._front,l=0;l<o;++l)this[d+u&c-1]=arguments[l],d++;return this._length=u+o,u+o}}if(o===0)return u;this._checkCapacity(u+1);var l=this._front+u&this._capacity-1;return this[l]=s,this._length=u+1,u+1},e.prototype.pop=function(){var s=this._length;if(s!==0){var o=this._front+s-1&this._capacity-1,u=this[o];return this[o]=void 0,this._length=s-1,u}},e.prototype.shift=function(){var s=this._length;if(s!==0){var o=this._front,u=this[o];return this[o]=void 0,this._front=o+1&this._capacity-1,this._length=s-1,u}},e.prototype.unshift=function(s){var o=this._length,u=arguments.length;if(u>1){var l=this._capacity;if(o+u>l){for(var f=u-1;f>=0;f--){this._checkCapacity(o+1);var l=this._capacity,c=(this._front-1&l-1^l)-l;this[c]=arguments[f],o++,this._length=o,this._front=c}return o}else{for(var d=this._front,f=u-1;f>=0;f--){var c=(d-1&l-1^l)-l;this[c]=arguments[f],d=c}return this._front=d,this._length=o+u,o+u}}if(u===0)return o;this._checkCapacity(o+1);var l=this._capacity,f=(this._front-1&l-1^l)-l;return this[f]=s,this._length=o+1,this._front=f,o+1},e.prototype.peekBack=function(){var s=this._length;if(s!==0){var o=this._front+s-1&this._capacity-1;return this[o]}},e.prototype.peekFront=function(){if(this._length!==0)return this[this._front]},e.prototype.get=function(s){var o=s;if(o===(o|0)){var u=this._length;if(o<0&&(o=o+u),!(o<0||o>=u))return this[this._front+o&this._capacity-1]}},e.prototype.isEmpty=function(){return this._length===0},e.prototype.clear=function(){for(var s=this._length,o=this._front,u=this._capacity,c=0;c<s;++c)this[o+c&u-1]=void 0;this._length=0,this._front=0},e.prototype.toString=function(){return this.toArray().toString()},e.prototype.valueOf=e.prototype.toString,e.prototype.removeFront=e.prototype.shift,e.prototype.removeBack=e.prototype.pop,e.prototype.insertFront=e.prototype.unshift,e.prototype.insertBack=e.prototype.push,e.prototype.enqueue=e.prototype.push,e.prototype.dequeue=e.prototype.shift,e.prototype.toJSON=e.prototype.toArray,Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),e.prototype._checkCapacity=function(s){this._capacity<s&&this._resizeTo(i(this._capacity*1.5+16))},e.prototype._resizeTo=function(s){var o=this._capacity;this._capacity=s;var u=this._front,c=this._length;if(u+c>o){var d=u+c&o-1;a(this,0,this,o,d)}};var n=Array.isArray;function a(r,s,o,u,c){for(var d=0;d<c;++d)o[d+u]=r[d+s],r[d+s]=void 0}function t(r){return r=r>>>0,r=r-1,r=r|r>>1,r=r|r>>2,r=r|r>>4,r=r|r>>8,r=r|r>>16,r+1}function i(r){if(typeof r!="number")if(n(r))r=r.length;else return 16;return t(Math.min(Math.max(16,r),1073741824))}return vF=e,vF}var Lw={exports:{}},SF,J3;function hE(){if(J3)return SF;J3=1;var e=1e3,n=e*60,a=n*60,t=a*24,i=t*7,r=t*365.25;SF=function(d,l){l=l||{};var f=typeof d;if(f==="string"&&d.length>0)return s(d);if(f==="number"&&isFinite(d))return l.long?u(d):o(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function s(d){if(d=String(d),!(d.length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(l){var f=parseFloat(l[1]),b=(l[2]||"ms").toLowerCase();switch(b){case"years":case"year":case"yrs":case"yr":case"y":return f*r;case"weeks":case"week":case"w":return f*i;case"days":case"day":case"d":return f*t;case"hours":case"hour":case"hrs":case"hr":case"h":return f*a;case"minutes":case"minute":case"mins":case"min":case"m":return f*n;case"seconds":case"second":case"secs":case"sec":case"s":return f*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function o(d){var l=Math.abs(d);return l>=t?Math.round(d/t)+"d":l>=a?Math.round(d/a)+"h":l>=n?Math.round(d/n)+"m":l>=e?Math.round(d/e)+"s":d+"ms"}function u(d){var l=Math.abs(d);return l>=t?c(d,l,t,"day"):l>=a?c(d,l,a,"hour"):l>=n?c(d,l,n,"minute"):l>=e?c(d,l,e,"second"):d+" ms"}function c(d,l,f,b){var C=l>=f*1.5;return Math.round(d/f)+" "+b+(C?"s":"")}return SF}var CF,Q3;function vme(){if(Q3)return CF;Q3=1;function e(n){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=r,t.enabled=u,t.humanize=hE(),t.destroy=d,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function a(l){let f=0;for(let b=0;b<l.length;b++)f=(f<<5)-f+l.charCodeAt(b),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=a;function t(l){let f,b=null,C,v;function m(...h){if(!m.enabled)return;const g=m,_=Number(new Date),S=_-(f||_);g.diff=S,g.prev=f,g.curr=_,f=_,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let p=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(O,E)=>{if(O==="%%")return"%";p++;const F=t.formatters[E];if(typeof F=="function"){const R=h[p];O=F.call(g,R),h.splice(p,1),p--}return O}),t.formatArgs.call(g,h),(g.log||t.log).apply(g,h)}return m.namespace=l,m.useColors=t.useColors(),m.color=t.selectColor(l),m.extend=i,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(C!==t.namespaces&&(C=t.namespaces,v=t.enabled(l)),v),set:h=>{b=h}}),typeof t.init=="function"&&t.init(m),m}function i(l,f){const b=t(this.namespace+(typeof f>"u"?":":f)+l);return b.log=this.log,b}function r(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];const f=(typeof l=="string"?l:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const b of f)b[0]==="-"?t.skips.push(b.slice(1)):t.names.push(b)}function s(l,f){let b=0,C=0,v=-1,m=0;for(;b<l.length;)if(C<f.length&&(f[C]===l[b]||f[C]==="*"))f[C]==="*"?(v=C,m=b,C++):(b++,C++);else if(v!==-1)C=v+1,m++,b=m;else return!1;for(;C<f.length&&f[C]==="*";)C++;return C===f.length}function o(){const l=[...t.names,...t.skips.map(f=>"-"+f)].join(",");return t.enable(""),l}function u(l){for(const f of t.skips)if(s(l,f))return!1;for(const f of t.names)if(s(l,f))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return CF=e,CF}var Y3;function fie(){return Y3||(Y3=1,(function(e,n){var a={};n.formatArgs=i,n.save=r,n.load=s,n.useColors=t,n.storage=o(),n.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let l=0,f=0;c[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(l++,b==="%c"&&(f=l))}),c.splice(f,0,d)}n.log=console.debug||console.log||(()=>{});function r(c){try{c?n.storage.setItem("debug",c):n.storage.removeItem("debug")}catch{}}function s(){let c;try{c=n.storage.getItem("debug")||n.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=a.DEBUG),c}function o(){try{return localStorage}catch{}}e.exports=vme()(n);const{formatters:u}=e.exports;u.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(Lw,Lw.exports)),Lw.exports}var Sme=fie(),la={},X3;function dl(){if(X3)return la;X3=1,Object.defineProperty(la,"__esModule",{value:!0}),la.EmptyBTree=la.asSet=la.BTree=la.simpleComparator=la.defaultComparator=void 0;function e(v,m){if(Number.isFinite(v)&&Number.isFinite(m))return v-m;let h=typeof v,g=typeof m;if(h!==g)return h<g?-1:1;if(h==="object"){if(v===null)return m===null?0:-1;if(m===null)return 1;if(v=v.valueOf(),m=m.valueOf(),h=typeof v,g=typeof m,h!==g)return h<g?-1:1}return v<m?-1:v>m?1:v===m?0:Number.isNaN(v)?Number.isNaN(m)?0:-1:Number.isNaN(m)?1:Array.isArray(v)?0:Number.NaN}la.defaultComparator=e;function n(v,m){return v>m?1:v<m?-1:0}la.simpleComparator=n;class a{constructor(m,h,g){this._root=l,this._size=0,this._maxNodeSize=g>=4?Math.min(g,256):32,this._compare=h||e,m&&this.setPairs(m)}get size(){return this._size}get length(){return this._size}get isEmpty(){return this._size===0}clear(){this._root=l,this._size=0}forEach(m,h){return h!==void 0&&(m=m.bind(h)),this.forEachPair((g,_)=>m(_,g,this))}forEachPair(m,h){var g=this.minKey(),_=this.maxKey();return this.forRange(g,_,!0,m,h)}get(m,h){return this._root.get(m,h,this)}set(m,h,g){this._root.isShared&&(this._root=this._root.clone());var _=this._root.set(m,h,g,this);return _===!0||_===!1?_:(this._root=new s([this._root,_]),!0)}has(m){return this.forRange(m,m,!0,void 0)!==0}delete(m){return this.editRange(m,m,!0,c)!==0}with(m,h,g){let _=this.clone();return _.set(m,h,g)||g?_:this}withPairs(m,h){let g=this.clone();return g.setPairs(m,h)!==0||h?g:this}withKeys(m,h){let g=this.clone(),_=!1;for(var S=0;S<m.length;S++)_=g.set(m[S],void 0,!1)||_;return h&&!_?this:g}without(m,h){return this.withoutRange(m,m,!0,h)}withoutKeys(m,h){let g=this.clone();return g.deleteKeys(m)||!h?g:this}withoutRange(m,h,g,_){let S=this.clone();return S.deleteRange(m,h,g)===0&&_?this:S}filter(m,h){var g=this.greedyClone(),_;return g.editAll((S,p,w)=>{if(!m(S,p,w))return _=u}),!_&&h?this:g}mapValues(m){var h={},g=this.greedyClone();return g.editAll((_,S,p)=>(h.value=m(S,_,p),h)),g}reduce(m,h){let g=0,_=h;for(var S=this.entries(this.minKey(),b),p;!(p=S.next()).done;)_=m(_,p.value,g++,this);return _}entries(m,h){var g=this.findPath(m);if(g===void 0)return i();var{nodequeue:_,nodeindex:S,leaf:p}=g,w=h!==void 0?1:0,O=m===void 0?-1:p.indexOf(m,0,this._compare)-1;return i(()=>{e:for(;;)switch(w){case 0:if(++O<p.keys.length)return{done:!1,value:[p.keys[O],p.values[O]]};w=2;continue;case 1:if(++O<p.keys.length)return h[0]=p.keys[O],h[1]=p.values[O],{done:!1,value:h};w=2;case 2:for(var E=-1;;){if(++E>=_.length){w=3;continue e}if(++S[E]<_[E].length)break}for(;E>0;E--)_[E-1]=_[E][S[E]].children,S[E-1]=0;p=_[0][S[0]],O=-1,w=h!==void 0?1:0;continue;case 3:return{done:!0,value:void 0}}})}entriesReversed(m,h,g){if(m===void 0&&(m=this.maxKey(),g=void 0,m===void 0))return i();var{nodequeue:_,nodeindex:S,leaf:p}=this.findPath(m)||this.findPath(this.maxKey());C(!_[0]||p===_[0][S[0]],"wat!");var w=p.indexOf(m,0,this._compare);!g&&w<p.keys.length&&this._compare(p.keys[w],m)<=0&&w++;var O=h!==void 0?1:0;return i(()=>{e:for(;;)switch(O){case 0:if(--w>=0)return{done:!1,value:[p.keys[w],p.values[w]]};O=2;continue;case 1:if(--w>=0)return h[0]=p.keys[w],h[1]=p.values[w],{done:!1,value:h};O=2;case 2:for(var E=-1;;){if(++E>=_.length){O=3;continue e}if(--S[E]>=0)break}for(;E>0;E--)_[E-1]=_[E][S[E]].children,S[E-1]=_[E-1].length-1;p=_[0][S[0]],w=p.keys.length,O=h!==void 0?1:0;continue;case 3:return{done:!0,value:void 0}}})}findPath(m){var h=this._root,g,_;if(h.isLeaf)g=f,_=f;else{g=[],_=[];for(var S=0;!h.isLeaf;S++){if(g[S]=h.children,_[S]=m===void 0?0:h.indexOf(m,0,this._compare),_[S]>=g[S].length)return;h=g[S][_[S]]}g.reverse(),_.reverse()}return{nodequeue:g,nodeindex:_,leaf:h}}diffAgainst(m,h,g,_){if(m._compare!==this._compare)throw new Error("Tree comparators are not the same.");if(this.isEmpty||m.isEmpty)return this.isEmpty&&m.isEmpty?void 0:this.isEmpty?g===void 0?void 0:a.stepToEnd(a.makeDiffCursor(m),g):h===void 0?void 0:a.stepToEnd(a.makeDiffCursor(this),h);const{_compare:S}=this,p=a.makeDiffCursor(this),w=a.makeDiffCursor(m);let O=!0,E=!0,F=a.compare(p,w,S);for(;O&&E;){const R=a.compare(p,w,S),{leaf:M,internalSpine:j,levelIndices:k}=p,{leaf:x,internalSpine:L,levelIndices:V}=w;if(M||x){if(F!==0){if(R===0){if(M&&x&&_){const G=M.values[k[k.length-1]],ee=x.values[V[V.length-1]];if(!Object.is(G,ee)){const se=_(p.currentKey,G,ee);if(se&&se.break)return se.break}}}else if(R>0){if(x&&g){const G=x.values[V[V.length-1]],ee=g(w.currentKey,G);if(ee&&ee.break)return ee.break}}else if(h&&M&&F!==0){const G=M.values[k[k.length-1]],ee=h(p.currentKey,G);if(ee&&ee.break)return ee.break}}}else if(!M&&!x&&R===0){const G=j.length-1,ee=L.length-1,se=j[G][k[G]];if(L[ee][V[ee]]===se){F=0,O=a.step(p,!0),E=a.step(w,!0);continue}}F=R,R<0?O=a.step(p):E=a.step(w)}if(O&&h)return a.finishCursorWalk(p,w,S,h);if(E&&g)return a.finishCursorWalk(w,p,S,g)}static finishCursorWalk(m,h,g,_){const S=a.compare(m,h,g);if(S===0){if(!a.step(m))return}else S<0&&C(!1,"cursor walk terminated early");return a.stepToEnd(m,_)}static stepToEnd(m,h){let g=!0;for(;g;){const{leaf:_,levelIndices:S,currentKey:p}=m;if(_){const w=_.values[S[S.length-1]],O=h(p,w);if(O&&O.break)return O.break}g=a.step(m)}}static makeDiffCursor(m){const{_root:h,height:g}=m;return{height:g,internalSpine:[[h]],levelIndices:[0],leaf:void 0,currentKey:h.maxKey()}}static step(m,h){const{internalSpine:g,levelIndices:_,leaf:S}=m;if(h===!0||S){const p=_.length;if(h===!0||_[p-1]===0){const w=g.length;if(w===0)return!1;const O=w-1;let E=O;for(;E>=0;){if(_[E]>0)return E<p-1&&(m.leaf=void 0,_.pop()),E<O&&(m.internalSpine=g.slice(0,E+1)),m.currentKey=g[E][--_[E]].maxKey(),!0;E--}return!1}else{const w=--_[p-1];return m.currentKey=S.keys[w],!0}}else{const p=g.length,w=p-1,O=g[w][_[w]];if(O.isLeaf){m.leaf=O;const E=_[p]=O.values.length-1;m.currentKey=O.keys[E]}else{const E=O.children;g[p]=E;const F=E.length-1;_[p]=F,m.currentKey=E[F].maxKey()}return!0}}static compare(m,h,g){const{height:_,currentKey:S,levelIndices:p}=m,{height:w,currentKey:O,levelIndices:E}=h,F=g(O,S);if(F!==0)return F;const R=_<w?_:w,M=p.length-(_-R),j=E.length-(w-R);return M-j}keys(m){var h=this.entries(m,b);return i(()=>{var g=h.next();return g.value&&(g.value=g.value[0]),g})}values(m){var h=this.entries(m,b);return i(()=>{var g=h.next();return g.value&&(g.value=g.value[1]),g})}get maxNodeSize(){return this._maxNodeSize}minKey(){return this._root.minKey()}maxKey(){return this._root.maxKey()}clone(){this._root.isShared=!0;var m=new a(void 0,this._compare,this._maxNodeSize);return m._root=this._root,m._size=this._size,m}greedyClone(m){var h=new a(void 0,this._compare,this._maxNodeSize);return h._root=this._root.greedyClone(m),h._size=this._size,h}toArray(m=2147483647){let h=this.minKey(),g=this.maxKey();return h!==void 0?this.getRange(h,g,!0,m):[]}keysArray(){var m=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,(h,g)=>{m.push(h)}),m}valuesArray(){var m=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,(h,g)=>{m.push(g)}),m}toString(){return this.toArray().toString()}setIfNotPresent(m,h){return this.set(m,h,!1)}nextHigherPair(m,h){return h=h||[],m===void 0?this._root.minPair(h):this._root.getPairOrNextHigher(m,this._compare,!1,h)}nextHigherKey(m){var h=this.nextHigherPair(m,b);return h&&h[0]}nextLowerPair(m,h){return h=h||[],m===void 0?this._root.maxPair(h):this._root.getPairOrNextLower(m,this._compare,!1,h)}nextLowerKey(m){var h=this.nextLowerPair(m,b);return h&&h[0]}getPairOrNextLower(m,h){return this._root.getPairOrNextLower(m,this._compare,!0,h||[])}getPairOrNextHigher(m,h){return this._root.getPairOrNextHigher(m,this._compare,!0,h||[])}changeIfPresent(m,h){return this.editRange(m,m,!0,(g,_)=>({value:h}))!==0}getRange(m,h,g,_=67108863){var S=[];return this._root.forRange(m,h,g,!1,this,0,(p,w)=>(S.push([p,w]),S.length>_?d:void 0)),S}setPairs(m,h){for(var g=0,_=0;_<m.length;_++)this.set(m[_][0],m[_][1],h)&&g++;return g}forRange(m,h,g,_,S){var p=this._root.forRange(m,h,g,!1,this,S||0,_);return typeof p=="number"?p:p.break}editRange(m,h,g,_,S){var p=this._root;p.isShared&&(this._root=p=p.clone());try{var w=p.forRange(m,h,g,!0,this,S||0,_);return typeof w=="number"?w:w.break}finally{let O;for(;p.keys.length<=1&&!p.isLeaf;)O||(O=p.isShared),this._root=p=p.keys.length===0?l:p.children[0];O&&(p.isShared=!0)}}editAll(m,h){return this.editRange(this.minKey(),this.maxKey(),!0,m,h)}deleteRange(m,h,g){return this.editRange(m,h,g,c)}deleteKeys(m){for(var h=0,g=0;h<m.length;h++)this.delete(m[h])&&g++;return g}get height(){let m=this._root,h=-1;for(;m;)h++,m=m.isLeaf?void 0:m.children[0];return h}freeze(){var m=this;m.clear=m.set=m.editRange=function(){throw new Error("Attempted to modify a frozen BTree")}}unfreeze(){delete this.clear,delete this.set,delete this.editRange}get isFrozen(){return this.hasOwnProperty("editRange")}checkValid(){var m=this._root.checkValid(0,this,0);C(m===this.size,"size mismatch: counted ",m,"but stored",this.size)}}la.BTree=a;function t(v){return v}la.asSet=t,Symbol&&Symbol.iterator&&(a.prototype[Symbol.iterator]=a.prototype.entries),a.prototype.where=a.prototype.filter,a.prototype.setRange=a.prototype.setPairs,a.prototype.add=a.prototype.set;function i(v=(()=>({done:!0,value:void 0}))){var m={next:v};return Symbol&&Symbol.iterator&&(m[Symbol.iterator]=function(){return this}),m}class r{get isLeaf(){return this.children===void 0}constructor(m=[],h){this.keys=m,this.values=h||o,this.isShared=void 0}maxKey(){return this.keys[this.keys.length-1]}indexOf(m,h,g){const _=this.keys;for(var S=0,p=_.length,w=p>>1;S<p;){var O=g(_[w],m);if(O<0)S=w+1;else if(O>0)p=w;else{if(O===0)return w;if(m===m)return _.length;throw new Error("BTree: NaN was used as a key")}w=S+p>>1}return w^h}minKey(){return this.keys[0]}minPair(m){if(this.keys.length!==0)return m[0]=this.keys[0],m[1]=this.values[0],m}maxPair(m){if(this.keys.length===0)return;const h=this.keys.length-1;return m[0]=this.keys[h],m[1]=this.values[h],m}clone(){var m=this.values;return new r(this.keys.slice(0),m===o?m:m.slice(0))}greedyClone(m){return this.isShared&&!m?this:this.clone()}get(m,h,g){var _=this.indexOf(m,-1,g._compare);return _<0?h:this.values[_]}getPairOrNextLower(m,h,g,_){var S=this.indexOf(m,-1,h);const p=S<0?~S-1:g?S:S-1;if(p>=0)return _[0]=this.keys[p],_[1]=this.values[p],_}getPairOrNextHigher(m,h,g,_){var S=this.indexOf(m,-1,h);const p=S<0?~S:g?S:S+1,w=this.keys;if(p<w.length)return _[0]=w[p],_[1]=this.values[p],_}checkValid(m,h,g){var _=this.keys.length,S=this.values.length;return C(this.values===o?_<=S:_===S,"keys/values length mismatch: depth",m,"with lengths",_,S,"and baseIndex",g),C(m==0||_>0,"empty leaf at depth",m,"and baseIndex",g),_}set(m,h,g,_){var S=this.indexOf(m,-1,_._compare);if(S<0){if(S=~S,_._size++,this.keys.length<_._maxNodeSize)return this.insertInLeaf(S,m,h,_);var p=this.splitOffRightSide(),w=this;return S>this.keys.length&&(S-=this.keys.length,w=p),w.insertInLeaf(S,m,h,_),p}else return g!==!1&&(h!==void 0&&this.reifyValues(),this.keys[S]=m,this.values[S]=h),!1}reifyValues(){return this.values===o?this.values=this.values.slice(0,this.keys.length):this.values}insertInLeaf(m,h,g,_){if(this.keys.splice(m,0,h),this.values===o){for(;o.length<_._maxNodeSize;)o.push(void 0);if(g===void 0)return!0;this.values=o.slice(0,this.keys.length-1)}return this.values.splice(m,0,g),!0}takeFromRight(m){var h=this.values;m.values===o?h!==o&&h.push(void 0):(h=this.reifyValues(),h.push(m.values.shift())),this.keys.push(m.keys.shift())}takeFromLeft(m){var h=this.values;m.values===o?h!==o&&h.unshift(void 0):(h=this.reifyValues(),h.unshift(m.values.pop())),this.keys.unshift(m.keys.pop())}splitOffRightSide(){var m=this.keys.length>>1,h=this.keys.splice(m),g=this.values===o?o:this.values.splice(m);return new r(h,g)}forRange(m,h,g,_,S,p,w){var O=S._compare,E,F;if(h===m){if(!g||(F=(E=this.indexOf(m,-1,O))+1,E<0))return p}else E=this.indexOf(m,0,O),F=this.indexOf(h,-1,O),F<0?F=~F:g===!0&&F++;var R=this.keys,M=this.values;if(w!==void 0)for(var j=E;j<F;j++){var k=R[j],x=w(k,M[j],p++);if(x!==void 0){if(_===!0){if(k!==R[j]||this.isShared===!0)throw new Error("BTree illegally changed or cloned in editRange");x.delete?(this.keys.splice(j,1),this.values!==o&&this.values.splice(j,1),S._size--,j--,F--):x.hasOwnProperty("value")&&(M[j]=x.value)}if(x.break!==void 0)return x}}else p+=F-E;return p}mergeSibling(m,h){if(this.keys.push.apply(this.keys,m.keys),this.values===o){if(m.values===o)return;this.values=this.values.slice(0,this.keys.length)}this.values.push.apply(this.values,m.reifyValues())}}class s extends r{constructor(m,h){if(!h){h=[];for(var g=0;g<m.length;g++)h[g]=m[g].maxKey()}super(h),this.children=m}clone(){for(var m=this.children.slice(0),h=0;h<m.length;h++)m[h].isShared=!0;return new s(m,this.keys.slice(0))}greedyClone(m){if(this.isShared&&!m)return this;for(var h=new s(this.children.slice(0),this.keys.slice(0)),g=0;g<h.children.length;g++)h.children[g]=h.children[g].greedyClone(m);return h}minKey(){return this.children[0].minKey()}minPair(m){return this.children[0].minPair(m)}maxPair(m){return this.children[this.children.length-1].maxPair(m)}get(m,h,g){var _=this.indexOf(m,0,g._compare),S=this.children;return _<S.length?S[_].get(m,h,g):void 0}getPairOrNextLower(m,h,g,_){var S=this.indexOf(m,0,h),p=this.children;if(S>=p.length)return this.maxPair(_);const w=p[S].getPairOrNextLower(m,h,g,_);return w===void 0&&S>0?p[S-1].maxPair(_):w}getPairOrNextHigher(m,h,g,_){var S=this.indexOf(m,0,h),p=this.children,w=p.length;if(S>=w)return;const O=p[S].getPairOrNextHigher(m,h,g,_);return O===void 0&&S<w-1?p[S+1].minPair(_):O}checkValid(m,h,g){let _=this.keys.length,S=this.children.length;C(_===S,"keys/children length mismatch: depth",m,"lengths",_,S,"baseIndex",g),C(_>1||m>0,"internal node has length",_,"at depth",m,"baseIndex",g);let p=0,w=this.children,O=this.keys,E=0;for(var F=0;F<S;F++)p+=w[F].checkValid(m+1,h,g+p),E+=w[F].keys.length,C(p>=E,"wtf",g),C(F===0||w[F-1].constructor===w[F].constructor,"type mismatch, baseIndex:",g),w[F].maxKey()!=O[F]&&C(!1,"keys[",F,"] =",O[F],"is wrong, should be ",w[F].maxKey(),"at depth",m,"baseIndex",g),F===0||h._compare(O[F-1],O[F])<0||C(!1,"sort violation at depth",m,"index",F,"keys",O[F-1],O[F]);let R=E===0;return(R||E>h.maxNodeSize*S)&&C(!1,R?"too few":"too many","children (",E,p,") at depth",m,"maxNodeSize:",h.maxNodeSize,"children.length:",S,"baseIndex:",g),p}set(m,h,g,_){var S=this.children,p=_._maxNodeSize,w=_._compare,O=Math.min(this.indexOf(m,0,w),S.length-1),E=S[O];if(E.isShared&&(S[O]=E=E.clone()),E.keys.length>=p){var F;O>0&&(F=S[O-1]).keys.length<p&&w(E.keys[0],m)<0?(F.isShared&&(S[O-1]=F=F.clone()),F.takeFromRight(E),this.keys[O-1]=F.maxKey()):(F=S[O+1])!==void 0&&F.keys.length<p&&w(E.maxKey(),m)<0&&(F.isShared&&(S[O+1]=F=F.clone()),F.takeFromLeft(E),this.keys[O]=S[O].maxKey())}var R=E.set(m,h,g,_);if(R===!1)return!1;if(this.keys[O]=E.maxKey(),R===!0)return!0;if(this.keys.length<p)return this.insert(O+1,R),!0;var M=this.splitOffRightSide(),j=this;return w(R.maxKey(),this.maxKey())>0&&(j=M,O-=this.keys.length),j.insert(O+1,R),M}insert(m,h){this.children.splice(m,0,h),this.keys.splice(m,0,h.maxKey())}splitOffRightSide(){var m=this.children.length>>1;return new s(this.children.splice(m),this.keys.splice(m))}takeFromRight(m){this.keys.push(m.keys.shift()),this.children.push(m.children.shift())}takeFromLeft(m){this.keys.unshift(m.keys.pop()),this.children.unshift(m.children.pop())}forRange(m,h,g,_,S,p,w){var O=S._compare,E=this.keys,F=this.children,R=this.indexOf(m,0,O),M=R,j=Math.min(h===m?R:this.indexOf(h,0,O),E.length-1);if(_){if(M<=j)try{for(;M<=j;M++){F[M].isShared&&(F[M]=F[M].clone());var k=F[M].forRange(m,h,g,_,S,p,w);if(E[M]=F[M].maxKey(),typeof k!="number")return k;p=k}}finally{var x=S._maxNodeSize>>1;for(R>0&&R--,M=j;M>=R;M--)F[M].keys.length<=x&&(F[M].keys.length!==0?this.tryMerge(M,S._maxNodeSize):(E.splice(M,1),F.splice(M,1)));F.length!==0&&F[0].keys.length===0&&C(!1,"emptiness bug")}}else for(;M<=j;M++){var k=F[M].forRange(m,h,g,_,S,p,w);if(typeof k!="number")return k;p=k}return p}tryMerge(m,h){var g=this.children;return m>=0&&m+1<g.length&&g[m].keys.length+g[m+1].keys.length<=h?(g[m].isShared&&(g[m]=g[m].clone()),g[m].mergeSibling(g[m+1],h),g.splice(m+1,1),this.keys.splice(m+1,1),this.keys[m]=g[m].maxKey(),!0):!1}mergeSibling(m,h){var g=this.keys.length;this.keys.push.apply(this.keys,m.keys);const _=m.children;if(this.children.push.apply(this.children,_),m.isShared&&!this.isShared)for(var S=0;S<_.length;S++)_[S].isShared=!0;this.tryMerge(g-1,h)}}var o=[];const u={delete:!0},c=()=>u,d={break:!0},l=(function(){var v=new r;return v.isShared=!0,v})(),f=[],b=[];function C(v,...m){if(!v)throw m.unshift("B+ tree"),new Error(m.join(" "))}return la.EmptyBTree=(()=>{let v=new a;return v.freeze(),v})(),la}var _F,Z3;function Cme(){if(Z3)return _F;Z3=1;function e(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function n(i,r){for(var s="",o=0,u=-1,c=0,d,l=0;l<=i.length;++l){if(l<i.length)d=i.charCodeAt(l);else{if(d===47)break;d=47}if(d===47){if(!(u===l-1||c===1))if(u!==l-1&&c===2){if(s.length<2||o!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){var f=s.lastIndexOf("/");if(f!==s.length-1){f===-1?(s="",o=0):(s=s.slice(0,f),o=s.length-1-s.lastIndexOf("/")),u=l,c=0;continue}}else if(s.length===2||s.length===1){s="",o=0,u=l,c=0;continue}}r&&(s.length>0?s+="/..":s="..",o=2)}else s.length>0?s+="/"+i.slice(u+1,l):s=i.slice(u+1,l),o=l-u-1;u=l,c=0}else d===46&&c!==-1?++c:c=-1}return s}function a(i,r){var s=r.dir||r.root,o=r.base||(r.name||"")+(r.ext||"");return s?s===r.root?s+o:s+i+o:o}var t={resolve:function(){for(var r="",s=!1,o,u=arguments.length-1;u>=-1&&!s;u--){var c;u>=0?c=arguments[u]:(o===void 0&&(o=process.cwd()),c=o),e(c),c.length!==0&&(r=c+"/"+r,s=c.charCodeAt(0)===47)}return r=n(r,!s),s?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(r){if(e(r),r.length===0)return".";var s=r.charCodeAt(0)===47,o=r.charCodeAt(r.length-1)===47;return r=n(r,!s),r.length===0&&!s&&(r="."),r.length>0&&o&&(r+="/"),s?"/"+r:r},isAbsolute:function(r){return e(r),r.length>0&&r.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var r,s=0;s<arguments.length;++s){var o=arguments[s];e(o),o.length>0&&(r===void 0?r=o:r+="/"+o)}return r===void 0?".":t.normalize(r)},relative:function(r,s){if(e(r),e(s),r===s||(r=t.resolve(r),s=t.resolve(s),r===s))return"";for(var o=1;o<r.length&&r.charCodeAt(o)===47;++o);for(var u=r.length,c=u-o,d=1;d<s.length&&s.charCodeAt(d)===47;++d);for(var l=s.length,f=l-d,b=c<f?c:f,C=-1,v=0;v<=b;++v){if(v===b){if(f>b){if(s.charCodeAt(d+v)===47)return s.slice(d+v+1);if(v===0)return s.slice(d+v)}else c>b&&(r.charCodeAt(o+v)===47?C=v:v===0&&(C=0));break}var m=r.charCodeAt(o+v),h=s.charCodeAt(d+v);if(m!==h)break;m===47&&(C=v)}var g="";for(v=o+C+1;v<=u;++v)(v===u||r.charCodeAt(v)===47)&&(g.length===0?g+="..":g+="/..");return g.length>0?g+s.slice(d+C):(d+=C,s.charCodeAt(d)===47&&++d,s.slice(d))},_makeLong:function(r){return r},dirname:function(r){if(e(r),r.length===0)return".";for(var s=r.charCodeAt(0),o=s===47,u=-1,c=!0,d=r.length-1;d>=1;--d)if(s=r.charCodeAt(d),s===47){if(!c){u=d;break}}else c=!1;return u===-1?o?"/":".":o&&u===1?"//":r.slice(0,u)},basename:function(r,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');e(r);var o=0,u=-1,c=!0,d;if(s!==void 0&&s.length>0&&s.length<=r.length){if(s.length===r.length&&s===r)return"";var l=s.length-1,f=-1;for(d=r.length-1;d>=0;--d){var b=r.charCodeAt(d);if(b===47){if(!c){o=d+1;break}}else f===-1&&(c=!1,f=d+1),l>=0&&(b===s.charCodeAt(l)?--l===-1&&(u=d):(l=-1,u=f))}return o===u?u=f:u===-1&&(u=r.length),r.slice(o,u)}else{for(d=r.length-1;d>=0;--d)if(r.charCodeAt(d)===47){if(!c){o=d+1;break}}else u===-1&&(c=!1,u=d+1);return u===-1?"":r.slice(o,u)}},extname:function(r){e(r);for(var s=-1,o=0,u=-1,c=!0,d=0,l=r.length-1;l>=0;--l){var f=r.charCodeAt(l);if(f===47){if(!c){o=l+1;break}continue}u===-1&&(c=!1,u=l+1),f===46?s===-1?s=l:d!==1&&(d=1):s!==-1&&(d=-1)}return s===-1||u===-1||d===0||d===1&&s===u-1&&s===o+1?"":r.slice(s,u)},format:function(r){if(r===null||typeof r!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof r);return a("/",r)},parse:function(r){e(r);var s={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return s;var o=r.charCodeAt(0),u=o===47,c;u?(s.root="/",c=1):c=0;for(var d=-1,l=0,f=-1,b=!0,C=r.length-1,v=0;C>=c;--C){if(o=r.charCodeAt(C),o===47){if(!b){l=C+1;break}continue}f===-1&&(b=!1,f=C+1),o===46?d===-1?d=C:v!==1&&(v=1):d!==-1&&(v=-1)}return d===-1||f===-1||v===0||v===1&&d===f-1&&d===l+1?f!==-1&&(l===0&&u?s.base=s.name=r.slice(1,f):s.base=s.name=r.slice(l,f)):(l===0&&u?(s.name=r.slice(1,d),s.base=r.slice(1,f)):(s.name=r.slice(l,d),s.base=r.slice(l,f)),s.ext=r.slice(d,f)),l>0?s.dir=r.slice(0,l-1):u&&(s.dir="/"),s},sep:"/",delimiter:":",win32:null,posix:null};return t.posix=t,_F=t,_F}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */const _me=e=>{const n=hs.useRef(new Map),a=hs.useCallback((s,o,u)=>{let c=n.current.get(s);c?c.has(o)||c.set(o,u):(c=new Map,c.set(o,u),n.current.set(s,c));const d=e?.container.initialObjects.TURBO_STATE_MAP,l=d?.get(s);l&&u(l)},[e]),t=hs.useCallback((s,o)=>{let u=n.current.get(s);u?.has(o)&&u.delete(o)},[]),i=hs.useCallback((s,o)=>{if(!e)return;const{container:u}=e;u.initialObjects.TURBO_STATE_MAP.set(s,o)},[e]),r=hs.useCallback(s=>{if(!e)return;const{container:o}=e;let u=n.current.get(s);u?.clear(),o.initialObjects.TURBO_STATE_MAP.delete(s)},[e]);return hs.useEffect(()=>{if(!e)return;const{container:s}=e,o=s.initialObjects.TURBO_STATE_MAP,u=c=>{if(n.current.has(c.key)){const d=o.get(c.key),l=n.current.get(c.key);l?.forEach(f=>{f(d)})}};return o.on("valueChanged",u),o.forEach((c,d)=>{const l=n.current.get(d);l?.forEach(f=>{f(c)})}),()=>{o.off("valueChanged",u)}},[e]),{registerSharedSetStateAction:a,unregisterSharedSetStateAction:t,updateSharedState:i,deleteSharedState:r}};var $l={},Gl={},TF={},yv={},wF={},bv={},OF={},e4;function hie(){return e4||(e4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.IFluidCodeDetailsComparer=e.isFluidCodeDetails=e.isFluidPackage=void 0;const n=t=>typeof t=="object"&&typeof t?.name=="string"&&typeof t?.fluid=="object";e.isFluidPackage=n;const a=t=>{const i=t;return typeof i=="object"&&(typeof i?.package=="string"||(0,e.isFluidPackage)(i?.package))&&(i?.config===void 0||typeof i?.config=="object")};e.isFluidCodeDetails=a,e.IFluidCodeDetailsComparer="IFluidCodeDetailsComparer"})(OF)),OF}var t4;function Tme(){if(t4)return bv;t4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(bv,"__esModule",{value:!0}),bv.isFluidBrowserPackage=void 0;const e=hie(),n=a=>(0,e.isFluidPackage)(a)&&typeof a?.fluid?.browser?.umd?.library=="string"&&Array.isArray(a?.fluid?.browser?.umd?.files);return bv.isFluidBrowserPackage=n,bv}var vv={},n4;function wme(){if(n4)return vv;n4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vv,"__esModule",{value:!0}),vv.isIDeltaManagerFull=void 0;function e(n){return"inbound"in n&&"outbound"in n}return vv.isIDeltaManagerFull=e,vv}var Sv={},PF={},Cv={},r4;function Ome(){if(r4)return Cv;r4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(Cv,"__esModule",{value:!0}),Cv.FluidErrorTypes=void 0,Cv.FluidErrorTypes={genericError:"genericError",throttlingError:"throttlingError",dataCorruptionError:"dataCorruptionError",dataProcessingError:"dataProcessingError",usageError:"usageError"},Cv}var Wl={},i4;function Pme(){if(i4)return Wl;i4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(Wl,"__esModule",{value:!0}),Wl.IFluidRunnable=Wl.IFluidLoadable=void 0,Wl.IFluidLoadable="IFluidLoadable",Wl.IFluidRunnable="IFluidRunnable",Wl}var Zc={},s4;function Eme(){if(s4)return Zc;s4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(Zc,"__esModule",{value:!0}),Zc.fluidHandleSymbol=Zc.IFluidHandle=Zc.IFluidHandleContext=void 0,Zc.IFluidHandleContext="IFluidHandleContext",Zc.IFluidHandle="IFluidHandle",Zc.fluidHandleSymbol=Symbol.for("FluidHandle-3978c7cf-4675-49ba-a20c-bf35efbf43da"),Zc}var _v={},a4;function Ime(){if(a4)return _v;a4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(_v,"__esModule",{value:!0}),_v.LogLevel=void 0,_v.LogLevel={verbose:10,default:20,error:30},_v}var o4;function hd(){return o4||(o4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.LogLevel=e.fluidHandleSymbol=e.IFluidHandle=e.IFluidHandleContext=e.IFluidRunnable=e.IFluidLoadable=e.FluidErrorTypes=void 0;var n=Ome();Object.defineProperty(e,"FluidErrorTypes",{enumerable:!0,get:function(){return n.FluidErrorTypes}});var a=Pme();Object.defineProperty(e,"IFluidLoadable",{enumerable:!0,get:function(){return a.IFluidLoadable}}),Object.defineProperty(e,"IFluidRunnable",{enumerable:!0,get:function(){return a.IFluidRunnable}});var t=Eme();Object.defineProperty(e,"IFluidHandleContext",{enumerable:!0,get:function(){return t.IFluidHandleContext}}),Object.defineProperty(e,"IFluidHandle",{enumerable:!0,get:function(){return t.IFluidHandle}}),Object.defineProperty(e,"fluidHandleSymbol",{enumerable:!0,get:function(){return t.fluidHandleSymbol}});var i=Ime();Object.defineProperty(e,"LogLevel",{enumerable:!0,get:function(){return i.LogLevel}})})(PF)),PF}var c4;function Rme(){if(c4)return Sv;c4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Sv,"__esModule",{value:!0}),Sv.ContainerErrorTypes=void 0;const e=hd();return Sv.ContainerErrorTypes={...e.FluidErrorTypes,clientSessionExpiredError:"clientSessionExpiredError"},Sv}var Jl={},u4;function Fme(){if(u4)return Jl;u4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Jl,"__esModule",{value:!0}),Jl.LoaderHeader=Jl.ConnectionState=void 0;var e;(function(a){a.Disconnected=0,a.EstablishingConnection=3,a.CatchingUp=1,a.Connected=2})(e||(Jl.ConnectionState=e={}));var n;return(function(a){a.cache="fluid-cache",a.clientDetails="fluid-client-details",a.loadMode="loadMode",a.reconnect="fluid-reconnect",a.sequenceNumber="fluid-sequence-number",a.version="version"})(n||(Jl.LoaderHeader=n={})),Jl}var Ql={},d4;function jme(){if(d4)return Ql;d4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ql,"__esModule",{value:!0}),Ql.IRuntimeFactory=Ql.AttachState=void 0;var e;return(function(n){n.Detached="Detached",n.Attaching="Attaching",n.Attached="Attached"})(e||(Ql.AttachState=e={})),Ql.IRuntimeFactory="IRuntimeFactory",Ql}var l4;function Mr(){return l4||(l4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.IRuntimeFactory=e.AttachState=e.isFluidCodeDetails=e.isFluidPackage=e.IFluidCodeDetailsComparer=e.LoaderHeader=e.ConnectionState=e.ContainerErrorTypes=e.isIDeltaManagerFull=e.isFluidBrowserPackage=void 0;var n=Tme();Object.defineProperty(e,"isFluidBrowserPackage",{enumerable:!0,get:function(){return n.isFluidBrowserPackage}});var a=wme();Object.defineProperty(e,"isIDeltaManagerFull",{enumerable:!0,get:function(){return a.isIDeltaManagerFull}});var t=Rme();Object.defineProperty(e,"ContainerErrorTypes",{enumerable:!0,get:function(){return t.ContainerErrorTypes}});var i=Fme();Object.defineProperty(e,"ConnectionState",{enumerable:!0,get:function(){return i.ConnectionState}}),Object.defineProperty(e,"LoaderHeader",{enumerable:!0,get:function(){return i.LoaderHeader}});var r=hie();Object.defineProperty(e,"IFluidCodeDetailsComparer",{enumerable:!0,get:function(){return r.IFluidCodeDetailsComparer}}),Object.defineProperty(e,"isFluidPackage",{enumerable:!0,get:function(){return r.isFluidPackage}}),Object.defineProperty(e,"isFluidCodeDetails",{enumerable:!0,get:function(){return r.isFluidCodeDetails}});var s=jme();Object.defineProperty(e,"AttachState",{enumerable:!0,get:function(){return s.AttachState}}),Object.defineProperty(e,"IRuntimeFactory",{enumerable:!0,get:function(){return s.IRuntimeFactory}})})(wF)),wF}var EF={},Tv={},f4;function sx(){if(f4)return Tv;f4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Tv,"__esModule",{value:!0}),Tv.ConnectionState=void 0;var e;return(function(n){n[n.Disconnected=0]="Disconnected",n[n.EstablishingConnection=3]="EstablishingConnection",n[n.CatchingUp=1]="CatchingUp",n[n.Connected=2]="Connected"})(e||(Tv.ConnectionState=e={})),Tv}var to={},IF={},wi={},h4;function ax(){if(h4)return wi;h4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=wi&&wi.__createBinding||(Object.create?(function(c,d,l,f){f===void 0&&(f=l);var b=Object.getOwnPropertyDescriptor(d,l);(!b||("get"in b?!d.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return d[l]}}),Object.defineProperty(c,f,b)}):(function(c,d,l,f){f===void 0&&(f=l),c[f]=d[l]})),n=wi&&wi.__setModuleDefault||(Object.create?(function(c,d){Object.defineProperty(c,"default",{enumerable:!0,value:d})}):function(c,d){c.default=d}),a=wi&&wi.__importStar||function(c){if(c&&c.__esModule)return c;var d={};if(c!=null)for(var l in c)l!=="default"&&Object.prototype.hasOwnProperty.call(c,l)&&e(d,c,l);return n(d,c),d};Object.defineProperty(wi,"__esModule",{value:!0}),wi.IsoBuffer=wi.isArrayBuffer=wi.bufferToString=wi.stringToBuffer=wi.Uint8ArrayToString=void 0;const t=a(Xk());function i(c,d){switch(d){case"base64":return t.fromByteArray(c);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(c);default:throw new Error("invalid/unsupported encoding")}}wi.Uint8ArrayToString=i;const r=(c,d)=>u.from(c,d).buffer;wi.stringToBuffer=r;const s=(c,d)=>u.from(c).toString(d);wi.bufferToString=s;function o(c){const d=c;return c instanceof ArrayBuffer||typeof d=="object"&&d!==null&&typeof d.byteLength=="number"&&typeof d.slice=="function"&&d.byteOffset===void 0&&d.buffer===void 0}wi.isArrayBuffer=o;class u extends Uint8Array{toString(d){return i(this,d)}static from(d,l,f){if(typeof d=="string")return u.fromString(d,l);if(d!==null&&typeof d=="object"&&o(d.buffer))return u.fromArrayBuffer(d.buffer,d.byteOffset,d.byteLength);if(o(d))return u.fromArrayBuffer(d,l,f);throw new TypeError("Input value was neither a string nor an ArrayBuffer.")}static fromArrayBuffer(d,l,f){const b=l??0,C=f??d.byteLength-b;if(b<0||b>d.byteLength||C<0||C+b>d.byteLength)throw new RangeError("Invalid range specified.");return new u(d,b,C)}static fromString(d,l){switch(l){case"base64":{const f=this.sanitizeBase64(d),b=t.toByteArray(f);return new u(b.buffer)}case"utf8":case"utf-8":case void 0:{const f=new TextEncoder().encode(d);return new u(f.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(d){throw new Error("unimplemented")}static sanitizeBase64(d){let l=d;return l=l.split("=")[0],l=l.replace(/[^\w+-/]/g,""),l.length%4!==0&&(l+=["","===","==","="][l.length%4]),l}}return wi.IsoBuffer=u,wi}var fa={},m4;function Mme(){if(m4)return fa;m4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=fa&&fa.__createBinding||(Object.create?(function(c,d,l,f){f===void 0&&(f=l);var b=Object.getOwnPropertyDescriptor(d,l);(!b||("get"in b?!d.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return d[l]}}),Object.defineProperty(c,f,b)}):(function(c,d,l,f){f===void 0&&(f=l),c[f]=d[l]})),n=fa&&fa.__setModuleDefault||(Object.create?(function(c,d){Object.defineProperty(c,"default",{enumerable:!0,value:d})}):function(c,d){c.default=d}),a=fa&&fa.__importStar||function(c){if(c&&c.__esModule)return c;var d={};if(c!=null)for(var l in c)l!=="default"&&Object.prototype.hasOwnProperty.call(c,l)&&e(d,c,l);return n(d,c),d};Object.defineProperty(fa,"__esModule",{value:!0}),fa.gitHashFile=fa.hashFile=void 0;const t=a(Xk()),i=ax();async function r(c,d){const l=await crypto.subtle.digest(d,c);return new Uint8Array(l)}function s(c,d){switch(d){case"hex":return Array.prototype.map.call(c,f=>f.toString(16).padStart(2,"0")).join("");case"base64":return t.fromByteArray(c)}}async function o(c,d="SHA-1",l="hex"){if(crypto.subtle===void 0)return Zk(()=>import("./hashFileNode-DhY5-l_s.js").then(b=>b.h),__vite__mapDeps([0,1])).then(async b=>b.hashFile(c,d,l));const f=await r(c,d);return s(f,l)}fa.hashFile=o;async function u(c){const l=`blob ${c.byteLength.toString()}\0`,f=i.IsoBuffer.from(l+c.toString());return o(f)}return fa.gitHashFile=u,fa}var eu={},p4;function Nme(){if(p4)return eu;p4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(eu,"__esModule",{value:!0}),eu.toUtf8=eu.fromUtf8ToBase64=eu.fromBase64ToUtf8=void 0;const e=ax(),n=i=>e.IsoBuffer.from(i,"base64").toString("utf8");eu.fromBase64ToUtf8=n;const a=i=>e.IsoBuffer.from(i,"utf8").toString("base64");eu.fromUtf8ToBase64=a;const t=(i,r)=>{switch(r){case"utf8":case"utf-8":return i;default:return e.IsoBuffer.from(i,r).toString()}};return eu.toUtf8=t,eu}var wv={},g4;function Ame(){if(g4)return wv;g4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(wv,"__esModule",{value:!0}),wv.Uint8ArrayToArrayBuffer=void 0;function e(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}return wv.Uint8ArrayToArrayBuffer=e,wv}var RF={},y4;function mie(){return y4||(y4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var n=Bre();Object.defineProperty(e,"EventEmitter",{enumerable:!0,get:function(){return n.EventEmitter}})})(RF)),RF}var Ov={},b4;function pie(){if(b4)return Ov;b4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ov,"__esModule",{value:!0}),Ov.performanceNow=void 0;const e=()=>globalThis.performance.now();return Ov.performanceNow=e,Ov}var Pv={},v4;function Dme(){if(v4)return Pv;v4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Pv,"__esModule",{value:!0}),Pv.Trace=void 0;const e=pie();class n{static start(){const t=(0,e.performanceNow)();return new n(t)}constructor(t){this.startTick=t,this.lastTick=t}trace(){const t=(0,e.performanceNow)(),i={totalTimeElapsed:t-this.startTick,duration:t-this.lastTick,tick:t};return this.lastTick=t,i}}return Pv.Trace=n,Pv}var Ev={},S4;function kme(){if(S4)return Ev;S4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ev,"__esModule",{value:!0}),Ev.TypedEventEmitter=void 0;const e=mie();class n extends e.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}return Ev.TypedEventEmitter=n,Ev}var FF={},Yl={},C4;function xme(){if(C4)return Yl;C4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Yl,"__esModule",{value:!0}),Yl.createEmitter=Yl.CustomEventEmitter=void 0;function e(i,r,s){let o=i.get(r);return o===void 0&&(o=s(r),i.set(r,o)),o}class n{constructor(r){this.noListeners=r,this.listeners=new Map}emit(r,...s){const o=this.listeners.get(r);if(o!==void 0){const u=s;for(const c of[...o])o.has(c)&&c(...u)}}emitAndCollect(r,...s){const o=this.listeners.get(r);if(o!==void 0){const u=s,c=[];for(const d of[...o.values()])c.push(d(...u));return c}return[]}on(r,s){const o=e(this.listeners,r,()=>new Set);if(o.has(s)){const u=typeof r=="symbol"?r.description:String(r.toString());throw new Error(`Attempted to register the same listener object twice for event ${u}`)}return o.add(s),()=>this.off(r,s)}off(r,s){const o=this.listeners.get(r);o?.delete(s)===!0&&o.size===0&&(this.listeners.delete(r),this.noListeners?.(r))}hasListeners(r){return r===void 0?this.listeners.size>0:this.listeners.has(r)}}Yl.CustomEventEmitter=n;class a extends n{constructor(r){super(r)}emit(r,...s){return super.emit(r,...s)}emitAndCollect(r,...s){return super.emitAndCollect(r,...s)}}function t(i){return new a(i)}return Yl.createEmitter=t,Yl}var _4;function qme(){return _4||(_4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.CustomEventEmitter=e.createEmitter=void 0;var n=xme();Object.defineProperty(e,"createEmitter",{enumerable:!0,get:function(){return n.createEmitter}}),Object.defineProperty(e,"CustomEventEmitter",{enumerable:!0,get:function(){return n.CustomEventEmitter}})})(FF)),FF}var jF={},T4;function Lme(){return T4||(T4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.checkLayerCompatibility=e.defaultLayerCompatDetails=e.ILayerCompatDetails=void 0,e.ILayerCompatDetails="ILayerCompatDetails",e.defaultLayerCompatDetails={supportedFeatures:new Set,generation:0,pkgVersion:"unknown"};function n(a,t){const i=t??e.defaultLayerCompatDetails;let r=!0;const s=[];i.generation<a.minSupportedGeneration&&(r=!1);for(const o of a.requiredFeatures)i.supportedFeatures.has(o)||s.push(o);return r&&s.length===0?{isCompatible:!0}:{isCompatible:!1,isGenerationCompatible:r,unsupportedFeatures:s.length>0?s:void 0}}e.checkLayerCompatibility=n})(jF)),jF}var w4;function Ht(){return w4||(w4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.checkLayerCompatibility=e.createEmitter=e.TypedEventEmitter=e.Trace=e.performanceNow=e.EventEmitter=e.Uint8ArrayToArrayBuffer=e.toUtf8=e.fromUtf8ToBase64=e.fromBase64ToUtf8=e.hashFile=e.gitHashFile=e.Uint8ArrayToString=e.stringToBuffer=e.IsoBuffer=e.isArrayBuffer=e.bufferToString=void 0;var n=ax();Object.defineProperty(e,"bufferToString",{enumerable:!0,get:function(){return n.bufferToString}}),Object.defineProperty(e,"isArrayBuffer",{enumerable:!0,get:function(){return n.isArrayBuffer}}),Object.defineProperty(e,"IsoBuffer",{enumerable:!0,get:function(){return n.IsoBuffer}}),Object.defineProperty(e,"stringToBuffer",{enumerable:!0,get:function(){return n.stringToBuffer}}),Object.defineProperty(e,"Uint8ArrayToString",{enumerable:!0,get:function(){return n.Uint8ArrayToString}});var a=Mme();Object.defineProperty(e,"gitHashFile",{enumerable:!0,get:function(){return a.gitHashFile}}),Object.defineProperty(e,"hashFile",{enumerable:!0,get:function(){return a.hashFile}});var t=Nme();Object.defineProperty(e,"fromBase64ToUtf8",{enumerable:!0,get:function(){return t.fromBase64ToUtf8}}),Object.defineProperty(e,"fromUtf8ToBase64",{enumerable:!0,get:function(){return t.fromUtf8ToBase64}}),Object.defineProperty(e,"toUtf8",{enumerable:!0,get:function(){return t.toUtf8}});var i=Ame();Object.defineProperty(e,"Uint8ArrayToArrayBuffer",{enumerable:!0,get:function(){return i.Uint8ArrayToArrayBuffer}});var r=mie();Object.defineProperty(e,"EventEmitter",{enumerable:!0,get:function(){return r.EventEmitter}});var s=pie();Object.defineProperty(e,"performanceNow",{enumerable:!0,get:function(){return s.performanceNow}});var o=Dme();Object.defineProperty(e,"Trace",{enumerable:!0,get:function(){return o.Trace}});var u=kme();Object.defineProperty(e,"TypedEventEmitter",{enumerable:!0,get:function(){return u.TypedEventEmitter}});var c=qme();Object.defineProperty(e,"createEmitter",{enumerable:!0,get:function(){return c.createEmitter}});var d=Lme();Object.defineProperty(e,"checkLayerCompatibility",{enumerable:!0,get:function(){return d.checkLayerCompatibility}})})(IF)),IF}var MF={},Ps={},O4;function gie(){if(O4)return Ps;O4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.nonProductionConditionalsIncluded=Ps.configureDebugAsserts=Ps.debugAssert=Ps.onAssertionFailure=Ps.fail=Ps.assert=void 0;function e(c,d){c||n(d)}Ps.assert=e;function n(c){const d=new Error(typeof c=="number"?`0x${c.toString(16).padStart(3,"0")}`:c);throw a(d),d}Ps.fail=n;function a(c){for(const d of t)d(c)}const t=new Set;function i(c){const d=l=>{c(l)};return t.add(d),()=>{t.delete(d)}}Ps.onAssertionFailure=i;function r(c){}Ps.debugAssert=r;let s=!1;function o(c){e(u(),2737);const d=s;return s=c,d}Ps.configureDebugAsserts=o;function u(){return!1}return Ps.nonProductionConditionalsIncluded=u,Ps}var Iv={},P4;function Bme(){if(P4)return Iv;P4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Iv,"__esModule",{value:!0}),Iv.compareArrays=void 0;const e=(n,a,t=(i,r)=>Object.is(i,r))=>n===a||n.length===a.length&&n.every((i,r)=>t(i,a[r],r));return Iv.compareArrays=e,Iv}var Rv={},E4;function Ume(){if(E4)return Rv;E4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Rv,"__esModule",{value:!0}),Rv.delay=void 0;const e=async n=>new Promise(a=>setTimeout(()=>a(),n));return Rv.delay=e,Rv}var Xl={},I4;function zme(){if(I4)return Xl;I4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Xl,"__esModule",{value:!0}),Xl.Heap=Xl.NumberComparer=void 0,Xl.NumberComparer={compare:(n,a)=>n-a,min:Number.MIN_VALUE};class e{constructor(a){this.comp=a,this.L=[{value:a.min,position:0}]}peek(){return this.L[1]}get(){if(this.L.length===0)return;this.swap(1,this.count());const a=this.L.pop();return this.fixdown(1),a.value}add(a){const t={value:a,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(a){const t=a.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(a){const t=a.position;this.swap(a.position,this.L.length-1),this.L.splice(-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(a){let t=a;for(;this.isGreaterThanParent(t);){const i=t>>1;this.swap(t,i),t=i}}isGreaterThanParent(a){return a>1&&this.comp.compare(this.L[a>>1].value,this.L[a].value)>0}fixdown(a){let t=a;for(;t<<1<=this.count();){let i=t<<1;if(i<this.count()&&this.comp.compare(this.L[i].value,this.L[i+1].value)>0&&i++,this.comp.compare(this.L[t].value,this.L[i].value)<=0)break;this.swap(t,i),t=i}}swap(a,t){const i=this.L[a];this.L[a]=this.L[t],this.L[a].position=a,this.L[t]=i,this.L[t].position=t}}return Xl.Heap=e,Xl}var Zl={},R4;function Vme(){if(R4)return Zl;R4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Zl,"__esModule",{value:!0}),Zl.LazyPromise=Zl.Lazy=void 0;class e{constructor(t){this.valueGenerator=t,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}Zl.Lazy=e;class n{get[Symbol.toStringTag](){return"[object LazyPromise]"}constructor(t){this.execute=t}async then(t,i){return this.getPromise().then(...arguments)}async catch(t){return this.getPromise().catch(...arguments)}async finally(t){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}}return Zl.LazyPromise=n,Zl}var tu={},F4;function Hme(){if(F4)return tu;F4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(tu,"__esModule",{value:!0}),tu.iterateListValuesWhile=tu.walkList=tu.DoublyLinkedList=void 0;class e{constructor(u){this._next=this,this._prev=this,this.headNode=this,u&&(this._list=u)}get next(){return this._next===this.headNode?void 0:this._next}get prev(){return this._prev===this.headNode?void 0:this._prev}get list(){return this.headNode._list}}const n=new e(void 0);class a extends e{constructor(u,c){super(void 0),this.data=c,this.headNode=u}remove(){return this.list?.remove(this)}}function t(o,u){let c=o;const d=c._next;let l;for(const f of u){const b=new a(o.headNode,f);l===void 0?l={first:b,last:b}:l.last=b,b._prev=c,c._next=b,c=b}if(d._prev=c,c._next=d,l===void 0)throw new Error("items must not be empty");return l}class i{constructor(u){this._len=0,this.headNode=new e(this),u!==void 0&&this.push(...u)}find(u){let c;return r(this,d=>{if(u(d,this))return c=d,!1}),c}map(u){let c=this.first;return{next(){if(c===void 0)return{done:!0,value:void 0};const l={value:u(c),done:!1};return c=c.next,l},[Symbol.iterator](){return this}}}insertAfter(u,...c){if(!this._includes(u))throw new Error("preceding not in list");return this._len+=c.length,t(u,c)}pop(){return this.remove(this.last)}push(...u){this._len+=u.length;const c=this.headNode._prev;return t(c,u)}shift(){return this.remove(this.first)}unshift(...u){return this._len+=u.length,t(this.headNode,u)}splice(u,c){const d=new i;return r(this,l=>{const f=this._remove(l);if(f.headNode=d.headNode,f._next=d.headNode,f._prev=d.headNode._prev,d.headNode._prev._next=f,d.headNode._prev=f,d._len++,l===c||d.length===c)return!1},u),d}includes(u){return this._includes(u)}_includes(u){return u instanceof a&&u.headNode===this.headNode}_remove(u){if(this._includes(u))return u._prev._next=u._next,u._next._prev=u._prev,u.headNode=u._next=u._prev=n,this._len--,u}remove(u){return this._remove(u)}[Symbol.iterator](){let u=this.first;return{next(){if(u!==void 0){const d={value:u,done:!1};return u=u.next,d}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}get length(){return this._len}get empty(){return this._len===0}get first(){return this.headNode.next}get last(){return this.headNode.prev}}tu.DoublyLinkedList=i;function r(o,u,c,d=!0){let l;if(c){if(!o.includes(c))throw new Error("start must be in the provided list");l=c}else l=d?o.first:o.last;let f=d?l?.next:l?.prev;for(;l!==void 0;){if(u(l)===!1)return!1;l=f,f=d?f?.next:f?.prev}return!0}tu.walkList=r;function s(o,u){let c=o;return{next:()=>{if(c!==void 0){const l=c;if(c=l.next,u(l)===!0)return{value:l.data,done:!1}}return{done:!0,value:void 0}},[Symbol.iterator](){return this}}}return tu.iterateListValuesWhile=s,tu}var Fv={},j4;function Kme(){if(j4)return Fv;j4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Fv,"__esModule",{value:!0}),Fv.PromiseCache=void 0;class e{constructor(t,i){this.expiry=t,this.cleanup=i,this.gcTimeouts=new Map}schedule(t){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(t,setTimeout(()=>{this.cleanup(t),this.cancel(t)},this.expiry.durationMs))}cancel(t){const i=this.gcTimeouts.get(t);i!==void 0&&(clearTimeout(i),this.gcTimeouts.delete(t))}update(t){this.expiry.policy==="sliding"&&(this.cancel(t),this.schedule(t))}}class n{constructor({expiry:t={policy:"indefinite"},removeOnError:i=()=>!0}={}){this.cache=new Map,this.removeOnError=i,this.gc=new e(t,r=>this.remove(r))}has(t){return this.cache.has(t)}get(t){return this.has(t)&&this.gc.update(t),this.cache.get(t)}remove(t){return this.gc.cancel(t),this.cache.delete(t)}async addOrGet(t,i){let r=this.get(t);return r===void 0&&(r=(async()=>i())(),this.cache.set(t,r),r.catch(o=>{this.removeOnError(o)&&this.remove(t)}),this.gc.schedule(t)),r}add(t,i){const r=this.has(t);return this.addOrGet(t,i).catch(()=>{}),!r}async addValueOrGet(t,i){return this.addOrGet(t,async()=>i)}addValue(t,i){return this.add(t,async()=>i)}}return Fv.PromiseCache=n,Fv}var jv={},M4;function yie(){if(M4)return jv;M4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(jv,"__esModule",{value:!0}),jv.Deferred=void 0;class e{constructor(){this.completed=!1,this.p=new Promise((a,t)=>{this.res=a,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(a){this.res!==void 0&&(this.completed=!0,this.res(a))}reject(a){this.rej!==void 0&&(this.completed=!0,this.rej(a))}}return jv.Deferred=e,jv}var Mv={},N4;function $me(){if(N4)return Mv;N4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Mv,"__esModule",{value:!0}),Mv.shallowCloneObject=void 0;function e(n){return Array.isArray(n)?[...n]:{...n}}return Mv.shallowCloneObject=e,Mv}var nu={},A4;function Gme(){if(A4)return nu;A4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(nu,"__esModule",{value:!0}),nu.PromiseTimer=nu.Timer=nu.setLongTimeout=void 0;const e=gie(),n=yie(),a=2147483647;function t(s,o,u){let c;if(o>a){const d=o-a;c=setTimeout(()=>t(s,d,u),a)}else c=setTimeout(()=>s(),Math.max(o,0));return u?.(c),c}nu.setLongTimeout=t;class i{get hasTimer(){return!!this.runningState}constructor(o,u,c){this.defaultTimeout=o,this.defaultHandler=u,this.exceptionHandler=c,this.getCurrentTick=()=>Date.now()}start(o=this.defaultTimeout,u=this.defaultHandler){this.startCore(o,u,o)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(o,u){if(this.runningState){const c=o??this.runningState.intendedDuration,d=u??this.runningState.restart?.handler??this.runningState.handler,l=this.calculateRemainingTime(this.runningState);c<l?this.start(c,d):c===l?(this.runningState.handler=d,this.runningState.restart=void 0,this.runningState.intendedDuration=c):this.runningState.restart={startTick:this.getCurrentTick(),duration:c,handler:d}}else this.start(o,u)}startCore(o,u,c){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:o,intendedDuration:c,handler:u,timeout:t(()=>this.handler(),o,d=>{this.runningState!==void 0&&(this.runningState.timeout=d)})}}handler(){(0,e.assert)(!!this.runningState,1892);const o=this.runningState.restart;if(o===void 0){const u=this.runningState.handler;this.clear();try{u()}catch(c){if(this.exceptionHandler)this.exceptionHandler(c);else throw c}}else{const u=this.calculateRemainingTime(o);this.startCore(u,()=>o.handler(),o.duration)}}calculateRemainingTime(o){const u=this.getCurrentTick()-o.startTick;return o.duration-u}}nu.Timer=i;class r{get hasTimer(){return this.timer.hasTimer}constructor(o,u){this.timer=new i(o,()=>this.wrapHandler(u))}async start(o,u){return this.clear(),this.deferred=new n.Deferred,this.timer.start(o,u?()=>this.wrapHandler(u):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(o){o(),(0,e.assert)(!!this.deferred,1893),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}return nu.PromiseTimer=r,nu}var Nv={},D4;function Wme(){if(D4)return Nv;D4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Nv,"__esModule",{value:!0}),Nv.unreachableCase=void 0;function e(n,a="Unreachable Case"){throw new Error(a)}return Nv.unreachableCase=e,Nv}var NF={},k4;function Jme(){return k4||(k4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isPromiseLike=e.isObject=void 0;const n=t=>typeof t=="object"&&t!==null;e.isObject=n;const a=t=>(0,e.isObject)(t)&&"then"in t&&typeof t.then=="function";e.isPromiseLike=a})(NF)),NF}var Av={},x4;function Qme(){if(x4)return Av;x4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Av,"__esModule",{value:!0}),Av.oob=void 0;function e(){throw new Error("Array index is out of bounds")}return Av.oob=e,Av}var q4;function Je(){return q4||(q4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.oob=e.isPromiseLike=e.isObject=e.unreachableCase=e.Timer=e.setLongTimeout=e.PromiseTimer=e.shallowCloneObject=e.Deferred=e.PromiseCache=e.walkList=e.iterateListValuesWhile=e.DoublyLinkedList=e.LazyPromise=e.Lazy=e.NumberComparer=e.Heap=e.delay=e.compareArrays=e.onAssertionFailure=e.nonProductionConditionalsIncluded=e.configureDebugAsserts=e.debugAssert=e.fail=e.assert=void 0;var n=gie();Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return n.assert}}),Object.defineProperty(e,"fail",{enumerable:!0,get:function(){return n.fail}}),Object.defineProperty(e,"debugAssert",{enumerable:!0,get:function(){return n.debugAssert}}),Object.defineProperty(e,"configureDebugAsserts",{enumerable:!0,get:function(){return n.configureDebugAsserts}}),Object.defineProperty(e,"nonProductionConditionalsIncluded",{enumerable:!0,get:function(){return n.nonProductionConditionalsIncluded}}),Object.defineProperty(e,"onAssertionFailure",{enumerable:!0,get:function(){return n.onAssertionFailure}});var a=Bme();Object.defineProperty(e,"compareArrays",{enumerable:!0,get:function(){return a.compareArrays}});var t=Ume();Object.defineProperty(e,"delay",{enumerable:!0,get:function(){return t.delay}});var i=zme();Object.defineProperty(e,"Heap",{enumerable:!0,get:function(){return i.Heap}}),Object.defineProperty(e,"NumberComparer",{enumerable:!0,get:function(){return i.NumberComparer}});var r=Vme();Object.defineProperty(e,"Lazy",{enumerable:!0,get:function(){return r.Lazy}}),Object.defineProperty(e,"LazyPromise",{enumerable:!0,get:function(){return r.LazyPromise}});var s=Hme();Object.defineProperty(e,"DoublyLinkedList",{enumerable:!0,get:function(){return s.DoublyLinkedList}}),Object.defineProperty(e,"iterateListValuesWhile",{enumerable:!0,get:function(){return s.iterateListValuesWhile}}),Object.defineProperty(e,"walkList",{enumerable:!0,get:function(){return s.walkList}});var o=Kme();Object.defineProperty(e,"PromiseCache",{enumerable:!0,get:function(){return o.PromiseCache}});var u=yie();Object.defineProperty(e,"Deferred",{enumerable:!0,get:function(){return u.Deferred}});var c=$me();Object.defineProperty(e,"shallowCloneObject",{enumerable:!0,get:function(){return c.shallowCloneObject}});var d=Gme();Object.defineProperty(e,"PromiseTimer",{enumerable:!0,get:function(){return d.PromiseTimer}}),Object.defineProperty(e,"setLongTimeout",{enumerable:!0,get:function(){return d.setLongTimeout}}),Object.defineProperty(e,"Timer",{enumerable:!0,get:function(){return d.Timer}});var l=Wme();Object.defineProperty(e,"unreachableCase",{enumerable:!0,get:function(){return l.unreachableCase}});var f=Jme();Object.defineProperty(e,"isObject",{enumerable:!0,get:function(){return f.isObject}}),Object.defineProperty(e,"isPromiseLike",{enumerable:!0,get:function(){return f.isPromiseLike}});var b=Qme();Object.defineProperty(e,"oob",{enumerable:!0,get:function(){return b.oob}})})(MF)),MF}var AF={},Dv={},L4;function Yme(){if(L4)return Dv;L4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Dv,"__esModule",{value:!0}),Dv.DriverErrorTypes=void 0;const e=hd(),{dataCorruptionError:n,dataProcessingError:a,...t}=e.FluidErrorTypes;return Dv.DriverErrorTypes={...t,genericNetworkError:"genericNetworkError",authorizationError:"authorizationError",fileNotFoundOrAccessDeniedError:"fileNotFoundOrAccessDeniedError",offlineError:"offlineError",unsupportedClientProtocolVersion:"unsupportedClientProtocolVersion",writeError:"writeError",fetchFailure:"fetchFailure",fetchTokenError:"fetchTokenError",incorrectServerResponse:"incorrectServerResponse",fileOverwrittenInStorage:"fileOverwrittenInStorage",deltaStreamConnectionForbidden:"deltaStreamConnectionForbidden",locationRedirection:"locationRedirection",fluidInvalidSchema:"fluidInvalidSchema",fileIsLocked:"fileIsLocked",outOfStorageError:"outOfStorageError"},Dv}var ef={},B4;function Xme(){if(B4)return ef;B4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ef,"__esModule",{value:!0}),ef.FetchSource=ef.LoaderCachingPolicy=void 0;var e;(function(a){a[a.NoCaching=0]="NoCaching",a[a.Prefetch=1]="Prefetch"})(e||(ef.LoaderCachingPolicy=e={}));var n;return(function(a){a.default="default",a.noCache="noCache"})(n||(ef.FetchSource=n={})),ef}var kv={},U4;function Zme(){if(U4)return kv;U4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(kv,"__esModule",{value:!0}),kv.DriverHeader=void 0;var e;return(function(n){n.summarizingClient="fluid-client-summarizer",n.createNew="createNew"})(e||(kv.DriverHeader=e={})),kv}var DF={},ru={},z4;function epe(){if(z4)return ru;z4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ru,"__esModule",{value:!0}),ru.NackErrorType=ru.SignalType=ru.MessageType=void 0;var e;(function(t){t.NoOp="noop",t.ClientJoin="join",t.ClientLeave="leave",t.Propose="propose",t.Reject="reject",t.Accept="accept",t.Summarize="summarize",t.SummaryAck="summaryAck",t.SummaryNack="summaryNack",t.Operation="op",t.NoClient="noClient",t.RoundTrip="tripComplete",t.Control="control"})(e||(ru.MessageType=e={}));var n;(function(t){t.ClientJoin="join",t.ClientLeave="leave"})(n||(ru.SignalType=n={}));var a;return(function(t){t.ThrottlingError="ThrottlingError",t.InvalidScopeError="InvalidScopeError",t.BadRequestError="BadRequestError",t.LimitExceededError="LimitExceededError"})(a||(ru.NackErrorType=a={})),ru}var xv={},V4;function tpe(){if(V4)return xv;V4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(xv,"__esModule",{value:!0}),xv.ScopeType=void 0;var e;return(function(n){n.DocRead="doc:read",n.DocWrite="doc:write",n.SummaryWrite="summary:write"})(e||(xv.ScopeType=e={})),xv}var tf={},H4;function npe(){if(H4)return tf;H4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(tf,"__esModule",{value:!0}),tf.TreeEntry=tf.FileMode=void 0;var e;(function(a){a.File="100644",a.Executable="100755",a.Directory="040000",a.Symlink="120000"})(e||(tf.FileMode=e={}));var n;return(function(a){a.Blob="Blob",a.Tree="Tree",a.Attachment="Attachment"})(n||(tf.TreeEntry=n={})),tf}var qv={},K4;function rpe(){if(K4)return qv;K4=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qv,"__esModule",{value:!0}),qv.SummaryType=void 0;var e;return(function(n){n.Tree=1,n.Blob=2,n.Handle=3,n.Attachment=4})(e||(qv.SummaryType=e={})),qv}var $4;function ipe(){return $4||($4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.SummaryType=e.TreeEntry=e.FileMode=e.ScopeType=e.SignalType=e.NackErrorType=e.MessageType=void 0;var n=epe();Object.defineProperty(e,"MessageType",{enumerable:!0,get:function(){return n.MessageType}}),Object.defineProperty(e,"NackErrorType",{enumerable:!0,get:function(){return n.NackErrorType}}),Object.defineProperty(e,"SignalType",{enumerable:!0,get:function(){return n.SignalType}});var a=tpe();Object.defineProperty(e,"ScopeType",{enumerable:!0,get:function(){return a.ScopeType}});var t=npe();Object.defineProperty(e,"FileMode",{enumerable:!0,get:function(){return t.FileMode}}),Object.defineProperty(e,"TreeEntry",{enumerable:!0,get:function(){return t.TreeEntry}});var i=rpe();Object.defineProperty(e,"SummaryType",{enumerable:!0,get:function(){return i.SummaryType}})})(DF)),DF}var G4;function on(){return G4||(G4=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TreeEntry=e.SummaryType=e.SignalType=e.ScopeType=e.NackErrorType=e.MessageType=e.FileMode=e.DriverHeader=e.LoaderCachingPolicy=e.FetchSource=e.DriverErrorTypes=void 0;var n=Yme();Object.defineProperty(e,"DriverErrorTypes",{enumerable:!0,get:function(){return n.DriverErrorTypes}});var a=Xme();Object.defineProperty(e,"FetchSource",{enumerable:!0,get:function(){return a.FetchSource}}),Object.defineProperty(e,"LoaderCachingPolicy",{enumerable:!0,get:function(){return a.LoaderCachingPolicy}});var t=Zme();Object.defineProperty(e,"DriverHeader",{enumerable:!0,get:function(){return t.DriverHeader}});var i=ipe();Object.defineProperty(e,"FileMode",{enumerable:!0,get:function(){return i.FileMode}}),Object.defineProperty(e,"MessageType",{enumerable:!0,get:function(){return i.MessageType}}),Object.defineProperty(e,"NackErrorType",{enumerable:!0,get:function(){return i.NackErrorType}}),Object.defineProperty(e,"ScopeType",{enumerable:!0,get:function(){return i.ScopeType}}),Object.defineProperty(e,"SignalType",{enumerable:!0,get:function(){return i.SignalType}}),Object.defineProperty(e,"SummaryType",{enumerable:!0,get:function(){return i.SummaryType}}),Object.defineProperty(e,"TreeEntry",{enumerable:!0,get:function(){return i.TreeEntry}})})(AF)),AF}var kF={},Lv={},xF={},Bw={},W4;function spe(){return W4||(W4=1,Object.defineProperty(Bw,"__esModule",{value:!0}),Bw.default="ffffffff-ffff-ffff-ffff-ffffffffffff"),Bw}var Uw={},J4;function ape(){return J4||(J4=1,Object.defineProperty(Uw,"__esModule",{value:!0}),Uw.default="00000000-0000-0000-0000-000000000000"),Uw}var zw={},Vw={},Hw={},Q4;function ope(){return Q4||(Q4=1,Object.defineProperty(Hw,"__esModule",{value:!0}),Hw.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i),Hw}var Y4;function mE(){if(Y4)return Vw;Y4=1,Object.defineProperty(Vw,"__esModule",{value:!0});const e=ope();function n(a){return typeof a=="string"&&e.default.test(a)}return Vw.default=n,Vw}var X4;function pE(){if(X4)return zw;X4=1,Object.defineProperty(zw,"__esModule",{value:!0});const e=mE();function n(a){if(!(0,e.default)(a))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(a.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,t&255,(t=parseInt(a.slice(9,13),16))>>>8,t&255,(t=parseInt(a.slice(14,18),16))>>>8,t&255,(t=parseInt(a.slice(19,23),16))>>>8,t&255,(t=parseInt(a.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255)}return zw.default=n,zw}var Uy={},Z4;function ll(){if(Z4)return Uy;Z4=1,Object.defineProperty(Uy,"__esModule",{value:!0}),Uy.unsafeStringify=void 0;const e=mE(),n=[];for(let i=0;i<256;++i)n.push((i+256).toString(16).slice(1));function a(i,r=0){return(n[i[r+0]]+n[i[r+1]]+n[i[r+2]]+n[i[r+3]]+"-"+n[i[r+4]]+n[i[r+5]]+"-"+n[i[r+6]]+n[i[r+7]]+"-"+n[i[r+8]]+n[i[r+9]]+"-"+n[i[r+10]]+n[i[r+11]]+n[i[r+12]]+n[i[r+13]]+n[i[r+14]]+n[i[r+15]]).toLowerCase()}Uy.unsafeStringify=a;function t(i,r=0){const s=a(i,r);if(!(0,e.default)(s))throw TypeError("Stringified UUID is invalid");return s}return Uy.default=t,Uy}var zy={},Kw={},eU;function ox(){if(eU)return Kw;eU=1,Object.defineProperty(Kw,"__esModule",{value:!0});let e;const n=new Uint8Array(16);function a(){if(!e){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");e=crypto.getRandomValues.bind(crypto)}return e(n)}return Kw.default=a,Kw}var tU;function bie(){if(tU)return zy;tU=1,Object.defineProperty(zy,"__esModule",{value:!0}),zy.updateV1State=void 0;const e=ox(),n=ll(),a={};function t(s,o,u){let c;const d=s?._v6??!1;if(s){const l=Object.keys(s);l.length===1&&l[0]==="_v6"&&(s=void 0)}if(s)c=r(s.random??s.rng?.()??(0,e.default)(),s.msecs,s.nsecs,s.clockseq,s.node,o,u);else{const l=Date.now(),f=(0,e.default)();i(a,l,f),c=r(f,a.msecs,a.nsecs,d?void 0:a.clockseq,d?void 0:a.node,o,u)}return o??(0,n.unsafeStringify)(c)}function i(s,o,u){return s.msecs??=-1/0,s.nsecs??=0,o===s.msecs?(s.nsecs++,s.nsecs>=1e4&&(s.node=void 0,s.nsecs=0)):o>s.msecs?s.nsecs=0:o<s.msecs&&(s.node=void 0),s.node||(s.node=u.slice(10,16),s.node[0]|=1,s.clockseq=(u[8]<<8|u[9])&16383),s.msecs=o,s}zy.updateV1State=i;function r(s,o,u,c,d,l,f=0){if(s.length<16)throw new Error("Random bytes length must be >= 16");if(!l)l=new Uint8Array(16),f=0;else if(f<0||f+16>l.length)throw new RangeError(`UUID byte range ${f}:${f+15} is out of buffer bounds`);o??=Date.now(),u??=0,c??=(s[8]<<8|s[9])&16383,d??=s.slice(10,16),o+=122192928e5;const b=((o&268435455)*1e4+u)%4294967296;l[f++]=b>>>24&255,l[f++]=b>>>16&255,l[f++]=b>>>8&255,l[f++]=b&255;const C=o/4294967296*1e4&268435455;l[f++]=C>>>8&255,l[f++]=C&255,l[f++]=C>>>24&15|16,l[f++]=C>>>16&255,l[f++]=c>>>8|128,l[f++]=c&255;for(let v=0;v<6;++v)l[f++]=d[v];return l}return zy.default=t,zy}var $w={},nU;function vie(){if(nU)return $w;nU=1,Object.defineProperty($w,"__esModule",{value:!0});const e=pE(),n=ll();function a(i){const r=typeof i=="string"?(0,e.default)(i):i,s=t(r);return typeof i=="string"?(0,n.unsafeStringify)(s):s}$w.default=a;function t(i){return Uint8Array.of((i[6]&15)<<4|i[7]>>4&15,(i[7]&15)<<4|(i[4]&240)>>4,(i[4]&15)<<4|(i[5]&240)>>4,(i[5]&15)<<4|(i[0]&240)>>4,(i[0]&15)<<4|(i[1]&240)>>4,(i[1]&15)<<4|(i[2]&240)>>4,96|i[2]&15,i[3],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])}return $w}var qF={},Gw={},rU;function cpe(){if(rU)return Gw;rU=1,Object.defineProperty(Gw,"__esModule",{value:!0});function e(f){const b=i(f),C=t(b,f.length*8);return n(C)}function n(f){const b=new Uint8Array(f.length*4);for(let C=0;C<f.length*4;C++)b[C]=f[C>>2]>>>C%4*8&255;return b}function a(f){return(f+64>>>9<<4)+14+1}function t(f,b){const C=new Uint32Array(a(b)).fill(0);C.set(f),C[b>>5]|=128<<b%32,C[C.length-1]=b,f=C;let v=1732584193,m=-271733879,h=-1732584194,g=271733878;for(let _=0;_<f.length;_+=16){const S=v,p=m,w=h,O=g;v=u(v,m,h,g,f[_],7,-680876936),g=u(g,v,m,h,f[_+1],12,-389564586),h=u(h,g,v,m,f[_+2],17,606105819),m=u(m,h,g,v,f[_+3],22,-1044525330),v=u(v,m,h,g,f[_+4],7,-176418897),g=u(g,v,m,h,f[_+5],12,1200080426),h=u(h,g,v,m,f[_+6],17,-1473231341),m=u(m,h,g,v,f[_+7],22,-45705983),v=u(v,m,h,g,f[_+8],7,1770035416),g=u(g,v,m,h,f[_+9],12,-1958414417),h=u(h,g,v,m,f[_+10],17,-42063),m=u(m,h,g,v,f[_+11],22,-1990404162),v=u(v,m,h,g,f[_+12],7,1804603682),g=u(g,v,m,h,f[_+13],12,-40341101),h=u(h,g,v,m,f[_+14],17,-1502002290),m=u(m,h,g,v,f[_+15],22,1236535329),v=c(v,m,h,g,f[_+1],5,-165796510),g=c(g,v,m,h,f[_+6],9,-1069501632),h=c(h,g,v,m,f[_+11],14,643717713),m=c(m,h,g,v,f[_],20,-373897302),v=c(v,m,h,g,f[_+5],5,-701558691),g=c(g,v,m,h,f[_+10],9,38016083),h=c(h,g,v,m,f[_+15],14,-660478335),m=c(m,h,g,v,f[_+4],20,-405537848),v=c(v,m,h,g,f[_+9],5,568446438),g=c(g,v,m,h,f[_+14],9,-1019803690),h=c(h,g,v,m,f[_+3],14,-187363961),m=c(m,h,g,v,f[_+8],20,1163531501),v=c(v,m,h,g,f[_+13],5,-1444681467),g=c(g,v,m,h,f[_+2],9,-51403784),h=c(h,g,v,m,f[_+7],14,1735328473),m=c(m,h,g,v,f[_+12],20,-1926607734),v=d(v,m,h,g,f[_+5],4,-378558),g=d(g,v,m,h,f[_+8],11,-2022574463),h=d(h,g,v,m,f[_+11],16,1839030562),m=d(m,h,g,v,f[_+14],23,-35309556),v=d(v,m,h,g,f[_+1],4,-1530992060),g=d(g,v,m,h,f[_+4],11,1272893353),h=d(h,g,v,m,f[_+7],16,-155497632),m=d(m,h,g,v,f[_+10],23,-1094730640),v=d(v,m,h,g,f[_+13],4,681279174),g=d(g,v,m,h,f[_],11,-358537222),h=d(h,g,v,m,f[_+3],16,-722521979),m=d(m,h,g,v,f[_+6],23,76029189),v=d(v,m,h,g,f[_+9],4,-640364487),g=d(g,v,m,h,f[_+12],11,-421815835),h=d(h,g,v,m,f[_+15],16,530742520),m=d(m,h,g,v,f[_+2],23,-995338651),v=l(v,m,h,g,f[_],6,-198630844),g=l(g,v,m,h,f[_+7],10,1126891415),h=l(h,g,v,m,f[_+14],15,-1416354905),m=l(m,h,g,v,f[_+5],21,-57434055),v=l(v,m,h,g,f[_+12],6,1700485571),g=l(g,v,m,h,f[_+3],10,-1894986606),h=l(h,g,v,m,f[_+10],15,-1051523),m=l(m,h,g,v,f[_+1],21,-2054922799),v=l(v,m,h,g,f[_+8],6,1873313359),g=l(g,v,m,h,f[_+15],10,-30611744),h=l(h,g,v,m,f[_+6],15,-1560198380),m=l(m,h,g,v,f[_+13],21,1309151649),v=l(v,m,h,g,f[_+4],6,-145523070),g=l(g,v,m,h,f[_+11],10,-1120210379),h=l(h,g,v,m,f[_+2],15,718787259),m=l(m,h,g,v,f[_+9],21,-343485551),v=r(v,S),m=r(m,p),h=r(h,w),g=r(g,O)}return Uint32Array.of(v,m,h,g)}function i(f){if(f.length===0)return new Uint32Array;const b=new Uint32Array(a(f.length*8)).fill(0);for(let C=0;C<f.length;C++)b[C>>2]|=(f[C]&255)<<C%4*8;return b}function r(f,b){const C=(f&65535)+(b&65535);return(f>>16)+(b>>16)+(C>>16)<<16|C&65535}function s(f,b){return f<<b|f>>>32-b}function o(f,b,C,v,m,h){return r(s(r(r(b,f),r(v,h)),m),C)}function u(f,b,C,v,m,h,g){return o(b&C|~b&v,f,b,m,h,g)}function c(f,b,C,v,m,h,g){return o(b&v|C&~v,f,b,m,h,g)}function d(f,b,C,v,m,h,g){return o(b^C^v,f,b,m,h,g)}function l(f,b,C,v,m,h,g){return o(C^(b|~v),f,b,m,h,g)}return Gw.default=e,Gw}var cc={},iU;function XP(){if(iU)return cc;iU=1,Object.defineProperty(cc,"__esModule",{value:!0}),cc.URL=cc.DNS=cc.stringToBytes=void 0;const e=pE(),n=ll();function a(i){i=unescape(encodeURIComponent(i));const r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}cc.stringToBytes=a,cc.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",cc.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function t(i,r,s,o,u,c){const d=typeof s=="string"?a(s):s,l=typeof o=="string"?(0,e.default)(o):o;if(typeof o=="string"&&(o=(0,e.default)(o)),o?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let f=new Uint8Array(16+d.length);if(f.set(l),f.set(d,l.length),f=r(f),f[6]=f[6]&15|i,f[8]=f[8]&63|128,u){c=c||0;for(let b=0;b<16;++b)u[c+b]=f[b];return u}return(0,n.unsafeStringify)(f)}return cc.default=t,cc}var sU;function upe(){return sU||(sU=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0;const n=cpe(),a=XP();var t=XP();Object.defineProperty(e,"DNS",{enumerable:!0,get:function(){return t.DNS}}),Object.defineProperty(e,"URL",{enumerable:!0,get:function(){return t.URL}});function i(r,s,o,u){return(0,a.default)(48,n.default,r,s,o,u)}i.DNS=a.DNS,i.URL=a.URL,e.default=i})(qF)),qF}var Ww={},Jw={},aU;function dpe(){if(aU)return Jw;aU=1,Object.defineProperty(Jw,"__esModule",{value:!0});const e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);return Jw.default={randomUUID:e},Jw}var oU;function lpe(){if(oU)return Ww;oU=1,Object.defineProperty(Ww,"__esModule",{value:!0});const e=dpe(),n=ox(),a=ll();function t(i,r,s){if(e.default.randomUUID&&!r&&!i)return e.default.randomUUID();i=i||{};const o=i.random??i.rng?.()??(0,n.default)();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,r){if(s=s||0,s<0||s+16>r.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let u=0;u<16;++u)r[s+u]=o[u];return r}return(0,a.unsafeStringify)(o)}return Ww.default=t,Ww}var LF={},Qw={},cU;function fpe(){if(cU)return Qw;cU=1,Object.defineProperty(Qw,"__esModule",{value:!0});function e(t,i,r,s){switch(t){case 0:return i&r^~i&s;case 1:return i^r^s;case 2:return i&r^i&s^r&s;case 3:return i^r^s}}function n(t,i){return t<<i|t>>>32-i}function a(t){const i=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520],s=new Uint8Array(t.length+1);s.set(t),s[t.length]=128,t=s;const o=t.length/4+2,u=Math.ceil(o/16),c=new Array(u);for(let d=0;d<u;++d){const l=new Uint32Array(16);for(let f=0;f<16;++f)l[f]=t[d*64+f*4]<<24|t[d*64+f*4+1]<<16|t[d*64+f*4+2]<<8|t[d*64+f*4+3];c[d]=l}c[u-1][14]=(t.length-1)*8/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=(t.length-1)*8&4294967295;for(let d=0;d<u;++d){const l=new Uint32Array(80);for(let h=0;h<16;++h)l[h]=c[d][h];for(let h=16;h<80;++h)l[h]=n(l[h-3]^l[h-8]^l[h-14]^l[h-16],1);let f=r[0],b=r[1],C=r[2],v=r[3],m=r[4];for(let h=0;h<80;++h){const g=Math.floor(h/20),_=n(f,5)+e(g,b,C,v)+m+i[g]+l[h]>>>0;m=v,v=C,C=n(b,30)>>>0,b=f,f=_}r[0]=r[0]+f>>>0,r[1]=r[1]+b>>>0,r[2]=r[2]+C>>>0,r[3]=r[3]+v>>>0,r[4]=r[4]+m>>>0}return Uint8Array.of(r[0]>>24,r[0]>>16,r[0]>>8,r[0],r[1]>>24,r[1]>>16,r[1]>>8,r[1],r[2]>>24,r[2]>>16,r[2]>>8,r[2],r[3]>>24,r[3]>>16,r[3]>>8,r[3],r[4]>>24,r[4]>>16,r[4]>>8,r[4])}return Qw.default=a,Qw}var uU;function hpe(){return uU||(uU=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0;const n=fpe(),a=XP();var t=XP();Object.defineProperty(e,"DNS",{enumerable:!0,get:function(){return t.DNS}}),Object.defineProperty(e,"URL",{enumerable:!0,get:function(){return t.URL}});function i(r,s,o,u){return(0,a.default)(80,n.default,r,s,o,u)}i.DNS=a.DNS,i.URL=a.URL,e.default=i})(LF)),LF}var Yw={},dU;function mpe(){if(dU)return Yw;dU=1,Object.defineProperty(Yw,"__esModule",{value:!0});const e=ll(),n=bie(),a=vie();function t(i,r,s){i??={},s??=0;let o=(0,n.default)({...i,_v6:!0},new Uint8Array(16));if(o=(0,a.default)(o),r){for(let u=0;u<16;u++)r[s+u]=o[u];return r}return(0,e.unsafeStringify)(o)}return Yw.default=t,Yw}var Xw={},lU;function ppe(){if(lU)return Xw;lU=1,Object.defineProperty(Xw,"__esModule",{value:!0});const e=pE(),n=ll();function a(i){const r=typeof i=="string"?(0,e.default)(i):i,s=t(r);return typeof i=="string"?(0,n.unsafeStringify)(s):s}Xw.default=a;function t(i){return Uint8Array.of((i[3]&15)<<4|i[4]>>4&15,(i[4]&15)<<4|(i[5]&240)>>4,(i[5]&15)<<4|i[6]&15,i[7],(i[1]&15)<<4|(i[2]&240)>>4,(i[2]&15)<<4|(i[3]&240)>>4,16|(i[0]&240)>>4,(i[0]&15)<<4|(i[1]&240)>>4,i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])}return Xw}var Vy={},fU;function gpe(){if(fU)return Vy;fU=1,Object.defineProperty(Vy,"__esModule",{value:!0}),Vy.updateV7State=void 0;const e=ox(),n=ll(),a={};function t(s,o,u){let c;if(s)c=r(s.random??s.rng?.()??(0,e.default)(),s.msecs,s.seq,o,u);else{const d=Date.now(),l=(0,e.default)();i(a,d,l),c=r(l,a.msecs,a.seq,o,u)}return o??(0,n.unsafeStringify)(c)}function i(s,o,u){return s.msecs??=-1/0,s.seq??=0,o>s.msecs?(s.seq=u[6]<<23|u[7]<<16|u[8]<<8|u[9],s.msecs=o):(s.seq=s.seq+1|0,s.seq===0&&s.msecs++),s}Vy.updateV7State=i;function r(s,o,u,c,d=0){if(s.length<16)throw new Error("Random bytes length must be >= 16");if(!c)c=new Uint8Array(16),d=0;else if(d<0||d+16>c.length)throw new RangeError(`UUID byte range ${d}:${d+15} is out of buffer bounds`);return o??=Date.now(),u??=s[6]*127<<24|s[7]<<16|s[8]<<8|s[9],c[d++]=o/1099511627776&255,c[d++]=o/4294967296&255,c[d++]=o/16777216&255,c[d++]=o/65536&255,c[d++]=o/256&255,c[d++]=o&255,c[d++]=112|u>>>28&15,c[d++]=u>>>20&255,c[d++]=128|u>>>14&63,c[d++]=u>>>6&255,c[d++]=u<<2&255|s[10]&3,c[d++]=s[11],c[d++]=s[12],c[d++]=s[13],c[d++]=s[14],c[d++]=s[15],c}return Vy.default=t,Vy}var Zw={},hU;function ype(){if(hU)return Zw;hU=1,Object.defineProperty(Zw,"__esModule",{value:!0});const e=mE();function n(a){if(!(0,e.default)(a))throw TypeError("Invalid UUID");return parseInt(a.slice(14,15),16)}return Zw.default=n,Zw}var mU;function ys(){return mU||(mU=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.version=e.validate=e.v7=e.v6ToV1=e.v6=e.v5=e.v4=e.v3=e.v1ToV6=e.v1=e.stringify=e.parse=e.NIL=e.MAX=void 0;var n=spe();Object.defineProperty(e,"MAX",{enumerable:!0,get:function(){return n.default}});var a=ape();Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}});var t=pE();Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return t.default}});var i=ll();Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return i.default}});var r=bie();Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return r.default}});var s=vie();Object.defineProperty(e,"v1ToV6",{enumerable:!0,get:function(){return s.default}});var o=upe();Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return o.default}});var u=lpe();Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return u.default}});var c=hpe();Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return c.default}});var d=mpe();Object.defineProperty(e,"v6",{enumerable:!0,get:function(){return d.default}});var l=ppe();Object.defineProperty(e,"v6ToV1",{enumerable:!0,get:function(){return l.default}});var f=gpe();Object.defineProperty(e,"v7",{enumerable:!0,get:function(){return f.default}});var b=mE();Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return b.default}});var C=ype();Object.defineProperty(e,"version",{enumerable:!0,get:function(){return C.default}})})(xF)),xF}var BF={},iu={},pU;function bpe(){if(pU)return iu;pU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(iu,"__esModule",{value:!0}),iu.buildGitTreeHierarchy=iu.getGitType=iu.getGitMode=void 0;const e=Je(),n=on();function a(r){const s=r.type===n.SummaryType.Handle?r.handleType:r.type;switch(s){case n.SummaryType.Blob:case n.SummaryType.Attachment:return n.FileMode.File;case n.SummaryType.Tree:return n.FileMode.Directory;default:(0,e.unreachableCase)(s,`Unknown type: ${s}`)}}iu.getGitMode=a;function t(r){const s=r.type===n.SummaryType.Handle?r.handleType:r.type;switch(s){case n.SummaryType.Blob:case n.SummaryType.Attachment:return"blob";case n.SummaryType.Tree:return"tree";default:(0,e.unreachableCase)(s,`Unknown type: ${s}`)}}iu.getGitType=t;function i(r,s=new Map,o=!1){const u={},c={id:r.sha,blobs:{},trees:{}};u[""]=c;for(const d of r.tree){const l=o?d.path.replace(/^\.app\//,""):d.path,f=l.lastIndexOf("/"),b=l.slice(0,Math.max(0,f)),C=l.slice(f+1),v=u[b];if(d.type==="tree"){const m={id:d.sha,blobs:{},commits:{},trees:{}};v.trees[decodeURIComponent(C)]=m,u[l]=m}else if(d.type==="blob")v.blobs[decodeURIComponent(C)]=d.sha,s.set(d.sha,`/${l}`);else throw new Error("Unknown entry type!!")}return c}return iu.buildGitTreeHierarchy=i,iu}var gU;function Sie(){return gU||(gU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getGitType=e.getGitMode=e.buildGitTreeHierarchy=void 0;var n=bpe();Object.defineProperty(e,"buildGitTreeHierarchy",{enumerable:!0,get:function(){return n.buildGitTreeHierarchy}}),Object.defineProperty(e,"getGitMode",{enumerable:!0,get:function(){return n.getGitMode}}),Object.defineProperty(e,"getGitType",{enumerable:!0,get:function(){return n.getGitType}})})(BF)),BF}var yU;function vpe(){if(yU)return Lv;yU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Lv,"__esModule",{value:!0}),Lv.buildSnapshotTree=void 0;const e=Ht(),n=Je(),a=on(),t=ys(),i=Sie();function r(u,c,d){const l=[];for(const f of c){const b=`${u}${f.path}`;if(f.type===a.TreeEntry.Blob){const C=f.value,v=(0,e.stringToBuffer)(C.contents,C.encoding),m=(0,t.v4)();d.set(m,v);const h={mode:a.FileMode[f.mode],path:b,sha:m,size:0,type:"blob",url:""};l.push(h)}else if(f.type===a.TreeEntry.Tree){(0,n.assert)(f.type===a.TreeEntry.Tree,257);const C=f.value,v={mode:a.FileMode[f.mode],path:b,sha:"",size:-1,type:"tree",url:""};l.push(v);const m=r(`${b}/`,C.entries,d);l.push(...m)}}return l}function s(u,c){return{sha:"",tree:r("",u,c),url:""}}function o(u,c){const d=s(u,c);return(0,i.buildGitTreeHierarchy)(d)}return Lv.buildSnapshotTree=o,Lv}var su={},bU;function Cie(){if(bU)return su;bU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(su,"__esModule",{value:!0}),su.AttachmentTreeEntry=su.TreeTreeEntry=su.BlobTreeEntry=void 0;const e=on();class n{constructor(r,s,o="utf-8"){this.path=r,this.mode=e.FileMode.File,this.type=e.TreeEntry.Blob,this.value={contents:s,encoding:o}}}su.BlobTreeEntry=n;class a{constructor(r,s){this.path=r,this.value=s,this.mode=e.FileMode.Directory,this.type=e.TreeEntry.Tree}}su.TreeTreeEntry=a;class t{constructor(r,s){this.path=r,this.id=s,this.mode=e.FileMode.File,this.type=e.TreeEntry.Attachment,this.value={id:s}}}return su.AttachmentTreeEntry=t,su}var Bv={},UF={},zF={},VF={},HF={},KF={},vU;function _ie(){return vU||(vU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isFluidError=e.hasErrorInstanceId=void 0;const n=i=>typeof i?.getTelemetryProperties=="function"&&typeof i?.addTelemetryProperties=="function",a=i=>typeof i?.errorInstanceId=="string";e.hasErrorInstanceId=a;function t(i){return typeof i?.errorType=="string"&&typeof i?.message=="string"&&(0,e.hasErrorInstanceId)(i)&&n(i)}e.isFluidError=t})(KF)),KF}var SU;function cx(){return SU||(SU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.NORMALIZED_ERROR_TYPE=e.LoggingError=e.getCircularReplacer=e.isTaggedTelemetryPropertyValue=e.isExternalError=e.overwriteStack=e.wrapErrorAndLog=e.wrapError=e.generateStack=e.generateErrorWithStack=e.normalizeError=e.isILoggingError=e.extractLogSafeErrorProperties=void 0;const n=ys(),a=_ie(),t=gE(),i=S=>S!==null&&!Array.isArray(S)&&typeof S=="object";function r(S,p){const w=(F,R)=>{if(!p)return F;const M=F.split(`
`);return M.shift(),R!==void 0&&M.unshift(R),M.join(`
`)},E={message:typeof S?.message=="string"?S.message:String(S)};if(i(S)){const{errorType:F,stack:R,name:M}=S;if(typeof F=="string"&&(E.errorType=F),typeof R=="string"){const j=typeof M=="string"?M:void 0;E.stack=w(R,j)}}return E}e.extractLogSafeErrorProperties=r;const s=S=>typeof S?.getTelemetryProperties=="function";e.isILoggingError=s;function o(S,p){for(const[w,O]of Object.entries(p))S[w]===void 0&&(S[w]=O)}function u(S,p={}){if((0,a.isFluidError)(S))return S.addTelemetryProperties(p.props??{}),S;const{message:w,stack:O}=r(S,!1),E=new _({message:w,stack:O});if(typeof S=="object"&&S!==null){const R=S;let M;"canRetry"in S&&(M??={},M.canRetry=R.canRetry),"retryAfterSeconds"in S&&(M??={},M.retryAfterSeconds=R.retryAfterSeconds),M!==void 0&&Object.assign(E,M)}typeof S!="object"&&E.addTelemetryProperties({typeofError:typeof S});const F=g.typeCheck(S)?S.getTelemetryProperties():{untrustedOrigin:1};return E.addTelemetryProperties({...F,...p.props}),E}e.normalizeError=u;let c;function d(S){const p=Error,w=p.stackTraceLimit;S!==void 0&&(p.stackTraceLimit=S);const O=new Error("<<generated stack>>");if(c===void 0&&(c=O.stack!==void 0),c)return p.stackTraceLimit=w,O;try{throw O}catch(E){return p.stackTraceLimit=w,E}}e.generateErrorWithStack=d;function l(S){return d(S).stack}e.generateStack=l;function f(S,p){const{message:w,stack:O}=r(S,!1),E=p(w);return O!==void 0&&C(E,O),v(S)&&E.addTelemetryProperties({untrustedOrigin:1}),(0,a.hasErrorInstanceId)(S)&&(E.overwriteErrorInstanceId(S.errorInstanceId),E.addTelemetryProperties({innerErrorInstanceId:S.errorInstanceId})),(0,e.isILoggingError)(S)&&E.addTelemetryProperties(S.getTelemetryProperties()),E}e.wrapError=f;function b(S,p,w){const O=f(S,p),E=O.errorInstanceId,F=E;return w.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:E,wrappedByErrorInstanceId:F},S),O}e.wrapErrorAndLog=b;function C(S,p){try{Object.assign(S,{stack:p})}catch{S.addTelemetryProperties({stack2:p})}}e.overwriteStack=C;function v(S){if(g.typeCheck(S)){if(S.errorType===e.NORMALIZED_ERROR_TYPE){const p=S.getTelemetryProperties();return p.untrustedOrigin===1||!!p.errorRunningExternalCode}return!1}return!0}e.isExternalError=v;function m(S){return typeof S?.tag=="string"}e.isTaggedTelemetryPropertyValue=m;const h=()=>{const S=new WeakSet;return(p,w)=>{if(typeof w=="object"&&w!==null){if(S.has(w))return"<removed/circular>";S.add(w)}return w}};e.getCircularReplacer=h;class g extends Error{get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(p){this._errorInstanceId=p}constructor(p,w,O=new Set){super(p),this.omitPropsFromLogging=O,this._errorInstanceId=(0,n.v4)(),O.add("omitPropsFromLogging"),O.add("_errorInstanceId"),w&&this.addTelemetryProperties(w)}static typeCheck(p){return typeof p=="object"&&p!==null?typeof p.addTelemetryProperties=="function"&&typeof p.getTelemetryProperties=="function"&&typeof p.errorInstanceId=="string":!1}addTelemetryProperties(p){o(this,p)}getTelemetryProperties(){const p={};for(const w of Object.keys(this)){if(this.omitPropsFromLogging.has(w))continue;const O=this[w];p[w]=(0,t.convertToBasePropertyType)(O)}return{...p,stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId}}}e.LoggingError=g,e.NORMALIZED_ERROR_TYPE="genericError";class _ extends g{constructor(p){super(p.message),this.errorType=e.NORMALIZED_ERROR_TYPE,p.stack!==void 0&&C(this,p.stack)}}})(HF)),HF}var CU;function gE(){return CU||(CU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.tagCodeArtifacts=e.tagData=e.convertToBasePropertyType=e.PerformanceEvent=e.MultiSinkLogger=e.createMultiSinkLogger=e.ChildLogger=e.createChildLogger=e.TaggedLoggerAdapter=e.TelemetryLogger=e.eventNamespaceSeparator=e.formatTick=e.numberFromString=e.TelemetryDataTag=void 0;const n=Ht(),a=hd(),t=ux(),i=cx();var r;(function(S){S.CodeArtifact="CodeArtifact",S.UserData="UserData"})(r||(e.TelemetryDataTag=r={}));function s(S){if(S==null)return;const p=Number(S);return Number.isNaN(p)?S:p}e.numberFromString=s;function o(S){return Math.floor(S)}e.formatTick=o,e.eventNamespaceSeparator=":";class u{static sanitizePkgName(p){return p.replace("@","").replace("/","-")}static prepareErrorObject(p,w,O){const{message:E,errorType:F,stack:R}=(0,i.extractLogSafeErrorProperties)(w,!0);if(p.stack=R,p.error=E,p.errorType=F,(0,i.isILoggingError)(w)){const M=w.getTelemetryProperties();for(const j of Object.keys(M))p[j]===void 0&&(p[j]=M[j])}p.stack===void 0&&O&&(p.stack=(0,i.generateStack)())}constructor(p,w){this.namespace=p,this.properties=w}sendTelemetryEvent(p,w,O=a.LogLevel.default){this.sendTelemetryEventCore({...p,category:p.category??"generic"},w,p.category==="error"?a.LogLevel.error:O)}sendTelemetryEventCore(p,w,O){const E=v(p);w!==void 0&&u.prepareErrorObject(E,w,!1),typeof E.duration=="number"&&(E.duration=o(E.duration)),this.send(E,O)}sendErrorEvent(p,w){this.sendTelemetryEventCore({error:p.eventName,...p,category:"error"},w,a.LogLevel.error)}sendPerformanceEvent(p,w,O=a.LogLevel.default){const E={...p,category:p.category??"performance"};this.sendTelemetryEventCore(E,w,E.category==="error"?a.LogLevel.error:O)}prepareEvent(p){const w=p.category==="error"||p.error!==void 0,O={...p};return this.namespace!==void 0&&(O.eventName=`${this.namespace}${u.eventNamespaceSeparator}${O.eventName}`),this.extendProperties(O,w)}extendProperties(p,w){const O=p;if(this.properties){const E=[];E.push(this.properties.all),w&&E.push(this.properties.error);for(const F of E)if(F!==void 0)for(const[R,M]of Object.entries(F)){if(O[R]!==void 0)continue;const j=typeof M=="function"?M():M;j!==void 0&&(O[R]=j)}}return p}}e.TelemetryLogger=u,u.eventNamespaceSeparator=e.eventNamespaceSeparator;class c{constructor(p){this.logger=p}send(p){const w={category:p.category,eventName:p.eventName};for(const[O,E]of Object.entries(p)){const{value:F,tag:R}=typeof E=="object"?E:{value:E,tag:void 0};switch(R){case void 0:{w[O]=F;break}case"PackageData":case r.CodeArtifact:{w[O]=F;break}case r.UserData:{w[O]="REDACTED (UserData)";break}default:{w[O]="REDACTED (unknown tag)";break}}}this.logger.send(w)}}e.TaggedLoggerAdapter=c;function d(S){return l.create(S?.logger,S?.namespace,S?.properties)}e.createChildLogger=d;class l extends u{static create(p,w,O){if(p instanceof l){const E={};for(const M of[p.properties,O])M!==void 0&&(M.all!==void 0&&(E.all={...E.all,...M.all}),M.error!==void 0&&(E.error={...E.error,...M.error}));const F=p.namespace===void 0?w:w===void 0?p.namespace:`${p.namespace}${u.eventNamespaceSeparator}${w}`,R=new l(p.baseLogger,F,E);return!(0,t.loggerIsMonitoringContext)(R)&&(0,t.loggerIsMonitoringContext)(p)&&(0,t.mixinMonitoringContext)(R,p.config),R}return new l(p??{send(){}},w,O)}constructor(p,w,O){super(w,O),this.baseLogger=p,(0,t.loggerIsMonitoringContext)(p)&&(0,t.mixinMonitoringContext)(this,new t.CachedConfigProvider(this,p.config))}get minLogLevel(){return this.baseLogger.minLogLevel}shouldFilterOutEvent(p,w){const O=w??a.LogLevel.default,E=this.baseLogger.minLogLevel??a.LogLevel.default;return O<E}send(p,w){this.shouldFilterOutEvent(p,w)||this.baseLogger.send(this.prepareEvent(p),w)}}e.ChildLogger=l;function f(S){return new b(S.namespace,S.properties,S.loggers?.filter(p=>p!==void 0),S.tryInheritProperties)}e.createMultiSinkLogger=f;class b extends u{constructor(p,w,O=[],E){let F=w===void 0?void 0:{...w};if(E===!0){const R=F??={};O.filter(M=>M instanceof u).map(M=>M.properties??{}).forEach(M=>{Object.keys(M).forEach(j=>{R[j]={...M[j],...R?.[j]}})})}super(p,F),this.loggers=O,this._minLogLevelOfAllLoggers=a.LogLevel.default,this.calculateMinLogLevel()}get minLogLevel(){return this._minLogLevelOfAllLoggers}calculateMinLogLevel(){if(this.loggers.length>0){const p=[];for(const w of this.loggers)p.push(w.minLogLevel??a.LogLevel.default);this._minLogLevelOfAllLoggers=Math.min(...p)}}addLogger(p){p!=null&&(this.loggers.push(p),this.calculateMinLogLevel())}send(p){const w=this.prepareEvent(p);for(const O of this.loggers)O.send(w)}}e.MultiSinkLogger=b;class C{static start(p,w,O,E=!0){return new C(p,w,O,E)}static timedExec(p,w,O,E,F=1){const R=C.start(p,w,E,C.shouldReport(w,F));try{const M=O(R);return R.autoEnd(),M}catch(M){throw R.cancel(void 0,M),M}}static async timedExecAsync(p,w,O,E,F=1){const R=C.start(p,w,E,C.shouldReport(w,F));try{const M=await O(R);return R.autoEnd(),M}catch(M){throw R.cancel(void 0,M),M}}get duration(){return(0,n.performanceNow)()-this.startTime}constructor(p,w,O={end:!0,cancel:"generic"},E=!0){this.logger=p,this.markers=O,this.emitLogs=E,this.startTime=(0,n.performanceNow)(),this.event={...w},this.markers.start&&this.reportEvent("start"),typeof window=="object"&&window?.performance?.mark!==void 0&&window?.performance?.mark!==null&&(this.startMark=`${w.eventName}-start`,window.performance.mark(this.startMark))}reportProgress(p,w="update"){this.reportEvent(w,p)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(p){this.reportEvent("end",p),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark!==void 0&&this.event){const p=`${this.event.eventName}-end`;window.performance.mark(p),window.performance.measure(`${this.event.eventName}`,this.startMark,p),this.startMark=void 0}}cancel(p,w){this.markers.cancel!==void 0&&this.reportEvent("cancel",{category:this.markers.cancel,...p},w),this.event=void 0}reportEvent(p,w,O){if(!this.event||!this.emitLogs)return;const E={...this.event,...w};E.eventName=`${E.eventName}_${p}`,p!=="start"&&(E.duration=this.duration),this.logger.sendPerformanceEvent(E,O)}static shouldReport(p,w){const O=`.${p.category}.${p.eventName}`,E=C.eventHits.get(O)??0;return C.eventHits.set(O,E>=w?1:E+1),E%w===0}}e.PerformanceEvent=C,C.eventHits=new Map;function v({category:S,eventName:p,...w}){const O={category:S,eventName:p};for(const E of Object.keys(w))O[E]=m(w[E]);return O}function m(S){return(0,i.isTaggedTelemetryPropertyValue)(S)?{value:h(S.value),tag:S.tag}:h(S)}e.convertToBasePropertyType=m;function h(S){switch(typeof S){case"string":case"number":case"boolean":case"undefined":return S;case"object":return JSON.stringify(S);default:return console.error(`convertToBasePropertyTypeUntagged: INVALID PROPERTY (typed as ${typeof S})`),`INVALID PROPERTY (typed as ${typeof S})`}}const g=(S,p)=>Object.entries(p).filter(w=>w[1]!==void 0).reduce((w,O)=>{const[E,F]=O;return typeof F=="function"?w[E]=()=>({tag:S,value:F()}):w[E]={tag:S,value:F},w},{});e.tagData=g;const _=S=>(0,e.tagData)(r.CodeArtifact,S);e.tagCodeArtifacts=_})(VF)),VF}var _U;function ux(){return _U||(_U=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.createConfigBasedOptionsProxy=e.createChildMonitoringContext=e.mixinMonitoringContext=e.loggerToMonitoringContext=e.loggerIsMonitoringContext=e.CachedConfigProvider=e.wrapConfigProviderWithDefaults=e.inMemoryConfigProvider=e.sessionStorageConfigProvider=void 0;const n=Je(),a=gE();e.sessionStorageConfigProvider=new n.Lazy(()=>(0,e.inMemoryConfigProvider)(o()));const t={getRawConfig:()=>{}},i=m=>m!=null?new c(void 0,{getRawConfig:h=>{try{return s(m.getItem(h)??void 0)?.raw}catch{return}}}):t;e.inMemoryConfigProvider=i;function r(m){switch(m){case"boolean":case"number":case"string":return!0;default:return!1}}function s(m){let h=m,g;if(typeof m=="string")try{h=JSON.parse(m),g={raw:m,string:m}}catch{}if(h===void 0)return g;const _=typeof h;if(r(_))return{...g,raw:m,[_]:h};if(Array.isArray(h)){const S=typeof h[0];if(!r(S))return g;for(const p of h)if(typeof p!==S)return g;return{...g,raw:m,[`${S}[]`]:h}}return g}const o=()=>{try{return globalThis.sessionStorage??void 0}catch{return}},u=(m,h)=>({getRawConfig:g=>m?.getRawConfig(g)??h[g]});e.wrapConfigProviderWithDefaults=u;class c{constructor(h,...g){this.logger=h,this.configCache=new Map,this.orderedBaseProviders=[];const _=new Set,S=[...g];for(;S.length>0;){const p=S.shift();p!==void 0&&b(p)&&!_.has(p)&&(_.add(p),p instanceof c?S.push(...p.orderedBaseProviders):this.orderedBaseProviders.push(p))}}getBoolean(h){return this.getCacheEntry(h)?.boolean}getNumber(h){return this.getCacheEntry(h)?.number}getString(h){return this.getCacheEntry(h)?.string}getBooleanArray(h){return this.getCacheEntry(h)?.["boolean[]"]}getNumberArray(h){return this.getCacheEntry(h)?.["number[]"]}getStringArray(h){return this.getCacheEntry(h)?.["string[]"]}getRawConfig(h){return this.getCacheEntry(h)?.raw}getCacheEntry(h){if(!this.configCache.has(h)){for(const g of this.orderedBaseProviders){const _=s(g?.getRawConfig(h));if(_!==void 0)return this.configCache.set(h,_),this.logger?.send({category:"generic",eventName:"ConfigRead",...(0,a.tagCodeArtifacts)({configName:h,configValue:JSON.stringify(_)})}),_}this.configCache.set(h,{raw:void 0})}return this.configCache.get(h)}}e.CachedConfigProvider=c;function d(m){const h=m;return b(h?.config)&&h?.logger!==void 0}e.loggerIsMonitoringContext=d;function l(m){return d(m)?m:f(m,e.sessionStorageConfigProvider.value)}e.loggerToMonitoringContext=l;function f(m,...h){if(d(m))throw new Error("Logger is already a monitoring context");const g=m;return g.config=new c(m,...h),g.logger=m,g}e.mixinMonitoringContext=f;function b(m){return typeof m?.getRawConfig=="function"}function C(m){return l((0,a.createChildLogger)(m))}e.createChildMonitoringContext=C;function v(m,h,g,_){const S=m instanceof c?m:new c(void 0,m),p=new Set([...Object.keys(_??{}),...Object.keys(g)]);return new Proxy(Object.freeze({}),{get:(w,O)=>{const E=g[O],F=E?.(S,`${h}.${O}`);return F!==void 0?F:_?.[O]},has:(w,O)=>p.has(O),ownKeys:()=>{throw new TypeError("OptionsProxy keys are not enumerable")}})}e.createConfigBasedOptionsProxy=v})(zF)),zF}var $F={},TU;function Spe(){return TU||(TU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.extractSafePropertiesFromMessage=e.DataProcessingError=e.DataCorruptionError=e.UsageError=e.GenericError=e.validatePrecondition=void 0;const n=hd(),a=cx();function t(c,d,l){if(!c)throw new r(d,l)}e.validatePrecondition=t;class i extends a.LoggingError{constructor(d,l,f){super(d,f,new Set(["error"])),this.error=l,this.errorType=n.FluidErrorTypes.genericError}}e.GenericError=i;class r extends a.LoggingError{constructor(d,l){super(d,{...l,usageError:!0}),this.errorType=n.FluidErrorTypes.usageError}}e.UsageError=r;class s extends a.LoggingError{constructor(d,l){super(d,{...l,dataProcessingError:1}),this.errorType=n.FluidErrorTypes.dataCorruptionError,this.canRetry=!1}}e.DataCorruptionError=s;class o extends a.LoggingError{constructor(d,l){super(d,l),this.errorType=n.FluidErrorTypes.dataProcessingError,this.canRetry=!1}static create(d,l,f,b={},C){const v=Error,m=v.stackTraceLimit;try{C!==void 0&&(v.stackTraceLimit=C);const h=o.wrapIfUnrecognized(d,l,f);return h.addTelemetryProperties(b),h}finally{C!==void 0&&(v.stackTraceLimit=m)}}static wrapIfUnrecognized(d,l,f){const b={dataProcessingError:1,dataProcessingCodepath:l,...f===void 0?void 0:(0,e.extractSafePropertiesFromMessage)(f)},C=(0,a.normalizeError)(d,{props:b});if((0,a.isExternalError)(C)||C.errorType===a.NORMALIZED_ERROR_TYPE){const v=(0,a.wrapError)(C,m=>new o(m));return v.addTelemetryProperties(C.getTelemetryProperties()),v}return C}}e.DataProcessingError=o;const u=c=>({messageClientId:c.clientId===null?"null":c.clientId,messageSequenceNumber:c.sequenceNumber,messageClientSequenceNumber:c.clientSequenceNumber,messageReferenceSequenceNumber:c.referenceSequenceNumber,messageMinimumSequenceNumber:c.minimumSequenceNumber,messageTimestamp:c.timestamp});e.extractSafePropertiesFromMessage=u})($F)),$F}var Uv={},wU;function Cpe(){if(wU)return Uv;wU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Uv,"__esModule",{value:!0}),Uv.EventEmitterWithErrorHandling=void 0;const e=Ht();class n extends e.TypedEventEmitter{constructor(t){super(),this.errorHandler=t}emit(t,...i){try{return super.emit(t,...i)}catch(r){return this.errorHandler(t,r),!0}}}return Uv.EventEmitterWithErrorHandling=n,Uv}var GF={},OU;function _pe(){return OU||(OU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.raiseConnectedEvent=e.safeRaiseEvent=e.disconnectedEventName=e.connectedEventName=void 0,e.connectedEventName="connected",e.disconnectedEventName="disconnected";function n(t,i,r,...s){try{t.emit(r,...s)}catch(o){i.sendErrorEvent({eventName:"RaiseEventError",event:r},o)}}e.safeRaiseEvent=n;function a(t,i,r,s,o){try{r?i.emit(e.connectedEventName,s):i.emit(e.disconnectedEventName,o)}catch(u){t.sendErrorEvent({eventName:"RaiseConnectedEventError"},u)}}e.raiseConnectedEvent=a})(GF)),GF}var nf={},PU;function Tpe(){if(PU)return nf;PU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(nf,"__esModule",{value:!0}),nf.createMockLoggerExt=nf.MockLogger=void 0;const e=hd(),n=Je(),a=gE();class t{get events(){return[...this._events]}constructor(o){this._events=[],this.minLogLevel=o??e.LogLevel.default}clear(){this._events=[]}toTelemetryLogger(){return(0,a.createChildLogger)({logger:this})}send(o,u){(u??e.LogLevel.default)>=this.minLogLevel&&this._events.push(o)}matchEvents(o,u=!1,c=!0){const d=this.getMatchedEventsCount(o,u,c);return o.length-d===0}assertMatch(o,u,c=!1,d=!0){const l=this.events;if(!this.matchEvents(o,c,d))throw new Error(`${u??"Logs don't match"}
expected:
${JSON.stringify(o)}

actual:
${JSON.stringify(l)}`)}matchAnyEvent(o,u=!1,c=!0){return this.getMatchedEventsCount(o,u,c)>0}assertMatchAny(o,u,c=!1,d=!0){const l=this.events;if(!this.matchAnyEvent(o,c,d))throw new Error(`${u??"Logs don't match"}
expected:
${JSON.stringify(o)}

actual:
${JSON.stringify(l)}`)}matchEventStrict(o,u=!1,c=!0){return o.length!==this._events.length?(c&&this.clear(),!1):this.matchEvents(o,u,c)}assertMatchStrict(o,u,c=!1,d=!0){const l=this.events;if(!this.matchEventStrict(o,c,d))throw new Error(`${u??"Logs don't match"}
expected:
${JSON.stringify(o)}

actual:
${JSON.stringify(l)}`)}assertMatchNone(o,u,c=!1,d=!0){const l=this.events;if(this.matchAnyEvent(o,c,d))throw new Error(`${u??"Logs don't match"}
disallowed events:
${JSON.stringify(o)}

actual:
${JSON.stringify(l)}`)}getMatchedEventsCount(o,u,c){let d=0;for(const l of this._events){const f=o[d];d<o.length&&f!==void 0&&t.eventsMatch(l,f,u)&&++d}return c&&this.clear(),d}static eventsMatch(o,u,c){const{details:d,...l}=o;if(c&&d!==void 0){(0,n.assert)(typeof d=="string",1737);const f=JSON.parse(d);return i({...l,...f},u)}return i(o,u)}assertNoErrors(o,u=!0){const d=this.events.filter(l=>l.category==="error");if(u&&this.clear(),d.length>0)throw new Error(`${o??"Errors found in logs"}

error logs:
${JSON.stringify(d)}`)}}nf.MockLogger=t;function i(s,o){for(const[u,c]of Object.entries(o)){const d=s[u];if(!Array.isArray(c)&&c!==null&&typeof c=="object"){if(Array.isArray(d)||d===null||typeof d!="object"||!i(d,c))return!1}else if(JSON.stringify(d)!==JSON.stringify(c))return!1}return!0}function r(s){const o=new t(s),u=(0,a.createChildLogger)({logger:o});return Object.assign(u,{events:()=>o.events.map(c=>c)})}return nf.createMockLoggerExt=r,nf}var zv={},EU;function wpe(){if(EU)return zv;EU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(zv,"__esModule",{value:!0}),zv.ThresholdCounter=void 0;class e{constructor(a,t,i=a){this.threshold=a,this.logger=t,this.thresholdMultiple=i}send(a,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:a,value:t})}sendIfMultiple(a,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:a,value:t}),this.thresholdMultiple=this.thresholdMultiple*2)}}return zv.ThresholdCounter=e,zv}var Vv={},Hv={},IU;function Tie(){if(IU)return Hv;IU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Hv,"__esModule",{value:!0}),Hv.roundToDecimalPlaces=void 0;function e(n,a){const t=Math.pow(10,a);return Math.round(n*t)/t}return Hv.roundToDecimalPlaces=e,Hv}var RU;function Ope(){if(RU)return Vv;RU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Vv,"__esModule",{value:!0}),Vv.SampledTelemetryHelper=void 0;const e=Ht(),n=Je(),a=Tie();class t{get disposed(){return this._disposed}constructor(r,s,o,u=!1,c=new Map){this.eventBase=r,this.logger=s,this.sampleThreshold=o,this.includeAggregateMetrics=u,this.perBucketProperties=c,this._disposed=!1,this.measurementsMap=new Map}measure(r,s=""){const o=(0,e.performanceNow)(),u=r(),c=(0,e.performanceNow)()-o;let d=this.measurementsMap.get(s);d===void 0&&(d={measurements:{count:0,duration:-1},dataSums:{},dataMaxes:{}},this.measurementsMap.set(s,d));const l=d.measurements;return l.count++,l.duration=c,this.includeAggregateMetrics&&(l.totalDuration=(l.totalDuration??0)+c,l.minDuration=Math.min(l.minDuration??c,c),l.maxDuration=Math.max(l.maxDuration??0,c)),this.isCustomData(u)&&(d=this.accumulateCustomData(u.customData,d)),l.count>=this.sampleThreshold&&(this.includeAggregateMetrics&&(l.averageDuration=(l.totalDuration??0)/l.count),this.flushBucket(s)),u}isCustomData(r){return typeof r=="object"&&r!==null&&"customData"in r&&typeof r.customData=="object"}accumulateCustomData(r,s){for(const[o,u]of Object.entries(r))(0,n.assert)(typeof o=="string",2527),(0,n.assert)(typeof u=="number",2528),s.dataSums[o]=(s.dataSums[o]??0)+u,s.dataMaxes[o]=Math.max(s.dataMaxes[o]??Number.NEGATIVE_INFINITY,u);return s}processCustomData(r,s){const o={};if(r.dataSums===void 0||r.dataMaxes===void 0)return o;const u=r.dataSums,c=r.dataMaxes;for(const[d,l]of Object.entries(u))o[`avg_${d}`]=(0,a.roundToDecimalPlaces)(l/s,6),o[`max_${d}`]=c[d]??0;return o}flushBucket(r){const s=this.measurementsMap.get(r);if(s===void 0)return;const o=s.measurements,u=this.processCustomData(s,o.count);if(o.count!==0){const c=this.perBucketProperties.get(r),d={...this.eventBase,...c,...o,...u};this.logger.sendPerformanceEvent(d),this.measurementsMap.delete(r)}}dispose(r){for(const[s]of this.measurementsMap.entries())this.flushBucket(s);this._disposed=!0}}return Vv.SampledTelemetryHelper=t,Vv}var rf={},FU;function Ppe(){if(FU)return rf;FU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(rf,"__esModule",{value:!0}),rf.measure=rf.createSampledLogger=void 0;const e=ux();function n(t,i,r){const o=(0,e.loggerToMonitoringContext)(t).config.getBoolean("Fluid.Telemetry.DisableSampling")??!1;return{send:c=>{if(o||i===void 0||i.sample()){if(o&&(r??!1))return;t.send(c)}},sendTelemetryEvent:c=>{if(o||i===void 0||i.sample()){if(o&&(r??!1))return;t.sendTelemetryEvent(c)}},sendErrorEvent:c=>{if(o||i===void 0||i.sample()){if(o&&(r??!1))return;t.sendErrorEvent(c)}},sendPerformanceEvent:c=>{if(o||i===void 0||i.sample()){if(o&&(r??!1))return;t.sendPerformanceEvent(c)}},isSamplingDisabled:o}}rf.createSampledLogger=n;function a(t){const i=performance.now(),r=t();return{duration:performance.now()-i,output:r}}return rf.measure=a,rf}var Kv={},jU;function Epe(){if(jU)return Kv;jU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Kv,"__esModule",{value:!0}),Kv.TelemetryEventBatcher=void 0;const e=Tie();class n{constructor(t,i,r){this.eventBase=t,this.logger=i,this.threshold=r,this.dataSums={},this.dataMaxes={},this.counter=0}accumulateAndLog(t){for(const i of Object.keys(t))this.dataSums[i]=(this.dataSums[i]??0)+t[i],this.dataMaxes[i]=Math.max(this.dataMaxes[i]??Number.NEGATIVE_INFINITY,t[i]);this.counter++,this.counter>=this.threshold&&this.sendData()}sendData(){const t={...this.eventBase};for(const i of Object.keys(this.dataSums)){const r=this.dataSums[i];r!==void 0&&(t[`avg_${i}`]=(0,e.roundToDecimalPlaces)(r/this.counter,6)),this.dataMaxes[i]!==void 0&&(t[`max_${i}`]=this.dataMaxes[i])}this.logger.sendPerformanceEvent(t),this.counter=0,this.dataSums={},this.dataMaxes={}}}return Kv.TelemetryEventBatcher=n,Kv}var MU;function Ot(){return MU||(MU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TelemetryEventBatcher=e.measure=e.createSampledLogger=e.SampledTelemetryHelper=e.ThresholdCounter=e.MockLogger=e.createMockLoggerExt=e.TelemetryDataTag=e.tagCodeArtifacts=e.tagData=e.TaggedLoggerAdapter=e.PerformanceEvent=e.numberFromString=e.formatTick=e.createMultiSinkLogger=e.createChildLogger=e.eventNamespaceSeparator=e.isFluidError=e.hasErrorInstanceId=e.safeRaiseEvent=e.raiseConnectedEvent=e.disconnectedEventName=e.connectedEventName=e.EventEmitterWithErrorHandling=e.wrapErrorAndLog=e.wrapError=e.overwriteStack=e.normalizeError=e.NORMALIZED_ERROR_TYPE=e.LoggingError=e.isTaggedTelemetryPropertyValue=e.isILoggingError=e.isExternalError=e.getCircularReplacer=e.generateStack=e.generateErrorWithStack=e.extractLogSafeErrorProperties=e.validatePrecondition=e.UsageError=e.GenericError=e.extractSafePropertiesFromMessage=e.DataProcessingError=e.DataCorruptionError=e.createConfigBasedOptionsProxy=e.wrapConfigProviderWithDefaults=e.loggerToMonitoringContext=e.mixinMonitoringContext=e.sessionStorageConfigProvider=e.createChildMonitoringContext=void 0;var n=ux();Object.defineProperty(e,"createChildMonitoringContext",{enumerable:!0,get:function(){return n.createChildMonitoringContext}}),Object.defineProperty(e,"sessionStorageConfigProvider",{enumerable:!0,get:function(){return n.sessionStorageConfigProvider}}),Object.defineProperty(e,"mixinMonitoringContext",{enumerable:!0,get:function(){return n.mixinMonitoringContext}}),Object.defineProperty(e,"loggerToMonitoringContext",{enumerable:!0,get:function(){return n.loggerToMonitoringContext}}),Object.defineProperty(e,"wrapConfigProviderWithDefaults",{enumerable:!0,get:function(){return n.wrapConfigProviderWithDefaults}}),Object.defineProperty(e,"createConfigBasedOptionsProxy",{enumerable:!0,get:function(){return n.createConfigBasedOptionsProxy}});var a=Spe();Object.defineProperty(e,"DataCorruptionError",{enumerable:!0,get:function(){return a.DataCorruptionError}}),Object.defineProperty(e,"DataProcessingError",{enumerable:!0,get:function(){return a.DataProcessingError}}),Object.defineProperty(e,"extractSafePropertiesFromMessage",{enumerable:!0,get:function(){return a.extractSafePropertiesFromMessage}}),Object.defineProperty(e,"GenericError",{enumerable:!0,get:function(){return a.GenericError}}),Object.defineProperty(e,"UsageError",{enumerable:!0,get:function(){return a.UsageError}}),Object.defineProperty(e,"validatePrecondition",{enumerable:!0,get:function(){return a.validatePrecondition}});var t=cx();Object.defineProperty(e,"extractLogSafeErrorProperties",{enumerable:!0,get:function(){return t.extractLogSafeErrorProperties}}),Object.defineProperty(e,"generateErrorWithStack",{enumerable:!0,get:function(){return t.generateErrorWithStack}}),Object.defineProperty(e,"generateStack",{enumerable:!0,get:function(){return t.generateStack}}),Object.defineProperty(e,"getCircularReplacer",{enumerable:!0,get:function(){return t.getCircularReplacer}}),Object.defineProperty(e,"isExternalError",{enumerable:!0,get:function(){return t.isExternalError}}),Object.defineProperty(e,"isILoggingError",{enumerable:!0,get:function(){return t.isILoggingError}}),Object.defineProperty(e,"isTaggedTelemetryPropertyValue",{enumerable:!0,get:function(){return t.isTaggedTelemetryPropertyValue}}),Object.defineProperty(e,"LoggingError",{enumerable:!0,get:function(){return t.LoggingError}}),Object.defineProperty(e,"NORMALIZED_ERROR_TYPE",{enumerable:!0,get:function(){return t.NORMALIZED_ERROR_TYPE}}),Object.defineProperty(e,"normalizeError",{enumerable:!0,get:function(){return t.normalizeError}}),Object.defineProperty(e,"overwriteStack",{enumerable:!0,get:function(){return t.overwriteStack}}),Object.defineProperty(e,"wrapError",{enumerable:!0,get:function(){return t.wrapError}}),Object.defineProperty(e,"wrapErrorAndLog",{enumerable:!0,get:function(){return t.wrapErrorAndLog}});var i=Cpe();Object.defineProperty(e,"EventEmitterWithErrorHandling",{enumerable:!0,get:function(){return i.EventEmitterWithErrorHandling}});var r=_pe();Object.defineProperty(e,"connectedEventName",{enumerable:!0,get:function(){return r.connectedEventName}}),Object.defineProperty(e,"disconnectedEventName",{enumerable:!0,get:function(){return r.disconnectedEventName}}),Object.defineProperty(e,"raiseConnectedEvent",{enumerable:!0,get:function(){return r.raiseConnectedEvent}}),Object.defineProperty(e,"safeRaiseEvent",{enumerable:!0,get:function(){return r.safeRaiseEvent}});var s=_ie();Object.defineProperty(e,"hasErrorInstanceId",{enumerable:!0,get:function(){return s.hasErrorInstanceId}}),Object.defineProperty(e,"isFluidError",{enumerable:!0,get:function(){return s.isFluidError}});var o=gE();Object.defineProperty(e,"eventNamespaceSeparator",{enumerable:!0,get:function(){return o.eventNamespaceSeparator}}),Object.defineProperty(e,"createChildLogger",{enumerable:!0,get:function(){return o.createChildLogger}}),Object.defineProperty(e,"createMultiSinkLogger",{enumerable:!0,get:function(){return o.createMultiSinkLogger}}),Object.defineProperty(e,"formatTick",{enumerable:!0,get:function(){return o.formatTick}}),Object.defineProperty(e,"numberFromString",{enumerable:!0,get:function(){return o.numberFromString}}),Object.defineProperty(e,"PerformanceEvent",{enumerable:!0,get:function(){return o.PerformanceEvent}}),Object.defineProperty(e,"TaggedLoggerAdapter",{enumerable:!0,get:function(){return o.TaggedLoggerAdapter}}),Object.defineProperty(e,"tagData",{enumerable:!0,get:function(){return o.tagData}}),Object.defineProperty(e,"tagCodeArtifacts",{enumerable:!0,get:function(){return o.tagCodeArtifacts}}),Object.defineProperty(e,"TelemetryDataTag",{enumerable:!0,get:function(){return o.TelemetryDataTag}});var u=Tpe();Object.defineProperty(e,"createMockLoggerExt",{enumerable:!0,get:function(){return u.createMockLoggerExt}}),Object.defineProperty(e,"MockLogger",{enumerable:!0,get:function(){return u.MockLogger}});var c=wpe();Object.defineProperty(e,"ThresholdCounter",{enumerable:!0,get:function(){return c.ThresholdCounter}});var d=Ope();Object.defineProperty(e,"SampledTelemetryHelper",{enumerable:!0,get:function(){return d.SampledTelemetryHelper}});var l=Ppe();Object.defineProperty(e,"createSampledLogger",{enumerable:!0,get:function(){return l.createSampledLogger}}),Object.defineProperty(e,"measure",{enumerable:!0,get:function(){return l.measure}});var f=Epe();Object.defineProperty(e,"TelemetryEventBatcher",{enumerable:!0,get:function(){return f.TelemetryEventBatcher}})})(UF)),UF}var NU;function dx(){if(NU)return Bv;NU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Bv,"__esModule",{value:!0}),Bv.DocumentStorageServiceProxy=void 0;const e=Ot();class n{set policies(t){this._policies=t}get policies(){return this._policies??this.internalStorageService.policies}constructor(t){this.internalStorageService=t}async getSnapshotTree(t,i){return this.internalStorageService.getSnapshotTree(t,i)}async getSnapshot(t){if(this.internalStorageService.getSnapshot!==void 0)return this.internalStorageService.getSnapshot(t);throw new e.UsageError("getSnapshot api should exist on internal storage in documentStorageServiceProxy class")}async getVersions(t,i,r,s){return this.internalStorageService.getVersions(t,i,r,s)}async uploadSummaryWithContext(t,i){return this.internalStorageService.uploadSummaryWithContext(t,i)}async downloadSummary(t){return this.internalStorageService.downloadSummary(t)}async createBlob(t){return this.internalStorageService.createBlob(t)}async readBlob(t){return this.internalStorageService.readBlob(t)}}return Bv.DocumentStorageServiceProxy=n,Bv}var $v={},AU;function Ipe(){if(AU)return $v;AU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty($v,"__esModule",{value:!0}),$v.UsageError=void 0;const e=on(),n=Ot();class a extends n.LoggingError{constructor(i){super(i,{usageError:!0}),this.errorType=e.DriverErrorTypes.usageError,this.canRetry=!1}}return $v.UsageError=a,$v}var sf={};/*! Axios v1.12.2 Copyright (c) 2025 Matt Zabriskie and contributors */var WF,DU;function Rpe(){if(DU)return WF;DU=1;function e(be,Ee){return function(){return be.apply(Ee,arguments)}}const{toString:n}=Object.prototype,{getPrototypeOf:a}=Object,{iterator:t,toStringTag:i}=Symbol,r=(be=>Ee=>{const Le=n.call(Ee);return be[Le]||(be[Le]=Le.slice(8,-1).toLowerCase())})(Object.create(null)),s=be=>(be=be.toLowerCase(),Ee=>r(Ee)===be),o=be=>Ee=>typeof Ee===be,{isArray:u}=Array,c=o("undefined");function d(be){return be!==null&&!c(be)&&be.constructor!==null&&!c(be.constructor)&&C(be.constructor.isBuffer)&&be.constructor.isBuffer(be)}const l=s("ArrayBuffer");function f(be){let Ee;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?Ee=ArrayBuffer.isView(be):Ee=be&&be.buffer&&l(be.buffer),Ee}const b=o("string"),C=o("function"),v=o("number"),m=be=>be!==null&&typeof be=="object",h=be=>be===!0||be===!1,g=be=>{if(r(be)!=="object")return!1;const Ee=a(be);return(Ee===null||Ee===Object.prototype||Object.getPrototypeOf(Ee)===null)&&!(i in be)&&!(t in be)},_=be=>{if(!m(be)||d(be))return!1;try{return Object.keys(be).length===0&&Object.getPrototypeOf(be)===Object.prototype}catch{return!1}},S=s("Date"),p=s("File"),w=s("Blob"),O=s("FileList"),E=be=>m(be)&&C(be.pipe),F=be=>{let Ee;return be&&(typeof FormData=="function"&&be instanceof FormData||C(be.append)&&((Ee=r(be))==="formdata"||Ee==="object"&&C(be.toString)&&be.toString()==="[object FormData]"))},R=s("URLSearchParams"),[M,j,k,x]=["ReadableStream","Request","Response","Headers"].map(s),L=be=>be.trim?be.trim():be.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function V(be,Ee,{allOwnKeys:Le=!1}={}){if(be===null||typeof be>"u")return;let $e,Xe;if(typeof be!="object"&&(be=[be]),u(be))for($e=0,Xe=be.length;$e<Xe;$e++)Ee.call(null,be[$e],$e,be);else{if(d(be))return;const gt=Le?Object.getOwnPropertyNames(be):Object.keys(be),ft=gt.length;let kt;for($e=0;$e<ft;$e++)kt=gt[$e],Ee.call(null,be[kt],kt,be)}}function G(be,Ee){if(d(be))return null;Ee=Ee.toLowerCase();const Le=Object.keys(be);let $e=Le.length,Xe;for(;$e-- >0;)if(Xe=Le[$e],Ee===Xe.toLowerCase())return Xe;return null}const ee=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ud,se=be=>!c(be)&&be!==ee;function re(){const{caseless:be,skipUndefined:Ee}=se(this)&&this||{},Le={},$e=(Xe,gt)=>{const ft=be&&G(Le,gt)||gt;g(Le[ft])&&g(Xe)?Le[ft]=re(Le[ft],Xe):g(Xe)?Le[ft]=re({},Xe):u(Xe)?Le[ft]=Xe.slice():(!Ee||!c(Xe))&&(Le[ft]=Xe)};for(let Xe=0,gt=arguments.length;Xe<gt;Xe++)arguments[Xe]&&V(arguments[Xe],$e);return Le}const fe=(be,Ee,Le,{allOwnKeys:$e}={})=>(V(Ee,(Xe,gt)=>{Le&&C(Xe)?be[gt]=e(Xe,Le):be[gt]=Xe},{allOwnKeys:$e}),be),oe=be=>(be.charCodeAt(0)===65279&&(be=be.slice(1)),be),pe=(be,Ee,Le,$e)=>{be.prototype=Object.create(Ee.prototype,$e),be.prototype.constructor=be,Object.defineProperty(be,"super",{value:Ee.prototype}),Le&&Object.assign(be.prototype,Le)},de=(be,Ee,Le,$e)=>{let Xe,gt,ft;const kt={};if(Ee=Ee||{},be==null)return Ee;do{for(Xe=Object.getOwnPropertyNames(be),gt=Xe.length;gt-- >0;)ft=Xe[gt],(!$e||$e(ft,be,Ee))&&!kt[ft]&&(Ee[ft]=be[ft],kt[ft]=!0);be=Le!==!1&&a(be)}while(be&&(!Le||Le(be,Ee))&&be!==Object.prototype);return Ee},ge=(be,Ee,Le)=>{be=String(be),(Le===void 0||Le>be.length)&&(Le=be.length),Le-=Ee.length;const $e=be.indexOf(Ee,Le);return $e!==-1&&$e===Le},Ce=be=>{if(!be)return null;if(u(be))return be;let Ee=be.length;if(!v(Ee))return null;const Le=new Array(Ee);for(;Ee-- >0;)Le[Ee]=be[Ee];return Le},Fe=(be=>Ee=>be&&Ee instanceof be)(typeof Uint8Array<"u"&&a(Uint8Array)),We=(be,Ee)=>{const $e=(be&&be[t]).call(be);let Xe;for(;(Xe=$e.next())&&!Xe.done;){const gt=Xe.value;Ee.call(be,gt[0],gt[1])}},Ze=(be,Ee)=>{let Le;const $e=[];for(;(Le=be.exec(Ee))!==null;)$e.push(Le);return $e},lt=s("HTMLFormElement"),ut=be=>be.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(Le,$e,Xe){return $e.toUpperCase()+Xe}),pt=(({hasOwnProperty:be})=>(Ee,Le)=>be.call(Ee,Le))(Object.prototype),Nt=s("RegExp"),Ke=(be,Ee)=>{const Le=Object.getOwnPropertyDescriptors(be),$e={};V(Le,(Xe,gt)=>{let ft;(ft=Ee(Xe,gt,be))!==!1&&($e[gt]=ft||Xe)}),Object.defineProperties(be,$e)},Ge=be=>{Ke(be,(Ee,Le)=>{if(C(be)&&["arguments","caller","callee"].indexOf(Le)!==-1)return!1;const $e=be[Le];if(C($e)){if(Ee.enumerable=!1,"writable"in Ee){Ee.writable=!1;return}Ee.set||(Ee.set=()=>{throw Error("Can not rewrite read-only method '"+Le+"'")})}})},Re=(be,Ee)=>{const Le={},$e=Xe=>{Xe.forEach(gt=>{Le[gt]=!0})};return u(be)?$e(be):$e(String(be).split(Ee)),Le},Qe=()=>{},Y=(be,Ee)=>be!=null&&Number.isFinite(be=+be)?be:Ee;function Me(be){return!!(be&&C(be.append)&&be[i]==="FormData"&&be[t])}const K=be=>{const Ee=new Array(10),Le=($e,Xe)=>{if(m($e)){if(Ee.indexOf($e)>=0)return;if(d($e))return $e;if(!("toJSON"in $e)){Ee[Xe]=$e;const gt=u($e)?[]:{};return V($e,(ft,kt)=>{const Wt=Le(ft,Xe+1);!c(Wt)&&(gt[kt]=Wt)}),Ee[Xe]=void 0,gt}}return $e};return Le(be,0)},Z=s("AsyncFunction"),me=be=>be&&(m(be)||C(be))&&C(be.then)&&C(be.catch),we=((be,Ee)=>be?setImmediate:Ee?((Le,$e)=>(ee.addEventListener("message",({source:Xe,data:gt})=>{Xe===ee&&gt===Le&&$e.length&&$e.shift()()},!1),Xe=>{$e.push(Xe),ee.postMessage(Le,"*")}))(`axios@${Math.random()}`,[]):Le=>setTimeout(Le))(typeof setImmediate=="function",C(ee.postMessage)),qe=typeof queueMicrotask<"u"?queueMicrotask.bind(ee):typeof process<"u"&&process.nextTick||we;var Oe={isArray:u,isArrayBuffer:l,isBuffer:d,isFormData:F,isArrayBufferView:f,isString:b,isNumber:v,isBoolean:h,isObject:m,isPlainObject:g,isEmptyObject:_,isReadableStream:M,isRequest:j,isResponse:k,isHeaders:x,isUndefined:c,isDate:S,isFile:p,isBlob:w,isRegExp:Nt,isFunction:C,isStream:E,isURLSearchParams:R,isTypedArray:Fe,isFileList:O,forEach:V,merge:re,extend:fe,trim:L,stripBOM:oe,inherits:pe,toFlatObject:de,kindOf:r,kindOfTest:s,endsWith:ge,toArray:Ce,forEachEntry:We,matchAll:Ze,isHTMLForm:lt,hasOwnProperty:pt,hasOwnProp:pt,reduceDescriptors:Ke,freezeMethods:Ge,toObjectSet:Re,toCamelCase:ut,noop:Qe,toFiniteNumber:Y,findKey:G,global:ee,isContextDefined:se,isSpecCompliantForm:Me,toJSONObject:K,isAsyncFn:Z,isThenable:me,setImmediate:we,asap:qe,isIterable:be=>be!=null&&C(be[t])};function He(be,Ee,Le,$e,Xe){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=be,this.name="AxiosError",Ee&&(this.code=Ee),Le&&(this.config=Le),$e&&(this.request=$e),Xe&&(this.response=Xe,this.status=Xe.status?Xe.status:null)}Oe.inherits(He,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Oe.toJSONObject(this.config),code:this.code,status:this.status}}});const Se=He.prototype,Ve={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(be=>{Ve[be]={value:be}}),Object.defineProperties(He,Ve),Object.defineProperty(Se,"isAxiosError",{value:!0}),He.from=(be,Ee,Le,$e,Xe,gt)=>{const ft=Object.create(Se);Oe.toFlatObject(be,ft,function(B){return B!==Error.prototype},dt=>dt!=="isAxiosError");const kt=be&&be.message?be.message:"Error",Wt=Ee==null&&be?be.code:Ee;return He.call(ft,kt,Wt,Le,$e,Xe),be&&ft.cause==null&&Object.defineProperty(ft,"cause",{value:be,configurable:!0}),ft.name=be&&be.name||"Error",gt&&Object.assign(ft,gt),ft};var ot=null;function mt(be){return Oe.isPlainObject(be)||Oe.isArray(be)}function he(be){return Oe.endsWith(be,"[]")?be.slice(0,-2):be}function Ue(be,Ee,Le){return be?be.concat(Ee).map(function(Xe,gt){return Xe=he(Xe),!Le&&gt?"["+Xe+"]":Xe}).join(Le?".":""):Ee}function Pe(be){return Oe.isArray(be)&&!be.some(mt)}const Ye=Oe.toFlatObject(Oe,{},null,function(Ee){return/^is[A-Z]/.test(Ee)});function ke(be,Ee,Le){if(!Oe.isObject(be))throw new TypeError("target must be an object");Ee=Ee||new FormData,Le=Oe.toFlatObject(Le,{metaTokens:!0,dots:!1,indexes:!1},!1,function(sn,Qt){return!Oe.isUndefined(Qt[sn])});const $e=Le.metaTokens,Xe=Le.visitor||B,gt=Le.dots,ft=Le.indexes,Wt=(Le.Blob||typeof Blob<"u"&&Blob)&&Oe.isSpecCompliantForm(Ee);if(!Oe.isFunction(Xe))throw new TypeError("visitor must be a function");function dt(Lt){if(Lt===null)return"";if(Oe.isDate(Lt))return Lt.toISOString();if(Oe.isBoolean(Lt))return Lt.toString();if(!Wt&&Oe.isBlob(Lt))throw new He("Blob is not supported. Use a Buffer instead.");return Oe.isArrayBuffer(Lt)||Oe.isTypedArray(Lt)?Wt&&typeof Blob=="function"?new Blob([Lt]):Buffer.from(Lt):Lt}function B(Lt,sn,Qt){let zr=Lt;if(Lt&&!Qt&&typeof Lt=="object"){if(Oe.endsWith(sn,"{}"))sn=$e?sn:sn.slice(0,-2),Lt=JSON.stringify(Lt);else if(Oe.isArray(Lt)&&Pe(Lt)||(Oe.isFileList(Lt)||Oe.endsWith(sn,"[]"))&&(zr=Oe.toArray(Lt)))return sn=he(sn),zr.forEach(function(br,kn){!(Oe.isUndefined(br)||br===null)&&Ee.append(ft===!0?Ue([sn],kn,gt):ft===null?sn:sn+"[]",dt(br))}),!1}return mt(Lt)?!0:(Ee.append(Ue(Qt,sn,gt),dt(Lt)),!1)}const en=[],tr=Object.assign(Ye,{defaultVisitor:B,convertValue:dt,isVisitable:mt});function Ur(Lt,sn){if(!Oe.isUndefined(Lt)){if(en.indexOf(Lt)!==-1)throw Error("Circular reference detected in "+sn.join("."));en.push(Lt),Oe.forEach(Lt,function(zr,ai){(!(Oe.isUndefined(zr)||zr===null)&&Xe.call(Ee,zr,Oe.isString(ai)?ai.trim():ai,sn,tr))===!0&&Ur(zr,sn?sn.concat(ai):[ai])}),en.pop()}}if(!Oe.isObject(be))throw new TypeError("data must be an object");return Ur(be),Ee}function Rt(be){const Ee={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(be).replace(/[!'()~]|%20|%00/g,function($e){return Ee[$e]})}function Ft(be,Ee){this._pairs=[],be&&ke(be,this,Ee)}const xt=Ft.prototype;xt.append=function(Ee,Le){this._pairs.push([Ee,Le])},xt.toString=function(Ee){const Le=Ee?function($e){return Ee.call(this,$e,Rt)}:Rt;return this._pairs.map(function(Xe){return Le(Xe[0])+"="+Le(Xe[1])},"").join("&")};function zt(be){return encodeURIComponent(be).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function fn(be,Ee,Le){if(!Ee)return be;const $e=Le&&Le.encode||zt;Oe.isFunction(Le)&&(Le={serialize:Le});const Xe=Le&&Le.serialize;let gt;if(Xe?gt=Xe(Ee,Le):gt=Oe.isURLSearchParams(Ee)?Ee.toString():new Ft(Ee,Le).toString($e),gt){const ft=be.indexOf("#");ft!==-1&&(be=be.slice(0,ft)),be+=(be.indexOf("?")===-1?"?":"&")+gt}return be}class je{constructor(){this.handlers=[]}use(Ee,Le,$e){return this.handlers.push({fulfilled:Ee,rejected:Le,synchronous:$e?$e.synchronous:!1,runWhen:$e?$e.runWhen:null}),this.handlers.length-1}eject(Ee){this.handlers[Ee]&&(this.handlers[Ee]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(Ee){Oe.forEach(this.handlers,function($e){$e!==null&&Ee($e)})}}var Ne=je,Kt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},mn=typeof URLSearchParams<"u"?URLSearchParams:Ft,er=typeof FormData<"u"?FormData:null,ji=typeof Blob<"u"?Blob:null,Qs={isBrowser:!0,classes:{URLSearchParams:mn,FormData:er,Blob:ji},protocols:["http","https","file","blob","url","data"]};const Qr=typeof window<"u"&&typeof document<"u",Br=typeof navigator=="object"&&navigator||void 0,wr=Qr&&(!Br||["ReactNative","NativeScript","NS"].indexOf(Br.product)<0),qn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",qi=Qr&&window.location.href||"http://localhost";var Ys=Object.freeze({__proto__:null,hasBrowserEnv:Qr,hasStandardBrowserWebWorkerEnv:qn,hasStandardBrowserEnv:wr,navigator:Br,origin:qi}),In={...Ys,...Qs};function Si(be,Ee){return ke(be,new In.classes.URLSearchParams,{visitor:function(Le,$e,Xe,gt){return In.isNode&&Oe.isBuffer(Le)?(this.append($e,Le.toString("base64")),!1):gt.defaultVisitor.apply(this,arguments)},...Ee})}function xa(be){return Oe.matchAll(/\w+|\[(\w*)]/g,be).map(Ee=>Ee[0]==="[]"?"":Ee[1]||Ee[0])}function os(be){const Ee={},Le=Object.keys(be);let $e;const Xe=Le.length;let gt;for($e=0;$e<Xe;$e++)gt=Le[$e],Ee[gt]=be[gt];return Ee}function bs(be){function Ee(Le,$e,Xe,gt){let ft=Le[gt++];if(ft==="__proto__")return!0;const kt=Number.isFinite(+ft),Wt=gt>=Le.length;return ft=!ft&&Oe.isArray(Xe)?Xe.length:ft,Wt?(Oe.hasOwnProp(Xe,ft)?Xe[ft]=[Xe[ft],$e]:Xe[ft]=$e,!kt):((!Xe[ft]||!Oe.isObject(Xe[ft]))&&(Xe[ft]=[]),Ee(Le,$e,Xe[ft],gt)&&Oe.isArray(Xe[ft])&&(Xe[ft]=os(Xe[ft])),!kt)}if(Oe.isFormData(be)&&Oe.isFunction(be.entries)){const Le={};return Oe.forEachEntry(be,($e,Xe)=>{Ee(xa($e),Xe,Le,0)}),Le}return null}function Yr(be,Ee,Le){if(Oe.isString(be))try{return(Ee||JSON.parse)(be),Oe.trim(be)}catch($e){if($e.name!=="SyntaxError")throw $e}return(Le||JSON.stringify)(be)}const ni={transitional:Kt,adapter:["xhr","http","fetch"],transformRequest:[function(Ee,Le){const $e=Le.getContentType()||"",Xe=$e.indexOf("application/json")>-1,gt=Oe.isObject(Ee);if(gt&&Oe.isHTMLForm(Ee)&&(Ee=new FormData(Ee)),Oe.isFormData(Ee))return Xe?JSON.stringify(bs(Ee)):Ee;if(Oe.isArrayBuffer(Ee)||Oe.isBuffer(Ee)||Oe.isStream(Ee)||Oe.isFile(Ee)||Oe.isBlob(Ee)||Oe.isReadableStream(Ee))return Ee;if(Oe.isArrayBufferView(Ee))return Ee.buffer;if(Oe.isURLSearchParams(Ee))return Le.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),Ee.toString();let kt;if(gt){if($e.indexOf("application/x-www-form-urlencoded")>-1)return Si(Ee,this.formSerializer).toString();if((kt=Oe.isFileList(Ee))||$e.indexOf("multipart/form-data")>-1){const Wt=this.env&&this.env.FormData;return ke(kt?{"files[]":Ee}:Ee,Wt&&new Wt,this.formSerializer)}}return gt||Xe?(Le.setContentType("application/json",!1),Yr(Ee)):Ee}],transformResponse:[function(Ee){const Le=this.transitional||ni.transitional,$e=Le&&Le.forcedJSONParsing,Xe=this.responseType==="json";if(Oe.isResponse(Ee)||Oe.isReadableStream(Ee))return Ee;if(Ee&&Oe.isString(Ee)&&($e&&!this.responseType||Xe)){const ft=!(Le&&Le.silentJSONParsing)&&Xe;try{return JSON.parse(Ee,this.parseReviver)}catch(kt){if(ft)throw kt.name==="SyntaxError"?He.from(kt,He.ERR_BAD_RESPONSE,this,null,this.response):kt}}return Ee}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:In.classes.FormData,Blob:In.classes.Blob},validateStatus:function(Ee){return Ee>=200&&Ee<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Oe.forEach(["delete","get","head","post","put","patch"],be=>{ni.headers[be]={}});var cs=ni;const Mi=Oe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var $n=be=>{const Ee={};let Le,$e,Xe;return be&&be.split(`
`).forEach(function(ft){Xe=ft.indexOf(":"),Le=ft.substring(0,Xe).trim().toLowerCase(),$e=ft.substring(Xe+1).trim(),!(!Le||Ee[Le]&&Mi[Le])&&(Le==="set-cookie"?Ee[Le]?Ee[Le].push($e):Ee[Le]=[$e]:Ee[Le]=Ee[Le]?Ee[Le]+", "+$e:$e)}),Ee};const Xs=Symbol("internals");function vs(be){return be&&String(be).trim().toLowerCase()}function Xr(be){return be===!1||be==null?be:Oe.isArray(be)?be.map(Xr):String(be)}function us(be){const Ee=Object.create(null),Le=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let $e;for(;$e=Le.exec(be);)Ee[$e[1]]=$e[2];return Ee}const Ss=be=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(be.trim());function Ci(be,Ee,Le,$e,Xe){if(Oe.isFunction($e))return $e.call(this,Ee,Le);if(Xe&&(Ee=Le),!!Oe.isString(Ee)){if(Oe.isString($e))return Ee.indexOf($e)!==-1;if(Oe.isRegExp($e))return $e.test(Ee)}}function ds(be){return be.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(Ee,Le,$e)=>Le.toUpperCase()+$e)}function Gt(be,Ee){const Le=Oe.toCamelCase(" "+Ee);["get","set","has"].forEach($e=>{Object.defineProperty(be,$e+Le,{value:function(Xe,gt,ft){return this[$e].call(this,Ee,Xe,gt,ft)},configurable:!0})})}class gn{constructor(Ee){Ee&&this.set(Ee)}set(Ee,Le,$e){const Xe=this;function gt(kt,Wt,dt){const B=vs(Wt);if(!B)throw new Error("header name must be a non-empty string");const en=Oe.findKey(Xe,B);(!en||Xe[en]===void 0||dt===!0||dt===void 0&&Xe[en]!==!1)&&(Xe[en||Wt]=Xr(kt))}const ft=(kt,Wt)=>Oe.forEach(kt,(dt,B)=>gt(dt,B,Wt));if(Oe.isPlainObject(Ee)||Ee instanceof this.constructor)ft(Ee,Le);else if(Oe.isString(Ee)&&(Ee=Ee.trim())&&!Ss(Ee))ft($n(Ee),Le);else if(Oe.isObject(Ee)&&Oe.isIterable(Ee)){let kt={},Wt,dt;for(const B of Ee){if(!Oe.isArray(B))throw TypeError("Object iterator must return a key-value pair");kt[dt=B[0]]=(Wt=kt[dt])?Oe.isArray(Wt)?[...Wt,B[1]]:[Wt,B[1]]:B[1]}ft(kt,Le)}else Ee!=null&&gt(Le,Ee,$e);return this}get(Ee,Le){if(Ee=vs(Ee),Ee){const $e=Oe.findKey(this,Ee);if($e){const Xe=this[$e];if(!Le)return Xe;if(Le===!0)return us(Xe);if(Oe.isFunction(Le))return Le.call(this,Xe,$e);if(Oe.isRegExp(Le))return Le.exec(Xe);throw new TypeError("parser must be boolean|regexp|function")}}}has(Ee,Le){if(Ee=vs(Ee),Ee){const $e=Oe.findKey(this,Ee);return!!($e&&this[$e]!==void 0&&(!Le||Ci(this,this[$e],$e,Le)))}return!1}delete(Ee,Le){const $e=this;let Xe=!1;function gt(ft){if(ft=vs(ft),ft){const kt=Oe.findKey($e,ft);kt&&(!Le||Ci($e,$e[kt],kt,Le))&&(delete $e[kt],Xe=!0)}}return Oe.isArray(Ee)?Ee.forEach(gt):gt(Ee),Xe}clear(Ee){const Le=Object.keys(this);let $e=Le.length,Xe=!1;for(;$e--;){const gt=Le[$e];(!Ee||Ci(this,this[gt],gt,Ee,!0))&&(delete this[gt],Xe=!0)}return Xe}normalize(Ee){const Le=this,$e={};return Oe.forEach(this,(Xe,gt)=>{const ft=Oe.findKey($e,gt);if(ft){Le[ft]=Xr(Xe),delete Le[gt];return}const kt=Ee?ds(gt):String(gt).trim();kt!==gt&&delete Le[gt],Le[kt]=Xr(Xe),$e[kt]=!0}),this}concat(...Ee){return this.constructor.concat(this,...Ee)}toJSON(Ee){const Le=Object.create(null);return Oe.forEach(this,($e,Xe)=>{$e!=null&&$e!==!1&&(Le[Xe]=Ee&&Oe.isArray($e)?$e.join(", "):$e)}),Le}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([Ee,Le])=>Ee+": "+Le).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(Ee){return Ee instanceof this?Ee:new this(Ee)}static concat(Ee,...Le){const $e=new this(Ee);return Le.forEach(Xe=>$e.set(Xe)),$e}static accessor(Ee){const $e=(this[Xs]=this[Xs]={accessors:{}}).accessors,Xe=this.prototype;function gt(ft){const kt=vs(ft);$e[kt]||(Gt(Xe,ft),$e[kt]=!0)}return Oe.isArray(Ee)?Ee.forEach(gt):gt(Ee),this}}gn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Oe.reduceDescriptors(gn.prototype,({value:be},Ee)=>{let Le=Ee[0].toUpperCase()+Ee.slice(1);return{get:()=>be,set($e){this[Le]=$e}}}),Oe.freezeMethods(gn);var wn=gn;function Or(be,Ee){const Le=this||cs,$e=Ee||Le,Xe=wn.from($e.headers);let gt=$e.data;return Oe.forEach(be,function(kt){gt=kt.call(Le,gt,Xe.normalize(),Ee?Ee.status:void 0)}),Xe.normalize(),gt}function Zs(be){return!!(be&&be.__CANCEL__)}function $a(be,Ee,Le){He.call(this,be??"canceled",He.ERR_CANCELED,Ee,Le),this.name="CanceledError"}Oe.inherits($a,He,{__CANCEL__:!0});function Ga(be,Ee,Le){const $e=Le.config.validateStatus;!Le.status||!$e||$e(Le.status)?be(Le):Ee(new He("Request failed with status code "+Le.status,[He.ERR_BAD_REQUEST,He.ERR_BAD_RESPONSE][Math.floor(Le.status/100)-4],Le.config,Le.request,Le))}function Tl(be){const Ee=/^([-+\w]{1,25})(:?\/\/|:)/.exec(be);return Ee&&Ee[1]||""}function wl(be,Ee){be=be||10;const Le=new Array(be),$e=new Array(be);let Xe=0,gt=0,ft;return Ee=Ee!==void 0?Ee:1e3,function(Wt){const dt=Date.now(),B=$e[gt];ft||(ft=dt),Le[Xe]=Wt,$e[Xe]=dt;let en=gt,tr=0;for(;en!==Xe;)tr+=Le[en++],en=en%be;if(Xe=(Xe+1)%be,Xe===gt&&(gt=(gt+1)%be),dt-ft<Ee)return;const Ur=B&&dt-B;return Ur?Math.round(tr*1e3/Ur):void 0}}function _b(be,Ee){let Le=0,$e=1e3/Ee,Xe,gt;const ft=(dt,B=Date.now())=>{Le=B,Xe=null,gt&&(clearTimeout(gt),gt=null),be(...dt)};return[(...dt)=>{const B=Date.now(),en=B-Le;en>=$e?ft(dt,B):(Xe=dt,gt||(gt=setTimeout(()=>{gt=null,ft(Xe)},$e-en)))},()=>Xe&&ft(Xe)]}const Mc=(be,Ee,Le=3)=>{let $e=0;const Xe=wl(50,250);return _b(gt=>{const ft=gt.loaded,kt=gt.lengthComputable?gt.total:void 0,Wt=ft-$e,dt=Xe(Wt),B=ft<=kt;$e=ft;const en={loaded:ft,total:kt,progress:kt?ft/kt:void 0,bytes:Wt,rate:dt||void 0,estimated:dt&&kt&&B?(kt-ft)/dt:void 0,event:gt,lengthComputable:kt!=null,[Ee?"download":"upload"]:!0};be(en)},Le)},Li=(be,Ee)=>{const Le=be!=null;return[$e=>Ee[0]({lengthComputable:Le,total:be,loaded:$e}),Ee[1]]},ri=be=>(...Ee)=>Oe.asap(()=>be(...Ee));var Tb=In.hasStandardBrowserEnv?((be,Ee)=>Le=>(Le=new URL(Le,In.origin),be.protocol===Le.protocol&&be.host===Le.host&&(Ee||be.port===Le.port)))(new URL(In.origin),In.navigator&&/(msie|trident)/i.test(In.navigator.userAgent)):()=>!0,bd=In.hasStandardBrowserEnv?{write(be,Ee,Le,$e,Xe,gt){const ft=[be+"="+encodeURIComponent(Ee)];Oe.isNumber(Le)&&ft.push("expires="+new Date(Le).toGMTString()),Oe.isString($e)&&ft.push("path="+$e),Oe.isString(Xe)&&ft.push("domain="+Xe),gt===!0&&ft.push("secure"),document.cookie=ft.join("; ")},read(be){const Ee=document.cookie.match(new RegExp("(^|;\\s*)("+be+")=([^;]*)"));return Ee?decodeURIComponent(Ee[3]):null},remove(be){this.write(be,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ay(be){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(be)}function Jo(be,Ee){return Ee?be.replace(/\/?\/$/,"")+"/"+Ee.replace(/^\/+/,""):be}function oy(be,Ee,Le){let $e=!ay(Ee);return be&&($e||Le==!1)?Jo(be,Ee):Ee}const Bi=be=>be instanceof wn?{...be}:be;function ea(be,Ee){Ee=Ee||{};const Le={};function $e(dt,B,en,tr){return Oe.isPlainObject(dt)&&Oe.isPlainObject(B)?Oe.merge.call({caseless:tr},dt,B):Oe.isPlainObject(B)?Oe.merge({},B):Oe.isArray(B)?B.slice():B}function Xe(dt,B,en,tr){if(Oe.isUndefined(B)){if(!Oe.isUndefined(dt))return $e(void 0,dt,en,tr)}else return $e(dt,B,en,tr)}function gt(dt,B){if(!Oe.isUndefined(B))return $e(void 0,B)}function ft(dt,B){if(Oe.isUndefined(B)){if(!Oe.isUndefined(dt))return $e(void 0,dt)}else return $e(void 0,B)}function kt(dt,B,en){if(en in Ee)return $e(dt,B);if(en in be)return $e(void 0,dt)}const Wt={url:gt,method:gt,data:gt,baseURL:ft,transformRequest:ft,transformResponse:ft,paramsSerializer:ft,timeout:ft,timeoutMessage:ft,withCredentials:ft,withXSRFToken:ft,adapter:ft,responseType:ft,xsrfCookieName:ft,xsrfHeaderName:ft,onUploadProgress:ft,onDownloadProgress:ft,decompress:ft,maxContentLength:ft,maxBodyLength:ft,beforeRedirect:ft,transport:ft,httpAgent:ft,httpsAgent:ft,cancelToken:ft,socketPath:ft,responseEncoding:ft,validateStatus:kt,headers:(dt,B,en)=>Xe(Bi(dt),Bi(B),en,!0)};return Oe.forEach(Object.keys({...be,...Ee}),function(B){const en=Wt[B]||Xe,tr=en(be[B],Ee[B],B);Oe.isUndefined(tr)&&en!==kt||(Le[B]=tr)}),Le}var Nc=be=>{const Ee=ea({},be);let{data:Le,withXSRFToken:$e,xsrfHeaderName:Xe,xsrfCookieName:gt,headers:ft,auth:kt}=Ee;if(Ee.headers=ft=wn.from(ft),Ee.url=fn(oy(Ee.baseURL,Ee.url,Ee.allowAbsoluteUrls),be.params,be.paramsSerializer),kt&&ft.set("Authorization","Basic "+btoa((kt.username||"")+":"+(kt.password?unescape(encodeURIComponent(kt.password)):""))),Oe.isFormData(Le)){if(In.hasStandardBrowserEnv||In.hasStandardBrowserWebWorkerEnv)ft.setContentType(void 0);else if(Oe.isFunction(Le.getHeaders)){const Wt=Le.getHeaders(),dt=["content-type","content-length"];Object.entries(Wt).forEach(([B,en])=>{dt.includes(B.toLowerCase())&&ft.set(B,en)})}}if(In.hasStandardBrowserEnv&&($e&&Oe.isFunction($e)&&($e=$e(Ee)),$e||$e!==!1&&Tb(Ee.url))){const Wt=Xe&&gt&&bd.read(gt);Wt&&ft.set(Xe,Wt)}return Ee},Zr=typeof XMLHttpRequest<"u"&&function(be){return new Promise(function(Le,$e){const Xe=Nc(be);let gt=Xe.data;const ft=wn.from(Xe.headers).normalize();let{responseType:kt,onUploadProgress:Wt,onDownloadProgress:dt}=Xe,B,en,tr,Ur,Lt;function sn(){Ur&&Ur(),Lt&&Lt(),Xe.cancelToken&&Xe.cancelToken.unsubscribe(B),Xe.signal&&Xe.signal.removeEventListener("abort",B)}let Qt=new XMLHttpRequest;Qt.open(Xe.method.toUpperCase(),Xe.url,!0),Qt.timeout=Xe.timeout;function zr(){if(!Qt)return;const br=wn.from("getAllResponseHeaders"in Qt&&Qt.getAllResponseHeaders()),On={data:!kt||kt==="text"||kt==="json"?Qt.responseText:Qt.response,status:Qt.status,statusText:Qt.statusText,headers:br,config:be,request:Qt};Ga(function(Pr){Le(Pr),sn()},function(Pr){$e(Pr),sn()},On),Qt=null}"onloadend"in Qt?Qt.onloadend=zr:Qt.onreadystatechange=function(){!Qt||Qt.readyState!==4||Qt.status===0&&!(Qt.responseURL&&Qt.responseURL.indexOf("file:")===0)||setTimeout(zr)},Qt.onabort=function(){Qt&&($e(new He("Request aborted",He.ECONNABORTED,be,Qt)),Qt=null)},Qt.onerror=function(kn){const On=kn&&kn.message?kn.message:"Network Error",_s=new He(On,He.ERR_NETWORK,be,Qt);_s.event=kn||null,$e(_s),Qt=null},Qt.ontimeout=function(){let kn=Xe.timeout?"timeout of "+Xe.timeout+"ms exceeded":"timeout exceeded";const On=Xe.transitional||Kt;Xe.timeoutErrorMessage&&(kn=Xe.timeoutErrorMessage),$e(new He(kn,On.clarifyTimeoutError?He.ETIMEDOUT:He.ECONNABORTED,be,Qt)),Qt=null},gt===void 0&&ft.setContentType(null),"setRequestHeader"in Qt&&Oe.forEach(ft.toJSON(),function(kn,On){Qt.setRequestHeader(On,kn)}),Oe.isUndefined(Xe.withCredentials)||(Qt.withCredentials=!!Xe.withCredentials),kt&&kt!=="json"&&(Qt.responseType=Xe.responseType),dt&&([tr,Lt]=Mc(dt,!0),Qt.addEventListener("progress",tr)),Wt&&Qt.upload&&([en,Ur]=Mc(Wt),Qt.upload.addEventListener("progress",en),Qt.upload.addEventListener("loadend",Ur)),(Xe.cancelToken||Xe.signal)&&(B=br=>{Qt&&($e(!br||br.type?new $a(null,be,Qt):br),Qt.abort(),Qt=null)},Xe.cancelToken&&Xe.cancelToken.subscribe(B),Xe.signal&&(Xe.signal.aborted?B():Xe.signal.addEventListener("abort",B)));const ai=Tl(Xe.url);if(ai&&In.protocols.indexOf(ai)===-1){$e(new He("Unsupported protocol "+ai+":",He.ERR_BAD_REQUEST,be));return}Qt.send(gt||null)})},cy=(be,Ee)=>{const{length:Le}=be=be?be.filter(Boolean):[];if(Ee||Le){let $e=new AbortController,Xe;const gt=function(dt){if(!Xe){Xe=!0,kt();const B=dt instanceof Error?dt:this.reason;$e.abort(B instanceof He?B:new $a(B instanceof Error?B.message:B))}};let ft=Ee&&setTimeout(()=>{ft=null,gt(new He(`timeout ${Ee} of ms exceeded`,He.ETIMEDOUT))},Ee);const kt=()=>{be&&(ft&&clearTimeout(ft),ft=null,be.forEach(dt=>{dt.unsubscribe?dt.unsubscribe(gt):dt.removeEventListener("abort",gt)}),be=null)};be.forEach(dt=>dt.addEventListener("abort",gt));const{signal:Wt}=$e;return Wt.unsubscribe=()=>Oe.asap(kt),Wt}};const qa=function*(be,Ee){let Le=be.byteLength;if(Le<Ee){yield be;return}let $e=0,Xe;for(;$e<Le;)Xe=$e+Ee,yield be.slice($e,Xe),$e=Xe},Cs=async function*(be,Ee){for await(const Le of Ol(be))yield*qa(Le,Ee)},Ol=async function*(be){if(be[Symbol.asyncIterator]){yield*be;return}const Ee=be.getReader();try{for(;;){const{done:Le,value:$e}=await Ee.read();if(Le)break;yield $e}}finally{await Ee.cancel()}},vd=(be,Ee,Le,$e)=>{const Xe=Cs(be,Ee);let gt=0,ft,kt=Wt=>{ft||(ft=!0,$e&&$e(Wt))};return new ReadableStream({async pull(Wt){try{const{done:dt,value:B}=await Xe.next();if(dt){kt(),Wt.close();return}let en=B.byteLength;if(Le){let tr=gt+=en;Le(tr)}Wt.enqueue(new Uint8Array(B))}catch(dt){throw kt(dt),dt}},cancel(Wt){return kt(Wt),Xe.return()}},{highWaterMark:2})},Dc=64*1024,{isFunction:Sd}=Oe,wb=(({Request:be,Response:Ee})=>({Request:be,Response:Ee}))(Oe.global),{ReadableStream:Us,TextEncoder:ii}=Oe.global,rn=(be,...Ee)=>{try{return!!be(...Ee)}catch{return!1}},Qo=be=>{be=Oe.merge.call({skipUndefined:!0},wb,be);const{fetch:Ee,Request:Le,Response:$e}=be,Xe=Ee?Sd(Ee):typeof fetch=="function",gt=Sd(Le),ft=Sd($e);if(!Xe)return!1;const kt=Xe&&Sd(Us),Wt=Xe&&(typeof ii=="function"?(Lt=>sn=>Lt.encode(sn))(new ii):async Lt=>new Uint8Array(await new Le(Lt).arrayBuffer())),dt=gt&&kt&&rn(()=>{let Lt=!1;const sn=new Le(In.origin,{body:new Us,method:"POST",get duplex(){return Lt=!0,"half"}}).headers.has("Content-Type");return Lt&&!sn}),B=ft&&kt&&rn(()=>Oe.isReadableStream(new $e("").body)),en={stream:B&&(Lt=>Lt.body)};Xe&&["text","arrayBuffer","blob","formData","stream"].forEach(Lt=>{!en[Lt]&&(en[Lt]=(sn,Qt)=>{let zr=sn&&sn[Lt];if(zr)return zr.call(sn);throw new He(`Response type '${Lt}' is not supported`,He.ERR_NOT_SUPPORT,Qt)})});const tr=async Lt=>{if(Lt==null)return 0;if(Oe.isBlob(Lt))return Lt.size;if(Oe.isSpecCompliantForm(Lt))return(await new Le(In.origin,{method:"POST",body:Lt}).arrayBuffer()).byteLength;if(Oe.isArrayBufferView(Lt)||Oe.isArrayBuffer(Lt))return Lt.byteLength;if(Oe.isURLSearchParams(Lt)&&(Lt=Lt+""),Oe.isString(Lt))return(await Wt(Lt)).byteLength},Ur=async(Lt,sn)=>{const Qt=Oe.toFiniteNumber(Lt.getContentLength());return Qt??tr(sn)};return async Lt=>{let{url:sn,method:Qt,data:zr,signal:ai,cancelToken:br,timeout:kn,onDownloadProgress:On,onUploadProgress:_s,responseType:Pr,headers:Rl,withCredentials:_d="same-origin",fetchOptions:zc}=Nc(Lt),Ln=Ee||fetch;Pr=Pr?(Pr+"").toLowerCase():"text";let Td=cy([ai,br&&br.toAbortSignal()],kn),Ja=null;const lr=Td&&Td.unsubscribe&&(()=>{Td.unsubscribe()});let Ts;try{if(_s&&dt&&Qt!=="get"&&Qt!=="head"&&(Ts=await Ur(Rl,zr))!==0){let Yn=new Le(sn,{method:"POST",body:zr,duplex:"half"}),nr;if(Oe.isFormData(zr)&&(nr=Yn.headers.get("content-type"))&&Rl.setContentType(nr),Yn.body){const[jl,Od]=Li(Ts,Mc(ri(_s)));zr=vd(Yn.body,Dc,jl,Od)}}Oe.isString(_d)||(_d=_d?"include":"omit");const zi=gt&&"credentials"in Le.prototype,Fl={...zc,signal:Td,method:Qt.toUpperCase(),headers:Rl.normalize().toJSON(),body:zr,duplex:"half",credentials:zi?_d:void 0};Ja=gt&&new Le(sn,Fl);let ls=await(gt?Ln(Ja,zc):Ln(sn,Fl));const wd=B&&(Pr==="stream"||Pr==="response");if(B&&(On||wd&&lr)){const Yn={};["status","statusText","headers"].forEach(Ml=>{Yn[Ml]=ls[Ml]});const nr=Oe.toFiniteNumber(ls.headers.get("content-length")),[jl,Od]=On&&Li(nr,Mc(ri(On),!0))||[];ls=new $e(vd(ls.body,Dc,jl,()=>{Od&&Od(),lr&&lr()}),Yn)}Pr=Pr||"text";let dy=await en[Oe.findKey(en,Pr)||"text"](ls,Lt);return!wd&&lr&&lr(),await new Promise((Yn,nr)=>{Ga(Yn,nr,{data:dy,headers:wn.from(ls.headers),status:ls.status,statusText:ls.statusText,config:Lt,request:Ja})})}catch(zi){throw lr&&lr(),zi&&zi.name==="TypeError"&&/Load failed|fetch/i.test(zi.message)?Object.assign(new He("Network Error",He.ERR_NETWORK,Lt,Ja),{cause:zi.cause||zi}):He.from(zi,zi&&zi.code,Lt,Ja)}}},Yo=new Map,Pl=be=>{let Ee=be?be.env:{};const{fetch:Le,Request:$e,Response:Xe}=Ee,gt=[$e,Xe,Le];let ft=gt.length,kt=ft,Wt,dt,B=Yo;for(;kt--;)Wt=gt[kt],dt=B.get(Wt),dt===void 0&&B.set(Wt,dt=kt?new Map:Qo(Ee)),B=dt;return dt};Pl();const kc={http:ot,xhr:Zr,fetch:{get:Pl}};Oe.forEach(kc,(be,Ee)=>{if(be){try{Object.defineProperty(be,"name",{value:Ee})}catch{}Object.defineProperty(be,"adapterName",{value:Ee})}});const El=be=>`- ${be}`,xc=be=>Oe.isFunction(be)||be===null||be===!1;var Qn={getAdapter:(be,Ee)=>{be=Oe.isArray(be)?be:[be];const{length:Le}=be;let $e,Xe;const gt={};for(let ft=0;ft<Le;ft++){$e=be[ft];let kt;if(Xe=$e,!xc($e)&&(Xe=kc[(kt=String($e)).toLowerCase()],Xe===void 0))throw new He(`Unknown adapter '${kt}'`);if(Xe&&(Oe.isFunction(Xe)||(Xe=Xe.get(Ee))))break;gt[kt||"#"+ft]=Xe}if(!Xe){const ft=Object.entries(gt).map(([Wt,dt])=>`adapter ${Wt} `+(dt===!1?"is not supported by the environment":"is not available in the build"));let kt=Le?ft.length>1?`since :
`+ft.map(El).join(`
`):" "+El(ft[0]):"as no adapter specified";throw new He("There is no suitable adapter to dispatch the request "+kt,"ERR_NOT_SUPPORT")}return Xe},adapters:kc};function qc(be){if(be.cancelToken&&be.cancelToken.throwIfRequested(),be.signal&&be.signal.aborted)throw new $a(null,be)}function Xo(be){return qc(be),be.headers=wn.from(be.headers),be.data=Or.call(be,be.transformRequest),["post","put","patch"].indexOf(be.method)!==-1&&be.headers.setContentType("application/x-www-form-urlencoded",!1),Qn.getAdapter(be.adapter||cs.adapter,be)(be).then(function($e){return qc(be),$e.data=Or.call(be,be.transformResponse,$e),$e.headers=wn.from($e.headers),$e},function($e){return Zs($e)||(qc(be),$e&&$e.response&&($e.response.data=Or.call(be,be.transformResponse,$e.response),$e.response.headers=wn.from($e.response.headers))),Promise.reject($e)})}const ta="1.12.2",Zo={};["object","boolean","number","function","string","symbol"].forEach((be,Ee)=>{Zo[be]=function($e){return typeof $e===be||"a"+(Ee<1?"n ":" ")+be}});const Lc={};Zo.transitional=function(Ee,Le,$e){function Xe(gt,ft){return"[Axios v"+ta+"] Transitional option '"+gt+"'"+ft+($e?". "+$e:"")}return(gt,ft,kt)=>{if(Ee===!1)throw new He(Xe(ft," has been removed"+(Le?" in "+Le:"")),He.ERR_DEPRECATED);return Le&&!Lc[ft]&&(Lc[ft]=!0,console.warn(Xe(ft," has been deprecated since v"+Le+" and will be removed in the near future"))),Ee?Ee(gt,ft,kt):!0}},Zo.spelling=function(Ee){return(Le,$e)=>(console.warn(`${$e} is likely a misspelling of ${Ee}`),!0)};function uy(be,Ee,Le){if(typeof be!="object")throw new He("options must be an object",He.ERR_BAD_OPTION_VALUE);const $e=Object.keys(be);let Xe=$e.length;for(;Xe-- >0;){const gt=$e[Xe],ft=Ee[gt];if(ft){const kt=be[gt],Wt=kt===void 0||ft(kt,gt,be);if(Wt!==!0)throw new He("option "+gt+" must be "+Wt,He.ERR_BAD_OPTION_VALUE);continue}if(Le!==!0)throw new He("Unknown option "+gt,He.ERR_BAD_OPTION)}}var Wa={assertOptions:uy,validators:Zo};const Ui=Wa.validators;class Sn{constructor(Ee){this.defaults=Ee||{},this.interceptors={request:new Ne,response:new Ne}}async request(Ee,Le){try{return await this._request(Ee,Le)}catch($e){if($e instanceof Error){let Xe={};Error.captureStackTrace?Error.captureStackTrace(Xe):Xe=new Error;const gt=Xe.stack?Xe.stack.replace(/^.+\n/,""):"";try{$e.stack?gt&&!String($e.stack).endsWith(gt.replace(/^.+\n.+\n/,""))&&($e.stack+=`
`+gt):$e.stack=gt}catch{}}throw $e}}_request(Ee,Le){typeof Ee=="string"?(Le=Le||{},Le.url=Ee):Le=Ee||{},Le=ea(this.defaults,Le);const{transitional:$e,paramsSerializer:Xe,headers:gt}=Le;$e!==void 0&&Wa.assertOptions($e,{silentJSONParsing:Ui.transitional(Ui.boolean),forcedJSONParsing:Ui.transitional(Ui.boolean),clarifyTimeoutError:Ui.transitional(Ui.boolean)},!1),Xe!=null&&(Oe.isFunction(Xe)?Le.paramsSerializer={serialize:Xe}:Wa.assertOptions(Xe,{encode:Ui.function,serialize:Ui.function},!0)),Le.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?Le.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:Le.allowAbsoluteUrls=!0),Wa.assertOptions(Le,{baseUrl:Ui.spelling("baseURL"),withXsrfToken:Ui.spelling("withXSRFToken")},!0),Le.method=(Le.method||this.defaults.method||"get").toLowerCase();let ft=gt&&Oe.merge(gt.common,gt[Le.method]);gt&&Oe.forEach(["delete","get","head","post","put","patch","common"],Lt=>{delete gt[Lt]}),Le.headers=wn.concat(ft,gt);const kt=[];let Wt=!0;this.interceptors.request.forEach(function(sn){typeof sn.runWhen=="function"&&sn.runWhen(Le)===!1||(Wt=Wt&&sn.synchronous,kt.unshift(sn.fulfilled,sn.rejected))});const dt=[];this.interceptors.response.forEach(function(sn){dt.push(sn.fulfilled,sn.rejected)});let B,en=0,tr;if(!Wt){const Lt=[Xo.bind(this),void 0];for(Lt.unshift(...kt),Lt.push(...dt),tr=Lt.length,B=Promise.resolve(Le);en<tr;)B=B.then(Lt[en++],Lt[en++]);return B}tr=kt.length;let Ur=Le;for(;en<tr;){const Lt=kt[en++],sn=kt[en++];try{Ur=Lt(Ur)}catch(Qt){sn.call(this,Qt);break}}try{B=Xo.call(this,Ur)}catch(Lt){return Promise.reject(Lt)}for(en=0,tr=dt.length;en<tr;)B=B.then(dt[en++],dt[en++]);return B}getUri(Ee){Ee=ea(this.defaults,Ee);const Le=oy(Ee.baseURL,Ee.url,Ee.allowAbsoluteUrls);return fn(Le,Ee.params,Ee.paramsSerializer)}}Oe.forEach(["delete","get","head","options"],function(Ee){Sn.prototype[Ee]=function(Le,$e){return this.request(ea($e||{},{method:Ee,url:Le,data:($e||{}).data}))}}),Oe.forEach(["post","put","patch"],function(Ee){function Le($e){return function(gt,ft,kt){return this.request(ea(kt||{},{method:Ee,headers:$e?{"Content-Type":"multipart/form-data"}:{},url:gt,data:ft}))}}Sn.prototype[Ee]=Le(),Sn.prototype[Ee+"Form"]=Le(!0)});var si=Sn;class na{constructor(Ee){if(typeof Ee!="function")throw new TypeError("executor must be a function.");let Le;this.promise=new Promise(function(gt){Le=gt});const $e=this;this.promise.then(Xe=>{if(!$e._listeners)return;let gt=$e._listeners.length;for(;gt-- >0;)$e._listeners[gt](Xe);$e._listeners=null}),this.promise.then=Xe=>{let gt;const ft=new Promise(kt=>{$e.subscribe(kt),gt=kt}).then(Xe);return ft.cancel=function(){$e.unsubscribe(gt)},ft},Ee(function(gt,ft,kt){$e.reason||($e.reason=new $a(gt,ft,kt),Le($e.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(Ee){if(this.reason){Ee(this.reason);return}this._listeners?this._listeners.push(Ee):this._listeners=[Ee]}unsubscribe(Ee){if(!this._listeners)return;const Le=this._listeners.indexOf(Ee);Le!==-1&&this._listeners.splice(Le,1)}toAbortSignal(){const Ee=new AbortController,Le=$e=>{Ee.abort($e)};return this.subscribe(Le),Ee.signal.unsubscribe=()=>this.unsubscribe(Le),Ee.signal}static source(){let Ee;return{token:new na(function(Xe){Ee=Xe}),cancel:Ee}}}var Cd=na;function Bc(be){return function(Le){return be.apply(null,Le)}}function Ob(be){return Oe.isObject(be)&&be.isAxiosError===!0}const Uc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Uc).forEach(([be,Ee])=>{Uc[Ee]=be});var Il=Uc;function ec(be){const Ee=new si(be),Le=e(si.prototype.request,Ee);return Oe.extend(Le,si.prototype,Ee,{allOwnKeys:!0}),Oe.extend(Le,Ee,null,{allOwnKeys:!0}),Le.create=function(Xe){return ec(ea(be,Xe))},Le}const yr=ec(cs);return yr.Axios=si,yr.CanceledError=$a,yr.CancelToken=Cd,yr.isCancel=Zs,yr.VERSION=ta,yr.toFormData=ke,yr.AxiosError=He,yr.Cancel=yr.CanceledError,yr.all=function(Ee){return Promise.all(Ee)},yr.spread=Bc,yr.isAxiosError=Ob,yr.mergeConfig=ea,yr.AxiosHeaders=wn,yr.formToJSON=be=>bs(Oe.isHTMLForm(be)?new FormData(be):be),yr.getAdapter=Qn.getAdapter,yr.HttpStatusCode=Il,yr.default=yr,WF=yr,WF}var kU;function Fpe(){if(kU)return sf;kU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=sf&&sf.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(sf,"__esModule",{value:!0}),sf.InsecureUrlResolver=void 0;const n=Je(),a=on(),t=e(Rpe());class i{constructor(s,o,u,c,d,l,f=!1){this.hostUrl=s,this.ordererUrl=o,this.storageUrl=u,this.deltaStreamUrl=c,this.tenantId=d,this.bearer=l,this.isForNodeTest=f,this.cache=new Map}async resolve(s){if(s.headers?.[a.DriverHeader.createNew]){const[,u]=s.url.split("?"),d=new URLSearchParams(u).get("fileName");return this.resolveHelper(d)}const o=new URL(s.url);if(this.isForNodeTest){const[,u,c]=o.pathname.substr(1).split("/"),d=c??"";return this.resolveHelper(u,d,o.search)}else if(o.host===window.location.host){const u=o.pathname.substr(1),c=u.split("/")[0],d=u.slice(c.length);return this.resolveHelper(c,d)}else{const u=this.cache.get(s.url);if(u)return u;const c={Authorization:`Bearer ${this.bearer}`},d=t.default.post(`${this.hostUrl}/apis/load`,{url:s.url},{headers:c});return this.cache.set(s.url,d.then(l=>l.data)),this.cache.get(s.url)}}resolveHelper(s,o="",u=""){const c=encodeURIComponent(this.tenantId),d=new URL(this.ordererUrl).host;if(!s)return{endpoints:{deltaStorageUrl:`${this.ordererUrl}/deltas/${c}/new`,deltaStreamUrl:this.deltaStreamUrl,ordererUrl:this.ordererUrl,storageUrl:`${this.storageUrl}/repos/${c}`},id:"",tokens:{},type:"fluid",url:`https://${d}/${c}/new`};const l=encodeURIComponent(s),f=!o||o.startsWith("/")?o:`/${o}`,b=`https://${d}/${c}/${l}${f}${u}`,C=`${this.ordererUrl}/deltas/${c}/${l}`,v=`${this.storageUrl}/repos/${c}`;return{endpoints:{deltaStorageUrl:C,deltaStreamUrl:this.deltaStreamUrl,ordererUrl:this.ordererUrl,storageUrl:v},id:s,tokens:{},type:"fluid",url:b}}async getAbsoluteUrl(s,o){const u=new URL(s.url),[,,c]=u.pathname?.split("/")??[];(0,n.assert)(!!c,627);let d=o;return d.startsWith("/")&&(d=d.substr(1)),`${this.hostUrl}/${encodeURIComponent(this.tenantId)}/${encodeURIComponent(c)}/${d}`}createCreateNewRequest(s){return{url:s?`${this.hostUrl}?fileName=${s}`:this.hostUrl,headers:{[a.DriverHeader.createNew]:!0}}}}return sf.InsecureUrlResolver=i,sf}var af={},xU;function jpe(){if(xU)return af;xU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(af,"__esModule",{value:!0}),af.canBeCoalescedByService=af.isRuntimeMessage=void 0;const e=on();function n(t){return t.type===e.MessageType.Operation}af.isRuntimeMessage=n;function a(t){return t.type===e.MessageType.NoOp||t.type===e.MessageType.Accept}return af.canBeCoalescedByService=a,af}var Bn={},qU;function cT(){if(qU)return Bn;qU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.getRetryDelayFromError=Bn.getRetryDelaySecondsFromError=Bn.canRetryOnError=Bn.createGenericNetworkError=Bn.createWriteError=Bn.ThrottlingError=Bn.RetryableError=Bn.NonRetryableError=Bn.NetworkErrorBasic=Bn.LocationRedirectionError=Bn.AuthorizationError=Bn.DeltaStreamConnectionForbiddenError=Bn.FluidInvalidSchemaError=Bn.GenericNetworkError=Bn.isOnline=Bn.OnlineStatus=void 0;const e=on(),n=Ot();var a;(function(g){g[g.Offline=0]="Offline",g[g.Online=1]="Online",g[g.Unknown=2]="Unknown"})(a||(Bn.OnlineStatus=a={}));function t(){return typeof navigator=="object"&&navigator!==null&&typeof navigator.onLine=="boolean"?navigator.onLine?a.Online:a.Offline:a.Unknown}Bn.isOnline=t;class i extends n.LoggingError{constructor(_,S,p){super(_,p),this.canRetry=S,this.errorType=e.DriverErrorTypes.genericNetworkError}}Bn.GenericNetworkError=i;class r extends n.LoggingError{constructor(_,S){super(_,S),this.errorType=e.DriverErrorTypes.fluidInvalidSchema,this.canRetry=!1}}Bn.FluidInvalidSchemaError=r;class s extends n.LoggingError{constructor(_,S,p){super(_,{...S,statusCode:400}),this.errorType=s.errorType,this.canRetry=!1,this.storageOnlyReason=p}}Bn.DeltaStreamConnectionForbiddenError=s,s.errorType=e.DriverErrorTypes.deltaStreamConnectionForbidden;class o extends n.LoggingError{constructor(_,S,p,w){S!==void 0&&(w.claims=S),p!==void 0&&(w.tenantId=p),super(_,w,new Set(["claims","tenantId"])),this.errorType=e.DriverErrorTypes.authorizationError,this.canRetry=!1}}Bn.AuthorizationError=o;class u extends n.LoggingError{constructor(_,S,p){super(_,p,new Set(["redirectUrl"])),this.redirectUrl=S,this.errorType=e.DriverErrorTypes.locationRedirection,this.canRetry=!1}}Bn.LocationRedirectionError=u;class c extends n.LoggingError{constructor(_,S,p,w){super(_,w),this.errorType=S,this.canRetry=p}}Bn.NetworkErrorBasic=c;class d extends c{constructor(_,S,p){super(_,S,!1,p),this.errorType=S}}Bn.NonRetryableError=d;class l extends c{constructor(_,S,p){super(_,S,!0,p),this.errorType=S}}Bn.RetryableError=l;class f extends n.LoggingError{constructor(_,S,p){super(_,p),this.retryAfterSeconds=S,this.errorType=e.DriverErrorTypes.throttlingError,this.canRetry=!0}}Bn.ThrottlingError=f;const b=(g,_)=>new d(g,e.DriverErrorTypes.writeError,_);Bn.createWriteError=b;function C(g,_,S){return _.retryAfterMs!==void 0&&_.canRetry?new f(g,_.retryAfterMs/1e3,S):new i(g,_.canRetry,S)}Bn.createGenericNetworkError=C;const v=g=>g?.canRetry===!0;Bn.canRetryOnError=v;const m=g=>g?.retryAfterSeconds;Bn.getRetryDelaySecondsFromError=m;const h=g=>g?.retryAfterSeconds!==void 0?g.retryAfterSeconds*1e3:void 0;return Bn.getRetryDelayFromError=h,Bn}var Gv={},LU;function wie(){if(LU)return Gv;LU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Gv,"__esModule",{value:!0}),Gv.logNetworkFailure=void 0;const e=cT();function n(a,t,i){const r={...t},s=i?.online;if(r.online=typeof s=="string"?s:e.OnlineStatus[(0,e.isOnline)()],typeof navigator=="object"&&navigator!==null){const o=navigator,u=o.connection??o.mozConnection??o.webkitConnection;u!==null&&typeof u=="object"&&(r.connectionType=u.type)}r.category=(0,e.canRetryOnError)(i)?"generic":"error",a.sendTelemetryEvent(r,i)}return Gv.logNetworkFailure=n,Gv}var Es={},of={},BU;function Oie(){if(BU)return of;BU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(of,"__esModule",{value:!0}),of.pkgVersion=of.pkgName=void 0,of.pkgName="@fluidframework/driver-utils",of.pkgVersion="2.60.0",of}var cf={},UU;function Pie(){if(UU)return cf;UU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(cf,"__esModule",{value:!0}),cf.calculateMaxWaitTime=cf.runWithRetry=void 0;const e=Ht(),n=Je(),a=on(),t=Ot(),i=cT(),r=Oie();async function s(d,l,f,b){let C,v=!1,m=500,h=0;const g=(0,e.performanceNow)();let _;do try{C=await d(b.cancel),v=!0}catch(S){if(!(0,i.canRetryOnError)(S))throw f.sendTelemetryEvent({eventName:`${l}_cancel`,retry:h,duration:(0,e.performanceNow)()-g,fetchCallName:l},S),S;if(b.cancel?.aborted===!0)throw f.sendTelemetryEvent({eventName:`${l}_runWithRetryAborted`,retry:h,duration:(0,e.performanceNow)()-g,fetchCallName:l,reason:b.cancel.reason},S),new i.NonRetryableError("runWithRetry was Aborted",a.DriverErrorTypes.genericError,{driverVersion:r.pkgVersion,fetchCallName:l,reason:b.cancel.reason});h===0&&f.sendTelemetryEvent({eventName:`${l}_firstFailed`,duration:(0,e.performanceNow)()-g,fetchCallName:l},S),h++,_=S,m=c(m,S),b.onRetry&&b.onRetry(m,S),await(0,n.delay)(m)}while(!v);return h>0&&f.sendTelemetryEvent({eventName:`${l}_lastError`,retry:h,duration:(0,e.performanceNow)()-g,fetchCallName:l},_),C}cf.runWithRetry=s;const o=6e4,u=8e3;function c(d,l){const f=(0,i.getRetryDelayFromError)(l);let b=Math.max(f??0,d*2);return b=Math.min(b,(0,t.isFluidError)(l)&&l.getTelemetryProperties().endpointReached===!0?o:u),b}return cf.calculateMaxWaitTime=c,cf}var zU;function Mpe(){if(zU)return Es;zU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Es,"__esModule",{value:!0}),Es.streamObserver=Es.streamFromMessages=Es.emptyMessageStream=Es.requestOps=Es.Queue=Es.ParallelRequests=void 0;const e=Ht(),n=Je(),a=Ot(),t=cT(),i=wie(),r=Oie(),s=Pie(),o=50;class u{get working(){return this.workingState==="working"}get canceled(){return this.workingState==="canceled"}constructor(m,h,g,_,S,p){this.to=h,this.payloadSize=g,this.logger=_,this.requestCallback=S,this.responseCallback=p,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new n.Deferred,this.requests=0,this.latestRequested=m,this.nextToDeliver=m,this.knewTo=h!==void 0}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(m){(0,n.assert)(m>0,258),(0,n.assert)(this.working,259);let h=m;for(;h>0;)h--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){(0,n.assert)(this.to!==void 0,260),(0,n.assert)(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(m){this.working&&(this.workingState="done",this.endEvent.reject(m))}dispatch(){for(;this.working;){const m=this.results.get(this.nextToDeliver);if(m===void 0)break;this.results.delete(this.nextToDeliver),(0,n.assert)(m.length<=this.payloadSize,473),this.nextToDeliver+=m.length,this.responseCallback(m)}this.working&&(this.requestsInFlight===0?((0,n.assert)(this.results.size===0,263),this.done()):this.to!==void 0&&this.nextToDeliver>=this.to&&((0,n.assert)(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const m=this.latestRequested;if(!(this.to!==void 0&&this.to<=m))return this.latestRequested+=this.payloadSize,this.to!==void 0&&(this.latestRequested=Math.min(this.to,this.latestRequested)),(0,n.assert)(m<this.latestRequested,265),{from:m,to:this.latestRequested}}addRequest(){const m=this.getNextChunk();m!==void 0&&this.addRequestCore(m.from,m.to).catch(this.fail.bind(this))}async addRequestCore(m,h){(0,n.assert)(this.working,266);let g=m,_=h;for(this.requestsInFlight++;this.working;){const S=_-g;(0,n.assert)(S>0,267),this.to!==void 0&&((0,n.assert)(g<this.to,268),(0,n.assert)(_<=this.to,269)),this.requests++;const p=this.requestCallback(this.requests,g,_,this.to!==void 0,{});this.dispatch();const{payload:w,cancel:O,partial:E}=await p;if(O&&this.cancel(),this.to!==void 0&&g>=this.to){(0,n.assert)(!this.knewTo,270),w.length!==0&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:g,to:_,end:this.to,length:w.length});break}if(this.working){const F=g,R=w.length;let M=S<=R;if(R!==0){S<R&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:g,to:_,length:R});const j=w.splice(0,S);this.results.set(g,j),g+=j.length}else(0,n.assert)(!E,271),(0,n.assert)(!this.knewTo,272);if(!E&&!M){if(!this.knewTo){(this.to===void 0||this.to>g)&&(this.to=g);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:F,to:_,length:R})}if(_===this.latestRequested){for(;w.length!==0;){const j=w.splice(0,S);this.results.set(g,j),g+=j.length}this.latestRequested=g,M=!0}if(M){const j=this.getNextChunk();if(j===void 0)break;g=j.from,_=j.to}}}this.requestsInFlight--,this.dispatch()}}Es.ParallelRequests=u;class c{constructor(){this.queue=[],this.done=!1}pushValue(m){this.pushCore(Promise.resolve({done:!1,value:m}))}pushError(m){this.pushCore(Promise.reject(m)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(m){(0,n.assert)(!this.done,274),this.deferred?((0,n.assert)(this.queue.length===0,275),this.deferred.resolve(m),this.deferred=void 0):this.queue.push(m)}async read(){(0,n.assert)(this.deferred===void 0,276);const m=this.queue.shift();return m!==void 0?m:((0,n.assert)(!this.done,277),this.deferred=new n.Deferred,this.deferred.promise)}}Es.Queue=c;const d=async()=>{if(globalThis.navigator?.onLine===!1&&globalThis.addEventListener!==void 0)return new Promise(v=>{const m=()=>{v(),globalThis.removeEventListener("online",m)};globalThis.addEventListener("online",m)})};async function l(v,m,h,g,_,S){let p,w=0,O,E=0;const F={partial:!1,cancel:!0,payload:[]};let R=0,M=o;for(;_?.aborted!==!0;){E++;let j;const k=(0,e.performanceNow)();try{const{messages:x,partialResult:L}=await v({...m,retry:E});if(x.length!==0||!h)return O?.end({duration:w,...m,reason:S}),{payload:x,cancel:!1,partial:L};if(p===void 0)p=(0,e.performanceNow)();else if((0,e.performanceNow)()-p>3e4)throw(0,t.createGenericNetworkError)("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},{retry:E,driverVersion:r.pkgVersion,...m})}catch(x){j=x;const L=(0,t.canRetryOnError)(x),V=(0,t.getRetryDelayFromError)(x);if((0,i.logNetworkFailure)(g,{eventName:"GetDeltas_Error",...m,retry:E,duration:(0,e.performanceNow)()-k,retryAfter:V,reason:S},x),!L)throw x}O===void 0&&(R=(0,e.performanceNow)(),O=a.PerformanceEvent.start(g,{eventName:"GetDeltasWaitTime"})),M=(0,s.calculateMaxWaitTime)(M,j),await new Promise(x=>{setTimeout(x,M)}),await d(),w+=(0,e.performanceNow)()-R}return F}function f(v,m,h,g,_,S,p,w){let O=0,E,F=0;const R=new c,M={fromTotal:h,toTotal:g},j=a.PerformanceEvent.start(S,{eventName:"GetDeltas",...M,reason:w}),k=new u(h,g,_,S,async(L,V,G,ee,se)=>(O++,l(async re=>v(V,G,re),{request:L,from:V,to:G,...M,...se},ee,S,p,w)),L=>{E===void 0?(0,n.assert)(L[0].sequenceNumber===h,621):(0,n.assert)(L[0].sequenceNumber===E+1,622),E=L[L.length-1].sequenceNumber,(0,n.assert)(E-L[0].sequenceNumber+1===L.length,623),F+=L.length,R.pushValue(L)}),x=L=>{k.cancel()};return p!==void 0&&p.addEventListener("abort",x),k.run(m).finally(()=>{p!==void 0&&p.removeEventListener("abort",x)}).then(()=>{const L={lastFetch:E,length:F,requests:O};k.canceled?j.cancel({...L,error:"ops request cancelled by client"}):((0,n.assert)(g===void 0||E!==void 0&&E>=g-1,624),j.end(L)),R.pushDone()}).catch(L=>{j.cancel({lastFetch:E,length:F,requests:O},L),R.pushError(L)}),R}Es.requestOps=f,Es.emptyMessageStream={read:async()=>({done:!0})};function b(v){let m=v;return{read:async()=>{if(m===void 0)return{done:!0};const h=await m;return m=void 0,h.length===0?{done:!0}:{done:!1,value:h}}}}Es.streamFromMessages=b;function C(v,m){return{read:async()=>{const h=await v.read();return m(h),h}}}return Es.streamObserver=C,Es}var Wv={},VU;function Npe(){if(VU)return Wv;VU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Wv,"__esModule",{value:!0}),Wv.PrefetchDocumentStorageService=void 0;const e=on(),n=dx(),a=cT();class t extends n.DocumentStorageServiceProxy{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const r=this.internalStorageService.policies;if(r)return{...r,caching:e.LoaderCachingPolicy.NoCaching}}async getSnapshotTree(r){const s=this.internalStorageService.getSnapshotTree(r);return this.prefetchEnabled&&s.then(o=>{o!=null&&this.prefetchTree(o)}),s}async readBlob(r){return this.cachedRead(r)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(r){if(this.prefetchEnabled){const s=this.prefetchCache.get(r);if(s!==void 0)return s;const o=this.internalStorageService.readBlob(r);return this.prefetchCache.set(r,o.catch(u=>{throw(0,a.canRetryOnError)(u)&&this.prefetchCache.delete(r),u})),o}return this.internalStorageService.readBlob(r)}prefetchTree(r){const s=[];this.prefetchTreeCore(r,s);for(const o of s)this.cachedRead(o)}prefetchTreeCore(r,s){for(const[o,u]of Object.entries(r.blobs))o.startsWith(".")||o==="header"||o.startsWith("quorum")?u!==null&&this.cachedRead(u):o.startsWith("deltas")||u!==null&&s.push(u);for(const o of Object.values(r.trees))this.prefetchTreeCore(o,s)}}return Wv.PrefetchDocumentStorageService=t,Wv}var Jv={},HU;function Ape(){if(HU)return Jv;HU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Jv,"__esModule",{value:!0}),Jv.RateLimiter=void 0;const e=Je();class n{constructor(t){this.maxRequests=t,this.tasks=[],this.release=()=>{const i=this.tasks.shift();if(i!==void 0)return i();this.maxRequests++},(0,e.assert)(t>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(this.maxRequests>0){this.maxRequests--;return}return new Promise(t=>{this.tasks.push(t)})}async schedule(t){return await this.acquire(),t().finally(this.release)}}return Jv.RateLimiter=n,Jv}var Qv={},KU;function Dpe(){if(KU)return Qv;KU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Qv,"__esModule",{value:!0}),Qv.readAndParse=void 0;const e=Ht();async function n(a,t){const i=await a.readBlob(t),r=(0,e.bufferToString)(i,"utf8");return JSON.parse(r)}return Qv.readAndParse=n,Qv}var au={},$U;function Eie(){if($U)return au;$U=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(au,"__esModule",{value:!0}),au.getQuorumValuesFromProtocolSummary=au.getDocAttributesFromProtocolSummary=au.isCombinedAppAndProtocolSummary=void 0;const e=on();function n(i,...r){return!(i?.tree===void 0||i.tree?.[".app"]?.type!==e.SummaryType.Tree||i.tree?.[".protocol"]?.type!==e.SummaryType.Tree||Object.keys(i.tree).filter(o=>!r.includes(o)).length!==2)}au.isCombinedAppAndProtocolSummary=n;function a(i){const r=i.tree.attributes;return JSON.parse(r.content)}au.getDocAttributesFromProtocolSummary=a;function t(i){const r=i.tree.quorumValues;return JSON.parse(r.content)}return au.getQuorumValuesFromProtocolSummary=t,au}var Yv={},GU;function kpe(){if(GU)return Yv;GU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Yv,"__esModule",{value:!0}),Yv.convertSummaryTreeToSnapshotITree=void 0;const e=Ht(),n=Je(),a=on(),t=Cie(),i=Eie();function r(s){const o=[],u=(0,i.isCombinedAppAndProtocolSummary)(s),c=u?[...Object.entries(s.tree[".protocol"].tree),...Object.entries(s.tree[".app"].tree)]:Object.entries(s.tree);for(const[d,l]of c){const f=u&&d==="attributes"?".attributes":d;switch(l.type){case a.SummaryType.Blob:{let b,C="utf-8";typeof l.content=="string"?b=l.content:(b=(0,e.Uint8ArrayToString)(l.content,"base64"),C="base64"),o.push(new t.BlobTreeEntry(f,b,C));break}case a.SummaryType.Tree:{o.push(new t.TreeTreeEntry(f,r(l)));break}case a.SummaryType.Attachment:{o.push(new t.AttachmentTreeEntry(f,l.id));break}case a.SummaryType.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,n.unreachableCase)(l,"Unexpected summary tree type")}}return{entries:o,unreferenced:s.unreferenced,groupId:s.groupId}}return Yv.convertSummaryTreeToSnapshotITree=r,Yv}var JF={},QF={},uf={},WU;function Iie(){if(WU)return uf;WU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(uf,"__esModule",{value:!0}),uf.DefaultCompressionStorageConfig=uf.SummaryCompressionAlgorithm=void 0;var e;return(function(n){n[n.None=0]="None",n[n.LZ4=1]="LZ4"})(e||(uf.SummaryCompressionAlgorithm=e={})),uf.DefaultCompressionStorageConfig={algorithm:e.LZ4,minSizeToCompress:500},uf}var Xv={},Zv={},JU;function xpe(){if(JU)return Zv;JU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Zv,"__esModule",{value:!0}),Zv.DocumentServiceFactoryProxy=void 0;class e{constructor(a){this._serviceFactory=a}get serviceFactory(){return this._serviceFactory}get ILayerCompatDetails(){return this._serviceFactory.ILayerCompatDetails}async createContainer(a,t,i,r){return this.serviceFactory.createContainer(a,t,i,r)}async createDocumentService(a,t,i){return this.serviceFactory.createDocumentService(a,t,i)}}return Zv.DocumentServiceFactoryProxy=e,Zv}var e0={},t0={},QU;function qpe(){if(QU)return t0;QU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(t0,"__esModule",{value:!0}),t0.DocumentServiceProxy=void 0;const e=Ht();class n extends e.TypedEventEmitter{constructor(t){super(),this._service=t}get service(){return this._service}async connectToStorage(){return this._service.connectToStorage()}async connectToDeltaStorage(){return this._service.connectToDeltaStorage()}async connectToDeltaStream(t){return this._service.connectToDeltaStream(t)}dispose(t){this._service.dispose(t)}get resolvedUrl(){return this._service.resolvedUrl}}return t0.DocumentServiceProxy=n,t0}var YF={},XF={},YU;function Lpe(){return YU||(YU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.DocumentStorageServiceCompressionAdapter=e.blobHeadersBlobName=void 0;const n=Ht(),a=Je(),t=on(),i=rx(),r=dx(),s=Iie();e.blobHeadersBlobName=".metadata.blobHeaders";const o=".metadata";class u extends r.DocumentStorageServiceProxy{constructor(d,l){super(d),this._config=l,this._isCompressionEnabled=!1}get service(){return this.internalStorageService}static hasPrefix(d){return(n.IsoBuffer.from(d)[0]&240)===176}static readAlgorithmFromBlob(d){return this.hasPrefix(d)?n.IsoBuffer.from(d)[0]&15:s.SummaryCompressionAlgorithm.None}static writeAlgorithmToBlob(d,l){if(l===s.SummaryCompressionAlgorithm.None&&(n.IsoBuffer.from(d)[0]&240)!==176)return d;(0,a.assert)(l<16,1781);const f=new Uint8Array(d),b=f.length,C=new Uint8Array(b+1),v=176|l;return C[0]=v,C.set(f,1),n.IsoBuffer.from(C)}static removePrefixFromBlobIfPresent(d){const l=new Uint8Array(d);return this.hasPrefix(d)?n.IsoBuffer.from(l.subarray(1)):d}static toBinaryArray(d){return typeof d=="string"?new TextEncoder().encode(d):d}static encodeBlob(d,l){let f,b=l.algorithm;if(new Uint8Array(d).length<l.minSizeToCompress)f=d,b=s.SummaryCompressionAlgorithm.None;else if(b===s.SummaryCompressionAlgorithm.None)f=d;else if(b===s.SummaryCompressionAlgorithm.LZ4)f=(0,i.compress)(d);else throw new Error(`Unknown Algorithm ${l.algorithm}`);return f=u.writeAlgorithmToBlob(f,b),f}static decodeBlob(d){let l,f,b;if(this.hasPrefix(d)?(b=u.readAlgorithmFromBlob(d),f=this.removePrefixFromBlobIfPresent(d)):(b=s.SummaryCompressionAlgorithm.None,f=d),b===s.SummaryCompressionAlgorithm.None)l=f;else if(b===s.SummaryCompressionAlgorithm.LZ4)l=(0,i.decompress)(f);else throw new Error(`Unknown Algorithm ${b}`);return l}static recursivelyReplace(d,l,f,b,C,v){(0,a.assert)(typeof l=="object",1782);const m=d?f(l,C):b(l);if(m!==l)return m;let h;for(const g of Object.keys(l)){const _=l[g];if(_&&typeof _=="object"){const S=this.recursivelyReplace(d,_,f,b,C,v);S!==_&&(h=h??(Array.isArray(l)?[...l]:{...l}),h[g]=S)}}return h??l}static findMetadataHolderSummary(d){(0,a.assert)(typeof d=="object",1783);for(const[l,f]of Object.entries(d.tree)){if(f&&f.type===t.SummaryType.Tree){const b=this.findMetadataHolderSummary(f);if(b)return b}if(f&&l===o&&f.type===t.SummaryType.Blob)return d}}static getMetadataHolderTree(d){const l=this.findMetadataHolderSummary(d);return(0,a.assert)(l!==void 0,1784),l.tree}static putCompressionMarkup(d){const l=u.getMetadataHolderTree(d);l[e.blobHeadersBlobName]={type:2,content:""}}static hasCompressionMarkup(d){(0,a.assert)(typeof d=="object",1785);for(const l of Object.keys(d.blobs))if(l===o&&d.blobs[e.blobHeadersBlobName]!==void 0)return!0;for(const l of Object.keys(d.trees)){const f=d[l];if(f!==void 0){const b=this.hasCompressionMarkup(f);if(b)return b}}return!1}static compressSummary(d,l){return this.putCompressionMarkup(d),u.recursivelyReplace(!0,d,u.blobEncoder,u.blobDecoder,l)}async readBlob(d){const l=await super.readBlob(d);return this._isCompressionEnabled?u.decodeBlob(l):l}async getSnapshotTree(d,l){const f=await super.getSnapshotTree(d,l);return this._isCompressionEnabled=f!=null&&u.hasCompressionMarkup(f),f}async uploadSummaryWithContext(d,l){const f=u.compressSummary(d,this._config);return super.uploadSummaryWithContext(f,l)}async downloadSummary(d){const l=await super.downloadSummary(d);return this._isCompressionEnabled?u.recursivelyReplace(!1,l,u.blobEncoder,u.blobDecoder,this._config):l}}e.DocumentStorageServiceCompressionAdapter=u,u.blobEncoder=(c,d)=>{if(c.type===t.SummaryType.Blob){const l=c,f=u.toBinaryArray(l.content),b=u.encodeBlob(f,d);return{type:t.SummaryType.Blob,content:n.IsoBuffer.from(b)}}else return c},u.blobDecoder=c=>{if(c.type===t.SummaryType.Blob){const d=c,l=u.toBinaryArray(d.content),f=u.decodeBlob(l);return{type:t.SummaryType.Blob,content:n.IsoBuffer.from(f)}}else return c}})(XF)),XF}var XU;function lx(){return XU||(XU=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.blobHeadersBlobName=e.DocumentStorageServiceCompressionAdapter=void 0;var n=Lpe();Object.defineProperty(e,"DocumentStorageServiceCompressionAdapter",{enumerable:!0,get:function(){return n.DocumentStorageServiceCompressionAdapter}}),Object.defineProperty(e,"blobHeadersBlobName",{enumerable:!0,get:function(){return n.blobHeadersBlobName}})})(YF)),YF}var ZU;function Bpe(){if(ZU)return e0;ZU=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e0,"__esModule",{value:!0}),e0.DocumentServiceCompressionAdapter=void 0;const e=qpe(),n=lx();class a extends e.DocumentServiceProxy{constructor(i,r){super(i),this._config=r,i.on!==void 0&&i.on("metadataUpdate",s=>this.emit("metadataUpdate",s))}async connectToStorage(){const i=await super.connectToStorage(),r=new n.DocumentStorageServiceCompressionAdapter(i,this._config);return await r.getSnapshotTree(),r}}return e0.DocumentServiceCompressionAdapter=a,e0}var ez;function Upe(){if(ez)return Xv;ez=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Xv,"__esModule",{value:!0}),Xv.DocumentServiceFactoryCompressionAdapter=void 0;const e=xpe(),n=Bpe(),a=lx();class t extends e.DocumentServiceFactoryProxy{constructor(r,s){super(r),this._config=s}async createContainer(r,s,o,u){if(r!==void 0){const d=this._config,l=a.DocumentStorageServiceCompressionAdapter.compressSummary(r.tree[".app"],d);r.tree[".app"]=l}const c=await this.serviceFactory.createContainer(r,s,o,u);return new n.DocumentServiceCompressionAdapter(c,this._config)}async createDocumentService(r){const s=await this.serviceFactory.createDocumentService(r);return new n.DocumentServiceCompressionAdapter(s,this._config)}}return Xv.DocumentServiceFactoryCompressionAdapter=t,Xv}var tz;function Rie(){return tz||(tz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.blobHeadersBlobName=e.DocumentServiceFactoryCompressionAdapter=e.DefaultCompressionStorageConfig=e.SummaryCompressionAlgorithm=void 0;var n=Iie();Object.defineProperty(e,"SummaryCompressionAlgorithm",{enumerable:!0,get:function(){return n.SummaryCompressionAlgorithm}}),Object.defineProperty(e,"DefaultCompressionStorageConfig",{enumerable:!0,get:function(){return n.DefaultCompressionStorageConfig}});var a=Upe();Object.defineProperty(e,"DocumentServiceFactoryCompressionAdapter",{enumerable:!0,get:function(){return a.DocumentServiceFactoryCompressionAdapter}});var t=lx();Object.defineProperty(e,"blobHeadersBlobName",{enumerable:!0,get:function(){return t.blobHeadersBlobName}})})(QF)),QF}var df={},nz;function zpe(){if(nz)return df;nz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(df,"__esModule",{value:!0}),df.isCompressionConfig=df.applyStorageCompression=void 0;const e=Je(),n=Rie();function a(r,s){return s===void 0||s===!1?r:s===!0?t(n.DocumentServiceFactoryCompressionAdapter,r):((0,e.assert)(i(s),1780),t(n.DocumentServiceFactoryCompressionAdapter,r,s))}df.applyStorageCompression=a;function t(r,s,o=n.DefaultCompressionStorageConfig){return o.algorithm===void 0?s:new r(s,o)}function i(r){return r!==void 0&&(r.algorithm!==void 0||r.minSizeToCompress!==void 0)}return df.isCompressionConfig=i,df}var rz;function Vpe(){return rz||(rz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.applyStorageCompression=e.blobHeadersBlobName=e.DefaultCompressionStorageConfig=e.SummaryCompressionAlgorithm=void 0;var n=Rie();Object.defineProperty(e,"SummaryCompressionAlgorithm",{enumerable:!0,get:function(){return n.SummaryCompressionAlgorithm}}),Object.defineProperty(e,"DefaultCompressionStorageConfig",{enumerable:!0,get:function(){return n.DefaultCompressionStorageConfig}}),Object.defineProperty(e,"blobHeadersBlobName",{enumerable:!0,get:function(){return n.blobHeadersBlobName}});var a=zpe();Object.defineProperty(e,"applyStorageCompression",{enumerable:!0,get:function(){return a.applyStorageCompression}})})(JF)),JF}var lf={},iz;function Hpe(){if(iz)return lf;iz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(lf,"__esModule",{value:!0}),lf.getSnapshotTree=lf.isInstanceOfISnapshot=void 0;function e(a){return a!==void 0&&"snapshotFormatV"in a&&a.snapshotFormatV===1}lf.isInstanceOfISnapshot=e;function n(a){return e(a)?a.snapshotTree:a}return lf.getSnapshotTree=n,lf}var sz;function Kn(){return sz||(sz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getGitType=e.getGitMode=e.buildGitTreeHierarchy=e.isInstanceOfISnapshot=e.getSnapshotTree=e.blobHeadersBlobName=e.SummaryCompressionAlgorithm=e.applyStorageCompression=e.convertSummaryTreeToSnapshotITree=e.isCombinedAppAndProtocolSummary=e.getQuorumValuesFromProtocolSummary=e.getDocAttributesFromProtocolSummary=e.runWithRetry=e.calculateMaxWaitTime=e.readAndParse=e.RateLimiter=e.PrefetchDocumentStorageService=e.streamObserver=e.streamFromMessages=e.requestOps=e.Queue=e.ParallelRequests=e.emptyMessageStream=e.logNetworkFailure=e.ThrottlingError=e.RetryableError=e.OnlineStatus=e.NonRetryableError=e.NetworkErrorBasic=e.LocationRedirectionError=e.isOnline=e.getRetryDelaySecondsFromError=e.getRetryDelayFromError=e.GenericNetworkError=e.FluidInvalidSchemaError=e.DeltaStreamConnectionForbiddenError=e.createWriteError=e.createGenericNetworkError=e.canRetryOnError=e.AuthorizationError=e.isRuntimeMessage=e.canBeCoalescedByService=e.InsecureUrlResolver=e.UsageError=e.DocumentStorageServiceProxy=e.AttachmentTreeEntry=e.TreeTreeEntry=e.BlobTreeEntry=e.buildSnapshotTree=void 0;var n=vpe();Object.defineProperty(e,"buildSnapshotTree",{enumerable:!0,get:function(){return n.buildSnapshotTree}});var a=Cie();Object.defineProperty(e,"BlobTreeEntry",{enumerable:!0,get:function(){return a.BlobTreeEntry}}),Object.defineProperty(e,"TreeTreeEntry",{enumerable:!0,get:function(){return a.TreeTreeEntry}}),Object.defineProperty(e,"AttachmentTreeEntry",{enumerable:!0,get:function(){return a.AttachmentTreeEntry}});var t=dx();Object.defineProperty(e,"DocumentStorageServiceProxy",{enumerable:!0,get:function(){return t.DocumentStorageServiceProxy}});var i=Ipe();Object.defineProperty(e,"UsageError",{enumerable:!0,get:function(){return i.UsageError}});var r=Fpe();Object.defineProperty(e,"InsecureUrlResolver",{enumerable:!0,get:function(){return r.InsecureUrlResolver}});var s=jpe();Object.defineProperty(e,"canBeCoalescedByService",{enumerable:!0,get:function(){return s.canBeCoalescedByService}}),Object.defineProperty(e,"isRuntimeMessage",{enumerable:!0,get:function(){return s.isRuntimeMessage}});var o=cT();Object.defineProperty(e,"AuthorizationError",{enumerable:!0,get:function(){return o.AuthorizationError}}),Object.defineProperty(e,"canRetryOnError",{enumerable:!0,get:function(){return o.canRetryOnError}}),Object.defineProperty(e,"createGenericNetworkError",{enumerable:!0,get:function(){return o.createGenericNetworkError}}),Object.defineProperty(e,"createWriteError",{enumerable:!0,get:function(){return o.createWriteError}}),Object.defineProperty(e,"DeltaStreamConnectionForbiddenError",{enumerable:!0,get:function(){return o.DeltaStreamConnectionForbiddenError}}),Object.defineProperty(e,"FluidInvalidSchemaError",{enumerable:!0,get:function(){return o.FluidInvalidSchemaError}}),Object.defineProperty(e,"GenericNetworkError",{enumerable:!0,get:function(){return o.GenericNetworkError}}),Object.defineProperty(e,"getRetryDelayFromError",{enumerable:!0,get:function(){return o.getRetryDelayFromError}}),Object.defineProperty(e,"getRetryDelaySecondsFromError",{enumerable:!0,get:function(){return o.getRetryDelaySecondsFromError}}),Object.defineProperty(e,"isOnline",{enumerable:!0,get:function(){return o.isOnline}}),Object.defineProperty(e,"LocationRedirectionError",{enumerable:!0,get:function(){return o.LocationRedirectionError}}),Object.defineProperty(e,"NetworkErrorBasic",{enumerable:!0,get:function(){return o.NetworkErrorBasic}}),Object.defineProperty(e,"NonRetryableError",{enumerable:!0,get:function(){return o.NonRetryableError}}),Object.defineProperty(e,"OnlineStatus",{enumerable:!0,get:function(){return o.OnlineStatus}}),Object.defineProperty(e,"RetryableError",{enumerable:!0,get:function(){return o.RetryableError}}),Object.defineProperty(e,"ThrottlingError",{enumerable:!0,get:function(){return o.ThrottlingError}});var u=wie();Object.defineProperty(e,"logNetworkFailure",{enumerable:!0,get:function(){return u.logNetworkFailure}});var c=Mpe();Object.defineProperty(e,"emptyMessageStream",{enumerable:!0,get:function(){return c.emptyMessageStream}}),Object.defineProperty(e,"ParallelRequests",{enumerable:!0,get:function(){return c.ParallelRequests}}),Object.defineProperty(e,"Queue",{enumerable:!0,get:function(){return c.Queue}}),Object.defineProperty(e,"requestOps",{enumerable:!0,get:function(){return c.requestOps}}),Object.defineProperty(e,"streamFromMessages",{enumerable:!0,get:function(){return c.streamFromMessages}}),Object.defineProperty(e,"streamObserver",{enumerable:!0,get:function(){return c.streamObserver}});var d=Npe();Object.defineProperty(e,"PrefetchDocumentStorageService",{enumerable:!0,get:function(){return d.PrefetchDocumentStorageService}});var l=Ape();Object.defineProperty(e,"RateLimiter",{enumerable:!0,get:function(){return l.RateLimiter}});var f=Dpe();Object.defineProperty(e,"readAndParse",{enumerable:!0,get:function(){return f.readAndParse}});var b=Pie();Object.defineProperty(e,"calculateMaxWaitTime",{enumerable:!0,get:function(){return b.calculateMaxWaitTime}}),Object.defineProperty(e,"runWithRetry",{enumerable:!0,get:function(){return b.runWithRetry}});var C=Eie();Object.defineProperty(e,"getDocAttributesFromProtocolSummary",{enumerable:!0,get:function(){return C.getDocAttributesFromProtocolSummary}}),Object.defineProperty(e,"getQuorumValuesFromProtocolSummary",{enumerable:!0,get:function(){return C.getQuorumValuesFromProtocolSummary}}),Object.defineProperty(e,"isCombinedAppAndProtocolSummary",{enumerable:!0,get:function(){return C.isCombinedAppAndProtocolSummary}});var v=kpe();Object.defineProperty(e,"convertSummaryTreeToSnapshotITree",{enumerable:!0,get:function(){return v.convertSummaryTreeToSnapshotITree}});var m=Vpe();Object.defineProperty(e,"applyStorageCompression",{enumerable:!0,get:function(){return m.applyStorageCompression}}),Object.defineProperty(e,"SummaryCompressionAlgorithm",{enumerable:!0,get:function(){return m.SummaryCompressionAlgorithm}}),Object.defineProperty(e,"blobHeadersBlobName",{enumerable:!0,get:function(){return m.blobHeadersBlobName}});var h=Hpe();Object.defineProperty(e,"getSnapshotTree",{enumerable:!0,get:function(){return h.getSnapshotTree}}),Object.defineProperty(e,"isInstanceOfISnapshot",{enumerable:!0,get:function(){return h.isInstanceOfISnapshot}});var g=Sie();Object.defineProperty(e,"buildGitTreeHierarchy",{enumerable:!0,get:function(){return g.buildGitTreeHierarchy}}),Object.defineProperty(e,"getGitMode",{enumerable:!0,get:function(){return g.getGitMode}}),Object.defineProperty(e,"getGitType",{enumerable:!0,get:function(){return g.getGitType}})})(kF)),kF}var ZF={},ej={},za={},az;function Fie(){if(az)return za;az=1;const e=-1;za.VOID=e;const n=0;za.PRIMITIVE=n;const a=1;za.ARRAY=a;const t=2;za.OBJECT=t;const i=3;za.DATE=i;const r=4;za.REGEXP=r;const s=5;za.MAP=s;const o=6;za.SET=o;const u=7;za.ERROR=u;const c=8;return za.BIGINT=c,za}var oz;function Kpe(){if(oz)return ej;oz=1;const{VOID:e,PRIMITIVE:n,ARRAY:a,OBJECT:t,DATE:i,REGEXP:r,MAP:s,SET:o,ERROR:u,BIGINT:c}=Fie(),d=typeof self=="object"?self:globalThis,l=(b,C)=>{const v=(h,g)=>(b.set(g,h),h),m=h=>{if(b.has(h))return b.get(h);const[g,_]=C[h];switch(g){case n:case e:return v(_,h);case a:{const S=v([],h);for(const p of _)S.push(m(p));return S}case t:{const S=v({},h);for(const[p,w]of _)S[m(p)]=m(w);return S}case i:return v(new Date(_),h);case r:{const{source:S,flags:p}=_;return v(new RegExp(S,p),h)}case s:{const S=v(new Map,h);for(const[p,w]of _)S.set(m(p),m(w));return S}case o:{const S=v(new Set,h);for(const p of _)S.add(m(p));return S}case u:{const{name:S,message:p}=_;return v(new d[S](p),h)}case c:return v(BigInt(_),h);case"BigInt":return v(Object(BigInt(_)),h);case"ArrayBuffer":return v(new Uint8Array(_).buffer,_);case"DataView":{const{buffer:S}=new Uint8Array(_);return v(new DataView(S),_)}}return v(new d[g](_),h)};return m},f=b=>l(new Map,b)(0);return ej.deserialize=f,ej}var tj={},cz;function $pe(){if(cz)return tj;cz=1;const{VOID:e,PRIMITIVE:n,ARRAY:a,OBJECT:t,DATE:i,REGEXP:r,MAP:s,SET:o,ERROR:u,BIGINT:c}=Fie(),d="",{toString:l}={},{keys:f}=Object,b=h=>{const g=typeof h;if(g!=="object"||!h)return[n,g];const _=l.call(h).slice(8,-1);switch(_){case"Array":return[a,d];case"Object":return[t,d];case"Date":return[i,d];case"RegExp":return[r,d];case"Map":return[s,d];case"Set":return[o,d];case"DataView":return[a,_]}return _.includes("Array")?[a,_]:_.includes("Error")?[u,_]:[t,_]},C=([h,g])=>h===n&&(g==="function"||g==="symbol"),v=(h,g,_,S)=>{const p=(O,E)=>{const F=S.push(O)-1;return _.set(E,F),F},w=O=>{if(_.has(O))return _.get(O);let[E,F]=b(O);switch(E){case n:{let M=O;switch(F){case"bigint":E=c,M=O.toString();break;case"function":case"symbol":if(h)throw new TypeError("unable to serialize "+F);M=null;break;case"undefined":return p([e],O)}return p([E,M],O)}case a:{if(F){let k=O;return F==="DataView"?k=new Uint8Array(O.buffer):F==="ArrayBuffer"&&(k=new Uint8Array(O)),p([F,[...k]],O)}const M=[],j=p([E,M],O);for(const k of O)M.push(w(k));return j}case t:{if(F)switch(F){case"BigInt":return p([F,O.toString()],O);case"Boolean":case"Number":case"String":return p([F,O.valueOf()],O)}if(g&&"toJSON"in O)return w(O.toJSON());const M=[],j=p([E,M],O);for(const k of f(O))(h||!C(b(O[k])))&&M.push([w(k),w(O[k])]);return j}case i:return p([E,O.toISOString()],O);case r:{const{source:M,flags:j}=O;return p([E,{source:M,flags:j}],O)}case s:{const M=[],j=p([E,M],O);for(const[k,x]of O)(h||!(C(b(k))||C(b(x))))&&M.push([w(k),w(x)]);return j}case o:{const M=[],j=p([E,M],O);for(const k of O)(h||!C(b(k)))&&M.push(w(k));return j}}const{message:R}=O;return p([E,{name:F,message:R}],O)};return w},m=(h,{json:g,lossy:_}={})=>{const S=[];return v(!(g||_),!!g,new Map,S)(h),S};return tj.serialize=m,tj}var uz;function jie(){return uz||(uz=1,(function(e){const{deserialize:n}=Kpe(),{serialize:a}=$pe();Object.defineProperty(e,"__esModule",{value:!0}).default=typeof structuredClone=="function"?(t,i)=>i&&("json"in i||"lossy"in i)?n(a(t,i)):structuredClone(t):(t,i)=>n(a(t,i)),e.deserialize=n,e.serialize=a})(ZF)),ZF}var n0={},nj={},dz;function Kg(){return dz||(dz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getDocumentAttributes=e.runSingle=e.getAttachedContainerStateFromSerializedContainer=e.getDetachedContainerStateFromSerializedContainer=e.isDeltaStreamConnectionForbiddenError=e.combineSnapshotTreeAndSnapshotBlobs=e.getProtocolSnapshotTree=e.getSnapshotTreeAndBlobsFromSerializedContainer=e.convertSnapshotInfoToSnapshot=e.convertSnapshotToSnapshotInfo=e.combineAppAndProtocolSummary=e.tryParseCompatibleResolvedUrl=void 0;const n=Ht(),a=Je(),t=on(),i=on(),r=Kn(),s=Ot(),o=ys();function u(O){const E=new URL(O);if(typeof E.pathname!="string")throw new s.LoggingError("Failed to parse pathname");const F=E.search??"",M=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(E.pathname);return M?.length===3?{id:M[1],path:M[2],query:F,version:E.searchParams.get("version")??void 0}:void 0}e.tryParseCompatibleResolvedUrl=u;function c(O,E){return(0,a.assert)(!(0,r.isCombinedAppAndProtocolSummary)(O),1448),(0,a.assert)(!(0,r.isCombinedAppAndProtocolSummary)(E),1449),{type:t.SummaryType.Tree,tree:{".protocol":E,".app":O}}}e.combineAppAndProtocolSummary=c;function d(O){let E={};const F={blobs:{},trees:{},id:(0,o.v4)(),unreferenced:O.unreferenced,groupId:O.groupId};for(const[M,j]of Object.entries(O.tree))switch(j.type){case t.SummaryType.Tree:{const k=d(j);F.trees[M]=k.baseSnapshot,E={...E,...k.snapshotBlobs};break}case t.SummaryType.Attachment:{F.blobs[M]=j.id;break}case t.SummaryType.Blob:{const k=(0,o.v4)();F.blobs[M]=k;const x=j.content instanceof Uint8Array?(0,n.Uint8ArrayToString)(j.content):j.content;E[k]=x;break}case t.SummaryType.Handle:throw new s.LoggingError("No handles should be there in summary in detached container!!");default:(0,a.unreachableCase)(j,`Unknown tree type ${j.type}`)}return{baseSnapshot:F,snapshotBlobs:E}}function l(O){(0,a.assert)(O.sequenceNumber!==void 0,2362);const E={};for(const[F,R]of O.blobContents.entries())E[F]=(0,n.bufferToString)(R,"utf8");return{baseSnapshot:O.snapshotTree,snapshotBlobs:E,snapshotSequenceNumber:O.sequenceNumber}}e.convertSnapshotToSnapshotInfo=l;function f(O,E){const F=new Map;for(const[R,M]of Object.entries(O.snapshotBlobs))F.set(R,(0,n.stringToBuffer)(M,"utf8"));return{snapshotTree:O.baseSnapshot,blobContents:F,ops:[],sequenceNumber:E,latestSequenceNumber:void 0,snapshotFormatV:1}}e.convertSnapshotInfoToSnapshot=f;function b(O,E){const F={type:t.SummaryType.Tree,tree:{...E.tree}};return F.tree[".protocol"]=O,d(F)}const C=O=>{(0,a.assert)((0,r.isCombinedAppAndProtocolSummary)(O),2278);const E=O.tree[".protocol"],F=O.tree[".app"];return b(E,F)};e.getSnapshotTreeAndBlobsFromSerializedContainer=C;function v(O){return".protocol"in O.trees?O.trees[".protocol"]:O}e.getProtocolSnapshotTree=v;const m=(O,E)=>{const F={};for(const[,j]of Object.entries(O.blobs))E[j]!==void 0&&(F[j]=(0,n.stringToBuffer)(E[j],"utf8"));const R={};for(const[j,k]of Object.entries(O.trees))R[j]=(0,e.combineSnapshotTreeAndSnapshotBlobs)(k,E);return{...O,blobsContents:F,trees:R}};e.combineSnapshotTreeAndSnapshotBlobs=m;function h(O){return typeof O=="object"&&O!==null&&O?.errorType===i.DriverErrorTypes.deltaStreamConnectionForbidden}e.isDeltaStreamConnectionForbiddenError=h;function g(O){return!(O?.attached===void 0||O?.baseSnapshot===void 0||O?.snapshotBlobs===void 0||O?.hasAttachmentBlobs===void 0)}function _(O){const E=".hasAttachmentBlobs",F=JSON.parse(O);if(g(F))return F;if((0,r.isCombinedAppAndProtocolSummary)(F)){const{baseSnapshot:R,snapshotBlobs:M}=(0,e.getSnapshotTreeAndBlobsFromSerializedContainer)(F);return{attached:!1,baseSnapshot:R,snapshotBlobs:M,hasAttachmentBlobs:F.tree[E]!==void 0}}else throw new s.UsageError("Cannot rehydrate detached container. Incorrect format")}e.getDetachedContainerStateFromSerializedContainer=_;function S(O){return O===void 0?void 0:JSON.parse(O)}e.getAttachedContainerStateFromSerializedContainer=S;const p=O=>{let E;return(...F)=>E!==void 0?(0,a.compareArrays)(E.args,F)?E.result:Promise.reject(new s.UsageError("Subsequent calls cannot use different arguments.")):(E={args:F,result:O(...F).finally(()=>E=void 0)},E.result)};e.runSingle=p;async function w(O,E){if(E===void 0)return{minimumSequenceNumber:0,sequenceNumber:0};const F=".protocol"in E.trees?E.trees[".protocol"].blobs.attributes:E.blobs[".attributes"];return await(0,r.readAndParse)(O,F)}e.getDocumentAttributes=w})(nj)),nj}var lz;function Gpe(){if(lz)return n0;lz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n0,"__esModule",{value:!0}),n0.runRetriableAttachProcess=void 0;const e=Mr(),n=Je(),a=Kg(),t=async({detachedBlobStorage:i,createOrGetStorageService:r,setAttachmentData:s,createAttachmentSummary:o,offlineLoadEnabled:u,initialAttachmentData:c})=>{let d=c;d.blobs===void 0&&(d=i!==void 0&&i.size>0?{state:e.AttachState.Detached,blobs:"outstanding",redirectTable:new Map}:{state:e.AttachState.Attaching,summary:o(),blobs:"none"},s(d));const l=await r(d.summary);if(d.blobs==="outstanding"){const{redirectTable:b}=d;for((0,n.assert)(!!i,590);b.size<i.size;){const C=i.getBlobIds().filter(v=>!b.has(v));for(const v of C){const m=await i.readBlob(v),h=await l.createBlob(m);b.set(v,h.id)}}s(d={state:e.AttachState.Attaching,summary:o(b),blobs:"done"})}(0,n.assert)(d.state===e.AttachState.Attaching,2274),d.blobs==="done"&&await l.uploadSummaryWithContext(d.summary,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0});const f=u?(0,a.getSnapshotTreeAndBlobsFromSerializedContainer)(d.summary):void 0;return s(d={state:e.AttachState.Attached}),f};return n0.runRetriableAttachProcess=t,n0}var r0={},fz;function Wpe(){if(fz)return r0;fz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(r0,"__esModule",{value:!0}),r0.Audience=void 0;const e=Ht(),n=Je();class a extends e.TypedEventEmitter{constructor(){super(),this.members=new Map,super.setMaxListeners(0)}getSelf(){return this._currentClientId===void 0?void 0:{clientId:this._currentClientId,client:this.getMember(this._currentClientId)}}setCurrentClientId(i){if(this._currentClientId!==i){const r=this._currentClientId;this._currentClientId=i,this.emit("selfChanged",r===void 0?void 0:{clientId:r},{clientId:i,client:this.getMember(i)})}}addMember(i,r){if(this.members.has(i)){const s=this.members.get(i);(0,n.assert)(JSON.stringify(s)===JSON.stringify(r),1202)}else this.members.set(i,r),this.emit("addMember",i,r)}removeMember(i){const r=this.members.get(i);return r===void 0?!1:(this.members.delete(i),this.emit("removeMember",i,r),!0)}getMembers(){return new Map(this.members)}getMember(i){return this.members.get(i)}}return r0.Audience=a,r0}var i0={},ff={},hz;function Mie(){if(hz)return ff;hz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ff,"__esModule",{value:!0}),ff.getPackageName=ff.ReconnectMode=void 0;const e=Mr();var n;(function(t){t.Never="Never",t.Disabled="Disabled",t.Enabled="Enabled"})(n||(ff.ReconnectMode=n={}));const a=t=>({name:(0,e.isFluidPackage)(t?.package)?t?.package.name:t?.package});return ff.getPackageName=a,ff}var hf={},mz;function Nie(){if(mz)return hf;mz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=hf&&hf.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(hf,"__esModule",{value:!0}),hf.DeltaQueue=void 0;const n=Ht(),a=Je(),t=e(ix());class i extends n.TypedEventEmitter{get disposed(){return this.isDisposed}get paused(){return this.pauseCount!==0}get length(){return this.q.length}get idle(){return this.processingPromise===void 0&&this.q.length===0}async waitTillProcessingDone(){return this.processingPromise??{count:0,duration:0}}constructor(s){super(),this.worker=s,this.isDisposed=!1,this.q=new t.default,this.pauseCount=1}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(s){try{this.q.push(s),this.emit("push",s),this.ensureProcessing()}catch(o){this.emit("error",o)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){(0,a.assert)(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&this.processingPromise===void 0&&(this.processingPromise=Promise.resolve().then(()=>{(0,a.assert)(this.processingPromise!==void 0,895);const s=this.processDeltas();return(0,a.assert)(this.processingPromise!==void 0,896),this.processingPromise=void 0,s}).catch(s=>(this.error=s,this.processingPromise=void 0,this.emit("error",s),{count:0,duration:0})),(0,a.assert)(this.processingPromise!==void 0,897))}anythingToProcess(){return this.q.length>0&&!this.paused&&this.error===void 0}processDeltas(){const s=(0,n.performanceNow)();let o=0;for(;this.anythingToProcess();){const c=this.q.shift();o++,this.worker(c),this.emit("op",c)}const u=(0,n.performanceNow)()-s;return this.q.length===0&&this.emit("idle",o,u),{count:o,duration:u}}}return hf.DeltaQueue=i,hf}var ou={},rj={},s0={},no={},pz;function Aie(){if(pz)return no;pz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=no&&no.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(no,"__esModule",{value:!0}),no.Quorum=no.QuorumProposals=no.QuorumClients=void 0;const n=Ht(),a=Je(),t=e(Bre()),{EventEmitter:i}=t.default;class r{constructor(d,l,f,b){this.sequenceNumber=d,this.key=l,this.value=f,this.local=b}}class s extends n.TypedEventEmitter{get disposed(){return this.isDisposed}constructor(d){super(),this.isDisposed=!1,this.members=new Map(d),this.snapshotCache=d}snapshot(){return this.snapshotCache??=[...this.members],this.snapshotCache}addMember(d,l){(0,a.assert)(!!d,2464),(0,a.assert)(!this.members.has(d),2465),this.members.set(d,l),this.emit("addMember",d,l),this.snapshotCache=void 0}removeMember(d){(0,a.assert)(!!d,2466),(0,a.assert)(this.members.has(d),2467),this.members.delete(d),this.emit("removeMember",d),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(d){return this.members.get(d)}dispose(){this.isDisposed=!0}}no.QuorumClients=s;class o extends n.TypedEventEmitter{get disposed(){return this.isDisposed}constructor(d,l){super(),this.sendProposal=l,this.isDisposed=!1,this.stateEvents=new i,this.proposals=new Map(d.proposals.map(([,f])=>[f.sequenceNumber,new r(f.sequenceNumber,f.key,f.value,!1)])),this.values=new Map(d.values),this.proposalsSnapshotCache=d.proposals,this.valuesSnapshotCache=d.values}snapshot(){return this.proposalsSnapshotCache??=[...this.proposals].map(([d,l])=>[d,{sequenceNumber:d,key:l.key,value:l.value},[]]),this.valuesSnapshotCache??=[...this.values],{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(d){return this.values.has(d)}get(d){return this.values.get(d)?.value}async propose(d,l){const f=this.sendProposal(d,l);if(f<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:d}),new Error("Can't propose in disconnected state");return new Promise((b,C)=>{let v;const m=(p,w)=>{p===f&&(v=w,this.stateEvents.off("localProposalSequenced",m),this.stateEvents.off("disconnected",g),this.stateEvents.on("localProposalApproved",h))},h=p=>{p===v&&(b(),S())},g=()=>{v===void 0&&this.stateEvents.once("connected",()=>{v===void 0&&(C(new Error("Client disconnected without successfully sending proposal")),S())})},_=()=>{C(new Error("QuorumProposals was disposed")),S()},S=()=>{this.stateEvents.off("localProposalSequenced",m),this.stateEvents.off("localProposalApproved",h),this.stateEvents.off("disconnected",g),this.stateEvents.off("disposed",_)};this.stateEvents.on("localProposalSequenced",m),this.stateEvents.on("disconnected",g),this.stateEvents.on("disposed",_)})}addProposal(d,l,f,b,C){(0,a.assert)(!this.proposals.has(f),2468);const v=new r(f,d,l,b);this.proposals.set(f,v),this.emit("addProposal",v),b&&this.stateEvents.emit("localProposalSequenced",C,f),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(d){const l=d.minimumSequenceNumber,f=[];for(const[b,C]of this.proposals)b<=l&&f.push(C);f.sort((b,C)=>b.sequenceNumber-C.sequenceNumber);for(const b of f){const C={approvalSequenceNumber:d.sequenceNumber,commitSequenceNumber:-1,key:b.key,sequenceNumber:b.sequenceNumber,value:b.value};this.values.set(C.key,C),this.valuesSnapshotCache=void 0;let v=!1,m=!1;for(const[,h]of this.proposals)if(h.key===C.key){if(m){v=!1;break}else v=!0;m=!0}this.emit("approveProposal",C.sequenceNumber,C.key,C.value,C.approvalSequenceNumber),v&&this.emit("approveProposalComplete",C.sequenceNumber,C.key,C.value,C.approvalSequenceNumber),this.proposals.delete(b.sequenceNumber),this.proposalsSnapshotCache=void 0,b.local&&this.stateEvents.emit("localProposalApproved",b.sequenceNumber)}}setConnectionState(d){d?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}no.QuorumProposals=o;class u extends n.TypedEventEmitter{get disposed(){return this.isDisposed}constructor(d,l,f,b){super(),this.isDisposed=!1,this.quorumClients=new s(d),this.quorumClients.on("addMember",(C,v)=>{this.emit("addMember",C,v)}),this.quorumClients.on("removeMember",C=>{this.emit("removeMember",C)}),this.quorumProposals=new o({proposals:l,values:f},b),this.quorumProposals.on("addProposal",C=>{this.emit("addProposal",C)}),this.quorumProposals.on("approveProposal",(C,v,m,h)=>{this.emit("approveProposal",C,v,m,h)})}close(){this.removeAllListeners()}snapshot(){const d=this.quorumClients.snapshot(),{proposals:l,values:f}=this.quorumProposals.snapshot();return{members:d,proposals:l,values:f}}has(d){return this.quorumProposals.has(d)}get(d){return this.quorumProposals.get(d)}addMember(d,l){this.quorumClients.addMember(d,l)}removeMember(d){this.quorumClients.removeMember(d)}getMembers(){return this.quorumClients.getMembers()}getMember(d){return this.quorumClients.getMember(d)}async propose(d,l){return this.quorumProposals.propose(d,l)}addProposal(d,l,f,b,C){return this.quorumProposals.addProposal(d,l,f,b,C)}updateMinimumSequenceNumber(d){this.quorumProposals.updateMinimumSequenceNumber(d)}setConnectionState(d,l){this.quorumProposals.setConnectionState(d)}dispose(){throw new Error("Not implemented.")}}return no.Quorum=u,no}var gz;function Jpe(){if(gz)return s0;gz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(s0,"__esModule",{value:!0}),s0.ProtocolOpHandler=void 0;const e=on(),n=Aie();class a{get quorum(){return this._quorum}constructor(i,r,s,o,u,c){this.minimumSequenceNumber=i,this.sequenceNumber=r,this._quorum=new n.Quorum(s,o,u,c)}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber}}setConnectionState(i,r){this._quorum.setConnectionState(i,r)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(i,r){if(i.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${i.sequenceNumber}`);this.sequenceNumber=i.sequenceNumber,this.minimumSequenceNumber=i.minimumSequenceNumber;let s=!1;switch(i.type){case e.MessageType.ClientJoin:{const o=i,u=JSON.parse(o.data),c={client:u.detail,sequenceNumber:o.sequenceNumber};this._quorum.addMember(u.clientId,c);break}case e.MessageType.ClientLeave:{const u=JSON.parse(i.data);this._quorum.removeMember(u);break}case e.MessageType.Propose:{typeof i.contents=="string"&&(i.contents=JSON.parse(i.contents));const o=i.contents;this._quorum.addProposal(o.key,o.value,i.sequenceNumber,r,i.clientSequenceNumber),s=!0;break}}return this._quorum.updateMinimumSequenceNumber(i),{immediateNoOp:s}}getProtocolState(i=!1){const r=this._quorum.snapshot();return i&&(r.members=r.members.map(([s,o])=>[s,{...o,client:{...o.client,user:{id:""}}}])),{sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber,...r}}}return s0.ProtocolOpHandler=a,s0}var yz;function Qpe(){return yz||(yz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.Quorum=e.ProtocolOpHandler=void 0;var n=Jpe();Object.defineProperty(e,"ProtocolOpHandler",{enumerable:!0,get:function(){return n.ProtocolOpHandler}});var a=Aie();Object.defineProperty(e,"Quorum",{enumerable:!0,get:function(){return a.Quorum}})})(rj)),rj}var bz;function Die(){if(bz)return ou;bz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ou,"__esModule",{value:!0}),ou.protocolHandlerShouldProcessSignal=ou.ProtocolHandler=ou.SignalType=void 0;const e=on(),n=Kn(),a=Qpe();var t;(function(s){s.ClientJoin="join",s.ClientLeave="leave",s.Clear="clear"})(t||(ou.SignalType=t={}));class i extends a.ProtocolOpHandler{constructor(o,u,c,d,l){super(o.minimumSequenceNumber,o.sequenceNumber,u.members,u.proposals,u.values,c),this.audience=d,this.shouldClientHaveLeft=l;for(const[f,b]of this.quorum.getMembers())d.addMember(f,b.client);this.quorum.on("addMember",(f,b)=>d.addMember(f,b.client)),this.quorum.on("removeMember",f=>d.removeMember(f))}processMessage(o,u){if(o.clientId!=null){if(this.quorum.getMember(o.clientId)===void 0&&o.type!==e.MessageType.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if(this.shouldClientHaveLeft(o.clientId)&&!(0,n.canBeCoalescedByService)(o))throw new Error("Remote message's clientId already should have left")}return super.processMessage(o,u)}processSignal(o){const u=o.content;switch(u.type){case t.Clear:{const c=this.audience.getMembers();for(const[d,l]of c)l.mode==="read"&&this.audience.removeMember(d);break}case t.ClientJoin:{const c=u.content;c.client.mode==="read"&&this.audience.addMember(c.clientId,c.client);break}case t.ClientLeave:{const c=u.content;this.audience.getMember(c)?.mode==="read"&&this.audience.removeMember(c);break}}}}ou.ProtocolHandler=i;function r(s){if(s.clientId===null){const o=s.content;return o.type===t.Clear||o.type===t.ClientJoin||o.type===t.ClientLeave}return!1}return ou.protocolHandlerShouldProcessSignal=r,ou}var vz;function Ype(){if(vz)return i0;vz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(i0,"__esModule",{value:!0}),i0.ConnectionManager=void 0;const e=Ht(),n=hd(),a=Je(),t=on(),i=Kn(),r=Ot(),s=Mie(),o=Nie(),u=Die(),c=Kg(),d=500,l=16*1024,f={fatalConnectError:!0};function b(S){const p=`Nack (${S.type}): ${S.message}`,w=S.code!==403,O=S.retryAfter===void 0?void 0:S.retryAfter*1e3;return(0,i.createGenericNetworkError)(p,{canRetry:w,retryAfterMs:O},{statusCode:S.code,driverVersion:void 0})}const C={mode:"read",details:{capabilities:{interactive:!0}},permission:[],user:{id:"storage-only client"},scopes:[]},v="storage-only client";class m extends e.TypedEventEmitter{constructor(p,w){super(),this.storageOnlyReason=p,this.readonlyConnectionReason=w,this.clientId=v,this.claims={scopes:[t.ScopeType.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[{client:C,clientId:v}],this.serviceConfiguration={maxMessageSize:0,blockSize:0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(p){this.emit("nack",this.clientId,p.map(w=>({operation:w,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(p){this.emit("nack",this.clientId,{operation:p,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}function h(S){return S instanceof m}const g=async()=>{if(globalThis.navigator?.onLine===!1&&globalThis.addEventListener!==void 0)return new Promise(S=>{const p=()=>{S(),globalThis.removeEventListener("online",p)};globalThis.addEventListener("online",p)})};class _{get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){return this.connection?.mode??"read"}get connected(){return this.connection!==void 0}get clientId(){return this.connection?.clientId}get connectionDetails(){return this._connectionDetails}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){return this.connection?.serviceConfiguration?.maxMessageSize??l}get version(){if(this.connection===void 0)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){return this.connection?.serviceConfiguration}get scopes(){return this.connection?.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return this.connection===void 0?{...this._connectionProps,sentOps:this.clientSequenceNumber}:this._connectionProps}shouldJoinWrite(){const p=this.clientSequenceNumberObserved<this.clientSequenceNumber-this.localOpsToIgnore,w=this.containerDirty();return p!==w&&this.logger.sendTelemetryEvent({eventName:"DesiredConnectionModeMismatch",details:JSON.stringify({outstandingOps:p,isDirty:w})}),p||w}get readonly(){return this.readOnlyInfo.readonly}get readOnlyInfo(){let p=!1,w;return h(this.connection)&&(p=!0,w=this.connection.storageOnlyReason),p||this._forceReadonly||this._readonlyPermissions===!0?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:p,storageOnlyReason:w}:{readonly:this._readonlyPermissions}}static detailsFromConnection(p,w){return{claims:p.claims,clientId:p.clientId,checkpointSequenceNumber:p.checkpointSequenceNumber,get initialClients(){return p.initialClients},mode:p.mode,serviceConfiguration:p.serviceConfiguration,version:p.version,reason:w}}constructor(p,w,O,E,F,R,M){this.serviceProvider=p,this.containerDirty=w,this.client=O,this.logger=F,this.props=R,this.retryConnectionTimeoutMs=M,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.localOpsToIgnore=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this._disposed=!1,this.opHandler=(j,k)=>{const x=Array.isArray(k)?k:[k];this.props.incomingOpHandler(x,"opHandler")},this.signalHandler=j=>{const k=Array.isArray(j)?j:[j];this.props.signalHandler(k)},this.nackHandler=(j,k)=>{const x=k[0];if(this._readonlyPermissions===!0){this.props.closeHandler((0,i.createWriteError)("writeOnReadOnlyDocument",{driverVersion:void 0}));return}const L=b(x.content);if(!L.canRetry){this.props.closeHandler(L);return}this.reconnectOnError("write",L)},this.disconnectHandlerInternal=j=>{this.reconnectOnError(this.defaultReconnectionMode,j)},this.errorHandler=j=>{this.reconnectOnError(this.defaultReconnectionMode,j)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=E?s.ReconnectMode.Enabled:s.ReconnectMode.Never,this._outbound=new o.DeltaQueue(j=>{if(this.connection===void 0)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(j)}),this._outbound.on("error",j=>{this.props.closeHandler((0,r.normalizeError)(j))})}dispose(p,w=!0){if(this._disposed)return;this._disposed=!0,this._reconnectMode=s.ReconnectMode.Never,this._outbound.clear();const O={text:"Closing DeltaManager",error:p},E=this.readonly;this.disconnectFromDeltaStream(O),w&&this.set_readonlyPermissions(!0,E,O)}setAutoReconnect(p,w){(0,a.assert)(p!==s.ReconnectMode.Never&&this._reconnectMode!==s.ReconnectMode.Never,632),this._reconnectMode=p,p!==s.ReconnectMode.Enabled&&this.disconnectFromDeltaStream(w)}forceReadonly(p){p!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:p});const w=this.readonly;if(this._forceReadonly=p,w!==this.readonly){if(this._reconnectMode===s.ReconnectMode.Never)throw new r.UsageError("API is not supported for non-connecting or closed container");let O=!1;this.readonly===!0&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),O=this.disconnectFromDeltaStream({text:"Force readonly"})),this.props.readonlyChangeHandler(this.readonly),O&&this.triggerConnect({text:"Force Readonly"},"read")}}set_readonlyPermissions(p,w,O){this._readonlyPermissions=p,w!==this.readonly&&this.props.readonlyChangeHandler(this.readonly,O)}connect(p,w){this.connectCore(p,w).catch(O=>{const E=(0,r.normalizeError)(O,{props:f});this.props.closeHandler(E)})}async connectCore(p,w){(0,a.assert)(!this._disposed,618);let O=w??this.defaultReconnectionMode;if(this.shouldJoinWrite()&&(O="write"),this.connection!==void 0||this.pendingConnection!==void 0){const V=this.connection?.mode??this.pendingConnection?.connectionMode;V!==O&&this.logger.sendTelemetryEvent({eventName:"ConnectionModeMismatch",connected:this.connection!==void 0,mode:V,requestedMode:O,stack:(0,r.generateStack)()});return}const E=this.serviceProvider();(0,a.assert)(E!==void 0,679),this.props.establishConnectionHandler(p);let F;if(E.policies?.storageOnly===!0){F=new m,this.setupNewSuccessfulConnection(F,"read",p),(0,a.assert)(this.pendingConnection===void 0,691);return}let R=d,M=0;const j=(0,e.performanceNow)();this.initialConnectionStartTime===void 0&&(this.initialConnectionStartTime=j);let k;const x=new AbortController,L=x.signal;for(this.pendingConnection={abort:()=>{x.abort()},connectionMode:O};F===void 0;){if(this._disposed)throw new Error("Attempting to connect a closed DeltaManager");if(L.aborted===!0){this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:M,duration:(0,r.formatTick)((0,e.performanceNow)()-j),connectionEstablished:!1});return}M++;try{this.client.mode=O,F=await E.connectToDeltaStream({...this.client,mode:O}),F.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),F=void 0),this.logger.sendTelemetryEvent({eventName:"ConnectionReceived",connected:F!==void 0&&F.disposed===!1},void 0,n.LogLevel.verbose)}catch(V){if(this.logger.sendTelemetryEvent({eventName:"ConnectToDeltaStreamException",connected:F!==void 0&&F.disposed===!1},void 0,n.LogLevel.verbose),(0,c.isDeltaStreamConnectionForbiddenError)(V)){F=new m(V.storageOnlyReason,{text:V.message,error:V}),O="read";break}else if((0,r.isFluidError)(V)&&V.errorType===t.DriverErrorTypes.outOfStorageError){F=new m(void 0,{text:V.message,error:V}),O="read";break}if(!(0,i.canRetryOnError)(V)){const se=(0,r.normalizeError)(V,{props:f});throw this.props.closeHandler(se),se}if((0,i.logNetworkFailure)(this.logger,{attempts:M,delay:R,eventName:"DeltaConnectionFailureToConnect",duration:(0,r.formatTick)((0,e.performanceNow)()-j)},V),k=V,this.reconnectMode!==s.ReconnectMode.Enabled)return;const G=(0,e.performanceNow)(),ee=(0,i.getRetryDelayFromError)(V);if((ee!==void 0||globalThis.navigator?.onLine!==!1)&&(R=(0,i.calculateMaxWaitTime)(R,V)),ee!==void 0&&this.props.reconnectionDelayHandler(R,V),this.retryConnectionTimeoutMs!==void 0){const se=(0,e.performanceNow)()-this.initialConnectionStartTime,re=this.retryConnectionTimeoutMs-se,fe=(0,e.performanceNow)()-j,oe=re*.75;if(R+fe>=oe)throw this.logger.sendTelemetryEvent({eventName:"RetryDelayExceedsConnectionTimeout",attempts:M,duration:(0,r.formatTick)(se),calculatedDelayMs:R,remainingTimeMs:re,timeoutMs:this.retryConnectionTimeoutMs}),(0,r.normalizeError)(V,{props:f})}await new Promise(se=>{setTimeout(se,R)}),await g(),this.logger.sendPerformanceEvent({eventName:"WaitBetweenConnectionAttempts",duration:(0,e.performanceNow)()-G,details:JSON.stringify({retryDelayFromError:ee,delayMs:R})})}}if(M>1&&(0,i.logNetworkFailure)(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:M,duration:(0,r.formatTick)((0,e.performanceNow)()-j)},k),L.aborted===!0||this._disposed){F.dispose(),this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:M,duration:(0,r.formatTick)((0,e.performanceNow)()-j),connectionEstablished:!0});return}this.setupNewSuccessfulConnection(F,O,p)}triggerConnect(p,w){this.reconnectMode===s.ReconnectMode.Enabled&&this.connect(p,w)}disconnectFromDeltaStream(p){if(this.pendingReconnect=!1,this.connection===void 0)return this.pendingConnection!==void 0?(this.cancelConnection(p),!0):!1;(0,a.assert)(this.pendingConnection===void 0,635);const w=this.connection;return this.connection=void 0,this._connectionDetails=void 0,w.off("op",this.opHandler),w.off("signal",this.signalHandler),w.off("nack",this.nackHandler),w.off("disconnect",this.disconnectHandlerInternal),w.off("error",this.errorHandler),w.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),w.dispose(),this.props.disconnectHandler(p),this._connectionVerboseProps={},!0}cancelConnection(p){(0,a.assert)(this.pendingConnection!==void 0,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived",reason:p.text}),this.props.cancelConnectionHandler({text:`Cancel Pending Connection due to ${p.text}`,error:p.error})}setupNewSuccessfulConnection(p,w,O){(0,a.assert)(this.connection===void 0,230),(0,a.assert)(!p.disposed,650),this.pendingConnection=void 0;const E=this.readonly;this.connection=p;const F=!p.claims.scopes.includes(t.ScopeType.DocWrite);if(p.mode!==w&&this.logger.sendTelemetryEvent({eventName:"ConnectionModeMismatch",requestedMode:w,mode:p.mode}),(0,a.assert)(!F||this.connectionMode==="read",232),this.set_readonlyPermissions(F,E,h(p)?p.readonlyConnectionReason:void 0),this._disposed){this.disconnectFromDeltaStream({text:"ConnectionManager already closed"});return}this._outbound.resume(),p.on("op",this.opHandler),p.on("signal",this.signalHandler),p.on("nack",this.nackHandler),p.on("disconnect",this.disconnectHandlerInternal),p.on("error",this.errorHandler),p.on("pong",this.props.pongHandler);const R=p.initialMessages.sort((V,G)=>V.sequenceNumber-G.sequenceNumber);let M=p.checkpointSequenceNumber;this._connectionVerboseProps={clientId:p.clientId,mode:p.mode},this._connectionProps={},p.relayServiceAgent!==void 0&&(this._connectionVerboseProps.relayServiceAgent=p.relayServiceAgent,this._connectionProps.relayServiceAgent=p.relayServiceAgent),this._connectionProps.socketDocumentId=p.claims.documentId,this._connectionProps.connectionMode=p.mode;let j=-1;R.length>0&&(this._connectionVerboseProps.connectionInitialOpsFrom=R[0].sequenceNumber,j=R[R.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=j+1,(M===void 0||M<j)&&(M=j)),this.props.incomingOpHandler(R,this.connectFirstConnection?"InitialOps":"ReconnectOps"),this._connectionDetails=_.detailsFromConnection(p,O),this._connectionDetails.checkpointSequenceNumber=M,this.props.connectHandler(this._connectionDetails),this.connectFirstConnection=!1;let x=[{clientId:null,content:JSON.stringify({type:u.SignalType.Clear})}];const L=(p.initialClients??[]).map(V=>({clientId:null,content:JSON.stringify({type:u.SignalType.ClientJoin,content:V})}));L.length>0&&(x=[...x,...L]),p.initialSignals!==void 0&&p.initialSignals.length>0&&(x=[...x,...p.initialSignals]),this.props.signalHandler(x)}reconnectOnError(p,w){this.reconnect(p,{text:w.message,error:w}).catch(this.props.closeHandler)}async reconnect(p,w){if((0,a.assert)(this.connection!==void 0,235),this.disconnectFromDeltaStream(w),w.error?.canRetry===!1&&this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},w.error),this.reconnectMode===s.ReconnectMode.Never&&this.props.closeHandler(),this._disposed||this.reconnectMode!==s.ReconnectMode.Enabled)return;const O=(0,i.getRetryDelayFromError)(w.error);w.error!==void 0&&O!==void 0&&(this.props.reconnectionDelayHandler(O,w.error),await new Promise(E=>{setTimeout(E,O)})),await g(),this.triggerConnect({text:w.error===void 0?`Reconnecting due to: ${w.text}`:"Reconnecting due to Error",error:w.error},p)}prepareMessageToSend(p){if(this.readonly===!0){(0,a.assert)(this.readOnlyInfo.readonly===!0,496);const w=new r.GenericError("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly,storageOnlyReason:this.readOnlyInfo.storageOnlyReason});this.props.closeHandler(w);return}return(0,a.assert)(!!this.connection,228),this.lastSubmittedClientId!==this.connection?.clientId&&(this.lastSubmittedClientId=this.connection?.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),(0,i.isRuntimeMessage)(p)?this.localOpsToIgnore=0:this.localOpsToIgnore++,{...p,clientSequenceNumber:++this.clientSequenceNumber}}submitSignal(p,w){this.connection===void 0?this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"}):this.connection.submitSignal(p,w)}sendMessages(p){if((0,a.assert)(this.connected,692),this.connectionMode==="read"){this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then(async()=>{this.pendingReconnect&&await this.reconnect("write",{text:"Switch to write"})}).catch(()=>{}));return}(0,a.assert)(!this.pendingReconnect,693),this._outbound.push(p)}beforeProcessingIncomingOp(p){if((0,a.assert)(this.clientId!==p.clientId||this.lastSubmittedClientId===p.clientId,238),this.lastSubmittedClientId!==void 0&&this.lastSubmittedClientId===p.clientId){const w=p.clientSequenceNumber;(0,a.assert)(this.clientSequenceNumberObserved<w,239),(0,a.assert)(w<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=w}p.type===t.MessageType.ClientLeave&&JSON.parse(p.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read",{text:"Switch to read"}).catch(E=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},E)}))}}return i0.ConnectionManager=_,i0}var ro={},a0={},Sz;function Xpe(){if(Sz)return a0;Sz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(a0,"__esModule",{value:!0}),a0.CatchUpMonitor=void 0;const e=Je();class n{constructor(t,i){this.deltaManager=t,this.listener=i,this.caughtUp=!1,this.opHandler=r=>{!this.caughtUp&&r.sequenceNumber>=this.targetSeqNumber&&(this.caughtUp=!0,this.listener())},this._disposed=!1,this.targetSeqNumber=this.deltaManager.lastKnownSeqNumber,(0,e.assert)(this.targetSeqNumber>=this.deltaManager.lastSequenceNumber,892),this.deltaManager.on("op",this.opHandler),this.opHandler({sequenceNumber:this.deltaManager.lastSequenceNumber})}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.deltaManager.off("op",this.opHandler))}}return a0.CatchUpMonitor=n,a0}var Cz;function Zpe(){if(Cz)return ro;Cz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ro,"__esModule",{value:!0}),ro.ConnectionStateHandler=ro.ConnectionStateCatchup=ro.createConnectionStateHandlerCore=ro.createConnectionStateHandler=void 0;const e=Je(),n=Ot(),a=Xpe(),t=sx(),i=45e3,r=1e4;function s(l,f,b){const C=l.mc.config;return o(C.getBoolean("Fluid.Container.DisableCatchUpBeforeDeclaringConnected")!==!0,C.getBoolean("Fluid.Container.DisableJoinSignalWait")!==!0,l,f,b)}ro.createConnectionStateHandler=s;function o(l,f,b,C,v){const m=h=>new d(h,f,v);return l?new c(b,m,C):m(b)}ro.createConnectionStateHandlerCore=o;class u{constructor(f,b){this.inputs=f,this.pimpl=b(this)}get connectionState(){return this.pimpl.connectionState}get pendingClientId(){return this.pimpl.pendingClientId}get clientId(){return this.pimpl.clientId}containerSaved(){return this.pimpl.containerSaved()}dispose(){return this.pimpl.dispose()}initProtocol(f){return this.pimpl.initProtocol(f)}receivedDisconnectEvent(f){return this.pimpl.receivedDisconnectEvent(f)}establishingConnection(f){return this.pimpl.establishingConnection(f)}cancelEstablishingConnection(f){return this.pimpl.cancelEstablishingConnection(f)}receivedConnectEvent(f){return this.pimpl.receivedConnectEvent(f)}get logger(){return this.inputs.logger}get mc(){return this.inputs.mc}connectionStateChanged(f,b,C){return this.inputs.connectionStateChanged(f,b,C)}shouldClientJoinWrite(){return this.inputs.shouldClientJoinWrite()}get maxClientLeaveWaitTime(){return this.inputs.maxClientLeaveWaitTime}logConnectionIssue(f,b,C){return this.inputs.logConnectionIssue(f,b,C)}clientShouldHaveLeft(f){return this.inputs.clientShouldHaveLeft(f)}onCriticalError(f){return this.inputs.onCriticalError(f)}}class c extends u{constructor(f,b,C){super(f,b),this.deltaManager=C,this.transitionToConnectedState=()=>{const v=this.pimpl.connectionState;(0,e.assert)(v===t.ConnectionState.Connected,997),(0,e.assert)(this._connectionState===t.ConnectionState.CatchingUp,998),this._connectionState=t.ConnectionState.Connected,this.inputs.connectionStateChanged(t.ConnectionState.Connected,t.ConnectionState.CatchingUp,{text:"caught up"})},this._connectionState=this.pimpl.connectionState}get connectionState(){return this._connectionState}connectionStateChanged(f,b,C){switch(f){case t.ConnectionState.Connected:{(0,e.assert)(this._connectionState===t.ConnectionState.CatchingUp,993),(0,e.assert)(this.catchUpMonitor===void 0,1003),this.catchUpMonitor=new a.CatchUpMonitor(this.deltaManager,this.transitionToConnectedState);return}case t.ConnectionState.Disconnected:{this.catchUpMonitor?.dispose(),this.catchUpMonitor=void 0;break}case t.ConnectionState.EstablishingConnection:{(0,e.assert)(this._connectionState===t.ConnectionState.Disconnected,1746);break}case t.ConnectionState.CatchingUp:{(0,e.assert)(this._connectionState===t.ConnectionState.EstablishingConnection,995);break}}this._connectionState=f,this.inputs.connectionStateChanged(f,b,C)}}ro.ConnectionStateCatchup=c;class d{get connectionState(){return this._connectionState}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}constructor(f,b,C){this.handler=f,this.readClientsWaitForJoinSignal=b,this._connectionState=t.ConnectionState.Disconnected,this._clientId=C;const v=m=>this.handler.onCriticalError(m);this.prevClientLeftTimer=new e.Timer(this.handler.maxClientLeaveWaitTime??3e5,()=>{(0,e.assert)(this.connectionState!==t.ConnectionState.Connected,684),this.applyForConnectedState("timeout")},v),this.joinTimer=new e.Timer(0,()=>{if(this.connectionState!==t.ConnectionState.CatchingUp)return;const m={protocolInitialized:this.protocol!==void 0,pendingClientId:this.pendingClientId,clientJoined:this.hasMember(this.pendingClientId),waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue(this.connection?.mode==="read"?"NoJoinSignal":"NoJoinOp","error",m)},v)}startjoinTimer(){(0,e.assert)(!this.joinTimer.hasTimer,564),(0,e.assert)(this.connection!==void 0,1203),this.joinTimer.start(this.connection.mode==="write"?i:r)}stopjoinTimer(){(0,e.assert)(this.joinTimer.hasTimer,565),this.joinTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){(0,e.assert)(!this.joinTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(f){f===this.pendingClientId&&(this.joinTimer.hasTimer?this.stopjoinTimer():this.shouldWaitForSelf()&&this.handler.logConnectionIssue(this.connection?.mode==="read"?"ReceivedJoinSignal":"ReceivedJoinOp","generic"),this.waitingForLeaveOp&&(this.waitEvent=n.PerformanceEvent.start(this.handler.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(f){if((0,e.assert)(this.protocol!==void 0,566),(0,e.assert)(!this.waitingForLeaveOp||this.hasMember(this.clientId),738),this.pendingClientId!==this.clientId&&this.hasMember(this.pendingClientId)&&!this.waitingForLeaveOp)this.waitEvent?.end({source:f}),this.setConnectionState(t.ConnectionState.Connected);else{const b=f==="timeout"&&this.connectionState!==t.ConnectionState.Disconnected;this.handler.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:b?"error":"generic",details:JSON.stringify({source:f,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,clientJoined:this.hasMember(this.pendingClientId)})})}}receivedRemoveMemberEvent(f){this.clientId===f&&this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(f){this.connection=void 0,this.setConnectionState(t.ConnectionState.Disconnected,f)}cancelEstablishingConnection(f){(0,e.assert)(this._connectionState===t.ConnectionState.EstablishingConnection,1747),(0,e.assert)(this.connection===void 0,1748);const b=this._connectionState;this._connectionState=t.ConnectionState.Disconnected,this.handler.connectionStateChanged(t.ConnectionState.Disconnected,b,f)}establishingConnection(f){const b=this._connectionState;this._connectionState=t.ConnectionState.EstablishingConnection,this.handler.connectionStateChanged(t.ConnectionState.EstablishingConnection,b,{text:`Establishing Connection due to ${f.text}`,error:f.error})}shouldWaitForSelf(){return(0,e.assert)(this.connection!==void 0,1204),this.connection.mode==="write"||this.readClientsWaitForJoinSignal}receivedConnectEvent(f){this.connection=f;const b=this._connectionState;this._connectionState=t.ConnectionState.CatchingUp,this._pendingClientId=f.clientId,this.handler.connectionStateChanged(t.ConnectionState.CatchingUp,b,f.reason),!this.hasMember(this._pendingClientId)&&this.shouldWaitForSelf()?this.startjoinTimer():this.waitingForLeaveOp||this.setConnectionState(t.ConnectionState.Connected)}setConnectionState(f,b){if(this.connectionState===f){this.handler.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:f});return}const C=this._connectionState;this._connectionState=f;const v=this._clientId!==void 0&&this.protocol?.quorum?.getMember(this._clientId)!==void 0;f===t.ConnectionState.Connected?((0,e.assert)(C===t.ConnectionState.CatchingUp,472),v&&this.handler.clientShouldHaveLeft(this._clientId),this._clientId=this.pendingClientId):f===t.ConnectionState.Disconnected&&(this.joinTimer.hasTimer&&this.stopjoinTimer(),v&&this.handler.shouldClientJoinWrite()&&!this.waitingForLeaveOp?this.prevClientLeftTimer.restart():this.handler.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({clientId:this._clientId,inQuorum:v,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.connectionStateChanged(this._connectionState,C,b),f===t.ConnectionState.Disconnected&&(this._pendingClientId=void 0)}get membership(){return this.readClientsWaitForJoinSignal?this.protocol?.audience:this.protocol?.quorum}initProtocol(f){this.protocol=f,this.membership?.on("addMember",(b,C)=>{(0,e.assert)(C.mode==="read"||f.quorum.getMember(b)!==void 0,1205),this.receivedAddMemberEvent(b)}),this.membership?.on("removeMember",b=>{(0,e.assert)(f.quorum.getMember(b)===void 0,1206),this.receivedRemoveMemberEvent(b)}),this.hasMember(this.pendingClientId)&&this.receivedAddMemberEvent(this.pendingClientId),(0,e.assert)(!this.waitingForLeaveOp,2461),this._clientId!==void 0&&f.quorum?.getMember(this._clientId)!==void 0&&this.prevClientLeftTimer.restart()}hasMember(f){return this.membership?.getMember(f??"")!==void 0}}return ro.ConnectionStateHandler=d,ro}var o0={},ij={},mf={},_z;function fx(){if(_z)return mf;_z=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(mf,"__esModule",{value:!0}),mf.pkgVersion=mf.pkgName=void 0,mf.pkgName="@fluidframework/container-loader",mf.pkgVersion="2.60.0",mf}var Tz;function hx(){return Tz||(Tz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.validateDriverCompatibility=e.validateRuntimeCompatibility=e.driverSupportRequirementsForLoader=e.runtimeSupportRequirementsForLoader=e.loaderCompatDetailsForRuntime=e.loaderCoreCompatDetails=void 0;const n=Ht(),a=Ot(),t=fx();e.loaderCoreCompatDetails={pkgVersion:t.pkgVersion,generation:1},e.loaderCompatDetailsForRuntime={...e.loaderCoreCompatDetails,supportedFeatures:new Set},e.runtimeSupportRequirementsForLoader={minSupportedGeneration:0,requiredFeatures:[]},e.driverSupportRequirementsForLoader={minSupportedGeneration:0,requiredFeatures:[]};function i(s){const o=(0,n.checkLayerCompatibility)(e.runtimeSupportRequirementsForLoader,s);if(!o.isCompatible)throw new a.UsageError("Loader is not compatible with Runtime",{errorDetails:JSON.stringify({loaderVersion:e.loaderCompatDetailsForRuntime.pkgVersion,runtimeVersion:s?.pkgVersion,loaderGeneration:e.loaderCompatDetailsForRuntime.generation,runtimeGeneration:s?.generation,minSupportedGeneration:e.runtimeSupportRequirementsForLoader.minSupportedGeneration,isGenerationCompatible:o.isGenerationCompatible,unsupportedFeatures:o.unsupportedFeatures})})}e.validateRuntimeCompatibility=i;function r(s,o){const u=(0,n.checkLayerCompatibility)(e.driverSupportRequirementsForLoader,s);if(!u.isCompatible){const c=new a.UsageError("Loader is not compatible with Driver",{errorDetails:JSON.stringify({loaderVersion:e.loaderCoreCompatDetails.pkgVersion,driverVersion:s?.pkgVersion,loaderGeneration:e.loaderCoreCompatDetails.generation,driverGeneration:s?.generation,minSupportedGeneration:e.driverSupportRequirementsForLoader.minSupportedGeneration,isGenerationCompatible:u.isGenerationCompatible,unsupportedFeatures:u.unsupportedFeatures})});throw o(c),c}}e.validateDriverCompatibility=r})(ij)),ij}var wz;function ege(){if(wz)return o0;wz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(o0,"__esModule",{value:!0}),o0.ContainerContext=void 0;const e=hx();class n{get clientId(){return this._getClientId()}get id(){return this._getContainerDiagnosticId()??""}get connected(){return this._getConnected()}get ILayerCompatDetails(){return e.loaderCompatDetailsForRuntime}constructor(t){this.supportedFeatures=new Map([["referenceSequenceNumbers",!0]]),this.options=t.options,this.scope=t.scope,this.baseSnapshot=t.baseSnapshot,this.deltaManager=t.deltaManager,this.storage=t.storage,this.quorum=t.quorum,this.audience=t.audience,this.loader=t.loader,this.submitFn=t.submitFn,this.submitSummaryFn=t.submitSummaryFn,this.submitBatchFn=t.submitBatchFn,this.submitSignalFn=t.submitSignalFn,this.disposeFn=t.disposeFn,this.closeFn=t.closeFn,this.updateDirtyContainerState=t.updateDirtyContainerState,this.getAbsoluteUrl=t.getAbsoluteUrl,this.clientDetails=t.clientDetails,this.existing=t.existing,this.taggedLogger=t.taggedLogger,this.pendingLocalState=t.pendingLocalState,this.snapshotWithContents=t.snapshotWithContents,this.getConnectionState=t.getConnectionState,this._getClientId=t.getClientId,this._getContainerDiagnosticId=t.getContainerDiagnosticId,this._getConnected=t.getConnected,this._getAttachState=t.getAttachState,this.version=t.version}getLoadedFromVersion(){return this.version}get attachState(){return this._getAttachState()}}return o0.ContainerContext=n,o0}var cu={},c0={},Oz;function tge(){if(Oz)return c0;Oz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(c0,"__esModule",{value:!0}),c0.ProtocolTreeStorageService=void 0;class e{constructor(a,t,i){this.internalStorageService=a,this.addProtocolSummaryIfMissing=t,this.shouldSummarizeProtocolTree=i,this.getSnapshotTree=a.getSnapshotTree.bind(a),this.getSnapshot=a.getSnapshot?.bind(a),this.getVersions=a.getVersions.bind(a),this.createBlob=a.createBlob.bind(a),this.readBlob=a.readBlob.bind(a),this.downloadSummary=a.downloadSummary.bind(a),this.dispose=a.dispose.bind(a)}get policies(){return this.internalStorageService.policies}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(a,t){return this.shouldSummarizeProtocolTree()?this.internalStorageService.uploadSummaryWithContext(this.addProtocolSummaryIfMissing(a),t):this.internalStorageService.uploadSummaryWithContext(a,t)}}return c0.ProtocolTreeStorageService=e,c0}var u0={},Pz;function nge(){if(Pz)return u0;Pz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(u0,"__esModule",{value:!0}),u0.RetriableDocumentStorageService=void 0;const e=Je(),n=Kn(),a=Ot();class t{constructor(r,s){this.internalStorageServiceP=r,this.logger=s,this._disposed=!1,this.internalStorageServiceP.then(o=>this.internalStorageService=o).catch(()=>{})}get policies(){if(this.internalStorageService)return this.internalStorageService.policies;throw new Error("storage service not yet instantiated")}get disposed(){return this._disposed}dispose(){this._disposed=!0}async getSnapshotTree(r,s){return this.runWithRetry(async()=>this.internalStorageServiceP.then(async o=>o.getSnapshotTree(r,s)),"storage_getSnapshotTree")}async getSnapshot(r){return this.runWithRetry(async()=>this.internalStorageServiceP.then(async s=>{if(s.getSnapshot!==void 0)return s.getSnapshot(r);throw new a.UsageError("getSnapshot api should exist on internal storage in RetriableDocStorageService class")}),"storage_getSnapshot")}async readBlob(r){return this.runWithRetry(async()=>this.internalStorageServiceP.then(async s=>s.readBlob(r)),"storage_readBlob")}async getVersions(r,s,o,u){return this.runWithRetry(async()=>this.internalStorageServiceP.then(async c=>c.getVersions(r,s,o,u)),"storage_getVersions")}async uploadSummaryWithContext(r,s){return(0,e.assert)(s.referenceSequenceNumber===0==(s.ackHandle===void 0),593),s.referenceSequenceNumber!==0?this.internalStorageServiceP.then(async o=>o.uploadSummaryWithContext(r,s)):this.runWithRetry(async()=>this.internalStorageServiceP.then(async o=>o.uploadSummaryWithContext(r,s)),"storage_uploadSummaryWithContext")}async downloadSummary(r){return this.runWithRetry(async()=>this.internalStorageServiceP.then(async s=>s.downloadSummary(r)),"storage_downloadSummary")}async createBlob(r){return this.runWithRetry(async()=>this.internalStorageServiceP.then(async s=>s.createBlob(r)),"storage_createBlob")}checkStorageDisposed(r,s){if(this._disposed)throw this.logger.sendTelemetryEvent({eventName:`${r}_abortedStorageDisposed`,fetchCallName:r},s),new a.GenericError("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(r,s){return(0,n.runWithRetry)(r,s,this.logger,{onRetry:(o,u)=>this.checkStorageDisposed(s,u)})}}return u0.RetriableDocumentStorageService=t,u0}var Ez;function kie(){if(Ez)return cu;Ez=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(cu,"__esModule",{value:!0}),cu.getBlobContentsFromTreeWithBlobContents=cu.getBlobContentsFromTree=cu.ContainerStorageAdapter=void 0;const e=Ht(),n=Je(),a=Kn(),t=tge(),i=nge(),r=Kg();class s{get summarizeProtocolTree(){return this._summarizeProtocolTree===!0}get loadedGroupIdSnapshots(){return this._loadedGroupIdSnapshots}constructor(h,g,_={},S,p,w){this.logger=g,this.blobContents=_,this.loadingGroupIdSnapshotsFromPendingState=S,this.addProtocolSummaryIfMissing=p,this.enableSummarizeProtocolTree=w,this._loadedGroupIdSnapshots={},this.disposed=!1,this._storageService=new o(h,g)}dispose(h){this._storageService?.dispose?.(h),this.disposed=!0}connectToService(h){if(!(this._storageService instanceof o))return;const g=h.connectToStorage(),_=this._storageService=new i.RetriableDocumentStorageService(g,this.logger);this._storageService=new t.ProtocolTreeStorageService(_,(...S)=>(this.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this.addProtocolSummaryIfMissing(...S)),()=>{const S=h.policies?.summarizeProtocolTree??this.enableSummarizeProtocolTree??!1;return this._summarizeProtocolTree!==S&&this.logger.sendTelemetryEvent({eventName:"isSummarizeProtocolTreeEnabled",details:{value:S}}),this._summarizeProtocolTree=S,this._summarizeProtocolTree})}loadSnapshotFromSnapshotBlobs(h){for(const[g,_]of Object.entries(h))this.blobContents[g]=_}clearPendingState(){this.loadingGroupIdSnapshotsFromPendingState=void 0}get policies(){try{return this._storageService.policies}catch{}}get maximumCacheDurationMs(){return this.policies?.maximumCacheDurationMs}async getSnapshotTree(h,g){return this._storageService.getSnapshotTree(h,g)}async getSnapshot(h){let g;if(this.loadingGroupIdSnapshotsFromPendingState!==void 0&&h?.loadingGroupIds!==void 0){const S=this.loadingGroupIdSnapshotsFromPendingState[h.loadingGroupIds[0]];(0,n.assert)(S!==void 0,2416),g=(0,r.convertSnapshotInfoToSnapshot)(S,S.snapshotSequenceNumber)}else{if(this._storageService.getSnapshot===void 0)throw new a.UsageError("getSnapshot api should exist in internal storage in ContainerStorageAdapter");g=await this._storageService.getSnapshot(h)}const _=h?.loadingGroupIds;if((0,n.assert)(g.sequenceNumber!==void 0,2417),_!==void 0)for(const S of _)(this._loadedGroupIdSnapshots[S]?.sequenceNumber??-1)<g.sequenceNumber&&(this._loadedGroupIdSnapshots[S]=g);return g}async readBlob(h){const g=this.blobContents[h];return g!==void 0?typeof g=="string"?(0,e.stringToBuffer)(g,"utf8"):g:this._storageService.readBlob(h)}async getVersions(h,g,_,S){return this._storageService.getVersions(h,g,_,S)}async uploadSummaryWithContext(h,g){return this._storageService.uploadSummaryWithContext(h,g)}async createBlob(h){return this._storageService.createBlob(h)}async downloadSummary(h){return this._storageService.downloadSummary(h)}}cu.ContainerStorageAdapter=s;class o{constructor(h,g){this.detachedStorage=h,this.logger=g,this.getSnapshotTree=this.notCalled,this.getSnapshot=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(h){return this.verifyStorage().createBlob(h)}async readBlob(h){return this.verifyStorage().readBlob(h)}verifyStorage(){if(this.detachedStorage===void 0)throw new a.UsageError("Real storage calls not allowed in Unattached container");return this.detachedStorage}get policies(){return this.notCalled()}notCalled(){this.verifyStorage();try{throw new Error("BlobOnlyStorage not implemented method used")}catch(h){throw this.logger.sendTelemetryEvent({eventName:"BlobOnlyStorageWrongCall"},h),h}}}const u=".blobs",c=".redirectTable";async function d(m,h){const g={};if((0,a.isInstanceOfISnapshot)(m)){const _=m.blobContents;for(const[S,p]of _.entries())g[S]=(0,e.bufferToString)(p,"utf8")}else await l(m,g,h);return g}cu.getBlobContentsFromTree=d;async function l(m,h,g,_=!0){const S=[];for(const[p,w]of Object.entries(m.trees))_&&p===u?S.push(f(w,h,g)):S.push(l(w,h,g,!1));for(const p of Object.values(m.blobs)){const w=await g.readBlob(p);h[p]=(0,e.bufferToString)(w,"utf8")}return Promise.all(S)}async function f(m,h,g){const _=m.blobs[c];(0,n.assert)(_!==void 0,2510);const S=await g.readBlob(_);h[_]=(0,e.bufferToString)(S,"utf8")}function b(m){const h={};return C(m,h),h}cu.getBlobContentsFromTreeWithBlobContents=b;function C(m,h,g=!0){for(const[_,S]of Object.entries(m.trees))g&&_===u?v(S,h):C(S,h,!1);for(const _ of Object.values(m.blobs)){const S=m.blobsContents?.[_];(0,n.assert)(S!==void 0,748),h[_]=(0,e.bufferToString)(S,"utf8")}}function v(m,h){const g=m.blobs[c];(0,n.assert)(g!==void 0,2511);const _=m.blobsContents?.[g];(0,n.assert)(_!==void 0,1807),h[g]=(0,e.bufferToString)(_,"utf8")}return cu}var d0={},l0={},Iz;function rge(){if(Iz)return l0;Iz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(l0,"__esModule",{value:!0}),l0.ThrottlingWarning=void 0;const e=Mr(),n=Ot();class a extends n.LoggingError{constructor(i,r,s){super(i,s),this.retryAfterSeconds=r,this.errorType=e.ContainerErrorTypes.throttlingError}static wrap(i,r,s){const o=u=>new a(u,r);return(0,n.wrapErrorAndLog)(i,o,s)}}return l0.ThrottlingWarning=a,l0}var Rz;function ige(){if(Rz)return d0;Rz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(d0,"__esModule",{value:!0}),d0.DeltaManager=void 0;const e=Je(),n=on(),a=Kn(),t=Ot(),i=ys(),r=Nie(),s=rge();function o(d){if((0,a.isRuntimeMessage)(d))return!0;switch(d.type){case n.MessageType.Propose:case n.MessageType.Reject:case n.MessageType.NoOp:case n.MessageType.Accept:case n.MessageType.Summarize:return!0;default:return!1}}function u(d,l,f){if(d)return!0;const b={eventName:f,category:"error"};return l.send(b),!1}class c extends t.EventEmitterWithErrorHandling{get active(){return this._active()}get disposed(){return this._closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return(0,e.assert)(this.connectionManager.connected,223),this._checkpointSequenceNumber!==void 0}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(l,f,b=!1,C,v,m){const h=m??this.lastProcessedSequenceNumber,g={contents:f,metadata:C,referenceSequenceNumber:h,type:l,compression:v};b||this.flush();const _=this.connectionManager.prepareMessageToSend(g);return _===void 0?-1:((0,e.assert)(o(_),1049),f!==void 0&&(this.opsSize+=f.length),this.messageBuffer.push(_),_.type===n.MessageType.NoOp&&this.noOpCount++,this.emit("submitOp",_),b||this.flush(),_.clientSequenceNumber)}submitSignal(l,f){return this.connectionManager.submitSignal(l,f)}flush(){const l=this.messageBuffer;l.length!==0&&(this.messageBuffer=[],this.emit("prepareSend",l),l.length===1?(0,e.assert)(l[0].metadata?.batch===void 0,969):((0,e.assert)(l[0].metadata?.batch===!0,970),(0,e.assert)(l[l.length-1].metadata?.batch===!1,971)),this.connectionManager.sendMessages(l),(0,e.assert)(this.messageBuffer.length===0,972))}get connectionProps(){return{sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0,deltaManagerState:this._disposed?"disposed":this._closed?"closed":"open",...this.connectionManager.connectionProps}}logConnectionIssue(l){(0,e.assert)(this.connectionManager.connected,568);const f=this.pending.sort((b,C)=>b.sequenceNumber-C.sequenceNumber);this.logger.sendTelemetryEvent({...l,fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber,...this.connectionManager.connectionVerboseProps,pendingOps:this.pending.length,pendingFirst:f[0]?.sequenceNumber,haveHandler:this.handler!==void 0,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused})}constructor(l,f,b,C){super((m,h)=>{this.logger.sendErrorEvent({eventName:"DeltaManagerEventHandlerException",name:typeof m=="string"?m:void 0},h),this.close((0,t.normalizeError)(h))}),this.serviceProvider=l,this.logger=f,this._active=b,this.pending=[],this.currentlyProcessingOps=!1,this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.noOpCount=0,this.lastClientSequenceNumber=0,this.opsSize=0,this.initSequenceNumber=0,this._closed=!1,this._disposed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new AbortController,this.deltaStorageDelayId=(0,i.v4)(),this.deltaStreamDelayId=(0,i.v4)(),this.messageBuffer=[];const v={incomingOpHandler:(m,h)=>{try{this.enqueueMessages(m,h)}catch(g){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},g),this.close((0,t.normalizeError)(g))}},signalHandler:m=>{for(const h of m)this._inboundSignal.push(h)},reconnectionDelayHandler:(m,h)=>this.emitDelayInfo(this.deltaStreamDelayId,m,h),closeHandler:m=>this.close(m),disconnectHandler:m=>this.disconnectHandler(m),connectHandler:m=>this.connectHandler(m),pongHandler:m=>this.emit("pong",m),readonlyChangeHandler:(m,h)=>{(0,t.safeRaiseEvent)(this,this.logger,"readonly",m,h)},establishConnectionHandler:m=>this.establishingConnection(m),cancelConnectionHandler:m=>this.cancelEstablishingConnection(m)};this.connectionManager=C(v),this._inbound=new r.DeltaQueue(m=>{this.processInboundMessage(m)}),this._inbound.on("error",m=>{this.close(t.DataProcessingError.wrapIfUnrecognized(m,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new r.DeltaQueue(m=>{if(this.handler===void 0)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({...m,content:JSON.parse(m.content)})}),this._inboundSignal.on("error",m=>{this.close((0,t.normalizeError)(m))})}cancelEstablishingConnection(l){this.emit("cancelEstablishingConnection",l)}establishingConnection(l){this.emit("establishingConnection",l)}connectHandler(l){this.refreshDelayInfo(this.deltaStreamDelayId);const f=this.connectionManager.connectionVerboseProps;f.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,f.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const b=l.checkpointSequenceNumber;this._checkpointSequenceNumber=b,b!==void 0&&this.updateLatestKnownOpSeqNumber(b),(0,e.assert)(this.messageBuffer.length===0,233),this.opsSize=0,this.noOpCount=0,this.emit("connect",l,b===void 0?void 0:this.lastObservedSeqNumber-this.lastSequenceNumber),b!==void 0?b>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):l.mode==="read"&&this.fetchMissingDeltas("AfterReadConnection")}async attachOpHandler(l,f,b,C="none",v=f){if(this.initSequenceNumber=f,this.lastProcessedSequenceNumber=v,this.minSequenceNumber=l,this.lastQueuedSequenceNumber=v,this.lastObservedSeqNumber=v,(0,e.assert)(this.handler===void 0,226),this.handler=b,(0,e.assert)(!!this.handler,227),(0,e.assert)(this.fetchReason===void 0,616),!this._closed){if(this._inbound.resume(),this._inboundSignal.resume(),C!=="none"){const m=C==="cached";await this.fetchMissingDeltasCore(`DocumentOpen_${C}`,m),m&&this.fetchMissingDeltas("PostDocumentOpen")}(0,e.assert)(this.fetchReason!==void 0||this.pending.length===0,617)}}connect(l){const f=l.fetchOpsFromStorage??!0;u(this.handler!==void 0||!f,this.logger,"CantFetchWithoutBaseline"),f&&this.fetchMissingDeltas(l.reason.text),this.connectionManager.connect(l.reason,l.mode)}async getDeltas(l,f,b,C,v){const m=this.serviceProvider();if(m===void 0)throw new Error("Delta manager is not attached");this.deltaStorage===void 0&&(this.deltaStorage=await m.connectToDeltaStorage());let h;if(f===void 0)h=p=>p.sequenceNumber>=this.lastObservedSeqNumber;else{const p=f-1;if(this.lastQueuedSequenceNumber>=p){this.logger.sendPerformanceEvent({reason:b,eventName:"ExtraStorageCall",early:!0,from:l,to:f,...this.connectionManager.connectionVerboseProps});return}h=w=>w.sequenceNumber>=p}const g=new AbortController;let _=!1;const S=p=>{(0,e.assert)(p.sequenceNumber===this.lastQueuedSequenceNumber,570),!_&&h(p)&&(g.abort("DeltaManager getDeltas fetch cancelled"),this._inbound.off("push",S))};try{this._inbound.on("push",S),(0,e.assert)(this.closeAbortController.signal.onabort===null,488),this.closeAbortController.signal.addEventListener("abort",()=>g.abort(this.closeAbortController.signal.reason));const p=this.deltaStorage.fetchMessages(l,f,g.signal,v,b);for(;;){const w=await p.read();if(w.done)break;try{_=!0,C(w.value)}finally{_=!1}}}finally{g.signal.aborted&&this.logger.sendTelemetryEvent({eventName:"DeltaManager_GetDeltasAborted",fetchReason:b,reason:g.signal.reason}),this.closeAbortController.signal.onabort=null,this._inbound.off("push",S),(0,e.assert)(!_,649)}}close(l){this._closed||(this._closed=!0,this.connectionManager.dispose(l,!0),this.clearQueues(),this.emit("closed",l))}dispose(l){if(!this._disposed){if(l!==void 0&&!(0,t.isFluidError)(l))throw new t.UsageError("Error must be a Fluid error");this._disposed=!0,this._closed=!0,this.connectionManager.dispose(l,!1),this.clearQueues(),this.emit("disposed",l),this.removeAllListeners()}}clearQueues(){this.closeAbortController.abort("DeltaManager is closed"),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[]}refreshDelayInfo(l){this.throttlingIdSet.delete(l),this.throttlingIdSet.size===0&&(this.timeTillThrottling=0)}disconnectHandler(l){this.messageBuffer.length=0,this.emit("disconnect",l.text,l.error)}emitDelayInfo(l,f,b){const C=Date.now();if(this.throttlingIdSet.add(l),f>0&&C+f>this.timeTillThrottling){this.timeTillThrottling=C+f;const v=s.ThrottlingWarning.wrap(b,f/1e3,this.logger);this.emit("throttled",v)}}comparableMessagePayload(l){return`${l.clientId}-${l.type}-${l.minimumSequenceNumber}-${l.referenceSequenceNumber}-${l.timestamp}`}enqueueMessages(l,f,b=!1){if(this.handler===void 0){this.pending=[...this.pending,...l];return}if((0,e.assert)(this.pending.length===0||this.fetchReason!==void 0,489),l.length===0)return;const C=l[0].sequenceNumber,v=l[l.length-1].sequenceNumber;if(v>this.lastQueuedSequenceNumber){let h=C-1;const g=h-this.lastQueuedSequenceNumber;let _,S=0,p=0;for(const O of l)O.sequenceNumber===h?S++:O.sequenceNumber!==h+1&&(p++,_===void 0&&(_=h+1)),h=O.sequenceNumber;let w;S!==0||p!==0&&!b||g>0&&this.fetchReason===void 0?w="enqueueMessages":this.fetchReason!==void 0&&this.fetchReason!==f&&C<=this.lastQueuedSequenceNumber+1&&v>this.lastQueuedSequenceNumber&&(w="enqueueMessagesExtraFetch"),w!==void 0&&this.logger.sendPerformanceEvent({eventName:w,reason:f,previousReason:this.prevEnqueueMessagesReason,from:C,to:v+1,length:l.length,fetchReason:this.fetchReason,duplicate:S>0?S:void 0,initialGap:g===0?void 0:g,gap:p>0?p:void 0,firstMissing:_,dmInitialSeqNumber:this.initialSequenceNumber,...this.connectionManager.connectionVerboseProps})}this.updateLatestKnownOpSeqNumber(l[l.length-1].sequenceNumber);const m=this.previouslyProcessedMessage?.sequenceNumber;(0,e.assert)(m===void 0||m===this.lastQueuedSequenceNumber,236);for(const h of l)if(h.sequenceNumber<=this.lastQueuedSequenceNumber){if(this.previouslyProcessedMessage?.sequenceNumber===h.sequenceNumber){const g=this.comparableMessagePayload(this.previouslyProcessedMessage),_=this.comparableMessagePayload(h);if(g!==_){const S=new a.NonRetryableError("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",n.DriverErrorTypes.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:h.sequenceNumber,message1:g,message2:_,driverVersion:void 0});this.close(S)}}}else h.sequenceNumber===this.lastQueuedSequenceNumber+1?(this.lastQueuedSequenceNumber=h.sequenceNumber,this.previouslyProcessedMessage=h,this._inbound.push(h)):(this.pending.push(h),this.fetchMissingDeltas(f,h.sequenceNumber));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":f}processInboundMessage(l){const f=Date.now();(0,e.assert)(!this.currentlyProcessingOps,943),this.currentlyProcessingOps=!0,this.lastProcessedMessage=l;const b=typeof l.clientId=="string";if((0,e.assert)(l.clientId===null||b,1050),!b&&o(l)&&l.type!==n.MessageType.NoOp)throw new t.DataCorruptionError("Mismatch in clientId",{...(0,t.extractSafePropertiesFromMessage)(l),messageType:l.type});if(this.connectionManager.clientId!==void 0&&this.connectionManager.clientId===l.clientId){l.type===n.MessageType.NoOp&&this.noOpCount--;const m=l.clientSequenceNumber-this.lastClientSequenceNumber-1;if(this.noOpCount-=m,this.noOpCount<0)throw new Error(`gap in client sequence number: ${m}`);this.lastClientSequenceNumber=l.clientSequenceNumber}if(this.connectionManager.beforeProcessingIncomingOp(l),this.minSequenceNumber>l.minimumSequenceNumber)throw t.DataProcessingError.create("Invalid MinimumSequenceNumber from service - document may have been restored to previous state","DeltaManager.processInboundMessage",l,{clientId:this.connectionManager.clientId});const C=l.sequenceNumber-l.minimumSequenceNumber;if(C<0||C===0&&l.clientId!==null)throw new t.DataCorruptionError("MSN has to be lower than sequence #",(0,t.extractSafePropertiesFromMessage)(l));if(this.minSequenceNumber=l.minimumSequenceNumber,l.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new t.DataCorruptionError("Found a non-Sequential sequenceNumber",{...(0,t.extractSafePropertiesFromMessage)(l),clientId:this.connectionManager.clientId});if(this.lastProcessedSequenceNumber=l.sequenceNumber,(0,e.assert)(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),this.handler===void 0)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(l),this.currentlyProcessingOps=!1;const v=Date.now();this.emit("op",l,v-f)}fetchMissingDeltas(l,f){this.fetchMissingDeltasCore(l,!1,f).catch(b=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},b)})}async fetchMissingDeltasCore(l,f,b){if(this.fetchReason===void 0){if(this._closed){this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:l});return}if(this.handler===void 0){(0,e.assert)(this.lastQueuedSequenceNumber===0,619);return}try{let C=this.lastQueuedSequenceNumber+1;const v=this.previouslyProcessedMessage?.sequenceNumber;v!==void 0&&((0,e.assert)(v===this.lastQueuedSequenceNumber,242),(0,e.assert)(C>1,243),C--);const m=`${l}_fetch`;this.fetchReason=m,await this.getDeltas(C,b,m,h=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(h,m)},f)}catch(C){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},C),this.close((0,t.normalizeError)(C))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(l)}}}processPendingOps(l){if(this._closed)return;(0,e.assert)(this.handler!==void 0,620);const f=this.pending.sort((b,C)=>b.sequenceNumber-C.sequenceNumber);this.pending=[],this.enqueueMessages(f,`${l}_pending`,!0),this.fetchReason===void 0&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(l){this.lastObservedSeqNumber<l&&(this.lastObservedSeqNumber=l)}}return d0.DeltaManager=c,d0}var pf={},gf={},Fz;function sge(){if(Fz)return gf;Fz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=gf&&gf.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(gf,"__esModule",{value:!0}),gf.DebugLogger=void 0;const n=Ht(),a=Ot(),t=e(fie()),{debug:i}=t.default;class r{static mixinDebugLogger(o,u,c){const d=i(o),l=i(o);return l.log=function(...f){d.enabled===!0?i.log(...f):console.error(...f)},l.enabled=!0,(0,a.createMultiSinkLogger)({namespace:o,loggers:[u,new r(d,l)],properties:c,tryInheritProperties:!0})}constructor(o,u){this.debug=o,this.debugErr=u}send(o){const u={...o},c=u.category==="error";let d=c?this.debugErr:this.debug;const l=o.eventName.lastIndexOf(a.eventNamespaceSeparator),f=o.eventName.slice(Math.max(0,l+1));l>0&&(d=d.extend(o.eventName.slice(0,l))),u.eventName=void 0;let b="";b=`tick=${(0,a.formatTick)((0,n.performanceNow)())}`;const C=u.stack??"";u.stack=void 0;let v;try{v=JSON.stringify(u)}catch{u.error=void 0,v=JSON.stringify(u)}v==="{}"&&(v=""),c&&(d.enabled=!0),d(`${f} ${v} ${b} ${C}`)}}return gf.DebugLogger=r,gf}var jz;function mx(){if(jz)return pf;jz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(pf,"__esModule",{value:!0}),pf.Loader=pf.RelativeLoader=void 0;const e=Mr(),n=Ot(),a=ys(),t=xie(),i=sge(),r=fx(),s=Kg();function o(d){if(d===void 0)throw new Error("Object is not a IResolveUrl.")}class u{constructor(l,f){this.container=l,this.loader=f}async resolve(l){if(l.url.startsWith("/"))return o(this.container.resolvedUrl),await this.container.clone({resolvedUrl:{...this.container.resolvedUrl},version:l.headers?.[e.LoaderHeader.version]??void 0,loadMode:l.headers?.[e.LoaderHeader.loadMode]},{canReconnect:l.headers?.[e.LoaderHeader.reconnect],clientDetailsOverride:l.headers?.[e.LoaderHeader.clientDetails]});if(this.loader===void 0)throw new Error("Cannot resolve external containers");return this.loader.resolve(l)}}pf.RelativeLoader=u;class c{constructor(l){const{urlResolver:f,documentServiceFactory:b,codeLoader:C,options:v,scope:m,logger:h,configProvider:g,protocolHandlerBuilder:_}=l,S={loaderId:(0,a.v4)(),loaderVersion:r.pkgVersion},p=(0,n.mixinMonitoringContext)(i.DebugLogger.mixinDebugLogger("fluid:telemetry",h,{all:S}),n.sessionStorageConfigProvider.value,g);this.services={urlResolver:f,documentServiceFactory:b,codeLoader:C,options:v??{},scope:v?.provideScopeLoader===!1?{...m}:{...m,ILoader:this},protocolHandlerBuilder:_,subLogger:p.logger},this.mc=(0,n.createChildMonitoringContext)({logger:this.services.subLogger,namespace:"Loader"})}async createDetachedContainer(l,f){return t.Container.createDetached({...f,...this.services},l)}async rehydrateDetachedContainerFromSnapshot(l,f){return t.Container.rehydrateDetachedFromSnapshot({...f,...this.services},l)}async resolve(l,f){const b=f===void 0?"Resolve":"ResolveWithPendingState";return n.PerformanceEvent.timedExecAsync(this.mc.logger,{eventName:b},async()=>this.resolveCore(l,(0,s.getAttachedContainerStateFromSerializedContainer)(f)))}async resolveCore(l,f){const b=await this.services.urlResolver.resolve(l);o(b);const C=(0,s.tryParseCompatibleResolvedUrl)(b.url);if(C===void 0)throw new Error(`Invalid URL ${b.url}`);if(f!==void 0){const v=(0,s.tryParseCompatibleResolvedUrl)(f.url);if(v?.id!==C.id||v?.path.replace(/\/$/,"")!==C.path.replace(/\/$/,"")){const m=`URL ${b.url} does not match pending state URL ${f.url}`;throw new Error(m)}}return l.headers??={},l.headers[e.LoaderHeader.version]=C.version??l.headers[e.LoaderHeader.version],this.loadContainer(l,b,f)}async loadContainer(l,f,b){return t.Container.load({resolvedUrl:f,version:l.headers?.[e.LoaderHeader.version]??void 0,loadMode:l.headers?.[e.LoaderHeader.loadMode],pendingLocalState:b},{canReconnect:l.headers?.[e.LoaderHeader.reconnect],clientDetailsOverride:l.headers?.[e.LoaderHeader.clientDetails],...this.services})}}return pf.Loader=c,pf}var yf={},Mz;function age(){if(Mz)return yf;Mz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(yf,"__esModule",{value:!0}),yf.createMemoryDetachedBlobStorage=yf.tryInitializeMemoryDetachedBlobStorage=void 0;const e=Ht(),n=Je();function a(i,r){(0,n.assert)(i.size===0,2462);const s=JSON.parse(r);(0,n.assert)(Array.isArray(s),2463),i.initialize(s)}yf.tryInitializeMemoryDetachedBlobStorage=a;function t(){const i=[];return{createBlob:async s=>({id:`${i.push(s)-1}`}),readBlob:async s=>i[Number(s)]??Promise.reject(new Error(`Blob not found: ${s}`)),get size(){return i.length},getBlobIds:()=>i.map((s,o)=>`${o}`),dispose:()=>i.splice(0),serialize:()=>i.length>0?JSON.stringify(i.map(s=>(0,e.bufferToString)(s,"utf8"))):void 0,initialize:s=>i.push(...s.map(o=>(0,e.stringToBuffer)(o,"utf8")))}}return yf.createMemoryDetachedBlobStorage=t,yf}var f0={},Nz;function oge(){if(Nz)return f0;Nz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(f0,"__esModule",{value:!0}),f0.NoopHeuristic=void 0;const e=Ht(),n=Je(),a=Kn(),t=2e3,i=50;class r extends e.TypedEventEmitter{constructor(o=t,u=i){super(),this.NoopCountFrequency=u,this.opsProcessedSinceOpSent=0,o!==Number.POSITIVE_INFINITY&&(this.timer=new n.Timer(o,()=>{this.opsProcessedSinceOpSent!==0&&this.emit("wantsNoop")}))}notifyMessageProcessed(o){(0,a.isRuntimeMessage)(o)&&(this.opsProcessedSinceOpSent++,this.opsProcessedSinceOpSent===this.NoopCountFrequency&&queueMicrotask(()=>{this.opsProcessedSinceOpSent>=this.NoopCountFrequency&&(this.emit("wantsNoop"),(0,n.assert)(this.opsProcessedSinceOpSent===0,579))}),this.timer!==void 0&&(this.opsProcessedSinceOpSent===1&&this.timer.restart(),(0,n.assert)(this.timer.hasTimer,578)))}notifyDisconnect(){this.opsProcessedSinceOpSent=0}notifyMessageSent(){this.opsProcessedSinceOpSent=0}}return f0.NoopHeuristic=r,f0}var h0={},Az;function cge(){if(Az)return h0;Az=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(h0,"__esModule",{value:!0}),h0.initQuorumValuesFromCodeDetails=void 0;function e(n){return[["code",{key:"code",value:n,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}return h0.initQuorumValuesFromCodeDetails=e,h0}var io={},Dz;function uge(){if(Dz)return io;Dz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(io,"__esModule",{value:!0}),io.fetchISnapshotTree=io.fetchISnapshot=io.getLatestSnapshotInfo=io.SerializedStateManager=void 0;const e=Ht(),n=Je(),a=on(),t=Kn(),i=Ot(),r=kie(),s=Kg();class o{constructor(b,C,v,m,h,g,_,S){if(this.pendingLocalState=b,this.storageAdapter=v,this._offlineLoadEnabled=m,this.containerDirty=g,this.supportGetSnapshotApi=_,this.processedOps=[],this.lastSavedOpSequenceNumber=0,this.snapshotRefreshTimeoutMs=3600*24*1e3,this.mc=(0,i.createChildMonitoringContext)({logger:C,namespace:"serializedStateManager"}),this.snapshotRefreshTimeoutMs=S??this.snapshotRefreshTimeoutMs,this.refreshTimer=new n.Timer(this.snapshotRefreshTimeoutMs,()=>this.tryRefreshSnapshot()),b&&b.savedOps.length>0){const p=b.savedOps.length;this.lastSavedOpSequenceNumber=b.savedOps[p-1].sequenceNumber}h.on("saved",()=>this.updateSnapshotAndProcessedOpsMaybe())}get offlineLoadEnabled(){return this._offlineLoadEnabled}get refreshSnapshotP(){return this._refreshSnapshotP}addProcessedOp(b){this.offlineLoadEnabled&&(this.processedOps.push(b),this.updateSnapshotAndProcessedOpsMaybe())}async fetchSnapshot(b){if(this.pendingLocalState===void 0){const{baseSnapshot:C,version:v}=await c(this.mc,this.storageAdapter,this.supportGetSnapshotApi(),b),m=(0,t.getSnapshotTree)(C);if(this.offlineLoadEnabled){const h=await(0,r.getBlobContentsFromTree)(C,this.storageAdapter),g=await(0,s.getDocumentAttributes)(this.storageAdapter,m);this.snapshot={baseSnapshot:m,snapshotBlobs:h,snapshotSequenceNumber:g.sequenceNumber},this.refreshTimer.start()}return{baseSnapshot:C,version:v}}else{const{baseSnapshot:C,snapshotBlobs:v}=this.pendingLocalState,m=await(0,s.getDocumentAttributes)(this.storageAdapter,C);this.snapshot={baseSnapshot:C,snapshotBlobs:v,snapshotSequenceNumber:m.sequenceNumber},this.tryRefreshSnapshot();const h=new Map;for(const[_,S]of Object.entries(v))h.set(_,(0,e.stringToBuffer)(S,"utf8"));return{baseSnapshot:{sequenceNumber:this.snapshot.snapshotSequenceNumber,snapshotTree:C,blobContents:h,latestSequenceNumber:void 0,ops:[],snapshotFormatV:1},version:void 0}}}tryRefreshSnapshot(){this.mc.config.getBoolean("Fluid.Container.enableOfflineSnapshotRefresh")===!0&&this._refreshSnapshotP===void 0&&this.latestSnapshot===void 0&&(this._refreshSnapshotP=this.refreshLatestSnapshot(this.supportGetSnapshotApi()),this._refreshSnapshotP.catch(b=>{this.mc.logger.sendTelemetryEvent({eventName:"RefreshLatestSnapshotFailed",error:b})}).finally(()=>{this._refreshSnapshotP=void 0}))}async refreshLatestSnapshot(b){this.latestSnapshot=await u(this.mc,this.storageAdapter,b);const C=Object.keys(this.storageAdapter.loadedGroupIdSnapshots);if(b&&C.length>0){(0,n.assert)(this.storageAdapter.getSnapshot!==void 0,2418);const v=await this.storageAdapter.getSnapshot({versionId:void 0,scenarioName:"getLatestSnapshotInfo",cacheSnapshot:!1,loadingGroupIds:C,fetchSource:a.FetchSource.noCache});(0,n.assert)(v!==void 0,2419)}return this.updateSnapshotAndProcessedOpsMaybe()}updateSnapshotAndProcessedOpsMaybe(){const b=this.latestSnapshot?.snapshotSequenceNumber;if(b===void 0||this.processedOps.length===0||this.processedOps[this.processedOps.length-1].sequenceNumber<this.lastSavedOpSequenceNumber||this.containerDirty())return-1;const C=this.processedOps[0].sequenceNumber,v=this.processedOps[this.processedOps.length-1].sequenceNumber;return b<C?(this.mc.logger.sendTelemetryEvent({eventName:"OldSnapshotFetchWhileRefreshing",snapshotSequenceNumber:b,firstProcessedOpSequenceNumber:C,lastProcessedOpSequenceNumber:v,stashedSnapshotSequenceNumber:this.snapshot?.snapshotSequenceNumber}),this.latestSnapshot=void 0,this.refreshTimer.restart()):b<=v&&(this.processedOps.splice(0,b-C+1),this.snapshot=this.latestSnapshot,this.latestSnapshot=void 0,this.refreshTimer.restart(),this.mc.logger.sendTelemetryEvent({eventName:"SnapshotRefreshed",snapshotSequenceNumber:b,firstProcessedOpSequenceNumber:C,newFirstProcessedOpSequenceNumber:this.processedOps.length===0?void 0:this.processedOps[0].sequenceNumber})),b}setInitialSnapshot(b){if(this.offlineLoadEnabled){(0,n.assert)(this.snapshot===void 0,2359),(0,n.assert)(b!==void 0,2360);const{baseSnapshot:C,snapshotBlobs:v}=b,m=".protocol"in C.trees?C.trees[".protocol"].blobs.attributes:C.blobs[".attributes"],h=JSON.parse(v[m]);(0,n.assert)(h.sequenceNumber===0,2361),this.snapshot={...b,snapshotSequenceNumber:h.sequenceNumber},this.refreshTimer.start()}}async getPendingLocalState(b,C,v){return i.PerformanceEvent.timedExecAsync(this.mc.logger,{eventName:"getPendingLocalState",details:{notifyImminentClosure:!1,sessionExpiryTimerStarted:void 0,snapshotSequenceNumber:void 0,processedOpsSize:this.processedOps.length},clientId:b},async()=>{if(!this.offlineLoadEnabled)throw new i.UsageError("Can't get pending local state unless offline load is enabled");(0,n.assert)(this.snapshot!==void 0,2277);const m=await C.getPendingLocalState({notifyImminentClosure:!1,snapshotSequenceNumber:this.snapshot.snapshotSequenceNumber,sessionExpiryTimerStarted:this.snapshot.snapshotFetchedTime}),h={};let g=!1;const _=Object.entries(this.storageAdapter.loadedGroupIdSnapshots);if(_.length>0)for(const[p,w]of _)g=!0,h[p]=(0,s.convertSnapshotToSnapshotInfo)(w);const S={attached:!0,pendingRuntimeState:m,baseSnapshot:this.snapshot.baseSnapshot,snapshotBlobs:this.snapshot.snapshotBlobs,loadedGroupIdSnapshots:g?h:void 0,savedOps:this.processedOps,url:v.url,clientId:b};return JSON.stringify(S)})}}io.SerializedStateManager=o;async function u(f,b,C){return i.PerformanceEvent.timedExecAsync(f.logger,{eventName:"GetLatestSnapshotInfo"},async()=>{const v=await b.getVersions(null,1,"getLatestSnapshotInfo",a.FetchSource.noCache),{baseSnapshot:m}=await c(f,b,C,v[0]?.id),h=(0,t.getSnapshotTree)(m),g=Date.now(),_=await(0,r.getBlobContentsFromTree)(m,b),p=(await(0,s.getDocumentAttributes)(b,h)).sequenceNumber;return{baseSnapshot:h,snapshotBlobs:_,snapshotSequenceNumber:p,snapshotFetchedTime:g}}).catch(()=>{})}io.getLatestSnapshotInfo=u;async function c(f,b,C,v){const{snapshot:m,version:h}=C?await d(f,b,v):await l(f,b,v);return(0,n.assert)(m!==void 0,2276),{baseSnapshot:m,version:h}}async function d(f,b,C){const v=await b.getSnapshot?.({versionId:C}),m=v?.snapshotTree.id===void 0?void 0:{id:v.snapshotTree.id,treeId:v.snapshotTree.id};return v===void 0&&C!==void 0?f.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:C}):v!==void 0&&m?.id===void 0&&f.logger.sendErrorEvent({eventName:"getSnapshotFetchedTreeWithoutVersionId",hasVersion:m!==void 0}),{snapshot:v,version:m}}io.fetchISnapshot=d;async function l(f,b,C){const m=(await b.getVersions(C??null,1))[0];m===void 0&&C!==void 0&&f.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:C});const h=await b.getSnapshotTree(m)??void 0;return h===void 0&&m!==void 0?f.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:m.id}):h!==void 0&&m?.id===void 0&&f.logger.sendErrorEvent({eventName:"getSnapshotFetchedTreeWithoutVersionId",hasVersion:m!==void 0}),{snapshot:h,version:m}}return io.fetchISnapshotTree=l,io}var kz;function xie(){if(kz)return to;kz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=to&&to.__importDefault||function(pe){return pe&&pe.__esModule?pe:{default:pe}};Object.defineProperty(to,"__esModule",{value:!0}),to.Container=to.ReportIfTooLong=to.waitContainerToCatchUp=void 0;const n=Ht(),a=Mr(),t=Mr(),i=hd(),r=Je(),s=on(),o=on(),u=Kn(),c=Ot(),d=e(jie()),l=ys(),f=Gpe(),b=Wpe(),C=Ype(),v=sx(),m=Zpe(),h=ege(),g=kie(),_=Mie(),S=ige(),p=mx(),w=hx(),O=age(),E=oge(),F=fx(),R=Die(),M=cge(),j=uge(),k=Kg(),x=0,L="dirty",V="saved",G="Code package does not implement IRuntimeFactory";async function ee(pe){if(pe.closed)throw new c.UsageError("waitContainerToCatchUp: Container closed");return new Promise((de,ge)=>{const Ce=pe.deltaManager,Fe=lt=>{pe.off("closed",Fe);const ut="Container closed while waiting to catch up";ge(lt===void 0?new c.GenericError(ut):(0,c.wrapError)(lt,pt=>new c.GenericError(`${ut}: ${pt}`)))};pe.on("closed",Fe);const We=()=>{(0,r.assert)(pe.connectionState===v.ConnectionState.CatchingUp||pe.connectionState===v.ConnectionState.Connected,205);const lt=Ce.hasCheckpointSequenceNumber,ut=Ce.lastKnownSeqNumber;if((0,r.assert)(Ce.lastSequenceNumber<=ut,614),Ce.lastSequenceNumber===ut){pe.off("closed",Fe),de(lt);return}const pt=Nt=>{ut<=Nt.sequenceNumber&&(pe.off("closed",Fe),de(lt),Ce.off("op",pt))};Ce.on("op",pt)};if(pe.connectionState===v.ConnectionState.Connected){We();return}const Ze=()=>{pe.off(c.connectedEventName,Ze),We()};pe.on(c.connectedEventName,Ze),pe.connectionState===v.ConnectionState.Disconnected&&pe.connect()})}to.waitContainerToCatchUp=ee;const se=pe=>pe.get("code")??pe.get("code2");async function re(pe,de,ge){const Ce=c.PerformanceEvent.start(pe,{eventName:de}),Fe=await ge();Ce.duration>200&&Ce.end(Fe)}to.ReportIfTooLong=re;const fe="summarizer";class oe extends c.EventEmitterWithErrorHandling{static async load(de,ge){const{version:Ce,pendingLocalState:Fe,loadMode:We,resolvedUrl:Ze}=de,lt=new oe(ge,de);return c.PerformanceEvent.timedExecAsync(lt.mc.logger,{eventName:"Load",...We},async ut=>new Promise((pt,Nt)=>{const Ke={opsBeforeReturn:"cached"},Ge=Fe?{...We??Ke,opsBeforeReturn:void 0}:We??Ke,Re=Qe=>{Nt(Qe??new c.GenericError("Container closed without error during load"))};lt.on("closed",Re),lt.load(Ce,Ge,Ze,Fe).finally(()=>{lt.removeListener("closed",Re)}).then(Qe=>{ut.end({...Qe}),pt(lt)},Qe=>{const Y=(0,c.normalizeError)(Qe);lt.close(Y),lt.dispose(Y),Re(Y)})}),{start:!0,end:!0,cancel:"generic"})}static async createDetached(de,ge){const Ce=new oe(de);return c.PerformanceEvent.timedExecAsync(Ce.mc.logger,{eventName:"CreateDetached"},async Fe=>(await Ce.createDetached(ge),Ce),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(de,ge){const Ce=new oe(de);return c.PerformanceEvent.timedExecAsync(Ce.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},async Fe=>{const We=(0,k.getDetachedContainerStateFromSerializedContainer)(ge);return await Ce.rehydrateDetachedFromSnapshot(We),Ce},{start:!0,end:!0,cancel:"generic"})}setLoaded(){if(this._lifecycleState==="loading"){this._lifecycleState="loaded",(0,r.assert)(this.connectionState!==v.ConnectionState.Connected,2409),this.connectionStateHandler.initProtocol(this.protocolHandler);const de=this.readOnlyInfo.readonly??!1;this.setContextConnectedState(!1,de);const ge=this._deltaManager.connectionManager;if(ge.connected){const Ce=ge.connectionDetails;(0,r.assert)(Ce!==void 0,2410),this.connectionStateHandler.receivedConnectEvent(Ce)}}}get closed(){return this._lifecycleState==="closing"||this._lifecycleState==="closed"||this.disposed}get loaded(){return this._lifecycleState==="loaded"}get disposed(){return this._lifecycleState==="disposing"||this._lifecycleState==="disposed"}get runtime(){if(this._runtime===void 0)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get protocolHandler(){if(this._protocolHandler===void 0)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get resolvedUrl(){return this.service?.resolvedUrl}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get containerMetadata(){return this._containerMetadata}forceReadonly(de){this._deltaManager.connectionManager.forceReadonly(de)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connectionState===v.ConnectionState.Connected}get clientId(){return this.protocolHandler.audience.getSelf()?.clientId}get isInteractiveClient(){return this.deltaManager.clientDetails.capabilities.interactive}supportGetSnapshotApi(){return this.mc.config.getBoolean("Fluid.Container.UseLoadingGroupIdForSnapshotFetch2")===!0&&this.service?.policies?.supportGetSnapshotApi===!0}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){return this._loadedCodeDetails}get audience(){return this.protocolHandler.audience}get isDirty(){return this._dirtyContainer}async getEntryPoint(){if(this._disposed)throw new c.UsageError("The context is already disposed");return this._runtime!==void 0?this._runtime.getEntryPoint?.():new Promise((de,ge)=>{const Ce=()=>{(0,r.assert)(this._runtime!==void 0,1443),de(this._runtime.getEntryPoint?.()),this._lifecycleEvents.off("disposed",Fe)},Fe=()=>{ge(new Error("ContainerContext was disposed")),this._lifecycleEvents.off("runtimeInstantiated",Ce)};this._lifecycleEvents.once("runtimeInstantiated",Ce),this._lifecycleEvents.once("disposed",Fe)})}constructor(de,ge){super((xe,Oe)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:typeof xe=="string"?xe:void 0},Oe),this.close((0,c.normalizeError)(Oe))}),this._lifecycleState="loading",this.inboundQueuePausedFromInit=!0,this.connectionCount=0,this.connectionTransitionTimes=[],this._dirtyContainer=!1,this.attachmentData={state:a.AttachState.Detached},this.clientsWhoShouldHaveLeft=new Set,this._containerMetadata={},this.setAutoReconnectTime=(0,n.performanceNow)(),this._lifecycleEvents=new n.TypedEventEmitter,this.verifyClosedAfterCalls=0,this._disposed=!1,this.attach=(0,k.runSingle)(async(xe,Oe)=>{await c.PerformanceEvent.timedExecAsync(this.mc.logger,{eventName:"Attach"},async()=>{if(this._lifecycleState!=="loaded"||this.attachmentData.state===a.AttachState.Attached)throw new c.UsageError(`The Container is not in a valid state for attach [${this._lifecycleState}] and [${this.attachState}]`);const He=Ue=>{const Pe=(0,c.normalizeError)(Ue);return this.close(Pe),Pe.addTelemetryProperties({resolvedUrl:this.service?.resolvedUrl?.url}),Pe},Se=Ue=>{const Pe=this.attachmentData.state;this.attachmentData=Ue;const Ye=this.attachmentData.state;if(Ye!==Pe&&Ye!==a.AttachState.Detached)try{this.runtime.setAttachState(Ye),this.emit(Ye.toLocaleLowerCase())}catch(ke){throw He(ke)}},Ve=Ue=>{try{return(0,r.assert)(this._deltaManager.inbound.length===0,214),(0,k.combineAppAndProtocolSummary)(this.runtime.createSummary(Ue),this.captureProtocolSummary())}catch(Pe){throw He(Pe)}},ot=async Ue=>{if(this.service===void 0){const Pe=await this.urlResolver.resolve(xe);(0,r.assert)(this.client.details.type!==fe&&Pe!==void 0,708),this.service=await this.createDocumentService(Pe,{mode:"attach",summary:Ue})}return this.storageAdapter.connectToService(this.service),this.storageAdapter};let mt=(0,f.runRetriableAttachProcess)({initialAttachmentData:this.attachmentData,offlineLoadEnabled:this.serializedStateManager.offlineLoadEnabled,detachedBlobStorage:this.detachedBlobStorage,setAttachmentData:Se,createAttachmentSummary:Ve,createOrGetStorageService:ot});this.mc.config.getBoolean("Fluid.Container.RetryOnAttachFailure")!==!0&&(mt=mt.catch(Ue=>{throw He(Ue)}));const he=await mt;this.serializedStateManager.setInitialSnapshot(he),this.closed||(this.detachedBlobStorage?.dispose?.(),this.handleDeltaConnectionArg(Oe?.deltaConnection,{fetchOpsFromStorage:!1,reason:{text:"createDetached"}}))},{start:!0,end:!0,cancel:"generic"})}),this.getAbsoluteUrl=async xe=>{if(this.resolvedUrl!==void 0)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,xe,(0,_.getPackageName)(this._loadedCodeDetails))},this.metadataUpdateHandler=xe=>{this._containerMetadata={...this._containerMetadata,...xe},this.emit("metadataUpdate",xe)},this.updateDirtyContainerState=xe=>{this._dirtyContainer!==xe&&(this._dirtyContainer=xe,this.emit(xe?L:V))};const{canReconnect:Ce,clientDetailsOverride:Fe,urlResolver:We,documentServiceFactory:Ze,codeLoader:lt,options:ut,scope:pt,subLogger:Nt,protocolHandlerBuilder:Ke,retryConnectionTimeoutMs:Ge}=de,Re=Ze;(0,w.validateDriverCompatibility)(Re.ILayerCompatDetails,xe=>{}),this.connectionTransitionTimes[v.ConnectionState.Disconnected]=(0,n.performanceNow)();const Qe=ge?.pendingLocalState;this._canReconnect=Ce??!0,this._retryConnectionTimeoutMs=Ge,this.clientDetailsOverride=Fe,this.urlResolver=We,this.serviceFactory=Ze,this.codeLoader=lt,this.options={...ut},this.scope=pt,this.protocolHandlerBuilder=Ke??((xe,Oe,He)=>new R.ProtocolHandler(xe,Oe,He,new b.Audience,Se=>this.clientsWhoShouldHaveLeft.has(Se))),this.clone=async(xe,Oe)=>oe.load(xe,{...de,...Oe}),this._containerId=(0,l.v4)(),this.client=oe.setupClient(this._containerId,ut.client,this.clientDetailsOverride);const Y=this.client.details.type,Me=this.client.details.capabilities.interactive,K=`${Me?"interactive":"noninteractive"}${Y!==void 0&&Y!==""?`/${Y}`:""}`;this.subLogger=(0,c.createChildLogger)({logger:Nt,properties:{all:{clientType:K,containerId:this._containerId,docId:()=>this.resolvedUrl?.id,containerAttachState:()=>this.attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>v.ConnectionState[this.connectionState],serializedContainer:Qe!==void 0},error:{dmInitialSeqNumber:()=>this._deltaManager?.initialSequenceNumber,dmLastProcessedSeqNumber:()=>this._deltaManager?.lastSequenceNumber,dmLastKnownSeqNumber:()=>this._deltaManager?.lastKnownSeqNumber,containerLoadedFromVersionId:()=>this._loadedFromVersion?.id,containerLoadedFromVersionDate:()=>this._loadedFromVersion?.date,dmLastMsqSeqNumber:()=>this.deltaManager?.lastMessage?.sequenceNumber,dmLastMsqSeqTimestamp:()=>this.deltaManager?.lastMessage?.timestamp,dmLastMsqSeqClientId:()=>this.deltaManager?.lastMessage?.clientId===null?"null":this.deltaManager?.lastMessage?.clientId,dmLastMsgClientSeq:()=>this.deltaManager?.lastMessage?.clientSequenceNumber,connectionStateDuration:()=>(0,n.performanceNow)()-this.connectionTransitionTimes[this.connectionState]}}}),this.mc=(0,c.createChildMonitoringContext)({logger:this.subLogger,namespace:"Container"}),this._deltaManager=this.createDeltaManager(),this.connectionStateHandler=(0,m.createConnectionStateHandler)({logger:this.mc.logger,mc:(0,c.loggerToMonitoringContext)(Nt),connectionStateChanged:(xe,Oe,He)=>{this.logConnectionStateChangeTelemetry(xe,Oe,He),this.loaded&&this.propagateConnectionState(xe===v.ConnectionState.Disconnected?He:void 0)},shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:ut.maxClientLeaveWaitTime,logConnectionIssue:(xe,Oe,He)=>{const Se=this.connectionMode;if(this._deltaManager.logConnectionIssue({eventName:xe,mode:Se,category:this._lifecycleState==="loading"?"generic":Oe,duration:(0,n.performanceNow)()-this.connectionTransitionTimes[v.ConnectionState.CatchingUp],...He===void 0?{}:{details:JSON.stringify(He)}}),(0,r.assert)(this.loaded,2411),Se==="read"&&Oe==="error"){const Ve={text:"NoJoinSignal"};this.disconnectInternal(Ve),this.connectInternal({reason:Ve,fetchOpsFromStorage:!1})}},clientShouldHaveLeft:xe=>{this.clientsWhoShouldHaveLeft.add(xe)},onCriticalError:xe=>{this.close((0,c.normalizeError)(xe))}},this.deltaManager,Qe?.clientId),this.on(V,()=>{this.connectionStateHandler.containerSaved()});const Z=xe=>(0,u.isCombinedAppAndProtocolSummary)(xe)===!0?xe:(0,k.combineAppAndProtocolSummary)(xe,this.captureProtocolSummary()),me=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree2");this.detachedBlobStorage=this.attachState===a.AttachState.Attached?void 0:(0,O.createMemoryDetachedBlobStorage)(),this.storageAdapter=new g.ContainerStorageAdapter(this.detachedBlobStorage,this.mc.logger,Qe?.snapshotBlobs,Qe?.loadedGroupIdSnapshots,Z,me);const we=(this.isInteractiveClient&&this.mc.config.getBoolean("Fluid.Container.enableOfflineLoad"))??ut.enableOfflineLoad===!0;this.serializedStateManager=new j.SerializedStateManager(Qe,this.subLogger,this.storageAdapter,we,this,()=>this._deltaManager.connectionManager.shouldJoinWrite(),()=>this.supportGetSnapshotApi(),this.mc.config.getNumber("Fluid.Container.snapshotRefreshTimeoutMs")),typeof document=="object"&&document!==null&&typeof document.addEventListener=="function"&&document.addEventListener!==null&&Me&&(this.lastVisible=document.hidden?(0,n.performanceNow)():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=(0,n.performanceNow)():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler))}getQuorum(){return this.protocolHandler.quorum}dispose(de){this.verifyClosedAfter(()=>this._deltaManager.dispose(de))}close(de){this.verifyClosedAfter(()=>this._deltaManager.close(de))}verifyClosedAfter(de){this.verifyClosedAfterCalls++;try{de()}finally{this.verifyClosedAfterCalls--}this.verifyClosedAfterCalls===0&&((0,r.assert)(this.connectionState===v.ConnectionState.Disconnected,207),(0,r.assert)(this._lifecycleState==="closed"||this._lifecycleState==="disposed",788))}closeCore(de){(0,r.assert)(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:this._lifecycleState!=="loading"&&de!==void 0?"error":"generic"},de),this._lifecycleState="closing",this.service?.off!==void 0&&this.service?.off("metadataUpdate",this.metadataUpdateHandler),this._protocolHandler?.close(),this.connectionStateHandler.dispose()}catch(ge){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},ge)}this.emit("closed",de),this.visibilityEventHandler!==void 0&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed",this.client.details.type===fe&&this.dispose(de)}}disposeCore(de){(0,r.assert)(!this._disposed,1356),this._disposed=!0;try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerDispose",category:!this.closed&&de!==void 0?"error":"generic"},de),this._lifecycleState!=="closed"&&(this._lifecycleState="disposing"),this._protocolHandler?.close(),this.connectionStateHandler.dispose();const ge=de===void 0?void 0:new Error(de.message);this._runtime?.dispose(ge),this.storageAdapter.dispose(),this.service?.dispose(de)}catch(ge){this.mc.logger.sendErrorEvent({eventName:"ContainerDisposeException"},ge)}this.emit("disposed",de),this.removeAllListeners(),this.visibilityEventHandler!==void 0&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="disposed",this._lifecycleEvents.emit("disposed")}}async getPendingLocalState(){if(this.closed||this._disposed)throw new c.UsageError("Pending state cannot be retried if the container is closed or disposed");return(0,r.assert)(this.attachmentData.state===a.AttachState.Attached,209),(0,r.assert)(this.resolvedUrl!==void 0&&this.resolvedUrl.type==="fluid",210),await this.serializedStateManager.getPendingLocalState(this.clientId,this.runtime,this.resolvedUrl)}get attachState(){return this.attachmentData.state}serialize(){if(this.attachmentData.state===a.AttachState.Attached||this.closed)throw new c.UsageError("Container must not be attached or closed.");const de=this.attachmentData.state===a.AttachState.Attaching?this.attachmentData:void 0,ge=de?.summary??(0,k.combineAppAndProtocolSummary)(this.runtime.createSummary(),this.captureProtocolSummary()),{baseSnapshot:Ce,snapshotBlobs:Fe}=(0,k.getSnapshotTreeAndBlobsFromSerializedContainer)(ge),We=de===void 0?void 0:this.runtime.getPendingLocalState();(0,r.assert)(!(0,r.isPromiseLike)(We),2275);const Ze={attached:!1,baseSnapshot:Ce,snapshotBlobs:Fe,pendingRuntimeState:We,hasAttachmentBlobs:this.detachedBlobStorage!==void 0&&this.detachedBlobStorage.size>0,attachmentBlobs:this.detachedBlobStorage?.serialize()};return JSON.stringify(Ze)}setAutoReconnectInternal(de,ge){if(this._deltaManager.connectionManager.reconnectMode===de)return;const Fe=(0,n.performanceNow)(),We=Fe-this.setAutoReconnectTime;this.setAutoReconnectTime=Fe,this.mc.logger.sendTelemetryEvent({eventName:de===_.ReconnectMode.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:v.ConnectionState[this.connectionState],duration:We}),this._deltaManager.connectionManager.setAutoReconnect(de,ge)}connect(){if(this.closed)throw new c.UsageError("The Container is closed and cannot be connected");if(this.attachState!==a.AttachState.Attached)throw new c.UsageError("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:{text:"DocumentConnect"},fetchOpsFromStorage:!1})}connectInternal(de){(0,r.assert)(!this.closed,709),(0,r.assert)(this.attachState===a.AttachState.Attached,710);const ge=_.ReconnectMode.Enabled;this.setAutoReconnectInternal(ge,de.reason),this.resumeInternal(de)}disconnect(){if(this.closed)throw new c.UsageError("The Container is closed and cannot be disconnected");this.disconnectInternal({text:"DocumentDisconnect"})}disconnectInternal(de){(0,r.assert)(!this.closed,711);const ge=_.ReconnectMode.Disabled;this.setAutoReconnectInternal(ge,de)}resumeInternal(de){(0,r.assert)(!this.closed,217),this.inboundQueuePausedFromInit&&((0,r.assert)(this.loaded,2412),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(de)}async proposeCodeDetails(de){if(!(0,t.isFluidCodeDetails)(de))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const ge=await this.codeLoader.IFluidCodeDetailsComparer.compare(de,this.getCodeDetailsFromQuorum());if(ge!==void 0&&ge<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",de).then(()=>!0).catch(()=>!1)}async processCodeProposal(){const de=this.getCodeDetailsFromQuorum();if(await Promise.all([this._deltaManager.inbound.pause(),this._deltaManager.inboundSignal.pause()]),await this.satisfies(de)===!0){this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();return}const ge=new c.GenericError("Existing context does not satisfy incoming proposal");this.close(ge)}async satisfies(de){if(this._loadedModule===void 0)return!1;const ge=[],Ce=this.codeLoader;Ce.IFluidCodeDetailsComparer!==void 0&&ge.push(Ce.IFluidCodeDetailsComparer);const Fe=this._loadedModule?.module.fluidExport;if(Fe?.IFluidCodeDetailsComparer!==void 0&&ge.push(Fe.IFluidCodeDetailsComparer),ge.length===0)return!1;for(const We of ge)if(await We.satisfies(this._loadedModule?.details,de)===!1)return!1;return!0}connectToDeltaStream(de){(!this._canReconnect||!this.client.details.capabilities.interactive)&&(de.mode="write"),this._deltaManager.connect(de)}async createDocumentService(de,ge){let Ce;return ge.mode==="load"?(Ce=await this.serviceFactory.createDocumentService(de,this.subLogger,this.client.details.type===fe),Ce.on!==void 0&&Ce.on("metadataUpdate",this.metadataUpdateHandler)):Ce=await(0,u.runWithRetry)(async()=>this.serviceFactory.createContainer(ge.summary,de,this.subLogger,!1),"containerAttach",this.mc.logger,{cancel:this._deltaManager.closeAbortController.signal}),Ce}async load(de,ge,Ce,Fe){const We={phase1:(0,n.performanceNow)()};this.service=await this.createDocumentService(Ce,{mode:"load"});const Ze=this.mc.config.getBoolean("Fluid.Container.ForceWriteConnection")===!0||(Fe?.savedOps.length??0)>0?"write":"read",lt={reason:{text:"DocumentOpen"},mode:Ze,fetchOpsFromStorage:!1};ge.deltaConnection===void 0&&this.connectToDeltaStream(lt),this.storageAdapter.connectToService(this.service),this.attachmentData={state:a.AttachState.Attached},We.phase2=(0,n.performanceNow)();const{baseSnapshot:ut,version:pt}=await this.serializedStateManager.fetchSnapshot(de),Nt=(0,u.getSnapshotTree)(ut);this._loadedFromVersion=pt;const Ke=await(0,k.getDocumentAttributes)(this.storageAdapter,Nt),Ge=Fe?.savedOps[Fe.savedOps.length-1]?.sequenceNumber??Ke.sequenceNumber;let Re;switch(ge.opsBeforeReturn){case void 0:{this.attachDeltaManagerOpHandler(Ke,ge.deltaConnection==="none"?"none":"all",Ge);break}case"cached":case"all":{Re=this.attachDeltaManagerOpHandler(Ke,ge.opsBeforeReturn,Ge);break}default:(0,r.unreachableCase)(ge.opsBeforeReturn)}await this.initializeProtocolStateFromSnapshot(Ke,this.storageAdapter,Nt),(0,r.assert)(this.clientId===void 0,2413),Fe?.clientId!==void 0&&this.protocolHandler.audience.setCurrentClientId(Fe?.clientId),We.phase3=(0,n.performanceNow)();const Qe=this.getCodeDetailsFromQuorum();if(await this.instantiateRuntime(Qe,Nt,Fe?Fe?.pendingRuntimeState??{}:void 0,(0,u.isInstanceOfISnapshot)(ut)?ut:void 0),Fe){for(const Y of Fe.savedOps)this.processRemoteMessage({...Y,metadata:{...Y.metadata,savedOp:!0}}),await this.runtime.notifyOpReplay?.(Y);Fe.savedOps=[],this.storageAdapter.clearPendingState()}if(this.closed||(Re!==void 0&&(this._deltaManager.inbound.resume(),await c.PerformanceEvent.timedExecAsync(this.mc.logger,{eventName:"WaitOps"},async()=>Re),await c.PerformanceEvent.timedExecAsync(this.mc.logger,{eventName:"WaitOpProcessing"},async()=>this._deltaManager.inbound.waitTillProcessingDone()),this._deltaManager.inbound.pause()),this.setLoaded(),this.handleDeltaConnectionArg(ge.deltaConnection)),this.closed)throw new Error("Container was closed while load()");return We.end=(0,n.performanceNow)(),this.subLogger.sendTelemetryEvent({eventName:"LoadStagesTimings",details:JSON.stringify(We)},void 0,i.LogLevel.verbose),{sequenceNumber:Ke.sequenceNumber,version:pt?.id,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(de){const ge={sequenceNumber:x,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(ge);const Ce=(0,M.initQuorumValuesFromCodeDetails)(de);this.initializeProtocolState(ge,{members:[],proposals:[],values:Ce}),await this.instantiateRuntime(de,void 0),this.setLoaded()}async rehydrateDetachedFromSnapshot({baseSnapshot:de,snapshotBlobs:ge,hasAttachmentBlobs:Ce,attachmentBlobs:Fe,pendingRuntimeState:We}){Ce&&(Fe!==void 0&&((0,r.assert)(this.detachedBlobStorage!==void 0,2958),(0,O.tryInitializeMemoryDetachedBlobStorage)(this.detachedBlobStorage,Fe)),(0,r.assert)(this.detachedBlobStorage!==void 0&&this.detachedBlobStorage.size>0,592));const Ze=(0,k.combineSnapshotTreeAndSnapshotBlobs)(de,ge);this.storageAdapter.loadSnapshotFromSnapshotBlobs(ge);const lt=await(0,k.getDocumentAttributes)(this.storageAdapter,Ze);await this.attachDeltaManagerOpHandler(lt);const ut=(0,k.getProtocolSnapshotTree)(Ze),pt=await(0,u.readAndParse)(this.storageAdapter,ut.blobs.quorumValues);this.initializeProtocolState(lt,{members:[],proposals:[],values:pt});const Nt=this.getCodeDetailsFromQuorum();await this.instantiateRuntime(Nt,Ze,We),this.setLoaded()}async initializeProtocolStateFromSnapshot(de,ge,Ce){const Fe={members:[],proposals:[],values:[]};if(Ce!==void 0){const We=(0,k.getProtocolSnapshotTree)(Ce);[Fe.members,Fe.proposals,Fe.values]=await Promise.all([(0,u.readAndParse)(ge,We.blobs.quorumMembers),(0,u.readAndParse)(ge,We.blobs.quorumProposals),(0,u.readAndParse)(ge,We.blobs.quorumValues)])}this.initializeProtocolState(de,Fe)}initializeProtocolState(de,ge){const Ce=this.protocolHandlerBuilder(de,ge,(We,Ze)=>this.submitMessage(o.MessageType.Propose,JSON.stringify({key:We,value:Ze}))),Fe=(0,c.createChildLogger)({logger:this.subLogger,namespace:"ProtocolHandler"});Ce.quorum.on("error",We=>{Fe.sendErrorEvent(We)}),Ce.quorum.on("addProposal",We=>{(We.key==="code"||We.key==="code2")&&this.emit("codeDetailsProposed",We.value,We)}),Ce.quorum.on("approveProposal",(We,Ze,lt)=>{(Ze==="code"||Ze==="code2")&&((0,t.isFluidCodeDetails)(lt)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch(ut=>{const pt=(0,c.normalizeError)(ut);throw this.close(pt),ut}))}),this._protocolHandler=Ce}captureProtocolSummary(){const de=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:s.SummaryType.Blob},quorumMembers:{content:JSON.stringify(de.members),type:s.SummaryType.Blob},quorumProposals:{content:JSON.stringify(de.proposals),type:s.SummaryType.Blob},quorumValues:{content:JSON.stringify(de.values),type:s.SummaryType.Blob}},type:s.SummaryType.Tree}}getCodeDetailsFromQuorum(){const de=this.protocolHandler.quorum;return se(de)}static setupClient(de,ge,Ce){const Fe=ge===void 0?{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}}:(0,d.default)(ge);return Ce!==void 0&&(Fe.details={...Fe.details,...Ce,capabilities:{...Fe.details.capabilities,...Ce?.capabilities}}),Fe.details.environment=[Fe.details.environment,` loaderVersion:${F.pkgVersion}`,` containerId:${de}`].join(";"),Fe}activeConnection(){return this.connectionState===v.ConnectionState.Connected&&this.connectionMode==="write"}createDeltaManager(){const de=()=>this.service,ge=new S.DeltaManager(de,(0,c.createChildLogger)({logger:this.subLogger,namespace:"DeltaManager"}),()=>this.activeConnection(),Ce=>new C.ConnectionManager(de,()=>this.isDirty,this.client,this._canReconnect,(0,c.createChildLogger)({logger:this.subLogger,namespace:"ConnectionManager"}),Ce,this._retryConnectionTimeoutMs));return ge.inbound.pause(),ge.inboundSignal.pause(),ge.on("connect",(Ce,Fe)=>{(0,r.assert)(this.connectionMode===Ce.mode,1207),this.loaded&&this.connectionStateHandler.receivedConnectEvent(Ce)}),ge.on("establishingConnection",Ce=>{this.connectionStateHandler.establishingConnection(Ce)}),ge.on("cancelEstablishingConnection",Ce=>{this.connectionStateHandler.cancelEstablishingConnection(Ce)}),ge.on("disconnect",(Ce,Fe)=>{this.noopHeuristic?.notifyDisconnect();const We={text:Ce,error:Fe};this.loaded?this.connectionStateHandler.receivedDisconnectEvent(We):this.closed||this.connectionStateHandler.cancelEstablishingConnection(We)}),ge.on("throttled",Ce=>{const Fe=Ce;Fe.logged!==!0&&this.mc.logger.sendTelemetryEvent({eventName:"ContainerWarning"},Fe),this.emit("warning",Fe)}),ge.on("readonly",Ce=>{this.loaded&&this.setContextConnectedState(this.connectionState===v.ConnectionState.Connected,Ce),this.emit("readonly",Ce)}),ge.on("closed",Ce=>{this.closeCore(Ce)}),ge.on("disposed",Ce=>{this.disposeCore(Ce)}),ge}async attachDeltaManagerOpHandler(de,ge,Ce){return this._deltaManager.attachOpHandler(de.minimumSequenceNumber,de.sequenceNumber,{process:Fe=>this.processRemoteMessage(Fe),processSignal:Fe=>{this.processSignal(Fe)}},ge,Ce)}logConnectionStateChangeTelemetry(de,ge,Ce){const Fe=(0,n.performanceNow)();this.connectionTransitionTimes[de]=Fe;const We=Fe-this.connectionTransitionTimes[ge];let Ze,lt,ut,pt;de===v.ConnectionState.Disconnected?lt=this._deltaManager.connectionManager.reconnectMode:de===v.ConnectionState.Connected?(Ze=Fe-this.connectionTransitionTimes[v.ConnectionState.Disconnected],Ze=(0,c.formatTick)(Ze)):de===v.ConnectionState.CatchingUp&&(ut=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&this.loaded&&(pt=ut-this.deltaManager.lastSequenceNumber)),this.mc.logger.sendPerformanceEvent({eventName:`ConnectionStateChange_${v.ConnectionState[de]}`,from:v.ConnectionState[ge],duration:We,durationFromDisconnected:Ze,reason:Ce?.text,connectionCount:this.connectionCount,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.connectionStateHandler.clientId,autoReconnect:lt,opsBehind:pt,online:u.OnlineStatus[(0,u.isOnline)()],lastVisible:this.lastVisible===void 0?void 0:(0,n.performanceNow)()-this.lastVisible,checkpointSequenceNumber:ut,quorumSize:this._protocolHandler?.quorum.getMembers().size,audienceSize:this._protocolHandler?.audience.getMembers().size,isDirty:this.isDirty,...this._deltaManager.connectionProps},Ce?.error),de===v.ConnectionState.Connected&&this.connectionCount++}propagateConnectionState(de){const ge=this.connectionState===v.ConnectionState.Connected;if(ge){const Ce=this.connectionStateHandler.clientId;(0,r.assert)(Ce!==void 0,2414),this.protocolHandler.audience.setCurrentClientId(Ce)}this.connectionState!==v.ConnectionState.Connected&&this.connectionState!==v.ConnectionState.Disconnected||(this.setContextConnectedState(ge,this.readOnlyInfo.readonly??!1),this.protocolHandler.setConnectionState(ge,this.clientId),(0,c.raiseConnectedEvent)(this.mc.logger,this,ge,this.clientId,de?.text))}submitContainerMessage(de,ge,Ce,Fe){switch(de){case o.MessageType.Operation:return this.submitMessage(de,JSON.stringify(ge),Ce,Fe);case o.MessageType.Summarize:return this.submitSummaryMessage(ge);default:{const We=new c.GenericError("invalidContainerSubmitOpType",void 0,{messageType:de});return this.close(We),-1}}}submitBatch(de,ge){let Ce=-1;for(const Fe of de)Ce=this.submitMessage(o.MessageType.Operation,Fe.contents,!0,Fe.metadata,Fe.compression,ge);return this._deltaManager.flush(),Ce}submitSummaryMessage(de,ge){return de.details===void 0&&(de.details={}),de.details.includesProtocolTree=this.storageAdapter.summarizeProtocolTree,this.submitMessage(o.MessageType.Summarize,JSON.stringify(de),!1,void 0,void 0,ge)}submitMessage(de,ge,Ce,Fe,We,Ze){return this.connectionState!==v.ConnectionState.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:de}),-1):(this.noopHeuristic?.notifyMessageSent(),this._deltaManager.submit(de,ge,Ce,Fe,We,Ze))}processRemoteMessage(de){const ge=this.clientId===de.clientId,Ce=this.protocolHandler.processMessage(de,ge);if(this.runtime.process(de,ge),this.serializedStateManager.addProcessedOp(de),this.activeConnection()){if(this.noopHeuristic===void 0){const Fe=this.deltaManager.serviceConfiguration;(0,r.assert)(Fe!==void 0,740),this.noopHeuristic=new E.NoopHeuristic(Fe.noopTimeFrequency,Fe.noopCountFrequency),this.noopHeuristic.on("wantsNoop",()=>{(0,r.assert)(this.activeConnection(),577),this.submitMessage(o.MessageType.NoOp)})}this.noopHeuristic.notifyMessageProcessed(de),Ce.immediateNoOp===!0&&this.submitMessage(o.MessageType.Accept)}this.emit("op",de)}submitSignal(de,ge){this._deltaManager.submitSignal(JSON.stringify(de),ge)}processSignal(de){if((0,R.protocolHandlerShouldProcessSignal)(de))this.protocolHandler.processSignal(de);else{const ge=this.clientId===de.clientId;this.runtime.processSignal(de,ge)}}async instantiateRuntime(de,ge,Ce,Fe){(0,r.assert)(this._runtime?.disposed!==!1,221);try{const We=this.scope,Ze=new p.RelativeLoader(this,We.ILoader),lt=await c.PerformanceEvent.timedExecAsync(this.subLogger,{eventName:"CodeLoad"},async()=>this.codeLoader.load(de));this._loadedModule={module:lt.module,details:lt.details??de};const pt=this._loadedModule.module.fluidExport?.IRuntimeFactory;if(pt===void 0)throw new Error(G);const Nt=ge!==void 0,Ke=new h.ContainerContext({options:this.options,scope:this.scope,baseSnapshot:ge,version:this._loadedFromVersion,deltaManager:this._deltaManager,storage:this.storageAdapter,quorum:this.protocolHandler.quorum,audience:this.protocolHandler.audience,loader:Ze,submitFn:(Qe,Y,Me,K)=>this.submitContainerMessage(Qe,Y,Me,K),submitSummaryFn:(Qe,Y)=>this.submitSummaryMessage(Qe,Y),submitBatchFn:(Qe,Y)=>this.submitBatch(Qe,Y),submitSignalFn:(Qe,Y)=>this.submitSignal(Qe,Y),disposeFn:Qe=>this.dispose(Qe),closeFn:Qe=>this.close(Qe),updateDirtyContainerState:this.updateDirtyContainerState,getAbsoluteUrl:this.getAbsoluteUrl,getContainerDiagnosticId:()=>this.resolvedUrl?.id,getClientId:()=>this.clientId,getAttachState:()=>this.attachState,getConnected:()=>this.connected,getConnectionState:()=>this.connectionState,clientDetails:this._deltaManager.clientDetails,existing:Nt,taggedLogger:this.subLogger,pendingLocalState:Ce,snapshotWithContents:Fe}),Ge=await c.PerformanceEvent.timedExecAsync(this.subLogger,{eventName:"InstantiateRuntime"},async()=>pt.instantiateRuntime(Ke,Nt)),Re=Ge;(0,w.validateRuntimeCompatibility)(Re.ILayerCompatDetails),this._runtime=Ge,this._lifecycleEvents.emit("runtimeInstantiated"),this._loadedCodeDetails=de}catch(We){throw this.dispose((0,c.normalizeError)(We)),We}}setContextConnectedState(de,ge){this._runtime?.disposed===!1&&this.loaded&&this.runtime.setConnectionState(de&&!ge,this.clientId)}handleDeltaConnectionArg(de,ge){switch((0,r.assert)(this.loaded,2415),de){case void 0:ge&&this.connectToDeltaStream(ge);case"delayed":{(0,r.assert)(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break}case"none":break;default:(0,r.unreachableCase)(de)}}}return to.Container=oe,to}var uu={},xz;function qie(){if(xz)return uu;xz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(uu,"__esModule",{value:!0}),uu.loadExistingContainer=uu.rehydrateDetachedContainer=uu.createDetachedContainer=void 0;const e=mx();async function n(i){return new e.Loader(i).createDetachedContainer(i.codeDetails,{canReconnect:i.allowReconnect,clientDetailsOverride:i.clientDetailsOverride})}uu.createDetachedContainer=n;async function a(i){return new e.Loader(i).rehydrateDetachedContainerFromSnapshot(i.serializedState,{canReconnect:i.allowReconnect,clientDetailsOverride:i.clientDetailsOverride})}uu.rehydrateDetachedContainer=a;async function t(i){return new e.Loader(i).resolve(i.request,i.pendingLocalState)}return uu.loadExistingContainer=t,uu}var m0={},qz;function dge(){if(qz)return m0;qz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(m0,"__esModule",{value:!0}),m0.loadContainerPaused=void 0;const e=Mr(),n=Je(),a=Ot(),t=qie();async function i(r,s,o,u){const c=await(0,t.loadExistingContainer)({...r,request:{url:s.url,headers:{...s.headers,[e.LoaderHeader.loadMode]:{opsBeforeReturn:void 0,deltaConnection:"none"}}}});c.forceReadonly?.(!0);const d=c.deltaManager,l=d.initialSequenceNumber,f=()=>{(0,n.assert)((0,e.isIDeltaManagerFull)(d),2687),d.inbound.pause(),d.outbound.pause()};if(o===void 0||l===o)return f(),c;if(l>o){const h=new a.GenericError("Cannot satisfy request to pause the container at the specified sequence number. Most recent snapshot is newer than the specified sequence number.");throw c.close(h),h}let b,C,v;const m=new Promise((h,g)=>{C=()=>g(new a.GenericError("Canceled due to cancellation request.")),v=_=>g(_),b=()=>{o!==void 0&&d.lastSequenceNumber>=o&&(f(),h())},u?.addEventListener("abort",C),c.on("op",b),c.on("closed",v)});return c.connect(),await m.catch(h=>{throw c.close(h),h}).finally(()=>{c.disconnect(),c.off("op",b),c.off("closed",v),u?.removeEventListener("abort",C)}),c}return m0.loadContainerPaused=i,m0}var sj={},bf={},Lz;function lge(){if(Lz)return bf;Lz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(bf,"__esModule",{value:!0}),bf.resolveWithLocationRedirectionHandling=bf.isLocationRedirectionError=void 0;const e=on(),n=Ot();function a(i){return typeof i=="object"&&i!==null&&i.errorType===e.DriverErrorTypes.locationRedirection}bf.isLocationRedirectionError=a;async function t(i,r,s,o){let u=r;const c=(0,n.createChildLogger)({logger:o,namespace:"LocationRedirection"});for(;;)try{return await i(u)}catch(d){if(!a(d))throw d;c.sendTelemetryEvent({eventName:"LocationRedirectionError"});const l=d.redirectUrl;u={url:await s.getAbsoluteUrl(l,"",void 0),headers:u.headers}}}return bf.resolveWithLocationRedirectionHandling=t,bf}var Bz;function fge(){return Bz||(Bz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.resolveWithLocationRedirectionHandling=e.isLocationRedirectionError=void 0;var n=lge();Object.defineProperty(e,"isLocationRedirectionError",{enumerable:!0,get:function(){return n.isLocationRedirectionError}}),Object.defineProperty(e,"resolveWithLocationRedirectionHandling",{enumerable:!0,get:function(){return n.resolveWithLocationRedirectionHandling}})})(sj)),sj}var Uz;function Lie(){return Uz||(Uz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.tryParseCompatibleResolvedUrl=e.resolveWithLocationRedirectionHandling=e.isLocationRedirectionError=e.loadContainerPaused=e.loaderCompatDetailsForRuntime=e.runtimeSupportRequirementsForLoader=e.loaderCoreCompatDetails=e.driverSupportRequirementsForLoader=e.Loader=e.rehydrateDetachedContainer=e.loadExistingContainer=e.createDetachedContainer=e.waitContainerToCatchUp=e.ConnectionState=void 0;var n=sx();Object.defineProperty(e,"ConnectionState",{enumerable:!0,get:function(){return n.ConnectionState}});var a=xie();Object.defineProperty(e,"waitContainerToCatchUp",{enumerable:!0,get:function(){return a.waitContainerToCatchUp}});var t=qie();Object.defineProperty(e,"createDetachedContainer",{enumerable:!0,get:function(){return t.createDetachedContainer}}),Object.defineProperty(e,"loadExistingContainer",{enumerable:!0,get:function(){return t.loadExistingContainer}}),Object.defineProperty(e,"rehydrateDetachedContainer",{enumerable:!0,get:function(){return t.rehydrateDetachedContainer}});var i=mx();Object.defineProperty(e,"Loader",{enumerable:!0,get:function(){return i.Loader}});var r=hx();Object.defineProperty(e,"driverSupportRequirementsForLoader",{enumerable:!0,get:function(){return r.driverSupportRequirementsForLoader}}),Object.defineProperty(e,"loaderCoreCompatDetails",{enumerable:!0,get:function(){return r.loaderCoreCompatDetails}}),Object.defineProperty(e,"runtimeSupportRequirementsForLoader",{enumerable:!0,get:function(){return r.runtimeSupportRequirementsForLoader}}),Object.defineProperty(e,"loaderCompatDetailsForRuntime",{enumerable:!0,get:function(){return r.loaderCompatDetailsForRuntime}});var s=dge();Object.defineProperty(e,"loadContainerPaused",{enumerable:!0,get:function(){return s.loadContainerPaused}});var o=fge();Object.defineProperty(e,"isLocationRedirectionError",{enumerable:!0,get:function(){return o.isLocationRedirectionError}}),Object.defineProperty(e,"resolveWithLocationRedirectionHandling",{enumerable:!0,get:function(){return o.resolveWithLocationRedirectionHandling}});var u=Kg();Object.defineProperty(e,"tryParseCompatibleResolvedUrl",{enumerable:!0,get:function(){return u.tryParseCompatibleResolvedUrl}})})(EF)),EF}var aj={},vf={},zz;function hge(){if(zz)return vf;zz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vf,"__esModule",{value:!0}),vf.isInternalFluidContainer=vf.createFluidContainer=void 0;const e=Ht(),n=Mr(),a=Je();async function t(s){const o=await s.container.getEntryPoint();return(0,a.assert)(o.IStaticEntryPoint!==void 0,2974),new r(s.container,o.IStaticEntryPoint.rootDataObject,o.IStaticEntryPoint.extensionStore)}vf.createFluidContainer=t;function i(s){return s instanceof r}vf.isInternalFluidContainer=i;class r extends e.TypedEventEmitter{constructor(o,u,c){super(),this.container=o,this.rootDataObject=u,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=d=>this.emit("disposed",d),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),this.acquireExtension=c.acquireExtension.bind(c),o.on("connected",this.connectedHandler),o.on("closed",this.disposedHandler),o.on("disconnected",this.disconnectedHandler),o.on("saved",this.savedHandler),o.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(o){throw this.container.attachState!==n.AttachState.Detached?new Error("Cannot attach container. Container is not in detached state."):new Error("Cannot attach container. Attach method not provided.")}async connect(){this.container.connect?.()}async disconnect(){this.container.disconnect?.()}async create(o){return this.rootDataObject.create(o)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}async uploadBlob(o){return this.rootDataObject.uploadBlob(o)}}return vf}var p0={},oj={},cj={},g0={},uj={},Sf={},dj={},Cf={},lj={},y0={},fj={},b0={},Vz;function mge(){if(Vz)return b0;Vz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(b0,"__esModule",{value:!0}),b0.generateHandleContextPath=void 0;function e(n,a){if(n==="")return a===void 0?"":a.absolutePath;{let t=n.startsWith("/")?n.slice(1):n;return t=t.endsWith("/")?t.slice(0,-1):t,a===void 0?`/${t}`:`${a.absolutePath==="/"?"":a.absolutePath}/${t}`}}return b0.generateHandleContextPath=e,b0}var so={},Hz;function Bie(){if(Hz)return so;Hz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(so,"__esModule",{value:!0}),so.createResponseError=so.create404Response=so.responseToException=so.exceptionToResponse=void 0;const e=Je(),n=Ot();function a(o){return o!==null&&typeof o=="object"&&"errorFromRequestFluidObject"in o&&o.errorFromRequestFluidObject===!0}function t(o){if(a(o))return{mimeType:"text/plain",status:o.code,value:o.message,get stack(){return o.stack},headers:o.underlyingResponseHeaders};const c=(0,n.generateErrorWithStack)();return{mimeType:"text/plain",status:500,value:`${o}`,get stack(){return(typeof o=="object"&&o!==null&&"stack"in o?o.stack:void 0)??c.stack}}}so.exceptionToResponse=t;function i(o,u){const c=o.value,d=(0,n.generateErrorWithStack)();return{errorFromRequestFluidObject:!0,message:c,name:"Error",code:o.status,get stack(){return o.stack??d.stack},underlyingResponseHeaders:o.headers}}so.responseToException=i;const r=o=>s(404,"not found",o);so.create404Response=r;function s(o,u,c,d){(0,e.assert)(o!==200,411);const l=c.url?.split("?")[0],f=(0,n.generateErrorWithStack)();return{mimeType:"text/plain",status:o,value:l===void 0?u:`${u}: ${l}`,get stack(){return f.stack},headers:d}}return so.createResponseError=s,so}var hj={},Kz;function Uie(){return Kz||(Kz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.FluidHandleBase=e.toFluidHandleErased=e.toFluidHandleInternal=e.compareFluidHandles=e.isFluidHandle=e.encodeHandleForSerialization=e.isLocalFluidHandle=e.isFluidHandlePayloadPending=e.isFluidHandleInternalPayloadPending=e.isSerializedHandle=void 0;const n=hd(),a=f=>f?.type==="__fluid_handle__";e.isSerializedHandle=a;const t=f=>"payloadPending"in f&&f.payloadPending===!0;e.isFluidHandleInternalPayloadPending=t;const i=f=>"payloadState"in f&&(f.payloadState==="shared"||f.payloadState==="pending");e.isFluidHandlePayloadPending=i;const r=f=>(0,e.isFluidHandlePayloadPending)(f)&&"payloadShareError"in f;e.isLocalFluidHandle=r;function s(f){return(0,e.isFluidHandleInternalPayloadPending)(f)?{type:"__fluid_handle__",url:f.absolutePath,payloadPending:!0}:{type:"__fluid_handle__",url:f.absolutePath}}e.encodeHandleForSerialization=s;function o(f){if(typeof f!="object"||f===null)return!1;if(n.fluidHandleSymbol in f)return!0;if(n.IFluidHandle in f){const b=f[n.IFluidHandle];return typeof b!="object"||b===null?!1:n.IFluidHandle in b}return!1}e.isFluidHandle=o;function u(f,b){const C=c(f),v=c(b);return C.absolutePath===v.absolutePath}e.compareFluidHandles=u;function c(f){if(!(n.fluidHandleSymbol in f)||!(n.fluidHandleSymbol in f[n.fluidHandleSymbol])){if(n.IFluidHandle in f)return f[n.IFluidHandle];throw new TypeError("Invalid IFluidHandle")}return f[n.fluidHandleSymbol]}e.toFluidHandleInternal=c;function d(f){return f}e.toFluidHandleErased=d;class l{get IFluidHandle(){return this}get[n.fluidHandleSymbol](){return this}}e.FluidHandleBase=l})(hj)),hj}var v0={},$z;function pge(){if($z)return v0;$z=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(v0,"__esModule",{value:!0}),v0.ObjectStoragePartition=void 0;const e=Je();class n{constructor(t,i){this.storage=t,this.path=i,(0,e.assert)(!i.endsWith("/"),412)}async readBlob(t){return this.storage.readBlob(`${this.path}/${t}`)}async contains(t){return this.storage.contains(`${this.path}/${t}`)}async list(t){return this.storage.list(`${this.path}/${t}`)}}return v0.ObjectStoragePartition=n,v0}var _f={},Gz;function gge(){if(Gz)return _f;Gz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_f,"__esModule",{value:!0}),_f.listBlobsAtTreePath=_f.getNormalizedObjectStoragePathParts=void 0;const e=on();function n(t){let i=t;return i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,-1)),i.length>0?i.split("/"):[]}_f.getNormalizedObjectStoragePathParts=n;async function a(t,i){const r=n(i);let s=t;for(;s?.entries!==void 0&&r.length>0;){const o=r.shift(),u=s.entries.find(c=>c.type===e.TreeEntry.Tree&&c.path===o);s=u?.type===e.TreeEntry.Tree?u.value:void 0}if(s?.entries===void 0||r.length>0)throw new Error("path does not exist");return s.entries.filter(o=>o.type===e.TreeEntry.Blob).map(o=>o.path)}return _f.listBlobsAtTreePath=a,_f}var S0={},mj={},Wz;function zie(){return Wz||(Wz=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.encodeCompactIdToString=e.charSetForEncodingIds=e.seqFromTree=e.RuntimeHeaders=void 0;const n=Je();var a;(function(r){r.wait="wait",r.viaHandle="viaHandle",r.payloadPending="payloadPending"})(a||(e.RuntimeHeaders=a={}));async function t(r,s){const o=r.trees[".protocol"].blobs.attributes;return(await s(o)).sequenceNumber}e.seqFromTree=t,e.charSetForEncodingIds="ABCDEFGHIJKLMNOPQRSTUVWXYZ(abcdefghijklmnopqrstuvwxyz)0123456789";function i(r,s=""){if(typeof r=="string")return r;(0,n.assert)(Number.isInteger(r)&&r>=0,2304);let o="",u=r;do{const c=u%64;o=e.charSetForEncodingIds[c]+o,u=Math.floor(u/64)-1}while(u!==-1);return s+o}e.encodeCompactIdToString=i})(mj)),mj}var Jz;function yge(){if(Jz)return S0;Jz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(S0,"__esModule",{value:!0}),S0.RemoteFluidObjectHandle=void 0;const e=Je(),n=Bie(),a=Uie(),t=zie();class i extends a.FluidHandleBase{constructor(s,o,u){super(),this.absolutePath=s,this.routeContext=o,this.payloadPending=u,this.isAttached=!0,(0,e.assert)(s.startsWith("/"),413)}async get(){if(this.objectP===void 0){const s={url:this.absolutePath,headers:{[t.RuntimeHeaders.viaHandle]:!0,[t.RuntimeHeaders.payloadPending]:this.payloadPending}};this.objectP=this.routeContext.resolveHandle(s).then(o=>{if(o.mimeType==="fluid/object")return o.value;throw(0,n.responseToException)(o,s)})}return this.objectP}attachGraph(){}}return S0.RemoteFluidObjectHandle=i,S0}var C0={},Qz;function bge(){if(Qz)return C0;Qz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(C0,"__esModule",{value:!0}),C0.RequestParser=void 0;class e{static getPathParts(a){const t=a.indexOf("?"),i=[],r=a.slice(0,t<0?a.length:t);for(const s of r.split("/"))s!==void 0&&s.length>0&&i.push(decodeURIComponent(s));return i}static create(a){return a instanceof e?a:new e(a)}constructor(a){this.request=a;const t=this.request.url.indexOf("?");this.query=t>=0?this.request.url.slice(t):"",a.headers!==void 0&&(this.headers=a.headers)}get url(){return this.request.url}get pathParts(){return this.requestPathParts===void 0&&(this.requestPathParts=e.getPathParts(this.url)),this.requestPathParts}isLeaf(a){return this.query===""&&this.pathParts.length===a}createSubRequest(a){const t=this.pathParts.length;if(a<0||a>t)throw new Error("incorrect sub-request");if(a===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const i=`/${this.pathParts.slice(a).join("/")}`;return{url:this.query===""?i:`${i}/${this.query}`,headers:this.headers}}}return C0.RequestParser=e,C0}var _0={},Yz;function vge(){if(Yz)return _0;Yz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_0,"__esModule",{value:!0}),_0.RuntimeFactoryHelper=void 0;class e{get IRuntimeFactory(){return this}async instantiateRuntime(a,t){const i=await this.preInitialize(a,t);return await(t?this.instantiateFromExisting(i):this.instantiateFirstTime(i)),await this.hasInitialized(i),i}async instantiateFirstTime(a){}async instantiateFromExisting(a){}async hasInitialized(a){}}return _0.RuntimeFactoryHelper=e,_0}var sr={},pj={},du={},Xz;function Sge(){if(Xz)return du;Xz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(du,"__esModule",{value:!0}),du.VisibilityState=du.FlushModeExperimental=du.FlushMode=void 0;var e;(function(a){a[a.Immediate=0]="Immediate",a[a.TurnBased=1]="TurnBased"})(e||(du.FlushMode=e={}));var n;return(function(a){a[a.Async=2]="Async"})(n||(du.FlushModeExperimental=n={})),du.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"},du}var T0={},Zz;function Cge(){if(Zz)return T0;Zz=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(T0,"__esModule",{value:!0}),T0.IFluidDataStoreFactory=void 0,T0.IFluidDataStoreFactory="IFluidDataStoreFactory",T0}var w0={},e6;function _ge(){if(e6)return w0;e6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(w0,"__esModule",{value:!0}),w0.IFluidDataStoreRegistry=void 0,w0.IFluidDataStoreRegistry="IFluidDataStoreRegistry",w0}var ha={},t6;function Tge(){if(t6)return ha;t6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(ha,"__esModule",{value:!0}),ha.gcDataBlobKey=ha.gcDeletedBlobKey=ha.gcTombstoneBlobKey=ha.gcBlobPrefix=ha.gcTreeKey=void 0,ha.gcTreeKey="gc",ha.gcBlobPrefix="__gc",ha.gcTombstoneBlobKey="__tombstones",ha.gcDeletedBlobKey="__deletedNodes",ha.gcDataBlobKey=".gcdata",ha}var Tf={},n6;function wge(){if(n6)return Tf;n6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.notifiesReadOnlyState=Tf.encodeHandlesInContainerRuntime=void 0,Tf.encodeHandlesInContainerRuntime="encodeHandlesInContainerRuntime",Tf.notifiesReadOnlyState="notifiesReadOnlyState",Tf}var ao={},r6;function Oge(){if(r6)return ao;r6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ao,"__esModule",{value:!0}),ao.totalBlobSizePropertyName=ao.blobCountPropertyName=ao.channelsTreeName=ao.CreateSummarizerNodeSource=void 0;var e;return(function(n){n[n.FromSummary=0]="FromSummary",n[n.FromAttach=1]="FromAttach",n[n.Local=2]="Local"})(e||(ao.CreateSummarizerNodeSource=e={})),ao.channelsTreeName=".channels",ao.blobCountPropertyName="BlobCount",ao.totalBlobSizePropertyName="TotalBlobSize",ao}var i6;function ja(){return i6||(i6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.totalBlobSizePropertyName=e.CreateSummarizerNodeSource=e.channelsTreeName=e.blobCountPropertyName=e.notifiesReadOnlyState=e.encodeHandlesInContainerRuntime=e.gcTreeKey=e.gcTombstoneBlobKey=e.gcDeletedBlobKey=e.gcDataBlobKey=e.gcBlobPrefix=e.IFluidDataStoreRegistry=e.IFluidDataStoreFactory=e.VisibilityState=e.FlushModeExperimental=e.FlushMode=void 0;var n=Sge();Object.defineProperty(e,"FlushMode",{enumerable:!0,get:function(){return n.FlushMode}}),Object.defineProperty(e,"FlushModeExperimental",{enumerable:!0,get:function(){return n.FlushModeExperimental}}),Object.defineProperty(e,"VisibilityState",{enumerable:!0,get:function(){return n.VisibilityState}});var a=Cge();Object.defineProperty(e,"IFluidDataStoreFactory",{enumerable:!0,get:function(){return a.IFluidDataStoreFactory}});var t=_ge();Object.defineProperty(e,"IFluidDataStoreRegistry",{enumerable:!0,get:function(){return t.IFluidDataStoreRegistry}});var i=Tge();Object.defineProperty(e,"gcBlobPrefix",{enumerable:!0,get:function(){return i.gcBlobPrefix}}),Object.defineProperty(e,"gcDataBlobKey",{enumerable:!0,get:function(){return i.gcDataBlobKey}}),Object.defineProperty(e,"gcDeletedBlobKey",{enumerable:!0,get:function(){return i.gcDeletedBlobKey}}),Object.defineProperty(e,"gcTombstoneBlobKey",{enumerable:!0,get:function(){return i.gcTombstoneBlobKey}}),Object.defineProperty(e,"gcTreeKey",{enumerable:!0,get:function(){return i.gcTreeKey}});var r=wge();Object.defineProperty(e,"encodeHandlesInContainerRuntime",{enumerable:!0,get:function(){return r.encodeHandlesInContainerRuntime}}),Object.defineProperty(e,"notifiesReadOnlyState",{enumerable:!0,get:function(){return r.notifiesReadOnlyState}});var s=Oge();Object.defineProperty(e,"blobCountPropertyName",{enumerable:!0,get:function(){return s.blobCountPropertyName}}),Object.defineProperty(e,"channelsTreeName",{enumerable:!0,get:function(){return s.channelsTreeName}}),Object.defineProperty(e,"CreateSummarizerNodeSource",{enumerable:!0,get:function(){return s.CreateSummarizerNodeSource}}),Object.defineProperty(e,"totalBlobSizePropertyName",{enumerable:!0,get:function(){return s.totalBlobSizePropertyName}})})(pj)),pj}var s6;function Pge(){if(s6)return sr;s6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(sr,"__esModule",{value:!0}),sr.GCDataBuilder=sr.TelemetryContext=sr.processAttachMessageGCData=sr.convertSummaryTreeToITree=sr.convertSnapshotTreeToSummaryTree=sr.convertToSummaryTree=sr.convertToSummaryTreeWithStats=sr.SummaryTreeBuilder=sr.addSummarizeResultToSummary=sr.addBlobToSummary=sr.calculateStats=sr.getBlobSize=sr.utf8ByteLength=sr.mergeStats=void 0;const e=Ht(),n=Je(),a=on(),t=on(),i=Kn(),r=ja();function s(...O){const E={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const F of O)E.treeNodeCount+=F.treeNodeCount,E.blobNodeCount+=F.blobNodeCount,E.handleNodeCount+=F.handleNodeCount,E.totalBlobSize+=F.totalBlobSize,E.unreferencedBlobSize+=F.unreferencedBlobSize;return E}sr.mergeStats=s;function o(O){let E=O.length;for(let F=O.length-1;F>=0;F--){const R=O.codePointAt(F);R!==void 0&&(R>127&&R<=2047?E++:R>2047&&R<=65535&&(E+=2),R>=56320&&R<=57343&&F--)}return E}sr.utf8ByteLength=o;function u(O){return typeof O=="string"?o(O):O.byteLength}sr.getBlobSize=u;function c(O,E){switch(O.type){case a.SummaryType.Tree:{E.treeNodeCount++;for(const F of Object.values(O.tree))c(F,E);return}case a.SummaryType.Handle:{E.handleNodeCount++;return}case a.SummaryType.Blob:{E.blobNodeCount++,E.totalBlobSize+=u(O.content);return}default:return}}function d(O){const E=s();return c(O,E),E}sr.calculateStats=d;function l(O,E,F){const R={type:a.SummaryType.Blob,content:F};O.summary.tree[E]=R,O.stats.blobNodeCount++,O.stats.totalBlobSize+=u(F)}sr.addBlobToSummary=l;function f(O,E,F){O.summary.tree[E]=F.summary,O.stats=s(O.stats,F.stats)}sr.addSummarizeResultToSummary=f;class b{get summary(){const E={type:a.SummaryType.Tree,tree:{...this.summaryTree}};return this.groupId!==void 0&&(E.groupId=this.groupId),E}get stats(){return{...this.summaryStats}}constructor(E){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=s(),this.summaryStats.treeNodeCount++,this.groupId=E?.groupId}addBlob(E,F){l({summary:{type:a.SummaryType.Tree,tree:this.summaryTree},stats:this.summaryStats},E,F)}addHandle(E,F,R){this.summaryTree[E]={type:a.SummaryType.Handle,handleType:F,handle:R},this.summaryStats.handleNodeCount++}addWithStats(E,F){this.summaryTree[E]=F.summary,this.summaryStats=s(this.summaryStats,F.stats)}addAttachment(E){this.summaryTree[this.attachmentCounter++]={id:E,type:a.SummaryType.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}sr.SummaryTreeBuilder=b;function C(O,E=!1){const F=new b;for(const M of O.entries)switch(M.type){case t.TreeEntry.Blob:{const j=M.value,k=j.encoding==="base64"?e.IsoBuffer.from(j.contents,"base64"):j.contents;F.addBlob(M.path,k);break}case t.TreeEntry.Tree:{const j=v(M.value,E);F.addWithStats(M.path,j);break}case t.TreeEntry.Attachment:{const j=M.value.id;F.addAttachment(j);break}default:throw new Error("Unexpected TreeEntry type")}const R=F.getSummaryTree();return R.summary.unreferenced=O.unreferenced,R.summary.groupId=O.groupId,R}sr.convertToSummaryTreeWithStats=C;function v(O,E=!1){if(O.id&&!E){const F=s();return F.handleNodeCount++,{summary:{handle:O.id,handleType:a.SummaryType.Tree,type:a.SummaryType.Handle},stats:F}}else return C(O,E)}sr.convertToSummaryTree=v;function m(O){const E=new b;for(const[R,M]of Object.entries(O.blobs)){let j;if(O.blobsContents!==void 0){const k=O.blobsContents[M];k!==void 0&&(j=(0,e.bufferToString)(k,"utf-8"))}else O.blobs[M]!==void 0&&(j=(0,e.fromBase64ToUtf8)(O.blobs[M]));j!==void 0&&E.addBlob(R,j)}for(const[R,M]of Object.entries(O.trees)){const j=m(M);E.addWithStats(R,j)}const F=E.getSummaryTree();return F.summary.unreferenced=O.unreferenced,F.summary.groupId=O.groupId,F}sr.convertSnapshotTreeToSummaryTree=m;function h(O){const E=[];for(const[F,R]of Object.entries(O.tree))switch(R.type){case a.SummaryType.Blob:{let M,j="utf-8";typeof R.content=="string"?M=R.content:(M=(0,e.Uint8ArrayToString)(R.content,"base64"),j="base64"),E.push(new i.BlobTreeEntry(F,M,j));break}case a.SummaryType.Tree:{E.push(new i.TreeTreeEntry(F,h(R)));break}case a.SummaryType.Attachment:{E.push(new i.AttachmentTreeEntry(F,R.id));break}case a.SummaryType.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,n.unreachableCase)(R,"Unexpected summary tree type")}return{entries:E,unreferenced:O.unreferenced,groupId:O.groupId}}sr.convertSummaryTreeToITree=h;function g(O,E){const F=O?.entries.find(M=>M.path===r.gcDataBlobKey);if(F===void 0)return!1;(0,n.assert)(F.type===t.TreeEntry.Blob&&F.value.encoding==="utf-8",2303);const R=JSON.parse(F.value.contents);for(const[M,j]of Object.entries(R.gcNodes))for(const k of j)E(M,k);return!0}sr.processAttachMessageGCData=g;class _{constructor(){this.telemetry=new Map}set(E,F,R){this.telemetry.set(`${E}${F}`,R)}setMultiple(E,F,R){for(const M of Object.keys(R))this.set(E,`${F}_${M}`,R[M])}get(E,F){return this.telemetry.get(`${E}${F}`)}serialize(){const E={};for(const[F,R]of this.telemetry.entries())E[F]=R;return JSON.stringify(E)}}sr.TelemetryContext=_;function S(O){return O.replace(/^\/+/g,"")}function p(O){return O.replace(/\/+$/g,"")}class w{constructor(){this.gcNodesSet={}}get gcNodes(){const E={};for(const[F,R]of Object.entries(this.gcNodesSet))E[F]=[...R];return E}addNode(E,F){this.gcNodesSet[E]=new Set(F)}prefixAndAddNodes(E,F){for(const[R,M]of Object.entries(F)){let j=S(R);j=`/${E}/${j}`,j=p(j),this.gcNodesSet[j]=new Set(M)}}addNodes(E){for(const[F,R]of Object.entries(E))this.gcNodesSet[F]=new Set(R)}addRouteToAllNodes(E){for(const F of Object.values(this.gcNodesSet))F.add(E)}getGCData(){return{gcNodes:this.gcNodes}}}return sr.GCDataBuilder=w,sr}var O0={},a6;function Ege(){if(a6)return O0;a6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(O0,"__esModule",{value:!0}),O0.unpackChildNodesUsedRoutes=void 0;const e=Je();function n(a){const t=a.filter(r=>r!==""&&r!=="/"),i=new Map;for(const r of t){(0,e.assert)(r.startsWith("/"),1504);const s=r.split("/")[1];(0,e.assert)(s!==void 0,2475);const o=r.slice(s.length+1),u=i.get(s);u===void 0?i.set(s,[o]):u.push(o)}return i}return O0.unpackChildNodesUsedRoutes=n,O0}var P0={},o6;function Ige(){if(o6)return P0;o6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(P0,"__esModule",{value:!0}),P0.isSnapshotFetchRequiredForLoadingGroupId=void 0;function e(n,a){for(const[t,i]of Object.entries(n.blobs))if(!a.has(i))return!0;for(const[t,i]of Object.entries(n.trees))if(i.groupId===void 0&&e(i,a))return!0;return!1}return P0.isSnapshotFetchRequiredForLoadingGroupId=e,P0}var wf={},c6;function Rge(){if(c6)return wf;c6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(wf,"__esModule",{value:!0}),wf.toDeltaManagerErased=wf.toDeltaManagerInternal=void 0;function e(a){return a}wf.toDeltaManagerInternal=e;function n(a){return a}return wf.toDeltaManagerErased=n,wf}var gj={},gr={},u6;function px(){if(u6)return gr;u6=1;var e=Number.MAX_SAFE_INTEGER||9007199254740991,n=/^v?(0|[1-9]\d{0,256})\.(0|[1-9]\d{0,256})\.(0|[1-9]\d{0,256})(?:-((?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250})(?:\.(?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250}))*))?(?:\+([a-zA-Z0-9-]{1,250}(?:\.[a-zA-Z0-9-]{1,250})*))?$/,a=/^[v=\s]*(\d{1,256})\.(\d{1,256})\.(\d{1,256})(?:-?((?:\d{1,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250})(?:\.(?:\d{1,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250}))*))?(?:\+([a-zA-Z0-9-]{1,250}(?:\.[a-zA-Z0-9-]{1,250})*))?$/,t=/(^|[^\d])(\d{1,16})(?:\.(\d{1,16}))?(?:\.(\d{1,16}))?(?:(?:-((?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250})(?:\.(?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250}))*)))?(?:(?:\+([a-zA-Z0-9-]{1,250}(?:\.[a-zA-Z0-9-]{1,250})*)))?(?:$|[^\d])/,i=/(^|[^\d])(\d{1,16})(?:\.(\d{1,16}))?(?:\.(\d{1,16}))?(?:$|[^\d])/,r=/(^|[^\d])(\d{1,16})(?:\.(\d{1,16}))?(?:\.(\d{1,16}))?(?:(?:-((?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250})(?:\.(?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250}))*)))?(?:(?:\+([a-zA-Z0-9-]{1,250}(?:\.[a-zA-Z0-9-]{1,250})*)))?(?:$|[^\d])/g,s=/(^|[^\d])(\d{1,16})(?:\.(\d{1,16}))?(?:\.(\d{1,16}))?(?:$|[^\d])/g,o=/^(?:-((?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250})(?:\.(?:0|[1-9]\d{0,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250}))*))$/,u=/^(?:-?((?:\d{1,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250})(?:\.(?:\d{1,256}|\d{0,256}[a-zA-Z-][a-zA-Z0-9-]{0,250}))*))$/,c=Ue=>{if(Ue){if(typeof Ue!="object")return!0}else return!1;return!!Ue.loose},d=c,l=(Ue,Pe,Ye,ke,Rt)=>{let Ft=`${Ue}.${Pe}.${Ye}`;ke.length&&(Ft+=`-${ke.join(".")}`);let xt=Ft;return Rt.length&&(xt+=`+${Rt.join(".")}`),[Ft,xt]},f=l,b=256,C=(Ue,Pe)=>{if(typeof Ue!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof Ue}".`);if(Ue.length>b)throw new TypeError(`version is longer than ${b} characters`);const Ye=d(Pe),ke=Ue.trim().match(Ye?a:n);if(!ke)throw new TypeError(`Invalid Version: ${Ue}`);const Rt=+ke[1],Ft=+ke[2],xt=+ke[3];if(Rt>e||Rt<0)throw new TypeError("Invalid major version");if(Ft>e||Ft<0)throw new TypeError("Invalid minor version");if(xt>e||xt<0)throw new TypeError("Invalid patch version");const zt=ke[4]?ke[4].split(".").map(Kt=>{if(/^[0-9]+$/.test(Kt)){const mn=+Kt;if(mn>=0&&mn<e)return mn}return Kt}):[],fn=ke[5]?ke[5].split("."):[],[je,Ne]=f(Rt,Ft,xt,zt,fn);return{version:je,fullVersion:Ne,major:Rt,minor:Ft,patch:xt,prerelease:zt,build:fn}},v=(Ue,Pe,Ye)=>{try{return C(Ue,Pe)}catch(ke){if(!Ye)return null;throw ke}},m=v,h=(Ue,Pe)=>{const Ye=m(Ue.trim().replace(/^[=v]+/,""),Pe);return Ye?Ye.version:null},g=h,_=/^[0-9]+$/,S=(Ue,Pe)=>{let Ye=Ue.toString(),ke=Pe.toString();const Rt=_.test(Ye),Ft=_.test(ke);return Rt&&Ft&&(Ye=+Ye,ke=+ke),Ye===ke?0:Rt&&!Ft?-1:Ft&&!Rt?1:Ye<ke?-1:1},p=S,w=(Ue,Pe)=>p(Ue.major,Pe.major)||p(Ue.minor,Pe.minor)||p(Ue.patch,Pe.patch),O=(Ue,Pe)=>{if(Ue.length&&!Pe.length)return-1;if(!Ue.length&&Pe.length)return 1;if(!Ue.length&&!Pe.length)return 0;let Ye=0;for(;;){const ke=Ue[Ye],Rt=Pe[Ye];if(ke===void 0&&Rt===void 0)return 0;if(Rt===void 0)return 1;if(ke===void 0)return-1;if(ke!==Rt)return p(ke,Rt);Ye++}},E=(Ue,Pe)=>Ue.version===Pe.version?0:w(Ue,Pe)||O(Ue.prerelease,Pe.prerelease),F=E,R=(Ue,Pe,Ye)=>F(m(Ue,Ye,!0),m(Pe,Ye,!0)),M=R,j=(Ue,Pe,Ye)=>M(Ue,Pe,Ye)===0,k=j,x=(Ue,Pe,Ye)=>M(Ue,Pe,Ye)>0,L=x,V=(Ue,Pe,Ye)=>M(Ue,Pe,Ye)>=0,G=V,ee=(Ue,Pe,Ye)=>M(Ue,Pe,Ye)<0,se=ee,re=(Ue,Pe,Ye)=>M(Ue,Pe,Ye)<=0,fe=re,oe=(Ue,Pe,Ye)=>M(Ue,Pe,Ye)!==0,pe=oe,de=(Ue,Pe,Ye,ke)=>{switch(Pe){case"===":return Ue===Ye;case"!==":return Ue!==Ye;case"":case"=":case"==":return k(Ue,Ye,ke);case"!=":return pe(Ue,Ye,ke);case">":return L(Ue,Ye,ke);case">=":return G(Ue,Ye,ke);case"<":return se(Ue,Ye,ke);case"<=":return fe(Ue,Ye,ke);default:throw new TypeError(`Invalid operator: ${Pe}`)}},ge=(Ue,Pe)=>{let Ye=Ue;if(typeof Ye=="number"&&(Ye=String(Ye)),typeof Ye!="string")return null;Pe=Pe||{};let ke=null;if(!Pe.rtl)ke=Ye.match(Pe.includePrerelease?t:i);else{const Ne=Pe.includePrerelease?r:s;let Kt;for(;(Kt=Ne.exec(Ye))&&(!ke||ke.index+ke[0].length!==Ye.length);)(!ke||Kt.index+Kt[0].length!==ke.index+ke[0].length)&&(ke=Kt),Ne.lastIndex=Kt.index+Kt[1].length+Kt[2].length;Ne.lastIndex=-1}if(ke===null)return null;const Rt=ke[2],Ft=ke[3]||"0",xt=ke[4]||"0",zt=Pe.includePrerelease&&ke[5]?`-${ke[5]}`:"",fn=Pe.includePrerelease&&ke[6]?`+${ke[6]}`:"",je=m(`${Rt}.${Ft}.${xt}${zt}${fn}`,Pe);return je?je.fullVersion:null},Ce=ge,Fe=(Ue,Pe)=>{let Ye=0;for(;;){const ke=Ue[Ye],Rt=Pe[Ye];if(ke===void 0&&Rt===void 0)return 0;if(Rt===void 0)return 1;if(ke===void 0)return-1;if(ke!==Rt)return p(ke,Rt);Ye++}},We=(Ue,Pe,Ye)=>{const ke=m(Ue,Ye,!0),Rt=m(Pe,Ye,!0);return F(ke,Rt)||Fe(ke.build,Rt.build)},Ze=We,lt=(Ue,Pe)=>M(Ue,Pe,!0),ut=lt,pt=(Ue,Pe)=>{const Ye=m(Ue,!1,!0),ke=m(Pe,!1,!0),Rt=F(Ye,ke);if(Rt===0)return null;const Ft=Rt>0,xt=Ft?Ye:ke,zt=Ft?ke:Ye,fn=!!xt.prerelease.length;if(!!zt.prerelease.length&&!fn){if(!zt.patch&&!zt.minor)return"major";if(w(zt,xt)===0)return zt.minor&&!zt.patch?"minor":"patch"}const Ne=fn?"pre":"";return Ye.major!==ke.major?Ne+"major":Ye.minor!==ke.minor?Ne+"minor":Ye.patch!==ke.patch?Ne+"patch":"prerelease"},Nt=pt,Ke=(Ue,Pe,Ye,ke,Rt)=>{if(Pe===0||Pe.startsWith("pre")){if(!Ye&&ke===!1)throw new Error("invalid increment argument: identifier is empty");if(Ye){const mn=Rt?u:o,er=`-${Ye}`.match(mn);if(!er||er[1]!==Ye)throw new Error(`invalid identifier: ${Ye}`)}}switch(Pe){case"premajor":Ue.prerelease.length=0,Ue.patch=0,Ue.minor=0,Ue.major++,Ke(Ue,0,Ye,ke,Rt);break;case"preminor":Ue.prerelease.length=0,Ue.patch=0,Ue.minor++,Ke(Ue,0,Ye,ke,Rt);break;case"prepatch":Ue.prerelease.length=0,Ke(Ue,"patch",Ye,ke,Rt),Ke(Ue,0,Ye,ke,Rt);break;case"prerelease":Ue.prerelease.length===0&&Ke(Ue,"patch",Ye,ke,Rt),Ke(Ue,0,Ye,ke,Rt);break;case"release":if(Ue.prerelease.length===0)throw new Error(`version ${Ue.fullVersion} is not a prerelease`);Ue.prerelease.length=0;break;case"major":(Ue.minor!==0||Ue.patch!==0||Ue.prerelease.length===0)&&Ue.major++,Ue.minor=0,Ue.patch=0,Ue.prerelease.length=0;break;case"minor":(Ue.patch!==0||Ue.prerelease.length===0)&&Ue.minor++,Ue.patch=0,Ue.prerelease.length=0;break;case"patch":Ue.prerelease.length===0&&Ue.patch++,Ue.prerelease.length=0;break;case 0:{const mn=Number(ke)?1:0;if(Ue.prerelease.length===0)Ue.prerelease=[mn];else{let er=Ue.prerelease.length;for(;--er>=0;)typeof Ue.prerelease[er]=="number"&&(Ue.prerelease[er]++,er=-2);if(er===-1){if(Ye===Ue.prerelease.join(".")&&ke===!1)throw new Error("invalid increment argument: identifier already exists");Ue.prerelease.push(mn)}}if(Ye){let er=[Ye,mn];ke===!1&&(er=[Ye]),p(Ue.prerelease[0],Ye)===0?isNaN(Ue.prerelease[1])&&(Ue.prerelease=er):Ue.prerelease=er}break}default:throw new Error(`invalid increment argument: ${Pe}`)}const{major:Ft,minor:xt,patch:zt,prerelease:fn,build:je}=Ue,[Ne,Kt]=f(Ft,xt,zt,fn,je);return{version:Ne,fullVersion:Kt,major:Ft,minor:xt,patch:zt,prerelease:fn,build:je}};function Ge(Ue,Pe,Ye,ke,Rt){let Ft=Ye,xt=ke,zt=Rt;typeof Ft=="string"&&(zt=xt,xt=Ft,Ft=void 0);const fn=d(Ft);try{return Ke(m(Ue,Ft,!0),Pe,xt,zt,fn).version}catch{return null}}var Re=(Ue,Pe,Ye,ke,Rt)=>{const Ft=d(Rt);return Ke(m(Ue,Rt,!0),Pe,Ye,ke,Ft).version},Qe=(Ue,Pe)=>m(Ue,Pe,!0).major,Y=Qe,Me=(Ue,Pe)=>m(Ue,Pe,!0).minor,K=Me,Z=(Ue,Pe)=>m(Ue,Pe,!0).patch,me=Z,we=(Ue,Pe)=>{const Ye=m(Ue,Pe);return Ye&&Ye.prerelease.length?Ye.prerelease:null},qe=we,xe=(Ue,Pe,Ye)=>M(Pe,Ue,Ye),Oe=xe,He=(Ue,Pe)=>Ue.sort((Ye,ke)=>Ze(ke,Ye,Pe)),Se=He,Ve=(Ue,Pe)=>Ue.sort((Ye,ke)=>Ze(Ye,ke,Pe)),ot=Ve,mt=(Ue,Pe)=>{const Ye=m(Ue,Pe);return Ye?Ye.version:null},he=mt;return gr.clean=g,gr.cmp=de,gr.coerce=Ce,gr.compare=M,gr.compareBuild=Ze,gr.compareIdentifiers=p,gr.compareLoose=ut,gr.diff=Nt,gr.eq=k,gr.gt=L,gr.gte=G,gr.inc=Ge,gr.incThrow=Re,gr.lt=se,gr.lte=fe,gr.major=Y,gr.minor=K,gr.neq=pe,gr.parse=m,gr.patch=me,gr.prerelease=qe,gr.rcompare=Oe,gr.rsort=Se,gr.semverRegex=n,gr.sort=ot,gr.valid=he,gr}var Of={},d6;function Fge(){if(d6)return Of;d6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Of,"__esModule",{value:!0}),Of.pkgVersion=Of.pkgName=void 0,Of.pkgName="@fluidframework/runtime-utils",Of.pkgVersion="2.60.0",Of}var l6;function jge(){return l6||(l6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.configValueToMinVersionForCollab=e.getValidationForRuntimeOptions=e.isValidMinVersionForCollab=e.getConfigsForMinVersionForCollab=e.defaultMinVersionForCollab=void 0;const n=Je(),a=Ot(),t=px(),i=Fge();e.defaultMinVersionForCollab="2.0.0-defaults";const r="1.0.0";function s(d,l){const f={};for(const b of Object.keys(l)){const C=l[b],v=Object.keys(C).sort(t.compare);for(const m of v)if((0,t.gte)(d,m))f[b]=C[m];else break}return f}e.getConfigsForMinVersionForCollab=s;function o(d){return(0,t.valid)(d)!==null&&(0,t.gte)(d,r)&&(0,t.lte)(d,i.pkgVersion)}e.isValidMinVersionForCollab=o;function u(d,l,f){if(d!==e.defaultMinVersionForCollab)for(const[b,C]of Object.entries(l)){if(!(b in f))continue;const v=f[b](C);if(v!==void 0&&(0,t.gt)(v,d))throw new a.UsageError(`Runtime option ${b}:${JSON.stringify(C)} requires runtime version ${v}. Please update minVersionForCollab (currently ${d}) to ${v} or later to proceed.`)}}e.getValidationForRuntimeOptions=u;function c(d){const l=new Map(d);return f=>{if(typeof f!="object")return l.get(f);const b=[];for(const[C,v]of l.entries())(0,n.assert)(typeof C=="object",3001),Object.entries(C).some(([m,h])=>f[m]===h)&&b.push(v);if(b.length>0)return b.sort((C,v)=>(0,t.compare)(v,C))[0]}}e.configValueToMinVersionForCollab=c})(gj)),gj}var f6;function bn(){return f6||(f6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isValidMinVersionForCollab=e.getConfigsForMinVersionForCollab=e.getValidationForRuntimeOptions=e.defaultMinVersionForCollab=e.configValueToMinVersionForCollab=e.toDeltaManagerInternal=e.toDeltaManagerErased=e.isSnapshotFetchRequiredForLoadingGroupId=e.encodeCompactIdToString=e.seqFromTree=e.RuntimeHeaders=e.unpackChildNodesUsedRoutes=e.utf8ByteLength=e.TelemetryContext=e.SummaryTreeBuilder=e.processAttachMessageGCData=e.mergeStats=e.getBlobSize=e.GCDataBuilder=e.convertToSummaryTreeWithStats=e.convertToSummaryTree=e.convertSummaryTreeToITree=e.convertSnapshotTreeToSummaryTree=e.calculateStats=e.addSummarizeResultToSummary=e.addBlobToSummary=e.RuntimeFactoryHelper=e.RequestParser=e.RemoteFluidObjectHandle=e.listBlobsAtTreePath=e.getNormalizedObjectStoragePathParts=e.ObjectStoragePartition=e.toFluidHandleInternal=e.toFluidHandleErased=e.isSerializedHandle=e.isLocalFluidHandle=e.isFluidHandlePayloadPending=e.isFluidHandleInternalPayloadPending=e.isFluidHandle=e.FluidHandleBase=e.encodeHandleForSerialization=e.compareFluidHandles=e.responseToException=e.exceptionToResponse=e.createResponseError=e.create404Response=e.generateHandleContextPath=void 0;var n=mge();Object.defineProperty(e,"generateHandleContextPath",{enumerable:!0,get:function(){return n.generateHandleContextPath}});var a=Bie();Object.defineProperty(e,"create404Response",{enumerable:!0,get:function(){return a.create404Response}}),Object.defineProperty(e,"createResponseError",{enumerable:!0,get:function(){return a.createResponseError}}),Object.defineProperty(e,"exceptionToResponse",{enumerable:!0,get:function(){return a.exceptionToResponse}}),Object.defineProperty(e,"responseToException",{enumerable:!0,get:function(){return a.responseToException}});var t=Uie();Object.defineProperty(e,"compareFluidHandles",{enumerable:!0,get:function(){return t.compareFluidHandles}}),Object.defineProperty(e,"encodeHandleForSerialization",{enumerable:!0,get:function(){return t.encodeHandleForSerialization}}),Object.defineProperty(e,"FluidHandleBase",{enumerable:!0,get:function(){return t.FluidHandleBase}}),Object.defineProperty(e,"isFluidHandle",{enumerable:!0,get:function(){return t.isFluidHandle}}),Object.defineProperty(e,"isFluidHandleInternalPayloadPending",{enumerable:!0,get:function(){return t.isFluidHandleInternalPayloadPending}}),Object.defineProperty(e,"isFluidHandlePayloadPending",{enumerable:!0,get:function(){return t.isFluidHandlePayloadPending}}),Object.defineProperty(e,"isLocalFluidHandle",{enumerable:!0,get:function(){return t.isLocalFluidHandle}}),Object.defineProperty(e,"isSerializedHandle",{enumerable:!0,get:function(){return t.isSerializedHandle}}),Object.defineProperty(e,"toFluidHandleErased",{enumerable:!0,get:function(){return t.toFluidHandleErased}}),Object.defineProperty(e,"toFluidHandleInternal",{enumerable:!0,get:function(){return t.toFluidHandleInternal}});var i=pge();Object.defineProperty(e,"ObjectStoragePartition",{enumerable:!0,get:function(){return i.ObjectStoragePartition}});var r=gge();Object.defineProperty(e,"getNormalizedObjectStoragePathParts",{enumerable:!0,get:function(){return r.getNormalizedObjectStoragePathParts}}),Object.defineProperty(e,"listBlobsAtTreePath",{enumerable:!0,get:function(){return r.listBlobsAtTreePath}});var s=yge();Object.defineProperty(e,"RemoteFluidObjectHandle",{enumerable:!0,get:function(){return s.RemoteFluidObjectHandle}});var o=bge();Object.defineProperty(e,"RequestParser",{enumerable:!0,get:function(){return o.RequestParser}});var u=vge();Object.defineProperty(e,"RuntimeFactoryHelper",{enumerable:!0,get:function(){return u.RuntimeFactoryHelper}});var c=Pge();Object.defineProperty(e,"addBlobToSummary",{enumerable:!0,get:function(){return c.addBlobToSummary}}),Object.defineProperty(e,"addSummarizeResultToSummary",{enumerable:!0,get:function(){return c.addSummarizeResultToSummary}}),Object.defineProperty(e,"calculateStats",{enumerable:!0,get:function(){return c.calculateStats}}),Object.defineProperty(e,"convertSnapshotTreeToSummaryTree",{enumerable:!0,get:function(){return c.convertSnapshotTreeToSummaryTree}}),Object.defineProperty(e,"convertSummaryTreeToITree",{enumerable:!0,get:function(){return c.convertSummaryTreeToITree}}),Object.defineProperty(e,"convertToSummaryTree",{enumerable:!0,get:function(){return c.convertToSummaryTree}}),Object.defineProperty(e,"convertToSummaryTreeWithStats",{enumerable:!0,get:function(){return c.convertToSummaryTreeWithStats}}),Object.defineProperty(e,"GCDataBuilder",{enumerable:!0,get:function(){return c.GCDataBuilder}}),Object.defineProperty(e,"getBlobSize",{enumerable:!0,get:function(){return c.getBlobSize}}),Object.defineProperty(e,"mergeStats",{enumerable:!0,get:function(){return c.mergeStats}}),Object.defineProperty(e,"processAttachMessageGCData",{enumerable:!0,get:function(){return c.processAttachMessageGCData}}),Object.defineProperty(e,"SummaryTreeBuilder",{enumerable:!0,get:function(){return c.SummaryTreeBuilder}}),Object.defineProperty(e,"TelemetryContext",{enumerable:!0,get:function(){return c.TelemetryContext}}),Object.defineProperty(e,"utf8ByteLength",{enumerable:!0,get:function(){return c.utf8ByteLength}});var d=Ege();Object.defineProperty(e,"unpackChildNodesUsedRoutes",{enumerable:!0,get:function(){return d.unpackChildNodesUsedRoutes}});var l=zie();Object.defineProperty(e,"RuntimeHeaders",{enumerable:!0,get:function(){return l.RuntimeHeaders}}),Object.defineProperty(e,"seqFromTree",{enumerable:!0,get:function(){return l.seqFromTree}}),Object.defineProperty(e,"encodeCompactIdToString",{enumerable:!0,get:function(){return l.encodeCompactIdToString}});var f=Ige();Object.defineProperty(e,"isSnapshotFetchRequiredForLoadingGroupId",{enumerable:!0,get:function(){return f.isSnapshotFetchRequiredForLoadingGroupId}});var b=Rge();Object.defineProperty(e,"toDeltaManagerErased",{enumerable:!0,get:function(){return b.toDeltaManagerErased}}),Object.defineProperty(e,"toDeltaManagerInternal",{enumerable:!0,get:function(){return b.toDeltaManagerInternal}});var C=jge();Object.defineProperty(e,"configValueToMinVersionForCollab",{enumerable:!0,get:function(){return C.configValueToMinVersionForCollab}}),Object.defineProperty(e,"defaultMinVersionForCollab",{enumerable:!0,get:function(){return C.defaultMinVersionForCollab}}),Object.defineProperty(e,"getValidationForRuntimeOptions",{enumerable:!0,get:function(){return C.getValidationForRuntimeOptions}}),Object.defineProperty(e,"getConfigsForMinVersionForCollab",{enumerable:!0,get:function(){return C.getConfigsForMinVersionForCollab}}),Object.defineProperty(e,"isValidMinVersionForCollab",{enumerable:!0,get:function(){return C.isValidMinVersionForCollab}})})(fj)),fj}var h6;function Vie(){if(h6)return y0;h6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(y0,"__esModule",{value:!0}),y0.FluidObjectHandle=void 0;const e=bn();class n extends e.FluidHandleBase{get isAttached(){return this.routeContext.isAttached}constructor(t,i,r){super(),this.value=t,this.path=i,this.routeContext=r,this.absolutePath=(0,e.generateHandleContextPath)(i,this.routeContext)}async get(){return this.value}attachGraph(){this.routeContext.attachGraph()}}return y0.FluidObjectHandle=n,y0}var oo={},yj={},E0={},m6;function Mge(){if(m6)return E0;m6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(E0,"__esModule",{value:!0}),E0.ChannelDeltaConnection=void 0;const e=Je(),n=Ot(),a=Symbol();function t(){const u=[];return Object.defineProperty(u,a,{value:a,writable:!1,enumerable:!0}),u}function i(u){return Array.isArray(u)&&a in u&&u[a]===a}function r(u,c,d){if(i(c))for(const{contents:l,metadata:f}of c)d(l,f);else d(u,c)}function s(u){const c=[];for(const d of u)if(i(d.localOpMetadata))for(const{contents:l,metadata:f}of d.localOpMetadata)c.push({contents:l,localOpMetadata:f,clientSequenceNumber:d.clientSequenceNumber});else c.push(d);return c}class o{get handler(){return(0,e.assert)(!!this._handler,375),this._handler}get connected(){return this._connected}constructor(c,d,l,f){this._connected=c,this.submitFn=d,this.dirty=l,this.isAttachedAndVisible=f}attach(c){(0,e.assert)(this._handler===void 0,376),this._handler=c}setConnectionState(c){this._connected=c,this.handler.setConnectionState(c)}processMessages(c){try{const d=s(c.messagesContent);this.handler.processMessages({...c,messagesContent:d})}catch(d){throw n.DataProcessingError.wrapIfUnrecognized(d,"channelDeltaConnectionFailedToProcessMessages",c.envelope)}}reSubmit(c,d,l){r(c,d,(f,b)=>this.handler.reSubmit(f,b,l))}rollback(c,d){if(this.handler.rollback===void 0)throw new Error("Handler doesn't support rollback");r(c,d,this.handler.rollback.bind(this.handler))}applyStashedOp(c){try{return this.stashedOpMd=this.isAttachedAndVisible()?t():void 0,this.handler.applyStashedOp(c),this.stashedOpMd}finally{this.stashedOpMd=void 0}}submit(c,d){this.stashedOpMd===void 0?this.submitFn(c,d):this.stashedOpMd.push({contents:c,metadata:d})}}return E0.ChannelDeltaConnection=o,E0}var I0={},p6;function Nge(){if(p6)return I0;p6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(I0,"__esModule",{value:!0}),I0.ChannelStorageService=void 0;const e=Je(),n=bn();class a{static flattenTree(i,r,s){for(const[o,u]of Object.entries(r.trees))a.flattenTree(`${i}${o}/`,u,s);for(const[o,u]of Object.entries(r.blobs))s[`${i}${o}`]=u}constructor(i,r,s,o){this.tree=i,this.storage=r,this.logger=s,this.extraBlobs=o,this.flattenedTree={},i!==void 0&&a.flattenTree("",i,this.flattenedTree)}async contains(i){return this.flattenedTree[i]!==void 0}async readBlob(i){const r=await this.getIdForPath(i);(0,e.assert)(r!==void 0,2519);const s=this.extraBlobs===void 0?void 0:this.extraBlobs.get(r);if(s!==void 0)return s;const o=this.storage.readBlob(r);return o.catch(u=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},u)),o}async list(i){let r=this.tree;const s=(0,n.getNormalizedObjectStoragePathParts)(i);for(;r!==void 0&&s.length>0;){const o=s.shift();r=r.trees[o]}if(r===void 0||s.length>0)throw new Error("path does not exist");return Object.keys(r?.blobs??{})}getSnapshotTree(){return this.tree}async getIdForPath(i){return this.flattenedTree[i]}}return I0.ChannelStorageService=a,I0}var g6;function gx(){return g6||(g6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.loadChannel=e.loadChannelFactoryAndAttributes=e.summarizeChannelAsync=e.summarizeChannel=e.createChannelServiceEndpoints=e.attributesBlobKey=void 0;const n=Kn(),a=bn(),t=Ot(),i=Mge(),r=Nge();e.attributesBlobKey=".attributes";function s(l,f,b,C,v,m,h,g){const _=new i.ChannelDeltaConnection(l,(p,w)=>f(p,w),b,C),S=new r.ChannelStorageService(h,v,m,g);return{deltaConnection:_,objectStorage:S}}e.createChannelServiceEndpoints=s;function o(l,f=!1,b=!1,C){const v=l.getAttachSummary(f,b,C);return(0,a.addBlobToSummary)(v,e.attributesBlobKey,JSON.stringify(l.attributes)),v}e.summarizeChannel=o;async function u(l,f=!1,b=!1,C,v){const m=await l.summarize(f,b,C,v);return(0,a.addBlobToSummary)(m,e.attributesBlobKey,JSON.stringify(l.attributes)),m}e.summarizeChannelAsync=u;async function c(l,f,b,C,v){let m;await f.objectStorage.contains(e.attributesBlobKey)&&(m=await(0,n.readAndParse)(f.objectStorage,e.attributesBlobKey));const h=m?m.type:v;if(h===void 0)throw new t.DataCorruptionError("channelTypeNotAvailable",(0,t.tagCodeArtifacts)({channelId:b,dataStoreId:l.id,dataStorePackagePath:l.packagePath.join("/"),channelFactoryType:h}));const g=C.get(h);if(g===void 0)throw new t.DataCorruptionError("channelFactoryNotRegisteredForGivenType",(0,t.tagCodeArtifacts)({channelId:b,dataStoreId:l.id,dataStorePackagePath:l.packagePath.join("/"),channelFactoryType:h}));return m=m??g.attributes,{factory:g,attributes:m}}e.loadChannelFactoryAndAttributes=c;async function d(l,f,b,C,v,m){return f.snapshotFormatVersion!==void 0&&f.snapshotFormatVersion!==b.attributes.snapshotFormatVersion&&v.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",...(0,t.tagCodeArtifacts)({channelType:f.type,channelSnapshotVersion:`${f.snapshotFormatVersion}@${f.packageVersion}`,channelCodeVersion:`${b.attributes.snapshotFormatVersion}@${b.attributes.packageVersion}`})}),b.load(l,m,C,f)}e.loadChannel=d})(yj)),yj}var bj={},Pf={},y6;function Hie(){if(y6)return Pf;y6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Pf,"__esModule",{value:!0}),Pf.pkgVersion=Pf.pkgName=void 0,Pf.pkgName="@fluidframework/datastore",Pf.pkgVersion="2.60.0",Pf}var b6;function Kie(){return b6||(b6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.validateRuntimeCompatibility=e.runtimeSupportRequirementsForDataStore=e.dataStoreCompatDetailsForRuntime=e.dataStoreCoreCompatDetails=void 0;const n=Ht(),a=Ot(),t=Hie();e.dataStoreCoreCompatDetails={pkgVersion:t.pkgVersion,generation:1},e.dataStoreCompatDetailsForRuntime={...e.dataStoreCoreCompatDetails,supportedFeatures:new Set},e.runtimeSupportRequirementsForDataStore={minSupportedGeneration:0,requiredFeatures:[]};function i(r,s){const o=(0,n.checkLayerCompatibility)(e.runtimeSupportRequirementsForDataStore,r);if(!o.isCompatible){const u=new a.UsageError("DataStore is not compatible with Runtime",{errorDetails:JSON.stringify({dataStoreVersion:e.dataStoreCoreCompatDetails.pkgVersion,runtimeVersion:r?.pkgVersion,dataStoreGeneration:e.dataStoreCoreCompatDetails.generation,runtimeGeneration:r?.generation,minSupportedGeneration:e.runtimeSupportRequirementsForDataStore.minSupportedGeneration,isGenerationCompatible:o.isGenerationCompatible,unsupportedFeatures:o.unsupportedFeatures})});throw s(),u}}e.validateRuntimeCompatibility=i})(bj)),bj}var lu={},v6;function Age(){if(v6)return lu;v6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(lu,"__esModule",{value:!0}),lu.LocalChannelContext=lu.RehydratedLocalChannelContext=lu.LocalChannelContextBase=void 0;const e=Je(),n=Ot(),a=gx();class t{constructor(u,c,d,l,f){this.id=u,this.runtime=c,this.services=d,this.channelP=l,this._channel=f,this.globallyVisible=!1,this.pendingMessagesState={messageCollections:[],pendingCount:0},(0,e.assert)(!this.id.includes("/"),783)}get isGloballyVisible(){return this.globallyVisible}async getChannel(){return this._channel===void 0?this.channelP.then(u=>this._channel=u):this.channelP}get isLoaded(){return this._channel!==void 0}setConnectionState(u,c){this.globallyVisible&&this.isLoaded&&this.services.value.deltaConnection.setConnectionState(u)}processMessages(u){if((0,e.assert)(this.globallyVisible,723),this.isLoaded)this.services.value.deltaConnection.processMessages(u);else{(0,e.assert)(!u.local,393);const c={...u,messagesContent:[...u.messagesContent]};this.pendingMessagesState.messageCollections.push(c)}}reSubmit(u,c,d){(0,e.assert)(this.isLoaded,394),(0,e.assert)(this.globallyVisible,724),this.services.value.deltaConnection.reSubmit(u,c,d)}rollback(u,c){(0,e.assert)(this.isLoaded,750),(0,e.assert)(this.globallyVisible,751),this.services.value.deltaConnection.rollback(u,c)}async summarize(u=!1,c=!1,d){const l=await this.getChannel();return(0,a.summarizeChannelAsync)(l,u,c,d)}getAttachSummary(u){return(0,e.assert)(this._channel!==void 0,397),(0,a.summarizeChannel)(this._channel,!0,!1,u)}getAttachGCData(u){return(0,e.assert)(this._channel!==void 0,2301),this._channel.getGCData(!0)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&((0,e.assert)(!!this._channel,402),this._channel.connect(this.services.value)),this.globallyVisible=!0}async getGCData(u=!1){return(await this.getChannel()).getGCData(u)}updateUsedRoutes(u){}}lu.LocalChannelContextBase=t;class i extends t{constructor(u,c,d,l,f,b,C,v,m,h){super(u,d,new e.Lazy(()=>{const g=new Map(h),_=s(this.snapshotTree);return this.isSnapshotInOldFormatAndCollectBlobs(_,g)&&this.sanitizeSnapshot(_),(0,a.createChannelServiceEndpoints)(l.connected,C,this.dirtyFn,()=>this.isGloballyVisible,f,b,_,g)}),new e.LazyPromise(async()=>{try{const{attributes:g,factory:_}=await(0,a.loadChannelFactoryAndAttributes)(l,this.services.value,this.id,c),S=await(0,a.loadChannel)(d,g,_,this.services.value,b,this.id);for(const p of this.pendingMessagesState.messageCollections)this.services.value.deltaConnection.processMessages(p);return S}catch(g){throw n.DataProcessingError.wrapIfUnrecognized(g,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)}})),this.snapshotTree=m,this.dirtyFn=()=>{v(u)}}applyStashedOp(u){return this.services.value.deltaConnection.applyStashedOp(u)}isSnapshotInOldFormatAndCollectBlobs(u,c){let d=!1;const l=u.blobsContents;if(l!==void 0)for(const[f,b]of Object.entries(l))c.set(f,b),u.blobs[f]!==void 0&&(d=!0);for(const f of Object.values(u.trees))d=d||this.isSnapshotInOldFormatAndCollectBlobs(f,c);return d}sanitizeSnapshot(u){const c=new Map(Object.entries(u.blobs));for(const[d,l]of c.entries())c.get(l)===void 0&&delete u.blobs[d];for(const d of Object.values(u.trees))this.sanitizeSnapshot(d)}}lu.RehydratedLocalChannelContext=i;class r extends t{constructor(u,c,d,l,f,b,C){super(u.id,c,new e.Lazy(()=>(0,a.createChannelServiceEndpoints)(d.connected,b,this.dirtyFn,()=>this.isGloballyVisible,l,f)),Promise.resolve(u),u),this.channel=u,this.channel=u,this.dirtyFn=()=>{C(u.id)}}applyStashedOp(){throw new Error("no stashed ops on local channel")}}lu.LocalChannelContext=r;function s(o){const u={...o,blobs:{...o.blobs},trees:{}};for(const[c,d]of Object.entries(o.trees))u.trees[c]=s(d);return u}return lu}var R0={},S6;function Dge(){if(S6)return R0;S6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(R0,"__esModule",{value:!0}),R0.RemoteChannelContext=void 0;const e=Mr(),n=Je(),a=Ot(),t=gx();class i{constructor(s,o,u,c,d,l,f,b,C,v,m){this.id=l,this.isLoaded=!1,this.pendingMessagesState={messageCollections:[],pendingCount:0},(0,n.assert)(!this.id.includes("/"),784),this.subLogger=(0,a.createChildLogger)({logger:s.logger,namespace:"RemoteChannelContext"}),this.services=(0,t.createChannelServiceEndpoints)(o.connected,c,()=>d(this.id),()=>s.attachState!==e.AttachState.Detached,u,this.subLogger,f,C),this.channelP=new n.LazyPromise(async()=>{const{attributes:h,factory:g}=await(0,t.loadChannelFactoryAndAttributes)(o,this.services,this.id,b,m),_=await(0,t.loadChannel)(s,h,g,this.services,this.subLogger,this.id);(0,n.assert)(this.pendingMessagesState!==void 0,2668);for(const S of this.pendingMessagesState.messageCollections)this.services.deltaConnection.processMessages(S);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pendingMessagesState.pendingCount),this.channel=_,this.pendingMessagesState=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(o.connected),this.channel}),this.summarizerNode=v(async(h,g,_,S)=>this.summarizeInternal(h,g,_,S),async h=>this.getGCDataInternal(h)),this.thresholdOpsCounter=new a.ThresholdCounter(i.pendingOpsCountThreshold,this.subLogger)}getChannel(){return this.channelP}setConnectionState(s,o){this.isLoaded&&this.services.deltaConnection.setConnectionState(s)}applyStashedOp(s){return(0,n.assert)(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(s)}processMessages(s){const{envelope:o,messagesContent:u,local:c}=s;this.summarizerNode.invalidate(o.sequenceNumber),this.isLoaded?this.services.deltaConnection.processMessages(s):((0,n.assert)(!c,405),(0,n.assert)(this.pendingMessagesState!==void 0,2669),this.pendingMessagesState.messageCollections.push({...s,messagesContent:[...u]}),this.pendingMessagesState.pendingCount+=u.length,this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pendingMessagesState.pendingCount))}reSubmit(s,o,u){(0,n.assert)(this.isLoaded,406),this.services.deltaConnection.reSubmit(s,o,u)}rollback(s,o){(0,n.assert)(this.isLoaded,752),this.services.deltaConnection.rollback(s,o)}async summarize(s=!1,o=!0,u){return this.summarizerNode.summarize(s,o,u)}async summarizeInternal(s,o,u,c){const d=await this.getChannel();return{...await(0,t.summarizeChannelAsync)(d,s,o,u,c),id:this.id}}async getGCData(s=!1){return this.summarizerNode.getGCData(s)}async getGCDataInternal(s=!1){return(await this.getChannel()).getGCData(s)}updateUsedRoutes(s){this.summarizerNode.updateUsedRoutes([""])}}return R0.RemoteChannelContext=i,i.pendingOpsCountThreshold=1e3,R0}var C6;function kge(){if(C6)return oo;C6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(oo,"__esModule",{value:!0}),oo.mixinSummaryHandler=oo.mixinRequestHandler=oo.FluidDataStoreRuntime=oo.DataStoreMessageType=void 0;const e=Ht(),n=Mr(),a=Je(),t=on(),i=Kn(),r=ja(),s=bn(),o=Ot(),u=ys(),c=gx(),d=Kie(),l=Vie(),f=Age(),b=Hie(),C=Dge();function v(w,O){const{ILayerCompatDetails:E}=w;return E?.supportedFeatures.has(O)??!1}var m;(function(w){w.Attach="attach",w.ChannelOp="op"})(m||(oo.DataStoreMessageType=m={}));const h={readonlyInStagingMode:!0};function g(){let w=0;return{get value(){return w},set value(O){(0,a.assert)(O>=0,3005),w=O}}}class _ extends e.TypedEventEmitter{get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==n.AttachState.Detached}get attachState(){return this._attachState}get absolutePath(){return(0,s.generateHandleContextPath)(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get idCompressor(){return this.dataStoreContext.idCompressor}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}get logger(){return this.mc.logger}constructor(O,E,F,R,M){super(),this.dataStoreContext=O,this.sharedObjectRegistry=E,this.isReadOnly=()=>this._readonly,this._disposed=!1,this.contexts=new Map,this.pendingAttach=new Set,this.deferredAttached=new a.Deferred,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,this.ILayerCompatDetails=d.dataStoreCompatDetailsForRuntime,this.pendingOpCount=g(),(0,a.assert)(!O.id.includes("/"),782),this.policies={...h,...M};const{ILayerCompatDetails:j}=O;(0,d.validateRuntimeCompatibility)(j,this.dispose.bind(this)),v(O,r.notifiesReadOnlyState)?this._readonly=O.isReadOnly():(this._readonly=this.dataStoreContext.deltaManager.readOnlyInfo.readonly===!0,this.dataStoreContext.deltaManager.on("readonly",x=>this.notifyReadOnlyState(x))),this.submitMessagesWithoutEncodingHandles=v(O,r.encodeHandlesInContainerRuntime),(0,a.debugAssert)(()=>this.submitMessagesWithoutEncodingHandles!==void 0),this.mc=(0,o.createChildMonitoringContext)({logger:O.baseLogger,namespace:"FluidDataStoreRuntime",properties:{all:{dataStoreId:(0,u.v4)(),dataStoreVersion:b.pkgVersion}}}),this.id=O.id,this.options=O.options,this.deltaManagerInternal=O.deltaManager,this.quorum=O.getQuorum(),this.audience=O.getAudience();const k=O.baseSnapshot;if(k?.trees!==void 0)for(const[x,L]of Object.entries(k.trees)){if(x==="_search")continue;let V;O.isLocalDataStore?(V=this.createRehydratedLocalChannelContext(x,L),O.attachState===n.AttachState.Detached?this.localChannelContextQueue.set(x,V):V.makeVisible()):V=new C.RemoteChannelContext(this,O,O.storage,(G,ee)=>this.submitChannelOp(x,G,ee),G=>this.setChannelDirty(G),x,L,this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(x,{type:r.CreateSummarizerNodeSource.FromSummary})),this.contexts.set(x,V)}this.entryPoint=new l.FluidObjectHandle(new a.LazyPromise(async()=>R(this)),"",this.objectsRoutingContext),this.attachListener(),this._attachState=O.attachState,F?this.visibilityState=O.attachState===n.AttachState.Detached?r.VisibilityState.LocallyVisible:r.VisibilityState.GloballyVisible:this.visibilityState=r.VisibilityState.NotVisible,F&&this.deferredAttached.resolve(),this.localChangesTelemetryCount=this.mc.config.getNumber("Fluid.Telemetry.LocalChangesTelemetryCount")??10,this.inStagingMode,this.isDirty}get inStagingMode(){return this.dataStoreContext.containerRuntime?.inStagingMode}get isDirty(){return this.pendingOpCount.value>0}get deltaManager(){return(0,s.toDeltaManagerErased)(this.deltaManagerInternal)}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(O){return this.request(O)}async request(O){try{const E=s.RequestParser.create(O);if(E.pathParts.length===0&&O.headers?.viaHandle===!0)return{mimeType:"fluid/object",status:200,value:await this.entryPoint.get()};const F=E.pathParts[0];if(F==="_channels"||F==="_custom")return await this.request(E.createSubRequest(1));if(F!==void 0){const R=this.contexts.get(F);if(R!==void 0&&E.isLeaf(1))try{return{mimeType:"fluid/object",status:200,value:await R.getChannel()}}catch(M){return this.mc.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},M),(0,s.createResponseError)(500,`Failed to get Channel: ${M}`,O)}}return(0,s.create404Response)(O)}catch(E){return(0,s.exceptionToResponse)(E)}}async getChannel(O){this.verifyNotClosed();const E=this.contexts.get(O);if(E===void 0)throw new o.LoggingError("Channel does not exist");return E.getChannel()}validateChannelId(O){if(O.includes("/"))throw new o.UsageError(`Id cannot contain slashes: ${O}`);if(O.startsWith("_"))throw new o.UsageError(`Id cannot start with underscore: ${O}`)}addChannel(O){const E=O.id;this.validateChannelId(E),this.verifyNotClosed(),(0,a.assert)(!this.contexts.has(E),2149);const F=O.attributes.type;if(this.sharedObjectRegistry.get(O.attributes.type)===void 0)throw new Error(`Channel Factory ${F} not registered`);this.createChannelContext(O),this.identifyLocalChangeInSummarizer("DDSCreatedInSummarizer",E,F)}createChannel(O,E){let F;if(O===void 0){if(this.mc.config.getBoolean("Fluid.Runtime.DisableShortIds")===!0)F=(0,u.v4)();else if(this.visibilityState===r.VisibilityState.GloballyVisible){const j=this.dataStoreContext.containerRuntime.generateDocumentUniqueId?.()??(0,u.v4)();F=typeof j=="number"?(0,s.encodeCompactIdToString)(2*j+1,"_"):j}else F=(0,s.encodeCompactIdToString)(2*this.contexts.size,"_");(0,a.assert)(!F.includes("/"),2300)}else F=O,this.validateChannelId(F);this.verifyNotClosed(),(0,a.assert)(!this.contexts.has(F),377),(0,a.assert)(E!==void 0,521);const R=this.sharedObjectRegistry.get(E);if(R===void 0)throw new Error(`Channel Factory ${E} not registered`);const M=R.create(this,F);return this.createChannelContext(M),this.identifyLocalChangeInSummarizer("DDSCreatedInSummarizer",F,E),M}createChannelContext(O){this.notBoundedChannelContextSet.add(O.id);const E=new f.LocalChannelContext(O,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(F,R)=>this.submitChannelOp(O.id,F,R),F=>this.setChannelDirty(F));this.contexts.set(O.id,E)}createRehydratedLocalChannelContext(O,E,F){return new f.RehydratedLocalChannelContext(O,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(R,M)=>this.submitChannelOp(O,R,M),R=>this.setChannelDirty(R),E,F)}bindChannel(O){if((0,a.assert)(this.notBoundedChannelContextSet.has(O.id),379),this.notBoundedChannelContextSet.delete(O.id),this.isAttached){this.makeChannelLocallyVisible(O);return}this.pendingHandlesToMakeVisible.has((0,s.toFluidHandleInternal)(O.handle))||(this.bind(O.handle),this.localChannelContextQueue.has(O.id)||this.localChannelContextQueue.set(O.id,this.contexts.get(O.id)))}makeVisibleAndAttachGraph(){if(this.visibilityState===r.VisibilityState.NotVisible){this.visibilityState=r.VisibilityState.LocallyVisible;for(const O of this.pendingHandlesToMakeVisible)O.attachGraph();this.pendingHandlesToMakeVisible.clear(),this.dataStoreContext.makeLocallyVisible()}}attachGraph(){this.makeVisibleAndAttachGraph()}bind(O){if(this.visibilityState!==r.VisibilityState.NotVisible){(0,s.toFluidHandleInternal)(O).attachGraph();return}this.pendingHandlesToMakeVisible.add((0,s.toFluidHandleInternal)(O))}setConnectionState(O,E){this.verifyNotClosed();for(const[,F]of this.contexts)F.setConnectionState(O,E);(0,o.raiseConnectedEvent)(this.logger,this,O,E)}notifyReadOnlyState(O){this.verifyNotClosed(),O!==this._readonly&&(this._readonly=O,this.emit("readonly",O))}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(O,E){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(O,E)}createRemoteChannelContext(O,E){const F=new Map,R=(0,i.buildSnapshotTree)(O.snapshot.entries,F);return new C.RemoteChannelContext(this,this.dataStoreContext,this.dataStoreContext.storage,(M,j)=>this.submitChannelOp(O.id,M,j),M=>this.setChannelDirty(M),O.id,R,this.sharedObjectRegistry,F,this.dataStoreContext.getCreateChildSummarizerNodeFn(O.id,E),O.type)}processChannelMessages(O){this.verifyNotClosed();let E,F=[];const{messagesContent:R,local:M,envelope:j}=O,k=()=>{if(E===void 0)return;const x=this.contexts.get(E);(0,a.assert)(!!x,2667),x.processMessages({envelope:j,messagesContent:F,local:M}),F=[]};for(const{contents:x,...L}of R){const V=x;E!==V.address&&k(),F.push({contents:V.contents,...L}),E=V.address}k()}processAttachMessages(O){const{envelope:E,messagesContent:F,local:R}=O;for(const{contents:M}of F){const j=M,k=j.id;if((0,s.processAttachMessageGCData)(j.snapshot,(x,L)=>{const V=`/${this.id}/${k}${x==="/"?"":x}`;this.dataStoreContext.addedGCOutboundRoute(V,L,E.timestamp)}),R)(0,a.assert)(this.pendingAttach.delete(k),380);else{(0,a.assert)(!this.contexts.has(k),381);const x={type:r.CreateSummarizerNodeSource.FromAttach,sequenceNumber:E.sequenceNumber,snapshot:j.snapshot},L=this.createRemoteChannelContext(j,x);this.contexts.set(k,L)}}}processMessages(O){this.verifyNotClosed();const{envelope:E,local:F,messagesContent:R}=O;F&&(this.pendingOpCount.value-=R.length);try{switch(E.type){case m.ChannelOp:{this.processChannelMessages(O);break}case m.Attach:{this.processAttachMessages(O);break}default:}}catch(M){throw o.DataProcessingError.wrapIfUnrecognized(M,"fluidDataStoreRuntimeFailedToProcessMessage",E)}for(const{contents:M,clientSequenceNumber:j}of R)this.emit("op",{...E,contents:M,clientSequenceNumber:j})}processSignal(O,E){this.emit("signal",O,E)}isChannelAttached(O){return!this.notBoundedChannelContextSet.has(O)&&!this.localChannelContextQueue.has(O)&&!this.pendingAttach.has(O)}getOutboundRoutes(){const O=[];for(const[E]of this.contexts)O.push(`${this.absolutePath}/${E}`);return O}updateGCNodes(O){O.addRouteToAllNodes(this.absolutePath),O.addNode("/",this.getOutboundRoutes())}async summarize(O=!1,E=!0,F){const R=new s.SummaryTreeBuilder;return await this.visitContextsDuringSummary(async(M,j)=>{const k=await j.summarize(O,E,F);R.addWithStats(M,k)}),R.getSummaryTree()}async getGCData(O=!1){const E=new s.GCDataBuilder;return await this.visitContextsDuringSummary(async(F,R)=>{const M=await R.getGCData(O);E.prefixAndAddNodes(F,M.gcNodes)}),this.updateGCNodes(E),E.getGCData()}updateUsedRoutes(O){const E=(0,s.unpackChildNodesUsedRoutes)(O);for(const[F]of E)(0,a.assert)(this.contexts.has(F),382);for(const[F,R]of this.contexts)R.updateUsedRoutes(E.get(F)??[])}getAttachSummary(O){const E=new s.SummaryTreeBuilder;return this.visitLocalBoundContextsDuringAttach((F,R)=>{let M;if(R.isLoaded){const j=R.getAttachSummary(O);(0,a.assert)(j.summary.type===t.SummaryType.Tree,384),M={stats:j.stats,summary:j.summary}}else(0,a.assert)(!!this.dataStoreContext.baseSnapshot,385),M=(0,s.convertSnapshotTreeToSummaryTree)(this.dataStoreContext.baseSnapshot.trees[F]);E.addWithStats(F,M)}),E.getSummaryTree()}getAttachGCData(O){const E=new s.GCDataBuilder;return this.visitLocalBoundContextsDuringAttach((F,R)=>{if(R.isLoaded){const M=R.getAttachGCData(O);E.prefixAndAddNodes(F,M.gcNodes)}}),this.updateGCNodes(E),E.getGCData()}async visitContextsDuringSummary(O){for(const[E,F]of this.contexts){const R=this.isChannelAttached(E);(0,a.assert)(R,383),await O(E,F)}}visitLocalBoundContextsDuringAttach(O){(0,a.assert)(this.visibilityState===r.VisibilityState.LocallyVisible,3116);const E=new Set;let F=-1;for(;F!==E.size;){F=E.size;for(const[R,M]of this.contexts){if(!(M instanceof f.LocalChannelContextBase))throw new o.LoggingError("Should only be called with local channel handles");!E.has(R)&&!this.notBoundedChannelContextSet.has(R)&&(O(R,M),E.add(R))}}}submitMessage(O,E,F){this.submit(O,E,F)}submitSignal(O,E,F){this.verifyNotClosed(),this.dataStoreContext.submitSignal(O,E,F)}async waitAttached(){return this.deferredAttached.promise}makeChannelLocallyVisible(O){if(this.verifyNotClosed(),O.handle.isAttached)return;(0,s.toFluidHandleInternal)(O.handle).attachGraph(),(0,a.assert)(this.isAttached,386),(0,a.assert)(this.visibilityState===r.VisibilityState.GloballyVisible,720);const E=(0,c.summarizeChannel)(O,!0,!1),F=O.getGCData(!0);(0,s.addBlobToSummary)(E,r.gcDataBlobKey,JSON.stringify(F));const R=(0,s.convertSummaryTreeToITree)(E.summary),M={id:O.id,snapshot:R,type:O.attributes.type};this.pendingAttach.add(O.id),this.submit(m.Attach,M),this.contexts.get(O.id).makeVisible()}submitChannelOp(O,E,F){const R={address:O,contents:E};this.submit(m.ChannelOp,R,F)}submit(O,E,F=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(O,E,F),++this.pendingOpCount.value}reSubmit(O,E,F,R){switch(this.verifyNotClosed(),--this.pendingOpCount.value,O){case m.ChannelOp:{const M=E,j=this.contexts.get(M.address);(0,a.assert)(!!j,387),j.reSubmit(M.contents,F,R);break}case m.Attach:{this.submit(O,E,F);break}default:(0,a.unreachableCase)(O)}}rollback(O,E,F){switch(this.verifyNotClosed(),--this.pendingOpCount.value,O){case m.ChannelOp:{const R=E,M=this.contexts.get(R.address);(0,a.assert)(!!M,749),M.rollback(R.contents,F);break}default:throw new o.LoggingError(`Can't rollback ${O} message`)}}async applyStashedOp(O){++this.pendingOpCount.value;const E=O?.type;switch(E){case m.Attach:{const F=O.content,R=new Map,M=(0,i.buildSnapshotTree)(F.snapshot.entries,R),j=this.createRehydratedLocalChannelContext(F.id,M,R);await j.getChannel(),this.contexts.set(F.id,j),this.attachState===n.AttachState.Detached?this.localChannelContextQueue.set(F.id,j):(j.makeVisible(),this.pendingAttach.add(F.id));return}case m.ChannelOp:{const F=O.content,R=this.contexts.get(F.address);return(0,a.assert)(!!R,388),await R.getChannel(),R.applyStashedOp(F.contents)}default:(0,a.unreachableCase)(E)}}setChannelDirty(O){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(O)}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once?.("attaching",()=>{this.setAttachState(n.AttachState.Attaching)}),this.dataStoreContext.once?.("attached",()=>{this.setAttachState(n.AttachState.Attached)})}verifyNotClosed(){if(this._disposed)throw new o.LoggingError("Runtime is closed")}identifyLocalChangeInSummarizer(O,E,F){this.clientDetails.type!=="summarizer"||this.localChangesTelemetryCount<=0||(this.mc.logger.sendTelemetryEvent({eventName:O,...(0,o.tagCodeArtifacts)({channelType:F,channelId:E,fluidDataStoreId:this.id,fluidDataStorePackagePath:this.dataStoreContext.packagePath.join("/")}),stack:(0,o.generateStack)(30)}),this.localChangesTelemetryCount--)}setAttachState(O){switch(O){case n.AttachState.Attaching:{this.attachGraph(),this._attachState=n.AttachState.Attaching,(0,a.assert)(this.visibilityState===r.VisibilityState.LocallyVisible,721),this.visibilityState=r.VisibilityState.GloballyVisible;for(const[,E]of this.localChannelContextQueue)E.makeVisible();this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching");break}case n.AttachState.Attached:{(0,a.assert)(this.visibilityState===r.VisibilityState.GloballyVisible,722),this._attachState=n.AttachState.Attached,this.emit("attached");break}default:(0,a.unreachableCase)(O,"unreached")}}}oo.FluidDataStoreRuntime=_;const S=(w,O=_)=>class extends O{async request(F){const R=await super.request(F);return R.status===404?w(F,this):R}};oo.mixinRequestHandler=S;const p=(w,O=_)=>class extends O{addBlob(F,R,M){const j=R.shift();if(j===void 0)throw new o.LoggingError("Path can't be empty");let k={type:t.SummaryType.Blob,content:M};F.stats.blobNodeCount++,F.stats.totalBlobSize+=M.length;for(const x of R.reverse())k={type:t.SummaryType.Tree,tree:{[x]:k}},F.stats.treeNodeCount++;F.summary.tree[j]=k}async summarize(...F){const R=await super.summarize(...F);try{const M=await w(this);M!==void 0&&this.addBlob(R,M.path,M.content)}catch(M){throw o.DataProcessingError.wrapIfUnrecognized(M,"mixinSummaryHandler")}return R}};return oo.mixinSummaryHandler=p,oo}var _6;function yx(){return _6||(_6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.runtimeSupportRequirementsForDataStore=e.dataStoreCompatDetailsForRuntime=e.dataStoreCoreCompatDetails=e.mixinSummaryHandler=e.mixinRequestHandler=e.FluidDataStoreRuntime=e.DataStoreMessageType=e.FluidObjectHandle=void 0;var n=Vie();Object.defineProperty(e,"FluidObjectHandle",{enumerable:!0,get:function(){return n.FluidObjectHandle}});var a=kge();Object.defineProperty(e,"DataStoreMessageType",{enumerable:!0,get:function(){return a.DataStoreMessageType}}),Object.defineProperty(e,"FluidDataStoreRuntime",{enumerable:!0,get:function(){return a.FluidDataStoreRuntime}}),Object.defineProperty(e,"mixinRequestHandler",{enumerable:!0,get:function(){return a.mixinRequestHandler}}),Object.defineProperty(e,"mixinSummaryHandler",{enumerable:!0,get:function(){return a.mixinSummaryHandler}});var t=Kie();Object.defineProperty(e,"dataStoreCoreCompatDetails",{enumerable:!0,get:function(){return t.dataStoreCoreCompatDetails}}),Object.defineProperty(e,"dataStoreCompatDetailsForRuntime",{enumerable:!0,get:function(){return t.dataStoreCompatDetailsForRuntime}}),Object.defineProperty(e,"runtimeSupportRequirementsForDataStore",{enumerable:!0,get:function(){return t.runtimeSupportRequirementsForDataStore}})})(lj)),lj}var T6;function bx(){if(T6)return Cf;T6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Cf,"__esModule",{value:!0}),Cf.SharedObjectHandle=Cf.isISharedObjectHandle=void 0;const e=yx(),n=bn();function a(i){return(0,n.isFluidHandle)(i)&&typeof i.bind=="function"}Cf.isISharedObjectHandle=a;class t extends e.FluidObjectHandle{get isAttached(){return this.value.isAttached()}get isVisible(){return this.isAttached||this.isLocallyVisible}constructor(r,s,o){super(r,s,o.IFluidHandleContext),this.value=r,this.runtime=o,this.isLocallyVisible=!1,this.pendingHandles=new Set}attachGraph(){if(!this.isVisible){this.isLocallyVisible=!0;for(const r of this.pendingHandles)r.attachGraph();this.pendingHandles.clear(),this.value.bindToContext(),super.attachGraph()}}bind(r){if(this.runtime.inStagingMode!==!0){if(this.isVisible){r.attachGraph();return}this.pendingHandles.add(r)}}}return Cf.SharedObjectHandle=t,Cf}var F0={},w6;function vx(){if(w6)return F0;w6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(F0,"__esModule",{value:!0}),F0.FluidSerializer=void 0;const e=Je(),n=bn(),a=bx();class t{constructor(r){for(this.context=r,this.root=this.context;this.root.routeContext!==void 0;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(r,s){return(0,e.assert)((0,a.isISharedObjectHandle)(s),2956),r&&typeof r=="object"?this.recursivelyReplace(r,this.encodeValue.bind(this),s):r}decode(r){return r&&typeof r=="object"?this.recursivelyReplace(r,this.decodeValue.bind(this)):r}stringify(r,s){return(0,e.assert)((0,a.isISharedObjectHandle)(s),2957),JSON.stringify(r,(o,u)=>this.encodeValue(u,s))}parse(r){return JSON.parse(r,(s,o)=>this.decodeValue(o))}encodeValue(r,s){return(0,n.isFluidHandle)(r)?((0,e.assert)(s!==void 0,2707),this.bindAndEncodeHandle((0,n.toFluidHandleInternal)(r),s)):r}decodeValue(r){if((0,n.isSerializedHandle)(r)){const s=r.url.startsWith("/")?r.url:(0,n.generateHandleContextPath)(r.url,this.context);return new n.RemoteFluidObjectHandle(s,this.root,r.payloadPending===!0)}else return r}recursivelyReplace(r,s,o){const u=s(r,o);if((0,n.isFluidHandle)(r)||(0,n.isFluidHandle)(u))return u;let c;for(const d of Object.keys(r)){const l=r[d];if(l&&typeof l=="object"){const f=this.recursivelyReplace(l,s,o);f!==l&&(c??=(0,e.shallowCloneObject)(r),c[d]=f)}}return c??r}bindAndEncodeHandle(r,s){return s.bind(r),(0,n.encodeHandleForSerialization)(r)}}return F0.FluidSerializer=t,F0}var fu={},j0={},O6;function xge(){if(O6)return j0;O6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(j0,"__esModule",{value:!0}),j0.GCHandleVisitor=void 0;const e=vx();class n extends e.FluidSerializer{constructor(){super(...arguments),this.visitedHandlePaths=new Set}getVisitedHandlePaths(){return[...this.visitedHandlePaths]}bindAndEncodeHandle(t){return this.visitedHandlePaths.add(t.absolutePath),{type:"__fluid_handle__",url:"UNUSED (see GCHandleVisitor)"}}}return j0.GCHandleVisitor=n,j0}var ma={},P6;function $ie(){if(P6)return ma;P6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ma,"__esModule",{value:!0}),ma.bindHandles=ma.createSingleBlobSummary=ma.parseHandles=ma.makeHandlesSerializable=ma.serializeHandles=void 0;const e=bn();function n(s,o,u){return s===void 0?s:o.stringify(s,u)}ma.serializeHandles=n;function a(s,o,u){return o.encode(s,u)}ma.makeHandlesSerializable=a;function t(s,o){return o.decode(s)}ma.parseHandles=t;function i(s,o){const u=new e.SummaryTreeBuilder;return u.addBlob(s,o),u.getSummaryTree()}ma.createSingleBlobSummary=i;function r(s,o,u){return o.encode(s,u),s}return ma.bindHandles=r,ma}var E6;function Gie(){if(E6)return fu;E6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(fu,"__esModule",{value:!0}),fu.createSharedObjectKind=fu.SharedObject=fu.SharedObjectCore=void 0;const e=Mr(),n=Je(),a=ja(),t=bn(),i=Ot(),r=ys(),s=xge(),o=bx(),u=vx(),c=$ie();class d extends i.EventEmitterWithErrorHandling{get IFluidLoadable(){return this}get connected(){return this._connected}constructor(h,g,_){super((O,E)=>this.eventListenerErrorHandler(O,E)),this.id=h,this.runtime=g,this.attributes=_,this._connected=!1,this._isBoundToContext=!1,(0,n.assert)(!h.includes("/"),772),this.handle=new o.SharedObjectHandle(this,h,g),this.logger=(0,i.createChildLogger)({logger:g.logger,properties:{all:{sharedObjectId:(0,r.v4)(),...(0,i.tagCodeArtifacts)({ddsType:this.attributes.type})}}}),this.mc=(0,i.loggerToMonitoringContext)(this.logger);const{opProcessingHelper:S,callbacksHelper:p}=this.setUpSampledTelemetryHelpers();this.opProcessingHelper=S,this.callbacksHelper=p;const w=this.processMessagesCore?.bind(this);this.processMessagesHelper=w===void 0?O=>v(O,this.process.bind(this)):O=>{C(O,this.opProcessingHelper,this.emitInternal.bind(this),w)}}get deltaManager(){return(0,t.toDeltaManagerInternal)(this.runtime.deltaManager)}setUpSampledTelemetryHelpers(){(0,n.assert)(this.mc!==void 0&&this.logger!==void 0,841);const h=new i.SampledTelemetryHelper({eventName:"ddsOpProcessing",category:"performance"},this.logger,this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling")??1e3,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),g=new i.SampledTelemetryHelper({eventName:"ddsEventCallbacks",category:"performance"},this.logger,this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling")??1e3,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),{opProcessingHelper:h,callbacksHelper:g}}closeWithError(h){this.closeError===void 0&&(this.closeError=h)}verifyNotClosed(){if(this.closeError!==void 0)throw this.closeError}eventListenerErrorHandler(h,g){const _=i.DataProcessingError.wrapIfUnrecognized(g,"SharedObjectEventListenerException");throw _.addTelemetryProperties({emittedEventName:String(h)}),this.closeWithError(_),_}setBoundAndHandleAttach(){this.setBoundAndHandleAttach=()=>this.setConnectionState(this.runtime.connected),this._isBoundToContext=!0;const h=()=>{this.didAttach(),this.setConnectionState(this.runtime.connected)};this.isAttached()?h():this.runtime.once("attaching",h)}async load(h){this.services=h,this._isBoundToContext=!0,await this.loadCore(h.objectStorage),this.attachDeltaHandler(),this.setBoundAndHandleAttach()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this.bindToContext=()=>{},this._isBoundToContext||(this.runtime.bindChannel(this),this.setBoundAndHandleAttach())}connect(h){this.services===void 0&&(this.services=h,this.attachDeltaHandler()),this.setBoundAndHandleAttach()}isAttached(){return this._isBoundToContext&&this.runtime.attachState!==e.AttachState.Detached}initializeLocalCore(){}didAttach(){}submitLocalMessage(h,g=void 0){if(this.verifyNotClosed(),this.isAttached()){const S=this.runtime.submitMessagesWithoutEncodingHandles===!0?(0,c.bindHandles)(h,this.serializer,this.handle):(0,c.makeHandlesSerializable)(h,this.serializer,this.handle);this.services.deltaConnection.submit(S,g)}}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(h,g){this.submitLocalMessage(h,g)}reSubmitSquashed(h,g){(0,i.loggerToMonitoringContext)(this.logger).config.getBoolean("Fluid.SharedObject.AllowStagingModeWithoutSquashing")??this.runtime.options.allowStagingModeWithoutSquashing??!0?this.reSubmitCore(h,g):this.throwUnsupported("reSubmitSquashed")}async newAckBasedPromise(h){let g;return new Promise((_,S)=>{if(g=()=>S(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){g();return}this.runtime.on("dispose",g),h(_,S)}).finally(()=>{this.runtime.off("dispose",g)})}attachDeltaHandler(){(0,n.assert)(this.services!==void 0,122),this.services.deltaConnection.attach({processMessages:h=>{this.processMessages(h)},setConnectionState:h=>{this.setConnectionState(h)},reSubmit:(h,g,_)=>{this.reSubmit(h,g,_)},applyStashedOp:h=>{this.applyStashedOp((0,c.parseHandles)(h,this.serializer))},rollback:(h,g)=>{this.rollback(h,g)}})}setConnectionState(h){!this.isAttached()||this._connected===h||(this._connected=h,h?this.onConnect():this.onDisconnect())}process(h,g,_){this.verifyNotClosed(),this.emitInternal("pre-op",h,g,this),this.opProcessingHelper.measure(()=>(this.processCore(h,g,_),{customData:{sequenceDifference:h.sequenceNumber-h.referenceSequenceNumber}}),g?"local":"remote"),this.emitInternal("op",h,g,this)}processMessages(h){this.verifyNotClosed();const g=[];for(const{contents:S,localOpMetadata:p,clientSequenceNumber:w}of h.messagesContent){const O={contents:(0,c.parseHandles)(S,this.serializer),localOpMetadata:p,clientSequenceNumber:w};g.push(O)}const _={...h,messagesContent:g};this.processMessagesHelper(_)}reSubmit(h,g,_){_??!1?this.reSubmitSquashed(h,g):this.reSubmitCore(h,g)}rollback(h,g){this.throwUnsupported("rollback")}emit(h,...g){return this.callbacksHelper.measure(()=>super.emit(h,...g))}emitInternal(h,...g){return super.emit(h,...g)}throwUnsupported(h){throw new i.LoggingError("Unsupported DDS feature",{featureName:h,...(0,i.tagCodeArtifacts)({ddsType:this.attributes.type})})}}fu.SharedObjectCore=d;class l extends d{get serializer(){return(0,n.assert)(!this._isGCing,117),this._serializer}constructor(h,g,_,S){super(h,g,_),this.telemetryContextPrefix=S,this._isGCing=!1,this._serializer=new u.FluidSerializer(this.runtime.channelsRoutingContext)}getAttachSummary(h=!1,g=!1,_){const S=this.summarizeCore(this.serializer,_,void 0,h);return this.incrementTelemetryMetric(a.blobCountPropertyName,S.stats.blobNodeCount,_),this.incrementTelemetryMetric(a.totalBlobSizePropertyName,S.stats.totalBlobSize,_),S}async summarize(h=!1,g=!1,_,S){const p=this.summarizeCore(this.serializer,_,S,h);return this.incrementTelemetryMetric(a.blobCountPropertyName,p.stats.blobNodeCount,_),this.incrementTelemetryMetric(a.totalBlobSizePropertyName,p.stats.totalBlobSize,_),p}getGCData(h=!1){(0,n.assert)(!this._isGCing,120),this._isGCing=!0;let g;try{const _=new s.GCHandleVisitor(this.runtime.channelsRoutingContext);this.processGCDataCore(_),g={gcNodes:{"/":_.getVisitedHandlePaths()}},(0,n.assert)(this._isGCing,121)}finally{this._isGCing=!1}return g}processGCDataCore(h){this.summarizeCore(h)}incrementTelemetryMetric(h,g,_){if(_!==void 0){(0,n.assert)("get"in _&&typeof _.get=="function",2430);const S=_.get(this.telemetryContextPrefix,h)??0;_.set(this.telemetryContextPrefix,h,S+g)}}}fu.SharedObject=l;function f(m){return{getFactory(){return new m},create(g,_){return g.createChannel(_,m.Type)},is(g){return b(g)&&g.attributes.type===m.Type}}}fu.createSharedObjectKind=f;function b(m){return m.attributes!==void 0}function C(m,h,g,_){const{envelope:S,local:p,messagesContent:w}=m,O=(E,F)=>{for(const{contents:R,clientSequenceNumber:M}of F){const j={...S,contents:R,clientSequenceNumber:M};g(E,j,p)}};O("pre-op",w),h.measure(()=>(_(m),{customData:{sequenceDifference:S.sequenceNumber-S.referenceSequenceNumber}}),p?"local":"remote"),O("op",w)}function v(m,h){const{envelope:g,local:_,messagesContent:S}=m;for(const{contents:p,localOpMetadata:w,clientSequenceNumber:O}of S)h({...g,contents:p,clientSequenceNumber:O},_,w)}return fu}var M0={},I6;function qge(){if(I6)return M0;I6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(M0,"__esModule",{value:!0}),M0.ValueType=void 0;var e;return(function(n){n[n.Shared=0]="Shared",n[n.Plain=1]="Plain"})(e||(M0.ValueType=e={})),M0}var Ef={},R6;function Lge(){return R6||(R6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=Ef&&Ef.__classPrivateFieldSet||function(v,m,h,g,_){if(g==="m")throw new TypeError("Private method is not writable");if(g==="a"&&!_)throw new TypeError("Private accessor was defined without a setter");if(typeof m=="function"?v!==m||!_:!m.has(v))throw new TypeError("Cannot write private member to an object whose class did not declare it");return g==="a"?_.call(v,h):_?_.value=h:m.set(v,h),h},a=Ef&&Ef.__classPrivateFieldGet||function(v,m,h,g){if(h==="a"&&!g)throw new TypeError("Private accessor was defined without a getter");if(typeof m=="function"?v!==m||!g:!m.has(v))throw new TypeError("Cannot read private member from an object whose class did not declare it");return h==="m"?g:h==="a"?g.call(v):g?g.value:m.get(v)},t,i,r,s,o;Object.defineProperty(e,"__esModule",{value:!0}),e.makeSharedObjectKind=e.mergeAPIs=e.thisWrap=void 0;const u=Je(),c=Gie();class d extends c.SharedObject{constructor(m,h,g,_,S){super(m,h,g,S),t.add(this),this.factory=_,i.set(this,void 0),r.set(this,void 0),n(this,r,{sharedObject:this,serializer:this.serializer,submitLocalMessage:(p,w)=>this.submitLocalMessage(p,w),eventEmitter:this,logger:this.logger,idCompressor:h.idCompressor,lastSequenceNumber:()=>this.deltaManager.lastSequenceNumber},"f")}summarizeCore(m,h,g,_){return a(this,t,"a",o).summarizeCore(m,h,g,_)}initializeLocalCore(){a(this,t,"m",s).call(this,this.factory.create(a(this,r,"f")))}async loadCore(m){a(this,t,"m",s).call(this,await this.factory.loadCore(a(this,r,"f"),m))}onDisconnect(){a(this,t,"a",o).onDisconnect()}reSubmitCore(m,h){a(this,t,"a",o).reSubmitCore(m,h)}applyStashedOp(m){a(this,t,"a",o).applyStashedOp(m)}processCore(){(0,u.fail)("processCore should not be called")}processMessagesCore(m){a(this,t,"a",o).processMessagesCore(m)}rollback(m,h){a(this,t,"a",o).rollback===void 0?super.rollback(m,h):a(this,t,"a",o).rollback(m,h)}didAttach(){a(this,t,"a",o).didAttach?.()}}i=new WeakMap,r=new WeakMap,t=new WeakSet,s=function(m){(0,u.assert)(a(this,i,"f")===void 0,2969),n(this,i,m,"f"),l(this,m.view)},o=function(){return(a(this,i,"f")??(0,u.fail)("must initializeData first")).kernel},e.thisWrap=Symbol("selfWrap");function l(v,m){for(const[h,g]of Object.entries(Object.getOwnPropertyDescriptors(m))){(0,u.assert)(!Reflect.has(v,h),2970);let _;if(typeof g.value=="function"){const S=g.value;_=()=>f(S,m,v),Object.defineProperty(m,h,{...g,writable:!1})}else _=()=>m[h];Object.defineProperty(v,h,{configurable:!1,enumerable:g.enumerable,get:_})}}e.mergeAPIs=l;function f(v,m,h){return e.thisWrap in v?(...g)=>{const _=v.call(m,...g);return(0,u.assert)(_===m,2971),h}:v.bind(m)}function b(v){class m{get type(){return m.Type}get attributes(){return m.Attributes}async load(g,_,S,p){const w=new d(_,g,p,v.factory,v.telemetryContextPrefix);return await w.load(S),w}create(g,_){const S=new d(_,g,m.Attributes,v.factory,v.telemetryContextPrefix);return S.initializeLocal(),S}}return m.Type=v.type,m.Attributes=v.attributes,m}function C(v){return(0,c.createSharedObjectKind)(b(v))}e.makeSharedObjectKind=C})(Ef)),Ef}var F6;function Ma(){return F6||(F6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.mergeAPIs=e.makeSharedObjectKind=e.thisWrap=e.ValueType=e.bindHandles=e.serializeHandles=e.parseHandles=e.makeHandlesSerializable=e.createSingleBlobSummary=e.createSharedObjectKind=e.SharedObjectCore=e.SharedObject=e.FluidSerializer=e.isISharedObjectHandle=void 0;var n=bx();Object.defineProperty(e,"isISharedObjectHandle",{enumerable:!0,get:function(){return n.isISharedObjectHandle}});var a=vx();Object.defineProperty(e,"FluidSerializer",{enumerable:!0,get:function(){return a.FluidSerializer}});var t=Gie();Object.defineProperty(e,"SharedObject",{enumerable:!0,get:function(){return t.SharedObject}}),Object.defineProperty(e,"SharedObjectCore",{enumerable:!0,get:function(){return t.SharedObjectCore}}),Object.defineProperty(e,"createSharedObjectKind",{enumerable:!0,get:function(){return t.createSharedObjectKind}});var i=$ie();Object.defineProperty(e,"createSingleBlobSummary",{enumerable:!0,get:function(){return i.createSingleBlobSummary}}),Object.defineProperty(e,"makeHandlesSerializable",{enumerable:!0,get:function(){return i.makeHandlesSerializable}}),Object.defineProperty(e,"parseHandles",{enumerable:!0,get:function(){return i.parseHandles}}),Object.defineProperty(e,"serializeHandles",{enumerable:!0,get:function(){return i.serializeHandles}}),Object.defineProperty(e,"bindHandles",{enumerable:!0,get:function(){return i.bindHandles}});var r=qge();Object.defineProperty(e,"ValueType",{enumerable:!0,get:function(){return r.ValueType}});var s=Lge();Object.defineProperty(e,"thisWrap",{enumerable:!0,get:function(){return s.thisWrap}}),Object.defineProperty(e,"makeSharedObjectKind",{enumerable:!0,get:function(){return s.makeSharedObjectKind}}),Object.defineProperty(e,"mergeAPIs",{enumerable:!0,get:function(){return s.mergeAPIs}})})(dj)),dj}var N0={},A0={},If={},j6;function Wie(){if(j6)return If;j6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(If,"__esModule",{value:!0}),If.migrateIfSharedSerializable=If.serializeValue=void 0;const e=Ma(),n=(t,i,r)=>{const s=(0,e.serializeHandles)(t,i,r);return{type:e.ValueType[e.ValueType.Plain],value:s}};If.serializeValue=n;const a=(t,i,r)=>{if(t.type===e.ValueType[e.ValueType.Shared]){t.type=e.ValueType[e.ValueType.Plain];const s={type:"__fluid_handle__",url:t.value};t.value=i.encode((0,e.parseHandles)(s,i),r)}};return If.migrateIfSharedSerializable=a,If}var vj={},M6;function Jie(){return M6||(M6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.findLast=e.findLastIndex=void 0;const n=(t,i)=>{for(let r=t.length-1;r>=0;r--)if(i(t[r]))return r;return-1};e.findLastIndex=n;const a=(t,i)=>t[(0,e.findLastIndex)(t,i)];e.findLast=a})(vj)),vj}var N6;function Bge(){if(N6)return A0;N6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(A0,"__esModule",{value:!0}),A0.MapKernel=void 0;const e=Je(),n=Ma(),a=Wie(),t=Jie();class i{get size(){return[...this.internalIterator()].length}constructor(s,o,u,c,d){this.serializer=s,this.handle=o,this.submitMessage=u,this.isAttached=c,this.eventEmitter=d,this.messageHandlers=new Map,this.sequencedData=new Map,this.pendingData=[],this.internalIterator=()=>{const l=this.sequencedData.keys(),f=this.pendingData.values();return{next:()=>{let v=l.next();for(;!v.done;){const h=v.value;if(!this.pendingData.some(g=>g.type==="clear"||g.type==="delete"&&g.key===h)){const g=this.getOptimisticLocalValue(h);return(0,e.assert)(g!==void 0,3057),{value:[h,g],done:!1}}v=l.next()}let m=f.next();for(;!m.done;){const h=m.value;if(h.type==="lifetime"){const g=this.pendingData.indexOf(h),_=(0,t.findLastIndex)(this.pendingData,S=>S.type==="clear"||S.type==="delete"&&S.key===h.key);if(g>_){const S=h.keySets[h.keySets.length-1];if(!this.sequencedData.has(h.key)||_!==-1)return{value:[h.key,S.value],done:!1}}}m=f.next()}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}},this.getOptimisticLocalValue=l=>{const f=(0,t.findLast)(this.pendingData,b=>b.type==="clear"||b.key===l);return f===void 0?this.sequencedData.get(l):f.type==="lifetime"?f.keySets[f.keySets.length-1].value:void 0},this.messageHandlers=this.getMessageHandlers()}entries(){const s=this.internalIterator();return{next:()=>{const c=s.next();if(c.done)return{value:void 0,done:!0};const[d,l]=c.value;return{value:[d,l.value],done:!1}},[Symbol.iterator](){return this}}}keys(){const s=this.internalIterator();return{next:()=>{const c=s.next();if(c.done)return{value:void 0,done:!0};const[d]=c.value;return{value:d,done:!1}},[Symbol.iterator](){return this}}}values(){const s=this.internalIterator();return{next:()=>{const c=s.next();if(c.done)return{value:void 0,done:!0};const[,d]=c.value;return{value:d.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(s){new Map(this.internalIterator()).forEach((u,c,d)=>{s(u.value,c,d)})}get(s){const o=this.getOptimisticLocalValue(s);return o===void 0?void 0:o.value}has(s){return this.getOptimisticLocalValue(s)!==void 0}set(s,o){if(s==null)throw new Error("Undefined and null keys are not supported");const u={value:o},c=this.getOptimisticLocalValue(s);if(!this.isAttached()){this.sequencedData.set(s,u),this.eventEmitter.emit("valueChanged",{key:s,previousValue:c?.value},!0,this.eventEmitter);return}let d=(0,t.findLast)(this.pendingData,b=>b.type==="clear"||b.key===s);(d===void 0||d.type==="delete"||d.type==="clear")&&(d={type:"lifetime",key:s,keySets:[]},this.pendingData.push(d));const l={type:"set",value:u};d.keySets.push(l);const f={key:s,type:"set",value:{type:n.ValueType[n.ValueType.Plain],value:u.value}};this.submitMessage(f,l),this.eventEmitter.emit("valueChanged",{key:s,previousValue:c?.value},!0,this.eventEmitter)}delete(s){const o=this.getOptimisticLocalValue(s);if(!this.isAttached()){const d=this.sequencedData.delete(s);return o!==void 0&&this.eventEmitter.emit("valueChanged",{key:s,previousValue:o.value},!0,this.eventEmitter),d}const u={type:"delete",key:s};this.pendingData.push(u);const c={key:s,type:"delete"};return this.submitMessage(c,u),o!==void 0&&this.eventEmitter.emit("valueChanged",{key:s,previousValue:o.value},!0,this.eventEmitter),!0}clear(){if(!this.isAttached()){this.sequencedData.clear(),this.eventEmitter.emit("clear",!0,this.eventEmitter);return}const s={type:"clear"};this.pendingData.push(s);const o={type:"clear"};this.submitMessage(o,s),this.eventEmitter.emit("clear",!0,this.eventEmitter)}getSerializedStorage(s){const o={};for(const[u,c]of this.sequencedData.entries())o[u]=(0,a.serializeValue)(c.value,s,this.handle);return o}populateFromSerializable(s){for(const[o,u]of Object.entries(this.serializer.decode(s)))(0,a.migrateIfSharedSerializable)(u,this.serializer,this.handle),this.sequencedData.set(o,{value:u.value})}tryResubmitMessage(s,o){const u=this.messageHandlers.get(s.type);return u===void 0?!1:(u.resubmit(s,o),!0)}tryApplyStashedOp(s){switch(s.type){case"clear":{this.clear();break}case"delete":{this.delete(s.key);break}case"set":{(0,a.migrateIfSharedSerializable)(s.value,this.serializer,this.handle),this.set(s.key,s.value.value);break}default:(0,e.unreachableCase)(s)}}tryProcessMessage(s,o,u){const c=this.messageHandlers.get(s.type);return c===void 0?!1:(c.process(s,o,u),!0)}rollback(s,o){const u=s,c=o;if(u.type==="clear"){const d=this.pendingData.pop();(0,e.assert)(d!==void 0&&d.type==="clear"&&d===c,3058);for(const[l]of this.internalIterator())this.eventEmitter.emit("valueChanged",{key:l,previousValue:void 0},!0,this.eventEmitter)}else{const d=(0,t.findLastIndex)(this.pendingData,f=>f.type!=="clear"&&f.key===u.key),l=this.pendingData[d];if((0,e.assert)(l!==void 0&&(l.type==="delete"||l.type==="lifetime"),3059),l.type==="delete")(0,e.assert)(l===c,3060),this.pendingData.splice(d,1),this.getOptimisticLocalValue(u.key)!==void 0&&this.eventEmitter.emit("valueChanged",{key:u.key,previousValue:void 0},!0,this.eventEmitter);else if(l.type==="lifetime"){const f=l.keySets.pop();(0,e.assert)(f!==void 0&&f===c,3061),l.keySets.length===0&&this.pendingData.splice(d,1),this.eventEmitter.emit("valueChanged",{key:u.key,previousValue:f.value.value},!0,this.eventEmitter)}}}getMessageHandlers(){const s=new Map;return s.set("clear",{process:(o,u,c)=>{if(this.sequencedData.clear(),u){const d=this.pendingData.shift();(0,e.assert)(d!==void 0&&d.type==="clear"&&d===c,3062)}else this.pendingData.some(d=>d.type==="clear")||this.eventEmitter.emit("clear",u,this.eventEmitter)},resubmit:(o,u)=>{this.submitMessage(o,u)}}),s.set("delete",{process:(o,u,c)=>{const{key:d}=o;if(u){const l=this.pendingData.findIndex(b=>b.type!=="clear"&&b.key===d),f=this.pendingData[l];(0,e.assert)(f!==void 0&&f.type==="delete"&&f===c,3063),this.pendingData.splice(l,1),this.sequencedData.delete(d)}else{const l=this.sequencedData.get(d)?.value;this.sequencedData.delete(d),this.pendingData.some(f=>f.type==="clear"||f.key===d)||this.eventEmitter.emit("valueChanged",{key:d,previousValue:l},u,this.eventEmitter)}},resubmit:(o,u)=>{this.submitMessage(o,u)}}),s.set("set",{process:(o,u,c)=>{const{key:d,value:l}=o;if(u){const f=this.pendingData.findIndex(v=>v.type!=="clear"&&v.key===d),b=this.pendingData[f];(0,e.assert)(b!==void 0&&b.type==="lifetime",3064);const C=b.keySets.shift();(0,e.assert)(C!==void 0&&C===c,3065),b.keySets.length===0&&this.pendingData.splice(f,1),this.sequencedData.set(d,C.value)}else{(0,a.migrateIfSharedSerializable)(l,this.serializer,this.handle);const f={value:l.value},b=this.sequencedData.get(d)?.value;this.sequencedData.set(d,f),this.pendingData.some(C=>C.type==="clear"||C.key===d)||this.eventEmitter.emit("valueChanged",{key:d,previousValue:b},u,this.eventEmitter)}},resubmit:(o,u)=>{this.submitMessage(o,u)}}),s}}return A0.MapKernel=i,A0}var A6;function Uge(){if(A6)return N0;A6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e;Object.defineProperty(N0,"__esModule",{value:!0}),N0.SharedMap=void 0;const n=Je(),a=on(),t=Kn(),i=bn(),r=Ma(),s=Bge(),o="header";class u extends r.SharedObject{constructor(d,l,f){super(d,l,f,"fluid_map_"),this[e]="SharedMap",this.kernel=new s.MapKernel(this.serializer,this.handle,(b,C)=>this.submitLocalMessage(b,C),()=>this.isAttached(),this)}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(e=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(d){this.kernel.forEach(d)}get(d){return this.kernel.get(d)}has(d){return this.kernel.has(d)}set(d,l){return this.kernel.set(d,l),this}delete(d){return this.kernel.delete(d)}clear(){this.kernel.clear()}summarizeCore(d,l){let f=0,b=0,C={};const v=[],m=new i.SummaryTreeBuilder,h=this.kernel.getSerializedStorage(d),g=8*1024,_=16*1024;for(const[p,w]of Object.entries(h))if(w.value&&w.value.length>=g){const O=`blob${b}`;b++,v.push(O);const E={[p]:{type:w.type,value:JSON.parse(w.value)}};m.addBlob(O,JSON.stringify(E))}else{if(f+=w.type.length+21,w.value&&(f+=w.value.length),f>_){const O=`blob${b}`;b++,v.push(O),m.addBlob(O,JSON.stringify(C)),C={},f=0}C[p]={type:w.type,value:w.value===void 0?void 0:JSON.parse(w.value)}}const S={blobs:v,content:C};return m.addBlob(o,JSON.stringify(S)),m.getSummaryTree()}async loadCore(d){const l=await(0,t.readAndParse)(d,o),f=l;if(Array.isArray(f.blobs)){this.kernel.populateFromSerializable(f.content);const b=await Promise.all(f.blobs.map(async C=>(0,t.readAndParse)(d,C)));for(const C of b)this.kernel.populateFromSerializable(C)}else this.kernel.populateFromSerializable(l)}onDisconnect(){}reSubmitCore(d,l){this.kernel.tryResubmitMessage(d,l)}applyStashedOp(d){this.kernel.tryApplyStashedOp(d)}processCore(d,l,f){d.type===a.MessageType.Operation&&(0,n.assert)(this.kernel.tryProcessMessage(d.contents,l,f),2738)}rollback(d,l){this.kernel.rollback(d,l)}}return N0.SharedMap=u,N0}var Rf={},D6;function Qie(){if(D6)return Rf;D6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.pkgVersion=Rf.pkgName=void 0,Rf.pkgName="@fluidframework/map",Rf.pkgVersion="2.60.0",Rf}var k6;function x6(){if(k6)return Sf;k6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Sf,"__esModule",{value:!0}),Sf.SharedMap=Sf.MapFactory=void 0;const e=Ma(),n=Uge(),a=Qie();class t{get type(){return t.Type}get attributes(){return t.Attributes}async load(r,s,o,u){const c=new n.SharedMap(s,r,u);return await c.load(o),c}create(r,s){const o=new n.SharedMap(s,r,t.Attributes);return o.initializeLocal(),o}}return Sf.MapFactory=t,t.Type="https://graph.microsoft.com/types/map",t.Attributes={type:t.Type,snapshotFormatVersion:"0.2",packageVersion:a.pkgVersion},Sf.SharedMap=(0,e.createSharedObjectKind)(t),Sf}var Ff={},jf={},q6;function zge(){if(q6)return jf;q6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=jf&&jf.__importDefault||function(S){return S&&S.__esModule?S:{default:S}},n,a;Object.defineProperty(jf,"__esModule",{value:!0}),jf.SharedDirectory=void 0;const t=Ht(),i=Je(),r=on(),s=Kn(),o=bn(),u=Ma(),c=Ot(),d=e(Cme()),l=Wie(),f=Jie(),b=d.default.posix,C="header",v=(S,p)=>m(S)?m(p)?S.seq===p.seq?S.clientSeq-p.clientSeq:S.seq-p.seq:-1:m(p)?1:S.seq===p.seq?S.clientSeq-p.clientSeq:S.seq-p.seq;function m(S){return S.seq>=0}class h extends u.SharedObject{get absolutePath(){return this.root.absolutePath}constructor(p,w,O){super(p,w,O,"fluid_directory_"),this[n]="SharedDirectory",this.root=new _({seq:0,clientSeq:0},new Set,this,this.runtime,this.serializer,b.sep,this.logger),this.messageHandlers=new Map,this.setMessageHandlers(),this.root.on("containedValueChanged",(E,F)=>{this.emit("containedValueChanged",E,F,this)}),this.root.on("subDirectoryCreated",(E,F)=>{this.emit("subDirectoryCreated",E,F,this)}),this.root.on("subDirectoryDeleted",(E,F)=>{this.emit("subDirectoryDeleted",E,F,this)})}get(p){return this.root.get(p)}set(p,w){return this.root.set(p,w),this}dispose(p){this.root.dispose(p)}get disposed(){return this.root.disposed}delete(p){return this.root.delete(p)}clear(){this.root.clear()}has(p){return this.root.has(p)}get size(){return this.root.size}forEach(p){this.root.forEach(p)}[(n=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(p){return this.root.createSubDirectory(p)}getSubDirectory(p){return this.root.getSubDirectory(p)}hasSubDirectory(p){return this.root.hasSubDirectory(p)}deleteSubDirectory(p){return this.root.deleteSubDirectory(p)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(p){const w=this.makeAbsolute(p);if(w===b.sep)return this.root;let O=this.root;const E=w.slice(1).split(b.sep);for(const F of E)if(O=O.getSubDirectory(F),!O)return;return O}getSequencedWorkingDirectory(p){const w=this.makeAbsolute(p);if(w===b.sep)return this.root;let O=this.root;const E=w.slice(1).split(b.sep);for(const F of E)if(O=O.sequencedSubdirectories.get(F),!O)return;return O}summarizeCore(p,w){return this.serializeDirectory(this.root,p)}submitDirectoryMessage(p,w){this.submitLocalMessage(p,w)}onDisconnect(){}reSubmitCore(p,w){const O=p,E=this.messageHandlers.get(O.type);(0,i.assert)(E!==void 0,13),E.resubmit(O,w)}async loadCore(p){const w=await(0,s.readAndParse)(p,C),O=w;if(Array.isArray(O.blobs)){this.populate(O.content);const E=await Promise.all(O.blobs.map(async F=>(0,s.readAndParse)(p,F)));for(const F of E)this.populate(F)}else this.populate(w)}populate(p){const w=[];for(w.push([this.root,p]);w.length>0;){const[O,E]=w.pop();if(E.subdirectories){const F=new Map;for(const[R,M]of Object.entries(E.subdirectories)){let j=O.getSubDirectory(R),k;if(!j){const x=M.ci;if(x!==void 0&&x.csn>0){F.has(x.csn)||F.set(x.csn,0);let L=F.get(x.csn);k={seq:x.csn,clientSeq:L},F.set(x.csn,++L)}else k={seq:0,clientSeq:++O.localCreationSeq};j=new _(k,x===void 0?new Set:new Set(x.ccIds),this,this.runtime,this.serializer,b.join(O.absolutePath,R),this.logger),O.populateSubDirectory(R,j)}w.push([j,M])}}if(E.storage)for(const[F,R]of Object.entries(E.storage)){const M=(0,u.parseHandles)(R,this.serializer);(0,l.migrateIfSharedSerializable)(M,this.serializer,this.handle),O.populateStorage(F,M.value)}}}processCore(p,w,O){if(p.type===r.MessageType.Operation){const E=p.contents,F=this.messageHandlers.get(E.type);(0,i.assert)(F!==void 0,14),F.process(p,E,w,O)}}rollback(p,w){const O=p,E=this.getWorkingDirectory(O.path);E&&E.rollback(O,w)}makeAbsolute(p){return b.resolve(b.sep,p)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(p,w,O,E)=>{const F=this.getSequencedWorkingDirectory(w.path);F!==void 0&&!F?.disposed&&F.processClearMessage(p,w,O,E)},resubmit:(p,w)=>{const O=w.subdir;O.disposed||O.resubmitClearMessage(p,w)}}),this.messageHandlers.set("delete",{process:(p,w,O,E)=>{const F=this.getSequencedWorkingDirectory(w.path);F!==void 0&&!F?.disposed&&F.processDeleteMessage(p,w,O,E)},resubmit:(p,w)=>{const O=w.subdir;O.disposed||O.resubmitKeyMessage(p,w)}}),this.messageHandlers.set("set",{process:(p,w,O,E)=>{const F=this.getSequencedWorkingDirectory(w.path);if(F!==void 0&&!F?.disposed){(0,l.migrateIfSharedSerializable)(w.value,this.serializer,this.handle);const R=O?void 0:w.value.value;F.processSetMessage(p,w,R,O,E)}},resubmit:(p,w)=>{const O=w.subdir;O.disposed||O.resubmitKeyMessage(p,w)}}),this.messageHandlers.set("createSubDirectory",{process:(p,w,O,E)=>{const F=this.getSequencedWorkingDirectory(w.path);F!==void 0&&!F?.disposed&&F.processCreateSubDirectoryMessage(p,w,O,E)},resubmit:(p,w)=>{const O=w.parentSubdir;O.disposed||O.resubmitSubDirectoryMessage(p,w)}}),this.messageHandlers.set("deleteSubDirectory",{process:(p,w,O,E)=>{const F=this.getSequencedWorkingDirectory(w.path);F!==void 0&&!F?.disposed&&F.processDeleteSubDirectoryMessage(p,w,O,E)},resubmit:(p,w)=>{const O=w.parentSubdir;O.disposed||O.resubmitSubDirectoryMessage(p,w)}})}applyStashedOp(p){const w=p,O=this.getWorkingDirectory(w.path);switch(w.type){case"clear":{O?.clear();break}case"createSubDirectory":{O?.createSubDirectory(w.subdirName);break}case"delete":{O?.delete(w.key);break}case"deleteSubDirectory":{O?.deleteSubDirectory(w.subdirName);break}case"set":{(0,l.migrateIfSharedSerializable)(w.value,this.serializer,this.handle),O?.set(w.key,w.value.value);break}default:(0,i.unreachableCase)(w)}}serializeDirectory(p,w,O){const F=new o.SummaryTreeBuilder;let R=0;const M=[],j=[],k={};for(j.push([p,k]);j.length>0;){const[L,V]=j.pop();V.ci=L.getSerializableCreateInfo();for(const[G,ee]of L.getSerializedStorage(w)){V.storage||(V.storage={});const se={type:ee.type,value:ee.value&&JSON.parse(ee.value)};if(ee.value&&ee.value.length>=8192){const re={};let fe=re;if(L.absolutePath!==b.sep)for(const pe of L.absolutePath.slice(1).split(b.sep)){const de={};fe.subdirectories={[pe]:de},fe=de}fe.storage={[G]:se};const oe=`blob${R}`;R++,M.push(oe),F.addBlob(oe,JSON.stringify(re))}else V.storage[G]=se}for(const[G,ee]of L.subdirectories()){V.subdirectories||(V.subdirectories={});const se={};V.subdirectories[G]=se,j.push([ee,se])}}const x={blobs:M,content:k};return F.addBlob(C,JSON.stringify(x)),F.getSummaryTree()}}jf.SharedDirectory=h;function g(S){(0,i.assert)(S!==null,1711)}class _ extends t.TypedEventEmitter{constructor(p,w,O,E,F,R,M){super(),this.seqData=p,this.clientIds=w,this.directory=O,this.runtime=E,this.serializer=F,this.absolutePath=R,this._deleted=!1,this[a]="SubDirectory",this._sequencedSubdirectories=new Map,this.localCreationSeq=0,this.sequencedStorageData=new Map,this.pendingStorageData=[],this.pendingSubDirectoryData=[],this.internalIterator=()=>{const j=this.sequencedStorageData.keys(),k=this.pendingStorageData.values();return{next:()=>{let V=j.next();for(;!V.done;){const ee=V.value;if(!this.pendingStorageData.some(se=>se.type==="clear"||se.type==="delete"&&se.key===ee)){(0,i.assert)(this.has(ee),3075);const se=this.getOptimisticValue(ee);return{value:[ee,se],done:!1}}V=j.next()}let G=k.next();for(;!G.done;){const ee=G.value;if(ee.type==="lifetime"){const se=this.pendingStorageData.indexOf(ee),re=(0,f.findLastIndex)(this.pendingStorageData,fe=>fe.type==="clear"||fe.type==="delete"&&fe.key===ee.key);if(se>re){const fe=ee.keySets[ee.keySets.length-1];if(!this.sequencedStorageData.has(ee.key)||re!==-1)return{value:[ee.key,fe.value],done:!1}}}G=k.next()}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}},this.getOptimisticValue=j=>{const k=(0,f.findLast)(this.pendingStorageData,x=>x.type==="clear"||x.key===j);return k===void 0?this.sequencedStorageData.get(j):k.type==="lifetime"?k.keySets[k.keySets.length-1].value:void 0},this.optimisticallyHas=j=>{const k=(0,f.findLast)(this.pendingStorageData,x=>x.type==="clear"||x.key===j);return k===void 0?this.sequencedStorageData.has(j):k.type==="lifetime"},this.getOptimisticSubDirectory=(j,k=!1)=>{const x=(0,f.findLast)(this.pendingSubDirectoryData,V=>V.subdirName===j);let L;if(x===void 0)L=this._sequencedSubdirectories.get(j);else if(x.type==="createSubDirectory")L=x.subdir,(0,i.assert)(L!==void 0,3119);else return;if(!(L?.disposed&&!k))return L},this.mc=(0,c.createChildMonitoringContext)({logger:M,namespace:"Directory"})}dispose(p){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1,this.emit("undisposed",this)}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new c.UsageError("Cannot access Disposed subDirectory")}has(p){return this.throwIfDisposed(),this.optimisticallyHas(p)}get(p){return this.getOptimisticValue(p)}set(p,w){if(this.throwIfDisposed(),p==null)throw new Error("Undefined and null keys are not supported");const O=this.getOptimisticValue(p);if((this.mc.config.getBoolean("Fluid.Directory.AllowDetachedResolve")??!1)&&(0,u.bindHandles)(w,this.serializer,this.directory.handle),!this.directory.isAttached()){this.sequencedStorageData.set(p,w);const x={key:p,path:this.absolutePath,previousValue:O};this.directory.emit("valueChanged",x,!0,this.directory);const L={key:p,previousValue:O};return this.emit("containedValueChanged",L,!0,this),this}let F=(0,f.findLast)(this.pendingStorageData,x=>x.type==="clear"||x.key===p);(F===void 0||F.type==="delete"||F.type==="clear")&&(F={type:"lifetime",path:this.absolutePath,key:p,keySets:[],subdir:this},this.pendingStorageData.push(F));const R={type:"set",path:this.absolutePath,value:w,subdir:this};F.keySets.push(R);const M={key:p,path:this.absolutePath,type:"set",value:{type:u.ValueType[u.ValueType.Plain],value:w}};this.submitKeyMessage(M,R);const j={key:p,path:this.absolutePath,previousValue:O};this.directory.emit("valueChanged",j,!0,this.directory);const k={key:p,previousValue:O};return this.emit("containedValueChanged",k,!0,this),this}countSubDirectory(){return[...this.subdirectories()].length}createSubDirectory(p){if(this.throwIfDisposed(),p==null)throw new Error("SubDirectory name may not be undefined or null");if(p.includes(b.sep))throw new Error(`SubDirectory name may not contain ${b.sep}`);let w=this.getOptimisticSubDirectory(p,!0);const O=this.getLocalSeq(),E=this.runtime.clientId??"detached",F=w===void 0;if(w===void 0){const R=b.join(this.absolutePath,p);w=new _({...O},new Set([E]),this.directory,this.runtime,this.serializer,R,this.mc.logger)}else w.disposed&&this.undisposeSubdirectoryTree(w),w.clientIds.add(E);if(this.registerEventsOnSubDirectory(w,p),F){if(this.directory.isAttached()){const R={type:"createSubDirectory",subdirName:p,subdir:w};this.pendingSubDirectoryData.push(R);const M={subdirName:p,path:this.absolutePath,type:"createSubDirectory"};this.submitCreateSubDirectoryMessage(M)}else this._sequencedSubdirectories.set(p,w);this.emit("subDirectoryCreated",p,!0,this)}return w}getLocalSeq(){return this.directory.isAttached()?{seq:-1,clientSeq:++this.localCreationSeq}:{seq:0,clientSeq:++this.localCreationSeq}}getSubDirectory(p){return this.throwIfDisposed(),this.getOptimisticSubDirectory(p)}hasSubDirectory(p){return this.throwIfDisposed(),this.getOptimisticSubDirectory(p)!==void 0}deleteSubDirectory(p){if(this.throwIfDisposed(),!this.directory.isAttached()){const F=this._sequencedSubdirectories.get(p),R=this._sequencedSubdirectories.delete(p);return R&&(this.disposeSubDirectoryTree(F),this.emit("subDirectoryDeleted",p,!0,this)),R}const w=this.getOptimisticSubDirectory(p);if(w===void 0)return!1;const O={type:"deleteSubDirectory",subdirName:p,subdir:this};this.pendingSubDirectoryData.push(O);const E={subdirName:p,type:"deleteSubDirectory",path:this.absolutePath};return this.submitDeleteSubDirectoryMessage(E,w),this.emit("subDirectoryDeleted",p,!0,this),this.emitDisposeForSubdirTree(w),!0}subdirectories(){this.throwIfDisposed();const p=[],w=new Set([...this._sequencedSubdirectories.keys()]);for(const M of w){const j=this.getOptimisticSubDirectory(M);j!==void 0&&p.push([M,j])}const O=[...new Set(this.pendingSubDirectoryData.map(M=>M.subdirName).filter(M=>!w.has(M)))],E=[];for(const M of O){const j=this.getOptimisticSubDirectory(M);j!==void 0&&E.push([M,j])}return[...p,...E].sort((M,j)=>{const k=M[1].seqData,x=j[1].seqData;return v(k,x)})[Symbol.iterator]()}getWorkingDirectory(p){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(p))}isSubDirectoryDeletePending(p){return(0,f.findLast)(this.pendingSubDirectoryData,O=>O.subdirName===p&&O.type==="deleteSubDirectory")!==void 0}delete(p){this.throwIfDisposed();const w=this.getOptimisticValue(p);if(!this.directory.isAttached()){const F=this.sequencedStorageData.delete(p);if(w!==void 0&&F){const R={key:p,path:this.absolutePath,previousValue:w};this.directory.emit("valueChanged",R,!0,this.directory);const M={key:p,previousValue:w};this.emit("containedValueChanged",M,!0,this)}return F}const O={type:"delete",path:this.absolutePath,key:p,subdir:this};this.pendingStorageData.push(O);const E={key:p,type:"delete",path:this.absolutePath};if(this.submitKeyMessage(E,O),w!==void 0){const F={key:p,path:this.absolutePath,previousValue:w};this.directory.emit("valueChanged",F,!0,this.directory);const R={key:p,previousValue:w};this.emit("containedValueChanged",R,!0,this)}return!0}clear(){if(this.throwIfDisposed(),!this.directory.isAttached()){this.sequencedStorageData.clear(),this.directory.emit("clear",!0,this.directory);return}const p={type:"clear",path:this.absolutePath,subdir:this};this.pendingStorageData.push(p),this.directory.emit("clear",!0,this.directory);const w={type:"clear",path:this.absolutePath};this.submitClearMessage(w,p)}forEach(p){this.throwIfDisposed();for(const[w,O]of this.internalIterator())p(O,w,this)}get size(){return this.throwIfDisposed(),[...this.internalIterator()].length}entries(){this.throwIfDisposed();const p=this.internalIterator();return{next:()=>{const E=p.next();if(E.done)return{value:void 0,done:!0};const[F,R]=E.value;return{value:[F,R],done:!1}},[Symbol.iterator](){return this}}}keys(){this.throwIfDisposed();const p=this.internalIterator();return{next:()=>{const E=p.next();if(E.done)return{value:void 0,done:!0};const[F]=E.value;return{value:F,done:!1}},[Symbol.iterator](){return this}}}values(){this.throwIfDisposed();const p=this.internalIterator();return{next:()=>{const E=p.next();if(E.done)return{value:void 0,done:!0};const[,F]=E.value;return{value:F,done:!1}},[Symbol.iterator](){return this}}}[(a=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.internalIterator()}get sequencedSubdirectories(){return this.throwIfDisposed(),this._sequencedSubdirectories}processClearMessage(p,w,O,E){if(this.throwIfDisposed(),!!this.isMessageForCurrentInstanceOfSubDirectory(p,E?.subdir))if(O){this.sequencedStorageData.clear();const F=this.pendingStorageData.shift();(0,i.assert)(F!==void 0&&F.type==="clear"&&F===E,3076)}else{const F=[];for(const R of this.pendingStorageData)if(R.type==="lifetime"){const M=this.sequencedStorageData.get(R.key);F.push({key:R.key,previousValue:M})}this.sequencedStorageData.clear(),this.pendingStorageData.some(R=>R.type==="clear")||this.directory.emit("clear",O,this.directory);for(const{key:R,previousValue:M}of F)this.directory.emit("valueChanged",{key:R,previousValue:M},O,this.directory)}}processDeleteMessage(p,w,O,E){if(this.throwIfDisposed(),!!this.isMessageForCurrentInstanceOfSubDirectory(p,E?.subdir))if(O){const F=this.pendingStorageData.findIndex(M=>M.type!=="clear"&&M.key===w.key),R=this.pendingStorageData[F];(0,i.assert)(R!==void 0&&R.type==="delete"&&R.key===w.key,3077),this.pendingStorageData.splice(F,1),this.sequencedStorageData.delete(w.key)}else{const F=this.sequencedStorageData.get(w.key);if(this.sequencedStorageData.delete(w.key),!this.pendingStorageData.some(R=>R.type==="clear"||R.key===w.key)){const R={key:w.key,path:this.absolutePath,previousValue:F};this.directory.emit("valueChanged",R,O,this.directory);const M={key:w.key,previousValue:F};this.emit("containedValueChanged",M,O,this)}}}processSetMessage(p,w,O,E,F){if(this.throwIfDisposed(),!this.isMessageForCurrentInstanceOfSubDirectory(p,F?.subdir))return;const{key:R}=w;if(E){const M=this.pendingStorageData.findIndex(x=>x.type!=="clear"&&x.key===R),j=this.pendingStorageData[M];(0,i.assert)(j!==void 0&&j.type==="lifetime",3078);const k=j.keySets.shift();(0,i.assert)(k!==void 0&&k===F,3079),j.keySets.length===0&&this.pendingStorageData.splice(M,1),this.sequencedStorageData.set(R,k.value)}else{const M=this.sequencedStorageData.get(R);if(this.sequencedStorageData.set(R,O),!this.pendingStorageData.some(j=>j.type==="clear"||j.key===R)){const j={key:R,path:this.absolutePath,previousValue:M};this.directory.emit("valueChanged",j,E,this.directory);const k={key:R,previousValue:M};this.emit("containedValueChanged",k,E,this)}}}processCreateSubDirectoryMessage(p,w,O,E){if(this.throwIfDisposed(),!this.isMessageForCurrentInstanceOfSubDirectory(p,E?.parentSubdir))return;g(p.clientId);let F;if(O){const R=this.pendingSubDirectoryData.findIndex(k=>k.subdirName===w.subdirName),M=this.pendingSubDirectoryData[R];if((0,i.assert)(M!==void 0&&M.type==="createSubDirectory",3120),this.pendingSubDirectoryData.splice(R,1),F=M.subdir,this._sequencedSubdirectories.get(w.subdirName)!==void 0)return;F.disposed&&this.undisposeSubdirectoryTree(F),this._sequencedSubdirectories.set(w.subdirName,F)}else{if(F=this.getOptimisticSubDirectory(w.subdirName,!0),F===void 0){const R=b.join(this.absolutePath,w.subdirName);F=new _({seq:p.sequenceNumber,clientSeq:p.clientSequenceNumber},new Set([p.clientId]),this.directory,this.runtime,this.serializer,R,this.mc.logger)}else F.disposed&&this.undisposeSubdirectoryTree(F),F.clientIds.add(p.clientId);this.registerEventsOnSubDirectory(F,w.subdirName),this._sequencedSubdirectories.set(w.subdirName,F),this.pendingSubDirectoryData.some(R=>R.subdirName===w.subdirName)||this.emit("subDirectoryCreated",w.subdirName,O,this)}this.seqData.seq!==-1&&this.seqData.seq<=p.sequenceNumber&&F.seqData.seq===-1&&(F.seqData.seq=p.sequenceNumber,F.seqData.clientSeq=p.clientSequenceNumber)}processDeleteSubDirectoryMessage(p,w,O,E){if(this.throwIfDisposed(),!this.isMessageForCurrentInstanceOfSubDirectory(p,E?.parentSubdir))return;const F=this._sequencedSubdirectories.get(w.subdirName);if(F===void 0){if(O){const R=this.pendingSubDirectoryData.findIndex(j=>j.subdirName===w.subdirName),M=this.pendingSubDirectoryData[R];(0,i.assert)(M!==void 0&&M.type==="deleteSubDirectory"&&M.subdirName===w.subdirName,3121),this.pendingSubDirectoryData.splice(R,1)}return}if(this._sequencedSubdirectories.delete(w.subdirName),this.disposeSubDirectoryTree(F),O){const R=this.pendingSubDirectoryData.findIndex(j=>j.subdirName===w.subdirName),M=this.pendingSubDirectoryData[R];(0,i.assert)(M!==void 0&&M.type==="deleteSubDirectory"&&M.subdirName===w.subdirName,3122),this.pendingSubDirectoryData.splice(R,1)}else{const R=this.pendingSubDirectoryData.findIndex(j=>j.subdirName===w.subdirName&&j.type==="deleteSubDirectory");this.pendingSubDirectoryData[R]===void 0&&this.emit("subDirectoryDeleted",w.subdirName,O,this)}}submitClearMessage(p,w){this.throwIfDisposed(),this.directory.submitDirectoryMessage(p,w)}resubmitClearMessage(p,w){const O=this.pendingStorageData.findIndex(F=>F.type==="clear");this.pendingStorageData[O]!==void 0&&this.submitClearMessage(p,w)}submitKeyMessage(p,w){this.throwIfDisposed(),this.directory.submitDirectoryMessage(p,w)}resubmitKeyMessage(p,w){const O=this.pendingStorageData.findIndex(F=>p.type==="set"?F.type==="lifetime"&&F.key===p.key&&F.keySets.includes(w):F.type==="delete"&&F.key===p.key);this.pendingStorageData[O]!==void 0&&this.submitKeyMessage(p,w)}submitCreateSubDirectoryMessage(p){const w={type:"createSubDir",parentSubdir:this};this.directory.submitDirectoryMessage(p,w)}submitDeleteSubDirectoryMessage(p,w){const O={type:"deleteSubDir",subDirectory:w,parentSubdir:this};this.directory.submitDirectoryMessage(p,O)}resubmitSubDirectoryMessage(p,w){if(w.type==="createSubDir"){const O=(0,f.findLast)(this.pendingSubDirectoryData,E=>E.subdirName===p.subdirName&&E.type==="createSubDirectory");O!==void 0&&((0,i.assert)(O.type==="createSubDirectory",3123),O.subdir.clientIds.add(this.runtime.clientId??"detached"),this.undisposeSubdirectoryTree(O.subdir),this.submitCreateSubDirectoryMessage(p))}else w.type==="deleteSubDir"&&((0,i.assert)(w.subDirectory!==void 0,3124),(0,f.findLast)(this.pendingSubDirectoryData,E=>E.subdirName===p.subdirName&&E.type==="deleteSubDirectory")!==void 0&&this.submitDeleteSubDirectoryMessage(p,w.subDirectory))}*getSerializedStorage(p){this.throwIfDisposed();for(const[w,O]of this.sequencedStorageData.entries()){const E=(0,l.serializeValue)(O,p,this.directory.handle);yield[w,E]}}getSerializableCreateInfo(){return this.throwIfDisposed(),{csn:this.seqData.seq,ccIds:[...this.clientIds]}}populateStorage(p,w){this.throwIfDisposed(),this.sequencedStorageData.set(p,w)}populateSubDirectory(p,w){this.throwIfDisposed(),this.registerEventsOnSubDirectory(w,p),this._sequencedSubdirectories.set(p,w)}rollback(p,w){const O=p;if(O.type==="clear"){const E=this.pendingStorageData.pop();if(E===void 0)return;(0,i.assert)(E.type==="clear"&&w.type==="clear",3125);for(const[F]of this.internalIterator()){const R={key:F,path:this.absolutePath,previousValue:void 0};this.directory.emit("valueChanged",R,!0,this.directory);const M={key:F,previousValue:void 0};this.emit("containedValueChanged",M,!0,this)}}else if((O.type==="delete"||O.type==="set")&&(w.type==="set"||w.type==="delete")){const E=(0,f.findLastIndex)(this.pendingStorageData,R=>R.type!=="clear"&&R.key===O.key),F=this.pendingStorageData[E];if(F===void 0)return;if((0,i.assert)(F.type==="delete"||F.type==="lifetime",3126),F.type==="delete"){if((0,i.assert)(F===w,3083),this.pendingStorageData.splice(E,1),this.getOptimisticValue(O.key)!==void 0){const R={key:O.key,path:this.absolutePath,previousValue:void 0};this.directory.emit("valueChanged",R,!0,this.directory);const M={key:O.key,previousValue:void 0};this.emit("containedValueChanged",M,!0,this)}}else if(F.type==="lifetime"){const R=F.keySets.pop();(0,i.assert)(R!==void 0&&R===w,3084),F.keySets.length===0&&this.pendingStorageData.splice(E,1);const M={key:O.key,path:this.absolutePath,previousValue:R.value};this.directory.emit("valueChanged",M,!0,this.directory);const j={key:O.key,previousValue:R.value};this.emit("containedValueChanged",j,!0,this)}}else if(O.type==="createSubDirectory"&&w.type==="createSubDir"){const E=O.subdirName,F=(0,f.findLastIndex)(this.pendingSubDirectoryData,M=>M.type==="createSubDirectory"&&M.subdirName===E),R=this.pendingSubDirectoryData[F];(0,i.assert)(R!==void 0&&R.type==="createSubDirectory",3127),this.emitDisposeForSubdirTree(R.subdir),this.pendingSubDirectoryData.splice(F,1),this.emit("subDirectoryDeleted",E,!0,this)}else if(O.type==="deleteSubDirectory"&&w.type==="deleteSubDir"){const E=O.subdirName,F=(0,f.findLastIndex)(this.pendingSubDirectoryData,j=>j.type==="deleteSubDirectory"&&j.subdirName===E),R=this.pendingSubDirectoryData[F];(0,i.assert)(R!==void 0&&R.type==="deleteSubDirectory",3128),this.pendingSubDirectoryData.splice(F,1);const M=w.subDirectory;(0,i.assert)(M!==void 0,3129),this.undisposeSubdirectoryTree(M),this.registerEventsOnSubDirectory(M,E),this.emit("subDirectoryCreated",E,!0,this)}else throw new Error("Unsupported op for rollback")}makeAbsolute(p){return b.resolve(this.absolutePath,p)}isMessageForCurrentInstanceOfSubDirectory(p,w){return(w===void 0||w===this)&&(p.clientId!==null&&this.clientIds.has(p.clientId)||this.clientIds.has("detached")||this.seqData.seq!==-1&&this.seqData.seq<=p.referenceSequenceNumber)}registerEventsOnSubDirectory(p,w){p.on("subDirectoryCreated",(O,E)=>{this.emit("subDirectoryCreated",b.join(w,O),E,this)}),p.on("subDirectoryDeleted",(O,E)=>{this.emit("subDirectoryDeleted",b.join(w,O),E,this)})}disposeSubDirectoryTree(p){if(p===void 0)return;const w=p.subdirectories();for(const[O,E]of w)this.disposeSubDirectoryTree(E);p.clearSubDirectorySequencedData(),p.dispose()}emitDisposeForSubdirTree(p){if(p===void 0||p.disposed)return;const w=p.subdirectories();for(const[O,E]of w)this.emitDisposeForSubdirTree(E);typeof p.dispose=="function"&&p.emit("disposed",p)}undisposeSubdirectoryTree(p){for(const[w,O]of p.getSubdirectoriesEvenIfDisposed())this.undisposeSubdirectoryTree(O);p.undispose()}getSubdirectoriesEvenIfDisposed(){const p=[],w=new Set([...this._sequencedSubdirectories.keys()]);for(const M of w){const j=this.getOptimisticSubDirectory(M,!0);j!==void 0&&p.push([M,j])}const O=[...new Set(this.pendingSubDirectoryData.map(M=>M.subdirName).filter(M=>!w.has(M)))],E=[];for(const M of O){const j=this.getOptimisticSubDirectory(M,!0);j!==void 0&&E.push([M,j])}return[...p,...E].sort((M,j)=>{const k=M[1].seqData,x=j[1].seqData;return(0,i.assert)(k!==void 0&&x!==void 0,3130),v(k,x)})[Symbol.iterator]()}clearSubDirectorySequencedData(){this.seqData.seq=-1,this.seqData.clientSeq=-1,this.sequencedStorageData.clear(),this._sequencedSubdirectories.clear(),this.clientIds.clear(),this.clientIds.add(this.runtime.clientId??"detached")}}return jf}var L6;function B6(){if(L6)return Ff;L6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.SharedDirectory=Ff.DirectoryFactory=void 0;const e=Ma(),n=zge(),a=Qie();class t{get type(){return t.Type}get attributes(){return t.Attributes}async load(r,s,o,u){const c=new n.SharedDirectory(s,r,u);return await c.load(o),c}create(r,s){const o=new n.SharedDirectory(s,r,t.Attributes);return o.initializeLocal(),o}}return Ff.DirectoryFactory=t,t.Type="https://graph.microsoft.com/types/directory",t.Attributes={type:t.Type,snapshotFormatVersion:"0.1",packageVersion:a.pkgVersion},Ff.SharedDirectory=(0,e.createSharedObjectKind)(t),Ff}var U6;function yE(){return U6||(U6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.DirectoryFactory=e.MapFactory=e.SharedDirectory=e.SharedMap=void 0;var n=x6();Object.defineProperty(e,"SharedMap",{enumerable:!0,get:function(){return n.SharedMap}});var a=B6();Object.defineProperty(e,"SharedDirectory",{enumerable:!0,get:function(){return a.SharedDirectory}});var t=x6();Object.defineProperty(e,"MapFactory",{enumerable:!0,get:function(){return t.MapFactory}});var i=B6();Object.defineProperty(e,"DirectoryFactory",{enumerable:!0,get:function(){return i.DirectoryFactory}})})(uj)),uj}var D0={},Sj={},Cj={},_j={},hu={},k0={},ui={},Wn={},z6;function bE(){if(z6)return Wn;z6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.addNumericUuids=Wn.subtractNumericUuids=Wn.offsetNumericUuid=Wn.stableIdFromNumericUuid=Wn.numericUuidFromStableId=Wn.localIdFromGenCount=Wn.genCountFromLocalId=Wn.compareBigints=Wn.compareStrings=Wn.compareFiniteNumbers=Wn.isStableId=Wn.generateStableId=Wn.assertIsSessionId=Wn.assertIsStableId=Wn.createSessionId=void 0;const e=Je(),n=ys(),a=[..."09afAF"].map(R=>R.codePointAt(0));function t(R){return R>=a[0]&&R<=a[1]||R>=a[2]&&R<=a[3]||R>=a[4]&&R<=a[5]}function i(){return r((0,n.v4)())}Wn.createSessionId=i;function r(R){return(0,e.assert)(u(R),1187),R}Wn.assertIsStableId=r;function s(R){return r(R),R}Wn.assertIsSessionId=s;function o(){return r((0,n.v4)())}Wn.generateStableId=o;function u(R){if(R.length!==36)return!1;for(let M=0;M<R.length;M++)switch(M){case 8:case 13:case 18:case 23:{if(R.charAt(M)!=="-")return!1;break}case 14:{if(R.charAt(M)!=="4")return!1;break}case 19:{const j=R.charAt(M);if(j!=="8"&&j!=="9"&&j!=="a"&&j!=="b")return!1;break}default:{const j=R.codePointAt(M);if((0,e.assert)(j!==void 0,2735),!t(j))return!1;break}}return!0}Wn.isStableId=u;function c(R,M){return R-M}Wn.compareFiniteNumbers=c;function d(R,M){return R>M?1:R===M?0:-1}Wn.compareStrings=d;function l(R,M){return R>M?1:R===M?0:-1}Wn.compareBigints=l;function f(R){return-R}Wn.genCountFromLocalId=f;function b(R){return-R}Wn.localIdFromGenCount=b;const C=0x4n<<19n*4n,v=0x8n<<15n*4n,m=0xffffffffffffn<<20n*4n,h=m>>6n,g=0xfffn<<16n*4n,_=g>>2n,S=0x3fffffffffffffffn;function p(R){const M=BigInt(`0x${R.replace(/-/g,"")}`),j=M&m,k=M&g,x=M&S,L=j>>6n,V=k>>2n;return L|V|x}Wn.numericUuidFromStableId=p;function w(R){const M=(R&h)<<6n,j=(R&_)<<2n,k=R&S,L=(M|C|j|v|k).toString(16).padStart(32,"0");return`${L.slice(0,8)}-${L.slice(8,12)}-${L.slice(12,16)}-${L.slice(16,20)}-${L.slice(20,32)}`}Wn.stableIdFromNumericUuid=w;function O(R,M){return R+BigInt(M)}Wn.offsetNumericUuid=O;function E(R,M){return R-M}Wn.subtractNumericUuids=E;function F(R,M){return R+M}return Wn.addNumericUuids=F,Wn}var V6;function Yie(){if(V6)return ui;V6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ui,"__esModule",{value:!0}),ui.lastFinalizedLocal=ui.lastAllocatedLocal=ui.lastFinalizedFinal=ui.lastAllocatedFinal=ui.getAlignedLocal=ui.getAlignedFinal=ui.clustersEqual=ui.Session=ui.Sessions=void 0;const e=Je(),n=dl(),a=bE();class t{constructor(b){if(this.uuidSpace=new n.BTree(void 0,a.compareBigints),this.sessionCache=new Map,b!==void 0){for(const[C,v]of b)this.sessionCache.set((0,a.stableIdFromNumericUuid)(C),v);if(this.uuidSpace=new n.BTree(b,a.compareBigints),this.sessionCache.size!==b.length||b.length!==this.uuidSpace.size)throw new Error("Cannot resume existing session.")}}sessions(){return this.sessionCache.values()}getOrCreate(b){const C=this.sessionCache.get(b);if(C!==void 0)return C;const v=new i(b);return(0,e.assert)(this.uuidSpace.set(v.sessionUuid,v),1888),this.sessionCache.set(b,v),v}get(b){return this.sessionCache.get(b)}getContainingCluster(b){const C=(0,a.numericUuidFromStableId)(b),v=this.uuidSpace.getPairOrNextLower(C);if(v===void 0)return;const[m,h]=v,g=(0,a.subtractNumericUuids)(C,h.sessionUuid);if(g>Number.MAX_SAFE_INTEGER)return;const _=(0,a.localIdFromGenCount)(Number(g)+1),S=h.getClusterByLocal(_,!0);if(S!==void 0)return[S,_]}clusterCollides(b){const{session:C,baseLocalId:v,capacity:m}=b,h=(0,a.offsetNumericUuid)(C.sessionUuid,(0,a.genCountFromLocalId)(v)-1),g=(0,a.offsetNumericUuid)(h,m-1);let _=this.uuidSpace.getPairOrNextLower(g);for(;_!==void 0&&_[1]===C;)_=this.uuidSpace.nextLowerPair(_[0]);if(_===void 0)return!1;const[S,p]=_;(0,e.assert)(p!==C,1889);const w=p.getLastCluster();return w===void 0?!1:(0,a.offsetNumericUuid)(p.sessionUuid,(0,a.genCountFromLocalId)(d(w))-1)>=h}equals(b,C){const v=(m,h)=>{const g=m.sessions().next(),_=g.done?void 0:g.value;for(const[S,p]of m.sessionCache.entries()){const w=h.sessionCache.get(S);if(w===void 0){if(!p.isEmpty()||C)return!1;(0,e.assert)(p===_,1890)}else if(!p.equals(w))return!1}return!0};return v(this,b)&&v(b,this)}}ui.Sessions=t;class i{constructor(b){this.clusterChain=[],this.sessionUuid=typeof b=="string"?(0,a.numericUuidFromStableId)(b):b}addNewCluster(b,C,v){const m=this.getLastCluster(),h={session:this,baseFinalId:b,baseLocalId:m===void 0?-1:d(m)-1,capacity:C,count:v};return this.clusterChain.push(h),h}isEmpty(){return this.clusterChain.length===0}getLastCluster(){return this.clusterChain[this.clusterChain.length-1]}tryConvertToFinal(b,C){const v=this.getClusterByLocal(b,C);if(v!==void 0)return s(v,b)}getClusterByLocal(b,C){const v=C?d:l;return i.binarySearch(b,this.clusterChain,(h,g)=>{const _=v(g);return h<_?1:h>g.baseLocalId?-1:0})}getClusterByAllocatedFinal(b){return i.getContainingCluster(b,this.clusterChain)}static getContainingCluster(b,C){return i.binarySearch(b,C,(v,m)=>{const h=u(m);return v<m.baseFinalId?-1:v>h?1:0})}static binarySearch(b,C,v){let m=0,h=C.length-1;for(;m<=h;){const g=Math.floor((m+h)/2),_=C[g];(0,e.assert)(_!==void 0,2524);const S=v(b,_);if(S===0)return _;S>0?m=g+1:h=g-1}}equals(b){for(const[C,v]of Object.entries(this.clusterChain))if(!r(v,b.clusterChain[C]))return!1;return this.sessionUuid===b.sessionUuid}}ui.Session=i;function r(f,b){return f.session.sessionUuid===b.session.sessionUuid&&f.baseFinalId===b.baseFinalId&&f.baseLocalId===b.baseLocalId&&f.capacity===b.capacity&&f.count===b.count}ui.clustersEqual=r;function s(f,b){const C=(0,a.genCountFromLocalId)(b)-(0,a.genCountFromLocalId)(f.baseLocalId);if(C<f.capacity)return f.baseFinalId+C}ui.getAlignedFinal=s;function o(f,b){(0,e.assert)(b>=f.baseFinalId&&b<=u(f),1891);const C=b-f.baseFinalId;return f.baseLocalId-C}ui.getAlignedLocal=o;function u(f){return f.baseFinalId+(f.capacity-1)}ui.lastAllocatedFinal=u;function c(f){return f.baseFinalId+(f.count-1)}ui.lastFinalizedFinal=c;function d(f){return f.baseLocalId-(f.capacity-1)}ui.lastAllocatedLocal=d;function l(f){return f.baseLocalId-(f.count-1)}return ui.lastFinalizedLocal=l,ui}var H6;function Vge(){if(H6)return k0;H6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(k0,"__esModule",{value:!0}),k0.FinalSpace=void 0;const e=Je(),n=Yie();class a{constructor(){this.clusterList=[]}get clusters(){return this.clusterList}getLastCluster(){return this.clusterList[this.clusterList.length-1]}addCluster(i){const r=this.getLastCluster();(0,e.assert)(r===void 0||i.baseFinalId===r.baseFinalId+r.capacity,1875),this.clusterList.push(i)}getFinalizedIdLimit(){const i=this.getLastCluster();return i===void 0?0:(0,n.lastFinalizedFinal)(i)+1}getAllocatedIdLimit(){const i=this.getLastCluster();return i===void 0?0:(0,n.lastAllocatedFinal)(i)+1}equals(i){for(let r=0;r<this.clusterList.length;r++){const s=this.clusterList[r];if(!(0,n.clustersEqual)(s,i.clusterList[r]))return!1}return this.clusterList.length===i.clusterList.length}}return k0.FinalSpace=a,k0}var x0={},K6;function Hge(){if(K6)return x0;K6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(x0,"__esModule",{value:!0}),x0.isFinalId=void 0;function e(n){return n>=0}return x0.isFinalId=e,x0}var Is={},$6;function Kge(){if($6)return Is;$6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Is,"__esModule",{value:!0}),Is.readBoolean=Is.readNumericUuid=Is.readNumber=Is.writeBoolean=Is.writeNumericUuid=Is.writeNumber=void 0;const e=Je(),n=BigInt("0xFFFFFFFFFFFFFFFF"),a=BigInt(64);function t(c,d,l){return c[d]=l,d+1}Is.writeNumber=t;function i(c,d,l){return c[d]=l&n,c[d+1]=l>>a,d+2}Is.writeNumericUuid=i;function r(c,d,l){return t(c,d,l?1:0)}Is.writeBoolean=r;function s(c){const d=c.bufferFloat[c.index];return(0,e.assert)(d!==void 0,2521),c.index+=1,d}Is.readNumber=s;function o(c){const d=c.bufferUint[c.index];(0,e.assert)(d!==void 0,2522);const l=c.bufferUint[c.index+1];(0,e.assert)(l!==void 0,2523);const f=l<<a|d;return c.index+=2,f}Is.readNumericUuid=o;function u(c){return s(c)===1}return Is.readBoolean=u,Is}var q0={},L0={},G6;function $ge(){if(G6)return L0;G6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(L0,"__esModule",{value:!0}),L0.AppendOnlySortedMap=void 0;const e=Je();class n{constructor(t){this.comparator=t,this.elements=[]}get size(){return this.elements.length/2}minKey(){return this.elements[0]}maxKey(){return this.elements[this.elements.length-2]}minValue(){return this.elements[1]}maxValue(){return this.elements[this.elements.length-1]}first(){const{elements:t}=this,{length:i}=t;if(i!==0)return[t[0],t[1]]}last(){const{elements:t}=this,{length:i}=t;if(i===0)return;const r=i-2;return[t[r],t[r+1]]}getAtIndex(t){const i=t*2,{elements:r}=this;if(!(i<0||i>r.length-1))return[r[i],r[i+1]]}*entries(){const{elements:t}=this;for(let i=0;i<t.length;i+=2)yield[t[i],t[i+1]]}*keys(){const{elements:t}=this;for(let i=0;i<t.length;i+=2)yield t[i]}*values(){const{elements:t}=this;for(let i=0;i<t.length;i+=2)yield t[i+1]}*entriesReversed(){const{elements:t}=this;for(let i=t.length-2;i>=0;i-=2)yield[t[i],t[i+1]]}append(t,i){const{elements:r}=this,{length:s}=r;if(s!==0&&this.comparator(t,this.maxKey())<=0)throw new Error("Inserted key must be > all others in the map.");r.push(t,i)}replaceLast(t,i){const{elements:r,comparator:s}=this,{length:o}=r;if(o!==0&&(r.pop(),r.pop(),s(t,this.maxKey())<=0))throw new Error("Inserted key must be > all others in the map.");r.push(t,i)}get(t){const i=n.keyIndexOf(this.elements,t,this.comparator);if(!(i<0))return this.elements[i+1]}getPairOrNextLower(t){return this.getPairOrNextLowerBy(t,this.comparator)}getPairOrNextHigher(t){return this.getPairOrNextHigherBy(t,this.comparator)}equals(t,i){if(t===this)return!0;if(this.elements.length!==t.elements.length)return!1;for(let r=this.elements.length-2;r>=0;r-=2){const s=this.elements[r],o=this.elements[r+1],u=t.elements[r],c=t.elements[r+1];if(this.comparator(s,u)!==0||!i(o,c))return!1}return!0}assertValid(){let t;for(const i of this.entries())t!==void 0&&(0,e.assert)(this.comparator(i[0],t[0])>0,1874),t=i}*getRange(t,i){const r=this.getKeyIndexOfOrNextHigher(t,this.comparator);if(r===void 0)return;const s=this.getKeyIndexOfOrNextLower(i,this.comparator);if(s!==void 0)for(let o=r;o<=s;o+=2)yield[this.elements[o],this.elements[o+1]]}getPairOrNextLowerBy(t,i){const r=this.getKeyIndexOfOrNextLower(t,i);if(r!==void 0)return[this.elements[r],this.elements[r+1]]}getKeyIndexOfOrNextLower(t,i){const{elements:r}=this;if(r.length===0)return;let s=n.keyIndexOf(r,t,i);return s<0?(s^=n.failureXor,s>0?s-2:void 0):s}getPairOrNextHigherBy(t,i){const r=this.getKeyIndexOfOrNextHigher(t,i);if(r!==void 0)return[this.elements[r],this.elements[r+1]]}getKeyIndexOfOrNextHigher(t,i){const{elements:r}=this,{length:s}=r;if(s===0)return;let o=n.keyIndexOf(r,t,i);return o<0?(o^=n.failureXor,o<s?o:void 0):o}static keyIndexOf(t,i,r){let s=0,o=t.length/2,u=o>>1;for(;s<o;){const c=u*2,d=r(i,t[c],t[c+1]);if(d>0)s=u+1;else if(d<0)o=u;else{if(d===0)return c;throw new Error("Invalid comparator.")}u=s+o>>1}return u*2^n.failureXor}}return L0.AppendOnlySortedMap=n,n.failureXor=-1,L0}var W6;function Gge(){if(W6)return q0;W6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(q0,"__esModule",{value:!0}),q0.SessionSpaceNormalizer=void 0;const e=Je(),n=$ge(),a=bE();class t{constructor(){this.localIdRanges=new n.AppendOnlySortedMap(a.compareFiniteNumbers)}get idRanges(){return this.localIdRanges}getRangesBetween(r,s){const o=[];let u=this.localIdRanges.getPairOrNextLower(r);if((u===void 0||!this.rangeContains(u,r))&&(u=this.localIdRanges.getPairOrNextHigher(r),u===void 0))return o;for(const[v,m]of this.localIdRanges.getRange(u[0],s))o.push([v,m]);if(o.length===0)return o;(0,e.assert)(o[0]!==void 0,2525);const[c,d]=o[0];this.rangeContains(o[0],r)?(o[0]=[r,d-(r-c)],(0,e.assert)(this.rangeContains(o[0],r),2386)):(0,e.assert)(c>r,2387);const l=o.length-1,f=o[l];(0,e.assert)(f!==void 0,2526);const[b,C]=f;return this.rangeContains(f,s)?(o[l]=[b,s-b+1],(0,e.assert)(this.rangeContains(f,s),2388)):(0,e.assert)(b+C-1<s,2389),o}rangeContains(r,s){const[o,u]=r;return s>=o&&s<o+u}addLocalRange(r,s){const o=this.localIdRanges.last();if(o!==void 0){const[u,c]=o;if(u+c===r){this.localIdRanges.replaceLast(u,c+s);return}}this.localIdRanges.append(r,s)}contains(r){const s=(0,a.genCountFromLocalId)(r),o=this.localIdRanges.getPairOrNextLower(s);if(o!==void 0){const[u,c]=o;if(s<=u+(c-1))return!0}return!1}equals(r){return this.localIdRanges.equals(r.localIdRanges,(s,o)=>s===o)}}return q0.SessionSpaceNormalizer=t,q0}var J6;function Wge(){if(J6)return hu;J6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(hu,"__esModule",{value:!0}),hu.deserializeIdCompressor=hu.createIdCompressor=hu.IdCompressor=void 0;const e=Ht(),n=Je(),a=Ot(),t=Vge(),i=Hge(),r=Kge(),s=Gge(),o=Yie(),u=bE(),c=2;function d(C,v){return new a.LoggingError("Ranges finalized out of order",{expectedStart:C,actualStart:v})}class l{constructor(v,m){if(this.logger=m,this.normalizer=new s.SessionSpaceNormalizer,this.localGenCount=0,this.nextRangeBaseGenCount=1,this.sessions=new o.Sessions,this.finalSpace=new t.FinalSpace,this.nextRequestedClusterSize=512,this.telemetryLocalIdCount=0,this.telemetryEagerFinalIdCount=0,typeof v=="string")this.localSessionId=v,this.localSession=this.sessions.getOrCreate(v);else{this.sessions=v;const h=v.sessions().next();(0,n.assert)(!h.done,1876),this.localSession=h.value,this.localSessionId=(0,u.stableIdFromNumericUuid)(this.localSession.sessionUuid)}}generateCompressedId(){if(this.ongoingGhostSession)return this.ongoingGhostSession.cluster===void 0?this.ongoingGhostSession.cluster=this.addEmptyCluster(this.sessions.getOrCreate(this.ongoingGhostSession.ghostSessionId),1):this.ongoingGhostSession.cluster.capacity++,this.ongoingGhostSession.cluster.count++,(0,o.lastFinalizedFinal)(this.ongoingGhostSession.cluster);{this.localGenCount++;const v=this.localSession.getLastCluster();if(v===void 0)return this.telemetryLocalIdCount++,this.generateNextLocalId();const m=this.localGenCount-(0,u.genCountFromLocalId)(v.baseLocalId);return v.capacity>m?(this.telemetryEagerFinalIdCount++,v.baseFinalId+m):(this.telemetryLocalIdCount++,this.generateNextLocalId())}}generateDocumentUniqueId(){const v=this.generateCompressedId();return(0,i.isFinalId)(v)?v:this.decompress(v)}startGhostSession(v){(0,n.assert)(!this.ongoingGhostSession,2302),this.ongoingGhostSession={ghostSessionId:v}}beginGhostSession(v,m){this.startGhostSession(v);try{m()}finally{this.ongoingGhostSession=void 0}}generateNextLocalId(){return this.normalizer.addLocalRange(this.localGenCount,1),(0,u.localIdFromGenCount)(this.localGenCount)}takeNextCreationRange(){(0,n.assert)(!this.ongoingGhostSession,2214);const v=this.localGenCount-(this.nextRangeBaseGenCount-1);if(v===0)return{sessionId:this.localSessionId};const m={sessionId:this.localSessionId,ids:{firstGenCount:this.nextRangeBaseGenCount,count:v,requestedClusterSize:this.nextRequestedClusterSize,localIdRanges:this.normalizer.getRangesBetween(this.nextRangeBaseGenCount,this.localGenCount)}};return this.updateToRange(m)}takeUnfinalizedCreationRange(){const v=this.localSession.getLastCluster();let m,h;if(v===void 0?(h=1,m=this.localGenCount):(h=(0,u.genCountFromLocalId)(v.baseLocalId-v.count),m=this.localGenCount-h+1),m===0)return{sessionId:this.localSessionId};const g={ids:{count:m,firstGenCount:h,localIdRanges:this.normalizer.getRangesBetween(h,this.localGenCount),requestedClusterSize:this.nextRequestedClusterSize},sessionId:this.localSessionId};return this.updateToRange(g)}updateToRange(v){return this.nextRangeBaseGenCount=this.localGenCount+1,l.assertValidRange(v)}static assertValidRange(v){if(v.ids===void 0)return v;const{count:m,requestedClusterSize:h}=v.ids;return(0,n.assert)(m>0,1877),(0,n.assert)(h>0,2166),(0,n.assert)(h<=l.maxClusterSize,2167),v}finalizeCreationRange(v){if((0,n.assert)(!this.ongoingGhostSession,2215),v.ids===void 0)return;l.assertValidRange(v);const{sessionId:m,ids:h}=v,{count:g,firstGenCount:_,requestedClusterSize:S}=h,p=this.sessions.getOrCreate(m),w=p===this.localSession,O=(0,u.localIdFromGenCount)(_);let E=p.getLastCluster();if(E===void 0){if(O!==-1)throw d(-1,O);E=this.addEmptyCluster(p,S+g),w&&this.logger?.sendTelemetryEvent({eventName:"RuntimeIdCompressor:FirstCluster",sessionId:this.localSessionId})}const F=E.capacity-E.count;if(E.baseLocalId-E.count!==O)throw d(E.baseLocalId-E.count,O);if(F>=g)E.count+=g;else{const R=g-F,M=R+S;if(E===this.finalSpace.getLastCluster())E.capacity+=M,E.count+=g,(0,n.assert)(!this.sessions.clusterCollides(E),1878),w&&this.logger?.sendTelemetryEvent({eventName:"RuntimeIdCompressor:ClusterExpansion",sessionId:this.localSessionId,previousCapacity:E.capacity-M,newCapacity:E.capacity,overflow:R});else{E.count=E.capacity;const j=this.addEmptyCluster(p,M);j.count+=R,w&&this.logger?.sendTelemetryEvent({eventName:"RuntimeIdCompressor:NewCluster",sessionId:this.localSessionId})}}w&&(this.logger?.sendTelemetryEvent({eventName:"RuntimeIdCompressor:IdCompressorStatus",eagerFinalIdCount:this.telemetryEagerFinalIdCount,localIdCount:this.telemetryLocalIdCount,sessionId:this.localSessionId}),this.telemetryEagerFinalIdCount=0,this.telemetryLocalIdCount=0),(0,n.assert)(!p.isEmpty(),1879)}addEmptyCluster(v,m){(0,n.assert)(!this.ongoingGhostSession?.cluster,2216);const h=v.addNewCluster(this.finalSpace.getAllocatedIdLimit(),m,0);return(0,n.assert)(!this.sessions.clusterCollides(h),1880),this.finalSpace.addCluster(h),h}normalizeToOpSpace(v){if((0,i.isFinalId)(v))return v;{const m=v;if(!this.normalizer.contains(m))throw new Error("Invalid ID to normalize.");const h=this.localSession.tryConvertToFinal(m,!0);return h===void 0?m:h}}normalizeToSessionSpace(v,m){if((0,i.isFinalId)(v)){const h=this.localSession.getClusterByAllocatedFinal(v);if(h===void 0){if(v>=this.finalSpace.getFinalizedIdLimit())throw new Error("Unknown op space ID.");return v}else{const g=(0,o.getAlignedLocal)(h,v);if(this.normalizer.contains(g))return g;if((0,u.genCountFromLocalId)(g)>this.localGenCount)throw new Error("Unknown op space ID.");return v}}else{const h=v;if(m===this.localSessionId){if(this.normalizer.contains(h))return h;throw new Error("Unknown op space ID.")}else{const g=this.sessions.get(m);if(g===void 0)throw new Error("No IDs have ever been finalized by the supplied session.");const _=g.tryConvertToFinal(h,!1);if(_===void 0)throw new Error("Unknown op space ID.");return _}}}decompress(v){if((0,i.isFinalId)(v)){const m=o.Session.getContainingCluster(v,this.finalSpace.clusters);if(m===void 0)throw new Error("Unknown ID");const h=(0,o.getAlignedLocal)(m,v),g=(0,u.genCountFromLocalId)(h),_=(0,u.genCountFromLocalId)((0,o.lastFinalizedLocal)(m));if(g>_)if(m.session===this.localSession)(0,n.assert)(!this.normalizer.contains(h),1881);else throw new Error("Unknown ID");return(0,u.stableIdFromNumericUuid)((0,u.offsetNumericUuid)(m.session.sessionUuid,g-1))}else{const m=v;if(!this.normalizer.contains(m))throw new Error("Unknown ID");return(0,u.stableIdFromNumericUuid)((0,u.offsetNumericUuid)(this.localSession.sessionUuid,(0,u.genCountFromLocalId)(m)-1))}}recompress(v){const m=this.tryRecompress(v);if(m===void 0)throw new Error("Could not recompress.");return m}tryRecompress(v){const m=this.sessions.getContainingCluster(v);if(m===void 0){const h=(0,u.numericUuidFromStableId)(v),g=(0,u.subtractNumericUuids)(h,this.localSession.sessionUuid);if(g<Number.MAX_SAFE_INTEGER){const _=Number(g)+1,S=(0,u.localIdFromGenCount)(_);if(this.normalizer.contains(S))return S}return}else{const[h,g]=m;return h.session===this.localSession?this.normalizer.contains(g)?g:((0,n.assert)((0,u.genCountFromLocalId)(g)<=this.localGenCount,1882),(0,o.getAlignedFinal)(h,g)):(0,u.genCountFromLocalId)(g)>=(0,o.lastFinalizedLocal)(h)?(0,o.getAlignedFinal)(h,g):void 0}}serialize(v){(0,n.assert)(!this.ongoingGhostSession,2217);const{normalizer:m,finalSpace:h,sessions:g,localGenCount:_,logger:S,nextRangeBaseGenCount:p}=this,w=new Map;let O=0;for(const k of g.sessions())(!k.isEmpty()||v)&&(w.set(k,O),O++);const E=v?3+m.idRanges.size*2:0,F=4+w.size*2+h.clusters.length*3+E,R=new Float64Array(F),M=new BigUint64Array(R.buffer);let j=0;j=(0,r.writeNumber)(R,j,c),j=(0,r.writeBoolean)(R,j,v),j=(0,r.writeNumber)(R,j,w.size),j=(0,r.writeNumber)(R,j,h.clusters.length);for(const[k]of w.entries())j=(0,r.writeNumericUuid)(M,j,k.sessionUuid);for(const k of h.clusters)j=(0,r.writeNumber)(R,j,w.get(k.session)),j=(0,r.writeNumber)(R,j,k.capacity),j=(0,r.writeNumber)(R,j,k.count);if(v){j=(0,r.writeNumber)(R,j,_),j=(0,r.writeNumber)(R,j,p),j=(0,r.writeNumber)(R,j,m.idRanges.size);for(const[k,x]of m.idRanges.entries())j=(0,r.writeNumber)(R,j,k),j=(0,r.writeNumber)(R,j,x)}return(0,n.assert)(j===F,1883),S?.sendTelemetryEvent({eventName:"RuntimeIdCompressor:SerializedIdCompressorSize",size:R.byteLength,clusterCount:h.clusters.length,sessionCount:w.size}),(0,e.bufferToString)(R.buffer,"base64")}static deserialize(v){const{serialized:m,newSessionId:h,logger:g}=v,_=(0,e.stringToBuffer)(m,"base64"),S={index:0,bufferFloat:new Float64Array(_),bufferUint:new BigUint64Array(_)};switch((0,r.readNumber)(S)){case 1:throw new Error("IdCompressor version 1.0 is no longer supported.");case 2:return l.deserialize2_0(S,h,g);default:throw new Error("Unknown IdCompressor serialized version.")}}static deserialize2_0(v,m,h){const g=(0,r.readBoolean)(v),_=(0,r.readNumber)(v),S=(0,r.readNumber)(v);let p=0;const w=[];if(g)(0,n.assert)(m===void 0,1886);else{(0,n.assert)(m!==void 0,1885);const F=(0,u.numericUuidFromStableId)(m);w.push([F,new o.Session(F)]),p=1}for(let F=0;F<_;F++){const R=(0,r.readNumericUuid)(v);w.push([R,new o.Session(R)])}const O=new l(new o.Sessions(w),h);let E=0;for(let F=0;F<S;F++){const R=(0,r.readNumber)(v),M=w[R+p];(0,n.assert)(M!==void 0,2520);const j=M[1],k=(0,r.readNumber)(v),x=(0,r.readNumber)(v),L=j.addNewCluster(E,k,x);O.finalSpace.addCluster(L),E+=k}if(g){O.localGenCount=(0,r.readNumber)(v),O.nextRangeBaseGenCount=(0,r.readNumber)(v);const F=(0,r.readNumber)(v);for(let R=0;R<F;R++)O.normalizer.addLocalRange((0,r.readNumber)(v),(0,r.readNumber)(v))}return(0,n.assert)(v.index===v.bufferFloat.length,1887),O}equals(v,m){return m&&(this.localSessionId!==v.localSessionId||!this.localSession.equals(v.localSession)||!this.normalizer.equals(v.normalizer)||this.nextRangeBaseGenCount!==v.nextRangeBaseGenCount||this.localGenCount!==v.localGenCount)?!1:this.sessions.equals(v.sessions,m)&&this.finalSpace.equals(v.finalSpace)}}hu.IdCompressor=l,l.maxClusterSize=2**20;function f(C,v){let m,h;return C===void 0?m=(0,u.createSessionId)():typeof C=="string"?(m=C,h=v):(m=(0,u.createSessionId)(),h=C),new l(m,h===void 0?void 0:(0,a.createChildLogger)({logger:h}))}hu.createIdCompressor=f;function b(C,v,m){return typeof v=="string"?l.deserialize({serialized:C,logger:m,newSessionId:v}):((0,n.assert)(m===void 0,3117),l.deserialize({serialized:C,logger:v}))}return hu.deserializeIdCompressor=b,hu}var Q6;function fl(){return Q6||(Q6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isStableId=e.generateStableId=e.assertIsStableId=e.createSessionId=e.deserializeIdCompressor=e.createIdCompressor=void 0;var n=Wge();Object.defineProperty(e,"createIdCompressor",{enumerable:!0,get:function(){return n.createIdCompressor}}),Object.defineProperty(e,"deserializeIdCompressor",{enumerable:!0,get:function(){return n.deserializeIdCompressor}});var a=bE();Object.defineProperty(e,"createSessionId",{enumerable:!0,get:function(){return a.createSessionId}}),Object.defineProperty(e,"assertIsStableId",{enumerable:!0,get:function(){return a.assertIsStableId}}),Object.defineProperty(e,"generateStableId",{enumerable:!0,get:function(){return a.generateStableId}}),Object.defineProperty(e,"isStableId",{enumerable:!0,get:function(){return a.isStableId}})})(_j)),_j}var Mf={},Y6;function Jge(){if(Y6)return Mf;Y6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Mf,"__esModule",{value:!0}),Mf.BindBatchTracker=Mf.BatchTracker=void 0;const e=Ht(),n=Je(),a=Ot();class t{constructor(s,o,u,c,d=()=>(0,e.performanceNow)()){this.batchEventEmitter=s,this.trackedBatchCount=0,this.logger=(0,a.createChildLogger)({logger:o,namespace:"Batching"}),this.batchEventEmitter.on("batchBegin",l=>{this.startBatchSequenceNumber=l.sequenceNumber,this.batchProcessingStartTimeStamp=d(),this.trackedBatchCount++}),this.batchEventEmitter.on("batchEnd",(l,f)=>{(0,n.assert)(this.startBatchSequenceNumber!==void 0&&this.batchProcessingStartTimeStamp!==void 0,698);const b=f.sequenceNumber-this.startBatchSequenceNumber+1;b>=u&&this.logger.sendPerformanceEvent({eventName:"LengthTooBig",length:b,threshold:u,batchEndSequenceNumber:f.sequenceNumber,duration:d()-this.batchProcessingStartTimeStamp,batchError:l!==void 0}),this.trackedBatchCount%c===0&&this.logger.sendPerformanceEvent({eventName:"Length",length:b,samplingRate:c,batchEndSequenceNumber:f.sequenceNumber,duration:d()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0})}}Mf.BatchTracker=t;const i=(r,s,o=1e3,u=1e3)=>new t(r,s,o,u);return Mf.BindBatchTracker=i,Mf}var Tj={},wj={},mu={},X6;function vE(){if(X6)return mu;X6=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(mu,"__esModule",{value:!0}),mu.isBlobMetadata=mu.asEmptyBatchLocalOpMetadata=mu.asBatchMetadata=void 0;function e(t){return t}mu.asBatchMetadata=e;function n(t){return t}mu.asEmptyBatchLocalOpMetadata=n;const a=t=>!!t&&typeof t.blobId=="string"&&typeof t.localId=="string";return mu.isBlobMetadata=a,mu}var Oj={},Z6;function Xie(){return Z6||(Z6=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getStorageIds=e.summarizeBlobManagerState=e.toRedirectTable=e.loadBlobManagerLoadInfo=e.blobsTreeName=e.redirectTableBlobName=void 0;const n=Mr(),a=Je(),t=Kn(),i=bn();e.redirectTableBlobName=".redirectTable",e.blobsTreeName=".blobs";const r=async l=>s(l);e.loadBlobManagerLoadInfo=r;const s=async l=>{const f=l.baseSnapshot?.trees[e.blobsTreeName];if(!f)return{};let b=[];const C=f.blobs[e.redirectTableBlobName];return C&&(b=await(0,t.readAndParse)(l.storage,C)),{ids:Object.entries(f.blobs).filter(([m,h])=>m!==e.redirectTableBlobName).map(([m,h])=>h),redirectTable:b}},o=(l,f,b)=>{f.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:l.ids?.length??0,redirectTable:l.redirectTable?.length});const C=new Map(l.redirectTable),v=b!==n.AttachState.Attached;if(l.ids)for(const m of l.ids)C.set(m,v?void 0:m);return C};e.toRedirectTable=o;const u=(l,f)=>c(l,f);e.summarizeBlobManagerState=u;const c=(l,f)=>{const b=(0,e.getStorageIds)(l,f),C=b.size>0?[...b]:[...l.keys()],v=new i.SummaryTreeBuilder;for(const m of C)v.addAttachment(m);return l.size>C.length&&v.addBlob(e.redirectTableBlobName,JSON.stringify([...l.entries()].filter(([m,h])=>m!==h))),v.getSummaryTree()},d=(l,f)=>{const b=new Set(l.values()),C=b.delete(void 0);return(0,a.assert)(!C||f===n.AttachState.Detached&&b.size===0,898),b};e.getStorageIds=d})(Oj)),Oj}var e5;function Qge(){return e5||(e5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isBlobPath=e.BlobManager=e.blobManagerBasePath=e.BlobHandle=void 0;const n=Ht(),a=Mr(),t=Je(),i=bn(),r=Ot(),s=ys(),o=vE(),u=Xie();class c extends i.FluidHandleBase{get isAttached(){return this.routeContext.isAttached&&this.attached}get events(){return this._events??=(0,n.createEmitter)()}get payloadState(){return this._state}get payloadShareError(){return this._payloadShareError}constructor(m,h,g,_,S){super(),this.path=m,this.routeContext=h,this.get=g,this.payloadPending=_,this.onAttachGraph=S,this.attached=!1,this._state="pending",this.notifyShared=()=>{this._state="shared",this._events?.emit("payloadShared")},this.notifyFailed=p=>{this._payloadShareError=p,this._events?.emit("payloadShareFailed",p)},this.absolutePath=(0,i.generateHandleContextPath)(m,this.routeContext)}attachGraph(){this.attached||(this.attached=!0,this.onAttachGraph?.())}}e.BlobHandle=c,e.blobManagerBasePath="_blobs";class d{get events(){return this.publicEvents}constructor(m){this.publicEvents=(0,n.createEmitter)(),this.internalEvents=(0,n.createEmitter)(),this.pendingBlobs=new Map,this.opsInFlight=new Map;const{routeContext:h,blobManagerLoadInfo:g,storage:_,sendBlobAttachOp:S,blobRequested:p,isBlobDeleted:w,runtime:O,localBlobIdGenerator:E,createBlobPayloadPending:F}=m;this.routeContext=h,this.storage=_,this.blobRequested=p,this.isBlobDeleted=w,this.runtime=O,this.localBlobIdGenerator=E??s.v4,this.createBlobPayloadPending=F,this.mc=(0,r.createChildMonitoringContext)({logger:this.runtime.baseLogger,namespace:"BlobManager"}),this.redirectTable=(0,u.toRedirectTable)(g,this.mc.logger,this.runtime.attachState),this.sendBlobAttachOp=(R,M)=>{const j=this.pendingBlobs.get(R);if((0,t.assert)(j!==void 0,1829),j?.uploadTime&&j?.minTTLInSeconds){const k=(Date.now()-j.uploadTime)/1e3,x=j.minTTLInSeconds-k<0;if(this.mc.logger.sendTelemetryEvent({eventName:"sendBlobAttach",secondsSinceUpload:k,minTTLInSeconds:j.minTTLInSeconds,expired:x}),x){this.pendingBlobs.set(R,{...j,storageId:void 0,uploadTime:void 0,minTTLInSeconds:void 0,opsent:!1,uploadP:this.uploadBlob(R,j.blob)});return}}j.opsent=!0,S(R,M)}}get allBlobsAttached(){for(const m of this.pendingBlobs.values())if(m.attached===!1)return!1;return!0}get hasPendingBlobs(){return this.runtime.attachState!==a.AttachState.Attached&&this.redirectTable.size>0||this.pendingBlobs.size>0}createAbortError(m){return new r.LoggingError("uploadBlob aborted",{acked:m?.acked,uploadTime:m?.uploadTime})}hasBlob(m){return this.redirectTable.get(m)!==void 0}async getBlob(m,h){this.verifyBlobNotDeleted(m),this.blobRequested(l(m));const g=this.pendingBlobs.get(m);if(g)return g.blob;let _;if(this.runtime.attachState===a.AttachState.Detached)(0,t.assert)(this.redirectTable.has(m),899),_=m;else{const S=this.redirectTable.get(m);h||(0,t.assert)(S!==void 0,287),_=S??await new Promise(p=>{const w=(O,E)=>{O===m&&(this.internalEvents.off("processedBlobAttach",w),p(E))};this.internalEvents.on("processedBlobAttach",w)})}return r.PerformanceEvent.timedExecAsync(this.mc.logger,{eventName:"AttachmentReadBlob",id:_},async S=>this.storage.readBlob(_).catch(p=>{throw this.runtime.disposed&&S.cancel({category:"generic"}),p}),{end:!0,cancel:"error"})}getBlobHandle(m){(0,t.assert)(this.redirectTable.has(m)||this.pendingBlobs.has(m),900);const h=this.pendingBlobs.get(m),g=h?()=>{h.attached=!0,this.internalEvents.emit("handleAttached",h),this.deletePendingBlobMaybe(m)}:void 0;return new c(l(m),this.routeContext,async()=>this.getBlob(m,!1),!1,g)}async createBlobDetached(m){const h=await this.storage.createBlob(m);return this.setRedirection(h.id,void 0),this.getBlobHandle(h.id)}async createBlob(m,h){return this.runtime.attachState===a.AttachState.Detached?this.createBlobDetached(m):(this.runtime.attachState===a.AttachState.Attaching&&(this.mc.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise(g=>this.runtime.once("attached",g))),(0,t.assert)(this.runtime.attachState===a.AttachState.Attached,901),this.createBlobPayloadPending?this.createBlobWithPayloadPending(m):this.createBlobLegacy(m,h))}async createBlobLegacy(m,h){if(h?.aborted)throw this.createAbortError();const g=this.localBlobIdGenerator(),_={blob:m,handleP:new t.Deferred,uploadP:this.uploadBlob(g,m),attached:!1,acked:!1,abortSignal:h,opsent:!1};this.pendingBlobs.set(g,_);const S=()=>{_.acked||_.handleP.reject(this.createAbortError(_))};return h?.addEventListener("abort",S,{once:!0}),_.handleP.promise.finally(()=>{h?.removeEventListener("abort",S)})}createBlobWithPayloadPending(m){const h=this.localBlobIdGenerator(),g=new c(l(h),this.routeContext,async()=>m,!0,()=>{const p={blob:m,handleP:new t.Deferred,uploadP:this.uploadBlob(h,m),attached:!0,acked:!1,opsent:!1};this.pendingBlobs.set(h,p)}),_=(p,w)=>{p===h&&(this.internalEvents.off("processedBlobAttach",_),g.notifyShared())};this.internalEvents.on("processedBlobAttach",_);const S=(p,w)=>{p===h&&(this.internalEvents.off("uploadFailed",S),g.notifyFailed(w))};return this.internalEvents.on("uploadFailed",S),g}async uploadBlob(m,h){let g;try{g=await this.storage.createBlob(h)}catch(_){const S=this.pendingBlobs.get(m);this.mc.logger.sendTelemetryEvent({eventName:"UploadBlobReject",error:_,message:S===void 0?"Missing pendingBlob":void 0,localId:m}),S!==void 0&&(S.handleP.reject(_),this.deletePendingBlob(m)),this.internalEvents.emit("uploadFailed",m,_);return}try{this.onUploadResolve(m,g)}catch(_){this.mc.logger.sendTelemetryEvent({eventName:"OnUploadResolveError",error:_,localId:m})}}setRedirection(m,h){this.redirectTable.set(m,h)}deletePendingBlobMaybe(m){if(this.pendingBlobs.has(m)){const h=this.pendingBlobs.get(m);h?.attached&&h?.acked&&this.deletePendingBlob(m)}}deletePendingBlob(m){this.pendingBlobs.delete(m)&&!this.hasPendingBlobs&&this.publicEvents.emit("noPendingBlobs")}onUploadResolve(m,h){const g=this.pendingBlobs.get(m);if((0,t.assert)(g!==void 0,1736),g.abortSignal?.aborted===!0&&!g.opsent){this.mc.logger.sendTelemetryEvent({eventName:"BlobAborted",localId:m}),this.deletePendingBlob(m);return}if((0,t.assert)(g.storageId===void 0,902),g.storageId=h.id,g.uploadTime=Date.now(),g.minTTLInSeconds=h.minTTLInSeconds,g.opsent||this.sendBlobAttachOp(m,h.id),(0,u.getStorageIds)(this.redirectTable,this.runtime.attachState).has(h.id)){this.setRedirection(m,h.id);const S=this.getBlobHandle(m);S.notifyShared(),g.handleP.resolve(S),this.deletePendingBlobMaybe(m)}else{let S=this.opsInFlight.get(h.id);S===void 0&&(S=new Set,this.opsInFlight.set(h.id,S)),S.add(m)}return h}reSubmit(m){(0,t.assert)((0,o.isBlobMetadata)(m),3073);const{localId:h,blobId:g}=m;this.pendingBlobs.has(h)&&this.sendBlobAttachOp(h,g)}processBlobAttachMessage(m,h){(0,t.assert)((0,o.isBlobMetadata)(m.metadata),3074);const{localId:g,blobId:_}=m.metadata;if(this.pendingBlobs.get(g)?.abortSignal?.aborted){this.deletePendingBlob(g);return}if(this.setRedirection(g,_),this.setRedirection(_,_),h){const p=this.opsInFlight.get(_);if(p!==void 0){for(const O of p){const E=this.pendingBlobs.get(O);(0,t.assert)(E!==void 0,911),this.setRedirection(O,_),E.acked=!0;const F=this.getBlobHandle(O);F.notifyShared(),E.handleP.resolve(F),this.deletePendingBlobMaybe(O)}this.opsInFlight.delete(_)}const w=this.pendingBlobs.get(g);if(w){w.acked=!0;const O=this.getBlobHandle(g);O.notifyShared(),w.handleP.resolve(O),this.deletePendingBlobMaybe(g)}}this.internalEvents.emit("processedBlobAttach",g,_)}summarize(m){return(0,u.summarizeBlobManagerState)(this.redirectTable,this.runtime.attachState)}getGCData(m=!1){const h={gcNodes:{}};for(const[g,_]of this.redirectTable)(0,t.assert)(!!_,912),g!==_&&(h.gcNodes[l(g)]=[]);return h}deleteSweepReadyNodes(m){return this.deleteBlobsFromRedirectTable(m),[...m]}deleteBlobsFromRedirectTable(m){if(m.length===0)return;const h=new Set;for(const g of m){const _=f(g),S=this.isBlobDeleted(g);if(!this.redirectTable.has(_)){this.mc.logger.sendTelemetryEvent({eventName:"DeletedAttachmentBlobNotFound",category:S?"generic":"error",blobId:_,details:{alreadyDeleted:S}});continue}const p=this.redirectTable.get(_);(0,t.assert)(!!p,1467),h.add(p),this.redirectTable.delete(_)}for(const[g,_]of this.redirectTable.entries())(0,t.assert)(!!_,1468),h.has(_)&&g!==_&&h.delete(_);for(const g of h)this.redirectTable.delete(g)}verifyBlobNotDeleted(m){if(!this.isBlobDeleted(l(m)))return;const h={url:m},g=(0,i.responseToException)((0,i.createResponseError)(404,"Blob was deleted",h),h);throw this.mc.logger.sendErrorEvent({eventName:"GC_Deleted_Blob_Requested",pkg:e.blobManagerBasePath},g),g}setRedirectTable(m){(0,t.assert)(this.runtime.attachState===a.AttachState.Detached,594),(0,t.assert)(this.redirectTable.size===m.size,913);for(const[h,g]of m)(0,t.assert)(this.redirectTable.has(h),596),this.setRedirection(h,g),this.setRedirection(g,g)}getPendingBlobs(){}async attachAndGetPendingBlobs(m){throw new r.UsageError("attachAndGetPendingBlobs is no longer supported")}}e.BlobManager=d;const l=v=>`/${e.blobManagerBasePath}/${v}`,f=v=>{const m=v.split("/");return(0,t.assert)(C(m),1469),m[2]},b=v=>C(v.split("/"));e.isBlobPath=b;const C=v=>v.length===3&&v[1]===e.blobManagerBasePath})(wj)),wj}var t5;function Sx(){return t5||(t5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.redirectTableBlobName=e.blobsTreeName=e.loadBlobManagerLoadInfo=e.isBlobPath=e.blobManagerBasePath=e.BlobManager=void 0;var n=Qge();Object.defineProperty(e,"BlobManager",{enumerable:!0,get:function(){return n.BlobManager}}),Object.defineProperty(e,"blobManagerBasePath",{enumerable:!0,get:function(){return n.blobManagerBasePath}}),Object.defineProperty(e,"isBlobPath",{enumerable:!0,get:function(){return n.isBlobPath}});var a=Xie();Object.defineProperty(e,"loadBlobManagerLoadInfo",{enumerable:!0,get:function(){return a.loadBlobManagerLoadInfo}}),Object.defineProperty(e,"blobsTreeName",{enumerable:!0,get:function(){return a.blobsTreeName}}),Object.defineProperty(e,"redirectTableBlobName",{enumerable:!0,get:function(){return a.redirectTableBlobName}})})(Tj)),Tj}var Pj={},Nf={},B0={},n5;function $g(){if(n5)return B0;n5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(B0,"__esModule",{value:!0}),B0.ContainerMessageType=void 0;var e;return(function(n){n.FluidDataStoreOp="component",n.Attach="attach",n.ChunkedOp="chunkedOp",n.BlobAttach="blobAttach",n.Rejoin="rejoin",n.Alias="alias",n.IdAllocation="idAllocation",n.DocumentSchemaChange="schema",n.GC="GC"})(e||(B0.ContainerMessageType=e={})),B0}var r5;function Zie(){if(r5)return Nf;r5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Nf,"__esModule",{value:!0}),Nf.channelToDataStore=Nf.isDataStoreAliasMessage=void 0;const e=Mr(),n=Je(),a=Ot(),t=$g(),i=u=>typeof u?.internalId=="string"&&typeof u?.alias=="string";Nf.isDataStoreAliasMessage=i;const r=(u,c,d,l)=>new o(u,c,d,l);Nf.channelToDataStore=r;var s;(function(u){u.Aliased="Aliased",u.Aliasing="Aliasing",u.None="None"})(s||(s={}));class o{async trySetAlias(c){if(c.includes("/"))throw new a.UsageError(`The alias cannot contain slashes: '${c}'`);if(this.parentContext.containerRuntime.inStagingMode===!0)throw new a.UsageError("Cannot set aliases while in staging mode");switch(this.aliasState){case s.Aliasing:return(0,n.assert)(this.aliasResult!==void 0,790),await this.aliasResult,this.alias===c?"Success":"AlreadyAliased";case s.Aliased:return this.alias===c?"Success":"AlreadyAliased";case s.None:{if(this.pendingAliases.get(c)!==void 0)return"Conflict";break}default:(0,n.unreachableCase)(this.aliasState)}return this.aliasState=s.Aliasing,this.aliasResult=this.trySetAliasInternal(c),this.pendingAliases.set(c,this.aliasResult),this.aliasResult}async trySetAliasInternal(c){const d={internalId:this.internalId,alias:c};if(this.fluidDataStoreChannel.makeVisibleAndAttachGraph(),this.parentContext.attachState===e.AttachState.Detached){const f=this.channelCollection.processAliasMessageCore(this.internalId,c);return this.aliasState=s.Aliased,f?"Success":"Conflict"}return await this.ackBasedPromise(f=>{this.parentContext.submitMessage(t.ContainerMessageType.Alias,d,f)}).catch(f=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:c,tag:a.TelemetryDataTag.UserData},internalId:{value:this.internalId,tag:a.TelemetryDataTag.CodeArtifact}},f),!1)).finally(()=>{this.pendingAliases.delete(c)})?(this.alias=c,this.aliasState=s.Aliased,"Success"):(this.aliasState=s.None,this.aliasResult=void 0,"Conflict")}get entryPoint(){return this.fluidDataStoreChannel.entryPoint}constructor(c,d,l,f,b=l.parentContext){this.fluidDataStoreChannel=c,this.internalId=d,this.channelCollection=l,this.logger=f,this.parentContext=b,this.aliasState=s.None,this.pendingAliases=l.pendingAliases}async ackBasedPromise(c){let d;return new Promise((l,f)=>{if(d=()=>f(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.parentContext.containerRuntime.disposed){d();return}this.parentContext.containerRuntime.on("dispose",d),c(l,f)}).finally(()=>{this.parentContext.containerRuntime.off("dispose",d)})}}return Nf}var Rs={},pu={},Ej={},Ij={},Af={},i5;function ese(){if(i5)return Af;i5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Af,"__esModule",{value:!0}),Af.createRootSummarizerNode=Af.SummarizerNode=void 0;const e=Je(),n=on(),a=ja(),t=bn(),i=Ot();class r{get referenceSequenceNumber(){return this._lastSummaryReferenceSequenceNumber??0}get summaryHandleId(){return this._summaryHandleId}constructor(u,c,d,l,f,b,C,v){this.summarizeInternalFn=c,this._summaryHandleId=l,this._changeSequenceNumber=f,this._lastSummaryReferenceSequenceNumber=b,this.wipSummaryLogger=C,this.telemetryNodeId=v,this.children=new Map,this.pendingSummaries=new Map,this.wipSummarizeCalled=!1,this.wipSkipRecursion=!1,this.canReuseHandle=d.canReuseHandle??!0,this.logger=(0,i.createChildLogger)({logger:u,properties:{all:(0,i.tagCodeArtifacts)({id:this.telemetryNodeId})}})}startSummary(u,c,d){(0,e.assert)(this.wipSummaryLogger===void 0,415),(0,e.assert)(this.wipReferenceSequenceNumber===void 0,416);let l=1,f=0;const b=new Set,C=this._lastSummaryReferenceSequenceNumber;C!==void 0&&d!==C&&(f++,b.add(`${d}-${C}`)),this.wipSummaryLogger=c;for(const v of this.children.values()){const m=v.startSummary(u,this.wipSummaryLogger,d);l+=m.nodes,f+=m.invalidNodes;for(const h of m.mismatchNumbers)b.add(h)}return this.wipReferenceSequenceNumber=u,{nodes:l,invalidNodes:f,mismatchNumbers:b}}async summarize(u,c=!0,d){if(!c)return this.summarizeInternalFn(u,c,d);if(this.wipSummarizeCalled=!0,this.canReuseHandle&&!u&&!this.hasChanged()&&this._lastSummaryReferenceSequenceNumber!==void 0){this.wipSkipRecursion=!0;const b=(0,t.mergeStats)();return b.handleNodeCount++,{summary:{type:n.SummaryType.Handle,handle:this.summaryHandleId,handleType:n.SummaryType.Tree},stats:b}}let l;u||((0,e.assert)(this.wipReferenceSequenceNumber!==void 0,1503),l=this._lastSummaryReferenceSequenceNumber===void 0?void 0:{summarySequenceNumber:this.wipReferenceSequenceNumber,latestSummarySequenceNumber:this._lastSummaryReferenceSequenceNumber,summaryPath:this.summaryHandleId});const f=await this.summarizeInternalFn(u,c,d,l);return{summary:f.summary,stats:f.stats}}validateSummary(){return this.validateSummaryCore(!1)}validateSummaryCore(u){if(this.wasSummarizeMissed(u))return{success:!1,reason:"NodeDidNotSummarize",id:{tag:i.TelemetryDataTag.CodeArtifact,value:this.telemetryNodeId},retryAfterSeconds:1};if(u)return{success:!0};for(const c of this.children.values()){const d=c.validateSummaryCore(this.wipSkipRecursion||u);if(!d.success)return d}return{success:!0}}wasSummarizeMissed(u){return(0,e.assert)(this.wipSummaryLogger!==void 0,1788),(0,e.assert)(this.wipReferenceSequenceNumber!==void 0,1789),!(u||this.wipSummarizeCalled)}completeSummary(u){this.completeSummaryCore(u,!1)}completeSummaryCore(u,c){if((0,e.assert)(this.wipReferenceSequenceNumber!==void 0,420),c&&this._lastSummaryReferenceSequenceNumber===void 0){this.clearSummary();return}for(const d of this.children.values())d.completeSummaryCore(u,this.wipSkipRecursion||c);this.pendingSummaries.set(u,{referenceSequenceNumber:this.wipReferenceSequenceNumber}),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipSummarizeCalled=!1,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const u of this.children.values())u.clearSummary()}async refreshLatestSummary(u,c){const d={proposalHandle:u,summaryRefSeq:c,referenceSequenceNumber:this.referenceSequenceNumber};return i.PerformanceEvent.timedExecAsync(this.logger,{eventName:"refreshLatestSummary",...d},async l=>{if(this.isSummaryInProgress())throw new i.LoggingError("UnexpectedRefreshDuringSummarize",{inProgressSummaryRefSeq:this.wipReferenceSequenceNumber});let f=!1,b=!1;c>this.referenceSequenceNumber&&(b=!0);const C=this.pendingSummaries.get(u);return C?.referenceSequenceNumber!==void 0&&(f=!0,this.refreshLatestSummaryFromPending(u,C.referenceSequenceNumber)),l.end({...d,isSummaryNewer:b,pendingSummaryFound:f}),{isSummaryTracked:f,isSummaryNewer:b}},{start:!0,end:!0,cancel:"error"})}refreshLatestSummaryFromPending(u,c){const d=this.pendingSummaries.get(u);if(d===void 0){(0,e.assert)(this._lastSummaryReferenceSequenceNumber===void 0,422);return}else(0,e.assert)(c===d.referenceSequenceNumber,423),this.pendingSummaries.delete(u);for(const[l,f]of this.pendingSummaries)f.referenceSequenceNumber<c&&this.pendingSummaries.delete(l);this._lastSummaryReferenceSequenceNumber=d.referenceSequenceNumber;for(const l of this.children.values())l.refreshLatestSummaryFromPending(u,c)}updateBaseSummaryState(u){}recordChange(u){this.invalidate(u.sequenceNumber)}invalidate(u){u>this._changeSequenceNumber&&(this._changeSequenceNumber=u)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}createChild(u,c,d,l={}){(0,e.assert)(!this.children.has(c),427);const f=this.getCreateDetailsForChild(c,d),b=new r(this.logger,u,l,f.summaryHandleId,f.changeSequenceNumber,f.lastSummaryReferenceSequenceNumber,this.wipSummaryLogger,f.telemetryNodeId);return this.maybeUpdateChildState(b,c),this.children.set(c,b),b}getChild(u){return this.children.get(u)}getCreateDetailsForChild(u,c){let d,l;const f=this._lastSummaryReferenceSequenceNumber;switch(c.type){case a.CreateSummarizerNodeSource.FromAttach:{f!==void 0&&c.sequenceNumber<=f&&(d=f),l=c.sequenceNumber;break}case a.CreateSummarizerNodeSource.FromSummary:case a.CreateSummarizerNodeSource.Local:{d=f,l=f??-1;break}default:{const v=c.type;(0,e.unreachableCase)(c,`Unexpected CreateSummarizerNodeSource: ${v}`)}}const b=`${this.telemetryNodeId??""}/${u}`,C=`${this._summaryHandleId}/${a.channelsTreeName}/${u}`;return{changeSequenceNumber:l,telemetryNodeId:b,summaryHandleId:C,lastSummaryReferenceSequenceNumber:d}}maybeUpdateChildState(u,c){if(this.isSummaryInProgress()&&(u.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),u._lastSummaryReferenceSequenceNumber!==void 0)for(const[d,l]of this.pendingSummaries.entries())u.addPendingSummary(d,l)}addPendingSummary(u,c){this.pendingSummaries.set(u,c)}isSummaryInProgress(){return this.wipReferenceSequenceNumber!==void 0}throwUnexpectedError(u){const c=new i.LoggingError(u.eventName,{...u,referenceSequenceNumber:this.wipReferenceSequenceNumber,...(0,i.tagCodeArtifacts)({id:this.telemetryNodeId})});throw this.logger.sendErrorEvent(u,c),c}}Af.SummarizerNode=r;const s=(o,u,c,d,l={})=>new r(o,u,l,"",c,d,void 0,"");return Af.createRootSummarizerNode=s,Af}var Df={},Rj={},U0={},z0={},s5;function Yge(){if(s5)return z0;s5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(z0,"__esModule",{value:!0}),z0.ClientSessionExpiredError=void 0;const e=Mr(),n=Ot();class a extends n.LoggingError{constructor(i,r){super(i,{timeoutMs:r}),this.expiryMs=r,this.errorType=e.ContainerErrorTypes.clientSessionExpiredError}}return z0.ClientSessionExpiredError=a,z0}var kf={},Fj={},a5;function ab(){return a5||(a5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.UnreferencedState=e.GarbageCollectionMessageType=e.GCNodeType=e.defaultSweepGracePeriodMs=e.defaultSessionExpiryDurationMs=e.defaultInactiveTimeoutMs=e.maxSnapshotCacheExpiryMs=e.oneDayMs=e.gcVersionUpgradeToV4Key=e.disableThrowOnTombstoneLoadKey=e.runSessionExpiryKey=e.gcTestModeKey=e.gcGenerationOptionName=e.nextGCVersion=e.stableGCVersion=void 0,e.stableGCVersion=3,e.nextGCVersion=4,e.gcGenerationOptionName="gcGeneration",e.gcTestModeKey="Fluid.GarbageCollection.GCTestMode",e.runSessionExpiryKey="Fluid.GarbageCollection.RunSessionExpiry",e.disableThrowOnTombstoneLoadKey="Fluid.GarbageCollection.DisableThrowOnTombstoneLoad",e.gcVersionUpgradeToV4Key="Fluid.GarbageCollection.GCVersionUpgradeToV4",e.oneDayMs=1440*60*1e3,e.maxSnapshotCacheExpiryMs=5*e.oneDayMs,e.defaultInactiveTimeoutMs=7*e.oneDayMs,e.defaultSessionExpiryDurationMs=30*e.oneDayMs,e.defaultSweepGracePeriodMs=1*e.oneDayMs,e.GCNodeType={DataStore:"DataStore",SubDataStore:"SubDataStore",Blob:"Blob",Other:"Other"},e.GarbageCollectionMessageType={Sweep:"Sweep",TombstoneLoaded:"TombstoneLoaded"},e.UnreferencedState={Active:"Active",Inactive:"Inactive",TombstoneReady:"TombstoneReady",SweepReady:"SweepReady"}})(Fj)),Fj}var Cr={},o5;function SE(){if(o5)return Cr;o5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.compatBehaviorAllowsGCMessageType=Cr.dataStoreNodePathOnly=Cr.urlToGCNodePath=Cr.unpackChildNodesGCDetails=Cr.getGCDataFromSnapshot=Cr.concatGarbageCollectionData=Cr.cloneGCData=Cr.concatGarbageCollectionStates=Cr.generateSortedGCState=Cr.shouldAllowGcSweep=Cr.getGCVersionInEffect=Cr.getGCVersion=void 0;const e=Je(),n=ja(),a=ab();function t(m){return m?m.gcFeature??0:0}Cr.getGCVersion=t;function i(m){return m.getBoolean(a.gcVersionUpgradeToV4Key)===!0?a.nextGCVersion:a.stableGCVersion}Cr.getGCVersionInEffect=i;function r(m,h){if(h===void 0)return!0;const g=m.tombstoneGeneration??m.gcGeneration;return h===g}Cr.shouldAllowGcSweep=r;function s(m){const h=Object.entries(m.gcNodes);h.sort(([_],[S])=>_.localeCompare(S));const g={gcNodes:{}};for(const[_,S]of h)S.outboundRoutes.sort(),g.gcNodes[_]=S;return g}Cr.generateSortedGCState=s;function o(m,h){const g={};for(const[_,S]of Object.entries(m.gcNodes))g[_]={outboundRoutes:[...S.outboundRoutes],unreferencedTimestampMs:S.unreferencedTimestampMs};for(const[_,S]of Object.entries(h.gcNodes)){let p=g[_];p===void 0?p={outboundRoutes:[...S.outboundRoutes],unreferencedTimestampMs:S.unreferencedTimestampMs}:(S.unreferencedTimestampMs!==void 0&&p.unreferencedTimestampMs!==void 0&&(0,e.assert)(S.unreferencedTimestampMs===p.unreferencedTimestampMs,1495),p={outboundRoutes:[...new Set([...S.outboundRoutes,...p.outboundRoutes])],unreferencedTimestampMs:S.unreferencedTimestampMs??p.unreferencedTimestampMs}),g[_]=p}return{gcNodes:g}}Cr.concatGarbageCollectionStates=o;function u(m){const h={};for(const[g,_]of Object.entries(m.gcNodes))h[g]=[..._];return{gcNodes:h}}Cr.cloneGCData=u;function c(m,h){const g=u(m);for(const[_,S]of Object.entries(h.gcNodes))if(g.gcNodes[_]===void 0)g.gcNodes[_]=[...S];else{const p=[...S,...g.gcNodes[_]];g.gcNodes[_]=[...new Set(p)]}return g}Cr.concatGarbageCollectionData=c;async function d(m,h){let g={gcNodes:{}},_,S;for(const p of Object.keys(m.blobs)){if(p===n.gcDeletedBlobKey){S=await h(m.blobs[p]);continue}if(p===n.gcTombstoneBlobKey){_=await h(m.blobs[p]);continue}if(!p.startsWith(n.gcBlobPrefix))continue;const w=m.blobs[p];if(w===void 0)continue;const O=await h(w);(0,e.assert)(O!==void 0,1496),g=o(g,O)}return{gcState:g,tombstones:_,deletedNodes:S}}Cr.getGCDataFromSnapshot=d;function l(m){const h=new Map;if(m.gcData===void 0)return h;const g=m.gcData.gcNodes;for(const[S,p]of Object.entries(g)){if(S==="/")continue;const w=S.split("/")[1];(0,e.assert)(w!==void 0,2558);let O=S.slice(w.length+1);O===""&&(O="/");let E=h.get(w);E===void 0&&(E={gcData:{gcNodes:{}},usedRoutes:[]}),(0,e.assert)(E.gcData!==void 0,1498),E.gcData.gcNodes[O]=[...new Set(p)],h.set(w,E)}if(m.usedRoutes===void 0)return h;const _=m.usedRoutes.filter(S=>S!==""&&S!=="/");for(const S of _){const p=S.split("/")[1];(0,e.assert)(p!==void 0,2559);const w=S.slice(p.length+1),O=h.get(p);(0,e.assert)(O?.usedRoutes!==void 0,1500),O.usedRoutes.push(w),h.set(p,O)}return h}Cr.unpackChildNodesGCDetails=l;function f(m){return m.replace(/^\/+|\/+$/g,"")}function b(m){return`/${f(m.split("?")[0])}`}Cr.urlToGCNodePath=b;function C(m){return`/${m.split("/")[1]}`}Cr.dataStoreNodePathOnly=C;function v(m,h){return h==="Ignore"}return Cr.compatBehaviorAllowsGCMessageType=v,Cr}var c5;function tse(){if(c5)return kf;c5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(kf,"__esModule",{value:!0}),kf.computeTombstoneTimeout=kf.generateGCConfigs=void 0;const e=Ot(),n=ab(),a=SE();function t(r,s){let o=!0,u,c,d,l;if(s.existing){const _=s.metadata;l=(0,a.getGCVersion)(_),o=l!==0,u=_?.sessionExpiryTimeoutMs;const S=_?.sweepTimeoutMs;c=_?.tombstoneTimeoutMs??S??i(u),d=_?.gcFeatureMatrix}else{const _=r.config.getNumber("Fluid.GarbageCollection.TestOverride.TombstoneTimeoutMs");r.config.getBoolean(n.runSessionExpiryKey)!==!1&&(u=s.gcOptions.sessionExpiryTimeoutMs??n.defaultSessionExpiryDurationMs),c=_??i(u);const S=s.gcOptions[n.gcGenerationOptionName];S!==void 0&&(d={gcGeneration:S})}const f=(0,a.shouldAllowGcSweep)(d??{},s.gcOptions[n.gcGenerationOptionName]),b=!o||c===void 0?!1:f&&s.gcOptions.enableGCSweep===!0,C=r.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs")??s.gcOptions.inactiveTimeoutMs??n.defaultInactiveTimeoutMs;if(c!==void 0&&C>c)throw new e.UsageError("inactive timeout should not be greater than the tombstone timeout");const v=r.config.getBoolean(n.gcTestModeKey)??s.gcOptions.runGCInTestMode===!0,m=s.gcOptions.runFullGC,h=s.gcOptions.sweepGracePeriodMs??n.defaultSweepGracePeriodMs;(0,e.validatePrecondition)(h>=0,"sweepGracePeriodMs must be non-negative",{sweepGracePeriodMs:h});const g=r.config.getBoolean(n.disableThrowOnTombstoneLoadKey)!==!0&&b&&!s.isSummarizerClient;return{gcAllowed:o,sweepAllowed:f,sweepEnabled:b,runFullGC:m,testMode:v,sessionExpiryTimeoutMs:u,tombstoneTimeoutMs:c,sweepGracePeriodMs:h,inactiveTimeoutMs:C,persistedGcFeatureMatrix:d,gcVersionInBaseSnapshot:l,gcVersionInEffect:(0,a.getGCVersionInEffect)(r.config),throwOnTombstoneLoad:g}}kf.generateGCConfigs=t;function i(r){const s=n.oneDayMs;return r&&r+n.maxSnapshotCacheExpiryMs+s}return kf.computeTombstoneTimeout=i,kf}var V0={},u5;function nse(){if(u5)return V0;u5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(V0,"__esModule",{value:!0}),V0.runGarbageCollection=void 0;function e(n,a){const t=new Set,i=[...a];for(const o of i){if(t.has(o))continue;t.add(o);const u=n[o];u!==void 0&&i.push(...u)}const r=[],s=[];for(const o of Object.keys(n))t.has(o)?r.push(o):s.push(o);return{referencedNodeIds:r,deletedNodeIds:s}}return V0.runGarbageCollection=e,V0}var jj={},d5;function rse(){return d5||(d5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.GCSummaryStateTracker=e.gcStateBlobKey=void 0;const n=on(),a=ja(),t=bn(),i=SE();e.gcStateBlobKey=`${a.gcBlobPrefix}_root`;class r{constructor(o){this.configs=o,this.updatedDSCountSinceLastSummary=0}initializeBaseState(o){o!==void 0&&(this.latestSummaryData={serializedGCState:o.gcState?JSON.stringify((0,i.generateSortedGCState)(o.gcState)):void 0,serializedTombstones:JSON.stringify(o.tombstones),serializedDeletedNodes:JSON.stringify(o.deletedNodes)})}summarize(o,u,c,d){if(!this.configs.gcAllowed)return;const l=JSON.stringify((0,i.generateSortedGCState)(u)),f=c.size>0?JSON.stringify([...c].sort()):void 0,b=d.length>0?JSON.stringify(d.sort()):void 0;if(this.pendingSummaryData={serializedGCState:l,serializedTombstones:b,serializedDeletedNodes:f},o&&this.latestSummaryData!==void 0){if(this.latestSummaryData.serializedGCState===l&&this.latestSummaryData.serializedTombstones===b&&this.latestSummaryData.serializedDeletedNodes===f){const C=(0,t.mergeStats)();return C.handleNodeCount++,{summary:{type:n.SummaryType.Handle,handle:`/${a.gcTreeKey}`,handleType:n.SummaryType.Tree},stats:C}}return this.buildGCSummaryTree(l,b,f,!0)}return this.buildGCSummaryTree(l,b,f,!1)}buildGCSummaryTree(o,u,c,d){const l=new t.SummaryTreeBuilder;return this.latestSummaryData?.serializedGCState===o&&d?l.addHandle(e.gcStateBlobKey,n.SummaryType.Blob,`/${a.gcTreeKey}/${e.gcStateBlobKey}`):l.addBlob(e.gcStateBlobKey,o),u!==void 0&&(this.latestSummaryData?.serializedTombstones===u&&d?l.addHandle(a.gcTombstoneBlobKey,n.SummaryType.Blob,`/${a.gcTreeKey}/${a.gcTombstoneBlobKey}`):l.addBlob(a.gcTombstoneBlobKey,u)),c===void 0||(this.latestSummaryData?.serializedDeletedNodes===c&&d?l.addHandle(a.gcDeletedBlobKey,n.SummaryType.Blob,`/${a.gcTreeKey}/${a.gcDeletedBlobKey}`):l.addBlob(a.gcDeletedBlobKey,c)),l.getSummaryTree()}async refreshLatestSummary(o){!this.configs.gcAllowed||!o.isSummaryTracked||(this.latestSummaryData=this.pendingSummaryData,this.pendingSummaryData=void 0,this.updatedDSCountSinceLastSummary=0)}updateStateFromGCRunStats(o){this.updatedDSCountSinceLastSummary+=o.updatedDataStoreCount}}e.GCSummaryStateTracker=r})(jj)),jj}var H0={},l5;function ise(){if(l5)return H0;l5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(H0,"__esModule",{value:!0}),H0.GCTelemetryTracker=void 0;const e=Ot(),n=ab();class a{constructor(i,r,s,o,u,c,d){this.mc=i,this.configs=r,this.isSummarizerClient=s,this.createContainerMetadata=o,this.getNodeType=u,this.getNodeStateTracker=c,this.getNodePackagePath=d,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[]}shouldLogNonActiveEvent(i,r,s,o){return!(s.state===n.UnreferencedState.Active||i===n.GCNodeType.Other||i===n.GCNodeType.SubDataStore&&r==="Changed"||this.loggedUnreferencedEvents.has(o))}nodeUsed(i,{usageType:r,currentReferenceTimestampMs:s,packagePath:o,id:u,fromId:c,isTombstoned:d,...l}){const f=this.getNodeStateTracker(i),b=this.getNodeType(u),C=(()=>{switch(f?.state){case n.UnreferencedState.Inactive:return this.configs.inactiveTimeoutMs;case n.UnreferencedState.TombstoneReady:return this.configs.tombstoneTimeoutMs;case n.UnreferencedState.SweepReady:return this.configs.tombstoneTimeoutMs&&this.configs.tombstoneTimeoutMs+this.configs.sweepGracePeriodMs;default:return}})(),{persistedGcFeatureMatrix:v,...m}=this.configs,h={trackedId:i,type:b,unrefTime:f?.unreferencedTimestampMs??-1,age:f===void 0?-1:s-f.unreferencedTimestampMs,timeout:C,isTombstoned:d,...(0,e.tagCodeArtifacts)({id:u,fromId:c}),...l,...this.createContainerMetadata,gcConfigs:{...m,...v}};if(d&&this.logTombstoneUsageTelemetry(h,b,r,o),f===void 0)return;const g=f.state,_=`${g}-${u}-${r}`;if(this.shouldLogNonActiveEvent(b,r,f,_)){if(this.loggedUnreferencedEvents.add(_),this.isSummarizerClient)this.pendingEventsQueue.push({...h,usageType:r,state:g});else if(r==="Loaded"){const{id:S,fromId:p,headers:w,gcConfigs:O,additionalProps:E,...F}=h,R={eventName:`${g}Object_${r}`,...(0,e.tagCodeArtifacts)({pkg:o?.join("/")}),stack:(0,e.generateStack)(30),id:S,fromId:p,headers:{...w},details:{...F,...E},gcConfigs:O};this.mc.logger.sendTelemetryEvent(R)}}}logTombstoneUsageTelemetry(i,r,s,o){const{id:u,fromId:c,headers:d,gcConfigs:l,additionalProps:f,...b}=i,v={eventName:`GC_Tombstone_${r}_${s==="Loaded"?"Requested":s}`,...(0,e.tagCodeArtifacts)({pkg:o?.join("/")}),stack:(0,e.generateStack)(30),id:u,fromId:c,headers:{...d},details:{...b,...f},gcConfigs:l};s==="Loaded"&&this.configs.throwOnTombstoneLoad&&!d?.allowTombstone?this.mc.logger.sendErrorEvent(v):this.mc.logger.sendTelemetryEvent(v)}logIfMissingExplicitReferences(i,r,s,o){for(const[u,c]of Object.entries(i.gcNodes)){const d=r.gcNodes[u]??[],l=s.get(u)??[],f=[];for(const b of c){const C=this.getNodeType(b);(C===n.GCNodeType.DataStore||C===n.GCNodeType.Blob)&&!u.startsWith(b)&&!d.includes(b)&&!l.includes(b)&&f.push(b)}f.length>0&&o.sendTelemetryEvent({eventName:"gcUnknownOutboundReferences",...(0,e.tagCodeArtifacts)({id:u,routes:JSON.stringify(f)})})}}async logPendingEvents(i){for(const r of this.pendingEventsQueue){const{usageType:s,state:o,id:u,fromId:c,headers:d,gcConfigs:l,additionalProps:f,...b}=r,C=this.getNodeStateTracker(b.trackedId),v=C===void 0||C.state===n.UnreferencedState.Active;if(s==="Revived"===v){const m=await this.getNodePackagePath(u.value),h=c?await this.getNodePackagePath(c.value):void 0,g={eventName:`${o}Object_${s}`,id:u,fromId:c,headers:{...d},details:{...b,...f},gcConfigs:l,...(0,e.tagCodeArtifacts)({pkg:m?.join("/"),fromPkg:h?.join("/")})};i.sendTelemetryEvent(g)}}this.pendingEventsQueue=[]}}return H0.GCTelemetryTracker=a,H0}var xf={},f5;function sse(){if(f5)return xf;f5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(xf,"__esModule",{value:!0}),xf.UnreferencedStateTracker=xf.UnreferencedStateTrackerMap=void 0;const e=Je(),n=Ot(),a=ab();class t extends e.Timer{constructor(o){super(0,()=>{throw new Error("DefaultHandler should not be used")}),this.callback=o}start(o){super.start(o,this.callback)}restart(o){super.restart(o,this.callback)}}class i extends Map{delete(o){return this.get(o)?.stopTracking(),super.delete(o)}}xf.UnreferencedStateTrackerMap=i;class r{get state(){return this._state}constructor(o,u,c,d,l){this.unreferencedTimestampMs=o,this.inactiveTimeoutMs=u,this.tombstoneTimeoutMs=d,this.sweepGracePeriodMs=l,this._state=a.UnreferencedState.Active,(0,n.validatePrecondition)(this.tombstoneTimeoutMs===void 0||this.tombstoneTimeoutMs>=this.inactiveTimeoutMs,"inactiveTimeoutMs must not be greater than the tombstoneTimeoutMs"),this.sweepTimer=new t(()=>{this._state=a.UnreferencedState.SweepReady,(0,e.assert)(!this.inactiveTimer.hasTimer&&!this.tombstoneTimer.hasTimer,2147)}),this.tombstoneTimer=new t(()=>{this._state=a.UnreferencedState.TombstoneReady,(0,e.assert)(!this.inactiveTimer.hasTimer,2148),this.sweepGracePeriodMs>0?this.sweepTimer.restart(this.sweepGracePeriodMs):this._state=a.UnreferencedState.SweepReady}),this.inactiveTimer=new t(()=>{this._state=a.UnreferencedState.Inactive,this.tombstoneTimeoutMs!==void 0&&this.tombstoneTimer.restart(this.tombstoneTimeoutMs-this.inactiveTimeoutMs)}),this.updateTracking(c)}updateTracking(o){const u=o-this.unreferencedTimestampMs;if(this.clearTimers(),this.tombstoneTimeoutMs!==void 0&&u>=this.tombstoneTimeoutMs+this.sweepGracePeriodMs){this._state=a.UnreferencedState.SweepReady;return}if(this.tombstoneTimeoutMs!==void 0&&u>=this.tombstoneTimeoutMs){this._state=a.UnreferencedState.TombstoneReady,this.sweepTimer.restart(this.tombstoneTimeoutMs+this.sweepGracePeriodMs-u);return}if(u>=this.inactiveTimeoutMs){this._state=a.UnreferencedState.Inactive,this.tombstoneTimeoutMs!==void 0&&this.tombstoneTimer.restart(this.tombstoneTimeoutMs-u);return}this.inactiveTimer.restart(this.inactiveTimeoutMs-u)}clearTimers(){this.inactiveTimer.clear(),this.tombstoneTimer.clear(),this.sweepTimer.clear()}stopTracking(){this.clearTimers(),this._state=a.UnreferencedState.Active}}return xf.UnreferencedStateTracker=r,xf}var h5;function Xge(){if(h5)return U0;h5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(U0,"__esModule",{value:!0}),U0.GarbageCollector=void 0;const e=Je(),n=ja(),a=bn(),t=Ot(),i=Sx(),r=lT(),s=Yge(),o=$g(),u=tse(),c=ab(),d=SE(),l=nse(),f=rse(),b=ise(),C=sse();class v{static create(h){return new v(h)}get shouldRunGC(){return this.configs.gcAllowed}get updatedDSCountSinceLastSummary(){return this.summaryStateTracker.updatedDSCountSinceLastSummary}constructor(h){this.newReferencesSinceLastRun=new Map,this.tombstones=[],this.deletedNodes=new Set,this.unreferencedNodesState=new C.UnreferencedStateTrackerMap,this.completedRuns=0,this.autoRecovery=(()=>{let p;return{requestFullGCOnNextRun:()=>{p="requested"},onCompletedGCRun:()=>{p==="requested"&&(p="ran")},onSummaryAck:()=>{p==="ran"&&(p=void 0)},useFullGC:()=>p!==void 0}})(),this.runtime=h.runtime,this.isSummarizerClient=h.isSummarizerClient,this.getNodePackagePath=h.getNodePackagePath,this.getLastSummaryTimestampMs=h.getLastSummaryTimestampMs,this.submitMessage=h.submitMessage;const g=h.baseSnapshot,_=h.readAndParseBlob,S=h.sessionExpiryTimerStarted;if(this.mc=(0,t.createChildMonitoringContext)({logger:h.baseLogger,namespace:"GarbageCollector",properties:{all:{completedGCRuns:()=>this.completedRuns}}}),this.configs=(0,u.generateGCConfigs)(this.mc,h),this.configs.sessionExpiryTimeoutMs!==void 0){const p=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs");let w=this.configs.sessionExpiryTimeoutMs;if(S){const O=Date.now()-S;w-=O}w=p??w,w<=0&&this.runtime.closeFn(new s.ClientSessionExpiredError("Client session expired.",w)),this.sessionExpiryTimer=new e.Timer(w,()=>{this.runtime.closeFn(new s.ClientSessionExpiredError("Client session expired.",w))}),this.sessionExpiryTimer.start(),this.sessionExpiryTimerStarted=Date.now()}this.summaryStateTracker=new f.GCSummaryStateTracker(this.configs),this.telemetryTracker=new b.GCTelemetryTracker(this.mc,this.configs,this.isSummarizerClient,h.createContainerMetadata,p=>this.runtime.getNodeType(p),p=>this.unreferencedNodesState.get(p),this.getNodePackagePath),this.baseSnapshotDataP=new e.LazyPromise(async()=>{if(g!==void 0)try{const p=g.trees[n.gcTreeKey];if(p===void 0)return;const w=await(0,d.getGCDataFromSnapshot)(p,_);return this.configs.gcVersionInEffect!==this.configs.gcVersionInBaseSnapshot?{gcState:void 0,tombstones:void 0,deletedNodes:w.deletedNodes}:w}catch(p){const w=t.DataProcessingError.wrapIfUnrecognized(p,"FailedToInitializeGC");throw w.addTelemetryProperties({gcConfigs:JSON.stringify(this.configs)}),w}}),this.initializeGCStateFromBaseSnapshotP=new e.LazyPromise(async()=>{const p=this.runtime.getCurrentReferenceTimestampMs();(0,e.assert)(p!==void 0,2212);const w=await this.baseSnapshotDataP;if(this.summaryStateTracker.initializeBaseState(w),w?.gcState===void 0)return;const O={};for(const[E,F]of Object.entries(w.gcState.gcNodes))F.unreferencedTimestampMs!==void 0&&this.unreferencedNodesState.set(E,new C.UnreferencedStateTracker(F.unreferencedTimestampMs,this.configs.inactiveTimeoutMs,p,this.configs.tombstoneTimeoutMs,this.configs.sweepGracePeriodMs)),O[E]=[...F.outboundRoutes];this.gcDataFromLastRun={gcNodes:O}}),this.baseGCDetailsP=new e.LazyPromise(async()=>{const p=await this.baseSnapshotDataP;if(p?.gcState===void 0)return{};const w={};for(const[E,F]of Object.entries(p.gcState.gcNodes))w[E]=[...F.outboundRoutes];const O=(0,l.runGarbageCollection)(w,["/"]).referencedNodeIds;return{gcData:{gcNodes:w},usedRoutes:O}}),this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:JSON.stringify(this.configs),gcOptions:JSON.stringify(h.gcOptions),...h.createContainerMetadata})}async initializeBaseState(){const h=await this.baseSnapshotDataP;h!==void 0&&(h.deletedNodes!==void 0&&(this.deletedNodes=new Set(h.deletedNodes)),h.tombstones!==void 0&&(this.tombstones=[...h.tombstones],this.runtime.updateTombstonedRoutes(this.tombstones)),await this.initializeOrUpdateGCState())}async initializeOrUpdateGCState(){const h=this.runtime.getCurrentReferenceTimestampMs();if(h===void 0)return;const g=this.gcDataFromLastRun!==void 0;await t.PerformanceEvent.timedExecAsync(this.mc.logger,{eventName:"InitializeOrUpdateGCState"},async _=>{if(g)for(const[,S]of this.unreferencedNodesState)S.updateTracking(h);else await this.initializeGCStateFromBaseSnapshotP;_.end({details:{initialized:g,unrefNodeCount:this.unreferencedNodesState.size}})})}setConnectionState(h,g){h&&this.shouldRunGC&&this.initializeOrUpdateGCState().catch(_=>{this.mc.logger.sendErrorEvent({eventName:"GCInitializationOrUpdateFailed",gcConfigs:JSON.stringify(this.configs),clientId:g},_)})}async getBaseGCDetails(){return this.baseGCDetailsP}async collectGarbage(h,g){const _=h.fullGC??(this.configs.runFullGC===!0||this.autoRecovery.useFullGC());g?.setMultiple("fluid_GC","Options",{fullGC:_,runSweep:h.runSweep});const S=(0,t.createChildLogger)({logger:h.logger??this.mc.logger,properties:{all:{completedGCRuns:this.completedRuns,fullGC:_}}}),p=this.runtime.getCurrentReferenceTimestampMs();if(p===void 0){S.sendErrorEvent({eventName:"CollectGarbageCalledWithoutTimestamp",gcConfigs:JSON.stringify(this.configs)});return}return t.PerformanceEvent.timedExecAsync(S,{eventName:"GarbageCollection"},async w=>{await this.initializeGCStateFromBaseSnapshotP;const O=await this.runGC(_,p,S);return w.end({...O,details:{timestamp:p,sweep:this.configs.sweepEnabled,tombstone:this.configs.throwOnTombstoneLoad}}),await this.telemetryTracker.logPendingEvents(S),this.summaryStateTracker.updateStateFromGCRunStats(O),this.autoRecovery.onCompletedGCRun(),this.newReferencesSinceLastRun.clear(),this.completedRuns++,O},{end:!0,cancel:"error"})}async runGC(h,g,_){const S=await this.runtime.getGCData(h),p=(0,l.runGarbageCollection)(S.gcNodes,["/"]),w=this.findAllNodesReferencedBetweenGCs(S,this.gcDataFromLastRun,_)??p.referencedNodeIds,O=this.getMarkPhaseStats(p),{tombstoneReadyNodeIds:E,sweepReadyNodeIds:F}=this.runMarkPhase(p,w,g);this.runSweepPhase(p,E,F),this.gcDataFromLastRun=(0,d.cloneGCData)(S);const R=this.getSweepPhaseStats(this.deletedNodes,F,O);return{...O,...R}}runMarkPhase(h,g,_){for(const w of g)this.unreferencedNodesState.delete(w);const S=new Set,p=new Set;for(const w of h.deletedNodeIds){const O=this.unreferencedNodesState.get(w);O===void 0?this.unreferencedNodesState.set(w,new C.UnreferencedStateTracker(_,this.configs.inactiveTimeoutMs,_,this.configs.tombstoneTimeoutMs,this.configs.sweepGracePeriodMs)):(O.updateTracking(_),O.state===c.UnreferencedState.TombstoneReady&&S.add(w),O.state===c.UnreferencedState.SweepReady&&p.add(w))}return this.runtime.updateUsedRoutes(h.referencedNodeIds),{tombstoneReadyNodeIds:S,sweepReadyNodeIds:p}}runSweepPhase(h,g,_){if(this.configs.testMode){this.runtime.deleteSweepReadyNodes(h.deletedNodeIds);return}const{nodesToTombstone:S,nodesToDelete:p}=this.configs.sweepEnabled?{nodesToDelete:[..._],nodesToTombstone:[...g]}:{nodesToDelete:[],nodesToTombstone:[...g,..._]};if(this.tombstones=S,this.runtime.updateTombstonedRoutes(this.tombstones),p.length>0){const w=p.filter(F=>{const R=this.runtime.getNodeType(F);return R===c.GCNodeType.DataStore||R===c.GCNodeType.Blob}),O={type:c.GarbageCollectionMessageType.Sweep,deletedNodeIds:w},E={type:o.ContainerMessageType.GC,contents:O};this.submitMessage(E);return}}findAllNodesReferencedBetweenGCs(h,g,_){if(g===void 0||(this.telemetryTracker.logIfMissingExplicitReferences(h,g,this.newReferencesSinceLastRun,_),this.newReferencesSinceLastRun.size===0))return;const S=(0,d.concatGarbageCollectionData)(g,h),p=[];for(const[O,E]of this.newReferencesSinceLastRun)S.gcNodes[O]===void 0?S.gcNodes[O]=E:S.gcNodes[O].push(...E),p.push(...E);return(0,l.runGarbageCollection)(S.gcNodes,["/",...p]).referencedNodeIds}summarize(h,g,_){if(!this.shouldRunGC||this.gcDataFromLastRun===void 0)return;const S={gcNodes:{}};for(const[p,w]of Object.entries(this.gcDataFromLastRun.gcNodes))S.gcNodes[p]={outboundRoutes:w,unreferencedTimestampMs:this.unreferencedNodesState.get(p)?.unreferencedTimestampMs};return this.summaryStateTracker.summarize(g&&!h,S,this.deletedNodes,this.tombstones)}getMetadata(){return{gcFeature:this.configs.gcAllowed?this.configs.gcVersionInEffect:0,gcFeatureMatrix:this.configs.persistedGcFeatureMatrix,sessionExpiryTimeoutMs:this.configs.sessionExpiryTimeoutMs,sweepEnabled:!1,tombstoneTimeoutMs:this.configs.tombstoneTimeoutMs}}async refreshLatestSummary(h){return this.autoRecovery.onSummaryAck(),this.summaryStateTracker.refreshLatestSummary(h)}processMessages(h,g,_){for(const S of h){const p=S.type;switch(p){case c.GarbageCollectionMessageType.Sweep:{this.deleteSweepReadyNodes(S.deletedNodeIds);break}case c.GarbageCollectionMessageType.TombstoneLoaded:{const w=S.nodePath;this.addedOutboundReference("/",w,g,!0),this.autoRecovery.requestFullGCOnNextRun();break}default:throw t.DataProcessingError.create(`Garbage collection message of unknown type ${p}`,"processMessage")}}}deleteSweepReadyNodes(h){const g=new Set(h),_=[...h];for(const[p]of this.unreferencedNodesState){const w=p.split("/");if(w.length<=2)continue;const O=`/${w[1]}`;g.has(O)&&_.push(p)}const S=this.runtime.deleteSweepReadyNodes(_);for(const p of S)this.unreferencedNodesState.delete(p),this.deletedNodes.add(p)}nodeUpdated({node:h,reason:g,timestampMs:_,packagePath:S,request:p,headerData:w,additionalProps:O}){if(!this.shouldRunGC||_===void 0)return;const E=h.path,F=this.tombstones.includes(E),R=p===void 0?E:(0,d.urlToGCNodePath)(p.url);this.telemetryTracker.nodeUsed(E,{id:R,usageType:g,currentReferenceTimestampMs:_,packagePath:S,completedGCRuns:this.completedRuns,isTombstoned:F,lastSummaryTime:this.getLastSummaryTimestampMs(),headers:w,requestUrl:p?.url,requestHeaders:JSON.stringify(p?.headers),additionalProps:O}),F&&g==="Loaded"&&this.triggerAutoRecovery(R);const M=this.runtime.getNodeType(R);if(!(g==="Loaded"&&(M===c.GCNodeType.Blob||M===c.GCNodeType.DataStore)))return;const k=p??{url:R};if(F&&this.configs.throwOnTombstoneLoad&&w?.allowTombstone!==!0)throw(0,a.responseToException)((0,a.createResponseError)(404,`${M} was tombstoned`,k,{[r.TombstoneResponseHeaderKey]:!0}),k)}triggerAutoRecovery(h){if(!this.configs.sweepEnabled)return;const g={type:o.ContainerMessageType.GC,contents:{type:c.GarbageCollectionMessageType.TombstoneLoaded,nodePath:h}};this.submitMessage(g)}addedOutboundReference(h,g,_,S){if(!this.shouldRunGC)return;if(!g.startsWith("/")){this.mc.logger.sendErrorEvent({eventName:"InvalidRelativeOutboundRoute",...(0,t.tagCodeArtifacts)({fromId:h,id:g})});return}(0,e.assert)(h.startsWith("/"),2213);const p=this.newReferencesSinceLastRun.get(h)??[];p.push(g),this.newReferencesSinceLastRun.set(h,p);const w=this.runtime.getNodeType(g)==="SubDataStore"?(0,d.dataStoreNodePathOnly)(g):g;this.telemetryTracker.nodeUsed(w,{id:g,fromId:h,usageType:"Revived",currentReferenceTimestampMs:_,packagePath:void 0,completedGCRuns:this.completedRuns,isTombstoned:this.tombstones.includes(w),lastSummaryTime:this.getLastSummaryTimestampMs(),autorecovery:S}),this.unreferencedNodesState.get(g)?.stopTracking()}isNodeDeleted(h){return this.deletedNodes.has(h)}dispose(){this.sessionExpiryTimer?.clear(),this.sessionExpiryTimer=void 0;for(const h of this.unreferencedNodesState.values())h.stopTracking();this.unreferencedNodesState.clear()}getMarkPhaseStats(h){const g={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},_=(S,p)=>{g.nodeCount++;const w=this.unreferencedNodesState.has(S),O=this.gcDataFromLastRun===void 0||w===p;O&&g.updatedNodeCount++,p||g.unrefNodeCount++,this.runtime.getNodeType(S)===c.GCNodeType.DataStore&&(g.dataStoreCount++,O&&g.updatedDataStoreCount++,p||g.unrefDataStoreCount++),this.runtime.getNodeType(S)===c.GCNodeType.Blob&&(g.attachmentBlobCount++,O&&g.updatedAttachmentBlobCount++,p||g.unrefAttachmentBlobCount++)};for(const S of h.referencedNodeIds)_(S,!0);for(const S of h.deletedNodeIds)_(S,!1);return g}getSweepPhaseStats(h,g,_){const S={lifetimeNodeCount:_.nodeCount,lifetimeDataStoreCount:_.dataStoreCount,lifetimeAttachmentBlobCount:_.attachmentBlobCount,deletedNodeCount:0,deletedDataStoreCount:0,deletedAttachmentBlobCount:0},p=w=>{const O=w.split("/");return O[1]===i.blobManagerBasePath?c.GCNodeType.Blob:O.length===2?c.GCNodeType.DataStore:O.length===3?c.GCNodeType.SubDataStore:c.GCNodeType.Other};for(const w of h){S.deletedNodeCount++;const O=p(w);O===c.GCNodeType.DataStore?S.deletedDataStoreCount++:O===c.GCNodeType.Blob&&S.deletedAttachmentBlobCount++}S.lifetimeNodeCount+=S.deletedNodeCount,S.lifetimeDataStoreCount+=S.deletedDataStoreCount,S.lifetimeAttachmentBlobCount+=S.deletedAttachmentBlobCount;for(const w of g){S.deletedNodeCount++;const O=this.runtime.getNodeType(w);O===c.GCNodeType.DataStore?S.deletedDataStoreCount++:O===c.GCNodeType.Blob&&S.deletedAttachmentBlobCount++}return S}}return U0.GarbageCollector=v,U0}var m5;function CE(){return m5||(m5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.UnreferencedStateTracker=e.GCTelemetryTracker=e.GCSummaryStateTracker=e.gcStateBlobKey=e.runGarbageCollection=e.urlToGCNodePath=e.unpackChildNodesGCDetails=e.getGCVersionInEffect=e.concatGarbageCollectionStates=e.cloneGCData=e.GarbageCollectionMessageType=e.disableThrowOnTombstoneLoadKey=e.UnreferencedState=e.stableGCVersion=e.runSessionExpiryKey=e.oneDayMs=e.gcVersionUpgradeToV4Key=e.gcGenerationOptionName=e.gcTestModeKey=e.GCNodeType=e.defaultSessionExpiryDurationMs=e.defaultSweepGracePeriodMs=e.defaultInactiveTimeoutMs=e.nextGCVersion=e.computeTombstoneTimeout=e.GarbageCollector=void 0;var n=Xge();Object.defineProperty(e,"GarbageCollector",{enumerable:!0,get:function(){return n.GarbageCollector}});var a=tse();Object.defineProperty(e,"computeTombstoneTimeout",{enumerable:!0,get:function(){return a.computeTombstoneTimeout}});var t=ab();Object.defineProperty(e,"nextGCVersion",{enumerable:!0,get:function(){return t.nextGCVersion}}),Object.defineProperty(e,"defaultInactiveTimeoutMs",{enumerable:!0,get:function(){return t.defaultInactiveTimeoutMs}}),Object.defineProperty(e,"defaultSweepGracePeriodMs",{enumerable:!0,get:function(){return t.defaultSweepGracePeriodMs}}),Object.defineProperty(e,"defaultSessionExpiryDurationMs",{enumerable:!0,get:function(){return t.defaultSessionExpiryDurationMs}}),Object.defineProperty(e,"GCNodeType",{enumerable:!0,get:function(){return t.GCNodeType}}),Object.defineProperty(e,"gcTestModeKey",{enumerable:!0,get:function(){return t.gcTestModeKey}}),Object.defineProperty(e,"gcGenerationOptionName",{enumerable:!0,get:function(){return t.gcGenerationOptionName}}),Object.defineProperty(e,"gcVersionUpgradeToV4Key",{enumerable:!0,get:function(){return t.gcVersionUpgradeToV4Key}}),Object.defineProperty(e,"oneDayMs",{enumerable:!0,get:function(){return t.oneDayMs}}),Object.defineProperty(e,"runSessionExpiryKey",{enumerable:!0,get:function(){return t.runSessionExpiryKey}}),Object.defineProperty(e,"stableGCVersion",{enumerable:!0,get:function(){return t.stableGCVersion}}),Object.defineProperty(e,"UnreferencedState",{enumerable:!0,get:function(){return t.UnreferencedState}}),Object.defineProperty(e,"disableThrowOnTombstoneLoadKey",{enumerable:!0,get:function(){return t.disableThrowOnTombstoneLoadKey}}),Object.defineProperty(e,"GarbageCollectionMessageType",{enumerable:!0,get:function(){return t.GarbageCollectionMessageType}});var i=SE();Object.defineProperty(e,"cloneGCData",{enumerable:!0,get:function(){return i.cloneGCData}}),Object.defineProperty(e,"concatGarbageCollectionStates",{enumerable:!0,get:function(){return i.concatGarbageCollectionStates}}),Object.defineProperty(e,"getGCVersionInEffect",{enumerable:!0,get:function(){return i.getGCVersionInEffect}}),Object.defineProperty(e,"unpackChildNodesGCDetails",{enumerable:!0,get:function(){return i.unpackChildNodesGCDetails}}),Object.defineProperty(e,"urlToGCNodePath",{enumerable:!0,get:function(){return i.urlToGCNodePath}});var r=nse();Object.defineProperty(e,"runGarbageCollection",{enumerable:!0,get:function(){return r.runGarbageCollection}});var s=rse();Object.defineProperty(e,"gcStateBlobKey",{enumerable:!0,get:function(){return s.gcStateBlobKey}}),Object.defineProperty(e,"GCSummaryStateTracker",{enumerable:!0,get:function(){return s.GCSummaryStateTracker}});var o=ise();Object.defineProperty(e,"GCTelemetryTracker",{enumerable:!0,get:function(){return o.GCTelemetryTracker}});var u=sse();Object.defineProperty(e,"UnreferencedStateTracker",{enumerable:!0,get:function(){return u.UnreferencedStateTracker}})})(Rj)),Rj}var p5;function Zge(){if(p5)return Df;p5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Df,"__esModule",{value:!0}),Df.createRootSummarizerNodeWithGC=Df.SummarizerNodeWithGC=void 0;const e=Je(),n=bn(),a=Ot(),t=CE(),i=ese();class r extends i.SummarizerNode{constructor(u,c,d,l,f,b,C,v,m,h){super(u,c,d,l,f,b,C,h),this.getGCDataFn=v,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=d.gcDisabled===!0,this.baseGCDetailsP=new e.LazyPromise(async()=>await m?.()??{usedRoutes:[]}),this.childNodesBaseGCDetailsP=new e.LazyPromise(async()=>(await this.loadBaseGCDetails(),(0,t.unpackChildNodesGCDetails)({gcData:this.gcData,usedRoutes:this.usedRoutes})))}async loadBaseGCDetails(){if(this.baseGCDetailsLoaded)return;const u=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,u.gcData!==void 0&&(this.gcData=(0,t.cloneGCData)(u.gcData)),u.usedRoutes!==void 0&&(this.usedRoutes=[...u.usedRoutes].sort(),this.referenceUsedRoutes=[...u.usedRoutes].sort()))}async getGCData(u=!1){if((0,e.assert)(!this.gcDisabled,434),(0,e.assert)(this.getGCDataFn!==void 0,435),await this.loadBaseGCDetails(),this.canReuseHandle&&!u&&!this.hasDataChanged()&&this.gcData!==void 0)return(0,t.cloneGCData)(this.gcData);const c=await this.getGCDataFn(u);return this.gcData=(0,t.cloneGCData)(c),c}startSummary(u,c,d){return this.gcDisabled||(0,e.assert)(this.wipSerializedUsedRoutes===void 0,436),super.startSummary(u,c,d)}validateSummaryCore(u){return this.wasGCMissed()?{success:!1,reason:"NodeDidNotRunGC",id:{tag:a.TelemetryDataTag.CodeArtifact,value:this.telemetryNodeId},retryAfterSeconds:1}:super.validateSummaryCore(u)}wasGCMissed(){return!(this.gcDisabled||this.wipSerializedUsedRoutes!==void 0)}completeSummaryCore(u,c){let d;if(this.gcDisabled||(d=this.wipSerializedUsedRoutes),super.completeSummaryCore(u,c),!this.gcDisabled){const l=this.pendingSummaries.get(u);if(l!==void 0){const f={serializedUsedRoutes:d,...l};this.pendingSummaries.set(u,f)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,this.wipChildNodesUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(u,c){if(!this.gcDisabled){const d=this.pendingSummaries.get(u);if(d!==void 0){const l=d;if(l.serializedUsedRoutes===void 0){const f=new a.LoggingError("MissingGCStateInPendingSummary",{proposalHandle:u,referenceSequenceNumber:c,...(0,a.tagCodeArtifacts)({id:this.telemetryNodeId})});throw this.logger.sendErrorEvent({eventName:f.message},f),f}this.referenceUsedRoutes=JSON.parse(l.serializedUsedRoutes)}}return super.refreshLatestSummaryFromPending(u,c)}createChild(u,c,d,l={},f){(0,e.assert)(!this.children.has(c),438);const b=async()=>(await this.childNodesBaseGCDetailsP).get(c)??{},C=this.getCreateDetailsForChild(c,d),v=new r(this.logger,u,{...l,gcDisabled:l.gcDisabled??this.gcDisabled},C.summaryHandleId,C.changeSequenceNumber,C.lastSummaryReferenceSequenceNumber,this.wipSummaryLogger,f,b,C.telemetryNodeId);return this.maybeUpdateChildState(v,c),this.children.set(c,v),v}maybeUpdateChildState(u,c){super.maybeUpdateChildState(u,c),this.wipSerializedUsedRoutes!==void 0&&(this.wipChildNodesUsedRoutes===void 0&&(this.wipChildNodesUsedRoutes=(0,n.unpackChildNodesUsedRoutes)(this.usedRoutes)),u.updateUsedRoutes(this.wipChildNodesUsedRoutes.get(c)??[""]));for(const[d,l]of this.pendingSummaries.entries()){const f=l;if(f.serializedUsedRoutes!==void 0){const C=(0,n.unpackChildNodesUsedRoutes)(JSON.parse(f.serializedUsedRoutes)).get(c)??[""],v={...f,serializedUsedRoutes:JSON.stringify(C)};u.addPendingSummary(d,v)}}}deleteChild(u){this.children.delete(u)}getChild(u){return this.children.get(u)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(u){this.usedRoutes=u.sort(),!this.gcDisabled&&this.isSummaryInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes))}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return this.gcDisabled?!1:this.referenceUsedRoutes===void 0||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes)}}Df.SummarizerNodeWithGC=r;const s=(o,u,c,d,l={},f,b)=>new r(o,u,l,"",c,d,void 0,f,b,"");return Df.createRootSummarizerNodeWithGC=s,Df}var g5;function eye(){return g5||(g5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.createRootSummarizerNodeWithGC=e.createRootSummarizerNode=void 0;var n=ese();Object.defineProperty(e,"createRootSummarizerNode",{enumerable:!0,get:function(){return n.createRootSummarizerNode}});var a=Zge();Object.defineProperty(e,"createRootSummarizerNodeWithGC",{enumerable:!0,get:function(){return a.createRootSummarizerNodeWithGC}})})(Ij)),Ij}var K0={},y5;function _E(){if(y5)return K0;y5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(K0,"__esModule",{value:!0}),K0.summarizerClientType=void 0,K0.summarizerClientType="summarizer",K0}var qf={},b5;function tye(){if(b5)return qf;b5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qf,"__esModule",{value:!0}),qf.OrderedClientElection=qf.OrderedClientCollection=void 0;const e=Ht(),n=Je(),a=Ot(),t=_E();class i extends e.TypedEventEmitter{get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}constructor(o,u,c){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=(0,a.createChildLogger)({logger:o,namespace:"OrderedClientCollection"});const d=c.getMembers();for(const[l,f]of d)this.addClient(l,f);c.on("addMember",(l,f)=>{const b=this.addClient(l,f);this.emit("addClient",b,u.lastSequenceNumber)}),c.on("removeMember",l=>{const f=u.lastSequenceNumber,b=this.removeClient(l);b===void 0?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:l,sequenceNumber:f}):this.emit("removeClient",b,f)})}addClient(o,u){(0,n.assert)(u.sequenceNumber>-1,502);let c=this._youngestClient;for(;c.sequenceNumber>u.sequenceNumber;)(0,n.assert)(c.olderClient!==void 0,503),c=c.olderClient;const d={clientId:o,sequenceNumber:u.sequenceNumber,client:{...u.client},olderClient:c,youngerClient:c.youngerClient};return d.olderClient.youngerClient=d,d.youngerClient===void 0?this._youngestClient=d:d.youngerClient.olderClient=d,this.clientMap.set(o,d),d}removeClient(o){const u=this.clientMap.get(o);if(u!==void 0)return u.olderClient.youngerClient=u.youngerClient,u.youngerClient===void 0?this._youngestClient=u.olderClient:u.youngerClient.olderClient=u.olderClient,this.clientMap.delete(o),u}getAllClients(){const o=[];let u=this.rootNode;for(;u.youngerClient!==void 0;)o.push(u.youngerClient),u=u.youngerClient;return o}}qf.OrderedClientCollection=i;class r extends e.TypedEventEmitter{get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}constructor(o,u,c,d,l=!1){super(),this.logger=o,this.orderedClientCollection=u,this.isEligibleFn=d,this.recordPerformanceEvents=l,this._eligibleCount=0;let f,b;for(const C of u.getAllClients())this.addClient(C,0),typeof c!="number"&&(C.clientId===c.electedClientId&&(f=C,c.electedParentId===void 0&&C.client.details.type!==t.summarizerClientType&&(b=C)),C.clientId===c.electedParentId&&(b=C));u.on("addClient",(C,v)=>this.addClient(C,v)),u.on("removeClient",(C,v)=>this.removeClient(C,v)),typeof c=="number"?this._electionSequenceNumber=c:(f?.clientId!==c.electedClientId?this.logger.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:c.electionSequenceNumber,expectedClientId:c.electedClientId,electedClientId:f?.clientId,clientCount:u.count}):f!==void 0&&!d(f)&&(f=b=this.findFirstEligibleParent(b),this.logger.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:c.electionSequenceNumber,expectedClientId:c.electedClientId,electedClientId:f?.clientId})),this._electedParent=b,this._electedClient=f,this._electionSequenceNumber=c.electionSequenceNumber)}tryElectingClient(o,u,c){this.sendPerformanceEvent("TryElectingClient",o,u,!1,c);let d=!1;const l=o?.client.details.type===t.summarizerClientType,f=this._electedClient;this._electedClient!==o&&(this.sendPerformanceEvent("ClientElected",o,u,!0,c),this._electionSequenceNumber=u,this._electedClient=o,d=!0),this._electedParent!==o&&!l&&(this.sendPerformanceEvent("InteractiveClientElected",o,u,!0,c),this._electedParent=o,d=!0),d&&this.emit("election",o,u,f)}tryElectingParent(o,u,c){this.sendPerformanceEvent("TryElectingParent",o,u,!1,c),this._electedParent!==o&&(this.sendPerformanceEvent("ParentElected",o,u,!0,c),this._electedParent=o,this.emit("election",this._electedClient,u,this._electedClient))}findFirstEligibleParent(o){let u=o;for(;u!==void 0&&(!this.isEligibleFn(u)||u.client.details.type===t.summarizerClientType);)u=u.youngerClient;return u}addClient(o,u){if(this.sendPerformanceEvent("AddClient",o,u),this.isEligibleFn(o)){this._eligibleCount++;const c=o.client.details.type===t.summarizerClientType,d=this._electedClient?.client.details.type===t.summarizerClientType;this._electedClient===void 0||!d&&c?this.tryElectingClient(o,u,"AddClient"):this._electedParent===void 0&&!c&&this.tryElectingParent(o,u,"AddClient")}}removeClient(o,u){if(this.sendPerformanceEvent("RemoveClient",o,u),this.isEligibleFn(o)){if(this._eligibleCount--,this._electedClient===o)if(this._electedParent===o){const c=this.findFirstEligibleParent(this._electedParent?.youngerClient)??this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(c,u,"RemoveClient")}else{if(this._electedClient.client.details.type!==t.summarizerClientType)throw new a.UsageError("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,u,"RemoveSummarizerClient")}else if(this._electedParent===o){if(this._electedClient?.client.details.type!==t.summarizerClientType)throw new a.UsageError("Elected client should be a summarizer client 2");const c=this.findFirstEligibleParent(this._electedParent?.youngerClient)??this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(c,u,"RemoveClient")}}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(o=>this.isEligibleFn(o))}resetElectedClient(o){const u=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this._electedClient===void 0||this._electedClient===this._electedParent?this.tryElectingClient(u,o,"ResetElectedClient"):this.tryElectingParent(u,o,"ResetElectedClient")}peekNextElectedClient(){return this.findFirstEligibleParent(this._electedParent?.youngerClient)??this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:this.electedClient?.clientId,electedParentId:this.electedParent?.clientId}}sendPerformanceEvent(o,u,c,d=!1,l){(this.recordPerformanceEvents||d)&&this.logger.sendPerformanceEvent({eventName:o,clientId:u?.clientId,sequenceNumber:c,electedClientId:this.electedClient?.clientId,electedParentId:this.electedParent?.clientId,isEligible:u===void 0?!1:this.isEligibleFn(u),isSummarizerClient:u?.client.details.type===t.summarizerClientType,reason:l})}}return qf.OrderedClientElection=r,qf}var $0={},v5;function nye(){if(v5)return $0;v5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty($0,"__esModule",{value:!0}),$0.SummaryCollection=void 0;const e=Ht(),n=Je(),a=on(),t=Ot();var i;(function(u){u[u.Local=0]="Local",u[u.Broadcast=1]="Broadcast",u[u.Acked=2]="Acked",u[u.Nacked=-1]="Nacked"})(i||(i={}));class r{static createLocal(c,d){return new r(c,d)}static createFromOp(c){const d=new r(c.clientId,c.clientSequenceNumber);return d.broadcast(c),d}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}constructor(c,d){this.clientId=c,this.clientSequenceNumber=d,this.state=i.Local,this.defSummaryOp=new n.Deferred,this.defSummaryAck=new n.Deferred}hasBeenAcked(){return this.state===i.Acked}broadcast(c){return(0,n.assert)(this.state===i.Local,373),this._summaryOp=c,this.defSummaryOp.resolve(),this.state=i.Broadcast,!0}ackNack(c){return(0,n.assert)(this.state===i.Broadcast,374),this._summaryAckNack=c,this.defSummaryAck.resolve(),this.state=c.type===a.MessageType.SummaryAck?i.Acked:i.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class s{get disposed(){return this._disposed}constructor(c,d){this.clientId=c,this.summaryCollection=d,this.localSummaries=new Map,this._disposed=!1}watchSummary(c){let d=this.localSummaries.get(c);return d||(d=r.createLocal(this.clientId,c),this.localSummaries.set(d.clientSequenceNumber,d)),d}async waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(c){return this.localSummaries.get(c)}setSummary(c){this.localSummaries.set(c.clientSequenceNumber,c)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class o extends e.TypedEventEmitter{get latestAck(){return this.lastAck}emit(c,...d){return super.emit(c,...d)}get opsSinceLastAck(){return this.deltaManager.lastSequenceNumber-(this.lastAck?.summaryAck.sequenceNumber??this.deltaManager.initialSequenceNumber)}addOpListener(c){this.deltaManager.on("op",c)}removeOpListener(c){this.deltaManager.off("op",c)}constructor(c,d){super(),this.deltaManager=c,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new n.Deferred,this.deltaManager.on("op",l=>this.handleOp(l)),this.logger=(0,t.createChildLogger)({logger:d})}createWatcher(c){const d=new s(c,this);return this.summaryWatchers.set(c,d),d}removeWatcher(c){this.summaryWatchers.delete(c)}setPendingAckTimerTimeoutCallback(c,d){this.maxAckWaitTime=c,this.pendingAckTimerTimeoutCallback=d}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const c=Array.from(this.pendingSummaries,([,d])=>d.waitAckNack());await Promise.all(c)}return this.lastAck}async waitSummaryAck(c){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<c;)await this.refreshWaitNextAck.promise;return this.lastAck}parseContent(c){typeof c.contents=="string"&&(c.contents=JSON.parse(c.contents))}handleOp(c){const d={...c};switch(d.type){case a.MessageType.Summarize:return this.parseContent(d),this.handleSummaryOp(d);case a.MessageType.SummaryAck:case a.MessageType.SummaryNack:return d.data===void 0?this.parseContent(d):d.contents=JSON.parse(d.data),d.type===a.MessageType.SummaryAck?this.handleSummaryAck(d):this.handleSummaryNack(d);default:{const l=d.timestamp;this.lastSummaryTimestamp!==void 0&&this.maxAckWaitTime!==void 0&&l-this.lastSummaryTimestamp>=this.maxAckWaitTime&&this.pendingAckTimerTimeoutCallback?.(),this.emit("default",d);return}}}handleSummaryOp(c){let d;const l=this.summaryWatchers.get(c.clientId);l&&(d=l.tryGetSummary(c.clientSequenceNumber),d&&d.broadcast(c)),d||(d=r.createFromOp(c),l&&l.setSummary(d)),this.pendingSummaries.set(c.sequenceNumber,d),this.lastSummaryTimestamp=c.timestamp,this.emit(a.MessageType.Summarize,c)}handleSummaryAck(c){const d=c.contents.summaryProposal.summarySequenceNumber,l=this.pendingSummaries.get(d);if(!l||l.summaryOp===void 0){d>this.deltaManager.initialSequenceNumber&&this.logger.sendTelemetryEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:c.sequenceNumber,summarySequenceNumber:d,initialSequenceNumber:this.deltaManager.initialSequenceNumber});return}l.ackNack(c),this.pendingSummaries.delete(d),(!this.lastAck||d>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:l.summaryOp,summaryAck:c},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new n.Deferred,this.emit(a.MessageType.SummaryAck,c))}handleSummaryNack(c){const d=c.contents.summaryProposal.summarySequenceNumber,l=this.pendingSummaries.get(d);l&&(l.ackNack(c),this.pendingSummaries.delete(d),this.emit(a.MessageType.SummaryNack,c))}}return $0.SummaryCollection=o,$0}var G0={},S5;function rye(){if(S5)return G0;S5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(G0,"__esModule",{value:!0}),G0.SummarizerClientElection=void 0;const e=Ht(),n=on(),a=_E();class t extends e.TypedEventEmitter{get electedClientId(){return this.clientElection.electedClient?.clientId}get electedParentId(){return this.clientElection.electedParent?.clientId}constructor(r,s,o,u){super(),this.logger=r,this.summaryCollection=s,this.clientElection=o,this.maxOpsSinceLastSummary=u,this.lastReportedSeq=0,this.summaryCollection.on("default",({sequenceNumber:c})=>{const d=this.electedClientId;if(d===void 0){this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(c);return}const l=this.clientElection.electionSequenceNumber;c-(this.lastSummaryAckSeqForClient??l)>this.maxOpsSinceLastSummary&&c-this.lastReportedSeq>this.maxOpsSinceLastSummary&&(this.logger.sendTelemetryEvent({eventName:"ElectedClientNotSummarizing",electedClientId:d,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:l,nextElectedClientId:this.clientElection.peekNextElectedClient()?.clientId}),this.lastReportedSeq=c)}),this.summaryCollection.on(n.MessageType.SummaryAck,c=>{this.lastSummaryAckSeqForClient=c.sequenceNumber}),this.clientElection.on("election",(c,d)=>{this.lastSummaryAckSeqForClient=void 0,c===void 0&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(d),this.emit("electedSummarizerChanged")})}serialize(){const{electedClientId:r,electedParentId:s,electionSequenceNumber:o}=this.clientElection.serialize();return{electedClientId:r,electedParentId:s,electionSequenceNumber:this.lastSummaryAckSeqForClient??o}}static isClientEligible(r){const s=r.client.details;return s===void 0?!0:t.clientDetailsPermitElection(s)}}return G0.SummarizerClientElection=t,t.clientDetailsPermitElection=i=>i.capabilities.interactive||i.type===a.summarizerClientType,G0}var Mj={},C5;function iye(){return C5||(C5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.blobHeadersBlobName=e.getFluidDataStoreAttributes=e.wrapSummaryInChannelsTree=e.dataStoreAttributesBlobName=e.nonDataStorePaths=e.protocolTreeName=e.rootHasIsolatedChannels=e.idCompressorBlobName=e.electedSummarizerBlobName=e.recentBatchInfoBlobName=e.chunksBlobName=e.metadataBlobName=e.aliasBlobName=e.getMetadataFormatVersion=e.extractSummaryMetadataMessage=e.hasIsolatedChannels=e.getAttributesFormatVersion=void 0;const n=Je(),a=on(),t=Kn(),i=ja(),r=Sx();function s(C){return C.summaryFormatVersion?C.summaryFormatVersion:C.snapshotFormatVersion==="0.1"?1:0}e.getAttributesFormatVersion=s;function o(C){return!!C.summaryFormatVersion&&!C.disableIsolatedChannels}e.hasIsolatedChannels=o;const u=C=>C===void 0?void 0:{clientId:C.clientId,clientSequenceNumber:C.clientSequenceNumber,minimumSequenceNumber:C.minimumSequenceNumber,referenceSequenceNumber:C.referenceSequenceNumber,sequenceNumber:C.sequenceNumber,timestamp:C.timestamp,type:C.type};e.extractSummaryMetadataMessage=u;function c(C){return C?.summaryFormatVersion??0}e.getMetadataFormatVersion=c,e.aliasBlobName=".aliases",e.metadataBlobName=".metadata",e.chunksBlobName=".chunks",e.recentBatchInfoBlobName=".recentBatchInfo",e.electedSummarizerBlobName=".electedSummarizer",e.idCompressorBlobName=".idCompressor";function d(C){return!!C&&!C.disableIsolatedChannels}e.rootHasIsolatedChannels=d,e.protocolTreeName=".protocol",e.nonDataStorePaths=[e.protocolTreeName,".logTail",".serviceProtocol",r.blobsTreeName,i.gcTreeKey,e.idCompressorBlobName],e.dataStoreAttributesBlobName=".component";function l(C){C.summary={type:a.SummaryType.Tree,tree:{[i.channelsTreeName]:C.summary}},C.stats.treeNodeCount++}e.wrapSummaryInChannelsTree=l;async function f(C,v){const m=await(0,t.readAndParse)(C,v.blobs[e.dataStoreAttributesBlobName]),h=s(m);return(0,n.assert)(h>0,469),m}e.getFluidDataStoreAttributes=f;var b=Kn();Object.defineProperty(e,"blobHeadersBlobName",{enumerable:!0,get:function(){return b.blobHeadersBlobName}})})(Mj)),Mj}var Nj={},_5;function sye(){return _5||(_5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.validateSummaryHeuristicConfiguration=e.formCreateSummarizerFn=e.DefaultSummaryConfiguration=e.isSummariesDisabled=e.summarizerRequestUrl=void 0;const n=Mr(),a=on(),t=bn(),i=Ot(),r=_E();e.summarizerRequestUrl="_summarizer";function s(c){return c.state==="disabled"}e.isSummariesDisabled=s,e.DefaultSummaryConfiguration={state:"enabled",minIdleTime:0,maxIdleTime:30*1e3,maxTime:60*1e3,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:180*1e3,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5*1e3,nonRuntimeOpWeight:.1,runtimeOpWeight:1,nonRuntimeHeuristicThreshold:20};function o(c){return async()=>{const d={headers:{[n.LoaderHeader.cache]:!1,[n.LoaderHeader.clientDetails]:{capabilities:{interactive:!1},type:r.summarizerClientType},[a.DriverHeader.summarizingClient]:!0,[n.LoaderHeader.reconnect]:!1},url:`/${e.summarizerRequestUrl}`},l=await c.resolve(d);let f;if(l.getEntryPoint===void 0){const b=await l.request({url:`/${e.summarizerRequestUrl}`});if(b.status!==200||b.mimeType!=="fluid/object")throw(0,t.responseToException)(b,d);f=b.value}else f=await l.getEntryPoint();if(f?.ISummarizer===void 0)throw new i.UsageError("Fluid object does not implement ISummarizer");return f.ISummarizer}}e.formCreateSummarizerFn=o;function u(c){for(const d in c)if(typeof c[d]=="number"&&c[d]<0)throw new i.UsageError(`Summary heuristic configuration property "${d}" cannot be less than 0`);if(c.minIdleTime>c.maxIdleTime)throw new i.UsageError(`"minIdleTime" [${c.minIdleTime}] cannot be greater than "maxIdleTime" [${c.maxIdleTime}]`)}e.validateSummaryHeuristicConfiguration=u})(Nj)),Nj}var Aj={},Lf={},T5;function TE(){if(T5)return Lf;T5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Lf,"__esModule",{value:!0}),Lf.pkgVersion=Lf.pkgName=void 0,Lf.pkgName="@fluidframework/container-runtime",Lf.pkgVersion="2.60.0",Lf}var w5;function aye(){return w5||(w5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.DocumentsSchemaController=e.currentDocumentVersionSchema=void 0;const n=Je(),a=Ot(),t=px(),i=TE();e.currentDocumentVersionSchema=1;class r{and(S,p){return S===!0&&p===!0?!0:void 0}or(S,p){return S===!0||p===!0?!0:void 0}validate(S){return S===void 0||S===!0}}class s extends r{and(S,p){return this.or(S,p)}}class o{constructor(S){this.choices=S}and(S,p){if(!(S===void 0||p===void 0))return this.choices[Math.min(this.choices.indexOf(S),this.choices.indexOf(p))]}or(S,p){return S===void 0?p:p===void 0?S:this.choices[Math.max(this.choices.indexOf(S),this.choices.indexOf(p))]}validate(S){return S===void 0||typeof S=="string"&&this.choices.includes(S)}}class u extends o{and(S,p){return S}}class c{or(S=[],p=[]){const w=new Set([...S,...p]);return m([...w.values()])}and(S=[],p=[]){return this.or(S,p)}validate(S){return S===void 0||Array.isArray(S)&&!S.includes(i.pkgVersion)}}const d={explicitSchemaControl:new s,idCompressorMode:new u(["delayed","on"]),opGroupingEnabled:new r,compressionLz4:new r,createBlobPayloadPending:new r,disallowedVersions:new c};function l(_,S){if(_===void 0)return;const p="Document can't be opened with current version of the code";if(_.version!==e.currentDocumentVersionSchema)throw a.DataProcessingError.create(p,"checkRuntimeCompat1",void 0,{runtimeSchemaVersion:_.version,currentRuntimeSchemaVersion:e.currentDocumentVersionSchema,schemaName:S});let w;const O=_.refSeq;if(typeof O!="number"||O<0||!Number.isInteger(O))w="refSeq";else if(_.runtime===null||typeof _.runtime!="object")w="runtime";else for(const[E,F]of Object.entries(_.runtime)){const R=d[E];(R===void 0||!R.validate(F))&&(w=`runtime/${E}`)}if(w!==void 0){const E=_[w];throw a.DataProcessingError.create(p,"checkRuntimeCompat2",void 0,{codeVersion:e.currentDocumentVersionSchema,property:w,value:E,schemaName:S})}}function f(_,S){const p={};for(const O of new Set([...Object.keys(_.runtime),...Object.keys(S.runtime)]))p[O]=d[O].and(_.runtime[O],S.runtime[O]);const w=_.info?.minVersionForCollab??S.info.minVersionForCollab;return{version:e.currentDocumentVersionSchema,refSeq:_.refSeq,info:{minVersionForCollab:w},runtime:p}}function b(_,S){const p={};for(const O of new Set([...Object.keys(_.runtime),...Object.keys(S.runtime)]))p[O]=d[O].or(_.runtime[O],S.runtime[O]);const w=_.info===void 0?S.info.minVersionForCollab:(0,t.gt)(_.info.minVersionForCollab,S.info.minVersionForCollab)?_.info.minVersionForCollab:S.info.minVersionForCollab;return{version:e.currentDocumentVersionSchema,refSeq:_.refSeq,info:{minVersionForCollab:w},runtime:p}}function C(_,S){if(_.info===void 0||(0,t.lt)(_.info.minVersionForCollab,S.info.minVersionForCollab))return!1;for(const p of new Set([...Object.keys(_.runtime),...Object.keys(S.runtime)]))if(p!=="explicitSchemaControl"&&_.runtime[p]!==S.runtime[p])return!1;return!0}function v(_){return _?!0:void 0}function m(_){return _.length===0?void 0:_}class h{constructor(S,p,w,O,E,F,R){this.onSchemaChange=E,this.opPending=!1,(0,n.assert)(O.disallowedVersions.length===0||O.explicitSchemaControl,2377);const M=w?.info?.minVersionForCollab;if(M!==void 0&&(0,t.gt)(M,i.pkgVersion)&&!g(i.pkgVersion)){const j=`WARNING: The version of Fluid Framework used by this client (${i.pkgVersion}) is not supported by this document! Please upgrade to version ${M} or later to ensure compatibility.`;R.sendTelemetryEvent({eventName:"MinVersionForCollabWarning",message:j})}this.desiredSchema={version:e.currentDocumentVersionSchema,refSeq:w?.refSeq??0,info:F,runtime:{explicitSchemaControl:v(O.explicitSchemaControl),compressionLz4:v(O.compressionLz4),idCompressorMode:O.idCompressorMode,opGroupingEnabled:v(O.opGroupingEnabled),createBlobPayloadPending:O.createBlobPayloadPending,disallowedVersions:m(O.disallowedVersions)}},this.documentSchema=S?w??{version:e.currentDocumentVersionSchema,refSeq:0,info:F,runtime:{explicitSchemaControl:v(!S&&O.explicitSchemaControl)}}:this.desiredSchema,l(this.documentSchema,"document"),this.validateSeqNumber(this.documentSchema.refSeq,p,"summary"),this.explicitSchemaControl=this.documentSchema.runtime.explicitSchemaControl===!0||O.explicitSchemaControl,!this.explicitSchemaControl||!S?(this.sessionSchema=this.desiredSchema,(0,n.assert)(v(this.explicitSchemaControl)===this.sessionSchema.runtime.explicitSchemaControl,2378),this.futureSchema=void 0):(this.sessionSchema=f(this.documentSchema,this.desiredSchema),this.futureSchema=b(this.documentSchema,this.desiredSchema),(0,n.assert)(this.sessionSchema.runtime.explicitSchemaControl===!0,2379),(0,n.assert)(this.futureSchema.runtime.explicitSchemaControl===!0,2380),C(this.documentSchema,this.futureSchema)&&(this.futureSchema=void 0)),l(this.desiredSchema,"desired"),l(this.sessionSchema,"session"),l(this.futureSchema,"future")}summarizeDocumentSchema(S){const p=this.explicitSchemaControl?this.documentSchema:this.desiredSchema;return(0,n.assert)(this.explicitSchemaControl||p.refSeq===0,2381),p}maybeGenerateSchemaMessage(){if(this.futureSchema!==void 0&&!this.opPending)return this.opPending=!0,(0,n.assert)(this.explicitSchemaControl&&this.futureSchema.runtime.explicitSchemaControl===!0,2382),this.futureSchema}validateSeqNumber(S,p,w){if(!Number.isInteger(S)||!(S<=p))throw a.DataProcessingError.create("DocSchema: Incorrect sequence number","checkRuntimeCompat3",void 0,{schemaSeqNumber:S,sequenceNumber:p,message:w})}processDocumentSchemaMessages(S,p,w){for(const O of S){if(this.validateSeqNumber(O.refSeq,this.documentSchema.refSeq,"content.refSeq"),this.validateSeqNumber(this.documentSchema.refSeq,w,"refSeq"),(0,n.assert)(this.documentSchema.refSeq<w,2384),O.refSeq!==this.documentSchema.refSeq)return!1;(0,n.assert)(!p||this.explicitSchemaControl&&this.futureSchema!==void 0,2385),l(O,"change");const E={...O,refSeq:w};this.documentSchema=E,this.sessionSchema=f(E,this.desiredSchema),(0,n.assert)(this.sessionSchema.refSeq===w,2429),this.explicitSchemaControl=!0,this.futureSchema=void 0,this.onSchemaChange(this.sessionSchema)}return!0}pendingOpNotAcked(){this.opPending=!1}}e.DocumentsSchemaController=h;function g(_){const S=(0,t.parse)(_);return S!==null&&S.prerelease.includes("test")}})(Aj)),Aj}var co={},O5;function wE(){if(O5)return co;O5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(co,"__esModule",{value:!0}),co.RetriableSummaryError=co.getFailMessage=co.stopReasonCanRunLastSummary=co.raceTimer=void 0;const e=Ot();async function n(s,o,u){const c=[s.then(d=>({result:"done",value:d})),o.then(({timerResult:d})=>({result:d}))];return u!==void 0&&c.push(u.waitCancelled.then(()=>({result:"cancelled"}))),Promise.race(c)}co.raceTimer=n;function a(s){return s==="parentNotConnected"}co.stopReasonCanRunLastSummary=a;const t={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"},i=s=>`${s}: ${t[s]}`;co.getFailMessage=i;class r extends e.LoggingError{constructor(o,u,c){super(o,c),this.retryAfterSeconds=u}}return co.RetriableSummaryError=r,co}var Bf={},P5;function oye(){if(P5)return Bf;P5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.SummaryManager=Bf.SummaryManagerState=void 0;const e=Ht(),n=Je(),a=on(),t=Ot(),i=wE(),r=5e3,s=4e3;var o;(function(c){c[c.Off=0]="Off",c[c.Starting=1]="Starting",c[c.Running=2]="Running",c[c.Stopping=3]="Stopping"})(o||(Bf.SummaryManagerState=o={}));class u extends e.TypedEventEmitter{get disposed(){return this._disposed}get currentState(){return this.state}constructor(d,l,f,b,C,v,{initialDelayMs:m=r,opsToBypassInitialDelay:h=s}={}){super(),this.clientElection=d,this.connectedState=l,this.summaryCollection=f,this.createSummarizerFn=C,this.startThrottler=v,this.state=o.Off,this._disposed=!1,this.handleConnected=g=>{this.latestClientId=g,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const g=this.getShouldSummarizeState();switch(this.state){case o.Off:{g.shouldSummarize&&this.startSummarization();return}case o.Starting:return;case o.Running:{g.shouldSummarize===!1&&this.stop(g.stopReason);return}case o.Stopping:return;default:return}},this.forwardedEvents=new Map,this.logger=(0,t.createChildLogger)({logger:b,namespace:"SummaryManager",properties:{all:{clientId:()=>this.latestClientId}}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=h,this.initialDelayMs=m}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){return this.disposed?{shouldSummarize:!1,stopReason:"parentNotConnected"}:this.connectedState.clientId!==this.clientElection.electedParentId?{shouldSummarize:!1,stopReason:"notElectedParent"}:this.state!==o.Running&&this.connectedState.clientId!==this.clientElection.electedClientId?{shouldSummarize:!1,stopReason:"notElectedClient"}:this.connectedState.connected?{shouldSummarize:!0}:{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){(0,n.assert)(this.state===o.Off,609),this.state=o.Starting,(0,n.assert)(this.summarizer===void 0,610),this.delayBeforeCreatingSummarizer().then(async d=>{if(this.disposed)return"early exit (disposed)";const l=this.getShouldSummarizeState();if(d&&l.shouldSummarize===!1)return`early exit ${l.stopReason}`;(0,n.assert)(this.state===o.Starting,611),this.state=o.Running;const f=await this.createSummarizerFn();this.summarizer=f,this.setupForwardedEvents();const b=this.getShouldSummarizeState();if(b.shouldSummarize===!1){if(d||!(0,i.stopReasonCanRunLastSummary)(b.stopReason))return this.state=o.Starting,f.stop(b.stopReason),`early exit after starting summarizer ${b.stopReason}`;this.logger.sendTelemetryEvent({eventName:"LastAttemptToSummarize"})}const C=this.latestClientId;return t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},async()=>f.run(C))}).then(d=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:d})}).catch(d=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},d),this.getShouldSummarizeState().shouldSummarize||this.summarizer!==void 0){const l=d?.errorType===a.DriverErrorTypes.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:l},d)}}).finally(()=>{(0,n.assert)(this.state!==o.Off,612),this.state=o.Off,this.cleanupForwardedEvents(),this.summarizer?.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()})}stop(d){u.isStartingOrRunning(this.state)&&(this.state=o.Stopping,this.summarizer?.stop(d))}async delayBeforeCreatingSummarizer(){let d=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:d,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay,electedParentId:this.clientElection.electedParentId,electedClientId:this.clientElection.electedClientId});let l=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(l=!0,d=Math.max(d,this.initialDelayMs)),d>0){let f,b;const C=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(f),b())},v=new Promise(h=>{f=setTimeout(()=>h(),d)}),m=new Promise(h=>{b=h});this.summaryCollection.addOpListener(C),await Promise.race([v,m]),this.summaryCollection.removeOpListener(C)}return l}summarizeOnDemand(d){if(this.summarizer===void 0)throw new Error("No running summarizer client");return this.summarizer.summarizeOnDemand(d)}enqueueSummarize(d){if(this.summarizer===void 0)throw new Error("No running summarizer client");return this.summarizer.enqueueSummarize(d)}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this.cleanupForwardedEvents(),this._disposed=!0}setupForwardedEvents(){for(const d of["summarize","summarizeAllAttemptsFailed","summarizerStop","summarizerStart","summarizerStartupFailed"]){const l=(...f)=>{this.emit(d,...f)};this.summarizer?.on(d,l),this.forwardedEvents.set(d,l)}}cleanupForwardedEvents(){for(const[d,l]of this.forwardedEvents.entries())this.summarizer?.off(d,l);this.forwardedEvents.clear()}}return Bf.SummaryManager=u,u.isStartingOrRunning=c=>c===o.Starting||c===o.Running,Bf}var Dj={},pa={},W0={},J0={},E5;function cye(){if(E5)return J0;E5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(J0,"__esModule",{value:!0}),J0.opSize=void 0;const e=a=>{const t=typeof a.contents=="string"?a.contents:JSON.stringify(a.contents)??"",i=n(a)?a.data:"";return t.length+i.length};J0.opSize=e;const n=a=>a.data!==void 0;return J0}var Uf={},I5;function Cx(){if(I5)return Uf;I5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Uf,"__esModule",{value:!0}),Uf.SummarizeHeuristicRunner=Uf.SummarizeHeuristicData=void 0;const e=Je();class n{get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}get opsSinceLastSummary(){return this.numNonRuntimeOpsBefore+this.numRuntimeOpsBefore}constructor(u,c){this.lastOpSequenceNumber=u,this.hasMissingOpData=!1,this.totalOpsSize=0,this.totalOpsSizeBefore=0,this.numNonRuntimeOps=0,this.numNonRuntimeOpsBefore=0,this.numRuntimeOps=0,this.numRuntimeOpsBefore=0,this._lastAttempt=c,this._lastSuccessfulSummary={...c}}updateWithLastSummaryAckInfo(u){this._lastAttempt=u,this._lastSuccessfulSummary={...u}}recordAttempt(u){this._lastAttempt={refSequenceNumber:u??this.lastOpSequenceNumber,summaryTime:Date.now()},this.numNonRuntimeOpsBefore=this.numNonRuntimeOps,this.numRuntimeOpsBefore=this.numRuntimeOps,this.totalOpsSizeBefore=this.totalOpsSize}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary={...this.lastAttempt},this.numNonRuntimeOps-=this.numNonRuntimeOpsBefore,this.numNonRuntimeOpsBefore=0,this.numRuntimeOps-=this.numRuntimeOpsBefore,this.numRuntimeOpsBefore=0,this.totalOpsSize-=this.totalOpsSizeBefore,this.totalOpsSizeBefore=0}}Uf.SummarizeHeuristicData=n;class a{constructor(u,c,d,l,f=s()){this.heuristicData=u,this.configuration=c,this.logger=l,this.summarizeStrategies=f,this.idleTimer=new e.Timer(this.idleTime,()=>this.runSummarize("idle")),this.runSummarize=b=>{this.idleTimer?.clear(),this.opsSinceLastAck>0&&d(b)}}get idleTime(){const u=this.configuration.maxIdleTime,c=this.configuration.minIdleTime,l=i(this.heuristicData.numRuntimeOps,this.heuristicData.numNonRuntimeOps,this.configuration.runtimeOpWeight,this.configuration.nonRuntimeOpWeight)*1/this.configuration.maxOps;return l>=1?c:u-(u-c)*l}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}start(){this.idleTimer?.start(this.idleTime)}run(){for(const u of this.summarizeStrategies)if(u.shouldRunSummary(this.configuration,this.heuristicData))return this.runSummarize(u.summarizeReason);this.idleTimer?.restart(this.idleTime)}shouldRunLastSummary(){const u=i(this.heuristicData.numRuntimeOps,this.heuristicData.numNonRuntimeOps,this.configuration.runtimeOpWeight,this.configuration.nonRuntimeOpWeight),c=this.configuration.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",weightedOpsSinceLastAck:u,minOpsForLastSummaryAttempt:c}),u>=c}dispose(){this.idleTimer?.clear()}}Uf.SummarizeHeuristicRunner=a;class t{constructor(){this.summarizeReason="maxTime"}shouldRunSummary(u,c){return Date.now()-c.lastSuccessfulSummary.summaryTime>u.maxTime}}function i(o,u,c,d){return c*o+d*u}class r{constructor(){this.summarizeReason="maxOps"}shouldRunSummary(u,c){return i(c.numRuntimeOps,c.numNonRuntimeOps,u.runtimeOpWeight,u.nonRuntimeOpWeight)>u.maxOps}}function s(){return[new t,new r]}return Uf}var Q0={},Y0={},R5;function _x(){if(R5)return Y0;R5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Y0,"__esModule",{value:!0}),Y0.SummarizeResultBuilder=void 0;const e=Je();class n{constructor(){this.summarySubmitted=new e.Deferred,this.summaryOpBroadcasted=new e.Deferred,this.receivedSummaryAckOrNack=new e.Deferred}fail(t,i,r,s){(0,e.assert)(!this.receivedSummaryAckOrNack.isCompleted,606);const o={success:!1,message:t,data:void 0,error:i};this.summarySubmitted.resolve({...o,data:r}),this.summaryOpBroadcasted.resolve(o),this.receivedSummaryAckOrNack.resolve({...o,data:s})}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}return Y0.SummarizeResultBuilder=n,Y0}var F5;function uye(){if(F5)return Q0;F5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Q0,"__esModule",{value:!0}),Q0.SummaryGenerator=void 0;const e=Je(),n=on(),a=Kn(),t=Ot(),i=wE(),r=_x(),s=2e4,o=5;class u{constructor(d,l,f,b,C,v,m){this.pendingAckTimer=d,this.heuristicData=l,this.submitSummaryCallback=f,this.successfulSummaryCallback=b,this.refreshLatestSummaryCallback=C,this.summaryWatcher=v,this.logger=m,this.summarizeTimer=new e.Timer(s,()=>this.summarizeTimerHandler(s,1))}summarize(d,l=new r.SummarizeResultBuilder){return this.summarizeCore(d,l).catch(f=>{const b="UnexpectedSummarizeError";d.summaryLogger.sendErrorEvent({eventName:b},f),l.fail(b,f)}),l.build()}async summarizeCore(d,l){const{summaryLogger:f,cancellationToken:b,...C}=d,v=Date.now()-this.heuristicData.lastAttempt.summaryTime,m=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime;let h={...C,fullTree:C.fullTree??!1,timeSinceLastAttempt:v,timeSinceLastSummary:m};const g=t.PerformanceEvent.start(f,{eventName:"Summarize",...h},{start:!0,end:!0,cancel:"generic"});let _;const S=(p,w,O,E,F)=>{const R=b.cancelled||(0,t.isFluidError)(w)&&w?.errorType===n.DriverErrorTypes.offlineError?"generic":"error",M=(0,i.getFailMessage)(p);g.cancel({...O,reason:M,category:R,retryAfterSeconds:w.retryAfterSeconds},w),l.fail(M,w,E,F)};this.summarizeTimer.start();try{const p=this.heuristicData.lastAttempt.refSequenceNumber;_=await this.submitSummaryCallback(d);const w=_.referenceSequenceNumber;if(h={...h,referenceSequenceNumber:w,minimumSequenceNumber:_.minimumSequenceNumber,opsSinceLastAttempt:w-p,opsSinceLastSummary:w-this.heuristicData.lastSuccessfulSummary.refSequenceNumber,stage:_.stage},h=this.addSummaryDataToTelemetryProps(_,h),_.stage!=="submit"){const O="submitSummaryFailure",E=_.error??new i.RetriableSummaryError((0,i.getFailMessage)(O));return S(O,E,h,{stage:_.stage})}if(!d.fullTree){const{summarizedDataStoreCount:O,gcStateUpdatedDataStoreCount:E=0}=_.summaryStats;O>E+this.heuristicData.opsSinceLastSummary&&f.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:O,gcStateUpdatedDataStoreCount:E,opsSinceLastSummary:this.heuristicData.opsSinceLastSummary})}g.reportEvent("generate",{...h}),l.summarySubmitted.resolve({success:!0,data:_})}catch(p){return S("submitSummaryFailure",(0,t.wrapError)(p,w=>new i.RetriableSummaryError(w,(0,a.getRetryDelaySecondsFromError)(p))),void 0,{stage:"unknown"})}finally{_===void 0&&this.heuristicData.recordAttempt(),this.summarizeTimer.clear()}try{const p=this.pendingAckTimer.start(),w=this.summaryWatcher.watchSummary(_.clientSequenceNumber),O=await(0,i.raceTimer)(w.waitBroadcast(),p,b);if(O.result==="cancelled"){const k="disconnect";return S(k,new i.RetriableSummaryError((0,i.getFailMessage)(k)))}if(O.result!=="done"){const k="summaryOpWaitTimeout";return S(k,new i.RetriableSummaryError((0,i.getFailMessage)(k),0))}const E=O.value,F=Date.now()-this.heuristicData.lastAttempt.summaryTime;l.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:E,broadcastDuration:F}}),this.heuristicData.lastAttempt.summarySequenceNumber=E.sequenceNumber,f.sendTelemetryEvent({eventName:"Summarize_Op",duration:F,referenceSequenceNumber:E.referenceSequenceNumber,summarySequenceNumber:E.sequenceNumber,handle:E.contents.handle});const R=await(0,i.raceTimer)(w.waitAckNack(),p,b);if(R.result==="cancelled"){const k="disconnect";return S(k,new i.RetriableSummaryError((0,i.getFailMessage)(k)))}if(R.result!=="done"){const k="summaryAckWaitTimeout";return S(k,new i.RetriableSummaryError((0,i.getFailMessage)(k),0))}const M=R.value;this.pendingAckTimer.clear();const j=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(h={ackWaitDuration:j,ackNackSequenceNumber:M.sequenceNumber,summarySequenceNumber:M.contents.summaryProposal.summarySequenceNumber,...h},M.type===n.MessageType.SummaryAck)this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),g.end({...h,handle:M.contents.handle}),await this.refreshLatestSummaryCallback({proposalHandle:E.contents.handle,ackHandle:M.contents.handle,summaryRefSeq:E.referenceSequenceNumber,summaryLogger:f}),l.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:M,ackNackDuration:j}});else{(0,e.assert)(M.type===n.MessageType.SummaryNack,628);const k=M.contents,x=k?.message,L=k?.retryAfter,V="summaryNack",G=new i.RetriableSummaryError((0,i.getFailMessage)(V),L,{errorMessage:x});return(0,e.assert)((0,a.getRetryDelaySecondsFromError)(G)===L,607),S(V,G,{...h,nackRetryAfter:L},void 0,{summaryNackOp:M,ackNackDuration:j})}}finally{this.pendingAckTimer.clear()}}addSummaryDataToTelemetryProps(d,l){switch(d.stage){case"base":return l;case"generate":return{...l,...d.summaryStats,generateDuration:d.generateDuration};case"upload":return{...l,...d.summaryStats,generateDuration:d.generateDuration,handle:d.handle,uploadDuration:d.uploadDuration};case"submit":return{...l,...d.summaryStats,generateDuration:d.generateDuration,handle:d.handle,uploadDuration:d.uploadDuration,clientSequenceNumber:d.clientSequenceNumber,hasMissingOpData:this.heuristicData.hasMissingOpData,opsSizesSinceLastSummary:this.heuristicData.totalOpsSize,nonRuntimeOpsSinceLastSummary:this.heuristicData.numNonRuntimeOps,runtimeOpsSinceLastSummary:this.heuristicData.numRuntimeOps};default:(0,e.assert)(!0,919)}return l}summarizeTimerHandler(d,l){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:d,timeoutCount:l}),l<o){const f=d*2;this.summarizeTimer.start(f,()=>this.summarizeTimerHandler(f,l+1))}}dispose(){this.summarizeTimer.clear()}}return Q0.SummaryGenerator=u,Q0}var j5;function ase(){if(j5)return W0;j5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(W0,"__esModule",{value:!0}),W0.RunningSummarizer=void 0;const e=Ht(),n=Je(),a=on(),t=Ot(),i=cye(),r=wE(),s=ose(),o=Cx(),u=uye(),c=_x(),d=600*1e3;class l extends e.TypedEventEmitter{static async start(b,C,v,m,h,g,_,S,p,w){const O=new l(b,C,v,m,h,g,_,S,p,w);let E=w.deltaManager.initialSequenceNumber+1;const F=_.latestAck;F!==void 0&&F.summaryOp.referenceSequenceNumber>=E&&(await O.handleSummaryAck(F),E=F.summaryOp.referenceSequenceNumber+1),await O.waitStart(),O.processIncomingSummaryAcks(E).catch(M=>{(0,t.createChildLogger)({logger:b}).sendErrorEvent({eventName:"HandleSummaryAckFatalError"},M)});const R=w.deltaManager.lastSequenceNumber-(g.lastSuccessfulSummary.refSequenceNumber+g.numNonRuntimeOps+g.numRuntimeOps);return g.hasMissingOpData=R>0,g.hasMissingOpData&&(g.numNonRuntimeOps+=Math.ceil(R/2),g.numRuntimeOps+=Math.floor(R/2)),g.lastOpSequenceNumber=w.deltaManager.lastSequenceNumber,O.heuristicRunner?.start(),O.heuristicRunner?.run(),O}get disposed(){return this._disposed}constructor(b,C,v,m,h,g,_,S,p,w){super(),this.summaryWatcher=C,this.configuration=v,this.submitSummaryCallback=m,this.refreshLatestSummaryAckCallback=h,this.heuristicData=g,this.summaryCollection=_,this.cancellationToken=S,this.stopSummarizerCallback=p,this.runtime=w,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.initialized=!1,this.lastSummarizeFailureEventProps=void 0,this.refreshLatestSummaryAckAndHandleError=async M=>this.refreshLatestSummaryAckCallback(M).catch(async j=>{const k=(0,t.isFluidError)(j)&&j.errorType===a.DriverErrorTypes.fileNotFoundOrAccessDeniedError;M.summaryLogger.sendTelemetryEvent({eventName:k?"HandleSummaryAckErrorIgnored":"HandleLastSummaryAckError",referenceSequenceNumber:M.summaryRefSeq,proposalHandle:M.proposalHandle,ackHandle:M.ackHandle},j)}),this.tryGetCorrelatedLogger=M=>this.heuristicData.lastAttempt.refSequenceNumber===M?this.mc.logger:void 0,this.heuristicRunnerMicroTaskExists=!1;const O={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.mc=(0,t.createChildMonitoringContext)({logger:b,namespace:"Running",properties:{all:O}}),v.state!=="disableHeuristics"&&((0,n.assert)(this.configuration.state==="enabled",746),this.heuristicRunner=new o.SummarizeHeuristicRunner(g,this.configuration,M=>this.trySummarize(M),this.mc.logger)),(0,n.assert)(this.configuration.state!=="disabled",747);const E=Math.min(this.configuration.maxAckWaitTime,d);this.pendingAckTimer=new n.PromiseTimer(E,()=>{this.mc.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",message:"Pending summary ack not received in time",maxAckWaitTime:E,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})}),_.setPendingAckTimerTimeoutCallback(E,()=>{this.pendingAckTimer.hasTimer&&(this.mc.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())});const F=this.mc.config.getBoolean("Fluid.Summarizer.immediatelyRefreshLatestSummaryAck")??!0;this.generator=new u.SummaryGenerator(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,()=>{this.totalSuccessfulAttempts++},async M=>{F&&await this.refreshLatestSummaryAckAndHandleError(M)},this.summaryWatcher,this.mc.logger),this.runtimeListener=(M,j)=>{this.handleOp(M,j===!0)},this.runtime.on("op",this.runtimeListener);const R=this.mc.config.getNumber("Fluid.Summarizer.AttemptsForSubmitFailures");this.maxAttemptsForSubmitFailures=R&&R<s.defaultMaxAttemptsForSubmitFailures?R:s.defaultMaxAttemptsForSubmitFailures}async handleSummaryAck(b){const C=b.summaryOp.referenceSequenceNumber,v=this.tryGetCorrelatedLogger(C)??this.mc.logger,m=b.summaryOp.contents.handle,h=b.summaryAck.contents.handle;for(;this.summarizingLock!==void 0;)v.sendTelemetryEvent({eventName:"RefreshAttemptWithSummarizerRunning",referenceSequenceNumber:C,proposalHandle:m,ackHandle:h}),await this.summarizingLock;await this.lockedSummaryAction(()=>{},async()=>{const g={proposalHandle:m,ackHandle:h,summaryRefSeq:C,summaryLogger:v};await this.refreshLatestSummaryAckAndHandleError(g)},()=>{})}async processIncomingSummaryAcks(b){let C=b;for(;!this.disposed;){const v=await this.summaryCollection.waitSummaryAck(C);await this.handleSummaryAck(v),C=v.summaryOp.referenceSequenceNumber+1}}dispose(){this.runtime.off("op",this.runtimeListener),this.summaryWatcher.dispose(),this.heuristicRunner?.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleOp(b,C){this.heuristicData.lastOpSequenceNumber=b.sequenceNumber,C?this.heuristicData.numRuntimeOps++:this.heuristicData.numNonRuntimeOps++,this.heuristicData.totalOpsSize+=(0,i.opSize)(b),this.initialized&&this.opCanTriggerSummary(b,C)&&!this.tryRunEnqueuedSummary()&&!this.heuristicRunnerMicroTaskExists&&(this.heuristicRunnerMicroTaskExists=!0,Promise.resolve().then(()=>{this.heuristicRunner?.run()}).finally(()=>{this.heuristicRunnerMicroTaskExists=!1}))}opCanTriggerSummary(b,C){switch(b.type){case a.MessageType.Summarize:case a.MessageType.SummaryAck:case a.MessageType.SummaryNack:return!1;default:return C||this.nonRuntimeOpCanTriggerSummary()}}nonRuntimeOpCanTriggerSummary(){const b=this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;return this.configuration.state==="enabled"&&(this.configuration.nonRuntimeHeuristicThreshold===void 0||this.configuration.nonRuntimeHeuristicThreshold<=b)}async waitStop(b){this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),b&&this.heuristicRunner?.shouldRunLastSummary()&&this.summarizingLock===void 0&&this.trySummarizeOnce({summarizeReason:"lastSummary"},{},void 0,!0),await this.summarizingLock,this.lastSummarizeFailureEventProps!==void 0&&this.emit("summarizeAllAttemptsFailed",{...this.lastSummarizeFailureEventProps,numUnsummarizedRuntimeOps:this.heuristicData.numRuntimeOps,numUnsummarizedNonRuntimeOps:this.heuristicData.numNonRuntimeOps}),this.lastSummarizeFailureEventProps=void 0)}async waitStart(){const b=await(0,r.raceTimer)(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),b.result==="done"&&b.value!==void 0&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:b.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:b.value.summaryOp.sequenceNumber}),this.initialized=!0}beforeSummaryAction(){this.summarizeCount++}afterSummaryAction(){const b=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,!this.stopping&&!this.tryRunEnqueuedSummary()&&b&&this.heuristicRunner?.run()}async lockedSummaryAction(b,C,v){(0,n.assert)(this.summarizingLock===void 0,603);const m=new n.Deferred;return this.summarizingLock=m.promise,b(),C().finally(()=>{m.resolve(),this.summarizingLock=void 0,v()})}trySummarizeOnce(b,C,v=new c.SummarizeResultBuilder,m=!1){return this.lockedSummaryAction(()=>{this.beforeSummaryAction()},async()=>{const h=(0,t.createChildLogger)({logger:this.mc.logger,properties:{all:b}}),g={...C,summaryLogger:h,cancellationToken:this.cancellationToken,latestSummaryRefSeqNum:this.heuristicData.lastSuccessfulSummary.refSequenceNumber},S=await this.generator.summarize(g,v).receivedSummaryAckOrNack;S.success?(this.emit("summarize",{result:"success",currentAttempt:1,maxAttempts:1,numUnsummarizedRuntimeOps:this.heuristicData.numRuntimeOps,numUnsummarizedNonRuntimeOps:this.heuristicData.numNonRuntimeOps,isLastSummary:m}),this.lastSummarizeFailureEventProps=void 0):(this.emit("summarize",{result:"failure",currentAttempt:1,maxAttempts:1,error:S.error,failureMessage:S.message,numUnsummarizedRuntimeOps:this.heuristicData.numRuntimeOps,numUnsummarizedNonRuntimeOps:this.heuristicData.numNonRuntimeOps,isLastSummary:m}),this.mc.logger.sendErrorEvent({eventName:"SummarizeFailed",maxAttempts:1,summaryAttempts:1},S.error),m&&(this.lastSummarizeFailureEventProps={currentAttempt:(this.lastSummarizeFailureEventProps?.currentAttempt??0)+1,maxAttempts:(this.lastSummarizeFailureEventProps?.currentAttempt??0)+1,error:S.error,failureMessage:S.message}))},()=>{this.afterSummaryAction()}).catch(h=>{}),v.build()}trySummarize(b){if(this.summarizingLock!==void 0){this.tryWhileSummarizing=!0;return}this.lockedSummaryAction(()=>{this.beforeSummaryAction()},async()=>this.trySummarizeWithRetries(b),()=>{this.afterSummaryAction()}).catch(C=>{this.mc.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},C)})}async trySummarizeWithRetries(b){const C=(O,E)=>{const F={fullTree:!1},R={summarizeReason:b,summaryAttempts:O,...F,finalAttempt:E},M=(0,t.createChildLogger)({logger:this.mc.logger,properties:{all:R}}),j={...F,summaryLogger:M,cancellationToken:this.cancellationToken,finalAttempt:E,latestSummaryRefSeqNum:this.heuristicData.lastSuccessfulSummary.refSequenceNumber},k=this.generator.summarize(j);return{summarizeProps:R,summarizeResult:k}};let v=s.defaultMaxAttempts,m=0,h,g=!1,_="success",S,p,w;do{if(m++,this.cancellationToken.cancelled){_="canceled",g=!0;break}const O=C(m,!1);S=O.summarizeResult;const E=await S.receivedSummaryAckOrNack;if(E.success){_="success",g=!0;break}const F=await S.summarySubmitted;v=F.success?s.defaultMaxAttempts:this.maxAttemptsForSubmitFailures,_="failure",p=E.error,w=E.message,h=p.retryAfterSeconds;const R={result:_,currentAttempt:m,maxAttempts:v,error:p,failureMessage:w,numUnsummarizedRuntimeOps:this.heuristicData.numRuntimeOps,numUnsummarizedNonRuntimeOps:this.heuristicData.numNonRuntimeOps};this.emit("summarize",R),(h===void 0||m>=v-1)&&(g=!0),h!==void 0&&h>0&&(this.mc.logger.sendPerformanceEvent({eventName:"SummarizeAttemptDelay",duration:h*1e3,summaryNackDelay:E.data!==void 0,stage:F.data?.stage,...O.summarizeProps}),await(0,n.delay)(h*1e3))}while(!g);if(_!=="failure")return this.emit("summarize",{result:_,currentAttempt:m,maxAttempts:v,numUnsummarizedRuntimeOps:this.heuristicData.numRuntimeOps,numUnsummarizedNonRuntimeOps:this.heuristicData.numNonRuntimeOps}),S;if(h!==void 0){const{summarizeResult:O}=C(++m,!0),E=await O.receivedSummaryAckOrNack;_=E.success?"success":"failure",p=E.success?void 0:E.error,w=E.success?void 0:E.message;const F={result:_,currentAttempt:m,maxAttempts:v,error:p,failureMessage:w,numUnsummarizedRuntimeOps:this.heuristicData.numRuntimeOps,numUnsummarizedNonRuntimeOps:this.heuristicData.numNonRuntimeOps};this.emit("summarize",F),S=O}return _==="failure"&&(this.mc.logger.sendErrorEvent({eventName:"SummarizeFailed",maxAttempts:v,summaryAttempts:m},p),this.lastSummarizeFailureEventProps={currentAttempt:m,maxAttempts:v,error:p,failureMessage:w},this.stopSummarizerCallback("failToSummarize")),S}async summarizeOnDemandWithRetries(b,C){const v=await this.trySummarizeWithRetries(b);if(v===void 0)return C.fail("Summarization was canceled",new r.RetriableSummaryError("Summarization was canceled")),C.build();const m=await v.summarySubmitted,h=await v.summaryOpBroadcasted,g=await v.receivedSummaryAckOrNack;return C.summarySubmitted.resolve(m),C.summaryOpBroadcasted.resolve(h),C.receivedSummaryAckOrNack.resolve(g),C.build()}summarizeOnDemand(b,C=new c.SummarizeResultBuilder){if(this.stopping)return C.fail("RunningSummarizer stopped or disposed",new r.RetriableSummaryError("RunningSummarizer stopped or disposed")),C.build();if(this.summarizingLock!==void 0)throw new t.UsageError("Attempted to run an already-running summarizer on demand");const{reason:v,...m}=b;return b.retryOnFailure===!0?this.summarizeOnDemandWithRetries(`onDemand;${v}`,C).catch(h=>{C.fail("summarize failed",h)}):this.trySummarizeOnce({summarizeReason:`onDemand/${v}`},m,C),C.build()}enqueueSummarize(b){const{reason:C,afterSequenceNumber:v=0,override:m=!1,...h}=b;let g=!1;if(this.enqueuedSummary!==void 0){if(!m)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",new r.RetriableSummaryError("Summary was overridden by another enqueue summarize attempt")),this.enqueuedSummary=void 0,g=!0}this.enqueuedSummary={reason:`enqueue;${C}`,afterSequenceNumber:v,summarizeOptions:h,resultsBuilder:new c.SummarizeResultBuilder};const _=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),g?{..._,alreadyEnqueued:!0,overridden:!0}:_}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(this.enqueuedSummary===void 0||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||this.summarizingLock!==void 0)return!1;const{reason:b,resultsBuilder:C,summarizeOptions:v}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({summarizeReason:`enqueuedSummary/${b}`},v,C),!0}disposeEnqueuedSummary(){this.enqueuedSummary!==void 0&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",new r.RetriableSummaryError("RunningSummarizer stopped or disposed")),this.enqueuedSummary=void 0)}}return W0.RunningSummarizer=l,W0}var M5;function ose(){if(M5)return pa;M5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(pa,"__esModule",{value:!0}),pa.Summarizer=pa.createSummarizingWarning=pa.SummarizingWarning=pa.defaultMaxAttemptsForSubmitFailures=pa.defaultMaxAttempts=void 0;const e=Ht(),n=Je(),a=Ot(),t=ase(),i=Cx(),r=_x();pa.defaultMaxAttempts=2,pa.defaultMaxAttemptsForSubmitFailures=5;class s extends a.LoggingError{constructor(d,l=!1){super(d),this.logged=l,this.errorType="summarizingError",this.canRetry=!0}static wrap(d,l=!1,f){const b=C=>new s(C,l);return(0,a.wrapErrorAndLog)(d,b,f)}}pa.SummarizingWarning=s;const o=(c,d)=>new s(c,d);pa.createSummarizingWarning=o;class u extends e.TypedEventEmitter{get ISummarizer(){return this}constructor(d,l,f,b,C,v){super(),this.runtime=d,this.configurationGetter=l,this.internalsProvider=f,this.summaryCollection=C,this.runCoordinatorCreateFn=v,this._disposed=!1,this.starting=!1,this.stopDeferred=new n.Deferred,this.forwardedEvents=new Map,this.logger=(0,a.createChildLogger)({logger:this.runtime.baseLogger,namespace:"Summarizer"})}async run(d){try{const l=await this.runCore(d);return this.emit("summarizerStop",{stopReason:l,numUnsummarizedRuntimeOps:this._heuristicData?.numRuntimeOps,numUnsummarizedNonRuntimeOps:this._heuristicData?.numNonRuntimeOps}),l}catch(l){throw this.stop("summarizerException"),this.emit("summarizerStop",{stopReason:"summarizerException",error:l,numUnsummarizedRuntimeOps:this._heuristicData?.numRuntimeOps,numUnsummarizedNonRuntimeOps:this._heuristicData?.numNonRuntimeOps}),s.wrap(l,!1,this.logger)}finally{this.close()}}stop(d){this.stopDeferred.resolve(d)}close(){this.dispose(),this.runtime.disposeFn()}async runCore(d){const l=await this.runCoordinatorCreateFn(this.runtime),f=Promise.race([l.waitCancelled,this.stopDeferred.promise]);if(f.then(v=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:d,reason:v})}),l.cancelled)return this.emit("summarizerStartupFailed",{reason:await l.waitCancelled,numUnsummarizedRuntimeOps:this._heuristicData?.numRuntimeOps,numUnsummarizedNonRuntimeOps:this._heuristicData?.numNonRuntimeOps}),l.waitCancelled;this.emit("summarizerStart",{onBehalfOf:d,numUnsummarizedRuntimeOps:this._heuristicData?.numRuntimeOps,numUnsummarizedNonRuntimeOps:this._heuristicData?.numNonRuntimeOps});const b=await this.start(d,l),C=await f;return await b.waitStop(!l.cancelled&&u.stopReasonCanRunLastSummary(C)),l.stop(C),C}static stopReasonCanRunLastSummary(d){return d==="parentNotConnected"}async start(d,l){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new a.UsageError("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new a.UsageError("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:d,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const f=this.runtime.clientId;if(f===void 0)throw new a.UsageError("clientId should be defined if connected.");this._heuristicData=new i.SummarizeHeuristicData(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()});const b=await t.RunningSummarizer.start(this.logger,this.summaryCollection.createWatcher(f),this.configurationGetter(),async(...C)=>this.internalsProvider.submitSummary(...C),async(...C)=>this.internalsProvider.refreshLatestSummaryAck(...C),this._heuristicData,this.summaryCollection,l,C=>l.stop(C),this.runtime);return this.runningSummarizer=b,this.setupForwardedEvents(),this.starting=!1,b}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.cleanupForwardedEvents(),this.runningSummarizer.dispose(),this.runningSummarizer=void 0)}summarizeOnDemand(d){try{if(this._disposed||this.runningSummarizer?.disposed)throw new a.UsageError("Summarizer is already disposed.");if(this.runtime.summarizerClientId!==void 0&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new a.UsageError("On-demand summary attempted while an elected summarizer is present");const l=new r.SummarizeResultBuilder;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(d,l):(this.runCoordinatorCreateFn(this.runtime).then(b=>{this.start(this.runtime.clientId,b).then(async v=>{v.summarizeOnDemand(d,l);const m=await Promise.race([this.stopDeferred.promise,b.waitCancelled]);await v.waitStop(!1),b.stop(m),this.close()}).catch(v=>{l.fail("Failed to start summarizer",v)})}).catch(b=>{l.fail("Failed to create cancellation token",b)}),l.build())}catch(l){throw s.wrap(l,!1,this.logger)}}enqueueSummarize(d){if(this._disposed||this.runningSummarizer===void 0||this.runningSummarizer.disposed)throw new a.UsageError("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(d)}recordSummaryAttempt(d){this._heuristicData?.recordAttempt(d)}setupForwardedEvents(){for(const d of["summarize","summarizeAllAttemptsFailed"]){const l=(...f)=>{this.emit(d,...f)};this.runningSummarizer?.on(d,l),this.forwardedEvents.set(d,l)}}cleanupForwardedEvents(){for(const[d,l]of this.forwardedEvents.entries())this.runningSummarizer?.off(d,l);this.forwardedEvents.clear()}}return pa.Summarizer=u,pa}var zf={},N5;function dye(){if(N5)return zf;N5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(zf,"__esModule",{value:!0}),zf.RunWhileConnectedCoordinator=zf.neverCancelledSummaryToken=void 0;const e=Je();zf.neverCancelledSummaryToken={cancelled:!1,waitCancelled:new Promise(()=>{})};class n{get cancelled(){return this._cancelled||(0,e.assert)(this.active(),605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(t,i){const r=new n(t,i);return await r.waitStart(),r}constructor(t,i){this.runtime=t,this.active=i,this._cancelled=!1,this.stopDeferred=new e.Deferred}async waitStart(){if(this.runtime.disposed){this.stop("summarizerClientDisconnected");return}if(this.runtime.once("dispose",()=>this.stop("summarizerClientDisconnected")),!this.runtime.connected){const t=new Promise(i=>this.runtime.once("connected",i));await Promise.race([t,this.waitCancelled])}this.runtime.once("disconnected",()=>this.stop("summarizerClientDisconnected"))}stop(t){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(t))}}return zf.RunWhileConnectedCoordinator=n,zf}var A5;function lye(){return A5||(A5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.SummarizeHeuristicRunner=e.SummarizeHeuristicData=e.RunningSummarizer=e.RunWhileConnectedCoordinator=e.neverCancelledSummaryToken=e.Summarizer=e.defaultMaxAttemptsForSubmitFailures=e.defaultMaxAttempts=void 0;var n=ose();Object.defineProperty(e,"defaultMaxAttempts",{enumerable:!0,get:function(){return n.defaultMaxAttempts}}),Object.defineProperty(e,"defaultMaxAttemptsForSubmitFailures",{enumerable:!0,get:function(){return n.defaultMaxAttemptsForSubmitFailures}}),Object.defineProperty(e,"Summarizer",{enumerable:!0,get:function(){return n.Summarizer}});var a=dye();Object.defineProperty(e,"neverCancelledSummaryToken",{enumerable:!0,get:function(){return a.neverCancelledSummaryToken}}),Object.defineProperty(e,"RunWhileConnectedCoordinator",{enumerable:!0,get:function(){return a.RunWhileConnectedCoordinator}});var t=ase();Object.defineProperty(e,"RunningSummarizer",{enumerable:!0,get:function(){return t.RunningSummarizer}});var i=Cx();Object.defineProperty(e,"SummarizeHeuristicData",{enumerable:!0,get:function(){return i.SummarizeHeuristicData}}),Object.defineProperty(e,"SummarizeHeuristicRunner",{enumerable:!0,get:function(){return i.SummarizeHeuristicRunner}})})(Dj)),Dj}var D5;function uT(){return D5||(D5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.SummarizeHeuristicRunner=e.SummarizeHeuristicData=e.RunningSummarizer=e.Summarizer=e.RunWhileConnectedCoordinator=e.neverCancelledSummaryToken=e.defaultMaxAttemptsForSubmitFailures=e.defaultMaxAttempts=e.SummaryManagerState=e.SummaryManager=e.RetriableSummaryError=e.getFailMessage=e.DocumentsSchemaController=e.currentDocumentVersionSchema=e.isSummariesDisabled=e.DefaultSummaryConfiguration=e.summarizerRequestUrl=e.validateSummaryHeuristicConfiguration=e.formCreateSummarizerFn=e.idCompressorBlobName=e.wrapSummaryInChannelsTree=e.rootHasIsolatedChannels=e.nonDataStorePaths=e.metadataBlobName=e.hasIsolatedChannels=e.getFluidDataStoreAttributes=e.getAttributesFormatVersion=e.extractSummaryMetadataMessage=e.electedSummarizerBlobName=e.dataStoreAttributesBlobName=e.recentBatchInfoBlobName=e.chunksBlobName=e.aliasBlobName=e.SummarizerClientElection=e.SummaryCollection=e.OrderedClientElection=e.OrderedClientCollection=e.summarizerClientType=e.createRootSummarizerNodeWithGC=e.createRootSummarizerNode=void 0;var n=eye();Object.defineProperty(e,"createRootSummarizerNode",{enumerable:!0,get:function(){return n.createRootSummarizerNode}}),Object.defineProperty(e,"createRootSummarizerNodeWithGC",{enumerable:!0,get:function(){return n.createRootSummarizerNodeWithGC}});var a=_E();Object.defineProperty(e,"summarizerClientType",{enumerable:!0,get:function(){return a.summarizerClientType}});var t=tye();Object.defineProperty(e,"OrderedClientCollection",{enumerable:!0,get:function(){return t.OrderedClientCollection}}),Object.defineProperty(e,"OrderedClientElection",{enumerable:!0,get:function(){return t.OrderedClientElection}});var i=nye();Object.defineProperty(e,"SummaryCollection",{enumerable:!0,get:function(){return i.SummaryCollection}});var r=rye();Object.defineProperty(e,"SummarizerClientElection",{enumerable:!0,get:function(){return r.SummarizerClientElection}});var s=iye();Object.defineProperty(e,"aliasBlobName",{enumerable:!0,get:function(){return s.aliasBlobName}}),Object.defineProperty(e,"chunksBlobName",{enumerable:!0,get:function(){return s.chunksBlobName}}),Object.defineProperty(e,"recentBatchInfoBlobName",{enumerable:!0,get:function(){return s.recentBatchInfoBlobName}}),Object.defineProperty(e,"dataStoreAttributesBlobName",{enumerable:!0,get:function(){return s.dataStoreAttributesBlobName}}),Object.defineProperty(e,"electedSummarizerBlobName",{enumerable:!0,get:function(){return s.electedSummarizerBlobName}}),Object.defineProperty(e,"extractSummaryMetadataMessage",{enumerable:!0,get:function(){return s.extractSummaryMetadataMessage}}),Object.defineProperty(e,"getAttributesFormatVersion",{enumerable:!0,get:function(){return s.getAttributesFormatVersion}}),Object.defineProperty(e,"getFluidDataStoreAttributes",{enumerable:!0,get:function(){return s.getFluidDataStoreAttributes}}),Object.defineProperty(e,"hasIsolatedChannels",{enumerable:!0,get:function(){return s.hasIsolatedChannels}}),Object.defineProperty(e,"metadataBlobName",{enumerable:!0,get:function(){return s.metadataBlobName}}),Object.defineProperty(e,"nonDataStorePaths",{enumerable:!0,get:function(){return s.nonDataStorePaths}}),Object.defineProperty(e,"rootHasIsolatedChannels",{enumerable:!0,get:function(){return s.rootHasIsolatedChannels}}),Object.defineProperty(e,"wrapSummaryInChannelsTree",{enumerable:!0,get:function(){return s.wrapSummaryInChannelsTree}}),Object.defineProperty(e,"idCompressorBlobName",{enumerable:!0,get:function(){return s.idCompressorBlobName}});var o=sye();Object.defineProperty(e,"formCreateSummarizerFn",{enumerable:!0,get:function(){return o.formCreateSummarizerFn}}),Object.defineProperty(e,"validateSummaryHeuristicConfiguration",{enumerable:!0,get:function(){return o.validateSummaryHeuristicConfiguration}}),Object.defineProperty(e,"summarizerRequestUrl",{enumerable:!0,get:function(){return o.summarizerRequestUrl}}),Object.defineProperty(e,"DefaultSummaryConfiguration",{enumerable:!0,get:function(){return o.DefaultSummaryConfiguration}}),Object.defineProperty(e,"isSummariesDisabled",{enumerable:!0,get:function(){return o.isSummariesDisabled}});var u=aye();Object.defineProperty(e,"currentDocumentVersionSchema",{enumerable:!0,get:function(){return u.currentDocumentVersionSchema}}),Object.defineProperty(e,"DocumentsSchemaController",{enumerable:!0,get:function(){return u.DocumentsSchemaController}});var c=wE();Object.defineProperty(e,"getFailMessage",{enumerable:!0,get:function(){return c.getFailMessage}}),Object.defineProperty(e,"RetriableSummaryError",{enumerable:!0,get:function(){return c.RetriableSummaryError}});var d=oye();Object.defineProperty(e,"SummaryManager",{enumerable:!0,get:function(){return d.SummaryManager}}),Object.defineProperty(e,"SummaryManagerState",{enumerable:!0,get:function(){return d.SummaryManagerState}});var l=lye();Object.defineProperty(e,"defaultMaxAttempts",{enumerable:!0,get:function(){return l.defaultMaxAttempts}}),Object.defineProperty(e,"defaultMaxAttemptsForSubmitFailures",{enumerable:!0,get:function(){return l.defaultMaxAttemptsForSubmitFailures}}),Object.defineProperty(e,"neverCancelledSummaryToken",{enumerable:!0,get:function(){return l.neverCancelledSummaryToken}}),Object.defineProperty(e,"RunWhileConnectedCoordinator",{enumerable:!0,get:function(){return l.RunWhileConnectedCoordinator}}),Object.defineProperty(e,"Summarizer",{enumerable:!0,get:function(){return l.Summarizer}}),Object.defineProperty(e,"RunningSummarizer",{enumerable:!0,get:function(){return l.RunningSummarizer}}),Object.defineProperty(e,"SummarizeHeuristicData",{enumerable:!0,get:function(){return l.SummarizeHeuristicData}}),Object.defineProperty(e,"SummarizeHeuristicRunner",{enumerable:!0,get:function(){return l.SummarizeHeuristicRunner}})})(Ej)),Ej}var k5;function cse(){if(k5)return pu;k5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(pu,"__esModule",{value:!0}),pu.DeltaManagerPendingOpsProxy=pu.DeltaManagerSummarizerProxy=pu.BaseDeltaManagerProxy=void 0;const e=Ht(),n=uT();class a extends e.TypedEventEmitter{get IDeltaSender(){return this}get inbound(){return this.deltaManager.inbound}get outbound(){return this.deltaManager.outbound}get inboundSignal(){return this.deltaManager.inboundSignal}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}constructor(s,o){super(),this.deltaManager=s,this.eventHandlers={onPrepareSend:u=>{this.emit("prepareSend",u)},onSubmitOp:u=>{this.emit("submitOp",u)},onOp:(u,c)=>{this.emit("op",u,c)},onPong:u=>{this.emit("pong",u)},onConnect:(u,c)=>{this.emit("connect",u,c)},onDisconnect:(u,c)=>{this.emit("disconnect",u,c)},onReadonly:(u,c)=>{this.emit("readonly",u,c)},...o},super.setMaxListeners(0),this.deltaManager.on("prepareSend",this.eventHandlers.onPrepareSend),this.deltaManager.on("submitOp",this.eventHandlers.onSubmitOp),this.deltaManager.on("op",this.eventHandlers.onOp),this.deltaManager.on("pong",this.eventHandlers.onPong),this.deltaManager.on("connect",this.eventHandlers.onConnect),this.deltaManager.on("disconnect",this.eventHandlers.onDisconnect),this.deltaManager.on("readonly",this.eventHandlers.onReadonly)}dispose(){this.deltaManager.off("prepareSend",this.eventHandlers.onPrepareSend),this.deltaManager.off("submitOp",this.eventHandlers.onSubmitOp),this.deltaManager.off("op",this.eventHandlers.onOp),this.deltaManager.off("pong",this.eventHandlers.onPong),this.deltaManager.off("connect",this.eventHandlers.onConnect),this.deltaManager.off("disconnect",this.eventHandlers.onDisconnect),this.deltaManager.off("readonly",this.eventHandlers.onReadonly),this.removeAllListeners()}submitSignal(s,o){return this.deltaManager.submitSignal(s,o)}flush(){return this.deltaManager.flush()}}pu.BaseDeltaManagerProxy=a;class t extends a{static wrapIfSummarizer(s){return s.clientDetails.type===n.summarizerClientType?new t(s):s}get active(){return!1}get readOnlyInfo(){return{readonly:!0,forced:!1,permissions:void 0,storageOnly:!1}}constructor(s){super(s,{onReadonly:()=>{}}),this.deltaManager=s}}pu.DeltaManagerSummarizerProxy=t;class i extends a{get minimumSequenceNumber(){const s=this.pendingStateManager.minimumPendingMessageSequenceNumber;return s!==void 0&&s<this.deltaManager.minimumSequenceNumber?s:this.deltaManager.minimumSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage===void 0?this.deltaManager.lastMessage:{...this.deltaManager.lastMessage,minimumSequenceNumber:this.minimumSequenceNumber}}constructor(s,o){super(s,{onOp:(u,c)=>{const d={...u,minimumSequenceNumber:this.minimumSequenceNumber};this.emit("op",d,c)}}),this.deltaManager=s,this.pendingStateManager=o}}return pu.DeltaManagerPendingOpsProxy=i,pu}var kj={},x5;function Tx(){return x5||(x5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.validateDatastoreCompatibility=e.validateLoaderCompatibility=e.dataStoreSupportRequirementsForRuntime=e.runtimeCompatDetailsForDataStore=e.loaderSupportRequirementsForRuntime=e.runtimeCompatDetailsForLoader=e.runtimeCoreCompatDetails=void 0;const n=Ht(),a=ja(),t=Ot(),i=TE();e.runtimeCoreCompatDetails={pkgVersion:i.pkgVersion,generation:1},e.runtimeCompatDetailsForLoader={...e.runtimeCoreCompatDetails,supportedFeatures:new Set},e.loaderSupportRequirementsForRuntime={minSupportedGeneration:0,requiredFeatures:[]},e.runtimeCompatDetailsForDataStore={...e.runtimeCoreCompatDetails,supportedFeatures:new Set([a.encodeHandlesInContainerRuntime,a.notifiesReadOnlyState])},e.dataStoreSupportRequirementsForRuntime={minSupportedGeneration:0,requiredFeatures:[]};function r(o,u){const c=(0,n.checkLayerCompatibility)(e.loaderSupportRequirementsForRuntime,o);if(!c.isCompatible){const d=new t.UsageError("Runtime is not compatible with Loader",{errorDetails:JSON.stringify({runtimeVersion:e.runtimeCoreCompatDetails.pkgVersion,loaderVersion:o?.pkgVersion,runtimeGeneration:e.runtimeCoreCompatDetails.generation,loaderGeneration:o?.generation,minSupportedGeneration:e.loaderSupportRequirementsForRuntime.minSupportedGeneration,isGenerationCompatible:c.isGenerationCompatible,unsupportedFeatures:c.unsupportedFeatures})});throw u(d),d}}e.validateLoaderCompatibility=r;function s(o,u){const c=(0,n.checkLayerCompatibility)(e.dataStoreSupportRequirementsForRuntime,o);if(!c.isCompatible){const d=new t.UsageError("Runtime is not compatible with DataStore",{errorDetails:JSON.stringify({runtimeVersion:e.runtimeCoreCompatDetails.pkgVersion,dataStoreVersion:o?.pkgVersion,runtimeGeneration:e.runtimeCoreCompatDetails.generation,dataStoreGeneration:o?.generation,minSupportedGeneration:e.dataStoreSupportRequirementsForRuntime.minSupportedGeneration,isGenerationCompatible:c.isGenerationCompatible,unsupportedFeatures:c.unsupportedFeatures})});throw u(),d}}e.validateDatastoreCompatibility=s})(kj)),kj}var q5;function fye(){if(q5)return Rs;q5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.LocalDetachedFluidDataStoreContext=Rs.LocalFluidDataStoreContext=Rs.LocalFluidDataStoreContextBase=Rs.RemoteFluidDataStoreContext=Rs.FluidDataStoreContext=Rs.createAttributesBlob=void 0;const e=Ht(),n=Mr(),a=Mr(),t=Je(),i=Kn(),r=ja(),s=bn(),o=Ot(),u=cse(),c=Tx(),d=uT();function l(_,S){return{pkg:JSON.stringify(_),summaryFormatVersion:2,isRootDataStore:S}}function f(_,S){const p=l(_,S);return new i.BlobTreeEntry(d.dataStoreAttributesBlobName,JSON.stringify(p))}Rs.createAttributesBlob=f;class b extends u.BaseDeltaManagerProxy{constructor(S,p){super(S,{onReadonly:()=>{}}),this.isReadOnly=p}get readOnlyInfo(){const S=this.isReadOnly();return S===this.deltaManager.readOnlyInfo.readonly?this.deltaManager.readOnlyInfo:S===!0?{readonly:S,forced:!1,permissions:void 0,storageOnly:!1}:{readonly:S}}emitReadonly(){this.emit("readonly",this.isReadOnly())}}class C extends e.TypedEventEmitter{get packagePath(){return(0,t.assert)(this.pkg!==void 0,313),this.pkg}get options(){return this.parentContext.options}get clientId(){return this.parentContext.clientId}get clientDetails(){return this.parentContext.clientDetails}get baseLogger(){return this.parentContext.baseLogger}get deltaManager(){return this._contextDeltaManagerProxy}get connected(){return this.parentContext.connected}get IFluidHandleContext(){return this.parentContext.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get idCompressor(){return this.parentContext.idCompressor}get disposed(){return this._disposed}get tombstoned(){return this._tombstoned}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}get ILayerCompatDetails(){return c.runtimeCompatDetailsForDataStore}async isRoot(S){return this.isInMemoryRoot()?!0:S!==void 0&&this.baseSnapshot?.omitted===!0?S.has(this.id):(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}get pendingCount(){return this.pendingMessagesState?.pendingCount??0}constructor(S,p,w,O){super(),this.existing=p,this.isLocalDataStore=w,this.makeLocallyVisibleFn=O,this.isStagingMode=!1,this.isReadOnly=()=>this.isStagingMode&&this.channel?.policies?.readonlyInStagingMode!==!1||this.parentContext.isReadOnly(),this._disposed=!1,this._tombstoned=!1,this.gcThrowOnTombstoneUsage=!1,this.gcTombstoneEnforcementAllowed=!1,this.deleted=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pendingMessagesState={messageCollections:[],pendingCount:0},this._isInMemoryRoot=!1,this._containerRuntime=S.parentContext.containerRuntime,this.parentContext=S.parentContext,this.id=S.id,this.storage=S.storage,this.scope=S.scope,this.pkg=S.pkg,this.loadingGroupId=S.loadingGroupId,(0,t.assert)(!this.id.includes("/"),314),this._attachState=this.parentContext.attachState!==n.AttachState.Detached&&this.existing?this.parentContext.attachState:n.AttachState.Detached,this.summarizerNode=S.createSummarizerNodeFn(async(E,F,R)=>this.summarizeInternal(E,F,R),async E=>this.getGCDataInternal(E)),this.mc=(0,o.createChildMonitoringContext)({logger:this.baseLogger,namespace:"FluidDataStoreContext",properties:{all:(0,o.tagCodeArtifacts)({fluidDataStoreId:this.id,fullPackageName:()=>this.pkg?.join("/")})}}),this.thresholdOpsCounter=new o.ThresholdCounter(C.pendingOpsCountThreshold,this.mc.logger),this.localChangesTelemetryCount=this.mc.config.getNumber("Fluid.Telemetry.LocalChangesTelemetryCount")??10,(0,t.assert)((0,a.isIDeltaManagerFull)(this.parentContext.deltaManager),2947),this._contextDeltaManagerProxy=new b(this.parentContext.deltaManager,()=>this.isReadOnly())}dispose(){this._disposed||(this._disposed=!0,this.channelP&&this.channelP.then(S=>{S.dispose()}).catch(S=>{}),this._contextDeltaManagerProxy.dispose())}delete(){this.deleted=!0}setTombstone(S){this.tombstoned!==S&&(this._tombstoned=S)}factoryFromPackagePathError(S,p,w){throw new o.LoggingError(S,(0,o.tagCodeArtifacts)({failedPkgPath:p,packagePath:w?.join("/")}))}async realize(){return(0,t.assert)(!this.detachedRuntimeCreation,317),this.channelP||(this.channelP=this.realizeCore(this.existing).catch(S=>{const p=o.DataProcessingError.wrapIfUnrecognized(S,"realizeFluidDataStoreContext");throw p.addTelemetryProperties((0,o.tagCodeArtifacts)({fullPackageName:this.pkg?.join("/"),fluidDataStoreId:this.id})),this.mc.logger.sendErrorEvent({eventName:"RealizeError"},p),p})),this.channelP}async factoryFromPackagePath(){const S=this.pkg;S===void 0&&this.factoryFromPackagePathError("packages is undefined");let p,w=this.parentContext.IFluidDataStoreRegistry,O;for(const F of S)w||this.factoryFromPackagePathError("No registry for package",O,S),O=F,p=w.getSync?.(F)??await w.get(F),p||this.factoryFromPackagePathError("Registry does not contain entry for the package",F,S),w=p.IFluidDataStoreRegistry;const E=p?.IFluidDataStoreFactory;return E===void 0&&this.factoryFromPackagePathError("Can't find factory for package",O,S),(0,t.assert)(this.registry===void 0,343),this.registry=w,E}createChildDataStore(S){const p=this.registry?.getSync?.(S.type),w=p===void 0,O=p?.IFluidDataStoreFactory!==S;if(w||O)throw new o.UsageError("The provided factory instance must be synchronously available as a child of this datastore",{isUndefined:w,diffInstance:O});if(S?.createDataStore===void 0)throw new o.UsageError("createDataStore must exist on the provided factory",{noCreateDataStore:!0});const E=this._containerRuntime.createDetachedDataStore([...this.packagePath,S.type]);(0,t.assert)(E instanceof g,2697);const F=S.createDataStore(E);return E.unsafe_AttachRuntimeSync(F.runtime),F}async realizeCore(S){const p=await this.getInitialSnapshotDetails();this._baseSnapshot=p.snapshot,this.baseSnapshotSequenceNumber=p.sequenceNumber,(0,t.assert)(this.pkg===p.pkg,318);const O=await(await this.factoryFromPackagePath()).instantiateDataStore(this,S);return(0,t.assert)(O!==void 0,320),await this.bindRuntime(O,S),this.disposed&&O.dispose(),O}setConnectionState(S,p){this.verifyNotClosed("setConnectionState",!1),this.loaded&&((0,t.assert)(this.connected===S,321),this.channel.setConnectionState(S,p))}notifyReadOnlyState(){this.verifyNotClosed("notifyReadOnlyState",!1),this.channel?.notifyReadOnlyState?.(this.isReadOnly()),this._contextDeltaManagerProxy.emitReadonly()}notifyStagingMode(S){const p=this.isReadOnly();this.isStagingMode=S,this.isReadOnly()!==p&&this.notifyReadOnlyState()}processMessages(S){const{envelope:p,messagesContent:w,local:O}=S,E=(0,o.extractSafePropertiesFromMessage)(p);this.verifyNotClosed("process",!1,E),this.summarizerNode.recordChange(p),this.loaded?((0,t.assert)(this.channel!==void 0,2664),this.channel.processMessages(S)):((0,t.assert)(!O,322),(0,t.assert)(this.pendingMessagesState!==void 0,2665),this.pendingMessagesState.messageCollections.push({...S,messagesContent:[...w]}),this.pendingMessagesState.pendingCount+=w.length,this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pendingMessagesState.pendingCount))}processSignal(S,p){this.verifyNotClosed("processSignal"),this.loaded&&this.channel?.processSignal(S,p)}getQuorum(){return this.parentContext.getQuorum()}getAudience(){return this.parentContext.getAudience()}async summarize(S=!1,p=!0,w){return this.summarizerNode.summarize(S,p,w)}async summarizeInternal(S,p,w){await this.realize();const O=await this.channel.summarize(S,p,w);(0,d.wrapSummaryInChannelsTree)(O);const E=[r.channelsTreeName],{pkg:F}=await this.getInitialSnapshotDetails(),R=await this.isRoot(),M=l(F,R);return(0,s.addBlobToSummary)(O,d.dataStoreAttributesBlobName,JSON.stringify(M)),this.summarizerNode.isReferenced()||(O.summary.unreferenced=!0,O.stats.unreferencedBlobSize=O.stats.totalBlobSize),this.loadingGroupId!==void 0&&(O.summary.groupId=this.loadingGroupId),{...O,id:this.id,pathPartsForChildren:E}}async getGCData(S=!1){return this.summarizerNode.getGCData(S)}async getGCDataInternal(S=!1){return await this.realize(),(0,t.assert)(this.channel!==void 0,323),this.channel.getGCData(S)}updateUsedRoutes(S){if(this.summarizerNode.updateUsedRoutes(S),!this.channel)return;const p=S.filter(w=>w!=="/"&&w!=="");this.channel.updateUsedRoutes(p)}addedGCOutboundRoute(S,p,w){this.parentContext.addedGCOutboundRoute(S,p,w)}submitMessage(S,p,w){this.verifyNotClosed("submitMessage"),(0,t.assert)(!!this.channel,326),this.identifyLocalChangeIfReadonly("DataStoreMessageWhileReadonly",S),this.parentContext.submitMessage(S,p,w)}setChannelDirty(S){this.verifyNotClosed("setChannelDirty");const p=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(p);const w=this.summarizerNode.getChild(S);w&&w.invalidate(p)}submitSignal(S,p,w){return this.verifyNotClosed("submitSignal"),(0,t.assert)(!!this.channel,327),this.parentContext.submitSignal(S,p,w)}makeLocallyVisible(){(0,t.assert)(this.channel!==void 0,719),this.makeLocallyVisibleFn()}processPendingOps(S){const p=this.baseSnapshotSequenceNumber??-1;(0,t.assert)(this.pendingMessagesState!==void 0,2666);for(const w of this.pendingMessagesState.messageCollections)w.envelope.sequenceNumber>p&&S.processMessages(w);this.thresholdOpsCounter.send("ProcessPendingOps",this.pendingMessagesState.pendingCount),this.pendingMessagesState=void 0}completeBindingRuntime(S){const p=S;(0,c.validateDatastoreCompatibility)(p.ILayerCompatDetails,this.dispose.bind(this)),this.loaded=!0,this.channel=S,S.setConnectionState(this.connected,this.clientId),Object.freeze(this.pkg)}async bindRuntime(S,p){if(this.channel)throw new Error("Runtime already bound");(0,t.assert)(!this.detachedRuntimeCreation,328),(0,t.assert)(this.pkg!==void 0,330),p||await S.entryPoint.get(),this.processPendingOps(S),this.completeBindingRuntime(S)}async getAbsoluteUrl(S){if(this.attachState===n.AttachState.Attached)return this.parentContext.getAbsoluteUrl(S)}setInMemoryRoot(){this._isInMemoryRoot=!0}async getBaseGCDetails(){return{}}reSubmit(S,p,w,O){(0,t.assert)(!!this.channel,331),this.channel.reSubmit(S,p,w,O)}rollback(S,p,w){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");this.channel.rollback(S,p,w)}async applyStashedOp(S){return this.channel||await this.realize(),(0,t.assert)(!!this.channel,332),this.channel.applyStashedOp(S)}verifyNotClosed(S,p=!0,w={}){if(this.deleted){const O=`Context is deleted! Call site [${S}]`,E=o.DataProcessingError.create(O,S,void 0,w);throw this.mc.logger.sendErrorEvent({eventName:"GC_Deleted_DataStore_Changed",callSite:S},E),E}if(this._disposed)throw new Error(`Context is closed! Call site [${S}]`);if(p&&this.tombstoned){const O=`Context is tombstoned! Call site [${S}]`,E=o.DataProcessingError.create(O,S,void 0,w,30);this.mc.logger.sendTelemetryEvent({eventName:"GC_Tombstone_DataStore_Changed",category:"generic",callSite:S},E)}}identifyLocalChangeIfReadonly(S,p){!this.isReadOnly()||this.localChangesTelemetryCount<=0||(this.mc.logger.sendTelemetryEvent({eventName:S,type:p,isSummaryInProgress:this.summarizerNode.isSummaryInProgress?.(),stack:(0,o.generateStack)(30),readonly:this.isReadOnly(),isStagingMode:this.isStagingMode}),this.localChangesTelemetryCount--)}getCreateChildSummarizerNodeFn(S,p){return(w,O)=>this.summarizerNode.createChild(w,S,p,void 0,O)}deleteChildSummarizerNode(S){this.summarizerNode.deleteChild(S)}async uploadBlob(S,p){return this.parentContext.uploadBlob(S,p)}}Rs.FluidDataStoreContext=C,C.pendingOpsCountThreshold=1e3;class v extends C{constructor(S){super(S,!0,!1,()=>{throw new Error("Already attached")}),this.initialSnapshotDetailsP=new t.LazyPromise(async()=>{let p;if(this.snapshotFetchRequired===void 0&&this._baseSnapshot?.groupId!==void 0&&this.isSnapshotInISnapshotFormat&&((0,t.assert)(this.blobContents!==void 0,2426),(0,t.assert)(this._baseSnapshot!==void 0,2427),this.snapshotFetchRequired=(0,s.isSnapshotFetchRequiredForLoadingGroupId)(this._baseSnapshot,this.blobContents)),this.snapshotFetchRequired){(0,t.assert)(this.loadingGroupId!==void 0,2293);const E=await this.runtime.getSnapshotForLoadingGroupId([this.loadingGroupId],[this.id]);this._baseSnapshot=E.snapshotTree,p=E.sequenceNumber,this.snapshotFetchRequired=!1}let w=this.baseSnapshot,O=!0;if(w&&w.blobs[d.dataStoreAttributesBlobName]!==void 0){const E=await(0,i.readAndParse)(this.storage,w.blobs[d.dataStoreAttributesBlobName]);let F;(0,d.getAttributesFormatVersion)(E)<1?F=E.pkg.startsWith('["')&&E.pkg.endsWith('"]')?JSON.parse(E.pkg):[E.pkg]:F=JSON.parse(E.pkg),this.pkg=F,O=E.isRootDataStore??!0,(0,d.hasIsolatedChannels)(E)&&(w=w.trees[r.channelsTreeName],(0,t.assert)(w!==void 0,510))}return(0,t.assert)(this.pkg!==void 0,2294),{pkg:this.pkg,isRootDataStore:O,snapshot:w,sequenceNumber:p}}),this.runtime=S.parentContext.containerRuntime,(0,i.isInstanceOfISnapshot)(S.snapshot)?(this.blobContents=S.snapshot.blobContents,this._baseSnapshot=S.snapshot.snapshotTree,this.isSnapshotInISnapshotFormat=!0):(this._baseSnapshot=S.snapshot,this.isSnapshotInISnapshotFormat=!1)}setAttachState(S){}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}getAttachSummary(){throw new Error("Cannot attach remote store")}getAttachGCData(S){throw new Error("Cannot attach remote store")}}Rs.RemoteFluidDataStoreContext=v;class m extends C{constructor(S){super(S,S.snapshotTree!==void 0,!0,S.makeLocallyVisibleFn),this.initialSnapshotDetailsP=new t.LazyPromise(async()=>{let p=this.snapshotTree,w,O=!1;return p!==void 0&&(w=await(0,d.getFluidDataStoreAttributes)(this.storage,p),(0,d.hasIsolatedChannels)(w)&&(p=p.trees[r.channelsTreeName],(0,t.assert)(p!==void 0,511)),this.pkg===void 0&&(this.pkg=JSON.parse(w.pkg),(w.isRootDataStore??!0)&&(O=!0,this.setInMemoryRoot()))),(0,t.assert)(this.pkg!==void 0,338),{pkg:this.pkg,isRootDataStore:O,snapshot:p}}),this.identifyLocalChangeIfReadonly("DataStoreCreatedWhileReadonly"),this.snapshotTree=S.snapshotTree}setAttachState(S){switch(S){case n.AttachState.Attaching:{(0,t.assert)(this.attachState===n.AttachState.Detached,333),this._attachState=n.AttachState.Attaching,this.channel?.setAttachState?this.channel.setAttachState(S):this.channel&&this.emit("attaching");break}case n.AttachState.Attached:{this.attachState!==n.AttachState.Attached&&((0,t.assert)(this.attachState===n.AttachState.Attaching,334),this._attachState=n.AttachState.Attached,this.channel?.setAttachState?.(S),this.channel?.setAttachState?this.channel.setAttachState(S):this.channel&&this.emit("attached"));break}default:(0,t.unreachableCase)(S,"unreached")}}getAttachSummary(S){(0,t.assert)(this.channel!==void 0,335),(0,t.assert)(this.pkg!==void 0,336);const p=this.channel.getAttachSummary(S);(0,d.wrapSummaryInChannelsTree)(p);const w=l(this.pkg,this.isInMemoryRoot());return(0,s.addBlobToSummary)(p,d.dataStoreAttributesBlobName,JSON.stringify(w)),this.loadingGroupId!==void 0&&(p.summary.groupId=this.loadingGroupId),p}getAttachGCData(S){return(0,t.assert)(this.channel!==void 0,2470),this.channel.getAttachGCData(S)}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}delete(){this.mc.logger.sendErrorEvent({eventName:"GC_Deleted_DataStore_Unexpected_Delete",message:"Unexpected deletion of a local data store context"}),super.delete()}}Rs.LocalFluidDataStoreContextBase=m;class h extends m{constructor(S){super(S)}}Rs.LocalFluidDataStoreContext=h;class g extends m{constructor(S){super(S),this.detachedRuntimeCreation=!0,this.channelToDataStoreFn=S.channelToDataStoreFn}async attachRuntime(S,p){return(0,t.assert)(this.detachedRuntimeCreation,340),this.detachedRuntimeCreation=!1,(0,t.assert)(this.channelP===void 0,341),this.channelP=Promise.resolve().then(async()=>{const w=S.IFluidDataStoreFactory,O=await this.factoryFromPackagePath();return(0,t.assert)(O===w,342),await super.bindRuntime(p,!1),(0,t.assert)(!await this.isRoot(),2295),p}).catch(w=>{throw this.mc.logger.sendErrorEvent({eventName:"AttachRuntimeError"},w),w}),this.channelToDataStoreFn(await this.channelP)}unsafe_AttachRuntimeSync(S){return this.channelP=Promise.resolve(S),this.processPendingOps(S),this.completeBindingRuntime(S),this.channelToDataStoreFn(S)}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}return Rs.LocalDetachedFluidDataStoreContext=g,Rs}var X0={},L5;function hye(){if(L5)return X0;L5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(X0,"__esModule",{value:!0}),X0.DataStoreContexts=void 0;const e=Je(),n=Ot();class a{constructor(i){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new e.Lazy(()=>{for(const[r,s]of this.deferredContexts)s.promise.then(o=>{o.dispose()}).catch(o=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:r},o)})}),this.dispose=()=>this.disposeOnce.value,this._recentlyDeletedContexts=new Map,this._logger=(0,n.createChildLogger)({logger:i})}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(i){return this.notBoundContexts.has(i)}has(i){return this._contexts.has(i)}get(i){return this._contexts.get(i)}delete(i){this.deferredContexts.delete(i),this.notBoundContexts.delete(i);const r=this._contexts.get(i);return this._recentlyDeletedContexts.set(i,r),this._contexts.delete(i)}getRecentlyDeletedContext(i){return this._recentlyDeletedContexts.get(i)}getUnbound(i){const r=this._contexts.get(i);if(!(r===void 0||!this.notBoundContexts.has(i)))return r}addUnbound(i){const r=i.id;(0,e.assert)(!this._contexts.has(r),344),this._contexts.set(r,i),this.notBoundContexts.add(r),this.ensureDeferred(r)}async getBoundOrRemoted(i,r){const s=this.ensureDeferred(i);if(!(!r&&!s.isCompleted))return s.promise}ensureDeferred(i){const r=this.deferredContexts.get(i);if(r)return r;const s=new e.Deferred;return this.deferredContexts.set(i,s),s}bind(i){const r=this.notBoundContexts.delete(i);(0,e.assert)(r,345),this.resolveDeferred(i)}resolveDeferred(i){const r=this._contexts.get(i);(0,e.assert)(!!r,346),(0,e.assert)(!this.notBoundContexts.has(i),347);const s=this.deferredContexts.get(i);(0,e.assert)(!!s,348),s.resolve(r)}addBoundOrRemoted(i){const r=i.id;(0,e.assert)(!this._contexts.has(r),349),this._contexts.set(r,i),this.ensureDeferred(r),this.resolveDeferred(r)}}return X0.DataStoreContexts=a,X0}var Z0={},B5;function wx(){if(B5)return Z0;B5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Z0,"__esModule",{value:!0}),Z0.FluidDataStoreRegistry=void 0;const e=Je(),n=Ot();class a{get IFluidDataStoreRegistry(){return this}constructor(i){this.map=new Map;for(const r of i){if(this.map.has(r[0]))throw new n.UsageError("Duplicate entry names exist");this.map.set(r[0],r[1])}}async get(i){if(this.map.has(i))return this.map.get(i)}getSync(i){const r=this.map.get(i);if(!(0,e.isPromiseLike)(r))return r}}return Z0.FluidDataStoreRegistry=a,Z0}var eS={},U5;function mye(){if(U5)return eS;U5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(eS,"__esModule",{value:!0}),eS.StorageServiceWithAttachBlobs=void 0;const e=Ot();class n{constructor(t,i){this.internalStorageService=t,this.attachBlobs=i}get policies(){return this.internalStorageService.policies}async readBlob(t){const i=this.attachBlobs.get(t);return i!==void 0?i:this.internalStorageService.readBlob(t)}async getSnapshotTree(t,i){return this.internalStorageService.getSnapshotTree(t,i)}async getSnapshot(t){if(this.internalStorageService.getSnapshot!==void 0)return this.internalStorageService.getSnapshot(t);throw new e.UsageError("getSnapshot api should exist on internal storage in documentStorageServiceProxy class")}async getVersions(t,i,r,s){return this.internalStorageService.getVersions(t,i,r,s)}async uploadSummaryWithContext(t,i){return this.internalStorageService.uploadSummaryWithContext(t,i)}async createBlob(t){return this.internalStorageService.createBlob(t)}async downloadSummary(t){return this.internalStorageService.downloadSummary(t)}}return eS.StorageServiceWithAttachBlobs=n,eS}var z5;function use(){return z5||(z5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ChannelCollectionFactory=e.detectOutboundReferences=e.getSummaryForDatastores=e.ChannelCollection=e.getLocalDataStoreType=e.wrapContext=e.AllowTombstoneRequestHeaderKey=void 0;const n=Mr(),a=Je(),t=yx(),i=Kn(),r=ja(),s=bn(),o=Ot(),u=ys(),c=lT(),d=Zie(),l=fye(),f=hye(),b=wx(),C=CE(),v=$g(),m=mye(),h=uT();e.AllowTombstoneRequestHeaderKey="allowTombstone";function g(F){return{get IFluidDataStoreRegistry(){return F.IFluidDataStoreRegistry},IFluidHandleContext:F.IFluidHandleContext,options:F.options,get clientId(){return F.clientId},get connected(){return F.connected},deltaManager:F.deltaManager,storage:F.storage,baseLogger:F.baseLogger,get clientDetails(){return F.clientDetails},get idCompressor(){return F.idCompressor},loadingGroupId:F.loadingGroupId,get attachState(){return F.attachState},isReadOnly:()=>F.isReadOnly(),containerRuntime:F.containerRuntime,scope:F.scope,gcThrowOnTombstoneUsage:F.gcThrowOnTombstoneUsage,gcTombstoneEnforcementAllowed:F.gcTombstoneEnforcementAllowed,getAbsoluteUrl:async(...R)=>F.getAbsoluteUrl(...R),getQuorum:(...R)=>F.getQuorum(...R),getAudience:(...R)=>F.getAudience(...R),submitMessage:(...R)=>F.submitMessage(...R),submitSignal:(...R)=>F.submitSignal(...R),makeLocallyVisible:(...R)=>F.makeLocallyVisible(...R),uploadBlob:async(...R)=>F.uploadBlob(...R),addedGCOutboundRoute:(...R)=>F.addedGCOutboundRoute(...R),getCreateChildSummarizerNodeFn:(...R)=>F.getCreateChildSummarizerNodeFn?.(...R),deleteChildSummarizerNode:(...R)=>F.deleteChildSummarizerNode(...R),setChannelDirty:R=>F.setChannelDirty(R)}}e.wrapContext=g;function _(F,R){const M=g(R);return M.submitMessage=(j,k,x)=>{const V={address:F,contents:{content:k,type:j}};R.submitMessage(v.ContainerMessageType.FluidDataStoreOp,V,x)},M.submitSignal=(j,k,x)=>{const L={address:F,contents:k};R.submitSignal(j,L,x)},M}function S(F){return F.packagePath[F.packagePath.length-1]}e.getLocalDataStoreType=S;class p{constructor(R,M,j,k,x,L,V){this.baseSnapshot=R,this.parentContext=M,this.gcNodeUpdated=k,this.isDataStoreDeleted=x,this.aliasMap=L,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new a.Lazy(()=>this.contexts.dispose()),this.pendingAliasMap=new Map,this.shouldSendAttachLog=!0,this.mc=(0,o.createChildMonitoringContext)({logger:j}),this.contexts=new f.DataStoreContexts(j),this.entryPoint=new t.FluidObjectHandle(new a.LazyPromise(async()=>V(this)),"",this.parentContext.IFluidHandleContext),this.aliasedDataStores=new Set(L.values());const G=new Map;if(R){const se=(0,i.getSnapshotTree)(R);for(const[re,fe]of Object.entries(se.trees))G.set(re,fe)}let ee=0;for(const[se,re]of G){let fe;if(re.unreferenced&&ee++,this.parentContext.attachState===n.AttachState.Detached){if(typeof re!="object")throw new o.LoggingError("Snapshot should be there to load from!!");const oe=re;fe=new l.LocalFluidDataStoreContext({id:se,pkg:void 0,parentContext:this.wrapContextForInnerChannel(se),storage:this.parentContext.storage,scope:this.parentContext.scope,createSummarizerNodeFn:this.parentContext.getCreateChildSummarizerNodeFn(se,{type:r.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(se),snapshotTree:oe})}else{let oe=re;(0,i.isInstanceOfISnapshot)(R)&&(oe={...R,snapshotTree:re}),fe=new l.RemoteFluidDataStoreContext({id:se,snapshot:oe,parentContext:this.wrapContextForInnerChannel(se),storage:this.parentContext.storage,scope:this.parentContext.scope,createSummarizerNodeFn:this.parentContext.getCreateChildSummarizerNodeFn(se,{type:r.CreateSummarizerNodeSource.FromSummary}),loadingGroupId:re.groupId})}this.contexts.addBoundOrRemoted(fe)}this.containerLoadStats={containerLoadDataStoreCount:G.size,referencedDataStoreCount:G.size-ee}}get aliases(){return this.aliasMap}get pendingAliases(){return this.pendingAliasMap}async waitIfPendingAlias(R){return this.pendingAliases.get(R)??"Success"}wrapContextForInnerChannel(R){return _(R,this.parentContext)}makeVisibleAndAttachGraph(){this.parentContext.makeLocallyVisible()}processAttachMessages(R){const{envelope:M,messagesContent:j,local:k}=R;for(const{contents:x}of j){const L=x,V=(0,s.processAttachMessageGCData)(L.snapshot??void 0,(fe,oe)=>{const pe=`/${L.id}${fe==="/"?"":fe}`;this.parentContext.addedGCOutboundRoute(pe,oe,M.timestamp)});if(this.shouldSendAttachLog&&(this.shouldSendAttachLog=!1,this.mc.logger.sendTelemetryEvent({eventName:"dataStoreAttachMessage_sampled",...(0,o.tagCodeArtifacts)({id:L.id,pkg:L.type}),details:{local:k,snapshot:!!L.snapshot,foundGCData:V},...(0,o.extractSafePropertiesFromMessage)(M)})),k){(0,a.assert)(this.pendingAttach.has(L.id),350),this.contexts.get(L.id)?.setAttachState(n.AttachState.Attached),this.pendingAttach.delete(L.id);continue}if(this.alreadyProcessed(L.id))throw new o.DataCorruptionError("Duplicate DataStore created with existing id",{...(0,o.extractSafePropertiesFromMessage)(M),...(0,o.tagCodeArtifacts)({dataStoreId:L.id})});const G=new Map;let ee;L.snapshot&&(ee=(0,i.buildSnapshotTree)(L.snapshot.entries,G),(0,i.isInstanceOfISnapshot)(this.baseSnapshot)&&(ee={...this.baseSnapshot,snapshotTree:ee}));const se=[L.type],re=new l.RemoteFluidDataStoreContext({id:L.id,snapshot:ee,parentContext:this.wrapContextForInnerChannel(L.id),storage:new m.StorageServiceWithAttachBlobs(this.parentContext.storage,G),scope:this.parentContext.scope,loadingGroupId:L.snapshot?.groupId,createSummarizerNodeFn:this.parentContext.getCreateChildSummarizerNodeFn(L.id,{type:r.CreateSummarizerNodeSource.FromAttach,sequenceNumber:M.sequenceNumber,snapshot:L.snapshot??{entries:[(0,l.createAttributesBlob)(se,!0)]}}),pkg:se});this.contexts.addBoundOrRemoted(re)}}processAliasMessages(R){const{envelope:M,messagesContent:j,local:k}=R;for(const{contents:x,localOpMetadata:L}of j){const V=x;if(!(0,d.isDataStoreAliasMessage)(V))throw new o.DataCorruptionError("malformedDataStoreAliasMessage",{...(0,o.extractSafePropertiesFromMessage)(M)});const G=L,ee=this.processAliasMessageCore(V.internalId,V.alias,M.timestamp);k&&G(ee)}}processAliasMessageCore(R,M,j){if(this.alreadyProcessed(M))return!1;const k=this.contexts.get(R);return this.checkAndLogIfDeleted(R,k,"Changed","processAliasMessageCore")?!1:k===void 0?(this.mc.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:R}),!1):(j&&this.parentContext.addedGCOutboundRoute("/",`/${R}`,j),this.aliasMap.set(M,k.id),this.aliasedDataStores.add(k.id),k.setInMemoryRoot(),!0)}alreadyProcessed(R){return this.aliasMap.get(R)!==void 0||this.contexts.get(R)!==void 0}generateAttachMessage(R){const M=R.getAttachSummary(),j=R.getAttachGCData();(0,s.addBlobToSummary)(M,r.gcDataBlobKey,JSON.stringify(j));const k=(0,s.convertSummaryTreeToITree)(M.summary);return{id:R.id,snapshot:k,type:S(R)}}makeDataStoreLocallyVisible(R){const M=this.contexts.getUnbound(R);(0,a.assert)(!!M,351),this.parentContext.attachState!==n.AttachState.Detached&&(this.submitAttachChannelOp(M),M.setAttachState(n.AttachState.Attaching)),this.contexts.bind(R)}submitAttachChannelOp(R){const M=this.generateAttachMessage(R);this.pendingAttach.set(R.id,M),this.parentContext.submitMessage(v.ContainerMessageType.Attach,M,void 0),this.attachOpFiredForDataStore.add(R.id)}createDataStoreId(){if(this.mc.config.getBoolean("Fluid.Runtime.DisableShortIds")===!0)return(0,u.v4)();{if(this.parentContext.attachState===n.AttachState.Detached)return(0,s.encodeCompactIdToString)(2*this.contexts.size);const R=this.parentContext.containerRuntime.generateDocumentUniqueId();return typeof R=="number"?(0,s.encodeCompactIdToString)(2*R+1):R}}createDetachedDataStore(R,M){return this.createContext(this.createDataStoreId(),R,l.LocalDetachedFluidDataStoreContext,M)}createDataStoreContext(R,M){return this.createContext(this.createDataStoreId(),R,l.LocalFluidDataStoreContext,M)}createContext(R,M,j,k){(0,a.assert)(k!=="",2420);const x=new j({id:R,pkg:M,parentContext:this.wrapContextForInnerChannel(R),storage:this.parentContext.storage,scope:this.parentContext.scope,createSummarizerNodeFn:this.parentContext.getCreateChildSummarizerNodeFn(R,{type:r.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(R),snapshotTree:void 0,loadingGroupId:k,channelToDataStoreFn:L=>(0,d.channelToDataStore)(L,R,this,(0,o.createChildLogger)({logger:this.parentContext.baseLogger}))});return this.contexts.addUnbound(x),x}get disposed(){return this.disposeOnce.evaluated}dispose(){return this.disposeOnce.value}reSubmit(R,M,j,k){switch(R){case v.ContainerMessageType.Attach:case v.ContainerMessageType.Alias:{this.parentContext.submitMessage(R,M,j);return}case v.ContainerMessageType.FluidDataStoreOp:return this.reSubmitChannelOp(R,M,j,k);default:(0,a.assert)(!1,2311)}}reSubmitChannelOp(R,M,j,k){const x=M,L=this.contexts.get(x.address);if(this.checkAndLogIfDeleted(x.address,L,"Changed","resubmitDataStoreOp"))throw new o.DataCorruptionError("Context is deleted!",{callSite:"resubmitDataStoreOp",...(0,o.tagCodeArtifacts)({id:x.address})});(0,a.assert)(!!L,352);const V=x.contents;L.reSubmit(V.type,V.content,j,k)}rollback(R,M,j){(0,a.assert)(R===v.ContainerMessageType.FluidDataStoreOp,2280);const k=M,x=this.contexts.get(k.address);if(this.checkAndLogIfDeleted(k.address,x,"Changed","rollbackDataStoreOp"))throw new o.DataCorruptionError("Context is deleted!",{callSite:"rollbackDataStoreOp",...(0,o.tagCodeArtifacts)({id:k.address})});(0,a.assert)(!!x,744);const L=k.contents;x.rollback(L.type,L.content,j)}async applyStashedOp(R){const M=R;switch(M.type){case v.ContainerMessageType.Attach:return this.applyStashedAttachOp(M.contents);case v.ContainerMessageType.Alias:return;case v.ContainerMessageType.FluidDataStoreOp:return this.applyStashedChannelChannelOp(M.contents);default:(0,a.assert)(!1,2312)}}async applyStashedChannelChannelOp(R){const M=this.contexts.get(R.address);if(!this.checkAndLogIfDeleted(R.address,M,"Changed","applyStashedOp"))return(0,a.assert)(!!M,353),M.applyStashedOp(R.contents)}async applyStashedAttachOp(R){const{id:M,snapshot:j}=R,k=new Map,x=(0,i.buildSnapshotTree)(j.entries,k),L=new m.StorageServiceWithAttachBlobs(this.parentContext.storage,k),V=new l.LocalFluidDataStoreContext({id:M,pkg:void 0,parentContext:this.wrapContextForInnerChannel(M),storage:L,scope:this.parentContext.scope,createSummarizerNodeFn:this.parentContext.getCreateChildSummarizerNodeFn(M,{type:r.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(M),snapshotTree:x});this.contexts.addBoundOrRemoted(V),await(await V.realize()).entryPoint.get(),this.parentContext.attachState!==n.AttachState.Detached&&this.pendingAttach.set(M,R)}processMessages(R){switch(R.envelope.type){case v.ContainerMessageType.FluidDataStoreOp:{this.processChannelMessages(R);break}case v.ContainerMessageType.Attach:{this.processAttachMessages(R);break}case v.ContainerMessageType.Alias:{this.processAliasMessages(R);break}default:(0,a.assert)(!1,2281)}}processChannelMessages(R){const{envelope:M,messagesContent:j,local:k}=R;let x,L=[];const V=()=>{if(x===void 0)return;const G=this.contexts.get(x.address);(0,a.assert)(!!G,2662),G.processMessages({envelope:{...M,type:x.type},messagesContent:L,local:k}),L=[]};for(const{contents:G,...ee}of j){const se=G,re=se.address,fe=this.contexts.get(re);if(this.checkAndLogIfDeleted(re,fe,"Changed","processFluidDataStoreOp"))continue;if(fe===void 0)throw o.DataProcessingError.create("No context for op","processFluidDataStoreOp",M,{local:k,messageDetails:JSON.stringify({type:M.type,contentType:typeof G}),...(0,o.tagCodeArtifacts)({address:re})});const{type:oe,content:pe}=se.contents;(x?.address!==re||x?.type!==oe)&&V(),L.push({contents:pe,...ee}),x={address:re,type:oe},this.gcNodeUpdated({node:{type:"DataStore",path:`/${re}`},reason:"Changed",timestampMs:M.timestamp,packagePath:fe.isLoaded?fe.packagePath:void 0}),O(re,pe,(de,ge)=>this.parentContext.addedGCOutboundRoute(de,ge,M.timestamp))}V()}async getDataStore(R,M,j){const k={...c.defaultRuntimeHeaderData,...M};if(this.checkAndLogIfDeleted(R,this.contexts.get(R),"Requested","getDataStore",M,j))throw(0,s.responseToException)((0,s.createResponseError)(404,"DataStore was deleted",j,{[c.DeletedResponseHeaderKey]:!0}),j);const x=await this.contexts.getBoundOrRemoted(R,k.wait);if(x===void 0){const L={url:R};throw(0,s.responseToException)((0,s.create404Response)(L),L)}return x}async getDataStoreIfAvailable(R,M){if(this.checkAndLogIfDeleted(R,this.contexts.get(R),"Requested","getDataStoreIfAvailable",M))return;const j={...c.defaultRuntimeHeaderData,...M},k=await this.contexts.getBoundOrRemoted(R,j.wait);if(k!==void 0)return k}checkAndLogIfDeleted(R,M,j,k,x,L){const V=`/${R}`;if(!this.isDataStoreDeleted(V))return!1;const G=L===void 0?V:(0,C.urlToGCNodePath)(L.url),ee=this.contexts.getRecentlyDeletedContext(R);return ee!==void 0&&ee.getInitialSnapshotDetails().then(se=>se.pkg.join("/")).then(se=>({pkg:se,error:void 0}),se=>({pkg:void 0,error:se})).then(({pkg:se,error:re})=>{this.mc.logger.sendTelemetryEvent({eventName:"GC_DeletedDataStore_PathInfo",...(0,o.tagCodeArtifacts)({id:G,pkg:se}),callSite:k},re)}).catch(()=>{}),this.mc.logger.sendErrorEvent({eventName:`GC_Deleted_DataStore_${j}`,...(0,o.tagCodeArtifacts)({id:G}),callSite:k,headers:JSON.stringify(x),exists:M!==void 0,details:{url:L?.url,headers:JSON.stringify(L?.headers),aliased:this.aliasedDataStores.has(R)}}),!0}processSignal(R,M){const j=R.content,k=j.address,x={...R,content:j.contents},L=this.contexts.get(k);if(!this.checkAndLogIfDeleted(k,L,"Changed","processSignal")){if(!L){(0,a.assert)(!M,355),this.mc.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",...(0,o.tagCodeArtifacts)({fluidDataStoreId:k})});return}L.processSignal(x,M)}}setConnectionState(R,M){for(const[j,k]of this.contexts)try{k.setConnectionState(R,M)}catch(x){this.mc.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:M,...(0,o.tagCodeArtifacts)({fluidDataStoreId:j}),details:JSON.stringify({runtimeConnected:this.parentContext.connected,canSendOps:R})},x)}}notifyReadOnlyState(R){for(const[M,j]of this.contexts)try{j.notifyReadOnlyState()}catch(k){this.mc.logger.sendErrorEvent({eventName:"SetReadOnlyStateError",...(0,o.tagCodeArtifacts)({fluidDataStoreId:M}),details:{runtimeReadonly:this.parentContext.isReadOnly(),readonly:R}},k)}}notifyStagingMode(R){for(const[M,j]of this.contexts)try{j.notifyStagingMode(R)}catch(k){this.mc.logger.sendErrorEvent({eventName:"notifyStagingModeError",...(0,o.tagCodeArtifacts)({fluidDataStoreId:M}),details:{staging:R}},k)}}setAttachState(R){for(const[,M]of this.contexts)this.contexts.isNotBound(M.id)||M.setAttachState(R)}get size(){return this.contexts.size}getAttachSummary(R){const M=new s.SummaryTreeBuilder;return this.visitLocalBoundContextsDuringAttach((j,k)=>{let x;k.isLoaded?x=k.getAttachSummary(R):((0,a.assert)(!!this.baseSnapshot,358),x=(0,s.convertSnapshotTreeToSummaryTree)((0,i.getSnapshotTree)(this.baseSnapshot).trees[j])),M.addWithStats(j,x)}),M.getSummaryTree()}getAttachGCData(R){const M=new s.GCDataBuilder;return this.visitLocalBoundContextsDuringAttach((j,k)=>{const x=k.getAttachGCData(R);M.prefixAndAddNodes(j,x.gcNodes)}),M.addNode("/",[...this.aliasedDataStores]),M.getGCData()}visitLocalBoundContextsDuringAttach(R){const M=new Set;let j=-1,k=-1;for(;j!==M.size&&k!==this.contexts.notBoundLength();){j=M.size,k=this.contexts.notBoundLength();for(const[x,L]of this.contexts)M.has(x)||this.contexts.isNotBound(x)||this.attachOpFiredForDataStore.has(x)||(R(x,L),M.add(x))}}async visitContextsDuringSummary(R,M){for(const[j,k]of this.contexts){if(k.attachState===n.AttachState.Attaching)throw o.DataProcessingError.create("Local data store detected in attaching state","summarize/getGCData");if(k.attachState===n.AttachState.Attached){const x=k.isLoaded,L=k.pendingCount;await R(j,k),!x&&k.isLoaded&&this.gcNodeUpdated({node:{type:"DataStore",path:`/${k.id}`},reason:"Realized",packagePath:k.packagePath,timestampMs:void 0,additionalProps:{trailingOpCount:L,...M}})}}}async summarize(R,M,j){const k=new s.SummaryTreeBuilder;return await this.visitContextsDuringSummary(async(x,L)=>{const V=await L.summarize(R,M,j);k.addWithStats(x,V)},{fullTree:R,realizedDuring:"summarize"}),k.getSummaryTree()}async getGCData(R=!1){const M=new s.GCDataBuilder;return await this.visitContextsDuringSummary(async(j,k)=>{const x=await k.getGCData(R);M.prefixAndAddNodes(j,x.gcNodes)},{fullGC:R,realizedDuring:"getGCData"}),M.addNode("/",await this.getOutboundRoutes()),M.getGCData()}updateUsedRoutes(R){const M=(0,s.unpackChildNodesUsedRoutes)(R);for(const[j]of M)(0,a.assert)(this.contexts.has(j),359);for(const[j,k]of this.contexts)k.updateUsedRoutes(M.get(j)??[])}deleteChild(R){const M=this.contexts.get(R);(0,a.assert)(M!==void 0,727),M.isLoaded&&this.mc.logger.sendTelemetryEvent({eventName:"GC_DeletingLoadedDataStore",...(0,o.tagCodeArtifacts)({id:`/${R}`,pkg:M.packagePath.join("/")}),details:{aliased:this.aliasedDataStores.has(R)}}),M.delete(),this.contexts.delete(R),this.parentContext.deleteChildSummarizerNode(R)}deleteSweepReadyNodes(R){for(const M of R){const j=M.split("/"),k=j[1];if(j.length>2)continue;if(this.contexts.get(k)===void 0){const L=this.isDataStoreDeleted(`/${k}`);this.mc.logger.sendTelemetryEvent({eventName:"DeletedDataStoreNotFound",category:L?"generic":"error",...(0,o.tagCodeArtifacts)({id:k}),details:{alreadyDeleted:L}});continue}this.deleteChild(k)}return[...R]}updateTombstonedRoutes(R){const M=new Set;for(const j of R){const k=j.split("/");if(k.length>2)continue;const x=k[1];(0,a.assert)(this.contexts.has(x),1296),M.add(x)}for(const[j,k]of this.contexts)k.setTombstone(M.has(j))}async getOutboundRoutes(){const R=[];for(const[M,j]of this.contexts)await j.isRoot(this.aliasedDataStores)&&R.push(`/${M}`);return R}async getDataStorePackagePath(R){return(await this.contexts.get(R.split("/")[1])?.getInitialSnapshotDetails())?.pkg}getGCNodeType(R){const M=R.split("/");if(this.contexts.has(M[1]))return M.length===2?C.GCNodeType.DataStore:C.GCNodeType.SubDataStore}internalId(R){return this.aliases.get(R)??R}async request(R){const M=s.RequestParser.create(R),j=M.pathParts[0],k=M.pathParts.length>1,x={};typeof R.headers?.[s.RuntimeHeaders.wait]=="boolean"&&(x.wait=R.headers[s.RuntimeHeaders.wait]),typeof R.headers?.[s.RuntimeHeaders.viaHandle]=="boolean"&&(x.viaHandle=R.headers[s.RuntimeHeaders.viaHandle]),typeof R.headers?.[e.AllowTombstoneRequestHeaderKey]=="boolean"&&(x.allowTombstone=R.headers[e.AllowTombstoneRequestHeaderKey]),k&&(x.allowTombstone=!0),await this.waitIfPendingAlias(j);const L=this.internalId(j),V=await this.getDataStore(L,x,R),G=await V.getInitialSnapshotDetails();this.gcNodeUpdated({node:{type:"DataStore",path:`/${j}`},reason:"Loaded",packagePath:G.pkg,request:R,headerData:x,timestampMs:void 0});const ee=await V.realize(),se=M.createSubRequest(1);return(0,a.assert)(se.url.startsWith("/"),294),ee.request(se)}}e.ChannelCollection=p;function w(F,R){if(F)if((0,h.rootHasIsolatedChannels)(R)){const M=F.trees[r.channelsTreeName];return(0,a.assert)(!!M,360),M}else{const M={};for(const[j,k]of Object.entries(F.trees))h.nonDataStorePaths.includes(j)||(M[j]=k);return{...F,trees:M}}}e.getSummaryForDatastores=w;function O(F,R,M){const j=[];let k;function x(V){if(typeof V=="object"&&V!==null)for(const[G,ee]of Object.entries(V))(0,s.isSerializedHandle)(ee)&&j.push(ee.url),G==="address"&&k===void 0&&(k=ee),x(ee)}x(R);const L=["",F,k].join("/");for(const V of j)M(L,V)}e.detectOutboundReferences=O;class E{constructor(R,M){this.provideEntryPoint=M,this.type="ChannelCollectionChannel",this.IFluidDataStoreRegistry=new b.FluidDataStoreRegistry(R)}get IFluidDataStoreFactory(){return this}async instantiateDataStore(R,M){return(0,a.assert)(R instanceof l.FluidDataStoreContext,2959),new p(R.baseSnapshot,R,R.baseLogger,()=>{},k=>!1,new Map,this.provideEntryPoint)}}e.ChannelCollectionFactory=E})(Pj)),Pj}var gu={},V5;function dT(){if(V5)return gu;V5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(gu,"__esModule",{value:!0}),gu.enabledCompressionConfig=gu.disabledCompressionConfig=gu.CompressionAlgorithms=void 0;var e;return(function(n){n.lz4="lz4"})(e||(gu.CompressionAlgorithms=e={})),gu.disabledCompressionConfig={minimumBatchSizeInBytes:Number.POSITIVE_INFINITY,compressionAlgorithm:e.lz4},gu.enabledCompressionConfig={minimumBatchSizeInBytes:614400,compressionAlgorithm:e.lz4},gu}var xj={},H5;function pye(){return H5||(H5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ReportOpPerfTelemetry=e.latencyThreshold=void 0;const n=Ht(),a=Je(),t=on(),i=Kn(),r=Ot();e.latencyThreshold=5e3;class s{constructor(c,d,l,f){this.clientId=c,this.deltaManager=d,this.msnTrackingTimestamp=0,this.latencyStatistics=new Map,this.firstConnection=!0,this.bootTime=(0,n.performanceNow)(),this.connectionStartTime=0,this.gap=0,this.noOpCountForTelemetry=0,this.processedOpSizeForTelemetry=0,this.logger=(0,r.createChildLogger)({logger:f,namespace:"OpPerf"});const b=(()=>{let v=-1;return{sample:()=>{v++;const m=v%s.DELTA_LATENCY_SAMPLE_RATE===0;return m&&(v=0),m}}})();this.deltaLatencyLogger=(0,r.createSampledLogger)(f,b),this.opLatencyLogger=(0,r.createSampledLogger)(f);const C=(()=>{let v=0;return{sample:()=>{v++;const m=v%s.PROCESSED_OPS_SAMPLE_RATE===0;return m&&(v=0,this.noOpCountForTelemetry=0,this.processedOpSizeForTelemetry=0),m}}})();this.opsLogger=(0,r.createSampledLogger)(f,C,!0),this.deltaManager.on("pong",v=>this.recordPingTime(v)),this.deltaManager.on("submitOp",v=>this.beforeOpSubmit(v)),this.deltaManager.on("op",v=>this.afterProcessingOp(v)),this.deltaManager.on("connect",(v,m)=>{m!==void 0&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=m,this.connectionStartTime=(0,n.performanceNow)(),this.gap<=0&&this.reportGettingUpToDate())}),this.deltaManager.on("disconnect",()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.latencyStatistics.clear()}),this.deltaManager.outbound.on("push",v=>{for(const m of v)if(m.type===t.MessageType.Operation&&(this.opLatencyLogger.isSamplingDisabled||this.clientSequenceNumberForLatencyStatistics===m.clientSequenceNumber)){const h=this.latencyStatistics.get(m.clientSequenceNumber);(0,a.assert)(h!==void 0,1986),(0,a.assert)(h.opProcessingTimes.outboundPushEventTime===void 0,712),(0,a.assert)(h.opPerfData.durationNetwork===void 0,713),h.opProcessingTimes.outboundPushEventTime=Date.now(),(0,a.assert)(h.opPerfData.durationOutboundBatching===void 0,714),(0,a.assert)(h.opProcessingTimes.submitOpEventTime!==void 0,715),h.opPerfData.durationOutboundBatching=h.opProcessingTimes.outboundPushEventTime-h.opProcessingTimes.submitOpEventTime}}),this.deltaManager.inbound.on("push",v=>{if(this.clientId===v.clientId&&v.type===t.MessageType.Operation&&(this.opLatencyLogger.isSamplingDisabled||this.clientSequenceNumberForLatencyStatistics===v.clientSequenceNumber)){const m=this.latencyStatistics.get(v.clientSequenceNumber);(0,a.assert)(m!==void 0,1987),m.opProcessingTimes.outboundPushEventTime!==void 0&&(m.opProcessingTimes.inboundPushEventTime=Date.now(),m.opPerfData.durationNetwork=m.opProcessingTimes.inboundPushEventTime-m.opProcessingTimes.outboundPushEventTime,m.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)}(0,i.isRuntimeMessage)(v)&&typeof v.contents=="string"&&(this.processedOpSizeForTelemetry+=v.contents.length)}),this.deltaManager.inbound.on("idle",(v,m)=>{typeof v=="number"&&v>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:v,duration:m})}),l.on("connected",v=>{this.clientId=v})}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:(0,n.performanceNow)()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?(0,r.formatTick)(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(c){this.pingLatency=c,c>1e3*60&&this.logger.sendErrorEvent({eventName:"LatencyTooLong",duration:c}),this.deltaManager.active&&this.deltaLatencyLogger.sendPerformanceEvent({eventName:"DeltaLatency",duration:c})}beforeOpSubmit(c){(this.opLatencyLogger.isSamplingDisabled||this.clientSequenceNumberForLatencyStatistics===void 0&&c.clientSequenceNumber%s.OP_LATENCY_SAMPLE_RATE===1)&&((0,a.assert)(this.latencyStatistics.get(c.clientSequenceNumber)===void 0,1988),this.clientSequenceNumberForLatencyStatistics=c.clientSequenceNumber,this.latencyStatistics.set(c.clientSequenceNumber,{opProcessingTimes:{submitOpEventTime:Date.now()},opPerfData:{}})),c.type===t.MessageType.NoOp&&this.noOpCountForTelemetry++}afterProcessingOp(c){const d=c.sequenceNumber;if(d===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),this.sequenceNumberForMsnTracking===void 0&&d%1e3===0&&(this.sequenceNumberForMsnTracking=d,this.msnTrackingTimestamp=c.timestamp),this.sequenceNumberForMsnTracking!==void 0&&c.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&((0,a.assert)(this.msnTrackingTimestamp!==void 0,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:d,msnDistance:d-this.sequenceNumberForMsnTracking,duration:c.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===c.clientId&&c.type===t.MessageType.Operation&&(this.opLatencyLogger.isSamplingDisabled||this.clientSequenceNumberForLatencyStatistics===c.clientSequenceNumber)){const l=this.latencyStatistics.get(c.clientSequenceNumber);(0,a.assert)(l!==void 0,1989),(0,a.assert)(l.opProcessingTimes.submitOpEventTime!==void 0,288);const f=Date.now();l.opProcessingTimes.inboundPushEventTime!==void 0&&(l.opPerfData.durationInboundToProcessing=f-l.opProcessingTimes.inboundPushEventTime);const b=f-l.opProcessingTimes.submitOpEventTime,C=b>e.latencyThreshold?"error":"performance";this.opLatencyLogger.sendPerformanceEvent({eventName:"OpRoundtripTime",sequenceNumber:d,referenceSequenceNumber:c.referenceSequenceNumber,duration:b,category:C,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber,...l.opPerfData}),this.clientSequenceNumberForLatencyStatistics=void 0,this.latencyStatistics.delete(c.clientSequenceNumber)}(0,i.isRuntimeMessage)(c)&&this.opsLogger.sendPerformanceEvent({eventName:"OpStats",details:{processedOpCount:s.PROCESSED_OPS_SAMPLE_RATE,processedOpSize:this.processedOpSizeForTelemetry,submitedNoOpCount:this.noOpCountForTelemetry}})}}s.OP_LATENCY_SAMPLE_RATE=500,s.DELTA_LATENCY_SAMPLE_RATE=100,s.PROCESSED_OPS_SAMPLE_RATE=500;function o(u,c,d,l){new s(u,c,d,(0,r.createChildLogger)({logger:l}))}e.ReportOpPerfTelemetry=o})(xj)),xj}var Vf={},K5;function gye(){if(K5)return Vf;K5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Vf,"__esModule",{value:!0}),Vf.validateRuntimeOptions=Vf.getMinVersionForCollabDefaults=void 0;const e=ja(),n=bn(),a=dT(),t={enableGroupedBatching:{"1.0.0":!1,"2.0.0-defaults":!0},compressionOptions:{"1.0.0":a.disabledCompressionConfig,"2.0.0-defaults":a.enabledCompressionConfig},enableRuntimeIdCompressor:{"1.0.0":void 0},explicitSchemaControl:{"1.0.0":!1,"2.0.0":!0},flushMode:{"1.0.0":e.FlushMode.Immediate,"2.0.0-defaults":e.FlushMode.TurnBased},gcOptions:{"1.0.0":{},"3.0.0":{enableGCSweep:!0}},createBlobPayloadPending:{"1.0.0":void 0}},i={enableGroupedBatching:(0,n.configValueToMinVersionForCollab)([[!1,"1.0.0"],[!0,"2.0.0-defaults"]]),compressionOptions:(0,n.configValueToMinVersionForCollab)([[{...a.disabledCompressionConfig},"1.0.0"],[{...a.enabledCompressionConfig},"2.0.0-defaults"]]),enableRuntimeIdCompressor:(0,n.configValueToMinVersionForCollab)([[void 0,"1.0.0"],["on","2.0.0-defaults"],["delayed","2.0.0-defaults"]]),explicitSchemaControl:(0,n.configValueToMinVersionForCollab)([[!1,"1.0.0"],[!0,"2.0.0-defaults"]]),flushMode:(0,n.configValueToMinVersionForCollab)([[e.FlushMode.Immediate,"1.0.0"],[e.FlushMode.TurnBased,"2.0.0-defaults"]]),gcOptions:(0,n.configValueToMinVersionForCollab)([[{enableGCSweep:void 0},"1.0.0"],[{enableGCSweep:!0},"2.0.0-defaults"]]),createBlobPayloadPending:(0,n.configValueToMinVersionForCollab)([[void 0,"1.0.0"],[!0,"2.40.0"]])};function r(o){return(0,n.getConfigsForMinVersionForCollab)(o,t)}Vf.getMinVersionForCollabDefaults=r;function s(o,u){(0,n.getValidationForRuntimeOptions)(o,u,i)}return Vf.validateRuntimeOptions=s,Vf}var tS={},$5;function yye(){if($5)return tS;$5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(tS,"__esModule",{value:!0}),tS.ContainerFluidHandleContext=void 0;const e=Mr(),n=bn();class a{get IFluidHandleContext(){return this}constructor(i,r,s){this.path=i,this.runtime=r,this.routeContext=s,this.absolutePath=(0,n.generateHandleContextPath)(i,this.routeContext)}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==e.AttachState.Detached}async resolveHandle(i){return this.runtime.resolveHandle(i)}}return tS.ContainerFluidHandleContext=a,tS}var nS={},G5;function bye(){if(G5)return nS;G5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(nS,"__esModule",{value:!0}),nS.DeltaScheduler=void 0;const e=Ht(),n=Ot();class a{constructor(i,r,s){this.deltaManager=i,this.runtimeEventsEmitter=r,this.logger=s,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=a.processingTime,this.schedulingCount=0,this.batchBegin=o=>{this.processingStartTime||(this.processingStartTime=(0,e.performanceNow)()),this.schedulingLog===void 0&&this.schedulingCount%500===0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:o.sequenceNumber,lastSequenceNumber:o.sequenceNumber,startTime:(0,e.performanceNow)()})},this.batchEnd=(o,u)=>{if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=u.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const c=(0,e.performanceNow)(),d=c-this.processingStartTime;d>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=d),setTimeout(()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:(0,n.formatTick)(d),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:(0,n.formatTick)(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:(0,n.formatTick)((0,e.performanceNow)()-c)}),this.deltaManager.inbound.resume()}),this.processingStartTime=void 0)}},this.inboundQueueIdle=()=>{if(this.schedulingLog){const o=(0,e.performanceNow)();this.schedulingLog.totalProcessingTime+=o-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:(0,n.formatTick)(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:(0,n.formatTick)(o-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=a.processingTime},this.deltaManager.inbound.on("idle",this.inboundQueueIdle),r.on("batchBegin",this.batchBegin),r.on("batchEnd",this.batchEnd)}dispose(){this.deltaManager.inbound.off("idle",this.inboundQueueIdle),this.runtimeEventsEmitter.off("batchBegin",this.batchBegin),this.runtimeEventsEmitter.off("batchEnd",this.batchEnd)}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}return nS.DeltaScheduler=a,a.processingTime=50,nS}var rS={},W5;function vye(){if(W5)return rS;W5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(rS,"__esModule",{value:!0}),rS.InboundBatchAggregator=void 0;const e=Ht(),n=Je(),a=Kn(),t=Ot(),i=TE();class r{constructor(o,u,c){this.deltaManager=o,this.getClientId=u,this.logger=c,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.afterOpProcessing=l=>{if((0,n.assert)(!this.localPaused,660),this.deltaManager.inbound.length===0){(0,n.assert)(this.pauseSequenceNumber===void 0,661);return}if(this.pauseSequenceNumber!==void 0){if(l.sequenceNumber>=this.pauseSequenceNumber)throw t.DataProcessingError.create("Incomplete batch","InboundBatchAggregator",l,{type:l.type,contentType:typeof l.contents,batch:l.metadata?.batch,compression:l.compression,pauseSeqNum:this.pauseSequenceNumber});l.sequenceNumber+1===this.pauseSequenceNumber&&this.pauseQueue()}},this.trackPending=l=>{(0,n.assert)(this.deltaManager.inbound.length>0,664),(0,n.assert)(this.currentBatchClientId===void 0==(this.pauseSequenceNumber===void 0),665);const b=l.metadata?.batch;if(!(0,a.isRuntimeMessage)(l)){if(this.currentBatchClientId!==void 0)throw t.DataProcessingError.create("Received a system message during batch processing","trackPending",l,{runtimeVersion:i.pkgVersion,batchClientId:this.currentBatchClientId===null?"null":this.currentBatchClientId,pauseSequenceNumber:this.pauseSequenceNumber,localBatch:this.currentBatchClientId===this.getClientId(),messageType:l.type});(0,n.assert)(b===void 0,667),(0,n.assert)(!this.localPaused,668);return}if(this.currentBatchClientId===void 0&&b===void 0){(0,n.assert)(!this.localPaused,669);return}if(this.currentBatchClientId!==void 0&&this.currentBatchClientId!==l.clientId)throw new t.DataCorruptionError("OpBatchIncomplete",{runtimeVersion:i.pkgVersion,batchClientId:this.currentBatchClientId===null?"null":this.currentBatchClientId,pauseSequenceNumber:this.pauseSequenceNumber,localBatch:this.currentBatchClientId===this.getClientId(),localMessage:l.clientId===this.getClientId(),...(0,t.extractSafePropertiesFromMessage)(l)});b?((0,n.assert)(this.currentBatchClientId===void 0,670),(0,n.assert)(!this.localPaused,671),this.pauseSequenceNumber=l.sequenceNumber,this.currentBatchClientId=l.clientId,this.deltaManager.inbound.length===1&&this.pauseQueue()):b===!1?((0,n.assert)(this.pauseSequenceNumber!==void 0,672),this.resumeQueue(this.pauseSequenceNumber,l),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):(0,n.assert)(this.currentBatchClientId!==void 0,673)},this.deltaManager.inbound.on("push",this.trackPending);const d=this.deltaManager.inbound.toArray();for(const l of d)this.trackPending(l);this.deltaManager.on("op",this.afterOpProcessing)}dispose(){this.deltaManager.off("op",this.afterOpProcessing),this.deltaManager.inbound.off("push",this.trackPending)}pauseQueue(){(0,n.assert)(!this.localPaused,663),this.localPaused=!0,this.timePaused=(0,e.performanceNow)(),this.deltaManager.inbound.pause()}resumeQueue(o,u){const c=u.sequenceNumber,d=this.localPaused?(0,e.performanceNow)()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3===1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:c,length:c-o+1,msnDistance:c-u.minimumSequenceNumber,duration:d,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,this.deltaManager.inbound.resume())}}return rS.InboundBatchAggregator=r,rS}var qj={},Lj={},Hf={},J5;function Ox(){if(J5)return Hf;J5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Hf,"__esModule",{value:!0}),Hf.serializeOp=Hf.ensureContentsDeserialized=void 0;const e=bn();function n(t){typeof t.contents=="string"&&t.contents!==""&&(t.contents=JSON.parse(t.contents))}Hf.ensureContentsDeserialized=n;function a(t){return JSON.stringify(t,(i,r)=>(0,e.isFluidHandle)(r)?(0,e.encodeHandleForSerialization)((0,e.toFluidHandleInternal)(r)):r)}return Hf.serializeOp=a,Hf}var Q5;function Px(){return Q5||(Q5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.sequenceNumbersMatch=e.addBatchMetadata=e.BatchManager=e.getEffectiveBatchId=e.generateBatchId=void 0;const n=Je(),a=Ot(),t=lT(),i=vE(),r=Ox();function s(l,f){return`${l}_[${f}]`}e.generateBatchId=s;function o(l){if("localOpMetadata"in l){const b=l;return(0,i.asBatchMetadata)(b.opMetadata)?.batchId??s(b.batchInfo.clientId,b.batchInfo.batchStartCsn)}const f=l;return f.batchId??s(f.clientId,f.batchStartCsn)}e.getEffectiveBatchId=o;class u{get length(){return this.pendingBatch.length}get sequenceNumbers(){return{referenceSequenceNumber:this.referenceSequenceNumber,clientSequenceNumber:this.clientSequenceNumber}}get referenceSequenceNumber(){return this.pendingBatch.length===0?void 0:this.pendingBatch[this.pendingBatch.length-1].referenceSequenceNumber}constructor(f){this.options=f,this.pendingBatch=[],this.hasReentrantOps=!1}push(f,b,C){this.hasReentrantOps=this.hasReentrantOps||b,this.pendingBatch.length===0&&(this.clientSequenceNumber=C),this.pendingBatch.push(f)}get empty(){return this.pendingBatch.length===0}popBatch(f){(0,n.assert)(this.pendingBatch[0]!==void 0,2954);const b={messages:this.pendingBatch,referenceSequenceNumber:this.referenceSequenceNumber,hasReentrantOps:this.hasReentrantOps,staged:this.pendingBatch[0].staged};return this.pendingBatch=[],this.clientSequenceNumber=void 0,this.hasReentrantOps=!1,(0,e.addBatchMetadata)(b,f)}checkpoint(){const f=this.clientSequenceNumber,b=this.pendingBatch.length;return{rollback:C=>{this.clientSequenceNumber=f;const v=this.pendingBatch.splice(b).reverse();for(const h of v)C(h);const m=this.pendingBatch.length-b;if(m!==0)throw new a.LoggingError("Ops generated during rollback",{count:m,...(0,a.tagData)(a.TelemetryDataTag.UserData,{ops:(0,r.serializeOp)(this.pendingBatch.slice(b).map(h=>h.runtimeOp))})})}}}containsUserChanges(){return this.pendingBatch.some(f=>(0,t.isContainerMessageDirtyable)(f.runtimeOp))}}e.BatchManager=u;const c=(l,f)=>{const b=l.messages.length-1,C=l.messages[0],v=l.messages[b];(0,n.assert)(C!==void 0&&v!==void 0,2513);const m=C.metadata??{},h=v.metadata??{};return l.messages.length>1&&(m.batch=!0,h.batch=!1,C.metadata=m,v.metadata=h),f!==void 0&&(m.batchId=f,C.metadata=m),l};e.addBatchMetadata=c;const d=(l,f)=>(l.referenceSequenceNumber===void 0||f.referenceSequenceNumber===void 0||l.referenceSequenceNumber===f.referenceSequenceNumber)&&(l.clientSequenceNumber===void 0||f.clientSequenceNumber===void 0||l.clientSequenceNumber===f.clientSequenceNumber);e.sequenceNumbersMatch=d})(Lj)),Lj}var iS={},Y5;function Sye(){if(Y5)return iS;Y5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(iS,"__esModule",{value:!0}),iS.DuplicateBatchDetector=void 0;const e=Je(),n=Px();class a{constructor(i){if(this.batchIdsAll=new Set,this.batchIdsBySeqNum=new Map,i){this.batchIdsBySeqNum=new Map(i);for(const r of this.batchIdsBySeqNum.values())this.batchIdsAll.add(r)}}processInboundBatch(i){const{sequenceNumber:r,minimumSequenceNumber:s}=i.keyMessage;this.clearOldBatchIds(s);const o=(0,n.getEffectiveBatchId)(i);if(this.batchIdsAll.has(o)){for(const[u,c]of this.batchIdsBySeqNum.entries())if(c===o)return{duplicate:!0,otherSequenceNumber:u};(0,e.assert)(!1,2612)}return(0,e.assert)(!this.batchIdsBySeqNum.has(r),2613),this.batchIdsBySeqNum.set(r,o),this.batchIdsAll.add(o),{duplicate:!1}}clearOldBatchIds(i){for(const[r,s]of this.batchIdsBySeqNum)r<i&&(this.batchIdsBySeqNum.delete(r),this.batchIdsAll.delete(s))}getRecentBatchInfoForSummary(i){if(this.batchIdsBySeqNum.size!==0)return i?.set("fluid_DuplicateBatchDetector_","recentBatchCount",this.batchIdsBySeqNum.size),[...this.batchIdsBySeqNum.entries()]}}return iS.DuplicateBatchDetector=a,iS}var Bj={},X5;function Ex(){return X5||(X5=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.Outbox=e.estimateSocketSize=e.localBatchToOutboundBatch=e.getLongStack=void 0;const n=Je(),a=Ot(),t=Px(),i=Ox();function r(d,l=50){const f=Error;if((Object.getOwnPropertyDescriptor(f,"stackTraceLimit")||Object.getOwnPropertyDescriptor(Object.getPrototypeOf(f),"stackTraceLimit"))?.writable!==!0)return d();const b=f.stackTraceLimit;try{return f.stackTraceLimit=l,d()}finally{f.stackTraceLimit=b}}e.getLongStack=r;function s({staged:d,...l}){const f=l.messages.map(({runtimeOp:v,...m})=>({contents:(0,i.serializeOp)(v),...m})),b=f.reduce((v,m)=>v+(m.contents?.length??0),0);return{...l,messages:f,contentSizeInBytes:b}}e.localBatchToOutboundBatch=s;const o=200,u=d=>d.contentSizeInBytes+o*d.messages.length;e.estimateSocketSize=u;class c{constructor(l){this.params=l,this.batchRebasesToReport=5,this.rebasing=!1,this.maxMismatchedOpsToReport=3,this.mismatchedOpsReported=0,this.logger=(0,a.createChildLogger)({logger:l.logger,namespace:"Outbox"}),this.mainBatch=new t.BatchManager({canRebase:!0}),this.blobAttachBatch=new t.BatchManager({canRebase:!0}),this.idAllocationBatch=new t.BatchManager({canRebase:!1,ignoreBatchId:!0})}get messageCount(){return this.mainBatch.length+this.blobAttachBatch.length+this.idAllocationBatch.length}get mainBatchMessageCount(){return this.mainBatch.length}get blobAttachBatchMessageCount(){return this.blobAttachBatch.length}get idAllocationBatchMessageCount(){return this.idAllocationBatch.length}get isEmpty(){return this.messageCount===0}containsUserChanges(){return this.mainBatch.containsUserChanges()||this.blobAttachBatch.containsUserChanges()}maybeFlushPartialBatch(){const l=this.mainBatch.sequenceNumbers,f=this.blobAttachBatch.sequenceNumbers,b=this.idAllocationBatch.sequenceNumbers;(0,n.assert)((0,t.sequenceNumbersMatch)(l,f)&&(0,t.sequenceNumbersMatch)(l,b),1421);const C=this.params.getCurrentSequenceNumbers();if((0,t.sequenceNumbersMatch)(l,C)&&(0,t.sequenceNumbersMatch)(f,C)&&(0,t.sequenceNumbersMatch)(b,C))return;const v=this.isContextReentrant(),m=new n.Lazy(()=>r(()=>a.DataProcessingError.create("Sequence numbers advanced as if ops were processed while a batch is accumulating","outboxSequenceNumberCoherencyCheck")));if(++this.mismatchedOpsReported<=this.maxMismatchedOpsToReport&&this.logger.sendTelemetryEvent({category:v||this.params.config.flushPartialBatches?"generic":"error",eventName:"ReferenceSequenceNumberMismatch",details:{expectedDueToReentrancy:v,mainReferenceSequenceNumber:l.referenceSequenceNumber,mainClientSequenceNumber:l.clientSequenceNumber,blobAttachReferenceSequenceNumber:f.referenceSequenceNumber,blobAttachClientSequenceNumber:f.clientSequenceNumber,currentReferenceSequenceNumber:C.referenceSequenceNumber,currentClientSequenceNumber:C.clientSequenceNumber}},m.value),this.params.config.flushPartialBatches){this.flushAll();return}if(!v)throw m.value}submit(l){this.maybeFlushPartialBatch(),this.addMessageToBatchManager(this.mainBatch,l)}submitBlobAttach(l){this.maybeFlushPartialBatch(),this.addMessageToBatchManager(this.blobAttachBatch,l)}submitIdAllocation(l){this.maybeFlushPartialBatch(),this.addMessageToBatchManager(this.idAllocationBatch,l)}addMessageToBatchManager(l,f){l.push(f,this.isContextReentrant(),this.params.getCurrentSequenceNumbers().clientSequenceNumber)}flush(l){(0,n.assert)(!this.isContextReentrant(),2939),this.flushAll(l)}flushAll(l){if(this.idAllocationBatch.empty&&this.blobAttachBatch.empty&&this.mainBatch.empty){l?.batchId!==void 0&&this.flushEmptyBatch(l.batchId,l.staged);return}this.flushInternal({batchManager:this.idAllocationBatch}),this.flushInternal({batchManager:this.blobAttachBatch,disableGroupedBatching:!0,resubmitInfo:l}),this.flushInternal({batchManager:this.mainBatch,resubmitInfo:l})}flushEmptyBatch(l,f){const b=this.params.getCurrentSequenceNumbers().referenceSequenceNumber;(0,n.assert)(b!==void 0,2561);const{outboundBatch:C,placeholderMessage:v}=this.params.groupingManager.createEmptyGroupedBatch(l,b);let m;this.params.shouldSend()&&!f&&(m=this.sendBatch(C)),this.params.pendingStateManager.onFlushEmptyBatch(v,m,f)}flushInternal(l){const{batchManager:f,disableGroupedBatching:b=!1,resubmitInfo:C}=l;if(f.empty)return;const v=f.popBatch(C?.batchId),m=v.staged===!0;(0,n.assert)(C===void 0||C.staged===m,2979);const h=!b&&this.params.groupingManager.groupedBatchingEnabled();if(f.options.canRebase&&v.hasReentrantOps===!0&&h){(0,n.assert)(!this.rebasing,1786),this.rebase(v,f);return}let g;if(this.params.shouldSend()&&!m){const _=this.virtualizeBatch(v,h);g=this.sendBatch(_),(0,n.assert)(g===void 0||g>=0,2514)}this.params.pendingStateManager.onFlushBatch(v.messages,g,m,f.options.ignoreBatchId)}rebase(l,f){(0,n.assert)(!this.rebasing,1787),(0,n.assert)(f.options.canRebase,2471),this.rebasing=!0;const b=!1;for(const C of l.messages)this.params.reSubmit({runtimeOp:C.runtimeOp,localOpMetadata:C.localOpMetadata,opMetadata:C.metadata},b);this.batchRebasesToReport>0&&(this.logger.sendTelemetryEvent({eventName:"BatchRebase",length:l.messages.length,referenceSequenceNumber:l.referenceSequenceNumber},new a.UsageError("BatchRebase")),this.batchRebasesToReport--),this.flushInternal({batchManager:f}),this.rebasing=!1}isContextReentrant(){return this.params.opReentrancy()&&!this.rebasing}virtualizeBatch(l,f){const b=s(l),C=f?this.params.groupingManager.groupBatch(b):b;if(C.messages.length!==1)return C;const v=C;if(this.params.config.compressionOptions.minimumBatchSizeInBytes>v.contentSizeInBytes||this.params.submitBatchFn===void 0)return v;const m=this.params.compressor.compressBatch(v);if(this.params.splitter.isBatchChunkingEnabled)return m.contentSizeInBytes<=this.params.splitter.chunkSizeInBytes?m:this.params.splitter.splitSingletonBatchMessage(m);if(m.contentSizeInBytes>=this.params.config.maxBatchSizeInBytes)throw this.makeBatchTooLargeError(m,"CompressionInsufficient",{uncompressedSizeInBytes:v.contentSizeInBytes});return m}sendBatch(l){const f=l.messages.length;if(f===0)return;if((0,e.estimateSocketSize)(l)>=this.params.config.maxBatchSizeInBytes)throw this.makeBatchTooLargeError(l,"CannotSend");let C;return this.params.submitBatchFn===void 0?((0,n.assert)(l.messages[0].compression===void 0,1446),C=this.params.legacySendBatchFn(l)):((0,n.assert)(l.referenceSequenceNumber!==void 0,1422),C=this.params.submitBatchFn(l.messages.map(v=>({contents:v.contents,metadata:v.metadata,compression:v.compression,referenceSequenceNumber:v.referenceSequenceNumber})),l.referenceSequenceNumber)),C-=f-1,(0,n.assert)(C>=0,976),C}makeBatchTooLargeError(l,f,b){return a.DataProcessingError.create("BatchTooLarge",f,void 0,{errorDetails:{opCount:l.messages.length,contentSizeInBytes:l.contentSizeInBytes,socketSize:(0,e.estimateSocketSize)(l),maxBatchSizeInBytes:this.params.config.maxBatchSizeInBytes,groupedBatchingEnabled:this.params.groupingManager.groupedBatchingEnabled(),compressionOptions:JSON.stringify(this.params.config.compressionOptions),chunkingEnabled:this.params.splitter.isBatchChunkingEnabled,chunkSizeInBytes:this.params.splitter.chunkSizeInBytes,...b}})}getBatchCheckpoints(){return{mainBatch:this.mainBatch.checkpoint(),idAllocationBatch:this.idAllocationBatch.checkpoint(),blobAttachBatch:this.blobAttachBatch.checkpoint()}}}e.Outbox=c})(Bj)),Bj}var sS={},Z5;function Cye(){if(Z5)return sS;Z5=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(sS,"__esModule",{value:!0}),sS.OpCompressor=void 0;const e=Ht(),n=Je(),a=Ot(),t=rx(),i=dT(),r=Ex();class s{constructor(u){this.logger=(0,a.createChildLogger)({logger:u,namespace:"OpCompressor"})}compressBatch(u){(0,n.assert)(u.contentSizeInBytes>0&&u.messages.length===1,1444);const c=Date.now(),d=new TextEncoder().encode(this.serializeBatchContents(u)),l=(0,t.compress)(d),f=e.IsoBuffer.from(l).toString("base64"),b=Date.now()-c,C=[{...u.messages[0],contents:JSON.stringify({packedContents:f}),metadata:u.messages[0].metadata,compression:i.CompressionAlgorithms.lz4}],v={contentSizeInBytes:f.length,messages:C,referenceSequenceNumber:u.referenceSequenceNumber};return u.contentSizeInBytes>2e5&&this.logger.sendPerformanceEvent({eventName:"CompressedBatch",duration:b,sizeBeforeCompression:u.contentSizeInBytes,sizeAfterCompression:v.contentSizeInBytes,opCount:v.messages.length,socketSize:(0,r.estimateSocketSize)(v)}),v}serializeBatchContents(u){const[c,...d]=u.messages;(0,n.assert)(d.length===0,2936);try{return`[${c.contents}]`}catch(l){if(l.message==="Invalid string length"){const f=a.DataProcessingError.create("Payload too large","OpCompressor");throw this.logger.sendErrorEvent({eventName:"BatchTooLarge",size:u.contentSizeInBytes,length:u.messages.length},f),f}throw l}}}return sS.OpCompressor=s,sS}var aS={},e8;function _ye(){if(e8)return aS;e8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(aS,"__esModule",{value:!0}),aS.OpDecompressor=void 0;const e=Ht(),n=Je(),a=Ot(),t=rx(),i=dT();class r{constructor(u){this.activeBatch=!1,this.processedCount=0,this.isSingleMessageBatch=!1,this.logger=(0,a.createChildLogger)({logger:u,namespace:"OpDecompressor"})}isCompressedMessage(u){if(u.compression===i.CompressionAlgorithms.lz4)return!0;try{if(u.contents!==null&&typeof u.contents=="object"&&Object.keys(u.contents).length===1&&typeof u.contents.packedContents=="string"&&u.contents.packedContents.length>0&&e.IsoBuffer.from(u.contents.packedContents,"base64").toString("base64")===u.contents.packedContents)return this.logger.sendTelemetryEvent({eventName:"LegacyCompression",type:u.type,batch:u.metadata?.batch}),!0}catch{return!1}return!1}get currentlyUnrolling(){return this.activeBatch}decompressAndStore(u){(0,n.assert)(u.compression===void 0||u.compression===i.CompressionAlgorithms.lz4,1297),(0,n.assert)(this.isCompressedMessage(u),2368),(0,n.assert)(this.activeBatch===!1,1208),this.activeBatch=!0;const c=u.metadata?.batch;c===void 0?this.isSingleMessageBatch=!0:(0,n.assert)(c===!0,2369);const d=e.IsoBuffer.from(u.contents.packedContents,"base64"),l=(0,t.decompress)(d),f=(0,e.Uint8ArrayToString)(l);this.rootMessageContents=JSON.parse(f)}unroll(u){(0,n.assert)(this.currentlyUnrolling,2370),(0,n.assert)(this.rootMessageContents!==void 0,2371),(0,n.assert)(this.rootMessageContents.length>this.processedCount,2372);const c=u.metadata?.batch;if(c===!1||this.isSingleMessageBatch){const d=s(u,this.rootMessageContents[this.processedCount]);return this.activeBatch=!1,this.isSingleMessageBatch=!1,this.rootMessageContents=void 0,this.processedCount=0,d}else if(c===!0)return s(u,this.rootMessageContents[this.processedCount++]);return(0,n.assert)(c===void 0,2373),(0,n.assert)(u.contents===void 0,1298),s(u,this.rootMessageContents[this.processedCount++])}}aS.OpDecompressor=r;const s=(o,u)=>({...o,contents:u,compression:void 0,metadata:o.metadata===void 0?void 0:{...o.metadata}});return aS}var Uj={},t8;function dse(){return t8||(t8=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.splitOp=e.OpSplitter=e.isChunkedMessage=void 0;const n=Je(),a=Ot(),t=$g(),i=Ex();function r(d){return s(d.contents)}e.isChunkedMessage=r;function s(d){return d?.type===t.ContainerMessageType.ChunkedOp}class o{constructor(l,f,b,C,v){this.submitBatchFn=f,this.chunkSizeInBytes=b,this.maxBatchSizeInBytes=C,this.chunkMap=new Map(l),this.logger=(0,a.createChildLogger)({logger:v,namespace:"OpSplitter"})}get isBatchChunkingEnabled(){return this.chunkSizeInBytes<Number.POSITIVE_INFINITY&&this.submitBatchFn!==void 0}get chunks(){return this.chunkMap}clearPartialChunks(l){this.chunkMap.has(l)&&this.chunkMap.delete(l)}addChunk(l,f,b){let C=this.chunkMap.get(l);if(C===void 0&&(C=[],this.chunkMap.set(l,C)),f.chunkId!==C.length+1)throw new a.DataCorruptionError("Chunk Id mismatch",{...(0,a.extractSafePropertiesFromMessage)(b),chunkMapLength:C.length,chunkId:f.chunkId,totalChunks:f.totalChunks});C.push(f.contents)}splitSingletonBatchMessage(l){(0,n.assert)(this.isBatchChunkingEnabled,1299),(0,n.assert)(l.contentSizeInBytes>0&&l.messages.length>0,1300),(0,n.assert)(l.referenceSequenceNumber!==void 0,1418),(0,n.assert)(this.chunkSizeInBytes!==0,1301),(0,n.assert)(this.chunkSizeInBytes<this.maxBatchSizeInBytes,1302);const[f,...b]=l.messages;(0,n.assert)((f.contents?.length??0)>=this.chunkSizeInBytes,1304);const C=(0,i.estimateSocketSize)(l),v=(0,e.splitOp)(f,this.chunkSizeInBytes,C>=this.maxBatchSizeInBytes);(0,n.assert)(this.submitBatchFn!==void 0,1305);for(const h of v.slice(0,-1))this.submitBatchFn([u(h,l.referenceSequenceNumber)],l.referenceSequenceNumber);const m=u(v[v.length-1],l.referenceSequenceNumber,{batch:f.metadata?.batch});return this.logger.sendPerformanceEvent({eventName:"CompressedChunkedBatch",length:l.messages.length,sizeInBytes:l.contentSizeInBytes,chunks:v.length,chunkSizeInBytes:this.chunkSizeInBytes,socketSize:C}),{messages:[m,...b],contentSizeInBytes:m.contents?.length??0,referenceSequenceNumber:l.referenceSequenceNumber}}processChunk(l){(0,n.assert)(s(l.contents),2376);const f=l.contents,b=l.clientId,C=f.contents;if(this.addChunk(b,C,l),C.chunkId<C.totalChunks)return{isFinalChunk:!1};const v=this.chunkMap.get(b).join("");this.clearPartialChunks(b);const m={...l};return m.contents=v===""?void 0:JSON.parse(v),m.type=C.originalType,m.metadata=C.originalMetadata,m.compression=C.originalCompression,{message:m,isFinalChunk:!0}}}e.OpSplitter=o;const u=(d,l,f=void 0)=>{const b={type:t.ContainerMessageType.ChunkedOp,contents:d};return{contents:JSON.stringify(b),metadata:f,referenceSequenceNumber:l}},c=(d,l,f=!1)=>{const b=[];(0,n.assert)(d.contents!==void 0&&d.contents!==null,1306);const C=d.contents.length,v=Math.floor((C-1)/l)+1+(f?1:0);let m=0;for(let h=1;h<=v;h++){const g={chunkId:h,contents:d.contents.slice(m,m+l),totalChunks:v};h===v&&(g.originalMetadata=d.metadata,g.originalCompression=d.compression,g.originalType="component"),b.push(g),m+=l,(0,n.assert)(h>=v-1||m<=C,1419)}return(0,n.assert)(m>=C,1420),(0,n.assert)(b.length===v,1445),b};e.splitOp=c})(Uj)),Uj}var Kf={},$f={},n8;function lse(){if(n8)return $f;n8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty($f,"__esModule",{value:!0}),$f.OpGroupingManager=$f.isGroupedBatch=void 0;const e=Je(),n=Ot();function a(r){return r?.type===i.groupedBatchOp}function t(r){return a(r.contents)}$f.isGroupedBatch=t;class i{constructor(s,o){this.config=s,this.logger=(0,n.createChildLogger)({logger:o,namespace:"OpGroupingManager"})}createEmptyGroupedBatch(s,o){(0,e.assert)(this.config.groupedBatchingEnabled,2560);const u={type:"groupedBatch",contents:[]},c=JSON.stringify(u),d={metadata:{batchId:s},localOpMetadata:{emptyBatch:!0},referenceSequenceNumber:o,runtimeOp:u};return{outboundBatch:{contentSizeInBytes:0,messages:[{...d,runtimeOp:void 0,contents:c}],referenceSequenceNumber:o},placeholderMessage:d}}groupBatch(s){if((0,e.assert)(this.groupedBatchingEnabled(),2937),(0,e.assert)(s.messages.length>0,2938),s.messages.length===1)return s;s.messages.length>=1e3&&this.logger.sendTelemetryEvent({eventName:"GroupLargeBatch",length:s.messages.length,reentrant:s.hasReentrantOps,referenceSequenceNumber:s.messages[0].referenceSequenceNumber});let o;for(const d of s.messages)if(d.metadata){const{batch:l,batchId:f,...b}=d.metadata;f&&(o=f),(0,e.assert)(Object.keys(b).length===0,1501)}const u=JSON.stringify({type:i.groupedBatchOp,contents:s.messages.map(d=>({contents:d.contents===void 0?void 0:JSON.parse(d.contents),metadata:d.metadata,compression:d.compression}))});return{...s,messages:[{metadata:{batchId:o},referenceSequenceNumber:s.messages[0].referenceSequenceNumber,contents:u}]}}ungroupOp(s){(0,e.assert)(a(s.contents),2375);const o=s.contents;let u=1;return o.contents.map(c=>({...s,clientSequenceNumber:u++,contents:c.contents,metadata:c.metadata,compression:c.compression}))}groupedBatchingEnabled(){return this.config.groupedBatchingEnabled}}return $f.OpGroupingManager=i,i.groupedBatchOp="groupedBatch",$f}var r8;function Tye(){if(r8)return Kf;r8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Kf,"__esModule",{value:!0}),Kf.unpackRuntimeMessage=Kf.RemoteMessageProcessor=void 0;const e=Je(),n=on(),a=$g(),t=vE(),i=lse(),r=dse();function s(d){(0,e.assert)(d.clientId!==null,2562)}class o{constructor(l,f,b){this.opSplitter=l,this.opDecompressor=f,this.opGroupingManager=b,this.batchInProgress=!1}get partialMessages(){return this.opSplitter.chunks}clearPartialMessagesFor(l){this.opSplitter.clearPartialChunks(l)}process(l,f){let b=l;s(b);const C=b.clientId;if((0,r.isChunkedMessage)(b)){const v=this.opSplitter.processChunk(b);if(!v.isFinalChunk)return;b=v.message}if(this.opDecompressor.isCompressedMessage(b)&&this.opDecompressor.decompressAndStore(b),this.opDecompressor.currentlyUnrolling&&(b=this.opDecompressor.unroll(b),(0,i.isGroupedBatch)(b)||u(b)),(0,i.isGroupedBatch)(b)){(0,e.assert)(!this.batchInProgress,2515);const v=(0,t.asBatchMetadata)(b.metadata)?.batchId,m=this.opGroupingManager.ungroupOp(b).map(h=>u(h));return{type:"fullBatch",messages:m,batchStart:{batchStartCsn:b.clientSequenceNumber,clientId:C,batchId:v,keyMessage:m[0]??b},length:m.length,groupedBatch:!0}}return c(b,f),this.getResultBasedOnBatchMetadata(b)}getResultBasedOnBatchMetadata(l){const f=(0,t.asBatchMetadata)(l.metadata)?.batch;return this.batchInProgress?((0,e.assert)(f!==!0,2518),f===!1&&(this.batchInProgress=!1),{type:"nextBatchMessage",nextMessage:l,batchEnd:f===!1}):((0,e.assert)(f!==!1,2517),f===!0?(this.batchInProgress=!0,{type:"batchStartingMessage",batchStart:{batchId:(0,t.asBatchMetadata)(l.metadata)?.batchId,clientId:l.clientId,batchStartCsn:l.clientSequenceNumber,keyMessage:l},nextMessage:l}):{type:"fullBatch",messages:[l],batchStart:{batchStartCsn:l.clientSequenceNumber,clientId:l.clientId,batchId:(0,t.asBatchMetadata)(l.metadata)?.batchId,keyMessage:l},length:1,groupedBatch:!1})}}Kf.RemoteMessageProcessor=o;function u(d){const l=d.contents,f=d;return f.type=l.type,f.contents=l.contents,f}function c(d,l=()=>{}){return d.type!==n.MessageType.Operation?!1:(d.contents.address!==void 0&&d.contents.type===void 0?(d.type=a.ContainerMessageType.FluidDataStoreOp,l("unpackRuntimeMessage_contentsWithAddress")):u(d),!0)}return Kf.unpackRuntimeMessage=c,Kf}var i8;function Ix(){return i8||(i8=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isGroupedBatch=e.OpGroupingManager=e.unpackRuntimeMessage=e.RemoteMessageProcessor=e.isChunkedMessage=e.splitOp=e.OpSplitter=e.OpDecompressor=e.OpCompressor=e.getLongStack=e.Outbox=e.localBatchToOutboundBatch=e.estimateSocketSize=e.ensureContentsDeserialized=e.serializeOp=e.DuplicateBatchDetector=e.generateBatchId=e.getEffectiveBatchId=e.BatchManager=e.addBatchMetadata=void 0;var n=Px();Object.defineProperty(e,"addBatchMetadata",{enumerable:!0,get:function(){return n.addBatchMetadata}}),Object.defineProperty(e,"BatchManager",{enumerable:!0,get:function(){return n.BatchManager}}),Object.defineProperty(e,"getEffectiveBatchId",{enumerable:!0,get:function(){return n.getEffectiveBatchId}}),Object.defineProperty(e,"generateBatchId",{enumerable:!0,get:function(){return n.generateBatchId}});var a=Sye();Object.defineProperty(e,"DuplicateBatchDetector",{enumerable:!0,get:function(){return a.DuplicateBatchDetector}});var t=Ox();Object.defineProperty(e,"serializeOp",{enumerable:!0,get:function(){return t.serializeOp}}),Object.defineProperty(e,"ensureContentsDeserialized",{enumerable:!0,get:function(){return t.ensureContentsDeserialized}});var i=Ex();Object.defineProperty(e,"estimateSocketSize",{enumerable:!0,get:function(){return i.estimateSocketSize}}),Object.defineProperty(e,"localBatchToOutboundBatch",{enumerable:!0,get:function(){return i.localBatchToOutboundBatch}}),Object.defineProperty(e,"Outbox",{enumerable:!0,get:function(){return i.Outbox}}),Object.defineProperty(e,"getLongStack",{enumerable:!0,get:function(){return i.getLongStack}});var r=Cye();Object.defineProperty(e,"OpCompressor",{enumerable:!0,get:function(){return r.OpCompressor}});var s=_ye();Object.defineProperty(e,"OpDecompressor",{enumerable:!0,get:function(){return s.OpDecompressor}});var o=dse();Object.defineProperty(e,"OpSplitter",{enumerable:!0,get:function(){return o.OpSplitter}}),Object.defineProperty(e,"splitOp",{enumerable:!0,get:function(){return o.splitOp}}),Object.defineProperty(e,"isChunkedMessage",{enumerable:!0,get:function(){return o.isChunkedMessage}});var u=Tye();Object.defineProperty(e,"RemoteMessageProcessor",{enumerable:!0,get:function(){return u.RemoteMessageProcessor}}),Object.defineProperty(e,"unpackRuntimeMessage",{enumerable:!0,get:function(){return u.unpackRuntimeMessage}});var c=lse();Object.defineProperty(e,"OpGroupingManager",{enumerable:!0,get:function(){return c.OpGroupingManager}}),Object.defineProperty(e,"isGroupedBatch",{enumerable:!0,get:function(){return c.isGroupedBatch}})})(qj)),qj}var yu={},s8;function wye(){if(s8)return yu;s8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=yu&&yu.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(yu,"__esModule",{value:!0}),yu.PendingStateManager=yu.findFirstCharacterMismatched=void 0;const n=Je(),a=Ot(),t=e(ix()),i=ys(),r=lT(),s=vE(),o=Ix();function u(_){const S=JSON.parse(_.content);return S.type==="groupedBatch"&&S.contents?.length===0}function c(_){const{type:S,contents:p}=_;return JSON.stringify({type:S,contents:p})}function d(_){return Object.keys(_).reduce((S,p)=>(S[p]=typeof _[p],S),{})}function l(_){const S=d(_);return S.contents=_.contents&&d(_.contents),S.type=_.type,JSON.stringify(S)}function f(_,S){const p=Math.min(_.length,S.length);for(let w=0;w<p;w++)if(_[w]!==S[w])return[w,_[w],S[w]];return _.length===S.length?[-1,void 0,void 0]:[p,_[p],S[p]]}function b(_,S){const[p,w,O]=f(_,S),E=(w?.codePointAt(0)??0)<=127?w:"[non-ASCII]",F=(O?.codePointAt(0)??0)<=127?O:"[non-ASCII]";return[p,E,F]}yu.findFirstCharacterMismatched=b;function C(_){return{..._,localOpMetadata:void 0,runtimeOp:void 0}}const v={committingStagedBatches:!1,squash:!1};class m{get pendingMessagesCount(){return this.pendingMessages.length+this.initialMessages.length}hasPendingUserChanges(){for(let S=0;S<this.pendingMessages.length;S++){const p=this.pendingMessages.get(S);if(p!==void 0&&g(p)&&(0,r.isContainerMessageDirtyable)(p.runtimeOp))return!0}return this.initialMessages.length>0}get minimumPendingMessageSequenceNumber(){return this.pendingMessages.peekFront()?.referenceSequenceNumber}hasPendingMessages(){return this.pendingMessagesCount!==0}getLocalState(S){(0,n.assert)(this.initialMessages.isEmpty(),745);const p=[...this.savedOps].filter(w=>((0,n.assert)(w.sequenceNumber!==void 0,2428),w.sequenceNumber>(S??0)));for(const w of this.pendingMessages.toArray())if(S!==void 0&&w.referenceSequenceNumber<S)throw new a.LoggingError("trying to stash ops older than our latest snapshot");return{pendingStates:[...p,...this.pendingMessages.toArray().map(w=>C(w))]}}constructor(S,p,w){this.stateHandler=S,this.pendingMessages=new t.default,this.initialMessages=new t.default,this.savedOps=[],this.disposeOnce=new n.Lazy(()=>{this.initialMessages.clear(),this.pendingMessages.clear()}),this.dispose=()=>this.disposeOnce.value,this.logger=(0,a.createChildLogger)({logger:w}),p?.pendingStates&&this.initialMessages.push(...p.pendingStates)}get disposed(){return this.disposeOnce.evaluated}onFlushEmptyBatch(S,p,w){this.onFlushBatch([S],p,w)}onFlushBatch(S,p,w,O){const E=p!==void 0;E&&(0,n.assert)(!w,2948);const[F,R]=E?[this.stateHandler.clientId(),p]:[(0,i.v4)(),-1];(0,n.assert)(F!==void 0,2611);for(const M of S){const{runtimeOp:j,referenceSequenceNumber:k,localOpMetadata:x,metadata:L}=M,V={type:"message",referenceSequenceNumber:k,content:(0,o.serializeOp)(j),runtimeOp:j,localOpMetadata:x,opMetadata:L,batchInfo:{clientId:F,batchStartCsn:R,length:S.length,ignoreBatchId:O,staged:w}};this.pendingMessages.push(V)}}async applyStashedOpsAt(S){for(;!this.initialMessages.isEmpty();){if(S!==void 0){const w=this.initialMessages.peekFront();if(w.referenceSequenceNumber>S)break;if(w.referenceSequenceNumber<S)throw new Error("loaded from snapshot too recent to apply stashed ops")}const p=this.initialMessages.shift();try{if(u(p)){p.localOpMetadata={emptyBatch:!0},h(p),this.pendingMessages.push(p);continue}const w=await this.stateHandler.applyStashedOp(p.content);if(this.stateHandler.isAttached())p.localOpMetadata=w,p.runtimeOp=JSON.parse(p.content),h(p),this.pendingMessages.push(p);else if(w!==void 0)throw new Error("Local Op Metadata must be undefined when not attached")}catch(w){throw a.DataProcessingError.wrapIfUnrecognized(w,"applyStashedOp",p)}}}remoteBatchMatchesPendingBatch(S){const p=Array.from({length:this.pendingMessages.length}).findIndex((F,R)=>this.pendingMessages.get(R)?.batchInfo.ignoreBatchId!==!0),w=p===-1?void 0:this.pendingMessages.get(p);if(w===void 0)return!1;const O=(0,o.getEffectiveBatchId)(w),E=(0,o.getEffectiveBatchId)(S);return O===E}processInboundMessages(S,p){if(p)return this.processPendingLocalMessages(S);if("batchStart"in S&&this.remoteBatchMatchesPendingBatch(S.batchStart))throw a.DataProcessingError.create("Forked Container Error! Matching batchIds but mismatched clientId","PendingStateManager.processInboundMessages",S.batchStart.keyMessage);return(S.type==="fullBatch"?S.messages:[S.nextMessage]).map(O=>({message:O}))}processPendingLocalMessages(S){if("batchStart"in S&&this.onLocalBatchBegin(S.batchStart,S.length),S.length===0){const w=this.processNextPendingMessage(S.batchStart.keyMessage.sequenceNumber);return(0,n.assert)((0,s.asEmptyBatchLocalOpMetadata)(w)?.emptyBatch===!0,2592),[]}return(S.type==="fullBatch"?S.messages:[S.nextMessage]).map(w=>({message:w,localOpMetadata:this.processNextPendingMessage(w.sequenceNumber,w)}))}processNextPendingMessage(S,p){const w=this.pendingMessages.peekFront();if((0,n.assert)(w!==void 0,361),w.sequenceNumber=S,this.savedOps.push(C(w)),this.pendingMessages.shift(),p!==void 0){const O=c(p);if(w.content!==O){const[E,F]=[w.content.length,O.length],[R,M,j]=b(w.content,O),k=JSON.parse(w.content),x=JSON.parse(O),L=k.contents===x.contents||k.contents!==void 0&&x.contents!==void 0&&JSON.stringify(k.contents)===JSON.stringify(x.contents);throw this.logger.sendErrorEvent({eventName:"unexpectedAckReceived",details:{pendingContentScrubbed:l(k),incomingContentScrubbed:l(x),contentsMatch:L,pendingLength:E,incomingLength:F,mismatchStartIndex:R,pendingChar:M,incomingChar:j}}),a.DataProcessingError.create("pending local message content mismatch","unexpectedAckReceived",p)}}return w.localOpMetadata}onLocalBatchBegin(S,p){const w=this.pendingMessages.peekFront();(0,n.assert)(w!==void 0,2593),(0,n.assert)(!w.batchInfo.staged,2949);const O=S.keyMessage,E=w.batchInfo.length===-1||p===void 0,F=p===0?1:p,R=(0,s.asBatchMetadata)(w.opMetadata)?.batchId,M=S.batchId;(w.batchInfo.batchStartCsn!==S.batchStartCsn||!E&&w.batchInfo.length!==F||R!==M)&&this.logger?.sendErrorEvent({eventName:"BatchInfoMismatch",details:{pendingBatchCsn:w.batchInfo.batchStartCsn,batchStartCsn:S.batchStartCsn,pendingBatchLength:w.batchInfo.length,expectedPendingBatchLength:F,batchLength:p,pendingBatchId:R,inboundBatchId:M,pendingMessageBatchMetadata:(0,s.asBatchMetadata)(w.opMetadata)?.batch,messageBatchMetadata:(0,s.asBatchMetadata)(O?.metadata)?.batch},messageDetails:O&&(0,a.extractSafePropertiesFromMessage)(O)})}replayPendingStates(S){const{committingStagedBatches:p,squash:w}={...v,...S};(0,n.assert)(this.stateHandler.connected()||p===!0,370),p||(0,n.assert)(this.clientIdFromLastReplay!==this.stateHandler.clientId(),371),this.clientIdFromLastReplay=this.stateHandler.clientId(),(0,n.assert)(this.initialMessages.isEmpty(),372);const O=this.pendingMessages.length;let E=this.pendingMessages.length,F=!1;for(;E>0;){let R=this.pendingMessages.shift();if(E--,p){if(!R.batchInfo.staged){(0,n.assert)(!F,2950),this.pendingMessages.push(R);continue}F=!0,R.batchInfo.staged=!1}const M=(0,s.asBatchMetadata)(R.opMetadata)?.batch;(0,n.assert)(M!==!1,1051);const j=R.batchInfo.ignoreBatchId?void 0:(0,o.getEffectiveBatchId)(R),k=R.batchInfo.staged;if((0,s.asEmptyBatchLocalOpMetadata)(R.localOpMetadata)?.emptyBatch===!0){this.stateHandler.reSubmitBatch([],{batchId:j,staged:k,squash:w});continue}if((0,n.assert)(g(R),2951),M===void 0){this.stateHandler.reSubmitBatch([{runtimeOp:R.runtimeOp,localOpMetadata:R.localOpMetadata,opMetadata:R.opMetadata}],{batchId:j,staged:k,squash:w});continue}(0,n.assert)(E>0,1364);const x=[];for(;E>=0&&((0,n.assert)(g(R),2952),x.push({runtimeOp:R.runtimeOp,localOpMetadata:R.localOpMetadata,opMetadata:R.opMetadata}),R.opMetadata?.batch!==!1);)(0,n.assert)(E>0,1365),R=this.pendingMessages.shift(),E--,(0,n.assert)(R.opMetadata?.batch!==!0,1366);this.stateHandler.reSubmitBatch(x,{batchId:j,staged:k,squash:w})}p||(this.savedOps=[]),this.stateHandler.isActiveConnection()&&this.logger?.sendTelemetryEvent({eventName:"PendingStatesReplayed",count:O,clientId:this.stateHandler.clientId()})}popStagedBatches(S){for(;!this.pendingMessages.isEmpty();){const p=this.pendingMessages.peekBack();if(p?.batchInfo.staged===!0)this.pendingMessages.pop(),g(p)&&S(p);else break}(0,n.assert)(this.pendingMessages.toArray().every(p=>p.batchInfo.staged!==!0),2953)}}yu.PendingStateManager=m;function h(_){_.batchInfo===void 0&&(_.batchInfo={clientId:(0,i.v4)(),batchStartCsn:-1,length:-1,staged:!1})}function g(_){return _.runtimeOp!==void 0&&_.runtimeOp.type!=="groupedBatch"}return yu}var uo={},a8;function Oye(){if(a8)return uo;a8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=uo&&uo.__classPrivateFieldGet||function(o,u,c,d){if(c==="a"&&!d)throw new TypeError("Private accessor was defined without a getter");if(typeof u=="function"?o!==u||!d:!u.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return c==="m"?d:c==="a"?d.call(o):d?d.value:u.get(o)},n=uo&&uo.__classPrivateFieldSet||function(o,u,c,d,l){if(d==="m")throw new TypeError("Private method is not writable");if(d==="a"&&!l)throw new TypeError("Private accessor was defined without a setter");if(typeof u=="function"?o!==u||!l:!u.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return d==="a"?l.call(o,c):l?l.value=c:u.set(o,c),c},a,t;Object.defineProperty(uo,"__esModule",{value:!0}),uo.BatchRunCounter=uo.RunCounter=void 0;const i=Je();class r{constructor(){a.set(this,0)}get running(){return e(this,a,"f")!==0}get runs(){return e(this,a,"f")}run(u){var c,d;n(this,a,(c=e(this,a,"f"),c++,c),"f");try{return u()}finally{n(this,a,(d=e(this,a,"f"),d--,d),"f")}}}uo.RunCounter=r,a=new WeakMap;class s extends r{constructor(){super(...arguments),t.set(this,void 0)}get resubmitInfo(){return e(this,t,"f")}run(u,c){(0,i.assert)(e(this,t,"f")===void 0,2978),n(this,t,c,"f");try{return super.run(u)}finally{n(this,t,void 0,"f")}}}return uo.BatchRunCounter=s,t=new WeakMap,uo}var oS={},o8;function Pye(){if(o8)return oS;o8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(oS,"__esModule",{value:!0}),oS.SignalTelemetryManager=void 0;const e=100;class n{constructor(){this.signalTracking={totalSignalsSentInLatencyWindow:0,signalsLost:0,signalsOutOfOrder:0,signalsSentSinceLastLatencyMeasurement:0,signalTimestamp:0,roundTripSignalSequenceNumber:void 0,trackingSignalSequenceNumber:void 0,minimumTrackingSignalSequenceNumber:void 0},this.broadcastSignalSequenceNumber=0}resetTracking(){this.signalTracking.signalsLost=0,this.signalTracking.signalsOutOfOrder=0,this.signalTracking.signalTimestamp=0,this.signalTracking.signalsSentSinceLastLatencyMeasurement=0,this.signalTracking.totalSignalsSentInLatencyWindow=0,this.signalTracking.roundTripSignalSequenceNumber=void 0,this.signalTracking.trackingSignalSequenceNumber=void 0,this.signalTracking.minimumTrackingSignalSequenceNumber=void 0}trackReceivedSignal(t,i,r){const{clientBroadcastSignalSequenceNumber:s,contents:o,address:u}=t;if(s!==void 0&&!(this.signalTracking.trackingSignalSequenceNumber===void 0||this.signalTracking.minimumTrackingSignalSequenceNumber===void 0)){if(s>=this.signalTracking.trackingSignalSequenceNumber){const c=s-this.signalTracking.trackingSignalSequenceNumber;c>0&&(this.signalTracking.signalsLost+=c,i.sendErrorEvent({eventName:"SignalLost",details:{signalsLost:c,expectedSequenceNumber:this.signalTracking.trackingSignalSequenceNumber,clientBroadcastSignalSequenceNumber:s}})),this.signalTracking.trackingSignalSequenceNumber=s+1}else if(s>=this.signalTracking.minimumTrackingSignalSequenceNumber){this.signalTracking.signalsOutOfOrder++;const c={expectedSequenceNumber:this.signalTracking.trackingSignalSequenceNumber,clientBroadcastSignalSequenceNumber:s};u===void 0&&(c.contentsType=o.type),i.sendTelemetryEvent({eventName:"SignalOutOfOrder",details:c})}if(this.signalTracking.roundTripSignalSequenceNumber!==void 0&&s>=this.signalTracking.roundTripSignalSequenceNumber){if(s===this.signalTracking.roundTripSignalSequenceNumber){const c=Date.now()-this.signalTracking.signalTimestamp;i.sendPerformanceEvent({eventName:"SignalLatency",details:{duration:c,sent:this.signalTracking.totalSignalsSentInLatencyWindow,lost:this.signalTracking.signalsLost,outOfOrder:this.signalTracking.signalsOutOfOrder,reconnectCount:r}}),this.signalTracking.signalsLost=0,this.signalTracking.signalsOutOfOrder=0,this.signalTracking.signalTimestamp=0,this.signalTracking.totalSignalsSentInLatencyWindow=0}this.signalTracking.roundTripSignalSequenceNumber=void 0}}}applyTrackingToBroadcastSignalEnvelope(t){const i=++this.broadcastSignalSequenceNumber;t.clientBroadcastSignalSequenceNumber=i,this.signalTracking.signalsSentSinceLastLatencyMeasurement++,(this.signalTracking.minimumTrackingSignalSequenceNumber===void 0||this.signalTracking.trackingSignalSequenceNumber===void 0)&&(this.signalTracking.minimumTrackingSignalSequenceNumber=i,this.signalTracking.trackingSignalSequenceNumber=i),this.signalTracking.roundTripSignalSequenceNumber===void 0&&i%e===1&&(this.signalTracking.signalTimestamp=Date.now(),this.signalTracking.roundTripSignalSequenceNumber=i,this.signalTracking.totalSignalsSentInLatencyWindow+=this.signalTracking.signalsSentSinceLastLatencyMeasurement,this.signalTracking.signalsSentSinceLastLatencyMeasurement=0)}}return oS.SignalTelemetryManager=n,oS}var zj={},c8;function Eye(){return c8||(c8=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.formLinearFnWithAttemptOffset=e.formLinearFn=e.formExponentialFnWithAttemptOffset=e.formExponentialFn=e.Throttler=void 0;class n{get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}constructor(o,u,c){this.delayWindowMs=o,this.maxDelayMs=u,this.delayFn=c,this.startTimes=[]}getDelay(){const o=Date.now(),u=this.latestAttemptTime;if(u!==void 0){const d=u-o;d>0&&(this.startTimes=this.startTimes.map(l=>l-d))}this.startTimes=this.startTimes.filter(d=>o-d<this.delayWindowMs);const c=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(o),this.startTimes=this.startTimes.map(d=>d+c),c===this.maxDelayMs&&this.startTimes.shift(),c}}e.Throttler=n;const a=({multiplier:s=2,coefficient:o=1,offset:u=0,initialDelay:c=void 0}={})=>d=>Math.max(0,d<=0&&c!==void 0?c:o*Math.pow(s,d)+u);e.formExponentialFn=a;const t=(s,{multiplier:o=2,coefficient:u=1,offset:c=0,initialDelay:d=void 0}={})=>(0,e.formExponentialFn)({multiplier:o,coefficient:u*Math.pow(o,s),offset:c,initialDelay:d});e.formExponentialFnWithAttemptOffset=t;const i=({coefficient:s=1,offset:o=0}={})=>u=>Math.max(0,s*u+o);e.formLinearFn=i;const r=(s,{coefficient:o=1,offset:u=0}={})=>(0,e.formLinearFn)({coefficient:o,offset:o*s+u});e.formLinearFnWithAttemptOffset=r})(zj)),zj}var u8;function lT(){return u8||(u8=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isContainerMessageDirtyable=e.createNewSignalEnvelope=e.ContainerRuntime=e.loadContainerRuntime=e.getSingleUseLegacyLogCallback=e.makeLegacySendBatchFn=e.getDeviceSpec=e.agentSchedulerId=e.isUnpackedRuntimeMessage=e.defaultPendingOpsRetryDelayMs=e.defaultPendingOpsWaitTimeoutMs=e.defaultRuntimeHeaderData=e.InactiveResponseHeaderKey=e.TombstoneResponseHeaderKey=e.DeletedResponseHeaderKey=void 0;const n=Ht(),a=Mr(),t=Mr(),i=Je(),r=on(),s=on(),o=Kn(),u=fl(),c=ja(),d=bn(),l=bn(),f=Ot(),b=px(),C=ys(),v=Jge(),m=Sx(),h=use(),g=dT(),_=pye(),S=gye(),p=yye(),w=Zie(),O=wx(),E=cse(),F=bye(),R=CE(),M=vye(),j=$g(),k=Ix(),x=TE(),L=wye(),V=Oye(),G=Tx(),ee=Pye(),se=uT(),re=Eye();function fe(Me,K,Z){return f.DataProcessingError.create("Runtime message of unknown type",K,Z,{messageDetails:{type:Me}})}e.DeletedResponseHeaderKey="wasDeleted",e.TombstoneResponseHeaderKey="isTombstoned",e.InactiveResponseHeaderKey="isInactive",e.defaultRuntimeHeaderData={wait:!0,viaHandle:!1,allowTombstone:!1};const oe={squash:!1},pe="Fluid.ContainerRuntime.MaxConsecutiveReconnects",de=700*1024,ge=204800;e.defaultPendingOpsWaitTimeoutMs=1e3,e.defaultPendingOpsRetryDelayMs=1e3;const Ce=5e3;function Fe(Me){return Object.values(j.ContainerMessageType).includes(Me.type)}e.isUnpackedRuntimeMessage=Fe,e.agentSchedulerId="_scheduler";function We(){try{if(typeof navigator=="object"&&navigator!==null)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch{}return{}}e.getDeviceSpec=We;const Ze=(Me,K)=>Z=>{let me=-1;for(const we of Z.messages)me=Me(s.MessageType.Operation,we.contents===void 0?void 0:JSON.parse(we.contents),!0,we.metadata);return K.flush(),me};e.makeLegacySendBatchFn=Ze;function lt(Me){return Me?.documentSchema?.runtime?.explicitSchemaControl?Me?.lastMessage:Me?.message}let ut=(Me,K)=>Z=>{Me.sendTelemetryEvent({eventName:"LegacyMessageFormat",details:{codePath:Z,type:K}}),e.getSingleUseLegacyLogCallback=()=>()=>{}};e.getSingleUseLegacyLogCallback=ut;function pt(Me){return Me}async function Nt(Me){return Re.loadRuntime(Me)}e.loadContainerRuntime=Nt;const Ke=7;function Ge(Me){return Me===j.ContainerMessageType.FluidDataStoreOp||Me===j.ContainerMessageType.GC||Me===j.ContainerMessageType.DocumentSchemaChange}class Re extends n.TypedEventEmitter{static async loadRuntime(K){const{context:Z,registryEntries:me,existing:we,requestHandler:qe,provideEntryPoint:xe,runtimeOptions:Oe={},containerScope:He={},containerRuntimeCtor:Se=Re,minVersionForCollab:Ve=d.defaultMinVersionForCollab}=K,ot=Z,mt=ot.taggedLogger??new f.TaggedLoggerAdapter(ot.logger),he=(0,f.createChildLogger)({logger:mt,properties:{all:{runtimeVersion:x.pkgVersion}}}),Ue=(0,f.loggerToMonitoringContext)(he);if(!(0,d.isValidMinVersionForCollab)(Ve))throw new f.UsageError(`Invalid minVersionForCollab: ${Ve}. It must be an existing FF version (i.e. 2.22.1).`);(0,S.validateRuntimeOptions)(Ve,Oe);const ke={...(0,S.getMinVersionForCollabDefaults)(Ve),...{summaryOptions:{},loadSequenceNumberVerification:"close",maxBatchSizeInBytes:de,chunkSizeInBytes:ge}},{summaryOptions:Rt=ke.summaryOptions,gcOptions:Ft=ke.gcOptions,loadSequenceNumberVerification:xt=ke.loadSequenceNumberVerification,maxBatchSizeInBytes:zt=ke.maxBatchSizeInBytes,chunkSizeInBytes:fn=ke.chunkSizeInBytes,explicitSchemaControl:je=ke.explicitSchemaControl,enableGroupedBatching:Ne=ke.enableGroupedBatching,flushMode:Kt=ke.flushMode,compressionOptions:mn=Ne===!1?g.disabledCompressionConfig:ke.compressionOptions,createBlobPayloadPending:er=ke.createBlobPayloadPending}=Oe,ji="enableRuntimeIdCompressor"in Oe?Oe.enableRuntimeIdCompressor:ke.enableRuntimeIdCompressor,Qs=new O.FluidDataStoreRegistry(me),Qr=async Ci=>{const ds=Z.baseSnapshot?.blobs[Ci];if(Z.baseSnapshot&&ds)return(0,i.assert)(Z.storage!==void 0,501),(0,o.readAndParse)(Z.storage,ds)},[Br,wr,qn,qi,Ys,In]=await Promise.all([Qr(se.chunksBlobName),Qr(se.recentBatchInfoBlobName),Qr(se.metadataBlobName),Qr(se.electedSummarizerBlobName),Qr(se.aliasBlobName),Qr(se.idCompressorBlobName)]),Si=await(0,m.loadBlobManagerLoadInfo)(Z),os=lt(qn)?.sequenceNumber,bs=Z.deltaManager.initialSequenceNumber;if(!Z.pendingLocalState&&os!==void 0&&xt!=="bypass"&&os!==bs){const Ci=new f.DataCorruptionError("Summary metadata mismatch",{runtimeVersion:x.pkgVersion,runtimeSequenceNumber:os,protocolSequenceNumber:bs});xt==="log"?he.sendErrorEvent({eventName:"SequenceNumberMismatch"},Ci):Z.closeFn(Ci)}let Yr;switch(Ue.config.getBoolean("Fluid.ContainerRuntime.IdCompressorEnabled")){case!0:{Yr="on";break}case!1:{Yr=void 0;break}default:{Yr=ji;break}}let ni;we?(ni=qn?.documentSchema?.runtime?.idCompressorMode,ni===void 0&&Yr==="delayed"&&je&&(ni=Yr)):ni=Yr;const cs=()=>{const Ci=(()=>{const gn=Math.random()<.05;return{sample:()=>gn}})(),ds=(0,f.createSampledLogger)(he,Ci),Gt=Z.pendingLocalState;return Gt?.pendingIdCompressorState!==void 0?(0,u.deserializeIdCompressor)(Gt.pendingIdCompressorState,ds):In===void 0?(0,u.createIdCompressor)(ds):(0,u.deserializeIdCompressor)(In,(0,u.createSessionId)(),ds)},Mi=mn.minimumBatchSizeInBytes!==Number.POSITIVE_INFINITY&&mn.compressionAlgorithm==="lz4",$n=new se.DocumentsSchemaController(we,bs,qn?.documentSchema,{explicitSchemaControl:je,compressionLz4:Mi,idCompressorMode:ni,opGroupingEnabled:Ne,createBlobPayloadPending:er,disallowedVersions:[]},Ci=>{Ss.onSchemaChange(Ci)},{minVersionForCollab:Ve},he),Xs=$n.sessionSchema.info.minVersionForCollab,vs=Xs===void 0||(0,b.gt)(Ve,Xs)?Ve:Xs;if(Mi&&!Ne)throw new f.UsageError("If compression is enabled, op grouping must be enabled too");const Xr={},us={summaryOptions:Rt,gcOptions:Ft,loadSequenceNumberVerification:xt,flushMode:Kt,compressionOptions:mn,maxBatchSizeInBytes:zt,chunkSizeInBytes:fn,enableRuntimeIdCompressor:ji,enableGroupedBatching:Ne,explicitSchemaControl:je,createBlobPayloadPending:er},Ss=new Se(Z,Qs,qn,qi,Br??[],Ys??[],us,He,he,we,Si,Z.storage,cs,$n,Xr,xe,vs,qe,void 0,wr);return await Ss.initializeBaseState(Z.loader),await Ss.pendingStateManager.applyStashedOpsAt(os??0),Ss}get clientId(){return this._getClientId()}get storage(){return this._storage}get containerRuntime(){return this}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this._getAttachState()}get sessionSchema(){return this.documentsSchemaController.sessionSchema.runtime}get idCompressor(){if(this.sessionSchema.idCompressorMode==="on")return(0,i.assert)(this._idCompressor!==void 0,2282),this._idCompressor}generateDocumentUniqueId(){return this._idCompressor?.generateDocumentUniqueId()??(0,C.v4)()}get IFluidHandleContext(){return this.handleContext}get deltaManager(){return this._deltaManager}ensureNoDataModelChanges(K){return this.dataModelChangeRunner.run(K)}get connected(){return this.canSendOps}get summarizerClientId(){return this.summarizerClientElection?.electedClientId}get disposed(){return this._disposed}get gcTombstoneEnforcementAllowed(){return!1}get gcThrowOnTombstoneUsage(){return!1}get ILayerCompatDetails(){return G.runtimeCompatDetailsForLoader}constructor(K,Z,me,we,qe,xe,Oe,He,Se,Ve,ot,mt,he,Ue,Pe,Ye,ke,Rt,Ft={...se.DefaultSummaryConfiguration,...Oe.summaryOptions?.summaryConfigOverrides},xt){super(),this.registry=Z,this.metadata=me,this.electedSummarizerData=we,this.runtimeOptions=Oe,this.containerScope=He,this.baseLogger=Se,this._storage=mt,this.createIdCompressorFn=he,this.documentsSchemaController=Ue,this.minVersionForCollab=ke,this.requestHandler=Rt,this.summaryConfiguration=Ft,this.isReadOnly=()=>this.deltaManager.readOnlyInfo.readonly===!0,this.pendingIdCompressorOps=[],this.batchRunner=new V.BatchRunCounter,this.flushScheduled=!1,this.consecutiveReconnects=0,this.dataModelChangeRunner=new V.RunCounter,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.signalTelemetryManager=new ee.SignalTelemetryManager,this.snapshotCacheForLoadingGroupIds=new i.PromiseCache({expiry:{policy:"absolute",durationMs:6e4}}),this.extensions=new Map,this.notifyReadOnlyState=Gt=>this.channelCollection.notifyReadOnlyState(Gt),this.enterStagingMode=()=>{if(this.stageControls!==void 0)throw new f.UsageError("Already in staging mode");if(this.attachState===a.AttachState.Detached)throw new f.UsageError("Cannot enter staging mode while Detached");this.flush();const Gt=wn=>{try{this.outbox.flush(),this.stageControls=void 0,this.submitIdAllocationOpIfNeeded({staged:!1}),wn(),this.channelCollection.notifyStagingMode(!1)}catch(Or){const Zs=(0,f.normalizeError)(Or);throw this.closeFn(Zs),Zs}},gn={discardChanges:()=>Gt(()=>{this.pendingStateManager.popStagedBatches(({runtimeOp:wn,localOpMetadata:Or})=>{this.rollbackStagedChange(wn,Or)}),this.updateDocumentDirtyState()}),commitChanges:wn=>{const{squash:Or}={...oe,...wn};Gt(()=>{this.pendingStateManager.replayPendingStates({committingStagedBatches:!0,squash:Or})})}};return this.stageControls=gn,this.channelCollection.notifyStagingMode(!0),this.stageControls},this.readAndParseBlob=async Gt=>(0,o.readAndParse)(this.storage,Gt),this.lazyEventsForExtensions=new i.Lazy(()=>{const Gt=(0,n.createEmitter)();return this.getConnectionState?(this.on("connectedToService",(gn,wn)=>{Gt.emit("joined",{clientId:gn,canWrite:wn})}),this.on("disconnectedFromService",()=>Gt.emit("disconnected")),this.on("connectionTypeChanged",gn=>Gt.emit("connectionTypeChanged",gn))):(this.on("connected",gn=>{Gt.emit("joined",{clientId:gn,canWrite:!0})}),this.on("disconnected",()=>Gt.emit("disconnected"))),Gt});const{options:zt,clientDetails:fn,connected:je,baseSnapshot:Ne,submitFn:Kt,submitBatchFn:mn,submitSummaryFn:er,submitSignalFn:ji,disposeFn:Qs,closeFn:Qr,deltaManager:Br,quorum:wr,audience:qn,pendingLocalState:qi,supportedFeatures:Ys,snapshotWithContents:In,getConnectionState:Si}=K;this.getConnectionState=Si,this.disposeFn=Qs??Qr;const xa=K;(0,G.validateLoaderCompatibility)(xa.ILayerCompatDetails,this.disposeFn),this.mc=(0,f.createChildMonitoringContext)({logger:this.baseLogger,namespace:"ContainerRuntime",properties:{all:{inStagingMode:this.inStagingMode}}});const os={minimumBatchSizeInBytes:this.sessionSchema.compressionLz4?Oe.compressionOptions.minimumBatchSizeInBytes:Number.POSITIVE_INFINITY,compressionAlgorithm:g.CompressionAlgorithms.lz4};(0,i.assert)((0,t.isIDeltaManagerFull)(Br),2688),this.innerDeltaManager=Br,this.submitSummaryFn=er??((Gt,gn)=>Kt(s.MessageType.Summarize,Gt,!1));const bs=(Gt,gn)=>{gn===void 0&&this.signalTelemetryManager.applyTrackingToBroadcastSignalEnvelope(Gt),ji(Gt,gn)};this.submitSignalFn=(Gt,gn)=>{if(Gt.address?.startsWith("/"))throw new Error("General path based addressing is not implemented");bs(Gt,gn)},this.submitExtensionSignal=(Gt,gn,wn)=>{this.verifyNotClosed();const Or=Qe(`/ext/${Gt}/${gn.join("/")}`,wn.type,wn.content);bs(Or,wn.targetClientId)},this.options=zt??{},this.clientDetails=fn,this.isSummarizerClient=this.clientDetails.type===se.summarizerClientType,this.loadedFromVersionId=K.getLoadedFromVersion()?.id,this._getClientId=()=>K.clientId,this._getAttachState=()=>K.attachState,this.getAbsoluteUrl=async Gt=>{if(K.getAbsoluteUrl===void 0)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===a.AttachState.Attached)return K.getAbsoluteUrl(Gt)},this.on("dirty",()=>K.updateDirtyContainerState(!0)),this.on("saved",()=>K.updateDirtyContainerState(!1)),this.once("attached",()=>{this.mc.logger.sendTelemetryEvent({eventName:"Attached",details:{lastEmittedDirty:this.lastEmittedDirty,currentDirtyState:this.computeCurrentDirtyState()}})}),this.once("saved",()=>this.mc.logger.sendTelemetryEvent({eventName:"Saved",details:{attachState:this.attachState}})),this.closeFn=this.isSummarizerClient?this.disposeFn:Qr;let Yr;Ve?(this.createContainerMetadata={createContainerRuntimeVersion:me?.createContainerRuntimeVersion,createContainerTimestamp:me?.createContainerTimestamp},Yr=me?.summaryNumber??0):(this.createContainerMetadata={createContainerRuntimeVersion:x.pkgVersion,createContainerTimestamp:Date.now()},Yr=0),this.nextSummaryNumber=Yr+1,this.messageAtLastSummary=lt(me),this.canSendOps=je,this.canSendSignals=this.getConnectionState?this.getConnectionState()===t.ConnectionState.Connected:void 0,this.mc.logger.sendTelemetryEvent({eventName:"GCFeatureMatrix",metadataValue:JSON.stringify(me?.gcFeatureMatrix),inputs:JSON.stringify({gcOptions_gcGeneration:Oe.gcOptions[R.gcGenerationOptionName]})}),this.telemetryDocumentId=me?.telemetryDocumentId??(0,C.v4)();const ni=new k.OpGroupingManager({groupedBatchingEnabled:this.groupedBatchingEnabled},this.mc.logger),cs=new k.OpSplitter(qe,mn,Oe.chunkSizeInBytes,Oe.maxBatchSizeInBytes,this.mc.logger);this.remoteMessageProcessor=new k.RemoteMessageProcessor(cs,new k.OpDecompressor(this.mc.logger),ni);const Mi=qi;this.pendingStateManager=new L.PendingStateManager({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,connected:()=>this.connected,reSubmitBatch:this.reSubmitBatch.bind(this),isActiveConnection:()=>this.innerDeltaManager.active,isAttached:()=>this.attachState!==a.AttachState.Detached},Mi?.pending,this.baseLogger);let $n=this.innerDeltaManager;this.useDeltaManagerOpsProxy=this.mc.config.getBoolean("Fluid.ContainerRuntime.DeltaManagerOpsProxy")===!0,$n=E.DeltaManagerSummarizerProxy.wrapIfSummarizer($n),this.useDeltaManagerOpsProxy&&($n=new E.DeltaManagerPendingOpsProxy($n,this.pendingStateManager)),this._deltaManager=$n instanceof E.BaseDeltaManagerProxy?$n:new E.BaseDeltaManagerProxy($n),this.handleContext=new p.ContainerFluidHandleContext("",this),this.summaryConfiguration.state==="enabled"&&(0,se.validateSummaryHeuristicConfiguration)(this.summaryConfiguration),this.summariesDisabled=(0,se.isSummariesDisabled)(this.summaryConfiguration),this.maxConsecutiveReconnects=this.mc.config.getNumber(pe)??Ke;const Xs=xa.ILayerCompatDetails===void 0?Ys?.get("referenceSequenceNumbers")===!0:!0;if(Oe.flushMode===c.FlushModeExperimental.Async&&!Xs?(this.mc.logger.sendErrorEvent({eventName:"FlushModeFallback"}),this._flushMode=c.FlushMode.TurnBased):this._flushMode=Oe.flushMode,this.offlineEnabled=this.mc.config.getBoolean("Fluid.Container.enableOfflineLoad")??!1,this.offlineEnabled&&this._flushMode!==c.FlushMode.TurnBased){const Gt=new f.UsageError("Offline mode is only supported in turn-based mode");throw this.closeFn(Gt),Gt}if(this.offlineEnabled&&(this.duplicateBatchDetector=new k.DuplicateBatchDetector(xt)),K.attachState===a.AttachState.Attached){const Gt=this._storage?.policies?.maximumCacheDurationMs;if(Gt!==void 0&&Gt>7200*60*1e3)throw new f.UsageError("Driver's maximumCacheDurationMs policy cannot exceed 5 days")}this.garbageCollector=R.GarbageCollector.create({runtime:this,gcOptions:Oe.gcOptions,baseSnapshot:Ne,baseLogger:this.mc.logger,existing:Ve,metadata:me,createContainerMetadata:this.createContainerMetadata,isSummarizerClient:this.isSummarizerClient,getNodePackagePath:async Gt=>this.getGCNodePackagePath(Gt),getLastSummaryTimestampMs:()=>this.messageAtLastSummary?.timestamp,readAndParseBlob:async Gt=>(0,o.readAndParse)(this.storage,Gt),submitMessage:Gt=>this.submit(Gt),sessionExpiryTimerStarted:Mi?.sessionExpiryTimerStarted});const vs=this.deltaManager.initialSequenceNumber,Xr=Ne===void 0||me?.disableIsolatedChannels===!0?void 0:vs;this.summarizerNode=(0,se.createRootSummarizerNodeWithGC)((0,f.createChildLogger)({logger:this.baseLogger,namespace:"SummarizerNode"}),async(Gt,gn,wn)=>this.summarizeInternal(Gt,gn,wn),vs,Xr,{canReuseHandle:!1,gcDisabled:!this.garbageCollector.shouldRunGC},async Gt=>this.getGCDataInternal(Gt),async()=>this.garbageCollector.getBaseGCDetails());const us=(0,h.wrapContext)(this);In!==void 0&&(this.isSnapshotInstanceOfISnapshot=!0),us.submitSignal=(Gt,gn,wn)=>{const Or=gn,Zs=Qe(Or.address,Gt,Or.contents);this.submitSignalFn(Zs,wn)};let Ss=(0,h.getSummaryForDatastores)(Ne,me);Ss!==void 0&&In!==void 0&&(Ss={...In,snapshotTree:Ss}),this.channelCollection=new h.ChannelCollection(Ss,us,this.mc.logger,Gt=>this.garbageCollector.nodeUpdated({...Gt,timestampMs:Gt.timestampMs??this.getCurrentReferenceTimestampMs()}),Gt=>this.garbageCollector.isNodeDeleted(Gt),new Map(xe),async Gt=>Ye),this._deltaManager.on("readonly",this.notifyReadOnlyState),this.blobManager=new m.BlobManager({routeContext:this.handleContext,blobManagerLoadInfo:ot,storage:this.storage,sendBlobAttachOp:(Gt,gn)=>{this.disposed||this.submit({type:j.ContainerMessageType.BlobAttach,contents:void 0},void 0,{localId:Gt,blobId:gn})},blobRequested:Gt=>this.garbageCollector.nodeUpdated({node:{type:"Blob",path:Gt},reason:"Loaded",timestampMs:this.getCurrentReferenceTimestampMs()}),isBlobDeleted:Gt=>this.garbageCollector.isNodeDeleted(Gt),runtime:this,stashedBlobs:Mi?.pendingAttachmentBlobs,createBlobPayloadPending:this.sessionSchema.createBlobPayloadPending===!0}),this.deltaScheduler=new F.DeltaScheduler(this.innerDeltaManager,this,(0,f.createChildLogger)({logger:this.baseLogger,namespace:"DeltaScheduler"})),this.inboundBatchAggregator=new M.InboundBatchAggregator(this.innerDeltaManager,()=>this.clientId,(0,f.createChildLogger)({logger:this.baseLogger,namespace:"InboundBatchAggregator"}));const Ci=(0,e.makeLegacySendBatchFn)(Kt,this.innerDeltaManager);if(this.skipSafetyFlushDuringProcessStack=this.mc.config.getBoolean("Fluid.ContainerRuntime.DisableFlushBeforeProcess")===!0,this.outbox=new k.Outbox({shouldSend:()=>this.shouldSendOps(),pendingStateManager:this.pendingStateManager,submitBatchFn:mn,legacySendBatchFn:Ci,compressor:new k.OpCompressor(this.mc.logger),splitter:cs,config:{compressionOptions:os,maxBatchSizeInBytes:Oe.maxBatchSizeInBytes,flushPartialBatches:this.skipSafetyFlushDuringProcessStack},logger:this.mc.logger,groupingManager:ni,getCurrentSequenceNumbers:()=>({referenceSequenceNumber:this.deltaManager.lastSequenceNumber,clientSequenceNumber:this._processedClientSequenceNumber}),reSubmit:this.reSubmit.bind(this),opReentrancy:()=>this.dataModelChangeRunner.running}),this._quorum=wr,this._quorum.on("removeMember",Gt=>{this.remoteMessageProcessor.clearPartialMessagesFor(Gt)}),this._audience=qn,qn.getSelf===void 0){qn.getSelf=()=>{const gn=this._getClientId();return gn===void 0?void 0:{clientId:gn,client:qn.getMember(gn)}};let Gt=this.clientId;this.on("connected",()=>{const gn=this.clientId;(0,i.assert)(gn!==void 0,2421),qn.emit("selfChanged",{clientId:Gt},{clientId:gn,client:qn.getMember(gn)}),Gt=gn})}const ds=this.mc.config.getNumber("Fluid.ContainerRuntime.Test.CloseSummarizerDelayOverrideMs");this.closeSummarizerDelayMs=ds??Ce,this.lastEmittedDirty=this.computeCurrentDirtyState(),K.updateDirtyContainerState(this.lastEmittedDirty),this.skipSafetyFlushDuringProcessStack||this.deltaManager.on("op",()=>this.flush()),this.baseLogger.send({category:"generic",eventName:"DeviceSpec",...We()}),this.mc.logger.sendTelemetryEvent({eventName:"ContainerLoadStats",...this.createContainerMetadata,...this.channelCollection.containerLoadStats,summaryNumber:Yr,summaryFormatVersion:me?.summaryFormatVersion,disableIsolatedChannels:me?.disableIsolatedChannels,gcVersion:me?.gcFeature,options:JSON.stringify(Oe),idCompressorModeMetadata:me?.documentSchema?.runtime?.idCompressorMode,idCompressorMode:this.sessionSchema.idCompressorMode,sessionRuntimeSchema:JSON.stringify(this.sessionSchema),featureGates:JSON.stringify({...Pe,closeSummarizerDelayOverride:ds,disableFlushBeforeProcess:this.skipSafetyFlushDuringProcessStack}),telemetryDocumentId:this.telemetryDocumentId,groupedBatchingEnabled:this.groupedBatchingEnabled,initialSequenceNumber:this.deltaManager.initialSequenceNumber,minVersionForCollab:this.minVersionForCollab}),(0,_.ReportOpPerfTelemetry)(this.clientId,this._deltaManager,this,this.baseLogger),(0,v.BindBatchTracker)(this,this.baseLogger),this.entryPoint=new i.LazyPromise(async()=>this._summarizer!==void 0?this._summarizer:Ye(this)),this.skipSavedCompressorOps=Mi?.pendingIdCompressorState!==void 0}onSchemaChange(K){this.mc.logger.sendTelemetryEvent({eventName:"SchemaChangeAccept",sessionRuntimeSchema:JSON.stringify(K)}),K.runtime.idCompressorMode!==void 0&&this.loadIdCompressor()}getCreateChildSummarizerNodeFn(K,Z){return(me,we)=>this.summarizerNode.createChild(me,K,Z,void 0,we)}deleteChildSummarizerNode(K){return this.summarizerNode.deleteChild(K)}makeLocallyVisible(){(0,i.assert)(!1,2283)}setChannelDirty(K){(0,i.assert)(!1,2313)}async initializeBaseState(K){(this.sessionSchema.idCompressorMode==="on"||this.sessionSchema.idCompressorMode==="delayed"&&this.connected)&&(f.PerformanceEvent.timedExec(this.mc.logger,{eventName:"CreateIdCompressorOnBoot"},Z=>{this._idCompressor=this.createIdCompressorFn(),Z.end({details:{idCompressorMode:this.sessionSchema.idCompressorMode}})}),(0,i.assert)(this.pendingIdCompressorOps.length===0,2284)),await this.initializeSummarizer(K),await this.garbageCollector.initializeBaseState()}async initializeSummarizer(K){if(this.summariesDisabled){this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});return}const{maxOpsSinceLastSummary:Z=0,initialSummarizerDelayMs:me=0}=(0,se.isSummariesDisabled)(this.summaryConfiguration)?{}:{...this.summaryConfiguration,initialSummarizerDelayMs:this.runtimeOptions.summaryOptions.initialSummarizerDelayMs??this.summaryConfiguration.initialSummarizerDelayMs},we=new se.SummaryCollection(this.deltaManager,this.baseLogger),qe=(0,f.createChildLogger)({logger:this.baseLogger,namespace:"OrderedClientElection"}),xe=new se.OrderedClientCollection(qe,this.innerDeltaManager,this._quorum),Oe=new se.OrderedClientElection(qe,xe,this.electedSummarizerData??this.innerDeltaManager.lastSequenceNumber,se.SummarizerClientElection.isClientEligible,this.mc.config.getBoolean("Fluid.ContainerRuntime.OrderedClientElection.EnablePerformanceEvents"));if(this.summarizerClientElection=new se.SummarizerClientElection(qe,we,Oe,Z),this.isSummarizerClient){const He=await Zk(()=>import("./index-CyHRQ8OR.js").then(Se=>Se.i),[]);this._summarizer=new He.Summarizer(this,()=>this.summaryConfiguration,this,this.handleContext,we,async Se=>He.RunWhileConnectedCoordinator.create(Se,()=>this.innerDeltaManager.active))}else if(se.SummarizerClientElection.clientDetailsPermitElection(this.clientDetails)){const He=()=>{we.opsSinceLastAck>Z&&(this.mc.logger.sendTelemetryEvent({eventName:"SummaryStatus:Behind"}),we.once(s.MessageType.SummaryAck,()=>{this.mc.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),we.on("default",He)}),we.off("default",He))};we.on("default",He),this.summaryManager=new se.SummaryManager(this.summarizerClientElection,this,we,this.baseLogger,(0,se.formCreateSummarizerFn)(K),new re.Throttler(60*1e3,30*1e3,(0,re.formExponentialFn)({coefficient:20,initialDelay:0})),{initialDelayMs:me});for(const Se of["summarize","summarizeAllAttemptsFailed","summarizerStop","summarizerStart","summarizerStartupFailed"])this.summaryManager?.on(Se,(...Ve)=>{this.emit(Se,...Ve)});this.summaryManager.start()}}dispose(K){this._disposed||(this._disposed=!0,this.mc.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},K),this.summaryManager!==void 0&&this.summaryManager.dispose(),this.garbageCollector.dispose(),this._summarizer?.dispose(),this.channelCollection.dispose(),this.pendingStateManager.dispose(),this.inboundBatchAggregator.dispose(),this.deltaScheduler.dispose(),this._deltaManager.dispose(),this.emit("dispose"),this.removeAllListeners())}async getSnapshotForLoadingGroupId(K,Z){const me=K.sort();(0,i.assert)(this.storage.getSnapshot!==void 0,2285);let we=!0;const qe=await this.snapshotCacheForLoadingGroupIds.addOrGet(me.join(","),async()=>((0,i.assert)(this.storage.getSnapshot!==void 0,2286),we=!1,this.storage.getSnapshot({cacheSnapshot:!1,scenarioName:"snapshotForLoadingGroupId",loadingGroupIds:me})));this.mc.logger.sendTelemetryEvent({eventName:"GroupIdSnapshotFetched",details:JSON.stringify({fromCache:we,loadingGroupIds:K.join(",")})});const xe=(0,se.rootHasIsolatedChannels)(this.metadata),Oe=this.getSnapshotTreeForPath(qe.snapshotTree,Z,xe);(0,i.assert)(Oe!==void 0,2287);const He=qe.sequenceNumber;if((0,i.assert)(He!==void 0,2288),He<this.deltaManager.initialSequenceNumber)throw f.DataProcessingError.create("Downloaded snapshot older than snapshot we loaded from","getSnapshotForLoadingGroupId",void 0,{loadingGroupIds:me.join(","),snapshotSeqNumber:He,initialSequenceNumber:this.deltaManager.initialSequenceNumber});if(He>this.deltaManager.lastSequenceNumber){if(this._summarizer!==void 0)throw new Error("Summarizer client behind, loaded newer snapshot with loadingGroupId");const Se={eventName:"GroupIdSnapshotCatchup",loadingGroupIds:me.join(","),targetSequenceNumber:He,sequenceNumber:this.deltaManager.lastSequenceNumber},Ve=f.PerformanceEvent.start(this.mc.logger,{...Se});this._deltaManager.inbound.paused&&(Se.inboundPaused=this._deltaManager.inbound.paused);const ot=new i.Deferred;this.deltaManager.on("op",mt=>{mt.sequenceNumber>=He&&ot.resolve(!0)}),await ot.promise,Ve.end(Se)}return{snapshotTree:Oe,sequenceNumber:He}}getSnapshotTreeForPath(K,Z,me){let we=K;for(const qe of Z)me&&(we=we?.trees[c.channelsTreeName]),we=we?.trees[qe];return we}async request(K){try{const Z=l.RequestParser.create(K);return Z.pathParts[0]===se.summarizerRequestUrl&&Z.pathParts.length===1?this._summarizer!==void 0?{status:200,mimeType:"fluid/object",value:this._summarizer}:(0,l.create404Response)(K):this.requestHandler!==void 0?this.requestHandler(Z,this):(0,l.create404Response)(K)}catch(Z){return(0,l.exceptionToResponse)(Z)}}async resolveHandle(K){try{const Z=l.RequestParser.create(K),me=Z.pathParts[0];if(me==="_channels")return this.resolveHandle(Z.createSubRequest(1));if(me===m.blobManagerBasePath&&Z.isLeaf(2)){const we=Z.pathParts[1],qe=Z.headers?.[l.RuntimeHeaders.payloadPending]===!0;return!this.blobManager.hasBlob(we)&&Z.headers?.[l.RuntimeHeaders.wait]===!1?(0,l.create404Response)(K):{status:200,mimeType:"fluid/object",value:await this.blobManager.getBlob(we,qe)}}else if(Z.pathParts.length>0)return await this.channelCollection.request(K);return(0,l.create404Response)(K)}catch(Z){return(0,l.exceptionToResponse)(Z)}}async getEntryPoint(){return this.entryPoint}internalId(K){return this.channelCollection.internalId(K)}addMetadataToSummary(K){const Z=(0,se.extractSummaryMetadataMessage)(this.deltaManager.lastMessage)??this.messageAtLastSummary,me=this.documentsSchemaController.summarizeDocumentSchema(this.deltaManager.lastSequenceNumber),we=me?.runtime.explicitSchemaControl,qe={...this.createContainerMetadata,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,...this.garbageCollector.getMetadata(),telemetryDocumentId:this.telemetryDocumentId,message:we?{sequenceNumber:-1}:Z,lastMessage:we?Z:void 0,documentSchema:me};(0,l.addBlobToSummary)(K,se.metadataBlobName,JSON.stringify(qe))}addContainerStateToSummary(K,Z,me,we){if(this.addMetadataToSummary(K),this._idCompressor){const Se=JSON.stringify(this._idCompressor.serialize(!1));(0,l.addBlobToSummary)(K,se.idCompressorBlobName,Se)}if(this.remoteMessageProcessor.partialMessages.size>0){const Se=JSON.stringify([...this.remoteMessageProcessor.partialMessages]);(0,l.addBlobToSummary)(K,se.chunksBlobName,Se)}const qe=this.duplicateBatchDetector?.getRecentBatchInfoForSummary(we);qe!==void 0&&(0,l.addBlobToSummary)(K,se.recentBatchInfoBlobName,JSON.stringify(qe));const xe=this.channelCollection.aliases;if(xe.size>0&&(0,l.addBlobToSummary)(K,se.aliasBlobName,JSON.stringify([...xe])),this.summarizerClientElection){const Se=JSON.stringify(this.summarizerClientElection?.serialize());(0,l.addBlobToSummary)(K,se.electedSummarizerBlobName,Se)}const Oe=this.blobManager.summarize();Object.keys(Oe.summary.tree).length>0&&(0,l.addSummarizeResultToSummary)(K,m.blobsTreeName,Oe);const He=this.garbageCollector.summarize(Z,me,we);He!==void 0&&(0,l.addSummarizeResultToSummary)(K,c.gcTreeKey,He)}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0?!0:this.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0)}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.shouldSendOps())return;const K=this.lastEmittedDirty;(0,i.assert)(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;try{this.submitIdAllocationOpIfNeeded({resubmitOutstandingRanges:!0,staged:!1}),this.scheduleFlush(),this.pendingStateManager.replayPendingStates()}finally{this.lastEmittedDirty=K,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState()}parseLocalOpContent(K){(0,i.assert)(K!==void 0,1749);const Z=JSON.parse(K);return(0,i.assert)(Z.type!==void 0,1750),Z}async applyStashedOp(K){const Z=this.parseLocalOpContent(K);switch(Z.type){case j.ContainerMessageType.FluidDataStoreOp:case j.ContainerMessageType.Attach:case j.ContainerMessageType.Alias:return this.channelCollection.applyStashedOp(Z);case j.ContainerMessageType.IdAllocation:{(0,i.assert)(this.sessionSchema.idCompressorMode!==void 0,2289);return}case j.ContainerMessageType.DocumentSchemaChange:return;case j.ContainerMessageType.BlobAttach:return;case j.ContainerMessageType.Rejoin:throw new Error("rejoin not expected here");case j.ContainerMessageType.GC:throw new f.LoggingError("GC op not expected to be stashed in summarizer");default:{const me=fe(Z.type,"applyStashedOp");throw this.closeFn(me),me}}}loadIdCompressor(){this._idCompressor===void 0&&this.sessionSchema.idCompressorMode!==void 0&&(f.PerformanceEvent.timedExec(this.mc.logger,{eventName:"CreateIdCompressorOnDelayedLoad"},K=>{this._idCompressor=this.createIdCompressorFn();const Z=this.pendingIdCompressorOps;this.pendingIdCompressorOps=[];const me=n.Trace.start();for(const we of Z)this._idCompressor.finalizeCreationRange(we);K.end({details:{finalizeCreationRangeDuration:me.trace().duration,idCompressorMode:this.sessionSchema.idCompressorMode,pendingIdCompressorOps:Z.length}})}),(0,i.assert)(this.pendingIdCompressorOps.length===0,2422))}setConnectionState(K,Z){const me=this._audience.getSelf()?.clientId;(0,i.assert)(Z===me,2423),(0,i.assert)(this.clientId===me,2424),K&&this.sessionSchema.idCompressorMode==="delayed"&&this.loadIdCompressor(),this.setConnectionStateCore(K,Z)}setConnectionStateCore(K,Z){this.verifyNotClosed();const me=this.canSendOps!==K,we=me&&!K;if(me&&K&&this.flush(),this.canSendOps=K,K&&((0,i.assert)(this.attachState===a.AttachState.Attached,973),me&&this.signalTelemetryManager.resetTracking()),we&&(this.consecutiveReconnects++,!this.shouldContinueReconnecting())){this.closeFn(f.DataProcessingError.create("Runtime detected too many reconnects with no progress syncing local ops.","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingMessagesCount}));return}me&&this.replayPendingStates(),this.channelCollection.setConnectionState(K,Z),this.garbageCollector.setConnectionState(K,Z),(0,f.raiseConnectedEvent)(this.mc.logger,this,this.connected,Z),this.emitServiceConnectionEvents(me,K,Z)}emitServiceConnectionEvents(K,Z,me){if(!this.getConnectionState)return;const we=this.getConnectionState()===t.ConnectionState.Connected,qe=this.canSendSignals!==we;this.canSendSignals=we,qe?we?this.emit("connectedToService",me,Z):this.emit("disconnectedFromService"):K&&this.emit("connectionTypeChanged",Z)}async notifyOpReplay(K){await this.pendingStateManager.applyStashedOpsAt(K.sequenceNumber)}process({...K},Z){this.verifyNotClosed(),this.skipSafetyFlushDuringProcessStack||this.flush(),this.ensureNoDataModelChanges(()=>{this.processInboundMessageOrBatch(K,Z)})}processInboundMessageOrBatch(K,Z){const me=K.type===s.MessageType.Operation,we=K.metadata?.savedOp,qe=(0,e.getSingleUseLegacyLogCallback)(this.mc.logger,K.type);let xe=me||Fe(K);if(xe&&(0,k.ensureContentsDeserialized)(K),me){const Oe=this.remoteMessageProcessor.process(K,qe);if(Oe===void 0)return;if("batchStart"in Oe){const Ve=Oe.batchStart,ot=this.duplicateBatchDetector?.processInboundBatch(Ve);if(ot?.duplicate){const mt=new f.DataCorruptionError("Duplicate batch - The same batch was sequenced twice",{batchId:Ve.batchId});throw this.mc.logger.sendTelemetryEvent({eventName:"DuplicateBatch",details:{batchId:Ve.batchId,clientId:Ve.clientId,batchStartCsn:Ve.batchStartCsn,size:Oe.length,duplicateBatchSequenceNumber:ot.otherSequenceNumber,...(0,f.extractSafePropertiesFromMessage)(Ve.keyMessage)}},mt),mt}}let He=this.pendingStateManager.processInboundMessages(Oe,Z);Oe.type!=="fullBatch"&&(0,i.assert)(He.length===1,2621),He.length===0&&((0,i.assert)(Oe.type==="fullBatch",2622),He=[{message:Oe.batchStart.keyMessage,localOpMetadata:void 0}],xe=!1);const Se=Oe.type==="fullBatch"?{batchStart:!0,batchEnd:!0}:Oe.type==="batchStartingMessage"?{batchStart:!0,batchEnd:!1}:{batchStart:!1,batchEnd:Oe.batchEnd===!0};this.processInboundMessages(He,Se,Z,we,xe,Oe.type==="fullBatch"?Oe.groupedBatch:!1)}else this.processInboundMessages([{message:K,localOpMetadata:void 0}],{batchStart:!0,batchEnd:!0},Z,we,xe,!1);Z&&this.resetReconnectCount()}processInboundMessages(K,Z,me,we,qe,xe){if(this.updateDocumentDirtyState(),Z.batchStart){const He=K[0]?.message;(0,i.assert)(He!==void 0,2609),this.emit("batchBegin",He)}let Oe;try{if(!qe){for(const{message:mt}of K)this.observeNonRuntimeMessage(mt);return}const He=mt=>(mt.minimumSequenceNumber=this.useDeltaManagerOpsProxy&&this.deltaManager.minimumSequenceNumber<mt.minimumSequenceNumber?this.deltaManager.minimumSequenceNumber:mt.minimumSequenceNumber,this._processedClientSequenceNumber=mt.clientSequenceNumber,mt);if(!xe){for(const{message:mt,localOpMetadata:he}of K)He(mt),this.validateAndProcessRuntimeMessages(mt,[{contents:mt.contents,localOpMetadata:he,clientSequenceNumber:mt.clientSequenceNumber}],me,we),this.emit("op",mt,!0);return}let Se=[],Ve;const ot=()=>{(0,i.assert)(Ve!==void 0,2663),this.validateAndProcessRuntimeMessages(Ve,Se,me,we),Se=[]};for(const{message:mt,localOpMetadata:he}of K){const Ue=He(mt);Ve&&Ve.type!==Ue.type&&ot(),Ve=Ue,Se.push({contents:mt.contents,localOpMetadata:he,clientSequenceNumber:mt.clientSequenceNumber})}ot();for(const{message:mt}of K)this.emit("op",mt,!0)}catch(He){throw Oe=He,Oe}finally{if(Z.batchEnd){const He=K[K.length-1]?.message;(0,i.assert)(He!==void 0,2610),this.emit("batchEnd",Oe,He)}}}observeNonRuntimeMessage(K){this.deltaManager.minimumSequenceNumber<K.minimumSequenceNumber&&(K.minimumSequenceNumber=this.deltaManager.minimumSequenceNumber),this._processedClientSequenceNumber=K.clientSequenceNumber,typeof K.contents=="string"&&K.contents!==""&&K.type!==s.MessageType.ClientLeave&&(K.contents=JSON.parse(K.contents)),this.emit("op",K,!1)}validateAndProcessRuntimeMessages(K,Z,me,we){const qe=Z.map(xe=>xe.contents);switch(K.type){case j.ContainerMessageType.FluidDataStoreOp:case j.ContainerMessageType.Attach:case j.ContainerMessageType.Alias:{this.channelCollection.processMessages({envelope:K,messagesContent:Z,local:me});break}case j.ContainerMessageType.BlobAttach:{this.blobManager.processBlobAttachMessage(K,me);break}case j.ContainerMessageType.IdAllocation:{this.processIdCompressorMessages(qe,we);break}case j.ContainerMessageType.GC:{this.garbageCollector.processMessages(qe,K.timestamp,me);break}case j.ContainerMessageType.ChunkedOp:(0,i.assert)(!1,2365);case j.ContainerMessageType.Rejoin:break;case j.ContainerMessageType.DocumentSchemaChange:{this.documentsSchemaController.processDocumentSchemaMessages(qe,me,K.sequenceNumber);break}default:{const xe=fe(K.type,"validateAndProcessRuntimeMessage",K);throw this.closeFn(xe),xe}}}processIdCompressorMessages(K,Z){for(const me of K)this.skipSavedCompressorOps&&Z===!0||(this._idCompressor===void 0?((0,i.assert)(this.sessionSchema.idCompressorMode!==void 0,2364),this.pendingIdCompressorOps.push(me)):((0,i.assert)(this.pendingIdCompressorOps.length===0,2425),this._idCompressor.finalizeCreationRange(me)))}processSignal(K,Z){const me=K.content,we={clientId:K.clientId,content:me.contents.content,type:me.contents.type,targetClientId:K.targetClientId};K.clientId===this.clientId&&this.signalTelemetryManager.trackReceivedSignal(me,this.mc.logger,this.consecutiveReconnects);const qe=me.address;if(qe===void 0){this.emit("signal",we,Z);return}this.routeNonContainerSignal(qe,we,Z)}routeNonContainerSignal(K,Z,me){if(!K.startsWith("/")){const qe={...Z,content:{address:K,contents:Z.content}};this.channelCollection.processSignal(qe,me);return}const we=K.split("/");if(we.length>2&&we[1]==="ext"){const qe=we[2],xe=this.extensions.get(qe);if(xe!==void 0){xe.extension.processSignal?.(we.slice(3),Z,me);return}}(0,i.assert)(!me,2976),this.mc.logger.sendTelemetryEvent({eventName:"SignalAddressNotFound",...(0,f.tagCodeArtifacts)({address:K})})}flush(K){this.flushScheduled=!1;try{(0,i.assert)(!this.batchRunner.running,588),this.outbox.flush(K),(0,i.assert)(this.outbox.isEmpty,975)}catch(Z){const me=(0,f.normalizeError)(Z,{props:{orderSequentiallyCalls:this.batchRunner.runs}});throw this.closeFn(me),me}}orderSequentially(K){let Z,me;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(!this.batchRunner.running&&!this.inStagingMode&&(me=this.enterStagingMode()),Z=this.outbox.getBatchCheckpoints().mainBatch);const we=this.batchRunner.run(()=>{try{return K()}catch(qe){if(Z)try{Z.rollback(xe=>this.rollbackStagedChange(xe.runtimeOp,xe.localOpMetadata)),this.updateDocumentDirtyState(),me?.discardChanges(),me=void 0}catch(xe){const Oe=(0,f.wrapError)(xe,He=>f.DataProcessingError.create(`RollbackError: ${He}`,"checkpointRollback",void 0));throw this.closeFn(Oe),Oe}else this.closeFn((0,f.wrapError)(qe,xe=>new f.GenericError(`orderSequentially callback exception: ${xe}`,qe,{orderSequentiallyCalls:this.batchRunner.runs})));throw qe}});return me?.commitChanges({squash:!1}),this.flushMode!==c.FlushMode.TurnBased&&!this.batchRunner.running&&this.flush(),we}get inStagingMode(){return this.stageControls!==void 0}async getAliasedDataStoreEntryPoint(K){await this.channelCollection.waitIfPendingAlias(K);const Z=this.internalId(K),me=await this.channelCollection.getDataStoreIfAvailable(Z,{wait:!1});if(me===void 0||!await me.isRoot())return;const we=await me.realize();if(we.entryPoint===void 0)throw new f.UsageError("entryPoint must be defined on data store runtime for using getAliasedDataStoreEntryPoint");return this.garbageCollector.nodeUpdated({node:{type:"DataStore",path:`/${Z}`},reason:"Loaded",packagePath:me.packagePath,timestampMs:this.getCurrentReferenceTimestampMs()}),we.entryPoint}createDetachedDataStore(K,Z){return this.channelCollection.createDetachedDataStore(K,Z)}async createDataStore(K,Z){const me=this.channelCollection.createDataStoreContext(Array.isArray(K)?K:[K],Z);return(0,w.channelToDataStore)(await me.realize(),me.id,this.channelCollection,this.mc.logger)}shouldSendOps(){return this.connected&&!this.innerDeltaManager.readOnlyInfo.readonly}getQuorum(){return this._quorum}getAudience(){return this._audience}get isDirty(){return this.lastEmittedDirty}computeCurrentDirtyState(){return this.attachState!==a.AttachState.Attached||this.pendingStateManager.hasPendingUserChanges()||this.outbox.containsUserChanges()}submitSignal(K,Z,me){this.verifyNotClosed();const we=Qe(void 0,K,Z);this.submitSignalFn(we,me)}setAttachState(K){K===a.AttachState.Attaching?(0,i.assert)(this.attachState===a.AttachState.Attaching,301):((0,i.assert)(this.attachState===a.AttachState.Attached,302),this.emit("attached")),this.updateDocumentDirtyState(),this.channelCollection.setAttachState(K)}createSummary(K,Z){K&&this.blobManager.setRedirectTable(K);const me=this._idCompressor?.takeNextCreationRange();me!==void 0&&((0,i.assert)(me.ids===void 0||me.ids.firstGenCount===1,2366),this._idCompressor?.finalizeCreationRange(me));const we=this.channelCollection.getAttachSummary(Z);return(0,se.wrapSummaryInChannelsTree)(we),this.addContainerStateToSummary(we,!0,!1,Z),we.summary}async summarizeInternal(K,Z,me){const we=await this.channelCollection.summarize(K,Z,me);(0,se.wrapSummaryInChannelsTree)(we);const qe=[c.channelsTreeName];return this.loadIdCompressor(),this.addContainerStateToSummary(we,K,Z,me),{...we,id:"",pathPartsForChildren:qe}}async summarize(K){this.verifyNotClosed();const{fullTree:Z=!1,trackState:me=!0,summaryLogger:we=this.mc.logger,runGC:qe=this.garbageCollector.shouldRunGC,runSweep:xe,fullGC:Oe}=K,He=new l.TelemetryContext;He.setMultiple("fluid_Summarize","Options",{fullTree:Z,trackState:me,runGC:qe,fullGC:Oe,runSweep:xe});try{qe&&await this.collectGarbage({logger:we,runSweep:xe,fullGC:Oe},He);const{stats:Se,summary:Ve}=await this.summarizerNode.summarize(Z,me,He);return(0,i.assert)(Ve.type===r.SummaryType.Tree,303),{stats:Se,summary:Ve}}finally{we.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:He.serialize()})}}async getGCDataInternal(K){return this.channelCollection.getGCData(K)}async getGCData(K){const Z=new l.GCDataBuilder,me=await this.summarizerNode.getGCData(K);Z.addNodes(me.gcNodes);const we=this.blobManager.getGCData(K);return Z.addNodes(we.gcNodes),Z.getGCData()}updateUsedRoutes(K){this.summarizerNode.updateUsedRoutes([""]);const{dataStoreRoutes:Z}=this.getDataStoreAndBlobManagerRoutes(K);this.channelCollection.updateUsedRoutes(Z)}deleteSweepReadyNodes(K){const{dataStoreRoutes:Z,blobManagerRoutes:me}=this.getDataStoreAndBlobManagerRoutes(K);return[...this.channelCollection.deleteSweepReadyNodes(Z),...this.blobManager.deleteSweepReadyNodes(me)]}updateTombstonedRoutes(K){const{dataStoreRoutes:Z}=this.getDataStoreAndBlobManagerRoutes(K);this.channelCollection.updateTombstonedRoutes(Z)}getCurrentReferenceTimestampMs(){return this.deltaManager.lastMessage?.timestamp??this.messageAtLastSummary?.timestamp}getNodeType(K){return(0,m.isBlobPath)(K)?R.GCNodeType.Blob:this.channelCollection.getGCNodeType(K)??R.GCNodeType.Other}async getGCNodePackagePath(K){if(K==="/")return["_gcRoot"];switch(this.getNodeType(K)){case R.GCNodeType.Blob:return[m.blobManagerBasePath];case R.GCNodeType.DataStore:case R.GCNodeType.SubDataStore:return this.channelCollection.getDataStorePackagePath(K);default:(0,i.assert)(!1,734)}}getDataStoreAndBlobManagerRoutes(K){const Z=[],me=[];for(const we of K)(0,m.isBlobPath)(we)?Z.push(we):me.push(we);return{blobManagerRoutes:Z,dataStoreRoutes:me}}async collectGarbage(K,Z){return this.garbageCollector.collectGarbage(K,Z)}addedGCOutboundRoute(K,Z,me){const we=me??this.getCurrentReferenceTimestampMs();if(we===void 0){this.mc.logger.sendTelemetryEvent({eventName:"NoTimestampInGCOutboundRoute",...(0,f.tagCodeArtifacts)({id:Z,fromId:K})});return}this.garbageCollector.addedOutboundReference(K,Z,we)}async submitSummary(K){const{cancellationToken:Z,fullTree:me=!1,finalAttempt:we=!1,summaryLogger:qe,latestSummaryRefSeqNum:xe}=K,Oe=this.nextSummaryNumber;let He;const Se=(0,f.createChildLogger)({logger:qe,properties:{all:{summaryNumber:Oe,referenceSequenceNumber:()=>He}}});if(!this.outbox.isEmpty)throw f.DataProcessingError.create("Can't trigger summary in the middle of a batch","submitSummary",void 0,{summaryNumber:Oe,pendingMessages:this.pendingMessagesCount,outboxLength:this.outbox.messageCount,mainBatchLength:this.outbox.mainBatchMessageCount,blobAttachBatchLength:this.outbox.blobAttachBatchMessageCount,idAllocationBatchLength:this.outbox.idAllocationBatchMessageCount});if(this.isDirty){const mt=this.pendingMessagesCount,he=this.mc.config.getNumber("Fluid.Summarizer.waitForPendingOpsTimeoutMs")??e.defaultPendingOpsWaitTimeoutMs;await new Promise((Pe,Ye)=>{const ke=setTimeout(()=>Pe(),he);this.once("saved",()=>{clearTimeout(ke),Pe()}),this.once("dispose",()=>{clearTimeout(ke),Ye(new Error("Runtime is disposed while summarizing"))})}),Se.sendTelemetryEvent({eventName:"PendingOpsWhileSummarizing",saved:!this.isDirty,timeout:he,countBefore:mt,countAfter:this.pendingMessagesCount});const Ue=await this.shouldFailSummaryOnPendingOps(Se,this.deltaManager.lastSequenceNumber,this.deltaManager.minimumSequenceNumber,we,!0);if(Ue!==void 0)return Ue}const Ve=this.mc.config.getBoolean("Fluid.ContainerRuntime.SubmitSummary.disableInboundSignalPause")!==!0,ot=this.mc.config.getBoolean("Fluid.ContainerRuntime.SubmitSummary.shouldValidatePreSummaryState")===!0;try{await this._deltaManager.inbound.pause(),Ve&&await this.deltaManager.inboundSignal.pause(),He=this.deltaManager.lastSequenceNumber;const mt=this.deltaManager.minimumSequenceNumber,he=`Summary @${He}:${this.deltaManager.minimumSequenceNumber}`,Ue=this.lastAckedSummaryContext,Pe=this.summarizerNode.startSummary(He,Se,xe);if((Pe.invalidNodes>0||Pe.mismatchNumbers.size>0)&&(qe.sendTelemetryEvent({eventName:"LatestSummaryRefSeqNumMismatch",details:{...Pe,mismatchNumbers:[...Pe.mismatchNumbers]}}),ot&&!we))return{stage:"base",referenceSequenceNumber:He,minimumSequenceNumber:mt,error:new se.RetriableSummaryError("Summarizer node state inconsistent with summarizer state.")};const Ye=()=>Z.cancelled?{continue:!1,error:"disconnected"}:((0,i.assert)(this.connected,600),this.deltaManager.lastSequenceNumber!==He?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${He}`}:((0,i.assert)(He===this.deltaManager.lastMessage?.sequenceNumber,917),Ue!==this.lastAckedSummaryContext?{continue:!1,error:`Last summary changed while summarizing. ${this.lastAckedSummaryContext} !== ${Ue}`}:{continue:!0}));let ke=Ye();if(!ke.continue)return{stage:"base",referenceSequenceNumber:He,minimumSequenceNumber:mt,error:new se.RetriableSummaryError(ke.error)};const Rt=n.Trace.start();let Ft;try{Ft=await this.summarize({fullTree:me,trackState:!0,summaryLogger:Se,runGC:this.garbageCollector.shouldRunGC})}catch(In){return{stage:"base",referenceSequenceNumber:He,minimumSequenceNumber:mt,error:(0,f.wrapError)(In,Si=>new se.RetriableSummaryError(Si))}}const xt=this.summarizerNode.validateSummary();if(!xt.success){const{success:In,...Si}=xt,xa=new se.RetriableSummaryError(xt.reason,xt.retryAfterSeconds,{...Si});return{stage:"base",referenceSequenceNumber:He,minimumSequenceNumber:mt,error:xa}}const zt=await this.shouldFailSummaryOnPendingOps(Se,He,mt,we,!1);if(zt!==void 0)return zt;const{summary:fn,stats:je}=Ft;this.messageAtLastSummary=this.deltaManager.lastMessage;const Ne=fn.tree[c.channelsTreeName];(0,i.assert)(Ne.type===r.SummaryType.Tree,508);const Kt=Object.values(Ne.tree).filter(In=>In.type===r.SummaryType.Handle).length,mn=fn.tree[c.gcTreeKey]?(0,l.calculateStats)(fn.tree[c.gcTreeKey]):void 0,er={dataStoreCount:this.channelCollection.size,summarizedDataStoreCount:this.channelCollection.size-Kt,gcStateUpdatedDataStoreCount:this.garbageCollector.updatedDSCountSinceLastSummary,gcBlobNodeCount:mn?.blobNodeCount,gcTotalBlobsSize:mn?.totalBlobSize,summaryNumber:Oe,...je},ji={referenceSequenceNumber:He,minimumSequenceNumber:mt,summaryTree:fn,summaryStats:er,generateDuration:Rt.trace().duration};if(ke=Ye(),!ke.continue)return{stage:"generate",...ji,error:new se.RetriableSummaryError(ke.error)};const Qs={proposalHandle:this.lastAckedSummaryContext?.proposalHandle??void 0,ackHandle:this.lastAckedSummaryContext?.ackHandle??this.loadedFromVersionId,referenceSequenceNumber:He};let Qr;try{Qr=await this.storage.uploadSummaryWithContext(fn,Qs)}catch(In){return{stage:"generate",...ji,error:(0,f.wrapError)(In,Si=>new se.RetriableSummaryError(Si))}}const Br=Qs.ackHandle,wr={handle:Qr,head:Br,message:he,parents:Br?[Br]:[]},qn={...ji,handle:Qr,uploadDuration:Rt.trace().duration};if(ke=Ye(),!ke.continue)return{stage:"upload",...qn,error:new se.RetriableSummaryError(ke.error)};let qi;try{qi=this.submitSummaryMessage(wr,He)}catch(In){return{stage:"upload",...qn,error:(0,f.wrapError)(In,Si=>new se.RetriableSummaryError(Si))}}const Ys={stage:"submit",...qn,clientSequenceNumber:qi,submitOpDuration:Rt.trace().duration};try{this.summarizerNode.completeSummary(Qr)}catch(In){return{stage:"upload",...qn,error:(0,f.wrapError)(In,Si=>new se.RetriableSummaryError(Si))}}return Ys}finally{this.summarizerNode.clearSummary(),this._summarizer?.recordSummaryAttempt?.(He),this._deltaManager.inbound.resume(),Ve&&this.deltaManager.inboundSignal.resume()}}async shouldFailSummaryOnPendingOps(K,Z,me,we,qe){if(this.isDirty)if(we&&this.mc.config.getBoolean("Fluid.Summarizer.SkipFailingIncorrectSummary")){const xe=f.DataProcessingError.create("Pending ops during summarization","submitSummary",void 0,{pendingMessages:this.pendingMessagesCount});K.sendErrorEvent({eventName:"SkipFailingIncorrectSummary",referenceSequenceNumber:Z,minimumSequenceNumber:me,beforeGenerate:qe},xe)}else{const xe=this.mc.config.getNumber("Fluid.Summarizer.PendingOpsRetryDelayMs")??e.defaultPendingOpsRetryDelayMs,Oe=new se.RetriableSummaryError("PendingOpsWhileSummarizing",xe/1e3,{count:this.pendingMessagesCount,beforeGenerate:qe});return{stage:"base",referenceSequenceNumber:Z,minimumSequenceNumber:me,error:Oe}}}get pendingMessagesCount(){return this.pendingStateManager.pendingMessagesCount+this.outbox.messageCount}hasPendingMessages(){return this.pendingMessagesCount!==0}updateDocumentDirtyState(){const K=this.computeCurrentDirtyState();this.lastEmittedDirty!==K&&(this.lastEmittedDirty=K,this.emitDirtyDocumentEvent&&this.emit(K?"dirty":"saved"))}submitMessage(K,Z,me=void 0){this.submit({type:K,contents:Z},me)}async uploadBlob(K,Z){return this.verifyNotClosed(),this.blobManager.createBlob(K,Z)}submitIdAllocationOpIfNeeded({resubmitOutstandingRanges:K=!1,staged:Z}){if(this._idCompressor){const me=K?this._idCompressor.takeUnfinalizedCreationRange():this._idCompressor.takeNextCreationRange();if(me.ids!==void 0){const qe={runtimeOp:{type:j.ContainerMessageType.IdAllocation,contents:me},referenceSequenceNumber:this.deltaManager.lastSequenceNumber,staged:Z};this.outbox.submitIdAllocation(qe)}}}submit(K,Z=void 0,me){this.verifyNotClosed(),(0,i.assert)(this.attachState!==a.AttachState.Detached,306),(0,i.assert)(me===void 0||K.type===j.ContainerMessageType.BlobAttach,2367),this.innerDeltaManager.readOnlyInfo.readonly&&this.mc.logger.sendTelemetryEvent({eventName:"SubmitOpInReadonly",connected:this.connected});const we=K.type;(0,i.assert)(we!==j.ContainerMessageType.IdAllocation,2469);try{const qe=this.batchRunner.resubmitInfo?.staged??this.inStagingMode;(0,i.assert)(!qe||Ge(we),3002),qe||this.submitIdAllocationOpIfNeeded({staged:!1});const xe=this.documentsSchemaController.maybeGenerateSchemaMessage();if(xe){this.mc.logger.sendTelemetryEvent({eventName:"SchemaChangeProposal",refSeq:xe.refSeq,version:xe.version,newRuntimeSchema:JSON.stringify(xe.runtime),sessionRuntimeSchema:JSON.stringify(this.sessionSchema),oldRuntimeSchema:JSON.stringify(this.metadata?.documentSchema?.runtime),minVersionForCollab:xe.info?.minVersionForCollab});const He={type:j.ContainerMessageType.DocumentSchemaChange,contents:xe};this.outbox.submit({runtimeOp:He,referenceSequenceNumber:this.deltaManager.lastSequenceNumber,staged:qe})}const Oe={runtimeOp:K,metadata:me,localOpMetadata:Z,referenceSequenceNumber:this.deltaManager.lastSequenceNumber,staged:qe};we===j.ContainerMessageType.BlobAttach?this.outbox.submitBlobAttach(Oe):this.outbox.submit(Oe),this.scheduleFlush()}catch(qe){const xe=f.DataProcessingError.wrapIfUnrecognized(qe,"ContainerRuntime.submit",{referenceSequenceNumber:this.deltaManager.lastSequenceNumber});throw this.closeFn(xe),xe}this.updateDocumentDirtyState()}scheduleFlush(){if(!this.flushScheduled)switch(this.flushScheduled=!0,this.flushMode){case c.FlushMode.Immediate:{this.batchRunner.running||this.flush();break}case c.FlushMode.TurnBased:{Promise.resolve().then(()=>this.flush());break}case c.FlushModeExperimental.Async:{setTimeout(()=>this.flush(),0);break}default:(0,i.fail)(1415)}}submitSummaryMessage(K,Z){return this.verifyNotClosed(),(0,i.assert)(this.connected,307),(0,i.assert)(this.outbox.isEmpty,980),this.submitSummaryFn(K,Z)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmitBatch(K,{batchId:Z,staged:me,squash:we}){(0,i.assert)(this._summarizer===void 0,2290);const qe={batchId:this.offlineEnabled?Z:void 0,staged:me},xe=we?this.reSubmitWithSquashing.bind(this):this.reSubmit.bind(this);this.batchRunner.run(()=>{for(const Oe of K)xe(Oe)},qe),this.flush(qe)}reSubmitWithSquashing(K){const Z=K.runtimeOp;switch((0,i.assert)(Ge(Z.type),3003),Z.type){case j.ContainerMessageType.FluidDataStoreOp:{this.channelCollection.reSubmit(Z.type,Z.contents,K.localOpMetadata,!0);break}case j.ContainerMessageType.GC:case j.ContainerMessageType.DocumentSchemaChange:{this.reSubmit(K);break}default:(0,i.unreachableCase)(Z.type)}}reSubmit({runtimeOp:K,localOpMetadata:Z,opMetadata:me}){switch(K.type){case j.ContainerMessageType.FluidDataStoreOp:case j.ContainerMessageType.Attach:case j.ContainerMessageType.Alias:{this.channelCollection.reSubmit(K.type,K.contents,Z,!1);break}case j.ContainerMessageType.IdAllocation:break;case j.ContainerMessageType.BlobAttach:{this.blobManager.reSubmit(me);break}case j.ContainerMessageType.Rejoin:{this.submit(K);break}case j.ContainerMessageType.GC:{this.submit(K);break}case j.ContainerMessageType.DocumentSchemaChange:{this.documentsSchemaController.pendingOpNotAcked();break}default:{const we=fe(K.type,"reSubmitCore");throw this.closeFn(we),we}}}rollbackStagedChange({type:K,contents:Z},me){switch((0,i.assert)(Ge(K),3004),K){case j.ContainerMessageType.FluidDataStoreOp:{this.channelCollection.rollback(K,Z,me);break}case j.ContainerMessageType.GC:{this.mc.logger.sendErrorEvent({eventName:"GC_OpDiscarded",details:{subType:Z.type}});break}case j.ContainerMessageType.DocumentSchemaChange:{this.documentsSchemaController.pendingOpNotAcked();break}default:(0,i.unreachableCase)(K)}}async refreshLatestSummaryAck(K){const{proposalHandle:Z,ackHandle:me,summaryRefSeq:we,summaryLogger:qe}=K;(0,i.assert)(Z!==void 0,1894);const xe=await this.summarizerNode.refreshLatestSummary(Z,we);if(!xe.isSummaryTracked){xe.isSummaryNewer&&await this.fetchLatestSnapshotAndMaybeClose(we,me,qe);return}await this.garbageCollector.refreshLatestSummary(xe),this.lastAckedSummaryContext={proposalHandle:Z,ackHandle:me,referenceSequenceNumber:we}}async fetchLatestSnapshotAndMaybeClose(K,Z,me){await f.PerformanceEvent.timedExecAsync(me,{eventName:"RefreshLatestSummaryAckFetch"},async qe=>{const xe={targetRefSeq:K,targetAckHandle:Z},Oe=n.Trace.start();let He;const Se="RefreshLatestSummaryAckFetch";if(this.isSnapshotInstanceOfISnapshot&&this.storage.getSnapshot!==void 0&&this.mc.config.getBoolean("Fluid.Container.UseLoadingGroupIdForSnapshotFetch2")===!0){const ot=await this.storage.getSnapshot({scenarioName:Se,fetchSource:s.FetchSource.noCache}),mt=ot.snapshotTree.id;(0,i.assert)(mt!==void 0,2512),xe.snapshotVersion=mt,He=ot.snapshotTree}else{const ot=await this.storage.getVersions(null,1,Se,s.FetchSource.noCache);(0,i.assert)(!!ot&&!!ot[0],311),He=await this.storage.getSnapshotTree(ot[0]),(0,i.assert)(!!He,312),xe.snapshotVersion=ot[0].id}xe.getSnapshotDuration=Oe.trace().duration;const Ve=await(0,l.seqFromTree)(He,this.readAndParseBlob);return xe.snapshotRefSeq=Ve,xe.newerSnapshotPresent=Ve>=K,qe.end({details:xe}),Ve})<K||(await(0,i.delay)(this.closeSummarizerDelayMs),this._summarizer?.stop("latestSummaryStateStale"),this.disposeFn())}getPendingLocalState(K){if(this.inStagingMode)throw new f.UsageError("getPendingLocalState is not yet supported in staging mode");if(this.verifyNotClosed(),K?.notifyImminentClosure)throw new f.UsageError("notifyImminentClosure is no longer supported in ContainerRuntime");if(this.batchRunner.running)throw new f.UsageError("can't get state while manually accumulating a batch");return this.flush(),f.PerformanceEvent.timedExec(this.mc.logger,{eventName:"getPendingLocalState"},Z=>{const me=this.pendingStateManager.getLocalState(K?.snapshotSequenceNumber),we=K?.sessionExpiryTimerStarted??this.garbageCollector.sessionExpiryTimerStarted,qe=this._idCompressor?.serialize(!0),xe=this.blobManager.getPendingBlobs(),Oe={pending:me,pendingIdCompressorState:qe,pendingAttachmentBlobs:xe,sessionExpiryTimerStarted:we};return Z.end({attachmentBlobsSize:Object.keys(xe??{}).length,pendingOpsSize:Oe?.pending?.pendingStates.length}),Oe})}summarizeOnDemand(K){if(this._summarizer!==void 0)return this._summarizer.summarizeOnDemand(K);if(this.summaryManager===void 0)throw new f.UsageError(`Can't summarize, disableSummaries: ${this.summariesDisabled}`);return this.summaryManager.summarizeOnDemand(K)}enqueueSummarize(K){if(this._summarizer!==void 0)return this._summarizer.enqueueSummarize(K);if(this.summaryManager===void 0)throw new f.UsageError(`Can't summarize, disableSummaries: ${this.summariesDisabled}`);return this.summaryManager.enqueueSummarize(K)}getJoinedStatus(){const K=this.getConnectionState;if(K){if(K()===t.ConnectionState.Connected)return this.canSendOps?"joinedForWriting":"joinedForReading"}else if(this.canSendOps)return"joinedForWriting";return"disconnected"}acquireExtension(K,Z,...me){let we=this.extensions.get(K);if(we===void 0){const qe={getJoinedStatus:this.getJoinedStatus.bind(this),getClientId:()=>this.clientId,events:this.lazyEventsForExtensions.value,logger:this.baseLogger,submitAddressedSignal:(xe,Oe)=>{this.submitExtensionSignal(K,xe,Oe)},getQuorum:this.getQuorum.bind(this),getAudience:this.getAudience.bind(this),supportedFeatures:this.ILayerCompatDetails.supportedFeatures};we=new Z(qe,...me),this.extensions.set(K,we)}else(0,i.assert)(we instanceof Z,2977),we.extension.onNewUse(...me);return we.interface}get groupedBatchingEnabled(){return this.sessionSchema.opGroupingEnabled===!0}}e.ContainerRuntime=Re;function Qe(Me,K,Z){return{address:Me,contents:{type:K,content:Z}}}e.createNewSignalEnvelope=Qe;function Y({type:Me,contents:K}){switch(Me){case j.ContainerMessageType.Attach:{if(K.id===e.agentSchedulerId)return!1;break}case j.ContainerMessageType.FluidDataStoreOp:{if(K.address===e.agentSchedulerId)return!1;break}case j.ContainerMessageType.IdAllocation:case j.ContainerMessageType.DocumentSchemaChange:case j.ContainerMessageType.GC:return!1}return!0}e.isContainerMessageDirtyable=Y})(Cj)),Cj}var d8;function OE(){return d8||(d8=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.dataStoreSupportRequirementsForRuntime=e.loaderSupportRequirementsForRuntime=e.runtimeCompatDetailsForDataStore=e.runtimeCompatDetailsForLoader=e.runtimeCoreCompatDetails=e.unpackRuntimeMessage=e.DefaultSummaryConfiguration=e.DocumentsSchemaController=e.currentDocumentVersionSchema=e.SummaryCollection=e.Summarizer=e.neverCancelledSummaryToken=e.GCNodeType=e.AllowTombstoneRequestHeaderKey=e.ChannelCollectionFactory=e.detectOutboundReferences=e.FluidDataStoreRegistry=e.ContainerMessageType=e.disabledCompressionConfig=e.CompressionAlgorithms=e.InactiveResponseHeaderKey=e.TombstoneResponseHeaderKey=e.DeletedResponseHeaderKey=e.ContainerRuntime=e.agentSchedulerId=e.loadContainerRuntime=void 0;var n=lT();Object.defineProperty(e,"loadContainerRuntime",{enumerable:!0,get:function(){return n.loadContainerRuntime}}),Object.defineProperty(e,"agentSchedulerId",{enumerable:!0,get:function(){return n.agentSchedulerId}}),Object.defineProperty(e,"ContainerRuntime",{enumerable:!0,get:function(){return n.ContainerRuntime}}),Object.defineProperty(e,"DeletedResponseHeaderKey",{enumerable:!0,get:function(){return n.DeletedResponseHeaderKey}}),Object.defineProperty(e,"TombstoneResponseHeaderKey",{enumerable:!0,get:function(){return n.TombstoneResponseHeaderKey}}),Object.defineProperty(e,"InactiveResponseHeaderKey",{enumerable:!0,get:function(){return n.InactiveResponseHeaderKey}});var a=dT();Object.defineProperty(e,"CompressionAlgorithms",{enumerable:!0,get:function(){return a.CompressionAlgorithms}}),Object.defineProperty(e,"disabledCompressionConfig",{enumerable:!0,get:function(){return a.disabledCompressionConfig}});var t=$g();Object.defineProperty(e,"ContainerMessageType",{enumerable:!0,get:function(){return t.ContainerMessageType}});var i=wx();Object.defineProperty(e,"FluidDataStoreRegistry",{enumerable:!0,get:function(){return i.FluidDataStoreRegistry}});var r=use();Object.defineProperty(e,"detectOutboundReferences",{enumerable:!0,get:function(){return r.detectOutboundReferences}}),Object.defineProperty(e,"ChannelCollectionFactory",{enumerable:!0,get:function(){return r.ChannelCollectionFactory}}),Object.defineProperty(e,"AllowTombstoneRequestHeaderKey",{enumerable:!0,get:function(){return r.AllowTombstoneRequestHeaderKey}});var s=CE();Object.defineProperty(e,"GCNodeType",{enumerable:!0,get:function(){return s.GCNodeType}});var o=uT();Object.defineProperty(e,"neverCancelledSummaryToken",{enumerable:!0,get:function(){return o.neverCancelledSummaryToken}}),Object.defineProperty(e,"Summarizer",{enumerable:!0,get:function(){return o.Summarizer}}),Object.defineProperty(e,"SummaryCollection",{enumerable:!0,get:function(){return o.SummaryCollection}}),Object.defineProperty(e,"currentDocumentVersionSchema",{enumerable:!0,get:function(){return o.currentDocumentVersionSchema}}),Object.defineProperty(e,"DocumentsSchemaController",{enumerable:!0,get:function(){return o.DocumentsSchemaController}}),Object.defineProperty(e,"DefaultSummaryConfiguration",{enumerable:!0,get:function(){return o.DefaultSummaryConfiguration}});var u=Ix();Object.defineProperty(e,"unpackRuntimeMessage",{enumerable:!0,get:function(){return u.unpackRuntimeMessage}});var c=Tx();Object.defineProperty(e,"runtimeCoreCompatDetails",{enumerable:!0,get:function(){return c.runtimeCoreCompatDetails}}),Object.defineProperty(e,"runtimeCompatDetailsForLoader",{enumerable:!0,get:function(){return c.runtimeCompatDetailsForLoader}}),Object.defineProperty(e,"runtimeCompatDetailsForDataStore",{enumerable:!0,get:function(){return c.runtimeCompatDetailsForDataStore}}),Object.defineProperty(e,"loaderSupportRequirementsForRuntime",{enumerable:!0,get:function(){return c.loaderSupportRequirementsForRuntime}}),Object.defineProperty(e,"dataStoreSupportRequirementsForRuntime",{enumerable:!0,get:function(){return c.dataStoreSupportRequirementsForRuntime}})})(Sj)),Sj}var l8;function Rx(){if(l8)return D0;l8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(D0,"__esModule",{value:!0}),D0.PureDataObjectFactory=void 0;const e=OE(),n=Je(),a=yx();async function t({ctor:r,context:s,sharedObjectRegistry:o,optionalProviders:u,runtimeClassArg:c,existing:d,initialState:l,policies:f}){let b=c;b=(0,a.mixinRequestHandler)(async(g,_)=>{const S=await _.entryPoint.get();return(0,n.assert)(S.request!==void 0,1941),S.request(g)},b);const C=new b(s,o,d,async g=>((0,n.assert)(h!==void 0,1130),await h.finishInitialization(!0),h),f),m=s.scope.IFluidDependencySynthesizer?.synthesize(u,{})??{},h=new r({runtime:C,context:s,providers:m,initProps:l});return d||await h.finishInitialization(d),{instance:h,runtime:C}}class i{constructor(s,o,u,c,d,l){const f=typeof s=="string"?{type:s,ctor:o,sharedObjects:u,optionalProviders:c,registryEntries:d,runtimeClass:l}:s;if(f.type==="")throw new Error("undefined type member");this.type=f.type,this.createProps={ctor:f.ctor,optionalProviders:f.optionalProviders??{},sharedObjectRegistry:new Map(f.sharedObjects?.map(b=>[b.type,b])),runtimeClassArg:f.runtimeClass??a.FluidDataStoreRuntime,policies:f.policies},f.registryEntries!==void 0&&(this.registry=new e.FluidDataStoreRegistry(f.registryEntries))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(s,o){const{runtime:u}=await t({...this.createProps,context:s,existing:o});return u}async createChildInstance(s,o,u){return this.createNonRootInstanceCore(s.containerRuntime,[...s.packagePath,this.type],o,u)}async createPeerInstance(s,o,u){return this.createNonRootInstanceCore(s.containerRuntime,s.packagePath,o,u)}async createInstance(s,o,u){return this.createNonRootInstanceCore(s,[this.type],o,u)}async createInstanceWithDataStore(s,o,u,c){const d=s.createDetachedDataStore(u??[this.type],c),{instance:l,runtime:f}=await t({...this.createProps,context:d,existing:!1,initialState:o}),b=await d.attachRuntime(this,f);return[l,b]}async createRootInstance(s,o,u){const c=o.createDetachedDataStore([this.type]),{instance:d,runtime:l}=await t({...this.createProps,context:c,existing:!1,initialState:u});if(await(await c.attachRuntime(this,l)).trySetAlias(s)!=="Success"){const C=await o.getAliasedDataStoreEntryPoint(s);return(0,n.assert)(C!==void 0,2273),await C.get()}return d}async createNonRootInstanceCore(s,o,u,c){const d=s.createDetachedDataStore(o,c);return this.createInstanceCore(d,u)}async createInstanceCore(s,o){const{instance:u,runtime:c}=await t({...this.createProps,context:s,existing:!1,initialState:o});return await s.attachRuntime(this,c),u}}return D0.PureDataObjectFactory=i,D0}var f8;function Iye(){if(f8)return g0;f8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(g0,"__esModule",{value:!0}),g0.DataObjectFactory=void 0;const e=yE(),n=Rx();class a extends n.PureDataObjectFactory{constructor(i,r,s,o,u,c){const d=typeof i=="string"?{type:i,ctor:r,sharedObjects:s,optionalProviders:o,registryEntries:u,runtimeClass:c}:{...i},l=d.sharedObjects=[...d.sharedObjects??[]];l.some(f=>f.type===e.DirectoryFactory.Type)||l.push(e.SharedDirectory.getFactory()),l.some(f=>f.type===e.MapFactory.Type)||l.push(e.SharedMap.getFactory()),super(d)}}return g0.DataObjectFactory=a,g0}var cS={},bu={},Vj={},Hj={},vu={},Kj={},Gf={},h8;function fse(){if(h8)return Gf;h8=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.brand=Gf.BrandedType=void 0;const e=Ot();class n{constructor(){}static[Symbol.hasInstance](i){throw new e.UsageError("BrandedType is a compile time type brand not a real class that can be used with `instanceof` at runtime.")}}Gf.BrandedType=n;function a(t){return t}return Gf.brand=a,Gf}var Wf={},Jf={},Qf={},uS={},uc={},Oi={},m8;function Ws(){if(m8)return Oi;m8=1,Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.HasPropertyKey=e,Oi.IsAsyncIterator=n,Oi.IsArray=a,Oi.IsBigInt=t,Oi.IsBoolean=i,Oi.IsDate=r,Oi.IsFunction=s,Oi.IsIterator=o,Oi.IsNull=u,Oi.IsNumber=c,Oi.IsObject=d,Oi.IsRegExp=l,Oi.IsString=f,Oi.IsSymbol=b,Oi.IsUint8Array=C,Oi.IsUndefined=v;function e(m,h){return h in m}function n(m){return d(m)&&!a(m)&&!C(m)&&Symbol.asyncIterator in m}function a(m){return Array.isArray(m)}function t(m){return typeof m=="bigint"}function i(m){return typeof m=="boolean"}function r(m){return m instanceof globalThis.Date}function s(m){return typeof m=="function"}function o(m){return d(m)&&!a(m)&&!C(m)&&Symbol.iterator in m}function u(m){return m===null}function c(m){return typeof m=="number"}function d(m){return typeof m=="object"&&m!==null}function l(m){return m instanceof globalThis.RegExp}function f(m){return typeof m=="string"}function b(m){return typeof m=="symbol"}function C(m){return m instanceof globalThis.Uint8Array}function v(m){return m===void 0}return Oi}var p8;function Na(){if(p8)return uc;p8=1;var e=uc&&uc.__createBinding||(Object.create?(function(l,f,b,C){C===void 0&&(C=b);var v=Object.getOwnPropertyDescriptor(f,b);(!v||("get"in v?!f.__esModule:v.writable||v.configurable))&&(v={enumerable:!0,get:function(){return f[b]}}),Object.defineProperty(l,C,v)}):(function(l,f,b,C){C===void 0&&(C=b),l[C]=f[b]})),n=uc&&uc.__setModuleDefault||(Object.create?(function(l,f){Object.defineProperty(l,"default",{enumerable:!0,value:f})}):function(l,f){l.default=f}),a=uc&&uc.__importStar||(function(){var l=function(f){return l=Object.getOwnPropertyNames||function(b){var C=[];for(var v in b)Object.prototype.hasOwnProperty.call(b,v)&&(C[C.length]=v);return C},l(f)};return function(f){if(f&&f.__esModule)return f;var b={};if(f!=null)for(var C=l(f),v=0;v<C.length;v++)C[v]!=="default"&&e(b,f,C[v]);return n(b,f),b}})();Object.defineProperty(uc,"__esModule",{value:!0}),uc.Clone=d;const t=a(Ws());function i(l){return l.map(f=>c(f))}function r(l){return new Date(l.getTime())}function s(l){return new Uint8Array(l)}function o(l){return new RegExp(l.source,l.flags)}function u(l){const f={};for(const b of Object.getOwnPropertyNames(l))f[b]=c(l[b]);for(const b of Object.getOwnPropertySymbols(l))f[b]=c(l[b]);return f}function c(l){return t.IsArray(l)?i(l):t.IsDate(l)?r(l):t.IsUint8Array(l)?s(l):t.IsRegExp(l)?o(l):t.IsObject(l)?u(l):l}function d(l){return c(l)}return uc}var g8;function Fx(){if(g8)return uS;g8=1,Object.defineProperty(uS,"__esModule",{value:!0}),uS.CloneRest=n,uS.CloneType=a;const e=Na();function n(t){return t.map(i=>a(i))}function a(t,i){return i===void 0?(0,e.Clone)(t):(0,e.Clone)({...i,...t})}return uS}var y8;function hse(){return y8||(y8=1,(function(e){var n=Qf&&Qf.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Qf&&Qf.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Fx(),e),a(Na(),e)})(Qf)),Qf}var Yf={},eO={},dS={},Xf={},Nn={},b8;function mse(){if(b8)return Nn;b8=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.IsAsyncIterator=e,Nn.IsIterator=n,Nn.IsStandardObject=a,Nn.IsInstanceObject=t,Nn.IsPromise=i,Nn.IsDate=r,Nn.IsMap=s,Nn.IsSet=o,Nn.IsRegExp=u,Nn.IsTypedArray=c,Nn.IsInt8Array=d,Nn.IsUint8Array=l,Nn.IsUint8ClampedArray=f,Nn.IsInt16Array=b,Nn.IsUint16Array=C,Nn.IsInt32Array=v,Nn.IsUint32Array=m,Nn.IsFloat32Array=h,Nn.IsFloat64Array=g,Nn.IsBigInt64Array=_,Nn.IsBigUint64Array=S,Nn.HasPropertyKey=p,Nn.IsObject=w,Nn.IsArray=O,Nn.IsUndefined=E,Nn.IsNull=F,Nn.IsBoolean=R,Nn.IsNumber=M,Nn.IsInteger=j,Nn.IsBigInt=k,Nn.IsString=x,Nn.IsFunction=L,Nn.IsSymbol=V,Nn.IsValueType=G;function e(ee){return w(ee)&&globalThis.Symbol.asyncIterator in ee}function n(ee){return w(ee)&&globalThis.Symbol.iterator in ee}function a(ee){return w(ee)&&(globalThis.Object.getPrototypeOf(ee)===Object.prototype||globalThis.Object.getPrototypeOf(ee)===null)}function t(ee){return w(ee)&&!O(ee)&&L(ee.constructor)&&ee.constructor.name!=="Object"}function i(ee){return ee instanceof globalThis.Promise}function r(ee){return ee instanceof Date&&globalThis.Number.isFinite(ee.getTime())}function s(ee){return ee instanceof globalThis.Map}function o(ee){return ee instanceof globalThis.Set}function u(ee){return ee instanceof globalThis.RegExp}function c(ee){return globalThis.ArrayBuffer.isView(ee)}function d(ee){return ee instanceof globalThis.Int8Array}function l(ee){return ee instanceof globalThis.Uint8Array}function f(ee){return ee instanceof globalThis.Uint8ClampedArray}function b(ee){return ee instanceof globalThis.Int16Array}function C(ee){return ee instanceof globalThis.Uint16Array}function v(ee){return ee instanceof globalThis.Int32Array}function m(ee){return ee instanceof globalThis.Uint32Array}function h(ee){return ee instanceof globalThis.Float32Array}function g(ee){return ee instanceof globalThis.Float64Array}function _(ee){return ee instanceof globalThis.BigInt64Array}function S(ee){return ee instanceof globalThis.BigUint64Array}function p(ee,se){return se in ee}function w(ee){return ee!==null&&typeof ee=="object"}function O(ee){return globalThis.Array.isArray(ee)&&!globalThis.ArrayBuffer.isView(ee)}function E(ee){return ee===void 0}function F(ee){return ee===null}function R(ee){return typeof ee=="boolean"}function M(ee){return typeof ee=="number"}function j(ee){return globalThis.Number.isInteger(ee)}function k(ee){return typeof ee=="bigint"}function x(ee){return typeof ee=="string"}function L(ee){return typeof ee=="function"}function V(ee){return typeof ee=="symbol"}function G(ee){return k(ee)||R(ee)||F(ee)||M(ee)||x(ee)||V(ee)||E(ee)}return Nn}var v8;function hl(){return v8||(v8=1,(function(e){var n=Xf&&Xf.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Xf&&Xf.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(mse(),e)})(Xf)),Xf}var S8;function PE(){if(S8)return dS;S8=1,Object.defineProperty(dS,"__esModule",{value:!0}),dS.TypeSystemPolicy=void 0;const e=hl();var n;return(function(a){a.InstanceMode="default",a.ExactOptionalPropertyTypes=!1,a.AllowArrayObject=!1,a.AllowNaN=!1,a.AllowNullVoid=!1;function t(u,c){return a.ExactOptionalPropertyTypes?c in u:u[c]!==void 0}a.IsExactOptionalProperty=t;function i(u){const c=(0,e.IsObject)(u);return a.AllowArrayObject?c:c&&!(0,e.IsArray)(u)}a.IsObjectLike=i;function r(u){return i(u)&&!(u instanceof Date)&&!(u instanceof Uint8Array)}a.IsRecordLike=r;function s(u){return a.AllowNaN?(0,e.IsNumber)(u):Number.isFinite(u)}a.IsNumberLike=s;function o(u){const c=(0,e.IsUndefined)(u);return a.AllowNullVoid?c||u===null:c}a.IsVoidLike=o})(n||(dS.TypeSystemPolicy=n={})),dS}var dc={},C8;function Rye(){if(C8)return dc;C8=1;var e=dc&&dc.__createBinding||(Object.create?(function(d,l,f,b){b===void 0&&(b=f);var C=Object.getOwnPropertyDescriptor(l,f);(!C||("get"in C?!l.__esModule:C.writable||C.configurable))&&(C={enumerable:!0,get:function(){return l[f]}}),Object.defineProperty(d,b,C)}):(function(d,l,f,b){b===void 0&&(b=f),d[b]=l[f]})),n=dc&&dc.__setModuleDefault||(Object.create?(function(d,l){Object.defineProperty(d,"default",{enumerable:!0,value:l})}):function(d,l){d.default=l}),a=dc&&dc.__importStar||(function(){var d=function(l){return d=Object.getOwnPropertyNames||function(f){var b=[];for(var C in f)Object.prototype.hasOwnProperty.call(f,C)&&(b[b.length]=C);return b},d(l)};return function(l){if(l&&l.__esModule)return l;var f={};if(l!=null)for(var b=d(l),C=0;C<b.length;C++)b[C]!=="default"&&e(f,l,b[C]);return n(f,l),f}})();Object.defineProperty(dc,"__esModule",{value:!0}),dc.Immutable=c;const t=a(Ws());function i(d){return globalThis.Object.freeze(d).map(l=>c(l))}function r(d){return d}function s(d){return d}function o(d){return d}function u(d){const l={};for(const f of Object.getOwnPropertyNames(d))l[f]=c(d[f]);for(const f of Object.getOwnPropertySymbols(d))l[f]=c(d[f]);return globalThis.Object.freeze(l)}function c(d){return t.IsArray(d)?i(d):t.IsDate(d)?d:t.IsUint8Array(d)?d:t.IsRegExp(d)?d:t.IsObject(d)?u(d):d}return dc}var _8;function cn(){if(_8)return eO;_8=1,Object.defineProperty(eO,"__esModule",{value:!0}),eO.CreateType=t;const e=PE(),n=Rye(),a=Na();function t(i,r){const s=r!==void 0?{...r,...i}:i;switch(e.TypeSystemPolicy.InstanceMode){case"freeze":return(0,n.Immutable)(s);case"clone":return(0,a.Clone)(s);default:return s}}return eO}var T8;function ml(){return T8||(T8=1,(function(e){var n=Yf&&Yf.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Yf&&Yf.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(cn(),e)})(Yf)),Yf}var Zf={},lS={},w8;function Fye(){if(w8)return lS;w8=1,Object.defineProperty(lS,"__esModule",{value:!0}),lS.TypeBoxError=void 0;class e extends Error{constructor(a){super(a)}}return lS.TypeBoxError=e,lS}var O8;function ss(){return O8||(O8=1,(function(e){var n=Zf&&Zf.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Zf&&Zf.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Fye(),e)})(Zf)),Zf}var Fs={},tn={},eh={},ga={},P8;function EE(){return P8||(P8=1,Object.defineProperty(ga,"__esModule",{value:!0}),ga.Kind=ga.Hint=ga.OptionalKind=ga.ReadonlyKind=ga.TransformKind=void 0,ga.TransformKind=Symbol.for("TypeBox.Transform"),ga.ReadonlyKind=Symbol.for("TypeBox.Readonly"),ga.OptionalKind=Symbol.for("TypeBox.Optional"),ga.Hint=Symbol.for("TypeBox.Hint"),ga.Kind=Symbol.for("TypeBox.Kind")),ga}var E8;function Xt(){return E8||(E8=1,(function(e){var n=eh&&eh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=eh&&eh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(EE(),e)})(eh)),eh}var I8;function Dn(){if(I8)return tn;I8=1;var e=tn&&tn.__createBinding||(Object.create?(function(Y,Me,K,Z){Z===void 0&&(Z=K);var me=Object.getOwnPropertyDescriptor(Me,K);(!me||("get"in me?!Me.__esModule:me.writable||me.configurable))&&(me={enumerable:!0,get:function(){return Me[K]}}),Object.defineProperty(Y,Z,me)}):(function(Y,Me,K,Z){Z===void 0&&(Z=K),Y[Z]=Me[K]})),n=tn&&tn.__setModuleDefault||(Object.create?(function(Y,Me){Object.defineProperty(Y,"default",{enumerable:!0,value:Me})}):function(Y,Me){Y.default=Me}),a=tn&&tn.__importStar||(function(){var Y=function(Me){return Y=Object.getOwnPropertyNames||function(K){var Z=[];for(var me in K)Object.prototype.hasOwnProperty.call(K,me)&&(Z[Z.length]=me);return Z},Y(Me)};return function(Me){if(Me&&Me.__esModule)return Me;var K={};if(Me!=null)for(var Z=Y(Me),me=0;me<Z.length;me++)Z[me]!=="default"&&e(K,Me,Z[me]);return n(K,Me),K}})();Object.defineProperty(tn,"__esModule",{value:!0}),tn.IsReadonly=r,tn.IsOptional=s,tn.IsAny=o,tn.IsArgument=u,tn.IsArray=c,tn.IsAsyncIterator=d,tn.IsBigInt=l,tn.IsBoolean=f,tn.IsComputed=b,tn.IsConstructor=C,tn.IsDate=v,tn.IsFunction=m,tn.IsImport=h,tn.IsInteger=g,tn.IsProperties=_,tn.IsIntersect=S,tn.IsIterator=p,tn.IsKindOf=w,tn.IsLiteralString=O,tn.IsLiteralNumber=E,tn.IsLiteralBoolean=F,tn.IsLiteralValue=R,tn.IsLiteral=M,tn.IsMappedKey=j,tn.IsMappedResult=k,tn.IsNever=x,tn.IsNot=L,tn.IsNull=V,tn.IsNumber=G,tn.IsObject=ee,tn.IsPromise=se,tn.IsRecord=re,tn.IsRecursive=fe,tn.IsRef=oe,tn.IsRegExp=pe,tn.IsString=de,tn.IsSymbol=ge,tn.IsTemplateLiteral=Ce,tn.IsThis=Fe,tn.IsTransform=We,tn.IsTuple=Ze,tn.IsUndefined=lt,tn.IsUnion=ut,tn.IsUint8Array=pt,tn.IsUnknown=Nt,tn.IsUnsafe=Ke,tn.IsVoid=Ge,tn.IsKind=Re,tn.IsSchema=Qe;const t=a(Ws()),i=Xt();function r(Y){return t.IsObject(Y)&&Y[i.ReadonlyKind]==="Readonly"}function s(Y){return t.IsObject(Y)&&Y[i.OptionalKind]==="Optional"}function o(Y){return w(Y,"Any")}function u(Y){return w(Y,"Argument")}function c(Y){return w(Y,"Array")}function d(Y){return w(Y,"AsyncIterator")}function l(Y){return w(Y,"BigInt")}function f(Y){return w(Y,"Boolean")}function b(Y){return w(Y,"Computed")}function C(Y){return w(Y,"Constructor")}function v(Y){return w(Y,"Date")}function m(Y){return w(Y,"Function")}function h(Y){return w(Y,"Import")}function g(Y){return w(Y,"Integer")}function _(Y){return t.IsObject(Y)}function S(Y){return w(Y,"Intersect")}function p(Y){return w(Y,"Iterator")}function w(Y,Me){return t.IsObject(Y)&&i.Kind in Y&&Y[i.Kind]===Me}function O(Y){return M(Y)&&t.IsString(Y.const)}function E(Y){return M(Y)&&t.IsNumber(Y.const)}function F(Y){return M(Y)&&t.IsBoolean(Y.const)}function R(Y){return t.IsBoolean(Y)||t.IsNumber(Y)||t.IsString(Y)}function M(Y){return w(Y,"Literal")}function j(Y){return w(Y,"MappedKey")}function k(Y){return w(Y,"MappedResult")}function x(Y){return w(Y,"Never")}function L(Y){return w(Y,"Not")}function V(Y){return w(Y,"Null")}function G(Y){return w(Y,"Number")}function ee(Y){return w(Y,"Object")}function se(Y){return w(Y,"Promise")}function re(Y){return w(Y,"Record")}function fe(Y){return t.IsObject(Y)&&i.Hint in Y&&Y[i.Hint]==="Recursive"}function oe(Y){return w(Y,"Ref")}function pe(Y){return w(Y,"RegExp")}function de(Y){return w(Y,"String")}function ge(Y){return w(Y,"Symbol")}function Ce(Y){return w(Y,"TemplateLiteral")}function Fe(Y){return w(Y,"This")}function We(Y){return t.IsObject(Y)&&i.TransformKind in Y}function Ze(Y){return w(Y,"Tuple")}function lt(Y){return w(Y,"Undefined")}function ut(Y){return w(Y,"Union")}function pt(Y){return w(Y,"Uint8Array")}function Nt(Y){return w(Y,"Unknown")}function Ke(Y){return w(Y,"Unsafe")}function Ge(Y){return w(Y,"Void")}function Re(Y){return t.IsObject(Y)&&i.Kind in Y&&t.IsString(Y[i.Kind])}function Qe(Y){return o(Y)||u(Y)||c(Y)||f(Y)||l(Y)||d(Y)||b(Y)||C(Y)||v(Y)||m(Y)||g(Y)||S(Y)||p(Y)||M(Y)||j(Y)||k(Y)||x(Y)||L(Y)||V(Y)||G(Y)||ee(Y)||se(Y)||re(Y)||oe(Y)||pe(Y)||de(Y)||ge(Y)||Ce(Y)||Fe(Y)||Ze(Y)||lt(Y)||ut(Y)||pt(Y)||Nt(Y)||Ke(Y)||Ge(Y)||Re(Y)}return tn}var Yt={},R8;function pse(){if(R8)return Yt;R8=1;var e=Yt&&Yt.__createBinding||(Object.create?(function(he,Ue,Pe,Ye){Ye===void 0&&(Ye=Pe);var ke=Object.getOwnPropertyDescriptor(Ue,Pe);(!ke||("get"in ke?!Ue.__esModule:ke.writable||ke.configurable))&&(ke={enumerable:!0,get:function(){return Ue[Pe]}}),Object.defineProperty(he,Ye,ke)}):(function(he,Ue,Pe,Ye){Ye===void 0&&(Ye=Pe),he[Ye]=Ue[Pe]})),n=Yt&&Yt.__setModuleDefault||(Object.create?(function(he,Ue){Object.defineProperty(he,"default",{enumerable:!0,value:Ue})}):function(he,Ue){he.default=Ue}),a=Yt&&Yt.__importStar||(function(){var he=function(Ue){return he=Object.getOwnPropertyNames||function(Pe){var Ye=[];for(var ke in Pe)Object.prototype.hasOwnProperty.call(Pe,ke)&&(Ye[Ye.length]=ke);return Ye},he(Ue)};return function(Ue){if(Ue&&Ue.__esModule)return Ue;var Pe={};if(Ue!=null)for(var Ye=he(Ue),ke=0;ke<Ye.length;ke++)Ye[ke]!=="default"&&e(Pe,Ue,Ye[ke]);return n(Pe,Ue),Pe}})();Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.TypeGuardUnknownTypeError=void 0,Yt.IsReadonly=g,Yt.IsOptional=_,Yt.IsAny=S,Yt.IsArgument=p,Yt.IsArray=w,Yt.IsAsyncIterator=O,Yt.IsBigInt=E,Yt.IsBoolean=F,Yt.IsComputed=R,Yt.IsConstructor=M,Yt.IsDate=j,Yt.IsFunction=k,Yt.IsImport=x,Yt.IsInteger=L,Yt.IsProperties=V,Yt.IsIntersect=G,Yt.IsIterator=ee,Yt.IsKindOf=se,Yt.IsLiteralString=re,Yt.IsLiteralNumber=fe,Yt.IsLiteralBoolean=oe,Yt.IsLiteral=pe,Yt.IsLiteralValue=de,Yt.IsMappedKey=ge,Yt.IsMappedResult=Ce,Yt.IsNever=Fe,Yt.IsNot=We,Yt.IsNull=Ze,Yt.IsNumber=lt,Yt.IsObject=ut,Yt.IsPromise=pt,Yt.IsRecord=Nt,Yt.IsRecursive=Ke,Yt.IsRef=Ge,Yt.IsRegExp=Re,Yt.IsString=Qe,Yt.IsSymbol=Y,Yt.IsTemplateLiteral=Me,Yt.IsThis=K,Yt.IsTransform=Z,Yt.IsTuple=me,Yt.IsUndefined=we,Yt.IsUnionLiteral=qe,Yt.IsUnion=xe,Yt.IsUint8Array=Oe,Yt.IsUnknown=He,Yt.IsUnsafe=Se,Yt.IsVoid=Ve,Yt.IsKind=ot,Yt.IsSchema=mt;const t=a(Ws()),i=Xt(),r=ss();class s extends r.TypeBoxError{}Yt.TypeGuardUnknownTypeError=s;const o=["Argument","Any","Array","AsyncIterator","BigInt","Boolean","Computed","Constructor","Date","Enum","Function","Integer","Intersect","Iterator","Literal","MappedKey","MappedResult","Not","Null","Number","Object","Promise","Record","Ref","RegExp","String","Symbol","TemplateLiteral","This","Tuple","Undefined","Union","Uint8Array","Unknown","Void"];function u(he){try{return new RegExp(he),!0}catch{return!1}}function c(he){if(!t.IsString(he))return!1;for(let Ue=0;Ue<he.length;Ue++){const Pe=he.charCodeAt(Ue);if(Pe>=7&&Pe<=13||Pe===27||Pe===127)return!1}return!0}function d(he){return b(he)||mt(he)}function l(he){return t.IsUndefined(he)||t.IsBigInt(he)}function f(he){return t.IsUndefined(he)||t.IsNumber(he)}function b(he){return t.IsUndefined(he)||t.IsBoolean(he)}function C(he){return t.IsUndefined(he)||t.IsString(he)}function v(he){return t.IsUndefined(he)||t.IsString(he)&&c(he)&&u(he)}function m(he){return t.IsUndefined(he)||t.IsString(he)&&c(he)}function h(he){return t.IsUndefined(he)||mt(he)}function g(he){return t.IsObject(he)&&he[i.ReadonlyKind]==="Readonly"}function _(he){return t.IsObject(he)&&he[i.OptionalKind]==="Optional"}function S(he){return se(he,"Any")&&C(he.$id)}function p(he){return se(he,"Argument")&&t.IsNumber(he.index)}function w(he){return se(he,"Array")&&he.type==="array"&&C(he.$id)&&mt(he.items)&&f(he.minItems)&&f(he.maxItems)&&b(he.uniqueItems)&&h(he.contains)&&f(he.minContains)&&f(he.maxContains)}function O(he){return se(he,"AsyncIterator")&&he.type==="AsyncIterator"&&C(he.$id)&&mt(he.items)}function E(he){return se(he,"BigInt")&&he.type==="bigint"&&C(he.$id)&&l(he.exclusiveMaximum)&&l(he.exclusiveMinimum)&&l(he.maximum)&&l(he.minimum)&&l(he.multipleOf)}function F(he){return se(he,"Boolean")&&he.type==="boolean"&&C(he.$id)}function R(he){return se(he,"Computed")&&t.IsString(he.target)&&t.IsArray(he.parameters)&&he.parameters.every(Ue=>mt(Ue))}function M(he){return se(he,"Constructor")&&he.type==="Constructor"&&C(he.$id)&&t.IsArray(he.parameters)&&he.parameters.every(Ue=>mt(Ue))&&mt(he.returns)}function j(he){return se(he,"Date")&&he.type==="Date"&&C(he.$id)&&f(he.exclusiveMaximumTimestamp)&&f(he.exclusiveMinimumTimestamp)&&f(he.maximumTimestamp)&&f(he.minimumTimestamp)&&f(he.multipleOfTimestamp)}function k(he){return se(he,"Function")&&he.type==="Function"&&C(he.$id)&&t.IsArray(he.parameters)&&he.parameters.every(Ue=>mt(Ue))&&mt(he.returns)}function x(he){return se(he,"Import")&&t.HasPropertyKey(he,"$defs")&&t.IsObject(he.$defs)&&V(he.$defs)&&t.HasPropertyKey(he,"$ref")&&t.IsString(he.$ref)&&he.$ref in he.$defs}function L(he){return se(he,"Integer")&&he.type==="integer"&&C(he.$id)&&f(he.exclusiveMaximum)&&f(he.exclusiveMinimum)&&f(he.maximum)&&f(he.minimum)&&f(he.multipleOf)}function V(he){return t.IsObject(he)&&Object.entries(he).every(([Ue,Pe])=>c(Ue)&&mt(Pe))}function G(he){return se(he,"Intersect")&&!(t.IsString(he.type)&&he.type!=="object")&&t.IsArray(he.allOf)&&he.allOf.every(Ue=>mt(Ue)&&!Z(Ue))&&C(he.type)&&(b(he.unevaluatedProperties)||h(he.unevaluatedProperties))&&C(he.$id)}function ee(he){return se(he,"Iterator")&&he.type==="Iterator"&&C(he.$id)&&mt(he.items)}function se(he,Ue){return t.IsObject(he)&&i.Kind in he&&he[i.Kind]===Ue}function re(he){return pe(he)&&t.IsString(he.const)}function fe(he){return pe(he)&&t.IsNumber(he.const)}function oe(he){return pe(he)&&t.IsBoolean(he.const)}function pe(he){return se(he,"Literal")&&C(he.$id)&&de(he.const)}function de(he){return t.IsBoolean(he)||t.IsNumber(he)||t.IsString(he)}function ge(he){return se(he,"MappedKey")&&t.IsArray(he.keys)&&he.keys.every(Ue=>t.IsNumber(Ue)||t.IsString(Ue))}function Ce(he){return se(he,"MappedResult")&&V(he.properties)}function Fe(he){return se(he,"Never")&&t.IsObject(he.not)&&Object.getOwnPropertyNames(he.not).length===0}function We(he){return se(he,"Not")&&mt(he.not)}function Ze(he){return se(he,"Null")&&he.type==="null"&&C(he.$id)}function lt(he){return se(he,"Number")&&he.type==="number"&&C(he.$id)&&f(he.exclusiveMaximum)&&f(he.exclusiveMinimum)&&f(he.maximum)&&f(he.minimum)&&f(he.multipleOf)}function ut(he){return se(he,"Object")&&he.type==="object"&&C(he.$id)&&V(he.properties)&&d(he.additionalProperties)&&f(he.minProperties)&&f(he.maxProperties)}function pt(he){return se(he,"Promise")&&he.type==="Promise"&&C(he.$id)&&mt(he.item)}function Nt(he){return se(he,"Record")&&he.type==="object"&&C(he.$id)&&d(he.additionalProperties)&&t.IsObject(he.patternProperties)&&(Ue=>{const Pe=Object.getOwnPropertyNames(Ue.patternProperties);return Pe.length===1&&u(Pe[0])&&t.IsObject(Ue.patternProperties)&&mt(Ue.patternProperties[Pe[0]])})(he)}function Ke(he){return t.IsObject(he)&&i.Hint in he&&he[i.Hint]==="Recursive"}function Ge(he){return se(he,"Ref")&&C(he.$id)&&t.IsString(he.$ref)}function Re(he){return se(he,"RegExp")&&C(he.$id)&&t.IsString(he.source)&&t.IsString(he.flags)&&f(he.maxLength)&&f(he.minLength)}function Qe(he){return se(he,"String")&&he.type==="string"&&C(he.$id)&&f(he.minLength)&&f(he.maxLength)&&v(he.pattern)&&m(he.format)}function Y(he){return se(he,"Symbol")&&he.type==="symbol"&&C(he.$id)}function Me(he){return se(he,"TemplateLiteral")&&he.type==="string"&&t.IsString(he.pattern)&&he.pattern[0]==="^"&&he.pattern[he.pattern.length-1]==="$"}function K(he){return se(he,"This")&&C(he.$id)&&t.IsString(he.$ref)}function Z(he){return t.IsObject(he)&&i.TransformKind in he}function me(he){return se(he,"Tuple")&&he.type==="array"&&C(he.$id)&&t.IsNumber(he.minItems)&&t.IsNumber(he.maxItems)&&he.minItems===he.maxItems&&(t.IsUndefined(he.items)&&t.IsUndefined(he.additionalItems)&&he.minItems===0||t.IsArray(he.items)&&he.items.every(Ue=>mt(Ue)))}function we(he){return se(he,"Undefined")&&he.type==="undefined"&&C(he.$id)}function qe(he){return xe(he)&&he.anyOf.every(Ue=>re(Ue)||fe(Ue))}function xe(he){return se(he,"Union")&&C(he.$id)&&t.IsObject(he)&&t.IsArray(he.anyOf)&&he.anyOf.every(Ue=>mt(Ue))}function Oe(he){return se(he,"Uint8Array")&&he.type==="Uint8Array"&&C(he.$id)&&f(he.minByteLength)&&f(he.maxByteLength)}function He(he){return se(he,"Unknown")&&C(he.$id)}function Se(he){return se(he,"Unsafe")}function Ve(he){return se(he,"Void")&&he.type==="void"&&C(he.$id)}function ot(he){return t.IsObject(he)&&i.Kind in he&&t.IsString(he[i.Kind])&&!o.includes(he[i.Kind])}function mt(he){return t.IsObject(he)&&(S(he)||p(he)||w(he)||F(he)||E(he)||O(he)||R(he)||M(he)||j(he)||k(he)||L(he)||G(he)||ee(he)||pe(he)||ge(he)||Ce(he)||Fe(he)||We(he)||Ze(he)||lt(he)||ut(he)||pt(he)||Nt(he)||Ge(he)||Re(he)||Qe(he)||Y(he)||Me(he)||K(he)||me(he)||we(he)||xe(he)||Oe(he)||He(he)||Se(he)||Ve(he)||ot(he))}return Yt}var F8;function gse(){if(F8)return Fs;F8=1;var e=Fs&&Fs.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),n=Fs&&Fs.__setModuleDefault||(Object.create?(function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}):function(t,i){t.default=i}),a=Fs&&Fs.__importStar||(function(){var t=function(i){return t=Object.getOwnPropertyNames||function(r){var s=[];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[s.length]=o);return s},t(i)};return function(i){if(i&&i.__esModule)return i;var r={};if(i!=null)for(var s=t(i),o=0;o<s.length;o++)s[o]!=="default"&&e(r,i,s[o]);return n(r,i),r}})();return Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.ValueGuard=Fs.TypeGuard=Fs.KindGuard=void 0,Fs.KindGuard=a(Dn()),Fs.TypeGuard=a(pse()),Fs.ValueGuard=a(Ws()),Fs}var th={},tO={},j8;function jye(){if(j8)return tO;j8=1,Object.defineProperty(tO,"__esModule",{value:!0}),tO.Increment=e;function e(n){return(parseInt(n)+1).toString()}return tO}var M8;function Mye(){return M8||(M8=1,(function(e){var n=th&&th.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=th&&th.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(jye(),e)})(th)),th}var nh={},$j={},N8;function Nye(){return N8||(N8=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PatternNeverExact=e.PatternStringExact=e.PatternNumberExact=e.PatternBooleanExact=e.PatternNever=e.PatternString=e.PatternNumber=e.PatternBoolean=void 0,e.PatternBoolean="(true|false)",e.PatternNumber="(0|[1-9][0-9]*)",e.PatternString="(.*)",e.PatternNever="(?!.*)",e.PatternBooleanExact=`^${e.PatternBoolean}$`,e.PatternNumberExact=`^${e.PatternNumber}$`,e.PatternStringExact=`^${e.PatternString}$`,e.PatternNeverExact=`^${e.PatternNever}$`})($j)),$j}var A8;function IE(){return A8||(A8=1,(function(e){var n=nh&&nh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=nh&&nh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Nye(),e)})(nh)),nh}var ya={},Su={},D8;function Aye(){if(D8)return Su;D8=1,Object.defineProperty(Su,"__esModule",{value:!0}),Su.Entries=n,Su.Clear=a,Su.Delete=t,Su.Has=i,Su.Set=r,Su.Get=s;const e=new Map;function n(){return new Map(e)}function a(){return e.clear()}function t(o){return e.delete(o)}function i(o){return e.has(o)}function r(o,u){e.set(o,u)}function s(o){return e.get(o)}return Su}var Cu={},k8;function Dye(){if(k8)return Cu;k8=1,Object.defineProperty(Cu,"__esModule",{value:!0}),Cu.Entries=n,Cu.Clear=a,Cu.Delete=t,Cu.Has=i,Cu.Set=r,Cu.Get=s;const e=new Map;function n(){return new Map(e)}function a(){return e.clear()}function t(o){return e.delete(o)}function i(o){return e.has(o)}function r(o,u){e.set(o,u)}function s(o){return e.get(o)}return Cu}var x8;function fT(){if(x8)return ya;x8=1;var e=ya&&ya.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),n=ya&&ya.__setModuleDefault||(Object.create?(function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}):function(t,i){t.default=i}),a=ya&&ya.__importStar||(function(){var t=function(i){return t=Object.getOwnPropertyNames||function(r){var s=[];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[s.length]=o);return s},t(i)};return function(i){if(i&&i.__esModule)return i;var r={};if(i!=null)for(var s=t(i),o=0;o<s.length;o++)s[o]!=="default"&&e(r,i,s[o]);return n(r,i),r}})();return Object.defineProperty(ya,"__esModule",{value:!0}),ya.TypeRegistry=ya.FormatRegistry=void 0,ya.FormatRegistry=a(Aye()),ya.TypeRegistry=a(Dye()),ya}var rh={},lo={},q8;function kye(){if(q8)return lo;q8=1,Object.defineProperty(lo,"__esModule",{value:!0}),lo.SetIncludes=e,lo.SetIsSubset=n,lo.SetDistinct=a,lo.SetIntersect=t,lo.SetUnion=i,lo.SetComplement=r,lo.SetIntersectMany=o,lo.SetUnionMany=u;function e(c,d){return c.includes(d)}function n(c,d){return c.every(l=>e(d,l))}function a(c){return[...new Set(c)]}function t(c,d){return c.filter(l=>d.includes(l))}function i(c,d){return[...c,...d]}function r(c,d){return c.filter(l=>!d.includes(l))}function s(c,d){return c.reduce((l,f)=>t(l,f),d)}function o(c){return c.length===1?c[0]:c.length>1?s(c.slice(1),c[0]):[]}function u(c){const d=[];for(const l of c)d.push(...l);return d}return lo}var L8;function RE(){return L8||(L8=1,(function(e){var n=rh&&rh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=rh&&rh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(kye(),e)})(rh)),rh}var ih={},nO={},B8;function xye(){if(B8)return nO;B8=1,Object.defineProperty(nO,"__esModule",{value:!0}),nO.Any=a;const e=ml(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Any"},t)}return nO}var U8;function hT(){return U8||(U8=1,(function(e){var n=ih&&ih.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=ih&&ih.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(xye(),e)})(ih)),ih}var sh={},rO={},z8;function qye(){if(z8)return rO;z8=1,Object.defineProperty(rO,"__esModule",{value:!0}),rO.Array=a;const e=cn(),n=Xt();function a(t,i){return(0,e.CreateType)({[n.Kind]:"Array",type:"array",items:t},i)}return rO}var V8;function mT(){return V8||(V8=1,(function(e){var n=sh&&sh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=sh&&sh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(qye(),e)})(sh)),sh}var ah={},iO={},H8;function Lye(){if(H8)return iO;H8=1,Object.defineProperty(iO,"__esModule",{value:!0}),iO.Argument=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Argument",index:t})}return iO}var K8;function jx(){return K8||(K8=1,(function(e){var n=ah&&ah.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=ah&&ah.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Lye(),e)})(ah)),ah}var oh={},sO={},$8;function Bye(){if($8)return sO;$8=1,Object.defineProperty(sO,"__esModule",{value:!0}),sO.AsyncIterator=a;const e=Xt(),n=cn();function a(t,i){return(0,n.CreateType)({[e.Kind]:"AsyncIterator",type:"AsyncIterator",items:t},i)}return sO}var G8;function pT(){return G8||(G8=1,(function(e){var n=oh&&oh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=oh&&oh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Bye(),e)})(oh)),oh}var ch={},aO={},uh={},oO={},W8;function Uye(){if(W8)return oO;W8=1,Object.defineProperty(oO,"__esModule",{value:!0}),oO.Computed=a;const e=ml(),n=EE();function a(t,i,r){return(0,e.CreateType)({[n.Kind]:"Computed",target:t,parameters:i},r)}return oO}var J8;function Gg(){return J8||(J8=1,(function(e){var n=uh&&uh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=uh&&uh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Uye(),e)})(uh)),uh}var dh={},cO={},lh={},uO={},Q8;function Mx(){if(Q8)return uO;Q8=1,Object.defineProperty(uO,"__esModule",{value:!0}),uO.Discard=n;function e(a,t){const{[t]:i,...r}=a;return r}function n(a,t){return t.reduce((i,r)=>e(i,r),a)}return uO}var Y8;function pl(){return Y8||(Y8=1,(function(e){var n=lh&&lh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=lh&&lh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Mx(),e)})(lh)),lh}var fh={},dO={},X8;function zye(){if(X8)return dO;X8=1,Object.defineProperty(dO,"__esModule",{value:!0}),dO.Never=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Never",not:{}},t)}return dO}var Z8;function bi(){return Z8||(Z8=1,(function(e){var n=fh&&fh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=fh&&fh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(zye(),e)})(fh)),fh}var hh={},lO={},mh={},fO={},eV;function Vye(){if(eV)return fO;eV=1,Object.defineProperty(fO,"__esModule",{value:!0}),fO.MappedKey=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"MappedKey",keys:t})}return fO}var hO={},tV;function yse(){if(tV)return hO;tV=1,Object.defineProperty(hO,"__esModule",{value:!0}),hO.MappedResult=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"MappedResult",properties:t})}return hO}var fS={},ph={},mO={},nV;function Hye(){if(nV)return mO;nV=1,Object.defineProperty(mO,"__esModule",{value:!0}),mO.Constructor=a;const e=cn(),n=Xt();function a(t,i,r){return(0,e.CreateType)({[n.Kind]:"Constructor",type:"Constructor",parameters:t,returns:i},r)}return mO}var rV;function gT(){return rV||(rV=1,(function(e){var n=ph&&ph.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=ph&&ph.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Hye(),e)})(ph)),ph}var gh={},pO={},iV;function Kye(){if(iV)return pO;iV=1,Object.defineProperty(pO,"__esModule",{value:!0}),pO.Function=a;const e=cn(),n=Xt();function a(t,i,r){return(0,e.CreateType)({[n.Kind]:"Function",type:"Function",parameters:t,returns:i},r)}return pO}var sV;function Wg(){return sV||(sV=1,(function(e){var n=gh&&gh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=gh&&gh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Kye(),e)})(gh)),gh}var yh={},gO={},bh={},vh={},yO={},bO={},aV;function bse(){if(aV)return bO;aV=1,Object.defineProperty(bO,"__esModule",{value:!0}),bO.UnionCreate=a;const e=cn(),n=Xt();function a(t,i){return(0,e.CreateType)({[n.Kind]:"Union",anyOf:t},i)}return bO}var oV;function $ye(){if(oV)return yO;oV=1,Object.defineProperty(yO,"__esModule",{value:!0}),yO.UnionEvaluated=l;const e=cn(),n=Xt(),a=pl(),t=bi(),i=pd(),r=bse(),s=Dn();function o(f){return f.some(b=>(0,s.IsOptional)(b))}function u(f){return f.map(b=>(0,s.IsOptional)(b)?c(b):b)}function c(f){return(0,a.Discard)(f,[n.OptionalKind])}function d(f,b){return o(f)?(0,i.Optional)((0,r.UnionCreate)(u(f),b)):(0,r.UnionCreate)(u(f),b)}function l(f,b){return f.length===1?(0,e.CreateType)(f[0],b):f.length===0?(0,t.Never)(b):d(f,b)}return yO}var Gj={},cV;function Gye(){return cV||(cV=1,Object.defineProperty(Gj,"__esModule",{value:!0})),Gj}var vO={},uV;function Wye(){if(uV)return vO;uV=1,Object.defineProperty(vO,"__esModule",{value:!0}),vO.Union=t;const e=bi(),n=cn(),a=bse();function t(i,r){return i.length===0?(0,e.Never)(r):i.length===1?(0,n.CreateType)(i[0],r):(0,a.UnionCreate)(i,r)}return vO}var dV;function vi(){return dV||(dV=1,(function(e){var n=vh&&vh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=vh&&vh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a($ye(),e),a(Gye(),e),a(Wye(),e)})(vh)),vh}var SO={},Sh={},Ch={},_h={},lV;function Nx(){if(lV)return _h;lV=1,Object.defineProperty(_h,"__esModule",{value:!0}),_h.TemplateLiteralParserError=void 0,_h.TemplateLiteralParse=b,_h.TemplateLiteralParseExact=C;const e=ss();class n extends e.TypeBoxError{}_h.TemplateLiteralParserError=n;function a(v){return v.replace(/\\\$/g,"$").replace(/\\\*/g,"*").replace(/\\\^/g,"^").replace(/\\\|/g,"|").replace(/\\\(/g,"(").replace(/\\\)/g,")")}function t(v,m,h){return v[m]===h&&v.charCodeAt(m-1)!==92}function i(v,m){return t(v,m,"(")}function r(v,m){return t(v,m,")")}function s(v,m){return t(v,m,"|")}function o(v){if(!(i(v,0)&&r(v,v.length-1)))return!1;let m=0;for(let h=0;h<v.length;h++)if(i(v,h)&&(m+=1),r(v,h)&&(m-=1),m===0&&h!==v.length-1)return!1;return!0}function u(v){return v.slice(1,v.length-1)}function c(v){let m=0;for(let h=0;h<v.length;h++)if(i(v,h)&&(m+=1),r(v,h)&&(m-=1),s(v,h)&&m===0)return!0;return!1}function d(v){for(let m=0;m<v.length;m++)if(i(v,m))return!0;return!1}function l(v){let[m,h]=[0,0];const g=[];for(let S=0;S<v.length;S++)if(i(v,S)&&(m+=1),r(v,S)&&(m-=1),s(v,S)&&m===0){const p=v.slice(h,S);p.length>0&&g.push(b(p)),h=S+1}const _=v.slice(h);return _.length>0&&g.push(b(_)),g.length===0?{type:"const",const:""}:g.length===1?g[0]:{type:"or",expr:g}}function f(v){function m(_,S){if(!i(_,S))throw new n("TemplateLiteralParser: Index must point to open parens");let p=0;for(let w=S;w<_.length;w++)if(i(_,w)&&(p+=1),r(_,w)&&(p-=1),p===0)return[S,w];throw new n("TemplateLiteralParser: Unclosed group parens in expression")}function h(_,S){for(let p=S;p<_.length;p++)if(i(_,p))return[S,p];return[S,_.length]}const g=[];for(let _=0;_<v.length;_++)if(i(v,_)){const[S,p]=m(v,_),w=v.slice(S,p+1);g.push(b(w)),_=p}else{const[S,p]=h(v,_),w=v.slice(S,p);w.length>0&&g.push(b(w)),_=p-1}return g.length===0?{type:"const",const:""}:g.length===1?g[0]:{type:"and",expr:g}}function b(v){return o(v)?b(u(v)):c(v)?l(v):d(v)?f(v):{type:"const",const:a(v)}}function C(v){return b(v.slice(1,v.length-1))}return _h}var fV;function vse(){if(fV)return Ch;fV=1,Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.TemplateLiteralFiniteError=void 0,Ch.IsTemplateLiteralExpressionFinite=s,Ch.IsTemplateLiteralFinite=o;const e=Nx(),n=ss();class a extends n.TypeBoxError{}Ch.TemplateLiteralFiniteError=a;function t(u){return u.type==="or"&&u.expr.length===2&&u.expr[0].type==="const"&&u.expr[0].const==="0"&&u.expr[1].type==="const"&&u.expr[1].const==="[1-9][0-9]*"}function i(u){return u.type==="or"&&u.expr.length===2&&u.expr[0].type==="const"&&u.expr[0].const==="true"&&u.expr[1].type==="const"&&u.expr[1].const==="false"}function r(u){return u.type==="const"&&u.const===".*"}function s(u){return t(u)||r(u)?!1:i(u)?!0:u.type==="and"?u.expr.every(c=>s(c)):u.type==="or"?u.expr.every(c=>s(c)):u.type==="const"?!0:(()=>{throw new a("Unknown expression type")})()}function o(u){const c=(0,e.TemplateLiteralParseExact)(u.pattern);return s(c)}return Ch}var Th={},hV;function Sse(){if(hV)return Th;hV=1,Object.defineProperty(Th,"__esModule",{value:!0}),Th.TemplateLiteralGenerateError=void 0,Th.TemplateLiteralExpressionGenerate=u,Th.TemplateLiteralGenerate=c;const e=vse(),n=Nx(),a=ss();class t extends a.TypeBoxError{}Th.TemplateLiteralGenerateError=t;function*i(d){if(d.length===1)return yield*d[0];for(const l of d[0])for(const f of i(d.slice(1)))yield`${l}${f}`}function*r(d){return yield*i(d.expr.map(l=>[...u(l)]))}function*s(d){for(const l of d.expr)yield*u(l)}function*o(d){return yield d.const}function*u(d){return d.type==="and"?yield*r(d):d.type==="or"?yield*s(d):d.type==="const"?yield*o(d):(()=>{throw new t("Unknown expression")})()}function c(d){const l=(0,n.TemplateLiteralParseExact)(d.pattern);return(0,e.IsTemplateLiteralExpressionFinite)(l)?[...u(l)]:[]}return Th}var CO={},wh={},_O={},mV;function Jye(){if(mV)return _O;mV=1,Object.defineProperty(_O,"__esModule",{value:!0}),_O.Literal=a;const e=cn(),n=Xt();function a(t,i){return(0,e.CreateType)({[n.Kind]:"Literal",const:t,type:typeof t},i)}return _O}var pV;function Js(){return pV||(pV=1,(function(e){var n=wh&&wh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=wh&&wh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Jye(),e)})(wh)),wh}var Oh={},TO={},gV;function Qye(){if(gV)return TO;gV=1,Object.defineProperty(TO,"__esModule",{value:!0}),TO.Boolean=a;const e=Xt(),n=ml();function a(t){return(0,n.CreateType)({[e.Kind]:"Boolean",type:"boolean"},t)}return TO}var yV;function FE(){return yV||(yV=1,(function(e){var n=Oh&&Oh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Oh&&Oh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Qye(),e)})(Oh)),Oh}var Ph={},wO={},bV;function Yye(){if(bV)return wO;bV=1,Object.defineProperty(wO,"__esModule",{value:!0}),wO.BigInt=a;const e=Xt(),n=ml();function a(t){return(0,n.CreateType)({[e.Kind]:"BigInt",type:"bigint"},t)}return wO}var vV;function yT(){return vV||(vV=1,(function(e){var n=Ph&&Ph.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Ph&&Ph.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Yye(),e)})(Ph)),Ph}var Eh={},OO={},SV;function Xye(){if(SV)return OO;SV=1,Object.defineProperty(OO,"__esModule",{value:!0}),OO.Number=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Number",type:"number"},t)}return OO}var CV;function Jg(){return CV||(CV=1,(function(e){var n=Eh&&Eh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Eh&&Eh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Xye(),e)})(Eh)),Eh}var Ih={},PO={},_V;function Zye(){if(_V)return PO;_V=1,Object.defineProperty(PO,"__esModule",{value:!0}),PO.String=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"String",type:"string"},t)}return PO}var TV;function ob(){return TV||(TV=1,(function(e){var n=Ih&&Ih.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Ih&&Ih.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Zye(),e)})(Ih)),Ih}var wV;function Cse(){if(wV)return CO;wV=1,Object.defineProperty(CO,"__esModule",{value:!0}),CO.TemplateLiteralSyntax=d;const e=Js(),n=FE(),a=yT(),t=Jg(),i=ob(),r=vi(),s=bi();function*o(l){const f=l.trim().replace(/"|'/g,"");return f==="boolean"?yield(0,n.Boolean)():f==="number"?yield(0,t.Number)():f==="bigint"?yield(0,a.BigInt)():f==="string"?yield(0,i.String)():yield(()=>{const b=f.split("|").map(C=>(0,e.Literal)(C.trim()));return b.length===0?(0,s.Never)():b.length===1?b[0]:(0,r.UnionEvaluated)(b)})()}function*u(l){if(l[1]!=="{"){const f=(0,e.Literal)("$"),b=c(l.slice(1));return yield*[f,...b]}for(let f=2;f<l.length;f++)if(l[f]==="}"){const b=o(l.slice(2,f)),C=c(l.slice(f+1));return yield*[...b,...C]}yield(0,e.Literal)(l)}function*c(l){for(let f=0;f<l.length;f++)if(l[f]==="$"){const b=(0,e.Literal)(l.slice(0,f)),C=u(l.slice(f));return yield*[b,...C]}yield(0,e.Literal)(l)}function d(l){return[...c(l)]}return CO}var Hy={},OV;function _se(){if(OV)return Hy;OV=1,Object.defineProperty(Hy,"__esModule",{value:!0}),Hy.TemplateLiteralPatternError=void 0,Hy.TemplateLiteralPattern=o;const e=IE(),n=Xt(),a=ss(),t=Dn();class i extends a.TypeBoxError{}Hy.TemplateLiteralPatternError=i;function r(u){return u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function s(u,c){return(0,t.IsTemplateLiteral)(u)?u.pattern.slice(1,u.pattern.length-1):(0,t.IsUnion)(u)?`(${u.anyOf.map(d=>s(d,c)).join("|")})`:(0,t.IsNumber)(u)?`${c}${e.PatternNumber}`:(0,t.IsInteger)(u)?`${c}${e.PatternNumber}`:(0,t.IsBigInt)(u)?`${c}${e.PatternNumber}`:(0,t.IsString)(u)?`${c}${e.PatternString}`:(0,t.IsLiteral)(u)?`${c}${r(u.const.toString())}`:(0,t.IsBoolean)(u)?`${c}${e.PatternBoolean}`:(()=>{throw new i(`Unexpected Kind '${u[n.Kind]}'`)})()}function o(u){return`^${u.map(c=>s(c,"")).join("")}$`}return Hy}var EO={},PV;function ebe(){if(PV)return EO;PV=1,Object.defineProperty(EO,"__esModule",{value:!0}),EO.TemplateLiteralToUnion=t;const e=vi(),n=Js(),a=Sse();function t(i){const s=(0,a.TemplateLiteralGenerate)(i).map(o=>(0,n.Literal)(o));return(0,e.UnionEvaluated)(s)}return EO}var IO={},EV;function tbe(){if(EV)return IO;EV=1,Object.defineProperty(IO,"__esModule",{value:!0}),IO.TemplateLiteral=r;const e=cn(),n=Cse(),a=_se(),t=Ws(),i=Xt();function r(s,o){const u=(0,t.IsString)(s)?(0,a.TemplateLiteralPattern)((0,n.TemplateLiteralSyntax)(s)):(0,a.TemplateLiteralPattern)(s);return(0,e.CreateType)({[i.Kind]:"TemplateLiteral",type:"string",pattern:u},o)}return IO}var IV;function md(){return IV||(IV=1,(function(e){var n=Sh&&Sh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Sh&&Sh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(vse(),e),a(Sse(),e),a(Cse(),e),a(Nx(),e),a(_se(),e),a(ebe(),e),a(tbe(),e)})(Sh)),Sh}var RV;function Ax(){if(RV)return SO;RV=1,Object.defineProperty(SO,"__esModule",{value:!0}),SO.IndexPropertyKeys=r;const e=md(),n=Dn();function a(s){return(0,e.TemplateLiteralGenerate)(s).map(u=>u.toString())}function t(s){const o=[];for(const u of s)o.push(...r(u));return o}function i(s){return[s.toString()]}function r(s){return[...new Set((0,n.IsTemplateLiteral)(s)?a(s):(0,n.IsUnion)(s)?t(s.anyOf):(0,n.IsLiteral)(s)?i(s.const):(0,n.IsNumber)(s)?["[number]"]:(0,n.IsInteger)(s)?["[number]"]:[])]}return SO}var RO={},FV;function Tse(){if(FV)return RO;FV=1,Object.defineProperty(RO,"__esModule",{value:!0}),RO.IndexFromMappedResult=r;const e=Fi(),n=Ax(),a=Tc();function t(s,o,u){const c={};for(const d of Object.getOwnPropertyNames(o))c[d]=(0,a.Index)(s,(0,n.IndexPropertyKeys)(o[d]),u);return c}function i(s,o,u){return t(s,o.properties,u)}function r(s,o,u){const c=i(s,o,u);return(0,e.MappedResult)(c)}return RO}var jV;function Dx(){if(jV)return bh;jV=1,Object.defineProperty(bh,"__esModule",{value:!0}),bh.IndexFromPropertyKey=g,bh.IndexFromPropertyKeys=_,bh.IndexFromComputed=p,bh.Index=w;const e=cn(),n=ss(),a=Gg(),t=bi(),i=Ka(),r=vi(),s=Ax(),o=wse(),u=Tse(),c=Dn();function d(O,E){return O.map(F=>g(F,E))}function l(O){return O.filter(E=>!(0,c.IsNever)(E))}function f(O,E){return(0,i.IntersectEvaluated)(l(d(O,E)))}function b(O){return O.some(E=>(0,c.IsNever)(E))?[]:O}function C(O,E){return(0,r.UnionEvaluated)(b(d(O,E)))}function v(O,E){return E in O?O[E]:E==="[number]"?(0,r.UnionEvaluated)(O):(0,t.Never)()}function m(O,E){return E==="[number]"?O:(0,t.Never)()}function h(O,E){return E in O?O[E]:(0,t.Never)()}function g(O,E){return(0,c.IsIntersect)(O)?f(O.allOf,E):(0,c.IsUnion)(O)?C(O.anyOf,E):(0,c.IsTuple)(O)?v(O.items??[],E):(0,c.IsArray)(O)?m(O.items,E):(0,c.IsObject)(O)?h(O.properties,E):(0,t.Never)()}function _(O,E){return E.map(F=>g(O,F))}function S(O,E){return(0,r.UnionEvaluated)(_(O,E))}function p(O,E){return(0,a.Computed)("Index",[O,E])}function w(O,E,F){if((0,c.IsRef)(O)||(0,c.IsRef)(E)){const R="Index types using Ref parameters require both Type and Key to be of TSchema";if(!(0,c.IsSchema)(O)||!(0,c.IsSchema)(E))throw new n.TypeBoxError(R);return(0,a.Computed)("Index",[O,E])}return(0,c.IsMappedResult)(E)?(0,u.IndexFromMappedResult)(O,E,F):(0,c.IsMappedKey)(E)?(0,o.IndexFromMappedKey)(O,E,F):(0,e.CreateType)((0,c.IsSchema)(E)?S(O,(0,s.IndexPropertyKeys)(E)):S(O,E),F)}return bh}var MV;function wse(){if(MV)return gO;MV=1,Object.defineProperty(gO,"__esModule",{value:!0}),gO.IndexFromMappedKey=s;const e=Dx(),n=Fi(),a=Na();function t(o,u,c){return{[u]:(0,e.Index)(o,[u],(0,a.Clone)(c))}}function i(o,u,c){return u.reduce((d,l)=>({...d,...t(o,l,c)}),{})}function r(o,u,c){return i(o,u.keys,c)}function s(o,u,c){const d=r(o,u,c);return(0,n.MappedResult)(d)}return gO}var NV;function Tc(){return NV||(NV=1,(function(e){var n=yh&&yh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=yh&&yh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(wse(),e),a(Tse(),e),a(Ax(),e),a(Dx(),e)})(yh)),yh}var Rh={},FO={},AV;function nbe(){if(AV)return FO;AV=1,Object.defineProperty(FO,"__esModule",{value:!0}),FO.Iterator=a;const e=cn(),n=Xt();function a(t,i){return(0,e.CreateType)({[n.Kind]:"Iterator",type:"Iterator",items:t},i)}return FO}var DV;function bT(){return DV||(DV=1,(function(e){var n=Rh&&Rh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Rh&&Rh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(nbe(),e)})(Rh)),Rh}var Fh={},hS={},kV;function rbe(){if(kV)return hS;kV=1,Object.defineProperty(hS,"__esModule",{value:!0}),hS.Object=void 0;const e=cn(),n=Xt(),a=Dn();function t(r){const s=[];for(let o in r)(0,a.IsOptional)(r[o])||s.push(o);return s}function i(r,s){const o=t(r),u=o.length>0?{[n.Kind]:"Object",type:"object",properties:r,required:o}:{[n.Kind]:"Object",type:"object",properties:r};return(0,e.CreateType)(u,s)}return hS.Object=i,hS}var xV;function Aa(){return xV||(xV=1,(function(e){var n=Fh&&Fh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Fh&&Fh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(rbe(),e)})(Fh)),Fh}var jh={},jO={},qV;function ibe(){if(qV)return jO;qV=1,Object.defineProperty(jO,"__esModule",{value:!0}),jO.Promise=a;const e=cn(),n=Xt();function a(t,i){return(0,e.CreateType)({[n.Kind]:"Promise",type:"Promise",item:t},i)}return jO}var LV;function jE(){return LV||(LV=1,(function(e){var n=jh&&jh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=jh&&jh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(ibe(),e)})(jh)),jh}var Mh={},MO={},NO={},BV;function Ose(){if(BV)return NO;BV=1,Object.defineProperty(NO,"__esModule",{value:!0}),NO.Readonly=u;const e=cn(),n=Xt(),a=pl(),t=Pse(),i=Dn();function r(c){return(0,e.CreateType)((0,a.Discard)(c,[n.ReadonlyKind]))}function s(c){return(0,e.CreateType)({...c,[n.ReadonlyKind]:"Readonly"})}function o(c,d){return d===!1?r(c):s(c)}function u(c,d){const l=d??!0;return(0,i.IsMappedResult)(c)?(0,t.ReadonlyFromMappedResult)(c,l):o(c,l)}return NO}var UV;function Pse(){if(UV)return MO;UV=1,Object.defineProperty(MO,"__esModule",{value:!0}),MO.ReadonlyFromMappedResult=i;const e=Fi(),n=Ose();function a(r,s){const o={};for(const u of globalThis.Object.getOwnPropertyNames(r))o[u]=(0,n.Readonly)(r[u],s);return o}function t(r,s){return a(r.properties,s)}function i(r,s){const o=t(r,s);return(0,e.MappedResult)(o)}return MO}var zV;function Qg(){return zV||(zV=1,(function(e){var n=Mh&&Mh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Mh&&Mh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Pse(),e),a(Ose(),e)})(Mh)),Mh}var Nh={},AO={},VV;function sbe(){if(VV)return AO;VV=1,Object.defineProperty(AO,"__esModule",{value:!0}),AO.Tuple=a;const e=cn(),n=Xt();function a(t,i){return(0,e.CreateType)(t.length>0?{[n.Kind]:"Tuple",type:"array",items:t,additionalItems:!1,minItems:t.length,maxItems:t.length}:{[n.Kind]:"Tuple",type:"array",minItems:t.length,maxItems:t.length},i)}return AO}var HV;function gl(){return HV||(HV=1,(function(e){var n=Nh&&Nh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Nh&&Nh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(sbe(),e)})(Nh)),Nh}var KV;function abe(){if(KV)return fS;KV=1,Object.defineProperty(fS,"__esModule",{value:!0}),fS.MappedFunctionReturnType=M,fS.Mapped=j;const e=Xt(),n=pl(),a=mT(),t=pT(),i=gT(),r=Wg(),s=Tc(),o=Ka(),u=bT(),c=Js(),d=Aa(),l=pd(),f=jE(),b=Qg(),C=gl(),v=vi(),m=RE(),h=yse(),g=Dn();function _(k,x){return k in x?R(k,x[k]):(0,h.MappedResult)(x)}function S(k){return{[k]:(0,c.Literal)(k)}}function p(k){const x={};for(const L of k)x[L]=(0,c.Literal)(L);return x}function w(k,x){return(0,m.SetIncludes)(x,k)?S(k):p(x)}function O(k,x){const L=w(k,x);return _(k,L)}function E(k,x){return x.map(L=>R(k,L))}function F(k,x){const L={};for(const V of globalThis.Object.getOwnPropertyNames(x))L[V]=R(k,x[V]);return L}function R(k,x){const L={...x};return(0,g.IsOptional)(x)?(0,l.Optional)(R(k,(0,n.Discard)(x,[e.OptionalKind]))):(0,g.IsReadonly)(x)?(0,b.Readonly)(R(k,(0,n.Discard)(x,[e.ReadonlyKind]))):(0,g.IsMappedResult)(x)?_(k,x.properties):(0,g.IsMappedKey)(x)?O(k,x.keys):(0,g.IsConstructor)(x)?(0,i.Constructor)(E(k,x.parameters),R(k,x.returns),L):(0,g.IsFunction)(x)?(0,r.Function)(E(k,x.parameters),R(k,x.returns),L):(0,g.IsAsyncIterator)(x)?(0,t.AsyncIterator)(R(k,x.items),L):(0,g.IsIterator)(x)?(0,u.Iterator)(R(k,x.items),L):(0,g.IsIntersect)(x)?(0,o.Intersect)(E(k,x.allOf),L):(0,g.IsUnion)(x)?(0,v.Union)(E(k,x.anyOf),L):(0,g.IsTuple)(x)?(0,C.Tuple)(E(k,x.items??[]),L):(0,g.IsObject)(x)?(0,d.Object)(F(k,x.properties),L):(0,g.IsArray)(x)?(0,a.Array)(R(k,x.items),L):(0,g.IsPromise)(x)?(0,f.Promise)(R(k,x.item),L):x}function M(k,x){const L={};for(const V of k)L[V]=R(V,x);return L}function j(k,x,L){const V=(0,g.IsSchema)(k)?(0,s.IndexPropertyKeys)(k):k,G=x({[e.Kind]:"MappedKey",keys:V}),ee=M(V,G);return(0,d.Object)(ee,L)}return fS}var $V;function Fi(){return $V||($V=1,(function(e){var n=mh&&mh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=mh&&mh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Vye(),e),a(yse(),e),a(abe(),e)})(mh)),mh}var DO={},GV;function Ese(){if(GV)return DO;GV=1,Object.defineProperty(DO,"__esModule",{value:!0}),DO.Optional=u;const e=cn(),n=Xt(),a=pl(),t=Ise(),i=Dn();function r(c){return(0,e.CreateType)((0,a.Discard)(c,[n.OptionalKind]))}function s(c){return(0,e.CreateType)({...c,[n.OptionalKind]:"Optional"})}function o(c,d){return d===!1?r(c):s(c)}function u(c,d){const l=d??!0;return(0,i.IsMappedResult)(c)?(0,t.OptionalFromMappedResult)(c,l):o(c,l)}return DO}var WV;function Ise(){if(WV)return lO;WV=1,Object.defineProperty(lO,"__esModule",{value:!0}),lO.OptionalFromMappedResult=i;const e=Fi(),n=Ese();function a(r,s){const o={};for(const u of globalThis.Object.getOwnPropertyNames(r))o[u]=(0,n.Optional)(r[u],s);return o}function t(r,s){return a(r.properties,s)}function i(r,s){const o=t(r,s);return(0,e.MappedResult)(o)}return lO}var JV;function pd(){return JV||(JV=1,(function(e){var n=hh&&hh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=hh&&hh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Ise(),e),a(Ese(),e)})(hh)),hh}var kO={},QV;function Rse(){if(QV)return kO;QV=1,Object.defineProperty(kO,"__esModule",{value:!0}),kO.IntersectCreate=t;const e=cn(),n=Xt(),a=Dn();function t(i,r={}){const s=i.every(u=>(0,a.IsObject)(u)),o=(0,a.IsSchema)(r.unevaluatedProperties)?{unevaluatedProperties:r.unevaluatedProperties}:{};return(0,e.CreateType)(r.unevaluatedProperties===!1||(0,a.IsSchema)(r.unevaluatedProperties)||s?{...o,[n.Kind]:"Intersect",type:"object",allOf:i}:{...o,[n.Kind]:"Intersect",allOf:i},r)}return kO}var YV;function obe(){if(YV)return cO;YV=1,Object.defineProperty(cO,"__esModule",{value:!0}),cO.IntersectEvaluated=l;const e=Xt(),n=cn(),a=pl(),t=bi(),i=pd(),r=Rse(),s=Dn();function o(f){return f.every(b=>(0,s.IsOptional)(b))}function u(f){return(0,a.Discard)(f,[e.OptionalKind])}function c(f){return f.map(b=>(0,s.IsOptional)(b)?u(b):b)}function d(f,b){return o(f)?(0,i.Optional)((0,r.IntersectCreate)(c(f),b)):(0,r.IntersectCreate)(c(f),b)}function l(f,b={}){if(f.length===1)return(0,n.CreateType)(f[0],b);if(f.length===0)return(0,t.Never)(b);if(f.some(C=>(0,s.IsTransform)(C)))throw new Error("Cannot intersect transform types");return d(f,b)}return cO}var Wj={},XV;function cbe(){return XV||(XV=1,Object.defineProperty(Wj,"__esModule",{value:!0})),Wj}var xO={},ZV;function ube(){if(ZV)return xO;ZV=1,Object.defineProperty(xO,"__esModule",{value:!0}),xO.Intersect=i;const e=cn(),n=bi(),a=Rse(),t=Dn();function i(r,s){if(r.length===1)return(0,e.CreateType)(r[0],s);if(r.length===0)return(0,n.Never)(s);if(r.some(o=>(0,t.IsTransform)(o)))throw new Error("Cannot intersect transform types");return(0,a.IntersectCreate)(r,s)}return xO}var eH;function Ka(){return eH||(eH=1,(function(e){var n=dh&&dh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=dh&&dh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(obe(),e),a(cbe(),e),a(ube(),e)})(dh)),dh}var Ah={},qO={},tH;function dbe(){if(tH)return qO;tH=1,Object.defineProperty(qO,"__esModule",{value:!0}),qO.Ref=t;const e=ss(),n=cn(),a=Xt();function t(...i){const[r,s]=typeof i[0]=="string"?[i[0],i[1]]:[i[0].$id,i[1]];if(typeof r!="string")throw new e.TypeBoxError("Ref: $ref must be a string");return(0,n.CreateType)({[a.Kind]:"Ref",$ref:r},s)}return qO}var nH;function yl(){return nH||(nH=1,(function(e){var n=Ah&&Ah.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Ah&&Ah.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(dbe(),e)})(Ah)),Ah}var rH;function lbe(){if(rH)return aO;rH=1,Object.defineProperty(aO,"__esModule",{value:!0}),aO.Awaited=f;const e=cn(),n=Gg(),a=Ka(),t=vi(),i=yl(),r=Dn();function s(b,C){return(0,n.Computed)("Awaited",[(0,n.Computed)(b,C)])}function o(b){return(0,n.Computed)("Awaited",[(0,i.Ref)(b)])}function u(b){return(0,a.Intersect)(l(b))}function c(b){return(0,t.Union)(l(b))}function d(b){return f(b)}function l(b){return b.map(C=>f(C))}function f(b,C){return(0,e.CreateType)((0,r.IsComputed)(b)?s(b.target,b.parameters):(0,r.IsIntersect)(b)?u(b.allOf):(0,r.IsUnion)(b)?c(b.anyOf):(0,r.IsPromise)(b)?d(b.item):(0,r.IsRef)(b)?o(b.$ref):b,C)}return aO}var iH;function ME(){return iH||(iH=1,(function(e){var n=ch&&ch.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=ch&&ch.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(lbe(),e)})(ch)),ch}var Dh={},LO={},kh={},BO={},mS={},pS={},sH;function kx(){if(sH)return pS;sH=1,Object.defineProperty(pS,"__esModule",{value:!0}),pS.KeyOfPropertyKeys=c,pS.KeyOfPattern=l;const e=RE(),n=Dn();function a(f){const b=[];for(const C of f)b.push(c(C));return b}function t(f){const b=a(f);return(0,e.SetUnionMany)(b)}function i(f){const b=a(f);return(0,e.SetIntersectMany)(b)}function r(f){return f.map((b,C)=>C.toString())}function s(f){return["[number]"]}function o(f){return globalThis.Object.getOwnPropertyNames(f)}function u(f){return d?globalThis.Object.getOwnPropertyNames(f).map(C=>C[0]==="^"&&C[C.length-1]==="$"?C.slice(1,C.length-1):C):[]}function c(f){return(0,n.IsIntersect)(f)?t(f.allOf):(0,n.IsUnion)(f)?i(f.anyOf):(0,n.IsTuple)(f)?r(f.items??[]):(0,n.IsArray)(f)?s(f.items):(0,n.IsObject)(f)?o(f.properties):(0,n.IsRecord)(f)?u(f.patternProperties):[]}let d=!1;function l(f){d=!0;const b=c(f);return d=!1,`^(${b.map(v=>`(${v})`).join("|")})$`}return pS}var aH;function Fse(){if(aH)return mS;aH=1,Object.defineProperty(mS,"__esModule",{value:!0}),mS.KeyOfPropertyKeysToRest=f,mS.KeyOf=b;const e=cn(),n=Js(),a=Jg(),t=Gg(),i=yl(),r=kx(),s=vi(),o=jse(),u=Dn();function c(C,v){return(0,t.Computed)("KeyOf",[(0,t.Computed)(C,v)])}function d(C){return(0,t.Computed)("KeyOf",[(0,i.Ref)(C)])}function l(C,v){const m=(0,r.KeyOfPropertyKeys)(C),h=f(m),g=(0,s.UnionEvaluated)(h);return(0,e.CreateType)(g,v)}function f(C){return C.map(v=>v==="[number]"?(0,a.Number)():(0,n.Literal)(v))}function b(C,v){return(0,u.IsComputed)(C)?c(C.target,C.parameters):(0,u.IsRef)(C)?d(C.$ref):(0,u.IsMappedResult)(C)?(0,o.KeyOfFromMappedResult)(C,v):l(C,v)}return mS}var oH;function jse(){if(oH)return BO;oH=1,Object.defineProperty(BO,"__esModule",{value:!0}),BO.KeyOfFromMappedResult=r;const e=Fi(),n=Fse(),a=Na();function t(s,o){const u={};for(const c of globalThis.Object.getOwnPropertyNames(s))u[c]=(0,n.KeyOf)(s[c],(0,a.Clone)(o));return u}function i(s,o){return t(s.properties,o)}function r(s,o){const u=i(s,o);return(0,e.MappedResult)(u)}return BO}var UO={},cH;function fbe(){if(cH)return UO;cH=1,Object.defineProperty(UO,"__esModule",{value:!0}),UO.KeyOfPropertyEntries=a;const e=Dx(),n=kx();function a(t){const i=(0,n.KeyOfPropertyKeys)(t),r=(0,e.IndexFromPropertyKeys)(t,i);return i.map((s,o)=>[i[o],r[o]])}return UO}var uH;function wc(){return uH||(uH=1,(function(e){var n=kh&&kh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=kh&&kh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(jse(),e),a(fbe(),e),a(kx(),e),a(Fse(),e)})(kh)),kh}var dH;function hbe(){if(dH)return LO;dH=1,Object.defineProperty(LO,"__esModule",{value:!0}),LO.Composite=d;const e=Ka(),n=Tc(),a=wc(),t=Aa(),i=RE(),r=Dn();function s(l){const f=[];for(const b of l)f.push(...(0,a.KeyOfPropertyKeys)(b));return(0,i.SetDistinct)(f)}function o(l){return l.filter(f=>!(0,r.IsNever)(f))}function u(l,f){const b=[];for(const C of l)b.push(...(0,n.IndexFromPropertyKeys)(C,[f]));return o(b)}function c(l,f){const b={};for(const C of f)b[C]=(0,e.IntersectEvaluated)(u(l,C));return b}function d(l,f){const b=s(l),C=c(l,b);return(0,t.Object)(C,f)}return LO}var lH;function xx(){return lH||(lH=1,(function(e){var n=Dh&&Dh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Dh&&Dh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(hbe(),e)})(Dh)),Dh}var xh={},zO={},qh={},VO={},fH;function mbe(){if(fH)return VO;fH=1,Object.defineProperty(VO,"__esModule",{value:!0}),VO.Date=a;const e=Xt(),n=cn();function a(t){return(0,n.CreateType)({[e.Kind]:"Date",type:"Date"},t)}return VO}var hH;function NE(){return hH||(hH=1,(function(e){var n=qh&&qh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=qh&&qh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(mbe(),e)})(qh)),qh}var Lh={},HO={},mH;function pbe(){if(mH)return HO;mH=1,Object.defineProperty(HO,"__esModule",{value:!0}),HO.Null=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Null",type:"null"},t)}return HO}var pH;function AE(){return pH||(pH=1,(function(e){var n=Lh&&Lh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Lh&&Lh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(pbe(),e)})(Lh)),Lh}var Bh={},KO={},gH;function gbe(){if(gH)return KO;gH=1,Object.defineProperty(KO,"__esModule",{value:!0}),KO.Symbol=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Symbol",type:"symbol"},t)}return KO}var yH;function DE(){return yH||(yH=1,(function(e){var n=Bh&&Bh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Bh&&Bh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(gbe(),e)})(Bh)),Bh}var Uh={},$O={},bH;function ybe(){if(bH)return $O;bH=1,Object.defineProperty($O,"__esModule",{value:!0}),$O.Undefined=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Undefined",type:"undefined"},t)}return $O}var vH;function kE(){return vH||(vH=1,(function(e){var n=Uh&&Uh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Uh&&Uh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(ybe(),e)})(Uh)),Uh}var zh={},GO={},SH;function bbe(){if(SH)return GO;SH=1,Object.defineProperty(GO,"__esModule",{value:!0}),GO.Uint8Array=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Uint8Array",type:"Uint8Array"},t)}return GO}var CH;function xE(){return CH||(CH=1,(function(e){var n=zh&&zh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=zh&&zh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(bbe(),e)})(zh)),zh}var Vh={},WO={},_H;function vbe(){if(_H)return WO;_H=1,Object.defineProperty(WO,"__esModule",{value:!0}),WO.Unknown=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Unknown"},t)}return WO}var TH;function cb(){return TH||(TH=1,(function(e){var n=Vh&&Vh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Vh&&Vh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(vbe(),e)})(Vh)),Vh}var wH;function Sbe(){if(wH)return zO;wH=1,Object.defineProperty(zO,"__esModule",{value:!0}),zO.Const=_;const e=hT(),n=yT(),a=NE(),t=Wg(),i=Js(),r=AE(),s=Aa(),o=DE(),u=gl(),c=Qg(),d=kE(),l=xE(),f=cb(),b=ml(),C=Ws();function v(S){return S.map(p=>g(p,!1))}function m(S){const p={};for(const w of globalThis.Object.getOwnPropertyNames(S))p[w]=(0,c.Readonly)(g(S[w],!1));return p}function h(S,p){return p===!0?S:(0,c.Readonly)(S)}function g(S,p){return(0,C.IsAsyncIterator)(S)||(0,C.IsIterator)(S)?h((0,e.Any)(),p):(0,C.IsArray)(S)?(0,c.Readonly)((0,u.Tuple)(v(S))):(0,C.IsUint8Array)(S)?(0,l.Uint8Array)():(0,C.IsDate)(S)?(0,a.Date)():(0,C.IsObject)(S)?h((0,s.Object)(m(S)),p):(0,C.IsFunction)(S)?h((0,t.Function)([],(0,f.Unknown)()),p):(0,C.IsUndefined)(S)?(0,d.Undefined)():(0,C.IsNull)(S)?(0,r.Null)():(0,C.IsSymbol)(S)?(0,o.Symbol)():(0,C.IsBigInt)(S)?(0,n.BigInt)():(0,C.IsNumber)(S)||(0,C.IsBoolean)(S)||(0,C.IsString)(S)?(0,i.Literal)(S):(0,s.Object)({})}function _(S,p){return(0,b.CreateType)(g(S,!0),p)}return zO}var OH;function qx(){return OH||(OH=1,(function(e){var n=xh&&xh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=xh&&xh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Sbe(),e)})(xh)),xh}var Hh={},lc={},PH;function Cbe(){if(PH)return lc;PH=1;var e=lc&&lc.__createBinding||(Object.create?(function(o,u,c,d){d===void 0&&(d=c);var l=Object.getOwnPropertyDescriptor(u,c);(!l||("get"in l?!u.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return u[c]}}),Object.defineProperty(o,d,l)}):(function(o,u,c,d){d===void 0&&(d=c),o[d]=u[c]})),n=lc&&lc.__setModuleDefault||(Object.create?(function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}):function(o,u){o.default=u}),a=lc&&lc.__importStar||(function(){var o=function(u){return o=Object.getOwnPropertyNames||function(c){var d=[];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(d[d.length]=l);return d},o(u)};return function(u){if(u&&u.__esModule)return u;var c={};if(u!=null)for(var d=o(u),l=0;l<d.length;l++)d[l]!=="default"&&e(c,u,d[l]);return n(c,u),c}})();Object.defineProperty(lc,"__esModule",{value:!0}),lc.ConstructorParameters=s;const t=gl(),i=bi(),r=a(Dn());function s(o,u){return r.IsConstructor(o)?(0,t.Tuple)(o.parameters,u):(0,i.Never)(u)}return lc}var EH;function Lx(){return EH||(EH=1,(function(e){var n=Hh&&Hh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Hh&&Hh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Cbe(),e)})(Hh)),Hh}var Kh={},JO={},IH;function _be(){if(IH)return JO;IH=1,Object.defineProperty(JO,"__esModule",{value:!0}),JO.Enum=i;const e=Js(),n=Xt(),a=vi(),t=Ws();function i(r,s){if((0,t.IsUndefined)(r))throw new Error("Enum undefined or empty");const o=globalThis.Object.getOwnPropertyNames(r).filter(d=>isNaN(d)).map(d=>r[d]),c=[...new Set(o)].map(d=>(0,e.Literal)(d));return(0,a.Union)(c,{...s,[n.Hint]:"Enum"})}return JO}var RH;function Bx(){return RH||(RH=1,(function(e){var n=Kh&&Kh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Kh&&Kh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(_be(),e)})(Kh)),Kh}var $h={},QO={},YO={},Gh={},Xd={},FH;function Mse(){if(FH)return Xd;FH=1,Object.defineProperty(Xd,"__esModule",{value:!0}),Xd.ExtendsResult=Xd.ExtendsResolverError=void 0,Xd.ExtendsCheck=fn;const e=hT(),n=Wg(),a=Jg(),t=ob(),i=cb(),r=md(),s=IE(),o=Xt(),u=ss(),c=gse();class d extends u.TypeBoxError{}Xd.ExtendsResolverError=d;var l;(function(je){je[je.Union=0]="Union",je[je.True=1]="True",je[je.False=2]="False"})(l||(Xd.ExtendsResult=l={}));function f(je){return je===l.False?je:l.True}function b(je){throw new d(je)}function C(je){return c.TypeGuard.IsNever(je)||c.TypeGuard.IsIntersect(je)||c.TypeGuard.IsUnion(je)||c.TypeGuard.IsUnknown(je)||c.TypeGuard.IsAny(je)}function v(je,Ne){return c.TypeGuard.IsNever(Ne)?G():c.TypeGuard.IsIntersect(Ne)?k(je,Ne):c.TypeGuard.IsUnion(Ne)?Pe(je,Ne):c.TypeGuard.IsUnknown(Ne)?ke():c.TypeGuard.IsAny(Ne)?m():b("StructuralRight")}function m(je,Ne){return l.True}function h(je,Ne){return c.TypeGuard.IsIntersect(Ne)?k(je,Ne):c.TypeGuard.IsUnion(Ne)&&Ne.anyOf.some(Kt=>c.TypeGuard.IsAny(Kt)||c.TypeGuard.IsUnknown(Kt))?l.True:c.TypeGuard.IsUnion(Ne)?l.Union:c.TypeGuard.IsUnknown(Ne)||c.TypeGuard.IsAny(Ne)?l.True:l.Union}function g(je,Ne){return c.TypeGuard.IsUnknown(je)?l.False:c.TypeGuard.IsAny(je)?l.Union:c.TypeGuard.IsNever(je)?l.True:l.False}function _(je,Ne){return c.TypeGuard.IsObject(Ne)&&Ke(Ne)?l.True:C(Ne)?v(je,Ne):c.TypeGuard.IsArray(Ne)?f(zt(je.items,Ne.items)):l.False}function S(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsAsyncIterator(Ne)?f(zt(je.items,Ne.items)):l.False}function p(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsBigInt(Ne)?l.True:l.False}function w(je,Ne){return c.TypeGuard.IsLiteralBoolean(je)||c.TypeGuard.IsBoolean(je)?l.True:l.False}function O(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsBoolean(Ne)?l.True:l.False}function E(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsConstructor(Ne)?je.parameters.length>Ne.parameters.length?l.False:je.parameters.every((Kt,mn)=>f(zt(Ne.parameters[mn],Kt))===l.True)?f(zt(je.returns,Ne.returns)):l.False:l.False}function F(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsDate(Ne)?l.True:l.False}function R(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsFunction(Ne)?je.parameters.length>Ne.parameters.length?l.False:je.parameters.every((Kt,mn)=>f(zt(Ne.parameters[mn],Kt))===l.True)?f(zt(je.returns,Ne.returns)):l.False:l.False}function M(je,Ne){return c.TypeGuard.IsLiteral(je)&&c.ValueGuard.IsNumber(je.const)||c.TypeGuard.IsNumber(je)||c.TypeGuard.IsInteger(je)?l.True:l.False}function j(je,Ne){return c.TypeGuard.IsInteger(Ne)||c.TypeGuard.IsNumber(Ne)?l.True:C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):l.False}function k(je,Ne){return Ne.allOf.every(Kt=>zt(je,Kt)===l.True)?l.True:l.False}function x(je,Ne){return je.allOf.some(Kt=>zt(Kt,Ne)===l.True)?l.True:l.False}function L(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsIterator(Ne)?f(zt(je.items,Ne.items)):l.False}function V(je,Ne){return c.TypeGuard.IsLiteral(Ne)&&Ne.const===je.const?l.True:C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsString(Ne)?xe(je):c.TypeGuard.IsNumber(Ne)?oe(je):c.TypeGuard.IsInteger(Ne)?M(je):c.TypeGuard.IsBoolean(Ne)?w(je):l.False}function G(je,Ne){return l.False}function ee(je,Ne){return l.True}function se(je){let[Ne,Kt]=[je,0];for(;c.TypeGuard.IsNot(Ne);)Ne=Ne.not,Kt+=1;return Kt%2===0?Ne:(0,i.Unknown)()}function re(je,Ne){return c.TypeGuard.IsNot(je)?zt(se(je),Ne):c.TypeGuard.IsNot(Ne)?zt(je,se(Ne)):b("Invalid fallthrough for Not")}function fe(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsNull(Ne)?l.True:l.False}function oe(je,Ne){return c.TypeGuard.IsLiteralNumber(je)||c.TypeGuard.IsNumber(je)||c.TypeGuard.IsInteger(je)?l.True:l.False}function pe(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsInteger(Ne)||c.TypeGuard.IsNumber(Ne)?l.True:l.False}function de(je,Ne){return Object.getOwnPropertyNames(je.properties).length===Ne}function ge(je){return Ke(je)}function Ce(je){return de(je,0)||de(je,1)&&"description"in je.properties&&c.TypeGuard.IsUnion(je.properties.description)&&je.properties.description.anyOf.length===2&&(c.TypeGuard.IsString(je.properties.description.anyOf[0])&&c.TypeGuard.IsUndefined(je.properties.description.anyOf[1])||c.TypeGuard.IsString(je.properties.description.anyOf[1])&&c.TypeGuard.IsUndefined(je.properties.description.anyOf[0]))}function Fe(je){return de(je,0)}function We(je){return de(je,0)}function Ze(je){return de(je,0)}function lt(je){return de(je,0)}function ut(je){return Ke(je)}function pt(je){const Ne=(0,a.Number)();return de(je,0)||de(je,1)&&"length"in je.properties&&f(zt(je.properties.length,Ne))===l.True}function Nt(je){return de(je,0)}function Ke(je){const Ne=(0,a.Number)();return de(je,0)||de(je,1)&&"length"in je.properties&&f(zt(je.properties.length,Ne))===l.True}function Ge(je){const Ne=(0,n.Function)([(0,e.Any)()],(0,e.Any)());return de(je,0)||de(je,1)&&"then"in je.properties&&f(zt(je.properties.then,Ne))===l.True}function Re(je,Ne){return zt(je,Ne)===l.False||c.TypeGuard.IsOptional(je)&&!c.TypeGuard.IsOptional(Ne)?l.False:l.True}function Qe(je,Ne){return c.TypeGuard.IsUnknown(je)?l.False:c.TypeGuard.IsAny(je)?l.Union:c.TypeGuard.IsNever(je)||c.TypeGuard.IsLiteralString(je)&&ge(Ne)||c.TypeGuard.IsLiteralNumber(je)&&Fe(Ne)||c.TypeGuard.IsLiteralBoolean(je)&&We(Ne)||c.TypeGuard.IsSymbol(je)&&Ce(Ne)||c.TypeGuard.IsBigInt(je)&&Ze(Ne)||c.TypeGuard.IsString(je)&&ge(Ne)||c.TypeGuard.IsSymbol(je)&&Ce(Ne)||c.TypeGuard.IsNumber(je)&&Fe(Ne)||c.TypeGuard.IsInteger(je)&&Fe(Ne)||c.TypeGuard.IsBoolean(je)&&We(Ne)||c.TypeGuard.IsUint8Array(je)&&ut(Ne)||c.TypeGuard.IsDate(je)&&lt(Ne)||c.TypeGuard.IsConstructor(je)&&Nt(Ne)||c.TypeGuard.IsFunction(je)&&pt(Ne)?l.True:c.TypeGuard.IsRecord(je)&&c.TypeGuard.IsString(K(je))?Ne[o.Hint]==="Record"?l.True:l.False:c.TypeGuard.IsRecord(je)&&c.TypeGuard.IsNumber(K(je))?de(Ne,0)?l.True:l.False:l.False}function Y(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsObject(Ne)?(()=>{for(const Kt of Object.getOwnPropertyNames(Ne.properties)){if(!(Kt in je.properties)&&!c.TypeGuard.IsOptional(Ne.properties[Kt]))return l.False;if(c.TypeGuard.IsOptional(Ne.properties[Kt]))return l.True;if(Re(je.properties[Kt],Ne.properties[Kt])===l.False)return l.False}return l.True})():l.False}function Me(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)&&Ge(Ne)?l.True:c.TypeGuard.IsPromise(Ne)?f(zt(je.item,Ne.item)):l.False}function K(je){return s.PatternNumberExact in je.patternProperties?(0,a.Number)():s.PatternStringExact in je.patternProperties?(0,t.String)():b("Unknown record key pattern")}function Z(je){return s.PatternNumberExact in je.patternProperties?je.patternProperties[s.PatternNumberExact]:s.PatternStringExact in je.patternProperties?je.patternProperties[s.PatternStringExact]:b("Unable to get record value schema")}function me(je,Ne){const[Kt,mn]=[K(Ne),Z(Ne)];return c.TypeGuard.IsLiteralString(je)&&c.TypeGuard.IsNumber(Kt)&&f(zt(je,mn))===l.True?l.True:c.TypeGuard.IsUint8Array(je)&&c.TypeGuard.IsNumber(Kt)||c.TypeGuard.IsString(je)&&c.TypeGuard.IsNumber(Kt)||c.TypeGuard.IsArray(je)&&c.TypeGuard.IsNumber(Kt)?zt(je,mn):c.TypeGuard.IsObject(je)?(()=>{for(const er of Object.getOwnPropertyNames(je.properties))if(Re(mn,je.properties[er])===l.False)return l.False;return l.True})():l.False}function we(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?zt(Z(je),Z(Ne)):l.False}function qe(je,Ne){const Kt=c.TypeGuard.IsRegExp(je)?(0,t.String)():je,mn=c.TypeGuard.IsRegExp(Ne)?(0,t.String)():Ne;return zt(Kt,mn)}function xe(je,Ne){return c.TypeGuard.IsLiteral(je)&&c.ValueGuard.IsString(je.const)||c.TypeGuard.IsString(je)?l.True:l.False}function Oe(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsString(Ne)?l.True:l.False}function He(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsSymbol(Ne)?l.True:l.False}function Se(je,Ne){return c.TypeGuard.IsTemplateLiteral(je)?zt((0,r.TemplateLiteralToUnion)(je),Ne):c.TypeGuard.IsTemplateLiteral(Ne)?zt(je,(0,r.TemplateLiteralToUnion)(Ne)):b("Invalid fallthrough for TemplateLiteral")}function Ve(je,Ne){return c.TypeGuard.IsArray(Ne)&&je.items!==void 0&&je.items.every(Kt=>zt(Kt,Ne.items)===l.True)}function ot(je,Ne){return c.TypeGuard.IsNever(je)?l.True:c.TypeGuard.IsUnknown(je)?l.False:c.TypeGuard.IsAny(je)?l.Union:l.False}function mt(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)&&Ke(Ne)||c.TypeGuard.IsArray(Ne)&&Ve(je,Ne)?l.True:c.TypeGuard.IsTuple(Ne)?c.ValueGuard.IsUndefined(je.items)&&!c.ValueGuard.IsUndefined(Ne.items)||!c.ValueGuard.IsUndefined(je.items)&&c.ValueGuard.IsUndefined(Ne.items)?l.False:c.ValueGuard.IsUndefined(je.items)&&!c.ValueGuard.IsUndefined(Ne.items)||je.items.every((Kt,mn)=>zt(Kt,Ne.items[mn])===l.True)?l.True:l.False:l.False}function he(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsUint8Array(Ne)?l.True:l.False}function Ue(je,Ne){return C(Ne)?v(je,Ne):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsRecord(Ne)?me(je,Ne):c.TypeGuard.IsVoid(Ne)?Ft(je):c.TypeGuard.IsUndefined(Ne)?l.True:l.False}function Pe(je,Ne){return Ne.anyOf.some(Kt=>zt(je,Kt)===l.True)?l.True:l.False}function Ye(je,Ne){return je.anyOf.every(Kt=>zt(Kt,Ne)===l.True)?l.True:l.False}function ke(je,Ne){return l.True}function Rt(je,Ne){return c.TypeGuard.IsNever(Ne)?G():c.TypeGuard.IsIntersect(Ne)?k(je,Ne):c.TypeGuard.IsUnion(Ne)?Pe(je,Ne):c.TypeGuard.IsAny(Ne)?m():c.TypeGuard.IsString(Ne)?xe(je):c.TypeGuard.IsNumber(Ne)?oe(je):c.TypeGuard.IsInteger(Ne)?M(je):c.TypeGuard.IsBoolean(Ne)?w(je):c.TypeGuard.IsArray(Ne)?g(je):c.TypeGuard.IsTuple(Ne)?ot(je):c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsUnknown(Ne)?l.True:l.False}function Ft(je,Ne){return c.TypeGuard.IsUndefined(je)||c.TypeGuard.IsUndefined(je)?l.True:l.False}function xt(je,Ne){return c.TypeGuard.IsIntersect(Ne)?k(je,Ne):c.TypeGuard.IsUnion(Ne)?Pe(je,Ne):c.TypeGuard.IsUnknown(Ne)?ke():c.TypeGuard.IsAny(Ne)?m():c.TypeGuard.IsObject(Ne)?Qe(je,Ne):c.TypeGuard.IsVoid(Ne)?l.True:l.False}function zt(je,Ne){return c.TypeGuard.IsTemplateLiteral(je)||c.TypeGuard.IsTemplateLiteral(Ne)?Se(je,Ne):c.TypeGuard.IsRegExp(je)||c.TypeGuard.IsRegExp(Ne)?qe(je,Ne):c.TypeGuard.IsNot(je)||c.TypeGuard.IsNot(Ne)?re(je,Ne):c.TypeGuard.IsAny(je)?h(je,Ne):c.TypeGuard.IsArray(je)?_(je,Ne):c.TypeGuard.IsBigInt(je)?p(je,Ne):c.TypeGuard.IsBoolean(je)?O(je,Ne):c.TypeGuard.IsAsyncIterator(je)?S(je,Ne):c.TypeGuard.IsConstructor(je)?E(je,Ne):c.TypeGuard.IsDate(je)?F(je,Ne):c.TypeGuard.IsFunction(je)?R(je,Ne):c.TypeGuard.IsInteger(je)?j(je,Ne):c.TypeGuard.IsIntersect(je)?x(je,Ne):c.TypeGuard.IsIterator(je)?L(je,Ne):c.TypeGuard.IsLiteral(je)?V(je,Ne):c.TypeGuard.IsNever(je)?ee():c.TypeGuard.IsNull(je)?fe(je,Ne):c.TypeGuard.IsNumber(je)?pe(je,Ne):c.TypeGuard.IsObject(je)?Y(je,Ne):c.TypeGuard.IsRecord(je)?we(je,Ne):c.TypeGuard.IsString(je)?Oe(je,Ne):c.TypeGuard.IsSymbol(je)?He(je,Ne):c.TypeGuard.IsTuple(je)?mt(je,Ne):c.TypeGuard.IsPromise(je)?Me(je,Ne):c.TypeGuard.IsUint8Array(je)?he(je,Ne):c.TypeGuard.IsUndefined(je)?Ue(je,Ne):c.TypeGuard.IsUnion(je)?Ye(je,Ne):c.TypeGuard.IsUnknown(je)?Rt(je,Ne):c.TypeGuard.IsVoid(je)?xt(je,Ne):b(`Unknown left type operand '${je[o.Kind]}'`)}function fn(je,Ne){return zt(je,Ne)}return Xd}var XO={},ZO={},eP={},jH;function Nse(){if(jH)return eP;jH=1,Object.defineProperty(eP,"__esModule",{value:!0}),eP.ExtendsFromMappedResult=r;const e=Fi(),n=Ux(),a=Na();function t(s,o,u,c,d){const l={};for(const f of globalThis.Object.getOwnPropertyNames(s))l[f]=(0,n.Extends)(s[f],o,u,c,(0,a.Clone)(d));return l}function i(s,o,u,c,d){return t(s.properties,o,u,c,d)}function r(s,o,u,c,d){const l=i(s,o,u,c,d);return(0,e.MappedResult)(l)}return eP}var MH;function Ux(){if(MH)return ZO;MH=1,Object.defineProperty(ZO,"__esModule",{value:!0}),ZO.Extends=o;const e=cn(),n=vi(),a=Mse(),t=Ase(),i=Nse(),r=Dn();function s(u,c,d,l){const f=(0,a.ExtendsCheck)(u,c);return f===a.ExtendsResult.Union?(0,n.Union)([d,l]):f===a.ExtendsResult.True?d:l}function o(u,c,d,l,f){return(0,r.IsMappedResult)(u)?(0,i.ExtendsFromMappedResult)(u,c,d,l,f):(0,r.IsMappedKey)(u)?(0,e.CreateType)((0,t.ExtendsFromMappedKey)(u,c,d,l,f)):(0,e.CreateType)(s(u,c,d,l),f)}return ZO}var NH;function Ase(){if(NH)return XO;NH=1,Object.defineProperty(XO,"__esModule",{value:!0}),XO.ExtendsFromMappedKey=o;const e=Fi(),n=Js(),a=Ux(),t=Na();function i(u,c,d,l,f){return{[u]:(0,a.Extends)((0,n.Literal)(u),c,d,l,(0,t.Clone)(f))}}function r(u,c,d,l,f){return u.reduce((b,C)=>({...b,...i(C,c,d,l,f)}),{})}function s(u,c,d,l,f){return r(u.keys,c,d,l,f)}function o(u,c,d,l,f){const b=s(u,c,d,l,f);return(0,e.MappedResult)(b)}return XO}var tP={},AH;function zx(){if(AH)return tP;AH=1,Object.defineProperty(tP,"__esModule",{value:!0}),tP.ExtendsUndefinedCheck=i;const e=Xt();function n(r){return r.allOf.every(s=>i(s))}function a(r){return r.anyOf.some(s=>i(s))}function t(r){return!i(r.not)}function i(r){return r[e.Kind]==="Intersect"?n(r):r[e.Kind]==="Union"?a(r):r[e.Kind]==="Not"?t(r):r[e.Kind]==="Undefined"}return tP}var DH;function ub(){return DH||(DH=1,(function(e){var n=Gh&&Gh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Gh&&Gh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Mse(),e),a(Ase(),e),a(Nse(),e),a(zx(),e),a(Ux(),e)})(Gh)),Gh}var nP={},kH;function Dse(){if(kH)return nP;kH=1,Object.defineProperty(nP,"__esModule",{value:!0}),nP.ExcludeFromTemplateLiteral=a;const e=Vx(),n=md();function a(t,i){return(0,e.Exclude)((0,n.TemplateLiteralToUnion)(t),i)}return nP}var xH;function Vx(){if(xH)return YO;xH=1,Object.defineProperty(YO,"__esModule",{value:!0}),YO.Exclude=u;const e=cn(),n=vi(),a=bi(),t=ub(),i=kse(),r=Dse(),s=Dn();function o(c,d){const l=c.filter(f=>(0,t.ExtendsCheck)(f,d)===t.ExtendsResult.False);return l.length===1?l[0]:(0,n.Union)(l)}function u(c,d,l={}){return(0,s.IsTemplateLiteral)(c)?(0,e.CreateType)((0,r.ExcludeFromTemplateLiteral)(c,d),l):(0,s.IsMappedResult)(c)?(0,e.CreateType)((0,i.ExcludeFromMappedResult)(c,d),l):(0,e.CreateType)((0,s.IsUnion)(c)?o(c.anyOf,d):(0,t.ExtendsCheck)(c,d)!==t.ExtendsResult.False?(0,a.Never)():c,l)}return YO}var qH;function kse(){if(qH)return QO;qH=1,Object.defineProperty(QO,"__esModule",{value:!0}),QO.ExcludeFromMappedResult=i;const e=Fi(),n=Vx();function a(r,s){const o={};for(const u of globalThis.Object.getOwnPropertyNames(r))o[u]=(0,n.Exclude)(r[u],s);return o}function t(r,s){return a(r.properties,s)}function i(r,s){const o=t(r,s);return(0,e.MappedResult)(o)}return QO}var LH;function Hx(){return LH||(LH=1,(function(e){var n=$h&&$h.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=$h&&$h.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(kse(),e),a(Dse(),e),a(Vx(),e)})($h)),$h}var Wh={},rP={},iP={},sP={},BH;function xse(){if(BH)return sP;BH=1,Object.defineProperty(sP,"__esModule",{value:!0}),sP.ExtractFromTemplateLiteral=a;const e=Kx(),n=md();function a(t,i){return(0,e.Extract)((0,n.TemplateLiteralToUnion)(t),i)}return sP}var UH;function Kx(){if(UH)return iP;UH=1,Object.defineProperty(iP,"__esModule",{value:!0}),iP.Extract=u;const e=cn(),n=vi(),a=bi(),t=ub(),i=qse(),r=xse(),s=Dn();function o(c,d){const l=c.filter(f=>(0,t.ExtendsCheck)(f,d)!==t.ExtendsResult.False);return l.length===1?l[0]:(0,n.Union)(l)}function u(c,d,l){return(0,s.IsTemplateLiteral)(c)?(0,e.CreateType)((0,r.ExtractFromTemplateLiteral)(c,d),l):(0,s.IsMappedResult)(c)?(0,e.CreateType)((0,i.ExtractFromMappedResult)(c,d),l):(0,e.CreateType)((0,s.IsUnion)(c)?o(c.anyOf,d):(0,t.ExtendsCheck)(c,d)!==t.ExtendsResult.False?c:(0,a.Never)(),l)}return iP}var zH;function qse(){if(zH)return rP;zH=1,Object.defineProperty(rP,"__esModule",{value:!0}),rP.ExtractFromMappedResult=i;const e=Fi(),n=Kx();function a(r,s){const o={};for(const u of globalThis.Object.getOwnPropertyNames(r))o[u]=(0,n.Extract)(r[u],s);return o}function t(r,s){return a(r.properties,s)}function i(r,s){const o=t(r,s);return(0,e.MappedResult)(o)}return rP}var VH;function $x(){return VH||(VH=1,(function(e){var n=Wh&&Wh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Wh&&Wh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(qse(),e),a(xse(),e),a(Kx(),e)})(Wh)),Wh}var Jh={},fc={},HH;function Tbe(){if(HH)return fc;HH=1;var e=fc&&fc.__createBinding||(Object.create?(function(o,u,c,d){d===void 0&&(d=c);var l=Object.getOwnPropertyDescriptor(u,c);(!l||("get"in l?!u.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return u[c]}}),Object.defineProperty(o,d,l)}):(function(o,u,c,d){d===void 0&&(d=c),o[d]=u[c]})),n=fc&&fc.__setModuleDefault||(Object.create?(function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}):function(o,u){o.default=u}),a=fc&&fc.__importStar||(function(){var o=function(u){return o=Object.getOwnPropertyNames||function(c){var d=[];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(d[d.length]=l);return d},o(u)};return function(u){if(u&&u.__esModule)return u;var c={};if(u!=null)for(var d=o(u),l=0;l<d.length;l++)d[l]!=="default"&&e(c,u,d[l]);return n(c,u),c}})();Object.defineProperty(fc,"__esModule",{value:!0}),fc.InstanceType=s;const t=cn(),i=bi(),r=a(Dn());function s(o,u){return r.IsConstructor(o)?(0,t.CreateType)(o.returns,u):(0,i.Never)(u)}return fc}var KH;function Gx(){return KH||(KH=1,(function(e){var n=Jh&&Jh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Jh&&Jh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Tbe(),e)})(Jh)),Jh}var Qh={},fo={},Yh={},aP={},$H;function wbe(){if($H)return aP;$H=1,Object.defineProperty(aP,"__esModule",{value:!0}),aP.ReadonlyOptional=a;const e=Qg(),n=pd();function a(t){return(0,e.Readonly)((0,n.Optional)(t))}return aP}var GH;function qE(){return GH||(GH=1,(function(e){var n=Yh&&Yh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Yh&&Yh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(wbe(),e)})(Yh)),Yh}var Xh={},Zh={},WH;function Obe(){if(WH)return Zh;WH=1,Object.defineProperty(Zh,"__esModule",{value:!0}),Zh.Record=E,Zh.RecordPattern=F,Zh.RecordKey=R,Zh.RecordValue=M;const e=cn(),n=Xt(),a=bi(),t=Jg(),i=Aa(),r=ob(),s=vi(),o=md(),u=IE(),c=Tc(),d=Ws(),l=Dn();function f(j,k,x){return(0,e.CreateType)({[n.Kind]:"Record",type:"object",patternProperties:{[j]:k}},x)}function b(j,k,x){const L={};for(const V of j)L[V]=k;return(0,i.Object)(L,{...x,[n.Hint]:"Record"})}function C(j,k,x){return(0,o.IsTemplateLiteralFinite)(j)?b((0,c.IndexPropertyKeys)(j),k,x):f(j.pattern,k,x)}function v(j,k,x){return b((0,c.IndexPropertyKeys)((0,s.Union)(j)),k,x)}function m(j,k,x){return b([j.toString()],k,x)}function h(j,k,x){return f(j.source,k,x)}function g(j,k,x){const L=(0,d.IsUndefined)(j.pattern)?u.PatternStringExact:j.pattern;return f(L,k,x)}function _(j,k,x){return f(u.PatternStringExact,k,x)}function S(j,k,x){return f(u.PatternNeverExact,k,x)}function p(j,k,x){return(0,i.Object)({true:k,false:k},x)}function w(j,k,x){return f(u.PatternNumberExact,k,x)}function O(j,k,x){return f(u.PatternNumberExact,k,x)}function E(j,k,x={}){return(0,l.IsUnion)(j)?v(j.anyOf,k,x):(0,l.IsTemplateLiteral)(j)?C(j,k,x):(0,l.IsLiteral)(j)?m(j.const,k,x):(0,l.IsBoolean)(j)?p(j,k,x):(0,l.IsInteger)(j)?w(j,k,x):(0,l.IsNumber)(j)?O(j,k,x):(0,l.IsRegExp)(j)?h(j,k,x):(0,l.IsString)(j)?g(j,k,x):(0,l.IsAny)(j)?_(j,k,x):(0,l.IsNever)(j)?S(j,k,x):(0,a.Never)(x)}function F(j){return globalThis.Object.getOwnPropertyNames(j.patternProperties)[0]}function R(j){const k=F(j);return k===u.PatternStringExact?(0,r.String)():k===u.PatternNumberExact?(0,t.Number)():(0,r.String)({pattern:k})}function M(j){return j.patternProperties[F(j)]}return Zh}var JH;function vT(){return JH||(JH=1,(function(e){var n=Xh&&Xh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Xh&&Xh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Obe(),e)})(Xh)),Xh}var QH;function Pbe(){if(QH)return fo;QH=1;var e=fo&&fo.__createBinding||(Object.create?(function(k,x,L,V){V===void 0&&(V=L);var G=Object.getOwnPropertyDescriptor(x,L);(!G||("get"in G?!x.__esModule:G.writable||G.configurable))&&(G={enumerable:!0,get:function(){return x[L]}}),Object.defineProperty(k,V,G)}):(function(k,x,L,V){V===void 0&&(V=L),k[V]=x[L]})),n=fo&&fo.__setModuleDefault||(Object.create?(function(k,x){Object.defineProperty(k,"default",{enumerable:!0,value:x})}):function(k,x){k.default=x}),a=fo&&fo.__importStar||(function(){var k=function(x){return k=Object.getOwnPropertyNames||function(L){var V=[];for(var G in L)Object.prototype.hasOwnProperty.call(L,G)&&(V[V.length]=G);return V},k(x)};return function(x){if(x&&x.__esModule)return x;var L={};if(x!=null)for(var V=k(x),G=0;G<V.length;G++)V[G]!=="default"&&e(L,x,V[G]);return n(L,x),L}})();Object.defineProperty(fo,"__esModule",{value:!0}),fo.FromTypes=R,fo.Instantiate=j;const t=Fx(),i=cb(),r=qE(),s=Qg(),o=pd(),u=Aa(),c=vT(),d=a(Ws()),l=a(Dn());function f(k,x){return x.parameters=R(k,x.parameters),x.returns=M(k,x.returns),x}function b(k,x){return x.parameters=R(k,x.parameters),x.returns=M(k,x.returns),x}function C(k,x){return x.allOf=R(k,x.allOf),x}function v(k,x){return x.anyOf=R(k,x.anyOf),x}function m(k,x){return d.IsUndefined(x.items)||(x.items=R(k,x.items)),x}function h(k,x){return x.items=M(k,x.items),x}function g(k,x){return x.items=M(k,x.items),x}function _(k,x){return x.items=M(k,x.items),x}function S(k,x){return x.item=M(k,x.item),x}function p(k,x){const L=F(k,x.properties);return{...x,...(0,u.Object)(L)}}function w(k,x){const L=M(k,(0,c.RecordKey)(x)),V=M(k,(0,c.RecordValue)(x)),G=(0,c.Record)(L,V);return{...x,...G}}function O(k,x){return x.index in k?k[x.index]:(0,i.Unknown)()}function E(k,x){const L=l.IsReadonly(x),V=l.IsOptional(x),G=M(k,x);return L&&V?(0,r.ReadonlyOptional)(G):L&&!V?(0,s.Readonly)(G):!L&&V?(0,o.Optional)(G):G}function F(k,x){return globalThis.Object.getOwnPropertyNames(x).reduce((L,V)=>({...L,[V]:E(k,x[V])}),{})}function R(k,x){return x.map(L=>M(k,L))}function M(k,x){return l.IsConstructor(x)?f(k,x):l.IsFunction(x)?b(k,x):l.IsIntersect(x)?C(k,x):l.IsUnion(x)?v(k,x):l.IsTuple(x)?m(k,x):l.IsArray(x)?h(k,x):l.IsAsyncIterator(x)?g(k,x):l.IsIterator(x)?_(k,x):l.IsPromise(x)?S(k,x):l.IsObject(x)?p(k,x):l.IsRecord(x)?w(k,x):l.IsArgument(x)?O(k,x):x}function j(k,x){return M(x,(0,t.CloneType)(k))}return fo}var YH;function Wx(){return YH||(YH=1,(function(e){var n=Qh&&Qh.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Qh&&Qh.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Pbe(),e)})(Qh)),Qh}var em={},oP={},XH;function Ebe(){if(XH)return oP;XH=1,Object.defineProperty(oP,"__esModule",{value:!0}),oP.Integer=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Integer",type:"integer"},t)}return oP}var ZH;function Jx(){return ZH||(ZH=1,(function(e){var n=em&&em.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=em&&em.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Ebe(),e)})(em)),em}var tm={},cP={},uP={},dP={},e9;function Lse(){if(e9)return dP;e9=1,Object.defineProperty(dP,"__esModule",{value:!0}),dP.IntrinsicFromMappedKey=o;const e=Fi(),n=db(),a=Js(),t=Na();function i(u,c,d){return{[u]:(0,n.Intrinsic)((0,a.Literal)(u),c,(0,t.Clone)(d))}}function r(u,c,d){return u.reduce((f,b)=>({...f,...i(b,c,d)}),{})}function s(u,c,d){return r(u.keys,c,d)}function o(u,c,d){const l=s(u,c,d);return(0,e.MappedResult)(l)}return dP}var t9;function db(){if(t9)return uP;t9=1,Object.defineProperty(uP,"__esModule",{value:!0}),uP.Intrinsic=b;const e=cn(),n=md(),a=Lse(),t=Js(),i=vi(),r=Dn();function s(C){const[v,m]=[C.slice(0,1),C.slice(1)];return[v.toLowerCase(),m].join("")}function o(C){const[v,m]=[C.slice(0,1),C.slice(1)];return[v.toUpperCase(),m].join("")}function u(C){return C.toUpperCase()}function c(C){return C.toLowerCase()}function d(C,v,m){const h=(0,n.TemplateLiteralParseExact)(C.pattern);if(!(0,n.IsTemplateLiteralExpressionFinite)(h))return{...C,pattern:l(C.pattern,v)};const S=[...(0,n.TemplateLiteralExpressionGenerate)(h)].map(O=>(0,t.Literal)(O)),p=f(S,v),w=(0,i.Union)(p);return(0,n.TemplateLiteral)([w],m)}function l(C,v){return typeof C=="string"?v==="Uncapitalize"?s(C):v==="Capitalize"?o(C):v==="Uppercase"?u(C):v==="Lowercase"?c(C):C:C.toString()}function f(C,v){return C.map(m=>b(m,v))}function b(C,v,m={}){return(0,r.IsMappedKey)(C)?(0,a.IntrinsicFromMappedKey)(C,v,m):(0,r.IsTemplateLiteral)(C)?d(C,v,m):(0,r.IsUnion)(C)?(0,i.Union)(f(C.anyOf,v),m):(0,r.IsLiteral)(C)?(0,t.Literal)(l(C.const,v),m):(0,e.CreateType)(C,m)}return uP}var n9;function Ibe(){if(n9)return cP;n9=1,Object.defineProperty(cP,"__esModule",{value:!0}),cP.Capitalize=n;const e=db();function n(a,t={}){return(0,e.Intrinsic)(a,"Capitalize",t)}return cP}var lP={},r9;function Rbe(){if(r9)return lP;r9=1,Object.defineProperty(lP,"__esModule",{value:!0}),lP.Lowercase=n;const e=db();function n(a,t={}){return(0,e.Intrinsic)(a,"Lowercase",t)}return lP}var fP={},i9;function Fbe(){if(i9)return fP;i9=1,Object.defineProperty(fP,"__esModule",{value:!0}),fP.Uncapitalize=n;const e=db();function n(a,t={}){return(0,e.Intrinsic)(a,"Uncapitalize",t)}return fP}var hP={},s9;function jbe(){if(s9)return hP;s9=1,Object.defineProperty(hP,"__esModule",{value:!0}),hP.Uppercase=n;const e=db();function n(a,t={}){return(0,e.Intrinsic)(a,"Uppercase",t)}return hP}var a9;function Qx(){return a9||(a9=1,(function(e){var n=tm&&tm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=tm&&tm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Ibe(),e),a(Lse(),e),a(db(),e),a(Rbe(),e),a(Fbe(),e),a(jbe(),e)})(tm)),tm}var nm={},Ky={},Va={},rm={},mP={},pP={},gP={},o9;function Bse(){if(o9)return gP;o9=1,Object.defineProperty(gP,"__esModule",{value:!0}),gP.OmitFromMappedResult=r;const e=Fi(),n=Yx(),a=Na();function t(s,o,u){const c={};for(const d of globalThis.Object.getOwnPropertyNames(s))c[d]=(0,n.Omit)(s[d],o,(0,a.Clone)(u));return c}function i(s,o,u){return t(s.properties,o,u)}function r(s,o,u){const c=i(s,o,u);return(0,e.MappedResult)(c)}return gP}var c9;function Yx(){if(c9)return pP;c9=1,Object.defineProperty(pP,"__esModule",{value:!0}),pP.Omit=S;const e=cn(),n=Mx(),a=EE(),t=Gg(),i=Js(),r=Tc(),s=Ka(),o=vi(),u=Aa(),c=Use(),d=Bse(),l=Dn(),f=Ws();function b(p,w){return p.map(O=>_(O,w))}function C(p,w){return p.map(O=>_(O,w))}function v(p,w){const{[w]:O,...E}=p;return E}function m(p,w){return w.reduce((O,E)=>v(O,E),p)}function h(p,w){const O=(0,n.Discard)(p,[a.TransformKind,"$id","required","properties"]),E=m(p.properties,w);return(0,u.Object)(E,O)}function g(p){const w=p.reduce((O,E)=>(0,l.IsLiteralValue)(E)?[...O,(0,i.Literal)(E)]:O,[]);return(0,o.Union)(w)}function _(p,w){return(0,l.IsIntersect)(p)?(0,s.Intersect)(b(p.allOf,w)):(0,l.IsUnion)(p)?(0,o.Union)(C(p.anyOf,w)):(0,l.IsObject)(p)?h(p,w):(0,u.Object)({})}function S(p,w,O){const E=(0,f.IsArray)(w)?g(w):w,F=(0,l.IsSchema)(w)?(0,r.IndexPropertyKeys)(w):w,R=(0,l.IsRef)(p),M=(0,l.IsRef)(w);return(0,l.IsMappedResult)(p)?(0,d.OmitFromMappedResult)(p,F,O):(0,l.IsMappedKey)(w)?(0,c.OmitFromMappedKey)(p,w,O):R&&M?(0,t.Computed)("Omit",[p,E],O):!R&&M?(0,t.Computed)("Omit",[p,E],O):R&&!M?(0,t.Computed)("Omit",[p,E],O):(0,e.CreateType)({..._(p,F),...O})}return pP}var u9;function Use(){if(u9)return mP;u9=1,Object.defineProperty(mP,"__esModule",{value:!0}),mP.OmitFromMappedKey=s;const e=Fi(),n=Yx(),a=Na();function t(o,u,c){return{[u]:(0,n.Omit)(o,[u],(0,a.Clone)(c))}}function i(o,u,c){return u.reduce((d,l)=>({...d,...t(o,l,c)}),{})}function r(o,u,c){return i(o,u.keys,c)}function s(o,u,c){const d=r(o,u,c);return(0,e.MappedResult)(d)}return mP}var d9;function LE(){return d9||(d9=1,(function(e){var n=rm&&rm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=rm&&rm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Use(),e),a(Bse(),e),a(Yx(),e)})(rm)),rm}var im={},yP={},bP={},vP={},l9;function zse(){if(l9)return vP;l9=1,Object.defineProperty(vP,"__esModule",{value:!0}),vP.PickFromMappedResult=r;const e=Fi(),n=Xx(),a=Na();function t(s,o,u){const c={};for(const d of globalThis.Object.getOwnPropertyNames(s))c[d]=(0,n.Pick)(s[d],o,(0,a.Clone)(u));return c}function i(s,o,u){return t(s.properties,o,u)}function r(s,o,u){const c=i(s,o,u);return(0,e.MappedResult)(c)}return vP}var f9;function Xx(){if(f9)return bP;f9=1,Object.defineProperty(bP,"__esModule",{value:!0}),bP.Pick=_;const e=cn(),n=Mx(),a=Gg(),t=Ka(),i=Js(),r=Aa(),s=vi(),o=Tc(),u=EE(),c=Dn(),d=Ws(),l=Vse(),f=zse();function b(S,p){return S.map(w=>g(w,p))}function C(S,p){return S.map(w=>g(w,p))}function v(S,p){const w={};for(const O of p)O in S&&(w[O]=S[O]);return w}function m(S,p){const w=(0,n.Discard)(S,[u.TransformKind,"$id","required","properties"]),O=v(S.properties,p);return(0,r.Object)(O,w)}function h(S){const p=S.reduce((w,O)=>(0,c.IsLiteralValue)(O)?[...w,(0,i.Literal)(O)]:w,[]);return(0,s.Union)(p)}function g(S,p){return(0,c.IsIntersect)(S)?(0,t.Intersect)(b(S.allOf,p)):(0,c.IsUnion)(S)?(0,s.Union)(C(S.anyOf,p)):(0,c.IsObject)(S)?m(S,p):(0,r.Object)({})}function _(S,p,w){const O=(0,d.IsArray)(p)?h(p):p,E=(0,c.IsSchema)(p)?(0,o.IndexPropertyKeys)(p):p,F=(0,c.IsRef)(S),R=(0,c.IsRef)(p);return(0,c.IsMappedResult)(S)?(0,f.PickFromMappedResult)(S,E,w):(0,c.IsMappedKey)(p)?(0,l.PickFromMappedKey)(S,p,w):F&&R?(0,a.Computed)("Pick",[S,O],w):!F&&R?(0,a.Computed)("Pick",[S,O],w):F&&!R?(0,a.Computed)("Pick",[S,O],w):(0,e.CreateType)({...g(S,E),...w})}return bP}var h9;function Vse(){if(h9)return yP;h9=1,Object.defineProperty(yP,"__esModule",{value:!0}),yP.PickFromMappedKey=s;const e=Fi(),n=Xx(),a=Na();function t(o,u,c){return{[u]:(0,n.Pick)(o,[u],(0,a.Clone)(c))}}function i(o,u,c){return u.reduce((d,l)=>({...d,...t(o,l,c)}),{})}function r(o,u,c){return i(o,u.keys,c)}function s(o,u,c){const d=r(o,u,c);return(0,e.MappedResult)(d)}return yP}var m9;function BE(){return m9||(m9=1,(function(e){var n=im&&im.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=im&&im.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Vse(),e),a(zse(),e),a(Xx(),e)})(im)),im}var sm={},SP={},hc={},p9;function Hse(){if(p9)return hc;p9=1;var e=hc&&hc.__createBinding||(Object.create?(function(p,w,O,E){E===void 0&&(E=O);var F=Object.getOwnPropertyDescriptor(w,O);(!F||("get"in F?!w.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return w[O]}}),Object.defineProperty(p,E,F)}):(function(p,w,O,E){E===void 0&&(E=O),p[E]=w[O]})),n=hc&&hc.__setModuleDefault||(Object.create?(function(p,w){Object.defineProperty(p,"default",{enumerable:!0,value:w})}):function(p,w){p.default=w}),a=hc&&hc.__importStar||(function(){var p=function(w){return p=Object.getOwnPropertyNames||function(O){var E=[];for(var F in O)Object.prototype.hasOwnProperty.call(O,F)&&(E[E.length]=F);return E},p(w)};return function(w){if(w&&w.__esModule)return w;var O={};if(w!=null)for(var E=p(w),F=0;F<E.length;F++)E[F]!=="default"&&e(O,w,E[F]);return n(O,w),O}})();Object.defineProperty(hc,"__esModule",{value:!0}),hc.Partial=S;const t=cn(),i=Gg(),r=pd(),s=Aa(),o=Ka(),u=vi(),c=yl(),d=pl(),l=Xt(),f=Kse(),b=a(Dn());function C(p,w){return(0,i.Computed)("Partial",[(0,i.Computed)(p,w)])}function v(p){return(0,i.Computed)("Partial",[(0,c.Ref)(p)])}function m(p){const w={};for(const O of globalThis.Object.getOwnPropertyNames(p))w[O]=(0,r.Optional)(p[O]);return w}function h(p){const w=(0,d.Discard)(p,[l.TransformKind,"$id","required","properties"]),O=m(p.properties);return(0,s.Object)(O,w)}function g(p){return p.map(w=>_(w))}function _(p){return b.IsComputed(p)?C(p.target,p.parameters):b.IsRef(p)?v(p.$ref):b.IsIntersect(p)?(0,o.Intersect)(g(p.allOf)):b.IsUnion(p)?(0,u.Union)(g(p.anyOf)):b.IsObject(p)?h(p):b.IsBigInt(p)||b.IsBoolean(p)||b.IsInteger(p)||b.IsLiteral(p)||b.IsNull(p)||b.IsNumber(p)||b.IsString(p)||b.IsSymbol(p)||b.IsUndefined(p)?p:(0,s.Object)({})}function S(p,w){return b.IsMappedResult(p)?(0,f.PartialFromMappedResult)(p,w):(0,t.CreateType)({..._(p),...w})}return hc}var g9;function Kse(){if(g9)return SP;g9=1,Object.defineProperty(SP,"__esModule",{value:!0}),SP.PartialFromMappedResult=r;const e=Fi(),n=Hse(),a=Na();function t(s,o){const u={};for(const c of globalThis.Object.getOwnPropertyNames(s))u[c]=(0,n.Partial)(s[c],(0,a.Clone)(o));return u}function i(s,o){return t(s.properties,o)}function r(s,o){const u=i(s,o);return(0,e.MappedResult)(u)}return SP}var y9;function UE(){return y9||(y9=1,(function(e){var n=sm&&sm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=sm&&sm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Kse(),e),a(Hse(),e)})(sm)),sm}var am={},CP={},mc={},b9;function $se(){if(b9)return mc;b9=1;var e=mc&&mc.__createBinding||(Object.create?(function(S,p,w,O){O===void 0&&(O=w);var E=Object.getOwnPropertyDescriptor(p,w);(!E||("get"in E?!p.__esModule:E.writable||E.configurable))&&(E={enumerable:!0,get:function(){return p[w]}}),Object.defineProperty(S,O,E)}):(function(S,p,w,O){O===void 0&&(O=w),S[O]=p[w]})),n=mc&&mc.__setModuleDefault||(Object.create?(function(S,p){Object.defineProperty(S,"default",{enumerable:!0,value:p})}):function(S,p){S.default=p}),a=mc&&mc.__importStar||(function(){var S=function(p){return S=Object.getOwnPropertyNames||function(w){var O=[];for(var E in w)Object.prototype.hasOwnProperty.call(w,E)&&(O[O.length]=E);return O},S(p)};return function(p){if(p&&p.__esModule)return p;var w={};if(p!=null)for(var O=S(p),E=0;E<O.length;E++)O[E]!=="default"&&e(w,p,O[E]);return n(w,p),w}})();Object.defineProperty(mc,"__esModule",{value:!0}),mc.Required=_;const t=cn(),i=Gg(),r=Aa(),s=Ka(),o=vi(),u=yl(),c=Xt(),d=pl(),l=Gse(),f=a(Dn());function b(S,p){return(0,i.Computed)("Required",[(0,i.Computed)(S,p)])}function C(S){return(0,i.Computed)("Required",[(0,u.Ref)(S)])}function v(S){const p={};for(const w of globalThis.Object.getOwnPropertyNames(S))p[w]=(0,d.Discard)(S[w],[c.OptionalKind]);return p}function m(S){const p=(0,d.Discard)(S,[c.TransformKind,"$id","required","properties"]),w=v(S.properties);return(0,r.Object)(w,p)}function h(S){return S.map(p=>g(p))}function g(S){return f.IsComputed(S)?b(S.target,S.parameters):f.IsRef(S)?C(S.$ref):f.IsIntersect(S)?(0,s.Intersect)(h(S.allOf)):f.IsUnion(S)?(0,o.Union)(h(S.anyOf)):f.IsObject(S)?m(S):f.IsBigInt(S)||f.IsBoolean(S)||f.IsInteger(S)||f.IsLiteral(S)||f.IsNull(S)||f.IsNumber(S)||f.IsString(S)||f.IsSymbol(S)||f.IsUndefined(S)?S:(0,r.Object)({})}function _(S,p){return f.IsMappedResult(S)?(0,l.RequiredFromMappedResult)(S,p):(0,t.CreateType)({...g(S),...p})}return mc}var v9;function Gse(){if(v9)return CP;v9=1,Object.defineProperty(CP,"__esModule",{value:!0}),CP.RequiredFromMappedResult=i;const e=Fi(),n=$se();function a(r,s){const o={};for(const u of globalThis.Object.getOwnPropertyNames(r))o[u]=(0,n.Required)(r[u],s);return o}function t(r,s){return a(r.properties,s)}function i(r,s){const o=t(r,s);return(0,e.MappedResult)(o)}return CP}var S9;function zE(){return S9||(S9=1,(function(e){var n=am&&am.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=am&&am.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Gse(),e),a($se(),e)})(am)),am}var C9;function Mbe(){if(C9)return Va;C9=1;var e=Va&&Va.__createBinding||(Object.create?(function(Ge,Re,Qe,Y){Y===void 0&&(Y=Qe);var Me=Object.getOwnPropertyDescriptor(Re,Qe);(!Me||("get"in Me?!Re.__esModule:Me.writable||Me.configurable))&&(Me={enumerable:!0,get:function(){return Re[Qe]}}),Object.defineProperty(Ge,Y,Me)}):(function(Ge,Re,Qe,Y){Y===void 0&&(Y=Qe),Ge[Y]=Re[Qe]})),n=Va&&Va.__setModuleDefault||(Object.create?(function(Ge,Re){Object.defineProperty(Ge,"default",{enumerable:!0,value:Re})}):function(Ge,Re){Ge.default=Re}),a=Va&&Va.__importStar||(function(){var Ge=function(Re){return Ge=Object.getOwnPropertyNames||function(Qe){var Y=[];for(var Me in Qe)Object.prototype.hasOwnProperty.call(Qe,Me)&&(Y[Y.length]=Me);return Y},Ge(Re)};return function(Re){if(Re&&Re.__esModule)return Re;var Qe={};if(Re!=null)for(var Y=Ge(Re),Me=0;Me<Y.length;Me++)Y[Me]!=="default"&&e(Qe,Re,Y[Me]);return n(Qe,Re),Qe}})();Object.defineProperty(Va,"__esModule",{value:!0}),Va.FromType=pt,Va.ComputeType=Nt,Va.ComputeModuleProperties=Ke;const t=ml(),i=hse(),r=pl(),s=mT(),o=ME(),u=pT(),c=gT(),d=Tc(),l=Wg(),f=Ka(),b=bT(),C=wc(),v=Aa(),m=LE(),h=BE(),g=bi(),_=UE(),S=vT(),p=zE(),w=gl(),O=vi(),E=Xt(),F=a(Dn());function R(Ge,Re){return Re.map(Qe=>F.IsRef(Qe)?M(Ge,Qe.$ref):pt(Ge,Qe))}function M(Ge,Re){return Re in Ge?F.IsRef(Ge[Re])?M(Ge,Ge[Re].$ref):pt(Ge,Ge[Re]):(0,g.Never)()}function j(Ge){return(0,o.Awaited)(Ge[0])}function k(Ge){return(0,d.Index)(Ge[0],Ge[1])}function x(Ge){return(0,C.KeyOf)(Ge[0])}function L(Ge){return(0,_.Partial)(Ge[0])}function V(Ge){return(0,m.Omit)(Ge[0],Ge[1])}function G(Ge){return(0,h.Pick)(Ge[0],Ge[1])}function ee(Ge){return(0,p.Required)(Ge[0])}function se(Ge,Re,Qe){const Y=R(Ge,Qe);return Re==="Awaited"?j(Y):Re==="Index"?k(Y):Re==="KeyOf"?x(Y):Re==="Partial"?L(Y):Re==="Omit"?V(Y):Re==="Pick"?G(Y):Re==="Required"?ee(Y):(0,g.Never)()}function re(Ge,Re){return(0,s.Array)(pt(Ge,Re))}function fe(Ge,Re){return(0,u.AsyncIterator)(pt(Ge,Re))}function oe(Ge,Re,Qe){return(0,c.Constructor)(ut(Ge,Re),pt(Ge,Qe))}function pe(Ge,Re,Qe){return(0,l.Function)(ut(Ge,Re),pt(Ge,Qe))}function de(Ge,Re){return(0,f.Intersect)(ut(Ge,Re))}function ge(Ge,Re){return(0,b.Iterator)(pt(Ge,Re))}function Ce(Ge,Re){return(0,v.Object)(globalThis.Object.keys(Re).reduce((Qe,Y)=>({...Qe,[Y]:pt(Ge,Re[Y])}),{}))}function Fe(Ge,Re){const[Qe,Y]=[pt(Ge,(0,S.RecordValue)(Re)),(0,S.RecordPattern)(Re)],Me=(0,i.CloneType)(Re);return Me.patternProperties[Y]=Qe,Me}function We(Ge,Re){return F.IsRef(Re)?{...M(Ge,Re.$ref),[E.TransformKind]:Re[E.TransformKind]}:Re}function Ze(Ge,Re){return(0,w.Tuple)(ut(Ge,Re))}function lt(Ge,Re){return(0,O.Union)(ut(Ge,Re))}function ut(Ge,Re){return Re.map(Qe=>pt(Ge,Qe))}function pt(Ge,Re){return F.IsOptional(Re)?(0,t.CreateType)(pt(Ge,(0,r.Discard)(Re,[E.OptionalKind])),Re):F.IsReadonly(Re)?(0,t.CreateType)(pt(Ge,(0,r.Discard)(Re,[E.ReadonlyKind])),Re):F.IsTransform(Re)?(0,t.CreateType)(We(Ge,Re),Re):F.IsArray(Re)?(0,t.CreateType)(re(Ge,Re.items),Re):F.IsAsyncIterator(Re)?(0,t.CreateType)(fe(Ge,Re.items),Re):F.IsComputed(Re)?(0,t.CreateType)(se(Ge,Re.target,Re.parameters)):F.IsConstructor(Re)?(0,t.CreateType)(oe(Ge,Re.parameters,Re.returns),Re):F.IsFunction(Re)?(0,t.CreateType)(pe(Ge,Re.parameters,Re.returns),Re):F.IsIntersect(Re)?(0,t.CreateType)(de(Ge,Re.allOf),Re):F.IsIterator(Re)?(0,t.CreateType)(ge(Ge,Re.items),Re):F.IsObject(Re)?(0,t.CreateType)(Ce(Ge,Re.properties),Re):F.IsRecord(Re)?(0,t.CreateType)(Fe(Ge,Re)):F.IsTuple(Re)?(0,t.CreateType)(Ze(Ge,Re.items||[]),Re):F.IsUnion(Re)?(0,t.CreateType)(lt(Ge,Re.anyOf),Re):Re}function Nt(Ge,Re){return Re in Ge?pt(Ge,Ge[Re]):(0,g.Never)()}function Ke(Ge){return globalThis.Object.getOwnPropertyNames(Ge).reduce((Re,Qe)=>({...Re,[Qe]:Nt(Ge,Qe)}),{})}return Va}var _9;function Nbe(){if(_9)return Ky;_9=1,Object.defineProperty(Ky,"__esModule",{value:!0}),Ky.TModule=void 0,Ky.Module=i;const e=ml(),n=Xt(),a=Mbe();class t{constructor(s){const o=(0,a.ComputeModuleProperties)(s),u=this.WithIdentifiers(o);this.$defs=u}Import(s,o){const u={...this.$defs,[s]:(0,e.CreateType)(this.$defs[s],o)};return(0,e.CreateType)({[n.Kind]:"Import",$defs:u,$ref:s})}WithIdentifiers(s){return globalThis.Object.getOwnPropertyNames(s).reduce((o,u)=>({...o,[u]:{...s[u],$id:u}}),{})}}Ky.TModule=t;function i(r){return new t(r)}return Ky}var T9;function Zx(){return T9||(T9=1,(function(e){var n=nm&&nm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=nm&&nm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Nbe(),e)})(nm)),nm}var om={},_P={},w9;function Abe(){if(w9)return _P;w9=1,Object.defineProperty(_P,"__esModule",{value:!0}),_P.Not=a;const e=cn(),n=Xt();function a(t,i){return(0,e.CreateType)({[n.Kind]:"Not",not:t},i)}return _P}var O9;function eq(){return O9||(O9=1,(function(e){var n=om&&om.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=om&&om.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Abe(),e)})(om)),om}var cm={},pc={},P9;function Dbe(){if(P9)return pc;P9=1;var e=pc&&pc.__createBinding||(Object.create?(function(o,u,c,d){d===void 0&&(d=c);var l=Object.getOwnPropertyDescriptor(u,c);(!l||("get"in l?!u.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return u[c]}}),Object.defineProperty(o,d,l)}):(function(o,u,c,d){d===void 0&&(d=c),o[d]=u[c]})),n=pc&&pc.__setModuleDefault||(Object.create?(function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}):function(o,u){o.default=u}),a=pc&&pc.__importStar||(function(){var o=function(u){return o=Object.getOwnPropertyNames||function(c){var d=[];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(d[d.length]=l);return d},o(u)};return function(u){if(u&&u.__esModule)return u;var c={};if(u!=null)for(var d=o(u),l=0;l<d.length;l++)d[l]!=="default"&&e(c,u,d[l]);return n(c,u),c}})();Object.defineProperty(pc,"__esModule",{value:!0}),pc.Parameters=s;const t=gl(),i=bi(),r=a(Dn());function s(o,u){return r.IsFunction(o)?(0,t.Tuple)(o.parameters,u):(0,i.Never)()}return pc}var E9;function tq(){return E9||(E9=1,(function(e){var n=cm&&cm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=cm&&cm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Dbe(),e)})(cm)),cm}var um={},TP={},I9;function kbe(){if(I9)return TP;I9=1,Object.defineProperty(TP,"__esModule",{value:!0}),TP.Recursive=r;const e=Fx(),n=cn(),a=Ws(),t=Xt();let i=0;function r(s,o={}){(0,a.IsUndefined)(o.$id)&&(o.$id=`T${i++}`);const u=(0,e.CloneType)(s({[t.Kind]:"This",$ref:`${o.$id}`}));return u.$id=o.$id,(0,n.CreateType)({[t.Hint]:"Recursive",...u},o)}return TP}var R9;function nq(){return R9||(R9=1,(function(e){var n=um&&um.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=um&&um.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(kbe(),e)})(um)),um}var dm={},wP={},F9;function xbe(){if(F9)return wP;F9=1,Object.defineProperty(wP,"__esModule",{value:!0}),wP.RegExp=t;const e=cn(),n=Ws(),a=Xt();function t(i,r){const s=(0,n.IsString)(i)?new globalThis.RegExp(i):i;return(0,e.CreateType)({[a.Kind]:"RegExp",type:"RegExp",source:s.source,flags:s.flags},r)}return wP}var j9;function rq(){return j9||(j9=1,(function(e){var n=dm&&dm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=dm&&dm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(xbe(),e)})(dm)),dm}var lm={},OP={},M9;function qbe(){if(M9)return OP;M9=1,Object.defineProperty(OP,"__esModule",{value:!0}),OP.Rest=a;const e=Dn();function n(t){return(0,e.IsIntersect)(t)?t.allOf:(0,e.IsUnion)(t)?t.anyOf:(0,e.IsTuple)(t)?t.items??[]:[]}function a(t){return n(t)}return OP}var N9;function iq(){return N9||(N9=1,(function(e){var n=lm&&lm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=lm&&lm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(qbe(),e)})(lm)),lm}var fm={},gc={},A9;function Lbe(){if(A9)return gc;A9=1;var e=gc&&gc.__createBinding||(Object.create?(function(o,u,c,d){d===void 0&&(d=c);var l=Object.getOwnPropertyDescriptor(u,c);(!l||("get"in l?!u.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return u[c]}}),Object.defineProperty(o,d,l)}):(function(o,u,c,d){d===void 0&&(d=c),o[d]=u[c]})),n=gc&&gc.__setModuleDefault||(Object.create?(function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}):function(o,u){o.default=u}),a=gc&&gc.__importStar||(function(){var o=function(u){return o=Object.getOwnPropertyNames||function(c){var d=[];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(d[d.length]=l);return d},o(u)};return function(u){if(u&&u.__esModule)return u;var c={};if(u!=null)for(var d=o(u),l=0;l<d.length;l++)d[l]!=="default"&&e(c,u,d[l]);return n(c,u),c}})();Object.defineProperty(gc,"__esModule",{value:!0}),gc.ReturnType=s;const t=cn(),i=bi(),r=a(Dn());function s(o,u){return r.IsFunction(o)?(0,t.CreateType)(o.returns,u):(0,i.Never)(u)}return gc}var D9;function sq(){return D9||(D9=1,(function(e){var n=fm&&fm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=fm&&fm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Lbe(),e)})(fm)),fm}var hm={},Jj={},k9;function Bbe(){return k9||(k9=1,Object.defineProperty(Jj,"__esModule",{value:!0})),Jj}var Qj={},x9;function Ube(){return x9||(x9=1,Object.defineProperty(Qj,"__esModule",{value:!0})),Qj}var q9;function zbe(){return q9||(q9=1,(function(e){var n=hm&&hm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=hm&&hm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Bbe(),e),a(Ube(),e)})(hm)),hm}var mm={},Yj={},L9;function Vbe(){return L9||(L9=1,Object.defineProperty(Yj,"__esModule",{value:!0})),Yj}var B9;function Hbe(){return B9||(B9=1,(function(e){var n=mm&&mm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=mm&&mm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Vbe(),e)})(mm)),mm}var pm={},Zd={},U9;function Kbe(){if(U9)return Zd;U9=1,Object.defineProperty(Zd,"__esModule",{value:!0}),Zd.TransformEncodeBuilder=Zd.TransformDecodeBuilder=void 0,Zd.Transform=i;const e=Xt(),n=Dn();class a{constructor(s){this.schema=s}Decode(s){return new t(this.schema,s)}}Zd.TransformDecodeBuilder=a;class t{constructor(s,o){this.schema=s,this.decode=o}EncodeTransform(s,o){const d={Encode:l=>o[e.TransformKind].Encode(s(l)),Decode:l=>this.decode(o[e.TransformKind].Decode(l))};return{...o,[e.TransformKind]:d}}EncodeSchema(s,o){const u={Decode:this.decode,Encode:s};return{...o,[e.TransformKind]:u}}Encode(s){return(0,n.IsTransform)(this.schema)?this.EncodeTransform(s,this.schema):this.EncodeSchema(s,this.schema)}}Zd.TransformEncodeBuilder=t;function i(r){return new a(r)}return Zd}var z9;function aq(){return z9||(z9=1,(function(e){var n=pm&&pm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=pm&&pm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Kbe(),e)})(pm)),pm}var gm={},PP={},V9;function $be(){if(V9)return PP;V9=1,Object.defineProperty(PP,"__esModule",{value:!0}),PP.Unsafe=a;const e=cn(),n=Xt();function a(t={}){return(0,e.CreateType)({[n.Kind]:t[n.Kind]??"Unsafe"},t)}return PP}var H9;function VE(){return H9||(H9=1,(function(e){var n=gm&&gm.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=gm&&gm.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a($be(),e)})(gm)),gm}var ym={},EP={},K9;function Gbe(){if(K9)return EP;K9=1,Object.defineProperty(EP,"__esModule",{value:!0}),EP.Void=a;const e=cn(),n=Xt();function a(t){return(0,e.CreateType)({[n.Kind]:"Void",type:"void"},t)}return EP}var $9;function oq(){return $9||($9=1,(function(e){var n=ym&&ym.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=ym&&ym.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(Gbe(),e)})(ym)),ym}var _u={},gS={},G9;function Wse(){if(G9)return gS;G9=1,Object.defineProperty(gS,"__esModule",{value:!0}),gS.JsonTypeBuilder=void 0;const e=hT(),n=mT(),a=FE(),t=xx(),i=qx(),r=Bx(),s=Hx(),o=ub(),u=$x(),c=Tc(),d=Jx(),l=Ka(),f=Qx(),b=wc(),C=Js(),v=Fi(),m=bi(),h=eq(),g=AE(),_=Zx(),S=Jg(),p=Aa(),w=LE(),O=pd(),E=UE(),F=BE(),R=Qg(),M=qE(),j=vT(),k=nq(),x=yl(),L=zE(),V=iq(),G=ob(),ee=md(),se=aq(),re=gl(),fe=vi(),oe=cb(),pe=VE();class de{ReadonlyOptional(Ce){return(0,M.ReadonlyOptional)(Ce)}Readonly(Ce,Fe){return(0,R.Readonly)(Ce,Fe??!0)}Optional(Ce,Fe){return(0,O.Optional)(Ce,Fe??!0)}Any(Ce){return(0,e.Any)(Ce)}Array(Ce,Fe){return(0,n.Array)(Ce,Fe)}Boolean(Ce){return(0,a.Boolean)(Ce)}Capitalize(Ce,Fe){return(0,f.Capitalize)(Ce,Fe)}Composite(Ce,Fe){return(0,t.Composite)(Ce,Fe)}Const(Ce,Fe){return(0,i.Const)(Ce,Fe)}Enum(Ce,Fe){return(0,r.Enum)(Ce,Fe)}Exclude(Ce,Fe,We){return(0,s.Exclude)(Ce,Fe,We)}Extends(Ce,Fe,We,Ze,lt){return(0,o.Extends)(Ce,Fe,We,Ze,lt)}Extract(Ce,Fe,We){return(0,u.Extract)(Ce,Fe,We)}Index(Ce,Fe,We){return(0,c.Index)(Ce,Fe,We)}Integer(Ce){return(0,d.Integer)(Ce)}Intersect(Ce,Fe){return(0,l.Intersect)(Ce,Fe)}KeyOf(Ce,Fe){return(0,b.KeyOf)(Ce,Fe)}Literal(Ce,Fe){return(0,C.Literal)(Ce,Fe)}Lowercase(Ce,Fe){return(0,f.Lowercase)(Ce,Fe)}Mapped(Ce,Fe,We){return(0,v.Mapped)(Ce,Fe,We)}Module(Ce){return(0,_.Module)(Ce)}Never(Ce){return(0,m.Never)(Ce)}Not(Ce,Fe){return(0,h.Not)(Ce,Fe)}Null(Ce){return(0,g.Null)(Ce)}Number(Ce){return(0,S.Number)(Ce)}Object(Ce,Fe){return(0,p.Object)(Ce,Fe)}Omit(Ce,Fe,We){return(0,w.Omit)(Ce,Fe,We)}Partial(Ce,Fe){return(0,E.Partial)(Ce,Fe)}Pick(Ce,Fe,We){return(0,F.Pick)(Ce,Fe,We)}Record(Ce,Fe,We){return(0,j.Record)(Ce,Fe,We)}Recursive(Ce,Fe){return(0,k.Recursive)(Ce,Fe)}Ref(...Ce){return(0,x.Ref)(Ce[0],Ce[1])}Required(Ce,Fe){return(0,L.Required)(Ce,Fe)}Rest(Ce){return(0,V.Rest)(Ce)}String(Ce){return(0,G.String)(Ce)}TemplateLiteral(Ce,Fe){return(0,ee.TemplateLiteral)(Ce,Fe)}Transform(Ce){return(0,se.Transform)(Ce)}Tuple(Ce,Fe){return(0,re.Tuple)(Ce,Fe)}Uncapitalize(Ce,Fe){return(0,f.Uncapitalize)(Ce,Fe)}Union(Ce,Fe){return(0,fe.Union)(Ce,Fe)}Unknown(Ce){return(0,oe.Unknown)(Ce)}Unsafe(Ce){return(0,pe.Unsafe)(Ce)}Uppercase(Ce,Fe){return(0,f.Uppercase)(Ce,Fe)}}return gS.JsonTypeBuilder=de,gS}var Xj={},W9;function Wbe(){return W9||(W9=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Rest=e.Required=e.RegExp=e.Ref=e.Recursive=e.Record=e.ReadonlyOptional=e.Readonly=e.Promise=e.Pick=e.Partial=e.Parameters=e.Optional=e.Omit=e.Object=e.Number=e.Null=e.Not=e.Never=e.Module=e.Mapped=e.Literal=e.KeyOf=e.Iterator=e.Uppercase=e.Lowercase=e.Uncapitalize=e.Capitalize=e.Intersect=e.Integer=e.Instantiate=e.InstanceType=e.Index=e.Function=e.Extract=e.Extends=e.Exclude=e.Enum=e.Date=e.ConstructorParameters=e.Constructor=e.Const=e.Composite=e.Boolean=e.BigInt=e.Awaited=e.AsyncIterator=e.Array=e.Argument=e.Any=void 0,e.Void=e.Unsafe=e.Unknown=e.Union=e.Undefined=e.Uint8Array=e.Tuple=e.Transform=e.TemplateLiteral=e.Symbol=e.String=e.ReturnType=void 0;var n=hT();Object.defineProperty(e,"Any",{enumerable:!0,get:function(){return n.Any}});var a=jx();Object.defineProperty(e,"Argument",{enumerable:!0,get:function(){return a.Argument}});var t=mT();Object.defineProperty(e,"Array",{enumerable:!0,get:function(){return t.Array}});var i=pT();Object.defineProperty(e,"AsyncIterator",{enumerable:!0,get:function(){return i.AsyncIterator}});var r=ME();Object.defineProperty(e,"Awaited",{enumerable:!0,get:function(){return r.Awaited}});var s=yT();Object.defineProperty(e,"BigInt",{enumerable:!0,get:function(){return s.BigInt}});var o=FE();Object.defineProperty(e,"Boolean",{enumerable:!0,get:function(){return o.Boolean}});var u=xx();Object.defineProperty(e,"Composite",{enumerable:!0,get:function(){return u.Composite}});var c=qx();Object.defineProperty(e,"Const",{enumerable:!0,get:function(){return c.Const}});var d=gT();Object.defineProperty(e,"Constructor",{enumerable:!0,get:function(){return d.Constructor}});var l=Lx();Object.defineProperty(e,"ConstructorParameters",{enumerable:!0,get:function(){return l.ConstructorParameters}});var f=NE();Object.defineProperty(e,"Date",{enumerable:!0,get:function(){return f.Date}});var b=Bx();Object.defineProperty(e,"Enum",{enumerable:!0,get:function(){return b.Enum}});var C=Hx();Object.defineProperty(e,"Exclude",{enumerable:!0,get:function(){return C.Exclude}});var v=ub();Object.defineProperty(e,"Extends",{enumerable:!0,get:function(){return v.Extends}});var m=$x();Object.defineProperty(e,"Extract",{enumerable:!0,get:function(){return m.Extract}});var h=Wg();Object.defineProperty(e,"Function",{enumerable:!0,get:function(){return h.Function}});var g=Tc();Object.defineProperty(e,"Index",{enumerable:!0,get:function(){return g.Index}});var _=Gx();Object.defineProperty(e,"InstanceType",{enumerable:!0,get:function(){return _.InstanceType}});var S=Wx();Object.defineProperty(e,"Instantiate",{enumerable:!0,get:function(){return S.Instantiate}});var p=Jx();Object.defineProperty(e,"Integer",{enumerable:!0,get:function(){return p.Integer}});var w=Ka();Object.defineProperty(e,"Intersect",{enumerable:!0,get:function(){return w.Intersect}});var O=Qx();Object.defineProperty(e,"Capitalize",{enumerable:!0,get:function(){return O.Capitalize}}),Object.defineProperty(e,"Uncapitalize",{enumerable:!0,get:function(){return O.Uncapitalize}}),Object.defineProperty(e,"Lowercase",{enumerable:!0,get:function(){return O.Lowercase}}),Object.defineProperty(e,"Uppercase",{enumerable:!0,get:function(){return O.Uppercase}});var E=bT();Object.defineProperty(e,"Iterator",{enumerable:!0,get:function(){return E.Iterator}});var F=wc();Object.defineProperty(e,"KeyOf",{enumerable:!0,get:function(){return F.KeyOf}});var R=Js();Object.defineProperty(e,"Literal",{enumerable:!0,get:function(){return R.Literal}});var M=Fi();Object.defineProperty(e,"Mapped",{enumerable:!0,get:function(){return M.Mapped}});var j=Zx();Object.defineProperty(e,"Module",{enumerable:!0,get:function(){return j.Module}});var k=bi();Object.defineProperty(e,"Never",{enumerable:!0,get:function(){return k.Never}});var x=eq();Object.defineProperty(e,"Not",{enumerable:!0,get:function(){return x.Not}});var L=AE();Object.defineProperty(e,"Null",{enumerable:!0,get:function(){return L.Null}});var V=Jg();Object.defineProperty(e,"Number",{enumerable:!0,get:function(){return V.Number}});var G=Aa();Object.defineProperty(e,"Object",{enumerable:!0,get:function(){return G.Object}});var ee=LE();Object.defineProperty(e,"Omit",{enumerable:!0,get:function(){return ee.Omit}});var se=pd();Object.defineProperty(e,"Optional",{enumerable:!0,get:function(){return se.Optional}});var re=tq();Object.defineProperty(e,"Parameters",{enumerable:!0,get:function(){return re.Parameters}});var fe=UE();Object.defineProperty(e,"Partial",{enumerable:!0,get:function(){return fe.Partial}});var oe=BE();Object.defineProperty(e,"Pick",{enumerable:!0,get:function(){return oe.Pick}});var pe=jE();Object.defineProperty(e,"Promise",{enumerable:!0,get:function(){return pe.Promise}});var de=Qg();Object.defineProperty(e,"Readonly",{enumerable:!0,get:function(){return de.Readonly}});var ge=qE();Object.defineProperty(e,"ReadonlyOptional",{enumerable:!0,get:function(){return ge.ReadonlyOptional}});var Ce=vT();Object.defineProperty(e,"Record",{enumerable:!0,get:function(){return Ce.Record}});var Fe=nq();Object.defineProperty(e,"Recursive",{enumerable:!0,get:function(){return Fe.Recursive}});var We=yl();Object.defineProperty(e,"Ref",{enumerable:!0,get:function(){return We.Ref}});var Ze=rq();Object.defineProperty(e,"RegExp",{enumerable:!0,get:function(){return Ze.RegExp}});var lt=zE();Object.defineProperty(e,"Required",{enumerable:!0,get:function(){return lt.Required}});var ut=iq();Object.defineProperty(e,"Rest",{enumerable:!0,get:function(){return ut.Rest}});var pt=sq();Object.defineProperty(e,"ReturnType",{enumerable:!0,get:function(){return pt.ReturnType}});var Nt=ob();Object.defineProperty(e,"String",{enumerable:!0,get:function(){return Nt.String}});var Ke=DE();Object.defineProperty(e,"Symbol",{enumerable:!0,get:function(){return Ke.Symbol}});var Ge=md();Object.defineProperty(e,"TemplateLiteral",{enumerable:!0,get:function(){return Ge.TemplateLiteral}});var Re=aq();Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return Re.Transform}});var Qe=gl();Object.defineProperty(e,"Tuple",{enumerable:!0,get:function(){return Qe.Tuple}});var Y=xE();Object.defineProperty(e,"Uint8Array",{enumerable:!0,get:function(){return Y.Uint8Array}});var Me=kE();Object.defineProperty(e,"Undefined",{enumerable:!0,get:function(){return Me.Undefined}});var K=vi();Object.defineProperty(e,"Union",{enumerable:!0,get:function(){return K.Union}});var Z=cb();Object.defineProperty(e,"Unknown",{enumerable:!0,get:function(){return Z.Unknown}});var me=VE();Object.defineProperty(e,"Unsafe",{enumerable:!0,get:function(){return me.Unsafe}});var we=oq();Object.defineProperty(e,"Void",{enumerable:!0,get:function(){return we.Void}})})(Xj)),Xj}var yS={},J9;function Jbe(){if(J9)return yS;J9=1,Object.defineProperty(yS,"__esModule",{value:!0}),yS.JavaScriptTypeBuilder=void 0;const e=Wse(),n=jx(),a=pT(),t=ME(),i=yT(),r=gT(),s=Lx(),o=NE(),u=Wg(),c=Gx(),d=Wx(),l=bT(),f=tq(),b=jE(),C=rq(),v=sq(),m=DE(),h=xE(),g=kE(),_=oq();class S extends e.JsonTypeBuilder{Argument(w){return(0,n.Argument)(w)}AsyncIterator(w,O){return(0,a.AsyncIterator)(w,O)}Awaited(w,O){return(0,t.Awaited)(w,O)}BigInt(w){return(0,i.BigInt)(w)}ConstructorParameters(w,O){return(0,s.ConstructorParameters)(w,O)}Constructor(w,O,E){return(0,r.Constructor)(w,O,E)}Date(w={}){return(0,o.Date)(w)}Function(w,O,E){return(0,u.Function)(w,O,E)}InstanceType(w,O){return(0,c.InstanceType)(w,O)}Instantiate(w,O){return(0,d.Instantiate)(w,O)}Iterator(w,O){return(0,l.Iterator)(w,O)}Parameters(w,O){return(0,f.Parameters)(w,O)}Promise(w,O){return(0,b.Promise)(w,O)}RegExp(w,O){return(0,C.RegExp)(w,O)}ReturnType(w,O){return(0,v.ReturnType)(w,O)}Symbol(w){return(0,m.Symbol)(w)}Undefined(w){return(0,g.Undefined)(w)}Uint8Array(w){return(0,h.Uint8Array)(w)}Void(w){return(0,_.Void)(w)}}return yS.JavaScriptTypeBuilder=S,yS}var Q9;function Qbe(){return Q9||(Q9=1,(function(e){var n=_u&&_u.__createBinding||(Object.create?(function(u,c,d,l){l===void 0&&(l=d);var f=Object.getOwnPropertyDescriptor(c,d);(!f||("get"in f?!c.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return c[d]}}),Object.defineProperty(u,l,f)}):(function(u,c,d,l){l===void 0&&(l=d),u[l]=c[d]})),a=_u&&_u.__setModuleDefault||(Object.create?(function(u,c){Object.defineProperty(u,"default",{enumerable:!0,value:c})}):function(u,c){u.default=c}),t=_u&&_u.__importStar||(function(){var u=function(c){return u=Object.getOwnPropertyNames||function(d){var l=[];for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(l[l.length]=f);return l},u(c)};return function(c){if(c&&c.__esModule)return c;var d={};if(c!=null)for(var l=u(c),f=0;f<l.length;f++)l[f]!=="default"&&n(d,c,l[f]);return a(d,c),d}})();Object.defineProperty(e,"__esModule",{value:!0}),e.Type=e.JavaScriptTypeBuilder=e.JsonTypeBuilder=void 0;var i=Wse();Object.defineProperty(e,"JsonTypeBuilder",{enumerable:!0,get:function(){return i.JsonTypeBuilder}});const r=t(Wbe()),s=Jbe();Object.defineProperty(e,"JavaScriptTypeBuilder",{enumerable:!0,get:function(){return s.JavaScriptTypeBuilder}});const o=r;e.Type=o})(_u)),_u}var Y9;function Nr(){return Y9||(Y9=1,(function(e){var n=Jf&&Jf.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Jf&&Jf.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(hse(),e),a(ml(),e),a(ss(),e),a(gse(),e),a(Mye(),e),a(IE(),e),a(fT(),e),a(RE(),e),a(Xt(),e),a(hT(),e),a(mT(),e),a(jx(),e),a(pT(),e),a(ME(),e),a(yT(),e),a(FE(),e),a(xx(),e),a(qx(),e),a(gT(),e),a(Lx(),e),a(NE(),e),a(Bx(),e),a(Hx(),e),a(ub(),e),a($x(),e),a(Wg(),e),a(Tc(),e),a(Gx(),e),a(Wx(),e),a(Jx(),e),a(Ka(),e),a(bT(),e),a(Qx(),e),a(wc(),e),a(Js(),e),a(Zx(),e),a(Fi(),e),a(bi(),e),a(eq(),e),a(AE(),e),a(Jg(),e),a(Aa(),e),a(LE(),e),a(pd(),e),a(tq(),e),a(UE(),e),a(BE(),e),a(jE(),e),a(Qg(),e),a(qE(),e),a(vT(),e),a(nq(),e),a(yl(),e),a(rq(),e),a(zE(),e),a(iq(),e),a(sq(),e),a(zbe(),e),a(Hbe(),e),a(ob(),e),a(DE(),e),a(md(),e),a(aq(),e),a(gl(),e),a(xE(),e),a(kE(),e),a(vi(),e),a(cb(),e),a(VE(),e),a(oq(),e),a(Qbe(),e)})(Jf)),Jf}var X9;function Ybe(){if(X9)return Wf;X9=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Wf,"__esModule",{value:!0}),Wf.brandedNumberType=Wf.brandedStringType=void 0;const e=Nr();function n(){return e.Type.String()}Wf.brandedStringType=n;function a(t){return e.Type.Number(t)}return Wf.brandedNumberType=a,Wf}var bm={},Z9;function Xbe(){if(Z9)return bm;Z9=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(bm,"__esModule",{value:!0}),bm.brandOpaque=bm.extractFromOpaque=void 0;function e(a){return a}bm.extractFromOpaque=e;function n(a){return a}return bm.brandOpaque=n,bm}var ur={},$t={},eK;function cq(){if(eK)return $t;eK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=$t&&$t.__importDefault||function(ee){return ee&&ee.__esModule?ee:{default:ee}};Object.defineProperty($t,"__esModule",{value:!0}),$t.balancedReduce=$t.copyPropertyIfDefined=$t.defineLazyCachedProperty=$t.compareStrings=$t.capitalize=$t.disposeSymbol=$t.compareNamed=$t.oneFromSet=$t.invertMap=$t.transformObjectMap=$t.objectToMap=$t.assertNonNegativeSafeInteger=$t.assertValidRange=$t.assertValidIndex=$t.assertValidRangeIndices=$t.isJsonObject=$t.JsonCompatibleReadOnlySchema=$t.count=$t.find=$t.filterIterable=$t.mapIterable=$t.getOrAddEmptyToMap=$t.getOrCreate=$t.getOrAddInMap=$t.compareSets=$t.hasSingle=$t.iterableHasSome=$t.hasSome=$t.getLast=$t.makeArray=$t.isReadonlyArray=$t.clone=$t.asMutable=void 0;const n=Je(),a=Nr(),t=e(jie());function i(ee){return ee}$t.asMutable=i,$t.clone=t.default;function r(ee){return Array.isArray(ee)}$t.isReadonlyArray=r;function s(ee,se){const re=[];for(let fe=0;fe<ee;++fe)re.push(se(fe));return re}$t.makeArray=s;function o(ee){return ee[ee.length-1]}$t.getLast=o;function u(ee){return ee.length>0}$t.hasSome=u;function c(ee){return ee[Symbol.iterator]().next().done===!1}$t.iterableHasSome=c;function d(ee){return ee.length===1}$t.hasSingle=d;function l({a:ee,b:se,aExtra:re,bExtra:fe,same:oe}){for(const pe of ee.keys())if(se.has(pe)){if(oe!==void 0&&!oe(pe))return!1}else if(re!==void 0){if(!re(pe))return!1}else return!1;for(const pe of se.keys())if(!ee.has(pe))if(fe!==void 0){if(!fe(pe))return!1}else return!1;return!0}$t.compareSets=l;function f(ee,se,re){const fe=ee.get(se);return fe!==void 0?fe:(ee.set(se,re),re)}$t.getOrAddInMap=f;function b(ee,se,re){let fe=ee.get(se);return fe===void 0&&(fe=re(se),ee.set(se,fe)),fe}$t.getOrCreate=b;function C(ee,se){let re=ee.get(se);return re===void 0&&(re=[],ee.set(se,re)),re}$t.getOrAddEmptyToMap=C;function*v(ee,se){for(const re of ee)yield se(re)}$t.mapIterable=v;function*m(ee,se){for(const re of ee)se(re)&&(yield re)}$t.filterIterable=m;function h(ee,se){for(const re of ee)if(se(re))return re}$t.find=h;function g(ee){let se=0;for(const re of ee)se+=1;return se}$t.count=g,$t.JsonCompatibleReadOnlySchema=a.Type.Any();function _(ee){return typeof ee=="object"&&ee!==null&&!Array.isArray(ee)}$t.isJsonObject=_;function S(ee,se,re){(0,n.assert)(se>=ee,1948),p(ee,re,!1),p(se,re,!0)}$t.assertValidRangeIndices=S;function p(ee,se,re=!1){O(ee),re?(0,n.assert)(ee<=se.length,888):(0,n.assert)(ee<se.length,889)}$t.assertValidIndex=p;function w({start:ee,end:se},re){O(ee),O(se),(0,n.assert)(se<=re.length,1949),(0,n.assert)(ee<=se,1950)}$t.assertValidRange=w;function O(ee){(0,n.assert)(Number.isSafeInteger(ee),886),(0,n.assert)(ee>=0,887)}$t.assertNonNegativeSafeInteger=O;function E(ee){const se=new Map;for(const re of Object.keys(ee)){const fe=ee[re];se.set(re,fe)}return se}$t.objectToMap=E;function F(ee,se){const re=Object.create(null);for(const fe of Object.keys(ee)){const oe=ee[fe];Object.defineProperty(re,fe,{enumerable:!0,configurable:!0,writable:!0,value:se(oe,fe)})}return re}$t.transformObjectMap=F;function R(ee){const se=new Map(v(ee,([re,fe])=>[fe,re]));return(0,n.assert)(se.size===ee.size,2186),se}$t.invertMap=R;function M(ee){if(ee!==void 0&&ee.size===1)for(const se of ee)return se}$t.oneFromSet=M;function j(ee,se){return ee.name<se.name?-1:ee.name>se.name?1:0}$t.compareNamed=j,$t.disposeSymbol=Symbol("Symbol.dispose placeholder");function k(ee){const se=ee[Symbol.iterator]().next();return se.done===!0?"":se.value.toUpperCase()+ee.slice(se.value.length)}$t.capitalize=k;function x(ee,se){return ee>se?1:ee===se?0:-1}$t.compareStrings=x;function L(ee,se,re){return Reflect.defineProperty(ee,se,{get(){const fe=re();return Reflect.defineProperty(ee,se,{value:fe}),fe},configurable:!0}),ee}$t.defineLazyCachedProperty=L;function V(ee,se,re){if(ee!==void 0){const fe=ee[se];fe!==void 0&&(re[se]=fe)}}$t.copyPropertyIfDefined=V;function G(ee,se,re){if(d(ee))return ee[0];if(!u(ee))return re();const fe=Math.floor(ee.length/2),oe=G(ee.slice(0,fe),se,re),pe=G(ee.slice(fe),se,re);return se(oe,pe)}return $t.balancedReduce=G,$t}var tK;function Jse(){if(tK)return ur;tK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ur,"__esModule",{value:!0}),ur.SizedNestedMap=ur.mapNestedMap=ur.forEachInNestedMap=ur.nestedMapFromFlatList=ur.nestedMapToFlatList=ur.deleteFromNestedMap=ur.getOrDefaultInNestedMap=ur.getOrAddInNestedMap=ur.tryGetFromNestedMap=ur.getOrCreateInNestedMap=ur.setInNestedMap=ur.populateNestedMap=ur.tryAddToNestedMap=void 0;const e=Je(),n=cq();function a(v,m,h,g){let _=v.get(m);if(_===void 0&&(_=new Map,v.set(m,_)),_.has(h))return _.get(h);_.set(h,g)}ur.tryAddToNestedMap=a;function t(v,m,h){for(const[g,_]of v){let S=m.get(g);if(S===void 0)S=new Map(_),m.set(g,S);else for(const[p,w]of _)(h||!S.has(p))&&S.set(p,w)}}ur.populateNestedMap=t;function i(v,m,h,g){(0,n.getOrAddInMap)(v,m,new Map).set(h,g)}ur.setInNestedMap=i;function r(v,m,h,g){const _=(0,n.getOrAddInMap)(v,m,new Map);return(0,n.getOrCreate)(_,h,()=>g(m,h))}ur.getOrCreateInNestedMap=r;function s(v,m,h){const g=v.get(m);if(g!==void 0)return g.get(h)}ur.tryGetFromNestedMap=s;function o(v,m,h,g){const _=a(v,m,h,g);return _!==void 0?_:g}ur.getOrAddInNestedMap=o;function u(v,m,h,g){const _=s(v,m,h);return _!==void 0?_:g}ur.getOrDefaultInNestedMap=u;function c(v,m,h){const g=v.get(m);if(g===void 0)return!1;const _=g.delete(h);return g.size===0&&v.delete(m),_}ur.deleteFromNestedMap=c;function d(v){const m=[];return v.forEach((h,g)=>{h.forEach((_,S)=>{m.push([g,S,_])})}),m}ur.nestedMapToFlatList=d;function l(v){const m=new Map;for(const[h,g,_]of v)(0,n.getOrAddInMap)(m,h,new Map).set(g,_);return m}ur.nestedMapFromFlatList=l;function f(v,m){v.forEach((h,g)=>{h.forEach((_,S)=>{m(_,g,S)})})}ur.forEachInNestedMap=f;function b(v,m){const h=new Map;return v.forEach((g,_)=>{const S=new Map;g.forEach((p,w)=>{const O=m(p,_,w);S.set(w,O)}),h.set(_,S)}),h}ur.mapNestedMap=b;class C{constructor(){this.nestedMap=new Map,this.count=0}get size(){return this.count}tryGet(m,h){return s(this.nestedMap,m,h)}getOrDefault(m,h,g){return u(this.nestedMap,m,h,g)}tryAdd(m,h,g){const _=a(this.nestedMap,m,h,g);return _===void 0&&this.count++,_}set(m,h,g){this.tryAdd(m,h,g)!==void 0&&i(this.nestedMap,m,h,g)}delete(m,h){const g=c(this.nestedMap,m,h);return g&&this.count--,g}forEach(m){f(this.nestedMap,m)}clear(){this.count=0,this.nestedMap.clear()}values(){return Array.from(this.nestedMap.values()).flatMap(m=>m.values())[0]??(0,e.oob)()}[Symbol.iterator](){return this.nestedMap[Symbol.iterator]()}}return ur.SizedNestedMap=C,ur}var vm={},nK;function Zbe(){if(nK)return vm;nK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vm,"__esModule",{value:!0}),vm.nestedSetContains=vm.addToNestedSet=void 0;const e=Jse();function n(t,i,r){(0,e.setInNestedMap)(t,i,r,!0)}vm.addToNestedSet=n;function a(t,i,r){return(0,e.getOrDefaultInNestedMap)(t,i,r,!1)}return vm.nestedSetContains=a,vm}var bS={},rK;function eve(){if(rK)return bS;rK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(bS,"__esModule",{value:!0}),bS.OffsetListFactory=void 0;class e{constructor(){this.offset=0,this.list=[]}push(...a){for(const t of a)typeof t=="number"?this.pushOffset(t):this.pushContent(t)}pushOffset(a){this.offset+=a}pushContent(a){this.offset>0&&(this.list.push(this.offset),this.offset=0),this.list.push(a)}}return bS.OffsetListFactory=e,bS}var vS={},iK;function tve(){if(iK)return vS;iK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vS,"__esModule",{value:!0}),vS.StackyIterator=void 0;class e{constructor(a){this.stack=[],this.index=0,this.list=a}[Symbol.iterator](){return this}next(){return this.done?{value:void 0,done:!0}:{value:this.pop()}}get done(){return this.index>=this.list.length&&this.stack.length===0}push(a){this.stack.push(a)}pop(){if(this.stack.length>0)return this.stack.pop();if(!(this.index>=this.list.length))return this.list[this.index++]}peek(){return this.stack.length>0?this.stack[this.stack.length-1]:this.list[this.index]}}return vS.StackyIterator=e,vS}var SS={},sK;function nve(){if(sK)return SS;sK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(SS,"__esModule",{value:!0}),SS.ReferenceCountedBase=void 0;const e=Je();class n{constructor(t=1){this.refCount=t}referenceAdded(t=1){this.refCount+=t}referenceRemoved(t=1){this.refCount-=t,(0,e.assert)(this.refCount>=0,1220),this.refCount===0&&this.onUnreferenced()}isShared(){return this.refCount>1}isUnreferenced(){return this.refCount===0}}return SS.ReferenceCountedBase=n,SS}var CS={},aK;function rve(){if(aK)return CS;aK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(CS,"__esModule",{value:!0}),CS.unsafeArrayToTuple=void 0;function e(n){return n}return CS.unsafeArrayToTuple=e,CS}var Sm={},oK;function ive(){if(oK)return Sm;oK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Sm,"__esModule",{value:!0}),Sm.brandedSlot=Sm.getOrCreateSlotContent=void 0;const e=cq();function n(i,r,s){return(0,e.getOrCreate)(i,r,s)}Sm.getOrCreateSlotContent=n;let a=0;function t(){return a++}return Sm.brandedSlot=t,Sm}var Cm={},cK;function sve(){if(cK)return Cm;cK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Cm,"__esModule",{value:!0}),Cm.newIntegerRangeMap=Cm.RangeMap=void 0;const e=Je(),n=dl();class a{constructor(u,c,d=s){this.offsetKey=u,this.subtractKeys=c,this.offsetValue=d,this.tree=new n.BTree(void 0,c)}entries(){const u=[];for(const[c,d]of this.tree.entries())u.push({start:c,length:d.length,value:d.value});return u}clear(){this.tree.clear()}getAll(u,c){const d=this.getIntersectingEntries(u,c);if(d.length===0)return d;const l=d[0]??(0,e.oob)(),f=this.subtractKeys(u,l.start);f>0&&(d[0]={start:u,length:l.length-f,value:this.offsetValue(l.value,f)});const b=d[d.length-1]??(0,e.oob)(),C=this.offsetKey(b.start,b.length-1),v=this.offsetKey(u,c-1),m=this.subtractKeys(C,v);return m>0&&(d[d.length-1]={...b,length:b.length-m}),d}getFirst(u,c){{const d=this.tree.getPairOrNextLower(u);if(d!==void 0){const l=d[0],{value:f,length:b}=d[1],C=this.offsetKey(l,b-1),v=this.subtractKeys(u,l),m=Math.min(this.subtractKeys(C,u)+1,c);if(m>0)return{value:this.offsetValue(f,v),start:u,length:m}}}{const d=this.tree.nextHigherKey(u);if(d!==void 0){const l=d,f=this.offsetKey(u,c-1);if(this.le(l,f))return{value:void 0,start:u,length:this.subtractKeys(l,u)}}return{value:void 0,start:u,length:c}}}set(u,c,d){this.delete(u,c),d!==void 0&&this.tree.set(u,{value:d,length:c})}delete(u,c){const d=this.offsetKey(u,c-1);for(const{start:l,length:f,value:b}of this.getIntersectingEntries(u,c)){this.tree.delete(l);const C=this.subtractKeys(u,l);C>0&&this.tree.set(l,{length:C,value:b});const v=this.offsetKey(l,f-1),m=this.subtractKeys(v,d);if(m>0){const h=this.offsetKey(d,1),g=this.subtractKeys(h,l);this.tree.set(h,{length:m,value:this.offsetValue(b,g)})}}}clone(){const u=new a(this.offsetKey,this.subtractKeys,this.offsetValue);return u.tree=this.tree.clone(),u}static union(u,c){(0,e.assert)(u.offsetKey===c.offsetKey&&u.subtractKeys===c.subtractKeys&&u.offsetValue===c.offsetValue,2734);const d=new a(u.offsetKey,u.subtractKeys,u.offsetValue);d.tree=u.tree.clone();for(const[l,f]of c.tree.entries())d.tree.set(l,f);return d}getIntersectingEntries(u,c){const d=[],l=this.offsetKey(u,c-1);{const f=this.tree.getPairOrNextLower(u);if(f!==void 0){const b=f[0],{length:C,value:v}=f[1],m=this.offsetKey(b,C-1);this.ge(m,u)&&d.push({start:b,length:C,value:v})}}{let f=this.tree.nextHigherPair(u);for(;f!==void 0;){const b=f[0];if(this.gt(b,l))break;const{length:C,value:v}=f[1],m=this.offsetKey(b,C-1);d.push({start:b,length:C,value:v}),f=this.tree.nextHigherPair(m)}}return d}gt(u,c){return this.subtractKeys(u,c)>0}ge(u,c){return this.subtractKeys(u,c)>=0}lt(u,c){return this.subtractKeys(u,c)<0}le(u,c){return this.subtractKeys(u,c)<=0}}Cm.RangeMap=a;function t(){return new a(i,r)}Cm.newIntegerRangeMap=t;function i(o,u){return o+u}function r(o,u){return o-u}function s(o,u){return o}return Cm}var Tu={},uK;function ave(){if(uK)return Tu;uK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Tu,"__esModule",{value:!0}),Tu.fakeIdAllocator=Tu.idAllocatorFromState=Tu.idAllocatorFromMaxId=void 0;const e=Je();function n(t=void 0){return a({maxId:t??-1})}Tu.idAllocatorFromMaxId=n;function a(t){return{allocate:i=>{const r=i??1;(0,e.assert)(r>0,1487);const s=t.maxId+1;return t.maxId+=r,s},getMaxId:()=>t.maxId}}return Tu.idAllocatorFromState=a,Tu.fakeIdAllocator={allocate:()=>(0,e.fail)(2790),getMaxId:()=>0},Tu}var ho={},dK;function ove(){if(dK)return ho;dK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ho,"__esModule",{value:!0}),ho.breakingClass=ho.throwIfBroken=ho.breakingMethod=ho.Breakable=void 0;const e=Je(),n=Ot();class a{constructor(l){this.name=l}use(){if(this.brokenBy!==void 0)throw new n.UsageError(`Invalid use of ${this.name} after it was put into an invalid state by another error.
Original Error:
${this.brokenBy}`)}break(l){throw this.brokenBy!==l&&(this.use(),this.brokenBy=l),l}rethrowCaught(l){l instanceof Error&&this.break(l),this.break(new Error(`Non-error thrown breaking ${this.name}. Thrown value: "${l}"`))}run(l){this.use();try{return l()}catch(f){this.rethrowCaught(f)}}clearError(){(0,e.assert)(this.brokenBy!==void 0,2486),this.brokenBy=void 0}}ho.Breakable=a;function t(d,l){function f(...b){return this.breaker===void 0?d.call(this,...b):this.breaker.run(()=>d.call(this,...b))}return o(f),r(f,d),f}ho.breakingMethod=t;function i(d,l){function f(...b){return this.breaker.use(),d.call(this,...b)}return o(f),r(f,d),f}ho.throwIfBroken=i;function r(d,l){d.displayName=l.displayName??l.name}const s=Symbol("isBreaker");function o(d){d[s]=!0}function u(d){return s in d}function c(d,l){const f=d,b=new Set(["constructor"]);let C=d.prototype;for(;C!==null;){for(const v of Reflect.ownKeys(C))if(!b.has(v)){b.add(v);const m=Reflect.getOwnPropertyDescriptor(C,v);m!==void 0&&typeof m.value=="function"&&(u(m.value)||(m.value=t(m.value),Object.defineProperty(f.prototype,v,m)))}C=Reflect.getPrototypeOf(C)}return f}return ho.breakingClass=c,ho}var _m={},lK;function cve(){if(lK)return _m;lK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_m,"__esModule",{value:!0}),_m.mergeTupleBTrees=_m.newTupleBTree=void 0;const e=dl(),n=fse();function a(r){return(0,n.brand)(new e.BTree(r,t))}_m.newTupleBTree=a;function t(r,s){for(let o=0;o<r.length;o++){const u=r[o],c=s[o];if(u===void 0&&c!==void 0)return-1;if(c===void 0&&u!==void 0)return 1;if(u<c)return-1;if(u>c)return 1}return 0}function i(r,s,o=!0){if(r===void 0)return s!==void 0?(0,n.brand)(s.clone()):a();const u=(0,n.brand)(r.clone());if(s===void 0)return u;for(const[c,d]of s.entries())u.set(c,d,!o);return u}return _m.mergeTupleBTrees=i,_m}var _S={},fK;function uve(){if(fK)return _S;fK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_S,"__esModule",{value:!0}),_S.cloneWithReplacements=void 0;function e(n,a,t){const{clone:i,value:r}=t(a,n);if(i===!1)return r;if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map((o,u)=>e(o,u.toString(),t));const s={};for(const[o,u]of Object.entries(n))s[o]=e(u,o,t);return s}return _S.cloneWithReplacements=e,_S}var hK;function Bt(){return hK||(hK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getLast=e.count=e.find=e.compareStrings=e.transformObjectMap=e.assertValidRangeIndices=e.capitalize=e.disposeSymbol=e.compareNamed=e.oneFromSet=e.invertMap=e.objectToMap=e.assertNonNegativeSafeInteger=e.assertValidRange=e.assertValidIndex=e.filterIterable=e.mapIterable=e.makeArray=e.JsonCompatibleReadOnlySchema=e.isReadonlyArray=e.isJsonObject=e.getOrCreate=e.getOrAddEmptyToMap=e.compareSets=e.clone=e.balancedReduce=e.asMutable=e.StackyIterator=e.OffsetListFactory=e.nestedSetContains=e.addToNestedSet=e.getOrCreateInNestedMap=e.nestedMapFromFlatList=e.nestedMapToFlatList=e.mapNestedMap=e.tryGetFromNestedMap=e.tryAddToNestedMap=e.setInNestedMap=e.populateNestedMap=e.SizedNestedMap=e.forEachInNestedMap=e.getOrDefaultInNestedMap=e.getOrAddInNestedMap=e.deleteFromNestedMap=e.extractFromOpaque=e.brandOpaque=e.brandedStringType=e.brandedNumberType=e.BrandedType=e.brand=void 0,e.cloneWithReplacements=e.mergeTupleBTrees=e.newTupleBTree=e.breakingClass=e.throwIfBroken=e.breakingMethod=e.Breakable=e.fakeIdAllocator=e.idAllocatorFromState=e.idAllocatorFromMaxId=e.newIntegerRangeMap=e.RangeMap=e.brandedSlot=e.getOrCreateSlotContent=e.unsafeArrayToTuple=e.ReferenceCountedBase=e.iterableHasSome=e.getOrAddInMap=e.copyProperty=e.defineLazyCachedProperty=e.hasSingle=e.hasSome=void 0;var n=fse();Object.defineProperty(e,"brand",{enumerable:!0,get:function(){return n.brand}}),Object.defineProperty(e,"BrandedType",{enumerable:!0,get:function(){return n.BrandedType}});var a=Ybe();Object.defineProperty(e,"brandedNumberType",{enumerable:!0,get:function(){return a.brandedNumberType}}),Object.defineProperty(e,"brandedStringType",{enumerable:!0,get:function(){return a.brandedStringType}});var t=Xbe();Object.defineProperty(e,"brandOpaque",{enumerable:!0,get:function(){return t.brandOpaque}}),Object.defineProperty(e,"extractFromOpaque",{enumerable:!0,get:function(){return t.extractFromOpaque}});var i=Jse();Object.defineProperty(e,"deleteFromNestedMap",{enumerable:!0,get:function(){return i.deleteFromNestedMap}}),Object.defineProperty(e,"getOrAddInNestedMap",{enumerable:!0,get:function(){return i.getOrAddInNestedMap}}),Object.defineProperty(e,"getOrDefaultInNestedMap",{enumerable:!0,get:function(){return i.getOrDefaultInNestedMap}}),Object.defineProperty(e,"forEachInNestedMap",{enumerable:!0,get:function(){return i.forEachInNestedMap}}),Object.defineProperty(e,"SizedNestedMap",{enumerable:!0,get:function(){return i.SizedNestedMap}}),Object.defineProperty(e,"populateNestedMap",{enumerable:!0,get:function(){return i.populateNestedMap}}),Object.defineProperty(e,"setInNestedMap",{enumerable:!0,get:function(){return i.setInNestedMap}}),Object.defineProperty(e,"tryAddToNestedMap",{enumerable:!0,get:function(){return i.tryAddToNestedMap}}),Object.defineProperty(e,"tryGetFromNestedMap",{enumerable:!0,get:function(){return i.tryGetFromNestedMap}}),Object.defineProperty(e,"mapNestedMap",{enumerable:!0,get:function(){return i.mapNestedMap}}),Object.defineProperty(e,"nestedMapToFlatList",{enumerable:!0,get:function(){return i.nestedMapToFlatList}}),Object.defineProperty(e,"nestedMapFromFlatList",{enumerable:!0,get:function(){return i.nestedMapFromFlatList}}),Object.defineProperty(e,"getOrCreateInNestedMap",{enumerable:!0,get:function(){return i.getOrCreateInNestedMap}});var r=Zbe();Object.defineProperty(e,"addToNestedSet",{enumerable:!0,get:function(){return r.addToNestedSet}}),Object.defineProperty(e,"nestedSetContains",{enumerable:!0,get:function(){return r.nestedSetContains}});var s=eve();Object.defineProperty(e,"OffsetListFactory",{enumerable:!0,get:function(){return s.OffsetListFactory}});var o=tve();Object.defineProperty(e,"StackyIterator",{enumerable:!0,get:function(){return o.StackyIterator}});var u=cq();Object.defineProperty(e,"asMutable",{enumerable:!0,get:function(){return u.asMutable}}),Object.defineProperty(e,"balancedReduce",{enumerable:!0,get:function(){return u.balancedReduce}}),Object.defineProperty(e,"clone",{enumerable:!0,get:function(){return u.clone}}),Object.defineProperty(e,"compareSets",{enumerable:!0,get:function(){return u.compareSets}}),Object.defineProperty(e,"getOrAddEmptyToMap",{enumerable:!0,get:function(){return u.getOrAddEmptyToMap}}),Object.defineProperty(e,"getOrCreate",{enumerable:!0,get:function(){return u.getOrCreate}}),Object.defineProperty(e,"isJsonObject",{enumerable:!0,get:function(){return u.isJsonObject}}),Object.defineProperty(e,"isReadonlyArray",{enumerable:!0,get:function(){return u.isReadonlyArray}}),Object.defineProperty(e,"JsonCompatibleReadOnlySchema",{enumerable:!0,get:function(){return u.JsonCompatibleReadOnlySchema}}),Object.defineProperty(e,"makeArray",{enumerable:!0,get:function(){return u.makeArray}}),Object.defineProperty(e,"mapIterable",{enumerable:!0,get:function(){return u.mapIterable}}),Object.defineProperty(e,"filterIterable",{enumerable:!0,get:function(){return u.filterIterable}}),Object.defineProperty(e,"assertValidIndex",{enumerable:!0,get:function(){return u.assertValidIndex}}),Object.defineProperty(e,"assertValidRange",{enumerable:!0,get:function(){return u.assertValidRange}}),Object.defineProperty(e,"assertNonNegativeSafeInteger",{enumerable:!0,get:function(){return u.assertNonNegativeSafeInteger}}),Object.defineProperty(e,"objectToMap",{enumerable:!0,get:function(){return u.objectToMap}}),Object.defineProperty(e,"invertMap",{enumerable:!0,get:function(){return u.invertMap}}),Object.defineProperty(e,"oneFromSet",{enumerable:!0,get:function(){return u.oneFromSet}}),Object.defineProperty(e,"compareNamed",{enumerable:!0,get:function(){return u.compareNamed}}),Object.defineProperty(e,"disposeSymbol",{enumerable:!0,get:function(){return u.disposeSymbol}}),Object.defineProperty(e,"capitalize",{enumerable:!0,get:function(){return u.capitalize}}),Object.defineProperty(e,"assertValidRangeIndices",{enumerable:!0,get:function(){return u.assertValidRangeIndices}}),Object.defineProperty(e,"transformObjectMap",{enumerable:!0,get:function(){return u.transformObjectMap}}),Object.defineProperty(e,"compareStrings",{enumerable:!0,get:function(){return u.compareStrings}}),Object.defineProperty(e,"find",{enumerable:!0,get:function(){return u.find}}),Object.defineProperty(e,"count",{enumerable:!0,get:function(){return u.count}}),Object.defineProperty(e,"getLast",{enumerable:!0,get:function(){return u.getLast}}),Object.defineProperty(e,"hasSome",{enumerable:!0,get:function(){return u.hasSome}}),Object.defineProperty(e,"hasSingle",{enumerable:!0,get:function(){return u.hasSingle}}),Object.defineProperty(e,"defineLazyCachedProperty",{enumerable:!0,get:function(){return u.defineLazyCachedProperty}}),Object.defineProperty(e,"copyProperty",{enumerable:!0,get:function(){return u.copyPropertyIfDefined}}),Object.defineProperty(e,"getOrAddInMap",{enumerable:!0,get:function(){return u.getOrAddInMap}}),Object.defineProperty(e,"iterableHasSome",{enumerable:!0,get:function(){return u.iterableHasSome}});var c=nve();Object.defineProperty(e,"ReferenceCountedBase",{enumerable:!0,get:function(){return c.ReferenceCountedBase}});var d=rve();Object.defineProperty(e,"unsafeArrayToTuple",{enumerable:!0,get:function(){return d.unsafeArrayToTuple}});var l=ive();Object.defineProperty(e,"getOrCreateSlotContent",{enumerable:!0,get:function(){return l.getOrCreateSlotContent}}),Object.defineProperty(e,"brandedSlot",{enumerable:!0,get:function(){return l.brandedSlot}});var f=sve();Object.defineProperty(e,"RangeMap",{enumerable:!0,get:function(){return f.RangeMap}}),Object.defineProperty(e,"newIntegerRangeMap",{enumerable:!0,get:function(){return f.newIntegerRangeMap}});var b=ave();Object.defineProperty(e,"idAllocatorFromMaxId",{enumerable:!0,get:function(){return b.idAllocatorFromMaxId}}),Object.defineProperty(e,"idAllocatorFromState",{enumerable:!0,get:function(){return b.idAllocatorFromState}}),Object.defineProperty(e,"fakeIdAllocator",{enumerable:!0,get:function(){return b.fakeIdAllocator}});var C=ove();Object.defineProperty(e,"Breakable",{enumerable:!0,get:function(){return C.Breakable}}),Object.defineProperty(e,"breakingMethod",{enumerable:!0,get:function(){return C.breakingMethod}}),Object.defineProperty(e,"throwIfBroken",{enumerable:!0,get:function(){return C.throwIfBroken}}),Object.defineProperty(e,"breakingClass",{enumerable:!0,get:function(){return C.breakingClass}});var v=cve();Object.defineProperty(e,"newTupleBTree",{enumerable:!0,get:function(){return v.newTupleBTree}}),Object.defineProperty(e,"mergeTupleBTrees",{enumerable:!0,get:function(){return v.mergeTupleBTrees}});var m=uve();Object.defineProperty(e,"cloneWithReplacements",{enumerable:!0,get:function(){return m.cloneWithReplacements}})})(Kj)),Kj}var Zj={},eM={},mK;function ST(){return mK||(mK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.aboveRootPlaceholder=e.keyAsDetachedField=e.detachedFieldAsKey=e.rootField=e.rootFieldKey=e.EmptyKey=void 0;const n=Bt();e.EmptyKey=(0,n.brand)(""),e.rootFieldKey=(0,n.brand)("rootFieldKey"),e.rootField=t(e.rootFieldKey);function a(i){return(0,n.brand)((0,n.extractFromOpaque)(i))}e.detachedFieldAsKey=a;function t(i){return(0,n.brand)(i)}e.keyAsDetachedField=t,e.aboveRootPlaceholder=(0,n.brand)("com.fluidframework.placeholder.aboveRoot")})(eM)),eM}var pK;function uq(){return pK||(pK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.areDetachedNodeIdsEqual=e.offsetDetachId=e.makeDetachedNodeId=e.deltaForRootInitialization=e.emptyDelta=void 0;const n=ST();e.emptyDelta={};function a(s){if(s.topLevelLength===0)return e.emptyDelta;const o={minor:0};return{build:[{id:o,trees:s}],fields:new Map([[n.rootFieldKey,[{count:s.topLevelLength,attach:o}]]])}}e.deltaForRootInitialization=a;function t(s,o){const u={minor:o};return s!==void 0&&(u.major=s),u}e.makeDetachedNodeId=t;function i(s,o){if(s!==void 0)return{...s,minor:s.minor+o}}e.offsetDetachId=i;function r(s,o){return s.major===o.major&&s.minor===o.minor}e.areDetachedNodeIdsEqual=r})(Zj)),Zj}var Gi={},gK;function dq(){if(gK)return Gi;gK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Gi,"__esModule",{value:!0}),Gi.getDetachedFieldContainingPath=Gi.compareFieldUpPaths=Gi.compareUpPaths=Gi.topDownPath=Gi.clonePath=Gi.getDepth=Gi.isDetachedUpPathRoot=void 0;const e=ST();function n(u){return u.detachedNodeId!==void 0}Gi.isDetachedUpPathRoot=n;function a(u){let c=0,d=u.parent;for(;d!==void 0;)c+=1,d=d.parent;return c}Gi.getDepth=a;function t(u){if(u!==void 0)return{parent:t(u.parent),parentField:u.parentField,parentIndex:u.parentIndex}}Gi.clonePath=t;function i(u){const c=[];let d=u;for(;d!==void 0;)c.push(d),d=d.parent;return c.reverse(),c}Gi.topDownPath=i;function r(u,c){return u===c?!0:u===void 0||c===void 0||u.parentField!==c.parentField||u.parentIndex!==c.parentIndex?!1:r(u.parent,c.parent)}Gi.compareUpPaths=r;function s(u,c){return u.field!==c.field?!1:r(u.parent,c.parent)}Gi.compareFieldUpPaths=s;function o(u){let c=u;for(;c!==void 0;){if(c.parent===void 0)return(0,e.keyAsDetachedField)(c.parentField);c=c.parent}return(0,e.keyAsDetachedField)(u.parentField)}return Gi.getDetachedFieldContainingPath=o,Gi}var yK;function dve(){if(yK)return vu;yK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=vu&&vu.__classPrivateFieldGet||function(C,v,m,h){if(m==="a"&&!h)throw new TypeError("Private accessor was defined without a getter");if(typeof v=="function"?C!==v||!h:!v.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return m==="m"?h:m==="a"?h.call(C):h?h.value:v.get(C)},n;Object.defineProperty(vu,"__esModule",{value:!0}),vu.AnchorSet=vu.anchorSlot=void 0;const a=Ht(),t=Je(),i=Bt(),r=uq(),s=dq(),o=ST(),u=(0,i.brand)(0);function c(){return(0,i.brandedSlot)()}vu.anchorSlot=c;class d{constructor(){n.set(this,(0,a.createEmitter)()),this.events=e(this,n,"f"),this.anchorCounter=1,this.generationNumber=0,this.root=new f(this,o.EmptyKey,0,void 0),this.anchorToPath=new Map,this.events.on("treeChanging",()=>{this.generationNumber+=1})}get slots(){return this.root.slots}*[(n=new WeakMap,Symbol.iterator)](){const v=[];let m=this.root;for(;m!==void 0;){yield m;for(const[h,g]of m.children)for(const _ of g)v.push(_);m=v.pop()}}isEmpty(){return this.root.children.size===0}locate(v){if(v===u)return;const m=this.anchorToPath.get(v);return(0,t.assert)(m!==void 0,934),m.status===l.Alive?m:void 0}forget(v){if(v!==u){const m=this.anchorToPath.get(v);(0,t.assert)(m!==void 0,849),m.removeRef(),this.anchorToPath.delete(v)}}track(v){if(v===null)return u;const m=this.trackInner(v),h=(0,i.brand)(this.anchorCounter++);return this.anchorToPath.set(h,m),h}trackInner(v){if(v instanceof f&&v.anchorSet===this)return v.addRef(),v;const m=v.parent??this.root,h=this.trackInner(m),g=h.getOrCreateChild(v.parentField,v.parentIndex);return h.removeRef(),g}find(v){if(v instanceof f&&v.anchorSet===this)return v;const m=v.parent??this.root;return this.find(m)?.childIfAnchored(v.parentField,v.parentIndex)}internalizePath(v){let m=v;const h=[];for(;m!==void 0&&!(m instanceof f&&m.anchorSet===this);)h.push(m),m=m.parent;let g;for(;(g=h.pop())!==void 0;){if(m===void 0||m instanceof f){const _=(m??this.root).childIfAnchored(g.parentField,g.parentIndex);if(_!==void 0){m=_;continue}}m===g.parent&&!(g instanceof f)?m=g:m={parent:m,parentField:g.parentField,parentIndex:g.parentIndex}}return m??(0,t.fail)(2794)}deepDelete(v){const m=[...v];for(;m.length>0;){const h=m.pop();(0,t.assert)(h.status===l.Alive,1032),h.status=l.Dangling,h.events.emit("afterDestroy",h);for(const g of h.children.values())m.push(...g)}}decoupleNodes(v,m){(0,t.assert)(m>0,1665);const h=this.find(v.parent??this.root),g=h?.children?.get(v.parentField);let _=[];if(g!==void 0){let S=0,p=0,w=0;for(;w<g.length&&g[w].parentIndex<v.parentIndex;)S++,w++;for(;w<g.length&&g[w].parentIndex<v.parentIndex+m;)p++,w++;for(;w<g.length;)g[w].parentIndex-=m,w++;_=g.splice(S,p),g.length===0&&h.afterEmptyField(v.parentField)}return _}coupleNodes(v,m,h){(0,t.assert)(h.nodes.length>0,1666);const g=this.trackInner(v.parent??this.root);for(const S of h.nodes)S.parentIndex+=v.parentIndex-h.startParentIndex,S.parentPath=g,S.parentField=v.parentField,S.detachedNodeId=(0,s.isDetachedUpPathRoot)(v)?(0,r.offsetDetachId)(v.detachedNodeId,S.parentIndex-v.parentIndex):void 0;const _=g.children.get(v.parentField);if(_===void 0)g.children.set(v.parentField,h.nodes);else{const S=this.increaseParentIndexes(_,v.parentIndex,m);_.splice(S,0,...h.nodes)}g.removeRef()}increaseParentIndexes(v,m,h){let g=0;for(;g<v.length&&v[g].parentIndex<m;)g++;const _=g;for(;g<v.length;)v[g].parentIndex+=h,g++;return _}moveChildren(v,m,h){const g=this.decoupleNodes(v,h);g.length>0?this.coupleNodes(m,h,{startParentIndex:v.parentIndex,nodes:g}):this.offsetChildren(m,h)}removeChildren(v,m){const h=this.decoupleNodes(v,m);this.deepDelete(h)}offsetChildren(v,m){const g=this.find(v.parent??this.root)?.children.get(v.parentField);g!==void 0&&this.increaseParentIndexes(g,v.parentIndex,m)}acquireVisitor(){(0,t.assert)(this.activeVisitor===void 0,1895);const v=[],m={anchorSet:this,maybeWithNode(h,g){this.parent===void 0&&g!==void 0?g():((0,t.assert)(this.parent!==void 0,1456),this.parent=this.anchorSet.internalizePath(this.parent),this.parent instanceof f&&(this.parent.addRef(),v.push(this.parent),h(this.parent)))},parentField:void 0,parent:void 0,bufferedEvents:[],currentDepth:0,depthThresholdForSubtreeChanged:0,free(){(0,t.assert)(this.anchorSet.activeVisitor!==void 0,1896);for(const _ of v)_.removeRef();this.anchorSet.activeVisitor=void 0;const h=new Map;for(const{node:_,event:S,changedField:p}of this.bufferedEvents)S==="childrenChangedAfterBatch"&&(0,i.getOrCreate)(h,_,()=>new Set).add(p??(0,t.fail)(2903));const g=new Map;for(const{node:_,event:S}of this.bufferedEvents){const p=(0,i.getOrAddEmptyToMap)(g,_);if(!p.includes(S))if(p.push(S),S==="childrenChangedAfterBatch"){const w=h.get(_)??(0,t.fail)(2795);_.events.emit(S,{changedFields:w})}else _.events.emit(S)}},notifyChildrenChanging(){this.maybeWithNode(h=>h.events.emit("childrenChanging",h),()=>e(this.anchorSet,n,"f").emit("childrenChanging",this.anchorSet))},notifyChildrenChanged(){this.maybeWithNode(h=>{(0,t.assert)(this.parentField!==void 0,2596),h.events.emit("childrenChanged",h),this.bufferedEvents.push({node:h,event:"childrenChangedAfterBatch",changedField:this.parentField})},()=>{})},attach(h,g,_){this.notifyChildrenChanging(),this.attachEdit(h,g,_),this.notifyChildrenChanged()},attachEdit(h,g,_){(0,t.assert)(this.parentField!==void 0,1954);const S={parent:this.anchorSet.root,parentField:h,parentIndex:0},p={parent:this.parent,parentField:this.parentField,parentIndex:_};this.anchorSet.moveChildren(S,p,g),this.depthThresholdForSubtreeChanged=this.currentDepth},detach(h,g,_){this.notifyChildrenChanging(),this.detachEdit(h,g,_),this.notifyChildrenChanged()},detachEdit(h,g,_){(0,t.assert)(this.parentField!==void 0,1957);const S={parent:this.parent,parentField:this.parentField,parentIndex:h.start},p={parent:this.anchorSet.root,parentField:g,parentIndex:0,detachedNodeId:_};this.anchorSet.moveChildren(S,p,h.end-h.start),this.depthThresholdForSubtreeChanged=this.currentDepth},replace(h,g,_,S){this.notifyChildrenChanging(),this.detachEdit(g,_,S),this.attachEdit(h,g.end-g.start,g.start),this.notifyChildrenChanged()},destroy(h,g){this.anchorSet.removeChildren({parent:void 0,parentField:h,parentIndex:0},g)},create(h,g){},enterNode(h){(0,t.assert)(this.parentField!==void 0,939),this.parent={parent:this.parent,parentField:this.parentField,parentIndex:h},this.parentField=void 0,this.maybeWithNode(g=>{g.events.emit("subtreeChanging",g)}),this.currentDepth++},exitNode(h){(0,t.assert)(this.parent!==void 0,940),this.depthThresholdForSubtreeChanged===this.currentDepth&&(this.maybeWithNode(_=>{_.events.emit("subtreeChanged",_),this.bufferedEvents.push({node:_,event:"subtreeChangedAfterBatch"})}),this.depthThresholdForSubtreeChanged--);const g=this.parent;this.parentField=g.parentField,this.parent=g.parent,this.currentDepth--},enterField(h){this.parentField=h},exitField(h){this.parentField=void 0}};return e(this,n,"f").emit("treeChanging",this),this.activeVisitor=m,m}}vu.AnchorSet=d;var l;(function(C){C[C.Alive=0]="Alive",C[C.Disposed=1]="Disposed",C[C.Dangling=2]="Dangling"})(l||(l={}));class f extends i.ReferenceCountedBase{constructor(v,m,h,g){super(1),this.anchorSet=v,this.parentField=m,this.parentIndex=h,this.parentPath=g,this.status=l.Alive,this.events=(0,a.createEmitter)(()=>this.considerDispose()),this.children=new Map,this.slots=new Map}child(v,m){return this.childIfAnchored(v,m)??{parent:this,parentField:v,parentIndex:m}}getOrCreateChildRef(v,m){const h=this.anchorSet.track(this.child(v,m)),g=this.anchorSet.locate(h)??(0,t.fail)(2796);return[h,g]}isRoot(){return this.parentPath===void 0}get parent(){if((0,t.assert)(this.status!==l.Disposed,1033),(0,t.assert)(this.parentPath!==void 0,853),!this.parentPath.isRoot())return this.parentPath}addRef(v=1){(0,t.assert)(this.status===l.Alive,1034),this.referenceAdded(v)}removeRef(v=1){(0,t.assert)(this.status!==l.Disposed,1035),this.referenceRemoved(v)}onUnreferenced(){this.considerDispose()}getOrCreateChild(v,m){(0,t.assert)(this.status===l.Alive,1036);let h=this.children.get(v);h===void 0&&(h=[],this.children.set(v,h));let g=b(h,m);return g===void 0?(g=new f(this.anchorSet,v,m,this),h.push(g),h.sort((_,S)=>_.parentIndex-S.parentIndex)):g.addRef(),g}childIfAnchored(v,m){(0,t.assert)(this.status===l.Alive,1037);const h=this.children.get(v);return h===void 0?void 0:b(h,m)}removeChild(v){(0,t.assert)(this.status===l.Alive,1038);const m=v.parentField,h=this.children.get(m),g=h?.indexOf(v)??-1;(0,t.assert)(g!==-1,860),h?.splice(g,1),h?.length===0&&this.afterEmptyField(m)}afterEmptyField(v){(0,t.assert)(this.status===l.Alive,1039),this.children.delete(v),this.considerDispose()}considerDispose(){(0,t.assert)(this.status!==l.Disposed,1053),this.isUnreferenced()&&this.children.size===0&&!this.events.hasListeners()&&(this.status===l.Alive&&this.parentPath?.removeChild(this),this.status=l.Disposed)}}function b(C,v){const m=C[v];if(m!==void 0&&m.parentIndex===v)return m;let h=0,g=C.length;for(;h!==g;){const _=Math.floor((h+g)/2),S=C[_],p=S.parentIndex;if(p===v)return S;p>v?g=_:h=_+1}}return vu}var tM={},bK;function Qse(){return bK||(bK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.inCursorNode=e.inCursorField=e.castCursorToSynchronous=e.forEachNodeInSubtree=e.forEachNode=e.iterateCursorField=e.mapCursorField=e.forEachField=e.mapCursorFields=e.CursorLocationType=e.isCursor=e.CursorMarker=void 0;const n=Je();e.CursorMarker=Symbol("CursorMarker");function a(b){return b!==null&&typeof b=="object"&&b[e.CursorMarker]===!0}e.isCursor=a;var t;(function(b){b[b.Nodes=0]="Nodes",b[b.Fields=1]="Fields"})(t||(e.CursorLocationType=t={}));function i(b,C){const v=[];return r(b,m=>{v.push(C(m))}),v}e.mapCursorFields=i;function r(b,C){(0,n.assert)(b.mode===0,1041);for(let v=b.firstField();v;v=b.nextField())C(b)}e.forEachField=r;function s(b,C){const v=[];return u(b,m=>{v.push(C(m))}),v}e.mapCursorField=s;function*o(b,C){(0,n.assert)(b.mode===1,1960);for(let v=b.firstNode();v;v=b.nextNode())yield C(b)}e.iterateCursorField=o;function u(b,C){(0,n.assert)(b.mode===1,957);for(let v=b.firstNode();v;v=b.nextNode())C(b)}e.forEachNode=u;function c(b,C){b.mode===0?(C(b),r(b,v=>c(v,C))):u(b,v=>c(v,C))}e.forEachNodeInSubtree=c;function d(b){return b}e.castCursorToSynchronous=d;function l(b,C,v){b.enterField(C);const m=v(b);return b.exitField(),m}e.inCursorField=l;function f(b,C,v){b.enterNode(C);const m=v(b);return b.exitNode(),m}e.inCursorNode=f})(tM)),tM}var TS={},vK;function lve(){if(vK)return TS;vK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(TS,"__esModule",{value:!0}),TS.deepCopyMapTree=void 0;const e=Je();function n(a){function t(s,o){return{type:s.type,...s.value!==void 0?{value:s.value}:{},fields:o}}const i=new Map,r=[[i,a.fields]];for(let s=r.pop();s!==void 0;s=r.pop()){const[o,u]=s;for(const[c,d]of u)if((0,e.assert)(d.length>0,2995),d.length>0){const l=[];for(const f of d){const b=t(f,new Map);l.push(b),r.push([b.fields,f.fields])}o.set(c,l)}}return t(a,i)}return TS.deepCopyMapTree=n,TS}var mo={},SK;function fve(){if(SK)return mo;SK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(mo,"__esModule",{value:!0}),mo.genericTreeDeleteIfEmpty=mo.genericTreeKeys=mo.setGenericTreeField=mo.getGenericTreeField=void 0;const e=Je();function n(s,o,u){const c=a(s,u);if(Object.prototype.hasOwnProperty.call(c,o))return c[o]??(0,e.fail)(2797);if(u===!1)return[];const d=[];return c[o]=d,d}mo.getGenericTreeField=n;function a(s,o){let u=s.fields;return u===void 0&&(u={},o&&(s.fields=u)),u}function t(s,o,u){const c=a(s,!0);Object.defineProperty(c,o,{enumerable:!0,configurable:!0,writable:!0,value:u})}mo.setGenericTreeField=t;function i(s){const o=s.fields;return o===void 0?[]:Object.keys(o)}mo.genericTreeKeys=i;function r(s,o,u){const c=a(s,!1);Object.prototype.hasOwnProperty.call(c,o)&&c[o]?.length===0&&(delete c[o],u&&Object.keys(c).length===0&&delete s.fields)}return mo.genericTreeDeleteIfEmpty=r,mo}var wS={},wu={},nM={},rM={},Hr={},OS={},CK;function Yse(){if(CK)return OS;CK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(OS,"__esModule",{value:!0}),OS.noopValidator=void 0,OS.noopValidator={compile:()=>({check:e=>!0})},OS}var _K;function Xse(){if(_K)return Hr;_K=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.currentVersion=Hr.FluidClientVersion=Hr.withSchemaValidation=Hr.unitCodec=Hr.ensureBinaryEncoding=Hr.withDefaultBinaryEncoding=Hr.makeCodecFamily=Hr.extractJsonValidator=Hr.toFormatValidator=Hr.FormatValidatorNoOp=void 0;const e=Ht(),n=Je(),a=Yse();Hr.FormatValidatorNoOp=a.noopValidator;function t(f){return f}Hr.toFormatValidator=t;function i(f){return f}Hr.extractJsonValidator=i;function r(f){const b=new Map;for(const[C,v]of f)b.has(C)&&(0,n.fail)(2751),b.set(C,c(v));return{resolve(C){const v=b.get(C);return(0,n.assert)(v!==void 0,1510),v},getSupportedFormats(){return b.keys()}}}Hr.makeCodecFamily=r;class s{constructor(b){this.jsonCodec=b}encode(b,C){const v=this.jsonCodec.encode(b,C),m=JSON.stringify(v);return e.IsoBuffer.from(m)}decode(b,C){const v=(0,e.bufferToString)(b,"utf8"),m=JSON.parse(v);return this.jsonCodec.decode(m,C)}}function o(f){return typeof f.encode=="function"&&typeof f.decode=="function"}function u(f){return{json:f,binary:new s(f)}}Hr.withDefaultBinaryEncoding=u;function c(f){return o(f)?u(f):f}Hr.ensureBinaryEncoding=c,Hr.unitCodec={json:{encode:()=>0,decode:()=>0},binary:{encode:()=>e.IsoBuffer.from(""),decode:()=>0}};function d(f,b,C){if(!C)return b;const v=C.compile(f);return{encode:(m,h)=>{const g=b.encode(m,h);return v.check(g)||(0,n.fail)(2752),g},decode:(m,h)=>(v.check(m)||(0,n.fail)(2753),b.decode(m,h))}}Hr.withSchemaValidation=d;var l;return(function(f){f[f.v2_0=2]="v2_0",f[f.v2_52=2.052]="v2_52",f[f.EnableUnstableFeatures=Number.POSITIVE_INFINITY]="EnableUnstableFeatures"})(l||(Hr.FluidClientVersion=l={})),Hr.currentVersion=l.v2_0,Hr}var Tm={},TK;function hve(){if(TK)return Tm;TK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Tm,"__esModule",{value:!0}),Tm.DiscriminatedUnionDispatcher=Tm.unionOptions=void 0;const e=Je(),n=Bt();Tm.unionOptions={additionalProperties:!1,minProperties:1,maxProperties:1};class a{constructor(i){this.library=(0,n.objectToMap)(i)}dispatch(i,...r){const s=Reflect.ownKeys(i);(0,e.assert)(s.length===1,1843);const o=s[0],u=i[o];return(this.library.get(o)??(0,e.fail)(2754))(u,...r)}}return Tm.DiscriminatedUnionDispatcher=a,Tm}var iM={},PS={},wK;function Zse(){if(wK)return PS;wK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(PS,"__esModule",{value:!0}),PS.Versioned=void 0;const e=Nr();return PS.Versioned=e.Type.Object({version:e.Type.Number()}),PS}var po={},wm={},OK;function eae(){if(OK)return wm;OK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(wm,"__esModule",{value:!0}),wm.pkgVersion=wm.pkgName=void 0,wm.pkgName="@fluidframework/tree",wm.pkgVersion="2.60.0",wm}var PK;function mve(){if(PK)return po;PK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(po,"__esModule",{value:!0}),po.ClientVersionDispatchingCodecBuilder=po.makeVersionDispatchingCodec=po.makeVersionedValidatedCodec=po.makeVersionedCodec=void 0;const e=Je(),n=Ot(),a=Xse(),t=Zse(),i=eae();function r(c,{jsonValidator:d},l){const f={encode:(b,C)=>{const v=l.encode(b,C);return(0,e.assert)(c.has(v.version),2187),v},decode:(b,C)=>{const v=b;if(!c.has(v.version))throw new n.UsageError(`Unsupported version ${v.version} encountered while decoding data. Supported versions for this data are: ${Array.from(c).join(", ")}.
The client which encoded this data likely specified an "oldestCompatibleClient" value which corresponds to a version newer than the version of this client ("${i.pkgVersion}").`);return l.decode(b,C)}};return c.has(void 0)?f:(0,a.withSchemaValidation)(t.Versioned,f,d)}po.makeVersionedCodec=r;function s(c,d,l,f){return r(d,c,(0,a.withSchemaValidation)(l,f,c.jsonValidator))}po.makeVersionedValidatedCodec=s;function o(c,d){const l=c.resolve(d.writeVersion).json,f=new Set(c.getSupportedFormats());return r(f,d,{encode(b,C){return l.encode(b,C)},decode(b,C){return c.resolve(b.version).json.decode(b,C)}})}po.makeVersionDispatchingCodec=o;class u{constructor(d,l){this.family=d,this.versionMapping=l}build(d){const l=this.versionMapping(d.oldestCompatibleClient);return o(this.family,{...d,writeVersion:l})}}return po.ClientVersionDispatchingCodecBuilder=u,po}var EK;function pve(){return EK||(EK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.makeVersionDispatchingCodec=e.makeVersionedValidatedCodec=e.makeVersionedCodec=e.Versioned=void 0;var n=Zse();Object.defineProperty(e,"Versioned",{enumerable:!0,get:function(){return n.Versioned}});var a=mve();Object.defineProperty(e,"makeVersionedCodec",{enumerable:!0,get:function(){return a.makeVersionedCodec}}),Object.defineProperty(e,"makeVersionedValidatedCodec",{enumerable:!0,get:function(){return a.makeVersionedValidatedCodec}}),Object.defineProperty(e,"makeVersionDispatchingCodec",{enumerable:!0,get:function(){return a.makeVersionDispatchingCodec}})})(iM)),iM}var IK;function zn(){return IK||(IK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.makeVersionDispatchingCodec=e.makeVersionedValidatedCodec=e.makeVersionedCodec=e.Versioned=e.noopValidator=e.unionOptions=e.DiscriminatedUnionDispatcher=e.extractJsonValidator=e.FormatValidatorNoOp=e.toFormatValidator=e.currentVersion=e.FluidClientVersion=e.withSchemaValidation=e.withDefaultBinaryEncoding=e.unitCodec=e.makeCodecFamily=void 0;var n=Xse();Object.defineProperty(e,"makeCodecFamily",{enumerable:!0,get:function(){return n.makeCodecFamily}}),Object.defineProperty(e,"unitCodec",{enumerable:!0,get:function(){return n.unitCodec}}),Object.defineProperty(e,"withDefaultBinaryEncoding",{enumerable:!0,get:function(){return n.withDefaultBinaryEncoding}}),Object.defineProperty(e,"withSchemaValidation",{enumerable:!0,get:function(){return n.withSchemaValidation}}),Object.defineProperty(e,"FluidClientVersion",{enumerable:!0,get:function(){return n.FluidClientVersion}}),Object.defineProperty(e,"currentVersion",{enumerable:!0,get:function(){return n.currentVersion}}),Object.defineProperty(e,"toFormatValidator",{enumerable:!0,get:function(){return n.toFormatValidator}}),Object.defineProperty(e,"FormatValidatorNoOp",{enumerable:!0,get:function(){return n.FormatValidatorNoOp}}),Object.defineProperty(e,"extractJsonValidator",{enumerable:!0,get:function(){return n.extractJsonValidator}});var a=hve();Object.defineProperty(e,"DiscriminatedUnionDispatcher",{enumerable:!0,get:function(){return a.DiscriminatedUnionDispatcher}}),Object.defineProperty(e,"unionOptions",{enumerable:!0,get:function(){return a.unionOptions}});var t=Yse();Object.defineProperty(e,"noopValidator",{enumerable:!0,get:function(){return t.noopValidator}});var i=pve();Object.defineProperty(e,"Versioned",{enumerable:!0,get:function(){return i.Versioned}}),Object.defineProperty(e,"makeVersionedCodec",{enumerable:!0,get:function(){return i.makeVersionedCodec}}),Object.defineProperty(e,"makeVersionedValidatedCodec",{enumerable:!0,get:function(){return i.makeVersionedValidatedCodec}}),Object.defineProperty(e,"makeVersionDispatchingCodec",{enumerable:!0,get:function(){return i.makeVersionDispatchingCodec}})})(rM)),rM}var sM={},RK;function lq(){return RK||(RK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TreeNodeSchemaDataFormat=e.PersistedValueSchema=e.FieldSchemaFormat=e.TreeNodeSchemaIdentifierSchema=e.FieldKindIdentifierSchema=e.FieldKeySchema=void 0;const n=Nr(),a=zn(),t=Bt();e.FieldKeySchema=(0,t.brandedStringType)(),e.FieldKindIdentifierSchema=(0,t.brandedStringType)(),e.TreeNodeSchemaIdentifierSchema=(0,t.brandedStringType)();const i=n.Type.Object({kind:e.FieldKindIdentifierSchema,types:n.Type.Array(e.TreeNodeSchemaIdentifierSchema)}),r={additionalProperties:!1};e.FieldSchemaFormat=n.Type.Composite([i],r);var s;(function(o){o[o.Number=0]="Number",o[o.String=1]="String",o[o.Boolean=2]="Boolean",o[o.FluidHandle=3]="FluidHandle",o[o.Null=4]="Null"})(s||(e.PersistedValueSchema=s={})),e.TreeNodeSchemaDataFormat=n.Type.Object({object:n.Type.Optional(n.Type.Record(n.Type.String(),e.FieldSchemaFormat)),map:n.Type.Optional(e.FieldSchemaFormat),leaf:n.Type.Optional(n.Type.Enum(s))},a.unionOptions)})(sM)),sM}var FK;function tae(){return FK||(FK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.decodeFieldSchema=e.encodeFieldSchemaV2=e.encodeFieldSchemaV1=e.storedSchemaDecodeDispatcher=e.LeafNodeStoredSchema=e.MapNodeStoredSchema=e.ObjectNodeStoredSchema=e.TreeNodeStoredSchema=e.identifierFieldKindIdentifier=e.storedEmptyFieldSchema=e.forbiddenFieldKindIdentifier=e.ValueSchema=e.SchemaVersion=void 0;const n=Je(),a=zn(),t=Bt(),i=lq();var r;(function(g){g[g.v1=1]="v1",g[g.v2=2]="v2"})(r||(e.SchemaVersion=r={}));var s;(function(g){g[g.Number=0]="Number",g[g.String=1]="String",g[g.Boolean=2]="Boolean",g[g.FluidHandle=3]="FluidHandle",g[g.Null=4]="Null"})(s||(e.ValueSchema=s={})),e.forbiddenFieldKindIdentifier=(0,t.brand)("Forbidden"),e.storedEmptyFieldSchema={kind:e.forbiddenFieldKindIdentifier,types:new Set,persistedMetadata:void 0},e.identifierFieldKindIdentifier="Identifier";class o{constructor(_){this.metadata=_}}e.TreeNodeStoredSchema=o;class u extends o{constructor(_,S){super(S),this.objectNodeFields=_}encodeV1(){return{object:this.encodeFieldsObject(v)}}encodeV2(){return{kind:{object:this.encodeFieldsObject(m)},metadata:this.metadata}}getFieldSchema(_){return this.objectNodeFields.get(_)??e.storedEmptyFieldSchema}encodeFieldsObject(_){const S=Object.create(null);for(const p of[...this.objectNodeFields.keys()].sort())Object.defineProperty(S,p,{enumerable:!0,configurable:!0,writable:!0,value:_(this.objectNodeFields.get(p)??(0,n.fail)(2791))});return S}}e.ObjectNodeStoredSchema=u;class c extends o{constructor(_,S){super(S),this.mapFields=_}encodeV1(){return{map:v(this.mapFields)}}encodeV2(){return{kind:{map:m(this.mapFields)},metadata:this.metadata}}getFieldSchema(_){return this.mapFields}}e.MapNodeStoredSchema=c;class d extends o{constructor(_){super(void 0),this.leafValue=_}encodeV1(){return{leaf:b(this.leafValue)}}encodeV2(){return{kind:{leaf:b(this.leafValue)}}}getFieldSchema(_){return e.storedEmptyFieldSchema}}e.LeafNodeStoredSchema=d,e.storedSchemaDecodeDispatcher=new a.DiscriminatedUnionDispatcher({leaf:g=>_=>new d(C(g)),object:g=>_=>{const S=new Map;for(const[p,w]of Object.entries(g))S.set(p,h(w));return new u(S,_)},map:g=>_=>new c(h(g),_)});const l=new Map([[s.Number,i.PersistedValueSchema.Number],[s.String,i.PersistedValueSchema.String],[s.Boolean,i.PersistedValueSchema.Boolean],[s.FluidHandle,i.PersistedValueSchema.FluidHandle],[s.Null,i.PersistedValueSchema.Null]]),f=(0,t.invertMap)(l);function b(g){return l.get(g)??(0,n.fail)(2792)}function C(g){return f.get(g)??(0,n.fail)(2793)}function v(g){return{kind:g.kind,types:[...g.types].sort()}}e.encodeFieldSchemaV1=v;function m(g){const _=v(g);return g.persistedMetadata!==void 0?{..._,metadata:g.persistedMetadata}:{..._}}e.encodeFieldSchemaV2=m;function h(g){return{kind:g.kind,types:new Set(g.types),persistedMetadata:g.metadata}}e.decodeFieldSchema=h})(nM)),nM}var Om={},jK;function gve(){if(jK)return Om;jK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Om,"__esModule",{value:!0}),Om.schemaDataIsEmpty=Om.TreeStoredSchemaRepository=void 0;const e=Ht(),n=dl(),a=Bt(),t=tae();class i{constructor(u){this._events=(0,e.createEmitter)(),this.events=this._events,u===void 0?(this.rootFieldSchemaData=t.storedEmptyFieldSchema,this.nodeSchemaData=new n.BTree([],a.compareStrings)):u instanceof i?(this.rootFieldSchemaData=u.rootFieldSchema,this.nodeSchemaData=u.nodeSchemaData.clone()):(this.rootFieldSchemaData=u.rootFieldSchema,this.nodeSchemaData=s(u.nodeSchema))}get nodeSchema(){return this.nodeSchemaData}get rootFieldSchema(){return this.rootFieldSchemaData}apply(u){this._events.emit("beforeSchemaChange",u);const c=new i(u);this.rootFieldSchemaData=c.rootFieldSchemaData,this.nodeSchemaData=c.nodeSchemaData,this._events.emit("afterSchemaChange",u)}clone(){return new i(this)}}Om.TreeStoredSchemaRepository=i;function r(o){return o.nodeSchema.size===0}Om.schemaDataIsEmpty=r;function s(o){const u=[...o.entries()];return new n.BTree(u,a.compareStrings)}return Om}var ES={},MK;function yve(){if(MK)return ES;MK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ES,"__esModule",{value:!0}),ES.Multiplicity=void 0;var e;return(function(n){n[n.Single=0]="Single",n[n.Optional=1]="Optional",n[n.Sequence=2]="Sequence",n[n.Forbidden=3]="Forbidden"})(e||(ES.Multiplicity=e={})),ES}var aM={},NK;function bve(){return NK||(NK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TreeNodeSchemaDataFormat=e.TreeNodeSchemaUnionFormat=e.FieldSchemaFormat=e.PersistedMetadataFormat=void 0;const n=Nr(),a=Bt(),t=lq(),i=zn();e.PersistedMetadataFormat=n.Type.Optional(a.JsonCompatibleReadOnlySchema);const r=n.Type.Object({kind:t.FieldKindIdentifierSchema,types:n.Type.Array(t.TreeNodeSchemaIdentifierSchema),metadata:e.PersistedMetadataFormat}),s={additionalProperties:!1};e.FieldSchemaFormat=n.Type.Composite([r],s),e.TreeNodeSchemaUnionFormat=n.Type.Object({object:n.Type.Optional(n.Type.Record(n.Type.String(),e.FieldSchemaFormat)),map:n.Type.Optional(e.FieldSchemaFormat),leaf:n.Type.Optional(n.Type.Enum(t.PersistedValueSchema))},i.unionOptions),e.TreeNodeSchemaDataFormat=n.Type.Object({kind:e.TreeNodeSchemaUnionFormat,metadata:e.PersistedMetadataFormat},s)})(aM)),aM}var AK;function nae(){return AK||(AK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=wu&&wu.__createBinding||(Object.create?(function(c,d,l,f){f===void 0&&(f=l);var b=Object.getOwnPropertyDescriptor(d,l);(!b||("get"in b?!d.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return d[l]}}),Object.defineProperty(c,f,b)}):(function(c,d,l,f){f===void 0&&(f=l),c[f]=d[l]})),a=wu&&wu.__setModuleDefault||(Object.create?(function(c,d){Object.defineProperty(c,"default",{enumerable:!0,value:d})}):function(c,d){c.default=d}),t=wu&&wu.__importStar||function(c){if(c&&c.__esModule)return c;var d={};if(c!=null)for(var l in c)l!=="default"&&Object.prototype.hasOwnProperty.call(c,l)&&n(d,c,l);return a(d,c),d};Object.defineProperty(e,"__esModule",{value:!0}),e.schemaFormatV2=e.schemaFormatV1=e.Multiplicity=e.schemaDataIsEmpty=e.TreeStoredSchemaRepository=e.SchemaVersion=e.storedSchemaDecodeDispatcher=e.encodeFieldSchemaV2=e.encodeFieldSchemaV1=e.decodeFieldSchema=e.MapNodeStoredSchema=e.ObjectNodeStoredSchema=e.LeafNodeStoredSchema=e.storedEmptyFieldSchema=e.identifierFieldKindIdentifier=e.forbiddenFieldKindIdentifier=e.TreeNodeStoredSchema=e.ValueSchema=void 0;var i=tae();Object.defineProperty(e,"ValueSchema",{enumerable:!0,get:function(){return i.ValueSchema}}),Object.defineProperty(e,"TreeNodeStoredSchema",{enumerable:!0,get:function(){return i.TreeNodeStoredSchema}}),Object.defineProperty(e,"forbiddenFieldKindIdentifier",{enumerable:!0,get:function(){return i.forbiddenFieldKindIdentifier}}),Object.defineProperty(e,"identifierFieldKindIdentifier",{enumerable:!0,get:function(){return i.identifierFieldKindIdentifier}}),Object.defineProperty(e,"storedEmptyFieldSchema",{enumerable:!0,get:function(){return i.storedEmptyFieldSchema}}),Object.defineProperty(e,"LeafNodeStoredSchema",{enumerable:!0,get:function(){return i.LeafNodeStoredSchema}}),Object.defineProperty(e,"ObjectNodeStoredSchema",{enumerable:!0,get:function(){return i.ObjectNodeStoredSchema}}),Object.defineProperty(e,"MapNodeStoredSchema",{enumerable:!0,get:function(){return i.MapNodeStoredSchema}}),Object.defineProperty(e,"decodeFieldSchema",{enumerable:!0,get:function(){return i.decodeFieldSchema}}),Object.defineProperty(e,"encodeFieldSchemaV1",{enumerable:!0,get:function(){return i.encodeFieldSchemaV1}}),Object.defineProperty(e,"encodeFieldSchemaV2",{enumerable:!0,get:function(){return i.encodeFieldSchemaV2}}),Object.defineProperty(e,"storedSchemaDecodeDispatcher",{enumerable:!0,get:function(){return i.storedSchemaDecodeDispatcher}}),Object.defineProperty(e,"SchemaVersion",{enumerable:!0,get:function(){return i.SchemaVersion}});var r=gve();Object.defineProperty(e,"TreeStoredSchemaRepository",{enumerable:!0,get:function(){return r.TreeStoredSchemaRepository}}),Object.defineProperty(e,"schemaDataIsEmpty",{enumerable:!0,get:function(){return r.schemaDataIsEmpty}});var s=yve();Object.defineProperty(e,"Multiplicity",{enumerable:!0,get:function(){return s.Multiplicity}});const o=t(lq());e.schemaFormatV1=o;const u=t(bve());e.schemaFormatV2=u})(wu)),wu}var DK;function vve(){if(DK)return wS;DK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(wS,"__esModule",{value:!0}),wS.EncodedJsonableTree=void 0;const e=Nr(),n=nae(),a=s=>e.Type.Record(e.Type.String(),e.Type.Array(s,{minItems:1})),t=e.Type.Object({value:e.Type.Optional(e.Type.Any()),type:e.Type.Readonly(n.schemaFormatV1.TreeNodeSchemaIdentifierSchema)}),i=s=>e.Type.Object({fields:e.Type.Optional(a(s)),globalFields:e.Type.Optional(a(s))}),r=s=>e.Type.Composite([i(s),t],{additionalProperties:!1});return wS.EncodedJsonableTree=e.Type.Recursive(s=>r(s)),wS}var IS={},kK;function rae(){if(kK)return IS;kK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(IS,"__esModule",{value:!0}),IS.visitDelta=void 0;const e=Je(),n=Bt(),a=Qse(),t=uq();function i(h,g,_,S){const p=new Map,w=new Map,O=[],E=[],F=new Map;h.refreshers?.forEach(({id:{major:j,minor:k},trees:x})=>{const L=m(x);for(let V=0;V<x.topLevelLength;V+=1){const G=k+V;(0,n.setInNestedMap)(F,j,G,L[V])}});const R={func:c,latestRevision:S,refreshers:F,detachedFieldIndex:_,detachPassRoots:p,attachPassRoots:w,rootTransfers:O,rootDestructions:E};l(h.build,R,g),f(h.global,R,g),b(h.rename,R),o(h.fields,g,R),r(g,p,R),s(O,w,_,g,F,S);const M={func:v,latestRevision:S,refreshers:F,detachedFieldIndex:_,detachPassRoots:p,attachPassRoots:w,rootTransfers:O,rootDestructions:E};o(h.fields,g,M),r(g,w,M),C(h.destroy,M);for(const{id:j,count:k}of E)for(let x=0;x<k;x+=1){const L=(0,t.offsetDetachId)(j,x),V=_.getEntry(L),G=_.toFieldKey(V);g.destroy(G,1),_.deleteEntry(L)}}IS.visitDelta=i;function r(h,g,_){for(;g.size>0;)for(const[S,p]of g){g.delete(S);const w=_.detachedFieldIndex.toFieldKey(S);h.enterField(w),u(0,p,h,_),h.exitField(w)}}function s(h,g,_,S,p,w){let O=h.flatMap(({oldId:E,newId:F,count:R})=>{const M=[];if(!(0,t.areDetachedNodeIdsEqual)(E,F))for(let j=0;j<R;j+=1)M.push({oldId:(0,t.offsetDetachId)(E,j),newId:(0,t.offsetDetachId)(F,j)});return M});for(;O.length>0;){const E=[],F=O.length;for(const{oldId:R,newId:M}of O){let j=_.tryGetEntry(R);if(j===void 0){const G=(0,n.tryGetFromNestedMap)(p,R.major,R.minor);G!==void 0&&(d(R,[G],_,w,S),j=_.getEntry(R))}if(j===void 0){E.push({oldId:R,newId:M});continue}let k=_.tryGetEntry(M);if(k!==void 0){E.push({oldId:R,newId:M});continue}k=_.createEntry(M,w);const x=g.get(j);x!==void 0&&(g.delete(j),g.set(k,x));const L=_.toFieldKey(j),V=_.toFieldKey(k);S.enterField(L),S.detach({start:0,end:1},V,M,!1),S.exitField(L),_.deleteEntry(R)}(0,e.assert)(E.length<F,1999),O=E}}function o(h,g,_){if(h!==void 0)for(const[S,p]of h)g.enterField(S),_.func(p,g,_),g.exitField(S)}function u(h,g,_,S){g!==void 0&&(_.enterNode(h),o(g,_,S),_.exitNode(h))}function c(h,g,_){let S=0;for(const p of h){if(p.fields!==void 0&&((0,e.assert)(p.attach===void 0||p.detach!==void 0,2e3),u(S,p.fields,g,_)),p.detach!==void 0)for(let w=0;w<p.count;w+=1){const O=(0,t.offsetDetachId)(p.detach,w),E=_.detachedFieldIndex.createEntry(O,_.latestRevision);p.fields!==void 0&&_.attachPassRoots.set(E,p.fields);const F=_.detachedFieldIndex.toFieldKey(E);g.detach({start:S,end:S+1},F,O,p.attach!==void 0)}p.detach===void 0&&p.attach===void 0&&(S+=p.count)}}function d(h,g,_,S,p){for(const[w,O]of g.entries()){const E=(0,t.offsetDetachId)(h,w);let F=_.tryGetEntry(E);(0,e.assert)(F===void 0,2345),F=_.createEntry(E,S);const R=_.toFieldKey(F);p.create([O],R)}}function l(h,g,_){if(h!==void 0)for(const{id:S,trees:p}of h)d(S,m(p),g.detachedFieldIndex,g.latestRevision,_)}function f(h,g,_){if(h!==void 0)for(const{id:S,fields:p}of h){let w=g.detachedFieldIndex.tryGetEntry(S);if(w===void 0){const O=(0,n.tryGetFromNestedMap)(g.refreshers,S.major,S.minor);(0,e.assert)(O!==void 0,2344),d(S,[O],g.detachedFieldIndex,g.latestRevision,_),w=g.detachedFieldIndex.getEntry(S)}g.detachedFieldIndex.updateLatestRevision(S,g.latestRevision),g.detachPassRoots.set(w,p),g.attachPassRoots.set(w,p)}}function b(h,g){h!==void 0&&g.rootTransfers.push(...h)}function C(h,g){h!==void 0&&g.rootDestructions.push(...h)}function v(h,g,_){let S=0;for(const p of h){if(p.attach!==void 0)for(let w=0;w<p.count;w+=1){const O=(0,t.offsetDetachId)(p.attach,w);let E=_.detachedFieldIndex.tryGetEntry(O);if(E===void 0){const j=(0,n.tryGetFromNestedMap)(_.refreshers,O.major,O.minor);(0,e.assert)(j!==void 0,2346),d(O,[j],_.detachedFieldIndex,_.latestRevision,g),E=_.detachedFieldIndex.getEntry(O)}const F=_.detachedFieldIndex.toFieldKey(E),R=S+w;g.attach(F,1,R),_.detachedFieldIndex.deleteEntry(O);const M=_.attachPassRoots.get(E);M!==void 0&&(_.attachPassRoots.delete(E),u(R,M,g,_))}p.detach===void 0&&p.fields!==void 0&&u(S,p.fields,g,_),(p.detach===void 0||p.attach!==void 0)&&(S+=p.count)}}function m(h){return(0,a.mapCursorField)(h.cursor(),g=>g.fork())}return IS}var ba={},RS={},Pm={},oM={},cM={},xK;function fq(){return xK||(xK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.Format=e.EncodedRootsForRevision=e.RootRanges=e.RootRange=e.ForestRootIdSchema=e.DetachId=void 0;const n=Nr(),a=Bt();e.DetachId=n.Type.Number({multipleOf:1}),e.ForestRootIdSchema=(0,a.brandedNumberType)({minimum:-1,multipleOf:1}),e.RootRange=n.Type.Tuple([e.DetachId,e.ForestRootIdSchema]),e.RootRanges=n.Type.Array(e.RootRange);const t=r=>n.Type.Union([n.Type.Tuple([r,e.RootRanges]),n.Type.Tuple([r,e.DetachId,e.ForestRootIdSchema])]);e.EncodedRootsForRevision=t;const i=(r,s)=>n.Type.Object({version:n.Type.Literal(r),data:n.Type.Array((0,e.EncodedRootsForRevision)(s)),maxId:e.ForestRootIdSchema},{additionalProperties:!1});e.Format=i})(cM)),cM}var uM={},Un={},qK;function iae(){if(qK)return Un;qK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Un,"__esModule",{value:!0}),Un.compareRevisions=Un.subtractChangeAtomIds=Un.newChangeAtomIdRangeMap=Un.mintCommit=Un.CommitKind=Un.replaceAtomRevisions=Un.offsetChangeAtomId=Un.taggedOptAtomId=Un.taggedAtomId=Un.asChangeAtomId=Un.makeChangeAtomId=Un.areEqualChangeAtomIdOpts=Un.areEqualChangeAtomIds=Un.StableIdSchema=Un.RevisionTagSchema=Un.SessionIdSchema=void 0;const e=Nr(),n=Bt();Un.SessionIdSchema=(0,n.brandedStringType)(),Un.RevisionTagSchema=e.Type.Union([e.Type.Literal("root"),(0,n.brandedNumberType)()]),Un.StableIdSchema=e.Type.String();function a(m,h){return m.localId===h.localId&&m.revision===h.revision}Un.areEqualChangeAtomIds=a;function t(m,h){return m===void 0||h===void 0?m===h:a(m,h)}Un.areEqualChangeAtomIdOpts=t;function i(m,h){return h===void 0?{localId:m}:{localId:m,revision:h}}Un.makeChangeAtomId=i;function r(m){return typeof m=="object"?m:{localId:m}}Un.asChangeAtomId=r;function s(m,h){return i(m.localId,m.revision??h)}Un.taggedAtomId=s;function o(m,h){if(m!==void 0)return s(m,h)}Un.taggedOptAtomId=o;function u(m,h){return{...m,localId:(0,n.brand)(m.localId+h)}}Un.offsetChangeAtomId=u;function c(m,h,g){return h.has(m.revision)?d(m,g):m}Un.replaceAtomRevisions=c;function d(m,h){const g={...m,revision:h};return h===void 0&&delete g.revision,g}var l;(function(m){m[m.Default=0]="Default",m[m.Undo=1]="Undo",m[m.Redo=2]="Redo"})(l||(Un.CommitKind=l={}));function f(m,h){const{revision:g,change:_}=h;return{revision:g,change:_,parent:m}}Un.mintCommit=f;function b(){return new n.RangeMap(u,C)}Un.newChangeAtomIdRangeMap=b;function C(m,h){const g=v(m.revision,h.revision);return g!==0?g*Number.POSITIVE_INFINITY:m.localId-h.localId}Un.subtractChangeAtomIds=C;function v(m,h){return m===void 0?h===void 0?0:-1:h===void 0?1:m<h?-1:m>h?1:0}return Un.compareRevisions=v,Un}var FS={},LK;function Sve(){if(LK)return FS;LK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(FS,"__esModule",{value:!0}),FS.RevisionTagCodec=void 0;const e=Je();class n{constructor(t){this.idCompressor=t,this.localSessionId=t.localSessionId}encode(t){return t==="root"?t:this.idCompressor.normalizeToOpSpace(t)}decode(t,i){return t==="root"?t:((0,e.assert)(typeof t=="number",2189),this.idCompressor.normalizeToSessionSpace(t,i.originatorId))}}return FS.RevisionTagCodec=n,FS}var va={},BK;function sae(){if(BK)return va;BK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(va,"__esModule",{value:!0}),va.FinalChangeStatus=va.makeAnonChange=va.tagRollbackInverse=va.tagChange=va.mapTaggedChange=void 0;function e(r,s){return{...r,change:s}}va.mapTaggedChange=e;function n(r,s){return{revision:s,change:r}}va.tagChange=n;function a(r,s,o){return{revision:s,change:r,rollbackOf:o}}va.tagRollbackInverse=a;function t(r){return{revision:void 0,change:r}}va.makeAnonChange=t;var i;return(function(r){r[r.conflicted=0]="conflicted",r[r.rebased=1]="rebased",r[r.commuted=2]="commuted"})(i||(va.FinalChangeStatus=i={})),va}var Pi={},UK;function Cve(){if(UK)return Pi;UK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.isAncestor=Pi.replaceChange=Pi.findCommonAncestor=Pi.findAncestor=Pi.rebaseChangeOverChanges=Pi.revisionMetadataSourceFromInfo=Pi.rebaseChange=Pi.rebaseBranch=void 0;const e=Je(),n=Bt(),a=sae(),t=iae();function i(m,h,g,_,S=_){const p=[],w=[],O=f([g,p],[S,w]);(0,e.assert)(O!==void 0,1653);const E=p.length,F=w.findIndex(fe=>fe===_);if(F===-1)return{newSourceHead:g,sourceChange:void 0,commits:{deletedSourceCommits:[],targetCommits:[],sourceCommits:p},telemetryProperties:{sourceBranchLength:E,rebaseDistance:F+1,countDropped:0}};const R=new Set(p.map(fe=>fe.revision));let M=F;for(const[fe,{revision:oe}]of w.entries())if(R.has(oe))R.delete(oe),M=Math.max(M,fe);else if(fe>F)break;const j=w[M]??(0,e.oob)(),k=w.slice(0,M+1),x=[...p],L=[...k];if((0,n.hasSome)(p)&&(0,n.hasSome)(L)){const fe=Math.min(p.length,L.length);for(let oe=0;oe<fe;oe++){const pe=p[0],de=L[0];pe.revision===de.revision&&(p.shift(),L.shift())}}const V=[];if(!(0,n.hasSome)(L)){for(const fe of p)V.push((0,t.mintCommit)(V[V.length-1]??j,fe));return{newSourceHead:V[V.length-1]??j,sourceChange:void 0,commits:{deletedSourceCommits:x,targetCommits:k,sourceCommits:V},telemetryProperties:{sourceBranchLength:E,rebaseDistance:k.length,countDropped:E-R.size}}}let G=j;const ee=u([...L,...p]),se=s(ee);let re=L.slice();for(const fe of p){const oe=d(h,fe,m);if(R.has(fe.revision)){const pe=(0,a.makeAnonChange)(h.compose(re));re=[pe];const de=h.rebase(fe,pe,se);G={revision:fe.revision,change:de,parent:G},V.push(G),re.push((0,a.tagChange)(de,fe.revision))}ee.push({revision:fe.revision}),re.unshift(oe),ee.unshift({revision:oe.revision,rollbackOf:oe.rollbackOf})}return(0,n.defineLazyCachedProperty)({newSourceHead:G,commits:{deletedSourceCommits:x,targetCommits:k,sourceCommits:V},telemetryProperties:{sourceBranchLength:E,rebaseDistance:k.length,countDropped:E-R.size}},"sourceChange",()=>h.compose(re))}Pi.rebaseBranch=i;function r(m,h,g,_,S){const p=[],w=[];(0,e.assert)(f([g,p],[_,w])!==void 0,1398);const O=p.map(F=>d(m,F,S));O.reverse();const E={sourceBranchLength:1,rebaseDistance:p.length+w.length,countDropped:0};return{change:o(m,h,[...O,...w]),telemetryProperties:E}}Pi.rebaseChange=r;function s(m){const h=S=>{const p=m.findIndex(w=>w.revision===S);return p>=0?p:void 0};return{getIndex:h,tryGetInfo:S=>{if(S===void 0)return;const p=h(S);return p===void 0?void 0:m[p]},hasRollback:S=>m.find(p=>p.rollbackOf===S)!==void 0}}Pi.revisionMetadataSourceFromInfo=s;function o(m,h,g){const _=s(u([...g,h]));return g.reduce((S,p)=>(0,a.mapTaggedChange)(h,m.rebase(S,p,_)),h).change}Pi.rebaseChangeOverChanges=o;function u(m){const h=[];for(const g of m)h.push(...c(g));return h}function c(m){const h=[];if(m.revision!==void 0){const g={revision:m.revision};m.rollbackOf!==void 0&&(g.rollbackOf=m.rollbackOf),h.push(g)}return h}function d(m,h,g,_){const S=C.get(h);if(S!==void 0)return S;const p=g(),w=(0,a.tagRollbackInverse)(m.invert(h,!0,p),p,h.revision);return C.set(h,w),w}function l(m,h=g=>g.parent===void 0){let g,_;Array.isArray(m)?[g,_]=m:g=m;for(let S=g;S!==void 0;S=S.parent){if(h(S))return _?.reverse(),S;_?.push(S)}_!==void 0&&(_.length=0)}Pi.findAncestor=l;function f(m,h){let g,_,S,p;if(Array.isArray(m)?([g,S]=m,(0,e.assert)(S===void 0||S.length===0,1400)):g=m,Array.isArray(h)?([_,p]=h,(0,e.assert)(p===void 0||p.length===0,1401)):_=h,g===_)return g;const w=()=>{S?.reverse(),p?.reverse()},O=new Set;for(;g!==void 0||_!==void 0;){if(g!==void 0){if(O.has(g))return p!==void 0&&(p.length=p.findIndex(E=>Object.is(E,g))),w(),g;O.add(g),S?.push(g),g=g.parent}if(_!==void 0){if(O.has(_))return S!==void 0&&(S.length=S.findIndex(E=>Object.is(E,_))),w(),_;O.add(_),p?.push(_),_=_.parent}}S!==void 0&&(S.length=0),p!==void 0&&(p.length=0)}Pi.findCommonAncestor=f;function b(m,h){const g={...m,change:h};return C.set(g,void 0),g}Pi.replaceChange=b;var C;(function(m){const h=new WeakMap;function g(S){return h.get(S)}m.get=g;function _(S,p){p===void 0?h.delete(S):h.set(S,p)}m.set=_})(C||(C={}));function v(m,h,g){if(g&&m===h)return!0;let _=h.parent;for(;_!==void 0;){if(_===m)return!0;_=_.parent}return!1}return Pi.isAncestor=v,Pi}var zK;function HE(){return zK||(zK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isAncestor=e.replaceChange=e.revisionMetadataSourceFromInfo=e.rebaseChangeOverChanges=e.rebaseChange=e.rebaseBranch=e.findCommonAncestor=e.findAncestor=e.tagRollbackInverse=e.mapTaggedChange=e.tagChange=e.makeAnonChange=e.FinalChangeStatus=e.RevisionTagCodec=e.compareRevisions=e.newChangeAtomIdRangeMap=e.replaceAtomRevisions=e.subtractChangeAtomIds=e.StableIdSchema=e.offsetChangeAtomId=e.taggedOptAtomId=e.taggedAtomId=e.SessionIdSchema=e.RevisionTagSchema=e.CommitKind=e.mintCommit=e.asChangeAtomId=e.makeChangeAtomId=e.areEqualChangeAtomIdOpts=e.areEqualChangeAtomIds=void 0;var n=iae();Object.defineProperty(e,"areEqualChangeAtomIds",{enumerable:!0,get:function(){return n.areEqualChangeAtomIds}}),Object.defineProperty(e,"areEqualChangeAtomIdOpts",{enumerable:!0,get:function(){return n.areEqualChangeAtomIdOpts}}),Object.defineProperty(e,"makeChangeAtomId",{enumerable:!0,get:function(){return n.makeChangeAtomId}}),Object.defineProperty(e,"asChangeAtomId",{enumerable:!0,get:function(){return n.asChangeAtomId}}),Object.defineProperty(e,"mintCommit",{enumerable:!0,get:function(){return n.mintCommit}}),Object.defineProperty(e,"CommitKind",{enumerable:!0,get:function(){return n.CommitKind}}),Object.defineProperty(e,"RevisionTagSchema",{enumerable:!0,get:function(){return n.RevisionTagSchema}}),Object.defineProperty(e,"SessionIdSchema",{enumerable:!0,get:function(){return n.SessionIdSchema}}),Object.defineProperty(e,"taggedAtomId",{enumerable:!0,get:function(){return n.taggedAtomId}}),Object.defineProperty(e,"taggedOptAtomId",{enumerable:!0,get:function(){return n.taggedOptAtomId}}),Object.defineProperty(e,"offsetChangeAtomId",{enumerable:!0,get:function(){return n.offsetChangeAtomId}}),Object.defineProperty(e,"StableIdSchema",{enumerable:!0,get:function(){return n.StableIdSchema}}),Object.defineProperty(e,"subtractChangeAtomIds",{enumerable:!0,get:function(){return n.subtractChangeAtomIds}}),Object.defineProperty(e,"replaceAtomRevisions",{enumerable:!0,get:function(){return n.replaceAtomRevisions}}),Object.defineProperty(e,"newChangeAtomIdRangeMap",{enumerable:!0,get:function(){return n.newChangeAtomIdRangeMap}}),Object.defineProperty(e,"compareRevisions",{enumerable:!0,get:function(){return n.compareRevisions}});var a=Sve();Object.defineProperty(e,"RevisionTagCodec",{enumerable:!0,get:function(){return a.RevisionTagCodec}});var t=sae();Object.defineProperty(e,"FinalChangeStatus",{enumerable:!0,get:function(){return t.FinalChangeStatus}}),Object.defineProperty(e,"makeAnonChange",{enumerable:!0,get:function(){return t.makeAnonChange}}),Object.defineProperty(e,"tagChange",{enumerable:!0,get:function(){return t.tagChange}}),Object.defineProperty(e,"mapTaggedChange",{enumerable:!0,get:function(){return t.mapTaggedChange}}),Object.defineProperty(e,"tagRollbackInverse",{enumerable:!0,get:function(){return t.tagRollbackInverse}});var i=Cve();Object.defineProperty(e,"findAncestor",{enumerable:!0,get:function(){return i.findAncestor}}),Object.defineProperty(e,"findCommonAncestor",{enumerable:!0,get:function(){return i.findCommonAncestor}}),Object.defineProperty(e,"rebaseBranch",{enumerable:!0,get:function(){return i.rebaseBranch}}),Object.defineProperty(e,"rebaseChange",{enumerable:!0,get:function(){return i.rebaseChange}}),Object.defineProperty(e,"rebaseChangeOverChanges",{enumerable:!0,get:function(){return i.rebaseChangeOverChanges}}),Object.defineProperty(e,"revisionMetadataSourceFromInfo",{enumerable:!0,get:function(){return i.revisionMetadataSourceFromInfo}}),Object.defineProperty(e,"replaceChange",{enumerable:!0,get:function(){return i.replaceChange}}),Object.defineProperty(e,"isAncestor",{enumerable:!0,get:function(){return i.isAncestor}})})(uM)),uM}var VK;function aae(){return VK||(VK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.FormatV1=e.version1=void 0;const n=fq(),a=HE();e.version1=1,e.FormatV1=(0,n.Format)(e.version1,a.RevisionTagSchema)})(oM)),oM}var dM={},HK;function oae(){return HK||(HK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.FormatV2=e.StableOrFinalRevisionTag=e.version2=void 0;const n=Nr(),a=fq(),t=HE();e.version2=2,e.StableOrFinalRevisionTag=n.Type.Union([t.RevisionTagSchema,t.StableIdSchema]),e.FormatV2=(0,a.Format)(e.version2,e.StableOrFinalRevisionTag)})(dM)),dM}var jS={},MS={},KK;function cae(){if(KK)return MS;KK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(MS,"__esModule",{value:!0}),MS.makeDetachedFieldIndexCodecFromMajorCodec=void 0;const e=zn(),n=Bt(),a=fq();function t(i,r,s,o){const u=(0,a.Format)(s,o);return(0,e.makeVersionedValidatedCodec)(i,new Set([s]),u,{encode:c=>{const d=[];for(const[f,b]of c.data){const C=r.encode(f),v=[];for(const[m,h]of b)v.push([m,h.root]);if((0,n.hasSingle)(v)){const m=v[0],h=[C,m[0],m[1]];d.push(h)}else{const m=[C,v];d.push(m)}}return{version:s,data:d,maxId:c.maxId}},decode:c=>{const d=new Map;for(const l of c.data){const f=new Map;if(l.length===2)for(const[C,v]of l[1])f.set(C,{root:v});else f.set(l[1],{root:l[2]});const b=l[0];d.set(r.decode(b),f)}return{data:d,maxId:c.maxId}}})}return MS.makeDetachedFieldIndexCodecFromMajorCodec=t,MS}var $K;function _ve(){if($K)return jS;$K=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(jS,"__esModule",{value:!0}),jS.makeDetachedNodeToFieldCodecV1=void 0;const e=Je(),n=HE(),a=aae(),t=cae();class i{constructor(o,u,c){this.revisionTagCodec=o,this.options=u,this.idCompressor=c}encode(o){(0,e.assert)(o!==void 0,2190);const u=this.revisionTagCodec.encode(o);return(0,e.assert)(u==="root"||u>=0,2191),u}decode(o){return(0,e.assert)(o==="root"||o>=0,2192),this.revisionTagCodec.decode(o,{originatorId:this.revisionTagCodec.localSessionId,idCompressor:this.idCompressor,revision:void 0})}}function r(s,o,u){const c=new i(s,o,u);return(0,t.makeDetachedFieldIndexCodecFromMajorCodec)(o,c,a.version1,n.RevisionTagSchema)}return jS.makeDetachedNodeToFieldCodecV1=r,jS}var NS={},GK;function Tve(){if(GK)return NS;GK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(NS,"__esModule",{value:!0}),NS.makeDetachedNodeToFieldCodecV2=void 0;const e=Je(),n=oae(),a=cae(),t=fl();class i{constructor(o,u,c){this.revisionTagCodec=o,this.options=u,this.idCompressor=c}encode(o){(0,e.assert)(o!==void 0,3067);const u=this.revisionTagCodec.encode(o);return u!=="root"&&u<0?((0,e.assert)(o!=="root",3068),this.idCompressor.decompress(o)):u}decode(o){return(0,e.assert)(o==="root"||typeof o=="string"&&(0,t.isStableId)(o)||o>=0,3069),typeof o=="string"&&(0,t.isStableId)(o)?this.idCompressor.recompress(o):this.revisionTagCodec.decode(o,{originatorId:this.revisionTagCodec.localSessionId,idCompressor:this.idCompressor,revision:void 0})}}function r(s,o,u){const c=new i(s,o,u);return(0,a.makeDetachedFieldIndexCodecFromMajorCodec)(o,c,n.version2,n.StableOrFinalRevisionTag)}return NS.makeDetachedNodeToFieldCodecV2=r,NS}var WK;function wve(){if(WK)return Pm;WK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Pm,"__esModule",{value:!0}),Pm.makeDetachedFieldIndexCodecFamily=Pm.makeDetachedFieldIndexCodec=void 0;const e=zn(),n=aae(),a=oae(),t=_ve(),i=Tve();function r(o,u,c){const d=s(o,u,c),l=u.oldestCompatibleClient<e.FluidClientVersion.v2_52?n.version1:a.version2;return(0,e.makeVersionDispatchingCodec)(d,{...u,writeVersion:l})}Pm.makeDetachedFieldIndexCodec=r;function s(o,u,c){return(0,e.makeCodecFamily)([[n.version1,(0,t.makeDetachedNodeToFieldCodecV1)(o,u,c)],[a.version2,(0,i.makeDetachedNodeToFieldCodecV2)(o,u,c)]])}return Pm.makeDetachedFieldIndexCodecFamily=s,Pm}var JK;function uae(){if(JK)return RS;JK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(RS,"__esModule",{value:!0}),RS.DetachedFieldIndex=void 0;const e=Je(),n=zn(),a=Bt(),t=wve();class i{constructor(s,o,u,c,d){this.name=s,this.rootIdAllocator=o,this.revisionTagCodec=u,this.idCompressor=c,this.detachedNodeToField=new Map,this.latestRelevantRevisionToFields=new Map,this.isFullyLoaded=!0,this.options=d??{jsonValidator:n.noopValidator,oldestCompatibleClient:n.FluidClientVersion.v2_0},this.codec=(0,t.makeDetachedFieldIndexCodec)(u,this.options,c)}clone(){const s=new i(this.name,(0,a.idAllocatorFromMaxId)(this.rootIdAllocator.getMaxId()),this.revisionTagCodec,this.idCompressor,this.options);return(0,a.populateNestedMap)(this.detachedNodeToField,s.detachedNodeToField,!0),(0,a.populateNestedMap)(this.latestRelevantRevisionToFields,s.latestRelevantRevisionToFields,!0),s}*entries(){for(const[s,o]of this.detachedNodeToField)if(s!==void 0)for(const[u,{root:c,latestRelevantRevision:d}]of o)yield d!==void 0?{id:{major:s,minor:u},root:c,latestRelevantRevision:d}:{id:{major:s,minor:u},root:c};else for(const[u,{root:c,latestRelevantRevision:d}]of o)yield d!==void 0?{id:{minor:u},root:c,latestRelevantRevision:d}:{id:{minor:u},root:c}}purge(){this.detachedNodeToField.clear(),this.latestRelevantRevisionToFields.clear()}updateMajor(s,o){{const u=this.latestRelevantRevisionToFields.get(s);if(u!==void 0){for(const d of u.values()){const l=(0,a.tryGetFromNestedMap)(this.detachedNodeToField,d.major,d.minor);(0,e.assert)(l!==void 0,2488),(0,a.setInNestedMap)(this.detachedNodeToField,d.major,d.minor,{...l,latestRelevantRevision:o})}this.latestRelevantRevisionToFields.delete(s);const c=this.latestRelevantRevisionToFields.get(o);if(c!==void 0)for(const[d,l]of u)c.set(d,l);else this.latestRelevantRevisionToFields.set(o,u)}}{const u=this.detachedNodeToField.get(s);if(u!==void 0){this.detachedNodeToField.delete(s);const c=this.detachedNodeToField.get(o);if(c===void 0)this.detachedNodeToField.set(o,u);else for(const[d,l]of u)(0,e.assert)(c.get(d)===void 0,1961),c.set(d,l);for(const[d,l]of u){const f=this.latestRelevantRevisionToFields.get(l.latestRelevantRevision);(0,e.assert)(f!==void 0,2489),f.set(l.root,{major:o,minor:d})}}}}toFieldKey(s){return(0,a.brand)(`${this.name}-${s}`)}tryGetEntry(s){return(0,a.tryGetFromNestedMap)(this.detachedNodeToField,s.major,s.minor)?.root}getEntry(s){const o=this.tryGetEntry(s);return(0,e.assert)(o!==void 0,1962),o}*getRootsLastTouchedByRevision(s){const o=this.latestRelevantRevisionToFields.get(s);o!==void 0&&(yield*o.keys())}deleteRootsLastTouchedByRevision(s){const o=this.latestRelevantRevisionToFields.get(s);if(o!==void 0){this.latestRelevantRevisionToFields.delete(s);for(const u of o.values()){const c=(0,a.deleteFromNestedMap)(this.detachedNodeToField,u.major,u.minor);(0,e.assert)(c,2490)}}}deleteEntry(s){const o=(0,a.tryGetFromNestedMap)(this.detachedNodeToField,s.major,s.minor);(0,e.assert)(o!==void 0,2491),(0,a.deleteFromNestedMap)(this.detachedNodeToField,s.major,s.minor),(0,a.deleteFromNestedMap)(this.latestRelevantRevisionToFields,o.latestRelevantRevision,o.root)}createEntry(s,o,u=1){const c=this.rootIdAllocator.allocate(u);if(s!==void 0)for(let d=0;d<u;d++)(0,e.assert)((0,a.tryGetFromNestedMap)(this.detachedNodeToField,s.major,s.minor+d)===void 0,1998),(0,a.setInNestedMap)(this.detachedNodeToField,s.major,s.minor+d,{root:(0,a.brand)(c+d),latestRelevantRevision:o}),(0,a.setInNestedMap)(this.latestRelevantRevisionToFields,o,c,s);return c}updateLatestRevision(s,o){const u=(0,a.tryGetFromNestedMap)(this.detachedNodeToField,s.major,s.minor);(0,e.assert)(u!==void 0,2492);const{root:c,latestRelevantRevision:d}=u;(0,a.deleteFromNestedMap)(this.latestRelevantRevisionToFields,d,c),(0,a.setInNestedMap)(this.latestRelevantRevisionToFields,o,c,s),(0,a.setInNestedMap)(this.detachedNodeToField,s.major,s.minor,{root:c,latestRelevantRevision:o})}encode(){return this.codec.encode({data:this.detachedNodeToField,maxId:this.rootIdAllocator.getMaxId()})}loadData(s){const o=this.codec.decode(s);this.rootIdAllocator=(0,a.idAllocatorFromMaxId)(o.maxId),this.detachedNodeToField=new Map,this.latestRelevantRevisionToFields=new Map,this.isFullyLoaded=!1;const u=new Map;(0,a.forEachInNestedMap)(o.data,({root:c},d,l)=>{(0,a.setInNestedMap)(this.detachedNodeToField,d,l,{root:c}),u.set(c,{major:d,minor:l})}),this.latestRelevantRevisionToFields.set(void 0,u)}setRevisionsForLoadedData(s){(0,e.assert)(!this.isFullyLoaded,2493);const o=new Map,u=new Map;(0,a.forEachInNestedMap)(this.detachedNodeToField,({root:c},d,l)=>{(0,a.setInNestedMap)(o,d,l,{root:c,latestRelevantRevision:s}),u.set(c,{major:d,minor:l})}),this.detachedNodeToField=o,this.latestRelevantRevisionToFields.delete(void 0),this.latestRelevantRevisionToFields.set(s,u),this.isFullyLoaded=!0}}return RS.DetachedFieldIndex=i,RS}var QK;function Ove(){if(QK)return ba;QK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ba,"__esModule",{value:!0}),ba.createAnnouncedVisitor=ba.combineVisitors=ba.announceDelta=ba.applyDelta=ba.makeDetachedFieldIndex=void 0;const e=Bt(),n=uae(),a=rae();function t(u="Temp",c,d,l){return new n.DetachedFieldIndex(u,(0,e.idAllocatorFromMaxId)(),c,d,l)}ba.makeDetachedFieldIndex=t;function i(u,c,d,l){const f=d.acquireVisitor();(0,a.visitDelta)(u,f,l,c),f.free()}ba.applyDelta=i;function r(u,c,d,l){const f=d.acquireVisitor();(0,a.visitDelta)(u,s([f]),l,c),f.free()}ba.announceDelta=r;function s(u){const c=u.flatMap(l=>l.type==="Combined"?l.visitors:[l]),d=c.filter(l=>l.type==="Announced");return{type:"Combined",visitors:c,free:()=>u.forEach(l=>l.free()),create:(...l)=>{c.forEach(f=>f.create(...l)),d.forEach(f=>f.afterCreate(...l))},destroy:(...l)=>{d.forEach(f=>f.beforeDestroy(...l)),c.forEach(f=>f.destroy(...l))},attach:(l,f,b)=>{d.forEach(C=>C.beforeAttach(l,f,b)),c.forEach(C=>C.attach(l,f,b)),d.forEach(C=>C.afterAttach(l,{start:b,end:b+f}))},detach:(l,f,b,C)=>{d.forEach(v=>v.beforeDetach(l,f,C)),c.forEach(v=>v.detach(l,f,b,C)),d.forEach(v=>v.afterDetach(l.start,l.end-l.start,f,C))},enterNode:(...l)=>c.forEach(f=>f.enterNode(...l)),exitNode:(...l)=>c.forEach(f=>f.exitNode(...l)),enterField:(...l)=>c.forEach(f=>f.enterField(...l)),exitField:(...l)=>c.forEach(f=>f.exitField(...l))}}ba.combineVisitors=s;function o(u){const c=()=>{};return{type:"Announced",free:u.free??c,create:u.create??c,afterCreate:u.afterCreate??c,beforeDestroy:u.beforeDestroy??c,destroy:u.destroy??c,beforeAttach:u.beforeAttach??c,attach:u.attach??c,afterAttach:u.afterAttach??c,beforeDetach:u.beforeDetach??c,detach:u.detach??c,afterDetach:u.afterDetach??c,enterNode:u.enterNode??c,exitNode:u.exitNode??c,enterField:u.enterField??c,exitField:u.exitField??c}}return ba.createAnnouncedVisitor=o,ba}var Em={},YK;function Pve(){if(YK)return Em;YK=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Em,"__esModule",{value:!0}),Em.getDescendant=Em.SparseNode=void 0;const e=Je(),n=dq();class a{constructor(r,s,o,u){this.parentField=r,this.parentIndex=s,this.parentPath=o,this.data=u,this.children=new Map}isRoot(){return this.parentPath===void 0}get parent(){if((0,e.assert)(this.parentPath!==void 0,1188),!this.parentPath.isRoot())return this.parentPath}getOrCreateChild(r,s,o){let u=this.children.get(r);u===void 0&&(u=[],this.children.set(r,u));let c=u.find(d=>d.parentIndex===s);return c===void 0&&(c=new a(r,s,this,o()),u.push(c),u.sort((d,l)=>d.parentIndex-l.parentIndex)),c}tryGetChild(r,s){const o=this.children.get(r);if(o!==void 0)return o.find(u=>u.parentIndex===s)}removeChild(r){const s=r.parentField,o=this.children.get(s),u=o?.indexOf(r)??-1;(0,e.assert)(u!==-1,1189),o?.splice(u,1),o?.length===0&&this.afterEmptyField(s)}afterEmptyField(r){this.children.delete(r),this.children.size===0&&this.disposeThis()}disposeThis(){this.parentPath?.removeChild(this)}}Em.SparseNode=a;function t(i,r){const s=(0,n.topDownPath)(r);let o=i;for(const u of s){const c=o.children.get(u.parentField);(0,e.assert)(c!==void 0,1190);const d=c.find(l=>l.parentIndex===u.parentIndex);(0,e.assert)(d!==void 0,1191),o=d}return o}return Em.getDescendant=t,Em}var lM={},XK;function Eve(){return XK||(XK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.tryGetChunk=e.cursorChunk=e.dummyRoot=void 0;const n=Je(),a=ST();e.dummyRoot=a.rootFieldKey,e.cursorChunk=Symbol("cursorChunk");function t(i){return(0,n.assert)(i.mode===0,1403),i[e.cursorChunk]}e.tryGetChunk=t})(lM)),lM}var ZK;function dae(){return ZK||(ZK=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.DetachedFieldIndex=e.tryGetChunk=e.cursorChunk=e.dummyRoot=e.emptyDelta=e.offsetDetachId=e.makeDetachedNodeId=e.deltaForRootInitialization=e.getDescendant=e.SparseNode=e.makeDetachedFieldIndex=e.combineVisitors=e.createAnnouncedVisitor=e.applyDelta=e.announceDelta=e.visitDelta=e.aboveRootPlaceholder=e.rootField=e.rootFieldKey=e.keyAsDetachedField=e.detachedFieldAsKey=e.EmptyKey=e.EncodedJsonableTree=e.setGenericTreeField=e.getGenericTreeField=e.genericTreeKeys=e.genericTreeDeleteIfEmpty=e.getDetachedFieldContainingPath=e.isDetachedUpPath=e.compareFieldUpPaths=e.compareUpPaths=e.getDepth=e.topDownPath=e.clonePath=e.deepCopyMapTree=e.isCursor=e.CursorMarker=e.inCursorNode=e.inCursorField=e.iterateCursorField=e.forEachField=e.forEachNodeInSubtree=e.forEachNode=e.mapCursorFields=e.mapCursorField=e.castCursorToSynchronous=e.CursorLocationType=e.anchorSlot=e.AnchorSet=void 0;var n=dve();Object.defineProperty(e,"AnchorSet",{enumerable:!0,get:function(){return n.AnchorSet}}),Object.defineProperty(e,"anchorSlot",{enumerable:!0,get:function(){return n.anchorSlot}});var a=Qse();Object.defineProperty(e,"CursorLocationType",{enumerable:!0,get:function(){return a.CursorLocationType}}),Object.defineProperty(e,"castCursorToSynchronous",{enumerable:!0,get:function(){return a.castCursorToSynchronous}}),Object.defineProperty(e,"mapCursorField",{enumerable:!0,get:function(){return a.mapCursorField}}),Object.defineProperty(e,"mapCursorFields",{enumerable:!0,get:function(){return a.mapCursorFields}}),Object.defineProperty(e,"forEachNode",{enumerable:!0,get:function(){return a.forEachNode}}),Object.defineProperty(e,"forEachNodeInSubtree",{enumerable:!0,get:function(){return a.forEachNodeInSubtree}}),Object.defineProperty(e,"forEachField",{enumerable:!0,get:function(){return a.forEachField}}),Object.defineProperty(e,"iterateCursorField",{enumerable:!0,get:function(){return a.iterateCursorField}}),Object.defineProperty(e,"inCursorField",{enumerable:!0,get:function(){return a.inCursorField}}),Object.defineProperty(e,"inCursorNode",{enumerable:!0,get:function(){return a.inCursorNode}}),Object.defineProperty(e,"CursorMarker",{enumerable:!0,get:function(){return a.CursorMarker}}),Object.defineProperty(e,"isCursor",{enumerable:!0,get:function(){return a.isCursor}});var t=lve();Object.defineProperty(e,"deepCopyMapTree",{enumerable:!0,get:function(){return t.deepCopyMapTree}});var i=dq();Object.defineProperty(e,"clonePath",{enumerable:!0,get:function(){return i.clonePath}}),Object.defineProperty(e,"topDownPath",{enumerable:!0,get:function(){return i.topDownPath}}),Object.defineProperty(e,"getDepth",{enumerable:!0,get:function(){return i.getDepth}}),Object.defineProperty(e,"compareUpPaths",{enumerable:!0,get:function(){return i.compareUpPaths}}),Object.defineProperty(e,"compareFieldUpPaths",{enumerable:!0,get:function(){return i.compareFieldUpPaths}}),Object.defineProperty(e,"isDetachedUpPath",{enumerable:!0,get:function(){return i.isDetachedUpPathRoot}}),Object.defineProperty(e,"getDetachedFieldContainingPath",{enumerable:!0,get:function(){return i.getDetachedFieldContainingPath}});var r=fve();Object.defineProperty(e,"genericTreeDeleteIfEmpty",{enumerable:!0,get:function(){return r.genericTreeDeleteIfEmpty}}),Object.defineProperty(e,"genericTreeKeys",{enumerable:!0,get:function(){return r.genericTreeKeys}}),Object.defineProperty(e,"getGenericTreeField",{enumerable:!0,get:function(){return r.getGenericTreeField}}),Object.defineProperty(e,"setGenericTreeField",{enumerable:!0,get:function(){return r.setGenericTreeField}});var s=vve();Object.defineProperty(e,"EncodedJsonableTree",{enumerable:!0,get:function(){return s.EncodedJsonableTree}});var o=ST();Object.defineProperty(e,"EmptyKey",{enumerable:!0,get:function(){return o.EmptyKey}}),Object.defineProperty(e,"detachedFieldAsKey",{enumerable:!0,get:function(){return o.detachedFieldAsKey}}),Object.defineProperty(e,"keyAsDetachedField",{enumerable:!0,get:function(){return o.keyAsDetachedField}}),Object.defineProperty(e,"rootFieldKey",{enumerable:!0,get:function(){return o.rootFieldKey}}),Object.defineProperty(e,"rootField",{enumerable:!0,get:function(){return o.rootField}}),Object.defineProperty(e,"aboveRootPlaceholder",{enumerable:!0,get:function(){return o.aboveRootPlaceholder}});var u=rae();Object.defineProperty(e,"visitDelta",{enumerable:!0,get:function(){return u.visitDelta}});var c=Ove();Object.defineProperty(e,"announceDelta",{enumerable:!0,get:function(){return c.announceDelta}}),Object.defineProperty(e,"applyDelta",{enumerable:!0,get:function(){return c.applyDelta}}),Object.defineProperty(e,"createAnnouncedVisitor",{enumerable:!0,get:function(){return c.createAnnouncedVisitor}}),Object.defineProperty(e,"combineVisitors",{enumerable:!0,get:function(){return c.combineVisitors}}),Object.defineProperty(e,"makeDetachedFieldIndex",{enumerable:!0,get:function(){return c.makeDetachedFieldIndex}});var d=Pve();Object.defineProperty(e,"SparseNode",{enumerable:!0,get:function(){return d.SparseNode}}),Object.defineProperty(e,"getDescendant",{enumerable:!0,get:function(){return d.getDescendant}});var l=uq();Object.defineProperty(e,"deltaForRootInitialization",{enumerable:!0,get:function(){return l.deltaForRootInitialization}}),Object.defineProperty(e,"makeDetachedNodeId",{enumerable:!0,get:function(){return l.makeDetachedNodeId}}),Object.defineProperty(e,"offsetDetachId",{enumerable:!0,get:function(){return l.offsetDetachId}}),Object.defineProperty(e,"emptyDelta",{enumerable:!0,get:function(){return l.emptyDelta}});var f=Eve();Object.defineProperty(e,"dummyRoot",{enumerable:!0,get:function(){return f.dummyRoot}}),Object.defineProperty(e,"cursorChunk",{enumerable:!0,get:function(){return f.cursorChunk}}),Object.defineProperty(e,"tryGetChunk",{enumerable:!0,get:function(){return f.tryGetChunk}});var b=uae();Object.defineProperty(e,"DetachedFieldIndex",{enumerable:!0,get:function(){return b.DetachedFieldIndex}})})(Hj)),Hj}var fM={},AS={},e$;function Ive(){if(e$)return AS;e$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(AS,"__esModule",{value:!0}),AS.isFieldLocation=void 0;function e(n){return typeof n=="object"}return AS.isFieldLocation=e,AS}var go={},t$;function Rve(){if(t$)return go;t$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(go,"__esModule",{value:!0}),go.TreeNavigationResult=go.ITreeSubscriptionCursorState=go.moveToDetachedField=go.rootAnchor=void 0;const e=Je(),n=dae();function a(s=n.rootField){return{parent:void 0,fieldKey:(0,n.detachedFieldAsKey)(s)}}go.rootAnchor=a;function t(s,o,u=n.rootField){const c=s.tryMoveCursorToField(a(u),o);(0,e.assert)(c===1,1069)}go.moveToDetachedField=t;var i;(function(s){s[s.Current=0]="Current",s[s.Cleared=1]="Cleared",s[s.Freed=2]="Freed"})(i||(go.ITreeSubscriptionCursorState=i={}));var r;return(function(s){s[s.NotFound=-1]="NotFound",s[s.Pending=0]="Pending",s[s.Ok=1]="Ok"})(r||(go.TreeNavigationResult=r={})),go}var n$;function Fve(){return n$||(n$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.moveToDetachedField=e.TreeNavigationResult=e.ITreeSubscriptionCursorState=e.isFieldLocation=void 0;var n=Ive();Object.defineProperty(e,"isFieldLocation",{enumerable:!0,get:function(){return n.isFieldLocation}});var a=Rve();Object.defineProperty(e,"ITreeSubscriptionCursorState",{enumerable:!0,get:function(){return a.ITreeSubscriptionCursorState}}),Object.defineProperty(e,"TreeNavigationResult",{enumerable:!0,get:function(){return a.TreeNavigationResult}}),Object.defineProperty(e,"moveToDetachedField",{enumerable:!0,get:function(){return a.moveToDetachedField}})})(fM)),fM}var hM={},DS={},r$;function jve(){if(r$)return DS;r$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(DS,"__esModule",{value:!0}),DS.EditBuilder=void 0;class e{constructor(a,t){this.changeFamily=a,this.changeReceiver=t}applyChange(a){this.changeReceiver(a)}enterTransaction(){}exitTransaction(){}}return DS.EditBuilder=e,DS}var i$;function Mve(){return i$||(i$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EditBuilder=void 0;var n=jve();Object.defineProperty(e,"EditBuilder",{enumerable:!0,get:function(){return n.EditBuilder}})})(hM)),hM}var mM={},kS={},s$;function Nve(){if(s$)return kS;s$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(kS,"__esModule",{value:!0}),kS.AdaptedViewSchema=void 0;class e{constructor(a,t){this.adapters=a,this.adaptedForViewSchema=t}}return kS.AdaptedViewSchema=e,kS}var a$;function Ave(){return a$||(a$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.AdaptedViewSchema=void 0;var n=Nve();Object.defineProperty(e,"AdaptedViewSchema",{enumerable:!0,get:function(){return n.AdaptedViewSchema}})})(mM)),mM}var xS={},o$;function Dve(){if(o$)return xS;o$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(xS,"__esModule",{value:!0}),xS.RevertibleStatus=void 0;var e;return(function(n){n[n.Valid=0]="Valid",n[n.Disposed=1]="Disposed"})(e||(xS.RevertibleStatus=e={})),xS}var c$;function Vt(){return c$||(c$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TreeNavigationResult=e.tryGetChunk=e.cursorChunk=e.dummyRoot=e.deepCopyMapTree=e.aboveRootPlaceholder=e.getDetachedFieldContainingPath=e.DetachedFieldIndex=e.isCursor=e.CursorMarker=e.inCursorNode=e.inCursorField=e.isDetachedUpPath=e.anchorSlot=e.emptyDelta=e.offsetDetachId=e.makeDetachedNodeId=e.deltaForRootInitialization=e.forEachField=e.forEachNodeInSubtree=e.forEachNode=e.compareFieldUpPaths=e.topDownPath=e.clonePath=e.compareUpPaths=e.getDescendant=e.SparseNode=e.setGenericTreeField=e.makeDetachedFieldIndex=e.applyDelta=e.announceDelta=e.combineVisitors=e.createAnnouncedVisitor=e.visitDelta=e.keyAsDetachedField=e.detachedFieldAsKey=e.iterateCursorField=e.mapCursorFields=e.mapCursorField=e.getDepth=e.genericTreeDeleteIfEmpty=e.getGenericTreeField=e.genericTreeKeys=e.castCursorToSynchronous=e.CursorLocationType=e.rootField=e.rootFieldKey=e.EncodedJsonableTree=e.AnchorSet=e.EmptyKey=void 0,e.compareRevisions=e.newChangeAtomIdRangeMap=e.isAncestor=e.replaceChange=e.replaceAtomRevisions=e.subtractChangeAtomIds=e.StableIdSchema=e.offsetChangeAtomId=e.taggedOptAtomId=e.taggedAtomId=e.revisionMetadataSourceFromInfo=e.rebaseChangeOverChanges=e.rebaseChange=e.rebaseBranch=e.mintCommit=e.SessionIdSchema=e.tagRollbackInverse=e.mapTaggedChange=e.tagChange=e.makeAnonChange=e.RevisionTagCodec=e.RevisionTagSchema=e.CommitKind=e.findCommonAncestor=e.findAncestor=e.asChangeAtomId=e.makeChangeAtomId=e.areEqualChangeAtomIdOpts=e.areEqualChangeAtomIds=e.EditBuilder=e.SchemaVersion=e.Multiplicity=e.storedSchemaDecodeDispatcher=e.encodeFieldSchemaV2=e.encodeFieldSchemaV1=e.decodeFieldSchema=e.MapNodeStoredSchema=e.ObjectNodeStoredSchema=e.LeafNodeStoredSchema=e.schemaFormatV2=e.schemaFormatV1=e.storedEmptyFieldSchema=e.identifierFieldKindIdentifier=e.forbiddenFieldKindIdentifier=e.schemaDataIsEmpty=e.TreeStoredSchemaRepository=e.TreeNodeStoredSchema=e.ValueSchema=e.moveToDetachedField=e.ITreeSubscriptionCursorState=void 0,e.RevertibleStatus=e.AdaptedViewSchema=void 0;var n=dae();Object.defineProperty(e,"EmptyKey",{enumerable:!0,get:function(){return n.EmptyKey}}),Object.defineProperty(e,"AnchorSet",{enumerable:!0,get:function(){return n.AnchorSet}}),Object.defineProperty(e,"EncodedJsonableTree",{enumerable:!0,get:function(){return n.EncodedJsonableTree}}),Object.defineProperty(e,"rootFieldKey",{enumerable:!0,get:function(){return n.rootFieldKey}}),Object.defineProperty(e,"rootField",{enumerable:!0,get:function(){return n.rootField}}),Object.defineProperty(e,"CursorLocationType",{enumerable:!0,get:function(){return n.CursorLocationType}}),Object.defineProperty(e,"castCursorToSynchronous",{enumerable:!0,get:function(){return n.castCursorToSynchronous}}),Object.defineProperty(e,"genericTreeKeys",{enumerable:!0,get:function(){return n.genericTreeKeys}}),Object.defineProperty(e,"getGenericTreeField",{enumerable:!0,get:function(){return n.getGenericTreeField}}),Object.defineProperty(e,"genericTreeDeleteIfEmpty",{enumerable:!0,get:function(){return n.genericTreeDeleteIfEmpty}}),Object.defineProperty(e,"getDepth",{enumerable:!0,get:function(){return n.getDepth}}),Object.defineProperty(e,"mapCursorField",{enumerable:!0,get:function(){return n.mapCursorField}}),Object.defineProperty(e,"mapCursorFields",{enumerable:!0,get:function(){return n.mapCursorFields}}),Object.defineProperty(e,"iterateCursorField",{enumerable:!0,get:function(){return n.iterateCursorField}}),Object.defineProperty(e,"detachedFieldAsKey",{enumerable:!0,get:function(){return n.detachedFieldAsKey}}),Object.defineProperty(e,"keyAsDetachedField",{enumerable:!0,get:function(){return n.keyAsDetachedField}}),Object.defineProperty(e,"visitDelta",{enumerable:!0,get:function(){return n.visitDelta}}),Object.defineProperty(e,"createAnnouncedVisitor",{enumerable:!0,get:function(){return n.createAnnouncedVisitor}}),Object.defineProperty(e,"combineVisitors",{enumerable:!0,get:function(){return n.combineVisitors}}),Object.defineProperty(e,"announceDelta",{enumerable:!0,get:function(){return n.announceDelta}}),Object.defineProperty(e,"applyDelta",{enumerable:!0,get:function(){return n.applyDelta}}),Object.defineProperty(e,"makeDetachedFieldIndex",{enumerable:!0,get:function(){return n.makeDetachedFieldIndex}}),Object.defineProperty(e,"setGenericTreeField",{enumerable:!0,get:function(){return n.setGenericTreeField}}),Object.defineProperty(e,"SparseNode",{enumerable:!0,get:function(){return n.SparseNode}}),Object.defineProperty(e,"getDescendant",{enumerable:!0,get:function(){return n.getDescendant}}),Object.defineProperty(e,"compareUpPaths",{enumerable:!0,get:function(){return n.compareUpPaths}}),Object.defineProperty(e,"clonePath",{enumerable:!0,get:function(){return n.clonePath}}),Object.defineProperty(e,"topDownPath",{enumerable:!0,get:function(){return n.topDownPath}}),Object.defineProperty(e,"compareFieldUpPaths",{enumerable:!0,get:function(){return n.compareFieldUpPaths}}),Object.defineProperty(e,"forEachNode",{enumerable:!0,get:function(){return n.forEachNode}}),Object.defineProperty(e,"forEachNodeInSubtree",{enumerable:!0,get:function(){return n.forEachNodeInSubtree}}),Object.defineProperty(e,"forEachField",{enumerable:!0,get:function(){return n.forEachField}}),Object.defineProperty(e,"deltaForRootInitialization",{enumerable:!0,get:function(){return n.deltaForRootInitialization}}),Object.defineProperty(e,"makeDetachedNodeId",{enumerable:!0,get:function(){return n.makeDetachedNodeId}}),Object.defineProperty(e,"offsetDetachId",{enumerable:!0,get:function(){return n.offsetDetachId}}),Object.defineProperty(e,"emptyDelta",{enumerable:!0,get:function(){return n.emptyDelta}}),Object.defineProperty(e,"anchorSlot",{enumerable:!0,get:function(){return n.anchorSlot}}),Object.defineProperty(e,"isDetachedUpPath",{enumerable:!0,get:function(){return n.isDetachedUpPath}}),Object.defineProperty(e,"inCursorField",{enumerable:!0,get:function(){return n.inCursorField}}),Object.defineProperty(e,"inCursorNode",{enumerable:!0,get:function(){return n.inCursorNode}}),Object.defineProperty(e,"CursorMarker",{enumerable:!0,get:function(){return n.CursorMarker}}),Object.defineProperty(e,"isCursor",{enumerable:!0,get:function(){return n.isCursor}}),Object.defineProperty(e,"DetachedFieldIndex",{enumerable:!0,get:function(){return n.DetachedFieldIndex}}),Object.defineProperty(e,"getDetachedFieldContainingPath",{enumerable:!0,get:function(){return n.getDetachedFieldContainingPath}}),Object.defineProperty(e,"aboveRootPlaceholder",{enumerable:!0,get:function(){return n.aboveRootPlaceholder}}),Object.defineProperty(e,"deepCopyMapTree",{enumerable:!0,get:function(){return n.deepCopyMapTree}}),Object.defineProperty(e,"dummyRoot",{enumerable:!0,get:function(){return n.dummyRoot}}),Object.defineProperty(e,"cursorChunk",{enumerable:!0,get:function(){return n.cursorChunk}}),Object.defineProperty(e,"tryGetChunk",{enumerable:!0,get:function(){return n.tryGetChunk}});var a=Fve();Object.defineProperty(e,"TreeNavigationResult",{enumerable:!0,get:function(){return a.TreeNavigationResult}}),Object.defineProperty(e,"ITreeSubscriptionCursorState",{enumerable:!0,get:function(){return a.ITreeSubscriptionCursorState}}),Object.defineProperty(e,"moveToDetachedField",{enumerable:!0,get:function(){return a.moveToDetachedField}});var t=nae();Object.defineProperty(e,"ValueSchema",{enumerable:!0,get:function(){return t.ValueSchema}}),Object.defineProperty(e,"TreeNodeStoredSchema",{enumerable:!0,get:function(){return t.TreeNodeStoredSchema}}),Object.defineProperty(e,"TreeStoredSchemaRepository",{enumerable:!0,get:function(){return t.TreeStoredSchemaRepository}}),Object.defineProperty(e,"schemaDataIsEmpty",{enumerable:!0,get:function(){return t.schemaDataIsEmpty}}),Object.defineProperty(e,"forbiddenFieldKindIdentifier",{enumerable:!0,get:function(){return t.forbiddenFieldKindIdentifier}}),Object.defineProperty(e,"identifierFieldKindIdentifier",{enumerable:!0,get:function(){return t.identifierFieldKindIdentifier}}),Object.defineProperty(e,"storedEmptyFieldSchema",{enumerable:!0,get:function(){return t.storedEmptyFieldSchema}}),Object.defineProperty(e,"schemaFormatV1",{enumerable:!0,get:function(){return t.schemaFormatV1}}),Object.defineProperty(e,"schemaFormatV2",{enumerable:!0,get:function(){return t.schemaFormatV2}}),Object.defineProperty(e,"LeafNodeStoredSchema",{enumerable:!0,get:function(){return t.LeafNodeStoredSchema}}),Object.defineProperty(e,"ObjectNodeStoredSchema",{enumerable:!0,get:function(){return t.ObjectNodeStoredSchema}}),Object.defineProperty(e,"MapNodeStoredSchema",{enumerable:!0,get:function(){return t.MapNodeStoredSchema}}),Object.defineProperty(e,"decodeFieldSchema",{enumerable:!0,get:function(){return t.decodeFieldSchema}}),Object.defineProperty(e,"encodeFieldSchemaV1",{enumerable:!0,get:function(){return t.encodeFieldSchemaV1}}),Object.defineProperty(e,"encodeFieldSchemaV2",{enumerable:!0,get:function(){return t.encodeFieldSchemaV2}}),Object.defineProperty(e,"storedSchemaDecodeDispatcher",{enumerable:!0,get:function(){return t.storedSchemaDecodeDispatcher}}),Object.defineProperty(e,"Multiplicity",{enumerable:!0,get:function(){return t.Multiplicity}}),Object.defineProperty(e,"SchemaVersion",{enumerable:!0,get:function(){return t.SchemaVersion}});var i=Mve();Object.defineProperty(e,"EditBuilder",{enumerable:!0,get:function(){return i.EditBuilder}});var r=HE();Object.defineProperty(e,"areEqualChangeAtomIds",{enumerable:!0,get:function(){return r.areEqualChangeAtomIds}}),Object.defineProperty(e,"areEqualChangeAtomIdOpts",{enumerable:!0,get:function(){return r.areEqualChangeAtomIdOpts}}),Object.defineProperty(e,"makeChangeAtomId",{enumerable:!0,get:function(){return r.makeChangeAtomId}}),Object.defineProperty(e,"asChangeAtomId",{enumerable:!0,get:function(){return r.asChangeAtomId}}),Object.defineProperty(e,"findAncestor",{enumerable:!0,get:function(){return r.findAncestor}}),Object.defineProperty(e,"findCommonAncestor",{enumerable:!0,get:function(){return r.findCommonAncestor}}),Object.defineProperty(e,"CommitKind",{enumerable:!0,get:function(){return r.CommitKind}}),Object.defineProperty(e,"RevisionTagSchema",{enumerable:!0,get:function(){return r.RevisionTagSchema}}),Object.defineProperty(e,"RevisionTagCodec",{enumerable:!0,get:function(){return r.RevisionTagCodec}}),Object.defineProperty(e,"makeAnonChange",{enumerable:!0,get:function(){return r.makeAnonChange}}),Object.defineProperty(e,"tagChange",{enumerable:!0,get:function(){return r.tagChange}}),Object.defineProperty(e,"mapTaggedChange",{enumerable:!0,get:function(){return r.mapTaggedChange}}),Object.defineProperty(e,"tagRollbackInverse",{enumerable:!0,get:function(){return r.tagRollbackInverse}}),Object.defineProperty(e,"SessionIdSchema",{enumerable:!0,get:function(){return r.SessionIdSchema}}),Object.defineProperty(e,"mintCommit",{enumerable:!0,get:function(){return r.mintCommit}}),Object.defineProperty(e,"rebaseBranch",{enumerable:!0,get:function(){return r.rebaseBranch}}),Object.defineProperty(e,"rebaseChange",{enumerable:!0,get:function(){return r.rebaseChange}}),Object.defineProperty(e,"rebaseChangeOverChanges",{enumerable:!0,get:function(){return r.rebaseChangeOverChanges}}),Object.defineProperty(e,"revisionMetadataSourceFromInfo",{enumerable:!0,get:function(){return r.revisionMetadataSourceFromInfo}}),Object.defineProperty(e,"taggedAtomId",{enumerable:!0,get:function(){return r.taggedAtomId}}),Object.defineProperty(e,"taggedOptAtomId",{enumerable:!0,get:function(){return r.taggedOptAtomId}}),Object.defineProperty(e,"offsetChangeAtomId",{enumerable:!0,get:function(){return r.offsetChangeAtomId}}),Object.defineProperty(e,"StableIdSchema",{enumerable:!0,get:function(){return r.StableIdSchema}}),Object.defineProperty(e,"subtractChangeAtomIds",{enumerable:!0,get:function(){return r.subtractChangeAtomIds}}),Object.defineProperty(e,"replaceAtomRevisions",{enumerable:!0,get:function(){return r.replaceAtomRevisions}}),Object.defineProperty(e,"replaceChange",{enumerable:!0,get:function(){return r.replaceChange}}),Object.defineProperty(e,"isAncestor",{enumerable:!0,get:function(){return r.isAncestor}}),Object.defineProperty(e,"newChangeAtomIdRangeMap",{enumerable:!0,get:function(){return r.newChangeAtomIdRangeMap}}),Object.defineProperty(e,"compareRevisions",{enumerable:!0,get:function(){return r.compareRevisions}});var s=Ave();Object.defineProperty(e,"AdaptedViewSchema",{enumerable:!0,get:function(){return s.AdaptedViewSchema}});var o=Dve();Object.defineProperty(e,"RevertibleStatus",{enumerable:!0,get:function(){return o.RevertibleStatus}})})(Vj)),Vj}var Ou={},qS={},u$;function kve(){if(u$)return qS;u$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qS,"__esModule",{value:!0}),qS.toDownPath=void 0;const e=Vt();function n(a){const i=(0,e.topDownPath)(a).map(r=>({field:r.parentField,index:r.parentIndex}));return i.shift(),i}return qS.toDownPath=n,qS}var yo={},d$;function ZP(){if(d$)return yo;d$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(yo,"__esModule",{value:!0}),yo.isTreeValue=yo.assertAllowedValue=yo.valueSchemaAllows=yo.allowsValue=void 0;const e=Je(),n=bn(),a=Vt();function t(o,u){return o===void 0?u===void 0:i(o,u)}yo.allowsValue=t;function i(o,u){switch(o){case a.ValueSchema.String:return typeof u=="string";case a.ValueSchema.Number:return typeof u=="number";case a.ValueSchema.Boolean:return typeof u=="boolean";case a.ValueSchema.FluidHandle:return(0,n.isFluidHandle)(u);case a.ValueSchema.Null:return u===null;default:(0,e.unreachableCase)(o)}}yo.valueSchemaAllows=i;function r(o){(0,e.assert)(s(o),2115)}yo.assertAllowedValue=r;function s(o){switch(typeof o){case"string":case"number":case"boolean":return!0;default:return o===null||(0,n.isFluidHandle)(o)}}return yo.isTreeValue=s,yo}var pM={},gM={},yM={},bM={},LS={},Im={},l$;function lae(){if(l$)return Im;l$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Im,"__esModule",{value:!0}),Im.isStableNodeIdentifier=Im.createNodeIdentifierManager=void 0;const e=Je(),n=fl(),a=Bt();function t(s){return new i(s)}Im.createNodeIdentifierManager=t;class i{constructor(o){this.idCompressor=o}generateLocalNodeIdentifier(){return(0,e.assert)(this.idCompressor!==void 0,1764),(0,a.brand)(this.idCompressor.generateCompressedId())}localizeNodeIdentifier(o){return(0,e.assert)(this.idCompressor!==void 0,1765),(0,a.brand)(this.idCompressor.recompress(o))}stabilizeNodeIdentifier(o){return(0,e.assert)(this.idCompressor!==void 0,1766),(0,a.brand)((0,n.assertIsStableId)(this.idCompressor.decompress((0,a.extractFromOpaque)(o))))}tryLocalizeNodeIdentifier(o){if((0,e.assert)(this.idCompressor!==void 0,1769),r(o)){const u=this.idCompressor.tryRecompress(o);if(u!==void 0)return(0,a.brand)(u)}}}function r(s){return(0,n.isStableId)(s)}return Im.isStableNodeIdentifier=r,Im}var f$;function xve(){if(f$)return LS;f$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(LS,"__esModule",{value:!0}),LS.MockNodeIdentifierManager=void 0;const e=Je(),n=fl(),a=Ot(),t=Bt(),i=lae();class r{constructor(){this.count=0}generateStableNodeIdentifier(){return(0,t.brand)(this.getId(this.count++))}generateLocalNodeIdentifier(){return this.localizeNodeIdentifier(this.generateStableNodeIdentifier())}localizeNodeIdentifier(o){return this.tryLocalizeNodeIdentifier(o)??(0,e.fail)(2854)}stabilizeNodeIdentifier(o){return(0,t.brand)(this.getId((0,t.extractFromOpaque)(o)))}tryLocalizeNodeIdentifier(o){if(!(0,i.isStableNodeIdentifier)(o)||!o.startsWith("a110ca7e-add1-4000-8000-"))return;const u=Number.parseInt(o.substring(24),16);return u<this.count?(0,t.brand)(u):void 0}getId(o){if((0,e.assert)(o<281474976710656,1768),o>=0&&o<this.count)return(0,n.assertIsStableId)(`a110ca7e-add1-4000-8000-${Math.round(o).toString(16).padStart(12,"0")}`);throw new a.UsageError("Local ID offset out of bounds")}}return LS.MockNodeIdentifierManager=r,LS}var Rm={},h$;function qve(){if(h$)return Rm;h$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.nodeKeyTreeIdentifier=Rm.compareLocalNodeIdentifiers=void 0;const e=Bt();function n(a,t){return a===t?0:a>t?1:-1}return Rm.compareLocalNodeIdentifiers=n,Rm.nodeKeyTreeIdentifier=(0,e.brand)("com.fluidframework.nodeIdentifier.NodeIdentifier"),Rm}var m$;function fae(){return m$||(m$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isStableNodeIdentifier=e.createNodeIdentifierManager=e.nodeKeyTreeIdentifier=e.compareLocalNodeIdentifiers=e.MockNodeIdentifierManager=void 0;var n=xve();Object.defineProperty(e,"MockNodeIdentifierManager",{enumerable:!0,get:function(){return n.MockNodeIdentifierManager}});var a=qve();Object.defineProperty(e,"compareLocalNodeIdentifiers",{enumerable:!0,get:function(){return a.compareLocalNodeIdentifiers}}),Object.defineProperty(e,"nodeKeyTreeIdentifier",{enumerable:!0,get:function(){return a.nodeKeyTreeIdentifier}});var t=lae();Object.defineProperty(e,"createNodeIdentifierManager",{enumerable:!0,get:function(){return t.createNodeIdentifierManager}}),Object.defineProperty(e,"isStableNodeIdentifier",{enumerable:!0,get:function(){return t.isStableNodeIdentifier}})})(bM)),bM}var Fm={},Wi={},p$;function Yg(){if(p$)return Wi;p$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e,n;Object.defineProperty(Wi,"__esModule",{value:!0}),Wi.PrefixedPath=Wi.prefixPathPrefix=Wi.prefixFieldPath=Wi.prefixPath=Wi.SynchronousCursor=Wi.stackTreeFieldCursor=Wi.stackTreeNodeCursor=void 0;const a=Je(),t=Ot(),i=Vt();function r(C,v){return new u(C,[],[],[v],0)}Wi.stackTreeNodeCursor=r;function s(C,v,m=i.rootField){const h=r(C,v);return h.enterField((0,i.detachedFieldAsKey)(m)),h}Wi.stackTreeFieldCursor=s;class o{constructor(){this[e]=!0,this.pending=!1}skipPendingFields(){return!0}}Wi.SynchronousCursor=o,e=i.CursorMarker;class u extends o{constructor(v,m,h,g,_){super(),this.adapter=v,this.siblingStack=m,this.indexStack=h,this.siblings=g,this.index=_,this[n]=!0,this.chunkLength=1}getFieldKey(){return(0,a.debugAssert)(()=>this.mode===1?!0:"must be in fields mode"),this.siblings[this.index]}getStackedFieldKey(v){(0,a.assert)(v%2===1,952);const m=this.siblingStack[v]??(0,a.oob)(),h=this.indexStack[v]??(0,a.oob)();return m[h]}getStackedNodeIndex(v){return this.indexStack[v]??(0,a.oob)()}getStackedNode(v){const m=this.getStackedNodeIndex(v);return this.siblingStack[v][m]}getFieldLength(){return this.getField().length}enterNode(v){const m=this.getField();if(!(v in m))throw new t.UsageError(`A child does not exist at index '${v}' in field containing ${m.length} nodes.`);this.siblingStack.push(this.siblings),this.indexStack.push(this.index),this.index=v,this.siblings=m}getPath(v){return(0,a.assert)(this.mode===0,953),this.getOffsetPath(0,v)}getFieldPath(v){return(0,a.assert)(this.mode===1,1097),{field:this.indexStack.length===1?v?.rootFieldOverride??this.getFieldKey():this.getFieldKey(),parent:this.getOffsetPath(1,v)}}getOffsetPath(v,m){const h=this.indexStack.length-v;if(h===0)return m?.parent;(0,a.assert)(h>0,1098),(0,a.assert)(h%2===0,1099);const g=S=>{let p=S===this.indexStack.length?this.index:this.getStackedNodeIndex(S);return m!==void 0&&S===2&&(p+=m.indexOffset??0),p};let _=m?.parent;for(let S=2;S<=h;S+=2){const p=S===2?m?.rootFieldOverride:void 0;_={parent:_,parentIndex:g(S),parentField:p??this.getStackedFieldKey(S-1)}}return _}fork(){return new u(this.adapter,[...this.siblingStack],[...this.indexStack],this.siblings,this.index)}enterField(v){this.siblingStack.push(this.siblings),this.indexStack.push(this.index),this.index=0,this.siblings=[v]}get mode(){return this.siblingStack.length%2===0?0:1}nextField(){return this.index+=1,this.index===this.siblings.length?(this.exitField(),!1):!0}firstField(){const v=this.adapter.keysFromNode(this.getNode());return v.length===0?!1:(this.siblingStack.push(this.siblings),this.indexStack.push(this.index),this.index=0,this.siblings=v,!0)}seekNodes(v){return this.index+=v,this.index in this.siblings?!0:(this.exitNode(),!1)}firstNode(){const v=this.getField();return v.length===0?!1:(this.siblingStack.push(this.siblings),this.indexStack.push(this.index),this.index=0,this.siblings=v,!0)}nextNode(){return(0,a.assert)(this.mode===0,1030),this.index++,this.index<this.siblings.length?!0:(this.exitNode(),!1)}exitField(){this.siblings=this.siblingStack.pop()??(0,a.fail)(2755),this.index=this.indexStack.pop()??(0,a.fail)(2756)}exitNode(){this.siblings=this.siblingStack.pop()??(0,a.fail)(2757),this.index=this.indexStack.pop()??(0,a.fail)(2758)}getNode(){return this.siblings[this.index]}getField(){const v=this.getStackedNode(this.indexStack.length-1),m=this.getFieldKey();return this.adapter.getFieldFromNode(v,m)}get value(){return this.adapter.value(this.getNode())}get type(){return this.adapter.type(this.getNode())}get fieldIndex(){return this.index}get chunkStart(){return this.fieldIndex}}n=i.CursorMarker;function c(C,v){return C===void 0||C.parent===void 0&&C.rootFieldOverride===void 0&&(C.indexOffset??0)===0?v:f(C,v)}Wi.prefixPath=c;function d(C,v){return C===void 0||C.parent===void 0&&C.rootFieldOverride===void 0&&(C.indexOffset??0)===0?v:{field:v.parent===void 0?C.rootFieldOverride??v.field:v.field,parent:c(C,v.parent)}}Wi.prefixFieldPath=d;function l(C,v){return v.parent!==void 0?{parent:new b(C,v.parent),rootFieldOverride:v.rootFieldOverride,indexOffset:v.indexOffset}:{parent:C.parent,rootFieldOverride:C.rootFieldOverride??v.rootFieldOverride,indexOffset:(v.indexOffset??0)+(C.indexOffset??0)}}Wi.prefixPathPrefix=l;function f(C,v){if(v===void 0)return C.parent;if(v instanceof b){const m=l(C,v.prefix);return new b(m,v.path)}else return new b(C,v)}class b{constructor(v,m){this.prefix=v,this.path=m,m.parent===void 0?(this.parentField=v.rootFieldOverride??m.parentField,this.parentIndex=m.parentIndex+(v.indexOffset??0)):(this.parentField=m.parentField,this.parentIndex=m.parentIndex)}get parent(){return f(this.prefix,this.path.parent)}}return Wi.PrefixedPath=b,Wi}var g$;function KE(){if(g$)return Fm;g$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Fm,"__esModule",{value:!0}),Fm.BasicChunkCursor=Fm.BasicChunk=void 0;const e=Je(),n=Vt(),a=Bt(),t=Yg();class i extends a.ReferenceCountedBase{constructor(o,u,c){super(),this.type=o,this.fields=u,this.value=c,this.topLevelLength=1}clone(){const o=new Map;for(const[u,c]of this.fields){const d=c.map(l=>(l.referenceAdded(),l));o.set(u,d)}return new i(this.type,o,this.value)}cursor(){return new r([this],[],[],[],[],[n.dummyRoot],0,0,0,void 0)}onUnreferenced(){for(const o of this.fields.values())for(const u of o)u.referenceRemoved()}}Fm.BasicChunk=i;class r extends t.SynchronousCursor{constructor(o,u,c,d,l,f,b,C,v,m){super(),this.root=o,this.siblingStack=u,this.indexStack=c,this.indexOfChunkStack=d,this.indexWithinChunkStack=l,this.siblings=f,this.index=b,this.indexOfChunk=C,this.indexWithinChunk=v,this.nestedCursor=m}get[n.cursorChunk](){return this.nestedCursor!==void 0?this.nestedCursor[n.cursorChunk]:((0,e.assert)(this.mode===0,1402),this.siblings[this.indexOfChunk])}atChunkRoot(){return this.siblingStack.length<2&&(this.nestedCursor===void 0||this.nestedCursor.atChunkRoot())}fork(){return new r(this.root,[...this.siblingStack],[...this.indexStack],[...this.indexOfChunkStack],[...this.indexWithinChunkStack],this.siblings,this.index,this.indexOfChunk,this.indexWithinChunk,this.nestedCursor?.fork())}get mode(){if(this.nestedCursor!==void 0)return this.nestedCursor.mode;const o=this.siblingStack.length+1>>1;return(0,e.assert)(this.indexOfChunkStack.length===o,1308),(0,e.assert)(this.indexWithinChunkStack.length===o,1309),this.siblingStack.length%2===0?1:0}getFieldKey(){return this.nestedCursor!==void 0?this.nestedCursor.getFieldKey():((0,e.assert)(this.mode===1,1310),this.siblings[this.index])}getStackedFieldKey(o){return(0,e.assert)(o%2===0,1311),this.siblingStack[o][this.indexStack[o]]}getStackedNodeIndex(o){return(0,e.assert)(o%2===1,1312),(0,e.assert)(o>=0,1313),this.indexStack[o]??(0,e.oob)()}getStackedNode(o){const u=this.getStackedNodeIndex(o);return this.siblingStack[o][u]}getFieldLength(){if(this.nestedCursor!==void 0)return this.nestedCursor.getFieldLength();(0,e.assert)(this.mode===1,1314);let o=0;for(const u of this.getField())o+=u.topLevelLength;return o}enterNode(o){if(this.nestedCursor!==void 0){this.nestedCursor.enterNode(o);return}const u=this.firstNode()&&this.seekNodes(o);(0,e.assert)(u,1315)}getPath(o){if(this.nestedCursor!==void 0)return this.nestedCursor.getPath(this.nestedPathPrefix(o))??(0,e.fail)(2798);(0,e.assert)(this.mode===0,1316);const u=this.getOffsetPath(0,o);return(0,e.assert)(u!==void 0,1372),u}nestedPathPrefix(o){const u=this.getOffsetPath(0,o)??(0,e.fail)(2799);return{indexOffset:u.parentIndex-this.indexWithinChunk,rootFieldOverride:u.parentField,parent:u.parent}}getFieldPath(o){return this.nestedCursor!==void 0?this.nestedCursor.getFieldPath(this.nestedPathPrefix(o)):((0,e.assert)(this.mode===1,1317),{field:this.indexStack.length===1?o?.rootFieldOverride??this.getFieldKey():this.getFieldKey(),parent:this.getOffsetPath(1,o)})}getOffsetPath(o,u){const c=this.indexStack.length-o;if(c===-1)return u?.parent;(0,e.assert)(c>0,1318),(0,e.assert)(c%2===1,1319);let d;function l(f){d=d===void 0?(0,t.prefixPath)(u,f):f}for(let f=1;f<c;f+=2){const b=this.getStackedFieldKey(f-1);l({parent:d,parentIndex:this.getStackedNodeIndex(f),parentField:b})}return l({parent:d,parentIndex:o===0?this.index:this.getStackedNodeIndex(c),parentField:this.getStackedFieldKey(c-1)}),d}enterField(o){if(this.nestedCursor!==void 0){this.nestedCursor.enterField(o);return}(0,e.assert)(this.mode===0,1320),this.siblingStack.push(this.siblings),this.indexStack.push(this.index),this.index=0,this.siblings=[o]}nextField(){return this.nestedCursor!==void 0?this.nestedCursor.nextField():(this.index+=1,this.index===this.siblings.length?(this.exitField(),!1):!0)}firstField(){if(this.nestedCursor!==void 0)return this.nestedCursor.firstField();const o=this.getNode().fields;return o.size===0?!1:(this.siblingStack.push(this.siblings),this.indexStack.push(this.index),this.index=0,this.siblings=[...o.keys()],!0)}seekNodes(o){if(this.nestedCursor!==void 0){const u=this.nestedCursor.atChunkRoot(),c=this.nestedCursor.seekNodes(o);if(!u)return c;c||(this.nestedCursor=void 0)}if((0,e.assert)(this.mode===0,1321),(0,e.assert)(this.indexOfChunk<this.siblings.length,1322),this.indexWithinChunk+=o,o>=0){const u=this.siblings??(0,e.oob)();for(;this.indexWithinChunk>=u[this.indexOfChunk].topLevelLength;){if(this.indexWithinChunk-=u[this.indexOfChunk].topLevelLength,this.indexOfChunk++,this.indexOfChunk===u.length)return this.exitNode(),!1;(0,e.assert)(this.indexOfChunk<this.siblings.length,1323)}}else{const u=this.siblings;for(;this.indexWithinChunk<0;){if(this.indexOfChunk===0)return this.exitNode(),!1;this.indexOfChunk--,this.indexWithinChunk+=u[this.indexOfChunk].topLevelLength}}return this.index+=o,this.initNestedCursor(),!0}firstNode(){if(this.nestedCursor!==void 0)return this.nestedCursor.firstNode();const o=this.getField();return o.length===0?!1:(this.siblingStack.push(this.siblings),this.indexStack.push(this.index),this.indexOfChunkStack.push(this.indexOfChunk),this.indexWithinChunkStack.push(this.indexWithinChunk),this.index=0,this.siblings=o,this.indexOfChunk=0,this.indexWithinChunk=0,this.initNestedCursor(),!0)}nextNode(){if(this.nestedCursor!==void 0){const o=this.nestedCursor.atChunkRoot(),u=this.nestedCursor.nextNode();if(!o)return u;u||(this.nestedCursor=void 0)}if((0,e.assert)(this.mode===0,1324),this.indexWithinChunk++,this.indexWithinChunk===this.siblings[this.indexOfChunk].topLevelLength){if(this.indexOfChunk++,this.indexOfChunk===this.siblings.length)return this.exitNode(),!1;this.indexWithinChunk=0,this.initNestedCursor()}return this.index++,!0}initNestedCursor(){(0,e.assert)(this.mode===0,1373);const o=this.siblings[this.indexOfChunk]??(0,e.oob)();this.nestedCursor=o instanceof i?void 0:o.cursor(),this.nestedCursor?.enterNode(this.indexWithinChunk)}exitField(){if(this.nestedCursor!==void 0)return this.nestedCursor.exitField();(0,e.assert)(this.mode===1,1325),this.siblings=this.siblingStack.pop()??(0,e.fail)(2800),this.index=this.indexStack.pop()??(0,e.fail)(2801)}exitNode(){if(this.nestedCursor!==void 0){if(!this.nestedCursor.atChunkRoot())return this.nestedCursor.exitNode();this.nestedCursor=void 0}(0,e.assert)(this.mode===0,1326),this.siblings=this.siblingStack.pop()??(0,e.fail)(2802),this.index=this.indexStack.pop()??(0,e.fail)(2803),this.indexOfChunk=this.indexOfChunkStack.pop()??(0,e.fail)(2804),this.indexWithinChunk=this.indexWithinChunkStack.pop()??(0,e.fail)(2805)}getNode(){return(0,e.assert)(this.mode===0,1327),this.siblings[this.index]}getField(){if(this.siblingStack.length===0)return this.root;(0,e.assert)(this.mode===1,1328);const o=this.getStackedNode(this.indexStack.length-1),u=this.getFieldKey();return o.fields.get(u)??[]}get value(){return this.nestedCursor!==void 0?this.nestedCursor.value:this.getNode().value}get type(){return this.nestedCursor!==void 0?this.nestedCursor.type:this.getNode().type}get fieldIndex(){return(0,e.assert)(this.mode===0,1329),this.nestedCursor!==void 0?this.nestedCursor.atChunkRoot()?this.nestedCursor.fieldIndex+this.nestedOffset():this.nestedCursor.fieldIndex:this.index}nestedOffset(){return(0,e.assert)(this.nestedCursor!==void 0,1374),(0,e.assert)(!this.nestedCursor.atChunkRoot()||this.indexWithinChunk===this.nestedCursor.fieldIndex,1375),this.index-this.indexWithinChunk}get chunkStart(){return this.nestedCursor!==void 0?this.nestedCursor.atChunkRoot()?this.nestedCursor.chunkStart+this.nestedOffset():this.nestedCursor.chunkStart:this.fieldIndex}get chunkLength(){return this.nestedCursor!==void 0?this.nestedCursor.chunkLength:1}}return Fm.BasicChunkCursor=r,Fm}var BS={},y$;function hae(){if(y$)return BS;y$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(BS,"__esModule",{value:!0}),BS.SequenceChunk=void 0;const e=Vt(),n=Bt(),a=KE();class t extends n.ReferenceCountedBase{get topLevelLength(){let r=0;for(const s of this.subChunks)r+=s.topLevelLength;return r}constructor(r){super(),this.subChunks=r}clone(){const r=this.subChunks.map(s=>(s.referenceAdded(),s));return new t(r)}cursor(){return new a.BasicChunkCursor(this.subChunks,[],[],[],[],[e.dummyRoot],0,0,0,void 0)}onUnreferenced(){for(const r of this.subChunks)r.referenceRemoved()}}return BS.SequenceChunk=t,BS}var bo={},b$;function mae(){if(b$)return bo;b$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(bo,"__esModule",{value:!0}),bo.ChunkShape=bo.TreeShape=bo.UniformChunk=bo.uniformChunk=void 0;const e=Je(),n=Ot(),a=Vt(),t=Bt(),i=Yg();function r(b,C){return new s(b,C)}bo.uniformChunk=r;class s extends t.ReferenceCountedBase{constructor(C,v,m){super(),this.shape=C,this.values=v,this.idCompressor=m,(0,e.assert)(C.treeShape.valuesPerTopLevelNode*C.topLevelLength===v.length,1219)}get topLevelLength(){return this.shape.topLevelLength}clone(){return new s(this.shape,this.values.slice())}cursor(){return new f(this)}onUnreferenced(){}}bo.UniformChunk=s;class o{constructor(C,v,m,h=!1){if(this.type=C,this.hasValue=v,this.fieldsArray=m,this.maybeDecompressedStringAsNumber=h,h&&!(v&&C==="com.fluidframework.leaf.string"))throw new n.UsageError("maybeDecompressedStringAsNumber flag can only be set to true for string leaf node.");const g=new Map;let _=v?1:0;const S=[new l(void 0,a.dummyRoot,0,void 0,void 0,this,1,0)];let p=0;for(const[w,O,E]of m){(0,e.assert)(!g.has(w),1221);const F=new d(O,E,S.length,w,p);g.set(w,F),u(0,[w,O,E],p,_,S),_+=O.valuesPerTopLevelNode*E,p++}this.fields=g,this.valuesPerTopLevelNode=_,this.positions=S,this.fieldsOffsetArray=[...g.values()]}equals(C){return(0,e.compareArrays)(this.fieldsArray,C.fieldsArray,([v,m,h],[g,_,S])=>v===g&&h===S&&m.equals(_))?this.type===C.type&&this.hasValue===C.hasValue:!1}withTopLevelLength(C){return new c(this,C)}}bo.TreeShape=o;function u(b,[C,v,m],h,g,_){const S=_.length;for(let p=0;p<m;p++)for(const w of v.positions){const O=w.indexOfParentPosition===void 0,E=O?b:w.indexOfParentPosition+p*v.positions.length+S;_.push(new l(E===void 0?void 0:_[E],w.parentField===a.dummyRoot?C:w.parentField,O?p:w.parentIndex,w.indexOfParentField??h,E,w.shape,O?m:w.topLevelLength,w.valueOffset+g+v.valuesPerTopLevelNode*p))}}class c{constructor(C,v){this.treeShape=C,this.topLevelLength=v,(0,e.assert)(v>0,1222);const m=[void 0];u(0,[a.dummyRoot,C,v],0,0,m),this.positions=m}equals(C){return this.topLevelLength===C.topLevelLength&&this.treeShape===C.treeShape}}bo.ChunkShape=c;class d{constructor(C,v,m,h,g){this.shape=C,this.topLevelLength=v,this.offset=m,this.key=h,this.indexOfParentField=g}}class l{constructor(C,v,m,h,g,_,S,p){this.parent=C,this.parentField=v,this.parentIndex=m,this.indexOfParentField=h,this.indexOfParentPosition=g,this.shape=_,this.topLevelLength=S,this.valueOffset=p}}class f extends i.SynchronousCursor{constructor(C){super(),this.chunk=C,this.mode=1,this.indexOfField=0,this.chunkStart=0,this.shape=this.chunk.shape,this.positions=this.shape.positions,this.fieldKey=a.dummyRoot,this.moveToPosition(0)}get[a.cursorChunk](){return this.atChunkRoot()?this.chunk:void 0}atChunkRoot(){return(0,e.assert)(this.fieldKey===void 0==(this.mode===0),1376),this.nodePositionInfo===void 0||this.nodePositionInfo.parent===void 0&&this.fieldKey===void 0}fork(){const C=new f(this.chunk);return C.mode=this.mode,C.fieldKey=this.fieldKey,C.indexOfField=this.indexOfField,C.moveToPosition(this.positionIndex),C}moveToPosition(C){this.nodePositionInfo=this.positions[C],this.positionIndex=C,this.nodePositionInfo===void 0&&((0,e.assert)(C===0,1377),(0,e.assert)(this.mode===1,1378))}nodeInfo(C){return(0,e.assert)(this.mode===C,1224),(0,e.assert)(this.nodePositionInfo!==void 0,1342),this.nodePositionInfo}nextField(){this.indexOfField++;const C=this.nodeInfo(1).shape.fieldsArray;if(this.indexOfField<C.length){const v=C[this.indexOfField]??(0,e.oob)();return this.fieldKey=v[0],!0}return this.exitField(),!1}exitField(){(0,e.assert)(this.mode===1,1225),(0,e.assert)(this.nodePositionInfo!==void 0,1379),this.fieldKey=void 0,this.mode=0}getFieldKey(){return this.fieldKey??(0,e.fail)(2825)}getFieldLength(){if((0,e.assert)(this.mode===1,1343),this.nodePositionInfo===void 0)return this.shape.topLevelLength;const C=this.nodePositionInfo.shape.fieldsArray[this.indexOfField];return C===void 0?0:C[2]}firstNode(){return(0,e.assert)(this.mode===1,1344),this.nodePositionInfo===void 0?(this.enterRootNodeInner(0),!0):this.enterNodeInner(this.nodePositionInfo,0)}enterNode(C){if((0,e.assert)(this.mode===1,1345),(0,e.assert)(C>=0,1226),this.nodePositionInfo===void 0)(0,e.assert)(C<this.shape.topLevelLength,1346),this.enterRootNodeInner(C);else{const v=this.enterNodeInner(this.nodePositionInfo,C);(0,e.assert)(v,1227)}}enterNodeInner(C,v){const m=C.shape,h=m.fieldsOffsetArray;if(this.indexOfField>=h.length)return!1;const g=m.fieldsOffsetArray[this.indexOfField]??(0,e.oob)();return v>=g.topLevelLength?!1:(this.mode=0,this.fieldKey=void 0,this.moveToPosition(this.positionIndex+g.offset+v*g.shape.positions.length),(0,e.assert)(this.fieldIndex===v,1228),!0)}enterRootNodeInner(C){this.mode=0,this.fieldKey=void 0,this.moveToPosition(1+C*this.shape.treeShape.positions.length),(0,e.assert)(this.fieldIndex===C,1347)}getFieldPath(C){return(0,i.prefixFieldPath)(C,{field:this.getFieldKey(),parent:this.nodePositionInfo})}getPath(C){return(0,i.prefixPath)(C,this.nodeInfo(0))}get fieldIndex(){return this.nodeInfo(0).parentIndex}get chunkLength(){return this.nodeInfo(0).topLevelLength}seekNodes(C){const v=this.nodeInfo(0),m=C+v.parentIndex;return m>=0&&m<v.topLevelLength?(this.moveToPosition(this.positionIndex+C*v.shape.positions.length),!0):(this.exitNode(),!1)}nextNode(){const C=this.nodeInfo(0);return C.parentIndex+1===C.topLevelLength?(this.exitNode(),!1):(this.moveToPosition(this.positionIndex+C.shape.positions.length),!0)}exitNode(){const C=this.nodeInfo(0);this.indexOfField=C.indexOfParentField??(0,e.fail)(2826),this.fieldKey=C.parentField,this.mode=1,this.moveToPosition(C.indexOfParentPosition??(0,e.fail)(2827))}firstField(){const C=this.nodeInfo(0).shape.fieldsArray;if(!(0,t.hasSome)(C))return!1;this.indexOfField=0,this.mode=1;const v=C[0];return this.fieldKey=v[0],!0}enterField(C){const v=this.nodeInfo(0).shape.fields,m=v.get(C);this.indexOfField=m===void 0?v.size:m.indexOfParentField??(0,e.fail)(2828),this.fieldKey=C,this.mode=1}get type(){return this.nodeInfo(0).shape.type}get value(){const C=this.chunk.idCompressor,v=this.nodeInfo(0);if(v.shape.hasValue&&v.shape.maybeDecompressedStringAsNumber){const m=this.chunk.values[v.valueOffset];if(typeof m=="number"&&C!==void 0)return C.decompress(m)}return v.shape.hasValue?this.chunk.values[v.valueOffset]:void 0}}return bo}var v$;function hq(){return v$||(v$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.uniformChunkFromCursor=e.insertValues=e.chunkRange=e.basicOnlyChunkPolicy=e.defaultChunkPolicy=e.tryShapeFromFieldSchema=e.tryShapeFromSchema=e.shapesFromSchema=e.makePolicy=e.basicChunkTree=e.chunkFieldSingle=e.chunkField=e.chunkTree=e.Chunker=e.polymorphic=e.Polymorphic=e.makeTreeChunker=void 0;const n=Je(),a=Vt(),t=Bt(),i=fae(),r=KE(),s=hae(),o=mae();function u(O,E){return new d(O,E,e.defaultChunkPolicy.sequenceChunkInlineThreshold,e.defaultChunkPolicy.sequenceChunkInlineThreshold,e.defaultChunkPolicy.uniformChunkNodeCount,h)}e.makeTreeChunker=u;class c{}e.Polymorphic=c,e.polymorphic=new c;class d{constructor(E,F,R,M,j,k){this.schema=E,this.policy=F,this.sequenceChunkSplitThreshold=R,this.sequenceChunkInlineThreshold=M,this.uniformChunkNodeCount=j,this.tryShapeFromSchema=k,this.typeShapes=new Map}clone(E){return new d(E,this.policy,this.sequenceChunkSplitThreshold,this.sequenceChunkInlineThreshold,this.uniformChunkNodeCount,this.tryShapeFromSchema)}shapeFromSchema(E){const F=this.typeShapes.get(E);return F!==void 0?F:(this.unregisterSchemaCallback=this.schema.events.on("afterSchemaChange",()=>this.schemaChanged()),this.tryShapeFromSchema(this.schema,this.policy,E,this.typeShapes))}dispose(){this.schemaChanged()}schemaChanged(){this.typeShapes.clear(),this.unregisterSchemaCallback&&(this.unregisterSchemaCallback(),this.unregisterSchemaCallback=void 0)}}e.Chunker=d;function l(O,E){return S(O,E,1,!0)[0]??(0,n.oob)()}e.chunkTree=l;function f(O,E){const F=O.getFieldLength(),R=O.firstNode();return(0,n.debugAssert)(()=>R===(F!==0)||"only 0 length fields should not have nodes"),S(O,E,F,!1)}e.chunkField=f;function b(O,E){const F=f(O,E);return F.length===1?F[0]??(0,n.oob)():new s.SequenceChunk(F)}e.chunkFieldSingle=b;function C(O,E){const F=(0,a.tryGetChunk)(O);return F instanceof r.BasicChunk?(F.referenceAdded(),F):_(O,E)}e.basicChunkTree=C;function v(O){const E={...e.defaultChunkPolicy,...O};return(0,n.assert)(E.sequenceChunkSplitThreshold>=2,1405),E}e.makePolicy=v;function m(O,E){const F=new Map;for(const R of O.nodeSchema.keys())h(O,E,R,F);return F}e.shapesFromSchema=m;function h(O,E,F,R){return(0,t.getOrCreate)(R,F,()=>{const M=O.nodeSchema.get(F)??(0,n.fail)(2809);if(M instanceof a.LeafNodeStoredSchema)return M.leafValue===a.ValueSchema.String?new o.TreeShape(F,!0,[],!0):new o.TreeShape(F,!0,[],!1);if(M instanceof a.ObjectNodeStoredSchema){const j=[];for(const[k,x]of M.objectNodeFields){const L=g(O,E,x,k,R);if(L===void 0)return e.polymorphic;j.push(L)}return new o.TreeShape(F,!1,j)}return e.polymorphic})}e.tryShapeFromSchema=h;function g(O,E,F,R,M){if((E.fieldKinds.get(F.kind)??(0,n.fail)(2810)).multiplicity!==a.Multiplicity.Single||F.types?.size!==1)return;const k=[...F.types][0]??(0,n.oob)(),x=h(O,E,k,M);if(!(x instanceof c))return[R,x,1]}e.tryShapeFromFieldSchema=g,e.defaultChunkPolicy={sequenceChunkSplitThreshold:Number.POSITIVE_INFINITY,sequenceChunkInlineThreshold:Number.POSITIVE_INFINITY,uniformChunkNodeCount:400,shapeFromSchema:()=>e.polymorphic},e.basicOnlyChunkPolicy={sequenceChunkSplitThreshold:Number.POSITIVE_INFINITY,sequenceChunkInlineThreshold:Number.POSITIVE_INFINITY,uniformChunkNodeCount:0,shapeFromSchema:()=>e.polymorphic};function _(O,E){return new r.BasicChunk(O.type,new Map((0,a.mapCursorFields)(O,()=>[O.getFieldKey(),f(O,E)])),O.value)}function S(O,E,F,R){(0,n.assert)(!(R&&F===0),2904),(0,n.assert)(O.mode===0==F>0,2905);let M=[],j=F;for(;j>0;){(0,n.assert)(O.mode===0,1407);const k=O.chunkStart;let x=!1;if(k===O.fieldIndex){const L=O.chunkLength;if(L<=j){const V=(0,a.tryGetChunk)(O);if(V!==void 0){if(V instanceof s.SequenceChunk&&V.subChunks.length<=E.policy.sequenceChunkInlineThreshold)for(const ee of V.subChunks)ee.referenceAdded(),M.push(ee);V.referenceAdded(),M.push(V),j-=L,x=!0;let G=L;R&&j===0&&(G-=1),O.seekNodes(G)}}}if(!x){(0,n.assert)(O.mode===0,1408);const L=O.type,V=E.policy.shapeFromSchema(L);if(V instanceof o.TreeShape){const G=V.positions.length,ee=Math.ceil(G/E.policy.uniformChunkNodeCount),se=Math.min(ee,j),re=w(O,V,se,se===j&&R,E.idCompressor);j-=re.topLevelLength,M.push(re)}else M.push(_(O,E)),j-=1,(!R||j!==0)&&O.nextNode()}}for(;M.length>E.policy.sequenceChunkSplitThreshold;){const k=Math.ceil(M.length/E.policy.sequenceChunkSplitThreshold),x=[],L=Math.floor(M.length/k),V=M.length%k;let G=0;for(let ee=0;ee<k;ee++){const se=G+L+(ee<V?1:0);x.push(new s.SequenceChunk(M.slice(G,se))),G=se}(0,n.assert)(G===M.length,1409),M=x}return M}e.chunkRange=S;function p(O,E,F,R){(0,n.assert)(E.type===O.type,1410),E.hasValue&&(typeof O.value=="string"&&R!==void 0&&(0,i.isStableNodeIdentifier)(O.value)?F.push(R.tryRecompress(O.value)??O.value):F.push(O.value));for(const[M,j,k]of E.fieldsArray){O.enterField(M);let x=0;for(let L=O.firstNode();L;L=O.nextNode())p(O,j,F,R),x++;O.exitField(),(0,n.assert)(k===x,1411)}}e.insertValues=p;function w(O,E,F,R,M){const j=[];let k=1;for(;k<=F;){if(p(O,E,j,M),k===F){R||O.nextNode();break}if(O.nextNode(),O.type!==E.type)break;k+=1}return new o.UniformChunk(E.withTopLevelLength(k),j,M)}e.uniformChunkFromCursor=w})(yM)),yM}var US={},vM={},S$;function Lve(){return S$||(S$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.Format=e.version=void 0;const n=Nr(),a=zn(),t=Vt();e.version=1,e.Format=n.Type.Object({version:n.Type.Literal(e.version),keys:n.Type.Array(t.schemaFormatV1.FieldKeySchema),fields:a.Versioned},{additionalProperties:!1})})(vM)),vM}var C$;function Bve(){if(C$)return US;C$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(US,"__esModule",{value:!0}),US.makeForestSummarizerCodec=void 0;const e=Je(),n=zn(),a=Lve();function t(i,r){const s=r;return(0,n.makeVersionedValidatedCodec)(i,new Set([1]),a.Format,{encode:(o,u)=>{const c=[],d=[];for(const[l,f]of o)c.push(l),d.push(f);return{keys:c,fields:s.encode(d,u),version:1}},decode:(o,u)=>{const c=new Map,d=s.decode(o.fields,u);(0,e.assert)(o.keys.length===d.length,2193);for(const[l,f]of d.entries())c.set(o.keys[l]??(0,e.oob)(),f);return c}})}return US.makeForestSummarizerCodec=t,US}var SM={},_$;function Uve(){return _$||(_$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ForestIncrementalSummaryBuilder=e.ForestIncrementalSummaryBehavior=e.ForestSummaryTrackingState=e.forestSummaryContentKey=void 0;const n=Je(),a=bn(),t=Bt(),i=on(),r=Ot();e.forestSummaryContentKey="ForestTree";const s="contents";e.ForestSummaryTrackingState={Tracking:"Tracking",ReadyToTrack:"ReadyToTrack"};var o;(function(l){l[l.Incremental=0]="Incremental",l[l.SingleBlob=1]="SingleBlob"})(o||(e.ForestIncrementalSummaryBehavior=o={}));function u(l,f){(0,n.assert)(l===e.ForestSummaryTrackingState.Tracking,3106),(0,n.assert)(f!==void 0,3107)}function c(l,f){(0,n.assert)(l===e.ForestSummaryTrackingState.ReadyToTrack,3108),(0,n.assert)(f===void 0,3109)}class d{constructor(f,b,C){this.enableIncrementalSummary=f,this.getChunkAtCursor=b,this.shouldEncodeFieldIncrementally=C,this.nextReferenceId=(0,t.brand)(0),this.chunkTrackingPropertiesMap=new Map,this.forestSummaryState=e.ForestSummaryTrackingState.ReadyToTrack,this.latestSummarySequenceNumber=-1,this.encodedChunkContentsMap=new Map}async load(f,b){const C=f.getSnapshotTree?.();if(C===void 0)return;const v=async(m,h)=>{for(const[g,_]of Object.entries(m.trees)){const S=`${h}${g}`,p=`${S}/${s}`;if(!await f.contains(p))throw new r.LoggingError(`SharedTree: Cannot find contents for incremental chunk ${p}`);const w=await b(p);this.encodedChunkContentsMap.set(g,w),await v(_,`${S}/`)}};await v(C,"")}startSummary(f){const{fullTree:b,incrementalSummaryContext:C,stringify:v}=f;return!this.enableIncrementalSummary||C===void 0?o.SingleBlob:(c(this.forestSummaryState,this.trackedSummaryProperties),this.forestSummaryState=e.ForestSummaryTrackingState.Tracking,this.latestSummarySequenceNumber=C.latestSummarySequenceNumber,this.trackedSummaryProperties={summarySequenceNumber:C.summarySequenceNumber,latestSummaryBasePath:C.summaryPath,chunkSummaryPath:[],parentSummaryBuilder:new a.SummaryTreeBuilder,fullTree:b,stringify:v},o.Incremental)}encodeIncrementalField(f,b){if(u(this.forestSummaryState,this.trackedSummaryProperties),f.getFieldLength()===0)return[];let C,v;const m=this.getChunkAtCursor(f),h=(0,t.tryGetFromNestedMap)(this.chunkTrackingPropertiesMap,this.latestSummarySequenceNumber,m);if(h!==void 0&&!this.trackedSummaryProperties.fullTree)v=h,C=h.referenceId,this.trackedSummaryProperties.parentSummaryBuilder.addHandle(`${C}`,i.SummaryType.Tree,`${this.trackedSummaryProperties.latestSummaryBasePath}/${h.summaryPath}`);else{C=(0,t.brand)(this.nextReferenceId++),this.trackedSummaryProperties.chunkSummaryPath.push(C),v={referenceId:C,summaryPath:this.trackedSummaryProperties.chunkSummaryPath.join("/")};const g=this.trackedSummaryProperties.parentSummaryBuilder,_=new a.SummaryTreeBuilder;this.trackedSummaryProperties.parentSummaryBuilder=_,_.addBlob(s,this.trackedSummaryProperties.stringify(b(m))),g.addWithStats(`${C}`,_.getSummaryTree()),this.trackedSummaryProperties.parentSummaryBuilder=g,this.trackedSummaryProperties.chunkSummaryPath.pop()}return(0,t.setInNestedMap)(this.chunkTrackingPropertiesMap,this.trackedSummaryProperties.summarySequenceNumber,m,v),[C]}completeSummary(f){const{incrementalSummaryContext:b,forestSummaryContent:C}=f;if(!this.enableIncrementalSummary||b===void 0){const g=new a.SummaryTreeBuilder;return g.addBlob(e.forestSummaryContentKey,C),g.getSummaryTree()}u(this.forestSummaryState,this.trackedSummaryProperties),this.trackedSummaryProperties.parentSummaryBuilder.addBlob(e.forestSummaryContentKey,C);const v=this.chunkTrackingPropertiesMap.get(this.latestSummarySequenceNumber),m=this.chunkTrackingPropertiesMap.get(this.trackedSummaryProperties.summarySequenceNumber);if(v!==void 0&&m!==void 0)for(const[g,_]of v.entries())m.has(g)||m.set(g,_);for(const g of this.chunkTrackingPropertiesMap.keys())g<this.latestSummarySequenceNumber&&this.chunkTrackingPropertiesMap.delete(g);this.forestSummaryState=e.ForestSummaryTrackingState.ReadyToTrack;const h=this.trackedSummaryProperties.parentSummaryBuilder.getSummaryTree();return this.trackedSummaryProperties=void 0,h}getEncodedIncrementalChunk(f){const b=this.encodedChunkContentsMap.get(`${f}`);return(0,n.assert)(b!==void 0,3110),b}}e.ForestIncrementalSummaryBuilder=d})(SM)),SM}var jm={},T$;function $E(){if(T$)return jm;T$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(jm,"__esModule",{value:!0}),jm.TreeCompressionStrategyExtended=jm.TreeCompressionStrategy=void 0;var e;(function(a){a[a.Compressed=0]="Compressed",a[a.Uncompressed=1]="Uncompressed"})(e||(jm.TreeCompressionStrategy=e={}));var n;return(function(a){a[a.CompressedIncremental=2]="CompressedIncremental"})(n||(jm.TreeCompressionStrategyExtended=n={})),jm}var w$;function zve(){return w$||(w$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ForestSummarizer=e.forestSummaryKey=void 0;const n=Ht(),a=Je(),t=Vt(),i=Bt(),r=hq(),s=Bve(),o=Uve(),u=$E();e.forestSummaryKey="Forest";class c{constructor(l,f,b,C,v,m,h){this.forest=l,this.revisionTagCodec=f,this.encoderContext=C,this.idCompressor=m,this.key=e.forestSummaryKey,this.codec=(0,s.makeForestSummarizerCodec)(v,b);const g=(_,S)=>h?.(_,S)??!1;this.incrementalSummaryBuilder=new o.ForestIncrementalSummaryBuilder(C.encodeType===u.TreeCompressionStrategyExtended.CompressedIncremental,_=>this.forest.chunkField(_),g)}summarize(l){const{stringify:f,fullTree:b=!1,incrementalSummaryContext:C}=l,v=this.forest.getCursorAboveDetachedFields(),m=new Map;(0,t.forEachField)(v,S=>{const p=S.getFieldKey(),w=this.forest.allocateCursor("getTreeString");(0,a.assert)(this.forest.tryMoveCursorToField({fieldKey:p,parent:void 0},w)===1,2194),m.set(p,w)});const h=this.incrementalSummaryBuilder.startSummary({fullTree:b,incrementalSummaryContext:C,stringify:f}),g={...this.encoderContext,incrementalEncoderDecoder:h===o.ForestIncrementalSummaryBehavior.Incremental?this.incrementalSummaryBuilder:void 0},_=this.codec.encode(m,g);return m.forEach(S=>S.free()),this.incrementalSummaryBuilder.completeSummary({incrementalSummaryContext:C,forestSummaryContent:f(_)})}async load(l,f){(0,a.assert)(await l.contains(o.forestSummaryContentKey),3105);const b=async g=>{const _=await l.readBlob(g),S=(0,n.bufferToString)(_,"utf8");return f(S)};await this.incrementalSummaryBuilder.load(l,b);const C=this.codec.decode(await b(o.forestSummaryContentKey),{...this.encoderContext,incrementalEncoderDecoder:this.incrementalSummaryBuilder}),v=(0,i.idAllocatorFromMaxId)(),m=[],h=[];for(const[g,_]of C){const S=(0,r.chunkFieldSingle)(_,{policy:r.defaultChunkPolicy,idCompressor:this.idCompressor}),p={minor:v.allocate(S.topLevelLength)};h.push({id:p,trees:S}),m.push([g,[{count:S.topLevelLength,attach:p}]])}(0,a.assert)(this.forest.isEmpty,1943),(0,t.applyDelta)({build:h,fields:new Map(m)},void 0,this.forest,(0,t.makeDetachedFieldIndex)("init",this.revisionTagCodec,this.idCompressor))}}e.ForestSummarizer=c})(gM)),gM}var O$;function Vve(){return O$||(O$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ForestSummarizer=e.forestSummaryKey=void 0;var n=zve();Object.defineProperty(e,"forestSummaryKey",{enumerable:!0,get:function(){return n.forestSummaryKey}}),Object.defineProperty(e,"ForestSummarizer",{enumerable:!0,get:function(){return n.ForestSummarizer}})})(pM)),pM}var js={},P$;function mq(){if(P$)return js;P$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(js,"__esModule",{value:!0}),js.mapTreeFieldFromCursor=js.mapTreeFromCursor=js.cursorForMapTreeField=js.mapTreeFieldsWithField=js.mapTreeWithField=js.cursorForMapTreeNode=void 0;const e=Je(),n=Vt(),a=Yg();function t(d){const l=o;return(0,a.stackTreeNodeCursor)(l,d)}js.cursorForMapTreeNode=t;function i(d,l=n.rootFieldKey,f=n.aboveRootPlaceholder){return{type:f,fields:r(d,l)}}js.mapTreeWithField=i;function r(d,l){return new Map(d.length===0?[]:[[l,d]])}js.mapTreeFieldsWithField=r;function s(d,l=n.rootField){const f=(0,n.detachedFieldAsKey)(l),b=o,C={type:n.aboveRootPlaceholder,fields:r(d,f)};return(0,a.stackTreeFieldCursor)(b,C,l)}js.cursorForMapTreeField=s;const o={value:d=>d.value,type:d=>d.type,keysFromNode:d=>Array.from(d.fields,([l,f])=>l),getFieldFromNode:(d,l)=>{const f=d.fields.get(l);return f===void 0?[]:Array.isArray(f)?f:[...f]}};function u(d){(0,e.assert)(d.mode===0,951);const l=new Map;for(let b=d.firstField();b;b=d.nextField()){const C=(0,n.mapCursorField)(d,u);l.set(d.getFieldKey(),C)}return{type:d.type,value:d.value,fields:l}}js.mapTreeFromCursor=u;function c(d){return(0,e.assert)(d.mode===1,2563),(0,n.mapCursorField)(d,u)}return js.mapTreeFieldFromCursor=c,js}var CM={},Ms={},_M={},Pu={},E$;function Hve(){if(E$)return Pu;E$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Pu&&Pu.__classPrivateFieldGet||function(f,b,C,v){if(C==="a"&&!v)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?f!==b||!v:!b.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return C==="m"?v:C==="a"?v.call(f):v?v.value:b.get(f)},n;Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.buildChunkedForest=Pu.ChunkedForest=void 0;const a=Ht(),t=Je(),i=Vt(),r=Bt(),s=KE(),o=hq();function u(){return new s.BasicChunk(i.aboveRootPlaceholder,new Map)}class c{constructor(b,C,v,m=new i.AnchorSet,h){this.roots=b,this.schema=C,this.chunker=v,this.anchors=m,this.idCompressor=h,this.deltaVisitors=new Set,n.set(this,(0,a.createEmitter)()),this.events=e(this,n,"f"),this.nextDetachedFieldIdentifier=0}get isEmpty(){return this.roots.fields.size===0}clone(b,C){return this.roots.referenceAdded(),new c(this.roots,b,this.chunker.clone(b),C)}chunkField(b){return(0,o.chunkFieldSingle)(b,{idCompressor:this.idCompressor,policy:this.chunker})}forgetAnchor(b){this.anchors.forget(b)}registerAnnouncedVisitor(b){this.deltaVisitors.add(b)}deregisterAnnouncedVisitor(b){this.deltaVisitors.delete(b)}acquireVisitor(){(0,t.assert)(this.activeVisitor===void 0,1898),this.roots.isShared()&&(this.roots=this.roots.clone());const b={forest:this,mutableChunkStack:[],mutableChunk:this.roots,getParent(){return(0,t.assert)((0,r.hasSome)(this.mutableChunkStack),1330),(0,r.getLast)(this.mutableChunkStack)},free(){this.mutableChunk=void 0,this.mutableChunkStack.length=0,(0,t.assert)(this.forest.activeVisitor!==void 0,1899),this.forest.activeVisitor=void 0},destroy(m,h){e(this.forest,n,"f").emit("beforeChange"),this.forest.roots.fields.delete(m)},create(m,h){e(this.forest,n,"f").emit("beforeChange");const g=m.map(_=>(0,o.chunkTree)(_,{policy:this.forest.chunker,idCompressor:this.forest.idCompressor}));this.forest.roots.fields.set(h,g),e(this.forest,n,"f").emit("afterRootFieldCreated",h)},attach(m,h,g){this.attachEdit(m,h,g)},detach(m,h,g){this.detachEdit(m,h)},attachEdit(m,h,g){e(this.forest,n,"f").emit("beforeChange");const _=this.forest.roots.fields.get(m)??[];if(this.forest.roots.fields.delete(m),_.length===0)return;const S=this.getParent();(0,r.getOrAddEmptyToMap)(S.mutableChunk.fields,S.key).splice(g,0,..._)},detachEdit(m,h){e(this.forest,n,"f").emit("beforeChange");const g=this.getParent(),_=g.mutableChunk.fields.get(g.key)??[];(0,r.assertValidRange)(m,_);const S=_.splice(m.start,m.end-m.start);if(h!==void 0)(0,t.assert)(!this.forest.roots.fields.has(h),1967),S.length>0&&this.forest.roots.fields.set(h,S);else for(const p of S)p.referenceRemoved();_.length===0&&g.mutableChunk.fields.delete(g.key)},enterNode(m){(0,t.assert)(this.mutableChunk===void 0,1333);const h=this.getParent(),g=h.mutableChunk.fields.get(h.key)??(0,t.fail)(2806);let _=m,S=0,p=g[S]??(0,t.oob)();for(;_>=p.topLevelLength;)p=g[S]??(0,t.oob)(),_-=p.topLevelLength,S++,S===g.length&&(0,t.fail)(2807);let w=g[S]??(0,t.oob)();if(!(w instanceof s.BasicChunk)){const O=(0,i.mapCursorField)(w.cursor(),E=>(0,o.basicChunkTree)(E,{policy:this.forest.chunker,idCompressor:this.forest.idCompressor}));g.splice(S,1,...O),w.referenceRemoved(),w=O[_]??(0,t.oob)()}(0,t.assert)(w instanceof s.BasicChunk,1334),w.isShared()?(this.mutableChunk=g[S]=w.clone(),w.referenceRemoved()):this.mutableChunk=w},exitNode(m){(0,t.assert)(this.mutableChunk!==void 0,1335),this.mutableChunk=void 0},enterField(m){(0,t.assert)(this.mutableChunk!==void 0,1336),this.mutableChunkStack.push({key:m,mutableChunk:this.mutableChunk}),this.mutableChunk=void 0},exitField(m){const h=this.mutableChunkStack.pop()??(0,t.fail)(2808);(0,t.assert)(this.mutableChunk===void 0,1337),this.mutableChunk=h.mutableChunk}},C=[];this.deltaVisitors.forEach(m=>C.push(m()));const v=(0,i.combineVisitors)([b,...C]);return this.activeVisitor=v,v}newDetachedField(){const b=(0,r.brand)(String(this.nextDetachedFieldIdentifier));return(0,t.assert)(!this.roots.fields.has((0,i.detachedFieldAsKey)(b)),1338),this.nextDetachedFieldIdentifier+=1,b}allocateCursor(){return new d(this,i.ITreeSubscriptionCursorState.Cleared,[],[],[],[],[],[],0,0,0,void 0)}tryMoveCursorToNode(b,C){const v=this.anchors.locate(b);return v===void 0?-1:(this.moveCursorToPath(v,C),1)}tryMoveCursorToField(b,C){if((0,t.assert)(C instanceof d,1339),b.parent===void 0)return C.setToDetachedSequence(b.fieldKey),1;const v=this.tryMoveCursorToNode(b.parent,C);return v!==1?v:(C.enterField(b.fieldKey),1)}moveCursorToPath(b,C){(0,t.assert)(C instanceof d,1340),(0,t.assert)(C.forest===this,1341);const v=[],m=[];let h=b;for(;h!==void 0;)v.push(h.parentIndex),m.push(h.parentField),h=h.parent;for(C.clear();m.length>0;){const g=m.pop();C.state===i.ITreeSubscriptionCursorState.Cleared?(C.setToDetachedSequence(g),C.state=i.ITreeSubscriptionCursorState.Current):C.enterField(g),C.enterNode(v.pop())}}getCursorAboveDetachedFields(){const b=this.roots.cursor();return b.enterNode(0),b}}Pu.ChunkedForest=c,n=new WeakMap;class d extends s.BasicChunkCursor{constructor(b,C,v,m,h,g,_,S,p,w,O,E){super(v,m,h,g,_,S,p,w,O,E),this.forest=b,this.state=C}setToDetachedSequence(b){this.root=this.forest.roots.fields.get(b)??[],this.siblingStack.length=0,this.indexStack.length=0,this.indexOfChunkStack.length=0,this.indexWithinChunkStack.length=0,this.siblings=[b],this.index=0,this.indexOfChunk=0,this.indexWithinChunk=0,this.nestedCursor=void 0}fork(){return new d(this.forest,this.state,this.root,[...this.siblingStack],[...this.indexStack],[...this.indexOfChunkStack],[...this.indexWithinChunkStack],this.siblings,this.index,this.indexOfChunk,this.indexWithinChunk,this.nestedCursor?.fork())}buildFieldAnchor(){const b=this.getFieldPath();return{parent:b.parent===void 0?void 0:this.forest.anchors.track(b.parent),fieldKey:b.field}}free(){this.state=i.ITreeSubscriptionCursorState.Freed}buildAnchor(){return this.forest.anchors.track(this.getPath())}clear(){this.state=i.ITreeSubscriptionCursorState.Cleared,this.setToDetachedSequence(i.rootFieldKey)}}function l(f,b,C){return new c(u(),f.schema,f,b,C)}return Pu.buildChunkedForest=l,Pu}var TM={},wM={},vo={},I$;function Kve(){if(I$)return vo;I$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vo,"__esModule",{value:!0}),vo.EncodedFieldBatchGeneric=vo.Count=vo.ShapeIndex=vo.IdentifierOrIndex=void 0;const e=Nr();vo.IdentifierOrIndex=e.Type.Union([e.Type.String(),e.Type.Number({multipleOf:1,minimum:0})]),vo.ShapeIndex=e.Type.Number({multipleOf:1,minimum:0}),vo.Count=e.Type.Number({multipleOf:1,minimum:0});const n=e.Type.Object({version:e.Type.Number(),identifiers:e.Type.Array(e.Type.String()),data:e.Type.Array(e.Type.Array(e.Type.Any()))},{additionalProperties:!1}),a=(t,i)=>e.Type.Composite([n,e.Type.Object({version:e.Type.Literal(t),shapes:e.Type.Array(i)})],{additionalProperties:!1});return vo.EncodedFieldBatchGeneric=a,vo}var R$;function lb(){return R$||(R$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncodedFieldBatch=e.EncodedChunkShape=e.EncodedNodeShape=e.EncodedValueShape=e.SpecialField=e.EncodedCounter=e.EncodedFieldShape=e.EncodedIncrementalChunkShape=e.EncodedAnyShape=e.EncodedInlineArrayShape=e.EncodedNestedArrayShape=e.validVersions=e.version=void 0;const n=Nr(),a=zn(),t=Kve();e.version=1,e.validVersions=new Set([e.version]),e.EncodedNestedArrayShape=t.ShapeIndex,e.EncodedInlineArrayShape=n.Type.Object({length:t.Count,shape:t.ShapeIndex},{additionalProperties:!1}),e.EncodedAnyShape=n.Type.Literal(0),e.EncodedIncrementalChunkShape=n.Type.Literal(0),e.EncodedFieldShape=n.Type.Tuple([t.IdentifierOrIndex,t.ShapeIndex]);var i;(function(o){o[o.PreviousNodeOfType_DepthFirstPreOrder=0]="PreviousNodeOfType_DepthFirstPreOrder"})(i||(i={}));var r;(function(o){o[o.Number=0]="Number",o[o.UUID=1]="UUID"})(r||(r={})),e.EncodedCounter=n.Type.Object({relativeTo:n.Type.Enum(i),delta:n.Type.Optional(n.Type.Number()),mode:n.Type.Enum(r)},{additionalProperties:!1});var s;(function(o){o[o.Identifier=0]="Identifier"})(s||(e.SpecialField=s={})),e.EncodedValueShape=n.Type.Union([n.Type.Boolean(),n.Type.Array(n.Type.Any(),{minItems:1,maxItems:1}),n.Type.Enum(s)]),e.EncodedNodeShape=n.Type.Object({type:n.Type.Optional(t.IdentifierOrIndex),value:n.Type.Optional(e.EncodedValueShape),fields:n.Type.Optional(n.Type.Array(e.EncodedFieldShape)),extraFields:n.Type.Optional(t.ShapeIndex)},{additionalProperties:!1}),e.EncodedChunkShape=n.Type.Object({a:n.Type.Optional(e.EncodedNestedArrayShape),b:n.Type.Optional(e.EncodedInlineArrayShape),c:n.Type.Optional(e.EncodedNodeShape),d:n.Type.Optional(e.EncodedAnyShape),e:n.Type.Optional(e.EncodedIncrementalChunkShape)},a.unionOptions),e.EncodedFieldBatch=(0,t.EncodedFieldBatchGeneric)(e.version,e.EncodedChunkShape)})(wM)),wM}var Mm={},OM={},PM={},F$;function pae(){return F$||(F$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.emptyCursor=e.emptyChunk=void 0;const n=Je(),a=Vt(),t=Yg();e.emptyChunk={topLevelLength:0,cursor(){return e.emptyCursor},referenceAdded(){},referenceRemoved(){},isShared(){return!1}};const i={parent:void 0,field:a.dummyRoot};e.emptyCursor={[a.CursorMarker]:!0,pending:!1,mode:1,[a.cursorChunk]:e.emptyChunk,nextField(){(0,n.fail)(2811)},exitField(){(0,n.fail)(2812)},skipPendingFields(){return!0},getFieldKey(){return i.field},getFieldLength(){return 0},firstNode(){return!1},enterNode(r){(0,n.fail)(2813)},getFieldPath(r){return(0,t.prefixFieldPath)(r,i)},getPath(){(0,n.fail)(2814)},get fieldIndex(){return(0,n.fail)(2815)},get chunkStart(){return(0,n.fail)(2816)},get chunkLength(){return(0,n.fail)(2817)},seekNodes(r){(0,n.fail)(2818)},nextNode(){(0,n.fail)(2819)},exitNode(){(0,n.fail)(2820)},firstField(){(0,n.fail)(2821)},enterField(r){(0,n.fail)(2822)},get type(){return(0,n.fail)(2823)},get value(){return(0,n.fail)(2824)},atChunkRoot(){return!0},fork(){return e.emptyCursor}}})(PM)),PM}var Ei={},j$;function pq(){if(j$)return Ei;j$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.readStreamStream=Ei.readStreamValue=Ei.readStreamBoolean=Ei.readStreamNumber=Ei.readStream=Ei.getChecked=Ei.jsonMinimizingFilter=Ei.Counter=void 0;const e=Je(),n=Bt(),a=ZP();class t{constructor(){this.counts=new Map}add(f,b=1){const C=this.counts.get(f)??0;this.counts.set(f,C+b)}buildTable(f=()=>!0){const b=[...this.counts.keys()];b.sort((v,m)=>(this.counts.get(m)??0)-(this.counts.get(v)??0));const C=[];for(const v of b)f(v,C.length,this.counts.get(v)??0)&&C.push(v);return{indexToValue:C,valueToIndex:new Map(C.map((v,m)=>[v,m]))}}}Ei.Counter=t;function i(l,f,b){const C=JSON.stringify(l),v=String(f).length*b+C.length+1,m=C.length*b;return v<m}Ei.jsonMinimizingFilter=i;function r(l,f){return(0,n.assertValidIndex)(f,l),l[f]??(0,e.oob)()}Ei.getChecked=r;function s(l){const f=r(l.data,l.offset);return l.offset++,f}Ei.readStream=s;function o(l){const f=s(l);return(0,e.assert)(typeof f=="number",1840),f}Ei.readStreamNumber=o;function u(l){const f=s(l);return(0,e.assert)(typeof f=="boolean",1841),f}Ei.readStreamBoolean=u;function c(l){const f=s(l);return(0,a.assertAllowedValue)(f),f}Ei.readStreamValue=c;function d(l){const f=s(l);return(0,e.assert)(Array.isArray(f),1842),{data:f,offset:0}}return Ei.readStreamStream=d,Ei}var Eu={},M$;function $ve(){if(M$)return Eu;M$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Eu,"__esModule",{value:!0}),Eu.readStreamIdentifier=Eu.DecoderContext=Eu.decode=void 0;const e=Je(),n=pq();function a(r,s,o,u){const c=o.shapes.map(l=>r.dispatch(l,s)),d=[];for(const l of o.data){const f={data:l,offset:0},b=u.decode(c,f);(0,e.assert)(f.offset===f.data.length,1850),d.push(b)}return d}Eu.decode=a;class t{constructor(s,o,u,c){this.identifiers=s,this.shapes=o,this.idDecodingContext=u,this.incrementalDecoder=c}identifier(s){return typeof s=="string"?s:(0,n.getChecked)(this.identifiers,s)}}Eu.DecoderContext=t;function i(r,s){const o=(0,n.readStream)(r);return(0,e.assert)(typeof o=="number"||typeof o=="string",1851),s.identifier(o)}return Eu.readStreamIdentifier=i,Eu}var N$;function Gve(){return N$||(N$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.NodeDecoder=e.anyDecoder=e.IncrementalChunkDecoder=e.InlineArrayDecoder=e.NestedArrayDecoder=e.aggregateChunks=e.deaggregateChunks=e.readValue=e.decode=void 0;const n=Je(),a=zn(),t=Bt(),i=KE(),r=pae(),s=hae(),o=pq(),u=$ve(),c=lb();function d(S,p,w){return(0,u.decode)(l,new u.DecoderContext(S.identifiers,S.shapes,p,w),S,e.anyDecoder)}e.decode=d;const l=new a.DiscriminatedUnionDispatcher({a(S,p){return new v(S)},b(S,p){return new m(S)},c(S,p){return new _(S,p)},d(S){return e.anyDecoder},e(S,p){return new h(p)}});function f(S,p,w){if(p===void 0)return(0,o.readStreamBoolean)(S)?(0,o.readStreamValue)(S):void 0;if(p===!0)return(0,o.readStreamValue)(S);if(p===!1)return;if(Array.isArray(p))return(0,n.assert)(p.length===1,1844),p[0];if(p===c.SpecialField.Identifier){const O=(0,o.readStream)(S);(0,n.assert)(typeof O=="number"||typeof O=="string",2455);const E=w.idCompressor;return typeof O=="number"?E.decompress(E.normalizeToSessionSpace(O,w.originatorId)):O}else(0,n.unreachableCase)(p,"decoding values as deltas is not yet supported")}e.readValue=f;function b(S){if(S===r.emptyChunk)return[];if(S instanceof s.SequenceChunk){(0,n.assert)(S.subChunks.length>0,1845),(0,n.assert)(S.subChunks.length>1,1846);for(const p of S.subChunks)(0,n.assert)(!(p instanceof s.SequenceChunk),1847),(0,n.assert)(p!==r.emptyChunk,1848),p.referenceAdded();return S.referenceRemoved(),S.subChunks}else return[S]}e.deaggregateChunks=b;function C(S){const p=S.flatMap(b);switch(p.length){case 0:return r.emptyChunk;case 1:return p[0]??(0,n.oob)();default:return new s.SequenceChunk(p)}}e.aggregateChunks=C;class v{constructor(p){this.shape=p}decode(p,w){const O=p[this.shape]??(0,n.oob)(),E=[],F=(0,o.readStream)(w);if(typeof F=="number"){const R={data:[],offset:0};for(let M=0;M<F;M++)E.push(O.decode(p,R))}else{(0,n.assert)(Array.isArray(F),1849);const R={data:F,offset:0};for(;R.offset!==R.data.length;)E.push(O.decode(p,R))}return C(E)}}e.NestedArrayDecoder=v;class m{constructor(p){this.shape=p}decode(p,w){const O=this.shape.length,E=p[this.shape.shape]??(0,n.oob)(),F=[];for(let R=0;R<O;R++)F.push(E.decode(p,w));return C(F)}}e.InlineArrayDecoder=m;class h{constructor(p){this.cache=p}decode(p,w){(0,n.assert)(this.cache.incrementalDecoder!==void 0,3111);const O=(0,o.readStreamNumber)(w),E=this.cache.incrementalDecoder.getEncodedIncrementalChunk((0,t.brand)(O));(0,n.assert)(E!==void 0,3112);const F=new u.DecoderContext(E.identifiers,E.shapes,this.cache.idDecodingContext,this.cache.incrementalDecoder),R=(0,u.decode)(l,F,E,e.anyDecoder);return C(R)}}e.IncrementalChunkDecoder=h,e.anyDecoder={decode(S,p){const w=(0,o.readStreamNumber)(p);return(0,o.getChecked)(S,w).decode(S,p)}};function g(S,p,w){return(0,t.assertValidIndex)(w,S.shapes),(O,E)=>{const F=O[w]??(0,n.oob)();return[p,F.decode(O,E)]}}class _{constructor(p,w){this.shape=p,this.context=w,this.type=p.type===void 0?void 0:w.identifier(p.type);const O=[];for(const[E,F]of p.fields??[]){const R=w.identifier(E);O.push(g(w,R,F))}this.fieldDecoders=O}decode(p,w){const O=this.type??(0,u.readStreamIdentifier)(w,this.context),E=f(w,this.shape.value,this.context.idDecodingContext),F=new Map;function R(M,j){const k=b(j);k.length!==0&&F.set(M,k)}for(const M of this.fieldDecoders){const[j,k]=M(p,w);R(j,k)}if(this.shape.extraFields!==void 0){const M=p[this.shape.extraFields]??(0,n.oob)(),j=(0,o.readStreamStream)(w);for(;j.offset!==j.data.length;){const k=(0,u.readStreamIdentifier)(j,this.context);R(k,M.decode(p,j))}}return new i.BasicChunk(O,F,E)}}e.NodeDecoder=_})(OM)),OM}var Sa={},EM={},Iu={},A$;function gae(){if(A$)return Iu;A$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Iu,"__esModule",{value:!0}),Iu.Shape=Iu.updateShapesAndIdentifiersEncoding=Iu.IdentifierToken=void 0;const e=Je(),n=pq();class a{constructor(s){this.identifier=s}}Iu.IdentifierToken=a;function t(r,s,o=n.jsonMinimizingFilter){const u=new n.Counter,c=new n.Counter,d=new Set,l=[],f=h=>{c.add(h),d.has(h)||(d.add(h),l.push(h))},b=[s];for(const h of b)for(const g of h)g instanceof a?u.add(g.identifier):g instanceof i?f(g):Array.isArray(g)?b.push(g):g!==null&&typeof g=="object"&&g.shape instanceof i&&(0,e.fail)(2891);{let h;for(;(h=l.pop())!==void 0;)h.countReferencedShapesAndIdentifiers(u,f)}const C=u.buildTable(o),v=c.buildTable();for(const h of b)for(let g=0;g<h.length;g++){const _=h[g];_ instanceof a?h[g]=C.valueToIndex.get(_.identifier)??_.identifier:_ instanceof i&&(h[g]=v.valueToIndex.get(_)??(0,e.fail)(2892))}const m=v.indexToValue.map(h=>h.encodeShape(C,v));return{version:r,identifiers:C.indexToValue,shapes:m,data:s}}Iu.updateShapesAndIdentifiersEncoding=t;class i{}return Iu.Shape=i,Iu}var D$;function yae(){return D$||(D$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncoderContext=e.encodeValue=e.incrementalFieldEncoder=e.IncrementalChunkShape=e.NestedArrayEncoder=e.NestedArrayShape=e.InlineArrayEncoder=e.anyFieldEncoder=e.anyNodeEncoder=e.AnyShape=e.asNodesEncoder=e.asFieldEncoder=e.compressedEncode=void 0;const n=Je(),a=Vt(),t=Bt(),i=gae(),r=lb();function s(h,g){const _=[];for(const S of h){const p=[];e.anyFieldEncoder.encodeField(S,g,p),_.push(p)}return(0,i.updateShapesAndIdentifiersEncoding)(r.version,_)}e.compressedEncode=s;function o(h){return{encodeField(g,_,S){(0,a.forEachNode)(g,()=>h.encodeNode(g,_,S))},shape:h.shape}}e.asFieldEncoder=o;function u(h){return{encodeNodes(g,_,S){h.encodeNode(g,_,S),g.nextNode()},shape:h.shape}}e.asNodesEncoder=u;class c extends i.Shape{constructor(){super()}encodeShape(g,_){return{d:0}}countReferencedShapesAndIdentifiers(g,_){}static encodeField(g,_,S,p){S.push(p.shape),p.encodeField(g,_,S)}static encodeNode(g,_,S,p){S.push(p.shape),p.encodeNode(g,_,S)}static encodeNodes(g,_,S,p){S.push(p.shape),p.encodeNodes(g,_,S)}}e.AnyShape=c,c.instance=new c,e.anyNodeEncoder={encodeNode(h,g,_){const S=g.nodeEncoderFromSchema(h.type);c.encodeNode(h,g,_,S)},shape:c.instance},e.anyFieldEncoder={encodeField(h,g,_){if(h.getFieldLength()===0){const S=d.empty;c.encodeField(h,g,_,S)}else if(h.getFieldLength()===1)h.enterNode(0),e.anyNodeEncoder.encodeNode(h,g,_),h.exitNode();else{const S=g.nestedArrayEncoder(e.anyNodeEncoder);c.encodeField(h,g,_,S)}},shape:c.instance};class d extends i.Shape{constructor(g,_){super(),this.length=g,this.inner=_}encodeNodes(g,_,S){for(let p=0;p<this.length;p++)this.inner.encodeNodes(g,_,S)}encodeField(g,_,S){(0,n.assert)(g.getFieldLength()>=this.length,1852),g.firstNode(),this.encodeNodes(g,_,S),(0,n.assert)(g.mode===1,1853)}encodeShape(g,_){return{b:{length:this.length,shape:_.valueToIndex.get(this.inner.shape)??(0,n.fail)(2894)}}}countReferencedShapesAndIdentifiers(g,_){_(this.inner.shape)}get shape(){return this}}e.InlineArrayEncoder=d,d.empty=new d(0,{get shape(){return d.empty},encodeNodes(h,g,_){(0,n.fail)(2893)}});class l extends i.Shape{constructor(g){super(),this.innerShape=g}encodeShape(g,_){return{a:_.valueToIndex.get(this.innerShape)??(0,n.fail)(2895)}}countReferencedShapesAndIdentifiers(g,_){_(this.innerShape)}}e.NestedArrayShape=l;class f{constructor(g,_=new l(g.shape)){this.innerEncoder=g,this.shape=_}encodeField(g,_,S){const p=[];let w=!0;const O=g.getFieldLength();(0,a.forEachNode)(g,()=>{const E=p.length;this.innerEncoder.encodeNode(g,_,p),w&&=p.length-E!==0}),p.length===0?S.push(O):((0,n.assert)(w,1854),S.push(p))}}e.NestedArrayEncoder=f;class b extends i.Shape{static encodeChunk(g,_){const S=[],p=u(e.anyNodeEncoder),w=g.cursor();w.firstNode();const O=w.chunkLength;for(let E=0;E<O;E++)p.encodeNodes(w,_,S);return(0,n.assert)(w.mode===1,3113),S}encodeShape(g,_){return{e:0}}countReferencedShapesAndIdentifiers(g,_){}get shape(){return this}}e.IncrementalChunkShape=b,e.incrementalFieldEncoder={encodeField(h,g,_){(0,n.assert)(g.shouldEncodeIncrementally,3114);const S=g.encodeIncrementalField(h,p=>b.encodeChunk(p,g));_.push(S)},shape:new l(new b)};function C(h,g,_){g===void 0?h!==void 0?_.push(!0,h):_.push(!1):g===!0?((0,n.assert)(h!==void 0,1933),_.push(h)):g===!1?(0,n.assert)(h===void 0,1855):Array.isArray(g)?(0,n.assert)(g.length===1,1856):g===r.SpecialField.Identifier?((0,n.assert)(h!==void 0,2456),_.push(h)):(0,n.unreachableCase)(g,"Encoding values as deltas is not yet supported")}e.encodeValue=C;class v{constructor(g,_,S,p,w){this.nodeEncoderFromPolicy=g,this.fieldEncoderFromPolicy=_,this.fieldShapes=S,this.idCompressor=p,this.incrementalEncoder=w,this.nodeEncodersFromSchema=new Map,this.nestedArrayEncoders=new Map}nodeEncoderFromSchema(g){return(0,t.getOrCreate)(this.nodeEncodersFromSchema,g,()=>this.nodeEncoderFromPolicy(this,g))}fieldEncoderFromSchema(g){return new m(this,g,this.fieldEncoderFromPolicy)}nestedArrayEncoder(g){return(0,t.getOrCreate)(this.nestedArrayEncoders,g,()=>new f(g))}get shouldEncodeIncrementally(){return this.incrementalEncoder!==void 0}encodeIncrementalField(g,_){(0,n.assert)(this.incrementalEncoder!==void 0,3115);const S=p=>{const w=_(p);return(0,i.updateShapesAndIdentifiersEncoding)(r.version,[w])};return this.incrementalEncoder.encodeIncrementalField(g,S)}}e.EncoderContext=v;class m{constructor(g,_,S){this.nodeBuilder=g,this.fieldSchema=_,this.fieldEncoderFromPolicy=S}encodeField(g,_,S){this.encoder.encodeField(g,_,S)}get encoder(){return this.encoderLazy===void 0&&(this.encoderLazy=this.fieldEncoderFromPolicy(this.nodeBuilder,this.fieldSchema)),this.encoderLazy}get shape(){return this.encoder.shape}}})(EM)),EM}var Nm={},k$;function Wve(){if(k$)return Nm;k$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Nm,"__esModule",{value:!0}),Nm.encodeFieldShapes=Nm.NodeShapeBasedEncoder=void 0;const e=Je(),n=fl(),a=Vt(),t=Bt(),i=gae(),r=yae();class s extends i.Shape{constructor(b,C,v,m){super(),this.type=b,this.value=C,this.specializedFieldEncoders=v,this.otherFieldsEncoder=m,this.specializedFieldKeys=new Set(this.specializedFieldEncoders.map(h=>h.key))}getValueToEncode(b,C){if(this.value===0&&((0,e.assert)(typeof b.value=="string",2474),(0,n.isStableId)(b.value))){const v=C.idCompressor.tryRecompress(b.value);if(v!==void 0)return C.idCompressor.normalizeToOpSpace(v)}return b.value}encodeNode(b,C,v){this.type===void 0?v.push(new i.IdentifierToken(b.type)):(0,e.assert)(b.type===this.type,1857),(0,r.encodeValue)(this.getValueToEncode(b,C),this.value,v);for(const h of this.specializedFieldEncoders)b.enterField((0,t.brand)(h.key)),h.encoder.encodeField(b,C,v),b.exitField();const m=[];(0,a.forEachField)(b,()=>{const h=b.getFieldKey();this.specializedFieldKeys.has(h)||((0,e.assert)(this.otherFieldsEncoder!==void 0,1858),m.push(new i.IdentifierToken(h)),this.otherFieldsEncoder.encodeField(b,C,m))}),this.otherFieldsEncoder!==void 0&&v.push(m)}encodeShape(b,C){return{c:{type:c(this.type,b),value:this.value,fields:o(this.specializedFieldEncoders,b,C),extraFields:d(this.otherFieldsEncoder,C)}}}countReferencedShapesAndIdentifiers(b,C){this.type!==void 0&&b.add(this.type);for(const v of this.specializedFieldEncoders)b.add(v.key),C(v.encoder.shape);this.otherFieldsEncoder!==void 0&&C(this.otherFieldsEncoder.shape)}get shape(){return this}}Nm.NodeShapeBasedEncoder=s;function o(f,b,C){if(f.length!==0)return f.map(v=>[u(v.key,b),C.valueToIndex.get(v.encoder.shape)??(0,e.fail)(2896)])}Nm.encodeFieldShapes=o;function u(f,b){return b.valueToIndex.get(f)??f}function c(f,b){return f===void 0?void 0:u(f,b)}function d(f,b){return f===void 0?void 0:l(f.shape,b)}function l(f,b){return b.valueToIndex.get(f)??(0,e.fail)(2897)}return Nm}var x$;function Jve(){if(x$)return Sa;x$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.oneFromSet=Sa.getNodeEncoder=Sa.getFieldEncoder=Sa.buildContext=Sa.schemaCompressedEncode=void 0;const e=Je(),n=Vt(),a=yae(),t=lb(),i=Wve();function r(l,f,b,C,v){return(0,a.compressedEncode)(b,s(l,f,C,v))}Sa.schemaCompressedEncode=r;function s(l,f,b,C){const v=new a.EncoderContext((m,h)=>u(m,l,h,C),(m,h)=>o(m,h,v,l),f.fieldKinds,b,C);return v}Sa.buildContext=s;function o(l,f,b,C){const v=b.fieldShapes.get(f.kind)??(0,e.fail)(2898),m=c(f.types),h=m!==void 0?l.nodeEncoderFromSchema(m):a.anyNodeEncoder;if(v.multiplicity===n.Multiplicity.Single){if(f.kind===n.identifierFieldKindIdentifier){(0,e.assert)(m!==void 0,2457);const g=C.nodeSchema.get(m);(0,e.assert)(g!==void 0,2458),(0,e.assert)(g instanceof n.LeafNodeStoredSchema,2459),(0,e.assert)(g.leafValue===n.ValueSchema.String,2460);const _=new i.NodeShapeBasedEncoder(m,t.SpecialField.Identifier,[],void 0);return(0,a.asFieldEncoder)(_)}return(0,a.asFieldEncoder)(h)}else return b.nestedArrayEncoder(h)}Sa.getFieldEncoder=o;function u(l,f,b,C){const v=f.nodeSchema.get(b)??(0,e.fail)(2899);if(v instanceof n.ObjectNodeStoredSchema){const m=(_,S)=>C?.shouldEncodeFieldIncrementally(_,S)??!1,h=[];for(const[_,S]of v.objectNodeFields??[]){const p=m(b,_)?a.incrementalFieldEncoder:l.fieldEncoderFromSchema(S);h.push({key:_,encoder:p})}return new i.NodeShapeBasedEncoder(b,!1,h,void 0)}if(v instanceof n.LeafNodeStoredSchema)return new i.NodeShapeBasedEncoder(b,d(v.leafValue),[],void 0);if(v instanceof n.MapNodeStoredSchema)return new i.NodeShapeBasedEncoder(b,!1,[],l.fieldEncoderFromSchema(v.mapFields));(0,e.fail)(2900)}Sa.getNodeEncoder=u;function c(l){if(l!==void 0&&l.size===1)for(const f of l)return f}Sa.oneFromSet=c;function d(l){switch(l){case void 0:return!1;case n.ValueSchema.Number:case n.ValueSchema.String:case n.ValueSchema.Boolean:case n.ValueSchema.FluidHandle:return!0;case n.ValueSchema.Null:return[null];default:(0,e.unreachableCase)(l)}}return Sa}var zS={},q$;function Qve(){if(q$)return zS;q$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(zS,"__esModule",{value:!0}),zS.uncompressedEncode=void 0;const e=Vt(),n=lb();function a(u){const c=u.map(o);return{version:n.version,identifiers:[],shapes:[{c:r},{a:s}],data:c.map(d=>[i,d])}}zS.uncompressedEncode=a;const t=0,i=1,r={extraFields:i},s=t;function o(u){const c=[];return(0,e.forEachNode)(u,()=>{c.push(u.type);const d=u.value;c.push(d!==void 0),d!==void 0&&c.push(d);const l=[];(0,e.forEachField)(u,()=>{const f=u.getFieldKey();l.push(f,o(u))}),c.push(l)}),c}return zS}var L$;function Yve(){if(L$)return Mm;L$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Mm,"__esModule",{value:!0}),Mm.makeFieldBatchCodec=Mm.fluidVersionToFieldBatchCodecWriteVersion=void 0;const e=Je(),n=zn(),a=Bt(),t=$E(),i=Gve(),r=lb(),s=Jve(),o=Qve();(0,a.brandedNumberType)({multipleOf:1,minimum:0});function u(d){return 1}Mm.fluidVersionToFieldBatchCodecWriteVersion=u;function c(d,l){return(0,e.assert)(r.validVersions.has(l),2357),(0,n.makeVersionedValidatedCodec)(d,r.validVersions,r.EncodedFieldBatch,{encode:(f,b)=>{for(const v of f)(0,e.assert)(v.mode===1,2211);let C;switch(b.encodeType){case t.TreeCompressionStrategy.Uncompressed:C=(0,o.uncompressedEncode)(f);break;case t.TreeCompressionStrategyExtended.CompressedIncremental:case t.TreeCompressionStrategy.Compressed:b.schema!==void 0?C=(0,s.schemaCompressedEncode)(b.schema.schema,b.schema.policy,f,b.idCompressor,b.encodeType===t.TreeCompressionStrategyExtended.CompressedIncremental?b.incrementalEncoderDecoder:void 0):C=(0,o.uncompressedEncode)(f);break;default:(0,e.unreachableCase)(b.encodeType)}return C},decode:(f,b)=>(0,i.decode)(f,{idCompressor:b.idCompressor,originatorId:b.originatorId},b.incrementalEncoderDecoder).map(C=>C.cursor())})}return Mm.makeFieldBatchCodec=c,Mm}var B$;function Xve(){return B$||(B$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.fluidVersionToFieldBatchCodecWriteVersion=e.makeFieldBatchCodec=e.EncodedFieldBatch=void 0;var n=lb();Object.defineProperty(e,"EncodedFieldBatch",{enumerable:!0,get:function(){return n.EncodedFieldBatch}});var a=Yve();Object.defineProperty(e,"makeFieldBatchCodec",{enumerable:!0,get:function(){return a.makeFieldBatchCodec}}),Object.defineProperty(e,"fluidVersionToFieldBatchCodecWriteVersion",{enumerable:!0,get:function(){return a.fluidVersionToFieldBatchCodecWriteVersion}})})(TM)),TM}var U$;function GE(){return U$||(U$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.emptyChunk=e.fluidVersionToFieldBatchCodecWriteVersion=e.makeFieldBatchCodec=e.EncodedFieldBatch=e.buildChunkedForest=e.chunkField=e.chunkFieldSingle=e.makeTreeChunker=e.defaultChunkPolicy=e.chunkTree=e.dummyRoot=e.ChunkShape=e.uniformChunk=void 0;var n=mae();Object.defineProperty(e,"uniformChunk",{enumerable:!0,get:function(){return n.uniformChunk}}),Object.defineProperty(e,"ChunkShape",{enumerable:!0,get:function(){return n.ChunkShape}});var a=Vt();Object.defineProperty(e,"dummyRoot",{enumerable:!0,get:function(){return a.dummyRoot}});var t=hq();Object.defineProperty(e,"chunkTree",{enumerable:!0,get:function(){return t.chunkTree}}),Object.defineProperty(e,"defaultChunkPolicy",{enumerable:!0,get:function(){return t.defaultChunkPolicy}}),Object.defineProperty(e,"makeTreeChunker",{enumerable:!0,get:function(){return t.makeTreeChunker}}),Object.defineProperty(e,"chunkFieldSingle",{enumerable:!0,get:function(){return t.chunkFieldSingle}}),Object.defineProperty(e,"chunkField",{enumerable:!0,get:function(){return t.chunkField}});var i=Hve();Object.defineProperty(e,"buildChunkedForest",{enumerable:!0,get:function(){return i.buildChunkedForest}});var r=Xve();Object.defineProperty(e,"EncodedFieldBatch",{enumerable:!0,get:function(){return r.EncodedFieldBatch}}),Object.defineProperty(e,"makeFieldBatchCodec",{enumerable:!0,get:function(){return r.makeFieldBatchCodec}}),Object.defineProperty(e,"fluidVersionToFieldBatchCodecWriteVersion",{enumerable:!0,get:function(){return r.fluidVersionToFieldBatchCodecWriteVersion}});var s=pae();Object.defineProperty(e,"emptyChunk",{enumerable:!0,get:function(){return s.emptyChunk}})})(_M)),_M}var IM={},RM={},FM={},Ca={},Am={},VS={},z$;function bae(){if(z$)return VS;z$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(VS,"__esModule",{value:!0}),VS.FlexFieldKind=void 0;class e{constructor(a,t){this.identifier=a,this.multiplicity=t}}return VS.FlexFieldKind=e,VS}var So={},V$;function gq(){if(V$)return So;V$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(So,"__esModule",{value:!0}),So.isNeverTreeRecursive=So.isNeverTree=So.isNeverFieldRecursive=So.isNeverField=void 0;const e=Je(),n=Vt();function a(s,o,u){return t(s,o,u,new Set)}So.isNeverField=a;function t(s,o,u,c){if((s.fieldKinds.get(u.kind)??(0,e.fail)(2844)).multiplicity===n.Multiplicity.Single&&u.types!==void 0){for(const d of u.types)if(!r(s,o,o.nodeSchema.get(d),c))return!1;return!0}return!1}So.isNeverFieldRecursive=t;function i(s,o,u){return r(s,o,u,new Set)}So.isNeverTree=i;function r(s,o,u,c){if(u===void 0||c.has(u))return!0;try{if(c.add(u),u instanceof n.MapNodeStoredSchema)return(s.fieldKinds.get(u.mapFields.kind)??(0,e.fail)(2845)).multiplicity===n.Multiplicity.Single;if(u instanceof n.ObjectNodeStoredSchema){for(const d of u.objectNodeFields.values())if(t(s,o,d,c))return!0;return!1}else return(0,e.assert)(u instanceof n.LeafNodeStoredSchema,2199),!1}finally{c.delete(u)}}return So.isNeverTreeRecursive=r,So}var H$;function WE(){if(H$)return Am;H$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Am,"__esModule",{value:!0}),Am.withEditor=Am.FieldKindWithEditor=void 0;const e=Je(),n=bae(),a=gq();class t extends n.FlexFieldKind{constructor(s,o,u,c,d){super(s,o),this.changeHandler=u,this.allowsTreeSupersetOf=c,this.handlesEditsFrom=d}allowsFieldSuperset(s,o,u,c){return(0,a.isNeverField)(s,o,{kind:this.identifier,types:u,persistedMetadata:void 0})?!0:(0,a.isNeverField)(s,o,c)?!1:this.allowsTreeSupersetOf(u,c)}}Am.FieldKindWithEditor=t;function i(r){return(0,e.assert)(r instanceof t,1973),r}return Am.withEditor=i,Am}var K$;function Zve(){if(K$)return Ca;K$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ca,"__esModule",{value:!0}),Ca.allowsRepoSuperset=Ca.allowsTreeSchemaIdentifierSuperset=Ca.allowsFieldSuperset=Ca.allowsValueSuperset=Ca.allowsTreeSuperset=void 0;const e=Je(),n=Vt(),a=Bt(),t=WE(),i=gq();function r(d,l,f,b){if((0,i.isNeverTree)(d,l,f))return!0;if((0,i.isNeverTree)(d,l,b))return!1;if((0,e.assert)(f!==void 0,1814),(0,e.assert)(b!==void 0,1815),f instanceof n.LeafNodeStoredSchema)return b instanceof n.LeafNodeStoredSchema?s(f.leafValue,b.leafValue):!1;if(b instanceof n.LeafNodeStoredSchema)return!1;if((0,e.assert)(f instanceof n.MapNodeStoredSchema||f instanceof n.ObjectNodeStoredSchema,2195),(0,e.assert)(b instanceof n.MapNodeStoredSchema||b instanceof n.ObjectNodeStoredSchema,2196),f instanceof n.MapNodeStoredSchema)return b instanceof n.MapNodeStoredSchema?o(d,l,f.mapFields,b.mapFields):!1;if((0,e.assert)(f instanceof n.ObjectNodeStoredSchema,2197),b instanceof n.MapNodeStoredSchema){for(const[C,v]of f.objectNodeFields)if(!o(d,l,v,b.mapFields))return!1;return!0}return(0,e.assert)(b instanceof n.ObjectNodeStoredSchema,2198),(0,a.compareSets)({a:f.objectNodeFields,b:b.objectNodeFields,aExtra:C=>o(d,l,f.objectNodeFields.get(C)??(0,e.fail)(2839),n.storedEmptyFieldSchema),bExtra:C=>o(d,l,n.storedEmptyFieldSchema,b.objectNodeFields.get(C)??(0,e.fail)(2840)),same:C=>o(d,l,f.objectNodeFields.get(C)??(0,e.fail)(2841),b.objectNodeFields.get(C)??(0,e.fail)(2842))})}Ca.allowsTreeSuperset=r;function s(d,l){return d===l}Ca.allowsValueSuperset=s;function o(d,l,f,b){return(0,t.withEditor)(d.fieldKinds.get(f.kind)??(0,e.fail)(2843)).allowsFieldSuperset(d,l,f.types,b)}Ca.allowsFieldSuperset=o;function u(d,l){for(const f of d)if(!l.has(f))return!1;return!0}Ca.allowsTreeSchemaIdentifierSuperset=u;function c(d,l,f){if(!o(d,l,l.rootFieldSchema,f.rootFieldSchema))return!1;for(const[b,C]of l.nodeSchema)if(!r(d,l,C,f.nodeSchema.get(b)))return!1;return!0}return Ca.allowsRepoSuperset=c,Ca}var Co={},$$;function vae(){if($$)return Co;$$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Co,"__esModule",{value:!0}),Co.CrossFieldTarget=Co.getFirstFromCrossFieldMap=Co.setInCrossFieldMap=Co.addCrossFieldQuery=void 0;function e(i,r,s,o){n(i,r,s,o,!0)}Co.addCrossFieldQuery=e;function n(i,r,s,o,u){i.set({revision:r,localId:s},o,u)}Co.setInCrossFieldMap=n;function a(i,r,s,o){return i.getFirst({revision:r,localId:s},o)}Co.getFirstFromCrossFieldMap=a;var t;return(function(i){i[i.Source=0]="Source",i[i.Destination=1]="Destination"})(t||(Co.CrossFieldTarget=t={})),Co}var jM={},G$;function yq(){return G$||(G$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncodedModularChangeset=e.EncodedBuilds=e.EncodedBuildsArray=e.CommitBuilds=e.EncodedTreeIndex=e.EncodedRevisionInfo=e.EncodedNodeChangeset=e.EncodedChangeAtomId=e.ChangesetLocalIdSchema=void 0;const n=Nr(),a=Vt(),t=Bt(),i=GE(),r={additionalProperties:!1};e.ChangesetLocalIdSchema=(0,t.brandedNumberType)({multipleOf:1}),e.EncodedChangeAtomId=n.Type.Union([n.Type.Tuple([e.ChangesetLocalIdSchema,a.RevisionTagSchema]),e.ChangesetLocalIdSchema]);const s=n.Type.Object({fieldKey:a.schemaFormatV1.FieldKeySchema,fieldKind:a.schemaFormatV1.FieldKindIdentifierSchema,change:t.JsonCompatibleReadOnlySchema},r),o=n.Type.Array(s),u=n.Type.Object({violated:n.Type.Boolean()},r);e.EncodedNodeChangeset=n.Type.Object({fieldChanges:n.Type.Optional(o),nodeExistsConstraint:n.Type.Optional(u)},r),e.EncodedRevisionInfo=n.Type.Object({revision:n.Type.Readonly(a.RevisionTagSchema),rollbackOf:n.Type.ReadonlyOptional(a.RevisionTagSchema)},r),e.EncodedTreeIndex=n.Type.Number({multipleOf:1,minimum:0}),e.CommitBuilds=n.Type.Array(n.Type.Tuple([e.ChangesetLocalIdSchema,e.EncodedTreeIndex])),e.EncodedBuildsArray=n.Type.Array(n.Type.Union([n.Type.Tuple([e.CommitBuilds,a.RevisionTagSchema]),n.Type.Tuple([e.CommitBuilds])])),e.EncodedBuilds=n.Type.Object({builds:e.EncodedBuildsArray,trees:i.EncodedFieldBatch},r),e.EncodedModularChangeset=n.Type.Object({maxId:n.Type.Optional(e.ChangesetLocalIdSchema),changes:o,revisions:n.Type.ReadonlyOptional(n.Type.Array(e.EncodedRevisionInfo)),builds:n.Type.Optional(e.EncodedBuilds),refreshers:n.Type.Optional(e.EncodedBuilds),violations:n.Type.Optional(n.Type.Number({minimum:0,multipleOf:1}))},r)})(jM)),jM}var Ru={},W$;function Sae(){if(W$)return Ru;W$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ru,"__esModule",{value:!0}),Ru.NodeAttachState=Ru.isolatedFieldChangeRebaser=Ru.referenceFreeFieldChangeRebaser=void 0;function e(t){return n({compose:(i,r,s,o)=>t.compose(i,r),invert:(i,r,s)=>t.invert(i),rebase:(i,r,s,o)=>t.rebase(i,r),mute:i=>t.mute(i)})}Ru.referenceFreeFieldChangeRebaser=e;function n(t){return{...t,prune:i=>i,replaceRevisions:i=>i}}Ru.isolatedFieldChangeRebaser=n;var a;return(function(t){t[t.Attached=0]="Attached",t[t.Detached=1]="Detached"})(a||(Ru.NodeAttachState=a={})),Ru}var MM={},HS={},NM={},J$;function e0e(){return J$||(J$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncodedGenericChangeset=e.EncodedGenericChange=void 0;const n=Nr(),a=i=>n.Type.Tuple([n.Type.Number({minimum:0,multipleOf:1}),i]);e.EncodedGenericChange=a;const t=i=>n.Type.Array((0,e.EncodedGenericChange)(i));e.EncodedGenericChangeset=t})(NM)),NM}var KS={},Q$;function Cae(){if(Q$)return KS;Q$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(KS,"__esModule",{value:!0}),KS.newGenericChangeset=void 0;const e=dl();function n(a=[]){return new e.BTree(a)}return KS.newGenericChangeset=n,KS}var Y$;function t0e(){if(Y$)return HS;Y$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(HS,"__esModule",{value:!0}),HS.makeGenericChangeCodec=void 0;const e=zn(),n=e0e(),a=Cae(),t=yq();function i(){return(0,e.makeCodecFamily)([[1,r()]])}HS.makeGenericChangeCodec=i;function r(){return{encode:(s,o)=>s.toArray().map(([c,d])=>[c,o.encodeNode(d)]),decode:(s,o)=>(0,a.newGenericChangeset)(s.map(([u,c])=>[u,o.decodeNode(c)])),encodedSchema:(0,n.EncodedGenericChangeset)(t.EncodedNodeChangeset)}}return HS}var X$;function bq(){return X$||(X$=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.convertGenericChange=e.genericFieldKind=e.genericChangeHandler=void 0;const n=Je(),a=dl(),t=Vt(),i=WE(),r=t0e(),s=Cae();e.genericChangeHandler={rebaser:{compose:o,invert:C=>C,rebase:c,prune:d,replaceRevisions:l,mute:C=>C},codecsFactory:r.makeGenericChangeCodec,editor:{buildChildChanges(C){return(0,s.newGenericChangeset)(Array.from(C))}},intoDelta:(C,v)=>{let m=0;const h=[];for(const[g,_]of C.entries()){if(m<g){const S=g-m;h.push({count:S}),m=g}h.push({count:1,fields:v(_)}),m+=1}return{local:h}},relevantRemovedRoots:b,isEmpty:C=>C.length===0,getNestedChanges:u,createEmpty:s.newGenericChangeset,getCrossFieldKeys:C=>[]};function o(C,v,m){const h=C.clone();for(const[g,_]of v.entries()){const S=h.get(g),p=S!==void 0?m(S,_):_;h.set(g,p)}return h}function u(C){return C.toArray().map(([v,m])=>[m,v,v])}function c(C,v,m){const h=new a.BTree;let g=0;for(;;){const _=C.getPairOrNextHigher(g),S=v.getPairOrNextHigher(g);if(S===void 0&&_===void 0)break;const p=_?.[0]??Number.POSITIVE_INFINITY,w=S?.[0]??Number.POSITIVE_INFINITY;let O,E,F;p===w?((0,n.assert)(_!==void 0&&S!==void 0,2573),F=p,O=_[1],E=S[1]):p<w?((0,n.assert)(_!==void 0,2574),F=p,O=_[1]):((0,n.assert)(S!==void 0,2575),F=w,E=S[1]);const R=m(O,E);R!==void 0&&h.set(F,R),g=F+1}return h}function d(C,v){const m=new a.BTree;for(const[h,g]of C.entries())v(g)!==void 0&&m.set(h,g);return m}function l(C,v,m){return C.mapValues(h=>(0,t.replaceAtomRevisions)(h,v,m))}e.genericFieldKind=new i.FieldKindWithEditor("ModularEditBuilder.Generic",t.Multiplicity.Sequence,e.genericChangeHandler,(C,v)=>!1,new Set);function f(C,v){return v.editor.buildChildChanges(C.entries())}e.convertGenericChange=f;function*b(C,v){for(const m of C.values())yield*v(m)}})(MM)),MM}var Kr={},$S={},Z$;function _ae(){if(Z$)return $S;Z$=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty($S,"__esModule",{value:!0}),$S.newCrossFieldKeyTable=void 0;const e=Vt(),n=Bt();function a(){return new n.RangeMap(t,i)}$S.newCrossFieldKeyTable=a;function t(r,s){return{...r,localId:(0,n.brand)(r.localId+s)}}function i(r,s){const o=r.target-s.target;return o!==0?o*Number.POSITIVE_INFINITY:(0,e.subtractChangeAtomIds)(r,s)}return $S}var e7;function n0e(){if(e7)return Kr;e7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.normalizeFieldId=Kr.getParentFieldId=Kr.ModularEditBuilder=Kr.getChangeHandler=Kr.getFieldKind=Kr.rebaseRevisionMetadataFromInfo=Kr.intoDelta=Kr.updateRefreshers=Kr.relevantRemovedRoots=Kr.ModularChangeFamily=void 0;const e=Je(),n=dl(),a=Vt(),t=Bt(),i=vae(),r=Sae(),s=WE(),o=bq(),u=_ae();class c{constructor(K,Z){this.codecs=Z,this.fieldKinds=K}get rebaser(){return this}normalizeFieldChanges(K,Z){const me=K.fieldKind!==o.genericFieldKind.identifier?K.fieldKind:Z.fieldKind;if(me===o.genericFieldKind.identifier)return{fieldKind:o.genericFieldKind.identifier,changeHandler:o.genericFieldKind.changeHandler,change1:K.change,change2:Z.change};const qe=E(this.fieldKinds,me).changeHandler,xe=this.normalizeFieldChange(K,qe),Oe=this.normalizeFieldChange(Z,qe);return{fieldKind:me,changeHandler:qe,change1:xe,change2:Oe}}normalizeFieldChange(K,Z){if(K.fieldKind!==o.genericFieldKind.identifier)return K.change;const me=K.change;return(0,o.convertGenericChange)(me,Z)}compose(K){const{revInfos:Z,maxId:me}=fe(K),we={maxId:me},qe=(Oe,He)=>this.composePair(Oe,He,Z,we),xe=K.map(Oe=>Oe.change);return(0,t.balancedReduce)(xe,qe,G)}composePair(K,Z,me,we){const{fieldChanges:qe,nodeChanges:xe,nodeToParent:Oe,nodeAliases:He,crossFieldKeys:Se}=this.composeAllFields(K,Z,me,we),{allBuilds:Ve,allDestroys:ot,allRefreshers:mt}=b(K,Z);return G({fieldChanges:qe,nodeChanges:xe,nodeToParent:Oe,nodeAliases:He,crossFieldKeys:Se,maxId:we.maxId,revisions:me,builds:Ve,destroys:ot,refreshers:mt})}composeAllFields(K,Z,me,we){const qe=this.getEffectiveChange(K),xe=this.getEffectiveChange(Z),Oe=(0,t.idAllocatorFromState)(we),He=(0,a.revisionMetadataSourceFromInfo)(me),Se=(0,t.brand)((0,t.mergeTupleBTrees)(qe.nodeChanges,xe.nodeChanges)),Ve=(0,t.brand)((0,t.mergeTupleBTrees)(qe.nodeToParent,xe.nodeToParent)),ot=(0,t.brand)((0,t.mergeTupleBTrees)(qe.nodeAliases,xe.nodeAliases)),mt=R(qe,xe,Ve),he=this.composeFieldMaps(qe.fieldChanges,xe.fieldChanges,void 0,Oe,mt,He);this.composeInvalidatedElements(mt,he,Se,Ve,ot,Oe,He);const Ue=t.RangeMap.union(qe.crossFieldKeys,xe.crossFieldKeys);return{fieldChanges:he,nodeChanges:Se,nodeToParent:Ve,nodeAliases:ot,crossFieldKeys:Ue}}composeInvalidatedField(K,Z,me,we){const qe=Z.fieldToContext.get(K);(0,e.assert)(qe!==void 0,2252);const{fieldId:xe,change1:Oe,change2:He,composedChange:Se}=qe,Ve=F(this.fieldKinds,Se.fieldKind).rebaser,ot=(he,Ue)=>(he!==void 0&&Ue!==void 0&&Re(Z.newToBaseNodeId,Ue)===void 0&&(Qe(Z.newToBaseNodeId,Ue,he),Z.pendingCompositions.nodeIdsToCompose.push([he,Ue])),he??Ue??(0,e.fail)(2850)),mt=Ve.compose(Oe,He,ot,me,new V(Z,K,xe,!1),we);Se.change=(0,t.brand)(mt)}composeInvalidatedElements(K,Z,me,we,qe,xe,Oe){const He=K.pendingCompositions;for(;K.invalidatedFields.size>0||He.nodeIdsToCompose.length>0||He.affectedBaseFields.length>0||He.affectedNewFields.length>0;){for(const[Se,Ve]of He.nodeIdsToCompose)this.composeNodesById(K.baseChange.nodeChanges,K.newChange.nodeChanges,me,we,qe,Se,Ve,xe,K,Oe);He.nodeIdsToCompose.length=0,this.composeAffectedFields(K,K.baseChange,!0,He.affectedBaseFields,Z,me,xe,Oe),this.composeAffectedFields(K,K.newChange,!1,He.affectedNewFields,Z,me,xe,Oe),this.processInvalidatedCompositions(K,xe,Oe)}}processInvalidatedCompositions(K,Z,me){const we=K.invalidatedFields;K.invalidatedFields=new Set;for(const qe of we)this.composeInvalidatedField(qe,K,Z,me)}composeAffectedFields(K,Z,me,we,qe,xe,Oe,He){for(const Se of we.keys()){const Ve=Nt(We(Se),Z.nodeAliases),ot=pe(Z.fieldChanges,Z.nodeChanges,Ve);if(K.fieldToContext.has(ot)||K.newFieldToBaseField.has(ot))continue;const mt=this.createEmptyFieldChange(ot.fieldKind),[he,Ue]=me?[ot,mt]:[mt,ot],Pe=this.composeFieldChanges(Ve,he,Ue,Oe,K,He);if(Ve.nodeId===void 0){qe.set(Ve.field,Pe);continue}const Ye=Re(K.newToBaseNodeId,Ve.nodeId)??Ve.nodeId;let ke=Fe(xe,Ye);K.composedNodes.has(ke)||(ke=Ze(ke),Qe(xe,Ye,ke)),ke.fieldChanges===void 0&&(ke.fieldChanges=new Map),ke.fieldChanges.set(Ve.field,Pe)}we.clear()}composeFieldMaps(K,Z,me,we,qe,xe){const Oe=new Map;if(K===void 0||Z===void 0)return K??Z??Oe;for(const[He,Se]of K){const Ve={nodeId:me,field:He},ot=Z.get(He),mt=ot!==void 0?this.composeFieldChanges(Ve,Se,ot,we,qe,xe):Se;Oe.set(He,mt)}for(const[He,Se]of Z)(K===void 0||!K.has(He))&&Oe.set(He,Se);return Oe}composeFieldChanges(K,Z,me,we,qe,xe){const{fieldKind:Oe,changeHandler:He,change1:Se,change2:Ve}=this.normalizeFieldChanges(Z,me),ot=new V(qe,Z,K),mt=He.rebaser.compose(Se,Ve,(Ue,Pe)=>(Ue!==void 0&&Pe!==void 0&&(Qe(qe.newToBaseNodeId,Pe,Ue),qe.pendingCompositions.nodeIdsToCompose.push([Ue,Pe])),Ue??Pe??(0,e.fail)(2851)),we,ot,xe),he={fieldKind:Oe,change:(0,t.brand)(mt)};return qe.fieldToContext.set(Z,{fieldId:K,change1:Se,change2:Ve,composedChange:he}),qe.newFieldToBaseField.set(me,Z),he}composeNodesById(K,Z,me,we,qe,xe,Oe,He,Se,Ve){const ot=Fe(K,xe),mt=Fe(Z,Oe),he=this.composeNodeChanges(xe,ot,mt,He,Se,Ve);Qe(me,xe,he),(0,a.areEqualChangeAtomIds)(xe,Oe)||(me.delete([Oe.revision,Oe.localId]),we.delete([Oe.revision,Oe.localId]),Qe(qe,Oe,xe),qe.delete([xe.revision,xe.localId])),Se.composedNodes.add(he)}composeNodeChanges(K,Z,me,we,qe,xe){const Oe=Z.nodeExistsConstraint??me.nodeExistsConstraint,He=Z.nodeExistsConstraintOnRevert??me.nodeExistsConstraintOnRevert,Se=this.composeFieldMaps(Z.fieldChanges,me.fieldChanges,K,we,qe,xe),Ve={};return Se.size>0&&(Ve.fieldChanges=Se),Oe!==void 0&&(Ve.nodeExistsConstraint=Oe),He!==void 0&&(Ve.nodeExistsConstraintOnRevert=He),Ve}invert(K,Z,me){const we=Z?C(K.change.builds):void 0;(0,e.assert)(K.change.destroys===void 0,2202);const qe=Z?[{revision:me,rollbackOf:K.revision}]:[{revision:me}];if(Ge(K.change))return G({maxId:K.change.maxId,revisions:qe,destroys:we});const xe=(0,t.idAllocatorFromMaxId)(K.change.maxId??-1),Oe={...M(),originalFieldToContext:new Map,invertedNodeToParent:(0,t.brand)(K.change.nodeToParent.clone())},{revInfos:He}=fe([K]),Se=(0,a.revisionMetadataSourceFromInfo)(He),Ve=this.invertFieldMap(K.change.fieldChanges,void 0,Z,xe,Oe,Se,me),ot=(0,t.newTupleBTree)();if(K.change.nodeChanges.forEachPair(([he,Ue],Pe)=>{ot.set([he,Ue],this.invertNodeChange(Pe,{revision:he,localId:Ue},Z,xe,Oe,Se,me))}),Oe.invalidatedFields.size>0){const he=Oe.invalidatedFields;Oe.invalidatedFields=new Set;for(const Ue of he){const Pe=Ue.change,Ye=Oe.originalFieldToContext.get(Ue);(0,e.assert)(Ye!==void 0,2129);const{invertedField:ke,fieldId:Rt}=Ye,Ft=F(this.fieldKinds,Ue.fieldKind).rebaser.invert(Pe,Z,xe,me,new x(Oe,Ue,Rt),Se);ke.change=(0,t.brand)(Ft)}}const mt=this.makeCrossFieldKeyTable(Ve,ot);return G({fieldChanges:Ve,nodeChanges:ot,nodeToParent:Oe.invertedNodeToParent,nodeAliases:K.change.nodeAliases,crossFieldKeys:mt,maxId:xe.getMaxId(),revisions:qe,constraintViolationCount:K.change.constraintViolationCountOnRevert,constraintViolationCountOnRevert:K.change.constraintViolationCount,destroys:we})}invertFieldMap(K,Z,me,we,qe,xe,Oe){const He=new Map;for(const[Se,Ve]of K){const ot={nodeId:Z,field:Se},mt=new x(qe,Ve,ot),he=F(this.fieldKinds,Ve.fieldKind).rebaser.invert(Ve.change,me,we,Oe,mt,xe),Ue={...Ve,change:(0,t.brand)(he)};He.set(Se,Ue),qe.originalFieldToContext.set(Ve,{fieldId:ot,invertedField:Ue})}return He}invertNodeChange(K,Z,me,we,qe,xe,Oe){const He={};return K.nodeExistsConstraint!==void 0&&(He.nodeExistsConstraintOnRevert=K.nodeExistsConstraint),K.nodeExistsConstraintOnRevert!==void 0&&(He.nodeExistsConstraint=K.nodeExistsConstraintOnRevert),K.fieldChanges!==void 0&&(He.fieldChanges=this.invertFieldMap(K.fieldChanges,Z,me,we,qe,xe,Oe)),He}rebase(K,Z,me){const we=(0,a.mapTaggedChange)(Z,this.getEffectiveChange(Z.change)),qe=K.change,Oe={maxId:Math.max(qe.maxId??-1,we.change.maxId??-1)},He=(0,t.idAllocatorFromState)(Oe),Se={...M(),newChange:qe,baseChange:we.change,baseFieldToContext:new Map,baseToRebasedNodeId:(0,t.newTupleBTree)(),rebasedFields:new Set,rebasedNodeToParent:(0,t.brand)(qe.nodeToParent.clone()),rebasedCrossFieldKeys:qe.crossFieldKeys.clone(),nodeIdPairs:[],affectedBaseFields:(0,t.newTupleBTree)(),fieldsWithUnattachedChild:new Set},ot={...me,getRevisionToRebase:()=>K.revision,getBaseRevisions:()=>oe(we).map(ke=>ke.revision)},mt=(0,t.brand)(qe.nodeChanges.clone()),he=this.rebaseIntersectingFields(Se,mt,He,ot);this.rebaseInvalidatedElements(he,mt,Se,ot,He);const Ue=j(qe.constraintViolationCount??0),Pe=j(qe.constraintViolationCountOnRevert??0);return this.updateConstraintsForFields(he,r.NodeAttachState.Attached,r.NodeAttachState.Attached,Ue,Pe,mt),G({fieldChanges:this.pruneFieldMap(he,mt),nodeChanges:mt,nodeToParent:Se.rebasedNodeToParent,nodeAliases:qe.nodeAliases,crossFieldKeys:Se.rebasedCrossFieldKeys,maxId:Oe.maxId,revisions:qe.revisions,constraintViolationCount:Ue.violationCount,constraintViolationCountOnRevert:Pe.violationCount,builds:qe.builds,destroys:qe.destroys,refreshers:qe.refreshers})}rebaseIntersectingFields(K,Z,me,we){const qe=K.newChange,xe=K.baseChange,Oe=this.rebaseFieldMap(qe.fieldChanges,xe.fieldChanges,void 0,me,K,we);for(const[He,Se,Ve]of K.nodeIdPairs){const ot=this.rebaseNodeChange(He,Se,me,K,we);Qe(Z,He,ot)}return Oe}rebaseFieldsWithoutNewChanges(K,Z,me,we,qe){const xe=me.baseChange;for(const[Oe,He,Se]of me.affectedBaseFields.keys()){const Ve=He!==void 0?Ke({revision:Oe,localId:He},xe.nodeAliases):void 0,ot=de(xe.fieldChanges,xe.nodeChanges,Ve).get(Se);if((0,e.assert)(ot!==void 0,2498),me.baseFieldToContext.has(ot))continue;const mt=(Ft,xt,zt)=>{(0,e.assert)(Ft===void 0,2499)},he=F(this.fieldKinds,ot.fieldKind),Ue={...ot,change:(0,t.brand)(he.createEmpty())},Ye={nodeId:Ve!==void 0?Ce(me,Ve):void 0,field:Se},ke=he.rebaser.rebase(Ue.change,ot.change,mt,we,new L(me,ot,Ye),qe),Rt={...ot,change:(0,t.brand)(ke)};me.baseFieldToContext.set(ot,{newChange:Ue,baseChange:ot,rebasedChange:Rt,fieldId:Ye,baseNodeIds:[]}),me.rebasedFields.add(Rt),this.attachRebasedField(K,Z,me,Rt,Ye,we,qe)}}rebaseInvalidatedElements(K,Z,me,we,qe){this.rebaseFieldsWithoutNewChanges(K,Z,me,qe,we),this.rebaseFieldsWithUnattachedChild(me,we,qe),this.rebaseInvalidatedFields(me,we,qe)}rebaseInvalidatedFields(K,Z,me){const we=K.invalidatedFields;K.invalidatedFields=new Set;for(const qe of we)this.rebaseInvalidatedField(qe,K,Z,me)}rebaseFieldsWithUnattachedChild(K,Z,me){for(const we of K.fieldsWithUnattachedChild)K.invalidatedFields.delete(we),this.rebaseInvalidatedField(we,K,Z,me,!0)}rebaseInvalidatedField(K,Z,me,we,qe=!1){const xe=Z.baseFieldToContext.get(K);(0,e.assert)(xe!==void 0,2130);const{changeHandler:Oe,change1:He,change2:Se}=this.normalizeFieldChanges(xe.newChange,xe.baseChange),Ve=(ot,mt)=>{if(ot!==void 0)return ot;if(mt!==void 0){for(const he of xe.baseNodeIds)if((0,a.areEqualChangeAtomIds)(mt,he))return mt}};xe.rebasedChange.change=(0,t.brand)(Oe.rebaser.rebase(He,Se,Ve,we,new L(Z,K,xe.fieldId,qe),me))}attachRebasedField(K,Z,me,we,{nodeId:qe,field:xe},Oe,He){if(qe===void 0){K.set(xe,we);return}const Se=Re(Z,qe);if(Se!==void 0){if(Se.fieldChanges===void 0){Se.fieldChanges=new Map([[xe,we]]);return}(0,e.assert)(!Se.fieldChanges.has(xe),2500),Se.fieldChanges.set(xe,we);return}Qe(Z,qe,{fieldChanges:new Map([[xe,we]])}),Qe(me.baseToRebasedNodeId,qe,qe);const ot=ut(me.baseChange,qe);this.attachRebasedNode(K,Z,me,qe,ot,Oe,He)}attachRebasedNode(K,Z,me,we,qe,xe,Oe){const He=pe(me.baseChange.fieldChanges,me.baseChange.nodeChanges,qe),Se=ge(me,qe);Qe(me.rebasedNodeToParent,we,Se);const Ve=me.baseFieldToContext.get(He);if(Ve!==void 0){Ve.baseNodeIds.push(we),me.fieldsWithUnattachedChild.add(He);return}const ot=F(this.fieldKinds,He.fieldKind),mt={...He,change:(0,t.brand)(ot.createEmpty())},he=ot.rebaser.rebase(ot.createEmpty(),He.change,(Pe,Ye)=>Ye!==void 0&&(0,a.areEqualChangeAtomIds)(Ye,we)?we:void 0,xe,new L(me,He,Se),Oe),Ue={...He,change:(0,t.brand)(he)};me.rebasedFields.add(Ue),me.baseFieldToContext.set(He,{newChange:mt,baseChange:He,rebasedChange:Ue,fieldId:Se,baseNodeIds:[]}),this.attachRebasedField(K,Z,me,Ue,Se,xe,Oe)}rebaseFieldMap(K,Z,me,we,qe,xe){const Oe=new Map,He=(Se,Ve,ot)=>(Se!==void 0&&Ve!==void 0&&qe.nodeIdPairs.push([Se,Ve,ot]),Se);for(const[Se,Ve]of K){const ot={nodeId:me,field:Se},mt=Z.get(Se);if(mt===void 0){Oe.set(Se,Ve);continue}const{fieldKind:he,changeHandler:Ue,change1:Pe,change2:Ye}=this.normalizeFieldChanges(Ve,mt),ke=new L(qe,mt,ot),Rt=Ue.rebaser.rebase(Pe,Ye,He,we,ke,xe),Ft={fieldKind:he,change:(0,t.brand)(Rt)};Oe.set(Se,Ft),qe.baseFieldToContext.set(mt,{baseChange:mt,newChange:Ve,rebasedChange:Ft,fieldId:ot,baseNodeIds:[]}),qe.rebasedFields.add(Ft)}return Oe}rebaseNodeChange(K,Z,me,we,qe){const xe=Fe(we.newChange.nodeChanges,K),Oe=Fe(we.baseChange.nodeChanges,Z),He=Oe?.fieldChanges??new Map,Se=xe.fieldChanges!==void 0&&Oe.fieldChanges!==void 0?this.rebaseFieldMap(xe?.fieldChanges??new Map,He,K,me,we,qe):xe.fieldChanges,Ve={};return Se!==void 0&&Se.size>0&&(Ve.fieldChanges=Se),xe?.nodeExistsConstraint!==void 0&&(Ve.nodeExistsConstraint=xe.nodeExistsConstraint),xe?.nodeExistsConstraintOnRevert!==void 0&&(Ve.nodeExistsConstraintOnRevert=xe.nodeExistsConstraintOnRevert),Qe(we.baseToRebasedNodeId,Z,K),Ve}updateConstraintsForFields(K,Z,me,we,qe,xe){for(const Oe of K.values()){const He=F(this.fieldKinds,Oe.fieldKind);for(const[Se,Ve,ot]of He.getNestedChanges(Oe.change)){const mt=Ve===void 0,he=Z===r.NodeAttachState.Detached||mt?r.NodeAttachState.Detached:r.NodeAttachState.Attached,Ue=ot===void 0,Pe=me===r.NodeAttachState.Detached||Ue?r.NodeAttachState.Detached:r.NodeAttachState.Attached;this.updateConstraintsForNode(Se,he,Pe,xe,we,qe)}}}updateConstraintsForNode(K,Z,me,we,qe,xe){const Oe=we.get([K.revision,K.localId])??(0,e.fail)(2852);if(Oe.nodeExistsConstraint!==void 0){const He=Z===r.NodeAttachState.Detached;Oe.nodeExistsConstraint.violated!==He&&(Oe.nodeExistsConstraint={...Oe.nodeExistsConstraint,violated:He},qe.violationCount+=He?1:-1)}if(Oe.nodeExistsConstraintOnRevert!==void 0){const He=me===r.NodeAttachState.Detached;Oe.nodeExistsConstraintOnRevert.violated!==He&&(Oe.nodeExistsConstraintOnRevert={...Oe.nodeExistsConstraintOnRevert,violated:He},xe.violationCount+=He?1:-1)}Oe.fieldChanges!==void 0&&this.updateConstraintsForFields(Oe.fieldChanges,Z,me,qe,xe,we)}pruneFieldMap(K,Z){if(K===void 0)return;const me=new Map;for(const[we,qe]of K){const xe=F(this.fieldKinds,qe.fieldKind),Oe=xe.rebaser.prune(qe.change,He=>this.pruneNodeChange(He,Z));xe.isEmpty(Oe)||me.set(we,{...qe,change:(0,t.brand)(Oe)})}return me.size>0?me:void 0}pruneNodeChange(K,Z){const me=Fe(Z,K),we=me.fieldChanges!==void 0?this.pruneFieldMap(me.fieldChanges,Z):void 0,qe={...me,fieldChanges:we};if(qe.fieldChanges===void 0&&delete qe.fieldChanges,O(qe)){Z.delete([K.revision,K.localId]);return}else return Qe(Z,K,qe),K}changeRevision(K,Z,me){const we=new Set(K.revisions===void 0||K.revisions.length===0?[void 0]:K.revisions.map(Se=>Se.revision)),qe=this.replaceFieldMapRevisions(K.fieldChanges,we,Z),xe=(0,t.newTupleBTree)();for(const[[Se,Ve],ot]of K.nodeChanges.entries())xe.set([l(Se,we,Z),Ve],this.replaceNodeChangesetRevisions(ot,we,Z));const Oe=(0,t.newTupleBTree)();for(const[[Se,Ve],ot]of K.nodeToParent.entries())Oe.set([l(Se,we,Z),Ve],lt(Nt(ot,K.nodeAliases),we,Z));const He={...K,fieldChanges:qe,nodeChanges:xe,nodeToParent:Oe,nodeAliases:(0,t.newTupleBTree)(),crossFieldKeys:d(K.crossFieldKeys,we,Z,K.nodeAliases)};if(K.builds!==void 0&&(He.builds=f(K.builds,we,Z)),K.destroys!==void 0&&(He.destroys=f(K.destroys,we,Z)),K.refreshers!==void 0&&(He.refreshers=f(K.refreshers,we,Z)),Z!==void 0){const Se={revision:Z};me!==void 0&&(Se.rollbackOf=me),He.revisions=[Se]}else delete He.revisions;return He}replaceNodeChangesetRevisions(K,Z,me){const we={...K};return K.fieldChanges!==void 0&&(we.fieldChanges=this.replaceFieldMapRevisions(K.fieldChanges,Z,me)),we}replaceFieldMapRevisions(K,Z,me){const we=new Map;for(const[qe,xe]of K){const Oe=F(this.fieldKinds,xe.fieldKind).rebaser.replaceRevisions(xe.change,Z,me);we.set(qe,{...xe,change:(0,t.brand)(Oe)})}return we}makeCrossFieldKeyTable(K,Z){const me=(0,u.newCrossFieldKeyTable)();return this.populateCrossFieldKeyTableForFieldMap(me,K,void 0),Z.forEachPair(([we,qe],xe)=>{xe.fieldChanges!==void 0&&this.populateCrossFieldKeyTableForFieldMap(me,xe.fieldChanges,{revision:we,localId:qe})}),me}populateCrossFieldKeyTableForFieldMap(K,Z,me){for(const[we,qe]of Z){const xe=F(this.fieldKinds,qe.fieldKind).getCrossFieldKeys(qe.change);for(const{key:Oe,count:He}of xe)K.set(Oe,He,{nodeId:me,field:we})}}buildEditor(K){return new ee(this,this.fieldKinds,K)}createEmptyFieldChange(K){const Z=F(this.fieldKinds,K).createEmpty();return{fieldKind:K,change:(0,t.brand)(Z)}}validateChangeset(K){let Z=this.validateFieldChanges(K,K.fieldChanges,void 0);for(const[[me,we],qe]of K.nodeChanges.entries()){if(qe.fieldChanges===void 0)continue;const xe={revision:me,localId:we},Oe=this.validateFieldChanges(K,qe.fieldChanges,xe);Z+=Oe}(0,e.assert)(Z===K.nodeChanges.size,2637)}validateFieldChanges(K,Z,me){let we=0;for(const[qe,xe]of Z.entries()){const Oe={nodeId:me,field:qe},He=F(this.fieldKinds,xe.fieldKind);for(const[Se,Ve]of He.getNestedChanges(xe.change)){const ot=ut(K,Se);(0,e.assert)(Y(ot,Oe),2638),we+=1}for(const Se of He.getCrossFieldKeys(xe.change)){const Ve=pt(K,Se.key,Se.count);(0,e.assert)(Ve.length===1&&Ve[0]!==void 0&&Y(Ve[0],Oe),2639)}}return we}getEffectiveChange(K){return Ge(K)?this.muteChange(K):K}muteChange(K){return{...K,crossFieldKeys:(0,u.newCrossFieldKeyTable)(),fieldChanges:this.muteFieldChanges(K.fieldChanges),nodeChanges:(0,t.brand)(K.nodeChanges.mapValues(me=>this.muteNodeChange(me)))}}muteNodeChange(K){return K.fieldChanges===void 0?K:{...K,fieldChanges:this.muteFieldChanges(K.fieldChanges)}}muteFieldChanges(K){return new Map(Array.from(K.entries(),([Z,me])=>[Z,this.muteFieldChange(me)]))}muteFieldChange(K){const Z=F(this.fieldKinds,K.fieldKind);return{fieldKind:K.fieldKind,change:(0,t.brand)(Z.rebaser.mute(K.change))}}}Kr.ModularChangeFamily=c,c.emptyChange=G();function d(Me,K,Z,me){const we=(0,u.newCrossFieldKeyTable)();for(const qe of Me.entries()){const xe=qe.start,Oe={target:xe.target,revision:l(xe.revision,K,Z),localId:xe.localId},He=qe.value,Se=Nt(He,me),Ve=Se.nodeId!==void 0?(0,a.replaceAtomRevisions)(Se.nodeId,K,Z):void 0,ot={...Se,nodeId:Ve};we.set(Oe,qe.length,ot)}return we}function l(Me,K,Z){return K.has(Me)?Z:Me}function f(Me,K,Z){const me=(0,t.newTupleBTree)();for(const[[we,qe],xe]of Me.entries())me.set([l(we,K,Z),qe],xe);return me}function b(Me,K){const Z=(0,t.brand)((0,t.mergeTupleBTrees)(Me.builds??(0,t.newTupleBTree)(),K.builds??(0,t.newTupleBTree)(),!0)),me=(0,t.brand)((0,t.mergeTupleBTrees)(Me.destroys??(0,t.newTupleBTree)(),K.destroys??(0,t.newTupleBTree)())),we=(0,t.brand)((0,t.mergeTupleBTrees)(Me.refreshers??(0,t.newTupleBTree)(),K.refreshers??(0,t.newTupleBTree)(),!0));if(Me.destroys!==void 0&&K.builds!==void 0)for(const[qe,xe]of K.builds.entries()){const Oe=Me.destroys.get(qe);Oe!==void 0&&((0,e.assert)(Oe===xe.topLevelLength,2203),Z.delete(qe),me.delete(qe))}if(Me.builds!==void 0&&K.destroys!==void 0)for(const[qe,xe]of Me.builds.entries()){const Oe=K.destroys.get(qe);Oe!==void 0&&((0,e.assert)(Oe===xe.topLevelLength,2544),Z.delete(qe),me.delete(qe))}return{allBuilds:Z,allDestroys:me,allRefreshers:we}}function C(Me){if(Me!==void 0)return(0,t.brand)(Me.mapValues(K=>K.topLevelLength))}function*v(Me,K){yield*m(Me.fieldChanges,Me.nodeChanges,K)}Kr.relevantRemovedRoots=v;function*m(Me,K,Z){for(const[me,we]of Me){const qe=F(Z,we.fieldKind),xe=function*(Oe){const He=Fe(K,Oe);He.fieldChanges!==void 0&&(yield*m(He.fieldChanges,K,Z))};yield*qe.relevantRemovedRoots(we.change,xe)}}function h(Me,K,Z,me=!0){const we=(0,t.newTupleBTree)(),qe=new Map;if(Me.builds!==void 0)for(const[[Ue,Pe],Ye]of Me.builds.entries())(0,t.getOrCreate)(qe,Ue,()=>new n.BTree).set(Pe,Ye.topLevelLength);for(const Ue of Z){if(Me.builds!==void 0){const Ye=qe.get(Ue.major);if(Ye!==void 0){const ke=Ye.getPairOrNextLower(Ue.minor);if(ke!==void 0){const[Rt,Ft]=ke;if(Ue.minor<Rt+Ft)continue}}}const Pe=K(Ue);Pe===void 0?(0,e.assert)(!me,2253):we.set([Ue.major,(0,t.brand)(Ue.minor)],Pe)}const{fieldChanges:xe,nodeChanges:Oe,maxId:He,revisions:Se,constraintViolationCount:Ve,constraintViolationCountOnRevert:ot,builds:mt,destroys:he}=Me;return G({fieldChanges:xe,nodeChanges:Oe,nodeToParent:Me.nodeToParent,nodeAliases:Me.nodeAliases,crossFieldKeys:Me.crossFieldKeys,maxId:He,revisions:Se,constraintViolationCount:Ve,constraintViolationCountOnRevert:ot,builds:mt,destroys:he,refreshers:we})}Kr.updateRefreshers=h;function g(Me,K){const Z=Me.change,me={},we=[],qe=[];if(!Ge(Z)){const xe=S(Z.fieldChanges,Z.nodeChanges,K,we,qe);xe.size>0&&(me.fields=xe),we.length>0&&(me.global=we),qe.length>0&&(me.rename=qe)}if(Z.builds&&Z.builds.size>0&&(me.build=_(Z.builds)),Z.destroys!==void 0&&Z.destroys.size>0){const xe=[];for(const[[Oe,He],Se]of Z.destroys.entries())xe.push({id:(0,a.makeDetachedNodeId)(Oe,He),count:Se});me.destroy=xe}return Z.refreshers&&Z.refreshers.size>0&&(me.refreshers=_(Z.refreshers)),me}Kr.intoDelta=g;function _(Me){const K=[];for(const[[Z,me],we]of Me.entries())we.topLevelLength>0&&(we.referenceAdded(),K.push({id:(0,a.makeDetachedNodeId)(Z,me),trees:we}));return K.length>0?K:void 0}function S(Me,K,Z,me,we){const qe=new Map;for(const[xe,Oe]of Me){const{local:He,global:Se,rename:Ve}=F(Z,Oe.fieldKind).intoDelta(Oe.change,ot=>{const mt=Fe(K,ot);return p(mt,K,Z,me,we)});He!==void 0&&He.length>0&&qe.set(xe,He),Se?.forEach(ot=>me.push(ot)),Ve?.forEach(ot=>we.push(ot))}return qe}function p(Me,K,Z,me,we){return Me.fieldChanges!==void 0?S(Me.fieldChanges,K,Z,me,we):new Map}function w(Me,K,Z){const me=[];for(const qe of Z)qe!==void 0&&me.push(qe);const we=()=>me;return{...(0,a.revisionMetadataSourceFromInfo)(Me),getRevisionToRebase:()=>K,getBaseRevisions:we}}Kr.rebaseRevisionMetadataFromInfo=w;function O(Me){return Me.fieldChanges===void 0&&Me.nodeExistsConstraint===void 0&&Me.nodeExistsConstraintOnRevert===void 0}function E(Me,K){if(K===o.genericFieldKind.identifier)return o.genericFieldKind;const Z=Me.get(K);return(0,e.assert)(Z!==void 0,941),(0,s.withEditor)(Z)}Kr.getFieldKind=E;function F(Me,K){return E(Me,K).changeHandler}Kr.getChangeHandler=F;function R(Me,K,Z){return{...M(),baseChange:Me,newChange:K,fieldToContext:new Map,newFieldToBaseField:new Map,newToBaseNodeId:(0,t.newTupleBTree)(),composedNodes:new Set,composedNodeToParent:Z,pendingCompositions:{nodeIdsToCompose:[],affectedBaseFields:(0,t.newTupleBTree)(),affectedNewFields:(0,t.newTupleBTree)()}}}function M(){return{srcTable:(0,a.newChangeAtomIdRangeMap)(),dstTable:(0,a.newChangeAtomIdRangeMap)(),srcDependents:(0,a.newChangeAtomIdRangeMap)(),dstDependents:(0,a.newChangeAtomIdRangeMap)(),invalidatedFields:new Set}}function j(Me){return{violationCount:Me}}class k{constructor(K,Z,me=!0){this.crossFieldTable=K,this.currentFieldKey=Z,this.allowInval=me}set(K,Z,me,we,qe,xe){if(xe&&this.allowInval){const Oe=me+we-1;let He=me;for(;He<=Oe;){const Se=(0,i.getFirstFromCrossFieldMap)(this.getDependents(K),Z,He,Oe-He+1);Se.value!==void 0&&this.crossFieldTable.invalidatedFields.add(Se.value),He=(0,t.brand)(He+Se.length)}}(0,i.setInCrossFieldMap)(this.getMap(K),Z,me,we,qe)}get(K,Z,me,we,qe){return qe&&(0,i.setInCrossFieldMap)(this.getDependents(K),Z,me,we,this.currentFieldKey),(0,i.getFirstFromCrossFieldMap)(this.getMap(K),Z,me,we)}getMap(K){return K===i.CrossFieldTarget.Source?this.crossFieldTable.srcTable:this.crossFieldTable.dstTable}getDependents(K){return K===i.CrossFieldTarget.Source?this.crossFieldTable.srcDependents:this.crossFieldTable.dstDependents}}class x extends k{constructor(K,Z,me,we=!0){super(K,Z,we),this.fieldId=me}onMoveIn(K){Qe(this.table.invertedNodeToParent,K,this.fieldId)}moveKey(K,Z,me,we){(0,e.assert)(!1,2501)}get table(){return this.crossFieldTable}}class L extends k{constructor(K,Z,me,we=!0){super(K,Z,we),this.fieldId=me}set(K,Z,me,we,qe,xe){if(xe&&this.allowInval){const Oe=pt(this.table.newChange,{target:K,revision:Z,localId:me},we);(0,e.assert)(Oe.length===0,2502);const He=pt(this.table.baseChange,{target:K,revision:Z,localId:me},we);(0,e.assert)(He.length>0,2503);for(const Se of He)this.table.affectedBaseFields.set([Se.nodeId?.revision,Se.nodeId?.localId,Se.field],!0)}super.set(K,Z,me,we,qe,xe)}onMoveIn(K){Qe(this.table.rebasedNodeToParent,K,this.fieldId)}moveKey(K,Z,me,we){this.table.rebasedCrossFieldKeys.set({target:K,revision:Z,localId:me},we,this.fieldId)}get table(){return this.crossFieldTable}}class V extends k{constructor(K,Z,me,we=!0){super(K,Z,we),this.fieldId=me}set(K,Z,me,we,qe,xe){if(xe&&this.allowInval){const Oe=pt(this.table.newChange,{target:K,revision:Z,localId:me},we);if(Oe.length>0)for(const He of Oe)this.table.pendingCompositions.affectedNewFields.set([He.nodeId?.revision,He.nodeId?.localId,He.field],!0);else{const He=pt(this.table.baseChange,{target:K,revision:Z,localId:me},we);(0,e.assert)(He.length>0,2504);for(const Se of He)this.table.pendingCompositions.affectedBaseFields.set([Se.nodeId?.revision,Se.nodeId?.localId,Se.field],!0)}}super.set(K,Z,me,we,qe,xe)}onMoveIn(K){Qe(this.table.composedNodeToParent,K,this.fieldId)}moveKey(K,Z,me,we){throw new Error("Moving cross-field keys during compose is currently unsupported")}get table(){return this.crossFieldTable}}function G(Me={maxId:-1}){const K={fieldChanges:Me.fieldChanges??new Map,nodeChanges:Me.nodeChanges??(0,t.newTupleBTree)(),nodeToParent:Me.nodeToParent??(0,t.newTupleBTree)(),nodeAliases:Me.nodeAliases??(0,t.newTupleBTree)(),crossFieldKeys:Me.crossFieldKeys??(0,u.newCrossFieldKeyTable)()};return Me.revisions!==void 0&&Me.revisions.length>0&&(K.revisions=Me.revisions),Me.maxId>=0&&(K.maxId=(0,t.brand)(Me.maxId)),Me.constraintViolationCount!==void 0&&Me.constraintViolationCount>0&&(K.constraintViolationCount=Me.constraintViolationCount),Me.constraintViolationCountOnRevert!==void 0&&Me.constraintViolationCountOnRevert>0&&(K.constraintViolationCountOnRevert=Me.constraintViolationCountOnRevert),Me.builds!==void 0&&Me.builds.size>0&&(K.builds=Me.builds),Me.destroys!==void 0&&Me.destroys.size>0&&(K.destroys=Me.destroys),Me.refreshers!==void 0&&Me.refreshers.size>0&&(K.refreshers=Me.refreshers),K}class ee extends a.EditBuilder{constructor(K,Z,me){super(K,me),this.fieldKinds=Z,this.transactionDepth=0,this.idAllocator=(0,t.idAllocatorFromMaxId)()}enterTransaction(){this.transactionDepth+=1,this.transactionDepth===1&&(this.idAllocator=(0,t.idAllocatorFromMaxId)())}exitTransaction(){(0,e.assert)(this.transactionDepth>0,1465),this.transactionDepth-=1,this.transactionDepth===0&&(this.idAllocator=(0,t.idAllocatorFromMaxId)())}buildTrees(K,Z,me){if(Z.topLevelLength===0)return{type:"global",revision:me};Z.referenceAdded();const we=(0,t.newTupleBTree)();return we.set([me,K],Z),{type:"global",builds:we,revision:me}}submitChange(K,Z,me,we){const qe=F(this.fieldKinds,Z).getCrossFieldKeys(me),xe=se({path:K,fieldChange:{fieldKind:Z,change:me},nodeChanges:(0,t.newTupleBTree)(),nodeToParent:(0,t.newTupleBTree)(),crossFieldKeys:(0,u.newCrossFieldKeyTable)(),idAllocator:this.idAllocator,localCrossFieldKeys:qe,revision:we});this.applyChange((0,a.tagChange)(xe,we))}submitChanges(K,Z){const me=this.buildChanges(K);this.applyChange((0,a.tagChange)(me,Z))}buildChanges(K){const Z=new Set,me=K.map(Oe=>(Z.add(Oe.revision),(0,a.makeAnonChange)(Oe.type==="global"?G({maxId:this.idAllocator.getMaxId(),builds:Oe.builds,revisions:[{revision:Oe.revision}]}):se({path:Oe.field,fieldChange:{fieldKind:Oe.fieldKind,change:Oe.change},nodeChanges:(0,t.newTupleBTree)(),nodeToParent:(0,t.newTupleBTree)(),crossFieldKeys:(0,u.newCrossFieldKeyTable)(),idAllocator:this.idAllocator,localCrossFieldKeys:F(this.fieldKinds,Oe.fieldKind).getCrossFieldKeys(Oe.change),revision:Oe.revision})))),we=Array.from(Z).map(Oe=>({revision:Oe})),qe={...this.changeFamily.rebaser.compose(me),revisions:we},xe=(0,t.brand)(this.idAllocator.getMaxId());return xe>=0&&(qe.maxId=xe),qe}generateId(K){return(0,t.brand)(this.idAllocator.allocate(K))}addNodeExistsConstraint(K,Z){const me={nodeExistsConstraint:{violated:!1}};this.applyChange((0,a.tagChange)(re({path:K,nodeChange:me,nodeChanges:(0,t.newTupleBTree)(),nodeToParent:(0,t.newTupleBTree)(),crossFieldKeys:(0,u.newCrossFieldKeyTable)(),idAllocator:this.idAllocator,revision:Z}),Z))}addNodeExistsConstraintOnRevert(K,Z){const me={nodeExistsConstraintOnRevert:{violated:!1}};this.applyChange((0,a.tagChange)(re({path:K,nodeChange:me,nodeChanges:(0,t.newTupleBTree)(),nodeToParent:(0,t.newTupleBTree)(),crossFieldKeys:(0,u.newCrossFieldKeyTable)(),idAllocator:this.idAllocator,revision:Z}),Z))}}Kr.ModularEditBuilder=ee;function se(Me){const{path:K,fieldChange:Z,nodeChanges:me,nodeToParent:we,crossFieldKeys:qe,idAllocator:xe=(0,t.idAllocatorFromMaxId)(),localCrossFieldKeys:Oe=[],childId:He,revision:Se}=Me,Ve=new Map([[K.field,Z]]);if(K.parent===void 0){for(const{key:he,count:Ue}of Oe)qe.set(he,Ue,{nodeId:void 0,field:K.field});return He!==void 0&&Qe(we,He,{nodeId:void 0,field:K.field}),G({fieldChanges:Ve,nodeChanges:me,nodeToParent:we,crossFieldKeys:qe,maxId:xe.getMaxId(),revisions:[{revision:Se}]})}const ot={fieldChanges:Ve},mt={localId:(0,t.brand)(xe.allocate()),revision:Se};for(const{key:he,count:Ue}of Oe)qe.set(he,Ue,{nodeId:mt,field:K.field});return He!==void 0&&Qe(we,He,{nodeId:mt,field:K.field}),re({path:K.parent,nodeChange:ot,nodeChanges:me,nodeToParent:we,crossFieldKeys:qe,idAllocator:xe,revision:Se,nodeId:mt})}function re(Me){const{path:K,nodeId:Z={localId:(0,t.brand)(Me.idAllocator.allocate()),revision:Me.revision}}=Me;Qe(Me.nodeChanges,Z,Me.nodeChange);const me=o.genericFieldKind.changeHandler.editor.buildChildChanges([[K.parentIndex,Z]]),we={fieldKind:o.genericFieldKind.identifier,change:me};return se({...Me,path:{parent:K.parent,field:K.parentField},fieldChange:we,localCrossFieldKeys:[],childId:Z})}function fe(Me){let K=-1;const Z=[];for(const qe of Me){const xe=qe.change;K=Math.max(xe.maxId??-1,K),Z.push(...oe(qe))}const me=new Set,we=[];for(const qe of Z)me.add(qe.revision),qe.rollbackOf!==void 0&&we.push(qe.rollbackOf);we.reverse();for(const qe of we)me.has(qe)||Z.push({revision:qe});return{maxId:(0,t.brand)(K),revInfos:Z}}function oe(Me){const K=[];if(Me.change.revisions!==void 0)K.push(...Me.change.revisions);else if(Me.revision!==void 0){const Z={revision:Me.revision};Me.rollbackOf!==void 0&&(Z.rollbackOf=Me.rollbackOf),K.push(Z)}return K}function pe(Me,K,Z){return de(Me,K,Z.nodeId).get(Z.field)??(0,e.fail)(2853)}function de(Me,K,Z){if(Z===void 0)return Me;const me=Fe(K,Z);return(0,e.assert)(me.fieldChanges!==void 0,2505),me.fieldChanges}function ge(Me,K){return K.nodeId===void 0?K:{...K,nodeId:Ce(Me,K.nodeId)}}function Ce(Me,K){return Re(Me.baseToRebasedNodeId,K)??K}function Fe(Me,K){const Z=Re(Me,K);return(0,e.assert)(Z!==void 0,2506),Z}function We([Me,K,Z]){return{nodeId:K!==void 0?{revision:Me,localId:K}:void 0,field:Z}}function Ze(Me){return Me.fieldChanges!==void 0?{...Me,fieldChanges:new Map(Me.fieldChanges)}:{...Me}}function lt(Me,K,Z){return Me.nodeId===void 0?Me:{...Me,nodeId:(0,a.replaceAtomRevisions)(Me.nodeId,K,Z)}}function ut(Me,K){const Z=Re(Me.nodeToParent,K);return(0,e.assert)(Z!==void 0,2507),Nt(Z,Me.nodeAliases)}Kr.getParentFieldId=ut;function pt(Me,K,Z){return Me.crossFieldKeys.getAll(K,Z).map(({value:me})=>Nt(me,Me.nodeAliases))}function Nt(Me,K){return Me.nodeId!==void 0?{...Me,nodeId:Ke(Me.nodeId,K)}:Me}Kr.normalizeFieldId=Nt;function Ke(Me,K){let Z=Me;for(;;){const me=Re(K,Z);if(me===void 0)return Z;Z=me}}function Ge(Me){return(Me.constraintViolationCount??0)>0}function Re(Me,K){return Me.get([K.revision,K.localId])}function Qe(Me,K,Z){Me.set([K.revision,K.localId],Z)}function Y(Me,K){return(0,a.areEqualChangeAtomIdOpts)(Me.nodeId,K.nodeId)&&Me.field===K.field}return Kr}var GS={},t7;function r0e(){if(t7)return GS;t7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(GS,"__esModule",{value:!0}),GS.makeModularChangeCodecFamily=void 0;const e=Je(),n=zn(),a=Bt(),t=GE(),i=$E(),r=bq(),s=yq(),o=_ae();function u(f,b,C,v,m=i.TreeCompressionStrategy.Compressed){return(0,n.makeCodecFamily)(Array.from(f.entries(),([h,g])=>[h,c(g,b,C,v,m)]))}GS.makeModularChangeCodecFamily=u;function c(f,b,C,v,m=i.TreeCompressionStrategy.Compressed){const h=({kind:L,formatVersion:V})=>{const G=L.changeHandler.codecsFactory(b).resolve(V);return{codec:G,compiledSchema:G.json.encodedSchema?(0,n.extractJsonValidator)(v.jsonValidator).compile(G.json.encodedSchema):void 0}},_=new Map([[r.genericFieldKind.identifier,h({kind:r.genericFieldKind,formatVersion:1})]]);f.forEach((L,V)=>{_.set(V,h(L))});const S=L=>{const V=_.get(L);return(0,e.assert)(V!==void 0,1514),V};function p(L,V,G){const ee={baseContext:V,encodeNode:se=>{const re=G.get([se.revision,se.localId]);return(0,e.assert)(re!==void 0,2350),O(re,ee)},decodeNode:()=>(0,e.fail)(2846)};return w(L,ee)}function w(L,V){const G=[];for(const[ee,se]of L){const{codec:re,compiledSchema:fe}=S(se.fieldKind),oe=re.json.encode(se.change,V);fe!==void 0&&!fe.check(oe)&&(0,e.fail)(2847);const de={fieldKey:ee,fieldKind:se.fieldKind,change:oe};G.push(de)}return G}function O(L,V){const G={},{fieldChanges:ee,nodeExistsConstraint:se}=L;return ee!==void 0&&(G.fieldChanges=w(ee,V)),se!==void 0&&(G.nodeExistsConstraint=se),G}function E(L,V,G,ee,se){const re=new Map;for(const fe of L){const{codec:oe,compiledSchema:pe}=S(fe.fieldKind);pe!==void 0&&!pe.check(fe.change)&&(0,e.fail)(2848);const de={nodeId:V,field:fe.fieldKey},ge={baseContext:ee,encodeNode:()=>(0,e.fail)(2849),decodeNode:Ze=>{const lt={revision:ee.revision,localId:(0,a.brand)(se.allocate())},ut=F(Ze,lt,G,ee,se);return G.nodeChanges.set([lt.revision,lt.localId],ut),G.nodeToParent.set([lt.revision,lt.localId],de),lt}},Ce=oe.json.decode(fe.change,ge),Fe=d(f,fe.fieldKind).getCrossFieldKeys(Ce);for(const{key:Ze,count:lt}of Fe)G.crossFieldKeys.set(Ze,lt,de);const We=(0,a.brand)(fe.fieldKey);re.set(We,{fieldKind:fe.fieldKind,change:(0,a.brand)(Ce)})}return re}function F(L,V,G,ee,se){const re={},{fieldChanges:fe,nodeExistsConstraint:oe}=L;return fe!==void 0&&(re.fieldChanges=E(fe,V,G,ee,se)),oe!==void 0&&(re.nodeExistsConstraint=oe),re}function R(L,V){if(L===void 0)return;const G=[],ee=[];let se;for(const[[re,fe],oe]of L.entries()){const pe=l(b,re,V);(se===void 0||se[1]!==pe)&&(se!==void 0&&ee.push(se),se=pe!==void 0?[[],pe]:[[]]),G.push(oe.cursor());const de=G.length-1;se?.[0].push([fe,de])}return se!==void 0&&ee.push(se),ee.length===0?void 0:{builds:ee,trees:C.encode(G,{encodeType:m,schema:V.schema,originatorId:V.originatorId,idCompressor:V.idCompressor})}}function M(L,V){if(L===void 0||L.builds.length===0)return;const G=C.decode(L.trees,{encodeType:m,originatorId:V.originatorId,idCompressor:V.idCompressor}),ee=re=>((0,e.assert)(re<G.length,2200),(0,t.chunkFieldSingle)(G[re]??(0,e.oob)(),{policy:t.defaultChunkPolicy,idCompressor:V.idCompressor})),se=(0,a.newTupleBTree)();return L.builds.forEach(re=>{const fe=re[1]===void 0?V.revision:b.decode(re[1],V),oe=re[0].map(([pe,de])=>[pe,ee(de)]);for(const[pe,de]of oe)se.set([fe,pe],de)}),se}function j(L,V){if(V.revision!==void 0){(0,e.assert)(L.length===1&&L[0]!==void 0&&L[0].revision===V.revision&&L[0].rollbackOf===void 0,2404);return}const G=[];for(const ee of L){const se={revision:b.encode(ee.revision,V)};ee.rollbackOf!==void 0&&(se.rollbackOf=b.encode(ee.rollbackOf,V)),G.push(se)}return G}function k(L,V){if(L===void 0)return V.revision!==void 0?[{revision:V.revision}]:void 0;const G=[];for(const ee of L){const se={revision:b.decode(ee.revision,V)};ee.rollbackOf!==void 0&&(se.rollbackOf=b.decode(ee.rollbackOf,V)),G.push(se)}return G}const x={encode:(L,V)=>((0,e.assert)(L.destroys===void 0,2201),{maxId:L.maxId,revisions:L.revisions===void 0?void 0:j(L.revisions,V),changes:p(L.fieldChanges,V,L.nodeChanges),builds:R(L.builds,V),refreshers:R(L.refreshers,V),violations:L.constraintViolationCount}),decode:(L,V)=>{const G={fieldChanges:new Map,nodeChanges:(0,a.newTupleBTree)(),nodeToParent:(0,a.newTupleBTree)(),nodeAliases:(0,a.newTupleBTree)(),crossFieldKeys:(0,o.newCrossFieldKeyTable)()};G.fieldChanges=E(L.changes,void 0,G,V,(0,a.idAllocatorFromMaxId)(L.maxId)),L.builds!==void 0&&(G.builds=M(L.builds,V)),L.refreshers!==void 0&&(G.refreshers=M(L.refreshers,V)),L.violations!==void 0&&(G.constraintViolationCount=L.violations);const ee=k(L.revisions,V);return ee!==void 0&&(G.revisions=ee),L.maxId!==void 0&&(G.maxId=L.maxId),G}};return(0,n.withSchemaValidation)(s.EncodedModularChangeset,x,v.jsonValidator)}function d(f,b){if(b===r.genericFieldKind.identifier)return r.genericFieldKind.changeHandler;const C=f.get(b)?.kind.changeHandler;return(0,e.assert)(C!==void 0,2497),C}function l(f,b,C){if(b!==void 0)return b===C.revision?void 0:f.encode(b,C)}return GS}var n7;function ki(){return n7||(n7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.makeModularChangeCodecFamily=e.updateRefreshers=e.relevantRemovedRoots=e.intoDelta=e.rebaseRevisionMetadataFromInfo=e.ModularEditBuilder=e.ModularChangeFamily=e.genericFieldKind=e.genericChangeHandler=e.convertGenericChange=e.NodeAttachState=e.referenceFreeFieldChangeRebaser=e.FieldKindWithEditor=e.FlexFieldKind=e.EncodedNodeChangeset=e.EncodedModularChangeset=e.EncodedRevisionInfo=e.EncodedChangeAtomId=e.ChangesetLocalIdSchema=e.setInCrossFieldMap=e.CrossFieldTarget=e.addCrossFieldQuery=e.isNeverTree=e.isNeverField=e.allowsTreeSuperset=e.allowsFieldSuperset=e.allowsTreeSchemaIdentifierSuperset=e.allowsRepoSuperset=void 0;var n=Zve();Object.defineProperty(e,"allowsRepoSuperset",{enumerable:!0,get:function(){return n.allowsRepoSuperset}}),Object.defineProperty(e,"allowsTreeSchemaIdentifierSuperset",{enumerable:!0,get:function(){return n.allowsTreeSchemaIdentifierSuperset}}),Object.defineProperty(e,"allowsFieldSuperset",{enumerable:!0,get:function(){return n.allowsFieldSuperset}}),Object.defineProperty(e,"allowsTreeSuperset",{enumerable:!0,get:function(){return n.allowsTreeSuperset}});var a=gq();Object.defineProperty(e,"isNeverField",{enumerable:!0,get:function(){return a.isNeverField}}),Object.defineProperty(e,"isNeverTree",{enumerable:!0,get:function(){return a.isNeverTree}});var t=vae();Object.defineProperty(e,"addCrossFieldQuery",{enumerable:!0,get:function(){return t.addCrossFieldQuery}}),Object.defineProperty(e,"CrossFieldTarget",{enumerable:!0,get:function(){return t.CrossFieldTarget}}),Object.defineProperty(e,"setInCrossFieldMap",{enumerable:!0,get:function(){return t.setInCrossFieldMap}});var i=yq();Object.defineProperty(e,"ChangesetLocalIdSchema",{enumerable:!0,get:function(){return i.ChangesetLocalIdSchema}}),Object.defineProperty(e,"EncodedChangeAtomId",{enumerable:!0,get:function(){return i.EncodedChangeAtomId}}),Object.defineProperty(e,"EncodedRevisionInfo",{enumerable:!0,get:function(){return i.EncodedRevisionInfo}}),Object.defineProperty(e,"EncodedModularChangeset",{enumerable:!0,get:function(){return i.EncodedModularChangeset}}),Object.defineProperty(e,"EncodedNodeChangeset",{enumerable:!0,get:function(){return i.EncodedNodeChangeset}});var r=bae();Object.defineProperty(e,"FlexFieldKind",{enumerable:!0,get:function(){return r.FlexFieldKind}});var s=WE();Object.defineProperty(e,"FieldKindWithEditor",{enumerable:!0,get:function(){return s.FieldKindWithEditor}});var o=Sae();Object.defineProperty(e,"referenceFreeFieldChangeRebaser",{enumerable:!0,get:function(){return o.referenceFreeFieldChangeRebaser}}),Object.defineProperty(e,"NodeAttachState",{enumerable:!0,get:function(){return o.NodeAttachState}});var u=bq();Object.defineProperty(e,"convertGenericChange",{enumerable:!0,get:function(){return u.convertGenericChange}}),Object.defineProperty(e,"genericChangeHandler",{enumerable:!0,get:function(){return u.genericChangeHandler}}),Object.defineProperty(e,"genericFieldKind",{enumerable:!0,get:function(){return u.genericFieldKind}});var c=n0e();Object.defineProperty(e,"ModularChangeFamily",{enumerable:!0,get:function(){return c.ModularChangeFamily}}),Object.defineProperty(e,"ModularEditBuilder",{enumerable:!0,get:function(){return c.ModularEditBuilder}}),Object.defineProperty(e,"rebaseRevisionMetadataFromInfo",{enumerable:!0,get:function(){return c.rebaseRevisionMetadataFromInfo}}),Object.defineProperty(e,"intoDelta",{enumerable:!0,get:function(){return c.intoDelta}}),Object.defineProperty(e,"relevantRemovedRoots",{enumerable:!0,get:function(){return c.relevantRemovedRoots}}),Object.defineProperty(e,"updateRefreshers",{enumerable:!0,get:function(){return c.updateRefreshers}});var d=r0e();Object.defineProperty(e,"makeModularChangeCodecFamily",{enumerable:!0,get:function(){return d.makeModularChangeCodecFamily}})})(FM)),FM}var AM={},WS={},JS={},QS={},r7;function JE(){if(r7)return QS;r7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(QS,"__esModule",{value:!0}),QS.makeChangeAtomIdCodec=void 0;function e(n){return{encode(a,t){return a.revision===void 0||a.revision===t.revision?a.localId:[a.localId,n.encode(a.revision,t)]},decode(a,t){return Array.isArray(a)?{localId:a[0],revision:n.decode(a[1],t)}:{localId:a,revision:t.revision}}}}return QS.makeChangeAtomIdCodec=e,QS}var DM={},i7;function i0e(){return i7||(i7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncodedOptionalChangeset=e.EncodedBuild=e.EncodedRegisterId=void 0;const n=Nr(),a=ki(),t={additionalProperties:!1};e.EncodedRegisterId=n.Type.Union([a.EncodedChangeAtomId,n.Type.Null()]),e.EncodedBuild=n.Type.Tuple([a.EncodedChangeAtomId]);const i=o=>n.Type.Object({b:n.Type.Optional(n.Type.Array(e.EncodedBuild)),m:s,c:r(o),d:n.Type.Optional(e.EncodedRegisterId)},t);e.EncodedOptionalChangeset=i;const r=o=>n.Type.Optional(n.Type.Array(n.Type.Tuple([e.EncodedRegisterId,o]))),s=n.Type.Optional(n.Type.Array(n.Type.Tuple([e.EncodedRegisterId,e.EncodedRegisterId,n.Type.Optional(n.Type.Boolean())])))})(DM)),DM}var s7;function s0e(){if(s7)return JS;s7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(JS,"__esModule",{value:!0}),JS.makeOptionalFieldCodec=void 0;const e=Je(),n=JE(),a=ki(),t=i0e();function i(s){const o=(0,n.makeChangeAtomIdCodec)(s);return{encode:(u,c)=>u==="self"?null:o.encode(u,c),decode:(u,c)=>u===null?"self":o.decode(u,c),encodedSchema:t.EncodedRegisterId}}function r(s){const o=i(s);return{encode:(u,c)=>{const d={};d.m=[],u.valueReplace!==void 0&&(u.valueReplace.src!==void 0&&d.m.push([o.encode(u.valueReplace.src,c.baseContext),o.encode("self",c.baseContext),!0]),u.valueReplace.isEmpty||u.valueReplace.src==="self"?d.d=o.encode(u.valueReplace.dst,c.baseContext):d.m.push([o.encode("self",c.baseContext),o.encode(u.valueReplace.dst,c.baseContext),!1]));for(const[l,f]of u.moves)d.m.push([o.encode(l,c.baseContext),o.encode(f,c.baseContext),!0]);if(d.m.length===0&&delete d.m,u.childChanges.length>0){d.c=[];for(const[l,f]of u.childChanges)d.c.push([o.encode(l,c.baseContext),c.encodeNode(f)])}return d},decode:(u,c)=>{let d,l;const f=[];if(u.m!==void 0)for(const[C,v]of u.m){const m=o.decode(C,c.baseContext),h=o.decode(v,c.baseContext);m==="self"||h==="self"?(m==="self"&&((0,e.assert)(d===void 0,2256),d=h),h==="self"&&((0,e.assert)(l===void 0,2257),l=m)):f.push([m,h])}const b={moves:f,childChanges:u.c?.map(([C,v])=>[o.decode(C,c.baseContext),c.decodeNode(v)])??[]};if(d!==void 0&&l!==void 0)if(d==="self"||l==="self"){(0,e.assert)(u.d!==void 0,2258);const C=o.decode(u.d,c.baseContext);(0,e.assert)(C!=="self",2259),b.valueReplace={isEmpty:!1,dst:C,src:"self"}}else(0,e.assert)(u.d===void 0,2260),b.valueReplace={isEmpty:!1,dst:d,src:l};else if(l!==void 0){(0,e.assert)(u.d!==void 0,2261);const C=o.decode(u.d,c.baseContext);(0,e.assert)(C!=="self",2262),b.valueReplace={isEmpty:!0,dst:C,src:l}}else if(d!==void 0)(0,e.assert)(u.d===void 0,2263),(0,e.assert)(d!=="self",2264),b.valueReplace={isEmpty:!1,dst:d};else if(u.d!==void 0){const C=o.decode(u.d,c.baseContext);(0,e.assert)(C!=="self",2265),b.valueReplace={isEmpty:!0,dst:C}}return b},encodedSchema:(0,t.EncodedOptionalChangeset)(a.EncodedNodeChangeset)}}return JS.makeOptionalFieldCodec=r,JS}var YS={},kM={},a7;function a0e(){return a7||(a7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncodedOptionalChangeset=e.EncodedRegisterId=void 0;const n=Nr(),a=ki(),t={additionalProperties:!1};e.EncodedRegisterId=n.Type.Union([a.EncodedChangeAtomId,n.Type.Null()]);const i=u=>n.Type.Object({m:n.Type.Optional(n.Type.Array(s)),c:n.Type.Optional(r(u)),r:n.Type.Optional(o)},t);e.EncodedOptionalChangeset=i;const r=u=>n.Type.Array(n.Type.Tuple([e.EncodedRegisterId,u])),s=n.Type.Tuple([a.EncodedChangeAtomId,a.EncodedChangeAtomId]),o=n.Type.Object({e:n.Type.Boolean(),s:n.Type.Optional(e.EncodedRegisterId),d:a.EncodedChangeAtomId},t)})(kM)),kM}var o7;function o0e(){if(o7)return YS;o7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(YS,"__esModule",{value:!0}),YS.makeOptionalFieldCodec=void 0;const e=JE(),n=ki(),a=a0e();function t(r){return{encode:(s,o)=>s==="self"?null:r.encode(s,o),decode:(s,o)=>s===null?"self":r.decode(s,o),encodedSchema:a.EncodedRegisterId}}function i(r){const s=(0,e.makeChangeAtomIdCodec)(r),o=t(s);return{encode:(u,c)=>{const d={};if(u.moves.length>0&&(d.m=u.moves.map(([l,f])=>[s.encode(l,c.baseContext),s.encode(f,c.baseContext)])),u.valueReplace!==void 0&&(d.r={e:u.valueReplace.isEmpty,d:s.encode(u.valueReplace.dst,c.baseContext)},u.valueReplace.src!==void 0&&(d.r.s=o.encode(u.valueReplace.src,c.baseContext))),u.childChanges.length>0){d.c=[];for(const[l,f]of u.childChanges)d.c.push([o.encode(l,c.baseContext),c.encodeNode(f)])}return d},decode:(u,c)=>{const d={moves:u.m?.map(([l,f])=>[s.decode(l,c.baseContext),s.decode(f,c.baseContext)])??[],childChanges:u.c?.map(([l,f])=>[o.decode(l,c.baseContext),c.decodeNode(f)])??[]};if(u.r!==void 0){const l={isEmpty:u.r.e,dst:s.decode(u.r.d,c.baseContext)};u.r.s!==void 0&&(l.src=o.decode(u.r.s,c.baseContext)),d.valueReplace=l}return d},encodedSchema:(0,a.EncodedOptionalChangeset)(n.EncodedNodeChangeset)}}return YS.makeOptionalFieldCodec=i,YS}var c7;function Tae(){if(c7)return WS;c7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(WS,"__esModule",{value:!0}),WS.makeOptionalFieldCodecFamily=void 0;const e=zn(),n=s0e(),a=o0e(),t=i=>(0,e.makeCodecFamily)([[1,(0,n.makeOptionalFieldCodec)(i)],[2,(0,a.makeOptionalFieldCodec)(i)]]);return WS.makeOptionalFieldCodecFamily=t,WS}var xM={},Dm={},u7;function QE(){if(u7)return Dm;u7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Dm,"__esModule",{value:!0}),Dm.mapRootChanges=Dm.nodeIdFromChangeAtom=void 0;const e=Vt();function n(t){return(0,e.makeDetachedNodeId)(t.revision,t.localId)}Dm.nodeIdFromChangeAtom=n;function a(t,i){const r={};return t.fields!==void 0&&(r.fields=t.fields),t.build!==void 0&&(r.build=t.build.map(({id:s,trees:o})=>({id:s,trees:i(o)}))),t.global!==void 0&&(r.global=t.global.map(({id:s,fields:o})=>({id:s,fields:o}))),t.rename!==void 0&&(r.rename=t.rename.map(({count:s,oldId:o,newId:u})=>({count:s,oldId:o,newId:u}))),r}return Dm.mapRootChanges=a,Dm}var d7;function c0e(){return d7||(d7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.optionalChangeHandler=e.optionalFieldIntoDelta=e.optionalFieldEditor=e.taggedRegister=e.optionalChangeRebaser=e.RegisterMap=void 0;const n=Je(),a=Vt(),t=Bt(),i=QE(),r=ki(),s=Tae();class o{constructor(){this.nestedMapData=new t.SizedNestedMap}clone(){const w=new o;for(const[O,E]of this.entries())w.set(O,E);return w}set(w,O){w==="self"?this.nestedMapData.set("self",void 0,O):this.nestedMapData.set(w.localId,w.revision,O)}get(w){return w==="self"?this.nestedMapData.tryGet(w,void 0):this.nestedMapData.tryGet(w.localId,w.revision)}has(w){return this.get(w)!==void 0}delete(w){return w==="self"?this.nestedMapData.delete("self",void 0):this.nestedMapData.delete(w.localId,w.revision)}keys(){const w=[];for(const[O,E]of this.nestedMapData)if(O==="self")w.push("self");else for(const[F,R]of E)w.push(F===void 0?{localId:O}:{localId:O,revision:F});return w}values(){return this.nestedMapData.values()}entries(){const w=[];for(const O of this.keys())if(O==="self"){const E=this.nestedMapData.tryGet("self",void 0);(0,n.assert)(E!==void 0,1904),w.push(["self",E])}else{const E=this.nestedMapData.tryGet(O.localId,O.revision);(0,n.assert)(E!==void 0,1905),w.push([O,E])}return w}get size(){return this.nestedMapData.size}}e.RegisterMap=o,e.optionalChangeRebaser={compose:(p,w,O)=>{const{srcToDst:E,dstToSrc:F}=C(p.moves),R=p.valueReplace?.src,M=m(p.valueReplace),j=w.valueReplace?.src;let k;j!==void 0?j==="self"?k=R??j:M!==void 0&&f(M,j)?k="self":k=(0,t.tryGetFromNestedMap)(F,j.revision,j.localId)??j:R!==void 0&&w.valueReplace===void 0&&(k=R);const x=new o;for(const[re,fe]of w.childChanges)if(re==="self")R!==void 0?x.set(R,fe):x.set("self",fe);else if(M!==void 0&&(0,a.areEqualChangeAtomIds)(M,re))x.set("self",fe);else{const oe=(0,t.tryGetFromNestedMap)(F,re.revision,re.localId);x.set(oe??re,fe)}const L=[],V=[],G={moves:L,childChanges:V};for(const[re,fe]of p.childChanges){const oe=x.get(re);V.push([re,O(fe,oe)]),x.delete(re)}for(const[re,fe]of x.entries())V.push([re,O(void 0,fe)]);for(const[re,fe]of w.moves){const oe=(0,t.tryGetFromNestedMap)(F,re.revision,re.localId);oe!==void 0?(L.push([oe,fe]),(0,t.deleteFromNestedMap)(E,oe.revision,oe.localId),(0,t.deleteFromNestedMap)(F,re.revision,re.localId)):(M===void 0||!(0,a.areEqualChangeAtomIds)(M,re))&&L.push([re,fe])}for(const[re,fe]of E.entries())for(const[oe,pe]of fe.entries()){const de=(0,a.makeChangeAtomId)(oe,re);(k===void 0||!f(de,k))&&L.push([de,pe])}if(R!==void 0&&R!=="self"&&w.valueReplace!==void 0){const re=w.valueReplace.dst;v(w.valueReplace)&&!(0,a.areEqualChangeAtomIds)(R,re)&&L.push([R,re])}const ee=p.valueReplace??w.valueReplace;if(ee===void 0)return G;const se={isEmpty:ee.isEmpty,dst:d(p.valueReplace,w)};return k!==void 0&&(se.src=k),G.valueReplace=se,G},invert:(p,w,O,E)=>{const{moves:F,childChanges:R}=p,M=new o,j=[];for(const[x,L]of F)M.set(x,L),j.push([L,x]);p.valueReplace!==void 0&&(m(p.valueReplace)!==void 0&&M.set("self",p.valueReplace.dst),p.valueReplace.src!==void 0&&M.set(p.valueReplace.src,"self"));const k={moves:j,childChanges:R.map(([x,L])=>[M.get(x)??x,L])};if(p.valueReplace!==void 0)if(v(p.valueReplace)){const x=p.valueReplace.src===void 0?{isEmpty:!0,dst:(0,a.makeChangeAtomId)(O.allocate(),E)}:{isEmpty:!1,dst:w?p.valueReplace.src:(0,a.makeChangeAtomId)(O.allocate(),E)};p.valueReplace.isEmpty===!1&&(x.src=p.valueReplace.dst),k.valueReplace=x}else!w&&p.valueReplace.src==="self"&&(k.valueReplace={isEmpty:!1,src:"self",dst:(0,a.makeChangeAtomId)(O.allocate(),E)});return k},rebase:(p,w,O)=>{const{moves:E,childChanges:F,valueReplace:R}=p,{srcToDst:M}=C(w.moves),j=new o;for(const[G,ee]of w.moves)j.set(G,ee);w.valueReplace!==void 0&&(m(w.valueReplace)!==void 0&&j.set("self",w.valueReplace.dst),w.valueReplace.src!==void 0&&j.set(w.valueReplace.src,"self"));const k=[];for(const[G,ee]of E){const se=(0,t.tryGetFromNestedMap)(M,G.revision,G.localId);k.push([G,se??ee])}const x=new o;for(const[G,ee]of w.childChanges)x.set(G,ee);const L=[];for(const[G,ee]of F){const se=x.get(G);se!==void 0&&x.delete(G);const re=j.get(G)??G,fe=O(ee,se,re==="self"?r.NodeAttachState.Attached:r.NodeAttachState.Detached);fe!==void 0&&L.push([re,fe])}for(const[G,ee]of x.entries()){const se=j.get(G)??G,re=O(void 0,ee,se==="self"?r.NodeAttachState.Attached:r.NodeAttachState.Detached);re!==void 0&&L.push([se,re])}const V={moves:k,childChanges:L};if(R!==void 0){const G={isEmpty:w.valueReplace===void 0?R.isEmpty:w.valueReplace.src===void 0,dst:R.dst};R.src!==void 0&&(G.src=j.get(R.src)??R.src),V.valueReplace=G}return V},prune:(p,w)=>{const O=[],E={moves:p.moves,childChanges:O};p.valueReplace!==void 0&&(E.valueReplace=p.valueReplace);for(const[F,R]of p.childChanges){const M=w(R);M!==void 0&&O.push([F,M])}return E},replaceRevisions:(p,w,O)=>{const E=u(p.valueReplace,w,O),F=[];for(const[j,k]of p.childChanges)F.push([c(j,w,O),(0,a.replaceAtomRevisions)(k,w,O)]);const R=[];for(const[j,k]of p.moves)R.push([(0,a.replaceAtomRevisions)(j,w,O),(0,a.replaceAtomRevisions)(k,w,O)]);const M={childChanges:F,moves:R};return E!==void 0&&(M.valueReplace=E),M},mute:p=>({childChanges:p.childChanges,moves:[]})};function u(p,w,O){if(p===void 0)return;const E={...p,dst:(0,a.replaceAtomRevisions)(p.dst,w,O)};return p.src!==void 0&&(E.src=c(p.src,w,O)),E}function c(p,w,O){return p==="self"?p:(0,a.replaceAtomRevisions)(p,w,O)}function d(p,w){const O=p?.dst;return w.valueReplace===void 0?((0,n.assert)(O!==void 0,2254),l(O,w.moves)):O===void 0||p?.src==="self"||w.valueReplace.src!==void 0&&f(w.valueReplace.src,O)?((0,n.assert)(w.valueReplace!==void 0,2255),w.valueReplace.dst):l(O,w.moves)}function l(p,w){for(const[O,E]of w)if((0,a.areEqualChangeAtomIds)(p,O))return E;return p}function f(p,w){return p==="self"||w==="self"?p===w:(0,a.areEqualChangeAtomIds)(p,w)}function b(p,w){return p===void 0||w===void 0?p===w:f(p,w)}function C(p){const w=new Map,O=new Map;for(const[E,F]of p)(0,t.setInNestedMap)(w,E.revision,E.localId,F),(0,t.setInNestedMap)(O,F.revision,F.localId,E);return{srcToDst:w,dstToSrc:O}}function v(p){return p.src==="self"?!1:!p.isEmpty||p.src!==void 0}function m(p){return p===void 0||p.isEmpty||p.src==="self"?void 0:p.dst}function h(p,w){return p==="self"?p:(0,a.taggedAtomId)(p,w)}e.taggedRegister=h,e.optionalFieldEditor={set:(p,w)=>({moves:[],childChanges:[],valueReplace:{isEmpty:p,src:w.fill,dst:w.detach}}),clear:(p,w)=>({moves:[],childChanges:[],valueReplace:{isEmpty:p,dst:w}}),buildChildChanges:p=>{const w=Array.from(p,([O,E])=>((0,n.assert)(O===0,1028),["self",E]));return(0,n.assert)(w.length<=1,2749),{moves:[],childChanges:w}}};function g(p,w){const O={};let E=!0;const F={count:1};if(p.valueReplace!==void 0&&v(p.valueReplace)&&(p.valueReplace.isEmpty||(F.detach=(0,i.nodeIdFromChangeAtom)(p.valueReplace.dst)),p.valueReplace.src!==void 0&&(F.attach=(0,i.nodeIdFromChangeAtom)(p.valueReplace.src)),E=!1),p.moves.length>0&&(O.rename=p.moves.map(([R,M])=>({count:1,oldId:(0,i.nodeIdFromChangeAtom)(R),newId:(0,i.nodeIdFromChangeAtom)(M)}))),p.childChanges.length>0){const R=[];for(const[M,j]of p.childChanges){const k=w(j);if(M!=="self"){const x=k;R.push({id:{major:M.revision,minor:M.localId},fields:x})}else F.fields=k,E=!1}R.length>0&&(O.global=R)}return E||(O.local=[F]),O}e.optionalFieldIntoDelta=g,e.optionalChangeHandler={rebaser:e.optionalChangeRebaser,codecsFactory:s.makeOptionalFieldCodecFamily,editor:e.optionalFieldEditor,intoDelta:g,relevantRemovedRoots:S,isEmpty:p=>p.childChanges.length===0&&p.moves.length===0&&p.valueReplace===void 0,getNestedChanges:_,createEmpty:()=>({moves:[],childChanges:[]}),getCrossFieldKeys:p=>[]};function _(p){const w=p.valueReplace!==void 0&&p.valueReplace.src!=="self",O=p.valueReplace?.src;return p.childChanges.map(([E,F])=>{const R=E==="self"?0:void 0,M=E==="self"?w?void 0:0:b(E,O)?0:void 0;return[F,R,M]})}function*S(p,w){const O=new o;for(const[F]of p.moves)O.has(F)||(O.set(F,!0),yield(0,i.nodeIdFromChangeAtom)(F));for(const[F,R]of p.childChanges)F!=="self"&&!O.has(F)&&(O.set(F,!0),yield(0,i.nodeIdFromChangeAtom)(F)),yield*w(R);const E=p.valueReplace?.src;E!==void 0&&E!=="self"&&!O.has(E)&&(yield(0,i.nodeIdFromChangeAtom)(E))}})(xM)),xM}var l7;function u0e(){return l7||(l7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.optionalFieldIntoDelta=e.optionalChangeRebaser=e.optionalFieldEditor=e.optionalChangeHandler=e.RegisterMap=e.makeOptionalFieldCodecFamily=void 0;var n=Tae();Object.defineProperty(e,"makeOptionalFieldCodecFamily",{enumerable:!0,get:function(){return n.makeOptionalFieldCodecFamily}});var a=c0e();Object.defineProperty(e,"RegisterMap",{enumerable:!0,get:function(){return a.RegisterMap}}),Object.defineProperty(e,"optionalChangeHandler",{enumerable:!0,get:function(){return a.optionalChangeHandler}}),Object.defineProperty(e,"optionalFieldEditor",{enumerable:!0,get:function(){return a.optionalFieldEditor}}),Object.defineProperty(e,"optionalChangeRebaser",{enumerable:!0,get:function(){return a.optionalChangeRebaser}}),Object.defineProperty(e,"optionalFieldIntoDelta",{enumerable:!0,get:function(){return a.optionalFieldIntoDelta}})})(AM)),AM}var qM={},km={},f7;function wae(){if(f7)return km;f7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(km,"__esModule",{value:!0}),km.Changeset=km.DetachIdOverrideType=void 0;const e=Nr(),n=zn(),a=Vt(),t=ki();var i;(function(j){j[j.Unattach=0]="Unattach",j[j.Redetach=1]="Redetach"})(i||(km.DetachIdOverrideType=i={}));const r={additionalProperties:!1},s=e.Type.Number({multipleOf:1,minimum:1}),o=t.ChangesetLocalIdSchema,u=e.Type.Object({id:o}),c=e.Type.Tuple([a.RevisionTagSchema,t.ChangesetLocalIdSchema,s,e.Type.Number({multipleOf:1,minimum:0})]),d=e.Type.Object({lineage:e.Type.Optional(e.Type.Array(c))}),l=e.Type.Tuple([t.ChangesetLocalIdSchema,s]),f=e.Type.Composite([d,e.Type.Object({atom:t.EncodedChangeAtomId,adjacentCells:e.Type.Optional(e.Type.Array(l))})],r),b=e.Type.Object({revision:e.Type.Optional(a.RevisionTagSchema)}),C=e.Type.Composite([u,b],r),v=e.Type.Composite([u,b,e.Type.Object({finalEndpoint:e.Type.Optional(t.EncodedChangeAtomId)})]),m=e.Type.Composite([v],r),h=e.Type.Object({type:e.Type.Enum(i),id:f},r),g=e.Type.Object({idOverride:e.Type.Optional(h)}),_=e.Type.Composite([e.Type.Object({id:t.ChangesetLocalIdSchema}),b,g],r),S=e.Type.Composite([v,g],r),p=e.Type.Object({insert:e.Type.Optional(C),moveIn:e.Type.Optional(m)},n.unionOptions),w=e.Type.Object({delete:e.Type.Optional(_),moveOut:e.Type.Optional(S)},n.unionOptions),O=e.Type.Object({attach:p,detach:w}),E=e.Type.Object({insert:e.Type.Optional(C),moveIn:e.Type.Optional(m),delete:e.Type.Optional(_),moveOut:e.Type.Optional(S),attachAndDetach:e.Type.Optional(O)},n.unionOptions),F=(j,k)=>e.Type.Object({effect:e.Type.Optional(j),cellId:e.Type.Optional(f),changes:e.Type.Optional(k),count:s},r),R=j=>F(E,j),M=j=>e.Type.Array(R(j));return km.Changeset=M,km}var XS={},ZS={},qt={},eC={},h7;function bl(){if(h7)return eC;h7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(eC,"__esModule",{value:!0}),eC.NoopMarkType=void 0,eC.NoopMarkType=void 0,eC}var m7;function as(){if(m7)return qt;m7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qt,"__esModule",{value:!0}),qt.getEndpoint=qt.withRevision=qt.withNodeChange=qt.omitMarkEffect=qt.extractMarkEffect=qt.splitMarkEffect=qt.splitMark=qt.tryMergeMarks=qt.isRemoveMark=qt.isDetach=qt.compareCellsFromSameRevision=qt.areOverlappingIdRanges=qt.isNoopMark=qt.isTombstone=qt.isImpactful=qt.settleMark=qt.areOutputCellsEmpty=qt.areInputCellsEmpty=qt.isImpactfulCellRename=qt.isDetachOfRemovedNodes=qt.isAttachAndDetachEffect=qt.markHasCellEffect=qt.markFillsCells=qt.markEmptiesCells=qt.getInputLength=qt.getOutputLength=qt.cloneCellId=qt.cloneMarkEffect=qt.cloneMark=qt.asAttachAndDetach=qt.normalizeCellRename=qt.getDetachedNodeId=qt.getDetachOutputCellId=qt.compareCellPositionsUsingTombstones=qt.CellOrder=qt.cellSourcesFromMarks=qt.getOutputCellId=qt.getInputCellId=qt.areEqualCellIds=qt.isActiveReattach=qt.isReattachEffect=qt.isReattach=qt.isAttach=qt.isInsert=qt.isRename=qt.isNewAttachEffect=qt.isNewAttach=qt.getNestedChanges=qt.createEmpty=qt.isEmpty=void 0,qt.getCrossFieldKeys=void 0;const e=Je(),n=Vt(),a=Bt(),t=ki(),i=bl();function r(Se){for(const Ve of Se)if(Ve.changes!==void 0||Ve.type!==void 0)return!1;return!0}qt.isEmpty=r;function s(){return[]}qt.createEmpty=s;function o(Se){const Ve=[];let ot=0,mt=0;for(const he of Se){const{changes:Ue,count:Pe}=he;Ue!==void 0&&Ve.push([Ue,fe(he)?void 0:ot,oe(he)?void 0:mt]),fe(he)||(ot+=Pe),oe(he)||(mt+=Pe)}return Ve}qt.getNestedChanges=o;function u(Se,Ve){return c(Se,Se.cellId,Ve)}qt.isNewAttach=u;function c(Se,Ve,ot){return f(Se)&&Ve!==void 0&&(Se.revision??ot)===(Ve.revision??ot)||ee(Se)&&c(Se.attach,Ve,ot)}qt.isNewAttachEffect=c;function d(Se){return Se.type==="Rename"}qt.isRename=d;function l(Se){return Se.type==="Insert"}qt.isInsert=l;function f(Se){return Se.type==="Insert"||Se.type==="MoveIn"}qt.isAttach=f;function b(Se){return C(Se,Se.cellId)}qt.isReattach=b;function C(Se,Ve){return f(Se)&&!c(Se,Ve)}qt.isReattachEffect=C;function v(Se){return f(Se)&&C(Se,Se.cellId)&&Se.cellId!==void 0}qt.isActiveReattach=v;function m(Se,Ve){return(0,n.areEqualChangeAtomIdOpts)(Se,Ve)}qt.areEqualCellIds=m;function h(Se){return Se.cellId}qt.getInputCellId=h;function g(Se){return Ze(Se)||d(Se)?w(Se):V(Se)?void 0:ee(Se)?w(Se.detach):h(Se)}qt.getOutputCellId=g;function _(Se,Ve){const ot=new Set;for(const mt of Se){const he=Ve(mt);he!==void 0&&ot.add(he.revision)}return ot}qt.cellSourcesFromMarks=_;var S;(function(Se){Se[Se.SameCell=0]="SameCell",Se[Se.OldThenNew=1]="OldThenNew",Se[Se.NewThenOld=2]="NewThenOld"})(S||(qt.CellOrder=S={}));function p(Se,Ve,ot,mt,he){if((0,n.areEqualChangeAtomIds)(Se,Ve))return S.SameCell;const Ue=ot.has(Ve.revision),Pe=mt.has(Se.revision);if(Ue&&Pe)return(0,e.assert)(Se.revision===void 0&&Ve.revision===void 0,2208),S.NewThenOld;if(Pe)return S.NewThenOld;if(Ue)return S.OldThenNew;{if(Ve.revision===void 0)return S.NewThenOld;(0,e.assert)(Se.revision!==void 0,2209);const Ye=he.getIndex(Se.revision),ke=he.getIndex(Ve.revision);return ke!==void 0&&Ye!==void 0?ke>Ye?S.NewThenOld:S.OldThenNew:(ke===void 0&&Ye===void 0&&(0,e.assert)(!1,2210),Ye===void 0?S.NewThenOld:S.OldThenNew)}}qt.compareCellPositionsUsingTombstones=p;function w(Se){return d(Se)||Se.idOverride!==void 0?Se.idOverride:Se.revision===void 0?{localId:Se.id}:{revision:Se.revision,localId:Se.id}}qt.getDetachOutputCellId=w;function O(Se){switch(Se.type){case"Rename":case"Remove":return w(Se);case"MoveOut":return(0,n.makeChangeAtomId)(Se.id,Se.revision);default:(0,e.unreachableCase)(Se)}}qt.getDetachedNodeId=O;function E(Se,Ve,ot,mt){if(ot.type==="MoveIn"){if(mt.type==="MoveOut"){const he=w(mt);return{type:"Rename",count:Ve,cellId:Se,idOverride:he}}}else return{...mt,count:Ve,cellId:Se};return{type:"AttachAndDetach",attach:ot,detach:mt,count:Ve,cellId:Se}}qt.normalizeCellRename=E;function F(Se){if(Se.type==="AttachAndDetach")return Se;const{cellId:Ve,count:ot,changes:mt,revision:he,...Ue}=Se,Pe={type:"AttachAndDetach",count:ot,cellId:Ve,attach:{type:"Insert",id:Se.id},detach:Ue};return mt!==void 0&&(Pe.changes=mt),he!==void 0&&(Pe.attach.revision=he,Pe.detach.revision=he),Pe}qt.asAttachAndDetach=F;function R(Se){const Ve={...M(Se),count:Se.count};return Se.cellId!==void 0&&(Ve.cellId=j(Se.cellId)),Ve}qt.cloneMark=R;function M(Se){const Ve={...Se};return Ve.type==="AttachAndDetach"&&(Ve.attach=M(Ve.attach),Ve.detach=M(Ve.detach)),Ve}qt.cloneMarkEffect=M;function j(Se){return{...Se}}qt.cloneCellId=j;function k(Se,Ve=!1){return oe(Se)?0:Se.count}qt.getOutputLength=k;function x(Se){return fe(Se)?0:Se.count}qt.getInputLength=x;function L(Se){return!fe(Se)&&oe(Se)}qt.markEmptiesCells=L;function V(Se){return fe(Se)&&!oe(Se)}qt.markFillsCells=V;function G(Se){return fe(Se)!==oe(Se)}qt.markHasCellEffect=G;function ee(Se){return Se.type==="AttachAndDetach"}qt.isAttachAndDetachEffect=ee;function se(Se){return Ze(Se)&&Se.cellId!==void 0}qt.isDetachOfRemovedNodes=se;function re(Se){return(ee(Se)||se(Se))&&de(Se)}qt.isImpactfulCellRename=re;function fe(Se){return Se.cellId!==void 0}qt.areInputCellsEmpty=fe;function oe(Se){const Ve=Se.type;switch(Ve){case i.NoopMarkType:return Se.cellId!==void 0;case"Remove":case"Rename":case"MoveOut":case"AttachAndDetach":return!0;case"MoveIn":case"Insert":return!1;default:(0,e.unreachableCase)(Ve)}}qt.areOutputCellsEmpty=oe;function pe(Se){return de(Se)?Se:Z(Se)}qt.settleMark=pe;function de(Se){const Ve=Se.type;switch(Ve){case i.NoopMarkType:return!1;case"Rename":return!0;case"Remove":{const ot=h(Se);if(ot===void 0)return!0;const mt=g(Se);return(0,e.assert)(mt!==void 0,2084),!(0,n.areEqualChangeAtomIds)(ot,mt)}case"AttachAndDetach":case"MoveOut":return!0;case"MoveIn":return(0,e.assert)(Se.cellId!==void 0,2085),!0;case"Insert":return Se.cellId!==void 0;default:(0,e.unreachableCase)(Ve)}}qt.isImpactful=de;function ge(Se){return Se.type===i.NoopMarkType&&Se.cellId!==void 0&&Se.changes===void 0}qt.isTombstone=ge;function Ce(Se){return Se.type===i.NoopMarkType}qt.isNoopMark=Ce;function Fe(Se,Ve,ot,mt){const he=Se+Ve-1,Ue=ot+mt-1;return ot<=Se&&Se<=Ue||Se<=ot&&ot<=he}qt.areOverlappingIdRanges=Fe;function We(Se,Ve,ot,mt){if((0,e.assert)(Se.revision===ot.revision,2139),Fe(Se.localId,Ve,ot.localId,mt))return Se.localId-ot.localId}qt.compareCellsFromSameRevision=We;function Ze(Se){const Ve=Se?.type;return Ve==="Remove"||Ve==="MoveOut"}qt.isDetach=Ze;function lt(Se){return Se?.type==="Remove"}qt.isRemoveMark=lt;function ut(Se,Ve,ot){return Se===void 0||ot===void 0?Se===void 0&&ot===void 0:Se.revision===ot.revision&&pt(Se.localId,Ve,ot.localId)}function pt(Se,Ve,ot){return Se+Ve===ot}function Nt(Se,Ve,ot){return Se.idOverride!==void 0&&ot.idOverride!==void 0?Ke(Se.idOverride,Ve,ot.idOverride):Se.idOverride===void 0==(ot.idOverride===void 0)}function Ke(Se,Ve,ot){return ut(Se,Ve,ot)}function Ge(Se,Ve){if(Ve.type!==Se.type||!Ke(Se.cellId,Se.count,Ve.cellId)||Ve.changes!==void 0||Se.changes!==void 0)return;const ot=Re(Se,Ve,Se.count);if(ot!==void 0)return{...Se,...ot,count:Se.count+Ve.count}}qt.tryMergeMarks=Ge;function Re(Se,Ve,ot){if(Se.type!==Ve.type)return;if(Ve.type===i.NoopMarkType)return Se;if(Ve.type==="AttachAndDetach"){const he=Se,Ue=Re(he.attach,Ve.attach,ot),Pe=Re(he.detach,Ve.detach,ot);return Ue===void 0||Pe===void 0?void 0:((0,e.assert)(f(Ue)&&Ze(Pe),2086),{...he,attach:Ue,detach:Pe})}if(Se.revision!==Ve.revision||Ze(Se)&&Ze(Ve)&&!Nt(Se,ot,Ve))return;const mt=Ve.type;switch(mt){case"MoveIn":{const he=Se;if(he.id+ot===Ve.id&&ut(he.finalEndpoint,ot,Ve.finalEndpoint))return he;break}case"Remove":{const he=Se;if(he.id+ot===Ve.id&&Nt(he,ot,Ve))return he;break}case"Rename":{const he=Se;if(Nt(he,ot,Ve))return he;break}case"MoveOut":{const he=Se;if(he.id+ot===Ve.id&&Nt(he,ot,Ve)&&ut(he.finalEndpoint,ot,Ve.finalEndpoint))return he;break}case"Insert":{const he=Se;if(he.id+ot===Ve.id)return he;break}default:(0,e.unreachableCase)(mt)}}function Qe(Se,Ve){const mt=Se.count-Ve;(Ve<1||mt<1)&&(0,e.fail)(2861);const[he,Ue]=Y(Se,Ve),Pe={...Se,...he,count:Ve},Ye={...Se,...Ue,count:mt};return Ye.cellId!==void 0&&(Ye.cellId=Me(Ye.cellId,Ve)),[Pe,Ye]}qt.splitMark=Qe;function Y(Se,Ve){const ot=Se.type;switch(ot){case i.NoopMarkType:return[Se,Se];case"Insert":{const mt={...Se},he={...Se,id:Se.id+Ve};return[mt,he]}case"MoveIn":{const mt={...Se,id:Se.id+Ve},he=mt;return he.finalEndpoint!==void 0&&(he.finalEndpoint=Me(he.finalEndpoint,Ve)),[Se,mt]}case"Remove":{const mt={...Se},he=(0,a.brand)(Se.id+Ve),Ue={...Se,id:he},Pe=Ue;return Pe.idOverride!==void 0&&(Pe.idOverride=Me(Pe.idOverride,Ve)),[mt,Ue]}case"Rename":{const mt={...Se},he={...Se},Ue=he;return Ue.idOverride!==void 0&&(Ue.idOverride=Me(Ue.idOverride,Ve)),[mt,he]}case"MoveOut":{const mt={...Se,id:Se.id+Ve},he=mt;return he.idOverride!==void 0&&(he.idOverride=Me(he.idOverride,Ve)),he.finalEndpoint!==void 0&&(he.finalEndpoint=Me(he.finalEndpoint,Ve)),[Se,mt]}case"AttachAndDetach":{const[mt,he]=Y(Se.attach,Ve),[Ue,Pe]=Y(Se.detach,Ve),Ye={...Se,attach:mt,detach:Ue},ke={...Se,attach:he,detach:Pe};return[Ye,ke]}default:(0,e.unreachableCase)(ot)}}qt.splitMarkEffect=Y;function Me(Se,Ve){return{...Se,localId:(0,a.brand)(Se.localId+Ve)}}function K(Se){const{cellId:Ve,count:ot,changes:mt,...he}=Se;return he}qt.extractMarkEffect=K;function Z(Se){const{cellId:Ve,count:ot,changes:mt}=Se,he={count:ot};return Ve!==void 0&&(he.cellId=Ve),mt!==void 0&&(he.changes=mt),he}qt.omitMarkEffect=Z;function me(Se,Ve){const ot={...Se};return Ve!==void 0?ot.changes=Ve:delete ot.changes,ot}qt.withNodeChange=me;function we(Se,Ve){if(Ve===void 0)return Se;const ot=R(Se);return qe(ot,Ve),ot.cellId!==void 0&&ot.cellId.revision===void 0&&Ve!==void 0&&(ot.cellId.revision=Ve),ot}qt.withRevision=we;function qe(Se,Ve){if(!(Se.type===i.NoopMarkType||d(Se))){if(Se.type==="AttachAndDetach"){qe(Se.attach,Ve),qe(Se.detach,Ve);return}(0,e.assert)(Se.revision===void 0||Se.revision===Ve,2089),Se.revision=Ve}}function xe(Se){return Se.finalEndpoint??{revision:Se.revision,localId:Se.id}}qt.getEndpoint=xe;function Oe(Se){const Ve=[];for(const ot of Se)Ve.push(...He(ot,ot.count));return Ve}qt.getCrossFieldKeys=Oe;function He(Se,Ve){switch(Se.type){case"Insert":return[{key:{target:t.CrossFieldTarget.Source,revision:Se.revision,localId:Se.id},count:Ve},{key:{target:t.CrossFieldTarget.Destination,revision:Se.revision,localId:Se.id},count:Ve}];case"MoveOut":return[{key:{target:t.CrossFieldTarget.Source,revision:Se.revision,localId:Se.id},count:Ve}];case"MoveIn":return[{key:{target:t.CrossFieldTarget.Destination,revision:Se.revision,localId:Se.id},count:Ve}];case"AttachAndDetach":return[...He(Se.attach,Ve),...He(Se.detach,Ve)];default:return[]}}return qt}var p7;function Oae(){if(p7)return ZS;p7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ZS,"__esModule",{value:!0}),ZS.relevantRemovedRoots=void 0;const e=Je(),n=Vt(),a=QE(),t=as();function*i(s,o){for(const u of s){if(r(u)){(0,e.assert)(u.cellId!==void 0,2077);const c=(0,a.nodeIdFromChangeAtom)(u.cellId);for(let d=0;d<u.count;d+=1)yield(0,n.offsetDetachId)(c,d)}u.changes!==void 0&&(yield*o(u.changes))}}ZS.relevantRemovedRoots=i;function r(s){if(s.cellId!==void 0){const o=(0,t.isAttachAndDetachEffect)(s)?s.attach:s;if((0,t.isInsert)(o))return!0;if((0,t.isDetachOfRemovedNodes)(s)||s.changes!==void 0)return!0}return!1}return ZS}var tC={},xm={},nC={},g7;function Xg(){if(g7)return nC;g7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(nC,"__esModule",{value:!0}),nC.MarkListFactory=void 0;const e=as();class n{constructor(){this.offset=0,this.list=[]}push(...t){for(const i of t)this.pushContent(i)}pushOffset(t){this.offset+=t}pushContent(t){if((0,e.isNoopMark)(t)&&t.changes===void 0&&!(0,e.isTombstone)(t)){this.pushOffset(t.count);return}this.offset>0&&(this.list.push({count:this.offset}),this.offset=0);const i=this.list[this.list.length-1];if(i!==void 0&&i.type===t.type){const r=(0,e.tryMergeMarks)(i,t);if(r!==void 0){this.list.splice(-1,1,r);return}}this.list.push(t)}}return nC.MarkListFactory=n,nC}var rC={},di={},y7;function CT(){if(y7)return di;y7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(di,"__esModule",{value:!0}),di.getCrossFieldTargetFromMove=di.splitMarkForMoveEffects=di.getMoveIn=di.isMoveIn=di.isMoveOut=di.isMoveMark=di.getMoveEffect=di.setMoveEffect=di.MoveEnd=void 0;const e=Je(),n=Bt(),a=ki(),t=as();var i;(function(m){m[m.Source=0]="Source",m[m.Dest=1]="Dest"})(i||(di.MoveEnd=i={}));function r(m,h,g,_,S,p,w=!0){p.basis=_,m.set(h,g,_,S,p,w)}di.setMoveEffect=r;function s(m,h,g,_,S,p=!0){const w=m.get(h,g,_,S,p);return w.value!==void 0?{...w,value:l(w.value,_)}:w}di.getMoveEffect=s;function o(m){return u(m)||c(m)}di.isMoveMark=o;function u(m){return m.type==="MoveOut"}di.isMoveOut=u;function c(m){return m.type==="MoveIn"}di.isMoveIn=c;function d(m){switch(m.type){case"MoveIn":return m;case"AttachAndDetach":return d(m.attach);default:return}}di.getMoveIn=d;function l(m,h){if(m.basis===h)return m;const g={...m,basis:h},_=h-m.basis;if((0,e.assert)(_>0,2066),m.endpoint!==void 0&&(g.endpoint=v(m.endpoint,_)),m.truncatedEndpoint!==void 0&&(g.truncatedEndpoint=v(m.truncatedEndpoint,_)),m.truncatedEndpointForInner!==void 0&&(g.truncatedEndpointForInner=v(m.truncatedEndpointForInner,_)),m.movedEffect!==void 0){const[S,p]=(0,t.splitMarkEffect)(m.movedEffect,_);g.movedEffect=p}return g}function f(m,h){const g=b(m,m.count,h);return g<m.count?(0,t.splitMark)(m,g):[m]}di.splitMarkForMoveEffects=f;function b(m,h,g){return o(m)?s(g,C(m),m.revision,m.id,h).length:(0,t.isAttachAndDetachEffect)(m)?Math.min(b(m.attach,h,g),b(m.detach,h,g)):h}function C(m){const h=m.type;switch(h){case"MoveIn":return a.CrossFieldTarget.Destination;case"MoveOut":return a.CrossFieldTarget.Source;default:(0,e.unreachableCase)(h)}}di.getCrossFieldTargetFromMove=C;function v(m,h){return{...m,localId:(0,n.brand)(m.localId+h)}}return di}var b7;function Pae(){if(b7)return rC;b7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(rC,"__esModule",{value:!0}),rC.MarkQueue=void 0;const e=Je(),n=CT(),a=as();class t{constructor(r,s){this.list=r,this.moveEffects=s,this.stack=[],this.index=0,this.list=r}isEmpty(){return this.peek()===void 0}dequeue(){const r=this.tryDequeue();return(0,e.assert)(r!==void 0,1250),r}tryDequeue(){const r=this.stack.length>0?this.stack.pop():this.list[this.index++];if(r===void 0)return;const s=(0,n.splitMarkForMoveEffects)(r,this.moveEffects);for(let o=s.length-1;o>0;o--)this.stack.push(s[o]??(0,e.oob)());return s[0]}dequeueUpTo(r){const s=this.dequeue();if(s.count<=r)return s;const[o,u]=(0,a.splitMark)(s,r);return this.stack.push(u),o}peek(){const r=this.tryDequeue();return r!==void 0&&this.stack.push(r),r}}return rC.MarkQueue=t,rC}var v7;function Eae(){if(v7)return xm;v7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(xm,"__esModule",{value:!0}),xm.ComposeQueue=xm.compose=void 0;const e=Je(),n=Vt(),a=ki(),t=Xg(),i=Pae(),r=CT(),s=bl(),o=as();function u(j,k,x,L,V,G){return c(j,k,x,V,G)}xm.compose=u;function c(j,k,x,L,V){const G=new t.MarkListFactory,ee=new h(j,k,L,V);for(;!ee.isEmpty();){const{baseMark:se,newMark:re}=ee.pop();if(re===void 0)(0,e.assert)(se!==void 0,1243),G.push(m(se,L,fe=>v(fe,void 0,x)));else{const fe=(0,o.settleMark)(re);if(se===void 0)G.push(m(fe,L,oe=>v(void 0,oe,x)));else{const oe=(0,o.settleMark)(se),pe=d(oe,fe,x,L);G.push(pe)}}}return G.list}function d(j,k,x,L){const V=C(j,k,x,L);return E((0,o.withNodeChange)(l(j,k,L),V),j.count,L)}function l(j,k,x){if((0,o.isNoopMark)(j))return k;if((0,o.isNoopMark)(k))return j;if((0,o.isRename)(j)&&(0,o.isRename)(k))return{...j,idOverride:k.idOverride};if((0,o.isRename)(j))return(0,e.assert)((0,o.isAttach)(k)||(0,o.isAttachAndDetachEffect)(k),2545),{...k,cellId:j.cellId};if((0,o.isRename)(k))return(0,e.assert)((0,o.isDetach)(j)||(0,o.isAttachAndDetachEffect)(j),2546),(0,o.isDetach)(j)?{...j,idOverride:k.idOverride}:{...j,detach:{...j.detach,idOverride:k.idOverride}};if((0,o.isImpactfulCellRename)(k)){const L=(0,o.asAttachAndDetach)(k);(0,e.assert)(L.cellId!==void 0,2547);const V=L.detach.revision;if((0,o.markEmptiesCells)(j)){const G={...L.detach,count:j.count};if((0,r.isMoveIn)(L.attach)&&(0,r.isMoveOut)(L.detach)){(0,e.assert)((0,r.isMoveOut)(j),2056);const ee={revision:V,localId:L.detach.id};O(x,a.CrossFieldTarget.Destination,(0,o.getEndpoint)(j),j.count,ee);const se=R(x,a.CrossFieldTarget.Source,j.revision,j.id,j.count);se!==void 0&&(F(G,se),w(x,a.CrossFieldTarget.Destination,se,j.count,ee))}return G}if((0,o.isImpactfulCellRename)(j)){(0,e.assert)(j.cellId!==void 0,2548);const G=(0,o.asAttachAndDetach)(j),ee=(0,o.getOutputCellId)(L),se={...G.attach},re={...L.detach};if(f(j.count,se,re,x),(0,o.areEqualCellIds)(ee,G.cellId))return{count:G.count,cellId:G.cellId};const fe=re.revision;return fe!==void 0&&(re.revision=fe),(0,o.normalizeCellRename)(j.cellId,j.count,se,re)}return(0,o.normalizeCellRename)(L.cellId,L.count,L.attach,L.detach)}if((0,o.isImpactfulCellRename)(j)){const L=(0,o.asAttachAndDetach)(j);if((0,o.markFillsCells)(k)){const V=(0,o.withRevision)({...L.attach,cellId:L.cellId,count:L.count},L.attach.revision);if((0,r.isMoveIn)(L.attach)&&(0,r.isMoveOut)(L.detach)){(0,e.assert)((0,r.isMoveIn)(k),2057);const G={revision:L.attach.revision,localId:L.attach.id};O(x,a.CrossFieldTarget.Source,(0,o.getEndpoint)(k),L.count,G);const ee=R(x,a.CrossFieldTarget.Destination,k.revision,k.id,k.count);ee!==void 0&&(F(V,ee),w(x,a.CrossFieldTarget.Source,ee,j.count,G))}return V}else return(0,e.assert)(k.type===s.NoopMarkType,2058),j}if(!(0,o.markHasCellEffect)(j)&&!(0,o.markHasCellEffect)(k))return b(k.count,void 0,(0,o.getInputCellId)(j));if((0,o.markHasCellEffect)(j))if((0,o.markHasCellEffect)(k))if((0,o.areInputCellsEmpty)(j)){(0,e.assert)((0,o.isDetach)(k),1820),(0,e.assert)((0,o.isAttach)(j),1821);const L=(0,o.extractMarkEffect)(j),V=(0,o.extractMarkEffect)(k);return f(j.count,L,V,x),(0,o.areEqualCellIds)((0,o.getOutputCellId)(k),j.cellId)?{count:j.count,cellId:j.cellId}:(0,o.normalizeCellRename)(j.cellId,j.count,L,V)}else{const L=j.count;return b(L,void 0)}else return j;else return k}function f(j,k,x,L){if((0,r.isMoveIn)(k)&&(0,r.isMoveOut)(x)){const V=(0,o.getEndpoint)(k),G=(0,o.getEndpoint)(x);p(L,a.CrossFieldTarget.Source,V,j,G);const ee=M(L,a.CrossFieldTarget.Destination,k.revision,k.id,j);ee!==void 0&&w(L,a.CrossFieldTarget.Destination,G,j,ee),p(L,a.CrossFieldTarget.Destination,G,j,V);const se=M(L,a.CrossFieldTarget.Source,x.revision,x.id,j);se!==void 0&&w(L,a.CrossFieldTarget.Source,V,j,se),delete k.finalEndpoint,delete x.finalEndpoint}}function b(j,k,x){const L={count:j};return k!==void 0&&((0,e.assert)(j===1,1682),L.changes=k),x!==void 0&&(L.cellId=x),L}function C(j,k,x,L){if(k.changes!==void 0){const V=(0,r.getMoveIn)(j);if(V!==void 0){S(L,(0,o.getEndpoint)(V),k.changes);return}}return v(j.changes,k.changes,x)}function v(j,k,x){if(!(j===void 0&&k===void 0))return x(j,k)}function m(j,k,x){const L=j.changes!==void 0?x(j.changes):void 0,V=E(j,j.count,k);return(0,o.withNodeChange)(V,L)}class h{constructor(k,x,L,V){this.moveEffects=L,this.revisionMetadata=V,this.baseMarks=new i.MarkQueue(k,L),this.newMarks=new i.MarkQueue(x,L),this.baseMarksCellSources=(0,o.cellSourcesFromMarks)(k,o.getOutputCellId),this.newMarksCellSources=(0,o.cellSourcesFromMarks)(x,o.getInputCellId)}isEmpty(){return this.baseMarks.isEmpty()&&this.newMarks.isEmpty()}pop(){const k=this.baseMarks.peek(),x=this.newMarks.peek();if(k===void 0&&x===void 0)return{};if(k===void 0)return this.dequeueNew();if(x===void 0)return this.dequeueBase();if((0,o.areOutputCellsEmpty)(k)&&(0,o.areInputCellsEmpty)(x)){const L=(0,o.getOutputCellId)(k)??(0,e.fail)(2857);if((0,o.markEmptiesCells)(k)&&L.revision===void 0)return(0,e.assert)((0,o.isNewAttach)(x),1685),this.dequeueNew();const V=(0,o.getInputCellId)(x);(0,e.assert)(V!==void 0,2205);const G=(0,o.compareCellPositionsUsingTombstones)(L,V,this.baseMarksCellSources,this.newMarksCellSources,this.revisionMetadata);switch(G){case o.CellOrder.SameCell:return this.dequeueBoth();case o.CellOrder.OldThenNew:return this.dequeueBase();case o.CellOrder.NewThenOld:return this.dequeueNew();default:(0,e.unreachableCase)(G)}}else return(0,o.areOutputCellsEmpty)(k)?this.dequeueBase():(0,o.areInputCellsEmpty)(x)?this.dequeueNew():this.dequeueBoth()}dequeueBase(k=Number.POSITIVE_INFINITY){const x=this.baseMarks.dequeueUpTo(k),L=g(this.moveEffects,x);L!==void 0&&this.moveEffects.onMoveIn(L);const V=b(x.count,L,(0,o.getOutputCellId)(x));return{baseMark:x,newMark:V}}dequeueNew(k=Number.POSITIVE_INFINITY){const x=this.newMarks.dequeueUpTo(k);return{baseMark:b(x.count,void 0,(0,o.getInputCellId)(x)),newMark:x}}dequeueBoth(){const k=this.peekMinLength(),x=this.baseMarks.dequeueUpTo(k);let L=this.newMarks.dequeueUpTo(k);const V=g(this.moveEffects,x);return V!==void 0&&((0,e.assert)(L.changes===void 0,2266),L=(0,o.withNodeChange)(L,V)),{baseMark:x,newMark:L}}peekMinLength(){const k=this.baseMarks.peek(),x=this.newMarks.peek();return(0,e.assert)(k!==void 0&&x!==void 0,2267),Math.min(x.count,k.count)}}xm.ComposeQueue=h;function g(j,k){if((0,o.isAttachAndDetachEffect)(k))return g(j,k.detach);if((0,r.isMoveOut)(k))return _(j,k.revision,k.id)}function _(j,k,x){const L=a.CrossFieldTarget.Source,V=(0,r.getMoveEffect)(j,L,k,x,1);if(V.value?.modifyAfter!==void 0)return V.value.modifyAfter}function S(j,{revision:k,localId:x},L){const V=a.CrossFieldTarget.Source,G=1,ee=(0,r.getMoveEffect)(j,V,k,x,G,!1),se=ee.value!==void 0?{...ee.value,modifyAfter:L}:{modifyAfter:L};(0,r.setMoveEffect)(j,V,k,x,G,se)}function p(j,k,x,L,V){const G=(0,r.getMoveEffect)(j,k,x.revision,x.localId,L,!1),ee=G.value!==void 0?{...G.value,endpoint:V}:{endpoint:V};(0,r.setMoveEffect)(j,k,x.revision,x.localId,G.length,ee);const se=L-G.length;se>0&&p(j,k,(0,n.offsetChangeAtomId)(x,G.length),se,(0,n.offsetChangeAtomId)(V,G.length))}function w(j,k,x,L,V){const G=(0,r.getMoveEffect)(j,k,x.revision,x.localId,L),ee=G.value!==void 0?{...G.value,truncatedEndpoint:V}:{truncatedEndpoint:V};(0,r.setMoveEffect)(j,k,x.revision,x.localId,G.length,ee);const se=L-G.length;se>0&&w(j,k,(0,n.offsetChangeAtomId)(x,G.length),se,(0,n.offsetChangeAtomId)(V,G.length))}function O(j,k,x,L,V){const G=(0,r.getMoveEffect)(j,k,x.revision,x.localId,L),ee=G.value!==void 0?{...G.value,truncatedEndpointForInner:V}:{truncatedEndpointForInner:V};(0,r.setMoveEffect)(j,k,x.revision,x.localId,G.length,ee);const se=L-G.length;se>0&&O(j,k,(0,n.offsetChangeAtomId)(x,G.length),se,(0,n.offsetChangeAtomId)(V,G.length))}function E(j,k,x){if((0,o.isAttachAndDetachEffect)(j))return{...j,attach:E(j.attach,k,x),detach:E(j.detach,k,x)};if(!(0,r.isMoveMark)(j))return j;const L=R(x,(0,r.getCrossFieldTargetFromMove)(j),j.revision,j.id,k);if(L===void 0)return j;const V={...j};return F(V,L),V}function F(j,k){(0,o.areEqualCellIds)(k,{revision:j.revision,localId:j.id})?delete j.finalEndpoint:j.finalEndpoint=k}function R(j,k,x,L,V){const G=(0,r.getMoveEffect)(j,k,x,L,V);return(0,e.assert)(G.length===V,2069),G.value?.truncatedEndpoint??G.value?.endpoint}function M(j,k,x,L,V){const G=(0,r.getMoveEffect)(j,k,x,L,V);return(0,e.assert)(G.length===V,2356),G.value?.truncatedEndpointForInner}return xm}var iC={},S7;function Iae(){if(S7)return iC;S7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(iC,"__esModule",{value:!0}),iC.invert=void 0;const e=Je(),n=Bt(),a=ki(),t=Xg(),i=bl(),r=as();function s(l,f,b,C,v){return o(l,f,v,C)}iC.invert=s;function o(l,f,b,C){const v=new t.MarkListFactory;for(const m of l){const h=u(m,f,b,C);v.push(...h)}return v.list}function u(l,f,b,C){if(!(0,r.isImpactful)(l)){const m=(0,r.getInputCellId)(l);return[d(l.count,l.changes,m)]}const v=l.type;switch(v){case i.NoopMarkType:return[l];case"Rename":{const m=(0,r.getInputCellId)(l);(0,e.assert)(m!==void 0,2549);const h={type:"Rename",count:l.count,cellId:l.idOverride,idOverride:f?m:{localId:m.localId}};return[(0,r.withNodeChange)(h,l.changes)]}case"Remove":{(0,e.assert)(l.revision!==void 0,1441);const m=(0,r.getOutputCellId)(l),h=(0,r.getInputCellId)(l);let g;return h===void 0?g={type:"Insert",id:l.id,cellId:m,count:l.count,revision:C}:(g={type:"Remove",id:l.id,cellId:m,count:l.count,revision:C},f&&(g.idOverride=h)),[(0,r.withNodeChange)(g,l.changes)]}case"Insert":{const m=(0,r.getInputCellId)(l);(0,e.assert)(m!==void 0,2060);const h={type:"Remove",count:l.count,id:m.localId,revision:C};return f&&(h.idOverride=m),[(0,r.withNodeChange)(h,l.changes)]}case"MoveOut":{if(l.changes!==void 0){(0,e.assert)(l.count===1,1773);const S=(0,r.getEndpoint)(l);b.set(a.CrossFieldTarget.Destination,S.revision,S.localId,l.count,l.changes,!0)}const m=(0,r.getDetachOutputCellId)(l)??{revision:l.revision??(0,e.fail)(2858),localId:l.id},h={type:"MoveIn",id:l.id,revision:C};l.finalEndpoint!==void 0&&(h.finalEndpoint={localId:l.finalEndpoint.localId,revision:l.revision});let g=h;const _=(0,r.getInputCellId)(l);if(_!==void 0){const S={type:"Remove",id:l.id,revision:C};f&&(S.idOverride=_),g={type:"AttachAndDetach",attach:h,detach:S}}return[{...g,count:l.count,cellId:m}]}case"MoveIn":{const m=(0,r.getInputCellId)(l);(0,e.assert)(m!==void 0,2206);const h={type:"MoveOut",id:l.id,count:l.count,revision:C};return f&&(h.idOverride=m),l.finalEndpoint&&(h.finalEndpoint={localId:l.finalEndpoint.localId,revision:l.revision}),c(h,l.revision,b)}case"AttachAndDetach":{const m={count:l.count,cellId:l.cellId,...l.attach},h=(0,r.getOutputCellId)(m),g={count:l.count,cellId:h,changes:l.changes,...l.detach},_=u(m,f,b,C),S=u(g,f,b,C);if(S.length===0)return _;(0,e.assert)((0,n.hasSingle)(S),2061);let p=S[0];(0,e.assert)((0,r.isAttach)(p),2062);const w=[];for(const O of _){let E=p;if(O.count!==p.count&&([E,p]=(0,r.splitMark)(p,O.count)),O.type===i.NoopMarkType){O.changes!==void 0&&((0,e.assert)(E.changes===void 0,2063),E.changes=O.changes),w.push(E);continue}(0,e.assert)((0,r.isDetach)(O),2064),(0,e.assert)(E.cellId!==void 0,2550);const F=(0,r.normalizeCellRename)(E.cellId,O.count,(0,r.extractMarkEffect)(E),(0,r.extractMarkEffect)(O));p.changes!==void 0&&(F.changes=p.changes),O.changes!==void 0&&((0,e.assert)(F.changes===void 0,2065),F.changes=O.changes),w.push(F)}return w}default:(0,e.unreachableCase)(v)}}function c(l,f,b){const C=b.get(a.CrossFieldTarget.Destination,f,l.id,l.count,!0);if(C.length<l.count){const[v,m]=(0,r.splitMark)(l,C.length);return[C.value!==void 0?(0,r.withNodeChange)(v,C.value):v,...c(m,f,b)]}return C.value!==void 0?(b.onMoveIn(C.value),[(0,r.withNodeChange)(l,C.value)]):[l]}function d(l,f,b){if(f!==void 0){(0,e.assert)(l===1,1644);const C={count:l,changes:f};return b!==void 0&&(C.cellId=b),C}return b!==void 0?{count:l,cellId:b}:{count:l}}return iC}var sC={},C7;function d0e(){if(C7)return sC;C7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(sC,"__esModule",{value:!0}),sC.prune=void 0;const e=Xg(),n=as();function a(t,i){const r=new e.MarkListFactory;for(let s of t)s.changes!==void 0&&(s=(0,n.withNodeChange)(s,i(s.changes))),r.push(s);return r.list}return sC.prune=a,sC}var aC={},_7;function Rae(){if(_7)return aC;_7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(aC,"__esModule",{value:!0}),aC.rebase=void 0;const e=Je(),n=Bt(),a=ki(),t=Xg(),i=Pae(),r=CT(),s=bl(),o=as();function u(R,M,j,k,x,L){return c(R,M,L,j,k,x)}aC.rebase=u;function c(R,M,j,k,x,L){const V=new t.MarkListFactory,G=new l(M,R,j,L);for(;!G.isEmpty();){const{baseMark:ee,newMark:se}=G.pop(),re=b(se,ee,k,L);V.push(re)}return V.list}function d(R){const M=R.count,j=(0,o.getInputCellId)(R);return j===void 0?{count:M}:{count:M,cellId:j}}class l{constructor(M,j,k,x){this.metadata=k,this.moveEffects=x,this.baseMarks=new i.MarkQueue(M,x),this.newMarks=new i.MarkQueue(j,x),this.baseMarksCellSources=(0,o.cellSourcesFromMarks)(M,o.getInputCellId),this.newMarksCellSources=(0,o.cellSourcesFromMarks)(j,o.getInputCellId)}isEmpty(){return this.baseMarks.isEmpty()&&this.newMarks.isEmpty()}pop(){const M=this.baseMarks.peek(),j=this.newMarks.peek();if((0,e.assert)(!(M===void 0&&j===void 0),1826),M===void 0){const k=this.newMarks.dequeue();return{baseMark:d(k),newMark:k}}else{if(j===void 0)return this.dequeueBase();if((0,o.areInputCellsEmpty)(M)&&(0,o.areInputCellsEmpty)(j)){const k=(0,o.getInputCellId)(M),x=(0,o.getInputCellId)(j);(0,e.assert)(k!==void 0&&x!==void 0,2207);const L=(0,o.compareCellPositionsUsingTombstones)(k,x,this.baseMarksCellSources,this.newMarksCellSources,this.metadata);switch(L){case o.CellOrder.SameCell:return this.dequeueBoth();case o.CellOrder.OldThenNew:return this.dequeueBase();case o.CellOrder.NewThenOld:return this.dequeueNew();default:(0,e.unreachableCase)(L)}}else return(0,o.areInputCellsEmpty)(j)?this.dequeueNew():(0,o.areInputCellsEmpty)(M)?this.dequeueBase():this.dequeueBoth()}}dequeueBase(M){const j=M!==void 0?this.baseMarks.dequeueUpTo(M):this.baseMarks.dequeue();let k=d(j);const x=w(this.moveEffects,j);return x!==void 0&&(k=f(k,x)),{baseMark:j,newMark:k}}dequeueNew(){const M=this.newMarks.dequeue();return{newMark:M,baseMark:d(M)}}dequeueBoth(){const M=this.baseMarks.peek(),j=this.newMarks.peek();(0,e.assert)(M!==void 0&&j!==void 0,1692);const k=Math.min(j.count,M.count),x=this.baseMarks.dequeueUpTo(k),L=this.newMarks.dequeueUpTo(k),V=w(this.moveEffects,x);return{baseMark:x,newMark:V===void 0?L:f(L,V)}}}function f(R,M){if((0,r.isMoveIn)(R)&&(0,r.isMoveOut)(M))return{...R,type:"Insert"};if((0,o.isRename)(R)&&(0,r.isMoveOut)(M))return{...M,count:R.count,idOverride:R.idOverride};if((0,o.isAttachAndDetachEffect)(R)&&(0,r.isMoveIn)(R.attach)&&(0,r.isMoveOut)(M))return{...R.detach,count:R.count};if((0,o.isTombstone)(R))return{...R,...M};(0,e.assert)(!1,2072)}function b(R,M,j,k){const x=g((0,o.cloneMark)(R),M,j),L=E(k,M);return L!==void 0&&((0,e.assert)(x.changes===void 0,2268),x.changes=L,k.onMoveIn(L)),C(x,M,k)}function C(R,M,j){let k;if((0,o.isDetach)(M)){M.cellId!==void 0&&delete R.cellId,(0,e.assert)(!(0,o.isNewAttach)(R),1693);const x=(0,o.getDetachOutputCellId)(M);if((0,r.isMoveOut)(M)){(0,e.assert)((0,r.isMoveMark)(M),1776),(0,e.assert)(!(0,o.isNewAttach)(R),2073);const{remains:L,follows:V}=v((0,o.extractMarkEffect)(R));V!==void 0&&m(V,j,(0,o.getEndpoint)(M),M.count),R.changes!==void 0&&h(R.changes,j,(0,o.getEndpoint)(M)),k={...L??{},count:M.count}}else k=R;k=S(k,(0,o.cloneCellId)(x))}else if((0,o.markFillsCells)(M))k=(0,o.isAttachAndDetachEffect)(R)?(0,o.withNodeChange)({...R.detach,count:R.count},R.changes):p(R,void 0);else if((0,o.isAttachAndDetachEffect)(M)){(0,e.assert)(M.cellId!==void 0,2074);const x=C(R,{...M.attach,cellId:(0,o.cloneCellId)(M.cellId),count:M.count},j);k=C(x,{...M.detach,count:M.count},j)}else{if((0,o.isRename)(M))return p(R,(0,o.getDetachOutputCellId)(M));k=R}return k}function v(R){const M=R.type;switch(M){case"Remove":case"MoveOut":{if(R.idOverride!==void 0){const j={type:"Rename",idOverride:R.idOverride},k={...R};return delete k.idOverride,{remains:j,follows:k}}return{follows:R}}case"AttachAndDetach":return{follows:R.detach,remains:R.attach};case"MoveIn":case"Rename":return{remains:R};case s.NoopMarkType:return{};case"Insert":{const j={type:"MoveOut",id:R.id},k={type:"MoveIn",id:R.id};return R.revision!==void 0&&(j.revision=R.revision,k.revision=R.revision),{remains:k,follows:j}}default:(0,e.unreachableCase)(M)}}function m(R,M,{revision:j,localId:k},x){const L=(0,r.getMoveEffect)(M,a.CrossFieldTarget.Destination,j,k,x,!1);if(L.length<x){const[V,G]=(0,o.splitMarkEffect)(R,L.length),ee=L.value!==void 0?{...L.value,movedMark:V}:{movedMark:V};(0,r.setMoveEffect)(M,a.CrossFieldTarget.Destination,j,k,L.length,ee),m(G,M,{revision:j,localId:(0,n.brand)(k+L.length)},x-L.length)}else{const V=L.value!==void 0?{...L.value,movedEffect:R}:{movedEffect:R};(0,r.setMoveEffect)(M,a.CrossFieldTarget.Destination,j,k,x,V)}}function h(R,M,{revision:j,localId:k}){const x=(0,r.getMoveEffect)(M,a.CrossFieldTarget.Destination,j,k,1,!1).value,L=x!==void 0?{...x,rebasedChanges:R}:{rebasedChanges:R};(0,r.setMoveEffect)(M,a.CrossFieldTarget.Destination,j,k,1,L)}function g(R,M,j){const k=M.changes,x=R.changes;if(k===void 0&&x===void 0)return R;const L=_(M);return(0,o.withNodeChange)(R,j(x,k,L))}function _(R){return(0,o.markEmptiesCells)(R)?a.NodeAttachState.Detached:(0,o.markFillsCells)(R)||R.cellId===void 0?a.NodeAttachState.Attached:a.NodeAttachState.Detached}function S(R,M){return(0,e.assert)(R.cellId===void 0,1695),{...R,cellId:M}}function p(R,M){const j={...R,cellId:M};return M===void 0&&delete j.cellId,j}function w(R,M){return(0,r.isMoveIn)(M)?O(R,M.revision,M.id,M.count):(0,o.isAttachAndDetachEffect)(M)&&(0,r.isMoveIn)(M.attach)?O(R,M.attach.revision,M.attach.id,M.count):void 0}function O(R,M,j,k){const x=(0,r.getMoveEffect)(R,a.CrossFieldTarget.Destination,M,j,k);(0,e.assert)(x.length===k,1779);const L=x.value?.movedEffect;if(L!==void 0)return(0,r.isMoveOut)(L)&&R.moveKey(a.CrossFieldTarget.Source,L.revision,L.id,k),L}function E(R,M){return(0,r.isMoveIn)(M)?F(R,M.revision,M.id,M.count):(0,o.isAttachAndDetachEffect)(M)&&(0,r.isMoveIn)(M.attach)?F(R,M.attach.revision,M.attach.id,M.count):void 0}function F(R,M,j,k){return(0,r.getMoveEffect)(R,a.CrossFieldTarget.Destination,M,j,k).value?.rebasedChanges}return aC}var oC={},T7;function l0e(){if(T7)return oC;T7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(oC,"__esModule",{value:!0}),oC.replaceRevisions=void 0;const e=Je(),n=Vt(),a=Xg(),t=bl(),i=as();function r(f,b,C){const v=new a.MarkListFactory;for(const m of f){const h=s(m,b,C);v.push(h)}return v.list}oC.replaceRevisions=r;function s(f,b,C){const v={...o(f,b,C)};return f.cellId!==void 0&&(v.cellId=(0,n.replaceAtomRevisions)(f.cellId,b,C)),f.changes!==void 0&&(v.changes=(0,n.replaceAtomRevisions)(f.changes,b,C)),v}function o(f,b,C){const v=(0,i.isDetach)(f)||(0,i.isRename)(f)?u(f,b,C):f,m=v.type;switch(m){case"Rename":case t.NoopMarkType:return v;case"AttachAndDetach":return{...v,attach:o(v.attach,b,C),detach:o(v.detach,b,C)};case"MoveIn":case"MoveOut":return c(v,b,C);case"Insert":case"Remove":return d(v,b,C);default:(0,e.unreachableCase)(m)}}function u(f,b,C){if(f.idOverride!==void 0){const v=(0,n.replaceAtomRevisions)(f.idOverride,b,C);return{...f,idOverride:v}}else return f}function c(f,b,C){return f.finalEndpoint!==void 0?d({...f,finalEndpoint:d(f.finalEndpoint,b,C)},b,C):d(f,b,C)}function d(f,b,C){return b.has(f.revision)?l(f,C):f}function l(f,b){const C={...f,revision:b};return b===void 0&&delete C.revision,C}return oC}var w7;function Fae(){if(w7)return tC;w7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(tC,"__esModule",{value:!0}),tC.sequenceFieldChangeRebaser=void 0;const e=Eae(),n=Iae(),a=d0e(),t=Rae(),i=l0e(),r=as();return tC.sequenceFieldChangeRebaser={compose:e.compose,invert:n.invert,rebase:t.rebase,prune:a.prune,replaceRevisions:i.replaceRevisions,mute:s=>s.map(o=>(0,r.omitMarkEffect)(o))},tC}var cC={},uC={},O7;function f0e(){if(O7)return uC;O7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(uC,"__esModule",{value:!0}),uC.makeV1Codec=void 0;const e=Je(),n=zn(),a=Bt(),t=JE(),i=ki(),r=wae(),s=bl(),o=as();function u(d){const l=(0,t.makeChangeAtomIdCodec)(d),f={encode(m,h){function g(S){if(!(S===void 0||S===h.revision))return d.encode(S,h)}const _=m.type;switch(_){case"MoveIn":return{moveIn:{revision:g(m.revision),finalEndpoint:m.finalEndpoint===void 0?void 0:l.encode(m.finalEndpoint,h),id:m.id}};case"Insert":return{insert:{revision:g(m.revision),id:m.id}};case"Remove":return{delete:{revision:g(m.revision),idOverride:m.idOverride===void 0?void 0:{type:r.DetachIdOverrideType.Unattach,id:v.encode(m.idOverride,h)},id:m.id}};case"MoveOut":return{moveOut:{revision:g(m.revision),finalEndpoint:m.finalEndpoint===void 0?void 0:l.encode(m.finalEndpoint,h),idOverride:m.idOverride===void 0?void 0:{type:r.DetachIdOverrideType.Unattach,id:v.encode(m.idOverride,h)},id:m.id}};case"AttachAndDetach":return{attachAndDetach:{attach:f.encode(m.attach,h),detach:f.encode(m.detach,h)}};case"Rename":return f.encode({type:"AttachAndDetach",attach:{type:"MoveIn",id:c},detach:{type:"MoveOut",id:c,idOverride:m.idOverride}},h);case s.NoopMarkType:(0,e.fail)(2859);default:(0,e.unreachableCase)(_)}},decode(m,h){return C.dispatch(m,h)}};function b(m,h){return m===void 0?((0,e.assert)(h.revision!==void 0,2405),h.revision):d.decode(m,h)}const C=new n.DiscriminatedUnionDispatcher({moveIn(m,h){const{id:g,finalEndpoint:_,revision:S}=m,p={type:"MoveIn",id:g};return p.revision=b(S,h),_!==void 0&&(p.finalEndpoint=l.decode(_,h)),p},insert(m,h){const{id:g,revision:_}=m,S={type:"Insert",id:g};return S.revision=b(_,h),S},delete(m,h){const{id:g,revision:_,idOverride:S}=m,p={type:"Remove",id:g};return p.revision=b(_,h),S!==void 0&&(p.idOverride=v.decode(S.id,h)),p},moveOut(m,h){const{id:g,finalEndpoint:_,idOverride:S,revision:p}=m,w={type:"MoveOut",id:g};return w.revision=b(p,h),_!==void 0&&(w.finalEndpoint=l.decode(_,h)),S!==void 0&&(w.idOverride=v.decode(S.id,h)),w},attachAndDetach(m,h){const g=C.dispatch(m.attach,h),_=C.dispatch(m.detach,h);return g.id===c?((0,e.assert)(_.idOverride!==void 0,2551),{type:"Rename",idOverride:_.idOverride}):{type:"AttachAndDetach",attach:g,detach:_}}}),v={encode:(m,h)=>({atom:l.encode(m,h)}),decode:({atom:m},h)=>l.decode(m,h)};return{encode:(m,h)=>{const g=[];for(const _ of m){const S={count:_.count};(0,o.isNoopMark)(_)||(S.effect=f.encode(_,h.baseContext)),_.cellId!==void 0&&(S.cellId=v.encode(_.cellId,h.baseContext)),_.changes!==void 0&&(S.changes=h.encodeNode(_.changes)),g.push(S)}return g},decode:(m,h)=>{const g=[];for(const _ of m){const S={count:_.count};_.effect!==void 0&&Object.assign(S,f.decode(_.effect,h.baseContext)),_.cellId!==void 0&&(S.cellId=v.decode(_.cellId,h.baseContext));let p=S;p.cellId!==void 0&&p.type==="AttachAndDetach"&&(p=(0,o.normalizeCellRename)(p.cellId,p.count,p.attach,p.detach)),_.changes!==void 0&&(p.changes=h.decodeNode(_.changes)),g.push(p)}return g},encodedSchema:(0,r.Changeset)(i.EncodedNodeChangeset)}}uC.makeV1Codec=u;const c=(0,a.brand)(-1);return uC}var qm={},LM={},P7;function jae(){return P7||(P7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.Changeset=e.CellMark=e.MarkEffect=e.CellId=void 0;const n=Nr(),a=zn(),t=Vt(),i=ki(),r={additionalProperties:!1},s=n.Type.Number({multipleOf:1,minimum:1}),o=i.ChangesetLocalIdSchema,u=n.Type.Object({id:o});n.Type.Tuple([i.ChangesetLocalIdSchema,s]),e.CellId=i.EncodedChangeAtomId;const c=n.Type.Object({revision:n.Type.Optional(t.RevisionTagSchema)}),d=n.Type.Composite([u,c],r),l=n.Type.Composite([u,c,n.Type.Object({finalEndpoint:n.Type.Optional(i.EncodedChangeAtomId)})]),f=n.Type.Composite([l],r),b=n.Type.Object({idOverride:n.Type.Optional(e.CellId)}),C=n.Type.Composite([n.Type.Object({id:i.ChangesetLocalIdSchema}),c,b],r),v=n.Type.Composite([l,b],r),m=n.Type.Object({insert:n.Type.Optional(d),moveIn:n.Type.Optional(f)},a.unionOptions),h=n.Type.Object({remove:n.Type.Optional(C),moveOut:n.Type.Optional(v)},a.unionOptions),g=n.Type.Object({attach:m,detach:h});e.MarkEffect=n.Type.Object({insert:n.Type.Optional(d),moveIn:n.Type.Optional(f),remove:n.Type.Optional(C),moveOut:n.Type.Optional(v),attachAndDetach:n.Type.Optional(g)},a.unionOptions);const _=(w,O)=>n.Type.Object({effect:n.Type.Optional(w),cellId:n.Type.Optional(e.CellId),changes:n.Type.Optional(O),count:s},r);e.CellMark=_;const S=w=>(0,e.CellMark)(e.MarkEffect,w),p=w=>n.Type.Array(S(w));e.Changeset=p})(LM)),LM}var E7;function Mae(){if(E7)return qm;E7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qm,"__esModule",{value:!0}),qm.makeV2Codec=qm.makeV2CodecHelpers=void 0;const e=Je(),n=zn(),a=Bt(),t=JE(),i=ki(),r=jae(),s=bl(),o=as();function u(l){const f=(0,t.makeChangeAtomIdCodec)(l),b={encode(h,g){function _(p){if(!(p===void 0||p===g.revision))return l.encode(p,g)}const S=h.type;switch(S){case"MoveIn":return{moveIn:{revision:_(h.revision),finalEndpoint:h.finalEndpoint===void 0?void 0:f.encode(h.finalEndpoint,g),id:h.id}};case"Insert":return{insert:{revision:_(h.revision),id:h.id}};case"Remove":return{remove:{revision:_(h.revision),idOverride:h.idOverride===void 0?void 0:f.encode(h.idOverride,g),id:h.id}};case"MoveOut":return{moveOut:{revision:_(h.revision),finalEndpoint:h.finalEndpoint===void 0?void 0:f.encode(h.finalEndpoint,g),idOverride:h.idOverride===void 0?void 0:f.encode(h.idOverride,g),id:h.id}};case"AttachAndDetach":return{attachAndDetach:{attach:b.encode(h.attach,g),detach:b.encode(h.detach,g)}};case"Rename":return b.encode({type:"AttachAndDetach",attach:{type:"MoveIn",id:d},detach:{type:"MoveOut",id:d,idOverride:h.idOverride}},g);case s.NoopMarkType:(0,e.fail)(2860);default:(0,e.unreachableCase)(S)}},decode(h,g){return m.dispatch(h,g)}};function C(h,g){return h===void 0?((0,e.assert)(g.revision!==void 0,2454),g.revision):l.decode(h,g)}const v={moveIn(h,g){const{id:_,finalEndpoint:S,revision:p}=h,w={type:"MoveIn",id:_};return w.revision=C(p,g),S!==void 0&&(w.finalEndpoint=f.decode(S,g)),w},insert(h,g){const{id:_,revision:S}=h,p={type:"Insert",id:_};return p.revision=C(S,g),p},remove(h,g){const{id:_,revision:S,idOverride:p}=h,w={type:"Remove",id:_};return w.revision=C(S,g),p!==void 0&&(w.idOverride=f.decode(p,g)),w},moveOut(h,g){const{id:_,finalEndpoint:S,idOverride:p,revision:w}=h,O={type:"MoveOut",id:_};return O.revision=C(w,g),S!==void 0&&(O.finalEndpoint=f.decode(S,g)),p!==void 0&&(O.idOverride=f.decode(p,g)),O},attachAndDetach(h,g){const _=m.dispatch(h.attach,g),S=m.dispatch(h.detach,g);return _.id===d?((0,e.assert)(S.idOverride!==void 0,2552),{type:"Rename",idOverride:S.idOverride}):{type:"AttachAndDetach",attach:_,detach:S}}},m=new n.DiscriminatedUnionDispatcher(v);return{changeAtomIdCodec:f,markEffectCodec:b,decoderLibrary:v,decodeRevision:C}}qm.makeV2CodecHelpers=u;function c(l){const{markEffectCodec:f,changeAtomIdCodec:b}=u(l);return{encode:(C,v)=>{const m=[];for(const h of C){const g={count:h.count};(0,o.isNoopMark)(h)||(g.effect=f.encode(h,v.baseContext)),h.cellId!==void 0&&(g.cellId=b.encode(h.cellId,v.baseContext)),h.changes!==void 0&&(g.changes=v.encodeNode(h.changes)),m.push(g)}return m},decode:(C,v)=>{const m=[];for(const h of C){const g={count:h.count};h.effect!==void 0&&Object.assign(g,f.decode(h.effect,v.baseContext)),h.cellId!==void 0&&(g.cellId=b.decode(h.cellId,v.baseContext));let _=g;_.cellId!==void 0&&_.type==="AttachAndDetach"&&(_=(0,o.normalizeCellRename)(_.cellId,_.count,_.attach,_.detach)),h.changes!==void 0&&(_.changes=v.decodeNode(h.changes)),m.push(_)}return m},encodedSchema:(0,r.Changeset)(i.EncodedNodeChangeset)}}qm.makeV2Codec=c;const d=(0,a.brand)(-1);return qm}var dC={},lC={},I7;function h0e(){if(I7)return lC;I7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(lC,"__esModule",{value:!0}),lC.Changeset=void 0;const e=Nr(),n=zn(),a=jae(),t={additionalProperties:!1},i=e.Type.Object({idOverride:a.CellId},t),r=e.Type.Composite([a.MarkEffect,e.Type.Object({rename:e.Type.Optional(i)})],n.unionOptions),s=u=>(0,a.CellMark)(r,u),o=u=>e.Type.Array(s(u));return lC.Changeset=o,lC}var R7;function m0e(){if(R7)return dC;R7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(dC,"__esModule",{value:!0}),dC.makeV3Codec=void 0;const e=zn(),n=ki(),a=h0e(),t=Mae(),i=as();function r(s){const{changeAtomIdCodec:o,markEffectCodec:u,decoderLibrary:c}=(0,t.makeV2CodecHelpers)(s),d={encode(f,b){switch(f.type){case"Rename":return{rename:{idOverride:o.encode(f.idOverride,b)}};default:return u.encode(f,b)}},decode(f,b){return l.dispatch(f,b)}},l=new e.DiscriminatedUnionDispatcher({...c,rename(f,b){return{type:"Rename",idOverride:o.decode(f.idOverride,b)}}});return{encode:(f,b)=>{const C=[];for(const v of f){const m={count:v.count};(0,i.isNoopMark)(v)||(m.effect=d.encode(v,b.baseContext)),v.cellId!==void 0&&(m.cellId=o.encode(v.cellId,b.baseContext)),v.changes!==void 0&&(m.changes=b.encodeNode(v.changes)),C.push(m)}return C},decode:(f,b)=>{const C=[];for(const v of f){const m={count:v.count};v.effect!==void 0&&Object.assign(m,d.decode(v.effect,b.baseContext)),v.cellId!==void 0&&(m.cellId=o.decode(v.cellId,b.baseContext)),v.changes!==void 0&&(m.changes=b.decodeNode(v.changes)),C.push(m)}return C},encodedSchema:(0,a.Changeset)(n.EncodedNodeChangeset)}}return dC.makeV3Codec=r,dC}var F7;function Nae(){if(F7)return cC;F7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(cC,"__esModule",{value:!0}),cC.sequenceFieldChangeCodecFactory=void 0;const e=zn(),n=f0e(),a=Mae(),t=m0e(),i=r=>(0,e.makeCodecFamily)([[1,(0,n.makeV1Codec)(r)],[2,(0,a.makeV2Codec)(r)],[3,(0,t.makeV3Codec)(r)]]);return cC.sequenceFieldChangeCodecFactory=i,cC}var fC={},j7;function Aae(){if(j7)return fC;j7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(fC,"__esModule",{value:!0}),fC.sequenceFieldEditor=void 0;const e=Je(),n=Xg(),a=as();fC.sequenceFieldEditor={buildChildChanges:r=>{const s=[];let o=0;for(const[u,c]of r)(0,e.assert)(u>=o,2750),u>o&&s.push({count:u-o}),s.push({count:1,changes:c}),o=u+1;return s},insert:(r,s,o,u)=>{const c={type:"Insert",id:o.localId,count:s,cellId:o,revision:u};return i(r,c)},remove:(r,s,o,u)=>s===0?[]:i(r,{type:"Remove",count:s,id:o,revision:u}),revive:(r,s,o,u)=>{(0,e.assert)(o.revision!==void 0,1828);const c={type:"Insert",id:o.localId,count:s,cellId:o,revision:u};return s===0?[]:i(r,c)},move(r,s,o,u,c,d){return t(r,s,o,{type:"MoveOut",id:u,count:s,revision:d},{type:"MoveIn",id:u,count:s,cellId:c,revision:d})},moveOut(r,s,o,u){return i(r,{type:"MoveOut",id:o,count:s,revision:u})},moveIn(r,s,o,u,c){return i(r,{type:"MoveIn",id:o,count:s,cellId:u,revision:c})},return(r,s,o,u,c,d){const l={type:"MoveOut",id:c.localId,idOverride:u,count:s,revision:d},f={type:"MoveIn",id:c.localId,count:s,cellId:c,revision:d};return t(r,s,o,l,f)}};function t(r,s,o,u,c){if(s===0)return[];const d=r+s,l=new n.MarkListFactory;if(l.pushOffset(Math.min(r,o)),o<=r)l.pushContent(c),l.pushOffset(r-o),l.pushContent(u);else if(d<=o)l.pushContent(u),l.pushOffset(o-d),l.pushContent(c);else{const f=o-r,[b,C]=(0,a.splitMark)(u,f);l.pushContent(b),l.pushContent(c),l.pushContent(C)}return l.list}function i(r,s){return r===0?[s]:[{count:r},s]}return fC}var hC={},M7;function Dae(){if(M7)return hC;M7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(hC,"__esModule",{value:!0}),hC.sequenceFieldToDelta=void 0;const e=Je(),n=Vt(),a=Bt(),t=QE(),i=CT(),r=bl(),s=as();function o(u,c){const d=[],l=[],f=[];for(const C of u){const v={count:C.count},m=(0,s.getInputCellId)(C),h=C.changes;if(h!==void 0){const g=c(h);g.size>0&&(m===void 0?v.fields=g:l.push({id:(0,t.nodeIdFromChangeAtom)(m),fields:g}))}if(!(0,s.areInputCellsEmpty)(C)&&!(0,s.areOutputCellsEmpty)(C))d.push(v);else if((0,s.isAttachAndDetachEffect)(C)){if((0,e.assert)(m!==void 0,2078),(0,i.isMoveIn)(C.attach)&&(0,i.isMoveOut)(C.detach)){(0,e.assert)(C.changes===void 0,2079);continue}const g=(0,s.getDetachedNodeId)(C.detach);(0,e.assert)(g!==void 0,2080);const _=(0,t.nodeIdFromChangeAtom)((0,i.isMoveIn)(C.attach)?(0,s.getEndpoint)(C.attach):m);(0,n.areEqualChangeAtomIds)(m,g)||f.push({count:C.count,oldId:_,newId:(0,t.nodeIdFromChangeAtom)(g)}),v.fields&&l.push({id:_,fields:v.fields})}else{const g=C.type;switch(g){case"MoveIn":{d.push({attach:(0,t.nodeIdFromChangeAtom)((0,s.getEndpoint)(C)),count:C.count});break}case"Remove":{const _=(0,s.getDetachedNodeId)(C);if(m===void 0)v.detach=(0,t.nodeIdFromChangeAtom)(_),d.push(v);else{const S=(0,t.nodeIdFromChangeAtom)(m);(0,n.areEqualChangeAtomIds)(m,_)||f.push({count:C.count,oldId:S,newId:(0,t.nodeIdFromChangeAtom)(_)}),v.fields&&l.push({id:S,fields:v.fields})}break}case"MoveOut":{const _=(0,t.nodeIdFromChangeAtom)((0,s.getDetachedNodeId)(C));m===void 0?(v.detach=_,d.push(v)):f.push({count:C.count,oldId:(0,t.nodeIdFromChangeAtom)(m),newId:_});break}case"Insert":{(0,e.assert)(m!==void 0,2081);const _=(0,t.nodeIdFromChangeAtom)(m);v.attach=_,v.fields&&(l.push({id:_,fields:v.fields}),delete v.fields),d.push(v);break}case r.NoopMarkType:m===void 0&&d.push(v);break;case"Rename":(0,e.assert)(C.cellId!==void 0,2553);break;default:(0,e.unreachableCase)(g)}}}for(;(0,a.hasSome)(d);){const C=(0,a.getLast)(d);if(C.attach!==void 0||C.detach!==void 0||C.fields!==void 0)break;d.pop()}const b={};return d.length>0&&(b.local=d),l.length>0&&(b.global=l),f.length>0&&(b.rename=f),b}return hC.sequenceFieldToDelta=o,hC}var N7;function p0e(){if(N7)return XS;N7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(XS,"__esModule",{value:!0}),XS.sequenceFieldChangeHandler=void 0;const e=Oae(),n=Fae(),a=Nae(),t=Aae(),i=Dae(),r=as();return XS.sequenceFieldChangeHandler={rebaser:n.sequenceFieldChangeRebaser,codecsFactory:a.sequenceFieldChangeCodecFactory,editor:t.sequenceFieldEditor,intoDelta:i.sequenceFieldToDelta,relevantRemovedRoots:e.relevantRemovedRoots,isEmpty:r.isEmpty,getNestedChanges:r.getNestedChanges,createEmpty:r.createEmpty,getCrossFieldKeys:r.getCrossFieldKeys},XS}var A7;function kae(){return A7||(A7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.relevantRemovedRoots=e.isMoveMark=e.extractMarkEffect=e.cloneMark=e.isDetach=e.getInputLength=e.compose=e.invert=e.rebase=e.MarkListFactory=e.sequenceFieldEditor=e.sequenceFieldToDelta=e.sequenceFieldChangeCodecFactory=e.sequenceFieldChangeRebaser=e.sequenceFieldChangeHandler=e.DetachIdOverrideType=void 0;var n=wae();Object.defineProperty(e,"DetachIdOverrideType",{enumerable:!0,get:function(){return n.DetachIdOverrideType}});var a=p0e();Object.defineProperty(e,"sequenceFieldChangeHandler",{enumerable:!0,get:function(){return a.sequenceFieldChangeHandler}});var t=Fae();Object.defineProperty(e,"sequenceFieldChangeRebaser",{enumerable:!0,get:function(){return t.sequenceFieldChangeRebaser}});var i=Nae();Object.defineProperty(e,"sequenceFieldChangeCodecFactory",{enumerable:!0,get:function(){return i.sequenceFieldChangeCodecFactory}});var r=Dae();Object.defineProperty(e,"sequenceFieldToDelta",{enumerable:!0,get:function(){return r.sequenceFieldToDelta}});var s=Aae();Object.defineProperty(e,"sequenceFieldEditor",{enumerable:!0,get:function(){return s.sequenceFieldEditor}});var o=Xg();Object.defineProperty(e,"MarkListFactory",{enumerable:!0,get:function(){return o.MarkListFactory}});var u=Rae();Object.defineProperty(e,"rebase",{enumerable:!0,get:function(){return u.rebase}});var c=Iae();Object.defineProperty(e,"invert",{enumerable:!0,get:function(){return c.invert}});var d=Eae();Object.defineProperty(e,"compose",{enumerable:!0,get:function(){return d.compose}});var l=as();Object.defineProperty(e,"getInputLength",{enumerable:!0,get:function(){return l.getInputLength}}),Object.defineProperty(e,"isDetach",{enumerable:!0,get:function(){return l.isDetach}}),Object.defineProperty(e,"cloneMark",{enumerable:!0,get:function(){return l.cloneMark}}),Object.defineProperty(e,"extractMarkEffect",{enumerable:!0,get:function(){return l.extractMarkEffect}});var f=CT();Object.defineProperty(e,"isMoveMark",{enumerable:!0,get:function(){return f.isMoveMark}});var b=Oae();Object.defineProperty(e,"relevantRemovedRoots",{enumerable:!0,get:function(){return b.relevantRemovedRoots}})})(qM)),qM}var mC={},D7;function g0e(){if(D7)return mC;D7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(mC,"__esModule",{value:!0}),mC.noChangeCodecFamily=void 0;const e=zn();return mC.noChangeCodecFamily=(0,e.makeCodecFamily)([[1,e.unitCodec]]),mC}var k7;function vq(){return k7||(k7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.FieldKinds=e.fieldKinds=e.fieldKindConfigurations=e.forbidden=e.identifier=e.nodeKey=e.sequence=e.required=e.valueChangeHandler=e.valueFieldEditor=e.optional=e.noChangeHandler=void 0;const n=Je(),a=Vt(),t=ki(),i=u0e(),r=kae(),s=g0e();e.noChangeHandler={rebaser:(0,t.referenceFreeFieldChangeRebaser)({compose:(f,b)=>0,invert:f=>0,rebase:(f,b)=>0,mute:f=>0}),codecsFactory:()=>s.noChangeCodecFamily,editor:{buildChildChanges:()=>(0,n.fail)(2829)},intoDelta:(f,b)=>({}),relevantRemovedRoots:f=>[],isEmpty:f=>!0,getNestedChanges:f=>[],createEmpty:()=>0,getCrossFieldKeys:()=>[]};const o="Optional";e.optional=new t.FieldKindWithEditor(o,a.Multiplicity.Optional,i.optionalChangeHandler,(f,b)=>(b.kind===e.sequence.identifier||b.kind===o)&&(0,t.allowsTreeSchemaIdentifierSuperset)(f,b.types),new Set([])),e.valueFieldEditor={...i.optionalFieldEditor,set:f=>i.optionalFieldEditor.set(!1,f)},e.valueChangeHandler={...e.optional.changeHandler,editor:e.valueFieldEditor};const u="Value";e.required=new t.FieldKindWithEditor(u,a.Multiplicity.Single,e.valueChangeHandler,(f,b)=>(b.kind===e.sequence.identifier||b.kind===u||b.kind===e.optional.identifier||b.kind===e.nodeKey.identifier)&&(0,t.allowsTreeSchemaIdentifierSuperset)(f,b.types),new Set);const c="Sequence";e.sequence=new t.FieldKindWithEditor(c,a.Multiplicity.Sequence,r.sequenceFieldChangeHandler,(f,b)=>b.kind===c&&(0,t.allowsTreeSchemaIdentifierSuperset)(f,b.types),new Set([]));const d="NodeKey";e.nodeKey=new t.FieldKindWithEditor(d,a.Multiplicity.Single,e.noChangeHandler,(f,b)=>(b.kind===e.sequence.identifier||b.kind===u||b.kind===e.optional.identifier||b.kind===d)&&(0,t.allowsTreeSchemaIdentifierSuperset)(f,b.types),new Set);const l="Identifier";e.identifier=new t.FieldKindWithEditor(l,a.Multiplicity.Single,e.noChangeHandler,(f,b)=>(b.kind===e.sequence.identifier||b.kind===u||b.kind===e.optional.identifier||b.kind===l)&&(0,t.allowsTreeSchemaIdentifierSuperset)(f,b.types),new Set),e.forbidden=new t.FieldKindWithEditor(a.forbiddenFieldKindIdentifier,a.Multiplicity.Forbidden,e.noChangeHandler,(f,b)=>e.fieldKinds.get(b.kind)?.multiplicity!==a.Multiplicity.Single,new Set),e.fieldKindConfigurations=new Map([[1,new Map([[e.nodeKey.identifier,{kind:e.nodeKey,formatVersion:1}],[e.required.identifier,{kind:e.required,formatVersion:1}],[e.optional.identifier,{kind:e.optional,formatVersion:1}],[e.sequence.identifier,{kind:e.sequence,formatVersion:1}],[e.forbidden.identifier,{kind:e.forbidden,formatVersion:1}],[e.identifier.identifier,{kind:e.identifier,formatVersion:1}]])],[2,new Map([[e.nodeKey.identifier,{kind:e.nodeKey,formatVersion:1}],[e.required.identifier,{kind:e.required,formatVersion:2}],[e.optional.identifier,{kind:e.optional,formatVersion:2}],[e.sequence.identifier,{kind:e.sequence,formatVersion:1}],[e.forbidden.identifier,{kind:e.forbidden,formatVersion:1}],[e.identifier.identifier,{kind:e.identifier,formatVersion:1}]])],[3,new Map([[e.nodeKey.identifier,{kind:e.nodeKey,formatVersion:1}],[e.required.identifier,{kind:e.required,formatVersion:2}],[e.optional.identifier,{kind:e.optional,formatVersion:2}],[e.sequence.identifier,{kind:e.sequence,formatVersion:2}],[e.forbidden.identifier,{kind:e.forbidden,formatVersion:1}],[e.identifier.identifier,{kind:e.identifier,formatVersion:1}]])],[4,new Map([[e.nodeKey.identifier,{kind:e.nodeKey,formatVersion:1}],[e.required.identifier,{kind:e.required,formatVersion:2}],[e.optional.identifier,{kind:e.optional,formatVersion:2}],[e.sequence.identifier,{kind:e.sequence,formatVersion:3}],[e.forbidden.identifier,{kind:e.forbidden,formatVersion:1}],[e.identifier.identifier,{kind:e.identifier,formatVersion:1}]])]]),e.fieldKinds=new Map([e.required,e.optional,e.sequence,e.nodeKey,e.identifier,e.forbidden].map(f=>[f.identifier,f])),e.FieldKinds={required:e.required,optional:e.optional,sequence:e.sequence,identifier:e.identifier,forbidden:e.forbidden}})(RM)),RM}var _o={},x7;function y0e(){if(x7)return _o;x7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_o,"__esModule",{value:!0}),_o.DefaultEditBuilder=_o.relevantRemovedRoots=_o.intoDelta=_o.DefaultChangeFamily=void 0;const e=Je(),n=Ot(),a=Vt(),t=Bt(),i=ki(),r=vq();class s{constructor(f){this.modularFamily=new i.ModularChangeFamily(r.fieldKinds,f)}get rebaser(){return this.modularFamily.rebaser}get codecs(){return this.modularFamily.codecs}buildEditor(f,b){return new c(this,f,b)}}_o.DefaultChangeFamily=s;function o(l){return(0,i.intoDelta)(l,r.fieldKinds)}_o.intoDelta=o;function u(l){return(0,i.relevantRemovedRoots)(l,r.fieldKinds)}_o.relevantRemovedRoots=u;class c{constructor(f,b,C){this.mintRevisionTag=b,this.modularBuilder=new i.ModularEditBuilder(f,r.fieldKinds,C)}enterTransaction(){this.modularBuilder.enterTransaction()}exitTransaction(){this.modularBuilder.exitTransaction()}addNodeExistsConstraint(f){this.modularBuilder.addNodeExistsConstraint(f,this.mintRevisionTag())}addNodeExistsConstraintOnRevert(f){this.modularBuilder.addNodeExistsConstraintOnRevert(f,this.mintRevisionTag())}valueField(f){return{set:b=>{(0,e.assert)(b.topLevelLength===1,3090);const C=this.mintRevisionTag(),v={localId:this.modularBuilder.generateId(),revision:C},m={localId:this.modularBuilder.generateId(),revision:C},h=this.modularBuilder.buildTrees(v.localId,b,C),g=(0,t.brand)(r.required.changeHandler.editor.set({fill:v,detach:m})),_={type:"field",field:f,fieldKind:r.required.identifier,change:g,revision:C};this.modularBuilder.submitChanges([h,_],C)}}}optionalField(f){return{set:(b,C)=>{(0,e.assert)(b===void 0||b.topLevelLength===1,3091);const v=[];let m;const h=this.mintRevisionTag(),g={localId:this.modularBuilder.generateId(),revision:h};if(b!==void 0){const p={localId:this.modularBuilder.generateId(),revision:h},w=this.modularBuilder.buildTrees(p.localId,b,h);v.push(w),m=r.optional.changeHandler.editor.set(C,{fill:p,detach:g})}else m=r.optional.changeHandler.editor.clear(C,g);const _=(0,t.brand)(m),S={type:"field",field:f,fieldKind:r.optional.identifier,change:_,revision:h};v.push(S),this.modularBuilder.submitChanges(v,h)}}}move(f,b,C,v,m){if(C===0)return;if(C<0||!Number.isSafeInteger(C))throw new n.UsageError(`Expected non-negative integer count, got ${C}.`);const h=this.mintRevisionTag(),g=this.modularBuilder.generateId(C),_={localId:this.modularBuilder.generateId(C),revision:h};if((0,a.compareFieldUpPaths)(f,v)){const S=r.sequence.changeHandler.editor.move(b,C,m,g,_,h);this.modularBuilder.submitChange(f,r.sequence.identifier,(0,t.brand)(S),h)}else{const S=(0,a.topDownPath)(f.parent),p=(0,a.topDownPath)(v.parent),w=d(S,p);let O=v;if(w===S.length&&(p[w]?.parentField??v.field)===f.field){let M=p[w]?.parentIndex??b;if(!(M<b))if(b+C<=M){M-=C;let j=p[w-1];const k=p[w]??(0,e.oob)();j={parent:j,parentIndex:M,parentField:k.parentField};for(let x=w+1;x<p.length;x+=1)j={...p[x]??(0,e.oob)(),parent:j};O={parent:j,field:v.field}}else throw new n.UsageError("Invalid move operation: the destination is located under one of the moved elements. Consider using the Tree.contains API to detect this.")}const E=r.sequence.changeHandler.editor.moveOut(b,C,g,h),F=r.sequence.changeHandler.editor.moveIn(m,C,g,_,h);this.modularBuilder.submitChanges([{type:"field",field:f,fieldKind:r.sequence.identifier,change:(0,t.brand)(E),revision:h},{type:"field",field:O,fieldKind:r.sequence.identifier,change:(0,t.brand)(F),revision:h}],h)}}sequenceField(f){return{insert:(b,C)=>{const v=C.topLevelLength;if(v===0)return;const m=this.mintRevisionTag(),h={localId:this.modularBuilder.generateId(v),revision:m},g=this.modularBuilder.buildTrees(h.localId,C,m),_=(0,t.brand)(r.sequence.changeHandler.editor.insert(b,v,h,m)),S={type:"field",field:f,fieldKind:r.sequence.identifier,change:_,revision:m};this.modularBuilder.submitChanges([g,S],m)},remove:(b,C)=>{if(C===0)return;const v=this.mintRevisionTag(),m=this.modularBuilder.generateId(C),h=(0,t.brand)(r.sequence.changeHandler.editor.remove(b,C,m,v));this.modularBuilder.submitChange(f,r.sequence.identifier,h,v)}}}}_o.DefaultEditBuilder=c;function d(l,f){const b=Math.min(l.length,f.length);let C=0;for(;C<b;){const v=l[C]??(0,e.oob)(),m=f[C]??(0,e.oob)();if(v!==m&&(v.parentField!==m.parentField||v.parentIndex!==m.parentIndex))break;C+=1}return C}return _o}var _a={},q7;function b0e(){if(q7)return _a;q7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_a,"__esModule",{value:!0}),_a.compliesWithMultiplicity=_a.isFieldInSchema=_a.isNodeInSchema=_a.throwOutOfSchema=_a.SchemaValidationError=void 0;const e=Je(),n=Ot(),a=Vt(),t=ZP(),i=Bt();var r;(function(d){d[d.Field_KindNotInSchemaPolicy=0]="Field_KindNotInSchemaPolicy",d[d.Field_MissingRequiredChild=1]="Field_MissingRequiredChild",d[d.Field_MultipleChildrenNotAllowed=2]="Field_MultipleChildrenNotAllowed",d[d.Field_ChildInForbiddenField=3]="Field_ChildInForbiddenField",d[d.Field_NodeTypeNotAllowed=4]="Field_NodeTypeNotAllowed",d[d.LeafNode_InvalidValue=5]="LeafNode_InvalidValue",d[d.LeafNode_FieldsNotAllowed=6]="LeafNode_FieldsNotAllowed",d[d.ObjectNode_FieldNotInSchema=7]="ObjectNode_FieldNotInSchema",d[d.NonLeafNode_ValueNotAllowed=8]="NonLeafNode_ValueNotAllowed",d[d.Node_MissingSchema=9]="Node_MissingSchema"})(r||(_a.SchemaValidationError=r={}));function s(d){throw new n.UsageError(`Tree does not conform to schema: ${r[d]}`)}_a.throwOutOfSchema=s;function o(d,l,f){const b=l.schema.nodeSchema.get(d.type);if(b===void 0)return f(r.Node_MissingSchema);if(b instanceof a.LeafNodeStoredSchema){if((0,i.iterableHasSome)(d.fields))return f(r.LeafNode_FieldsNotAllowed);if(!(0,t.allowsValue)(b.leafValue,d.value))return f(r.LeafNode_InvalidValue)}else{if(d.value!==void 0)return f(r.NonLeafNode_ValueNotAllowed);if(b instanceof a.ObjectNodeStoredSchema){const C=new Set((0,i.mapIterable)(d.fields,([v,m])=>v));for(const[v,m]of b.objectNodeFields){const h=d.fields.get(v)??[],g=u(h,m,l,f);if(g!==void 0)return g;C.delete(v)}if(C.size!==0)return f(r.ObjectNode_FieldNotInSchema)}else if(b instanceof a.MapNodeStoredSchema)for(const[C,v]of d.fields){const m=u(v,b.mapFields,l,f);if(m!==void 0)return m}else(0,e.fail)(2830)}}_a.isNodeInSchema=o;function u(d,l,f,b){const C=f.policy.fieldKinds.get(l.kind);if(C===void 0)return b(r.Field_KindNotInSchemaPolicy);{const v=c(d.length,C.multiplicity);if(v!==void 0)return b(v)}for(const v of d){if(l.types!==void 0&&!l.types.has(v.type))return b(r.Field_NodeTypeNotAllowed);const m=o(v,f,b);if(m!==void 0)return m}}_a.isFieldInSchema=u;function c(d,l){switch(l){case a.Multiplicity.Single:return d<1?r.Field_MissingRequiredChild:d>1?r.Field_MultipleChildrenNotAllowed:void 0;case a.Multiplicity.Optional:return d>1?r.Field_MultipleChildrenNotAllowed:void 0;case a.Multiplicity.Sequence:return;case a.Multiplicity.Forbidden:return d===0?void 0:r.Field_ChildInForbiddenField;default:(0,e.unreachableCase)(l)}}return _a.compliesWithMultiplicity=c,_a}var pC={},L7;function v0e(){if(L7)return pC;L7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(pC,"__esModule",{value:!0}),pC.defaultSchemaPolicy=void 0;const e=vq();return pC.defaultSchemaPolicy={fieldKinds:e.fieldKinds},pC}var gC={},B7;function S0e(){if(B7)return gC;B7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(gC,"__esModule",{value:!0}),gC.MappedEditBuilder=void 0;class e{constructor(a,t){this.baseBuilder=a,this.mapDelegate=t}valueField(a){const t=this.baseBuilder.valueField(a);return{set:i=>{const r=this.mapDelegate(i);t.set(r)}}}optionalField(a){const t=this.baseBuilder.optionalField(a);return{set:(i,r)=>{const s=i===void 0?void 0:this.mapDelegate(i);t.set(s,r)}}}sequenceField(a){const t=this.baseBuilder.sequenceField(a);return{insert:(i,r)=>{const s=this.mapDelegate(r);t.insert(i,s)},remove:(i,r)=>{t.remove(i,r)}}}move(a,t,i,r,s){this.baseBuilder.move(a,t,i,r,s)}addNodeExistsConstraint(a){this.baseBuilder.addNodeExistsConstraint(a)}addNodeExistsConstraintOnRevert(a){this.baseBuilder.addNodeExistsConstraintOnRevert(a)}}return gC.MappedEditBuilder=e,gC}var U7;function YE(){return U7||(U7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.MappedEditBuilder=e.defaultSchemaPolicy=e.throwOutOfSchema=e.isFieldInSchema=e.isNodeInSchema=e.SchemaValidationError=e.relevantRemovedRoots=e.intoDelta=e.DefaultEditBuilder=e.DefaultChangeFamily=e.fieldKindConfigurations=e.fieldKinds=e.FieldKinds=void 0;var n=vq();Object.defineProperty(e,"FieldKinds",{enumerable:!0,get:function(){return n.FieldKinds}}),Object.defineProperty(e,"fieldKinds",{enumerable:!0,get:function(){return n.fieldKinds}}),Object.defineProperty(e,"fieldKindConfigurations",{enumerable:!0,get:function(){return n.fieldKindConfigurations}});var a=y0e();Object.defineProperty(e,"DefaultChangeFamily",{enumerable:!0,get:function(){return a.DefaultChangeFamily}}),Object.defineProperty(e,"DefaultEditBuilder",{enumerable:!0,get:function(){return a.DefaultEditBuilder}}),Object.defineProperty(e,"intoDelta",{enumerable:!0,get:function(){return a.intoDelta}}),Object.defineProperty(e,"relevantRemovedRoots",{enumerable:!0,get:function(){return a.relevantRemovedRoots}});var t=b0e();Object.defineProperty(e,"SchemaValidationError",{enumerable:!0,get:function(){return t.SchemaValidationError}}),Object.defineProperty(e,"isNodeInSchema",{enumerable:!0,get:function(){return t.isNodeInSchema}}),Object.defineProperty(e,"isFieldInSchema",{enumerable:!0,get:function(){return t.isFieldInSchema}}),Object.defineProperty(e,"throwOutOfSchema",{enumerable:!0,get:function(){return t.throwOutOfSchema}});var i=v0e();Object.defineProperty(e,"defaultSchemaPolicy",{enumerable:!0,get:function(){return i.defaultSchemaPolicy}});var r=S0e();Object.defineProperty(e,"MappedEditBuilder",{enumerable:!0,get:function(){return r.MappedEditBuilder}})})(IM)),IM}var z7;function C0e(){if(z7)return Ms;z7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Ms&&Ms.__runInitializers||function(m,h,g){for(var _=arguments.length>2,S=0;S<h.length;S++)g=_?h[S].call(m,g):h[S].call(m);return _?g:void 0},n=Ms&&Ms.__esDecorate||function(m,h,g,_,S,p){function w(G){if(G!==void 0&&typeof G!="function")throw new TypeError("Function expected");return G}for(var O=_.kind,E=O==="getter"?"get":O==="setter"?"set":"value",F=!h&&m?_.static?m:m.prototype:null,R=h||(F?Object.getOwnPropertyDescriptor(F,_.name):{}),M,j=!1,k=g.length-1;k>=0;k--){var x={};for(var L in _)x[L]=L==="access"?{}:_[L];for(var L in _.access)x.access[L]=_.access[L];x.addInitializer=function(G){if(j)throw new TypeError("Cannot add initializers after decoration has completed");p.push(w(G||null))};var V=(0,g[k])(O==="accessor"?{get:R.get,set:R.set}:R[E],x);if(O==="accessor"){if(V===void 0)continue;if(V===null||typeof V!="object")throw new TypeError("Object expected");(M=w(V.get))&&(R.get=M),(M=w(V.set))&&(R.set=M),(M=w(V.init))&&S.unshift(M)}else(M=w(V))&&(O==="field"?S.unshift(M):R[E]=M)}F&&Object.defineProperty(F,_.name,R),j=!0},a=Ms&&Ms.__classPrivateFieldGet||function(m,h,g,_){if(g==="a"&&!_)throw new TypeError("Private accessor was defined without a getter");if(typeof h=="function"?m!==h||!_:!h.has(m))throw new TypeError("Cannot read private member from an object whose class did not declare it");return g==="m"?_:g==="a"?_.call(m):_?_.value:h.get(m)},t=Ms&&Ms.__classPrivateFieldSet||function(m,h,g,_,S){if(_==="m")throw new TypeError("Private method is not writable");if(_==="a"&&!S)throw new TypeError("Private accessor was defined without a setter");if(typeof h=="function"?m!==h||!S:!h.has(m))throw new TypeError("Cannot write private member to an object whose class did not declare it");return _==="a"?S.call(m,g):S?S.value=g:h.set(m,g),g};Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.buildForest=Ms.ObjectForest=void 0;const i=Ht(),r=Je(),s=Vt(),o=Bt(),u=GE(),c=mq(),d=Yg(),l=YE();function f(m,h){const g=m.fields.get(h);if(g!==void 0)return g;const _=[];return m.fields.set(h,_),_}let b=(()=>{var m,h,g;let _=[],S;return m=class{get roots(){return a(this,g,"f")}constructor(w,O,E=new s.AnchorSet,F=!1,R){this.breaker=(e(this,_),w),this.schema=O,this.anchors=E,this.additionalAsserts=F,this.currentCursors=new Set,this.deltaVisitors=new Set,h.set(this,(0,i.createEmitter)()),this.events=a(this,h,"f"),g.set(this,void 0),this.nextRange=0,t(this,g,R!==void 0?(0,s.deepCopyMapTree)(R):{type:s.aboveRootPlaceholder,fields:new Map},"f"),F&&this.checkSchema()}get isEmpty(){return this.roots.fields.size===0}clone(w,O){return new m(this.breaker,w,O,this.additionalAsserts,this.roots)}chunkField(w){return(0,u.chunkFieldSingle)(w,{idCompressor:void 0,policy:u.defaultChunkPolicy})}forgetAnchor(w){this.anchors.forget(w)}checkSchema(){const w=this.schema;if(w!==void 0){const O=new Set([...this.roots.fields.keys(),s.rootFieldKey]);for(const E of O){const F=this.roots.fields.get(E)??[],R=E===s.rootFieldKey?w.rootFieldSchema:{kind:l.FieldKinds.sequence.identifier,types:new Set(F.map(M=>M.type)),persistedMetadata:void 0};(0,l.isFieldInSchema)(F,R,{schema:w,policy:l.defaultSchemaPolicy},l.throwOutOfSchema)}}}acquireVisitor(){(0,r.assert)(this.activeVisitor===void 0,1900);const w=this.allocateCursor("acquireVisitor");w.setToAboveDetachedSequences();const O=()=>{if(a(this,h,"f").emit("beforeChange"),(0,r.assert)(this.currentCursors.has(w),2453),this.currentCursors.size>1){const j=[...this.currentCursors].flatMap(k=>k===w?[]:k.source??null);throw new Error(`Found unexpected cursors when editing with the following annotations: ${JSON.stringify(j)}`)}};class E{constructor(k){this.forest=k}free(){w.free(),(0,r.assert)(this.forest.activeVisitor!==void 0,1901),this.forest.activeVisitor=void 0,this.forest.additionalAsserts&&this.forest.checkSchema()}destroy(k,x){O(),this.forest.delete(k)}create(k,x){O(),this.forest.add(k,x),a(this.forest,h,"f").emit("afterRootFieldCreated",x)}attach(k,x,L){O(),this.attachEdit(k,x,L)}detach(k,x,L){O(),this.detachEdit(k,x)}attachEdit(k,x,L){if((0,o.assertNonNegativeSafeInteger)(x),x===0)return;const[V,G]=w.getParent();(0,r.assert)(V!==this.forest.roots||G!==k,1974);const ee=f(V,G);(0,o.assertValidIndex)(L,ee,!0);const se=a(this.forest,g,"f").fields.get(k)??[];(0,r.assert)(se!==void 0,1975),(0,r.assert)(se.length===x,1976),ee.splice(L,0,...se),this.forest.delete(k)}detachEdit(k,x){const[L,V]=w.getParent();(0,r.assert)(x===void 0||L!==this.forest.roots||V!==x,1977);const G=f(L,V);(0,o.assertValidRange)(k,G);const ee=G.splice(k.start,k.end-k.start);x!==void 0&&this.forest.addFieldAsDetached(ee,x),G.length===0&&L.fields.delete(V)}enterNode(k){w.enterNode(k)}exitNode(k){w.exitNode()}enterField(k){w.enterField(k)}exitField(k){w.exitField()}}const F=new E(this),R=[];this.deltaVisitors.forEach(j=>R.push(j()));const M=(0,s.combineVisitors)([F,...R]);return this.activeVisitor=M,M}registerAnnouncedVisitor(w){this.deltaVisitors.add(w)}deregisterAnnouncedVisitor(w){this.deltaVisitors.delete(w)}newDetachedField(){const w=(0,o.brand)(String(this.nextRange));return this.nextRange+=1,w}add(w,O){const E=Array.from(w,c.mapTreeFromCursor);this.addFieldAsDetached(E,O)}addFieldAsDetached(w,O){(0,r.assert)(!this.roots.fields.has(O),880),w.length>0&&a(this,g,"f").fields.set(O,w)}delete(w){a(this,g,"f").fields.delete(w)}allocateCursor(w){return new C(this,w)}tryMoveCursorToNode(w,O){const E=this.anchors.locate(w);return E===void 0?-1:(this.moveCursorToPath(E,O),1)}tryMoveCursorToField(w,O){if(w.parent===void 0)this.moveCursorToPath(void 0,O);else{const E=this.tryMoveCursorToNode(w.parent,O);if(E!==1)return E}return O.enterField(w.fieldKey),1}moveCursorToPath(w,O){(0,r.assert)(O instanceof C,823),(0,r.assert)(O.forest===this,824);const E=[],F=[];let R=w;for(;R!==void 0;)E.push(R.parentIndex),F.push(R.parentField),R=R.parent;for(O.setToAboveDetachedSequences();F.length>0;)O.enterField(F.pop()),O.enterNode(E.pop())}getCursorAboveDetachedFields(){return(0,c.cursorForMapTreeNode)(this.roots)}},h=new WeakMap,g=new WeakMap,(()=>{const p=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;S=[o.breakingMethod],n(m,null,S,{kind:"method",name:"checkSchema",static:!1,private:!1,access:{has:w=>"checkSchema"in w,get:w=>w.checkSchema},metadata:p},null,_),p&&Object.defineProperty(m,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),m})();Ms.ObjectForest=b;class C extends d.SynchronousCursor{constructor(h,g,_){super(),this.forest=h,this.source=g,this.innerCursor=_,_===void 0?this.state=s.ITreeSubscriptionCursorState.Cleared:(this.state=s.ITreeSubscriptionCursorState.Current,this.forest.currentCursors.add(this))}buildFieldAnchor(){const h=this.getFieldPath();return{parent:h.parent===void 0?void 0:this.forest.anchors.track(h.parent),fieldKey:h.field}}getFieldPath(h){return(0,r.assert)(this.innerCursor!==void 0,1119),this.innerCursor.getFieldPath(h)}get mode(){return(0,r.assert)(this.innerCursor!==void 0,1070),this.innerCursor.mode}nextField(){return(0,r.assert)(this.innerCursor!==void 0,1071),this.innerCursor.nextField()}exitField(){return(0,r.assert)(this.innerCursor!==void 0,1072),this.innerCursor.exitField()}skipPendingFields(){return(0,r.assert)(this.innerCursor!==void 0,1073),this.innerCursor.skipPendingFields()}getFieldKey(){return(0,r.assert)(this.innerCursor!==void 0,1074),this.innerCursor.getFieldKey()}getFieldLength(){return(0,r.assert)(this.innerCursor!==void 0,1075),this.innerCursor.getFieldLength()}firstNode(){return(0,r.assert)(this.innerCursor!==void 0,1076),this.innerCursor.firstNode()}enterNode(h){return(0,r.assert)(this.innerCursor!==void 0,1077),this.innerCursor.enterNode(h)}getPath(h){return(0,r.assert)(this.innerCursor!==void 0,1078),this.innerCursor.getPath(h)??(0,r.fail)(2855)}get fieldIndex(){return(0,r.assert)(this.innerCursor!==void 0,1079),this.innerCursor.fieldIndex}get chunkStart(){return(0,r.assert)(this.innerCursor!==void 0,1080),this.innerCursor.chunkStart}get chunkLength(){return(0,r.assert)(this.innerCursor!==void 0,1081),this.innerCursor.chunkLength}seekNodes(h){return(0,r.assert)(this.innerCursor!==void 0,1082),this.innerCursor.seekNodes(h)}nextNode(){return(0,r.assert)(this.innerCursor!==void 0,1083),this.innerCursor.nextNode()}exitNode(){return(0,r.assert)(this.innerCursor!==void 0,1084),this.innerCursor.exitNode()}firstField(){return(0,r.assert)(this.innerCursor!==void 0,1085),this.innerCursor.firstField()}enterField(h){return(0,r.assert)(this.innerCursor!==void 0,1086),this.innerCursor.enterField(h)}get type(){return(0,r.assert)(this.innerCursor!==void 0,1087),this.innerCursor.type}get value(){return(0,r.assert)(this.innerCursor!==void 0,1088),this.innerCursor.value}clear(){(0,r.assert)(this.state!==s.ITreeSubscriptionCursorState.Freed,827),this.state=s.ITreeSubscriptionCursorState.Cleared,this.innerCursor=void 0,this.forest.currentCursors.delete(this)}setToAboveDetachedSequences(){(0,r.assert)(this.state!==s.ITreeSubscriptionCursorState.Freed,828),this.clear(),this.state=s.ITreeSubscriptionCursorState.Current,this.innerCursor=(0,c.cursorForMapTreeNode)(this.forest.roots),this.forest.currentCursors.add(this)}getNode(){return(0,r.assert)(this.innerCursor!==void 0,830),this.innerCursor.getNode()}getParent(){(0,r.assert)(this.innerCursor!==void 0,1089);const h=this.innerCursor.getFieldKey();this.innerCursor.exitField();const g=this.innerCursor.getNode();return this.innerCursor.enterField(h),[g,h]}fork(h){return(0,r.assert)(this.innerCursor!==void 0,1120),new C(this.forest,h??`fork: ${this.source}`,this.innerCursor.fork())}free(){(0,r.assert)(this.state!==s.ITreeSubscriptionCursorState.Freed,831),this.forest.currentCursors.delete(this),this.state=s.ITreeSubscriptionCursorState.Freed}buildAnchor(){return(0,r.assert)(this.state===s.ITreeSubscriptionCursorState.Current,890),this.forest.anchors.track(this.getPath())}}function v(m,h,g,_=!1){return new b(m,h,g,_)}return Ms.buildForest=v,Ms}var V7;function _0e(){return V7||(V7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.buildForest=void 0;var n=C0e();Object.defineProperty(e,"buildForest",{enumerable:!0,get:function(){return n.buildForest}})})(CM)),CM}var BM={},Lm={},To={},yC={},H7;function xae(){if(H7)return yC;H7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(yC,"__esModule",{value:!0}),yC.Format=void 0;const e=Nr(),n=Vt(),a={additionalProperties:!1};return yC.Format=e.Type.Object({version:e.Type.Literal(n.SchemaVersion.v1),nodes:e.Type.Record(e.Type.String(),n.schemaFormatV1.TreeNodeSchemaDataFormat),root:n.schemaFormatV1.FieldSchemaFormat},a),yC}var bC={},K7;function qae(){if(K7)return bC;K7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(bC,"__esModule",{value:!0}),bC.Format=void 0;const e=Nr(),n=Vt(),a={additionalProperties:!1};return bC.Format=e.Type.Object({version:e.Type.Literal(n.SchemaVersion.v2),nodes:e.Type.Record(e.Type.String(),n.schemaFormatV2.TreeNodeSchemaDataFormat),root:n.schemaFormatV2.FieldSchemaFormat},a),bC}var $7;function Lae(){if($7)return To;$7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(To,"__esModule",{value:!0}),To.encodeRepo=To.makeSchemaCodecs=To.makeSchemaCodec=To.clientVersionToSchemaVersion=void 0;const e=Je(),n=zn(),a=Vt(),t=Bt(),i=xae(),r=qae();function s(h){return a.SchemaVersion.v1}To.clientVersionToSchemaVersion=s;function o(h,g){const _=u(h);return(0,n.makeVersionDispatchingCodec)(_,{...h,writeVersion:g})}To.makeSchemaCodec=o;function u(h){return(0,n.makeCodecFamily)([[a.SchemaVersion.v1,v(h)],[a.SchemaVersion.v2,m(h)]])}To.makeSchemaCodecs=u;function c(h,g){switch(g){case a.SchemaVersion.v1:return d(h);case a.SchemaVersion.v2:return l(h);default:(0,e.unreachableCase)(g)}}To.encodeRepo=c;function d(h){const g=f(h,S=>S.encodeV1()),_=(0,a.encodeFieldSchemaV1)(h.rootFieldSchema);return{version:a.SchemaVersion.v1,nodes:g,root:_}}function l(h){const g=f(h,S=>S.encodeV2()),_=(0,a.encodeFieldSchemaV2)(h.rootFieldSchema);return{version:a.SchemaVersion.v2,nodes:g,root:_}}function f(h,g){const _=Object.create(null);for(const S of[...h.nodeSchema.keys()].sort()){const p=h.nodeSchema.get(S)??(0,e.fail)(2856);Object.defineProperty(_,S,{enumerable:!0,configurable:!0,writable:!0,value:g(p)})}return _}function b(h){const g=new Map;for(const[_,S]of Object.entries(h.nodes)){const p=a.storedSchemaDecodeDispatcher.dispatch(S);g.set((0,t.brand)(_),p(void 0))}return{rootFieldSchema:(0,a.decodeFieldSchema)(h.root),nodeSchema:g}}function C(h){const g=new Map;for(const[_,S]of Object.entries(h.nodes)){const p=a.storedSchemaDecodeDispatcher.dispatch(S.kind);g.set((0,t.brand)(_),p(S.metadata))}return{rootFieldSchema:(0,a.decodeFieldSchema)(h.root),nodeSchema:g}}function v(h){return(0,n.makeVersionedValidatedCodec)(h,new Set([a.SchemaVersion.v1]),i.Format,{encode:g=>d(g),decode:g=>b(g)})}function m(h){return(0,n.makeVersionedValidatedCodec)(h,new Set([a.SchemaVersion.v2]),r.Format,{encode:g=>l(g),decode:g=>C(g)})}return To}var G7;function T0e(){if(G7)return Lm;G7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Lm,"__esModule",{value:!0}),Lm.encodeTreeSchema=Lm.SchemaSummarizer=void 0;const e=Ht(),n=Je(),a=on(),t=bn(),i=Vt(),r=Lae(),s="SchemaString";class o{constructor(d,l,f){this.schema=d,this.codec=f,this.key="Schema",this.schema.events.on("afterSchemaChange",()=>{this.schemaIndexLastChangedSeq=l.getCurrentSeq()})}summarize(d){const l=d.incrementalSummaryContext,f=new t.SummaryTreeBuilder;if(!(d.fullTree??!1)&&l!==void 0&&this.schemaIndexLastChangedSeq!==void 0&&l.latestSummarySequenceNumber>=this.schemaIndexLastChangedSeq)f.addHandle(s,a.SummaryType.Blob,`${l.summaryPath}/${s}`);else{const C=JSON.stringify(this.codec.encode(this.schema));f.addBlob(s,C)}return f.getSummaryTree()}async load(d,l){const f=await d.readBlob(s);(0,n.assert)((0,i.schemaDataIsEmpty)(this.schema),986);const b=(0,e.bufferToString)(f,"utf-8"),C=this.codec.decode(JSON.parse(b));this.schema.apply(C),this.schemaIndexLastChangedSeq=0}}Lm.SchemaSummarizer=o;function u(c,d){return(0,r.encodeRepo)(c,d)}return Lm.encodeTreeSchema=u,Lm}var W7;function Sq(){return W7||(W7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.FormatV2=e.FormatV1=e.clientVersionToSchemaVersion=e.makeSchemaCodecs=e.makeSchemaCodec=e.encodeTreeSchema=e.SchemaSummarizer=void 0;var n=T0e();Object.defineProperty(e,"SchemaSummarizer",{enumerable:!0,get:function(){return n.SchemaSummarizer}}),Object.defineProperty(e,"encodeTreeSchema",{enumerable:!0,get:function(){return n.encodeTreeSchema}});var a=Lae();Object.defineProperty(e,"makeSchemaCodec",{enumerable:!0,get:function(){return a.makeSchemaCodec}}),Object.defineProperty(e,"makeSchemaCodecs",{enumerable:!0,get:function(){return a.makeSchemaCodecs}}),Object.defineProperty(e,"clientVersionToSchemaVersion",{enumerable:!0,get:function(){return a.clientVersionToSchemaVersion}});var t=xae();Object.defineProperty(e,"FormatV1",{enumerable:!0,get:function(){return t.Format}});var i=qae();Object.defineProperty(e,"FormatV2",{enumerable:!0,get:function(){return i.Format}})})(BM)),BM}var UM={},J7;function w0e(){return J7||(J7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.jsonableTreeFromForest=e.jsonableTreeFromFieldCursor=e.jsonableTreeFromCursor=e.adapter=e.cursorForJsonableTreeField=e.cursorForJsonableTreeNode=void 0;const n=Je(),a=Vt(),t=Yg();function i(c){return(0,t.stackTreeNodeCursor)(e.adapter,c)}e.cursorForJsonableTreeNode=i;function r(c,d=a.rootField){const l=(0,a.detachedFieldAsKey)(d);return(0,t.stackTreeFieldCursor)(e.adapter,{type:a.aboveRootPlaceholder,fields:{[l]:c}},d)}e.cursorForJsonableTreeField=r,e.adapter={value:c=>c.value,type:c=>c.type,keysFromNode:a.genericTreeKeys,getFieldFromNode:(c,d)=>(0,a.getGenericTreeField)(c,d,!1)};function s(c){(0,n.assert)(c.mode===0,954);const d=c.value!==void 0?{type:c.type,value:c.value}:{type:c.type};for(let l=c.firstField();l;l=c.nextField()){const f=(0,a.mapCursorField)(c,s);(0,a.setGenericTreeField)(d,c.getFieldKey(),f)}return d}e.jsonableTreeFromCursor=s;function o(c){return(0,n.assert)(c.mode===1,1994),(0,a.mapCursorField)(c,s)}e.jsonableTreeFromFieldCursor=o;function u(c){const d=c.allocateCursor();(0,a.moveToDetachedField)(c,d);const l=o(d);return d.free(),l}e.jsonableTreeFromForest=u})(UM)),UM}var zM={},VM={},Q7;function XE(){return Q7||(Q7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TreeStatus=e.FlexTreeEntityKind=e.isFlexTreeNode=e.flexTreeMarker=e.flexTreeSlot=void 0;const n=Vt();e.flexTreeSlot=(0,n.anchorSlot)(),e.flexTreeMarker=Symbol("flexTreeMarker");function a(s){return typeof s=="object"&&s!==null&&e.flexTreeMarker in s}function t(s){return a(s)&&s[e.flexTreeMarker]===i.Node}e.isFlexTreeNode=t;var i;(function(s){s[s.Node=0]="Node",s[s.Field=1]="Field"})(i||(e.FlexTreeEntityKind=i={}));var r;(function(s){s[s.InDocument=0]="InDocument",s[s.Removed=1]="Removed",s[s.Deleted=2]="Deleted",s[s.New=3]="New"})(r||(e.TreeStatus=r={}))})(VM)),VM}var HM={},Ji={},wo={},Y7;function Cq(){if(Y7)return wo;Y7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=wo&&wo.__classPrivateFieldSet||function(u,c,d,l,f){if(l==="m")throw new TypeError("Private method is not writable");if(l==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof c=="function"?u!==c||!f:!c.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return l==="a"?f.call(u,d):f?f.value=d:c.set(u,d),d},n=wo&&wo.__classPrivateFieldGet||function(u,c,d,l){if(d==="a"&&!l)throw new TypeError("Private accessor was defined without a getter");if(typeof c=="function"?u!==c||!l:!c.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return d==="m"?l:d==="a"?l.call(u):l?l.value:c.get(u)},a;Object.defineProperty(wo,"__esModule",{value:!0}),wo.LazyEntity=wo.assertFlexTreeEntityNotFreed=void 0;const t=Je(),i=Vt(),r=Bt();function s(u){(0,t.assert)(u instanceof o,2249),(0,t.assert)(!u.isFreed(),2250)}wo.assertFlexTreeEntityNotFreed=s;class o{constructor(c,d,l){this.context=c,a.set(this,void 0),this.anchor=l,e(this,a,d.fork("LazyEntity Fork"),"f"),c.withCursors.add(this),this.context.withAnchors.add(this)}borrowCursor(){return this.cursor}[(a=new WeakMap,r.disposeSymbol)](){n(this,a,"f").free(),this.context.withCursors.delete(this),this.forgetAnchor(),this.context.withAnchors.delete(this)}prepareForEdit(){n(this,a,"f").clear(),this.context.withCursors.delete(this)}isFreed(){return n(this,a,"f").state===i.ITreeSubscriptionCursorState.Freed}get cursor(){if(n(this,a,"f").state!==i.ITreeSubscriptionCursorState.Current){(0,t.assert)(n(this,a,"f").state===i.ITreeSubscriptionCursorState.Cleared,1912),(0,t.assert)(this.anchor!==void 0,1913);const c=this.tryMoveCursorToAnchor(n(this,a,"f"));(0,t.assert)(c===1,1914),this.context.withCursors.add(this)}return n(this,a,"f")}}return wo.LazyEntity=o,wo}var Oo={},X7;function Bae(){if(X7)return Oo;X7=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Oo&&Oo.__classPrivateFieldSet||function(b,C,v,m,h){if(m==="m")throw new TypeError("Private method is not writable");if(m==="a"&&!h)throw new TypeError("Private accessor was defined without a setter");if(typeof C=="function"?b!==C||!h:!C.has(b))throw new TypeError("Cannot write private member to an object whose class did not declare it");return m==="a"?h.call(b,v):h?h.value=v:C.set(b,v),v},n=Oo&&Oo.__classPrivateFieldGet||function(b,C,v,m){if(v==="a"&&!m)throw new TypeError("Private accessor was defined without a getter");if(typeof C=="function"?b!==C||!m:!C.has(b))throw new TypeError("Cannot read private member from an object whose class did not declare it");return v==="m"?m:v==="a"?m.call(b):m?m.value:C.get(b)},a;Object.defineProperty(Oo,"__esModule",{value:!0}),Oo.LazyTreeNode=Oo.getOrCreateHydratedFlexTreeNode=void 0;const t=Je(),i=Vt(),r=Bt(),s=YE(),o=XE(),u=Cq(),c=Uae();function d(b,C){const v=C.buildAnchor(),m=b.checkout.forest.anchors.locate(v)??(0,t.fail)(2834),h=m.slots.get(o.flexTreeSlot);return h!==void 0?(b.checkout.forest.anchors.forget(v),(0,t.assert)(h.context===b,1922),(0,t.assert)(h instanceof f,2348),h):new f(b,C.type,C,m,v)}Oo.getOrCreateHydratedFlexTreeNode=d;function l(b){const C=b.slots.get(o.flexTreeSlot)??(0,t.fail)(2835);(0,t.assert)(C instanceof f,2349),C[r.disposeSymbol]()}class f extends u.LazyEntity{get[(a=new WeakMap,o.flexTreeMarker)](){return o.FlexTreeEntityKind.Node}constructor(C,v,m,h,g){super(C,m,g),this.type=v,this.anchorNode=h,a.set(this,void 0),this.fields={get:_=>this.tryGetField(_),[Symbol.iterator]:()=>(0,i.mapCursorFields)(this.cursor,_=>{const S=_.getFieldKey();return[S,(0,c.makeField)(this.context,this.storedSchema.getFieldSchema(S).kind,_)]}).values()},this.storedSchema=C.schema.nodeSchema.get(this.type)??(0,t.fail)(2836),(0,t.assert)(m.mode===0,1923),h.slots.set(o.flexTreeSlot,this),e(this,a,h.events.on("afterDestroy",l),"f")}isHydrated(){return!0}tryMoveCursorToAnchor(C){return this.context.checkout.forest.tryMoveCursorToNode(this.anchor,C)}forgetAnchor(){this.anchorNode.slots.delete(o.flexTreeSlot),n(this,a,"f").call(this),this.context.checkout.forest.anchors.forget(this.anchor)}get value(){return this.cursor.value}tryGetField(C){const v=this.storedSchema.getFieldSchema(C);return(0,i.inCursorField)(this.cursor,C,m=>{if(m.getFieldLength()!==0)return(0,c.makeField)(this.context,v.kind,m)})}getBoxed(C){const v=this.storedSchema.getFieldSchema(C);return(0,i.inCursorField)(this.cursor,C,m=>(0,c.makeField)(this.context,v.kind,m))}[Symbol.iterator](){return(0,i.mapCursorFields)(this.cursor,C=>(0,c.makeField)(this.context,this.storedSchema.getFieldSchema(C.getFieldKey()).kind,C)).values()}get parentField(){const C=this.cursor,v=this.anchorNode.parentIndex;(0,t.assert)(C.fieldIndex===v,1926);const m=this.anchorNode.parentField;C.exitNode(),(0,t.assert)(m===C.getFieldKey(),1927);let h;if(this.anchorNode.parent===void 0)m===i.rootFieldKey?h=this.context.schema.rootFieldSchema.kind:h=s.FieldKinds.sequence.identifier;else{C.exitField();const _=C.type;C.enterField(m),h=(this.context.schema.nodeSchema.get(_)??(0,t.fail)(2837)).getFieldSchema(m).kind}const g=(0,c.makeField)(this.context,h,C);return C.enterNode(v),{parent:g,index:v}}keys(){return(0,i.mapCursorFields)(this.cursor,C=>C.getFieldKey()).values()}}return Oo.LazyTreeNode=f,Oo}var KM={},Z7;function _k(){return Z7||(Z7=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.indexForAt=e.getSchemaAndPolicy=e.detachedFieldSlot=e.treeStatusFromAnchorCache=e.treeStatusFromDetachedField=void 0;const n=Vt(),a=XE();function t(u){return u===n.rootField?a.TreeStatus.InDocument:a.TreeStatus.Removed}e.treeStatusFromDetachedField=t;function i(u){const c=u.slots.get(e.detachedFieldSlot),{generationNumber:d}=u.anchorSet;return c===void 0?t(r(u,d)):c.generationNumber===d?t(c.detachedField):t(r(u,d))}e.treeStatusFromAnchorCache=i;function r(u,c){const d=(0,n.getDetachedFieldContainingPath)(u);return u.slots.set(e.detachedFieldSlot,{generationNumber:c,detachedField:d}),d}e.detachedFieldSlot=(0,n.anchorSlot)();function s(u){return{schema:u.schema,policy:u.schemaPolicy}}e.getSchemaAndPolicy=s;function o(u,c){let d=Math.trunc(+u);if(Number.isNaN(d)&&(d=0),!(d<-c||d>=c))return d<0&&(d=d+c),d}e.indexForAt=o})(KM)),KM}var eG;function Uae(){if(eG)return Ji;eG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.unboxedFlexNode=Ji.LazyForbiddenField=Ji.LazyOptionalField=Ji.LazyValueField=Ji.LazySequence=Ji.LazyField=Ji.makeField=void 0;const e=Je(),n=Ot(),a=Vt(),t=Bt(),i=YE(),r=mq(),s=XE(),o=Cq(),u=Bae(),c=_k(),d=new WeakMap;function l(S,p,w){const O=w.buildFieldAnchor();let E=!1;const F=()=>(E=!0,new(g.get(p)??(0,e.fail)(2831))(S,p,w,O));if(O.parent===void 0)return F();const M=(S.checkout.forest.anchors.locate(O.parent)??(0,e.fail)(2832)).slots.get(s.flexTreeSlot);if(M===void 0)return F();const j=(0,t.getOrCreate)(d,M,()=>new Map),k=(0,t.getOrCreate)(j,O.fieldKey,F);return E||S.checkout.forest.anchors.forget(O.parent),k}Ji.makeField=l;class f extends o.LazyEntity{get[s.flexTreeMarker](){return s.FlexTreeEntityKind.Field}constructor(p,w,O,E){if(super(p,O,E),this.schema=w,(0,e.assert)(O.mode===1,1915),this.key=O.getFieldKey(),E.parent!==void 0){const F=p.checkout.forest.anchors.locate(E.parent)??(0,e.fail)(2833);this.offAfterDestroy=F.events.on("afterDestroy",()=>{this[t.disposeSymbol]()})}}is(p){return(0,e.assert)(this.context.schemaPolicy.fieldKinds.get(p.identifier)===p,2598),this.schema===p.identifier}get parent(){if(this.anchor.parent===void 0)return;const p=this.cursor;p.exitField();const w=(0,u.getOrCreateHydratedFlexTreeNode)(this.context,p);return p.enterField(this.key),w}tryMoveCursorToAnchor(p){return this.context.checkout.forest.tryMoveCursorToField(this.anchor,p)}forgetAnchor(){this.offAfterDestroy?.(),this.anchor.parent!==void 0&&this.context.checkout.forest.anchors.forget(this.anchor.parent)}get length(){return this.cursor.getFieldLength()}atIndex(p){return(0,a.inCursorNode)(this.cursor,p,w=>_(this.context,w,this.anchor))}boxedAt(p){const w=(0,c.indexForAt)(p,this.length);if(w!==void 0)return(0,a.inCursorNode)(this.cursor,w,O=>(0,u.getOrCreateHydratedFlexTreeNode)(this.context,O))}map(p){return(0,a.mapCursorField)(this.cursor,w=>p(_(this.context,w,this.anchor),w.fieldIndex))}[Symbol.iterator](){return(0,a.iterateCursorField)(this.cursor,p=>(0,u.getOrCreateHydratedFlexTreeNode)(this.context,p))}getFieldPath(){return{parent:this.parent?.anchorNode,field:this.key}}getFieldPathForEditing(){if(!this.isFreed()&&(this.parent===void 0&&this.anchor.fieldKey===a.rootFieldKey||this.parent!==void 0&&(0,c.treeStatusFromAnchorCache)(this.parent.anchorNode)===s.TreeStatus.InDocument))return this.getFieldPath();throw new n.UsageError("Editing only allowed on fields with TreeStatus.InDocument status")}getEditor(){return new i.MappedEditBuilder(this.context.checkout.editor,p=>this.context.checkout.forest.chunkField(p))}}Ji.LazyField=f;class b extends f{constructor(){super(...arguments),this.editor={insert:(p,w)=>{this.sequenceEditor().insert(p,(0,r.cursorForMapTreeField)(w))},remove:(p,w)=>{this.sequenceEditor().remove(p,w)}}}at(p){const w=(0,c.indexForAt)(p,this.length);if(w!==void 0)return this.atIndex(w)}get asArray(){return this.map(p=>p)}sequenceEditor(){const p=this.getFieldPathForEditing();return this.getEditor().sequenceField(p)}}Ji.LazySequence=b;class C extends f{constructor(){super(...arguments),this.editor={set:p=>{this.valueFieldEditor().set((0,r.cursorForMapTreeField)([p]))}}}valueFieldEditor(){const p=this.getFieldPathForEditing();return this.getEditor().valueField(p)}get content(){return this.atIndex(0)}}Ji.LazyValueField=C;class v extends f{constructor(){super(...arguments),this.editor={set:(p,w)=>{this.optionalEditor().set(p!==void 0?(0,r.cursorForMapTreeField)([p]):p,w)}}}optionalEditor(){const p=this.getFieldPathForEditing();return this.getEditor().optionalField(p)}get content(){return this.length===0?void 0:this.atIndex(0)}}Ji.LazyOptionalField=v;class m extends f{}Ji.LazyForbiddenField=m;const h=[[i.FieldKinds.forbidden.identifier,m],[i.FieldKinds.optional.identifier,v],[i.FieldKinds.sequence.identifier,b],[i.FieldKinds.required.identifier,C],[i.FieldKinds.identifier.identifier,C]],g=new Map(h);function _(S,p,w){const O=p.value;if(O!==void 0)return O;const E=w.parent;let F;if(E!==void 0){const R=S.checkout.forest.anchors.locate(E);(0,e.assert)(R!==void 0,2636),F=R.childIfAnchored(w.fieldKey,p.fieldIndex)}else F=S.checkout.forest.anchors.find({parent:void 0,parentField:w.fieldKey,parentIndex:p.fieldIndex});if(F!==void 0){const R=F.slots.get(s.flexTreeSlot);if(R!==void 0)return R}return(0,u.getOrCreateHydratedFlexTreeNode)(S,p)}return Ji.unboxedFlexNode=_,Ji}var tG;function O0e(){return tG||(tG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.Context=e.ContextSlot=void 0;const n=Je(),a=Vt(),t=Bt(),i=Uae();e.ContextSlot=(0,a.anchorSlot)();class r{constructor(o,u,c){this.schemaPolicy=o,this.checkout=u,this.nodeKeyManager=c,this.withCursors=new Set,this.withAnchors=new Set,this.disposed=!1,this.onDispose=[this.checkout.forest.events.on("beforeChange",()=>{this.prepareForEdit()})],(0,n.assert)(!this.checkout.forest.anchors.slots.has(e.ContextSlot),2347),this.checkout.forest.anchors.slots.set(e.ContextSlot,this)}isHydrated(){return(0,n.debugAssert)(()=>!this.disposed||"Disposed"),!0}isDisposed(){return this.disposed}get schema(){return this.checkout.storedSchema}prepareForEdit(){(0,n.assert)(this.disposed===!1,2050);for(const o of this.withCursors)o.prepareForEdit();(0,n.assert)(this.withCursors.size===0,1907)}[t.disposeSymbol](){(0,n.assert)(this.disposed===!1,2051),this.disposed=!0,this.clear();for(const u of this.onDispose)u();this.onDispose.length=0;const o=this.checkout.forest.anchors.slots.delete(e.ContextSlot);(0,n.assert)(o,2244)}clear(){for(const o of this.withAnchors)o[t.disposeSymbol]();this.lazyRootCache=void 0,(0,n.assert)(this.withCursors.size===0,1908),(0,n.assert)(this.withAnchors.size===0,1909)}get root(){return(0,n.assert)(this.disposed===!1,2052),this.lazyRootCache??=this.detachedField(a.rootField,this.schema.rootFieldSchema.kind),this.lazyRootCache}detachedField(o,u){(0,n.assert)(this.disposed===!1,2972);const c=this.checkout.forest.allocateCursor("root");(0,a.moveToDetachedField)(this.checkout.forest,c,o);const d=(0,i.makeField)(this,u,c);return c.free(),d}get events(){return this.checkout.forest.events}}e.Context=r})(HM)),HM}var nG;function zae(){return nG||(nG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.treeStatusFromAnchorCache=e.indexForAt=e.getSchemaAndPolicy=e.getOrCreateHydratedFlexTreeNode=e.LazyEntity=e.assertFlexTreeEntityNotFreed=e.ContextSlot=e.Context=e.flexTreeSlot=e.isFlexTreeNode=e.FlexTreeEntityKind=e.flexTreeMarker=e.TreeStatus=void 0;var n=XE();Object.defineProperty(e,"TreeStatus",{enumerable:!0,get:function(){return n.TreeStatus}}),Object.defineProperty(e,"flexTreeMarker",{enumerable:!0,get:function(){return n.flexTreeMarker}}),Object.defineProperty(e,"FlexTreeEntityKind",{enumerable:!0,get:function(){return n.FlexTreeEntityKind}}),Object.defineProperty(e,"isFlexTreeNode",{enumerable:!0,get:function(){return n.isFlexTreeNode}}),Object.defineProperty(e,"flexTreeSlot",{enumerable:!0,get:function(){return n.flexTreeSlot}});var a=O0e();Object.defineProperty(e,"Context",{enumerable:!0,get:function(){return a.Context}}),Object.defineProperty(e,"ContextSlot",{enumerable:!0,get:function(){return a.ContextSlot}});var t=Cq();Object.defineProperty(e,"assertFlexTreeEntityNotFreed",{enumerable:!0,get:function(){return t.assertFlexTreeEntityNotFreed}}),Object.defineProperty(e,"LazyEntity",{enumerable:!0,get:function(){return t.LazyEntity}});var i=Bae();Object.defineProperty(e,"getOrCreateHydratedFlexTreeNode",{enumerable:!0,get:function(){return i.getOrCreateHydratedFlexTreeNode}});var r=_k();Object.defineProperty(e,"getSchemaAndPolicy",{enumerable:!0,get:function(){return r.getSchemaAndPolicy}}),Object.defineProperty(e,"indexForAt",{enumerable:!0,get:function(){return r.indexForAt}});var s=_k();Object.defineProperty(e,"treeStatusFromAnchorCache",{enumerable:!0,get:function(){return s.treeStatusFromAnchorCache}})})(zM)),zM}var vC={},rG;function P0e(){if(rG)return vC;rG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vC,"__esModule",{value:!0}),vC.DetachedFieldIndexSummarizer=void 0;const e=Ht(),n=Ma(),a="DetachedFieldIndexBlob";class t{constructor(r){this.detachedFieldIndex=r,this.key="DetachedFieldIndex"}summarize(r){const s=this.detachedFieldIndex.encode();return(0,n.createSingleBlobSummary)(a,r.stringify(s))}async load(r,s){if(await r.contains(a)){const o=await r.readBlob(a),u=(0,e.bufferToString)(o,"utf8"),c=s(u);this.detachedFieldIndex.loadData(c)}}}return vC.DetachedFieldIndexSummarizer=t,vC}var $M={},Bm={},SC={},iG;function Vae(){if(iG)return SC;iG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(SC,"__esModule",{value:!0}),SC.EncodedSchemaChange=void 0;const e=Nr(),n=Bt();return SC.EncodedSchemaChange=e.Type.Object({new:n.JsonCompatibleReadOnlySchema,old:n.JsonCompatibleReadOnlySchema}),SC}var sG;function E0e(){if(sG)return Bm;sG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Bm,"__esModule",{value:!0}),Bm.makeSchemaChangeCodec=Bm.makeSchemaChangeCodecs=void 0;const e=Je(),n=zn(),a=Sq(),t=Vae(),i=Vt();function r(u){return(0,n.makeCodecFamily)([[i.SchemaVersion.v1,o(u,i.SchemaVersion.v1)],[i.SchemaVersion.v2,o(u,i.SchemaVersion.v2)]])}Bm.makeSchemaChangeCodecs=r;function s(u,c){const d=r(u);return(0,n.makeVersionDispatchingCodec)(d,{...u,writeVersion:c})}Bm.makeSchemaChangeCodec=s;function o(u,c){const d=(0,a.makeSchemaCodec)(u,c),l={encode:f=>((0,e.assert)(!f.isInverse,2355),{new:d.encode(f.schema.new),old:d.encode(f.schema.old)}),decode:f=>({schema:{new:d.decode(f.new),old:d.decode(f.old)},isInverse:!1}),encodedSchema:t.EncodedSchemaChange};return(0,n.withSchemaValidation)(t.EncodedSchemaChange,l,u.jsonValidator)}return Bm}var aG;function I0e(){return aG||(aG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncodedSchemaChange=e.makeSchemaChangeCodecs=void 0;var n=E0e();Object.defineProperty(e,"makeSchemaChangeCodecs",{enumerable:!0,get:function(){return n.makeSchemaChangeCodecs}});var a=Vae();Object.defineProperty(e,"EncodedSchemaChange",{enumerable:!0,get:function(){return a.EncodedSchemaChange}})})($M)),$M}var Um={},oG;function R0e(){if(oG)return Um;oG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Um,"__esModule",{value:!0}),Um.makeMitigatedRebaser=Um.makeMitigatedChangeFamily=void 0;function e(a,t,i){return{buildEditor:(r,s)=>a.buildEditor(r,s),rebaser:n(a.rebaser,t,i),codecs:a.codecs}}Um.makeMitigatedChangeFamily=e;function n(a,t,i){const r=s=>{try{return s()}catch(o){return i(o),t}};return{compose:s=>r(()=>a.compose(s)),invert:(s,o,u)=>r(()=>a.invert(s,o,u)),rebase:(s,o,u)=>r(()=>a.rebase(s,o,u)),changeRevision:(s,o,u)=>r(()=>a.changeRevision(s,o,u))}}return Um.makeMitigatedRebaser=n,Um}var GM={},zm={},cG;function F0e(){if(cG)return zm;cG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(zm,"__esModule",{value:!0}),zm.hasElement=zm.AnchorTreeIndex=void 0;const e=Je(),n=Vt(),a=Bt(),t=zae();class i{constructor(u,c,d,l,f=!1){this.forest=u,this.indexer=c,this.getValue=d,this.checkTreeStatus=l,this.isShallowIndex=f,this.disposed=!1,this.keyFinders=new Map,this.keyToNodes=new Map,this.nodeToKey=new Map,this.anchors=new Map,this.keyFinder=this.acquireVisitor.bind(this),this.forest.registerAnnouncedVisitor(this.keyFinder);const b=[],C=u.getCursorAboveDetachedFields();(0,n.forEachField)(C,v=>{b.push(v.getFieldKey())});for(const v of b){const m=u.allocateCursor();u.tryMoveCursorToField({fieldKey:v,parent:void 0},m),this.indexField(m),m.free()}}acquireVisitor(){this.checkNotDisposed("visitor getter should be deregistered from the forest when index is disposed");let u,c;return(0,n.createAnnouncedVisitor)({afterCreate:(d,l)=>{const f=this.forest.allocateCursor();(0,e.assert)(this.forest.tryMoveCursorToField({fieldKey:l,parent:void 0},f)===1,2698),this.indexField(f),f.free()},afterAttach:()=>{(0,e.assert)(c!==void 0,2713),this.reIndexSpine(c)},afterDetach:(d,l,f,b)=>{b||((0,e.assert)(c!==void 0,2714),this.reIndexSpine(c))},enterNode(d){(0,e.assert)(u!==void 0,2701),c={parent:c,parentField:u,parentIndex:d},u=void 0},exitNode(d){(0,e.assert)(c!==void 0,2702);const l=c;u=l.parentField,c=l.parent},enterField:d=>{u=d},exitField(d){u=void 0}})}get(u){return this.checkNotDisposed(),this.getFilteredValue(this.keyToNodes.get(u))}has(u){return this.checkNotDisposed(),this.get(u)!==void 0}get size(){this.checkNotDisposed();let u=0;for(const c of this.keyToNodes.values())this.getFilteredValue(c)!==void 0&&(u+=1);return u}*keys(){this.checkNotDisposed();for(const[u,c]of this.keyToNodes.entries())this.getFilteredValue(c)!==void 0&&(yield u)}*values(){this.checkNotDisposed();for(const u of this.keyToNodes.values()){const c=this.getFilteredValue(u);c!==void 0&&(yield c)}}*entries(){this.checkNotDisposed();for(const[u,c]of this.keyToNodes.entries()){const d=this.getFilteredValue(c);d!==void 0&&(yield[u,d])}}[Symbol.iterator](){return this.checkNotDisposed(),this.entries()}forEach(u,c){this.checkNotDisposed();for(const[d,l]of this.keyToNodes.entries()){const f=this.getFilteredValue(l);f!==void 0&&u.call(c,f,d,this)}}*allEntries(){this.checkNotDisposed();for(const[u,c]of this.keyToNodes.entries()){const d=this.getValue(c);d!==void 0&&(yield[u,d])}}dispose(){this[a.disposeSymbol]()}[a.disposeSymbol](){this.checkNotDisposed("index is already disposed");for(const u of this.anchors.values())for(const c of u)this.forest.forgetAnchor(c);this.keyToNodes.clear(),this.anchors.clear(),this.forest.deregisterAnnouncedVisitor(this.keyFinder),this.disposed=!0}reIndexSpine(u){const c=this.forest.allocateCursor();this.forest.moveCursorToPath(u,c),(0,e.assert)(c.mode===0,2715),c.exitNode(),this.indexField(c),this.isShallowIndex||this.indexSpine(c),c.clear()}checkNotDisposed(u){if(this.disposed){if(u!==void 0)throw new Error(u);(0,e.assert)(!1,2703)}}indexNode(u){const c=(0,a.getOrCreate)(this.keyFinders,u.type,d=>this.indexer(d)??null);if(c!==null){const d=u.getPath(),l=c(u);if(!(0,n.compareUpPaths)(u.getPath(),d))throw new Error("key finder should be pure and functional");const f=u.buildAnchor(),b=this.forest.anchors.locate(f)??(0,e.fail)(2838),C=this.nodeToKey.get(b);if(C!==void 0)if(C===l){this.forest.forgetAnchor(f);return}else this.removeAnchor(b,C);(0,a.getOrCreate)(this.keyToNodes,l,()=>[]).push(b),this.nodeToKey.set(b,l),(0,a.getOrCreate)(this.anchors,b,()=>[]).push(f),b.events.on("afterDestroy",()=>{this.removeAnchor(b,l)})}}indexField(u){(0,n.forEachNode)(u,c=>{this.indexNode(c),(0,n.forEachField)(c,d=>{this.indexField(d)})})}indexSpine(u){if((0,n.keyAsDetachedField)(u.getFieldKey())!==n.rootField)u.exitField(),u.exitNode();else return;for(;u.mode===1&&(0,n.keyAsDetachedField)(u.getFieldKey())!==n.rootField;)(0,n.forEachNode)(u,c=>{this.indexNode(c)}),u.exitField(),u.exitNode()}removeAnchor(u,c){const d=this.keyToNodes.get(c);(0,e.assert)(d!==void 0,2704);const l=d.indexOf(u);(0,e.assert)(l!==-1,2705);const f=r(d,b=>b!==u);f!==void 0&&f.length>0?this.keyToNodes.set(c,f):this.keyToNodes.delete(c),this.nodeToKey.delete(u),(0,e.assert)(this.anchors.delete(u),2706)}getFilteredValue(u){const c=r(u,d=>this.checkTreeStatus(d)===t.TreeStatus.InDocument);if(c!==void 0&&s(c))return this.getValue(c)}}zm.AnchorTreeIndex=i;function r(o,u){if(o!==void 0)return o.filter(u)}function s(o){return o.length>=1}return zm.hasElement=s,zm}var uG;function j0e(){return uG||(uG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.hasElement=e.AnchorTreeIndex=void 0;var n=F0e();Object.defineProperty(e,"AnchorTreeIndex",{enumerable:!0,get:function(){return n.AnchorTreeIndex}}),Object.defineProperty(e,"hasElement",{enumerable:!0,get:function(){return n.hasElement}})})(GM)),GM}var dG;function An(){return dG||(dG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=Ou&&Ou.__createBinding||(Object.create?(function(F,R,M,j){j===void 0&&(j=M);var k=Object.getOwnPropertyDescriptor(R,M);(!k||("get"in k?!R.__esModule:k.writable||k.configurable))&&(k={enumerable:!0,get:function(){return R[M]}}),Object.defineProperty(F,j,k)}):(function(F,R,M,j){j===void 0&&(j=M),F[j]=R[M]})),a=Ou&&Ou.__setModuleDefault||(Object.create?(function(F,R){Object.defineProperty(F,"default",{enumerable:!0,value:R})}):function(F,R){F.default=R}),t=Ou&&Ou.__importStar||function(F){if(F&&F.__esModule)return F;var R={};if(F!=null)for(var M in F)M!=="default"&&Object.prototype.hasOwnProperty.call(F,M)&&n(R,F,M);return a(R,F),R};Object.defineProperty(e,"__esModule",{value:!0}),e.createNodeIdentifierManager=e.compareLocalNodeIdentifiers=e.emptyChunk=e.fluidVersionToFieldBatchCodecWriteVersion=e.makeFieldBatchCodec=e.makeTreeChunker=e.defaultChunkPolicy=e.buildChunkedForest=e.chunkFieldSingle=e.chunkField=e.chunkTree=e.mapRootChanges=e.isNeverTree=e.updateRefreshers=e.EncodedModularChangeset=e.ModularChangeFamily=e.FieldKindWithEditor=e.genericFieldKind=e.allowsRepoSuperset=e.FlexFieldKind=e.CrossFieldTarget=e.makeModularChangeCodecFamily=e.ModularEditBuilder=e.isNeverField=e.SequenceField=e.jsonableTreeFromForest=e.jsonableTreeFromFieldCursor=e.jsonableTreeFromCursor=e.cursorForJsonableTreeField=e.cursorForJsonableTreeNode=e.stackTreeFieldCursor=e.prefixFieldPath=e.prefixPath=e.stackTreeNodeCursor=e.makeSchemaCodecs=e.makeSchemaCodec=e.encodeTreeSchema=e.SchemaSummarizer=e.buildForest=e.mapTreeWithField=e.mapTreeFieldsWithField=e.mapTreeFieldFromCursor=e.mapTreeFromCursor=e.cursorForMapTreeNode=e.cursorForMapTreeField=e.ForestSummarizer=e.isTreeValue=e.assertAllowedValue=e.allowsValue=e.toDownPath=void 0,e.hasElement=e.AnchorTreeIndex=e.makeMitigatedChangeFamily=e.EncodedSchemaChange=e.makeSchemaChangeCodecs=e.DetachedFieldIndexSummarizer=e.valueSchemaAllows=e.TreeCompressionStrategyExtended=e.TreeCompressionStrategy=e.getOrCreateHydratedFlexTreeNode=e.FlexTreeEntityKind=e.indexForAt=e.treeStatusFromAnchorCache=e.LazyEntity=e.getSchemaAndPolicy=e.flexTreeSlot=e.assertFlexTreeEntityNotFreed=e.flexTreeMarker=e.ContextSlot=e.isFlexTreeNode=e.Context=e.TreeStatus=e.throwOutOfSchema=e.isFieldInSchema=e.isNodeInSchema=e.SchemaValidationError=e.relevantRemovedRoots=e.intoDelta=e.fieldKindConfigurations=e.fieldKinds=e.defaultSchemaPolicy=e.DefaultEditBuilder=e.DefaultChangeFamily=e.FieldKinds=e.nodeKeyTreeIdentifier=e.MockNodeIdentifierManager=e.isStableNodeIdentifier=void 0;var i=kve();Object.defineProperty(e,"toDownPath",{enumerable:!0,get:function(){return i.toDownPath}});var r=ZP();Object.defineProperty(e,"allowsValue",{enumerable:!0,get:function(){return r.allowsValue}}),Object.defineProperty(e,"assertAllowedValue",{enumerable:!0,get:function(){return r.assertAllowedValue}}),Object.defineProperty(e,"isTreeValue",{enumerable:!0,get:function(){return r.isTreeValue}});var s=Vve();Object.defineProperty(e,"ForestSummarizer",{enumerable:!0,get:function(){return s.ForestSummarizer}});var o=mq();Object.defineProperty(e,"cursorForMapTreeField",{enumerable:!0,get:function(){return o.cursorForMapTreeField}}),Object.defineProperty(e,"cursorForMapTreeNode",{enumerable:!0,get:function(){return o.cursorForMapTreeNode}}),Object.defineProperty(e,"mapTreeFromCursor",{enumerable:!0,get:function(){return o.mapTreeFromCursor}}),Object.defineProperty(e,"mapTreeFieldFromCursor",{enumerable:!0,get:function(){return o.mapTreeFieldFromCursor}}),Object.defineProperty(e,"mapTreeFieldsWithField",{enumerable:!0,get:function(){return o.mapTreeFieldsWithField}}),Object.defineProperty(e,"mapTreeWithField",{enumerable:!0,get:function(){return o.mapTreeWithField}});var u=_0e();Object.defineProperty(e,"buildForest",{enumerable:!0,get:function(){return u.buildForest}});var c=Sq();Object.defineProperty(e,"SchemaSummarizer",{enumerable:!0,get:function(){return c.SchemaSummarizer}}),Object.defineProperty(e,"encodeTreeSchema",{enumerable:!0,get:function(){return c.encodeTreeSchema}}),Object.defineProperty(e,"makeSchemaCodec",{enumerable:!0,get:function(){return c.makeSchemaCodec}}),Object.defineProperty(e,"makeSchemaCodecs",{enumerable:!0,get:function(){return c.makeSchemaCodecs}});var d=Yg();Object.defineProperty(e,"stackTreeNodeCursor",{enumerable:!0,get:function(){return d.stackTreeNodeCursor}}),Object.defineProperty(e,"prefixPath",{enumerable:!0,get:function(){return d.prefixPath}}),Object.defineProperty(e,"prefixFieldPath",{enumerable:!0,get:function(){return d.prefixFieldPath}}),Object.defineProperty(e,"stackTreeFieldCursor",{enumerable:!0,get:function(){return d.stackTreeFieldCursor}});var l=w0e();Object.defineProperty(e,"cursorForJsonableTreeNode",{enumerable:!0,get:function(){return l.cursorForJsonableTreeNode}}),Object.defineProperty(e,"cursorForJsonableTreeField",{enumerable:!0,get:function(){return l.cursorForJsonableTreeField}}),Object.defineProperty(e,"jsonableTreeFromCursor",{enumerable:!0,get:function(){return l.jsonableTreeFromCursor}}),Object.defineProperty(e,"jsonableTreeFromFieldCursor",{enumerable:!0,get:function(){return l.jsonableTreeFromFieldCursor}}),Object.defineProperty(e,"jsonableTreeFromForest",{enumerable:!0,get:function(){return l.jsonableTreeFromForest}});const f=t(kae());e.SequenceField=f;var b=ki();Object.defineProperty(e,"isNeverField",{enumerable:!0,get:function(){return b.isNeverField}}),Object.defineProperty(e,"ModularEditBuilder",{enumerable:!0,get:function(){return b.ModularEditBuilder}}),Object.defineProperty(e,"makeModularChangeCodecFamily",{enumerable:!0,get:function(){return b.makeModularChangeCodecFamily}}),Object.defineProperty(e,"CrossFieldTarget",{enumerable:!0,get:function(){return b.CrossFieldTarget}}),Object.defineProperty(e,"FlexFieldKind",{enumerable:!0,get:function(){return b.FlexFieldKind}}),Object.defineProperty(e,"allowsRepoSuperset",{enumerable:!0,get:function(){return b.allowsRepoSuperset}}),Object.defineProperty(e,"genericFieldKind",{enumerable:!0,get:function(){return b.genericFieldKind}}),Object.defineProperty(e,"FieldKindWithEditor",{enumerable:!0,get:function(){return b.FieldKindWithEditor}}),Object.defineProperty(e,"ModularChangeFamily",{enumerable:!0,get:function(){return b.ModularChangeFamily}}),Object.defineProperty(e,"EncodedModularChangeset",{enumerable:!0,get:function(){return b.EncodedModularChangeset}}),Object.defineProperty(e,"updateRefreshers",{enumerable:!0,get:function(){return b.updateRefreshers}}),Object.defineProperty(e,"isNeverTree",{enumerable:!0,get:function(){return b.isNeverTree}});var C=QE();Object.defineProperty(e,"mapRootChanges",{enumerable:!0,get:function(){return C.mapRootChanges}});var v=GE();Object.defineProperty(e,"chunkTree",{enumerable:!0,get:function(){return v.chunkTree}}),Object.defineProperty(e,"chunkField",{enumerable:!0,get:function(){return v.chunkField}}),Object.defineProperty(e,"chunkFieldSingle",{enumerable:!0,get:function(){return v.chunkFieldSingle}}),Object.defineProperty(e,"buildChunkedForest",{enumerable:!0,get:function(){return v.buildChunkedForest}}),Object.defineProperty(e,"defaultChunkPolicy",{enumerable:!0,get:function(){return v.defaultChunkPolicy}}),Object.defineProperty(e,"makeTreeChunker",{enumerable:!0,get:function(){return v.makeTreeChunker}}),Object.defineProperty(e,"makeFieldBatchCodec",{enumerable:!0,get:function(){return v.makeFieldBatchCodec}}),Object.defineProperty(e,"fluidVersionToFieldBatchCodecWriteVersion",{enumerable:!0,get:function(){return v.fluidVersionToFieldBatchCodecWriteVersion}}),Object.defineProperty(e,"emptyChunk",{enumerable:!0,get:function(){return v.emptyChunk}});var m=fae();Object.defineProperty(e,"compareLocalNodeIdentifiers",{enumerable:!0,get:function(){return m.compareLocalNodeIdentifiers}}),Object.defineProperty(e,"createNodeIdentifierManager",{enumerable:!0,get:function(){return m.createNodeIdentifierManager}}),Object.defineProperty(e,"isStableNodeIdentifier",{enumerable:!0,get:function(){return m.isStableNodeIdentifier}}),Object.defineProperty(e,"MockNodeIdentifierManager",{enumerable:!0,get:function(){return m.MockNodeIdentifierManager}}),Object.defineProperty(e,"nodeKeyTreeIdentifier",{enumerable:!0,get:function(){return m.nodeKeyTreeIdentifier}});var h=YE();Object.defineProperty(e,"FieldKinds",{enumerable:!0,get:function(){return h.FieldKinds}}),Object.defineProperty(e,"DefaultChangeFamily",{enumerable:!0,get:function(){return h.DefaultChangeFamily}}),Object.defineProperty(e,"DefaultEditBuilder",{enumerable:!0,get:function(){return h.DefaultEditBuilder}}),Object.defineProperty(e,"defaultSchemaPolicy",{enumerable:!0,get:function(){return h.defaultSchemaPolicy}}),Object.defineProperty(e,"fieldKinds",{enumerable:!0,get:function(){return h.fieldKinds}}),Object.defineProperty(e,"fieldKindConfigurations",{enumerable:!0,get:function(){return h.fieldKindConfigurations}}),Object.defineProperty(e,"intoDelta",{enumerable:!0,get:function(){return h.intoDelta}}),Object.defineProperty(e,"relevantRemovedRoots",{enumerable:!0,get:function(){return h.relevantRemovedRoots}}),Object.defineProperty(e,"SchemaValidationError",{enumerable:!0,get:function(){return h.SchemaValidationError}}),Object.defineProperty(e,"isNodeInSchema",{enumerable:!0,get:function(){return h.isNodeInSchema}}),Object.defineProperty(e,"isFieldInSchema",{enumerable:!0,get:function(){return h.isFieldInSchema}}),Object.defineProperty(e,"throwOutOfSchema",{enumerable:!0,get:function(){return h.throwOutOfSchema}});var g=zae();Object.defineProperty(e,"TreeStatus",{enumerable:!0,get:function(){return g.TreeStatus}}),Object.defineProperty(e,"Context",{enumerable:!0,get:function(){return g.Context}}),Object.defineProperty(e,"isFlexTreeNode",{enumerable:!0,get:function(){return g.isFlexTreeNode}}),Object.defineProperty(e,"ContextSlot",{enumerable:!0,get:function(){return g.ContextSlot}}),Object.defineProperty(e,"flexTreeMarker",{enumerable:!0,get:function(){return g.flexTreeMarker}}),Object.defineProperty(e,"assertFlexTreeEntityNotFreed",{enumerable:!0,get:function(){return g.assertFlexTreeEntityNotFreed}}),Object.defineProperty(e,"flexTreeSlot",{enumerable:!0,get:function(){return g.flexTreeSlot}}),Object.defineProperty(e,"getSchemaAndPolicy",{enumerable:!0,get:function(){return g.getSchemaAndPolicy}}),Object.defineProperty(e,"LazyEntity",{enumerable:!0,get:function(){return g.LazyEntity}}),Object.defineProperty(e,"treeStatusFromAnchorCache",{enumerable:!0,get:function(){return g.treeStatusFromAnchorCache}}),Object.defineProperty(e,"indexForAt",{enumerable:!0,get:function(){return g.indexForAt}}),Object.defineProperty(e,"FlexTreeEntityKind",{enumerable:!0,get:function(){return g.FlexTreeEntityKind}}),Object.defineProperty(e,"getOrCreateHydratedFlexTreeNode",{enumerable:!0,get:function(){return g.getOrCreateHydratedFlexTreeNode}});var _=$E();Object.defineProperty(e,"TreeCompressionStrategy",{enumerable:!0,get:function(){return _.TreeCompressionStrategy}}),Object.defineProperty(e,"TreeCompressionStrategyExtended",{enumerable:!0,get:function(){return _.TreeCompressionStrategyExtended}});var S=ZP();Object.defineProperty(e,"valueSchemaAllows",{enumerable:!0,get:function(){return S.valueSchemaAllows}});var p=P0e();Object.defineProperty(e,"DetachedFieldIndexSummarizer",{enumerable:!0,get:function(){return p.DetachedFieldIndexSummarizer}});var w=I0e();Object.defineProperty(e,"makeSchemaChangeCodecs",{enumerable:!0,get:function(){return w.makeSchemaChangeCodecs}}),Object.defineProperty(e,"EncodedSchemaChange",{enumerable:!0,get:function(){return w.EncodedSchemaChange}});var O=R0e();Object.defineProperty(e,"makeMitigatedChangeFamily",{enumerable:!0,get:function(){return O.makeMitigatedChangeFamily}});var E=j0e();Object.defineProperty(e,"AnchorTreeIndex",{enumerable:!0,get:function(){return E.AnchorTreeIndex}}),Object.defineProperty(e,"hasElement",{enumerable:!0,get:function(){return E.hasElement}})})(Ou)),Ou}var WM={},Fu={},JM={},ju={},lG;function Hae(){if(lG)return ju;lG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=ju&&ju.__classPrivateFieldGet||function(c,d,l,f){if(l==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof d=="function"?c!==d||!f:!d.has(c))throw new TypeError("Cannot read private member from an object whose class did not declare it");return l==="m"?f:l==="a"?f.call(c):f?f.value:d.get(c)},n;Object.defineProperty(ju,"__esModule",{value:!0}),ju.onForkTransitive=ju.SharedTreeBranch=void 0;const a=Ht(),t=Je(),i=Ot(),r=Vt(),s=Bt();class o{constructor(d,l,f,b,C){this.head=d,this.changeFamily=l,this.mintRevisionTag=f,this.branchTrimmer=b,this.telemetryEventBatcher=C,n.set(this,(0,a.createEmitter)()),this.events=e(this,n,"f"),this.disposed=!1,this.editor=this.changeFamily.buildEditor(f,v=>this.apply(v)),this.unsubscribeBranchTrimmer=b?.on("ancestryTrimmed",v=>{e(this,n,"f").emit("ancestryTrimmed",v)})}setHead(d){this.assertNotDisposed(),this.head=d}apply(d,l=r.CommitKind.Default){this.assertNotDisposed();const f=d.revision;(0,t.assert)(f!==void 0,2633);const b=(0,r.mintCommit)(this.head,{revision:f,change:d.change}),C={type:"append",kind:l,change:d,newCommits:[b]};e(this,n,"f").emit("beforeChange",C),this.head=b,e(this,n,"f").emit("afterChange",C)}getHead(){return this.head}fork(d=this.head){this.assertNotDisposed();const l=new o(d,this.changeFamily,this.mintRevisionTag,this.branchTrimmer);return e(this,n,"f").emit("fork",l),l}rebaseOnto(d,l=d.getHead()){this.assertNotDisposed();const f=this.rebaseBranch(this,d,l);if(f===void 0)return;const{newSourceHead:b,commits:C}=f,{deletedSourceCommits:v,targetCommits:m,sourceCommits:h}=C;(0,t.assert)((0,s.hasSome)(m),2691);const g=m.concat(h),_={type:"rebase",get change(){const S=f.sourceChange;return S===void 0?void 0:(0,r.makeAnonChange)(S)},removedCommits:v,newCommits:g};e(this,n,"f").emit("beforeChange",_),this.head=b,e(this,n,"f").emit("afterChange",_)}removeAfter(d){if(d===this.head)return;const l=[],f=[];(0,r.findAncestor)([this.head,l],v=>{if(v!==d){const m=this.mintRevisionTag(),h=this.changeFamily.rebaser.invert(v,!0,m);return f.push((0,r.tagRollbackInverse)(h,m,v.revision)),!1}return!0}),(0,t.assert)((0,s.hasSome)(l),2692);const C={type:"remove",change:(0,r.makeAnonChange)(this.changeFamily.rebaser.compose(f)),removedCommits:l};e(this,n,"f").emit("beforeChange",C),this.head=d,e(this,n,"f").emit("afterChange",C)}merge(d){if(this.assertNotDisposed(),d.assertNotDisposed(),d===this)return;const l=this.rebaseBranch(d,this);if(l===void 0)return;const f=l.commits.sourceCommits;(0,t.assert)((0,s.hasSome)(f),2694);const{rebaser:b}=this.changeFamily,C=(0,s.defineLazyCachedProperty)({type:"append",kind:r.CommitKind.Default,newCommits:f},"change",()=>(0,r.makeAnonChange)(b.compose(f)));return e(this,n,"f").emit("beforeChange",C),this.head=l.newSourceHead,e(this,n,"f").emit("afterChange",C),{sourceCommits:f}}rebaseBranch(d,l,f=l.getHead()){const{head:b}=d;if(b===f)return;const{duration:C,output:v}=(0,i.measure)(()=>(0,r.rebaseBranch)(this.mintRevisionTag,this.changeFamily.rebaser,b,f,l.getHead()));if(this.telemetryEventBatcher?.accumulateAndLog({duration:C,...v.telemetryProperties}),this.head!==v.newSourceHead)return v}dispose(){this.disposed||(this.unsubscribeBranchTrimmer?.(),this.disposed=!0,e(this,n,"f").emit("dispose"))}assertNotDisposed(){(0,t.assert)(!this.disposed,1646)}}ju.SharedTreeBranch=o,n=new WeakMap;function u(c,d){const l=[];return l.push(c.events.on("fork",f=>{l.push(u(f,d)),d(f)})),()=>l.forEach(f=>f())}return ju.onForkTransitive=u,ju}var Ta={},fG;function M0e(){if(fG)return Ta;fG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Ta&&Ta.__classPrivateFieldGet||function(m,h,g,_){if(g==="a"&&!_)throw new TypeError("Private accessor was defined without a getter");if(typeof h=="function"?m!==h||!_:!h.has(m))throw new TypeError("Cannot read private member from an object whose class did not declare it");return g==="m"?_:g==="a"?_.call(m):_?_.value:h.get(m)},n=Ta&&Ta.__classPrivateFieldSet||function(m,h,g,_,S){if(_==="m")throw new TypeError("Private method is not writable");if(_==="a"&&!S)throw new TypeError("Private accessor was defined without a setter");if(typeof h=="function"?m!==h||!S:!h.has(m))throw new TypeError("Cannot write private member to an object whose class did not declare it");return _==="a"?S.call(m,g):S?S.value=g:h.set(m,g),g},a,t,i,r,s,o;Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.SquashingTransactionStack=Ta.TransactionStack=Ta.TransactionResult=void 0;const u=Ht(),c=Je(),d=Ot(),l=Vt(),f=Bt();var b;(function(m){m[m.Abort=0]="Abort",m[m.Commit=1]="Commit"})(b||(Ta.TransactionResult=b={}));class C{get events(){return e(this,i,"f")}get disposed(){return e(this,r,"f")}constructor(h){a.set(this,[]),t.set(this,void 0),i.set(this,(0,u.createEmitter)()),r.set(this,!1),n(this,t,h,"f")}isInProgress(){return this.ensureNotDisposed(),e(this,a,"f").length>0}start(){this.ensureNotDisposed(),e(this,a,"f").push(e(this,t,"f")?.call(this)),e(this,i,"f").emit("started")}commit(){if(this.ensureNotDisposed(),!this.isInProgress())throw new d.UsageError("No transaction to commit");e(this,i,"f").emit("committing"),e(this,a,"f").pop()?.(b.Commit)}abort(){if(this.ensureNotDisposed(),!this.isInProgress())throw new d.UsageError("No transaction to abort");e(this,i,"f").emit("aborting"),e(this,a,"f").pop()?.(b.Abort)}dispose(){for(this.ensureNotDisposed();this.isInProgress();)this.abort();n(this,r,!0,"f")}ensureNotDisposed(){if(this.disposed)throw new d.UsageError("Transactor is disposed")}}Ta.TransactionStack=C,a=new WeakMap,t=new WeakMap,i=new WeakMap,r=new WeakMap;class v extends C{get activeBranch(){return e(this,s,"f")??this.branch}get activeBranchEvents(){const h=(g,_)=>{this.activeBranch.events.off(g,_);const S=e(this,o,"f").get(g);S?.delete(_)===!0&&S.size===0&&e(this,o,"f").delete(g)};return{on:(g,_)=>((0,f.getOrCreate)(e(this,o,"f"),g,()=>new Set).add(_),this.activeBranch.events.on(g,_),()=>h(g,_)),off:h}}constructor(h,g,_){super(()=>{const S=this.activeBranch.getHead(),p=_?.(),w=e(this,s,"f")??this.branch.fork();return this.setTransactionBranch(w),w.editor.enterTransaction(),O=>{switch((0,c.assert)(e(this,s,"f")!==void 0,2712),e(this,s,"f").editor.exitTransaction(),O){case b.Abort:e(this,s,"f").removeAfter(S);break;case b.Commit:if(!this.isInProgress()&&e(this,s,"f").getHead()!==S){const E=[];(0,l.findAncestor)([e(this,s,"f").getHead(),E],F=>F===S),h.apply(g(E))}break;default:(0,c.unreachableCase)(O)}this.isInProgress()||(e(this,s,"f").dispose(),this.setTransactionBranch(void 0)),p?.(O)}}),s.set(this,void 0),this.activeBranchEditor=new Proxy({},{get:(S,p,w)=>Reflect.get(this.activeBranch.editor,p,w)}),o.set(this,new Map),this.branch=h}setTransactionBranch(h){const g=this.activeBranch;n(this,s,h,"f");for(const[_,S]of e(this,o,"f"))for(const p of S)g.events.off(_,p),this.activeBranch.events.on(_,p)}}return Ta.SquashingTransactionStack=v,s=new WeakMap,o=new WeakMap,Ta}var Po={},Mu={},Nu={},hG;function N0e(){if(hG)return Nu;hG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Nu&&Nu.__classPrivateFieldSet||function(u,c,d,l,f){if(l==="m")throw new TypeError("Private method is not writable");if(l==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof c=="function"?u!==c||!f:!c.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return l==="a"?f.call(u,d):f?f.value=d:c.set(u,d),d},n=Nu&&Nu.__classPrivateFieldGet||function(u,c,d,l){if(d==="a"&&!l)throw new TypeError("Private accessor was defined without a getter");if(typeof c=="function"?u!==c||!l:!c.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return d==="m"?l:d==="a"?l.call(u):l?l.value:c.get(u)},a,t,i,r;Object.defineProperty(Nu,"__esModule",{value:!0}),Nu.TransactionEnricher=void 0;const s=Je();class o{constructor(c,d){a.set(this,void 0),t.set(this,void 0),i.set(this,[]),r.set(this,[]),e(this,a,c,"f"),e(this,t,d,"f")}isTransacting(){return n(this,r,"f").length!==0}startTransaction(){n(this,r,"f").push(n(this,i,"f").length)}commitTransaction(){const c=n(this,r,"f").pop();if((0,s.assert)(c!==void 0,2437),n(this,r,"f").length===0){if(n(this,i,"f").length===0)return;const d=n(this,i,"f");return e(this,i,[],"f"),l=>n(this,a,"f").changeRevision(n(this,a,"f").compose(d),l)}}abortTransaction(){const c=n(this,r,"f").pop();(0,s.assert)(c!==void 0,2438),n(this,i,"f").length=c}addTransactionStep(c){(0,s.assert)(n(this,r,"f").length!==0,2439);const d=n(this,t,"f").updateChangeEnrichments(c.change,c.revision);n(this,i,"f").push({...c,change:d})}}return Nu.TransactionEnricher=o,a=new WeakMap,t=new WeakMap,i=new WeakMap,r=new WeakMap,Nu}var mG;function A0e(){if(mG)return Mu;mG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Mu&&Mu.__classPrivateFieldSet||function(d,l,f,b,C){if(b==="m")throw new TypeError("Private method is not writable");if(b==="a"&&!C)throw new TypeError("Private accessor was defined without a setter");if(typeof l=="function"?d!==l||!C:!l.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return b==="a"?C.call(d,f):C?C.value=f:l.set(d,f),f},n=Mu&&Mu.__classPrivateFieldGet||function(d,l,f,b){if(f==="a"&&!b)throw new TypeError("Private accessor was defined without a getter");if(typeof l=="function"?d!==l||!b:!l.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return f==="m"?b:f==="a"?b.call(d):b?b.value:l.get(d)},a,t,i,r;Object.defineProperty(Mu,"__esModule",{value:!0}),Mu.BranchCommitEnricher=void 0;const s=Je(),o=Vt(),u=N0e();class c{constructor(l,f){a.set(this,void 0),t.set(this,void 0),i.set(this,new Map),r.set(this,void 0),e(this,t,f,"f"),e(this,a,new u.TransactionEnricher(l,n(this,t,"f")),"f")}processChange(l){if(l.type==="append")for(const f of l.newCommits){const b=n(this,r,"f")?.call(this,f.revision)??n(this,t,"f").updateChangeEnrichments(f.change,f.revision);n(this,i,"f").set(f,(0,o.replaceChange)(f,b))}e(this,r,void 0,"f")}enrich(l){const f=n(this,i,"f").get(l);return(0,s.assert)(f!==void 0,2432),n(this,i,"f").delete(l),f}startTransaction(){n(this,a,"f").startTransaction()}commitTransaction(){e(this,r,n(this,a,"f").commitTransaction(),"f")}abortTransaction(){n(this,a,"f").abortTransaction()}addTransactionCommits(l){(0,s.assert)(n(this,a,"f").isTransacting(),2711);for(const f of l)n(this,a,"f").addTransactionStep(f)}}return Mu.BranchCommitEnricher=c,a=new WeakMap,t=new WeakMap,i=new WeakMap,r=new WeakMap,Mu}var CC={},pG;function Kae(){if(pG)return CC;pG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(CC,"__esModule",{value:!0}),CC.NoOpChangeEnricher=void 0;const e=Bt();class n{applyTipChange(t,i){}updateChangeEnrichments(t,i){return t}fork(){return new n}[e.disposeSymbol](){}}return CC.NoOpChangeEnricher=n,CC}var _C={},gG;function $ae(){if(gG)return _C;gG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_C,"__esModule",{value:!0}),_C.DefaultResubmitMachine=void 0;const e=Je(),n=Bt();class a{constructor(i,r){this.makeRollback=i,this.tip=r,this.inFlightQueue=new e.DoublyLinkedList,this.currentEnrichment=0}onCommitSubmitted(i){if(this.pendingResubmitRange!==void 0){const r=this.pendingResubmitRange?.first;(0,e.assert)(r?.data.commit===i,2433),r!==this.pendingResubmitRange.last?((0,e.assert)(r.next!==void 0,3030),this.pendingResubmitRange.first=r.next):this.pendingResubmitRange=void 0,r.remove()}this.inFlightQueue.push({commit:i,lastEnrichment:this.currentEnrichment})}onCommitRollback(i){(0,e.assert)(i.revision===this.inFlightQueue.last?.data.commit.revision,3031),this.inFlightQueue.pop()}prepareForResubmit(i){if((0,e.assert)(!this.isInResubmitPhase,2391),!(0,n.hasSome)(i))return;(0,e.assert)(i.length<=this.inFlightQueue.length,3032);const r=this.inFlightQueue.find(o=>o.data.commit.revision===i[0].revision),s=this.inFlightQueue.last;if((0,e.assert)(r!==void 0&&s!==void 0,3033),this.pendingResubmitRange={first:r,last:s},r.data.lastEnrichment<this.currentEnrichment){const o=this.tip.fork();for(let c=i.length-1;c>=0;c-=1){const d=i[c]??(0,e.oob)(),l=this.makeRollback(d);o.applyTipChange(l)}let u=r;for(const c of i){if((0,e.assert)(u!==void 0,3034),u.data.commit=c,u.data.lastEnrichment<this.currentEnrichment){const d=o.updateChangeEnrichments(c.change,c.revision),l={...c,change:d};u.next!==void 0&&u.next.data.lastEnrichment<this.currentEnrichment&&o.applyTipChange(d,c.revision),u.data.commit=l,u.data.lastEnrichment=this.currentEnrichment}u=u.next}o[n.disposeSymbol]()}}peekNextCommit(){return(0,e.assert)(this.isInResubmitPhase,2434),(0,e.assert)(this.pendingResubmitRange!==void 0,2695),this.pendingResubmitRange.first.data.commit}get isInResubmitPhase(){return this.pendingResubmitRange!==void 0}onSequencedCommitApplied(i){i?((0,e.assert)(this.inFlightQueue.length>0,2393),this.inFlightQueue.shift()):this.currentEnrichment++}}return _C.DefaultResubmitMachine=a,_C}var QM={},YM={},yG;function D0e(){return yG||(yG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getUpperBoundOfPreviousSequenceId=e.maxSequenceId=e.minSequenceId=e.equalSequenceIds=e.sequenceIdComparator=void 0;const n=Je(),a=Bt(),t=(u,c)=>u.sequenceNumber!==c.sequenceNumber?u.sequenceNumber-c.sequenceNumber:u.indexInBatch===c.indexInBatch?0:(u.indexInBatch??0)-(c.indexInBatch??0);e.sequenceIdComparator=t;const i=(u,c)=>(0,e.sequenceIdComparator)(u,c)===0;e.equalSequenceIds=i;const r=(u,c)=>(0,e.sequenceIdComparator)(u,c)<0?u:c;e.minSequenceId=r;const s=(u,c)=>(0,e.sequenceIdComparator)(u,c)>0?u:c;e.maxSequenceId=s;const o=u=>((0,n.assert)(u.indexInBatch===void 0||Number.isFinite(u.indexInBatch),2748),u.indexInBatch===void 0||u.indexInBatch===0?{sequenceNumber:(0,a.brand)(u.sequenceNumber-1),indexInBatch:Number.POSITIVE_INFINITY}:{sequenceNumber:(0,a.brand)(u.sequenceNumber),indexInBatch:u.indexInBatch-1});e.getUpperBoundOfPreviousSequenceId=o})(YM)),YM}var bG;function Gae(){return bG||(bG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EditManager=e.minimumPossibleSequenceNumber=void 0;const n=Je(),a=Ht(),t=dl(),i=Vt(),r=Bt(),s=Hae(),o=D0e(),u=Ot();e.minimumPossibleSequenceNumber=(0,r.brand)(Number.MIN_SAFE_INTEGER);const c={sequenceNumber:e.minimumPossibleSequenceNumber},d="root",l=1e3;class f{constructor(v,m,h,g){this.changeFamily=v,this.localSessionId=m,this.mintRevisionTag=h,this._events=(0,a.createEmitter)(),this.trunkMetadata=new Map,this.sequenceMap=new t.BTree(void 0,o.sequenceIdComparator),this.peerLocalBranches=new Map,this.trunkBranches=new t.BTree(void 0,o.sequenceIdComparator),this.minimumSequenceNumber=e.minimumPossibleSequenceNumber,this.localCommits=[],this.trunkBase={revision:d,change:v.rebaser.compose([])},this.sequenceMap.set(c,this.trunkBase),g!==void 0&&(this.telemetryEventBatcher=new u.TelemetryEventBatcher({eventName:"rebaseProcessing",category:"performance"},g,l)),this.trunk=new s.SharedTreeBranch(this.trunkBase,v,h,this._events,this.telemetryEventBatcher),this.localBranch=new s.SharedTreeBranch(this.trunk.getHead(),v,h,this._events,this.telemetryEventBatcher),this.localBranch.events.on("afterChange",_=>{if(_.type==="append")for(const S of _.newCommits)this.localCommits.push(S);else this.localCommits.length=0,(0,i.findCommonAncestor)([this.localBranch.getHead(),this.localCommits],this.trunk.getHead())}),(0,s.onForkTransitive)(this.localBranch,_=>this.registerBranch(_))}registerBranch(v){this.trackBranch(v);const m=v.events.on("beforeChange",_=>{_.type==="rebase"&&this.untrackBranch(v)}),h=v.events.on("afterChange",_=>{_.type==="rebase"&&(this.trackBranch(v),this.trimTrunk())}),g=v.events.on("dispose",()=>{this.untrackBranch(v),this.trimTrunk(),m(),h(),g()})}trackBranch(v){const m=(0,i.findCommonAncestor)(this.trunk.getHead(),v.getHead())??(0,n.fail)(2770),h=this.getCommitSequenceId(m),g=(0,r.getOrCreate)(this.trunkBranches,h,()=>new Set);(0,n.assert)(!g.has(v),1648),g.add(v)}untrackBranch(v){const m=(0,i.findCommonAncestor)(this.trunk.getHead(),v.getHead())??(0,n.fail)(2771),h=this.getCommitSequenceId(m),g=this.trunkBranches.get(h)??(0,n.fail)(2772);(0,n.assert)(g.delete(v),1649),g.size===0&&this.trunkBranches.delete(h)}fastForwardNextLocalCommit(v){const m=this.localCommits.shift();(0,n.assert)(m!==void 0,1717);const h=this.getCommitSequenceId(this.trunk.getHead());this.pushGraphCommitToTrunk(v,m,this.localSessionId);const g=this.trunkBranches.get(h);if(g!==void 0){const _=(0,r.getOrCreate)(this.trunkBranches,v,()=>new Set);for(const S of g)(0,i.findAncestor)(S.getHead(),p=>p===m)!==void 0&&(_.add(S),g.delete(S));g.size===0&&this.trunkBranches.delete(h),_.size===0&&this.trunkBranches.delete(v)}}getSequenceNumber(v){return this.trunkMetadata.get(v.revision)?.sequenceId.sequenceNumber}advanceMinimumSequenceNumber(v,m=!0){v!==this.minimumSequenceNumber&&((0,n.assert)(v>this.minimumSequenceNumber,1142),this.minimumSequenceNumber=v,m&&this.trimTrunk())}trimTrunk(){let v={sequenceNumber:this.minimumSequenceNumber,indexInBatch:Number.POSITIVE_INFINITY};const m=this.trunkBranches.minKey();if(m!==void 0){const _=(0,o.getUpperBoundOfPreviousSequenceId)(m);v=(0,o.minSequenceId)(v,_)}const[h,g]=this.getClosestTrunkCommit((0,o.maxSequenceId)(v,this.sequenceMap.minKey()??c));if(g!==this.trunkBase){for(const[,w]of this.peerLocalBranches)w.rebaseOnto(this.trunk,g);const _=g;this.trunkMetadata.delete(_.revision);const S=b(_,this.trunkBase).map(w=>w.revision);delete _.parent,this.trunkBase=_,this.sequenceMap.editRange(c,h,!0,(w,O)=>{if(this.trunkMetadata.delete(O.revision),(0,o.equalSequenceIds)(w,h))(0,n.assert)(O===_,1833);else return Reflect.defineProperty(O,"change",{get:()=>(0,n.assert)(!1,2654)}),Reflect.defineProperty(O,"revision",{get:()=>(0,n.assert)(!1,2655)}),Reflect.defineProperty(O,"parent",{get:()=>(0,n.assert)(!1,2656)}),{delete:!0}});const p=b(this.trunk.getHead(),this.trunkBase).length;(0,n.assert)(this.sequenceMap.size===p+1,1860),(0,n.assert)(this.trunkMetadata.size===p,1861),this._events.emit("ancestryTrimmed",S)}}isEmpty(){return this.trunk.getHead()===this.trunkBase&&this.peerLocalBranches.size===0&&this.localBranch.getHead()===this.trunk.getHead()&&this.minimumSequenceNumber===e.minimumPossibleSequenceNumber}getSummaryData(){(0,n.assert)(this.localBranch.getHead()===this.trunk.getHead(),1064),this.trimTrunk();let v=this.getClosestTrunkCommit(this.minimumSequenceNumber)[1];(0,n.assert)(v.parent!==void 0||v===this.trunkBase,2247),v=v.parent??v;const m=b(this.trunk.getHead(),v).map(g=>{(0,n.assert)(g!==this.trunkBase,2657);const _=this.trunkMetadata.get(g.revision)??(0,n.fail)(2773),S={change:g.change,revision:g.revision,sequenceNumber:_.sequenceId.sequenceNumber,sessionId:_.sessionId};return _.sequenceId.indexInBatch!==void 0&&(S.indexInBatch=_.sequenceId.indexInBatch),S}),h=new Map((0,r.mapIterable)(this.peerLocalBranches.entries(),([g,_])=>{const S=[],p=(0,i.findCommonAncestor)([_.getHead(),S],this.trunk.getHead())??(0,n.fail)(2774),w=p===this.trunkBase?d:p.revision;return[g,{base:w,commits:S.map(O=>((0,n.assert)(O!==this.trunkBase,2658),{change:O.change,revision:O.revision,sessionId:g}))}]}));return{trunk:m,peerLocalBranches:h}}loadSummaryData(v){(0,n.assert)(this.isEmpty(),1674);const m=new Map;m.set(this.trunkBase.revision,this.trunkBase),this.trunk.setHead(v.trunk.reduce((h,g)=>{const _=g.indexInBatch===void 0?{sequenceNumber:g.sequenceNumber}:{sequenceNumber:g.sequenceNumber,indexInBatch:g.indexInBatch},S=(0,i.mintCommit)(h,g);return this.sequenceMap.set(_,S),this.trunkMetadata.set(g.revision,{sequenceId:_,sessionId:g.sessionId}),m.set(g.revision,S),S},this.trunkBase)),this.localBranch.setHead(this.trunk.getHead());for(const[h,g]of v.peerLocalBranches){const _=m.get(g.base)??(0,n.fail)(2775);this.peerLocalBranches.set(h,new s.SharedTreeBranch(g.commits.reduce(i.mintCommit,_),this.changeFamily,this.mintRevisionTag))}}getCommitSequenceId(v){const m=this.trunkMetadata.get(v.revision)?.sequenceId;return m===void 0?((0,n.assert)(v===this.trunkBase,2659),c):m}getTrunkChanges(){return this.getTrunkCommits().map(v=>v.change)}getTrunkCommits(){return b(this.trunk.getHead(),this.trunkBase)}getTrunkHead(){return this.trunk.getHead()}getLocalChanges(){return this.getLocalCommits().map(v=>v.change)}getLocalCommits(){return this.localCommits}getLongestBranchLength(){let v=0;const m=this.trunk.getHead();for(const g of this.peerLocalBranches.values()){const _=b(g.getHead(),m);_.length>v&&(v=_.length)}const h=b(this.localBranch.getHead(),m);return Math.max(v,h.length)}addSequencedChanges(v,m,h,g){(0,n.assert)(v.length>0,2776),(0,n.assert)(h>this.minimumSequenceNumber,1811),(0,n.assert)(h>=(this.sequenceMap.maxKey()?.sequenceNumber??e.minimumPossibleSequenceNumber),2660);const _=E=>({sequenceNumber:E.sequenceNumber,indexInBatch:(E.indexInBatch??0)+1}),S=this.getBatch(h);let p=S.length===0?{sequenceNumber:h}:{sequenceNumber:h,indexInBatch:S.length};if(m===this.localSessionId){for(const E of v)this.fastForwardNextLocalCommit(p),p=_(p);return}const[,w]=this.getClosestTrunkCommit(g),O=(0,r.getOrCreate)(this.peerLocalBranches,m,()=>new s.SharedTreeBranch(w,this.changeFamily,this.mintRevisionTag));if(O.rebaseOnto(this.trunk,w),O.getHead()===this.trunk.getHead()){for(const E of v)this.pushCommitToTrunk(p,{...E,sessionId:m}),p=_(p);O.setHead(this.trunk.getHead())}else{for(const F of v)O.apply((0,i.tagChange)(F.change,F.revision));const E=this.trunk.merge(O);if(E!==void 0)for(const F of E.sourceCommits)this.sequenceMap.set(p,F),this.trunkMetadata.set(F.revision,{sequenceId:p,sessionId:m}),p=_(p)}this.localBranch.rebaseOnto(this.trunk)}findLocalCommit(v){const m=[],h=(0,i.findAncestor)([this.localBranch.getHead(),m],g=>g.revision===v);return(0,n.assert)(h!==void 0,1433),[h,m]}pushCommitToTrunk(v,m){const h=(0,i.mintCommit)(this.trunk.getHead(),m);this.pushGraphCommitToTrunk(v,h,m.sessionId)}pushGraphCommitToTrunk(v,m,h){this.trunk.setHead(m);const g=this.trunk.getHead();this.sequenceMap.set(v,g),this.trunkMetadata.set(g.revision,{sequenceId:v,sessionId:h})}getClosestTrunkCommit(v){const m=typeof v=="number"?{sequenceNumber:v,indexInBatch:Number.POSITIVE_INFINITY}:v,h=this.sequenceMap.getPairOrNextLower(m);return(0,n.assert)(h!==void 0,1862),h}getBatch(v){const m={sequenceNumber:v},h={sequenceNumber:(0,r.brand)(v+1)};return this.sequenceMap.getRange(m,h,!1)}}e.EditManager=f;function b(C,v){const m=[];return(0,n.assert)((0,i.findCommonAncestor)([C,m],v)!==void 0,1395),m}})(QM)),QM}var Vm={},TC={},vG;function k0e(){if(vG)return TC;vG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(TC,"__esModule",{value:!0}),TC.EncodedEditManager=void 0;const e=Nr(),n=Vt(),a=Bt(),t={additionalProperties:!1},i=l=>e.Type.Object({revision:n.RevisionTagSchema,change:l,sessionId:n.SessionIdSchema}),r=l=>e.Type.Composite([i(l)],t),s=(0,a.brandedNumberType)({multipleOf:1}),o=e.Type.Object({sequenceNumber:s,indexInBatch:e.Type.Optional(e.Type.Number({multipleOf:1,minimum:0}))}),u=l=>e.Type.Composite([i(l),o],t),c=l=>e.Type.Object({base:n.RevisionTagSchema,commits:e.Type.Array(r(l))},t),d=l=>e.Type.Object({version:e.Type.Union([e.Type.Literal(1),e.Type.Literal(2),e.Type.Literal(3),e.Type.Literal(4)]),trunk:e.Type.Array(u(l)),branches:e.Type.Array(e.Type.Tuple([n.SessionIdSchema,c(l)]))},t);return TC.EncodedEditManager=d,TC}var SG;function Wae(){if(SG)return Vm;SG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Vm,"__esModule",{value:!0}),Vm.makeEditManagerCodecs=Vm.makeEditManagerCodec=void 0;const e=zn(),n=zn(),a=Bt(),t=k0e();function i(o,u,c,d){const l=r(o,u,c);return(0,n.makeVersionDispatchingCodec)(l,{...c,writeVersion:d})}Vm.makeEditManagerCodec=i;function r(o,u,c){return(0,e.makeCodecFamily)([[1,s(o.resolve(1),u,c,1)],[2,s(o.resolve(2),u,c,2)],[3,s(o.resolve(3),u,c,3)],[4,s(o.resolve(4),u,c,4)]])}Vm.makeEditManagerCodecs=r;function s(o,u,c,d){const l=(0,t.EncodedEditManager)(o.json.encodedSchema??a.JsonCompatibleReadOnlySchema),f=(v,m)=>({...v,revision:u.encode(v.revision,{originatorId:v.sessionId,idCompressor:m.idCompressor,revision:void 0}),change:o.json.encode(v.change,{...m,revision:v.revision})}),b=(v,m)=>{const h=u.decode(v.revision,{originatorId:v.sessionId,idCompressor:m.idCompressor,revision:void 0});return{...v,revision:h,change:o.json.decode(v.change,{...m,revision:h})}};return(0,e.withSchemaValidation)(l,{encode:(v,m)=>({trunk:v.trunk.map(g=>f(g,{originatorId:g.sessionId,idCompressor:m.idCompressor,schema:m.schema,revision:void 0})),branches:Array.from(v.peerLocalBranches.entries(),([g,_])=>[g,{base:u.encode(_.base,{originatorId:g,idCompressor:m.idCompressor,revision:void 0}),commits:_.commits.map(S=>f(S,{originatorId:S.sessionId,idCompressor:m.idCompressor,schema:m.schema,revision:void 0}))}]),version:d}),decode:(v,m)=>({trunk:v.trunk.map(g=>b(g,{originatorId:g.sessionId,idCompressor:m.idCompressor,revision:void 0})),peerLocalBranches:new Map((0,a.mapIterable)(v.branches,([g,_])=>[g,{base:u.decode(_.base,{originatorId:g,idCompressor:m.idCompressor,revision:void 0}),commits:_.commits.map(S=>b(S,{originatorId:S.sessionId,idCompressor:m.idCompressor,revision:void 0}))}]))})},c.jsonValidator)}return Vm}var wC={},CG;function Jae(){if(CG)return wC;CG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(wC,"__esModule",{value:!0}),wC.EditManagerSummarizer=void 0;const e=Ht(),n=Je(),a=Ma(),t="String";class i{constructor(s,o,u,c){this.editManager=s,this.codec=o,this.idCompressor=u,this.schemaAndPolicy=c,this.key="EditManager"}summarize(s){return this.summarizeCore(s.stringify)}summarizeCore(s){const o=this.schemaAndPolicy!==void 0?{schema:this.schemaAndPolicy,idCompressor:this.idCompressor}:{idCompressor:this.idCompressor},u=this.codec.encode(this.editManager.getSummaryData(),o),c=s(u);return(0,a.createSingleBlobSummary)(t,c)}async load(s,o){const u=await s.readBlob(t);(0,n.assert)(this.editManager.isEmpty(),1068);const c=o((0,e.bufferToString)(u,"utf-8")),d=this.codec.decode(c,{idCompressor:this.idCompressor});this.editManager.loadSummaryData(d)}}return wC.EditManagerSummarizer=i,wC}var Hm={},OC={},_G;function x0e(){if(_G)return OC;_G=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(OC,"__esModule",{value:!0}),OC.Message=void 0;const e=Nr(),n=Vt(),a=t=>e.Type.Object({revision:n.RevisionTagSchema,originatorId:n.SessionIdSchema,changeset:t,version:e.Type.Optional(e.Type.Number())});return OC.Message=a,OC}var TG;function q0e(){if(TG)return Hm;TG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Hm,"__esModule",{value:!0}),Hm.makeMessageCodecs=Hm.makeMessageCodec=void 0;const e=Nr(),n=zn(),a=x0e();function t(s,o,u,c){const d=i(s,o,u);return(0,n.makeVersionDispatchingCodec)(d,{...u,writeVersion:c})}Hm.makeMessageCodec=t;function i(s,o,u){const c=r(s.resolve(1).json,o,u,1);return(0,n.makeCodecFamily)([[void 0,c],[1,c],[2,r(s.resolve(2).json,o,u,2)],[3,r(s.resolve(3).json,o,u,3)],[4,r(s.resolve(4).json,o,u,4)]])}Hm.makeMessageCodecs=i;function r(s,o,u,c){return(0,n.withSchemaValidation)((0,a.Message)(s.encodedSchema??e.Type.Any()),{encode:({commit:d,sessionId:l},f)=>({revision:o.encode(d.revision,{originatorId:l,idCompressor:f.idCompressor,revision:void 0}),originatorId:l,changeset:s.encode(d.change,{originatorId:l,schema:f.schema,idCompressor:f.idCompressor,revision:d.revision}),version:c}),decode:(d,l)=>{const{revision:f,originatorId:b,changeset:C}=d,v=o.decode(f,{originatorId:b,revision:void 0,idCompressor:l.idCompressor});return{commit:{revision:v,change:s.decode(C,{originatorId:b,revision:v,idCompressor:l.idCompressor})},sessionId:b}}},u.jsonValidator)}return Hm}var wG;function L0e(){if(wG)return Po;wG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Po&&Po.__runInitializers||function(_,S,p){for(var w=arguments.length>2,O=0;O<S.length;O++)p=w?S[O].call(_,p):S[O].call(_);return w?p:void 0},n=Po&&Po.__esDecorate||function(_,S,p,w,O,E){function F(re){if(re!==void 0&&typeof re!="function")throw new TypeError("Function expected");return re}for(var R=w.kind,M=R==="getter"?"get":R==="setter"?"set":"value",j=!S&&_?w.static?_:_.prototype:null,k=S||(j?Object.getOwnPropertyDescriptor(j,w.name):{}),x,L=!1,V=p.length-1;V>=0;V--){var G={};for(var ee in w)G[ee]=ee==="access"?{}:w[ee];for(var ee in w.access)G.access[ee]=w.access[ee];G.addInitializer=function(re){if(L)throw new TypeError("Cannot add initializers after decoration has completed");E.push(F(re||null))};var se=(0,p[V])(R==="accessor"?{get:k.get,set:k.set}:k[M],G);if(R==="accessor"){if(se===void 0)continue;if(se===null||typeof se!="object")throw new TypeError("Object expected");(x=F(se.get))&&(k.get=x),(x=F(se.set))&&(k.set=x),(x=F(se.init))&&O.unshift(x)}else(x=F(se))&&(R==="field"?O.unshift(x):k[M]=x)}j&&Object.defineProperty(j,w.name,k),L=!0},a=Po&&Po.__setFunctionName||function(_,S,p){return typeof S=="symbol"&&(S=S.description?"[".concat(S.description,"]"):""),Object.defineProperty(_,"name",{configurable:!0,value:p?"".concat(p," ",S):S})};Object.defineProperty(Po,"__esModule",{value:!0}),Po.SharedTreeCore=void 0;const t=Je(),i=bn(),r=Ot(),s=Vt(),o=Bt(),u=A0e(),c=Kae(),d=$ae(),l=Gae(),f=Wae(),b=Jae(),C=q0e(),v="indexes";let m=(()=>{let _=[o.breakingClass],S,p=[],w,O=[],E;return w=class{constructor(F,R,M,j,k,x,L,V,G,ee,se,re,fe,oe,pe=()=>this.getLocalBranch().editor){this.breaker=(e(this,O),F),this.sharedObject=R,this.serializer=M,this.submitLocalMessage=j,this.idCompressor=ee,this.getEditor=pe,this.detachedRevision=l.minimumPossibleSequenceNumber,this.schemaAndPolicy={schema:se,policy:re};const de=(0,r.createChildLogger)({logger:k,namespace:"Rebase"});this.mintRevisionTag=()=>this.idCompressor.generateCompressedId();const ge=ee.localSessionId;this.editManager=new l.EditManager(L,ge,this.mintRevisionTag,de),this.editManager.localBranch.events.on("beforeChange",Ze=>{if(this.detachedRevision===void 0&&this.commitEnricher.processChange(Ze),Ze.type==="append")for(const lt of Ze.newCommits)this.submitCommit(lt,this.schemaAndPolicy,!1)});const Ce=new s.RevisionTagCodec(ee),Fe=(0,f.makeEditManagerCodec)(this.editManager.changeFamily.codecs,Ce,V,G.editManager);this.summarizables=[new b.EditManagerSummarizer(this.editManager,Fe,this.idCompressor,this.schemaAndPolicy),...x],(0,t.assert)(new Set(this.summarizables.map(Ze=>Ze.key)).size===this.summarizables.length,848),this.messageCodec=(0,C.makeMessageCodec)(L.codecs,new s.RevisionTagCodec(ee),V,G.message);const We=oe??new c.NoOpChangeEnricher;this.resubmitMachine=fe??new d.DefaultResubmitMachine(Ze=>L.rebaser.invert(Ze,!0,this.mintRevisionTag()),We),this.commitEnricher=new u.BranchCommitEnricher(L.rebaser,We)}summarizeCore(F,R,M,j){const k=new i.SummaryTreeBuilder,x=new i.SummaryTreeBuilder;for(const L of this.summarizables){const V=M===void 0?void 0:{...M,summaryPath:`${M.summaryPath}/${v}/${L.key}`};x.addWithStats(L.key,L.summarize({stringify:G=>F.stringify(G,this.sharedObject.handle),fullTree:j,telemetryContext:R,incrementalSummaryContext:V}))}return k.addWithStats(v,x.getSummaryTree()),k.getSummaryTree()}async loadCore(F){(0,t.assert)(this.editManager.localBranch.getHead()===this.editManager.getTrunkHead(),2730);const[R,...M]=this.summarizables,j=this.loadSummarizable(R,F),k=M.map(async x=>this.loadSummarizable(x,F));if(this.detachedRevision!==void 0){await j;let x;(0,s.findAncestor)(this.editManager.getTrunkHead(),L=>{const V=this.editManager.getSequenceNumber(L);return V!==void 0&&V<0?(x=V,!0):!1}),this.detachedRevision=x??this.detachedRevision,await Promise.all(k)}else await Promise.all([j,...k])}async loadSummarizable(F,R){return F.load(g(R,v,F.key),M=>this.serializer.parse(M))}submitCommit(F,R,M){(0,t.assert)(this.sharedObject.isAttached()===(this.detachedRevision===void 0),2394);const j=this.detachedRevision===void 0&&!M?this.commitEnricher.enrich(F):F;if(this.detachedRevision!==void 0){const x=(0,o.brand)(this.detachedRevision+1);this.detachedRevision=x,this.editManager.addSequencedChanges([j],this.editManager.localSessionId,x,this.detachedRevision),this.editManager.advanceMinimumSequenceNumber(x,!1);return}const k=this.messageCodec.encode({commit:j,sessionId:this.editManager.localSessionId},{idCompressor:this.idCompressor,schema:R});this.submitLocalMessage(k,{schema:R.schema.clone(),policy:R.policy}),this.resubmitMachine.onCommitSubmitted(j)}processMessagesCore(F){const{envelope:R,local:M,messagesContent:j}=F,k=[];let x;for(const L of j){const{commit:V,sessionId:G}=this.messageCodec.decode(L.contents,{idCompressor:this.idCompressor});k.push(V),x!==void 0&&(0,t.assert)(x===G,2777),x=G}(0,t.assert)(x!==void 0,2778),this.editManager.addSequencedChanges(k,x,(0,o.brand)(R.sequenceNumber),(0,o.brand)(R.referenceSequenceNumber));for(const L of j)this.resubmitMachine.onSequencedCommitApplied(M);this.editManager.advanceMinimumSequenceNumber((0,o.brand)(R.minimumSequenceNumber))}getLocalBranch(){return this.editManager.localBranch}didAttach(){this.detachedRevision=void 0}reSubmitCore(F,R){const{commit:{revision:M}}=this.messageCodec.decode(this.serializer.decode(F),{idCompressor:this.idCompressor});if(this.resubmitMachine.isInResubmitPhase===!1){const k=this.editManager.getLocalCommits(),x=k.findIndex(V=>V.revision===M);(0,t.assert)(x>=0,3035);const L=k.slice(x);this.resubmitMachine.prepareForResubmit(L)}(0,t.assert)(h(R),2398),(0,t.assert)(this.resubmitMachine.isInResubmitPhase!==!1,2436);const j=this.resubmitMachine.peekNextCommit();this.submitCommit(j,R,!0)}rollback(F,R){const{commit:{revision:M}}=this.messageCodec.decode(this.serializer.decode(F),{idCompressor:this.idCompressor}),[j]=this.editManager.findLocalCommit(M),{parent:k}=j;(0,t.assert)(k!==void 0,3036);const[x]=this.editManager.findLocalCommit(k.revision);this.editManager.localBranch.removeAfter(x),this.resubmitMachine.onCommitRollback(j)}applyStashedOp(F){const{commit:{revision:R,change:M}}=this.messageCodec.decode(F,{idCompressor:this.idCompressor});this.editManager.localBranch.apply({change:M,revision:R})}},a(w,"SharedTreeCore"),(()=>{const F=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;E=[o.throwIfBroken],n(w,null,E,{kind:"method",name:"summarizeCore",static:!1,private:!1,access:{has:R=>"summarizeCore"in R,get:R=>R.summarizeCore},metadata:F},null,O),n(null,S={value:w},_,{kind:"class",name:w.name,metadata:F},null,p),w=S.value,F&&Object.defineProperty(w,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:F}),e(w,p)})(),w})();Po.SharedTreeCore=m;function h(_){const S=_;return S.schema!==void 0&&S.policy!==void 0}function g(_,...S){const p=`${S.join("/")}/`;return{async readBlob(w){return _.readBlob(`${p}${w}`)},async contains(w){return _.contains(`${p}${w}`)},async list(w){return _.list(`${p}${w}`)},getSnapshotTree(){const w=_.getSnapshotTree?.();if(w===void 0)return;let O=w;for(const E of S){const F=O.trees[E];(0,t.assert)(F!==void 0,3104),O=F}return O}}}return Po}var OG;function Qae(){return OG||(OG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.minimumPossibleSequenceNumber=e.EditManager=e.EditManagerSummarizer=e.makeEditManagerCodec=e.NoOpChangeEnricher=e.DefaultResubmitMachine=e.SharedTreeCore=e.SquashingTransactionStack=e.TransactionStack=e.TransactionResult=e.SharedTreeBranch=e.onForkTransitive=void 0;var n=Hae();Object.defineProperty(e,"onForkTransitive",{enumerable:!0,get:function(){return n.onForkTransitive}}),Object.defineProperty(e,"SharedTreeBranch",{enumerable:!0,get:function(){return n.SharedTreeBranch}});var a=M0e();Object.defineProperty(e,"TransactionResult",{enumerable:!0,get:function(){return a.TransactionResult}}),Object.defineProperty(e,"TransactionStack",{enumerable:!0,get:function(){return a.TransactionStack}}),Object.defineProperty(e,"SquashingTransactionStack",{enumerable:!0,get:function(){return a.SquashingTransactionStack}});var t=L0e();Object.defineProperty(e,"SharedTreeCore",{enumerable:!0,get:function(){return t.SharedTreeCore}});var i=$ae();Object.defineProperty(e,"DefaultResubmitMachine",{enumerable:!0,get:function(){return i.DefaultResubmitMachine}});var r=Kae();Object.defineProperty(e,"NoOpChangeEnricher",{enumerable:!0,get:function(){return r.NoOpChangeEnricher}});var s=Wae();Object.defineProperty(e,"makeEditManagerCodec",{enumerable:!0,get:function(){return s.makeEditManagerCodec}});var o=Jae();Object.defineProperty(e,"EditManagerSummarizer",{enumerable:!0,get:function(){return o.EditManagerSummarizer}});var u=Gae();Object.defineProperty(e,"EditManager",{enumerable:!0,get:function(){return u.EditManager}}),Object.defineProperty(e,"minimumPossibleSequenceNumber",{enumerable:!0,get:function(){return u.minimumPossibleSequenceNumber}})})(JM)),JM}var XM={},ZM={},Km={},Qi={},PG;function ZE(){if(PG)return Qi;PG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e,n;Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.unsupportedUsageError=Qi.createField=Qi.UnhydratedSequenceField=Qi.UnhydratedOptionalField=Qi.UnhydratedFlexTreeField=Qi.UnhydratedContext=Qi.UnhydratedFlexTreeNode=void 0;const a=Ht(),t=Je(),i=Ot(),r=Vt(),s=An(),o=Bt();class u{isHydrated(){return!1}get storedSchema(){return this.context.schema.nodeSchema.get(this.data.type)??(0,t.fail)(2886)}get events(){return this._events}get context(){return this.simpleContext.flexContext}constructor(g,_,S){this.data=g,this.fieldsAll=_,this.simpleContext=S,this.location=d,this[e]=s.FlexTreeEntityKind.Node,this._events=(0,a.createEmitter)(),this.fields={get:p=>this.tryGetField(p),[Symbol.iterator]:()=>(0,o.filterIterable)(this.fieldsAll,([,p])=>p.length>0)};for(const[p,w]of this.fieldsAll)w.parent=this}[(e=s.flexTreeMarker,Symbol.iterator)](){return(0,o.mapIterable)(this.fields,([,g])=>g)[Symbol.iterator]()}get allFieldsLazy(){return this.fieldsAll}get type(){return this.data.type}getOrCreateField(g){return(0,o.getOrCreate)(this.fieldsAll,g,()=>{const _=this.storedSchema.getFieldSchema(g).kind,S=v(this.context,_,g,[]);return S.parent=this,S})}adoptBy(g,_){if(g!==void 0){if((0,t.assert)(_!==void 0,2568),this.location!==d)throw new i.UsageError("A node may not be in more than one place in the tree");let S=g.parent;for(;S!==void 0;){if(S===this)throw new i.UsageError("A node may not be inserted into a location that is under itself");const p=S.parentField.parent.parent;(0,t.assert)(p===void 0||p instanceof u,2935),S=p}this.location={parent:g,index:_}}else(0,t.assert)(this.location!==d,2569),this.location=d}get parentField(){return this.location}borrowCursor(){return(0,s.cursorForMapTreeNode)(this)}tryGetField(g){const _=this.fieldsAll.get(g);if(_!==void 0&&_.length>0)return _}getBoxed(g){const _=(0,o.brand)(g);return this.getOrCreateField(_)}keys(){return Array.from(this.fields,([g])=>g)[Symbol.iterator]()}get value(){return this.data.value}emitChangedEvent(g){this._events.emit("childrenChangedAfterBatch",{changedFields:new Set([g])})}}Qi.UnhydratedFlexTreeNode=u;class c{constructor(g,_){this.schemaPolicy=g,this.schema=_}isDisposed(){return!1}isHydrated(){return!1}}Qi.UnhydratedContext=c;const d={parent:{key:r.dummyRoot,parent:void 0,schema:(0,o.brand)(s.FieldKinds.optional.identifier)},index:0};class l{constructor(g,_,S,p){if(this.context=g,this.schema=_,this.key=S,this.lazyChildren=p,this[n]=s.FlexTreeEntityKind.Field,this.parent=void 0,Array.isArray(p))for(const[w,O]of p.entries())O.adoptBy(this,w)}borrowCursor(){return(0,s.cursorForMapTreeField)(this.children)}getPendingDefault(){return Array.isArray(this.lazyChildren)?void 0:this.lazyChildren}fillPendingDefaults(g){const _=this.getPendingDefault();if(_){const S=_(g);this.lazyChildren=S}}get pendingDefault(){return this.getPendingDefault()!==void 0}get children(){const g=this.getPendingDefault();if(g){const _=g("UseGlobalContext");this.lazyChildren=_}return this.lazyChildren}get length(){return this.children.length}is(g){return this.schema===g.identifier}boxedAt(g){const _=(0,s.indexForAt)(g,this.length);return _===void 0?void 0:this.children[_]}[(n=s.flexTreeMarker,Symbol.iterator)](){return this.children[Symbol.iterator]()}edit(g){for(const _ of this.children)_.adoptBy(void 0);this.lazyChildren=g(this.children)??this.children;for(const[_,S]of this.children.entries())S.adoptBy(this,_);this.parent?.emitChangedEvent(this.key)}getFieldPath(){throw m("Editing an array")}unboxed(g){const _=this.children[g]??(0,t.oob)(),S=_.value;return S!==void 0?S:_}}Qi.UnhydratedFlexTreeField=l;class f extends l{constructor(){super(...arguments),this.editor={set:g=>{g!==void 0&&(0,t.assert)(g instanceof u,2999),this.edit(_=>{g!==void 0?_[0]=g:_.length=0})}}}get content(){if(this.children[0]!==void 0)return this.unboxed(0)}}Qi.UnhydratedOptionalField=f;class b extends f{get content(){return(0,t.assert)(super.content!==void 0,2647),super.content}}class C extends l{constructor(){super(...arguments),this.editor={insert:(g,_)=>{for(const p of _)(0,t.assert)(p!==void 0,2570),(0,t.assert)(p instanceof u,3e3);const S=_;this.edit(p=>{if(_.length<1e3)p.splice(g,0,...S);else return p.slice(0,g).concat(S,p.slice(g))})},remove:(g,_)=>{for(let p=g;p<g+_;p++){const w=this.children[p];(0,t.assert)(w!==void 0,2571)}let S;return this.edit(p=>{S=p.splice(g,_)}),S??(0,t.fail)(2890)}}}at(g){const _=(0,s.indexForAt)(g,this.length);if(_!==void 0)return this.unboxed(_)}map(g){return Array.from(this,g)}}Qi.UnhydratedSequenceField=C;function v(...h){switch(h[1]){case s.FieldKinds.required.identifier:case s.FieldKinds.identifier.identifier:return new b(...h);case s.FieldKinds.optional.identifier:return new f(...h);case s.FieldKinds.sequence.identifier:return new C(...h);case s.FieldKinds.forbidden.identifier:return new l(...h);default:return(0,t.fail)(2973)}}Qi.createField=v;function m(h){return new i.UsageError(`${h??"Operation"} is not supported for content that has not yet been inserted into the tree`)}return Qi.unsupportedUsageError=m,Qi}var EG;function eI(){return EG||(EG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=Km&&Km.__classPrivateFieldGet||function(M,j,k,x){if(k==="a"&&!x)throw new TypeError("Private accessor was defined without a getter");if(typeof j=="function"?M!==j||!x:!j.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return k==="m"?x:k==="a"?x.call(M):x?x.value:j.get(M)},a=Km&&Km.__classPrivateFieldSet||function(M,j,k,x,L){if(x==="m")throw new TypeError("Private method is not writable");if(x==="a"&&!L)throw new TypeError("Private accessor was defined without a setter");if(typeof j=="function"?M!==j||!L:!j.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return x==="a"?L.call(M,k):L?L.value=k:j.set(M,k),k},t,i;Object.defineProperty(e,"__esModule",{value:!0}),e.SimpleContextSlot=e.createTreeNodeFromInner=e.treeNodeFromAnchor=e.getOrCreateInnerNode=e.getSimpleContextFromInnerNode=e.getSimpleNodeSchemaFromInnerNode=e.tryDisposeTreeNode=e.simpleTreeNodeSlot=e.splitInnerNodeType=e.TreeNodeKernel=e.tryGetTreeNodeSchema=e.isTreeNode=e.getKernel=void 0;const r=Ht(),s=Je(),o=Ot(),u=Vt(),c=An(),d=An(),l=ZE(),f=new WeakMap;function b(M){const j=f.get(M);return(0,s.assert)(j!==void 0,2481),j}e.getKernel=b;function C(M){return f.has(M)}e.isTreeNode=C;function v(M){return f.get(M)?.schema}e.tryGetTreeNodeSchema=v;function m(M){return M.anchorNode!==void 0}class h{constructor(j,k,x,L){this.node=j,this.schema=k,this.initialContext=L,this.disposed=!1,this.generationNumber=0,t.set(this,void 0),i.set(this,new s.Lazy(r.createEmitter)),_(x),(0,s.assert)(!f.has(j),2586),f.set(j,this),x instanceof l.UnhydratedFlexTreeNode?((0,s.debugAssert)(()=>x.treeNode===void 0),x.treeNode=j,a(this,t,{innerNode:x,off:x.events.on("childrenChangedAfterBatch",({changedFields:V})=>{n(this,i,"f").value.emit("childrenChangedAfterBatch",{changedFields:V});let G=x;for(;G!==void 0;){const ee=G.treeNode;if(ee!==void 0){const re=b(ee);n(re,i,"f").value.emit("subtreeChangedAfterBatch")}const se=G.parentField.parent.parent;(0,s.assert)(se===void 0||se instanceof l.UnhydratedFlexTreeNode,2934),G=se}})},"f")):(a(this,t,this.createHydratedState(x.anchorNode),"f"),n(this,t,"f").innerNode=x)}get context(){return m(n(this,t,"f"))?n(this,t,"f")?.anchorNode.anchorSet.slots.get(e.SimpleContextSlot)??(0,s.fail)(2880):this.initialContext}hydrate(j,k){(0,s.assert)(!this.disposed,2602),(0,s.assert)(!m(n(this,t,"f")),2603);const x=j.track(k),L=j.locate(x)??(0,s.fail)(2882);if(a(this,t,this.createHydratedState(L),"f"),n(this,t,"f").offAnchorNode.add(()=>j.forget(x)),n(this,i,"f").evaluated){const V=n(this,i,"f").value;for(const G of g)V.hasListeners(G)&&n(this,t,"f").offAnchorNode.add(L.events.on(G,ee=>V.emit(G,ee)))}}createHydratedState(j){return(0,s.assert)(!j.slots.has(e.simpleTreeNodeSlot),2037),j.slots.set(e.simpleTreeNodeSlot,this.node),{anchorNode:j,offAnchorNode:new Set([j.events.on("afterDestroy",()=>this.dispose()),j.events.on("childrenChanging",()=>{this.generationNumber+=1})])}}getStatus(){if(this.disposed)return d.TreeStatus.Deleted;if(!m(n(this,t,"f")))return d.TreeStatus.New;const j=n(this,t,"f").anchorNode.slots.get(d.flexTreeSlot);return j!==void 0&&((0,s.assert)(j instanceof d.LazyEntity,2484),j.isFreed())?d.TreeStatus.Deleted:(0,d.treeStatusFromAnchorCache)(n(this,t,"f").anchorNode)}get events(){return m(n(this,t,"f"))?n(this,t,"f").anchorNode.events:n(this,i,"f").value}dispose(){if((0,s.debugAssert)(()=>!this.disposed||"Cannot dispose a disposed node"),this.disposed=!0,m(n(this,t,"f")))for(const j of n(this,t,"f").offAnchorNode)j()}isHydrated(){return m(n(this,t,"f"))}get anchorNode(){return m(n(this,t,"f"))?n(this,t,"f").anchorNode:void 0}getOrCreateInnerNode(){if(!m(n(this,t,"f")))return(0,s.debugAssert)(()=>n(this,t,"f").innerNode?.context.isDisposed()===!1||"Unhydrated node should never be disposed"),n(this,t,"f").innerNode;if(this.disposed)throw new o.UsageError("Cannot access a deleted node.");if(n(this,t,"f").innerNode===void 0){const j=n(this,t,"f").anchorNode,k=j.slots.get(d.flexTreeSlot);if(k!==void 0)n(this,t,"f").innerNode=k;else{const x=j.anchorSet.slots.get(d.ContextSlot)??(0,s.fail)(2881),L=x.checkout.forest.allocateCursor("getFlexNode");x.checkout.forest.moveCursorToPath(j,L),n(this,t,"f").innerNode=(0,c.getOrCreateHydratedFlexTreeNode)(x,L),L.free(),(0,d.assertFlexTreeEntityNotFreed)(n(this,t,"f").innerNode)}}return n(this,t,"f").innerNode}getInnerNodeIfUnhydrated(){if(!m(n(this,t,"f")))return n(this,t,"f").innerNode}}e.TreeNodeKernel=h,t=new WeakMap,i=new WeakMap;const g=["childrenChangedAfterBatch","subtreeChangedAfterBatch"];function _(M){(0,s.assert)(M instanceof l.UnhydratedFlexTreeNode||M.isHydrated(),3016)}e.splitInnerNodeType=_,e.simpleTreeNodeSlot=(0,u.anchorSlot)();function S(M){const j=M.slots.get(e.simpleTreeNodeSlot);j!==void 0&&(b(j).dispose(),M.slots.delete(e.simpleTreeNodeSlot))}e.tryDisposeTreeNode=S;function p(M){return w(M).schema.get(M.type)??(0,s.fail)(2879)}e.getSimpleNodeSchemaFromInnerNode=p;function w(M){if(_(M),M instanceof l.UnhydratedFlexTreeNode)return M.simpleContext;const j=M.anchorNode.anchorSet.slots.get(e.SimpleContextSlot);return(0,s.assert)(j!==void 0,2645),j}e.getSimpleContextFromInnerNode=w;function O(M){return b(M).getOrCreateInnerNode()}e.getOrCreateInnerNode=O;function E(M){const j=M.slots.get(d.flexTreeSlot);if(j!==void 0)return j;const k=M.anchorSet.slots.get(d.ContextSlot)??(0,s.fail)(2885),x=k.checkout.forest.allocateCursor("getFlexNode");k.checkout.forest.moveCursorToPath(M,x);const L=(0,c.getOrCreateHydratedFlexTreeNode)(k,x);return x.free(),L}function F(M){const j=M.slots.get(e.simpleTreeNodeSlot);if(j!==void 0)return j;const k=E(M);return R(k)}e.treeNodeFromAnchor=F;function R(M){const j=p(M),k=M;return typeof j=="function"?new j(k):j.create(k)}e.createTreeNodeFromInner=R,e.SimpleContextSlot=(0,u.anchorSlot)()})(Km)),Km}var $m={},IG;function Yae(){if(IG)return $m;IG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty($m,"__esModule",{value:!0}),$m.typeSchemaSymbol=$m.typeNameSymbol=void 0,$m.typeNameSymbol=Symbol("TreeNode Type"),$m.typeSchemaSymbol=Symbol("TreeNode Schema"),$m}var eN={},tN={},RG;function _T(){return RG||(RG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isTreeNodeSchemaClass=e.NodeKind=e.getTreeNodeSchemaPrivateData=e.CompatibilityLevel=e.privateDataSymbol=void 0;const n=Je();e.privateDataSymbol=Symbol("PrivateData");var a;(function(s){s[s.None=0]="None",s[s.Low=1]="Low",s[s.Normal=2]="Normal"})(a||(e.CompatibilityLevel=a={}));function t(s){return(0,n.assert)(e.privateDataSymbol in s,3017),s[e.privateDataSymbol]}e.getTreeNodeSchemaPrivateData=t;var i;(function(s){s[s.Map=0]="Map",s[s.Array=1]="Array",s[s.Object=2]="Object",s[s.Leaf=3]="Leaf",s[s.Record=4]="Record"})(i||(e.NodeKind=i={}));function r(s){return s.constructor!==void 0}e.isTreeNodeSchemaClass=r})(tN)),tN}var Gm={},FG;function _q(){if(FG)return Gm;FG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Gm,"__esModule",{value:!0}),Gm.markEager=Gm.isLazy=void 0;const e=Symbol("FlexList Eager");function n(t){return typeof t=="function"&&t[e]!==!0}Gm.isLazy=n;function a(t){return n(t)?Object.defineProperty(t,e,{value:!0,configurable:!0,enumerable:!1,writable:!1}):t}return Gm.markEager=a,Gm}var jG;function Xae(){return jG||(jG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n;Object.defineProperty(e,"__esModule",{value:!0}),e.inPrototypeChain=e.privateToken=e.TreeNode=void 0;const a=Je(),t=Ot(),i=eI(),r=_T(),s=_q();class o{static[(n=new WeakMap,Symbol.hasInstance)](d){const l=(0,i.tryGetTreeNodeSchema)(d);return l===void 0||l.kind===r.NodeKind.Leaf?!1:((0,a.assert)("prototype"in l,2442),u(l.prototype,this.prototype))}constructor(d){if(n.set(this,void 0),d!==e.privateToken)throw new t.UsageError("TreeNodes must extend schema classes created by SchemaFactory")}}e.TreeNode=o,(0,s.markEager)(o),e.privateToken={};function u(c,d){let l=c;for(;l!==null;){if(d===l)return!0;l=Reflect.getPrototypeOf(l)}return!1}e.inPrototypeChain=u})(eN)),eN}var _r={},Eo={},MG;function Zae(){if(MG)return Eo;MG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Eo,"__esModule",{value:!0}),Eo.createTreeNodeSchemaPrivateData=Eo.isClassBasedSchema=Eo.schemaAsTreeNodeValid=Eo.TreeNodeValid=void 0;const e=Je(),n=Ot(),a=An(),t=Xae(),i=ZE(),r=_T(),s=eI(),o=Yae();class u extends t.TreeNode{static prepareInstance(S,p){return S}static buildRawNode(S,p){return(0,e.fail)(2788)}static oneTimeSetup(){(0,e.fail)(2789)}static markMostDerived(){if((0,e.assert)(this.constructorCached!=="default",2399),this.constructorCached===void 0){let S=this;for(;!Object.prototype.hasOwnProperty.call(S,"constructorCached");)S=Reflect.getPrototypeOf(S);return(0,e.assert)(S.constructorCached===void 0,2402),S.constructorCached={constructor:this,oneTimeInitialized:void 0},(0,e.assert)(this.constructorCached===S.constructorCached,2485),this.constructorCached}else if(this.constructorCached.constructor===this)return this.constructorCached;throw new n.UsageError(`Two schema classes were used (${this.name} and ${this.constructorCached.constructor.name}) which derived from the same SchemaFactory generated class (${JSON.stringify(this.identifier)}). This is invalid.`)}static create(S){return new this(S)}static createFromInsertable(S){return new this(S)}static oneTimeInitialize(){const S=this.markMostDerived();return S.oneTimeInitialized??=this.oneTimeSetup(),S}constructor(S){super(t.privateToken);const p=this.constructor,w=p.oneTimeInitialize();if((0,s.isTreeNode)(S))throw new n.UsageError("Existing nodes may not be used as the constructor parameter for a new node. The existing node may be used directly instead of creating a new one, used as a child of the new node (if it has not yet been inserted into the tree). If the desired result is copying the provided node, it must be deep copied (since any child node would be parented under both the new and old nodes). `TreeBeta.clone` can be used to do this.");const O=(0,a.isFlexTreeNode)(S)?S:p.buildRawNode(this,S);(0,e.assert)((0,s.getSimpleNodeSchemaFromInnerNode)(O)===p,2107);const E=p.prepareInstance(this,O),F=O instanceof i.UnhydratedFlexTreeNode?O.simpleContext:w.oneTimeInitialized.context;return new s.TreeNodeKernel(E,p,O,F),E}}Eo.TreeNodeValid=u,u.constructorCached="default";function c(_){if(!d(_))throw new n.UsageError(`Schema for ${JSON.stringify(_.identifier)} does not extend a SchemaFactory generated class. This is invalid.`);return _}Eo.schemaAsTreeNodeValid=c;function d(_){return(0,t.inPrototypeChain)(_,u)}Eo.isClassBasedSchema=d;function l(_,S,p){const w=c(_);return w.markMostDerived(),{idempotentInitialize:()=>w.oneTimeInitialize().oneTimeInitialized,childAnnotatedAllowedTypes:S,toStored:p}}Eo.createTreeNodeSchemaPrivateData=l;const f=Symbol.for("nodejs.util.inspect.custom");function b(_,S,p){const w=this[o.typeSchemaSymbol],O=`${w.name}: ${r.NodeKind[w.kind]} Node (${w.identifier})`;if(_<2){const F=C(this);return F!==void 0?`${O} ${F}`:O}return`${O} ${JSON.stringify(this)}`}function C(_){if(Object.values(_).length===0)return JSON.stringify(_)}Object.defineProperty(u.prototype,f,{value:b,enumerable:!1});const v=typeof window>"u"?globalThis:window,m=v.devtoolsFormatters??=[],h={header(_,S){return(0,s.isTreeNode)(_)?["span",`${b.call(_,1)}`]:null},body(_,S){const p=[];for(const[w,O]of Object.entries(_))p.push(["li",["span",`${w}: `],g(O)]);return["ol",...p]},hasBody(_,S){return C(_)===void 0}};function g(_,S){return _===void 0?["span","undefined"]:_==="null"?["span","null"]:["object",{object:_,config:S}]}return m.push(h),Eo}var NG;function Tq(){if(NG)return _r;NG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_r,"__esModule",{value:!0}),_r.markSchemaMostDerived=_r.checkForUninitializedSchema=_r.evaluateLazySchema=_r.unannotateAllowedType=_r.unannotateImplicitAllowedTypes=_r.normalizeAnnotatedAllowedTypes=_r.normalizeToAnnotatedAllowedType=_r.normalizeAllowedTypes=_r.SchemaUpgrade=_r.createSchemaUpgrade=_r.isAnnotatedAllowedType=_r.isAnnotatedAllowedTypes=void 0;const e=Ot(),n=Bt(),a=_q(),t=_T(),i=Zae();function r(h){return v(h),typeof h=="object"&&"metadata"in h&&"types"in h}_r.isAnnotatedAllowedTypes=r;function s(h){return v(h),typeof h=="object"&&"metadata"in h&&"type"in h}_r.isAnnotatedAllowedType=s;class o{constructor(){}}_r.SchemaUpgrade=o,_r.createSchemaUpgrade=()=>new o;function u(h){const g=l(h),_=new Set;if((0,n.isReadonlyArray)(g)){Object.freeze(g);for(const S of g)_.add(C(S))}else _.add(C(g));return _}_r.normalizeAllowedTypes=u;function c(h){return s(h)?h:{metadata:{},type:h}}_r.normalizeToAnnotatedAllowedType=c;function d(h){const g=r(h)?h.types:h,_=[];if((0,n.isReadonlyArray)(g))for(const S of g)s(S)?_.push({type:C(S.type),metadata:S.metadata}):_.push({type:C(S),metadata:{}});else s(g)?_.push({type:C(g.type),metadata:g.metadata}):_.push({type:C(g),metadata:{}});return{metadata:r(h)?h.metadata:{},types:_}}_r.normalizeAnnotatedAllowedTypes=d;function l(h){return r(h)?h.types.map(f):(0,n.isReadonlyArray)(h)?h.map(f):s(h)?h.type:h}_r.unannotateImplicitAllowedTypes=l;function f(h){return s(h)?h.type:h}_r.unannotateAllowedType=f;const b=new WeakMap;function C(h){const g=(0,a.isLazy)(h)?(0,n.getOrCreate)(b,h,h):h;return v(g),m(g),g}_r.evaluateLazySchema=C;function v(h){if(h===void 0)throw new e.UsageError('Encountered an undefined schema. This could indicate that some referenced schema has not yet been instantiated. Consider using a lazy schema reference (like "() => schema") or delaying the evaluation of the lazy reference if one is already being used.')}_r.checkForUninitializedSchema=v;function m(h,g=!1){if(h.kind===t.NodeKind.Leaf)return;const _=(0,i.schemaAsTreeNodeValid)(h);g?_.oneTimeInitialize():_.markMostDerived()}return _r.markSchemaMostDerived=m,_r}var Wm={},AG;function eoe(){if(AG)return Wm;AG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Wm,"__esModule",{value:!0}),Wm.walkAllowedTypes=Wm.walkNodeSchema=void 0;const e=Tq(),n=_T();function a(i,r,s){if(s.has(i))return;s.add(i);const o=(0,n.getTreeNodeSchemaPrivateData)(i).childAnnotatedAllowedTypes;for(const u of o)t((0,e.normalizeAnnotatedAllowedTypes)(u),r,s);r.node?.(i)}Wm.walkNodeSchema=a;function t(i,r,s=new Set){for(const o of i.types)(r.allowedTypeFilter??(()=>!0))(o)&&a(o.type,r,s);r.allowedTypes?.(i)}return Wm.walkAllowedTypes=t,Wm}var Jm={},DG;function B0e(){if(DG)return Jm;DG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.HydratedContext=Jm.Context=void 0;const e=Bt(),n=eoe();class a{static schemaMapFromRootSchema(r){const s=new Map;return(0,n.walkAllowedTypes)(r,{node(o){s.set((0,e.brand)(o.identifier),o)}}),s}constructor(r,s){this.flexContext=r,this.schema=s}}Jm.Context=a;class t extends a{constructor(r,s){super(r,s),this.flexContext=r}}return Jm.HydratedContext=t,Jm}var Qm={},kG;function U0e(){if(kG)return Qm;kG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Qm,"__esModule",{value:!0}),Qm.getOrCreateNodeFromInnerUnboxedNode=Qm.getOrCreateNodeFromInnerNode=void 0;const e=An(),n=eI(),a=ZE();function t(r){(0,n.splitInnerNodeType)(r);const s=r instanceof a.UnhydratedFlexTreeNode?r.treeNode:r.anchorNode.slots.get(n.simpleTreeNodeSlot);return s!==void 0?s:(0,n.createTreeNodeFromInner)(r)}Qm.getOrCreateNodeFromInnerNode=t;function i(r){return(0,e.isFlexTreeNode)(r)?t(r):r}return Qm.getOrCreateNodeFromInnerUnboxedNode=i,Qm}var Ym={},xG;function z0e(){if(xG)return Ym;xG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ym,"__esModule",{value:!0}),Ym.convertAllowedTypes=Ym.allowedTypeFilter=void 0;const e=Bt(),n=Tq();function a(i,r){return i.metadata.stagedSchemaUpgrade!==void 0?r.includeStaged(i.metadata.stagedSchemaUpgrade):!0}Ym.allowedTypeFilter=a;function t(i,r){const s=(0,n.normalizeAnnotatedAllowedTypes)(i).types.filter(o=>a(o,r)).map(o=>(0,e.brand)(o.type.identifier));return new Set(s)}return Ym.convertAllowedTypes=t,Ym}var qG;function dr(){return qG||(qG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.allowedTypeFilter=e.convertAllowedTypes=e.isClassBasedSchema=e.createTreeNodeSchemaPrivateData=e.TreeNodeValid=e.isLazy=e.createField=e.UnhydratedContext=e.UnhydratedSequenceField=e.UnhydratedFlexTreeNode=e.UnhydratedFlexTreeField=e.getOrCreateNodeFromInnerUnboxedNode=e.getOrCreateNodeFromInnerNode=e.HydratedContext=e.Context=e.walkNodeSchema=e.walkAllowedTypes=e.createSchemaUpgrade=e.evaluateLazySchema=e.markSchemaMostDerived=e.unannotateImplicitAllowedTypes=e.normalizeToAnnotatedAllowedType=e.normalizeAnnotatedAllowedTypes=e.normalizeAllowedTypes=e.isAnnotatedAllowedType=e.isAnnotatedAllowedTypes=e.CompatibilityLevel=e.getTreeNodeSchemaPrivateData=e.privateDataSymbol=e.isTreeNodeSchemaClass=e.NodeKind=e.inPrototypeChain=e.privateToken=e.TreeNode=e.typeSchemaSymbol=e.typeNameSymbol=e.SimpleContextSlot=e.getSimpleNodeSchemaFromInnerNode=e.treeNodeFromAnchor=e.getOrCreateInnerNode=e.tryDisposeTreeNode=e.tryGetTreeNodeSchema=e.getKernel=e.TreeNodeKernel=e.isTreeNode=void 0;var n=eI();Object.defineProperty(e,"isTreeNode",{enumerable:!0,get:function(){return n.isTreeNode}}),Object.defineProperty(e,"TreeNodeKernel",{enumerable:!0,get:function(){return n.TreeNodeKernel}}),Object.defineProperty(e,"getKernel",{enumerable:!0,get:function(){return n.getKernel}}),Object.defineProperty(e,"tryGetTreeNodeSchema",{enumerable:!0,get:function(){return n.tryGetTreeNodeSchema}}),Object.defineProperty(e,"tryDisposeTreeNode",{enumerable:!0,get:function(){return n.tryDisposeTreeNode}}),Object.defineProperty(e,"getOrCreateInnerNode",{enumerable:!0,get:function(){return n.getOrCreateInnerNode}}),Object.defineProperty(e,"treeNodeFromAnchor",{enumerable:!0,get:function(){return n.treeNodeFromAnchor}}),Object.defineProperty(e,"getSimpleNodeSchemaFromInnerNode",{enumerable:!0,get:function(){return n.getSimpleNodeSchemaFromInnerNode}}),Object.defineProperty(e,"SimpleContextSlot",{enumerable:!0,get:function(){return n.SimpleContextSlot}});var a=Yae();Object.defineProperty(e,"typeNameSymbol",{enumerable:!0,get:function(){return a.typeNameSymbol}}),Object.defineProperty(e,"typeSchemaSymbol",{enumerable:!0,get:function(){return a.typeSchemaSymbol}});var t=Xae();Object.defineProperty(e,"TreeNode",{enumerable:!0,get:function(){return t.TreeNode}}),Object.defineProperty(e,"privateToken",{enumerable:!0,get:function(){return t.privateToken}}),Object.defineProperty(e,"inPrototypeChain",{enumerable:!0,get:function(){return t.inPrototypeChain}});var i=_T();Object.defineProperty(e,"NodeKind",{enumerable:!0,get:function(){return i.NodeKind}}),Object.defineProperty(e,"isTreeNodeSchemaClass",{enumerable:!0,get:function(){return i.isTreeNodeSchemaClass}}),Object.defineProperty(e,"privateDataSymbol",{enumerable:!0,get:function(){return i.privateDataSymbol}}),Object.defineProperty(e,"getTreeNodeSchemaPrivateData",{enumerable:!0,get:function(){return i.getTreeNodeSchemaPrivateData}}),Object.defineProperty(e,"CompatibilityLevel",{enumerable:!0,get:function(){return i.CompatibilityLevel}});var r=Tq();Object.defineProperty(e,"isAnnotatedAllowedTypes",{enumerable:!0,get:function(){return r.isAnnotatedAllowedTypes}}),Object.defineProperty(e,"isAnnotatedAllowedType",{enumerable:!0,get:function(){return r.isAnnotatedAllowedType}}),Object.defineProperty(e,"normalizeAllowedTypes",{enumerable:!0,get:function(){return r.normalizeAllowedTypes}}),Object.defineProperty(e,"normalizeAnnotatedAllowedTypes",{enumerable:!0,get:function(){return r.normalizeAnnotatedAllowedTypes}}),Object.defineProperty(e,"normalizeToAnnotatedAllowedType",{enumerable:!0,get:function(){return r.normalizeToAnnotatedAllowedType}}),Object.defineProperty(e,"unannotateImplicitAllowedTypes",{enumerable:!0,get:function(){return r.unannotateImplicitAllowedTypes}}),Object.defineProperty(e,"markSchemaMostDerived",{enumerable:!0,get:function(){return r.markSchemaMostDerived}}),Object.defineProperty(e,"evaluateLazySchema",{enumerable:!0,get:function(){return r.evaluateLazySchema}}),Object.defineProperty(e,"createSchemaUpgrade",{enumerable:!0,get:function(){return r.createSchemaUpgrade}});var s=eoe();Object.defineProperty(e,"walkAllowedTypes",{enumerable:!0,get:function(){return s.walkAllowedTypes}}),Object.defineProperty(e,"walkNodeSchema",{enumerable:!0,get:function(){return s.walkNodeSchema}});var o=B0e();Object.defineProperty(e,"Context",{enumerable:!0,get:function(){return o.Context}}),Object.defineProperty(e,"HydratedContext",{enumerable:!0,get:function(){return o.HydratedContext}});var u=U0e();Object.defineProperty(e,"getOrCreateNodeFromInnerNode",{enumerable:!0,get:function(){return u.getOrCreateNodeFromInnerNode}}),Object.defineProperty(e,"getOrCreateNodeFromInnerUnboxedNode",{enumerable:!0,get:function(){return u.getOrCreateNodeFromInnerUnboxedNode}});var c=ZE();Object.defineProperty(e,"UnhydratedFlexTreeField",{enumerable:!0,get:function(){return c.UnhydratedFlexTreeField}}),Object.defineProperty(e,"UnhydratedFlexTreeNode",{enumerable:!0,get:function(){return c.UnhydratedFlexTreeNode}}),Object.defineProperty(e,"UnhydratedSequenceField",{enumerable:!0,get:function(){return c.UnhydratedSequenceField}}),Object.defineProperty(e,"UnhydratedContext",{enumerable:!0,get:function(){return c.UnhydratedContext}}),Object.defineProperty(e,"createField",{enumerable:!0,get:function(){return c.createField}});var d=_q();Object.defineProperty(e,"isLazy",{enumerable:!0,get:function(){return d.isLazy}});var l=Zae();Object.defineProperty(e,"TreeNodeValid",{enumerable:!0,get:function(){return l.TreeNodeValid}}),Object.defineProperty(e,"createTreeNodeSchemaPrivateData",{enumerable:!0,get:function(){return l.createTreeNodeSchemaPrivateData}}),Object.defineProperty(e,"isClassBasedSchema",{enumerable:!0,get:function(){return l.isClassBasedSchema}});var f=z0e();Object.defineProperty(e,"convertAllowedTypes",{enumerable:!0,get:function(){return f.convertAllowedTypes}}),Object.defineProperty(e,"allowedTypeFilter",{enumerable:!0,get:function(){return f.allowedTypeFilter}})})(ZM)),ZM}var PC={},Tr={},LG;function xi(){if(LG)return Tr;LG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.areFieldSchemaEqual=Tr.areImplicitFieldSchemaEqual=Tr.normalizeFieldSchema=Tr.FieldSchemaAlpha=Tr.FieldSchema=Tr.createFieldSchema=Tr.getDefaultProvider=Tr.extractFieldProvider=Tr.isConstant=Tr.getExplicitStoredKey=Tr.getStoredKey=Tr.FieldKind=void 0;const e=Je(),n=Ot(),a=Bt(),t=dr();var i;(function(S){S[S.Optional=0]="Optional",S[S.Required=1]="Required",S[S.Identifier=2]="Identifier"})(i||(Tr.FieldKind=i={}));function r(S,p){return(0,a.brand)(s(p)??S)}Tr.getStoredKey=r;function s(S){return S instanceof f?S.props?.key:void 0}Tr.getExplicitStoredKey=s;function o(S){return S.length===0}Tr.isConstant=o;function u(S){return S}Tr.extractFieldProvider=u;function c(S){return S}Tr.getDefaultProvider=c;function d(S,p,w){return l(S,p,w)}Tr.createFieldSchema=d;let l;class f{get allowedTypeSet(){return this.lazyTypes.value}get metadata(){return this.props?.metadata??{}}constructor(p,w,O){if(this.kind=p,this.allowedTypes=w,this.props=O,!(this instanceof b))throw new n.UsageError("FieldSchema is @sealed: sub-classing is not allowed.");this.lazyTypes=new e.Lazy(()=>(0,t.normalizeAllowedTypes)(this.allowedTypes)),this.requiresValue=this.props?.defaultProvider===void 0&&this.kind!==i.Optional}}Tr.FieldSchema=f;class b extends f{get persistedMetadata(){return this.propsAlpha?.persistedMetadata}constructor(p,w,O,E){super(p,w,E),this.annotatedAllowedTypes=O,this.allowedTypesMetadata=(0,t.isAnnotatedAllowedTypes)(O)?O.metadata:{},this.lazyAnnotatedTypes=new e.Lazy(()=>(0,t.normalizeAnnotatedAllowedTypes)(O)),this.lazyIdentifiers=new e.Lazy(()=>new Set(this.annotatedAllowedTypesNormalized.types.map(({type:F})=>F.identifier))),this.propsAlpha=E}get allowedTypesIdentifiers(){return this.lazyIdentifiers.value}get annotatedAllowedTypesNormalized(){return this.lazyAnnotatedTypes.value}}Tr.FieldSchemaAlpha=b,l=(S,p,w)=>new b(S,(0,t.unannotateImplicitAllowedTypes)(p),p,w);function C(S){return S instanceof f?S:d(i.Required,S)}Tr.normalizeFieldSchema=C;function v(S,p){return m(C(S),C(p))}Tr.areImplicitFieldSchemaEqual=v;function m(S,p){return S===p?!0:S.kind!==p.kind||!h(S.props,p.props)?!1:(0,a.compareSets)({a:S.allowedTypeSet,b:p.allowedTypeSet})}Tr.areFieldSchemaEqual=m;function h(S,p){return S===p?!0:!(S?.key!==p?.key||S?.defaultProvider!==p?.defaultProvider||!g(S?.metadata,p?.metadata))}function g(S,p){return S===p?!0:Object.is(S?.custom,p?.custom)&&S?.description===p?.description&&_(S?.persistedMetadata,p?.persistedMetadata)}function _(S,p){if(Object.is(S,p))return!0;if(S===void 0||p===void 0)return!1;const w=JSON.stringify(S),O=JSON.stringify(p);return w===O}return Tr}var BG;function fb(){if(BG)return PC;BG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(PC,"__esModule",{value:!0}),PC.walkFieldSchema=void 0;const e=dr(),n=xi();function a(t,i,r=new Set){(0,e.walkAllowedTypes)((0,n.normalizeFieldSchema)(t).annotatedAllowedTypesNormalized,i,r)}return PC.walkFieldSchema=a,PC}var nN={},Au={},rN={},UG;function vl(){return UG||(UG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.arrayNodeStoredSchema=e.getStoredSchema=e.convertFieldKind=e.convertField=e.toStoredSchema=e.toUnhydratedSchema=e.toInitialSchema=e.toUpgradeSchema=e.permissiveStoredSchemaGenerationOptions=e.restrictiveStoredSchemaGenerationOptions=void 0;const n=Je(),a=Ot(),t=Vt(),i=An(),r=Bt(),s=dr(),o=xi(),u=fb(),c=new WeakMap;e.restrictiveStoredSchemaGenerationOptions={includeStaged:()=>!1},e.permissiveStoredSchemaGenerationOptions={includeStaged:()=>!0};function d(m){return f(m,e.restrictiveStoredSchemaGenerationOptions)}e.toUpgradeSchema=d;function l(m){return f(m,e.restrictiveStoredSchemaGenerationOptions)}e.toInitialSchema=l,e.toUnhydratedSchema=e.permissiveStoredSchemaGenerationOptions;function f(m,h){const g=(0,r.getOrCreate)(c,h,()=>new WeakMap);return(0,r.getOrCreate)(g,m,()=>{const _=(0,o.normalizeFieldSchema)(m),S=new Map;return(0,u.walkFieldSchema)(_,{node(w){if(S.has((0,r.brand)(w.identifier)))throw new a.UsageError(`Multiple schema encountered with the identifier ${JSON.stringify(w.identifier)}. Remove or rename them to avoid the collision.`);S.set((0,r.brand)(w.identifier),C(w,h))},allowedTypeFilter:w=>(0,s.allowedTypeFilter)(w,h)}),{nodeSchema:S,rootFieldSchema:b(_,h)}})}e.toStoredSchema=f;function b(m,h){const g=e.convertFieldKind.get(m.kind)?.identifier??(0,n.fail)(2787);let _;return m instanceof o.FieldSchemaAlpha?_=(0,s.convertAllowedTypes)(m.annotatedAllowedTypesNormalized,h):_=m.allowedTypesIdentifiers,{kind:g,types:_,persistedMetadata:m.persistedMetadata}}e.convertField=b,e.convertFieldKind=new Map([[o.FieldKind.Optional,i.FieldKinds.optional],[o.FieldKind.Required,i.FieldKinds.required],[o.FieldKind.Identifier,i.FieldKinds.identifier]]);function C(m,h){if((0,s.isClassBasedSchema)(m))return(0,s.getTreeNodeSchemaPrivateData)(m).toStored(h);const g=m.kind;switch(g){case s.NodeKind.Leaf:return new t.LeafNodeStoredSchema(m.leafKind);case s.NodeKind.Map:case s.NodeKind.Record:{const _=m.allowedTypesIdentifiers;return new t.MapNodeStoredSchema({kind:i.FieldKinds.optional.identifier,types:_,persistedMetadata:m.persistedMetadata},m.persistedMetadata)}case s.NodeKind.Array:{const _=m.allowedTypesIdentifiers;return v(_,m.persistedMetadata)}case s.NodeKind.Object:{const _=new Map;for(const S of m.fields.values())_.set((0,r.brand)(S.storedKey),b(S,h));return new t.ObjectNodeStoredSchema(_,m.persistedMetadata)}default:(0,n.unreachableCase)(g)}}e.getStoredSchema=C;function v(m,h){const g={kind:i.FieldKinds.sequence.identifier,types:m,persistedMetadata:h},_=new Map([[t.EmptyKey,g]]);return new t.ObjectNodeStoredSchema(_,h)}e.arrayNodeStoredSchema=v})(rN)),rN}var iN={},sN={},wa={},Du={},Xm={},zG;function Oc(){if(zG)return Xm;zG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.getTreeNodeSchemaInitializedData=Xm.getUnhydratedContext=void 0;const e=An(),n=Bt(),a=dr(),t=xi(),i=vl(),r=new WeakMap;function s(u){return(0,n.getOrCreate)(r,u,c=>{const d=(0,t.normalizeFieldSchema)(u),l=new a.UnhydratedContext(e.defaultSchemaPolicy,(0,i.toStoredSchema)(u,i.toUnhydratedSchema));return new a.Context(l,a.Context.schemaMapFromRootSchema(d.annotatedAllowedTypesNormalized))})}Xm.getUnhydratedContext=s;function o(u,c){const d=(0,a.getTreeNodeSchemaPrivateData)(u);return{...c,context:s(u),childAnnotatedAllowedTypes:d.childAnnotatedAllowedTypes.map(a.normalizeAnnotatedAllowedTypes)}}return Xm.getTreeNodeSchemaInitializedData=o,Xm}var VG;function Sl(){if(VG)return Du;VG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Du,"__esModule",{value:!0}),Du.getPossibleTypes=Du.unhydratedFlexTreeFromInsertableNode=Du.unhydratedFlexTreeFromInsertable=void 0;const e=Ot(),n=Je(),a=Bt(),t=xi(),i=dr(),r=Oc();function s(d,l){const f=(0,t.normalizeFieldSchema)(l);if(d===void 0){if(f.kind!==t.FieldKind.Optional)throw new e.UsageError("Got undefined for non-optional field.");return}return o(d,f.allowedTypeSet)}Du.unhydratedFlexTreeFromInsertable=s;function o(d,l){if((0,i.isTreeNode)(d)){const v=(0,i.getKernel)(d),m=v.getInnerNodeIfUnhydrated();if(m===void 0)throw new e.UsageError("A node may not be inserted into the tree more than once");if(!l.has(v.schema))throw new e.UsageError("Invalid schema for this context.");return m}const f=u(d,l),C=(0,i.getTreeNodeSchemaPrivateData)(f).idempotentInitialize().toFlexContent(d,l);return new i.UnhydratedFlexTreeNode(...C,(0,r.getUnhydratedContext)(f))}Du.unhydratedFlexTreeFromInsertableNode=o;function u(d,l){const f=c(l,d);if(f.length===0)throw new e.UsageError(`The provided data is incompatible with all of the types allowed by the schema. The set of allowed types is: ${JSON.stringify([...l].map(b=>b.identifier))}.`);if(!(0,a.hasSingle)(f))throw new e.UsageError(`The provided data is compatible with more than one type allowed by the schema.
The set of possible types is ${JSON.stringify([...f.map(b=>b.identifier)])}.
Explicitly construct an unhydrated node of the desired type to disambiguate.
For class-based schema, this can be done by replacing an expression like "{foo: 1}" with "new MySchema({foo: 1})".`);return f[0]}function c(d,l){(0,n.assert)(l!==void 0,2185);let f=i.CompatibilityLevel.None;const b=[];for(const C of d){const m=(0,i.getTreeNodeSchemaPrivateData)(C).idempotentInitialize().shallowCompatibilityTest(l);m>f&&(b.length=0,f=m),f===m&&b.push(C)}return f===i.CompatibilityLevel.None?[]:b}return Du.getPossibleTypes=c,Du}var Io={},HG;function TT(){if(HG)return Io;HG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Io,"__esModule",{value:!0}),Io.prepareContentForHydration=Io.prepareForInsertionContextless=Io.prepareArrayContentForInsertion=Io.prepareForInsertion=void 0;const e=An(),n=Sl(),a=Ot(),t=Bt(),i=dr(),r=Je(),s=An();function o(v,m,h,g){return c(v,m,(0,e.getSchemaAndPolicy)(h),h.isHydrated()?h:void 0,g)}Io.prepareForInsertion=o;function u(v,m,h,g){const _=v.map(S=>(0,n.unhydratedFlexTreeFromInsertable)(S,m));return d((0,e.getSchemaAndPolicy)(h),h.isHydrated()?h:void 0,{kind:e.FieldKinds.sequence.identifier,types:g,persistedMetadata:void 0},_),_}Io.prepareArrayContentForInsertion=u;function c(v,m,h,g,_){const S=(0,n.unhydratedFlexTreeFromInsertable)(v,m);return d(h,g,_,S===void 0?[]:[S]),S}Io.prepareForInsertionContextless=c;function d(v,m,h,g){m!==void 0&&(f(g,m.checkout.forest,m),(0,s.isFieldInSchema)(g,h,v,e.throwOutOfSchema))}const l=(0,t.brand)("placeholder");function f(v,m,h){const g=[];for(const _ of v){const S={rootPath:{parent:void 0,parentField:l,parentIndex:0},paths:[]};g.push(S),b(_,S.rootPath,(p,w)=>{S.paths.push({path:p,node:w})},h)}C(g,m)}Io.prepareContentForHydration=f;function b(v,m,h,g){if(v.parentField.parent.parent!==void 0)throw new a.UsageError("Attempted to insert a node which is already under a parent. If this is desired, remove the node from its parent before inserting it elsewhere.");const _=[];for(let S=[m,v];S!==void 0;S=_.pop()){const[p,w]=S;if(w!==void 0){const O=w.treeNode;O!==void 0&&h(p,O)}for(const[O,E]of w.allFieldsLazy){E.fillPendingDefaults(g);for(const[F,R]of E.children.entries())_.push([{parent:p,parentField:O,parentIndex:F},R])}}}function C(v,m){if(v.length>0){let h=0;const g=m.events.on("afterRootFieldCreated",_=>{const S=v[h]??(0,r.oob)();(0,r.debugAssert)(()=>S.rootPath.parentField===l),S.rootPath.parentField=(0,t.brand)(_);for(const{path:p,node:w}of S.paths)(0,i.getKernel)(w).hydrate(m.anchors,p);++h===v.length&&g()})}}return Io}var Zm={},KG;function Pc(){return KG||(KG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=Zm&&Zm.__classPrivateFieldGet||function(_,S,p,w){if(p==="a"&&!w)throw new TypeError("Private accessor was defined without a getter");if(typeof S=="function"?_!==S||!w:!S.has(_))throw new TypeError("Cannot read private member from an object whose class did not declare it");return p==="m"?w:p==="a"?w.call(_):w?w.value:S.get(_)},a=Zm&&Zm.__classPrivateFieldSet||function(_,S,p,w,O){if(w==="m")throw new TypeError("Private method is not writable");if(w==="a"&&!O)throw new TypeError("Private accessor was defined without a setter");if(typeof S=="function"?_!==S||!O:!S.has(_))throw new TypeError("Cannot write private member to an object whose class did not declare it");return w==="a"?O.call(_,p):O?O.value=p:S.set(_,p),p},t,i;Object.defineProperty(e,"__esModule",{value:!0}),e.leafToFlexContent=e.handleSchema=e.nullSchema=e.booleanSchema=e.numberSchema=e.stringSchema=e.LeafNodeSchema=void 0;const r=Je(),s=Ot(),o=bn(),u=Vt(),c=An(),d=dr(),l=Bt(),f=Oc();class b{create(S){if((0,c.isFlexTreeNode)(S)){const p=S.value;return(0,r.assert)((0,c.valueSchemaAllows)(this.info,p),2326),p}return S}createFromInsertable(S){return S}constructor(S,p){this.kind=d.NodeKind.Leaf,this.implicitlyConstructable=!0,this.childTypes=new Set,this[i]={idempotentInitialize:()=>a(this,t,n(this,t,"f")??(0,f.getTreeNodeSchemaInitializedData)(this,{shallowCompatibilityTest:w=>v(this,w),toFlexContent:(w,O)=>h(w,this,O)}),"f"),childAnnotatedAllowedTypes:[],toStored:()=>new u.LeafNodeStoredSchema(this.leafKind)},t.set(this,void 0),this.metadata={},this.identifier=S,this.info=p,this.leafKind=p}}e.LeafNodeSchema=b,t=new WeakMap,i=d.privateDataSymbol;function C(_,S){return new b(`com.fluidframework.leaf.${_}`,S)}e.stringSchema=C("string",u.ValueSchema.String),e.numberSchema=C("number",u.ValueSchema.Number),e.booleanSchema=C("boolean",u.ValueSchema.Boolean),e.nullSchema=C("null",u.ValueSchema.Null),e.handleSchema=C("handle",u.ValueSchema.FluidHandle);function v(_,S){return(0,c.isTreeValue)(S)&&m(_,S)?d.CompatibilityLevel.Normal:d.CompatibilityLevel.None}function m(_,S){return _.kind===d.NodeKind.Leaf?(0,c.valueSchemaAllows)(_.info,S):!1}function h(_,S,p){if((0,r.assert)(S.kind===d.NodeKind.Leaf,2337),!(0,c.isTreeValue)(_))throw new s.UsageError(`Input data is incompatible with leaf schema: ${_}`);const w=g(_,p),O=[...p].find(F=>m(F,w));return(0,r.assert)(O!==void 0,2122),[{value:w,type:(0,l.brand)(O.identifier)},new Map]}e.leafToFlexContent=h;function g(_,S){switch(typeof _){case"number":{if(Object.is(_,-0))return 0;if(Number.isFinite(_))return _;if(S.has(e.nullSchema))return null;throw new s.UsageError(`Received unsupported numeric value: ${_}.`)}case"string":case"boolean":return _;case"object":if(_===null||(0,o.isFluidHandle)(_))return _;default:throw new s.UsageError(`Received unsupported leaf value: ${_}.`)}}})(Zm)),Zm}var $G;function V0e(){if($G)return wa;$G=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=wa&&wa.__classPrivateFieldGet||function(x,L,V,G){if(V==="a"&&!G)throw new TypeError("Private accessor was defined without a getter");if(typeof L=="function"?x!==L||!G:!L.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return V==="m"?G:V==="a"?G.call(x):G?G.value:L.get(x)},n,a;Object.defineProperty(wa,"__esModule",{value:!0}),wa.arraySchema=wa.asIndex=wa.IterableTreeArrayContent=wa.TreeArrayNode=void 0;const t=Je(),i=Ot(),r=Vt(),s=An(),o=dr(),u=Sl(),c=TT(),d=Oc(),l=Bt(),f=Pc(),b=vl();wa.TreeArrayNode={spread:x=>C(x)};let C;class v{constructor(L){this.content=L}[Symbol.iterator](){return this.content[Symbol.iterator]()}}wa.IterableTreeArrayContent=v,C=x=>new v(x);function m(x){return(0,o.getOrCreateInnerNode)(x).getBoxed(r.EmptyKey)}const h=["concat","entries","every","filter","find","findIndex","flat","flatMap","forEach","includes","indexOf","join","keys","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString","toString"],g=(()=>{class x extends o.TreeNodeValid{}return h.forEach(L=>{Object.defineProperty(x.prototype,L,{value:Array.prototype[L]})}),x})();function _(x,L){if(typeof x!="string")return;const V=Number(x);if(!(!Number.isInteger(V)||String(V)!==x))return 0<=V&&V<L?V:void 0}wa.asIndex=_;function S(x,L,V){const G=new Proxy(L,{get:(ee,se,re)=>{const fe=m(re),oe=_(se,fe.length);if(oe===void 0)return se==="length"?fe.length:se==="constructor"?L.constructor:Reflect.get(V,se,re);const pe=fe.at(oe);return pe===void 0?void 0:(0,o.getOrCreateNodeFromInnerUnboxedNode)(pe)},set:(ee,se,re,fe)=>{if(se==="length")return!1;if(se===Symbol.isConcatSpreadable)return Reflect.set(V,se,re,fe);if(_(se,Number.POSITIVE_INFINITY)!==void 0)throw new i.UsageError("Cannot set indexed properties on array nodes. Use array node mutation APIs to alter the array.");return x?Reflect.set(ee,se,re,fe):!1},has:(ee,se)=>{const re=m(G);return _(se,re.length)!==void 0||Reflect.has(V,se)},ownKeys:ee=>{const se=m(G),re=Array.from({length:se.length},(fe,oe)=>`${oe}`);return x?re.push(...Reflect.ownKeys(ee)):re.push("length"),re},getOwnPropertyDescriptor:(ee,se)=>{const re=m(G),fe=_(se,re.length);if(fe!==void 0){const oe=re.at(fe);return{value:oe===void 0?void 0:(0,o.getOrCreateNodeFromInnerUnboxedNode)(oe),writable:!0,enumerable:!0,configurable:!0}}else if(se==="length")return{value:re.length,writable:!0,enumerable:!1,configurable:!1};return Reflect.getOwnPropertyDescriptor(V,se)},defineProperty(ee,se,re){if(_(se,Number.POSITIVE_INFINITY)!==void 0)throw new i.UsageError("Shadowing of array indices is not permitted.");return Reflect.defineProperty(V,se,re)}});return G}class p extends g{constructor(L){super(L??[]),n.add(this)}toJSON(){return Array.from(this)}get length(){return(0,t.fail)(2779)}[(n=new WeakSet,a=function(V){const G=m(this),se=V.flatMap(ge=>ge instanceof v?Array.from(ge):[ge]),re=(0,o.getKernel)(this),fe=re.getOrCreateInnerNode().context;(0,t.assert)(fe===re.context.flexContext,3092);const oe=re.context.flexContext.schema.nodeSchema.get((0,l.brand)(re.schema.identifier));(0,t.assert)(oe instanceof r.ObjectNodeStoredSchema,3093);const pe=oe.getFieldSchema(r.EmptyKey);return(0,c.prepareArrayContentForInsertion)(se,this.childSchema,G.context,pe.types)},Symbol.iterator)](){return this.values()}get[Symbol.unscopables](){return Array.prototype[Symbol.unscopables]}at(L){const G=m(this).boxedAt(L);return G===void 0?G:(0,o.getOrCreateNodeFromInnerNode)(G)}insertAt(L,...V){const G=m(this);F(L,G,"insertAt",!0);const ee=e(this,n,"m",a).call(this,V);G.editor.insert(L,ee)}insertAtStart(...L){this.insertAt(0,...L)}insertAtEnd(...L){this.insertAt(this.length,...L)}removeAt(L){const V=m(this);F(L,V,"removeAt"),V.editor.remove(L,1)}removeRange(L,V){const G=m(this),{length:ee}=G,se=L??0,re=Math.min(ee,V??ee);if(E(se),E(re),re<se)throw new i.UsageError('Too large of "start" value passed to TreeArrayNode.removeRange.');G.editor.remove(se,re-se)}moveToStart(L,V){const ee=m(V??this);F(L,ee,"moveToStart"),this.moveRangeToIndex(0,L,L+1,V)}moveToEnd(L,V){const ee=m(V??this);F(L,ee,"moveToEnd"),this.moveRangeToIndex(this.length,L,L+1,V)}moveToIndex(L,V,G){const se=m(G??this),re=m(this);F(L,re,"moveToIndex",!0),F(V,se,"moveToIndex"),this.moveRangeToIndex(L,V,V+1,G)}moveRangeToStart(L,V,G){R(L,V,G??m(this),"moveRangeToStart"),this.moveRangeToIndex(0,L,V,G)}moveRangeToEnd(L,V,G){R(L,V,G??m(this),"moveRangeToEnd"),this.moveRangeToIndex(this.length,L,V,G)}moveRangeToIndex(L,V,G,ee){const se=m(this),re=this.allowedTypes,fe=(0,o.getKernel)(this),oe=(fe.context.flexContext.schema.nodeSchema.get((0,l.brand)(fe.schema.identifier))??(0,t.fail)(3094)).getFieldSchema(r.EmptyKey).types,pe=ee!==void 0?m(ee):se;if(F(L,se,"moveRangeToIndex",!0),R(V,G,ee??se,"moveRangeToIndex"),pe!==se)for(let ge=V;ge<G;ge++){const Ce=pe.boxedAt(ge)??(0,t.oob)(),Fe=(0,o.getSimpleNodeSchemaFromInnerNode)(Ce);if(!re.has(Fe))throw new i.UsageError(`Type ${Ce.type} in source sequence is not allowed in destination.`);if(!oe.has(Ce.type))throw new i.UsageError(`Type ${Ce.type} in source sequence is not allowed in destination's stored schema: this would likely require upgrading the document to permit a staged schema.`)}const de=G-V;if(se.context.isHydrated()){if(!pe.context.isHydrated())throw new i.UsageError("Cannot move elements from an unhydrated array to a hydrated array.");if(pe.context!==se.context)throw new i.UsageError("Cannot move elements between two different TreeViews.");se.context.checkout.editor.move(pe.getFieldPath(),V,de,se.getFieldPath(),L)}else{if(!(pe instanceof o.UnhydratedSequenceField))throw new i.UsageError("Cannot move elements from a hydrated array to an unhydrated array.");if(pe.context.isHydrated())throw new i.UsageError("Cannot move elements from an unhydrated array to a hydrated array.");pe!==se||L<V?se.editor.insert(L,pe.editor.remove(V,de)):L>V+de&&se.editor.insert(L-de,pe.editor.remove(V,de))}}values(){return this.generateValues((0,o.getKernel)(this).generationNumber)}*generateValues(L){const V=(0,o.getKernel)(this);if(L!==V.generationNumber)throw new i.UsageError("Concurrent editing and iteration is not allowed.");for(let G=0;G<this.length;G++)if(yield this.at(G)??(0,t.fail)(2780),L!==V.generationNumber)throw new i.UsageError("Concurrent editing and iteration is not allowed.")}}p.kind=o.NodeKind.Array;function w(x,L,V,G,ee,se){const re=(0,o.unannotateImplicitAllowedTypes)(L),fe=new t.Lazy(()=>(0,o.normalizeAllowedTypes)(re)),oe=new t.Lazy(()=>new Set([...fe.value].map(Ce=>Ce.identifier)));let pe;class de extends p{static prepareInstance(Fe,We){const Ze=G?Fe:[];return G&&Object.defineProperty(Fe,"length",{value:Number.NaN,writable:!0,enumerable:!1,configurable:!1}),S(G,Ze,Fe)}static buildRawNode(Fe,We){return(0,u.unhydratedFlexTreeFromInsertable)(We,this)}static get allowedTypesIdentifiers(){return oe.value}static oneTimeSetup(){{let We=this.prototype;for(;We!==de.prototype;){for(const Ze of Object.getOwnPropertyNames(We))if(_(Ze,Number.POSITIVE_INFINITY)!==void 0)throw new i.UsageError(`Schema ${x} defines an inherited index property "${Ze.toString()}" which shadows a possible array index. Shadowing of array indices is not permitted.`);We=Reflect.getPrototypeOf(We)}}const Fe=this;return(0,d.getTreeNodeSchemaInitializedData)(this,{shallowCompatibilityTest:We=>k(We),toFlexContent:(We,Ze)=>j(We,Fe)})}static get childTypes(){return fe.value}get[o.typeNameSymbol](){return x}get[o.typeSchemaSymbol](){return de.constructorCached?.constructor}get childSchema(){return L}get allowedTypes(){return fe.value}static get[o.privateDataSymbol](){return pe??=(0,o.createTreeNodeSchemaPrivateData)(this,[L],Fe=>(0,b.arrayNodeStoredSchema)((0,o.convertAllowedTypes)(L,Fe),se))}}return de.constructorCached=void 0,de.identifier=x,de.info=L,de.implicitlyConstructable=V,de.metadata=ee??{},de.persistedMetadata=se,de}wa.arraySchema=w;function O(x){if(!Number.isSafeInteger(x))throw new i.UsageError(`Expected a safe integer, got ${x}.`)}function E(x){if(O(x),x<0)throw new i.UsageError(`Expected non-negative index, got ${x}.`)}function F(x,L,V,G=!1){if(E(x),G){if(x>L.length)throw new i.UsageError(`Index value passed to TreeArrayNode.${V} is out of bounds.`)}else if(x>=L.length)throw new i.UsageError(`Index value passed to TreeArrayNode.${V} is out of bounds.`)}function R(x,L,V,G){if(F(x,V,G,!0),F(L,V,G,!0),x>L||V.length<L)throw new i.UsageError(`Index value passed to TreeArrayNode.${G} is out of bounds.`)}function M(x,L){let V=x;if(x===void 0)if(L.has(f.nullSchema))V=null;else throw new TypeError(`Received unsupported array entry value: ${x}.`);return(0,u.unhydratedFlexTreeFromInsertableNode)(V,L)}function j(x,L){if(!(typeof x=="object"&&x!==null&&Symbol.iterator in x))throw new i.UsageError(`Input data is incompatible with Array schema: ${x}`);const V=(0,o.normalizeAllowedTypes)(L.info),G=Array.from(x,re=>M(re,V)),ee=(0,d.getUnhydratedContext)(L).flexContext,se=G.length===0?[]:[[r.EmptyKey,new o.UnhydratedSequenceField(ee,s.FieldKinds.sequence.identifier,r.EmptyKey,G)]];return[{type:(0,l.brand)(L.identifier)},new Map(se)]}function k(x,L){return(0,s.isTreeValue)(x)?o.CompatibilityLevel.None:x instanceof Map?o.CompatibilityLevel.Low:Symbol.iterator in x?o.CompatibilityLevel.Normal:o.CompatibilityLevel.None}return wa}var ep={},GG;function H0e(){if(GG)return ep;GG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ep,"__esModule",{value:!0}),ep.isArrayNodeSchema=ep.ArrayNodeSchema=void 0;const e=dr();ep.ArrayNodeSchema={[Symbol.hasInstance](a){return n(a)}};function n(a){return a.kind===e.NodeKind.Array}return ep.isArrayNodeSchema=n,ep}var WG;function K0e(){return WG||(WG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isArrayNodeSchema=e.ArrayNodeSchema=e.TreeArrayNode=e.IterableTreeArrayContent=e.asIndex=e.arraySchema=void 0;var n=V0e();Object.defineProperty(e,"arraySchema",{enumerable:!0,get:function(){return n.arraySchema}}),Object.defineProperty(e,"asIndex",{enumerable:!0,get:function(){return n.asIndex}}),Object.defineProperty(e,"IterableTreeArrayContent",{enumerable:!0,get:function(){return n.IterableTreeArrayContent}}),Object.defineProperty(e,"TreeArrayNode",{enumerable:!0,get:function(){return n.TreeArrayNode}});var a=H0e();Object.defineProperty(e,"ArrayNodeSchema",{enumerable:!0,get:function(){return a.ArrayNodeSchema}}),Object.defineProperty(e,"isArrayNodeSchema",{enumerable:!0,get:function(){return a.isArrayNodeSchema}})})(sN)),sN}var aN={},EC={},IC={},JG;function wT(){if(JG)return IC;JG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(IC,"__esModule",{value:!0}),IC.tryGetTreeNodeForField=void 0;const e=Je(),n=An(),a=dr();function t(i){function r(s){const o=s.content;return(0,n.isFlexTreeNode)(o)?(0,a.getOrCreateNodeFromInnerNode)(o):o}switch(i.schema){case n.FieldKinds.required.identifier:return r(i);case n.FieldKinds.optional.identifier:return r(i);case n.FieldKinds.identifier.identifier:return i.content;default:(0,e.fail)(2783)}}return IC.tryGetTreeNodeForField=t,IC}var RC={},QG;function toe(){if(QG)return RC;QG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(RC,"__esModule",{value:!0}),RC.recordLikeDataToFlexContent=void 0;const e=Je(),n=An(),a=Bt(),t=dr(),i=Oc(),r=Sl();function s(o,u){const c=(0,t.normalizeAllowedTypes)((0,t.unannotateImplicitAllowedTypes)(u.info)),d=(0,i.getUnhydratedContext)(u).flexContext,l=new Map;for(const f of o){const[b,C]=f;if((0,e.assert)(!l.has((0,a.brand)(b)),2124),C!==void 0){const v=(0,r.unhydratedFlexTreeFromInsertableNode)(C,c),m=(0,t.createField)(d,n.FieldKinds.optional.identifier,(0,a.brand)(b),[v]);l.set((0,a.brand)(b),m)}}return[{type:(0,a.brand)(u.identifier)},l]}return RC.recordLikeDataToFlexContent=s,RC}var YG;function $0e(){if(YG)return EC;YG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(EC,"__esModule",{value:!0}),EC.mapSchema=void 0;const e=Je(),n=Ot(),a=An(),t=wT(),i=xi(),r=dr(),s=Sl(),o=TT(),u=Bt(),c=Oc(),d=toe(),l=Vt(),f={getPrototypeOf:()=>Map.prototype};class b extends r.TreeNodeValid{constructor(g){super(g??[])}[Symbol.iterator](){return this.entries()}get innerNode(){return(0,r.getOrCreateInnerNode)(this)}editor(g){return this.innerNode.getBoxed((0,u.brand)(g)).editor}delete(g){const _=this.innerNode.getBoxed((0,u.brand)(g));this.editor(g).set(void 0,_.length===0)}*entries(){const g=this.innerNode;for(const _ of g.keys())yield[_,(0,t.tryGetTreeNodeForField)(g.getBoxed(_))]}get(g){const S=this.innerNode.getBoxed((0,u.brand)(g));return(0,t.tryGetTreeNodeForField)(S)}has(g){return this.innerNode.tryGetField((0,u.brand)(g))!==void 0}keys(){return this.innerNode.keys()}set(g,_){const S=(0,r.getKernel)(this),p=this.innerNode,w=this.innerNode.context.schema.nodeSchema.get((0,u.brand)(S.schema.identifier));(0,e.assert)(w instanceof l.MapNodeStoredSchema,3095);const O=(0,o.prepareForInsertion)(_,(0,i.createFieldSchema)(i.FieldKind.Optional,S.schema.info),p.context,w.mapFields),E=p.getBoxed((0,u.brand)(g));return this.editor(g).set(O,E.length===0),this}get size(){return(0,u.count)(this.innerNode.keys())}*values(){for(const[,g]of this.entries())yield g}forEach(g,_){for(const S of(0,r.getOrCreateInnerNode)(this)){const p=(0,t.tryGetTreeNodeForField)(S);g.call(_,p,S.key,this)}}}b.kind=r.NodeKind.Map;function C(h,g,_,S,p,w){const O=new e.Lazy(()=>(0,r.normalizeAllowedTypes)((0,r.unannotateImplicitAllowedTypes)(g))),E=new e.Lazy(()=>new Set([...O.value].map(j=>j.identifier)));let F;class R extends b{static prepareInstance(k,x){return S?new Proxy(k,f):k}static buildRawNode(k,x){return(0,s.unhydratedFlexTreeFromInsertable)(x,this)}static get allowedTypesIdentifiers(){return E.value}static oneTimeSetup(){const k=this;return(0,c.getTreeNodeSchemaInitializedData)(this,{shallowCompatibilityTest:v,toFlexContent:x=>m(x,k)})}static get childTypes(){return O.value}get[r.typeNameSymbol](){return h}get[r.typeSchemaSymbol](){return R.constructorCached?.constructor}static get[r.privateDataSymbol](){return F??=(0,r.createTreeNodeSchemaPrivateData)(this,[g],k=>new l.MapNodeStoredSchema({kind:a.FieldKinds.optional.identifier,types:(0,r.convertAllowedTypes)(g,k),persistedMetadata:w},w))}}return R.constructorCached=void 0,R.identifier=h,R.info=g,R.implicitlyConstructable=_,R.metadata=p??{},R.persistedMetadata=w,R}EC.mapSchema=C;function v(h){return(0,a.isTreeValue)(h)?r.CompatibilityLevel.None:(0,u.isReadonlyArray)(h)?r.CompatibilityLevel.Low:Symbol.iterator in h?r.CompatibilityLevel.Normal:r.CompatibilityLevel.Low}function m(h,g){if(!(typeof h=="object"&&h!==null))throw new n.UsageError(`Input data is incompatible with Map schema: ${h}`);const _=Symbol.iterator in h?h:Object.entries(h);return(0,d.recordLikeDataToFlexContent)(_,g)}return EC}var tp={},XG;function G0e(){if(XG)return tp;XG=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(tp,"__esModule",{value:!0}),tp.isMapNodeSchema=tp.MapNodeSchema=void 0;const e=dr();tp.MapNodeSchema={[Symbol.hasInstance](a){return n(a)}};function n(a){return a.kind===e.NodeKind.Map}return tp.isMapNodeSchema=n,tp}var ZG;function W0e(){return ZG||(ZG=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.MapNodeSchema=e.isMapNodeSchema=e.mapSchema=void 0;var n=$0e();Object.defineProperty(e,"mapSchema",{enumerable:!0,get:function(){return n.mapSchema}});var a=G0e();Object.defineProperty(e,"isMapNodeSchema",{enumerable:!0,get:function(){return a.isMapNodeSchema}}),Object.defineProperty(e,"MapNodeSchema",{enumerable:!0,get:function(){return a.MapNodeSchema}})})(aN)),aN}var oN={},Ro={},eW;function J0e(){if(eW)return Ro;eW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ro,"__esModule",{value:!0}),Ro.unannotateSchemaRecord=Ro.objectSchema=Ro.ObjectFieldSchema=Ro.setField=void 0;const e=Je(),n=Ot(),a=bn(),t=Vt(),i=An(),r=Bt(),s=dr(),o=Oc(),u=wT(),c=TT(),d=xi(),l=Sl(),f=vl();function b(F){const R=new Map;for(const[M,j]of Object.entries(F)){const k=(0,d.normalizeFieldSchema)(j),x=(0,d.getStoredKey)(M,k);R.set(M,{storedKey:x,schema:k})}return R}function C(F,R){return{get(j,k,x){const L=F.flexKeyMap.get(k);if(L!==void 0){const V=(0,s.getOrCreateInnerNode)(x);(0,e.debugAssert)(()=>!V.context.isDisposed()||"FlexTreeNode is disposed");const G=V.tryGetField(L.storedKey);return G!==void 0?(0,u.tryGetTreeNodeForField)(G):void 0}return k===s.typeSchemaSymbol?F:k===s.typeNameSymbol?F.identifier:Reflect.get(j,k,x)},set(j,k,x,L){const V=F.flexKeyMap.get(k);if(V===void 0)return R?Reflect.set(j,k,x,L):!1;const G=(0,s.getOrCreateInnerNode)(L),ee=G.context.schema.nodeSchema.get((0,r.brand)(F.identifier));return(0,e.assert)(ee instanceof t.ObjectNodeStoredSchema,3096),v(G.getBoxed(V.storedKey),V.schema,x,ee.getFieldSchema(V.storedKey)),!0},deleteProperty(j,k){throw new n.UsageError("Object nodes do not support the delete operator. Optional fields can be assigned to undefined instead.")},has:(j,k)=>F.flexKeyMap.has(k)||(R?Reflect.has(j,k):!1),ownKeys:j=>[...F.flexKeyMap.keys(),...R?Reflect.ownKeys(j):[]],getOwnPropertyDescriptor:(j,k)=>{const x=F.flexKeyMap.get(k);if(x===void 0)return R?Reflect.getOwnPropertyDescriptor(j,k):void 0;const L=S.get(j)??(0,e.fail)(2781),V=(0,s.getOrCreateInnerNode)(L).tryGetField(x.storedKey);return{value:V===void 0?void 0:(0,u.tryGetTreeNodeForField)(V),writable:!0,enumerable:V!==void 0,configurable:!0}}}}function v(F,R,M,j){const k=(0,c.prepareForInsertion)(M,R,F.context,j);switch(F.schema){case i.FieldKinds.required.identifier:{(0,e.assert)(k!==void 0,2564),F.editor.set(k);break}case i.FieldKinds.optional.identifier:{const x=F;x.editor.set(k,x.length===0);break}default:(0,e.fail)(2782)}}Ro.setField=v;class m extends d.FieldSchemaAlpha{constructor(R,M,j,k){super(R,M,j,k),this.storedKey=k.key}}Ro.ObjectFieldSchema=m;class h extends s.TreeNodeValid{}h.kind=s.NodeKind.Object;function g(F,R,M,j,k,x){Object.freeze(R),p(F,R);const L=b(R),V=[];for(const oe of L.values())oe.schema.kind===d.FieldKind.Identifier&&V.push(oe.storedKey);const G=new e.Lazy(()=>new Set(Array.from(L.values(),oe=>[...oe.schema.allowedTypeSet]).flat()));let ee,se,re;class fe extends h{static prepareInstance(pe,de){const ge=re?pe:{},Ce=new Proxy(ge,se);return S.set(ge,Ce),Ce}static buildRawNode(pe,de){return(0,l.unhydratedFlexTreeFromInsertable)(de,this)}static oneTimeSetup(){re=this!==fe;const pe=this;se=C(pe,re);{let de=this.prototype;for(;de!==fe.prototype;){for(const[ge]of L)if(ge!=="constructor"&&Reflect.getOwnPropertyDescriptor(de,ge)!==void 0)throw new n.UsageError(`Schema ${F} defines an inherited property "${ge.toString()}" which shadows a field. Since fields are exposed as own properties, this shadowing will not work, and is an error.`);de=Reflect.getPrototypeOf(de)}}return(0,o.getTreeNodeSchemaInitializedData)(pe,{shallowCompatibilityTest:de=>O(de,pe),toFlexContent:(de,ge)=>w(de,pe)})}static get childTypes(){return G.value}get[s.typeNameSymbol](){return F}get[s.typeSchemaSymbol](){return fe.constructorCached?.constructor}static get[s.privateDataSymbol](){return ee??=(0,s.createTreeNodeSchemaPrivateData)(this,Array.from(L.values(),({schema:pe})=>(0,d.normalizeFieldSchema)(pe).annotatedAllowedTypes),pe=>{const de=new Map;for(const ge of L.values())(0,e.assert)(ge.schema instanceof d.FieldSchemaAlpha,3097),de.set((0,r.brand)(ge.storedKey),(0,f.convertField)(ge.schema,pe));return new t.ObjectNodeStoredSchema(de,x)})}}return fe.fields=new Map(Array.from(L,([oe,pe])=>[oe,new m(pe.schema.kind,pe.schema.allowedTypes,pe.schema.annotatedAllowedTypes,{...pe.schema.props,key:(0,d.getStoredKey)(oe,pe.schema)})])),fe.flexKeyMap=L,fe.storedKeyToPropertyKey=new Map(Array.from(L,([oe,pe])=>[pe.storedKey,oe])),fe.identifierFieldKeys=V,fe.allowUnknownOptionalFields=j,fe.constructorCached=void 0,fe.identifier=F,fe.info=R,fe.implicitlyConstructable=M,fe.metadata=k??{},fe.persistedMetadata=x,fe}Ro.objectSchema=g;function _(F){return Object.fromEntries(Object.entries(F).map(([R,M])=>[R,M instanceof d.FieldSchema?M:(0,s.unannotateImplicitAllowedTypes)(M)]))}Ro.unannotateSchemaRecord=_;const S=new WeakMap;function p(F,R){const M=new Set;for(const k of Object.values(R)){const x=(0,d.getExplicitStoredKey)(k);if(x!==void 0){if(M.has(x))throw new n.UsageError(`Duplicate stored key "${x}" in schema "${F}". Stored keys must be unique within an object schema.`);M.add(x)}}const j=new Set;for(const[k,x]of Object.entries(R)){const L=(0,d.getStoredKey)(k,x);if(j.has(L))throw new n.UsageError(`Stored key "${L}" in schema "${F}" conflicts with a property key of the same name, which is not overridden by a stored key. The final set of stored keys in an object schema must be unique.`);j.add(L)}}function w(F,R){if(typeof F!="object"||F===null||Symbol.iterator in F||(0,a.isFluidHandle)(F))throw new n.UsageError(`Input data is incompatible with Object schema: ${F}`);const M=new Map,j=(0,o.getUnhydratedContext)(R).flexContext;for(const[k,x]of R.flexKeyMap){const L=E(F,k);let V;if(L===void 0){const ee=x.schema.props?.defaultProvider??(0,e.fail)(2993),se=(0,d.extractFieldProvider)(ee);V=(0,d.isConstant)(se)?se():se}else V=[(0,l.unhydratedFlexTreeFromInsertableNode)(L,x.schema.allowedTypeSet)];const G=f.convertFieldKind.get(x.schema.kind)??(0,e.fail)(2994);M.set(x.storedKey,(0,s.createField)(j,G.identifier,x.storedKey,V))}return[{type:(0,r.brand)(R.identifier)},M]}function O(F,R){if((0,i.isTreeValue)(F)||Symbol.iterator in F)return s.CompatibilityLevel.None;for(const[M,j]of R.fields)if(j.requiresValue&&E(F,M)===void 0)return s.CompatibilityLevel.None;return s.CompatibilityLevel.Normal}function E(F,R){if(Object.hasOwnProperty.call(F,R))return F[R]}return Ro}var np={},tW;function Q0e(){if(tW)return np;tW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(np,"__esModule",{value:!0}),np.isObjectNodeSchema=np.ObjectNodeSchema=void 0;const e=dr();np.ObjectNodeSchema={[Symbol.hasInstance](a){return n(a)}};function n(a){return a.kind===e.NodeKind.Object}return np.isObjectNodeSchema=n,np}var nW;function Y0e(){return nW||(nW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ObjectNodeSchema=e.isObjectNodeSchema=e.setField=e.objectSchema=void 0;var n=J0e();Object.defineProperty(e,"objectSchema",{enumerable:!0,get:function(){return n.objectSchema}}),Object.defineProperty(e,"setField",{enumerable:!0,get:function(){return n.setField}});var a=Q0e();Object.defineProperty(e,"isObjectNodeSchema",{enumerable:!0,get:function(){return a.isObjectNodeSchema}}),Object.defineProperty(e,"ObjectNodeSchema",{enumerable:!0,get:function(){return a.ObjectNodeSchema}})})(oN)),oN}var cN={},FC={},rW;function X0e(){if(rW)return FC;rW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(FC,"__esModule",{value:!0}),FC.recordSchema=void 0;const e=Je(),n=Ot(),a=Bt(),t=dr(),i=Oc(),r=wT(),s=xi(),o=Sl(),u=An(),c=TT(),d=toe(),l=Vt();function f(g,_,S){const p=new Proxy(g,{get:(w,O,E)=>{if(typeof O=="symbol")switch(O){case t.typeSchemaSymbol:return S;case t.typeNameSymbol:return S.identifier;case Symbol.iterator:return()=>v(p);case Symbol.toPrimitive:return()=>Object.prototype.toString.call(p);case Symbol.toStringTag:{if(_)return S.identifier;break}}if(typeof O=="string"){const R=(0,t.getOrCreateInnerNode)(E).tryGetField((0,a.brand)(O));if(R!==void 0)return(0,r.tryGetTreeNodeForField)(R)}},set:(w,O,E,F)=>{if(typeof O=="symbol")return!1;const R=(0,t.getOrCreateInnerNode)(F),M=R.getBoxed((0,a.brand)(O)),j=(0,t.getKernel)(F),k=R.context.schema.nodeSchema.get((0,a.brand)(S.identifier));(0,e.assert)(k instanceof l.MapNodeStoredSchema,3098);const x=(0,c.prepareForInsertion)(E,(0,s.createFieldSchema)(s.FieldKind.Optional,j.schema.info),R.context,k.mapFields);return M.editor.set(x,M.length===0),!0},has:(w,O)=>typeof O=="symbol"?!1:(0,t.getOrCreateInnerNode)(p).tryGetField((0,a.brand)(O))!==void 0,ownKeys:w=>[...(0,t.getOrCreateInnerNode)(p).keys()],getOwnPropertyDescriptor:(w,O)=>{if(typeof O=="symbol")return;const F=(0,t.getOrCreateInnerNode)(p).tryGetField((0,a.brand)(O));if(F!==void 0)return{value:(0,r.tryGetTreeNodeForField)(F),writable:!0,enumerable:!0,configurable:!0}},defineProperty(w,O,E){throw new n.UsageError("Shadowing properties of record nodes is not permitted.")},deleteProperty(w,O){if(typeof O=="symbol")return!1;const F=(0,t.getOrCreateInnerNode)(p).tryGetField((0,a.brand)(O));return F!==void 0&&F.editor.set(void 0,F.length===0),!0}});return p}class b extends t.TreeNodeValid{constructor(_){super(_??{})}}b.kind=t.NodeKind.Record;function C(g){const{identifier:_,info:S,customizable:p,implicitlyConstructable:w,metadata:O,persistedMetadata:E}=g,F=new e.Lazy(()=>(0,t.normalizeAllowedTypes)((0,t.unannotateImplicitAllowedTypes)(S))),R=new e.Lazy(()=>new Set([...F.value].map(x=>x.identifier)));let M;class j extends b{static prepareInstance(L,V){return f(p?L:{},p,this)}static buildRawNode(L,V){return(0,o.unhydratedFlexTreeFromInsertable)(V,this)}static oneTimeSetup(){{let V=this.prototype;for(;V!==j.prototype;){for(const G of Object.getOwnPropertyNames(V))if(G!=="constructor"&&Reflect.getOwnPropertyDescriptor(V,G)!==void 0)throw new n.UsageError(`Schema ${_} defines an inherited property "${G.toString()}" which could shadow a legal entry. Since child fields are exposed as own properties, shadowing properties of record nodes is not permitted.`);V=Reflect.getPrototypeOf(V)}}const L=this;return(0,i.getTreeNodeSchemaInitializedData)(this,{shallowCompatibilityTest:m,toFlexContent:V=>h(V,L)})}static get allowedTypesIdentifiers(){return R.value}static get childTypes(){return F.value}get[t.typeNameSymbol](){return _}get[t.typeSchemaSymbol](){return j.constructorCached?.constructor}[Symbol.iterator](){return v(this)}get[Symbol.toStringTag](){return _}static get[t.privateDataSymbol](){return M??=(0,t.createTreeNodeSchemaPrivateData)(this,[S],L=>new l.MapNodeStoredSchema({kind:u.FieldKinds.optional.identifier,types:(0,t.convertAllowedTypes)(S,L),persistedMetadata:E},E))}}return j.constructorCached=void 0,j.identifier=_,j.info=S,j.implicitlyConstructable=w,j.metadata=O??{},j.persistedMetadata=E,j}FC.recordSchema=C;function*v(g){for(const[_,S]of Object.entries(g))yield[_,S]}function m(g){return(0,u.isTreeValue)(g)||Symbol.iterator in g?t.CompatibilityLevel.None:t.CompatibilityLevel.Normal}function h(g,_){if(!(typeof g=="object"&&g!==null))throw new n.UsageError(`Input data is incompatible with Record schema: ${g}`);const S=Object.entries(g);return(0,d.recordLikeDataToFlexContent)(S,_)}return FC}var rp={},iW;function Z0e(){if(iW)return rp;iW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(rp,"__esModule",{value:!0}),rp.isRecordNodeSchema=rp.RecordNodeSchema=void 0;const e=dr();rp.RecordNodeSchema={[Symbol.hasInstance](a){return n(a)}};function n(a){return a.kind===e.NodeKind.Record}return rp.isRecordNodeSchema=n,rp}var sW;function eSe(){return sW||(sW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.RecordNodeSchema=e.isRecordNodeSchema=e.recordSchema=void 0;var n=X0e();Object.defineProperty(e,"recordSchema",{enumerable:!0,get:function(){return n.recordSchema}});var a=Z0e();Object.defineProperty(e,"isRecordNodeSchema",{enumerable:!0,get:function(){return a.isRecordNodeSchema}}),Object.defineProperty(e,"RecordNodeSchema",{enumerable:!0,get:function(){return a.RecordNodeSchema}})})(cN)),cN}var aW;function Ko(){return aW||(aW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.recordSchema=e.RecordNodeSchema=e.isRecordNodeSchema=e.setField=e.objectSchema=e.ObjectNodeSchema=e.isObjectNodeSchema=e.mapSchema=e.MapNodeSchema=e.isMapNodeSchema=e.TreeArrayNode=e.IterableTreeArrayContent=e.isArrayNodeSchema=e.asIndex=e.arraySchema=e.ArrayNodeSchema=void 0;var n=K0e();Object.defineProperty(e,"ArrayNodeSchema",{enumerable:!0,get:function(){return n.ArrayNodeSchema}}),Object.defineProperty(e,"arraySchema",{enumerable:!0,get:function(){return n.arraySchema}}),Object.defineProperty(e,"asIndex",{enumerable:!0,get:function(){return n.asIndex}}),Object.defineProperty(e,"isArrayNodeSchema",{enumerable:!0,get:function(){return n.isArrayNodeSchema}}),Object.defineProperty(e,"IterableTreeArrayContent",{enumerable:!0,get:function(){return n.IterableTreeArrayContent}}),Object.defineProperty(e,"TreeArrayNode",{enumerable:!0,get:function(){return n.TreeArrayNode}});var a=W0e();Object.defineProperty(e,"isMapNodeSchema",{enumerable:!0,get:function(){return a.isMapNodeSchema}}),Object.defineProperty(e,"MapNodeSchema",{enumerable:!0,get:function(){return a.MapNodeSchema}}),Object.defineProperty(e,"mapSchema",{enumerable:!0,get:function(){return a.mapSchema}});var t=Y0e();Object.defineProperty(e,"isObjectNodeSchema",{enumerable:!0,get:function(){return t.isObjectNodeSchema}}),Object.defineProperty(e,"ObjectNodeSchema",{enumerable:!0,get:function(){return t.ObjectNodeSchema}}),Object.defineProperty(e,"objectSchema",{enumerable:!0,get:function(){return t.objectSchema}}),Object.defineProperty(e,"setField",{enumerable:!0,get:function(){return t.setField}});var i=eSe();Object.defineProperty(e,"isRecordNodeSchema",{enumerable:!0,get:function(){return i.isRecordNodeSchema}}),Object.defineProperty(e,"RecordNodeSchema",{enumerable:!0,get:function(){return i.RecordNodeSchema}}),Object.defineProperty(e,"recordSchema",{enumerable:!0,get:function(){return i.recordSchema}})})(iN)),iN}var oW;function wq(){if(oW)return Au;oW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Au,"__esModule",{value:!0}),Au.checkUnion=Au.TreeViewConfigurationAlpha=Au.TreeViewConfiguration=void 0;const e=Je(),n=Ot(),a=xi(),t=dr(),i=vl(),r=Ko(),s=Bt(),o=fb(),u={enableSchemaValidation:!1,preventAmbiguity:!1};class c{constructor(C){const v={...u,...C};this.schema=v.schema,this.enableSchemaValidation=v.enableSchemaValidation,this.preventAmbiguity=v.preventAmbiguity;const m=[];(0,i.toStoredSchema)(v.schema,i.restrictiveStoredSchemaGenerationOptions),(0,i.toStoredSchema)(v.schema,i.permissiveStoredSchemaGenerationOptions);const h=new Map;if((0,o.walkFieldSchema)(v.schema,{node:g=>{(0,t.markSchemaMostDerived)(g,!0),(0,e.debugAssert)(()=>!h.has(g.identifier)),h.set(g.identifier,g)},allowedTypes({types:g}){f(g.map(_=>(0,t.evaluateLazySchema)((0,t.isAnnotatedAllowedType)(_)?_.type:_)),v.preventAmbiguity,m)}}),this.definitionsInternal=h,m.length!==0){const g=new Set(m);throw new n.UsageError(`Ambiguous schema found:
${[...g].join(`
`)}`)}}}Au.TreeViewConfiguration=c;class d extends c{get definitions(){return this.definitionsInternal}constructor(C){super(C),this.root=(0,a.normalizeFieldSchema)(C.schema)}}Au.TreeViewConfigurationAlpha=d;function l(b){return`[${Array.from(b,C=>JSON.stringify(C.identifier)).join(", ")}]`}function f(b,C,v){const m=new Set,h=[],g=[],_=[],S=[],p=new Map;for(const O of b){if(m.has(O))throw new n.UsageError(`Duplicate schema in allowed types: ${O.identifier}`);switch(m.add(O),O.kind){case t.NodeKind.Leaf:break;case t.NodeKind.Object:{(0,e.assert)((0,r.isObjectNodeSchema)(O),3038),S.push(O);for(const E of O.fields.keys())(0,s.getOrCreate)(p,E,()=>new Set).add(O);break}case t.NodeKind.Array:{(0,e.assert)((0,r.isArrayNodeSchema)(O),3039),g.push(O);break}case t.NodeKind.Map:{(0,e.assert)((0,r.isMapNodeSchema)(O),3040),h.push(O);break}case t.NodeKind.Record:{(0,e.assert)((0,r.isRecordNodeSchema)(O),3041),_.push(O);break}default:(0,e.unreachableCase)(O.kind)}}if(!C)return;g.length>1&&v.push(`More than one kind of array allowed within union (${l(g)}). This would require type disambiguation which is not supported by arrays during import or export.`),h.length>1&&v.push(`More than one kind of map allowed within union (${l(h)}). This would require type disambiguation which is not supported by maps during import or export.`),_.length>1&&v.push(`More than one kind of record allowed within union (${l(_)}). This would require type disambiguation which is not supported by records during import or export.`),h.length>0&&g.length>0&&v.push(`Both a map and an array allowed within union (${l([...g,...h])}). Both can be implicitly constructed from iterables like arrays, which are ambiguous when the array is empty.`);const w=[];if(S.length>0&&w.push("objects"),h.length>0&&w.push("maps"),_.length>0&&w.push("records"),w.length>1){const O=w.length===2?`${w[0]??(0,e.oob)()} and ${w[1]??(0,e.oob)()}`:`${w.slice(0,-1).join(", ")}, and ${w[w.length-1]}`;v.push(`A combination of ${O} is allowed within union (${l([...S,...h,..._])}). These can be constructed from objects and can be ambiguous.`)}for(const O of S){const E=new Set(S);E.delete(O);for(const[F,R]of O.fields)if(R.kind===a.FieldKind.Required){const M=p.get(F)??(0,e.fail)(2869);for(const j of E)M.has(j)||E.delete(j)}E.size>0&&v.push(`The required fields of ${JSON.stringify(O.identifier)} are insufficient to differentiate it from the following types: ${l(E)}. For objects to be considered unambiguous, each must have required fields that do not all occur on any other object in the union.`)}}return Au.checkUnion=f,Au}var jC={},cW;function tSe(){if(cW)return jC;cW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(jC,"__esModule",{value:!0}),jC.asTreeViewAlpha=void 0;function e(n){return n}return jC.asTreeViewAlpha=e,jC}var uN={},uW;function Oq(){return uW||(uW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.schemaStatics=e.schemaStaticsStable=void 0;const n=xi(),a=Pc(),t=(0,n.getDefaultProvider)(()=>[]);function i(o,u){return(0,n.createFieldSchema)(n.FieldKind.Optional,o,{defaultProvider:t,...u})}function r(o,u){return(0,n.createFieldSchema)(n.FieldKind.Required,o,u)}e.schemaStaticsStable={string:a.stringSchema,number:a.numberSchema,boolean:a.booleanSchema,null:a.nullSchema,handle:a.handleSchema,leaves:[a.stringSchema,a.numberSchema,a.booleanSchema,a.nullSchema,a.handleSchema],optional:i,required:r,optionalRecursive:(o,u)=>s(n.FieldKind.Optional,o,{defaultProvider:t,...u}),requiredRecursive:(o,u)=>s(n.FieldKind.Required,o,u)},e.schemaStatics={...e.schemaStaticsStable,identifier:o=>(0,n.createFieldSchema)(n.FieldKind.Identifier,a.stringSchema,o)};function s(o,u,c){return(0,n.createFieldSchema)(o,u,c)}})(uN)),uN}var dN={},dW;function Pq(){return dW||(dW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.scoped=e.structuralName=e.SchemaFactory=e.defaultSchemaFactoryObjectOptions=e.schemaFromValue=void 0;const n=Je(),a=bn(),t=Ot(),i=Bt(),r=dr(),s=Pc(),o=Ko(),u=xi(),c=fl(),d=Sl(),l=Oq();function f(g){switch(typeof g){case"boolean":return s.booleanSchema;case"number":return s.numberSchema;case"string":return s.stringSchema;case"object":return g===null?s.nullSchema:((0,n.assert)((0,a.isFluidHandle)(g),2174),s.handleSchema);default:(0,n.unreachableCase)(g)}}e.schemaFromValue=f,e.defaultSchemaFactoryObjectOptions={allowUnknownOptionalFields:!1};const b=l.schemaStatics;class C{constructor(_){this.scope=_,this.structuralTypes=new Map,this.string=b.string,this.number=b.number,this.boolean=b.boolean,this.null=b.null,this.handle=b.handle,this.leaves=b.leaves,this.optional=b.optional,this.required=b.required,this.optionalRecursive=b.optionalRecursive,this.requiredRecursive=b.requiredRecursive}object(_,S){return(0,o.objectSchema)(m(this,_),S,!0,e.defaultSchemaFactoryObjectOptions.allowUnknownOptionalFields)}map(_,S){if(S===void 0){const w=_,O=v("Map",w);return this.getStructuralType(O,w,()=>this.namedMap(O,_,!1,!0))}return this.namedMap(_,S,!0,!0)}namedMap(_,S,p,w){return(0,o.mapSchema)(m(this,_),S,w,!p,void 0)}array(_,S){if(S===void 0){const w=_,O=v("Array",w);return this.getStructuralType(O,w,()=>this.namedArray(O,_,!1,!0))}return this.namedArray(_,S,!0,!0)}getStructuralType(_,S,p){const w=(0,i.getOrCreate)(this.structuralTypes,_,p),O=new Set((0,r.normalizeAllowedTypes)(S)),E=new Set((0,r.normalizeAllowedTypes)(w.info));if(!(0,i.compareSets)({a:O,b:E}))throw new t.UsageError(`Structurally named schema collision: two schema named "${_}" were defined with different input schema.`);return w}namedArray(_,S,p,w){return(0,o.arraySchema)(m(this,_),S,w,p)}get identifier(){const _=(0,u.getDefaultProvider)(S=>{const p=S==="UseGlobalContext"?h.decompress(h.generateCompressedId()):S.nodeKeyManager.stabilizeNodeIdentifier(S.nodeKeyManager.generateLocalNodeIdentifier());return[(0,d.unhydratedFlexTreeFromInsertable)(p,this.string)]});return(0,u.createFieldSchema)(u.FieldKind.Identifier,this.string,{defaultProvider:_})}objectRecursive(_,S){return this.object(_,S)}arrayRecursive(_,S){return this.namedArray(_,S,!0,!1)}mapRecursive(_,S){return this.namedMap(_,S,!0,!1)}}e.SchemaFactory=C,C.string=b.string,C.number=b.number,C.boolean=b.boolean,C.null=b.null,C.handle=b.handle,C.leaves=b.leaves,C.optional=b.optional,C.required=b.required,C.optionalRecursive=b.optionalRecursive,C.requiredRecursive=b.requiredRecursive;function v(g,_){let S;if((0,i.isReadonlyArray)(_)){const p=_.map(w=>((0,n.assert)(!(0,r.isLazy)(w),2109),(0,r.markSchemaMostDerived)(w),w.identifier));p.sort(),S=JSON.stringify(p)}else return v(g,[_]);return`${g}<${S}>`}e.structuralName=v;function m(g,_){return g.scope===void 0?`${_}`:`${g.scope}.${_}`}e.scoped=m;const h=(0,c.createIdCompressor)()})(dN)),dN}var MC={},lW;function noe(){if(lW)return MC;lW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(MC,"__esModule",{value:!0}),MC.SchemaFactoryBeta=void 0;const e=Pq();class n extends e.SchemaFactory{scopedFactory(t){return new n((0,e.scoped)(this,t))}}return MC.SchemaFactoryBeta=n,MC}var NC={},fW;function roe(){if(fW)return NC;fW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(NC,"__esModule",{value:!0}),NC.SchemaFactoryAlpha=void 0;const e=Ko(),n=Pq(),a=Oq(),t=dr(),i=noe(),r={staged:o=>{const u=(0,t.normalizeToAnnotatedAllowedType)(o);return{type:u.type,metadata:{...u.metadata,stagedSchemaUpgrade:(0,t.createSchemaUpgrade)()}}}};class s extends i.SchemaFactoryBeta{constructor(){super(...arguments),this.leaves=a.schemaStatics.leaves,this.optional=a.schemaStatics.optional,this.required=a.schemaStatics.required,this.optionalRecursive=a.schemaStatics.optionalRecursive,this.requiredRecursive=a.schemaStatics.requiredRecursive,this.staged=r.staged}objectAlpha(u,c,d){return(0,e.objectSchema)((0,n.scoped)(this,u),c,!0,d?.allowUnknownOptionalFields??n.defaultSchemaFactoryObjectOptions.allowUnknownOptionalFields,d?.metadata,d?.persistedMetadata)}objectRecursive(u,c,d){return this.objectAlpha(u,c,d)}mapAlpha(u,c,d){return(0,e.mapSchema)((0,n.scoped)(this,u),c,!0,!0,d?.metadata,d?.persistedMetadata)}mapRecursive(u,c,d){return this.mapAlpha(u,c,d)}arrayAlpha(u,c,d){return(0,e.arraySchema)((0,n.scoped)(this,u),c,!0,!0,d?.metadata,d?.persistedMetadata)}arrayRecursive(u,c,d){return this.arrayAlpha(u,c,d)}record(u,c){if(c===void 0){const l=u,f=(0,n.structuralName)("Record",l);return this.getStructuralType(f,l,()=>this.namedRecord(f,u,!1,!0))}return this.namedRecord(u,c,!0,!0)}namedRecord(u,c,d,l,f){return(0,e.recordSchema)({identifier:(0,n.scoped)(this,u),info:c,customizable:d,implicitlyConstructable:l,metadata:f?.metadata,persistedMetadata:f?.persistedMetadata})}recordAlpha(u,c,d){return(0,e.recordSchema)({identifier:(0,n.scoped)(this,u),info:c,customizable:!0,implicitlyConstructable:!0,metadata:d?.metadata,persistedMetadata:d?.persistedMetadata})}recordRecursive(u,c,d){return this.namedRecord(u,c,!0,!1,d)}scopedFactoryAlpha(u){return new s((0,n.scoped)(this,u))}}return NC.SchemaFactoryAlpha=s,s.leaves=a.schemaStatics.leaves,s.optional=a.schemaStatics.optional,s.required=a.schemaStatics.required,s.optionalRecursive=a.schemaStatics.optionalRecursive,s.requiredRecursive=a.schemaStatics.requiredRecursive,s.identifier=a.schemaStatics.identifier,s.staged=r.staged,NC}var AC={},hW;function nSe(){if(hW)return AC;hW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(AC,"__esModule",{value:!0}),AC.allowUnused=void 0;function e(n){}return AC.allowUnused=e,AC}var Fo={},mW;function rSe(){if(mW)return Fo;mW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Fo,"__esModule",{value:!0}),Fo.enumFromStrings=Fo.enumEntries=Fo.adaptEnum=Fo.singletonSchema=void 0;const e=Ot(),n=Je();function a(s,o){var u;class c extends s.object(o,{}){constructor(f){super(f??{})}get value(){return o}static toString(){return`SingletonSchema(${o})`}}return u=Symbol.toStringTag,c[u]=`SingletonSchema(${o})`,c}Fo.singletonSchema=a;function t(s,o){const u=Object.values(o),c=new Map(Object.entries(o).map(([b,C])=>[C,b]));if(c.size!==u.length)throw new e.UsageError("All members of enums must have distinct values.");const d=[],f=b=>new f[c.get(b)??(0,n.fail)(2865)];for(const[b,C]of i(o)){const v=a(s,C);d.push(v),Object.defineProperty(f,b,{enumerable:!0,configurable:!1,writable:!1,value:v})}return Object.defineProperty(f,"schema",{enumerable:!0,configurable:!1,writable:!1,value:d}),f}Fo.adaptEnum=t;function i(s){return Object.entries(s).filter(([o,u])=>typeof s[u]!="number"?!0:((0,n.assert)(typeof u=="string",3044),(0,n.assert)(Number.parseFloat(o).toString()===o,3045),!1))}Fo.enumEntries=i;function r(s,o){if(new Set(o).size!==o.length)throw new e.UsageError("All members of enums must have distinct names");const c=b=>new f[b],d=[],l=c,f=l;for(const b of o){const C=a(s,b);d.push(C),Object.defineProperty(l,b,{enumerable:!0,configurable:!1,writable:!1,value:C})}return Object.defineProperty(l,"schema",{enumerable:!0,configurable:!1,writable:!1,value:d}),l}return Fo.enumFromStrings=r,Fo}var lN={},pW;function Eq(){return pW||(pW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getPropertyKeyFromStoredKey=e.getStoredKey=e.getIdentifierFromNode=e.tryGetSchema=e.treeNodeApi=void 0;const n=Je(),a=Vt(),t=An(),i=Bt(),r=xi(),s=Pc(),o=bn(),u=Ot(),c=dr(),d=Ko(),l=wT();e.treeNodeApi={parent(m){const h=(0,c.getOrCreateInnerNode)(m).parentField.parent.parent;if(h===void 0)return;const g=(0,c.getOrCreateNodeFromInnerNode)(h);return(0,n.assert)(!(0,t.isTreeValue)(g),2175),g},key(m){const h=e.treeNodeApi.parent(m);if(h===void 0)return a.rootFieldKey;const g=C(m),_=e.treeNodeApi.schema(h);return v(_,g)},on(m,h,g){const _=(0,c.getKernel)(m);switch(h){case"nodeChanged":{const S=_.schema;return(0,d.isObjectNodeSchema)(S)?_.events.on("childrenChangedAfterBatch",({changedFields:p})=>{const w=new Set(Array.from(p,O=>S.storedKeyToPropertyKey.get(O)??(0,n.fail)(2870)));g({changedProperties:w})}):(0,d.isArrayNodeSchema)(S)?_.events.on("childrenChangedAfterBatch",()=>{g({changedProperties:void 0})}):_.events.on("childrenChangedAfterBatch",({changedFields:p})=>{g({changedProperties:p})})}case"treeChanged":return _.events.on("subtreeChangedAfterBatch",()=>g({}));default:throw new u.UsageError(`No event named ${JSON.stringify(h)}.`)}},status(m){return(0,c.getKernel)(m).getStatus()},is(m,h){const g=f(m);return g===void 0?!1:(0,c.normalizeAllowedTypes)(h).has(g)},schema(m){return f(m)??(0,n.fail)(2871)},shortId(m){return b(m,"preferCompressed")}};function f(m){switch(typeof m){case"string":return s.stringSchema;case"number":return s.numberSchema;case"boolean":return s.booleanSchema;case"object":{if((0,c.isTreeNode)(m))return(0,c.tryGetTreeNodeSchema)(m);if(m===null)return s.nullSchema;if((0,o.isFluidHandle)(m))return s.handleSchema}default:return}}e.tryGetSchema=f;function b(m,h){const g=m[c.typeSchemaSymbol];if(!(0,d.isObjectNodeSchema)(g))return;const _=(0,c.getOrCreateInnerNode)(m),S=g.identifierFieldKeys;switch(S.length){case 0:return;case 1:{const p=S[0]??(0,n.oob)(),w=_.tryGetField(p);(0,n.assert)(w!==void 0,2997);const O=(0,l.tryGetTreeNodeForField)(w);(0,n.assert)(typeof O=="string",2998);const E=_.context;switch(h){case"preferCompressed":if(E.isHydrated()){const F=E.nodeKeyManager.tryLocalizeNodeIdentifier(O);return F!==void 0?(0,i.extractFromOpaque)(F):O}else return O;case"compressed":if(E.isHydrated()){const F=E.nodeKeyManager.tryLocalizeNodeIdentifier(O);return F!==void 0?(0,i.extractFromOpaque)(F):void 0}else return;case"uncompressed":return O;default:(0,n.unreachableCase)(h)}}default:throw new u.UsageError("shortId() may not be called on a node with more than one identifier. Consider converting extraneous identifier fields to string fields.")}}e.getIdentifierFromNode=b;function C(m){const h=(0,c.getOrCreateInnerNode)(m).parentField;return h.parent.schema===t.FieldKinds.sequence.identifier?((0,n.assert)(h.parent.key===a.EmptyKey,2600),h.index):((0,n.assert)(h.index===0,2601),h.parent.key)}e.getStoredKey=C;function v(m,h){if(m.kind!==c.NodeKind.Object)return h;const g=m.info;for(const[_,S]of Object.entries(g))if(S instanceof r.FieldSchema&&S.props?.key===h)return _;return g[h]===void 0&&(0,n.fail)(2872),h}e.getPropertyKeyFromStoredKey=v})(lN)),lN}var ip={},Ns={},gW;function hb(){if(gW)return Ns;gW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.unknownTypeError=Ns.replaceHandles=Ns.tryStoredSchemaAsArray=Ns.customFromCursorStored=Ns.customFromCursor=Ns.KeyEncodingOptions=void 0;const e=Je(),n=bn(),a=Ot(),t=Vt(),i=An(),r=Bt(),s=Pc(),o=Ko();var u;(function(v){v.usePropertyKeys="usePropertyKeys",v.allStoredKeys="allStoredKeys",v.knownStoredKeys="knownStoredKeys"})(u||(Ns.KeyEncodingOptions=u={}));function c(v,m,h,g,_){const S=v.type;switch(S){case s.numberSchema.identifier:case s.booleanSchema.identifier:case s.nullSchema.identifier:case s.stringSchema.identifier:return(0,e.assert)(v.value!==void 0,2640),(0,e.assert)(!(0,n.isFluidHandle)(v.value),2641),v.value;case s.handleSchema.identifier:return(0,e.assert)(v.value!==void 0,2642),(0,e.assert)((0,n.isFluidHandle)(v.value),2643),v.value;default:{(0,e.assert)(v.value===void 0,2644);const p=h.get(S)??(0,e.fail)(2862);if(f(p)!==void 0)return(0,t.inCursorField)(v,t.EmptyKey,()=>(0,t.mapCursorField)(v,()=>_(v,m,h,g)));{const O={};return(0,t.forEachField)(v,()=>{(0,e.assert)(v.getFieldLength()===1,2585);const E=v.getFieldKey(),F=d(m.keys,S,E,g);F!==void 0&&(v.enterNode(0),O[F]=_(v,m,h,g),v.exitNode())}),O}}}}Ns.customFromCursor=c;function d(v,m,h,g){switch(v){case u.allStoredKeys:return h;case u.usePropertyKeys:case u.knownStoredKeys:{const _=g.get(m)??(0,e.fail)(3071);if((0,o.isObjectNodeSchema)(_)){const S=_.storedKeyToPropertyKey.get(h);if(S===void 0){(0,e.assert)(_.allowUnknownOptionalFields,3072);return}else return v===u.usePropertyKeys?S:h}else return h}default:(0,e.unreachableCase)(v)}}function l(v,m,h){const g=v.type,_=m.get(g)??(0,e.fail)(2864);if(_ instanceof t.LeafNodeStoredSchema)return(0,e.assert)((0,i.valueSchemaAllows)(_.leafValue,v.value),2716),v.value;if((0,e.assert)(v.value===void 0,2717),f(_)!==void 0)return(0,t.inCursorField)(v,t.EmptyKey,()=>(0,t.mapCursorField)(v,()=>h(v,m)));const p={};return(0,t.forEachField)(v,()=>{const w=(0,t.mapCursorField)(v,()=>h(v,m));if(w.length===1){const O=v.getFieldKey();p[O]=w[0]}else(0,e.assert)(w.length===0,2718)}),p}Ns.customFromCursorStored=l;function f(v){if(v instanceof t.ObjectNodeStoredSchema){const m=v.getFieldSchema(t.EmptyKey);if(m.kind===i.FieldKinds.sequence.identifier)return(0,e.assert)(v.objectNodeFields.size===1,2719),m.types}}Ns.tryStoredSchemaAsArray=f;function b(v,m){return(0,r.cloneWithReplacements)(v,"",(h,g)=>(0,n.isFluidHandle)(g)?{clone:!1,value:m(g)}:{clone:!0,value:g})}Ns.replaceHandles=b;function C(v){throw new a.UsageError(`Failed to parse tree due to occurrence of type ${JSON.stringify(v)} which is not defined in this context.`)}return Ns.unknownTypeError=C,Ns}var yW;function ioe(){if(yW)return ip;yW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ip,"__esModule",{value:!0}),ip.unhydratedFlexTreeFromCursor=ip.createFromCursor=void 0;const e=Je(),n=Ot(),a=Vt(),t=dr(),i=An(),r=Oc(),s=hb();function o(c,d,l,f){const b=f??(0,r.getUnhydratedContext)(c);(0,e.assert)(b.flexContext.isHydrated()===!1,3070);const C=d===void 0?[]:[u(b,d)],v={policy:i.defaultSchemaPolicy,schema:b.flexContext.schema};if((0,i.isFieldInSchema)(C,l,v,i.throwOutOfSchema),C.length===0)return;(0,e.assert)(C.length===1,2577);const m=C[0];return(0,t.getOrCreateNodeFromInnerNode)(m)}ip.createFromCursor=o;function u(c,d){(0,e.assert)(d.mode===0,2996);const l=d.type,f=c.flexContext.schema.nodeSchema.get(l)??(0,s.unknownTypeError)(l),b=new Map((0,a.mapCursorFields)(d,()=>{const C=f.getFieldSchema(d.getFieldKey());if(C.kind===a.forbiddenFieldKindIdentifier)throw new n.UsageError(`Field ${JSON.stringify(d.getFieldKey())} is not defined in the schema ${JSON.stringify(l)}.`);return[d.getFieldKey(),(0,t.createField)(c.flexContext,C.kind,d.getFieldKey(),(0,a.mapCursorField)(d,()=>u(c,d)))]}));return new t.UnhydratedFlexTreeNode({type:d.type,value:d.value},b,c)}return ip.unhydratedFlexTreeFromCursor=u,ip}var DC={},sp={},bW;function iSe(){if(bW)return sp;bW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(sp,"__esModule",{value:!0}),sp.convertObjectNodeSchema=sp.toJsonSchema=void 0;const e=Je(),n=Ot(),a=Vt(),t=Bt(),i=xi(),r=dr(),s=Ko(),o=Pc(),u=hb();function c(g,_){const S=d(g.definitions,_),p=[];for(const w of g.root.allowedTypesIdentifiers)p.push(m(w));return(0,t.hasSingle)(p)?{...p[0],$defs:S}:{$defs:S,anyOf:p}}sp.toJsonSchema=c;function d(g,_){const S={};for(const[p,w]of g)S[p]=l(w,_);return S}function l(g,_){if(g instanceof s.ArrayNodeSchema)return f(g);if((0,s.isMapNodeSchema)(g)||(0,s.isRecordNodeSchema)(g))return v(g);if(g instanceof s.ObjectNodeSchema)return C(g,_);if(g instanceof o.LeafNodeSchema)return b(g);throw new TypeError(`Unknown node schema kind: ${g.kind}`)}function f(g){const _=[];g.allowedTypesIdentifiers.forEach(w=>{_.push(m(w))});const S=(0,t.hasSingle)(_)?_[0]:{anyOf:_},p={type:"array",_treeNodeSchemaKind:r.NodeKind.Array,items:S};return(0,t.copyProperty)(g.metadata,"description",p),p}function b(g){let _;switch(g.leafKind){case a.ValueSchema.String:_="string";break;case a.ValueSchema.Number:_="number";break;case a.ValueSchema.Boolean:_="boolean";break;case a.ValueSchema.Null:_="null";break;case a.ValueSchema.FluidHandle:throw new n.UsageError("Fluid handles are not supported via JSON Schema.");default:(0,e.unreachableCase)(g.leafKind)}return{type:_,_treeNodeSchemaKind:r.NodeKind.Leaf}}function C(g,_){const S={},p=[];for(const[O,E]of g.fields){const F=_.keys===u.KeyEncodingOptions.usePropertyKeys?O:E.storedKey,R=[];for(const j of E.allowedTypesIdentifiers)R.push(m(j));const M=(0,t.hasSingle)(R)?R[0]:{anyOf:R};(0,t.copyProperty)(E.metadata,"description",M),S[F]=M,E.kind!==i.FieldKind.Optional&&(_.requireFieldsWithDefaults||E.props?.defaultProvider===void 0)&&p.push(F)}const w={type:"object",_treeNodeSchemaKind:r.NodeKind.Object,properties:S,required:p,additionalProperties:!1};return(0,t.copyProperty)(g.metadata,"description",w),w}sp.convertObjectNodeSchema=C;function v(g){const _=[];g.allowedTypesIdentifiers.forEach(p=>{_.push(m(p))});const S={type:"object",_treeNodeSchemaKind:g.kind,patternProperties:{"^.*$":(0,t.hasSingle)(_)?_[0]:{anyOf:_}}};return(0,t.copyProperty)(g.metadata,"description",S),S}function m(g){return{$ref:h(g)}}function h(g){return`#/$defs/${g}`}return sp}var vW;function sSe(){if(vW)return DC;vW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(DC,"__esModule",{value:!0}),DC.getJsonSchema=void 0;const e=iSe(),n=wq();function a(t,i){const r=new n.TreeViewConfigurationAlpha({schema:t});return(0,e.toJsonSchema)(r,i)}return DC.getJsonSchema=a,DC}var kC={},xC={},SW;function soe(){if(SW)return xC;SW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(xC,"__esModule",{value:!0}),xC.toSimpleTreeSchema=void 0;const e=Je(),n=xi(),a=dr(),t=Ko(),i=fb(),r=Pc();function s(l,f){const b=(0,n.normalizeFieldSchema)(l),C=new Map;return(0,i.walkFieldSchema)(b,{node:v=>{(0,e.assert)(v instanceof t.ArrayNodeSchema||v instanceof t.MapNodeSchema||v instanceof r.LeafNodeSchema||v instanceof t.ObjectNodeSchema||v instanceof t.RecordNodeSchema,2912);const m=f?o(v):v;C.set(v.identifier,m)}}),{root:f?{allowedTypesIdentifiers:b.allowedTypesIdentifiers,kind:b.kind,metadata:b.metadata,persistedMetadata:b.persistedMetadata}:b,definitions:C}}xC.toSimpleTreeSchema=s;function o(l){const f=l.kind;switch(f){case a.NodeKind.Leaf:return u(l);case a.NodeKind.Array:case a.NodeKind.Map:case a.NodeKind.Record:return c(l);case a.NodeKind.Object:return d(l);default:(0,e.unreachableCase)(f)}}function u(l){return{kind:a.NodeKind.Leaf,leafKind:l.leafKind,metadata:l.metadata,persistedMetadata:l.persistedMetadata}}function c(l){return{kind:l.kind,allowedTypesIdentifiers:l.allowedTypesIdentifiers,metadata:l.metadata,persistedMetadata:l.persistedMetadata}}function d(l){const f=new Map;for(const[b,C]of l.fields)f.set(b,{kind:C.kind,allowedTypesIdentifiers:C.allowedTypesIdentifiers,metadata:C.metadata,persistedMetadata:C.persistedMetadata,storedKey:C.storedKey});return{kind:a.NodeKind.Object,fields:f,metadata:l.metadata,persistedMetadata:l.persistedMetadata}}return xC}var CW;function aSe(){if(CW)return kC;CW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(kC,"__esModule",{value:!0}),kC.getSimpleSchema=void 0;const e=soe();function n(a){return(0,e.toSimpleTreeSchema)(a,!0)}return kC.getSimpleSchema=n,kC}var qC={},ap={},_W;function oSe(){if(_W)return ap;_W=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ap,"__esModule",{value:!0}),ap.findExtraAllowedTypes=ap.getDiscrepanciesInAllowedContent=void 0;const e=Je(),n=Vt(),a=Bt(),t=dr(),i=Ko(),r=vl(),s=xi(),o=Pc(),u=hb(),c=An();function d(g){if(g instanceof n.ObjectNodeStoredSchema)return n.ObjectNodeStoredSchema;if(g instanceof n.MapNodeStoredSchema)return n.MapNodeStoredSchema;if(g instanceof n.LeafNodeStoredSchema)return n.LeafNodeStoredSchema;(0,e.fail)(3048)}function l(g,_){switch(g){case t.NodeKind.Leaf:return _===n.LeafNodeStoredSchema;case t.NodeKind.Array:case t.NodeKind.Object:return _===n.ObjectNodeStoredSchema;case t.NodeKind.Map:case t.NodeKind.Record:return _===n.MapNodeStoredSchema;default:(0,e.unreachableCase)(g)}}function*f(g,_){yield*v(g.root,_.rootFieldSchema,void 0,void 0);for(const[S,p]of _.nodeSchema){const w=g.definitions.get(S);w!==void 0&&(yield*b(S,w,p))}}ap.getDiscrepanciesInAllowedContent=f;function*b(g,_,S){if(!l(_.kind,d(S))){yield{identifier:g,mismatch:"nodeKind",view:_.kind,stored:d(S)};return}switch(_.kind){case t.NodeKind.Object:{(0,e.assert)((0,i.isObjectNodeSchema)(_),3049),yield*h(g,_,S);break}case t.NodeKind.Array:{(0,e.assert)((0,i.isArrayNodeSchema)(_),3050);const p=(0,u.tryStoredSchemaAsArray)(S);if(p===void 0){yield{identifier:g,mismatch:"nodeKind",view:t.NodeKind.Array,stored:d(S)};return}yield*m((0,t.normalizeAnnotatedAllowedTypes)(_.info).types,p,(0,a.brand)(_.identifier),n.EmptyKey);break}case t.NodeKind.Map:{(0,e.assert)((0,i.isMapNodeSchema)(_),3051),yield*v((0,s.createFieldSchema)(s.FieldKind.Optional,_.info),S.mapFields,g,void 0);break}case t.NodeKind.Record:{(0,e.assert)((0,i.isRecordNodeSchema)(_),3052),yield*v((0,s.createFieldSchema)(s.FieldKind.Optional,_.info),S.mapFields,g,void 0);break}case t.NodeKind.Leaf:{(0,e.assert)(_ instanceof o.LeafNodeSchema,3053);const p=_.leafKind,w=S.leafValue;p!==w&&(yield{identifier:g,mismatch:"valueSchema",view:p,stored:w});break}}}function C(g,_){const S=new Set(g.map(O=>O.type.identifier)),p=g.filter(O=>!_.has((0,a.brand)(O.type.identifier))&&O.metadata.stagedSchemaUpgrade===void 0),w=[..._].filter(O=>!S.has(O));return{view:p,stored:w}}ap.findExtraAllowedTypes=C;function*v(g,_,S,p){(0,e.assert)(g instanceof s.FieldSchemaAlpha,3054),yield*m(g.annotatedAllowedTypesNormalized.types,_.types,S,p);const w=r.convertFieldKind.get(g.kind)??(0,e.fail)(3055);w.identifier!==_.kind&&(yield{identifier:S,fieldKey:p,mismatch:"fieldKind",view:w.identifier,stored:_.kind})}function*m(g,_,S,p){const w=C(g,_);(w.view.length>0||w.stored.length>0)&&(yield{...w,identifier:S,fieldKey:p,mismatch:"allowedTypes"})}function*h(g,_,S){const p=new Set;for(const[w,{storedKey:O,schema:E}]of _.flexKeyMap){const F=S.objectNodeFields.get(O);if(p.add(O),F===void 0){const R=r.convertFieldKind.get(E.kind)??(0,e.fail)(3056);yield{identifier:g,fieldKey:O,mismatch:"fieldKind",view:R.identifier,stored:n.storedEmptyFieldSchema.kind}}else yield*v(E,F,g,O)}for(const[w,O]of S.objectNodeFields)O.kind!==n.forbiddenFieldKindIdentifier&&(p.has(w)||(!_.allowUnknownOptionalFields||O.kind!==c.FieldKinds.optional.identifier)&&(yield{identifier:g,fieldKey:w,mismatch:"fieldKind",view:n.storedEmptyFieldSchema.kind,stored:O.kind}))}return ap}var TW;function aoe(){if(TW)return qC;TW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qC,"__esModule",{value:!0}),qC.SchemaCompatibilityTester=void 0;const e=An(),n=oSe(),a=vl();class t{constructor(r){this.viewSchema=r}checkCompatibility(r){const s=e.defaultSchemaPolicy;let o=!0;for(const l of(0,n.getDiscrepanciesInAllowedContent)(this.viewSchema,r)){o=!1;break}const u=(0,a.toUpgradeSchema)(this.viewSchema.root),c=(0,e.allowsRepoSuperset)(s,r,u),d=o&&c&&(0,e.allowsRepoSuperset)(s,u,r);return{canView:o,canUpgrade:c,isEquivalent:d}}}return qC.SchemaCompatibilityTester=t,qC}var Oa={},wW;function cSe(){if(wW)return Oa;wW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.replaceVerboseTreeHandles=Oa.verboseFromCursor=Oa.fieldCursorFromVerbose=Oa.cursorFromVerbose=Oa.applySchemaToParserOptions=void 0;const e=bn(),n=Je(),a=Ot(),t=Vt(),i=Bt(),r=An(),s=Pc(),o=Ko(),u=hb(),c=Oc();function d(h,g){const _={keys:u.KeyEncodingOptions.usePropertyKeys,...g},S=(0,c.getUnhydratedContext)(h);return{keyConverter:_.keys!==u.KeyEncodingOptions.usePropertyKeys?void 0:{encode:(p,w)=>{const O=S.schema.get((0,i.brand)(p))??(0,n.fail)(2873);if((0,o.isObjectNodeSchema)(O)){const E=O.storedKeyToPropertyKey.get(w);if(E!==void 0)return E;const F="arbitrary unused key: fe71614a-bf3e-43b3-b7b0-4cef39538e90";return(0,n.assert)(!O.storedKeyToPropertyKey.has((0,i.brand)(F)),2579),F}return w},parse:(p,w)=>{const O=S.schema.get((0,i.brand)(p))??(0,u.unknownTypeError)(p);if((0,o.isObjectNodeSchema)(O)){const E=O.flexKeyMap.get(w);if(E===void 0)throw new a.UsageError(`Failed to parse VerboseTree due to unexpected key ${JSON.stringify(w)} on type ${JSON.stringify(p)}.`);return E.storedKey}return(0,i.brand)(w)}}}}Oa.applySchemaToParserOptions=d;function l(h,g){return(0,r.stackTreeNodeCursor)(b(g),h)}Oa.cursorFromVerbose=l;function f(h,g){return(0,r.stackTreeFieldCursor)(b(g),{type:t.aboveRootPlaceholder,fields:h},(0,t.keyAsDetachedField)(t.EmptyKey))}Oa.fieldCursorFromVerbose=f;function b(h){return{value:g=>(0,r.isTreeValue)(g)?g:void 0,type:g=>{switch(typeof g){case"number":return(0,i.brand)(s.numberSchema.identifier);case"string":return(0,i.brand)(s.stringSchema.identifier);case"boolean":return(0,i.brand)(s.booleanSchema.identifier);default:return g===null?(0,i.brand)(s.nullSchema.identifier):(0,e.isFluidHandle)(g)?(0,i.brand)(s.handleSchema.identifier):(0,i.brand)(g.type)}},keysFromNode:g=>{switch(typeof g){case"object":{if(g===null)return[];if((0,e.isFluidHandle)(g))return[];if(Array.isArray(g.fields))return g.fields.length===0?[]:[t.EmptyKey];const _=Object.keys(g.fields),S=h.keyConverter;return S===void 0?_:_.map(p=>S.parse(g.type,p))}default:return[]}},getFieldFromNode:(g,_)=>{if(typeof g!="object")return[];if(g===null)return[];if((0,e.isFluidHandle)(g))return[];if(Array.isArray(g.fields))return _===t.EmptyKey?g.fields:[];const S=h.keyConverter===void 0?_:h.keyConverter.encode(g.type,_);if(Object.prototype.hasOwnProperty.call(g.fields,S)){const p=g.fields[S];return p===void 0?[]:[p]}return[]}}}function C(h,g,_){const S={keys:u.KeyEncodingOptions.usePropertyKeys,..._},p=g.flexContext.schema.nodeSchema,w=g.schema;return v(h,S,p,w)}Oa.verboseFromCursor=C;function v(h,g,_,S){const p=(0,u.customFromCursor)(h,g,_,S,v);return(_.get(h.type)??(0,n.fail)(2876))instanceof t.LeafNodeStoredSchema?p:{type:h.type,fields:p}}function m(h,g){return(0,u.replaceHandles)(h,g)}return Oa.replaceVerboseTreeHandles=m,Oa}var op={},OW;function uSe(){if(OW)return op;OW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(op,"__esModule",{value:!0}),op.replaceConciseTreeHandles=op.conciseFromCursor=void 0;const e=hb();function n(i,r,s){const o={keys:e.KeyEncodingOptions.usePropertyKeys,...s},u=r.flexContext.schema.nodeSchema,c=r.schema;return a(i,o,u,c)}op.conciseFromCursor=n;function a(i,r,s,o){return(0,e.customFromCursor)(i,r,s,o,a)}function t(i,r){return(0,e.replaceHandles)(i,r)}return op.replaceConciseTreeHandles=t,op}var LC={},PW;function dSe(){if(PW)return LC;PW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(LC,"__esModule",{value:!0}),LC.TreeBeta=void 0;const e=An(),n=Bt(),a=dr(),t=Oc(),i=ioe(),r=Eq();return LC.TreeBeta={on(s,o,u){return r.treeNodeApi.on(s,o,u)},clone(s){if(!(0,a.isTreeNode)(s))return s;const o=(0,a.getKernel)(s),u=o.getOrCreateInnerNode().borrowCursor(),c=new a.UnhydratedContext(e.defaultSchemaPolicy,o.context.flexContext.schema),d=new a.Context(c,(0,t.getUnhydratedContext)(o.schema).schema),l={kind:e.FieldKinds.required.identifier,types:new Set([(0,n.brand)(o.schema.identifier)]),persistedMetadata:void 0};return(0,i.createFromCursor)(o.schema,u,l,d)}},LC}var BC={},EW;function ooe(){if(EW)return BC;EW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(BC,"__esModule",{value:!0}),BC.createSimpleTreeIndex=void 0;const e=Je(),n=An(),a=Bt(),t=dr(),i=Eq(),r=fb();function s(u,c,d,l,f){const b=new Map;if(f!==void 0)for(const m of f)b.set(m.identifier,m);else(0,r.walkFieldSchema)(u.schema,{node:m=>b.set(m.identifier,m)});const C=f===void 0?m=>{const h=b.get(m);if(h!==void 0){const g=typeof c=="function"?c(h):c.get(h);if(g!==void 0)return o((0,a.brand)(g),l)}else(0,e.fail)(2866)}:m=>{const h=b.get(m);if(h!==void 0){const g=typeof c=="function"?c(h):c.get(h);if(g!==void 0)return o((0,a.brand)(g),l)}};return new n.AnchorTreeIndex(u.checkout.forest,C,m=>{const h=[];for(const g of m){const _=(0,t.treeNodeFromAnchor)(g);(0,n.isTreeValue)(_)||h.push(_)}if((0,n.hasElement)(h))return d(h)},m=>{const h=(0,t.treeNodeFromAnchor)(m);if(!(0,n.isTreeValue)(h))return i.treeNodeApi.status(h)},!0)}BC.createSimpleTreeIndex=s;function o(u,c){return d=>{d.enterField(u),d.firstNode();const l=d.value;return d.exitNode(),d.exitField(),l===void 0&&(0,e.fail)(2867),c(l)||(0,e.fail)(2868),l}}return BC}var UC={},IW;function lSe(){if(IW)return UC;IW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(UC,"__esModule",{value:!0}),UC.createIdentifierIndex=void 0;const e=Ot(),n=xi(),a=Ko(),t=fb(),i=ooe();function r(o){return typeof o=="string"}function s(o){const u=new Map;return(0,t.walkFieldSchema)(o.schema,{node:c=>{if(c instanceof a.ObjectNodeSchema){for(const[d,l]of c.fields.entries())if(l.kind===n.FieldKind.Identifier){u.set(c.identifier,d);break}}}}),(0,i.createSimpleTreeIndex)(o,c=>u.get(c.identifier),c=>{if(c.length>1)throw new e.UsageError("cannot retrieve node from index: there are multiple nodes with the same identifier");return c[0]},r)}return UC.createIdentifierIndex=s,UC}var cp={},RW;function fSe(){if(RW)return cp;RW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(cp,"__esModule",{value:!0}),cp.comparePersistedSchema=cp.extractPersistedSchema=void 0;const e=Vt(),n=An(),a=Sq(),t=xi(),i=vl(),r=wq(),s=aoe();function o(c,d,l){const f=(0,i.toStoredSchema)(c,{includeStaged:l}),b=(0,a.clientVersionToSchemaVersion)(d);return(0,n.encodeTreeSchema)(f,b)}cp.extractPersistedSchema=o;function u(c,d,l){const b=(0,n.makeSchemaCodec)(l,e.SchemaVersion.v1).decode(c),C=new r.TreeViewConfigurationAlpha({schema:(0,t.normalizeFieldSchema)(d)});return new s.SchemaCompatibilityTester(C).checkCompatibility(b)}return cp.comparePersistedSchema=u,cp}var zC={},FW;function hSe(){if(FW)return zC;FW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(zC,"__esModule",{value:!0}),zC.rollback=void 0,zC.rollback=Symbol("SharedTree Transaction Rollback"),zC}var VC={},jW;function mSe(){if(jW)return VC;jW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(VC,"__esModule",{value:!0}),VC.generateSchemaFromSimpleSchema=void 0;const e=Je(),n=dr(),a=xi(),t=roe(),i=new t.SchemaFactoryAlpha(void 0);function r(c){const d=new Map([...c.definitions].map(([b,C])=>[b,()=>u(b,C,d)])),l=s(c.root,d,void 0),f=new Map;for(const[b,C]of d)f.set(b,C());return{root:l,definitions:f}}VC.generateSchemaFromSimpleSchema=r;function s(c,d,l){const f=o(c.allowedTypesIdentifiers,d),b={metadata:c.metadata,key:l};switch(c.kind){case a.FieldKind.Identifier:return t.SchemaFactoryAlpha.identifier(b);case a.FieldKind.Optional:return t.SchemaFactoryAlpha.optional(f,b);case a.FieldKind.Required:return t.SchemaFactoryAlpha.required(f,b);default:return(0,e.unreachableCase)(c.kind)}}function o(c,d){return[...c].map(l=>d.get(l)??(0,e.fail)(2906))}function u(c,d,l){switch(d.kind){case n.NodeKind.Object:{const f={};for(const[b,C]of d.fields)f[b]=s(C,l,C.storedKey);return i.objectAlpha(c,f,{metadata:d.metadata})}case n.NodeKind.Array:return i.arrayAlpha(c,o(d.allowedTypesIdentifiers,l),{metadata:d.metadata});case n.NodeKind.Map:return i.mapAlpha(c,o(d.allowedTypesIdentifiers,l),{metadata:d.metadata});case n.NodeKind.Record:return i.recordAlpha(c,o(d.allowedTypesIdentifiers,l),{metadata:d.metadata});case n.NodeKind.Leaf:return t.SchemaFactoryAlpha.leaves.find(f=>f.identifier===c)??(0,e.fail)(2907);default:return(0,e.unreachableCase)(d)}}return VC}var MW;function pSe(){return MW||(MW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.toSimpleTreeSchema=e.generateSchemaFromSimpleSchema=e.rollback=e.comparePersistedSchema=e.extractPersistedSchema=e.createIdentifierIndex=e.createSimpleTreeIndex=e.TreeBeta=e.replaceConciseTreeHandles=e.conciseFromCursor=e.KeyEncodingOptions=e.replaceHandles=e.tryStoredSchemaAsArray=e.customFromCursorStored=e.replaceVerboseTreeHandles=e.verboseFromCursor=e.cursorFromVerbose=e.applySchemaToParserOptions=e.SchemaCompatibilityTester=e.getSimpleSchema=e.getJsonSchema=e.createFromCursor=e.tryGetSchema=e.treeNodeApi=e.getStoredKey=e.getPropertyKeyFromStoredKey=e.getIdentifierFromNode=e.singletonSchema=e.enumFromStrings=e.adaptEnum=e.allowUnused=e.SchemaFactoryAlpha=e.SchemaFactoryBeta=e.SchemaFactory=e.schemaStatics=e.asTreeViewAlpha=e.TreeViewConfigurationAlpha=e.TreeViewConfiguration=void 0;var n=wq();Object.defineProperty(e,"TreeViewConfiguration",{enumerable:!0,get:function(){return n.TreeViewConfiguration}}),Object.defineProperty(e,"TreeViewConfigurationAlpha",{enumerable:!0,get:function(){return n.TreeViewConfigurationAlpha}});var a=tSe();Object.defineProperty(e,"asTreeViewAlpha",{enumerable:!0,get:function(){return a.asTreeViewAlpha}});var t=Oq();Object.defineProperty(e,"schemaStatics",{enumerable:!0,get:function(){return t.schemaStatics}});var i=Pq();Object.defineProperty(e,"SchemaFactory",{enumerable:!0,get:function(){return i.SchemaFactory}});var r=noe();Object.defineProperty(e,"SchemaFactoryBeta",{enumerable:!0,get:function(){return r.SchemaFactoryBeta}});var s=roe();Object.defineProperty(e,"SchemaFactoryAlpha",{enumerable:!0,get:function(){return s.SchemaFactoryAlpha}});var o=nSe();Object.defineProperty(e,"allowUnused",{enumerable:!0,get:function(){return o.allowUnused}});var u=rSe();Object.defineProperty(e,"adaptEnum",{enumerable:!0,get:function(){return u.adaptEnum}}),Object.defineProperty(e,"enumFromStrings",{enumerable:!0,get:function(){return u.enumFromStrings}}),Object.defineProperty(e,"singletonSchema",{enumerable:!0,get:function(){return u.singletonSchema}});var c=Eq();Object.defineProperty(e,"getIdentifierFromNode",{enumerable:!0,get:function(){return c.getIdentifierFromNode}}),Object.defineProperty(e,"getPropertyKeyFromStoredKey",{enumerable:!0,get:function(){return c.getPropertyKeyFromStoredKey}}),Object.defineProperty(e,"getStoredKey",{enumerable:!0,get:function(){return c.getStoredKey}}),Object.defineProperty(e,"treeNodeApi",{enumerable:!0,get:function(){return c.treeNodeApi}}),Object.defineProperty(e,"tryGetSchema",{enumerable:!0,get:function(){return c.tryGetSchema}});var d=ioe();Object.defineProperty(e,"createFromCursor",{enumerable:!0,get:function(){return d.createFromCursor}});var l=sSe();Object.defineProperty(e,"getJsonSchema",{enumerable:!0,get:function(){return l.getJsonSchema}});var f=aSe();Object.defineProperty(e,"getSimpleSchema",{enumerable:!0,get:function(){return f.getSimpleSchema}});var b=aoe();Object.defineProperty(e,"SchemaCompatibilityTester",{enumerable:!0,get:function(){return b.SchemaCompatibilityTester}});var C=cSe();Object.defineProperty(e,"applySchemaToParserOptions",{enumerable:!0,get:function(){return C.applySchemaToParserOptions}}),Object.defineProperty(e,"cursorFromVerbose",{enumerable:!0,get:function(){return C.cursorFromVerbose}}),Object.defineProperty(e,"verboseFromCursor",{enumerable:!0,get:function(){return C.verboseFromCursor}}),Object.defineProperty(e,"replaceVerboseTreeHandles",{enumerable:!0,get:function(){return C.replaceVerboseTreeHandles}});var v=hb();Object.defineProperty(e,"customFromCursorStored",{enumerable:!0,get:function(){return v.customFromCursorStored}}),Object.defineProperty(e,"tryStoredSchemaAsArray",{enumerable:!0,get:function(){return v.tryStoredSchemaAsArray}}),Object.defineProperty(e,"replaceHandles",{enumerable:!0,get:function(){return v.replaceHandles}}),Object.defineProperty(e,"KeyEncodingOptions",{enumerable:!0,get:function(){return v.KeyEncodingOptions}});var m=uSe();Object.defineProperty(e,"conciseFromCursor",{enumerable:!0,get:function(){return m.conciseFromCursor}}),Object.defineProperty(e,"replaceConciseTreeHandles",{enumerable:!0,get:function(){return m.replaceConciseTreeHandles}});var h=dSe();Object.defineProperty(e,"TreeBeta",{enumerable:!0,get:function(){return h.TreeBeta}});var g=ooe();Object.defineProperty(e,"createSimpleTreeIndex",{enumerable:!0,get:function(){return g.createSimpleTreeIndex}});var _=lSe();Object.defineProperty(e,"createIdentifierIndex",{enumerable:!0,get:function(){return _.createIdentifierIndex}});var S=fSe();Object.defineProperty(e,"extractPersistedSchema",{enumerable:!0,get:function(){return S.extractPersistedSchema}}),Object.defineProperty(e,"comparePersistedSchema",{enumerable:!0,get:function(){return S.comparePersistedSchema}});var p=hSe();Object.defineProperty(e,"rollback",{enumerable:!0,get:function(){return p.rollback}});var w=mSe();Object.defineProperty(e,"generateSchemaFromSimpleSchema",{enumerable:!0,get:function(){return w.generateSchemaFromSimpleSchema}});var O=soe();Object.defineProperty(e,"toSimpleTreeSchema",{enumerable:!0,get:function(){return O.toSimpleTreeSchema}})})(nN)),nN}var NW;function gd(){return NW||(NW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.replaceHandles=e.replaceConciseTreeHandles=e.generateSchemaFromSimpleSchema=e.rollback=e.tryStoredSchemaAsArray=e.customFromCursorStored=e.asTreeViewAlpha=e.createFromCursor=e.conciseFromCursor=e.verboseFromCursor=e.cursorFromVerbose=e.applySchemaToParserOptions=e.tryGetSchema=e.getStoredKey=e.getPropertyKeyFromStoredKey=e.SchemaCompatibilityTester=e.comparePersistedSchema=e.extractPersistedSchema=e.getSimpleSchema=e.getJsonSchema=e.createIdentifierIndex=e.createSimpleTreeIndex=e.TreeBeta=e.treeNodeApi=e.singletonSchema=e.enumFromStrings=e.adaptEnum=e.SchemaFactoryAlpha=e.SchemaFactoryBeta=e.SchemaFactory=e.TreeViewConfigurationAlpha=e.TreeViewConfiguration=e.walkFieldSchema=e.walkAllowedTypes=e.walkNodeSchema=e.evaluateLazySchema=e.normalizeAllowedTypes=e.isTreeNodeSchemaClass=e.getKernel=e.getOrCreateNodeFromInnerUnboxedNode=e.getOrCreateNodeFromInnerNode=e.getOrCreateInnerNode=e.SimpleContextSlot=e.HydratedContext=e.tryDisposeTreeNode=e.isTreeNode=e.TreeNode=e.NodeKind=e.typeSchemaSymbol=e.typeNameSymbol=void 0,e.nullSchema=e.handleSchema=e.booleanSchema=e.stringSchema=e.numberSchema=e.permissiveStoredSchemaGenerationOptions=e.restrictiveStoredSchemaGenerationOptions=e.toUnhydratedSchema=e.convertField=e.toInitialSchema=e.toUpgradeSchema=e.convertFieldKind=e.getStoredSchema=e.toStoredSchema=e.prepareForInsertionContextless=e.prepareForInsertion=e.unhydratedFlexTreeFromInsertable=e.RecordNodeSchema=e.isRecordNodeSchema=e.setField=e.isObjectNodeSchema=e.ObjectNodeSchema=e.isMapNodeSchema=e.MapNodeSchema=e.TreeArrayNode=e.IterableTreeArrayContent=e.isArrayNodeSchema=e.asIndex=e.ArrayNodeSchema=e.tryGetTreeNodeForField=e.areImplicitFieldSchemaEqual=e.areFieldSchemaEqual=e.normalizeFieldSchema=e.FieldSchemaAlpha=e.FieldSchema=e.FieldKind=e.KeyEncodingOptions=e.schemaStatics=e.getIdentifierFromNode=e.allowUnused=e.replaceVerboseTreeHandles=void 0;var n=dr();Object.defineProperty(e,"typeNameSymbol",{enumerable:!0,get:function(){return n.typeNameSymbol}}),Object.defineProperty(e,"typeSchemaSymbol",{enumerable:!0,get:function(){return n.typeSchemaSymbol}}),Object.defineProperty(e,"NodeKind",{enumerable:!0,get:function(){return n.NodeKind}}),Object.defineProperty(e,"TreeNode",{enumerable:!0,get:function(){return n.TreeNode}}),Object.defineProperty(e,"isTreeNode",{enumerable:!0,get:function(){return n.isTreeNode}}),Object.defineProperty(e,"tryDisposeTreeNode",{enumerable:!0,get:function(){return n.tryDisposeTreeNode}}),Object.defineProperty(e,"HydratedContext",{enumerable:!0,get:function(){return n.HydratedContext}}),Object.defineProperty(e,"SimpleContextSlot",{enumerable:!0,get:function(){return n.SimpleContextSlot}}),Object.defineProperty(e,"getOrCreateInnerNode",{enumerable:!0,get:function(){return n.getOrCreateInnerNode}}),Object.defineProperty(e,"getOrCreateNodeFromInnerNode",{enumerable:!0,get:function(){return n.getOrCreateNodeFromInnerNode}}),Object.defineProperty(e,"getOrCreateNodeFromInnerUnboxedNode",{enumerable:!0,get:function(){return n.getOrCreateNodeFromInnerUnboxedNode}}),Object.defineProperty(e,"getKernel",{enumerable:!0,get:function(){return n.getKernel}}),Object.defineProperty(e,"isTreeNodeSchemaClass",{enumerable:!0,get:function(){return n.isTreeNodeSchemaClass}}),Object.defineProperty(e,"normalizeAllowedTypes",{enumerable:!0,get:function(){return n.normalizeAllowedTypes}}),Object.defineProperty(e,"evaluateLazySchema",{enumerable:!0,get:function(){return n.evaluateLazySchema}}),Object.defineProperty(e,"walkNodeSchema",{enumerable:!0,get:function(){return n.walkNodeSchema}}),Object.defineProperty(e,"walkAllowedTypes",{enumerable:!0,get:function(){return n.walkAllowedTypes}});var a=fb();Object.defineProperty(e,"walkFieldSchema",{enumerable:!0,get:function(){return a.walkFieldSchema}});var t=pSe();Object.defineProperty(e,"TreeViewConfiguration",{enumerable:!0,get:function(){return t.TreeViewConfiguration}}),Object.defineProperty(e,"TreeViewConfigurationAlpha",{enumerable:!0,get:function(){return t.TreeViewConfigurationAlpha}}),Object.defineProperty(e,"SchemaFactory",{enumerable:!0,get:function(){return t.SchemaFactory}}),Object.defineProperty(e,"SchemaFactoryBeta",{enumerable:!0,get:function(){return t.SchemaFactoryBeta}}),Object.defineProperty(e,"SchemaFactoryAlpha",{enumerable:!0,get:function(){return t.SchemaFactoryAlpha}}),Object.defineProperty(e,"adaptEnum",{enumerable:!0,get:function(){return t.adaptEnum}}),Object.defineProperty(e,"enumFromStrings",{enumerable:!0,get:function(){return t.enumFromStrings}}),Object.defineProperty(e,"singletonSchema",{enumerable:!0,get:function(){return t.singletonSchema}}),Object.defineProperty(e,"treeNodeApi",{enumerable:!0,get:function(){return t.treeNodeApi}}),Object.defineProperty(e,"TreeBeta",{enumerable:!0,get:function(){return t.TreeBeta}}),Object.defineProperty(e,"createSimpleTreeIndex",{enumerable:!0,get:function(){return t.createSimpleTreeIndex}}),Object.defineProperty(e,"createIdentifierIndex",{enumerable:!0,get:function(){return t.createIdentifierIndex}}),Object.defineProperty(e,"getJsonSchema",{enumerable:!0,get:function(){return t.getJsonSchema}}),Object.defineProperty(e,"getSimpleSchema",{enumerable:!0,get:function(){return t.getSimpleSchema}}),Object.defineProperty(e,"extractPersistedSchema",{enumerable:!0,get:function(){return t.extractPersistedSchema}}),Object.defineProperty(e,"comparePersistedSchema",{enumerable:!0,get:function(){return t.comparePersistedSchema}}),Object.defineProperty(e,"SchemaCompatibilityTester",{enumerable:!0,get:function(){return t.SchemaCompatibilityTester}}),Object.defineProperty(e,"getPropertyKeyFromStoredKey",{enumerable:!0,get:function(){return t.getPropertyKeyFromStoredKey}}),Object.defineProperty(e,"getStoredKey",{enumerable:!0,get:function(){return t.getStoredKey}}),Object.defineProperty(e,"tryGetSchema",{enumerable:!0,get:function(){return t.tryGetSchema}}),Object.defineProperty(e,"applySchemaToParserOptions",{enumerable:!0,get:function(){return t.applySchemaToParserOptions}}),Object.defineProperty(e,"cursorFromVerbose",{enumerable:!0,get:function(){return t.cursorFromVerbose}}),Object.defineProperty(e,"verboseFromCursor",{enumerable:!0,get:function(){return t.verboseFromCursor}}),Object.defineProperty(e,"conciseFromCursor",{enumerable:!0,get:function(){return t.conciseFromCursor}}),Object.defineProperty(e,"createFromCursor",{enumerable:!0,get:function(){return t.createFromCursor}}),Object.defineProperty(e,"asTreeViewAlpha",{enumerable:!0,get:function(){return t.asTreeViewAlpha}}),Object.defineProperty(e,"customFromCursorStored",{enumerable:!0,get:function(){return t.customFromCursorStored}}),Object.defineProperty(e,"tryStoredSchemaAsArray",{enumerable:!0,get:function(){return t.tryStoredSchemaAsArray}}),Object.defineProperty(e,"rollback",{enumerable:!0,get:function(){return t.rollback}}),Object.defineProperty(e,"generateSchemaFromSimpleSchema",{enumerable:!0,get:function(){return t.generateSchemaFromSimpleSchema}}),Object.defineProperty(e,"replaceConciseTreeHandles",{enumerable:!0,get:function(){return t.replaceConciseTreeHandles}}),Object.defineProperty(e,"replaceHandles",{enumerable:!0,get:function(){return t.replaceHandles}}),Object.defineProperty(e,"replaceVerboseTreeHandles",{enumerable:!0,get:function(){return t.replaceVerboseTreeHandles}}),Object.defineProperty(e,"allowUnused",{enumerable:!0,get:function(){return t.allowUnused}}),Object.defineProperty(e,"getIdentifierFromNode",{enumerable:!0,get:function(){return t.getIdentifierFromNode}}),Object.defineProperty(e,"schemaStatics",{enumerable:!0,get:function(){return t.schemaStatics}}),Object.defineProperty(e,"KeyEncodingOptions",{enumerable:!0,get:function(){return t.KeyEncodingOptions}});var i=xi();Object.defineProperty(e,"FieldKind",{enumerable:!0,get:function(){return i.FieldKind}}),Object.defineProperty(e,"FieldSchema",{enumerable:!0,get:function(){return i.FieldSchema}}),Object.defineProperty(e,"FieldSchemaAlpha",{enumerable:!0,get:function(){return i.FieldSchemaAlpha}}),Object.defineProperty(e,"normalizeFieldSchema",{enumerable:!0,get:function(){return i.normalizeFieldSchema}}),Object.defineProperty(e,"areFieldSchemaEqual",{enumerable:!0,get:function(){return i.areFieldSchemaEqual}}),Object.defineProperty(e,"areImplicitFieldSchemaEqual",{enumerable:!0,get:function(){return i.areImplicitFieldSchemaEqual}});var r=wT();Object.defineProperty(e,"tryGetTreeNodeForField",{enumerable:!0,get:function(){return r.tryGetTreeNodeForField}});var s=Ko();Object.defineProperty(e,"ArrayNodeSchema",{enumerable:!0,get:function(){return s.ArrayNodeSchema}}),Object.defineProperty(e,"asIndex",{enumerable:!0,get:function(){return s.asIndex}}),Object.defineProperty(e,"isArrayNodeSchema",{enumerable:!0,get:function(){return s.isArrayNodeSchema}}),Object.defineProperty(e,"IterableTreeArrayContent",{enumerable:!0,get:function(){return s.IterableTreeArrayContent}}),Object.defineProperty(e,"TreeArrayNode",{enumerable:!0,get:function(){return s.TreeArrayNode}}),Object.defineProperty(e,"MapNodeSchema",{enumerable:!0,get:function(){return s.MapNodeSchema}}),Object.defineProperty(e,"isMapNodeSchema",{enumerable:!0,get:function(){return s.isMapNodeSchema}}),Object.defineProperty(e,"ObjectNodeSchema",{enumerable:!0,get:function(){return s.ObjectNodeSchema}}),Object.defineProperty(e,"isObjectNodeSchema",{enumerable:!0,get:function(){return s.isObjectNodeSchema}}),Object.defineProperty(e,"setField",{enumerable:!0,get:function(){return s.setField}}),Object.defineProperty(e,"isRecordNodeSchema",{enumerable:!0,get:function(){return s.isRecordNodeSchema}}),Object.defineProperty(e,"RecordNodeSchema",{enumerable:!0,get:function(){return s.RecordNodeSchema}});var o=Sl();Object.defineProperty(e,"unhydratedFlexTreeFromInsertable",{enumerable:!0,get:function(){return o.unhydratedFlexTreeFromInsertable}});var u=TT();Object.defineProperty(e,"prepareForInsertion",{enumerable:!0,get:function(){return u.prepareForInsertion}}),Object.defineProperty(e,"prepareForInsertionContextless",{enumerable:!0,get:function(){return u.prepareForInsertionContextless}});var c=vl();Object.defineProperty(e,"toStoredSchema",{enumerable:!0,get:function(){return c.toStoredSchema}}),Object.defineProperty(e,"getStoredSchema",{enumerable:!0,get:function(){return c.getStoredSchema}}),Object.defineProperty(e,"convertFieldKind",{enumerable:!0,get:function(){return c.convertFieldKind}}),Object.defineProperty(e,"toUpgradeSchema",{enumerable:!0,get:function(){return c.toUpgradeSchema}}),Object.defineProperty(e,"toInitialSchema",{enumerable:!0,get:function(){return c.toInitialSchema}}),Object.defineProperty(e,"convertField",{enumerable:!0,get:function(){return c.convertField}}),Object.defineProperty(e,"toUnhydratedSchema",{enumerable:!0,get:function(){return c.toUnhydratedSchema}}),Object.defineProperty(e,"restrictiveStoredSchemaGenerationOptions",{enumerable:!0,get:function(){return c.restrictiveStoredSchemaGenerationOptions}}),Object.defineProperty(e,"permissiveStoredSchemaGenerationOptions",{enumerable:!0,get:function(){return c.permissiveStoredSchemaGenerationOptions}});var d=Pc();Object.defineProperty(e,"numberSchema",{enumerable:!0,get:function(){return d.numberSchema}}),Object.defineProperty(e,"stringSchema",{enumerable:!0,get:function(){return d.stringSchema}}),Object.defineProperty(e,"booleanSchema",{enumerable:!0,get:function(){return d.booleanSchema}}),Object.defineProperty(e,"handleSchema",{enumerable:!0,get:function(){return d.handleSchema}}),Object.defineProperty(e,"nullSchema",{enumerable:!0,get:function(){return d.nullSchema}})})(XM)),XM}var ku={},xu={},AW;function coe(){if(AW)return xu;AW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(xu,"__esModule",{value:!0}),xu.initializerFromChunk=xu.initialize=xu.canInitialize=void 0;const e=Je(),n=Vt(),a=An();function t(o){return o.forest.isEmpty&&(0,n.schemaDataIsEmpty)(o.storedSchema)}xu.canInitialize=t;function i(o,u,c){(0,e.assert)((0,n.schemaDataIsEmpty)(o.storedSchema),1859);let d;{const l=u.rootFieldSchema,f=l.kind;f===a.FieldKinds.sequence.identifier||f===a.FieldKinds.optional.identifier?d=u:((0,e.assert)(f===a.FieldKinds.required.identifier,1480),d={nodeSchema:u.nodeSchema,rootFieldSchema:{kind:a.FieldKinds.optional.identifier,types:l.types,persistedMetadata:l.persistedMetadata}})}(0,e.assert)((0,a.allowsRepoSuperset)(a.defaultSchemaPolicy,u,d),1481),o.updateSchema(d),c(),d!==u&&o.updateSchema(u,!0)}xu.initialize=i;function r(o,u){return()=>s(o,u())}xu.initializerFromChunk=r;function s(o,u){const c={field:n.rootFieldKey,parent:void 0};(0,e.assert)(o.storedSchema.rootFieldSchema.kind===a.FieldKinds.optional.identifier,3089);const d=o.editor.optionalField(c);(0,e.assert)(u.topLevelLength<=1,2036),d.set(u.topLevelLength===0?void 0:u,!0)}return xu}var DW;function mb(){return DW||(DW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=ku&&ku.__esDecorate||function(v,m,h,g,_,S){function p(V){if(V!==void 0&&typeof V!="function")throw new TypeError("Function expected");return V}for(var w=g.kind,O=w==="getter"?"get":w==="setter"?"set":"value",E=!m&&v?g.static?v:v.prototype:null,F=m||(E?Object.getOwnPropertyDescriptor(E,g.name):{}),R,M=!1,j=h.length-1;j>=0;j--){var k={};for(var x in g)k[x]=x==="access"?{}:g[x];for(var x in g.access)k.access[x]=g.access[x];k.addInitializer=function(V){if(M)throw new TypeError("Cannot add initializers after decoration has completed");S.push(p(V||null))};var L=(0,h[j])(w==="accessor"?{get:F.get,set:F.set}:F[O],k);if(w==="accessor"){if(L===void 0)continue;if(L===null||typeof L!="object")throw new TypeError("Object expected");(R=p(L.get))&&(F.get=R),(R=p(L.set))&&(F.set=R),(R=p(L.init))&&_.unshift(R)}else(R=p(L))&&(w==="field"?_.unshift(R):F[O]=R)}E&&Object.defineProperty(E,g.name,F),M=!0},a=ku&&ku.__runInitializers||function(v,m,h){for(var g=arguments.length>2,_=0;_<m.length;_++)h=g?m[_].call(v,h):m[_].call(v);return g?h:void 0},t=ku&&ku.__setFunctionName||function(v,m,h){return typeof m=="symbol"&&(m=m.description?"[".concat(m.description,"]"):""),Object.defineProperty(v,"name",{configurable:!0,value:h?"".concat(h," ",m):m})};Object.defineProperty(e,"__esModule",{value:!0}),e.addConstraintsToTransaction=e.getCheckout=e.SchematizingSimpleTreeView=e.ViewSlot=void 0;const i=Ht(),r=Je(),s=Ot(),o=Vt(),u=An(),c=gd(),d=Bt(),l=coe();e.ViewSlot=(0,o.anchorSlot)();let f=(()=>{let v=[d.breakingClass],m,h=[],g;return g=class{constructor(_,S,p,w){if(this.checkout=_,this.config=S,this.nodeKeyManager=p,this.onDispose=w,this.events=(0,i.createEmitter)(),this.flexTreeViewUnregisterCallbacks=new Set,this.unregisterCallbacks=new Set,this.disposed=!1,this.midUpgrade=!1,this.breaker=_.breaker,_.forest.anchors.slots.has(e.ViewSlot))throw new s.UsageError("Cannot create a second tree view from the same checkout");_.forest.anchors.slots.set(e.ViewSlot,this),this.rootFieldSchema=(0,c.normalizeFieldSchema)(S.schema);const O=new c.TreeViewConfigurationAlpha({schema:S.schema});this.viewSchema=new c.SchemaCompatibilityTester(O),this.currentCompatibility={canView:!1,canUpgrade:!0,isEquivalent:!1,canInitialize:!0},this.update(),this.unregisterCallbacks.add(this.checkout.events.on("changed",(E,F)=>{this.events.emit("changed",E,F),this.events.emit("commitApplied",E,F)}))}hasRootSchema(_){return(0,c.areImplicitFieldSchemaEqual)(this.rootFieldSchema,_)}get schema(){return this.config.schema}initialize(_){if(this.ensureUndisposed(),!this.compatibility.canInitialize)throw new s.UsageError("Tree cannot be initialized more than once.");this.runSchemaEdit(()=>{const p=(0,c.toInitialSchema)(this.config.schema),w=(0,c.prepareForInsertionContextless)(_,this.rootFieldSchema,{schema:p,policy:u.defaultSchemaPolicy},this,p.rootFieldSchema);this.checkout.transaction.start(),(0,l.initialize)(this.checkout,p,(0,l.initializerFromChunk)(this.checkout,()=>this.checkout.forest.chunkField((0,u.cursorForMapTreeField)(w===void 0?[]:[w])))),this.checkout.transaction.commit()})}upgradeSchema(){this.ensureUndisposed();const _=this.compatibility;if(_.isEquivalent)return;if(!_.canUpgrade)throw new s.UsageError("Existing stored schema cannot be upgraded (see TreeView.compatibility.canUpgrade).");const S=(0,c.toUpgradeSchema)(this.viewSchema.viewSchema.root);this.runSchemaEdit(()=>this.checkout.updateSchema(S))}getFlexTreeContext(){return this.ensureUndisposed(),(0,r.assert)(this.flexTreeContext!==void 0,2240),this.flexTreeContext}runTransaction(_,S){const p=(F,R=[])=>{C(this.checkout,F,R)};this.checkout.transaction.start(),p(!1,S?.preconditions);const w=_(),O=w?.rollback,E=w?.value;return O===!0?(this.checkout.transaction.abort(),E!==void 0?{success:!1,value:E}:{success:!1}):(p(!0,w?.preconditionsOnRevert),this.checkout.transaction.commit(),E!==void 0?{success:!0,value:E}:{success:!0})}ensureUndisposed(){this.disposed&&this.failDisposed()}failDisposed(){throw new s.UsageError("Accessed a disposed TreeView.")}update(){this.disposeFlexView();const _=this.viewSchema.checkCompatibility(this.checkout.storedSchema);this.currentCompatibility={..._,canInitialize:(0,l.canInitialize)(this.checkout)};const p=this.checkout.forest.anchors.slots;if(_.canView){this.flexTreeContext=new u.Context(u.defaultSchemaPolicy,this.checkout,this.nodeKeyManager),(0,r.assert)(!p.has(c.SimpleContextSlot),2631),(0,r.assert)(this.rootFieldSchema instanceof c.FieldSchemaAlpha,3066),p.set(c.SimpleContextSlot,new c.HydratedContext(this.flexTreeContext,c.HydratedContext.schemaMapFromRootSchema(this.rootFieldSchema.annotatedAllowedTypesNormalized)));{let w=this.root;this.flexTreeViewUnregisterCallbacks.add(this.checkout.events.on("afterBatch",()=>{!this.midUpgrade&&w!==this.root&&(w=this.root,this.events.emit("rootChanged"))}))}}this.flexTreeViewUnregisterCallbacks.add(this.checkout.storedSchema.events.on("afterSchemaChange",()=>this.update())),this.midUpgrade||(this.events.emit("schemaChanged"),this.events.emit("rootChanged"))}runSchemaEdit(_){this.midUpgrade=!0;try{_()}finally{this.midUpgrade=!1}this.events.emit("schemaChanged"),this.events.emit("rootChanged")}disposeFlexView(){const _=this.checkout.forest.anchors;if(this.flexTreeContext!==void 0){for(const S of _)(0,c.tryDisposeTreeNode)(S);this.flexTreeContext[d.disposeSymbol](),this.flexTreeContext=void 0}this.flexTreeViewUnregisterCallbacks.forEach(S=>S()),this.flexTreeViewUnregisterCallbacks.clear(),_.slots.delete(c.SimpleContextSlot)}get compatibility(){return this.currentCompatibility||this.failDisposed(),this.currentCompatibility}dispose(){this.disposed=!0,this.disposeFlexView(),this.unregisterCallbacks.forEach(_=>_()),this.checkout.forest.anchors.slots.delete(e.ViewSlot),this.currentCompatibility=void 0,this.onDispose?.(),this.checkout.isBranch&&!this.checkout.disposed&&this.checkout.dispose()}get root(){if(this.breaker.use(),!this.compatibility.canView)throw new s.UsageError("Document is out of schema. Check TreeView.compatibility before accessing TreeView.root.");const _=this.getFlexTreeContext();return(0,c.tryGetTreeNodeForField)(_.root)}set root(_){if(this.breaker.use(),!this.compatibility.canView)throw new s.UsageError("Document is out of schema. Check TreeView.compatibility before accessing TreeView.root.");const S=this.getFlexTreeContext();(0,c.setField)(S.root,this.rootFieldSchema,_,this.checkout.storedSchema.rootFieldSchema)}fork(){return this.checkout.branch().viewWith(this.config)}merge(_,S=!0){this.checkout.merge(b(_),S)}rebaseOnto(_){b(_).rebase(this.checkout)}},t(g,"SchematizingSimpleTreeView"),(()=>{const _=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;n(null,m={value:g},v,{kind:"class",name:g.name,metadata:_},null,h),g=m.value,_&&Object.defineProperty(g,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_}),a(g,h)})(),g})();e.SchematizingSimpleTreeView=f;function b(v){if(v instanceof f)return v.checkout;throw new s.UsageError("Unsupported context implementation")}e.getCheckout=b;function C(v,m,h=[]){for(const g of h)switch(g.type){case"nodeInDocument":{const _=(0,c.getOrCreateInnerNode)(g.node),S=(0,c.getKernel)(g.node).getStatus();if(S!==u.TreeStatus.InDocument){const p=m?" on revert":"";throw new s.UsageError(`Attempted to add a "nodeInDocument" constraint${p}, but the node is not currently in the document. Node status: ${S}`)}(0,r.assert)(_.isHydrated(),3010),m?v.editor.addNodeExistsConstraintOnRevert(_.anchorNode):v.editor.addNodeExistsConstraint(_.anchorNode);break}default:(0,r.unreachableCase)(g.type)}}e.addConstraintsToTransaction=C})(ku)),ku}var up={},qu={},HC={},fN={},kW;function gSe(){return kW||(kW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.EncodedSharedTreeChange=e.EncodedSharedTreeInnerChange=void 0;const n=Nr(),a=Bt();e.EncodedSharedTreeInnerChange=n.Type.Object({schema:n.Type.Optional(a.JsonCompatibleReadOnlySchema),data:n.Type.Optional(a.JsonCompatibleReadOnlySchema)}),e.EncodedSharedTreeChange=n.Type.Array(e.EncodedSharedTreeInnerChange)})(fN)),fN}var xW;function ySe(){if(xW)return HC;xW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(HC,"__esModule",{value:!0}),HC.makeSharedTreeChangeCodecFamily=void 0;const e=zn(),n=An(),a=gSe();function t(r,s){const o=(0,n.makeSchemaChangeCodecs)(s);return(0,e.makeCodecFamily)([[1,i(r.resolve(1).json,o.resolve(1).json,s)],[2,i(r.resolve(2).json,o.resolve(1).json,s)],[3,i(r.resolve(3).json,o.resolve(1).json,s)],[4,i(r.resolve(4).json,o.resolve(1).json,s)]])}HC.makeSharedTreeChangeCodecFamily=t;function i(r,s,o){const u=new e.DiscriminatedUnionDispatcher({data(c,d){return{type:"data",innerChange:r.decode(c,d)}},schema(c){return{type:"schema",innerChange:s.decode(c)}}});return(0,e.withSchemaValidation)(a.EncodedSharedTreeChange,{encode:(c,d)=>{const l=[];let f;for(const b of c.changes)if(b.type==="data"){const C=f!==void 0?{policy:d.schema!==void 0?d.schema.policy:n.defaultSchemaPolicy,schema:f}:d.schema;l.push({data:r.encode(b.innerChange,{originatorId:d.originatorId,schema:C,idCompressor:d.idCompressor,revision:d.revision})})}else b.type==="schema"&&(l.push({schema:s.encode(b.innerChange)}),f=b.innerChange.schema.new);return l},decode:(c,d)=>{const l=[];for(const f of c)l.push(u.dispatch(f,d));return{changes:l}}},o.jsonValidator)}return HC}var KC={},qW;function bSe(){if(qW)return KC;qW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(KC,"__esModule",{value:!0}),KC.SharedTreeEditBuilder=void 0;const e=An();class n extends e.DefaultEditBuilder{constructor(t,i,r){super(t,i,s=>r({...s,change:{changes:[{type:"data",innerChange:s.change}]}})),this.changeReceiver=r,this.schema={setStoredSchema:(s,o)=>{this.changeReceiver({revision:i(),change:{changes:[{type:"schema",innerChange:{schema:{new:o,old:s},isInverse:!1}}]}})}}}}return KC.SharedTreeEditBuilder=n,KC}var LW;function Iq(){if(LW)return qu;LW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qu,"__esModule",{value:!0}),qu.updateRefreshers=qu.hasSchemaChange=qu.SharedTreeChangeFamily=void 0;const e=Je(),n=Vt(),a=An(),t=Bt(),i=ySe(),r=bSe();class s{constructor(l,f,b,C,v){this.idCompressor=v;const m=(0,a.makeModularChangeCodecFamily)(a.fieldKindConfigurations,l,f,b,C);this.modularChangeFamily=new a.ModularChangeFamily(a.fieldKinds,m),this.codecs=(0,i.makeSharedTreeChangeCodecFamily)(this.modularChangeFamily.codecs,b)}buildEditor(l,f){return new r.SharedTreeEditBuilder(this.modularChangeFamily,l,f)}compose(l){const f=[],b=[],C=()=>{b.length>0&&(f.push({type:"data",innerChange:this.modularChangeFamily.compose(b)}),b.length=0)};for(const v of l)for(const m of v.change.changes)m.type==="schema"?(C(),f.push(m)):b.push((0,n.mapTaggedChange)(v,m.innerChange));return C(),{changes:f}}invert(l,f,b){const C=v=>{switch(v.type){case"data":return{type:"data",innerChange:this.modularChangeFamily.invert((0,n.mapTaggedChange)(l,v.innerChange),f,b)};case"schema":return{type:"schema",innerChange:{schema:{new:v.innerChange.schema.old,old:v.innerChange.schema.new},isInverse:!0}};default:(0,e.fail)(2764)}};return{changes:l.change.changes.map(C).reverse()}}rebase(l,f,b){if(l.change.changes.length===0||f.change.changes.length===0)return l.change;if(o(l.change)||o(f.change))return s.emptyChange;(0,e.assert)((0,t.hasSingle)(l.change.changes)&&(0,t.hasSingle)(f.change.changes),2180);const C=l.change.changes[0],v=f.change.changes[0];return(0,e.assert)(C.type==="data"&&v.type==="data",2181),{changes:[{type:"data",innerChange:this.modularChangeFamily.rebase((0,n.mapTaggedChange)(l,C.innerChange),(0,n.mapTaggedChange)(f,v.innerChange),b)}]}}changeRevision(l,f,b){return{changes:l.changes.map(C=>C.type==="data"?{...C,innerChange:this.modularChangeFamily.rebaser.changeRevision(C.innerChange,f,b)}:C)}}get rebaser(){return this}}qu.SharedTreeChangeFamily=s,s.emptyChange={changes:[]};function o(d){return d.changes.some(l=>l.type==="schema")}qu.hasSchemaChange=o;function u(d,l){return{changes:d.changes.map(f=>f.type==="data"?{type:"data",innerChange:l(f.innerChange)}:f)}}function c(d,l,f,b){const C=new Map;function v(g){return(0,t.addToNestedSet)(C,g.major,g.minor),l(g)}function*m(g){for(const _ of g)(0,t.nestedSetContains)(C,_.major,_.minor)||(yield _)}let h=!0;return u(d,g=>{const _=f(g);return h?(h=!1,b(g,v,_,!0)):b(g,v,m(_),!1)})}return qu.updateRefreshers=c,qu}var BW;function vSe(){if(BW)return up;BW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(up,"__esModule",{value:!0}),up.SharedTreeMutableChangeEnricher=up.SharedTreeReadonlyChangeEnricher=void 0;const e=Je(),n=Vt(),a=An(),t=Bt(),i=Iq();class r{constructor(u,c,d,l){this.forest=u,this.schema=c,this.removedRoots=d,this.idCompressor=l,this.getDetachedRoot=f=>{const b=this.removedRoots.tryGetEntry(f);if(b!==void 0){const C=this.forest.getCursorAboveDetachedFields(),v=this.removedRoots.toFieldKey(b);return C.enterField(v),C.enterNode(0),(0,a.chunkTree)(C,{policy:a.defaultChunkPolicy,idCompressor:this.idCompressor})}}}fork(){return new s(this.forest.clone(this.schema,new n.AnchorSet),this.schema,this.removedRoots.clone())}updateChangeEnrichments(u){return(0,i.updateRefreshers)(u,this.getDetachedRoot,a.relevantRemovedRoots,a.updateRefreshers)}}up.SharedTreeReadonlyChangeEnricher=r;class s extends r{applyTipChange(u,c){for(const d of u.changes){const l=d.type;switch(l){case"data":{const f=(0,a.intoDelta)((0,n.tagChange)(d.innerChange,c)),b=this.forest.acquireVisitor();(0,n.visitDelta)(f,b,this.removedRoots,c),b.free();break}case"schema":break;default:(0,e.unreachableCase)(l)}}}[t.disposeSymbol](){}}return up.SharedTreeMutableChangeEnricher=s,up}var jo={},UW;function Rq(){if(UW)return jo;UW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=jo&&jo.__classPrivateFieldGet||function(p,w,O,E){if(O==="a"&&!E)throw new TypeError("Private accessor was defined without a getter");if(typeof w=="function"?p!==w||!E:!w.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return O==="m"?E:O==="a"?E.call(p):E?E.value:w.get(p)},n=jo&&jo.__classPrivateFieldSet||function(p,w,O,E,F){if(E==="m")throw new TypeError("Private method is not writable");if(E==="a"&&!F)throw new TypeError("Private accessor was defined without a setter");if(typeof w=="function"?p!==w||!F:!w.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return E==="a"?F.call(p,O):F?F.value=O:w.set(p,O),O},a,t,i;Object.defineProperty(jo,"__esModule",{value:!0}),jo.TreeCheckout=jo.createTreeCheckout=void 0;const r=Je(),s=Ht(),o=Ot(),u=zn(),c=Vt(),d=An(),l=Qae(),f=Bt(),b=Iq(),C=gd(),v=mb();function m(p,w,O,E){const F=E?.breaker??new f.Breakable("TreeCheckout"),R=E?.schema??new c.TreeStoredSchemaRepository,M=E?.forest??(0,d.buildForest)(F,R),j={jsonValidator:u.noopValidator,oldestCompatibleClient:u.FluidClientVersion.v2_0},k=1,x=E?.changeFamily??new b.SharedTreeChangeFamily(O,E?.fieldBatchCodec??(0,d.makeFieldBatchCodec)(j,k),j,E?.chunkCompressionStrategy,p),L=E?.branch??new l.SharedTreeBranch({change:x.rebaser.compose([]),revision:"root"},x,()=>p.generateCompressedId());return new h(L,!1,x,R,M,w,O,p,E?.removedRoots,E?.logger,F,E?.disposeForksAfterTransaction)}jo.createTreeCheckout=m;class h{constructor(w,O,E,F,R,M,j,k,x=(0,c.makeDetachedFieldIndex)("repair",j,k),L,V=new f.Breakable("TreeCheckout"),G=!0){this.isBranch=O,this.changeFamily=E,this.storedSchema=F,this.forest=R,this.mintRevisionTag=M,this.revisionTagCodec=j,this.idCompressor=k,this.removedRoots=x,this.logger=L,this.breaker=V,this.disposeForksAfterTransaction=G,this.disposed=!1,this.views=new Set,this.revertibles=new Set,this.revertibleCommitBranches=new Map,a.set(this,(0,s.createEmitter)()),this.events=e(this,a,"f"),this.onAfterChange=ee=>{if(this.editLock.lock(),e(this,a,"f").emit("beforeBatch",ee),ee.change!==void 0){const se=ee.type==="rebase"?e(this,t,"f").activeBranch.getHead().revision:ee.change.revision;for(const re of ee.change.change.changes)if(re.type==="data"){const fe=(0,d.intoDelta)((0,c.tagChange)(re.innerChange,se));this.withCombinedVisitor(oe=>{(0,c.visitDelta)(fe,oe,this.removedRoots,se)})}else re.type==="schema"?this.storedSchema.apply(re.innerChange.schema.new):(0,r.fail)(2769)}e(this,a,"f").emit("afterBatch"),this.editLock.unlock(),ee.type==="append"&&ee.newCommits.forEach(se=>this.validateCommit(se))},this.onAncestryTrimmed=ee=>{this.withCombinedVisitor(se=>{ee.forEach(re=>{const fe=this.removedRoots.getRootsLastTouchedByRevision(re);for(const oe of fe)se.destroy(this.removedRoots.toFieldKey(oe),1);this.removedRoots.deleteRootsLastTouchedByRevision(re)})})},t.set(this,void 0),i.set(this,new WeakMap),n(this,t,new l.SquashingTransactionStack(w,ee=>{const se=this.mintRevisionTag();for(const oe of ee)this.removedRoots.updateMajor(oe.revision,se);const re=this.changeFamily.rebaser.compose(ee),fe=this.changeFamily.rebaser.changeRevision(re,se);return(0,c.tagChange)(fe,se)},()=>{const ee=this.disposeForksAfterTransaction?_(this):void 0,se=this.removedRoots.clone();return re=>{switch(re){case l.TransactionResult.Abort:this.removedRoots=se;break;case l.TransactionResult.Commit:this.transaction.isInProgress()||this.validateCommit(e(this,t,"f").branch.getHead());break;default:(0,r.unreachableCase)(re)}ee?.()}}),"f"),this.editLock=new g(e(this,t,"f").activeBranchEditor),w.events.on("afterChange",ee=>{if(ee.type==="append")for(const se of ee.newCommits){const re=ee.type==="append"?ee.kind:c.CommitKind.Default,{change:fe,revision:oe}=se,pe=(0,b.hasSchemaChange)(fe)?void 0:ge=>{if(!de)throw new o.UsageError("Cannot get a revertible outside of the context of a changed event.");if(this.revertibleCommitBranches.get(oe)!==void 0)throw new o.UsageError("Cannot generate the same revertible more than once. Note that this can happen when multiple changed event listeners are registered.");const Ce=this.createRevertible(oe,re,this,ge);return this.revertibleCommitBranches.set(oe,e(this,t,"f").activeBranch.fork(se)),this.revertibles.add(Ce),Ce};let de=!0;e(this,a,"f").emit("changed",{isLocal:!0,kind:re},pe),de=!1}else this.isRemoteChangeEvent(ee)&&e(this,a,"f").emit("changed",{isLocal:!1,kind:c.CommitKind.Default})}),e(this,t,"f").activeBranchEvents.on("afterChange",this.onAfterChange),e(this,t,"f").activeBranchEvents.on("ancestryTrimmed",this.onAncestryTrimmed)}exportVerbose(){const w=this.forest.allocateCursor("contentSnapshot");try{(0,c.moveToDetachedField)(this.forest,w);const O=w.getFieldLength();if(O===0)return;if(O===1)return w.enterNode(0),S(w,this.storedSchema.nodeSchema);(0,r.fail)(2760)}finally{w.free()}}withCombinedVisitor(w){const O=this.forest.anchors.acquireVisitor(),E=(0,c.combineVisitors)([this.forest.acquireVisitor(),O]);w(E),E.free()}checkNotDisposed(w){if(this.breaker.use(),this.disposed){if(w!==void 0)throw new o.UsageError(w);(0,r.assert)(!1,2321)}}createRevertible(w,O,E,F){const R=E.revertibleCommitBranches,M={get status(){return R.get(w)===void 0?c.RevertibleStatus.Disposed:c.RevertibleStatus.Valid},revert:(j=!0)=>{if(M.status===c.RevertibleStatus.Disposed)throw new o.UsageError("Unable to revert a revertible that has been disposed.");const k=E.revertRevertible(w,O);E.logger?.sendTelemetryEvent({eventName:h.revertTelemetryEventName,...k}),j&&M.dispose()},clone:j=>{const k=(0,v.getCheckout)(j),x=this.revertibleCommitBranches.get(w);if(x===void 0)throw new o.UsageError("Unable to clone a revertible that has been disposed.");const L=x.getHead(),V=e(k,t,"f").activeBranch.getHead();if((0,c.isAncestor)(L,V,!0)===!1)throw new o.UsageError("Cannot clone revertible for a commit that is not present on the given branch.");return k.revertibleCommitBranches.set(w,x.fork()),this.createRevertible(w,O,k,F)},dispose:()=>{if(M.status===c.RevertibleStatus.Disposed)throw new o.UsageError("Unable to dispose a revertible that has already been disposed.");E.disposeRevertible(M,w),F?.(M)}};return M}viewWith(w){const O=new v.SchematizingSimpleTreeView(this,w,(0,d.createNodeIdentifierManager)(this.idCompressor),()=>{this.views.delete(O)});return this.views.add(O),O}get rootEvents(){return this.forest.anchors.events}get editor(){return this.checkNotDisposed(),this.editLock.editor}locate(w){return this.checkNotDisposed(),this.forest.anchors.locate(w)}get transaction(){return e(this,t,"f")}branch(){this.checkNotDisposed("The parent branch has already been disposed and can no longer create new branches."),this.editLock.checkUnlocked("Branching");const w=new c.AnchorSet,O=e(this,t,"f").activeBranch.fork(),E=this.storedSchema.clone(),F=this.forest.clone(E,w),R=new h(O,!0,this.changeFamily,E,F,this.mintRevisionTag,this.revisionTagCodec,this.idCompressor,this.removedRoots.clone(),this.logger,this.breaker,this.disposeForksAfterTransaction);return e(this,a,"f").emit("fork",R),R}rebase(w){this.checkNotDisposed("The target of the branch rebase has been disposed and cannot be rebased."),w.checkNotDisposed("The source of the branch rebase has been disposed and cannot be rebased."),this.editLock.checkUnlocked("Rebasing"),(0,r.assert)(!w.transaction.isInProgress(),2479),(0,r.assert)(w.isBranch,2653),e(w,t,"f").activeBranch.rebaseOnto(e(this,t,"f").activeBranch)}rebaseOnto(w){this.checkNotDisposed("The target of the branch rebase has been disposed and cannot be rebased."),w.rebase(this)}merge(w,O=!0){for(this.checkNotDisposed("The target of the branch merge has been disposed and cannot be merged."),w.checkNotDisposed("The source of the branch merge has been disposed and cannot be merged."),this.editLock.checkUnlocked("Merging"),(0,r.assert)(!this.transaction.isInProgress(),2480);w.transaction.isInProgress();)w.transaction.commit();e(this,t,"f").activeBranch.merge(e(w,t,"f").activeBranch),O&&w.isBranch&&w[f.disposeSymbol]()}updateSchema(w,O){this.checkNotDisposed(),O!==!0&&(0,r.assert)((0,d.allowsRepoSuperset)(d.defaultSchemaPolicy,this.storedSchema.clone(),w),3046),this.editor.schema.setStoredSchema(this.storedSchema.clone(),w)}dispose(){this.editLock.checkUnlocked("Disposing a view"),this[f.disposeSymbol]()}[(a=new WeakMap,t=new WeakMap,i=new WeakMap,f.disposeSymbol)](){this.checkNotDisposed("The branch has already been disposed and cannot be disposed again."),this.disposed=!0,e(this,t,"f").branch.dispose(),e(this,t,"f").dispose(),this.purgeRevertibles();for(const w of this.views)w.dispose();e(this,a,"f").emit("dispose")}getRemovedRoots(){this.assertNoUntrackedRoots();const w=[],O=this.forest.allocateCursor("getRemovedRoots");for(const{id:E,root:F}of this.removedRoots.entries()){const R=this.removedRoots.toFieldKey(F);this.forest.moveCursorToPath({parent:void 0,parentField:R,parentIndex:0},O);const M=(0,d.jsonableTreeFromCursor)(O),{major:j,minor:k}=E,x=j!==void 0?this.revisionTagCodec.encode(j):j;w.push([x,k,M])}return O.free(),w}load(){this.removedRoots.setRevisionsForLoadedData(e(this,t,"f").branch.getHead().revision),e(this,a,"f").emit("afterBatch")}purgeRevertibles(){for(const w of this.revertibles)w.dispose()}disposeRevertible(w,O){this.revertibleCommitBranches.get(O)?.dispose(),this.revertibleCommitBranches.delete(O),this.revertibles.delete(w)}revertRevertible(w,O){if(this.transaction.isInProgress())throw new o.UsageError("Undo is not yet supported during transactions.");const E=this.revertibleCommitBranches.get(w);(0,r.assert)(E!==void 0,1996);const F=E.getHead(),R=this.mintRevisionTag();let M=(0,c.tagChange)(this.changeFamily.rebaser.invert(F,!1,R),R);const j=e(this,t,"f").activeBranch.getHead();F!==j&&(M=(0,c.tagChange)((0,c.rebaseChange)(this.changeFamily.rebaser,M,F,j,this.mintRevisionTag).change,R)),e(this,t,"f").activeBranch.apply(M,O===c.CommitKind.Default||O===c.CommitKind.Redo?c.CommitKind.Undo:c.CommitKind.Redo);let k=0,x=j;for(;F.revision!==x.revision;){k++;const L=x.parent;(0,r.assert)(L!==void 0,2473),x=L}return{age:k}}assertNoUntrackedRoots(){const w=this.forest.getCursorAboveDetachedFields(),O=new Set([c.rootFieldKey]);for(const{root:E}of this.removedRoots.entries())O.add(this.removedRoots.toFieldKey(E));if(w.firstField())do{const E=w.getFieldKey();(0,r.assert)(O.has(E),2594),O.delete(E)}while(w.nextField())}isRemoteChangeEvent(w){return!this.isBranch&&w.type==="rebase"}onCommitValid(w,O){const E=(0,f.getOrCreate)(e(this,i,"f"),w,()=>[]);return E===!0?(O(w),!0):(E.push(O),!1)}validateCommit(w){const O=(0,f.getOrCreate)(e(this,i,"f"),w,()=>[]);O!==!0&&(O.forEach(E=>E(w)),e(this,i,"f").set(w,!0))}}jo.TreeCheckout=h,h.revertTelemetryEventName="RevertRevertible";class g{constructor(w){this.locked=!1;const O=()=>this.checkUnlocked("Editing the tree");this.editor={get schema(){return w.schema},valueField(...E){const F=w.valueField(...E);return{set(...R){O(),F.set(...R)}}},optionalField(...E){const F=w.optionalField(...E);return{set(...R){O(),F.set(...R)}}},sequenceField(...E){const F=w.sequenceField(...E);return{insert(...R){O(),F.insert(...R)},remove(...R){O(),F.remove(...R)}}},move(...E){O(),w.move(...E)},addNodeExistsConstraint(E){w.addNodeExistsConstraint(E)},addNodeExistsConstraintOnRevert(E){w.addNodeExistsConstraintOnRevert(E)}}}lock(){if(this.locked)debugger;(0,r.assert)(!this.locked,2727),this.locked=!0}checkUnlocked(w){if(this.locked){const O="nodeChanged",E="treeChanged";throw new o.UsageError(`${w} is forbidden during a ${O} or ${E} event`)}}unlock(){(0,r.assert)(this.locked,2728),this.locked=!1}}function _(p){const w=new Set,O=[],E=(0,l.onForkTransitive)(p,R=>{w.add(R),O.push(R.events.on("dispose",()=>w.delete(R)))});let F=!1;return()=>{(0,r.assert)(!F,2729),w.forEach(R=>R.dispose()),O.forEach(R=>R()),E(),F=!0}}function S(p,w){const O=(0,C.customFromCursorStored)(p,w,S);return(w.get(p.type)??(0,r.fail)(2761))instanceof c.LeafNodeStoredSchema?O:{type:p.type,fields:O}}return jo}var zW;function uoe(){return zW||(zW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=Fu&&Fu.__runInitializers||function(R,M,j){for(var k=arguments.length>2,x=0;x<M.length;x++)j=k?M[x].call(R,j):M[x].call(R);return k?j:void 0},a=Fu&&Fu.__esDecorate||function(R,M,j,k,x,L){function V(Fe){if(Fe!==void 0&&typeof Fe!="function")throw new TypeError("Function expected");return Fe}for(var G=k.kind,ee=G==="getter"?"get":G==="setter"?"set":"value",se=!M&&R?k.static?R:R.prototype:null,re=M||(se?Object.getOwnPropertyDescriptor(se,k.name):{}),fe,oe=!1,pe=j.length-1;pe>=0;pe--){var de={};for(var ge in k)de[ge]=ge==="access"?{}:k[ge];for(var ge in k.access)de.access[ge]=k.access[ge];de.addInitializer=function(Fe){if(oe)throw new TypeError("Cannot add initializers after decoration has completed");L.push(V(Fe||null))};var Ce=(0,j[pe])(G==="accessor"?{get:re.get,set:re.set}:re[ee],de);if(G==="accessor"){if(Ce===void 0)continue;if(Ce===null||typeof Ce!="object")throw new TypeError("Object expected");(fe=V(Ce.get))&&(re.get=fe),(fe=V(Ce.set))&&(re.set=fe),(fe=V(Ce.init))&&x.unshift(fe)}else(fe=V(Ce))&&(G==="field"?x.unshift(fe):re[ee]=fe)}se&&Object.defineProperty(se,k.name,re),oe=!0},t=Fu&&Fu.__setFunctionName||function(R,M,j){return typeof M=="symbol"&&(M=M.description?"[".concat(M.description,"]"):""),Object.defineProperty(R,"name",{configurable:!0,value:j?"".concat(j," ",M):M})};Object.defineProperty(e,"__esModule",{value:!0}),e.defaultSharedTreeOptions=e.buildConfiguredForest=e.ForestTypeExpensiveDebug=e.ForestTypeOptimized=e.ForestTypeReference=e.SharedTreeFormatVersion=e.getBranch=e.persistedToSimpleSchema=e.exportSimpleSchema=e.SharedTreeKernel=void 0;const i=Je(),r=Ot(),s=zn(),o=Vt(),u=An(),c=Qae(),d=gd(),l=mb(),f=vSe(),b=Iq(),C=Rq(),v=Bt(),m=new Map([[1,{forest:1,schema:1,detachedFieldIndex:1,editManager:1,message:1,fieldBatch:1}],[2,{forest:1,schema:1,detachedFieldIndex:1,editManager:2,message:2,fieldBatch:1}],[3,{forest:1,schema:1,detachedFieldIndex:1,editManager:3,message:3,fieldBatch:1}],[4,{forest:1,schema:1,detachedFieldIndex:1,editManager:4,message:4,fieldBatch:1}],[5,{forest:1,schema:2,detachedFieldIndex:1,editManager:4,message:4,fieldBatch:1}]]);function h(R){const M=m.get(R);return(0,i.assert)(M!==void 0,2318),M}let g=(()=>{let R=[v.breakingClass],M,j=[],k,x=c.SharedTreeCore,L=[],V;return k=class extends x{get storedSchema(){return this.checkout.storedSchema}constructor(G,ee,se,re,fe,oe,pe,de){const ge={...e.defaultSharedTreeOptions,...de},Ce=h(ge.formatVersion),Fe=new o.TreeStoredSchemaRepository,We=O(G,ge.forest,Fe,pe),Ze=new o.RevisionTagCodec(pe),lt=(0,o.makeDetachedFieldIndex)("repair",Ze,pe,ge),ut=(0,u.makeSchemaCodec)(ge,Ce.schema),pt=new u.SchemaSummarizer(Fe,{getCurrentSeq:fe},ut),Nt=(0,u.makeFieldBatchCodec)(ge,Ce.fieldBatch),Ke={schema:{schema:Fe,policy:u.defaultSchemaPolicy},encodeType:ge.treeEncodeType,originatorId:pe.localSessionId,idCompressor:pe},Ge=new u.ForestSummarizer(We,Ze,Nt,Ke,ge,pe,ge.shouldEncodeFieldIncrementally),Re=new u.DetachedFieldIndexSummarizer(lt),Qe=new b.SharedTreeChangeFamily(Ze,Nt,ge,ge.treeEncodeType,pe),Y=(0,u.makeMitigatedChangeFamily)(Qe,b.SharedTreeChangeFamily.emptyChange,Z=>{throw Z}),Me=new f.SharedTreeReadonlyChangeEnricher(We,Fe,lt);super(G,ee,se,re,oe,[pt,Ge,Re],Y,ge,Ce,pe,Fe,u.defaultSchemaPolicy,new c.DefaultResubmitMachine(Z=>Y.rebaser.invert(Z,!0,this.mintRevisionTag()),Me),Me),this.checkout=n(this,L);const K=this.getLocalBranch();this.checkout=(0,C.createTreeCheckout)(pe,this.mintRevisionTag,Ze,{branch:K,changeFamily:Y,schema:Fe,forest:We,fieldBatchCodec:Nt,removedRoots:lt,chunkCompressionStrategy:ge.treeEncodeType,logger:oe,breaker:this.breaker,disposeForksAfterTransaction:ge.disposeForksAfterTransaction}),this.checkout.transaction.events.on("started",()=>{ee.isAttached()&&this.commitEnricher.startTransaction()}),this.checkout.transaction.events.on("aborting",()=>{ee.isAttached()&&this.commitEnricher.abortTransaction()}),this.checkout.transaction.events.on("committing",()=>{ee.isAttached()&&this.commitEnricher.commitTransaction()}),this.checkout.events.on("beforeBatch",Z=>{Z.type==="append"&&ee.isAttached()&&this.checkout.transaction.isInProgress()&&this.commitEnricher.addTransactionCommits(Z.newCommits)}),this.view={contentSnapshot:()=>this.contentSnapshot(),exportSimpleSchema:()=>this.exportSimpleSchema(),exportVerbose:()=>this.exportVerbose(),viewWith:this.viewWith.bind(this),kernel:this}}exportVerbose(){return this.checkout.exportVerbose()}exportSimpleSchema(){return _(this.storedSchema)}contentSnapshot(){const G=this.checkout.forest.allocateCursor("contentSnapshot");try{return(0,o.moveToDetachedField)(this.checkout.forest,G),{schema:this.storedSchema.clone(),tree:(0,u.jsonableTreeFromFieldCursor)(G),removed:this.checkout.getRemovedRoots()}}finally{G.free()}}viewWith(G){return this.checkout.viewWith(G)}async loadCore(G){await super.loadCore(G),this.checkout.load()}didAttach(){if(this.checkout.transaction.isInProgress())throw new r.UsageError("Cannot attach while a transaction is in progress. Commit or abort the transaction before attaching.");super.didAttach()}applyStashedOp(...G){(0,i.assert)(!this.checkout.transaction.isInProgress(),1652),super.applyStashedOp(...G)}submitCommit(G,ee,se){if((0,i.assert)(!this.checkout.transaction.isInProgress(),2726),se)return super.submitCommit(G,ee,se);this.checkout.onCommitValid(G,()=>super.submitCommit(G,ee,se))}onDisconnect(){}},t(k,"SharedTreeKernel"),(()=>{const G=typeof Symbol=="function"&&Symbol.metadata?Object.create(x[Symbol.metadata]??null):void 0;V=[v.throwIfBroken],a(k,null,V,{kind:"method",name:"contentSnapshot",static:!1,private:!1,access:{has:ee=>"contentSnapshot"in ee,get:ee=>ee.contentSnapshot},metadata:G},null,L),a(null,M={value:k},R,{kind:"class",name:k.name,metadata:G},null,j),k=M.value,G&&Object.defineProperty(k,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:G}),n(k,j)})(),k})();e.SharedTreeKernel=g;function _(R){return{root:E(R.rootFieldSchema),definitions:new Map([...R.nodeSchema].map(([M,j])=>[M,F(j)]))}}e.exportSimpleSchema=_;function S(R,M){const k=(0,u.makeSchemaCodec)(M,o.SchemaVersion.v1).decode(R);return _(k)}e.persistedToSimpleSchema=S;function p(R){if(R instanceof l.SchematizingSimpleTreeView)return R.checkout;const M=R.kernel;return(0,i.assert)(M instanceof g,2902),M.checkout}e.getBranch=p,e.SharedTreeFormatVersion={v1:1,v2:2,v3:3,v5:5},e.ForestTypeReference=(R,M,j)=>(0,u.buildForest)(R,M),e.ForestTypeOptimized=(R,M,j)=>(0,u.buildChunkedForest)((0,u.makeTreeChunker)(M,u.defaultSchemaPolicy),void 0,j),e.ForestTypeExpensiveDebug=(R,M)=>(0,u.buildForest)(R,M,void 0,!0);function w(R){return R}function O(R,M,j,k){return M(R,j,k)}e.buildConfiguredForest=O,e.defaultSharedTreeOptions={jsonValidator:s.noopValidator,oldestCompatibleClient:s.FluidClientVersion.v2_0,forest:e.ForestTypeReference,treeEncodeType:u.TreeCompressionStrategy.Compressed,formatVersion:e.SharedTreeFormatVersion.v3,disposeForksAfterTransaction:!0,shouldEncodeFieldIncrementally:(R,M)=>!1};function E(R){let M;switch(R.kind){case u.FieldKinds.identifier.identifier:M=d.FieldKind.Identifier;break;case u.FieldKinds.optional.identifier:M=d.FieldKind.Optional;break;case u.FieldKinds.required.identifier:M=d.FieldKind.Required;break;case u.FieldKinds.forbidden.identifier:M=d.FieldKind.Optional,(0,i.assert)(R.types.size===0,2708);break;default:(0,i.fail)(2762)}return{kind:M,allowedTypesIdentifiers:R.types,metadata:{},persistedMetadata:R.persistedMetadata}}function F(R){const M=(0,d.tryStoredSchemaAsArray)(R);if(M!==void 0)return{kind:d.NodeKind.Array,allowedTypesIdentifiers:M,metadata:{},persistedMetadata:R.metadata};if(R instanceof o.ObjectNodeStoredSchema){const j=new Map;for(const[k,x]of R.objectNodeFields)j.set(k,{...E(x),storedKey:k});return{kind:d.NodeKind.Object,fields:j,metadata:{},persistedMetadata:R.metadata}}if(R instanceof o.MapNodeStoredSchema)return(0,i.assert)(R.mapFields.kind===u.FieldKinds.optional.identifier,2709),{kind:d.NodeKind.Map,allowedTypesIdentifiers:R.mapFields.types,metadata:{},persistedMetadata:R.metadata};if(R instanceof o.LeafNodeStoredSchema)return{kind:d.NodeKind.Leaf,leafKind:R.leafValue,metadata:{},persistedMetadata:R.metadata};(0,i.fail)(2763)}})(Fu)),Fu}var hN={},VW;function SSe(){return VW||(VW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.runTransaction=e.Tree=void 0;const n=Ot(),a=Je(),t=gd(),i=mb(),r=An();e.Tree={...t.treeNodeApi,runTransaction:s(),contains(c,d){let l=d;for(;l!==void 0;){if(l===c)return!0;l=e.Tree.parent(l)}return!1}};function s(){function c(d){return Reflect.defineProperty(d,"rollback",{value:t.rollback}),d}return c(o.bind({}))}function o(c,d,l=[]){if(c instanceof i.SchematizingSimpleTreeView){const f=d;return u(c.checkout,()=>f(c.root),l)}else{const f=c,b=d,C=(0,t.getOrCreateInnerNode)(f).context;if(C.isHydrated()===!1)throw new n.UsageError("Transactions cannot be run on Unhydrated nodes. Transactions apply to a TreeView and Unhydrated nodes are not part of a TreeView.");return(0,a.assert)(C instanceof r.Context,3043),u(C.checkout,()=>b(f),l)}}e.runTransaction=o;function u(c,d,l){c.transaction.start(),(0,i.addConstraintsToTransaction)(c,!1,l);let f;try{f=d()}catch(b){throw c.transaction.abort(),b}return f===t.rollback?c.transaction.abort():c.transaction.commit(),f}})(hN)),hN}var $C={},Lu={},HW;function doe(){if(HW)return Lu;HW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Lu,"__esModule",{value:!0}),Lu.independentInitializedViewInternal=Lu.independentInitializedView=Lu.independentView=void 0;const e=Je(),n=fl(),a=Vt(),t=An(),i=Bt(),r=uoe(),s=Rq(),o=mb(),u=coe();function c(f,b){const C=new i.Breakable("independentView"),v=b.idCompressor??(0,n.createIdCompressor)(),m=()=>v.generateCompressedId(),h=new a.RevisionTagCodec(v),g=new a.TreeStoredSchemaRepository,_=(0,r.buildConfiguredForest)(C,b.forest??r.defaultSharedTreeOptions.forest,g,v),S=(0,s.createTreeCheckout)(v,m,h,{forest:_,schema:g,breaker:C});return new o.SchematizingSimpleTreeView(S,f,(0,t.createNodeIdentifierManager)(v))}Lu.independentView=c;function d(f,b,C){const v=C.idCompressor,m=(0,t.makeFieldBatchCodec)(b,1),g=(0,t.makeSchemaCodec)(b,a.SchemaVersion.v1).decode(C.schema),_={encodeType:t.TreeCompressionStrategy.Compressed,idCompressor:v,originatorId:v.localSessionId,schema:{schema:g,policy:t.defaultSchemaPolicy}},S=m.decode(C.tree,_);return(0,e.assert)(S.length===1,2651),l(f,b,g,S[0],v)}Lu.independentInitializedView=d;function l(f,b,C,v,m){const h=new i.Breakable("independentInitializedView"),g=new a.RevisionTagCodec(m),_=()=>m.generateCompressedId(),S=new a.TreeStoredSchemaRepository,p=(0,r.buildConfiguredForest)(h,b.forest??r.defaultSharedTreeOptions.forest,S,m),w=(0,s.createTreeCheckout)(m,_,g,{forest:p,schema:S,breaker:h});return(0,u.initialize)(w,C,(0,u.initializerFromChunk)(w,()=>w.forest.chunkField(v))),new o.SchematizingSimpleTreeView(w,f,(0,t.createNodeIdentifierManager)(m))}return Lu.independentInitializedViewInternal=l,Lu}var KW;function CSe(){if(KW)return $C;KW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty($C,"__esModule",{value:!0}),$C.TreeAlpha=void 0;const e=Je(),n=fl(),a=Ot(),t=gd(),i=Bt(),r=zn(),s=Vt(),o=An(),u=doe(),c=mb(),d=C=>{const v=(0,t.getIdentifierFromNode)(C,"uncompressed");if(typeof v=="number")throw new TypeError("identifier should be uncompressed.");return v};d.shorten=(C,v)=>{const h=C.nodeKeyManager.tryLocalizeNodeIdentifier(v);return h!==void 0?(0,i.extractFromOpaque)(h):void 0},d.lengthen=(C,v)=>C.nodeKeyManager.stabilizeNodeIdentifier(v),d.getShort=C=>{const v=(0,t.getIdentifierFromNode)(C,"compressed");return typeof v=="number"?v:void 0},d.create=C=>{const v=C.nodeKeyManager;return v.stabilizeNodeIdentifier(v.generateLocalNodeIdentifier())},Object.freeze(d),$C.TreeAlpha={branch(C){const v=(0,t.getKernel)(C);if(!v.isHydrated())return;const m=v.anchorNode.anchorSet.slots.get(c.ViewSlot);return(0,e.assert)(m instanceof c.SchematizingSimpleTreeView,2652),m},create(C,v){const m=(0,t.unhydratedFlexTreeFromInsertable)(v,C);return m===void 0?void 0:(0,t.getOrCreateNodeFromInnerNode)(m)},importConcise(C,v){return this.create(C,v)},importVerbose(C,v,m){const h={...m},g=(0,t.applySchemaToParserOptions)(C,h);if(v===void 0){if((0,t.normalizeFieldSchema)(C).kind!==t.FieldKind.Optional)throw new a.UsageError("undefined provided for non-optional field.");return}const _=(0,t.cursorFromVerbose)(v,g);return(0,t.createFromCursor)(C,_,(0,t.convertField)((0,t.normalizeFieldSchema)(C),t.toUnhydratedSchema))},exportConcise:l,exportVerbose(C,v){if((0,o.isTreeValue)(C))return C;const m={...v},h=f(C),g=(0,t.getKernel)(C);return(0,t.verboseFromCursor)(h,g.context,m)},exportCompressed(C,v){const m=(0,t.tryGetSchema)(C)??(0,e.fail)(2767),h=(0,o.fluidVersionToFieldBatchCodecWriteVersion)(v.oldestCompatibleClient),g=(0,o.makeFieldBatchCodec)({jsonValidator:r.noopValidator},h),S=[b(C)],p=v.idCompressor??(0,n.createIdCompressor)(),w=(0,t.isTreeNode)(C)?(0,t.getKernel)(C).context.flexContext.schema:(0,t.toInitialSchema)(m),O={encodeType:o.TreeCompressionStrategy.Compressed,idCompressor:p,originatorId:p.localSessionId,schema:{schema:w,policy:o.defaultSchemaPolicy}};return g.encode(S,O)},importCompressed(C,v,m){const h=new t.TreeViewConfigurationAlpha({schema:C}),g={schema:(0,t.extractPersistedSchema)(h.schema,r.FluidClientVersion.v2_0,()=>!0),tree:v,idCompressor:m.idCompressor??(0,n.createIdCompressor)()},_=(0,u.independentInitializedView)(h,m,g);return t.TreeBeta.clone(_.root)},identifier:d,key2(C){const v=t.treeNodeApi.parent(C);if(v===void 0)return;const m=(0,t.getStoredKey)(C),h=t.treeNodeApi.schema(v);return(0,t.getPropertyKeyFromStoredKey)(h,m)},child:(C,v)=>{const m=(0,t.getOrCreateInnerNode)(C);(0,e.debugAssert)(()=>!m.context.isDisposed()||"The provided tree node has been disposed.");const h=t.treeNodeApi.schema(C);switch(h.kind){case t.NodeKind.Array:{const g=m.tryGetField(s.EmptyKey);if(g===void 0)return;const _=typeof v=="number"?v:(0,t.asIndex)(v,Number.POSITIVE_INFINITY);if(_===void 0)return;const S=g.at(_);return S===void 0?void 0:(0,t.getOrCreateNodeFromInnerUnboxedNode)(S)}case t.NodeKind.Map:if(typeof v!="string")return;case t.NodeKind.Record:case t.NodeKind.Object:{let g=v;if((0,t.isObjectNodeSchema)(h)){const S=h.fields.get(String(v));if(S===void 0)return;g=S.storedKey}const _=m.tryGetField((0,i.brand)(String(g)));return _!==void 0?(0,t.tryGetTreeNodeForField)(_):void 0}case t.NodeKind.Leaf:(0,e.fail)(3011);default:(0,e.unreachableCase)(h.kind)}},children(C){const v=(0,t.getOrCreateInnerNode)(C);(0,e.debugAssert)(()=>!v.context.isDisposed()||"The provided tree node has been disposed.");const m=t.treeNodeApi.schema(C),h=[];switch(m.kind){case t.NodeKind.Array:{const g=v.tryGetField(s.EmptyKey);if(g===void 0)break;for(let _=0;_<g.length;_++){const S=g.at(_);(0,e.assert)(S!==void 0,3012);const p=(0,t.getOrCreateNodeFromInnerUnboxedNode)(S);h.push([_,p])}break}case t.NodeKind.Map:case t.NodeKind.Record:{for(const[g,_]of v.fields){const S=(0,t.tryGetTreeNodeForField)(_);S!==void 0&&h.push([g,S])}break}case t.NodeKind.Object:{(0,e.assert)((0,t.isObjectNodeSchema)(m),3013);for(const[g,_]of m.fields){const S=_.storedKey,p=v.tryGetField((0,i.brand)(String(S)));if(p!==void 0){const w=(0,t.tryGetTreeNodeForField)(p);(0,e.assert)(w!==void 0,3014),h.push([g,w])}}break}case t.NodeKind.Leaf:(0,e.fail)(3015);default:(0,e.unreachableCase)(m.kind)}return h}};function l(C,v){if(!(0,t.isTreeNode)(C))return C;const m={...v},h=(0,t.getKernel)(C),g=f(C);return(0,t.conciseFromCursor)(g,h.context,m)}function f(C){return(0,o.isTreeValue)(C)?(0,t.cursorFromVerbose)(C,{}):(0,t.getKernel)(C).getOrCreateInnerNode().borrowCursor()}function b(C){if(C===void 0)return(0,o.cursorForMapTreeField)([]);const v=f(C),m=(0,o.mapTreeFromCursor)(v);return(0,o.cursorForMapTreeField)([m])}return $C}var $W;function eE(){return $W||($W=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.independentView=e.independentInitializedView=e.TreeAlpha=e.Tree=e.SchematizingSimpleTreeView=e.TreeCheckout=e.createTreeCheckout=e.persistedToSimpleSchema=e.exportSimpleSchema=e.ForestTypeReference=e.ForestTypeExpensiveDebug=e.ForestTypeOptimized=e.defaultSharedTreeOptions=e.buildConfiguredForest=e.SharedTreeFormatVersion=e.getBranch=e.SharedTreeKernel=void 0;var n=uoe();Object.defineProperty(e,"SharedTreeKernel",{enumerable:!0,get:function(){return n.SharedTreeKernel}}),Object.defineProperty(e,"getBranch",{enumerable:!0,get:function(){return n.getBranch}}),Object.defineProperty(e,"SharedTreeFormatVersion",{enumerable:!0,get:function(){return n.SharedTreeFormatVersion}}),Object.defineProperty(e,"buildConfiguredForest",{enumerable:!0,get:function(){return n.buildConfiguredForest}}),Object.defineProperty(e,"defaultSharedTreeOptions",{enumerable:!0,get:function(){return n.defaultSharedTreeOptions}}),Object.defineProperty(e,"ForestTypeOptimized",{enumerable:!0,get:function(){return n.ForestTypeOptimized}}),Object.defineProperty(e,"ForestTypeExpensiveDebug",{enumerable:!0,get:function(){return n.ForestTypeExpensiveDebug}}),Object.defineProperty(e,"ForestTypeReference",{enumerable:!0,get:function(){return n.ForestTypeReference}}),Object.defineProperty(e,"exportSimpleSchema",{enumerable:!0,get:function(){return n.exportSimpleSchema}}),Object.defineProperty(e,"persistedToSimpleSchema",{enumerable:!0,get:function(){return n.persistedToSimpleSchema}});var a=Rq();Object.defineProperty(e,"createTreeCheckout",{enumerable:!0,get:function(){return a.createTreeCheckout}}),Object.defineProperty(e,"TreeCheckout",{enumerable:!0,get:function(){return a.TreeCheckout}});var t=mb();Object.defineProperty(e,"SchematizingSimpleTreeView",{enumerable:!0,get:function(){return t.SchematizingSimpleTreeView}});var i=SSe();Object.defineProperty(e,"Tree",{enumerable:!0,get:function(){return i.Tree}});var r=CSe();Object.defineProperty(e,"TreeAlpha",{enumerable:!0,get:function(){return r.TreeAlpha}});var s=doe();Object.defineProperty(e,"independentInitializedView",{enumerable:!0,get:function(){return s.independentInitializedView}}),Object.defineProperty(e,"independentView",{enumerable:!0,get:function(){return s.independentView}})})(WM)),WM}var dp={},mN={},GW;function loe(){return GW||(GW=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.SharedTreeAttributes=e.SharedTreeFactoryType=void 0;const n=eae();e.SharedTreeFactoryType="https://graph.microsoft.com/types/tree",e.SharedTreeAttributes={type:e.SharedTreeFactoryType,snapshotFormatVersion:"0.0.0",packageVersion:n.pkgVersion}})(mN)),mN}var WW;function _Se(){if(WW)return dp;WW=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(dp,"__esModule",{value:!0}),dp.configuredSharedTree=dp.SharedTree=void 0;const e=Ma(),n=Ot(),a=eE(),t=loe(),i=Bt(),r=zn();function s(u){function c(d){if(d.idCompressor===void 0)throw new n.UsageError("IdCompressor must be enabled to use SharedTree");const l={...u};return l.oldestCompatibleClient??=r.FluidClientVersion.v2_0,new a.SharedTreeKernel(new i.Breakable("SharedTree"),d.sharedObject,d.serializer,d.submitLocalMessage,d.lastSequenceNumber,d.logger,d.idCompressor,l)}return{create:d=>{const l=c(d);return{kernel:l,view:l.view}},async loadCore(d,l){const f=c(d);return await f.loadCore(l),{kernel:f,view:f.view}}}}dp.SharedTree=o({});function o(u){const c={type:t.SharedTreeFactoryType,attributes:t.SharedTreeAttributes,telemetryContextPrefix:"fluid_sharedTree_",factory:s(u)};return(0,e.makeSharedObjectKind)(c)}return dp.configuredSharedTree=o,dp}var pN={},gN={},lp={},fp={},yc={},hp={},Bu={},JW;function TSe(){if(JW)return Bu;JW=1,Object.defineProperty(Bu,"__esModule",{value:!0}),Bu.TypeSystem=Bu.TypeSystemDuplicateFormat=Bu.TypeSystemDuplicateTypeKind=void 0;const e=fT(),n=VE(),a=Xt(),t=ss();class i extends t.TypeBoxError{constructor(u){super(`Duplicate type kind '${u}' detected`)}}Bu.TypeSystemDuplicateTypeKind=i;class r extends t.TypeBoxError{constructor(u){super(`Duplicate string format '${u}' detected`)}}Bu.TypeSystemDuplicateFormat=r;var s;return(function(o){function u(d,l){if(e.TypeRegistry.Has(d))throw new i(d);return e.TypeRegistry.Set(d,l),(f={})=>(0,n.Unsafe)({...f,[a.Kind]:d})}o.Type=u;function c(d,l){if(e.FormatRegistry.Has(d))throw new r(d);return e.FormatRegistry.Set(d,l),d}o.Format=c})(s||(Bu.TypeSystem=s={})),Bu}var QW;function Fq(){return QW||(QW=1,(function(e){var n=hp&&hp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=hp&&hp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(PE(),e),a(TSe(),e)})(hp)),hp}var $y={},YW;function foe(){if(YW)return $y;YW=1,Object.defineProperty($y,"__esModule",{value:!0}),$y.DefaultErrorFunction=a,$y.SetErrorFunction=i,$y.GetErrorFunction=r;const e=Xt(),n=hoe();function a(s){switch(s.errorType){case n.ValueErrorType.ArrayContains:return"Expected array to contain at least one matching value";case n.ValueErrorType.ArrayMaxContains:return`Expected array to contain no more than ${s.schema.maxContains} matching values`;case n.ValueErrorType.ArrayMinContains:return`Expected array to contain at least ${s.schema.minContains} matching values`;case n.ValueErrorType.ArrayMaxItems:return`Expected array length to be less or equal to ${s.schema.maxItems}`;case n.ValueErrorType.ArrayMinItems:return`Expected array length to be greater or equal to ${s.schema.minItems}`;case n.ValueErrorType.ArrayUniqueItems:return"Expected array elements to be unique";case n.ValueErrorType.Array:return"Expected array";case n.ValueErrorType.AsyncIterator:return"Expected AsyncIterator";case n.ValueErrorType.BigIntExclusiveMaximum:return`Expected bigint to be less than ${s.schema.exclusiveMaximum}`;case n.ValueErrorType.BigIntExclusiveMinimum:return`Expected bigint to be greater than ${s.schema.exclusiveMinimum}`;case n.ValueErrorType.BigIntMaximum:return`Expected bigint to be less or equal to ${s.schema.maximum}`;case n.ValueErrorType.BigIntMinimum:return`Expected bigint to be greater or equal to ${s.schema.minimum}`;case n.ValueErrorType.BigIntMultipleOf:return`Expected bigint to be a multiple of ${s.schema.multipleOf}`;case n.ValueErrorType.BigInt:return"Expected bigint";case n.ValueErrorType.Boolean:return"Expected boolean";case n.ValueErrorType.DateExclusiveMinimumTimestamp:return`Expected Date timestamp to be greater than ${s.schema.exclusiveMinimumTimestamp}`;case n.ValueErrorType.DateExclusiveMaximumTimestamp:return`Expected Date timestamp to be less than ${s.schema.exclusiveMaximumTimestamp}`;case n.ValueErrorType.DateMinimumTimestamp:return`Expected Date timestamp to be greater or equal to ${s.schema.minimumTimestamp}`;case n.ValueErrorType.DateMaximumTimestamp:return`Expected Date timestamp to be less or equal to ${s.schema.maximumTimestamp}`;case n.ValueErrorType.DateMultipleOfTimestamp:return`Expected Date timestamp to be a multiple of ${s.schema.multipleOfTimestamp}`;case n.ValueErrorType.Date:return"Expected Date";case n.ValueErrorType.Function:return"Expected function";case n.ValueErrorType.IntegerExclusiveMaximum:return`Expected integer to be less than ${s.schema.exclusiveMaximum}`;case n.ValueErrorType.IntegerExclusiveMinimum:return`Expected integer to be greater than ${s.schema.exclusiveMinimum}`;case n.ValueErrorType.IntegerMaximum:return`Expected integer to be less or equal to ${s.schema.maximum}`;case n.ValueErrorType.IntegerMinimum:return`Expected integer to be greater or equal to ${s.schema.minimum}`;case n.ValueErrorType.IntegerMultipleOf:return`Expected integer to be a multiple of ${s.schema.multipleOf}`;case n.ValueErrorType.Integer:return"Expected integer";case n.ValueErrorType.IntersectUnevaluatedProperties:return"Unexpected property";case n.ValueErrorType.Intersect:return"Expected all values to match";case n.ValueErrorType.Iterator:return"Expected Iterator";case n.ValueErrorType.Literal:return`Expected ${typeof s.schema.const=="string"?`'${s.schema.const}'`:s.schema.const}`;case n.ValueErrorType.Never:return"Never";case n.ValueErrorType.Not:return"Value should not match";case n.ValueErrorType.Null:return"Expected null";case n.ValueErrorType.NumberExclusiveMaximum:return`Expected number to be less than ${s.schema.exclusiveMaximum}`;case n.ValueErrorType.NumberExclusiveMinimum:return`Expected number to be greater than ${s.schema.exclusiveMinimum}`;case n.ValueErrorType.NumberMaximum:return`Expected number to be less or equal to ${s.schema.maximum}`;case n.ValueErrorType.NumberMinimum:return`Expected number to be greater or equal to ${s.schema.minimum}`;case n.ValueErrorType.NumberMultipleOf:return`Expected number to be a multiple of ${s.schema.multipleOf}`;case n.ValueErrorType.Number:return"Expected number";case n.ValueErrorType.Object:return"Expected object";case n.ValueErrorType.ObjectAdditionalProperties:return"Unexpected property";case n.ValueErrorType.ObjectMaxProperties:return`Expected object to have no more than ${s.schema.maxProperties} properties`;case n.ValueErrorType.ObjectMinProperties:return`Expected object to have at least ${s.schema.minProperties} properties`;case n.ValueErrorType.ObjectRequiredProperty:return"Expected required property";case n.ValueErrorType.Promise:return"Expected Promise";case n.ValueErrorType.RegExp:return"Expected string to match regular expression";case n.ValueErrorType.StringFormatUnknown:return`Unknown format '${s.schema.format}'`;case n.ValueErrorType.StringFormat:return`Expected string to match '${s.schema.format}' format`;case n.ValueErrorType.StringMaxLength:return`Expected string length less or equal to ${s.schema.maxLength}`;case n.ValueErrorType.StringMinLength:return`Expected string length greater or equal to ${s.schema.minLength}`;case n.ValueErrorType.StringPattern:return`Expected string to match '${s.schema.pattern}'`;case n.ValueErrorType.String:return"Expected string";case n.ValueErrorType.Symbol:return"Expected symbol";case n.ValueErrorType.TupleLength:return`Expected tuple to have ${s.schema.maxItems||0} elements`;case n.ValueErrorType.Tuple:return"Expected tuple";case n.ValueErrorType.Uint8ArrayMaxByteLength:return`Expected byte length less or equal to ${s.schema.maxByteLength}`;case n.ValueErrorType.Uint8ArrayMinByteLength:return`Expected byte length greater or equal to ${s.schema.minByteLength}`;case n.ValueErrorType.Uint8Array:return"Expected Uint8Array";case n.ValueErrorType.Undefined:return"Expected undefined";case n.ValueErrorType.Union:return"Expected union value";case n.ValueErrorType.Void:return"Expected void";case n.ValueErrorType.Kind:return`Expected kind '${s.schema[e.Kind]}'`;default:return"Unknown error type"}}let t=a;function i(s){t=s}function r(){return t}return $y}var mp={},pp={},XW;function wSe(){if(XW)return pp;XW=1,Object.defineProperty(pp,"__esModule",{value:!0}),pp.TypeDereferenceError=void 0,pp.Pushref=r,pp.Deref=s;const e=ss(),n=Xt(),a=mse();class t extends e.TypeBoxError{constructor(u){super(`Unable to dereference schema with $id '${u.$ref}'`),this.schema=u}}pp.TypeDereferenceError=t;function i(o,u){const c=u.find(d=>d.$id===o.$ref);if(c===void 0)throw new t(o);return s(c,u)}function r(o,u){return!(0,a.IsString)(o.$id)||u.some(c=>c.$id===o.$id)||u.push(o),u}function s(o,u){return o[n.Kind]==="This"||o[n.Kind]==="Ref"?i(o,u):o}return pp}var ZW;function pb(){return ZW||(ZW=1,(function(e){var n=mp&&mp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=mp&&mp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(wSe(),e)})(mp)),mp}var gp={},Gy={},eJ;function OSe(){if(eJ)return Gy;eJ=1,Object.defineProperty(Gy,"__esModule",{value:!0}),Gy.ValueHashError=void 0,Gy.Hash=F;const e=hl(),n=ss();class a extends n.TypeBoxError{constructor(M){super("Unable to hash value"),this.value=M}}Gy.ValueHashError=a;var t;(function(R){R[R.Undefined=0]="Undefined",R[R.Null=1]="Null",R[R.Boolean=2]="Boolean",R[R.Number=3]="Number",R[R.String=4]="String",R[R.Object=5]="Object",R[R.Array=6]="Array",R[R.Date=7]="Date",R[R.Uint8Array=8]="Uint8Array",R[R.Symbol=9]="Symbol",R[R.BigInt=10]="BigInt"})(t||(t={}));let i=BigInt("14695981039346656037");const[r,s]=[BigInt("1099511628211"),BigInt("18446744073709551616")],o=Array.from({length:256}).map((R,M)=>BigInt(M)),u=new Float64Array(1),c=new DataView(u.buffer),d=new Uint8Array(u.buffer);function*l(R){const M=R===0?1:Math.ceil(Math.floor(Math.log2(R)+1)/8);for(let j=0;j<M;j++)yield R>>8*(M-1-j)&255}function f(R){E(t.Array);for(const M of R)O(M)}function b(R){E(t.Boolean),E(R?1:0)}function C(R){E(t.BigInt),c.setBigInt64(0,R);for(const M of d)E(M)}function v(R){E(t.Date),O(R.getTime())}function m(R){E(t.Null)}function h(R){E(t.Number),c.setFloat64(0,R);for(const M of d)E(M)}function g(R){E(t.Object);for(const M of globalThis.Object.getOwnPropertyNames(R).sort())O(M),O(R[M])}function _(R){E(t.String);for(let M=0;M<R.length;M++)for(const j of l(R.charCodeAt(M)))E(j)}function S(R){E(t.Symbol),O(R.description)}function p(R){E(t.Uint8Array);for(let M=0;M<R.length;M++)E(R[M])}function w(R){return E(t.Undefined)}function O(R){if((0,e.IsArray)(R))return f(R);if((0,e.IsBoolean)(R))return b(R);if((0,e.IsBigInt)(R))return C(R);if((0,e.IsDate)(R))return v(R);if((0,e.IsNull)(R))return m();if((0,e.IsNumber)(R))return h(R);if((0,e.IsObject)(R))return g(R);if((0,e.IsString)(R))return _(R);if((0,e.IsSymbol)(R))return S(R);if((0,e.IsUint8Array)(R))return p(R);if((0,e.IsUndefined)(R))return w();throw new a(R)}function E(R){i=i^o[R],i=i*r%s}function F(R){return i=BigInt("14695981039346656037"),O(R),i}return Gy}var tJ;function jq(){return tJ||(tJ=1,(function(e){var n=gp&&gp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=gp&&gp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(OSe(),e)})(gp)),gp}var yp={},Wy={},nJ;function PSe(){if(nJ)return Wy;nJ=1,Object.defineProperty(Wy,"__esModule",{value:!0}),Wy.ValueCheckUnknownTypeError=void 0,Wy.Check=Nt;const e=Fq(),n=pb(),a=jq(),t=Xt(),i=wc(),r=ub(),s=fT(),o=ss(),u=bi(),c=hl(),d=Dn();class l extends o.TypeBoxError{constructor(Ge){super("Unknown type"),this.schema=Ge}}Wy.ValueCheckUnknownTypeError=l;function f(Ke){return Ke[t.Kind]==="Any"||Ke[t.Kind]==="Unknown"}function b(Ke){return Ke!==void 0}function C(Ke,Ge,Re){return!0}function v(Ke,Ge,Re){return!0}function m(Ke,Ge,Re){if(!(0,c.IsArray)(Re)||b(Ke.minItems)&&!(Re.length>=Ke.minItems)||b(Ke.maxItems)&&!(Re.length<=Ke.maxItems)||!Re.every(Me=>pt(Ke.items,Ge,Me))||Ke.uniqueItems===!0&&!(function(){const Me=new Set;for(const K of Re){const Z=(0,a.Hash)(K);if(Me.has(Z))return!1;Me.add(Z)}return!0})())return!1;if(!(b(Ke.contains)||(0,c.IsNumber)(Ke.minContains)||(0,c.IsNumber)(Ke.maxContains)))return!0;const Qe=b(Ke.contains)?Ke.contains:(0,u.Never)(),Y=Re.reduce((Me,K)=>pt(Qe,Ge,K)?Me+1:Me,0);return!(Y===0||(0,c.IsNumber)(Ke.minContains)&&Y<Ke.minContains||(0,c.IsNumber)(Ke.maxContains)&&Y>Ke.maxContains)}function h(Ke,Ge,Re){return(0,c.IsAsyncIterator)(Re)}function g(Ke,Ge,Re){return!(!(0,c.IsBigInt)(Re)||b(Ke.exclusiveMaximum)&&!(Re<Ke.exclusiveMaximum)||b(Ke.exclusiveMinimum)&&!(Re>Ke.exclusiveMinimum)||b(Ke.maximum)&&!(Re<=Ke.maximum)||b(Ke.minimum)&&!(Re>=Ke.minimum)||b(Ke.multipleOf)&&Re%Ke.multipleOf!==BigInt(0))}function _(Ke,Ge,Re){return(0,c.IsBoolean)(Re)}function S(Ke,Ge,Re){return pt(Ke.returns,Ge,Re.prototype)}function p(Ke,Ge,Re){return!(!(0,c.IsDate)(Re)||b(Ke.exclusiveMaximumTimestamp)&&!(Re.getTime()<Ke.exclusiveMaximumTimestamp)||b(Ke.exclusiveMinimumTimestamp)&&!(Re.getTime()>Ke.exclusiveMinimumTimestamp)||b(Ke.maximumTimestamp)&&!(Re.getTime()<=Ke.maximumTimestamp)||b(Ke.minimumTimestamp)&&!(Re.getTime()>=Ke.minimumTimestamp)||b(Ke.multipleOfTimestamp)&&Re.getTime()%Ke.multipleOfTimestamp!==0)}function w(Ke,Ge,Re){return(0,c.IsFunction)(Re)}function O(Ke,Ge,Re){const Qe=globalThis.Object.values(Ke.$defs),Y=Ke.$defs[Ke.$ref];return pt(Y,[...Ge,...Qe],Re)}function E(Ke,Ge,Re){return!(!(0,c.IsInteger)(Re)||b(Ke.exclusiveMaximum)&&!(Re<Ke.exclusiveMaximum)||b(Ke.exclusiveMinimum)&&!(Re>Ke.exclusiveMinimum)||b(Ke.maximum)&&!(Re<=Ke.maximum)||b(Ke.minimum)&&!(Re>=Ke.minimum)||b(Ke.multipleOf)&&Re%Ke.multipleOf!==0)}function F(Ke,Ge,Re){const Qe=Ke.allOf.every(Y=>pt(Y,Ge,Re));if(Ke.unevaluatedProperties===!1){const Y=new RegExp((0,i.KeyOfPattern)(Ke)),Me=Object.getOwnPropertyNames(Re).every(K=>Y.test(K));return Qe&&Me}else if((0,d.IsSchema)(Ke.unevaluatedProperties)){const Y=new RegExp((0,i.KeyOfPattern)(Ke)),Me=Object.getOwnPropertyNames(Re).every(K=>Y.test(K)||pt(Ke.unevaluatedProperties,Ge,Re[K]));return Qe&&Me}else return Qe}function R(Ke,Ge,Re){return(0,c.IsIterator)(Re)}function M(Ke,Ge,Re){return Re===Ke.const}function j(Ke,Ge,Re){return!1}function k(Ke,Ge,Re){return!pt(Ke.not,Ge,Re)}function x(Ke,Ge,Re){return(0,c.IsNull)(Re)}function L(Ke,Ge,Re){return!(!e.TypeSystemPolicy.IsNumberLike(Re)||b(Ke.exclusiveMaximum)&&!(Re<Ke.exclusiveMaximum)||b(Ke.exclusiveMinimum)&&!(Re>Ke.exclusiveMinimum)||b(Ke.minimum)&&!(Re>=Ke.minimum)||b(Ke.maximum)&&!(Re<=Ke.maximum)||b(Ke.multipleOf)&&Re%Ke.multipleOf!==0)}function V(Ke,Ge,Re){if(!e.TypeSystemPolicy.IsObjectLike(Re)||b(Ke.minProperties)&&!(Object.getOwnPropertyNames(Re).length>=Ke.minProperties)||b(Ke.maxProperties)&&!(Object.getOwnPropertyNames(Re).length<=Ke.maxProperties))return!1;const Qe=Object.getOwnPropertyNames(Ke.properties);for(const Y of Qe){const Me=Ke.properties[Y];if(Ke.required&&Ke.required.includes(Y)){if(!pt(Me,Ge,Re[Y])||((0,r.ExtendsUndefinedCheck)(Me)||f(Me))&&!(Y in Re))return!1}else if(e.TypeSystemPolicy.IsExactOptionalProperty(Re,Y)&&!pt(Me,Ge,Re[Y]))return!1}if(Ke.additionalProperties===!1){const Y=Object.getOwnPropertyNames(Re);return Ke.required&&Ke.required.length===Qe.length&&Y.length===Qe.length?!0:Y.every(Me=>Qe.includes(Me))}else return typeof Ke.additionalProperties=="object"?Object.getOwnPropertyNames(Re).every(Me=>Qe.includes(Me)||pt(Ke.additionalProperties,Ge,Re[Me])):!0}function G(Ke,Ge,Re){return(0,c.IsPromise)(Re)}function ee(Ke,Ge,Re){if(!e.TypeSystemPolicy.IsRecordLike(Re)||b(Ke.minProperties)&&!(Object.getOwnPropertyNames(Re).length>=Ke.minProperties)||b(Ke.maxProperties)&&!(Object.getOwnPropertyNames(Re).length<=Ke.maxProperties))return!1;const[Qe,Y]=Object.entries(Ke.patternProperties)[0],Me=new RegExp(Qe),K=Object.entries(Re).every(([we,qe])=>Me.test(we)?pt(Y,Ge,qe):!0),Z=typeof Ke.additionalProperties=="object"?Object.entries(Re).every(([we,qe])=>Me.test(we)?!0:pt(Ke.additionalProperties,Ge,qe)):!0,me=Ke.additionalProperties===!1?Object.getOwnPropertyNames(Re).every(we=>Me.test(we)):!0;return K&&Z&&me}function se(Ke,Ge,Re){return pt((0,n.Deref)(Ke,Ge),Ge,Re)}function re(Ke,Ge,Re){const Qe=new RegExp(Ke.source,Ke.flags);return b(Ke.minLength)&&!(Re.length>=Ke.minLength)||b(Ke.maxLength)&&!(Re.length<=Ke.maxLength)?!1:Qe.test(Re)}function fe(Ke,Ge,Re){return!(0,c.IsString)(Re)||b(Ke.minLength)&&!(Re.length>=Ke.minLength)||b(Ke.maxLength)&&!(Re.length<=Ke.maxLength)||b(Ke.pattern)&&!new RegExp(Ke.pattern).test(Re)?!1:b(Ke.format)?s.FormatRegistry.Has(Ke.format)?s.FormatRegistry.Get(Ke.format)(Re):!1:!0}function oe(Ke,Ge,Re){return(0,c.IsSymbol)(Re)}function pe(Ke,Ge,Re){return(0,c.IsString)(Re)&&new RegExp(Ke.pattern).test(Re)}function de(Ke,Ge,Re){return pt((0,n.Deref)(Ke,Ge),Ge,Re)}function ge(Ke,Ge,Re){if(!(0,c.IsArray)(Re)||Ke.items===void 0&&Re.length!==0||Re.length!==Ke.maxItems)return!1;if(!Ke.items)return!0;for(let Qe=0;Qe<Ke.items.length;Qe++)if(!pt(Ke.items[Qe],Ge,Re[Qe]))return!1;return!0}function Ce(Ke,Ge,Re){return(0,c.IsUndefined)(Re)}function Fe(Ke,Ge,Re){return Ke.anyOf.some(Qe=>pt(Qe,Ge,Re))}function We(Ke,Ge,Re){return!(!(0,c.IsUint8Array)(Re)||b(Ke.maxByteLength)&&!(Re.length<=Ke.maxByteLength)||b(Ke.minByteLength)&&!(Re.length>=Ke.minByteLength))}function Ze(Ke,Ge,Re){return!0}function lt(Ke,Ge,Re){return e.TypeSystemPolicy.IsVoidLike(Re)}function ut(Ke,Ge,Re){return s.TypeRegistry.Has(Ke[t.Kind])?s.TypeRegistry.Get(Ke[t.Kind])(Ke,Re):!1}function pt(Ke,Ge,Re){const Qe=b(Ke.$id)?(0,n.Pushref)(Ke,Ge):Ge,Y=Ke;switch(Y[t.Kind]){case"Any":return C();case"Argument":return v();case"Array":return m(Y,Qe,Re);case"AsyncIterator":return h(Y,Qe,Re);case"BigInt":return g(Y,Qe,Re);case"Boolean":return _(Y,Qe,Re);case"Constructor":return S(Y,Qe,Re);case"Date":return p(Y,Qe,Re);case"Function":return w(Y,Qe,Re);case"Import":return O(Y,Qe,Re);case"Integer":return E(Y,Qe,Re);case"Intersect":return F(Y,Qe,Re);case"Iterator":return R(Y,Qe,Re);case"Literal":return M(Y,Qe,Re);case"Never":return j();case"Not":return k(Y,Qe,Re);case"Null":return x(Y,Qe,Re);case"Number":return L(Y,Qe,Re);case"Object":return V(Y,Qe,Re);case"Promise":return G(Y,Qe,Re);case"Record":return ee(Y,Qe,Re);case"Ref":return se(Y,Qe,Re);case"RegExp":return re(Y,Qe,Re);case"String":return fe(Y,Qe,Re);case"Symbol":return oe(Y,Qe,Re);case"TemplateLiteral":return pe(Y,Qe,Re);case"This":return de(Y,Qe,Re);case"Tuple":return ge(Y,Qe,Re);case"Undefined":return Ce(Y,Qe,Re);case"Union":return Fe(Y,Qe,Re);case"Uint8Array":return We(Y,Qe,Re);case"Unknown":return Ze();case"Void":return lt(Y,Qe,Re);default:if(!s.TypeRegistry.Has(Y[t.Kind]))throw new l(Y);return ut(Y,Qe,Re)}}function Nt(...Ke){return Ke.length===3?pt(Ke[0],Ke[1],Ke[2]):pt(Ke[0],[],Ke[1])}return Wy}var rJ;function Mq(){return rJ||(rJ=1,(function(e){var n=yp&&yp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=yp&&yp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(PSe(),e)})(yp)),yp}var iJ;function hoe(){if(iJ)return yc;iJ=1,Object.defineProperty(yc,"__esModule",{value:!0}),yc.ValueErrorIterator=yc.ValueErrorsUnknownTypeError=yc.ValueErrorType=void 0,yc.Errors=Qe;const e=Fq(),n=wc(),a=fT(),t=zx(),i=foe(),r=ss(),s=pb(),o=jq(),u=Mq(),c=Xt(),d=bi(),l=hl();var f;(function(Y){Y[Y.ArrayContains=0]="ArrayContains",Y[Y.ArrayMaxContains=1]="ArrayMaxContains",Y[Y.ArrayMaxItems=2]="ArrayMaxItems",Y[Y.ArrayMinContains=3]="ArrayMinContains",Y[Y.ArrayMinItems=4]="ArrayMinItems",Y[Y.ArrayUniqueItems=5]="ArrayUniqueItems",Y[Y.Array=6]="Array",Y[Y.AsyncIterator=7]="AsyncIterator",Y[Y.BigIntExclusiveMaximum=8]="BigIntExclusiveMaximum",Y[Y.BigIntExclusiveMinimum=9]="BigIntExclusiveMinimum",Y[Y.BigIntMaximum=10]="BigIntMaximum",Y[Y.BigIntMinimum=11]="BigIntMinimum",Y[Y.BigIntMultipleOf=12]="BigIntMultipleOf",Y[Y.BigInt=13]="BigInt",Y[Y.Boolean=14]="Boolean",Y[Y.DateExclusiveMaximumTimestamp=15]="DateExclusiveMaximumTimestamp",Y[Y.DateExclusiveMinimumTimestamp=16]="DateExclusiveMinimumTimestamp",Y[Y.DateMaximumTimestamp=17]="DateMaximumTimestamp",Y[Y.DateMinimumTimestamp=18]="DateMinimumTimestamp",Y[Y.DateMultipleOfTimestamp=19]="DateMultipleOfTimestamp",Y[Y.Date=20]="Date",Y[Y.Function=21]="Function",Y[Y.IntegerExclusiveMaximum=22]="IntegerExclusiveMaximum",Y[Y.IntegerExclusiveMinimum=23]="IntegerExclusiveMinimum",Y[Y.IntegerMaximum=24]="IntegerMaximum",Y[Y.IntegerMinimum=25]="IntegerMinimum",Y[Y.IntegerMultipleOf=26]="IntegerMultipleOf",Y[Y.Integer=27]="Integer",Y[Y.IntersectUnevaluatedProperties=28]="IntersectUnevaluatedProperties",Y[Y.Intersect=29]="Intersect",Y[Y.Iterator=30]="Iterator",Y[Y.Kind=31]="Kind",Y[Y.Literal=32]="Literal",Y[Y.Never=33]="Never",Y[Y.Not=34]="Not",Y[Y.Null=35]="Null",Y[Y.NumberExclusiveMaximum=36]="NumberExclusiveMaximum",Y[Y.NumberExclusiveMinimum=37]="NumberExclusiveMinimum",Y[Y.NumberMaximum=38]="NumberMaximum",Y[Y.NumberMinimum=39]="NumberMinimum",Y[Y.NumberMultipleOf=40]="NumberMultipleOf",Y[Y.Number=41]="Number",Y[Y.ObjectAdditionalProperties=42]="ObjectAdditionalProperties",Y[Y.ObjectMaxProperties=43]="ObjectMaxProperties",Y[Y.ObjectMinProperties=44]="ObjectMinProperties",Y[Y.ObjectRequiredProperty=45]="ObjectRequiredProperty",Y[Y.Object=46]="Object",Y[Y.Promise=47]="Promise",Y[Y.RegExp=48]="RegExp",Y[Y.StringFormatUnknown=49]="StringFormatUnknown",Y[Y.StringFormat=50]="StringFormat",Y[Y.StringMaxLength=51]="StringMaxLength",Y[Y.StringMinLength=52]="StringMinLength",Y[Y.StringPattern=53]="StringPattern",Y[Y.String=54]="String",Y[Y.Symbol=55]="Symbol",Y[Y.TupleLength=56]="TupleLength",Y[Y.Tuple=57]="Tuple",Y[Y.Uint8ArrayMaxByteLength=58]="Uint8ArrayMaxByteLength",Y[Y.Uint8ArrayMinByteLength=59]="Uint8ArrayMinByteLength",Y[Y.Uint8Array=60]="Uint8Array",Y[Y.Undefined=61]="Undefined",Y[Y.Union=62]="Union",Y[Y.Void=63]="Void"})(f||(yc.ValueErrorType=f={}));class b extends r.TypeBoxError{constructor(Me){super("Unknown type"),this.schema=Me}}yc.ValueErrorsUnknownTypeError=b;function C(Y){return Y.replace(/~/g,"~0").replace(/\//g,"~1")}function v(Y){return Y!==void 0}class m{constructor(Me){this.iterator=Me}[Symbol.iterator](){return this.iterator}First(){const Me=this.iterator.next();return Me.done?void 0:Me.value}}yc.ValueErrorIterator=m;function h(Y,Me,K,Z,me=[]){return{type:Y,schema:Me,path:K,value:Z,message:(0,i.GetErrorFunction)()({errorType:Y,path:K,schema:Me,value:Z,errors:me}),errors:me}}function*g(Y,Me,K,Z){}function*_(Y,Me,K,Z){}function*S(Y,Me,K,Z){if(!(0,l.IsArray)(Z))return yield h(f.Array,Y,K,Z);v(Y.minItems)&&!(Z.length>=Y.minItems)&&(yield h(f.ArrayMinItems,Y,K,Z)),v(Y.maxItems)&&!(Z.length<=Y.maxItems)&&(yield h(f.ArrayMaxItems,Y,K,Z));for(let qe=0;qe<Z.length;qe++)yield*Re(Y.items,Me,`${K}/${qe}`,Z[qe]);if(Y.uniqueItems===!0&&!(function(){const qe=new Set;for(const xe of Z){const Oe=(0,o.Hash)(xe);if(qe.has(Oe))return!1;qe.add(Oe)}return!0})()&&(yield h(f.ArrayUniqueItems,Y,K,Z)),!(v(Y.contains)||v(Y.minContains)||v(Y.maxContains)))return;const me=v(Y.contains)?Y.contains:(0,d.Never)(),we=Z.reduce((qe,xe,Oe)=>Re(me,Me,`${K}${Oe}`,xe).next().done===!0?qe+1:qe,0);we===0&&(yield h(f.ArrayContains,Y,K,Z)),(0,l.IsNumber)(Y.minContains)&&we<Y.minContains&&(yield h(f.ArrayMinContains,Y,K,Z)),(0,l.IsNumber)(Y.maxContains)&&we>Y.maxContains&&(yield h(f.ArrayMaxContains,Y,K,Z))}function*p(Y,Me,K,Z){(0,l.IsAsyncIterator)(Z)||(yield h(f.AsyncIterator,Y,K,Z))}function*w(Y,Me,K,Z){if(!(0,l.IsBigInt)(Z))return yield h(f.BigInt,Y,K,Z);v(Y.exclusiveMaximum)&&!(Z<Y.exclusiveMaximum)&&(yield h(f.BigIntExclusiveMaximum,Y,K,Z)),v(Y.exclusiveMinimum)&&!(Z>Y.exclusiveMinimum)&&(yield h(f.BigIntExclusiveMinimum,Y,K,Z)),v(Y.maximum)&&!(Z<=Y.maximum)&&(yield h(f.BigIntMaximum,Y,K,Z)),v(Y.minimum)&&!(Z>=Y.minimum)&&(yield h(f.BigIntMinimum,Y,K,Z)),v(Y.multipleOf)&&Z%Y.multipleOf!==BigInt(0)&&(yield h(f.BigIntMultipleOf,Y,K,Z))}function*O(Y,Me,K,Z){(0,l.IsBoolean)(Z)||(yield h(f.Boolean,Y,K,Z))}function*E(Y,Me,K,Z){yield*Re(Y.returns,Me,K,Z.prototype)}function*F(Y,Me,K,Z){if(!(0,l.IsDate)(Z))return yield h(f.Date,Y,K,Z);v(Y.exclusiveMaximumTimestamp)&&!(Z.getTime()<Y.exclusiveMaximumTimestamp)&&(yield h(f.DateExclusiveMaximumTimestamp,Y,K,Z)),v(Y.exclusiveMinimumTimestamp)&&!(Z.getTime()>Y.exclusiveMinimumTimestamp)&&(yield h(f.DateExclusiveMinimumTimestamp,Y,K,Z)),v(Y.maximumTimestamp)&&!(Z.getTime()<=Y.maximumTimestamp)&&(yield h(f.DateMaximumTimestamp,Y,K,Z)),v(Y.minimumTimestamp)&&!(Z.getTime()>=Y.minimumTimestamp)&&(yield h(f.DateMinimumTimestamp,Y,K,Z)),v(Y.multipleOfTimestamp)&&Z.getTime()%Y.multipleOfTimestamp!==0&&(yield h(f.DateMultipleOfTimestamp,Y,K,Z))}function*R(Y,Me,K,Z){(0,l.IsFunction)(Z)||(yield h(f.Function,Y,K,Z))}function*M(Y,Me,K,Z){const me=globalThis.Object.values(Y.$defs),we=Y.$defs[Y.$ref];yield*Re(we,[...Me,...me],K,Z)}function*j(Y,Me,K,Z){if(!(0,l.IsInteger)(Z))return yield h(f.Integer,Y,K,Z);v(Y.exclusiveMaximum)&&!(Z<Y.exclusiveMaximum)&&(yield h(f.IntegerExclusiveMaximum,Y,K,Z)),v(Y.exclusiveMinimum)&&!(Z>Y.exclusiveMinimum)&&(yield h(f.IntegerExclusiveMinimum,Y,K,Z)),v(Y.maximum)&&!(Z<=Y.maximum)&&(yield h(f.IntegerMaximum,Y,K,Z)),v(Y.minimum)&&!(Z>=Y.minimum)&&(yield h(f.IntegerMinimum,Y,K,Z)),v(Y.multipleOf)&&Z%Y.multipleOf!==0&&(yield h(f.IntegerMultipleOf,Y,K,Z))}function*k(Y,Me,K,Z){let me=!1;for(const we of Y.allOf)for(const qe of Re(we,Me,K,Z))me=!0,yield qe;if(me)return yield h(f.Intersect,Y,K,Z);if(Y.unevaluatedProperties===!1){const we=new RegExp((0,n.KeyOfPattern)(Y));for(const qe of Object.getOwnPropertyNames(Z))we.test(qe)||(yield h(f.IntersectUnevaluatedProperties,Y,`${K}/${qe}`,Z))}if(typeof Y.unevaluatedProperties=="object"){const we=new RegExp((0,n.KeyOfPattern)(Y));for(const qe of Object.getOwnPropertyNames(Z))if(!we.test(qe)){const xe=Re(Y.unevaluatedProperties,Me,`${K}/${qe}`,Z[qe]).next();xe.done||(yield xe.value)}}}function*x(Y,Me,K,Z){(0,l.IsIterator)(Z)||(yield h(f.Iterator,Y,K,Z))}function*L(Y,Me,K,Z){Z!==Y.const&&(yield h(f.Literal,Y,K,Z))}function*V(Y,Me,K,Z){yield h(f.Never,Y,K,Z)}function*G(Y,Me,K,Z){Re(Y.not,Me,K,Z).next().done===!0&&(yield h(f.Not,Y,K,Z))}function*ee(Y,Me,K,Z){(0,l.IsNull)(Z)||(yield h(f.Null,Y,K,Z))}function*se(Y,Me,K,Z){if(!e.TypeSystemPolicy.IsNumberLike(Z))return yield h(f.Number,Y,K,Z);v(Y.exclusiveMaximum)&&!(Z<Y.exclusiveMaximum)&&(yield h(f.NumberExclusiveMaximum,Y,K,Z)),v(Y.exclusiveMinimum)&&!(Z>Y.exclusiveMinimum)&&(yield h(f.NumberExclusiveMinimum,Y,K,Z)),v(Y.maximum)&&!(Z<=Y.maximum)&&(yield h(f.NumberMaximum,Y,K,Z)),v(Y.minimum)&&!(Z>=Y.minimum)&&(yield h(f.NumberMinimum,Y,K,Z)),v(Y.multipleOf)&&Z%Y.multipleOf!==0&&(yield h(f.NumberMultipleOf,Y,K,Z))}function*re(Y,Me,K,Z){if(!e.TypeSystemPolicy.IsObjectLike(Z))return yield h(f.Object,Y,K,Z);v(Y.minProperties)&&!(Object.getOwnPropertyNames(Z).length>=Y.minProperties)&&(yield h(f.ObjectMinProperties,Y,K,Z)),v(Y.maxProperties)&&!(Object.getOwnPropertyNames(Z).length<=Y.maxProperties)&&(yield h(f.ObjectMaxProperties,Y,K,Z));const me=Array.isArray(Y.required)?Y.required:[],we=Object.getOwnPropertyNames(Y.properties),qe=Object.getOwnPropertyNames(Z);for(const xe of me)qe.includes(xe)||(yield h(f.ObjectRequiredProperty,Y.properties[xe],`${K}/${C(xe)}`,void 0));if(Y.additionalProperties===!1)for(const xe of qe)we.includes(xe)||(yield h(f.ObjectAdditionalProperties,Y,`${K}/${C(xe)}`,Z[xe]));if(typeof Y.additionalProperties=="object")for(const xe of qe)we.includes(xe)||(yield*Re(Y.additionalProperties,Me,`${K}/${C(xe)}`,Z[xe]));for(const xe of we){const Oe=Y.properties[xe];Y.required&&Y.required.includes(xe)?(yield*Re(Oe,Me,`${K}/${C(xe)}`,Z[xe]),(0,t.ExtendsUndefinedCheck)(Y)&&!(xe in Z)&&(yield h(f.ObjectRequiredProperty,Oe,`${K}/${C(xe)}`,void 0))):e.TypeSystemPolicy.IsExactOptionalProperty(Z,xe)&&(yield*Re(Oe,Me,`${K}/${C(xe)}`,Z[xe]))}}function*fe(Y,Me,K,Z){(0,l.IsPromise)(Z)||(yield h(f.Promise,Y,K,Z))}function*oe(Y,Me,K,Z){if(!e.TypeSystemPolicy.IsRecordLike(Z))return yield h(f.Object,Y,K,Z);v(Y.minProperties)&&!(Object.getOwnPropertyNames(Z).length>=Y.minProperties)&&(yield h(f.ObjectMinProperties,Y,K,Z)),v(Y.maxProperties)&&!(Object.getOwnPropertyNames(Z).length<=Y.maxProperties)&&(yield h(f.ObjectMaxProperties,Y,K,Z));const[me,we]=Object.entries(Y.patternProperties)[0],qe=new RegExp(me);for(const[xe,Oe]of Object.entries(Z))qe.test(xe)&&(yield*Re(we,Me,`${K}/${C(xe)}`,Oe));if(typeof Y.additionalProperties=="object")for(const[xe,Oe]of Object.entries(Z))qe.test(xe)||(yield*Re(Y.additionalProperties,Me,`${K}/${C(xe)}`,Oe));if(Y.additionalProperties===!1){for(const[xe,Oe]of Object.entries(Z))if(!qe.test(xe))return yield h(f.ObjectAdditionalProperties,Y,`${K}/${C(xe)}`,Oe)}}function*pe(Y,Me,K,Z){yield*Re((0,s.Deref)(Y,Me),Me,K,Z)}function*de(Y,Me,K,Z){if(!(0,l.IsString)(Z))return yield h(f.String,Y,K,Z);if(v(Y.minLength)&&!(Z.length>=Y.minLength)&&(yield h(f.StringMinLength,Y,K,Z)),v(Y.maxLength)&&!(Z.length<=Y.maxLength)&&(yield h(f.StringMaxLength,Y,K,Z)),!new RegExp(Y.source,Y.flags).test(Z))return yield h(f.RegExp,Y,K,Z)}function*ge(Y,Me,K,Z){if(!(0,l.IsString)(Z))return yield h(f.String,Y,K,Z);v(Y.minLength)&&!(Z.length>=Y.minLength)&&(yield h(f.StringMinLength,Y,K,Z)),v(Y.maxLength)&&!(Z.length<=Y.maxLength)&&(yield h(f.StringMaxLength,Y,K,Z)),(0,l.IsString)(Y.pattern)&&(new RegExp(Y.pattern).test(Z)||(yield h(f.StringPattern,Y,K,Z))),(0,l.IsString)(Y.format)&&(a.FormatRegistry.Has(Y.format)?a.FormatRegistry.Get(Y.format)(Z)||(yield h(f.StringFormat,Y,K,Z)):yield h(f.StringFormatUnknown,Y,K,Z))}function*Ce(Y,Me,K,Z){(0,l.IsSymbol)(Z)||(yield h(f.Symbol,Y,K,Z))}function*Fe(Y,Me,K,Z){if(!(0,l.IsString)(Z))return yield h(f.String,Y,K,Z);new RegExp(Y.pattern).test(Z)||(yield h(f.StringPattern,Y,K,Z))}function*We(Y,Me,K,Z){yield*Re((0,s.Deref)(Y,Me),Me,K,Z)}function*Ze(Y,Me,K,Z){if(!(0,l.IsArray)(Z))return yield h(f.Tuple,Y,K,Z);if(Y.items===void 0&&Z.length!==0)return yield h(f.TupleLength,Y,K,Z);if(Z.length!==Y.maxItems)return yield h(f.TupleLength,Y,K,Z);if(Y.items)for(let me=0;me<Y.items.length;me++)yield*Re(Y.items[me],Me,`${K}/${me}`,Z[me])}function*lt(Y,Me,K,Z){(0,l.IsUndefined)(Z)||(yield h(f.Undefined,Y,K,Z))}function*ut(Y,Me,K,Z){if((0,u.Check)(Y,Me,Z))return;const me=Y.anyOf.map(we=>new m(Re(we,Me,K,Z)));yield h(f.Union,Y,K,Z,me)}function*pt(Y,Me,K,Z){if(!(0,l.IsUint8Array)(Z))return yield h(f.Uint8Array,Y,K,Z);v(Y.maxByteLength)&&!(Z.length<=Y.maxByteLength)&&(yield h(f.Uint8ArrayMaxByteLength,Y,K,Z)),v(Y.minByteLength)&&!(Z.length>=Y.minByteLength)&&(yield h(f.Uint8ArrayMinByteLength,Y,K,Z))}function*Nt(Y,Me,K,Z){}function*Ke(Y,Me,K,Z){e.TypeSystemPolicy.IsVoidLike(Z)||(yield h(f.Void,Y,K,Z))}function*Ge(Y,Me,K,Z){a.TypeRegistry.Get(Y[c.Kind])(Y,Z)||(yield h(f.Kind,Y,K,Z))}function*Re(Y,Me,K,Z){const me=v(Y.$id)?[...Me,Y]:Me,we=Y;switch(we[c.Kind]){case"Any":return yield*g();case"Argument":return yield*_();case"Array":return yield*S(we,me,K,Z);case"AsyncIterator":return yield*p(we,me,K,Z);case"BigInt":return yield*w(we,me,K,Z);case"Boolean":return yield*O(we,me,K,Z);case"Constructor":return yield*E(we,me,K,Z);case"Date":return yield*F(we,me,K,Z);case"Function":return yield*R(we,me,K,Z);case"Import":return yield*M(we,me,K,Z);case"Integer":return yield*j(we,me,K,Z);case"Intersect":return yield*k(we,me,K,Z);case"Iterator":return yield*x(we,me,K,Z);case"Literal":return yield*L(we,me,K,Z);case"Never":return yield*V(we,me,K,Z);case"Not":return yield*G(we,me,K,Z);case"Null":return yield*ee(we,me,K,Z);case"Number":return yield*se(we,me,K,Z);case"Object":return yield*re(we,me,K,Z);case"Promise":return yield*fe(we,me,K,Z);case"Record":return yield*oe(we,me,K,Z);case"Ref":return yield*pe(we,me,K,Z);case"RegExp":return yield*de(we,me,K,Z);case"String":return yield*ge(we,me,K,Z);case"Symbol":return yield*Ce(we,me,K,Z);case"TemplateLiteral":return yield*Fe(we,me,K,Z);case"This":return yield*We(we,me,K,Z);case"Tuple":return yield*Ze(we,me,K,Z);case"Undefined":return yield*lt(we,me,K,Z);case"Union":return yield*ut(we,me,K,Z);case"Uint8Array":return yield*pt(we,me,K,Z);case"Unknown":return yield*Nt();case"Void":return yield*Ke(we,me,K,Z);default:if(!a.TypeRegistry.Has(we[c.Kind]))throw new b(Y);return yield*Ge(we,me,K,Z)}}function Qe(...Y){const Me=Y.length===3?Re(Y[0],Y[1],"",Y[2]):Re(Y[0],[],"",Y[1]);return new m(Me)}return yc}var sJ;function moe(){return sJ||(sJ=1,(function(e){var n=fp&&fp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=fp&&fp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(hoe(),e),a(foe(),e)})(fp)),fp}var Pa={},bp={},el={},aJ;function ESe(){if(aJ)return el;aJ=1,Object.defineProperty(el,"__esModule",{value:!0}),el.TransformDecodeError=el.TransformDecodeCheckError=void 0,el.TransformDecode=w;const e=PE(),n=Xt(),a=ss(),t=wc(),i=pb(),r=Mq(),s=hl(),o=Dn();class u extends a.TypeBoxError{constructor(E,F,R){super("Unable to decode value as it does not match the expected schema"),this.schema=E,this.value=F,this.error=R}}el.TransformDecodeCheckError=u;class c extends a.TypeBoxError{constructor(E,F,R,M){super(M instanceof Error?M.message:"Unknown error"),this.schema=E,this.path=F,this.value=R,this.error=M}}el.TransformDecodeError=c;function d(O,E,F){try{return(0,o.IsTransform)(O)?O[n.TransformKind].Decode(F):F}catch(R){throw new c(O,E,F,R)}}function l(O,E,F,R){return(0,s.IsArray)(R)?d(O,F,R.map((M,j)=>p(O.items,E,`${F}/${j}`,M))):d(O,F,R)}function f(O,E,F,R){if(!(0,s.IsObject)(R)||(0,s.IsValueType)(R))return d(O,F,R);const M=(0,t.KeyOfPropertyEntries)(O),j=M.map(G=>G[0]),k={...R};for(const[G,ee]of M)G in k&&(k[G]=p(ee,E,`${F}/${G}`,k[G]));if(!(0,o.IsTransform)(O.unevaluatedProperties))return d(O,F,k);const x=Object.getOwnPropertyNames(k),L=O.unevaluatedProperties,V={...k};for(const G of x)j.includes(G)||(V[G]=d(L,`${F}/${G}`,V[G]));return d(O,F,V)}function b(O,E,F,R){const M=globalThis.Object.values(O.$defs),j=O.$defs[O.$ref],k=p(j,[...E,...M],F,R);return d(O,F,k)}function C(O,E,F,R){return d(O,F,p(O.not,E,F,R))}function v(O,E,F,R){if(!(0,s.IsObject)(R))return d(O,F,R);const M=(0,t.KeyOfPropertyKeys)(O),j={...R};for(const V of M)(0,s.HasPropertyKey)(j,V)&&((0,s.IsUndefined)(j[V])&&(!(0,o.IsUndefined)(O.properties[V])||e.TypeSystemPolicy.IsExactOptionalProperty(j,V))||(j[V]=p(O.properties[V],E,`${F}/${V}`,j[V])));if(!(0,o.IsSchema)(O.additionalProperties))return d(O,F,j);const k=Object.getOwnPropertyNames(j),x=O.additionalProperties,L={...j};for(const V of k)M.includes(V)||(L[V]=d(x,`${F}/${V}`,L[V]));return d(O,F,L)}function m(O,E,F,R){if(!(0,s.IsObject)(R))return d(O,F,R);const M=Object.getOwnPropertyNames(O.patternProperties)[0],j=new RegExp(M),k={...R};for(const G of Object.getOwnPropertyNames(R))j.test(G)&&(k[G]=p(O.patternProperties[M],E,`${F}/${G}`,k[G]));if(!(0,o.IsSchema)(O.additionalProperties))return d(O,F,k);const x=Object.getOwnPropertyNames(k),L=O.additionalProperties,V={...k};for(const G of x)j.test(G)||(V[G]=d(L,`${F}/${G}`,V[G]));return d(O,F,V)}function h(O,E,F,R){const M=(0,i.Deref)(O,E);return d(O,F,p(M,E,F,R))}function g(O,E,F,R){const M=(0,i.Deref)(O,E);return d(O,F,p(M,E,F,R))}function _(O,E,F,R){return(0,s.IsArray)(R)&&(0,s.IsArray)(O.items)?d(O,F,O.items.map((M,j)=>p(M,E,`${F}/${j}`,R[j]))):d(O,F,R)}function S(O,E,F,R){for(const M of O.anyOf){if(!(0,r.Check)(M,E,R))continue;const j=p(M,E,F,R);return d(O,F,j)}return d(O,F,R)}function p(O,E,F,R){const M=(0,i.Pushref)(O,E),j=O;switch(O[n.Kind]){case"Array":return l(j,M,F,R);case"Import":return b(j,M,F,R);case"Intersect":return f(j,M,F,R);case"Not":return C(j,M,F,R);case"Object":return v(j,M,F,R);case"Record":return m(j,M,F,R);case"Ref":return h(j,M,F,R);case"Symbol":return d(j,F,R);case"This":return g(j,M,F,R);case"Tuple":return _(j,M,F,R);case"Union":return S(j,M,F,R);default:return d(j,F,R)}}function w(O,E,F){return p(O,E,"",F)}return el}var tl={},oJ;function ISe(){if(oJ)return tl;oJ=1,Object.defineProperty(tl,"__esModule",{value:!0}),tl.TransformEncodeError=tl.TransformEncodeCheckError=void 0,tl.TransformEncode=w;const e=PE(),n=Xt(),a=ss(),t=wc(),i=pb(),r=Mq(),s=hl(),o=Dn();class u extends a.TypeBoxError{constructor(E,F,R){super("The encoded value does not match the expected schema"),this.schema=E,this.value=F,this.error=R}}tl.TransformEncodeCheckError=u;class c extends a.TypeBoxError{constructor(E,F,R,M){super(`${M instanceof Error?M.message:"Unknown error"}`),this.schema=E,this.path=F,this.value=R,this.error=M}}tl.TransformEncodeError=c;function d(O,E,F){try{return(0,o.IsTransform)(O)?O[n.TransformKind].Encode(F):F}catch(R){throw new c(O,E,F,R)}}function l(O,E,F,R){const M=d(O,F,R);return(0,s.IsArray)(M)?M.map((j,k)=>p(O.items,E,`${F}/${k}`,j)):M}function f(O,E,F,R){const M=globalThis.Object.values(O.$defs),j=O.$defs[O.$ref],k=d(O,F,R);return p(j,[...E,...M],F,k)}function b(O,E,F,R){const M=d(O,F,R);if(!(0,s.IsObject)(R)||(0,s.IsValueType)(R))return M;const j=(0,t.KeyOfPropertyEntries)(O),k=j.map(ee=>ee[0]),x={...M};for(const[ee,se]of j)ee in x&&(x[ee]=p(se,E,`${F}/${ee}`,x[ee]));if(!(0,o.IsTransform)(O.unevaluatedProperties))return x;const L=Object.getOwnPropertyNames(x),V=O.unevaluatedProperties,G={...x};for(const ee of L)k.includes(ee)||(G[ee]=d(V,`${F}/${ee}`,G[ee]));return G}function C(O,E,F,R){return d(O.not,F,d(O,F,R))}function v(O,E,F,R){const M=d(O,F,R);if(!(0,s.IsObject)(M))return M;const j=(0,t.KeyOfPropertyKeys)(O),k={...M};for(const G of j)(0,s.HasPropertyKey)(k,G)&&((0,s.IsUndefined)(k[G])&&(!(0,o.IsUndefined)(O.properties[G])||e.TypeSystemPolicy.IsExactOptionalProperty(k,G))||(k[G]=p(O.properties[G],E,`${F}/${G}`,k[G])));if(!(0,o.IsSchema)(O.additionalProperties))return k;const x=Object.getOwnPropertyNames(k),L=O.additionalProperties,V={...k};for(const G of x)j.includes(G)||(V[G]=d(L,`${F}/${G}`,V[G]));return V}function m(O,E,F,R){const M=d(O,F,R);if(!(0,s.IsObject)(R))return M;const j=Object.getOwnPropertyNames(O.patternProperties)[0],k=new RegExp(j),x={...M};for(const ee of Object.getOwnPropertyNames(R))k.test(ee)&&(x[ee]=p(O.patternProperties[j],E,`${F}/${ee}`,x[ee]));if(!(0,o.IsSchema)(O.additionalProperties))return x;const L=Object.getOwnPropertyNames(x),V=O.additionalProperties,G={...x};for(const ee of L)k.test(ee)||(G[ee]=d(V,`${F}/${ee}`,G[ee]));return G}function h(O,E,F,R){const M=(0,i.Deref)(O,E),j=p(M,E,F,R);return d(O,F,j)}function g(O,E,F,R){const M=(0,i.Deref)(O,E),j=p(M,E,F,R);return d(O,F,j)}function _(O,E,F,R){const M=d(O,F,R);return(0,s.IsArray)(O.items)?O.items.map((j,k)=>p(j,E,`${F}/${k}`,M[k])):[]}function S(O,E,F,R){for(const M of O.anyOf){if(!(0,r.Check)(M,E,R))continue;const j=p(M,E,F,R);return d(O,F,j)}for(const M of O.anyOf){const j=p(M,E,F,R);if((0,r.Check)(O,E,j))return d(O,F,j)}return d(O,F,R)}function p(O,E,F,R){const M=(0,i.Pushref)(O,E),j=O;switch(O[n.Kind]){case"Array":return l(j,M,F,R);case"Import":return f(j,M,F,R);case"Intersect":return b(j,M,F,R);case"Not":return C(j,M,F,R);case"Object":return v(j,M,F,R);case"Record":return m(j,M,F,R);case"Ref":return h(j,M,F,R);case"This":return g(j,M,F,R);case"Tuple":return _(j,M,F,R);case"Union":return S(j,M,F,R);default:return d(j,F,R)}}function w(O,E,F){return p(O,E,"",F)}return tl}var IP={},cJ;function RSe(){if(cJ)return IP;cJ=1,Object.defineProperty(IP,"__esModule",{value:!0}),IP.HasTransform=p;const e=pb(),n=Xt(),a=Dn(),t=hl();function i(w,O){return(0,a.IsTransform)(w)||_(w.items,O)}function r(w,O){return(0,a.IsTransform)(w)||_(w.items,O)}function s(w,O){return(0,a.IsTransform)(w)||_(w.returns,O)||w.parameters.some(E=>_(E,O))}function o(w,O){return(0,a.IsTransform)(w)||_(w.returns,O)||w.parameters.some(E=>_(E,O))}function u(w,O){return(0,a.IsTransform)(w)||(0,a.IsTransform)(w.unevaluatedProperties)||w.allOf.some(E=>_(E,O))}function c(w,O){const E=globalThis.Object.getOwnPropertyNames(w.$defs).reduce((R,M)=>[...R,w.$defs[M]],[]),F=w.$defs[w.$ref];return(0,a.IsTransform)(w)||_(F,[...E,...O])}function d(w,O){return(0,a.IsTransform)(w)||_(w.items,O)}function l(w,O){return(0,a.IsTransform)(w)||_(w.not,O)}function f(w,O){return(0,a.IsTransform)(w)||Object.values(w.properties).some(E=>_(E,O))||(0,a.IsSchema)(w.additionalProperties)&&_(w.additionalProperties,O)}function b(w,O){return(0,a.IsTransform)(w)||_(w.item,O)}function C(w,O){const E=Object.getOwnPropertyNames(w.patternProperties)[0],F=w.patternProperties[E];return(0,a.IsTransform)(w)||_(F,O)||(0,a.IsSchema)(w.additionalProperties)&&(0,a.IsTransform)(w.additionalProperties)}function v(w,O){return(0,a.IsTransform)(w)?!0:_((0,e.Deref)(w,O),O)}function m(w,O){return(0,a.IsTransform)(w)?!0:_((0,e.Deref)(w,O),O)}function h(w,O){return(0,a.IsTransform)(w)||!(0,t.IsUndefined)(w.items)&&w.items.some(E=>_(E,O))}function g(w,O){return(0,a.IsTransform)(w)||w.anyOf.some(E=>_(E,O))}function _(w,O){const E=(0,e.Pushref)(w,O),F=w;if(w.$id&&S.has(w.$id))return!1;switch(w.$id&&S.add(w.$id),w[n.Kind]){case"Array":return i(F,E);case"AsyncIterator":return r(F,E);case"Constructor":return s(F,E);case"Function":return o(F,E);case"Import":return c(F,E);case"Intersect":return u(F,E);case"Iterator":return d(F,E);case"Not":return l(F,E);case"Object":return f(F,E);case"Promise":return b(F,E);case"Record":return C(F,E);case"Ref":return v(F,E);case"This":return m(F,E);case"Tuple":return h(F,E);case"Union":return g(F,E);default:return(0,a.IsTransform)(w)}}const S=new Set;function p(w,O){return S.clear(),_(w,O)}return IP}var uJ;function FSe(){return uJ||(uJ=1,(function(e){var n=bp&&bp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=bp&&bp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(ESe(),e),a(ISe(),e),a(RSe(),e)})(bp)),bp}var dJ;function jSe(){if(dJ)return Pa;dJ=1,Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.TypeCompiler=Pa.Policy=Pa.TypeCompilerTypeGuardError=Pa.TypeCompilerUnknownTypeError=Pa.TypeCheck=void 0;const e=FSe(),n=moe(),a=Fq(),t=ss(),i=pb(),r=jq(),s=Xt(),o=fT(),u=wc(),c=zx(),d=bi(),l=yl(),f=hl(),b=pse();class C{constructor(E,F,R,M){this.schema=E,this.references=F,this.checkFunc=R,this.code=M,this.hasTransform=(0,e.HasTransform)(E,F)}Code(){return this.code}Schema(){return this.schema}References(){return this.references}Errors(E){return(0,n.Errors)(this.schema,this.references,E)}Check(E){return this.checkFunc(E)}Decode(E){if(!this.checkFunc(E))throw new e.TransformDecodeCheckError(this.schema,E,this.Errors(E).First());return this.hasTransform?(0,e.TransformDecode)(this.schema,this.references,E):E}Encode(E){const F=this.hasTransform?(0,e.TransformEncode)(this.schema,this.references,E):E;if(!this.checkFunc(F))throw new e.TransformEncodeCheckError(this.schema,E,this.Errors(E).First());return F}}Pa.TypeCheck=C;var v;(function(O){function E(j){return j===36}O.DollarSign=E;function F(j){return j===95}O.IsUnderscore=F;function R(j){return j>=65&&j<=90||j>=97&&j<=122}O.IsAlpha=R;function M(j){return j>=48&&j<=57}O.IsNumeric=M})(v||(v={}));var m;(function(O){function E(j){return j.length===0?!1:v.IsNumeric(j.charCodeAt(0))}function F(j){if(E(j))return!1;for(let k=0;k<j.length;k++){const x=j.charCodeAt(k);if(!(v.IsAlpha(x)||v.IsNumeric(x)||v.DollarSign(x)||v.IsUnderscore(x)))return!1}return!0}function R(j){return j.replace(/'/g,"\\'")}function M(j,k){return F(k)?`${j}.${k}`:`${j}['${R(k)}']`}O.Encode=M})(m||(m={}));var h;(function(O){function E(F){const R=[];for(let M=0;M<F.length;M++){const j=F.charCodeAt(M);v.IsNumeric(j)||v.IsAlpha(j)?R.push(F.charAt(M)):R.push(`_${j}_`)}return R.join("").replace(/__/g,"_")}O.Encode=E})(h||(h={}));var g;(function(O){function E(F){return F.replace(/'/g,"\\'")}O.Escape=E})(g||(g={}));class _ extends t.TypeBoxError{constructor(E){super("Unknown type"),this.schema=E}}Pa.TypeCompilerUnknownTypeError=_;class S extends t.TypeBoxError{constructor(E){super("Preflight validation check failed to guard for the given schema"),this.schema=E}}Pa.TypeCompilerTypeGuardError=S;var p;(function(O){function E(k,x,L){return a.TypeSystemPolicy.ExactOptionalPropertyTypes?`('${x}' in ${k} ? ${L} : true)`:`(${m.Encode(k,x)} !== undefined ? ${L} : true)`}O.IsExactOptionalProperty=E;function F(k){return a.TypeSystemPolicy.AllowArrayObject?`(typeof ${k} === 'object' && ${k} !== null)`:`(typeof ${k} === 'object' && ${k} !== null && !Array.isArray(${k}))`}O.IsObjectLike=F;function R(k){return a.TypeSystemPolicy.AllowArrayObject?`(typeof ${k} === 'object' && ${k} !== null && !(${k} instanceof Date) && !(${k} instanceof Uint8Array))`:`(typeof ${k} === 'object' && ${k} !== null && !Array.isArray(${k}) && !(${k} instanceof Date) && !(${k} instanceof Uint8Array))`}O.IsRecordLike=R;function M(k){return a.TypeSystemPolicy.AllowNaN?`typeof ${k} === 'number'`:`Number.isFinite(${k})`}O.IsNumberLike=M;function j(k){return a.TypeSystemPolicy.AllowNullVoid?`(${k} === undefined || ${k} === null)`:`${k} === undefined`}O.IsVoidLike=j})(p||(Pa.Policy=p={}));var w;return(function(O){function E(Pe){return Pe[s.Kind]==="Any"||Pe[s.Kind]==="Unknown"}function*F(Pe,Ye,ke){yield"true"}function*R(Pe,Ye,ke){yield"true"}function*M(Pe,Ye,ke){yield`Array.isArray(${ke})`;const[Rt,Ft]=[Ve("value","any"),Ve("acc","number")];(0,f.IsNumber)(Pe.maxItems)&&(yield`${ke}.length <= ${Pe.maxItems}`),(0,f.IsNumber)(Pe.minItems)&&(yield`${ke}.length >= ${Pe.minItems}`);const xt=xe(Pe.items,Ye,"value");if(yield`${ke}.every((${Rt}) => ${xt})`,(0,b.IsSchema)(Pe.contains)||(0,f.IsNumber)(Pe.minContains)||(0,f.IsNumber)(Pe.maxContains)){const zt=(0,b.IsSchema)(Pe.contains)?Pe.contains:(0,d.Never)(),fn=xe(zt,Ye,"value"),je=(0,f.IsNumber)(Pe.minContains)?[`(count >= ${Pe.minContains})`]:[],Ne=(0,f.IsNumber)(Pe.maxContains)?[`(count <= ${Pe.maxContains})`]:[],Kt=`const count = value.reduce((${Ft}, ${Rt}) => ${fn} ? acc + 1 : acc, 0)`,mn=["(count > 0)",...je,...Ne].join(" && ");yield`((${Rt}) => { ${Kt}; return ${mn}})(${ke})`}Pe.uniqueItems===!0&&(yield`((${Rt}) => { const set = new Set(); for(const element of value) { const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true } )(${ke})`)}function*j(Pe,Ye,ke){yield`(typeof value === 'object' && Symbol.asyncIterator in ${ke})`}function*k(Pe,Ye,ke){yield`(typeof ${ke} === 'bigint')`,(0,f.IsBigInt)(Pe.exclusiveMaximum)&&(yield`${ke} < BigInt(${Pe.exclusiveMaximum})`),(0,f.IsBigInt)(Pe.exclusiveMinimum)&&(yield`${ke} > BigInt(${Pe.exclusiveMinimum})`),(0,f.IsBigInt)(Pe.maximum)&&(yield`${ke} <= BigInt(${Pe.maximum})`),(0,f.IsBigInt)(Pe.minimum)&&(yield`${ke} >= BigInt(${Pe.minimum})`),(0,f.IsBigInt)(Pe.multipleOf)&&(yield`(${ke} % BigInt(${Pe.multipleOf})) === 0`)}function*x(Pe,Ye,ke){yield`(typeof ${ke} === 'boolean')`}function*L(Pe,Ye,ke){yield*we(Pe.returns,Ye,`${ke}.prototype`)}function*V(Pe,Ye,ke){yield`(${ke} instanceof Date) && Number.isFinite(${ke}.getTime())`,(0,f.IsNumber)(Pe.exclusiveMaximumTimestamp)&&(yield`${ke}.getTime() < ${Pe.exclusiveMaximumTimestamp}`),(0,f.IsNumber)(Pe.exclusiveMinimumTimestamp)&&(yield`${ke}.getTime() > ${Pe.exclusiveMinimumTimestamp}`),(0,f.IsNumber)(Pe.maximumTimestamp)&&(yield`${ke}.getTime() <= ${Pe.maximumTimestamp}`),(0,f.IsNumber)(Pe.minimumTimestamp)&&(yield`${ke}.getTime() >= ${Pe.minimumTimestamp}`),(0,f.IsNumber)(Pe.multipleOfTimestamp)&&(yield`(${ke}.getTime() % ${Pe.multipleOfTimestamp}) === 0`)}function*G(Pe,Ye,ke){yield`(typeof ${ke} === 'function')`}function*ee(Pe,Ye,ke){const Rt=globalThis.Object.getOwnPropertyNames(Pe.$defs).reduce((Ft,xt)=>[...Ft,Pe.$defs[xt]],[]);yield*we((0,l.Ref)(Pe.$ref),[...Ye,...Rt],ke)}function*se(Pe,Ye,ke){yield`Number.isInteger(${ke})`,(0,f.IsNumber)(Pe.exclusiveMaximum)&&(yield`${ke} < ${Pe.exclusiveMaximum}`),(0,f.IsNumber)(Pe.exclusiveMinimum)&&(yield`${ke} > ${Pe.exclusiveMinimum}`),(0,f.IsNumber)(Pe.maximum)&&(yield`${ke} <= ${Pe.maximum}`),(0,f.IsNumber)(Pe.minimum)&&(yield`${ke} >= ${Pe.minimum}`),(0,f.IsNumber)(Pe.multipleOf)&&(yield`(${ke} % ${Pe.multipleOf}) === 0`)}function*re(Pe,Ye,ke){const Rt=Pe.allOf.map(Ft=>xe(Ft,Ye,ke)).join(" && ");if(Pe.unevaluatedProperties===!1){const Ft=He(`${new RegExp((0,u.KeyOfPattern)(Pe))};`),xt=`Object.getOwnPropertyNames(${ke}).every(key => ${Ft}.test(key))`;yield`(${Rt} && ${xt})`}else if((0,b.IsSchema)(Pe.unevaluatedProperties)){const Ft=He(`${new RegExp((0,u.KeyOfPattern)(Pe))};`),xt=`Object.getOwnPropertyNames(${ke}).every(key => ${Ft}.test(key) || ${xe(Pe.unevaluatedProperties,Ye,`${ke}[key]`)})`;yield`(${Rt} && ${xt})`}else yield`(${Rt})`}function*fe(Pe,Ye,ke){yield`(typeof value === 'object' && Symbol.iterator in ${ke})`}function*oe(Pe,Ye,ke){typeof Pe.const=="number"||typeof Pe.const=="boolean"?yield`(${ke} === ${Pe.const})`:yield`(${ke} === '${g.Escape(Pe.const)}')`}function*pe(Pe,Ye,ke){yield"false"}function*de(Pe,Ye,ke){yield`(!${xe(Pe.not,Ye,ke)})`}function*ge(Pe,Ye,ke){yield`(${ke} === null)`}function*Ce(Pe,Ye,ke){yield p.IsNumberLike(ke),(0,f.IsNumber)(Pe.exclusiveMaximum)&&(yield`${ke} < ${Pe.exclusiveMaximum}`),(0,f.IsNumber)(Pe.exclusiveMinimum)&&(yield`${ke} > ${Pe.exclusiveMinimum}`),(0,f.IsNumber)(Pe.maximum)&&(yield`${ke} <= ${Pe.maximum}`),(0,f.IsNumber)(Pe.minimum)&&(yield`${ke} >= ${Pe.minimum}`),(0,f.IsNumber)(Pe.multipleOf)&&(yield`(${ke} % ${Pe.multipleOf}) === 0`)}function*Fe(Pe,Ye,ke){yield p.IsObjectLike(ke),(0,f.IsNumber)(Pe.minProperties)&&(yield`Object.getOwnPropertyNames(${ke}).length >= ${Pe.minProperties}`),(0,f.IsNumber)(Pe.maxProperties)&&(yield`Object.getOwnPropertyNames(${ke}).length <= ${Pe.maxProperties}`);const Rt=Object.getOwnPropertyNames(Pe.properties);for(const Ft of Rt){const xt=m.Encode(ke,Ft),zt=Pe.properties[Ft];if(Pe.required&&Pe.required.includes(Ft))yield*we(zt,Ye,xt),((0,c.ExtendsUndefinedCheck)(zt)||E(zt))&&(yield`('${Ft}' in ${ke})`);else{const fn=xe(zt,Ye,xt);yield p.IsExactOptionalProperty(ke,Ft,fn)}}if(Pe.additionalProperties===!1)if(Pe.required&&Pe.required.length===Rt.length)yield`Object.getOwnPropertyNames(${ke}).length === ${Rt.length}`;else{const Ft=`[${Rt.map(xt=>`'${xt}'`).join(", ")}]`;yield`Object.getOwnPropertyNames(${ke}).every(key => ${Ft}.includes(key))`}if(typeof Pe.additionalProperties=="object"){const Ft=xe(Pe.additionalProperties,Ye,`${ke}[key]`),xt=`[${Rt.map(zt=>`'${zt}'`).join(", ")}]`;yield`(Object.getOwnPropertyNames(${ke}).every(key => ${xt}.includes(key) || ${Ft}))`}}function*We(Pe,Ye,ke){yield`${ke} instanceof Promise`}function*Ze(Pe,Ye,ke){yield p.IsRecordLike(ke),(0,f.IsNumber)(Pe.minProperties)&&(yield`Object.getOwnPropertyNames(${ke}).length >= ${Pe.minProperties}`),(0,f.IsNumber)(Pe.maxProperties)&&(yield`Object.getOwnPropertyNames(${ke}).length <= ${Pe.maxProperties}`);const[Rt,Ft]=Object.entries(Pe.patternProperties)[0],xt=He(`${new RegExp(Rt)}`),zt=xe(Ft,Ye,"value"),fn=(0,b.IsSchema)(Pe.additionalProperties)?xe(Pe.additionalProperties,Ye,ke):Pe.additionalProperties===!1?"false":"true",je=`(${xt}.test(key) ? ${zt} : ${fn})`;yield`(Object.entries(${ke}).every(([key, value]) => ${je}))`}function*lt(Pe,Ye,ke){const Rt=(0,i.Deref)(Pe,Ye);if(qe.functions.has(Pe.$ref))return yield`${Oe(Pe.$ref)}(${ke})`;yield*we(Rt,Ye,ke)}function*ut(Pe,Ye,ke){const Rt=He(`${new RegExp(Pe.source,Pe.flags)};`);yield`(typeof ${ke} === 'string')`,(0,f.IsNumber)(Pe.maxLength)&&(yield`${ke}.length <= ${Pe.maxLength}`),(0,f.IsNumber)(Pe.minLength)&&(yield`${ke}.length >= ${Pe.minLength}`),yield`${Rt}.test(${ke})`}function*pt(Pe,Ye,ke){yield`(typeof ${ke} === 'string')`,(0,f.IsNumber)(Pe.maxLength)&&(yield`${ke}.length <= ${Pe.maxLength}`),(0,f.IsNumber)(Pe.minLength)&&(yield`${ke}.length >= ${Pe.minLength}`),Pe.pattern!==void 0&&(yield`${He(`${new RegExp(Pe.pattern)};`)}.test(${ke})`),Pe.format!==void 0&&(yield`format('${Pe.format}', ${ke})`)}function*Nt(Pe,Ye,ke){yield`(typeof ${ke} === 'symbol')`}function*Ke(Pe,Ye,ke){yield`(typeof ${ke} === 'string')`,yield`${He(`${new RegExp(Pe.pattern)};`)}.test(${ke})`}function*Ge(Pe,Ye,ke){yield`${Oe(Pe.$ref)}(${ke})`}function*Re(Pe,Ye,ke){if(yield`Array.isArray(${ke})`,Pe.items===void 0)return yield`${ke}.length === 0`;yield`(${ke}.length === ${Pe.maxItems})`;for(let Rt=0;Rt<Pe.items.length;Rt++)yield`${xe(Pe.items[Rt],Ye,`${ke}[${Rt}]`)}`}function*Qe(Pe,Ye,ke){yield`${ke} === undefined`}function*Y(Pe,Ye,ke){yield`(${Pe.anyOf.map(Ft=>xe(Ft,Ye,ke)).join(" || ")})`}function*Me(Pe,Ye,ke){yield`${ke} instanceof Uint8Array`,(0,f.IsNumber)(Pe.maxByteLength)&&(yield`(${ke}.length <= ${Pe.maxByteLength})`),(0,f.IsNumber)(Pe.minByteLength)&&(yield`(${ke}.length >= ${Pe.minByteLength})`)}function*K(Pe,Ye,ke){yield"true"}function*Z(Pe,Ye,ke){yield p.IsVoidLike(ke)}function*me(Pe,Ye,ke){const Rt=qe.instances.size;qe.instances.set(Rt,Pe),yield`kind('${Pe[s.Kind]}', ${Rt}, ${ke})`}function*we(Pe,Ye,ke,Rt=!0){const Ft=(0,f.IsString)(Pe.$id)?[...Ye,Pe]:Ye,xt=Pe;if(Rt&&(0,f.IsString)(Pe.$id)){const zt=Oe(Pe.$id);if(qe.functions.has(zt))return yield`${zt}(${ke})`;{qe.functions.set(zt,"<deferred>");const fn=Se(zt,Pe,Ye,"value",!1);return qe.functions.set(zt,fn),yield`${zt}(${ke})`}}switch(xt[s.Kind]){case"Any":return yield*F();case"Argument":return yield*R();case"Array":return yield*M(xt,Ft,ke);case"AsyncIterator":return yield*j(xt,Ft,ke);case"BigInt":return yield*k(xt,Ft,ke);case"Boolean":return yield*x(xt,Ft,ke);case"Constructor":return yield*L(xt,Ft,ke);case"Date":return yield*V(xt,Ft,ke);case"Function":return yield*G(xt,Ft,ke);case"Import":return yield*ee(xt,Ft,ke);case"Integer":return yield*se(xt,Ft,ke);case"Intersect":return yield*re(xt,Ft,ke);case"Iterator":return yield*fe(xt,Ft,ke);case"Literal":return yield*oe(xt,Ft,ke);case"Never":return yield*pe();case"Not":return yield*de(xt,Ft,ke);case"Null":return yield*ge(xt,Ft,ke);case"Number":return yield*Ce(xt,Ft,ke);case"Object":return yield*Fe(xt,Ft,ke);case"Promise":return yield*We(xt,Ft,ke);case"Record":return yield*Ze(xt,Ft,ke);case"Ref":return yield*lt(xt,Ft,ke);case"RegExp":return yield*ut(xt,Ft,ke);case"String":return yield*pt(xt,Ft,ke);case"Symbol":return yield*Nt(xt,Ft,ke);case"TemplateLiteral":return yield*Ke(xt,Ft,ke);case"This":return yield*Ge(xt,Ft,ke);case"Tuple":return yield*Re(xt,Ft,ke);case"Undefined":return yield*Qe(xt,Ft,ke);case"Union":return yield*Y(xt,Ft,ke);case"Uint8Array":return yield*Me(xt,Ft,ke);case"Unknown":return yield*K();case"Void":return yield*Z(xt,Ft,ke);default:if(!o.TypeRegistry.Has(xt[s.Kind]))throw new _(Pe);return yield*me(xt,Ft,ke)}}const qe={language:"javascript",functions:new Map,variables:new Map,instances:new Map};function xe(Pe,Ye,ke,Rt=!0){return`(${[...we(Pe,Ye,ke,Rt)].join(" && ")})`}function Oe(Pe){return`check_${h.Encode(Pe)}`}function He(Pe){const Ye=`local_${qe.variables.size}`;return qe.variables.set(Ye,`const ${Ye} = ${Pe}`),Ye}function Se(Pe,Ye,ke,Rt,Ft=!0){const[xt,zt]=[`
`,Kt=>"".padStart(Kt," ")],fn=Ve("value","any"),je=ot("boolean"),Ne=[...we(Ye,ke,Rt,Ft)].map(Kt=>`${zt(4)}${Kt}`).join(` &&${xt}`);return`function ${Pe}(${fn})${je} {${xt}${zt(2)}return (${xt}${Ne}${xt}${zt(2)})
}`}function Ve(Pe,Ye){const ke=qe.language==="typescript"?`: ${Ye}`:"";return`${Pe}${ke}`}function ot(Pe){return qe.language==="typescript"?`: ${Pe}`:""}function mt(Pe,Ye,ke){const Rt=Se("check",Pe,Ye,"value"),Ft=Ve("value","any"),xt=ot("boolean"),zt=[...qe.functions.values()],fn=[...qe.variables.values()],je=(0,f.IsString)(Pe.$id)?`return function check(${Ft})${xt} {
  return ${Oe(Pe.$id)}(value)
}`:`return ${Rt}`;return[...fn,...zt,je].join(`
`)}function he(...Pe){const Ye={language:"javascript"},[ke,Rt,Ft]=Pe.length===2&&(0,f.IsArray)(Pe[1])?[Pe[0],Pe[1],Ye]:Pe.length===2&&!(0,f.IsArray)(Pe[1])?[Pe[0],[],Pe[1]]:Pe.length===3?[Pe[0],Pe[1],Pe[2]]:Pe.length===1?[Pe[0],[],Ye]:[null,[],Ye];if(qe.language=Ft.language,qe.variables.clear(),qe.functions.clear(),qe.instances.clear(),!(0,b.IsSchema)(ke))throw new S(ke);for(const xt of Rt)if(!(0,b.IsSchema)(xt))throw new S(xt);return mt(ke,Rt)}O.Code=he;function Ue(Pe,Ye=[]){const ke=he(Pe,Ye,{language:"javascript"}),Rt=globalThis.Function("kind","format","hash",ke),Ft=new Map(qe.instances);function xt(Ne,Kt,mn){if(!o.TypeRegistry.Has(Ne)||!Ft.has(Kt))return!1;const er=o.TypeRegistry.Get(Ne),ji=Ft.get(Kt);return er(ji,mn)}function zt(Ne,Kt){return o.FormatRegistry.Has(Ne)?o.FormatRegistry.Get(Ne)(Kt):!1}function fn(Ne){return(0,r.Hash)(Ne)}const je=Rt(xt,zt,fn);return new C(Pe,Ye,je,ke)}O.Compile=Ue})(w||(Pa.TypeCompiler=w={})),Pa}var lJ;function MSe(){return lJ||(lJ=1,(function(e){var n=lp&&lp.__createBinding||(Object.create?(function(i,r,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(r,s);(!u||("get"in u?!r.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(i,o,u)}):(function(i,r,s,o){o===void 0&&(o=s),i[o]=r[s]})),a=lp&&lp.__exportStar||function(i,r){for(var s in i)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&n(r,i,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.ValueErrorIterator=e.ValueErrorType=void 0;var t=moe();Object.defineProperty(e,"ValueErrorType",{enumerable:!0,get:function(){return t.ValueErrorType}}),Object.defineProperty(e,"ValueErrorIterator",{enumerable:!0,get:function(){return t.ValueErrorIterator}}),a(jSe(),e)})(lp)),lp}var fJ;function NSe(){return fJ||(fJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.FormatValidatorBasic=e.typeboxValidator=void 0;const n=MSe(),a=zn();e.typeboxValidator={compile:t=>{const i=n.TypeCompiler.Compile(t);return{check:r=>i.Check(r)}}},e.FormatValidatorBasic=(0,a.toFormatValidator)(e.typeboxValidator)})(gN)),gN}var hJ;function ASe(){return hJ||(hJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.FormatValidatorBasic=e.typeboxValidator=void 0;var n=NSe();Object.defineProperty(e,"typeboxValidator",{enumerable:!0,get:function(){return n.typeboxValidator}}),Object.defineProperty(e,"FormatValidatorBasic",{enumerable:!0,get:function(){return n.FormatValidatorBasic}})})(pN)),pN}var yN={},mJ;function DSe(){if(mJ)return yN;mJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(yN,"__esModule",{value:!0}),yN}var GC={},pJ;function kSe(){if(pJ)return GC;pJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(GC,"__esModule",{value:!0}),GC.JsonAsTree=void 0;const e=gd(),n=new e.SchemaFactoryAlpha("com.fluidframework.json");var a;return(function(t){t.Primitive=[e.SchemaFactory.null,e.SchemaFactory.number,e.SchemaFactory.string,e.SchemaFactory.boolean],t.Tree=[...t.Primitive,()=>i,()=>r],t._APIExtractorWorkaroundObjectBase=n.recordRecursive("object",t.Tree);class i extends t._APIExtractorWorkaroundObjectBase{}t.JsonObject=i,t._APIExtractorWorkaroundArrayBase=n.arrayRecursive("array",t.Tree);class r extends t._APIExtractorWorkaroundArrayBase{}t.Array=r})(a||(GC.JsonAsTree=a={})),GC}var WC={},gJ;function xSe(){if(gJ)return WC;gJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(WC,"__esModule",{value:!0}),WC.FluidSerializableAsTree=void 0;const e=gd(),n=new e.SchemaFactory("com.fluidframework.serializable");var a;return(function(t){t.Tree=[()=>i,()=>r,...e.SchemaFactory.leaves],t._APIExtractorWorkaroundObjectBase=n.mapRecursive("object",t.Tree);class i extends t._APIExtractorWorkaroundObjectBase{}t.FluidSerializableObject=i,t._APIExtractorWorkaroundArrayBase=n.arrayRecursive("array",t.Tree);class r extends t._APIExtractorWorkaroundArrayBase{}t.Array=r})(a||(WC.FluidSerializableAsTree=a={})),WC}var vp={},yJ;function qSe(){if(yJ)return vp;yJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(vp,"__esModule",{value:!0}),vp.TableSchema=vp.System_TableSchema=void 0;const e=Je(),n=Ot(),a=eE(),t=gd(),i="table";function r(d){const l=a.Tree.parent(d);if(l===void 0||!(0,t.isArrayNodeSchema)(a.Tree.schema(l)))return;const f=a.Tree.parent(l);if(!(f===void 0||!o(f)))return f}const s=Symbol("tableNode");function o(d){return s in a.Tree.schema(d)}var u;(function(d){function l(C,v,m){const h=C.scopedFactoryAlpha(i),S={...{id:h.identifier},...{props:m}};class p extends h.objectAlpha("Column",S,{allowUnknownOptionalFields:!0}){getCells(){const E=r(this);if(E===void 0)throw new n.UsageError(`Column with ID "${this.id}" is not contained in a table.`);const F=[];for(const R of E.rows){const M=R.getCell(this.id);if(M!==void 0){if(!a.Tree.is(M,v))throw new n.UsageError("Parent table contains a cell with incompatible with this column.");F.push({rowId:R.id,cell:M})}}return F}}return p}d.createColumnSchema=l;function f(C,v,m){const h=C.scopedFactoryAlpha(i),S={...{id:h.identifier,cells:h.required(h.record("Row.cells",v),{metadata:{description:"The cells of the table row, keyed by column ID."}})},...{props:m}};class p extends h.objectAlpha("Row",S,{allowUnknownOptionalFields:!0}){getCell(E){const F=typeof E=="string"?E:E.id;return this.cells[F]}setCell(E,F){if(F===void 0)this.removeCell(E);else{const R=typeof E=="string"?E:E.id;this.cells[R]=a.TreeAlpha.create(v,F)}}removeCell(E){const F=typeof E=="string"?E:E.id,R=this.getCell(F);if(R!==void 0)return delete this.cells[F],R}getCells(){const E=[];for(const[F,R]of Object.entries(this.cells))R!==void 0&&E.push({columnId:F,cell:R});return E}}return p}d.createRowSchema=f;function b(C,v,m,h){const g=C.scopedFactoryAlpha(i),_={rows:g.array("Table.rows",h),columns:g.array("Table.columns",m)};class S extends g.objectAlpha("Table",_,{allowUnknownOptionalFields:!0}){static empty(){return new this({columns:[],rows:[]})}getColumn(O){return this.columns.find(E=>E.id===O)}getRow(O){return this.rows.find(E=>E.id===O)}getCell(O){const{column:E,row:F}=O,R=this._tryGetRow(F);if(R===void 0)return;const M=this._tryGetColumn(E);if(M!==void 0)return R.getCell(M)}insertColumns({columns:O,index:E}){return E!==void 0&&S.validateInsertionIndex(E,this.columns),E===void 0?this.columns.insertAtEnd(t.TreeArrayNode.spread(O)):this.columns.insertAt(E,t.TreeArrayNode.spread(O)),O}insertRows({index:O,rows:E}){O!==void 0&&S.validateInsertionIndex(O,this.rows);for(const F of E)if(F.cells!==void 0){const R=Object.keys(F.cells);for(const M of R)if(!this._containsColumnWithId(M))throw new n.UsageError(`Attempted to insert row a cell under column ID "${M}", but the table does not contain a column with that ID.`)}return O===void 0?this.rows.insertAtEnd(t.TreeArrayNode.spread(E)):this.rows.insertAt(O,t.TreeArrayNode.spread(E)),E}setCell({key:O,cell:E}){const{column:F,row:R}=O,M=this._getRow(R),j=this._getColumn(F);M.setCell(j,E)}removeColumns(O,E=void 0){if(typeof O=="number"||O===void 0){let F;const R=O??0,M=E??this.columns.length-R;return M===0?[]:(S._assertValidRange({index:R,count:M},this.columns),this._applyEditsInBatch(()=>{const j=this.columns.slice(R,R+M);for(const k of j)this._removeCells(k);S._removeRange({index:R,count:M},this.columns),F=j}),F??(0,e.fail)(3103))}else{if(O.length===0)return[];const F=[];for(const R of O)F.push(this._getColumn(R));return this._applyEditsInBatch(()=>{for(const R of F){for(const M of this.rows)M.removeCell(R);this.columns.removeAt(this.columns.indexOf(R))}}),F}}removeRows(O,E){if(typeof O=="number"||O===void 0){const R=O??0,M=E??this.columns.length-R;return M===0?[]:S._removeRange({index:R,count:M},this.rows)}if(O.length===0)return[];const F=[];for(const R of O)F.push(this._getRow(R));return this._applyEditsInBatch(()=>{for(const R of F)this.rows.removeAt(this.rows.indexOf(R))}),F}removeCell(O){const{column:E,row:F}=O,R=this._getRow(F),M=this._getColumn(E),j=R.getCell(M.id);if(j!==void 0)return R.removeCell(M.id),j}_removeCells(O){for(const E of this.rows)E.removeCell(O)}static _assertValidRange(O,E){const{index:F,count:R}=O;if(F<0||F>=E.length)throw new n.UsageError(`Start index out of bounds. Expected index to be on [0, ${E.length-1}], but got ${F}.`);if(R<0)throw new n.UsageError(`Expected non-negative count. Got ${R}.`);const M=F+R;if(M>E.length)throw new n.UsageError(`End index out of bounds. Expected end to be on [${F}, ${E.length}], but got ${M}.`)}_applyEditsInBatch(O){const E=a.TreeAlpha.branch(this);E===void 0?O():E.runTransaction(()=>{O()})}_tryGetColumn(O){const E=this._getColumnId(O);return this.getColumn(E)}_getColumn(O){const E=this._tryGetColumn(O);return E===void 0&&this._throwMissingColumnError(this._getColumnId(O)),E}_getColumnId(O){return typeof O=="string"?O:O.id}_containsColumnWithId(O){return this._tryGetColumn(O)!==void 0}_throwMissingColumnError(O){throw new n.UsageError(`No column with ID "${O}" exists in the table.`)}_tryGetRow(O){const E=this._getRowId(O);return this.getRow(E)}_getRow(O){const E=this._tryGetRow(O);return E===void 0&&this._throwMissingRowError(this._getRowId(O)),E}_getRowId(O){return typeof O=="string"?O:O.id}_throwMissingRowError(O){throw new n.UsageError(`No row with ID "${O}" exists in the table.`)}static _removeRange(O,E){S._assertValidRange(O,E);const{index:F,count:R}=O,M=F+R,j=E.slice(F,M);return E.removeRange(F,M),j}static validateInsertionIndex(O,E){if(O<0)throw new n.UsageError("The index must be greater than or equal to 0.");if(O>E.length)throw new n.UsageError("The index specified for insertion is out of bounds.");if(!Number.isInteger(O))throw new n.UsageError("The index must be an integer.")}}return S[s]=!0,S}d.createTableSchema=b})(u||(vp.System_TableSchema=u={}));var c;return(function(d){function l({schemaFactory:C,cell:v,props:m=t.SchemaFactory.optional(t.SchemaFactory.null)}){return u.createColumnSchema(C,v,m)}d.column=l;function f({schemaFactory:C,cell:v,props:m=t.SchemaFactory.optional(t.SchemaFactory.null)}){return u.createRowSchema(C,v,m)}d.row=f;function b({schemaFactory:C,cell:v,column:m=l({schemaFactory:C,cell:v}),row:h=f({schemaFactory:C,cell:v})}){return u.createTableSchema(C,v,m,h)}d.table=b})(c||(vp.TableSchema=c={})),vp}var bJ;function Y1(){return bJ||(bJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=bu&&bu.__createBinding||(Object.create?(function(_,S,p,w){w===void 0&&(w=p);var O=Object.getOwnPropertyDescriptor(S,p);(!O||("get"in O?!S.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return S[p]}}),Object.defineProperty(_,w,O)}):(function(_,S,p,w){w===void 0&&(w=p),_[w]=S[p]})),a=bu&&bu.__setModuleDefault||(Object.create?(function(_,S){Object.defineProperty(_,"default",{enumerable:!0,value:S})}):function(_,S){_.default=S}),t=bu&&bu.__importStar||function(_){if(_&&_.__esModule)return _;var S={};if(_!=null)for(var p in _)p!=="default"&&Object.prototype.hasOwnProperty.call(_,p)&&n(S,_,p);return a(S,_),S};Object.defineProperty(e,"__esModule",{value:!0}),e.ArrayNodeSchema=e.allowUnused=e.replaceVerboseTreeHandles=e.replaceHandles=e.replaceConciseTreeHandles=e.evaluateLazySchema=e.generateSchemaFromSimpleSchema=e.rollback=e.asTreeViewAlpha=e.getSimpleSchema=e.walkAllowedTypes=e.walkNodeSchema=e.walkFieldSchema=e.normalizeAllowedTypes=e.getJsonSchema=e.comparePersistedSchema=e.extractPersistedSchema=e.TreeViewConfigurationAlpha=e.TreeBeta=e.singletonSchema=e.enumFromStrings=e.adaptEnum=e.createIdentifierIndex=e.createSimpleTreeIndex=e.normalizeFieldSchema=e.ObjectNodeSchema=e.NodeKind=e.FieldSchema=e.FieldKind=e.SchemaFactoryAlpha=e.SchemaFactoryBeta=e.SchemaFactory=e.TreeViewConfiguration=e.TreeNode=e.IterableTreeArrayContent=e.TreeArrayNode=e.ForestTypeReference=e.ForestTypeExpensiveDebug=e.ForestTypeOptimized=e.independentView=e.TreeAlpha=e.independentInitializedView=e.getBranch=e.Tree=e.SharedTreeFormatVersion=e.TreeCompressionStrategy=e.TreeStatus=e.RevertibleStatus=e.CommitKind=e.ValueSchema=void 0,e.TableSchema=e.FluidSerializableAsTree=e.JsonAsTree=e.InternalTypes=e.cloneWithReplacements=e.FormatValidatorBasic=e.typeboxValidator=e.noopValidator=e.FormatValidatorNoOp=e.FluidClientVersion=e.persistedToSimpleSchema=e.SharedTreeFactoryType=e.SharedTreeAttributes=e.configuredSharedTree=e.SharedTree=e.KeyEncodingOptions=e.RecordNodeSchema=e.MapNodeSchema=void 0;var i=Vt();Object.defineProperty(e,"ValueSchema",{enumerable:!0,get:function(){return i.ValueSchema}}),Object.defineProperty(e,"CommitKind",{enumerable:!0,get:function(){return i.CommitKind}}),Object.defineProperty(e,"RevertibleStatus",{enumerable:!0,get:function(){return i.RevertibleStatus}});var r=An();Object.defineProperty(e,"TreeStatus",{enumerable:!0,get:function(){return r.TreeStatus}}),Object.defineProperty(e,"TreeCompressionStrategy",{enumerable:!0,get:function(){return r.TreeCompressionStrategy}});var s=eE();Object.defineProperty(e,"SharedTreeFormatVersion",{enumerable:!0,get:function(){return s.SharedTreeFormatVersion}}),Object.defineProperty(e,"Tree",{enumerable:!0,get:function(){return s.Tree}}),Object.defineProperty(e,"getBranch",{enumerable:!0,get:function(){return s.getBranch}}),Object.defineProperty(e,"independentInitializedView",{enumerable:!0,get:function(){return s.independentInitializedView}}),Object.defineProperty(e,"TreeAlpha",{enumerable:!0,get:function(){return s.TreeAlpha}}),Object.defineProperty(e,"independentView",{enumerable:!0,get:function(){return s.independentView}}),Object.defineProperty(e,"ForestTypeOptimized",{enumerable:!0,get:function(){return s.ForestTypeOptimized}}),Object.defineProperty(e,"ForestTypeExpensiveDebug",{enumerable:!0,get:function(){return s.ForestTypeExpensiveDebug}}),Object.defineProperty(e,"ForestTypeReference",{enumerable:!0,get:function(){return s.ForestTypeReference}});var o=gd();Object.defineProperty(e,"TreeArrayNode",{enumerable:!0,get:function(){return o.TreeArrayNode}}),Object.defineProperty(e,"IterableTreeArrayContent",{enumerable:!0,get:function(){return o.IterableTreeArrayContent}}),Object.defineProperty(e,"TreeNode",{enumerable:!0,get:function(){return o.TreeNode}}),Object.defineProperty(e,"TreeViewConfiguration",{enumerable:!0,get:function(){return o.TreeViewConfiguration}}),Object.defineProperty(e,"SchemaFactory",{enumerable:!0,get:function(){return o.SchemaFactory}}),Object.defineProperty(e,"SchemaFactoryBeta",{enumerable:!0,get:function(){return o.SchemaFactoryBeta}}),Object.defineProperty(e,"SchemaFactoryAlpha",{enumerable:!0,get:function(){return o.SchemaFactoryAlpha}}),Object.defineProperty(e,"FieldKind",{enumerable:!0,get:function(){return o.FieldKind}}),Object.defineProperty(e,"FieldSchema",{enumerable:!0,get:function(){return o.FieldSchema}}),Object.defineProperty(e,"NodeKind",{enumerable:!0,get:function(){return o.NodeKind}}),Object.defineProperty(e,"ObjectNodeSchema",{enumerable:!0,get:function(){return o.ObjectNodeSchema}}),Object.defineProperty(e,"normalizeFieldSchema",{enumerable:!0,get:function(){return o.normalizeFieldSchema}}),Object.defineProperty(e,"createSimpleTreeIndex",{enumerable:!0,get:function(){return o.createSimpleTreeIndex}}),Object.defineProperty(e,"createIdentifierIndex",{enumerable:!0,get:function(){return o.createIdentifierIndex}}),Object.defineProperty(e,"adaptEnum",{enumerable:!0,get:function(){return o.adaptEnum}}),Object.defineProperty(e,"enumFromStrings",{enumerable:!0,get:function(){return o.enumFromStrings}}),Object.defineProperty(e,"singletonSchema",{enumerable:!0,get:function(){return o.singletonSchema}}),Object.defineProperty(e,"TreeBeta",{enumerable:!0,get:function(){return o.TreeBeta}}),Object.defineProperty(e,"TreeViewConfigurationAlpha",{enumerable:!0,get:function(){return o.TreeViewConfigurationAlpha}}),Object.defineProperty(e,"extractPersistedSchema",{enumerable:!0,get:function(){return o.extractPersistedSchema}}),Object.defineProperty(e,"comparePersistedSchema",{enumerable:!0,get:function(){return o.comparePersistedSchema}}),Object.defineProperty(e,"getJsonSchema",{enumerable:!0,get:function(){return o.getJsonSchema}}),Object.defineProperty(e,"normalizeAllowedTypes",{enumerable:!0,get:function(){return o.normalizeAllowedTypes}}),Object.defineProperty(e,"walkFieldSchema",{enumerable:!0,get:function(){return o.walkFieldSchema}}),Object.defineProperty(e,"walkNodeSchema",{enumerable:!0,get:function(){return o.walkNodeSchema}}),Object.defineProperty(e,"walkAllowedTypes",{enumerable:!0,get:function(){return o.walkAllowedTypes}}),Object.defineProperty(e,"getSimpleSchema",{enumerable:!0,get:function(){return o.getSimpleSchema}}),Object.defineProperty(e,"asTreeViewAlpha",{enumerable:!0,get:function(){return o.asTreeViewAlpha}}),Object.defineProperty(e,"rollback",{enumerable:!0,get:function(){return o.rollback}}),Object.defineProperty(e,"generateSchemaFromSimpleSchema",{enumerable:!0,get:function(){return o.generateSchemaFromSimpleSchema}}),Object.defineProperty(e,"evaluateLazySchema",{enumerable:!0,get:function(){return o.evaluateLazySchema}}),Object.defineProperty(e,"replaceConciseTreeHandles",{enumerable:!0,get:function(){return o.replaceConciseTreeHandles}}),Object.defineProperty(e,"replaceHandles",{enumerable:!0,get:function(){return o.replaceHandles}}),Object.defineProperty(e,"replaceVerboseTreeHandles",{enumerable:!0,get:function(){return o.replaceVerboseTreeHandles}}),Object.defineProperty(e,"allowUnused",{enumerable:!0,get:function(){return o.allowUnused}}),Object.defineProperty(e,"ArrayNodeSchema",{enumerable:!0,get:function(){return o.ArrayNodeSchema}}),Object.defineProperty(e,"MapNodeSchema",{enumerable:!0,get:function(){return o.MapNodeSchema}}),Object.defineProperty(e,"RecordNodeSchema",{enumerable:!0,get:function(){return o.RecordNodeSchema}}),Object.defineProperty(e,"KeyEncodingOptions",{enumerable:!0,get:function(){return o.KeyEncodingOptions}});var u=_Se();Object.defineProperty(e,"SharedTree",{enumerable:!0,get:function(){return u.SharedTree}}),Object.defineProperty(e,"configuredSharedTree",{enumerable:!0,get:function(){return u.configuredSharedTree}});var c=loe();Object.defineProperty(e,"SharedTreeAttributes",{enumerable:!0,get:function(){return c.SharedTreeAttributes}}),Object.defineProperty(e,"SharedTreeFactoryType",{enumerable:!0,get:function(){return c.SharedTreeFactoryType}});var d=eE();Object.defineProperty(e,"persistedToSimpleSchema",{enumerable:!0,get:function(){return d.persistedToSimpleSchema}});var l=zn();Object.defineProperty(e,"FluidClientVersion",{enumerable:!0,get:function(){return l.FluidClientVersion}}),Object.defineProperty(e,"FormatValidatorNoOp",{enumerable:!0,get:function(){return l.FormatValidatorNoOp}});var f=zn();Object.defineProperty(e,"noopValidator",{enumerable:!0,get:function(){return f.noopValidator}});var b=ASe();Object.defineProperty(e,"typeboxValidator",{enumerable:!0,get:function(){return b.typeboxValidator}}),Object.defineProperty(e,"FormatValidatorBasic",{enumerable:!0,get:function(){return b.FormatValidatorBasic}});var C=Bt();Object.defineProperty(e,"cloneWithReplacements",{enumerable:!0,get:function(){return C.cloneWithReplacements}});const v=t(DSe());e.InternalTypes=v;var m=kSe();Object.defineProperty(e,"JsonAsTree",{enumerable:!0,get:function(){return m.JsonAsTree}});var h=xSe();Object.defineProperty(e,"FluidSerializableAsTree",{enumerable:!0,get:function(){return h.FluidSerializableAsTree}});var g=qSe();Object.defineProperty(e,"TableSchema",{enumerable:!0,get:function(){return g.TableSchema}})})(bu)),bu}var vJ;function LSe(){if(vJ)return cS;vJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(cS,"__esModule",{value:!0}),cS.TreeDataObjectFactory=void 0;const e=Y1(),n=Rx();class a extends n.PureDataObjectFactory{constructor(i){const r={...i,sharedObjects:i.sharedObjects?[...i.sharedObjects]:[]};r.sharedObjects.some(s=>s.type===e.SharedTree.getFactory().type)||r.sharedObjects.push(e.SharedTree.getFactory()),super(r)}}return cS.TreeDataObjectFactory=a,cS}var SJ;function BSe(){return SJ||(SJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TreeDataObjectFactory=e.PureDataObjectFactory=e.DataObjectFactory=void 0;var n=Iye();Object.defineProperty(e,"DataObjectFactory",{enumerable:!0,get:function(){return n.DataObjectFactory}});var a=Rx();Object.defineProperty(e,"PureDataObjectFactory",{enumerable:!0,get:function(){return a.PureDataObjectFactory}});var t=LSe();Object.defineProperty(e,"TreeDataObjectFactory",{enumerable:!0,get:function(){return t.TreeDataObjectFactory}})})(cj)),cj}var bN={},JC={},CJ;function USe(){if(CJ)return JC;CJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(JC,"__esModule",{value:!0}),JC.createDataObjectKind=void 0;function e(n){return n}return JC.createDataObjectKind=e,JC}var QC={},YC={},_J;function Nq(){if(_J)return YC;_J=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(YC,"__esModule",{value:!0}),YC.PureDataObject=void 0;const e=Ht(),n=Je(),a=bn();class t extends e.TypedEventEmitter{get id(){return this.runtime.id}get IFluidLoadable(){return this}get IFluidHandle(){return this.handle}get handle(){return(0,n.assert)(this.runtime.entryPoint!==void 0,1131),this.runtime.entryPoint}static async getDataObject(r){return await r.entryPoint.get()}constructor(r){super(),this.runtime=r.runtime,this.context=r.context,this.providers=r.providers,this.initProps=r.initProps}async request(r){return r.url===""||r.url==="/"||r.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:this}:(0,a.create404Response)(r)}async finishInitialization(r){return this.initializeP??=this.initializeInternal(r),this.initializeP}async initializeInternal(r){await this.preInitialize(),r?((0,n.assert)(this.initProps===void 0,190),await this.initializingFromExisting()):await this.initializingFirstTime(this.context.createProps??this.initProps),await this.hasInitialized()}async preInitialize(){}async initializingFirstTime(r){}async initializingFromExisting(){}async hasInitialized(){}}return YC.PureDataObject=t,YC}var TJ;function zSe(){if(TJ)return QC;TJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(QC,"__esModule",{value:!0}),QC.DataObject=void 0;const e=yE(),n=Nq();class a extends n.PureDataObject{constructor(){super(...arguments),this.rootDirectoryId="root"}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(i){i?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===e.MapFactory.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=e.SharedDirectory.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(i)}getUninitializedErrorString(i){return`${i} must be initialized before being accessed.`}}return QC.DataObject=a,QC}var Uu={},wJ;function VSe(){if(wJ)return Uu;wJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Uu&&Uu.__classPrivateFieldGet||function(c,d,l,f){if(l==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof d=="function"?c!==d||!f:!d.has(c))throw new TypeError("Cannot read private member from an object whose class did not declare it");return l==="m"?f:l==="a"?f.call(c):f?f.value:d.get(c)},n=Uu&&Uu.__classPrivateFieldSet||function(c,d,l,f,b){if(f==="m")throw new TypeError("Private method is not writable");if(f==="a"&&!b)throw new TypeError("Private accessor was defined without a setter");if(typeof d=="function"?c!==d||!b:!d.has(c))throw new TypeError("Cannot write private member to an object whose class did not declare it");return f==="a"?b.call(c,l):b?b.value=l:d.set(c,l),l},a;Object.defineProperty(Uu,"__esModule",{value:!0}),Uu.TreeDataObject=void 0;const t=Ot(),i=Y1(),r=Nq(),s="root-tree",o="The tree has not yet been initialized. The data object must be initialized before accessing.";class u extends r.PureDataObject{constructor(){super(...arguments),a.set(this,void 0)}get tree(){if(e(this,a,"f")===void 0)throw new t.UsageError(o);return e(this,a,"f")}async initializeInternal(d){if(d){const l=await this.runtime.getChannel(s);if(!i.SharedTree.is(l))throw new Error(`Content with id ${l.id} is not a SharedTree and cannot be loaded with treeDataObject.`);n(this,a,l,"f")}else{const l=this.runtime.createChannel(s,i.SharedTree.getFactory().type);l.bindToContext(),n(this,a,l,"f")}await super.initializeInternal(d)}}return Uu.TreeDataObject=u,a=new WeakMap,Uu}var OJ;function HSe(){return OJ||(OJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TreeDataObject=e.PureDataObject=e.DataObject=e.createDataObjectKind=void 0;var n=USe();Object.defineProperty(e,"createDataObjectKind",{enumerable:!0,get:function(){return n.createDataObjectKind}});var a=zSe();Object.defineProperty(e,"DataObject",{enumerable:!0,get:function(){return a.DataObject}});var t=Nq();Object.defineProperty(e,"PureDataObject",{enumerable:!0,get:function(){return t.PureDataObject}});var i=VSe();Object.defineProperty(e,"TreeDataObject",{enumerable:!0,get:function(){return i.TreeDataObject}})})(bN)),bN}var vN={},XC={},SN={},ZC={},PJ;function KSe(){if(PJ)return ZC;PJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ZC,"__esModule",{value:!0}),ZC.buildRuntimeRequestHandler=void 0;const e=bn();class n{constructor(){this.handlers=[]}pushHandler(...i){i!==void 0&&this.handlers.push(...i)}async handleRequest(i,r){const s=e.RequestParser.create(i);for(const o of this.handlers){const u=await o(s,r);if(u!==void 0)return u}return(0,e.create404Response)(i)}}function a(...t){const i=new n;return i.pushHandler(...t),async(r,s)=>i.handleRequest(r,s)}return ZC.buildRuntimeRequestHandler=a,ZC}var EJ;function $Se(){return EJ||(EJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.buildRuntimeRequestHandler=void 0;var n=KSe();Object.defineProperty(e,"buildRuntimeRequestHandler",{enumerable:!0,get:function(){return n.buildRuntimeRequestHandler}})})(SN)),SN}var CN={},e_={},t_={},IJ;function poe(){if(IJ)return t_;IJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(t_,"__esModule",{value:!0}),t_.IFluidDependencySynthesizer=void 0,t_.IFluidDependencySynthesizer="IFluidDependencySynthesizer",t_}var RJ;function GSe(){if(RJ)return e_;RJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e_,"__esModule",{value:!0}),e_.DependencyContainer=void 0;const e=Je(),n=poe();class a{get IFluidDependencySynthesizer(){return this}constructor(...i){this.providers=new Map,this.parents=i.filter(r=>r!==void 0)}register(i,r){if(this.providers.has(i))throw new Error(`Attempting to register a provider of type ${String(i)} that already exists`);this.providers.set(i,r)}unregister(i){this.providers.has(i)&&this.providers.delete(i)}synthesize(i,r){const s={};return this.generateRequired(s,r),this.generateOptional(s,i),Object.defineProperty(s,n.IFluidDependencySynthesizer,{get:()=>this}),s}has(i,r){return this.providers.has(i)?!0:r!==!0?this.parents.some(s=>s.has(i)):!1}getProvider(i){if(this.has(i)){if(this.providers.has(i))return this.providers.get(i);for(const r of this.parents){if(r instanceof a)return r.getProvider(i);{const s=r;if(s?.getProvider!==void 0)return s.getProvider(i)}}}}generateRequired(i,r){if(r!==void 0)for(const s of Object.keys(r)){const o=this.resolveProvider(s);if(o===void 0)throw new Error(`Object attempted to be created without registered required provider ${String(s)}`);Object.defineProperty(i,s,o)}}generateOptional(i,r){if(r!==void 0)for(const s of Object.keys(r)){const o=this.resolveProvider(s)??{get:async()=>{}};Object.defineProperty(i,s,o)}}resolveProvider(i){const r=this.providers.get(i);if(r===void 0){for(const s of this.parents){const o={[i]:i},u=s.synthesize(o,{}),c=Object.getOwnPropertyDescriptor(u,i);if(c!==void 0)return c}return}return typeof r=="function"?{get(){if(r&&typeof r=="function")return Promise.resolve(this[n.IFluidDependencySynthesizer]).then(async s=>r(s)).then(s=>s?.[i])}}:{get(){if(r)return new e.LazyPromise(async()=>Promise.resolve(r).then(s=>{if(s)return s[i]}))}}}}return e_.DependencyContainer=a,e_}var FJ;function WSe(){return FJ||(FJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.IFluidDependencySynthesizer=e.DependencyContainer=void 0;var n=GSe();Object.defineProperty(e,"DependencyContainer",{enumerable:!0,get:function(){return n.DependencyContainer}});var a=poe();Object.defineProperty(e,"IFluidDependencySynthesizer",{enumerable:!0,get:function(){return a.IFluidDependencySynthesizer}})})(CN)),CN}var jJ;function goe(){if(jJ)return XC;jJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(XC,"__esModule",{value:!0}),XC.BaseContainerRuntimeFactory=void 0;const e=OE(),n=$Se(),a=bn(),t=WSe();class i extends a.RuntimeFactoryHelper{get IFluidDataStoreRegistry(){return this.registry}constructor(s){super(),this.registryEntries=s.registryEntries,this.dependencyContainer=s.dependencyContainer,this.runtimeOptions=s.runtimeOptions,this.provideEntryPoint=s.provideEntryPoint,this.requestHandlers=s.requestHandlers??[],this.registry=new e.FluidDataStoreRegistry(this.registryEntries),this.minVersionForCollab=s.minVersionForCollab}async instantiateFirstTime(s){await this.containerInitializingFirstTime(s),await this.containerHasInitialized(s)}async instantiateFromExisting(s){await this.containerHasInitialized(s)}async preInitialize(s,o){const u=s.scope;if(this.dependencyContainer){const c=new t.DependencyContainer(this.dependencyContainer,u.IFluidDependencySynthesizer);u.IFluidDependencySynthesizer=c}return(0,e.loadContainerRuntime)({context:s,existing:o,runtimeOptions:this.runtimeOptions,registryEntries:this.registryEntries,containerScope:u,requestHandler:(0,n.buildRuntimeRequestHandler)(...this.requestHandlers),provideEntryPoint:this.provideEntryPoint,minVersionForCollab:this.minVersionForCollab})}async containerInitializingFirstTime(s){}async containerHasInitialized(s){}}return XC.BaseContainerRuntimeFactory=i,XC}var n_={},MJ;function JSe(){if(MJ)return n_;MJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(n_,"__esModule",{value:!0}),n_.ContainerRuntimeFactoryWithDefaultDataStore=void 0;const e=bn(),n=goe(),a="default";async function t(r){const s=await r.getAliasedDataStoreEntryPoint("default");if(s===void 0)throw new Error("default dataStore must exist");return s.get()}class i extends n.BaseContainerRuntimeFactory{constructor(s){const o=s.requestHandlers??[],u=s.provideEntryPoint??t,c=async(d,l)=>{const f=e.RequestParser.create(d);if(f.pathParts.length===0)return l.resolveHandle({url:`/${a}${f.query}`,headers:d.headers})};super({...s,requestHandlers:[c,...o],provideEntryPoint:u}),this.defaultFactory=s.defaultFactory}async containerInitializingFirstTime(s){await(await s.createDataStore(this.defaultFactory.type)).trySetAlias(a)}}return n_.ContainerRuntimeFactoryWithDefaultDataStore=i,i.defaultDataStoreId=a,n_}var NJ;function QSe(){return NJ||(NJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerRuntimeFactoryWithDefaultDataStore=e.BaseContainerRuntimeFactory=void 0;var n=goe();Object.defineProperty(e,"BaseContainerRuntimeFactory",{enumerable:!0,get:function(){return n.BaseContainerRuntimeFactory}});var a=JSe();Object.defineProperty(e,"ContainerRuntimeFactoryWithDefaultDataStore",{enumerable:!0,get:function(){return a.ContainerRuntimeFactoryWithDefaultDataStore}})})(vN)),vN}var AJ;function $o(){return AJ||(AJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerRuntimeFactoryWithDefaultDataStore=e.BaseContainerRuntimeFactory=e.createDataObjectKind=e.TreeDataObject=e.PureDataObject=e.DataObject=e.TreeDataObjectFactory=e.PureDataObjectFactory=e.DataObjectFactory=void 0;var n=BSe();Object.defineProperty(e,"DataObjectFactory",{enumerable:!0,get:function(){return n.DataObjectFactory}}),Object.defineProperty(e,"PureDataObjectFactory",{enumerable:!0,get:function(){return n.PureDataObjectFactory}}),Object.defineProperty(e,"TreeDataObjectFactory",{enumerable:!0,get:function(){return n.TreeDataObjectFactory}});var a=HSe();Object.defineProperty(e,"DataObject",{enumerable:!0,get:function(){return a.DataObject}}),Object.defineProperty(e,"PureDataObject",{enumerable:!0,get:function(){return a.PureDataObject}}),Object.defineProperty(e,"TreeDataObject",{enumerable:!0,get:function(){return a.TreeDataObject}}),Object.defineProperty(e,"createDataObjectKind",{enumerable:!0,get:function(){return a.createDataObjectKind}});var t=QSe();Object.defineProperty(e,"BaseContainerRuntimeFactory",{enumerable:!0,get:function(){return t.BaseContainerRuntimeFactory}}),Object.defineProperty(e,"ContainerRuntimeFactoryWithDefaultDataStore",{enumerable:!0,get:function(){return t.ContainerRuntimeFactoryWithDefaultDataStore}})})(oj)),oj}var r_={},DJ;function yoe(){if(DJ)return r_;DJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(r_,"__esModule",{value:!0}),r_.compatibilityModeRuntimeOptions=void 0,r_.compatibilityModeRuntimeOptions={1:{},2:{enableRuntimeIdCompressor:"on"}},r_}var Ii={},kJ;function Aq(){if(kJ)return Ii;kJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.isTreeContainerSchema=Ii.compatibilityModeToMinVersionForCollab=Ii.makeFluidObject=Ii.createSharedObject=Ii.createDataObject=Ii.parseDataObjectsFromSharedObjects=Ii.isSharedObjectKind=Ii.isDataObjectKind=void 0;const e=Je(),n=Ot(),a=Y1();function t(d){const l=d,f=l?.factory?.IFluidDataStoreFactory!==void 0&&l.factory.IFluidDataStoreFactory===l.factory;if(f===(d.getFactory!==void 0))throw new n.UsageError("Invalid LoadableObjectClass");return f}Ii.isDataObjectKind=t;function i(d){return!t(d)}Ii.isSharedObjectKind=i;const r=d=>{const l=new Set,f=new Set,b=v=>{if(i(v))f.add(v.getFactory());else if(t(v))l.add([v.factory.type,Promise.resolve(v.factory)]);else throw new Error("Entry is neither a DataObject or a SharedObject")},C=new Set([...Object.values(d.initialObjects),...d.dynamicObjectTypes??[]]);for(const v of C)b(v);if(l.size===0&&f.size===0)throw new Error("Container cannot be initialized without any DataTypes");return[[...l],[...f]]};Ii.parseDataObjectsFromSharedObjects=r;async function s(d,l){const f=d.factory,b=[...l.packagePath,f.type];return await(await l.containerRuntime.createDataStore(b)).entryPoint.get()}Ii.createDataObject=s;function o(d,l){const f=d.getFactory();return l.createChannel(void 0,f.type)}Ii.createSharedObject=o;function u(d,l){return Object.defineProperty(d,l,{value:d})}Ii.makeFluidObject=u,Ii.compatibilityModeToMinVersionForCollab={1:"1.0.0",2:"2.0.0"};function c(d){const l=Object.entries(d.initialObjects);if(l.length!==1)return!1;const f=l[0]??(0,e.oob)();if(f[0]!=="tree")return!1;const C=f[1];return!!(i(C)&&C.getFactory().type===a.SharedTreeFactoryType)}return Ii.isTreeContainerSchema=c,Ii}var xJ;function YSe(){if(xJ)return p0;xJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(p0,"__esModule",{value:!0}),p0.createDOProviderContainerRuntimeFactory=void 0;const e=$o(),n=OE(),a=Je(),t=yoe(),i=Aq();class r extends e.DataObject{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get RootDataObject(){return this}get initialObjectsDir(){const b=this.root.getSubDirectory(this.initialObjectsDirKey);if(b===void 0)throw new Error("InitialObjects sub-directory was not initialized");return b}async initializingFirstTime(b){this.root.createSubDirectory(this.initialObjectsDirKey);const C=[];for(const[v,m]of Object.entries(b.initialObjects)){const h=async()=>{const g=await this.create(m);this.initialObjectsDir.set(v,g.handle)};C.push(h())}await Promise.all(C)}async hasInitialized(){const b=[];for(const[C,v]of this.initialObjectsDir.entries()){const m=async()=>{const h=await v.get();Object.assign(this._initialObjects,{[C]:h})};b.push(m())}await Promise.all(b)}get initialObjects(){if(Object.keys(this._initialObjects).length===0)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(b){const C=b;if((0,i.isDataObjectKind)(C))return(0,i.createDataObject)(C,this.context);if((0,i.isSharedObjectKind)(C))return(0,i.createSharedObject)(C,this.runtime);throw new Error("Could not create new Fluid object because an unknown object was passed")}async uploadBlob(b){return this.runtime.uploadBlob(b)}}const s="rootDOId",o="rootDO";async function u(f){const b=await f.getAliasedDataStoreEntryPoint(s);if(b===void 0)throw new Error(`default dataStore [${s}] must exist`);const C=(await b.get()).RootDataObject;return(0,a.assert)(C!==void 0,2975),(0,i.makeFluidObject)({rootDataObject:C,extensionStore:f},"IStaticEntryPoint")}function c(f){const{compatibilityMode:b,minVersionForCollabOverride:C,rootDataStoreRegistry:v,runtimeOptionOverrides:m,schema:h}=f,[g,_]=(0,i.parseDataObjectsFromSharedObjects)(h),S=v??new n.FluidDataStoreRegistry(g);return new d(h,b,new l(_,S),{runtimeOptions:m,minVersionForCollab:C})}p0.createDOProviderContainerRuntimeFactory=c;class d extends e.BaseContainerRuntimeFactory{constructor(b,C,v,m){super({registryEntries:[v.registryEntry],runtimeOptions:{...t.compatibilityModeRuntimeOptions[C],...m?.runtimeOptions},provideEntryPoint:u,minVersionForCollab:m?.minVersionForCollab??i.compatibilityModeToMinVersionForCollab[C]}),this.rootDataObjectFactory=v,this.initialObjects=b.initialObjects}async containerInitializingFirstTime(b){await this.rootDataObjectFactory.createRootInstance(s,b,{initialObjects:this.initialObjects})}}class l extends e.DataObjectFactory{constructor(b=[],C){super({type:o,ctor:r,sharedObjects:b}),this.dataStoreRegistry=C}get IFluidDataStoreRegistry(){return this.dataStoreRegistry}}return p0}var i_={},qJ;function XSe(){if(qJ)return i_;qJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(i_,"__esModule",{value:!0}),i_.createServiceAudience=void 0;const e=Ht();function n(t){return new a(t.container,t.createServiceMember)}i_.createServiceAudience=n;class a extends e.TypedEventEmitter{constructor(i,r){super(),this.container=i,this.createServiceMember=r,this.lastMembers=new Map,this.audience=i.audience,this.getMembers(),this.audience.on("addMember",(s,o)=>{if(this.shouldIncludeAsMember(o)){const u=this.getMember(s);this.emit("memberAdded",s,u),this.emit("membersChanged")}}),this.audience.on("removeMember",s=>{this.lastMembers.has(s)&&(this.emit("memberRemoved",s,this.lastMembers.get(s)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){const i=new Map,r=new Map;for(const[s,o]of this.audience.getMembers())if(this.shouldIncludeAsMember(o)){const u=o.user.id;let c=i.get(u);c===void 0&&(c=this.createServiceMember(o),i.set(u,c)),c.connections.push({id:s,mode:o.mode}),r.set(s,c)}return this.lastMembers=r,i}getMyself(){const i=this.container.clientId;if(i===void 0)return;const r=this.getMember(i);return r===void 0?void 0:{...r,currentConnection:i}}getMember(i){const r=this.audience.getMember(i);if(r===void 0)return;const o=this.getMembers().get(r?.user.id);if(o===void 0)throw new Error(`Attempted to fetch client ${i} that is not part of the current member list`);return o}shouldIncludeAsMember(i){return i.details.capabilities.interactive}}return i_}var zu={},LJ;function ZSe(){if(LJ)return zu;LJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=zu&&zu.__classPrivateFieldSet||function(v,m,h,g,_){if(g==="m")throw new TypeError("Private method is not writable");if(g==="a"&&!_)throw new TypeError("Private accessor was defined without a setter");if(typeof m=="function"?v!==m||!_:!m.has(v))throw new TypeError("Cannot write private member to an object whose class did not declare it");return g==="a"?_.call(v,h):_?_.value=h:m.set(v,h),h},n=zu&&zu.__classPrivateFieldGet||function(v,m,h,g){if(h==="a"&&!g)throw new TypeError("Private accessor was defined without a getter");if(typeof m=="function"?v!==m||!g:!m.has(v))throw new TypeError("Cannot read private member from an object whose class did not declare it");return h==="m"?g:h==="a"?g.call(v):g?g.value:m.get(v)},a;Object.defineProperty(zu,"__esModule",{value:!0}),zu.createTreeContainerRuntimeFactory=void 0;const t=$o(),i=OE(),r=Je(),s=yoe(),o=Aq();class u extends t.TreeDataObject{constructor(m){super(m)}get TreeRootDataObject(){return this}get initialObjects(){return{tree:this.tree}}async create(m){const h=m;if((0,o.isDataObjectKind)(h))return(0,o.createDataObject)(h,this.context);if((0,o.isSharedObjectKind)(h))return(0,o.createSharedObject)(h,this.runtime);throw new Error("Could not create new Fluid object because an unknown object was passed")}async uploadBlob(m){return this.runtime.uploadBlob(m)}}const c="treeRootDOId",d="treeRootDO";async function l(v){const m=await v.getAliasedDataStoreEntryPoint(c);if(m===void 0)throw new Error(`default dataStore [${c}] must exist`);const h=(await m.get()).TreeRootDataObject;return(0,r.assert)(h!==void 0,3047),(0,o.makeFluidObject)({rootDataObject:h,extensionStore:v},"IStaticEntryPoint")}class f extends t.BaseContainerRuntimeFactory{constructor(m,h,g){super({registryEntries:[h.registryEntry],runtimeOptions:{...s.compatibilityModeRuntimeOptions[m],...g?.runtimeOptions},provideEntryPoint:l,minVersionForCollab:g?.minVersionForCollab??o.compatibilityModeToMinVersionForCollab[m]}),a.set(this,void 0),e(this,a,h,"f")}async containerInitializingFirstTime(m){await n(this,a,"f").createRootInstance(c,m)}}a=new WeakMap;class b extends t.TreeDataObjectFactory{constructor(m=[],h){const g=function(_){return new u({..._})};super({type:d,ctor:g,sharedObjects:m}),this.dataStoreRegistry=h}get IFluidDataStoreRegistry(){return this.dataStoreRegistry}}function C(v){const{compatibilityMode:m,minVersionForCollabOverride:h,rootDataStoreRegistry:g,runtimeOptionOverrides:_,schema:S}=v,[p,w]=(0,o.parseDataObjectsFromSharedObjects)(S),O=g??new i.FluidDataStoreRegistry(p);return new f(m,new b(w,O),{runtimeOptions:_,minVersionForCollab:h})}return zu.createTreeContainerRuntimeFactory=C,zu}var BJ;function eCe(){return BJ||(BJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.isTreeContainerSchema=e.createTreeContainerRuntimeFactory=e.createServiceAudience=e.createDOProviderContainerRuntimeFactory=e.isInternalFluidContainer=e.createFluidContainer=void 0;var n=hge();Object.defineProperty(e,"createFluidContainer",{enumerable:!0,get:function(){return n.createFluidContainer}}),Object.defineProperty(e,"isInternalFluidContainer",{enumerable:!0,get:function(){return n.isInternalFluidContainer}});var a=YSe();Object.defineProperty(e,"createDOProviderContainerRuntimeFactory",{enumerable:!0,get:function(){return a.createDOProviderContainerRuntimeFactory}});var t=XSe();Object.defineProperty(e,"createServiceAudience",{enumerable:!0,get:function(){return t.createServiceAudience}});var i=ZSe();Object.defineProperty(e,"createTreeContainerRuntimeFactory",{enumerable:!0,get:function(){return i.createTreeContainerRuntimeFactory}});var r=Aq();Object.defineProperty(e,"isTreeContainerSchema",{enumerable:!0,get:function(){return r.isTreeContainerSchema}})})(aj)),aj}var _N={},s_={},UJ;function tCe(){if(UJ)return s_;UJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(s_,"__esModule",{value:!0}),s_.DefaultTokenProvider=void 0;class e{constructor(a){this.jwt=a}async fetchOrdererToken(){return{fromCache:!0,jwt:this.jwt}}async fetchStorageToken(){return{fromCache:!0,jwt:this.jwt}}}return s_.DefaultTokenProvider=e,s_}var TN={},a_={},zJ;function nCe(){if(zJ)return a_;zJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(a_,"__esModule",{value:!0}),a_.R11sServiceClusterDrainingErrorCode=void 0,a_.R11sServiceClusterDrainingErrorCode="ClusterDraining",a_}var Sp={},VJ;function gb(){if(VJ)return Sp;VJ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Sp,"__esModule",{value:!0}),Sp.pkgVersion=Sp.pkgName=void 0,Sp.pkgName="@fluidframework/routerlicious-driver",Sp.pkgVersion="2.60.0",Sp}var HJ;function tI(){return HJ||(HJ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getUrlForTelemetry=e.socketIoPath=e.errorObjectFromSocketError=e.throwR11sNetworkError=e.createR11sNetworkError=e.ClusterDrainingError=e.RouterliciousErrorTypes=void 0;const n=on(),a=Kn(),t=Ot(),i=nCe(),r=gb();e.RouterliciousErrorTypes={...n.DriverErrorTypes,sslCertError:"sslCertError",clusterDrainingError:"clusterDrainingError"};class s extends t.LoggingError{constructor(f,b,C){super(f,C),this.retryAfterSeconds=b,this.errorType=e.RouterliciousErrorTypes.clusterDrainingError,this.canRetry=!0}}e.ClusterDrainingError=s;function o(l,f,b,C,v){let m;const h={...C,statusCode:f,driverVersion:r.pkgVersion};switch(f){case 401:case 403:m=new a.AuthorizationError(l,void 0,void 0,h);break;case 404:const g=e.RouterliciousErrorTypes.fileNotFoundOrAccessDeniedError;m=new a.NonRetryableError(l,g,h);break;case 429:m=(0,a.createGenericNetworkError)(l,{canRetry:!0,retryAfterMs:b},h);break;case 500:case 502:m=new a.GenericNetworkError(l,!0,h);break;case 503:if(v===i.R11sServiceClusterDrainingErrorCode){m=new s(l,b!==void 0?b/1e3:660,h);break}default:const _={canRetry:b!==void 0,retryAfterMs:b};m=(0,a.createGenericNetworkError)(l,_,h);break}return m.addTelemetryProperties({endpointReached:!0}),m}e.createR11sNetworkError=o;function u(l,f,b,C){throw o(l,f,b,C)}e.throwR11sNetworkError=u;function c(l,f,b){const C=`R11s socket error (${f}): ${l.message}`,v=o(C,l.code,l.retryAfterMs,b,l.internalErrorCode);return v.addTelemetryProperties({relayServiceError:!0,scenarioName:f,internalErrorCode:l.internalErrorCode}),v}e.errorObjectFromSocketError=c,e.socketIoPath="socket.io";function d(l,f=""){const b=l.match(/^(?:https?:\/\/)?([^/]+)/);if(!b)return;const C=b[1];let v="";for(const m of f.split("/"))m!==""&&([e.socketIoPath,"repos","deltas","documents","session","git","summaries","latest","document","commits","blobs","refs","revokeToken","accesstoken"].includes(m)?v+=`/${m}`:v+="/REDACTED");return`${C}${v}`}e.getUrlForTelemetry=d})(TN)),TN}var Vu={},Ut={},KJ;function rCe(){if(KJ)return Ut;KJ=1;var e={};e.userAgent=!1;var n={},a="11.1.0",t="jsrsasign(all) 11.1.0 (2024-02-01) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license";/*! CryptoJS v3.1.2 core-fix.js
 * code.google.com/p/crypto-js
 * (c) 2009-2013 by Jeff Mott. All rights reserved.
 * code.google.com/p/crypto-js/wiki/License
 * THIS IS FIX of 'core.js' to fix Hmac issue.
 * https://code.google.com/p/crypto-js/issues/detail?id=84
 * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
 */var i=i||(function(P,N){var A={},q=A.lib={},H=q.Base=(function(){function W(){}return{extend:function(ne){W.prototype=this;var X=new W;return ne&&X.mixIn(ne),X.hasOwnProperty("init")||(X.init=function(){X.$super.init.apply(this,arguments)}),X.init.prototype=X,X.$super=this,X},create:function(){var ne=this.extend();return ne.init.apply(ne,arguments),ne},init:function(){},mixIn:function(ne){for(var X in ne)ne.hasOwnProperty(X)&&(this[X]=ne[X]);ne.hasOwnProperty("toString")&&(this.toString=ne.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),U=q.WordArray=H.extend({init:function(W,ne){W=this.words=W||[],ne!=N?this.sigBytes=ne:this.sigBytes=W.length*4},toString:function(W){return(W||J).stringify(this)},concat:function(W){var ne=this.words,X=W.words,ie=this.sigBytes,ue=W.sigBytes;if(this.clamp(),ie%4)for(var ve=0;ve<ue;ve++){var ze=X[ve>>>2]>>>24-ve%4*8&255;ne[ie+ve>>>2]|=ze<<24-(ie+ve)%4*8}else for(var ve=0;ve<ue;ve+=4)ne[ie+ve>>>2]=X[ve>>>2];return this.sigBytes+=ue,this},clamp:function(){var W=this.words,ne=this.sigBytes;W[ne>>>2]&=4294967295<<32-ne%4*8,W.length=P.ceil(ne/4)},clone:function(){var W=H.clone.call(this);return W.words=this.words.slice(0),W},random:function(W){for(var ne=[],X=0;X<W;X+=4)ne.push(P.random()*4294967296|0);return new U.init(ne,W)}}),Q=A.enc={},J=Q.Hex={stringify:function(W){for(var ne=W.words,X=W.sigBytes,ie=[],ue=0;ue<X;ue++){var ve=ne[ue>>>2]>>>24-ue%4*8&255;ie.push((ve>>>4).toString(16)),ie.push((ve&15).toString(16))}return ie.join("")},parse:function(W){for(var ne=W.length,X=[],ie=0;ie<ne;ie+=2)X[ie>>>3]|=parseInt(W.substr(ie,2),16)<<24-ie%8*4;return new U.init(X,ne/2)}},ae=Q.Latin1={stringify:function(W){for(var ne=W.words,X=W.sigBytes,ie=[],ue=0;ue<X;ue++){var ve=ne[ue>>>2]>>>24-ue%4*8&255;ie.push(String.fromCharCode(ve))}return ie.join("")},parse:function(W){for(var ne=W.length,X=[],ie=0;ie<ne;ie++)X[ie>>>2]|=(W.charCodeAt(ie)&255)<<24-ie%4*8;return new U.init(X,ne)}},te=Q.Utf8={stringify:function(W){try{return decodeURIComponent(escape(ae.stringify(W)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(W){return ae.parse(unescape(encodeURIComponent(W)))}},le=q.BufferedBlockAlgorithm=H.extend({reset:function(){this._data=new U.init,this._nDataBytes=0},_append:function(W){typeof W=="string"&&(W=te.parse(W)),this._data.concat(W),this._nDataBytes+=W.sigBytes},_process:function(W){var ne=this._data,X=ne.words,ie=ne.sigBytes,ue=this.blockSize,ve=ue*4,ze=ie/ve;W?ze=P.ceil(ze):ze=P.max((ze|0)-this._minBufferSize,0);var tt=ze*ue,nt=P.min(tt*4,ie);if(tt){for(var it=0;it<tt;it+=ue)this._doProcessBlock(X,it);var _e=X.splice(0,tt);ne.sigBytes-=nt}return new U.init(_e,nt)},clone:function(){var W=H.clone.call(this);return W._data=this._data.clone(),W},_minBufferSize:0});q.Hasher=le.extend({cfg:H.extend(),init:function(W){this.cfg=this.cfg.extend(W),this.reset()},reset:function(){le.reset.call(this),this._doReset()},update:function(W){return this._append(W),this._process(),this},finalize:function(W){W&&this._append(W);var ne=this._doFinalize();return ne},blockSize:512/32,_createHelper:function(W){return function(ne,X){return new W.init(X).finalize(ne)}},_createHmacHelper:function(W){return function(ne,X){return new ce.HMAC.init(W,X).finalize(ne)}}});var ce=A.algo={};return A})(Math);(function(P){var H=i,N=H.lib,A=N.Base,q=N.WordArray,H=H.x64={};H.Word=A.extend({init:function(U,Q){this.high=U,this.low=Q}}),H.WordArray=A.extend({init:function(U,Q){U=this.words=U||[],this.sigBytes=Q!=P?Q:8*U.length},toX32:function(){for(var U=this.words,Q=U.length,J=[],ae=0;ae<Q;ae++){var te=U[ae];J.push(te.high),J.push(te.low)}return q.create(J,this.sigBytes)},clone:function(){for(var U=A.clone.call(this),Q=U.words=this.words.slice(0),J=Q.length,ae=0;ae<J;ae++)Q[ae]=Q[ae].clone();return U}})})(),i.lib.Cipher||(function(P){var ne=i,N=ne.lib,A=N.Base,q=N.WordArray,H=N.BufferedBlockAlgorithm,U=ne.enc.Base64,Q=ne.algo.EvpKDF,J=N.Cipher=H.extend({cfg:A.extend(),createEncryptor:function(ie,ue){return this.create(this._ENC_XFORM_MODE,ie,ue)},createDecryptor:function(ie,ue){return this.create(this._DEC_XFORM_MODE,ie,ue)},init:function(ie,ue,ve){this.cfg=this.cfg.extend(ve),this._xformMode=ie,this._key=ue,this.reset()},reset:function(){H.reset.call(this),this._doReset()},process:function(ie){return this._append(ie),this._process()},finalize:function(ie){return ie&&this._append(ie),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(ie){return{encrypt:function(ue,ve,ze){return(typeof ve=="string"?X:W).encrypt(ie,ue,ve,ze)},decrypt:function(ue,ve,ze){return(typeof ve=="string"?X:W).decrypt(ie,ue,ve,ze)}}}});N.StreamCipher=J.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var ce=ne.mode={},ae=function(ie,ue,ve){var ze=this._iv;ze?this._iv=P:ze=this._prevBlock;for(var tt=0;tt<ve;tt++)ie[ue+tt]^=ze[tt]},te=(N.BlockCipherMode=A.extend({createEncryptor:function(ie,ue){return this.Encryptor.create(ie,ue)},createDecryptor:function(ie,ue){return this.Decryptor.create(ie,ue)},init:function(ie,ue){this._cipher=ie,this._iv=ue}})).extend();te.Encryptor=te.extend({processBlock:function(ie,ue){var ve=this._cipher,ze=ve.blockSize;ae.call(this,ie,ue,ze),ve.encryptBlock(ie,ue),this._prevBlock=ie.slice(ue,ue+ze)}}),te.Decryptor=te.extend({processBlock:function(ie,ue){var ve=this._cipher,ze=ve.blockSize,tt=ie.slice(ue,ue+ze);ve.decryptBlock(ie,ue),ae.call(this,ie,ue,ze),this._prevBlock=tt}}),ce=ce.CBC=te,te=(ne.pad={}).Pkcs7={pad:function(ie,ue){for(var ve=4*ue,ve=ve-ie.sigBytes%ve,ze=ve<<24|ve<<16|ve<<8|ve,tt=[],nt=0;nt<ve;nt+=4)tt.push(ze);ve=q.create(tt,ve),ie.concat(ve)},unpad:function(ie){ie.sigBytes-=ie.words[ie.sigBytes-1>>>2]&255}},N.BlockCipher=J.extend({cfg:J.cfg.extend({mode:ce,padding:te}),reset:function(){J.reset.call(this);var ue=this.cfg,ie=ue.iv,ue=ue.mode;if(this._xformMode==this._ENC_XFORM_MODE)var ve=ue.createEncryptor;else ve=ue.createDecryptor,this._minBufferSize=1;this._mode=ve.call(ue,this,ie&&ie.words)},_doProcessBlock:function(ie,ue){this._mode.processBlock(ie,ue)},_doFinalize:function(){var ie=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){ie.pad(this._data,this.blockSize);var ue=this._process(!0)}else ue=this._process(!0),ie.unpad(ue);return ue},blockSize:4});var le=N.CipherParams=A.extend({init:function(ie){this.mixIn(ie)},toString:function(ie){return(ie||this.formatter).stringify(this)}}),ce=(ne.format={}).OpenSSL={stringify:function(ie){var ue=ie.ciphertext;return ie=ie.salt,(ie?q.create([1398893684,1701076831]).concat(ie).concat(ue):ue).toString(U)},parse:function(ie){ie=U.parse(ie);var ue=ie.words;if(ue[0]==1398893684&&ue[1]==1701076831){var ve=q.create(ue.slice(2,4));ue.splice(0,4),ie.sigBytes-=16}return le.create({ciphertext:ie,salt:ve})}},W=N.SerializableCipher=A.extend({cfg:A.extend({format:ce}),encrypt:function(ie,ue,ve,ze){ze=this.cfg.extend(ze);var tt=ie.createEncryptor(ve,ze);return ue=tt.finalize(ue),tt=tt.cfg,le.create({ciphertext:ue,key:ve,iv:tt.iv,algorithm:ie,mode:tt.mode,padding:tt.padding,blockSize:ie.blockSize,formatter:ze.format})},decrypt:function(ie,ue,ve,ze){return ze=this.cfg.extend(ze),ue=this._parse(ue,ze.format),ie.createDecryptor(ve,ze).finalize(ue.ciphertext)},_parse:function(ie,ue){return typeof ie=="string"?ue.parse(ie,this):ie}}),ne=(ne.kdf={}).OpenSSL={execute:function(ie,ue,ve,ze){return ze||(ze=q.random(8)),ie=Q.create({keySize:ue+ve}).compute(ie,ze),ve=q.create(ie.words.slice(ue),4*ve),ie.sigBytes=4*ue,le.create({key:ie,iv:ve,salt:ze})}},X=N.PasswordBasedCipher=W.extend({cfg:W.cfg.extend({kdf:ne}),encrypt:function(ie,ue,ve,ze){return ze=this.cfg.extend(ze),ve=ze.kdf.execute(ve,ie.keySize,ie.ivSize),ze.iv=ve.iv,ie=W.encrypt.call(this,ie,ue,ve.key,ze),ie.mixIn(ve),ie},decrypt:function(ie,ue,ve,ze){return ze=this.cfg.extend(ze),ue=this._parse(ue,ze.format),ve=ze.kdf.execute(ve,ie.keySize,ie.ivSize,ue.salt),ze.iv=ve.iv,W.decrypt.call(this,ie,ue,ve.key,ze)}})})(),(function(){for(var P=i,N=P.lib.BlockCipher,_e=P.algo,A=[],q=[],H=[],U=[],Q=[],J=[],ae=[],te=[],le=[],ce=[],W=[],ne=0;256>ne;ne++)W[ne]=128>ne?ne<<1:ne<<1^283;for(var X=0,ie=0,ne=0;256>ne;ne++){var ue=ie^ie<<1^ie<<2^ie<<3^ie<<4,ue=ue>>>8^ue&255^99;A[X]=ue,q[ue]=X;var ve=W[X],ze=W[ve],tt=W[ze],nt=257*W[ue]^16843008*ue;H[X]=nt<<24|nt>>>8,U[X]=nt<<16|nt>>>16,Q[X]=nt<<8|nt>>>24,J[X]=nt,nt=16843009*tt^65537*ze^257*ve^16843008*X,ae[ue]=nt<<24|nt>>>8,te[ue]=nt<<16|nt>>>16,le[ue]=nt<<8|nt>>>24,ce[ue]=nt,X?(X=ve^W[W[W[tt^ve]]],ie^=W[W[ie]]):X=ie=1}var it=[0,1,2,4,8,16,32,64,128,27,54],_e=_e.AES=N.extend({_doReset:function(){for(var Te=this._key,Ie=Te.words,Ae=Te.sigBytes/4,Te=4*((this._nRounds=Ae+6)+1),Be=this._keySchedule=[],rt=0;rt<Te;rt++)if(rt<Ae)Be[rt]=Ie[rt];else{var ct=Be[rt-1];rt%Ae?6<Ae&&rt%Ae==4&&(ct=A[ct>>>24]<<24|A[ct>>>16&255]<<16|A[ct>>>8&255]<<8|A[ct&255]):(ct=ct<<8|ct>>>24,ct=A[ct>>>24]<<24|A[ct>>>16&255]<<16|A[ct>>>8&255]<<8|A[ct&255],ct^=it[rt/Ae|0]<<24),Be[rt]=Be[rt-Ae]^ct}for(Ie=this._invKeySchedule=[],Ae=0;Ae<Te;Ae++)rt=Te-Ae,ct=Ae%4?Be[rt]:Be[rt-4],Ie[Ae]=4>Ae||4>=rt?ct:ae[A[ct>>>24]]^te[A[ct>>>16&255]]^le[A[ct>>>8&255]]^ce[A[ct&255]]},encryptBlock:function(Ie,Ae){this._doCryptBlock(Ie,Ae,this._keySchedule,H,U,Q,J,A)},decryptBlock:function(Ie,Ae){var Te=Ie[Ae+1];Ie[Ae+1]=Ie[Ae+3],Ie[Ae+3]=Te,this._doCryptBlock(Ie,Ae,this._invKeySchedule,ae,te,le,ce,q),Te=Ie[Ae+1],Ie[Ae+1]=Ie[Ae+3],Ie[Ae+3]=Te},_doCryptBlock:function(Ie,Ae,Te,Be,rt,ct,Tt,st){for(var yt=this._nRounds,Vn=Ie[Ae]^Te[0],_n=Ie[Ae+1]^Te[1],dn=Ie[Ae+2]^Te[2],xr=Ie[Ae+3]^Te[3],Pt=4,jt=1;jt<yt;jt++)var kr=Be[Vn>>>24]^rt[_n>>>16&255]^ct[dn>>>8&255]^Tt[xr&255]^Te[Pt++],Er=Be[_n>>>24]^rt[dn>>>16&255]^ct[xr>>>8&255]^Tt[Vn&255]^Te[Pt++],ir=Be[dn>>>24]^rt[xr>>>16&255]^ct[Vn>>>8&255]^Tt[_n&255]^Te[Pt++],xr=Be[xr>>>24]^rt[Vn>>>16&255]^ct[_n>>>8&255]^Tt[dn&255]^Te[Pt++],Vn=kr,_n=Er,dn=ir;kr=(st[Vn>>>24]<<24|st[_n>>>16&255]<<16|st[dn>>>8&255]<<8|st[xr&255])^Te[Pt++],Er=(st[_n>>>24]<<24|st[dn>>>16&255]<<16|st[xr>>>8&255]<<8|st[Vn&255])^Te[Pt++],ir=(st[dn>>>24]<<24|st[xr>>>16&255]<<16|st[Vn>>>8&255]<<8|st[_n&255])^Te[Pt++],xr=(st[xr>>>24]<<24|st[Vn>>>16&255]<<16|st[_n>>>8&255]<<8|st[dn&255])^Te[Pt++],Ie[Ae]=kr,Ie[Ae+1]=Er,Ie[Ae+2]=ir,Ie[Ae+3]=xr},keySize:8});P.AES=N._createHelper(_e)})(),(function(){function P(W,ne){var X=(this._lBlock>>>W^this._rBlock)&ne;this._rBlock^=X,this._lBlock^=X<<W}function N(W,ne){var X=(this._rBlock>>>W^this._lBlock)&ne;this._lBlock^=X,this._rBlock^=X<<W}var A=i,H=A.lib,q=H.WordArray,H=H.BlockCipher,U=A.algo,Q=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],J=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],ae=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],te=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],le=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],ce=U.DES=H.extend({_doReset:function(){for(var W=this._key.words,ne=[],X=0;56>X;X++){var ie=Q[X]-1;ne[X]=W[ie>>>5]>>>31-ie%32&1}for(W=this._subKeys=[],ie=0;16>ie;ie++){for(var ue=W[ie]=[],ve=ae[ie],X=0;24>X;X++)ue[X/6|0]|=ne[(J[X]-1+ve)%28]<<31-X%6,ue[4+(X/6|0)]|=ne[28+(J[X+24]-1+ve)%28]<<31-X%6;for(ue[0]=ue[0]<<1|ue[0]>>>31,X=1;7>X;X++)ue[X]>>>=4*(X-1)+3;ue[7]=ue[7]<<5|ue[7]>>>27}for(ne=this._invSubKeys=[],X=0;16>X;X++)ne[X]=W[15-X]},encryptBlock:function(W,ne){this._doCryptBlock(W,ne,this._subKeys)},decryptBlock:function(W,ne){this._doCryptBlock(W,ne,this._invSubKeys)},_doCryptBlock:function(W,ne,X){this._lBlock=W[ne],this._rBlock=W[ne+1],P.call(this,4,252645135),P.call(this,16,65535),N.call(this,2,858993459),N.call(this,8,16711935),P.call(this,1,1431655765);for(var ie=0;16>ie;ie++){for(var ue=X[ie],ve=this._lBlock,ze=this._rBlock,tt=0,nt=0;8>nt;nt++)tt|=te[nt][((ze^ue[nt])&le[nt])>>>0];this._lBlock=ze,this._rBlock=ve^tt}X=this._lBlock,this._lBlock=this._rBlock,this._rBlock=X,P.call(this,1,1431655765),N.call(this,8,16711935),N.call(this,2,858993459),P.call(this,16,65535),P.call(this,4,252645135),W[ne]=this._lBlock,W[ne+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});A.DES=H._createHelper(ce),U=U.TripleDES=H.extend({_doReset:function(){var W=this._key.words;this._des1=ce.createEncryptor(q.create(W.slice(0,2))),this._des2=ce.createEncryptor(q.create(W.slice(2,4))),this._des3=ce.createEncryptor(q.create(W.slice(4,6)))},encryptBlock:function(W,ne){this._des1.encryptBlock(W,ne),this._des2.decryptBlock(W,ne),this._des3.encryptBlock(W,ne)},decryptBlock:function(W,ne){this._des3.decryptBlock(W,ne),this._des2.encryptBlock(W,ne),this._des1.decryptBlock(W,ne)},keySize:6,ivSize:2,blockSize:2}),A.TripleDES=H._createHelper(U)})(),(function(){var P=i,N=P.lib.WordArray;P.enc.Base64={stringify:function(A){var q=A.words,H=A.sigBytes,U=this._map;A.clamp(),A=[];for(var Q=0;Q<H;Q+=3)for(var J=(q[Q>>>2]>>>24-8*(Q%4)&255)<<16|(q[Q+1>>>2]>>>24-8*((Q+1)%4)&255)<<8|q[Q+2>>>2]>>>24-8*((Q+2)%4)&255,ae=0;4>ae&&Q+.75*ae<H;ae++)A.push(U.charAt(J>>>6*(3-ae)&63));if(q=U.charAt(64))for(;A.length%4;)A.push(q);return A.join("")},parse:function(A){var q=A.length,H=this._map,U=H.charAt(64);U&&(U=A.indexOf(U),U!=-1&&(q=U));for(var U=[],Q=0,J=0;J<q;J++)if(J%4){var ae=H.indexOf(A.charAt(J-1))<<2*(J%4),te=H.indexOf(A.charAt(J))>>>6-2*(J%4);U[Q>>>2]|=(ae|te)<<24-8*(Q%4),Q++}return N.create(U,Q)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),(function(P){function N(ce,W,ne,X,ie,ue,ve){return ce=ce+(W&ne|~W&X)+ie+ve,(ce<<ue|ce>>>32-ue)+W}function A(ce,W,ne,X,ie,ue,ve){return ce=ce+(W&X|ne&~X)+ie+ve,(ce<<ue|ce>>>32-ue)+W}function q(ce,W,ne,X,ie,ue,ve){return ce=ce+(W^ne^X)+ie+ve,(ce<<ue|ce>>>32-ue)+W}function H(ce,W,ne,X,ie,ue,ve){return ce=ce+(ne^(W|~X))+ie+ve,(ce<<ue|ce>>>32-ue)+W}for(var U=i,ae=U.lib,Q=ae.WordArray,J=ae.Hasher,ae=U.algo,te=[],le=0;64>le;le++)te[le]=4294967296*P.abs(P.sin(le+1))|0;ae=ae.MD5=J.extend({_doReset:function(){this._hash=new Q.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(ce,W){for(var ne=0;16>ne;ne++){var X=W+ne,ie=ce[X];ce[X]=(ie<<8|ie>>>24)&16711935|(ie<<24|ie>>>8)&4278255360}var ne=this._hash.words,X=ce[W+0],ie=ce[W+1],ue=ce[W+2],ve=ce[W+3],ze=ce[W+4],tt=ce[W+5],nt=ce[W+6],it=ce[W+7],_e=ce[W+8],Ie=ce[W+9],Ae=ce[W+10],Te=ce[W+11],Be=ce[W+12],rt=ce[W+13],ct=ce[W+14],Tt=ce[W+15],st=ne[0],jt=ne[1],Pt=ne[2],yt=ne[3],st=N(st,jt,Pt,yt,X,7,te[0]),yt=N(yt,st,jt,Pt,ie,12,te[1]),Pt=N(Pt,yt,st,jt,ue,17,te[2]),jt=N(jt,Pt,yt,st,ve,22,te[3]),st=N(st,jt,Pt,yt,ze,7,te[4]),yt=N(yt,st,jt,Pt,tt,12,te[5]),Pt=N(Pt,yt,st,jt,nt,17,te[6]),jt=N(jt,Pt,yt,st,it,22,te[7]),st=N(st,jt,Pt,yt,_e,7,te[8]),yt=N(yt,st,jt,Pt,Ie,12,te[9]),Pt=N(Pt,yt,st,jt,Ae,17,te[10]),jt=N(jt,Pt,yt,st,Te,22,te[11]),st=N(st,jt,Pt,yt,Be,7,te[12]),yt=N(yt,st,jt,Pt,rt,12,te[13]),Pt=N(Pt,yt,st,jt,ct,17,te[14]),jt=N(jt,Pt,yt,st,Tt,22,te[15]),st=A(st,jt,Pt,yt,ie,5,te[16]),yt=A(yt,st,jt,Pt,nt,9,te[17]),Pt=A(Pt,yt,st,jt,Te,14,te[18]),jt=A(jt,Pt,yt,st,X,20,te[19]),st=A(st,jt,Pt,yt,tt,5,te[20]),yt=A(yt,st,jt,Pt,Ae,9,te[21]),Pt=A(Pt,yt,st,jt,Tt,14,te[22]),jt=A(jt,Pt,yt,st,ze,20,te[23]),st=A(st,jt,Pt,yt,Ie,5,te[24]),yt=A(yt,st,jt,Pt,ct,9,te[25]),Pt=A(Pt,yt,st,jt,ve,14,te[26]),jt=A(jt,Pt,yt,st,_e,20,te[27]),st=A(st,jt,Pt,yt,rt,5,te[28]),yt=A(yt,st,jt,Pt,ue,9,te[29]),Pt=A(Pt,yt,st,jt,it,14,te[30]),jt=A(jt,Pt,yt,st,Be,20,te[31]),st=q(st,jt,Pt,yt,tt,4,te[32]),yt=q(yt,st,jt,Pt,_e,11,te[33]),Pt=q(Pt,yt,st,jt,Te,16,te[34]),jt=q(jt,Pt,yt,st,ct,23,te[35]),st=q(st,jt,Pt,yt,ie,4,te[36]),yt=q(yt,st,jt,Pt,ze,11,te[37]),Pt=q(Pt,yt,st,jt,it,16,te[38]),jt=q(jt,Pt,yt,st,Ae,23,te[39]),st=q(st,jt,Pt,yt,rt,4,te[40]),yt=q(yt,st,jt,Pt,X,11,te[41]),Pt=q(Pt,yt,st,jt,ve,16,te[42]),jt=q(jt,Pt,yt,st,nt,23,te[43]),st=q(st,jt,Pt,yt,Ie,4,te[44]),yt=q(yt,st,jt,Pt,Be,11,te[45]),Pt=q(Pt,yt,st,jt,Tt,16,te[46]),jt=q(jt,Pt,yt,st,ue,23,te[47]),st=H(st,jt,Pt,yt,X,6,te[48]),yt=H(yt,st,jt,Pt,it,10,te[49]),Pt=H(Pt,yt,st,jt,ct,15,te[50]),jt=H(jt,Pt,yt,st,tt,21,te[51]),st=H(st,jt,Pt,yt,Be,6,te[52]),yt=H(yt,st,jt,Pt,ve,10,te[53]),Pt=H(Pt,yt,st,jt,Ae,15,te[54]),jt=H(jt,Pt,yt,st,ie,21,te[55]),st=H(st,jt,Pt,yt,_e,6,te[56]),yt=H(yt,st,jt,Pt,Tt,10,te[57]),Pt=H(Pt,yt,st,jt,nt,15,te[58]),jt=H(jt,Pt,yt,st,rt,21,te[59]),st=H(st,jt,Pt,yt,ze,6,te[60]),yt=H(yt,st,jt,Pt,Te,10,te[61]),Pt=H(Pt,yt,st,jt,ue,15,te[62]),jt=H(jt,Pt,yt,st,Ie,21,te[63]);ne[0]=ne[0]+st|0,ne[1]=ne[1]+jt|0,ne[2]=ne[2]+Pt|0,ne[3]=ne[3]+yt|0},_doFinalize:function(){var ce=this._data,W=ce.words,ne=8*this._nDataBytes,X=8*ce.sigBytes;W[X>>>5]|=128<<24-X%32;var ie=P.floor(ne/4294967296);for(W[(X+64>>>9<<4)+15]=(ie<<8|ie>>>24)&16711935|(ie<<24|ie>>>8)&4278255360,W[(X+64>>>9<<4)+14]=(ne<<8|ne>>>24)&16711935|(ne<<24|ne>>>8)&4278255360,ce.sigBytes=4*(W.length+1),this._process(),ce=this._hash,W=ce.words,ne=0;4>ne;ne++)X=W[ne],W[ne]=(X<<8|X>>>24)&16711935|(X<<24|X>>>8)&4278255360;return ce},clone:function(){var ce=J.clone.call(this);return ce._hash=this._hash.clone(),ce}}),U.MD5=J._createHelper(ae),U.HmacMD5=J._createHmacHelper(ae)})(Math),(function(){var P=i,H=P.lib,N=H.WordArray,A=H.Hasher,q=[],H=P.algo.SHA1=A.extend({_doReset:function(){this._hash=new N.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(U,Q){for(var J=this._hash.words,ae=J[0],te=J[1],le=J[2],ce=J[3],W=J[4],ne=0;80>ne;ne++){if(16>ne)q[ne]=U[Q+ne]|0;else{var X=q[ne-3]^q[ne-8]^q[ne-14]^q[ne-16];q[ne]=X<<1|X>>>31}X=(ae<<5|ae>>>27)+W+q[ne],X=20>ne?X+((te&le|~te&ce)+1518500249):40>ne?X+((te^le^ce)+1859775393):60>ne?X+((te&le|te&ce|le&ce)-1894007588):X+((te^le^ce)-899497514),W=ce,ce=le,le=te<<30|te>>>2,te=ae,ae=X}J[0]=J[0]+ae|0,J[1]=J[1]+te|0,J[2]=J[2]+le|0,J[3]=J[3]+ce|0,J[4]=J[4]+W|0},_doFinalize:function(){var U=this._data,Q=U.words,J=8*this._nDataBytes,ae=8*U.sigBytes;return Q[ae>>>5]|=128<<24-ae%32,Q[(ae+64>>>9<<4)+14]=Math.floor(J/4294967296),Q[(ae+64>>>9<<4)+15]=J,U.sigBytes=4*Q.length,this._process(),this._hash},clone:function(){var U=A.clone.call(this);return U._hash=this._hash.clone(),U}});P.SHA1=A._createHelper(H),P.HmacSHA1=A._createHmacHelper(H)})(),(function(P){for(var N=i,ne=N.lib,A=ne.WordArray,q=ne.Hasher,ne=N.algo,H=[],U=[],Q=function(ie){return 4294967296*(ie-(ie|0))|0},J=2,ae=0;64>ae;){var te;e:{te=J;for(var le=P.sqrt(te),ce=2;ce<=le;ce++)if(!(te%ce)){te=!1;break e}te=!0}te&&(8>ae&&(H[ae]=Q(P.pow(J,.5))),U[ae]=Q(P.pow(J,1/3)),ae++),J++}var W=[],ne=ne.SHA256=q.extend({_doReset:function(){this._hash=new A.init(H.slice(0))},_doProcessBlock:function(X,ie){for(var ue=this._hash.words,ve=ue[0],ze=ue[1],tt=ue[2],nt=ue[3],it=ue[4],_e=ue[5],Ie=ue[6],Ae=ue[7],Te=0;64>Te;Te++){if(16>Te)W[Te]=X[ie+Te]|0;else{var Be=W[Te-15],rt=W[Te-2];W[Te]=((Be<<25|Be>>>7)^(Be<<14|Be>>>18)^Be>>>3)+W[Te-7]+((rt<<15|rt>>>17)^(rt<<13|rt>>>19)^rt>>>10)+W[Te-16]}Be=Ae+((it<<26|it>>>6)^(it<<21|it>>>11)^(it<<7|it>>>25))+(it&_e^~it&Ie)+U[Te]+W[Te],rt=((ve<<30|ve>>>2)^(ve<<19|ve>>>13)^(ve<<10|ve>>>22))+(ve&ze^ve&tt^ze&tt),Ae=Ie,Ie=_e,_e=it,it=nt+Be|0,nt=tt,tt=ze,ze=ve,ve=Be+rt|0}ue[0]=ue[0]+ve|0,ue[1]=ue[1]+ze|0,ue[2]=ue[2]+tt|0,ue[3]=ue[3]+nt|0,ue[4]=ue[4]+it|0,ue[5]=ue[5]+_e|0,ue[6]=ue[6]+Ie|0,ue[7]=ue[7]+Ae|0},_doFinalize:function(){var X=this._data,ie=X.words,ue=8*this._nDataBytes,ve=8*X.sigBytes;return ie[ve>>>5]|=128<<24-ve%32,ie[(ve+64>>>9<<4)+14]=P.floor(ue/4294967296),ie[(ve+64>>>9<<4)+15]=ue,X.sigBytes=4*ie.length,this._process(),this._hash},clone:function(){var X=q.clone.call(this);return X._hash=this._hash.clone(),X}});N.SHA256=q._createHelper(ne),N.HmacSHA256=q._createHmacHelper(ne)})(Math),(function(){var P=i,N=P.lib.WordArray,q=P.algo,A=q.SHA256,q=q.SHA224=A.extend({_doReset:function(){this._hash=new N.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var H=A._doFinalize.call(this);return H.sigBytes-=4,H}});P.SHA224=A._createHelper(q),P.HmacSHA224=A._createHmacHelper(q)})(),(function(){function P(){return q.create.apply(q,arguments)}for(var N=i,A=N.lib.Hasher,U=N.x64,q=U.Word,H=U.WordArray,U=N.algo,Q=[P(1116352408,3609767458),P(1899447441,602891725),P(3049323471,3964484399),P(3921009573,2173295548),P(961987163,4081628472),P(1508970993,3053834265),P(2453635748,2937671579),P(2870763221,3664609560),P(3624381080,2734883394),P(310598401,1164996542),P(607225278,1323610764),P(1426881987,3590304994),P(1925078388,4068182383),P(2162078206,991336113),P(2614888103,633803317),P(3248222580,3479774868),P(3835390401,2666613458),P(4022224774,944711139),P(264347078,2341262773),P(604807628,2007800933),P(770255983,1495990901),P(1249150122,1856431235),P(1555081692,3175218132),P(1996064986,2198950837),P(2554220882,3999719339),P(2821834349,766784016),P(2952996808,2566594879),P(3210313671,3203337956),P(3336571891,1034457026),P(3584528711,2466948901),P(113926993,3758326383),P(338241895,168717936),P(666307205,1188179964),P(773529912,1546045734),P(1294757372,1522805485),P(1396182291,2643833823),P(1695183700,2343527390),P(1986661051,1014477480),P(2177026350,1206759142),P(2456956037,344077627),P(2730485921,1290863460),P(2820302411,3158454273),P(3259730800,3505952657),P(3345764771,106217008),P(3516065817,3606008344),P(3600352804,1432725776),P(4094571909,1467031594),P(275423344,851169720),P(430227734,3100823752),P(506948616,1363258195),P(659060556,3750685593),P(883997877,3785050280),P(958139571,3318307427),P(1322822218,3812723403),P(1537002063,2003034995),P(1747873779,3602036899),P(1955562222,1575990012),P(2024104815,1125592928),P(2227730452,2716904306),P(2361852424,442776044),P(2428436474,593698344),P(2756734187,3733110249),P(3204031479,2999351573),P(3329325298,3815920427),P(3391569614,3928383900),P(3515267271,566280711),P(3940187606,3454069534),P(4118630271,4000239992),P(116418474,1914138554),P(174292421,2731055270),P(289380356,3203993006),P(460393269,320620315),P(685471733,587496836),P(852142971,1086792851),P(1017036298,365543100),P(1126000580,2618297676),P(1288033470,3409855158),P(1501505948,4234509866),P(1607167915,987167468),P(1816402316,1246189591)],J=[],ae=0;80>ae;ae++)J[ae]=P();U=U.SHA512=A.extend({_doReset:function(){this._hash=new H.init([new q.init(1779033703,4089235720),new q.init(3144134277,2227873595),new q.init(1013904242,4271175723),new q.init(2773480762,1595750129),new q.init(1359893119,2917565137),new q.init(2600822924,725511199),new q.init(528734635,4215389547),new q.init(1541459225,327033209)])},_doProcessBlock:function(te,le){for(var ze=this._hash.words,ce=ze[0],W=ze[1],ne=ze[2],X=ze[3],ie=ze[4],ue=ze[5],ve=ze[6],ze=ze[7],tt=ce.high,nt=ce.low,it=W.high,_e=W.low,Ie=ne.high,Ae=ne.low,Te=X.high,Be=X.low,rt=ie.high,ct=ie.low,Tt=ue.high,st=ue.low,yt=ve.high,Pt=ve.low,jt=ze.high,kr=ze.low,Er=tt,ir=nt,xr=it,Vn=_e,_n=Ie,dn=Ae,ra=Te,Ir=Be,Tn=rt,Fn=ct,Rr=Tt,Fr=st,fi=yt,fr=Pt,jd=jt,ia=kr,Os=0;80>Os;Os++){var Xa=J[Os];if(16>Os)var hi=Xa.high=te[le+2*Os]|0,xn=Xa.low=te[le+2*Os+1]|0;else{var hi=J[Os-15],xn=hi.high,zs=hi.low,hi=(xn>>>1|zs<<31)^(xn>>>8|zs<<24)^xn>>>7,zs=(zs>>>1|xn<<31)^(zs>>>8|xn<<24)^(zs>>>7|xn<<25),Ya=J[Os-2],xn=Ya.high,Gn=Ya.low,Ya=(xn>>>19|Gn<<13)^(xn<<3|Gn>>>29)^xn>>>6,Gn=(Gn>>>19|xn<<13)^(Gn<<3|xn>>>29)^(Gn>>>6|xn<<26),xn=J[Os-7],sa=xn.high,Vi=J[Os-16],vr=Vi.high,Vi=Vi.low,xn=zs+xn.low,hi=hi+sa+(xn>>>0<zs>>>0?1:0),xn=xn+Gn,hi=hi+Ya+(xn>>>0<Gn>>>0?1:0),xn=xn+Vi,hi=hi+vr+(xn>>>0<Vi>>>0?1:0);Xa.high=hi,Xa.low=xn}var sa=Tn&Rr^~Tn&fi,Vi=Fn&Fr^~Fn&fr,Xa=Er&xr^Er&_n^xr&_n,Qa=ir&Vn^ir&dn^Vn&dn,zs=(Er>>>28|ir<<4)^(Er<<30|ir>>>2)^(Er<<25|ir>>>7),Ya=(ir>>>28|Er<<4)^(ir<<30|Er>>>2)^(ir<<25|Er>>>7),Gn=Q[Os],xl=Gn.high,ql=Gn.low,Gn=ia+((Fn>>>14|Tn<<18)^(Fn>>>18|Tn<<14)^(Fn<<23|Tn>>>9)),vr=jd+((Tn>>>14|Fn<<18)^(Tn>>>18|Fn<<14)^(Tn<<23|Fn>>>9))+(Gn>>>0<ia>>>0?1:0),Gn=Gn+Vi,vr=vr+sa+(Gn>>>0<Vi>>>0?1:0),Gn=Gn+ql,vr=vr+xl+(Gn>>>0<ql>>>0?1:0),Gn=Gn+xn,vr=vr+hi+(Gn>>>0<xn>>>0?1:0),xn=Ya+Qa,Xa=zs+Xa+(xn>>>0<Ya>>>0?1:0),jd=fi,ia=fr,fi=Rr,fr=Fr,Rr=Tn,Fr=Fn,Fn=Ir+Gn|0,Tn=ra+vr+(Fn>>>0<Ir>>>0?1:0)|0,ra=_n,Ir=dn,_n=xr,dn=Vn,xr=Er,Vn=ir,ir=Gn+xn|0,Er=vr+Xa+(ir>>>0<Gn>>>0?1:0)|0}nt=ce.low=nt+ir,ce.high=tt+Er+(nt>>>0<ir>>>0?1:0),_e=W.low=_e+Vn,W.high=it+xr+(_e>>>0<Vn>>>0?1:0),Ae=ne.low=Ae+dn,ne.high=Ie+_n+(Ae>>>0<dn>>>0?1:0),Be=X.low=Be+Ir,X.high=Te+ra+(Be>>>0<Ir>>>0?1:0),ct=ie.low=ct+Fn,ie.high=rt+Tn+(ct>>>0<Fn>>>0?1:0),st=ue.low=st+Fr,ue.high=Tt+Rr+(st>>>0<Fr>>>0?1:0),Pt=ve.low=Pt+fr,ve.high=yt+fi+(Pt>>>0<fr>>>0?1:0),kr=ze.low=kr+ia,ze.high=jt+jd+(kr>>>0<ia>>>0?1:0)},_doFinalize:function(){var te=this._data,le=te.words,ce=8*this._nDataBytes,W=8*te.sigBytes;return le[W>>>5]|=128<<24-W%32,le[(W+128>>>10<<5)+30]=Math.floor(ce/4294967296),le[(W+128>>>10<<5)+31]=ce,te.sigBytes=4*le.length,this._process(),this._hash.toX32()},clone:function(){var te=A.clone.call(this);return te._hash=this._hash.clone(),te},blockSize:32}),N.SHA512=A._createHelper(U),N.HmacSHA512=A._createHmacHelper(U)})(),(function(){var P=i,H=P.x64,N=H.Word,A=H.WordArray,H=P.algo,q=H.SHA512,H=H.SHA384=q.extend({_doReset:function(){this._hash=new A.init([new N.init(3418070365,3238371032),new N.init(1654270250,914150663),new N.init(2438529370,812702999),new N.init(355462360,4144912697),new N.init(1731405415,4290775857),new N.init(2394180231,1750603025),new N.init(3675008525,1694076839),new N.init(1203062813,3204075428)])},_doFinalize:function(){var U=q._doFinalize.call(this);return U.sigBytes-=16,U}});P.SHA384=q._createHelper(H),P.HmacSHA384=q._createHmacHelper(H)})(),(function(){var P=i,te=P.lib,N=te.WordArray,A=te.Hasher,te=P.algo,q=N.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),H=N.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),U=N.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),Q=N.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),J=N.create([0,1518500249,1859775393,2400959708,2840853838]),ae=N.create([1352829926,1548603684,1836072691,2053994217,0]),te=te.RIPEMD160=A.extend({_doReset:function(){this._hash=N.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(le,ce){for(var W=0;16>W;W++){var ne=ce+W,X=le[ne];le[ne]=(X<<8|X>>>24)&16711935|(X<<24|X>>>8)&4278255360}var ne=this._hash.words,X=J.words,ie=ae.words,ue=q.words,ve=H.words,ze=U.words,tt=Q.words,nt,it,_e,Ie,Ae,Te,Be,rt,ct,Tt;Te=nt=ne[0],Be=it=ne[1],rt=_e=ne[2],ct=Ie=ne[3],Tt=Ae=ne[4];for(var st,W=0;80>W;W+=1)st=nt+le[ce+ue[W]]|0,st=16>W?st+((it^_e^Ie)+X[0]):32>W?st+((it&_e|~it&Ie)+X[1]):48>W?st+(((it|~_e)^Ie)+X[2]):64>W?st+((it&Ie|_e&~Ie)+X[3]):st+((it^(_e|~Ie))+X[4]),st|=0,st=st<<ze[W]|st>>>32-ze[W],st=st+Ae|0,nt=Ae,Ae=Ie,Ie=_e<<10|_e>>>22,_e=it,it=st,st=Te+le[ce+ve[W]]|0,st=16>W?st+((Be^(rt|~ct))+ie[0]):32>W?st+((Be&ct|rt&~ct)+ie[1]):48>W?st+(((Be|~rt)^ct)+ie[2]):64>W?st+((Be&rt|~Be&ct)+ie[3]):st+((Be^rt^ct)+ie[4]),st|=0,st=st<<tt[W]|st>>>32-tt[W],st=st+Tt|0,Te=Tt,Tt=ct,ct=rt<<10|rt>>>22,rt=Be,Be=st;st=ne[1]+_e+ct|0,ne[1]=ne[2]+Ie+Tt|0,ne[2]=ne[3]+Ae+Te|0,ne[3]=ne[4]+nt+Be|0,ne[4]=ne[0]+it+rt|0,ne[0]=st},_doFinalize:function(){var le=this._data,ce=le.words,W=8*this._nDataBytes,ne=8*le.sigBytes;for(ce[ne>>>5]|=128<<24-ne%32,ce[(ne+64>>>9<<4)+14]=(W<<8|W>>>24)&16711935|(W<<24|W>>>8)&4278255360,le.sigBytes=4*(ce.length+1),this._process(),le=this._hash,ce=le.words,W=0;5>W;W++)ne=ce[W],ce[W]=(ne<<8|ne>>>24)&16711935|(ne<<24|ne>>>8)&4278255360;return le},clone:function(){var le=A.clone.call(this);return le._hash=this._hash.clone(),le}});P.RIPEMD160=A._createHelper(te),P.HmacRIPEMD160=A._createHmacHelper(te)})(),(function(){var P=i,N=P.enc.Utf8;P.algo.HMAC=P.lib.Base.extend({init:function(A,q){A=this._hasher=new A.init,typeof q=="string"&&(q=N.parse(q));var H=A.blockSize,U=4*H;q.sigBytes>U&&(q=A.finalize(q)),q.clamp();for(var Q=this._oKey=q.clone(),J=this._iKey=q.clone(),ae=Q.words,te=J.words,le=0;le<H;le++)ae[le]^=1549556828,te[le]^=909522486;Q.sigBytes=J.sigBytes=U,this.reset()},reset:function(){var A=this._hasher;A.reset(),A.update(this._iKey)},update:function(A){return this._hasher.update(A),this},finalize:function(A){var q=this._hasher;return A=q.finalize(A),q.reset(),q.finalize(this._oKey.clone().concat(A))}})})(),(function(){var P=i,q=P.lib,N=q.Base,A=q.WordArray,q=P.algo,H=q.HMAC,U=q.PBKDF2=N.extend({cfg:N.extend({keySize:4,hasher:q.SHA1,iterations:1}),init:function(Q){this.cfg=this.cfg.extend(Q)},compute:function(Q,J){for(var X=this.cfg,ae=H.create(X.hasher,Q),te=A.create(),le=A.create([1]),ce=te.words,W=le.words,ne=X.keySize,X=X.iterations;ce.length<ne;){var ie=ae.update(J).finalize(le);ae.reset();for(var ue=ie.words,ve=ue.length,ze=ie,tt=1;tt<X;tt++){ze=ae.finalize(ze),ae.reset();for(var nt=ze.words,it=0;it<ve;it++)ue[it]^=nt[it]}te.concat(ie),W[0]++}return te.sigBytes=4*ne,te}});P.PBKDF2=function(Q,J,ae){return U.create(ae).compute(Q,J)}})();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="=";function o(P){var N,A,q="";for(N=0;N+3<=P.length;N+=3)A=parseInt(P.substring(N,N+3),16),q+=r.charAt(A>>6)+r.charAt(A&63);for(N+1==P.length?(A=parseInt(P.substring(N,N+1),16),q+=r.charAt(A<<2)):N+2==P.length&&(A=parseInt(P.substring(N,N+2),16),q+=r.charAt(A>>2)+r.charAt((A&3)<<4));(q.length&3)>0;)q+=s;return q}function u(P){var N="",A,q=0,H,U;for(A=0;A<P.length&&P.charAt(A)!=s;++A)U=r.indexOf(P.charAt(A)),!(U<0)&&(q==0?(N+=p(U>>2),H=U&3,q=1):q==1?(N+=p(H<<2|U>>4),H=U&15,q=2):q==2?(N+=p(H),N+=p(U>>2),H=U&3,q=3):(N+=p(H<<2|U>>4),N+=p(U&15),q=0));return q==1&&(N+=p(H<<2)),N}function c(P){var N=u(P),A,q=new Array;for(A=0;2*A<N.length;++A)q[A]=parseInt(N.substring(2*A,2*A+2),16);return q}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
*/var d;function l(P,N,A){P!=null&&(typeof P=="number"?this.fromNumber(P,N,A):N==null&&typeof P!="string"?this.fromString(P,256):this.fromString(P,N))}function f(){return new l(null)}function b(P,N,A,q,H,U){for(;--U>=0;){var Q=N*this[P++]+A[q]+H;H=Math.floor(Q/67108864),A[q++]=Q&67108863}return H}function C(P,N,A,q,H,U){for(var Q=N&32767,J=N>>15;--U>=0;){var ae=this[P]&32767,te=this[P++]>>15,le=J*ae+te*Q;ae=Q*ae+((le&32767)<<15)+A[q]+(H&1073741823),H=(ae>>>30)+(le>>>15)+J*te+(H>>>30),A[q++]=ae&1073741823}return H}function v(P,N,A,q,H,U){for(var Q=N&16383,J=N>>14;--U>=0;){var ae=this[P]&16383,te=this[P++]>>14,le=J*ae+te*Q;ae=Q*ae+((le&16383)<<14)+A[q]+H,H=(ae>>28)+(le>>14)+J*te,A[q++]=ae&268435455}return H}e.appName=="Microsoft Internet Explorer"?(l.prototype.am=C,d=30):e.appName!="Netscape"?(l.prototype.am=b,d=26):(l.prototype.am=v,d=28),l.prototype.DB=d,l.prototype.DM=(1<<d)-1,l.prototype.DV=1<<d;var m=52;l.prototype.FV=Math.pow(2,m),l.prototype.F1=m-d,l.prototype.F2=2*d-m;var h="0123456789abcdefghijklmnopqrstuvwxyz",g=new Array,_,S;for(_=48,S=0;S<=9;++S)g[_++]=S;for(_=97,S=10;S<36;++S)g[_++]=S;for(_=65,S=10;S<36;++S)g[_++]=S;function p(P){return h.charAt(P)}function w(P,N){var A=g[P.charCodeAt(N)];return A??-1}function O(P){for(var N=this.t-1;N>=0;--N)P[N]=this[N];P.t=this.t,P.s=this.s}function E(P){this.t=1,this.s=P<0?-1:0,P>0?this[0]=P:P<-1?this[0]=P+this.DV:this.t=0}function F(P){var N=f();return N.fromInt(P),N}function R(P,N){var A;if(N==16)A=4;else if(N==8)A=3;else if(N==256)A=8;else if(N==2)A=1;else if(N==32)A=5;else if(N==4)A=2;else{this.fromRadix(P,N);return}this.t=0,this.s=0;for(var q=P.length,H=!1,U=0;--q>=0;){var Q=A==8?P[q]&255:w(P,q);if(Q<0){P.charAt(q)=="-"&&(H=!0);continue}H=!1,U==0?this[this.t++]=Q:U+A>this.DB?(this[this.t-1]|=(Q&(1<<this.DB-U)-1)<<U,this[this.t++]=Q>>this.DB-U):this[this.t-1]|=Q<<U,U+=A,U>=this.DB&&(U-=this.DB)}A==8&&(P[0]&128)!=0&&(this.s=-1,U>0&&(this[this.t-1]|=(1<<this.DB-U)-1<<U)),this.clamp(),H&&l.ZERO.subTo(this,this)}function M(){for(var P=this.s&this.DM;this.t>0&&this[this.t-1]==P;)--this.t}function j(P){if(this.s<0)return"-"+this.negate().toString(P);var N;if(P==16)N=4;else if(P==8)N=3;else if(P==2)N=1;else if(P==32)N=5;else if(P==4)N=2;else return this.toRadix(P);var A=(1<<N)-1,q,H=!1,U="",Q=this.t,J=this.DB-Q*this.DB%N;if(Q-- >0)for(J<this.DB&&(q=this[Q]>>J)>0&&(H=!0,U=p(q));Q>=0;)J<N?(q=(this[Q]&(1<<J)-1)<<N-J,q|=this[--Q]>>(J+=this.DB-N)):(q=this[Q]>>(J-=N)&A,J<=0&&(J+=this.DB,--Q)),q>0&&(H=!0),H&&(U+=p(q));return H?U:"0"}function k(){var P=f();return l.ZERO.subTo(this,P),P}function x(){return this.s<0?this.negate():this}function L(P){var N=this.s-P.s;if(N!=0)return N;var A=this.t;if(N=A-P.t,N!=0)return this.s<0?-N:N;for(;--A>=0;)if((N=this[A]-P[A])!=0)return N;return 0}function V(P){var N=1,A;return(A=P>>>16)!=0&&(P=A,N+=16),(A=P>>8)!=0&&(P=A,N+=8),(A=P>>4)!=0&&(P=A,N+=4),(A=P>>2)!=0&&(P=A,N+=2),(A=P>>1)!=0&&(P=A,N+=1),N}function G(){return this.t<=0?0:this.DB*(this.t-1)+V(this[this.t-1]^this.s&this.DM)}function ee(P,N){var A;for(A=this.t-1;A>=0;--A)N[A+P]=this[A];for(A=P-1;A>=0;--A)N[A]=0;N.t=this.t+P,N.s=this.s}function se(P,N){for(var A=P;A<this.t;++A)N[A-P]=this[A];N.t=Math.max(this.t-P,0),N.s=this.s}function re(P,N){var A=P%this.DB,q=this.DB-A,H=(1<<q)-1,U=Math.floor(P/this.DB),Q=this.s<<A&this.DM,J;for(J=this.t-1;J>=0;--J)N[J+U+1]=this[J]>>q|Q,Q=(this[J]&H)<<A;for(J=U-1;J>=0;--J)N[J]=0;N[U]=Q,N.t=this.t+U+1,N.s=this.s,N.clamp()}function fe(P,N){N.s=this.s;var A=Math.floor(P/this.DB);if(A>=this.t){N.t=0;return}var q=P%this.DB,H=this.DB-q,U=(1<<q)-1;N[0]=this[A]>>q;for(var Q=A+1;Q<this.t;++Q)N[Q-A-1]|=(this[Q]&U)<<H,N[Q-A]=this[Q]>>q;q>0&&(N[this.t-A-1]|=(this.s&U)<<H),N.t=this.t-A,N.clamp()}function oe(P,N){for(var A=0,q=0,H=Math.min(P.t,this.t);A<H;)q+=this[A]-P[A],N[A++]=q&this.DM,q>>=this.DB;if(P.t<this.t){for(q-=P.s;A<this.t;)q+=this[A],N[A++]=q&this.DM,q>>=this.DB;q+=this.s}else{for(q+=this.s;A<P.t;)q-=P[A],N[A++]=q&this.DM,q>>=this.DB;q-=P.s}N.s=q<0?-1:0,q<-1?N[A++]=this.DV+q:q>0&&(N[A++]=q),N.t=A,N.clamp()}function pe(P,N){var A=this.abs(),q=P.abs(),H=A.t;for(N.t=H+q.t;--H>=0;)N[H]=0;for(H=0;H<q.t;++H)N[H+A.t]=A.am(0,q[H],N,H,0,A.t);N.s=0,N.clamp(),this.s!=P.s&&l.ZERO.subTo(N,N)}function de(P){for(var N=this.abs(),A=P.t=2*N.t;--A>=0;)P[A]=0;for(A=0;A<N.t-1;++A){var q=N.am(A,N[A],P,2*A,0,1);(P[A+N.t]+=N.am(A+1,2*N[A],P,2*A+1,q,N.t-A-1))>=N.DV&&(P[A+N.t]-=N.DV,P[A+N.t+1]=1)}P.t>0&&(P[P.t-1]+=N.am(A,N[A],P,2*A,0,1)),P.s=0,P.clamp()}function ge(P,N,A){var q=P.abs();if(!(q.t<=0)){var H=this.abs();if(H.t<q.t){N?.fromInt(0),A!=null&&this.copyTo(A);return}A==null&&(A=f());var U=f(),Q=this.s,J=P.s,ae=this.DB-V(q[q.t-1]);ae>0?(q.lShiftTo(ae,U),H.lShiftTo(ae,A)):(q.copyTo(U),H.copyTo(A));var te=U.t,le=U[te-1];if(le!=0){var ce=le*(1<<this.F1)+(te>1?U[te-2]>>this.F2:0),W=this.FV/ce,ne=(1<<this.F1)/ce,X=1<<this.F2,ie=A.t,ue=ie-te,ve=N??f();for(U.dlShiftTo(ue,ve),A.compareTo(ve)>=0&&(A[A.t++]=1,A.subTo(ve,A)),l.ONE.dlShiftTo(te,ve),ve.subTo(U,U);U.t<te;)U[U.t++]=0;for(;--ue>=0;){var ze=A[--ie]==le?this.DM:Math.floor(A[ie]*W+(A[ie-1]+X)*ne);if((A[ie]+=U.am(0,ze,A,ue,0,te))<ze)for(U.dlShiftTo(ue,ve),A.subTo(ve,A);A[ie]<--ze;)A.subTo(ve,A)}N!=null&&(A.drShiftTo(te,N),Q!=J&&l.ZERO.subTo(N,N)),A.t=te,A.clamp(),ae>0&&A.rShiftTo(ae,A),Q<0&&l.ZERO.subTo(A,A)}}}function Ce(P){var N=f();return this.abs().divRemTo(P,null,N),this.s<0&&N.compareTo(l.ZERO)>0&&P.subTo(N,N),N}function Fe(P){this.m=P}function We(P){return P.s<0||P.compareTo(this.m)>=0?P.mod(this.m):P}function Ze(P){return P}function lt(P){P.divRemTo(this.m,null,P)}function ut(P,N,A){P.multiplyTo(N,A),this.reduce(A)}function pt(P,N){P.squareTo(N),this.reduce(N)}Fe.prototype.convert=We,Fe.prototype.revert=Ze,Fe.prototype.reduce=lt,Fe.prototype.mulTo=ut,Fe.prototype.sqrTo=pt;function Nt(){if(this.t<1)return 0;var P=this[0];if((P&1)==0)return 0;var N=P&3;return N=N*(2-(P&15)*N)&15,N=N*(2-(P&255)*N)&255,N=N*(2-((P&65535)*N&65535))&65535,N=N*(2-P*N%this.DV)%this.DV,N>0?this.DV-N:-N}function Ke(P){this.m=P,this.mp=P.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<P.DB-15)-1,this.mt2=2*P.t}function Ge(P){var N=f();return P.abs().dlShiftTo(this.m.t,N),N.divRemTo(this.m,null,N),P.s<0&&N.compareTo(l.ZERO)>0&&this.m.subTo(N,N),N}function Re(P){var N=f();return P.copyTo(N),this.reduce(N),N}function Qe(P){for(;P.t<=this.mt2;)P[P.t++]=0;for(var N=0;N<this.m.t;++N){var A=P[N]&32767,q=A*this.mpl+((A*this.mph+(P[N]>>15)*this.mpl&this.um)<<15)&P.DM;for(A=N+this.m.t,P[A]+=this.m.am(0,q,P,N,0,this.m.t);P[A]>=P.DV;)P[A]-=P.DV,P[++A]++}P.clamp(),P.drShiftTo(this.m.t,P),P.compareTo(this.m)>=0&&P.subTo(this.m,P)}function Y(P,N){P.squareTo(N),this.reduce(N)}function Me(P,N,A){P.multiplyTo(N,A),this.reduce(A)}Ke.prototype.convert=Ge,Ke.prototype.revert=Re,Ke.prototype.reduce=Qe,Ke.prototype.mulTo=Me,Ke.prototype.sqrTo=Y;function K(){return(this.t>0?this[0]&1:this.s)==0}function Z(P,N){if(P>4294967295||P<1)return l.ONE;var A=f(),q=f(),H=N.convert(this),U=V(P)-1;for(H.copyTo(A);--U>=0;)if(N.sqrTo(A,q),(P&1<<U)>0)N.mulTo(q,H,A);else{var Q=A;A=q,q=Q}return N.revert(A)}function me(P,N){var A;return P<256||N.isEven()?A=new Fe(N):A=new Ke(N),this.exp(P,A)}l.prototype.copyTo=O,l.prototype.fromInt=E,l.prototype.fromString=R,l.prototype.clamp=M,l.prototype.dlShiftTo=ee,l.prototype.drShiftTo=se,l.prototype.lShiftTo=re,l.prototype.rShiftTo=fe,l.prototype.subTo=oe,l.prototype.multiplyTo=pe,l.prototype.squareTo=de,l.prototype.divRemTo=ge,l.prototype.invDigit=Nt,l.prototype.isEven=K,l.prototype.exp=Z,l.prototype.toString=j,l.prototype.negate=k,l.prototype.abs=x,l.prototype.compareTo=L,l.prototype.bitLength=G,l.prototype.mod=Ce,l.prototype.modPowInt=me,l.ZERO=F(0),l.ONE=F(1);/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function we(){var P=f();return this.copyTo(P),P}function qe(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function xe(){return this.t==0?this.s:this[0]<<24>>24}function Oe(){return this.t==0?this.s:this[0]<<16>>16}function He(P){return Math.floor(Math.LN2*this.DB/Math.log(P))}function Se(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Ve(P){if(P==null&&(P=10),this.signum()==0||P<2||P>36)return"0";var N=this.chunkSize(P),A=Math.pow(P,N),q=F(A),H=f(),U=f(),Q="";for(this.divRemTo(q,H,U);H.signum()>0;)Q=(A+U.intValue()).toString(P).substr(1)+Q,H.divRemTo(q,H,U);return U.intValue().toString(P)+Q}function ot(P,N){this.fromInt(0),N==null&&(N=10);for(var A=this.chunkSize(N),q=Math.pow(N,A),H=!1,U=0,Q=0,J=0;J<P.length;++J){var ae=w(P,J);if(ae<0){P.charAt(J)=="-"&&this.signum()==0&&(H=!0);continue}Q=N*Q+ae,++U>=A&&(this.dMultiply(q),this.dAddOffset(Q,0),U=0,Q=0)}U>0&&(this.dMultiply(Math.pow(N,U)),this.dAddOffset(Q,0)),H&&l.ZERO.subTo(this,this)}function mt(P,N,A){if(typeof N=="number")if(P<2)this.fromInt(1);else for(this.fromNumber(P,A),this.testBit(P-1)||this.bitwiseTo(l.ONE.shiftLeft(P-1),xt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(N);)this.dAddOffset(2,0),this.bitLength()>P&&this.subTo(l.ONE.shiftLeft(P-1),this);else{var q=new Array,H=P&7;q.length=(P>>3)+1,N.nextBytes(q),H>0?q[0]&=(1<<H)-1:q[0]=0,this.fromString(q,256)}}function he(){var P=this.t,N=new Array;N[0]=this.s;var A=this.DB-P*this.DB%8,q,H=0;if(P-- >0)for(A<this.DB&&(q=this[P]>>A)!=(this.s&this.DM)>>A&&(N[H++]=q|this.s<<this.DB-A);P>=0;)A<8?(q=(this[P]&(1<<A)-1)<<8-A,q|=this[--P]>>(A+=this.DB-8)):(q=this[P]>>(A-=8)&255,A<=0&&(A+=this.DB,--P)),(q&128)!=0&&(q|=-256),H==0&&(this.s&128)!=(q&128)&&++H,(H>0||q!=this.s)&&(N[H++]=q);return N}function Ue(P){return this.compareTo(P)==0}function Pe(P){return this.compareTo(P)<0?this:P}function Ye(P){return this.compareTo(P)>0?this:P}function ke(P,N,A){var q,H,U=Math.min(P.t,this.t);for(q=0;q<U;++q)A[q]=N(this[q],P[q]);if(P.t<this.t){for(H=P.s&this.DM,q=U;q<this.t;++q)A[q]=N(this[q],H);A.t=this.t}else{for(H=this.s&this.DM,q=U;q<P.t;++q)A[q]=N(H,P[q]);A.t=P.t}A.s=N(this.s,P.s),A.clamp()}function Rt(P,N){return P&N}function Ft(P){var N=f();return this.bitwiseTo(P,Rt,N),N}function xt(P,N){return P|N}function zt(P){var N=f();return this.bitwiseTo(P,xt,N),N}function fn(P,N){return P^N}function je(P){var N=f();return this.bitwiseTo(P,fn,N),N}function Ne(P,N){return P&~N}function Kt(P){var N=f();return this.bitwiseTo(P,Ne,N),N}function mn(){for(var P=f(),N=0;N<this.t;++N)P[N]=this.DM&~this[N];return P.t=this.t,P.s=~this.s,P}function er(P){var N=f();return P<0?this.rShiftTo(-P,N):this.lShiftTo(P,N),N}function ji(P){var N=f();return P<0?this.lShiftTo(-P,N):this.rShiftTo(P,N),N}function Qs(P){if(P==0)return-1;var N=0;return(P&65535)==0&&(P>>=16,N+=16),(P&255)==0&&(P>>=8,N+=8),(P&15)==0&&(P>>=4,N+=4),(P&3)==0&&(P>>=2,N+=2),(P&1)==0&&++N,N}function Qr(){for(var P=0;P<this.t;++P)if(this[P]!=0)return P*this.DB+Qs(this[P]);return this.s<0?this.t*this.DB:-1}function Br(P){for(var N=0;P!=0;)P&=P-1,++N;return N}function wr(){for(var P=0,N=this.s&this.DM,A=0;A<this.t;++A)P+=Br(this[A]^N);return P}function qn(P){var N=Math.floor(P/this.DB);return N>=this.t?this.s!=0:(this[N]&1<<P%this.DB)!=0}function qi(P,N){var A=l.ONE.shiftLeft(P);return this.bitwiseTo(A,N,A),A}function Ys(P){return this.changeBit(P,xt)}function In(P){return this.changeBit(P,Ne)}function Si(P){return this.changeBit(P,fn)}function xa(P,N){for(var A=0,q=0,H=Math.min(P.t,this.t);A<H;)q+=this[A]+P[A],N[A++]=q&this.DM,q>>=this.DB;if(P.t<this.t){for(q+=P.s;A<this.t;)q+=this[A],N[A++]=q&this.DM,q>>=this.DB;q+=this.s}else{for(q+=this.s;A<P.t;)q+=P[A],N[A++]=q&this.DM,q>>=this.DB;q+=P.s}N.s=q<0?-1:0,q>0?N[A++]=q:q<-1&&(N[A++]=this.DV+q),N.t=A,N.clamp()}function os(P){var N=f();return this.addTo(P,N),N}function bs(P){var N=f();return this.subTo(P,N),N}function Yr(P){var N=f();return this.multiplyTo(P,N),N}function ni(){var P=f();return this.squareTo(P),P}function cs(P){var N=f();return this.divRemTo(P,N,null),N}function Mi(P){var N=f();return this.divRemTo(P,null,N),N}function $n(P){var N=f(),A=f();return this.divRemTo(P,N,A),new Array(N,A)}function Xs(P){this[this.t]=this.am(0,P-1,this,0,0,this.t),++this.t,this.clamp()}function vs(P,N){if(P!=0){for(;this.t<=N;)this[this.t++]=0;for(this[N]+=P;this[N]>=this.DV;)this[N]-=this.DV,++N>=this.t&&(this[this.t++]=0),++this[N]}}function Xr(){}function us(P){return P}function Ss(P,N,A){P.multiplyTo(N,A)}function Ci(P,N){P.squareTo(N)}Xr.prototype.convert=us,Xr.prototype.revert=us,Xr.prototype.mulTo=Ss,Xr.prototype.sqrTo=Ci;function ds(P){return this.exp(P,new Xr)}function Gt(P,N,A){var q=Math.min(this.t+P.t,N);for(A.s=0,A.t=q;q>0;)A[--q]=0;var H;for(H=A.t-this.t;q<H;++q)A[q+this.t]=this.am(0,P[q],A,q,0,this.t);for(H=Math.min(P.t,N);q<H;++q)this.am(0,P[q],A,q,0,N-q);A.clamp()}function gn(P,N,A){--N;var q=A.t=this.t+P.t-N;for(A.s=0;--q>=0;)A[q]=0;for(q=Math.max(N-this.t,0);q<P.t;++q)A[this.t+q-N]=this.am(N-q,P[q],A,0,0,this.t+q-N);A.clamp(),A.drShiftTo(1,A)}function wn(P){this.r2=f(),this.q3=f(),l.ONE.dlShiftTo(2*P.t,this.r2),this.mu=this.r2.divide(P),this.m=P}function Or(P){if(P.s<0||P.t>2*this.m.t)return P.mod(this.m);if(P.compareTo(this.m)<0)return P;var N=f();return P.copyTo(N),this.reduce(N),N}function Zs(P){return P}function $a(P){for(P.drShiftTo(this.m.t-1,this.r2),P.t>this.m.t+1&&(P.t=this.m.t+1,P.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);P.compareTo(this.r2)<0;)P.dAddOffset(1,this.m.t+1);for(P.subTo(this.r2,P);P.compareTo(this.m)>=0;)P.subTo(this.m,P)}function Ga(P,N){P.squareTo(N),this.reduce(N)}function Tl(P,N,A){P.multiplyTo(N,A),this.reduce(A)}wn.prototype.convert=Or,wn.prototype.revert=Zs,wn.prototype.reduce=$a,wn.prototype.mulTo=Tl,wn.prototype.sqrTo=Ga;function wl(P,N){var A=P.bitLength(),q,H=F(1),U;if(A<=0)return H;A<18?q=1:A<48?q=3:A<144?q=4:A<768?q=5:q=6,A<8?U=new Fe(N):N.isEven()?U=new wn(N):U=new Ke(N);var Q=new Array,J=3,ae=q-1,te=(1<<q)-1;if(Q[1]=U.convert(this),q>1){var le=f();for(U.sqrTo(Q[1],le);J<=te;)Q[J]=f(),U.mulTo(le,Q[J-2],Q[J]),J+=2}var ce=P.t-1,W,ne=!0,X=f(),ie;for(A=V(P[ce])-1;ce>=0;){for(A>=ae?W=P[ce]>>A-ae&te:(W=(P[ce]&(1<<A+1)-1)<<ae-A,ce>0&&(W|=P[ce-1]>>this.DB+A-ae)),J=q;(W&1)==0;)W>>=1,--J;if((A-=J)<0&&(A+=this.DB,--ce),ne)Q[W].copyTo(H),ne=!1;else{for(;J>1;)U.sqrTo(H,X),U.sqrTo(X,H),J-=2;J>0?U.sqrTo(H,X):(ie=H,H=X,X=ie),U.mulTo(X,Q[W],H)}for(;ce>=0&&(P[ce]&1<<A)==0;)U.sqrTo(H,X),ie=H,H=X,X=ie,--A<0&&(A=this.DB-1,--ce)}return U.revert(H)}function _b(P){var N=this.s<0?this.negate():this.clone(),A=P.s<0?P.negate():P.clone();if(N.compareTo(A)<0){var q=N;N=A,A=q}var H=N.getLowestSetBit(),U=A.getLowestSetBit();if(U<0)return N;for(H<U&&(U=H),U>0&&(N.rShiftTo(U,N),A.rShiftTo(U,A));N.signum()>0;)(H=N.getLowestSetBit())>0&&N.rShiftTo(H,N),(H=A.getLowestSetBit())>0&&A.rShiftTo(H,A),N.compareTo(A)>=0?(N.subTo(A,N),N.rShiftTo(1,N)):(A.subTo(N,A),A.rShiftTo(1,A));return U>0&&A.lShiftTo(U,A),A}function Mc(P){if(P<=0)return 0;var N=this.DV%P,A=this.s<0?P-1:0;if(this.t>0)if(N==0)A=this[0]%P;else for(var q=this.t-1;q>=0;--q)A=(N*A+this[q])%P;return A}function Li(P){var N=P.isEven();if(this.isEven()&&N||P.signum()==0)return l.ZERO;for(var A=P.clone(),q=this.clone(),H=F(1),U=F(0),Q=F(0),J=F(1);A.signum()!=0;){for(;A.isEven();)A.rShiftTo(1,A),N?((!H.isEven()||!U.isEven())&&(H.addTo(this,H),U.subTo(P,U)),H.rShiftTo(1,H)):U.isEven()||U.subTo(P,U),U.rShiftTo(1,U);for(;q.isEven();)q.rShiftTo(1,q),N?((!Q.isEven()||!J.isEven())&&(Q.addTo(this,Q),J.subTo(P,J)),Q.rShiftTo(1,Q)):J.isEven()||J.subTo(P,J),J.rShiftTo(1,J);A.compareTo(q)>=0?(A.subTo(q,A),N&&H.subTo(Q,H),U.subTo(J,U)):(q.subTo(A,q),N&&Q.subTo(H,Q),J.subTo(U,J))}if(q.compareTo(l.ONE)!=0)return l.ZERO;if(J.compareTo(P)>=0)return J.subtract(P);if(J.signum()<0)J.addTo(P,J);else return J;return J.signum()<0?J.add(P):J}var ri=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Tb=(1<<26)/ri[ri.length-1];function bd(P){var N,A=this.abs();if(A.t==1&&A[0]<=ri[ri.length-1]){for(N=0;N<ri.length;++N)if(A[0]==ri[N])return!0;return!1}if(A.isEven())return!1;for(N=1;N<ri.length;){for(var q=ri[N],H=N+1;H<ri.length&&q<Tb;)q*=ri[H++];for(q=A.modInt(q);N<H;)if(q%ri[N++]==0)return!1}return A.millerRabin(P)}function ay(P){var N=this.subtract(l.ONE),A=N.getLowestSetBit();if(A<=0)return!1;var q=N.shiftRight(A);P=P+1>>1,P>ri.length&&(P=ri.length);for(var H=f(),U=0;U<P;++U){H.fromInt(ri[Math.floor(Math.random()*ri.length)]);var Q=H.modPow(q,this);if(Q.compareTo(l.ONE)!=0&&Q.compareTo(N)!=0){for(var J=1;J++<A&&Q.compareTo(N)!=0;)if(Q=Q.modPowInt(2,this),Q.compareTo(l.ONE)==0)return!1;if(Q.compareTo(N)!=0)return!1}}return!0}l.prototype.chunkSize=He,l.prototype.toRadix=Ve,l.prototype.fromRadix=ot,l.prototype.fromNumber=mt,l.prototype.bitwiseTo=ke,l.prototype.changeBit=qi,l.prototype.addTo=xa,l.prototype.dMultiply=Xs,l.prototype.dAddOffset=vs,l.prototype.multiplyLowerTo=Gt,l.prototype.multiplyUpperTo=gn,l.prototype.modInt=Mc,l.prototype.millerRabin=ay,l.prototype.clone=we,l.prototype.intValue=qe,l.prototype.byteValue=xe,l.prototype.shortValue=Oe,l.prototype.signum=Se,l.prototype.toByteArray=he,l.prototype.equals=Ue,l.prototype.min=Pe,l.prototype.max=Ye,l.prototype.and=Ft,l.prototype.or=zt,l.prototype.xor=je,l.prototype.andNot=Kt,l.prototype.not=mn,l.prototype.shiftLeft=er,l.prototype.shiftRight=ji,l.prototype.getLowestSetBit=Qr,l.prototype.bitCount=wr,l.prototype.testBit=qn,l.prototype.setBit=Ys,l.prototype.clearBit=In,l.prototype.flipBit=Si,l.prototype.add=os,l.prototype.subtract=bs,l.prototype.multiply=Yr,l.prototype.divide=cs,l.prototype.remainder=Mi,l.prototype.divideAndRemainder=$n,l.prototype.modPow=wl,l.prototype.modInverse=Li,l.prototype.pow=ds,l.prototype.gcd=_b,l.prototype.isProbablePrime=bd,l.prototype.square=ni;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Jo(){this.i=0,this.j=0,this.S=new Array}function oy(P){var N,A,q;for(N=0;N<256;++N)this.S[N]=N;for(A=0,N=0;N<256;++N)A=A+this.S[N]+P[N%P.length]&255,q=this.S[N],this.S[N]=this.S[A],this.S[A]=q;this.i=0,this.j=0}function Bi(){var P;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,P=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=P,this.S[P+this.S[this.i]&255]}Jo.prototype.init=oy,Jo.prototype.next=Bi;function ea(){return new Jo}var Nc=256;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var Ac,Zr,ei;function cy(P){Zr[ei++]^=P&255,Zr[ei++]^=P>>8&255,Zr[ei++]^=P>>16&255,Zr[ei++]^=P>>24&255,ei>=Nc&&(ei-=Nc)}function qa(){cy(new Date().getTime())}if(Zr==null){Zr=new Array,ei=0;var Cs;if(n!==void 0&&(n.crypto!==void 0||n.msCrypto!==void 0)){var Ol=n.crypto||n.msCrypto;if(Ol.getRandomValues){var vd=new Uint8Array(32);for(Ol.getRandomValues(vd),Cs=0;Cs<32;++Cs)Zr[ei++]=vd[Cs]}else if(e.appName=="Netscape"&&e.appVersion<"5"){var Dc=n.crypto.random(32);for(Cs=0;Cs<Dc.length;++Cs)Zr[ei++]=Dc.charCodeAt(Cs)&255}}for(;ei<Nc;)Cs=Math.floor(65536*Math.random()),Zr[ei++]=Cs>>>8,Zr[ei++]=Cs&255;ei=0,qa()}function Sd(){if(Ac==null){for(qa(),Ac=ea(),Ac.init(Zr),ei=0;ei<Zr.length;++ei)Zr[ei]=0;ei=0}return Ac.next()}function wb(P){var N;for(N=0;N<P.length;++N)P[N]=Sd()}function Us(){}Us.prototype.nextBytes=wb;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function ii(P,N){return new l(P,N)}function rn(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Qo(P,N){if(this.isPublic=!0,this.isPrivate=!1,typeof P!="string")this.n=P,this.e=N;else if(P!=null&&N!=null&&P.length>0&&N.length>0)this.n=ii(P,16),this.e=parseInt(N,16);else throw"Invalid RSA public key"}function Yo(P){return P.modPowInt(this.e,this.n)}rn.prototype.doPublic=Yo,rn.prototype.setPublic=Qo,rn.prototype.type="RSA";function Pl(P,N,A){if(this.isPrivate=!0,typeof P!="string")this.n=P,this.e=N,this.d=A;else if(P!=null&&N!=null&&P.length>0&&N.length>0)this.n=ii(P,16),this.e=parseInt(N,16),this.d=ii(A,16);else throw"Invalid RSA private key"}function kc(P,N,A,q,H,U,Q,J){if(this.isPrivate=!0,this.isPublic=!1,P==null)throw"RSASetPrivateEx N == null";if(N==null)throw"RSASetPrivateEx E == null";if(P.length==0)throw"RSASetPrivateEx N.length == 0";if(N.length==0)throw"RSASetPrivateEx E.length == 0";if(P!=null&&N!=null&&P.length>0&&N.length>0)this.n=ii(P,16),this.e=parseInt(N,16),this.d=ii(A,16),this.p=ii(q,16),this.q=ii(H,16),this.dmp1=ii(U,16),this.dmq1=ii(Q,16),this.coeff=ii(J,16);else throw"Invalid RSA private key in RSASetPrivateEx"}function El(P,N){var A=new Us,q=P>>1;this.e=parseInt(N,16);for(var H=new l(N,16),U=P/2-100,Q=l.ONE.shiftLeft(U);;){for(;this.p=new l(P-q,1,A),!(this.p.subtract(l.ONE).gcd(H).compareTo(l.ONE)==0&&this.p.isProbablePrime(10)););for(;this.q=new l(q,1,A),!(this.q.subtract(l.ONE).gcd(H).compareTo(l.ONE)==0&&this.q.isProbablePrime(10)););if(this.p.compareTo(this.q)<=0){var J=this.p;this.p=this.q,this.q=J}var ae=this.q.subtract(this.p).abs();if(!(ae.bitLength()<U||ae.compareTo(Q)<=0)){var te=this.p.subtract(l.ONE),le=this.q.subtract(l.ONE),ce=te.multiply(le);if(ce.gcd(H).compareTo(l.ONE)==0&&(this.n=this.p.multiply(this.q),this.n.bitLength()==P)){this.d=H.modInverse(ce),this.dmp1=this.d.mod(te),this.dmq1=this.d.mod(le),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0}function xc(P){if(this.p==null||this.q==null)return P.modPow(this.d,this.n);for(var N=P.mod(this.p).modPow(this.dmp1,this.p),A=P.mod(this.q).modPow(this.dmq1,this.q);N.compareTo(A)<0;)N=N.add(this.p);return N.subtract(A).multiply(this.coeff).mod(this.p).multiply(this.q).add(A)}rn.prototype.doPrivate=xc,rn.prototype.setPrivate=Pl,rn.prototype.setPrivateEx=kc,rn.prototype.generate=El;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Qn(P,N){this.x=N,this.q=P}function qc(P){return P==this?!0:this.q.equals(P.q)&&this.x.equals(P.x)}function Xo(){return this.x}function ta(){return new Qn(this.q,this.x.negate().mod(this.q))}function Zo(P){return new Qn(this.q,this.x.add(P.toBigInteger()).mod(this.q))}function Lc(P){return new Qn(this.q,this.x.subtract(P.toBigInteger()).mod(this.q))}function uy(P){return new Qn(this.q,this.x.multiply(P.toBigInteger()).mod(this.q))}function Wa(){return new Qn(this.q,this.x.square().mod(this.q))}function Ui(P){return new Qn(this.q,this.x.multiply(P.toBigInteger().modInverse(this.q)).mod(this.q))}Qn.prototype.equals=qc,Qn.prototype.toBigInteger=Xo,Qn.prototype.negate=ta,Qn.prototype.add=Zo,Qn.prototype.subtract=Lc,Qn.prototype.multiply=uy,Qn.prototype.square=Wa,Qn.prototype.divide=Ui,Qn.prototype.sqrt=function(){return new Qn(this.q,this.x.sqrt().mod(this.q))};function Sn(P,N,A,q){this.curve=P,this.x=N,this.y=A,q==null?this.z=l.ONE:this.z=q,this.zinv=null}function si(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function na(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function Cd(P){if(P==this)return!0;if(this.isInfinity())return P.isInfinity();if(P.isInfinity())return this.isInfinity();var N,A;return N=P.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(P.z)).mod(this.curve.q),N.equals(l.ZERO)?(A=P.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(P.z)).mod(this.curve.q),A.equals(l.ZERO)):!1}function Bc(){return this.x==null&&this.y==null?!0:this.z.equals(l.ZERO)&&!this.y.toBigInteger().equals(l.ZERO)}function Ob(){return new Sn(this.curve,this.x,this.y.negate(),this.z)}function Uc(P){if(this.isInfinity())return P;if(P.isInfinity())return this;var N=P.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(P.z)).mod(this.curve.q),A=P.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(P.z)).mod(this.curve.q);if(l.ZERO.equals(A))return l.ZERO.equals(N)?this.twice():this.curve.getInfinity();var q=new l("3"),H=this.x.toBigInteger(),U=this.y.toBigInteger();P.x.toBigInteger(),P.y.toBigInteger();var Q=A.square(),J=Q.multiply(A),ae=H.multiply(Q),te=N.square().multiply(this.z),le=te.subtract(ae.shiftLeft(1)).multiply(P.z).subtract(J).multiply(A).mod(this.curve.q),ce=ae.multiply(q).multiply(N).subtract(U.multiply(J)).subtract(te.multiply(N)).multiply(P.z).add(N.multiply(J)).mod(this.curve.q),W=J.multiply(this.z).multiply(P.z).mod(this.curve.q);return new Sn(this.curve,this.curve.fromBigInteger(le),this.curve.fromBigInteger(ce),W)}function Il(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var P=new l("3"),N=this.x.toBigInteger(),A=this.y.toBigInteger(),q=A.multiply(this.z),H=q.multiply(A).mod(this.curve.q),U=this.curve.a.toBigInteger(),Q=N.square().multiply(P);l.ZERO.equals(U)||(Q=Q.add(this.z.square().multiply(U))),Q=Q.mod(this.curve.q);var J=Q.square().subtract(N.shiftLeft(3).multiply(H)).shiftLeft(1).multiply(q).mod(this.curve.q),ae=Q.multiply(P).multiply(N).subtract(H.shiftLeft(1)).shiftLeft(2).multiply(H).subtract(Q.square().multiply(Q)).mod(this.curve.q),te=q.square().multiply(q).shiftLeft(3).mod(this.curve.q);return new Sn(this.curve,this.curve.fromBigInteger(J),this.curve.fromBigInteger(ae),te)}function ec(P){if(this.isInfinity())return this;if(P.signum()==0)return this.curve.getInfinity();var N=P,A=N.multiply(new l("3")),q=this.negate(),H=this,U=this.curve.q.subtract(P),Q=U.multiply(new l("3")),J=new Sn(this.curve,this.x,this.y),ae=J.negate(),te;for(te=A.bitLength()-2;te>0;--te){H=H.twice();var le=A.testBit(te),ce=N.testBit(te);le!=ce&&(H=H.add(le?this:q))}for(te=Q.bitLength()-2;te>0;--te){J=J.twice();var W=Q.testBit(te),ne=U.testBit(te);W!=ne&&(J=J.add(W?J:ae))}return H}function yr(P,N,A){var q;P.bitLength()>A.bitLength()?q=P.bitLength()-1:q=A.bitLength()-1;for(var H=this.curve.getInfinity(),U=this.add(N);q>=0;)H=H.twice(),P.testBit(q)?A.testBit(q)?H=H.add(U):H=H.add(this):A.testBit(q)&&(H=H.add(N)),--q;return H}Sn.prototype.getX=si,Sn.prototype.getY=na,Sn.prototype.equals=Cd,Sn.prototype.isInfinity=Bc,Sn.prototype.negate=Ob,Sn.prototype.add=Uc,Sn.prototype.twice=Il,Sn.prototype.multiply=ec,Sn.prototype.multiplyTwo=yr;function be(P,N,A){this.q=P,this.a=this.fromBigInteger(N),this.b=this.fromBigInteger(A),this.infinity=new Sn(this,null,null)}function Ee(){return this.q}function Le(){return this.a}function $e(){return this.b}function Xe(P){return P==this?!0:this.q.equals(P.q)&&this.a.equals(P.a)&&this.b.equals(P.b)}function gt(){return this.infinity}function ft(P){return new Qn(this.q,P)}function kt(P){switch(parseInt(P.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var N=P.substr(0,2);P.substr(2);var A=this.fromBigInteger(new l(ae,16)),q=this.getA(),H=this.getB(),U=A.square().add(q).multiply(A).add(H),Q=U.sqrt();return N=="03"&&(Q=Q.negate()),new Sn(this,A,Q);case 4:case 6:case 7:var J=(P.length-2)/2,ae=P.substr(2,J),te=P.substr(J+2,J);return new Sn(this,this.fromBigInteger(new l(ae,16)),this.fromBigInteger(new l(te,16)));default:return null}}be.prototype.getQ=Ee,be.prototype.getA=Le,be.prototype.getB=$e,be.prototype.equals=Xe,be.prototype.getInfinity=gt,be.prototype.fromBigInteger=ft,be.prototype.decodePointHex=kt;/*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
 */Qn.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Sn.prototype.getEncoded=function(P){var N=function(U,Q){var J=U.toByteArrayUnsigned();if(Q<J.length)J=J.slice(J.length-Q);else for(;Q>J.length;)J.unshift(0);return J},A=this.getX().toBigInteger(),q=this.getY().toBigInteger(),H=N(A,32);return P?q.isEven()?H.unshift(2):H.unshift(3):(H.unshift(4),H=H.concat(N(q,32))),H},Sn.decodeFrom=function(P,N){N[0];var A=N.length-1,q=N.slice(1,1+A/2),H=N.slice(1+A/2,1+A);q.unshift(0),H.unshift(0);var U=new l(q),Q=new l(H);return new Sn(P,P.fromBigInteger(U),P.fromBigInteger(Q))},Sn.decodeFromHex=function(P,N){N.substr(0,2);var A=N.length-2,q=N.substr(2,A/2),H=N.substr(2+A/2,A/2),U=new l(q,16),Q=new l(H,16);return new Sn(P,P.fromBigInteger(U),P.fromBigInteger(Q))},Sn.prototype.add2D=function(P){if(this.isInfinity())return P;if(P.isInfinity())return this;if(this.x.equals(P.x))return this.y.equals(P.y)?this.twice():this.curve.getInfinity();var N=P.x.subtract(this.x),A=P.y.subtract(this.y),q=A.divide(N),H=q.square().subtract(this.x).subtract(P.x),U=q.multiply(this.x.subtract(H)).subtract(this.y);return new Sn(this.curve,H,U)},Sn.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var P=this.curve.fromBigInteger(l.valueOf(2)),N=this.curve.fromBigInteger(l.valueOf(3)),A=this.x.square().multiply(N).add(this.curve.a).divide(this.y.multiply(P)),q=A.square().subtract(this.x.multiply(P)),H=A.multiply(this.x.subtract(q)).subtract(this.y);return new Sn(this.curve,q,H)},Sn.prototype.multiply2D=function(P){if(this.isInfinity())return this;if(P.signum()==0)return this.curve.getInfinity();var N=P,A=N.multiply(new l("3")),q=this.negate(),H=this,U;for(U=A.bitLength()-2;U>0;--U){H=H.twice();var Q=A.testBit(U),J=N.testBit(U);Q!=J&&(H=H.add2D(Q?this:q))}return H},Sn.prototype.isOnCurve=function(){var P=this.getX().toBigInteger(),N=this.getY().toBigInteger(),A=this.curve.getA().toBigInteger(),q=this.curve.getB().toBigInteger(),H=this.curve.getQ(),U=N.multiply(N).mod(H),Q=P.multiply(P).multiply(P).add(A.multiply(P)).add(q).mod(H);return U.equals(Q)},Sn.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Sn.prototype.validate=function(){var P=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var N=this.getX().toBigInteger(),A=this.getY().toBigInteger();if(N.compareTo(l.ONE)<0||N.compareTo(P.subtract(l.ONE))>0)throw new Error("x coordinate out of bounds");if(A.compareTo(l.ONE)<0||A.compareTo(P.subtract(l.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(P).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var Wt=(function(){var P="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",N='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',A='(?:"'+N+'*")',q=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+P+"|"+A+")","g"),H=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),U={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function Q(le,ce,W){return ce?U[ce]:String.fromCharCode(parseInt(W,16))}var J=new String(""),ae="\\",te=Object.hasOwnProperty;return function(le,ce){var W=le.match(q),ne,X=W[0],ie=!1;X==="{"?ne={}:X==="["?ne=[]:(ne=[],ie=!0);for(var ue,ve=[ne],ze=1-ie,tt=W.length;ze<tt;++ze){X=W[ze];var nt;switch(X.charCodeAt(0)){default:nt=ve[0],nt[ue||nt.length]=+X,ue=void 0;break;case 34:if(X=X.substring(1,X.length-1),X.indexOf(ae)!==-1&&(X=X.replace(H,Q)),nt=ve[0],!ue)if(nt instanceof Array)ue=nt.length;else{ue=X||J;break}nt[ue]=X,ue=void 0;break;case 91:nt=ve[0],ve.unshift(nt[ue||nt.length]=[]),ue=void 0;break;case 93:ve.shift();break;case 102:nt=ve[0],nt[ue||nt.length]=!1,ue=void 0;break;case 110:nt=ve[0],nt[ue||nt.length]=null,ue=void 0;break;case 116:nt=ve[0],nt[ue||nt.length]=!0,ue=void 0;break;case 123:nt=ve[0],ve.unshift(nt[ue||nt.length]={}),ue=void 0;break;case 125:ve.shift();break}}if(ie){if(ve.length!==1)throw new Error;ne=ne[0]}else if(ve.length)throw new Error;if(ce){var it=function(_e,Ie){var Ae=_e[Ie];if(Ae&&typeof Ae=="object"){var Te=null;for(var Be in Ae)if(te.call(Ae,Be)&&Ae!==_e){var rt=it(Ae,Be);rt!==void 0?Ae[Be]=rt:(Te||(Te=[]),Te.push(Be))}if(Te)for(var ct=Te.length;--ct>=0;)delete Ae[Te[ct]]}return ce.call(_e,Ie,Ae)};ne=it({"":ne},"")}return ne}})();(typeof B>"u"||!B)&&(B={}),(typeof B.asn1>"u"||!B.asn1)&&(B.asn1={}),B.asn1.ASN1Util=new function(){this.integerToByteHex=function(P){var N=P.toString(16);return N.length%2==1&&(N="0"+N),N},this.bigIntToMinTwosComplementsHex=function(P){return Hc(P)},this.getPEMStringFromHex=function(P,N){return Yn(P,N)},this.newObject=function(P){var N=B,A=N.asn1,q=A.ASN1Object,H=A.DERBoolean,U=A.DERInteger,Q=A.DERBitString,J=A.DEROctetString,ae=A.DERNull,te=A.DERObjectIdentifier,le=A.DEREnumerated,ce=A.DERUTF8String,W=A.DERNumericString,ne=A.DERPrintableString,X=A.DERTeletexString,ie=A.DERIA5String,ue=A.DERUTCTime,ve=A.DERGeneralizedTime,ze=A.DERVisibleString,tt=A.DERBMPString,nt=A.DERSequence,it=A.DERSet,_e=A.DERTaggedObject,Ie=A.ASN1Util.newObject;if(P instanceof A.ASN1Object)return P;var Ae=Object.keys(P);if(Ae.length!=1)throw new Error("key of param shall be only one.");var Te=Ae[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+Te+":")==-1)throw new Error("undefined key: "+Te);if(Te=="bool")return new H(P[Te]);if(Te=="int")return new U(P[Te]);if(Te=="bitstr")return new Q(P[Te]);if(Te=="octstr")return new J(P[Te]);if(Te=="null")return new ae(P[Te]);if(Te=="oid")return new te(P[Te]);if(Te=="enum")return new le(P[Te]);if(Te=="utf8str")return new ce(P[Te]);if(Te=="numstr")return new W(P[Te]);if(Te=="prnstr")return new ne(P[Te]);if(Te=="telstr")return new X(P[Te]);if(Te=="ia5str")return new ie(P[Te]);if(Te=="utctime")return new ue(P[Te]);if(Te=="gentime")return new ve(P[Te]);if(Te=="visstr")return new ze(P[Te]);if(Te=="bmpstr")return new tt(P[Te]);if(Te=="asn1")return new q(P[Te]);if(Te=="seq"){for(var Be=P[Te],rt=[],ct=0;ct<Be.length;ct++){var Tt=Ie(Be[ct]);rt.push(Tt)}return new nt({array:rt})}if(Te=="set"){for(var Be=P[Te],rt=[],ct=0;ct<Be.length;ct++){var Tt=Ie(Be[ct]);rt.push(Tt)}return new it({array:rt})}if(Te=="tag"){var st=P[Te];if(Object.prototype.toString.call(st)==="[object Array]"&&st.length==3){var yt=Ie(st[2]);return new _e({tag:st[0],explicit:st[1],obj:yt})}else return new _e(st)}},this.jsonToASN1HEX=function(P){var N=this.newObject(P);return N.tohex()}},B.asn1.ASN1Util.oidHexToInt=function(P){for(var H="",N=parseInt(P.substr(0,2),16),A=Math.floor(N/40),q=N%40,H=A+"."+q,U="",Q=2;Q<P.length;Q+=2){var J=parseInt(P.substr(Q,2),16),ae=("00000000"+J.toString(2)).slice(-8);if(U=U+ae.substr(1,7),ae.substr(0,1)=="0"){var te=new l(U,2);H=H+"."+te.toString(10),U=""}}return H},B.asn1.ASN1Util.oidIntToHex=function(P){var N=function(J){var ae=J.toString(16);return ae.length==1&&(ae="0"+ae),ae},A=function(J){var ae="",te=new l(J,10),le=te.toString(2),ce=7-le.length%7;ce==7&&(ce=0);for(var W="",ne=0;ne<ce;ne++)W+="0";le=W+le;for(var ne=0;ne<le.length-1;ne+=7){var X=le.substr(ne,7);ne!=le.length-7&&(X="1"+X),ae+=N(parseInt(X,2))}return ae};if(!P.match(/^[0-9.]+$/))throw"malformed oid string: "+P;var q="",H=P.split("."),U=parseInt(H[0])*40+parseInt(H[1]);q+=N(U),H.splice(0,2);for(var Q=0;Q<H.length;Q++)q+=A(H[Q]);return q},B.asn1.ASN1Object=function(P){var N="";this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+N.length+",v="+this.hV);var A=this.hV.length/2,q=A.toString(16);if(q.length%2==1&&(q="0"+q),A<128)return q;var H=q.length/2;if(H>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+A.toString(16));var U=128+H;return U.toString(16)+q},this.tohex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(A){this.params=A},P!=null&&P.tlv!=null&&(this.hTLV=P.tlv,this.isModified=!1)},B.asn1.DERAbstractString=function(P){B.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(N){this.hTLV=null,this.isModified=!0,this.s=N,this.hV=zc(this.s).toLowerCase()},this.setStringHex=function(N){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=N},this.getFreshValueHex=function(){return this.hV},typeof P<"u"&&(typeof P=="string"?this.setString(P):typeof P.str<"u"?this.setString(P.str):typeof P.hex<"u"&&this.setStringHex(P.hex))},wt(B.asn1.DERAbstractString,B.asn1.ASN1Object),B.asn1.DERAbstractTime=function(P){B.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(N){var A=N.getTime()+N.getTimezoneOffset()*6e4,q=new Date(A);return q},this.formatDate=function(N,A,q){var H=this.zeroPadding,U=this.localDateToUTC(N),Q=String(U.getFullYear());A=="utc"&&(Q=Q.substr(2,2));var J=H(String(U.getMonth()+1),2),ae=H(String(U.getDate()),2),te=H(String(U.getHours()),2),le=H(String(U.getMinutes()),2),ce=H(String(U.getSeconds()),2),W=Q+J+ae+te+le+ce;if(q===!0){var ne=U.getMilliseconds();if(ne!=0){var X=H(String(ne),3);X=X.replace(/[0]+$/,""),W=W+"."+X}}return W+"Z"},this.zeroPadding=function(N,A){return N.length>=A?N:new Array(A-N.length+1).join("0")+N},this.setByParam=function(N){this.hV=null,this.hTLV=null,this.params=N},this.getString=function(){},this.setString=function(N){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.str=N},this.setByDate=function(N){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.date=N},this.setByDateValue=function(N,A,q,H,U,Q){var J=new Date(Date.UTC(N,A-1,q,H,U,Q,0));this.setByDate(J)},this.getFreshValueHex=function(){return this.hV}},wt(B.asn1.DERAbstractTime,B.asn1.ASN1Object),B.asn1.DERAbstractStructured=function(P){B.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(N){this.hTLV=null,this.isModified=!0,this.asn1Array=N},this.appendASN1Object=function(N){this.hTLV=null,this.isModified=!0,this.asn1Array.push(N)},this.asn1Array=new Array,typeof P<"u"&&typeof P.array<"u"&&(this.asn1Array=P.array)},wt(B.asn1.DERAbstractStructured,B.asn1.ASN1Object),B.asn1.DERBoolean=function(P){B.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",P==!1?this.hTLV="010100":this.hTLV="0101ff"},wt(B.asn1.DERBoolean,B.asn1.ASN1Object),B.asn1.DERInteger=function(P){B.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var N=Hc;this.setByBigInteger=function(A){this.isModified=!0,this.params={bigint:A}},this.setByInteger=function(A){this.isModified=!0,this.params=A},this.setValueHex=function(A){this.isModified=!0,this.params={hex:A}},this.getFreshValueHex=function(){var A=this.params,q=null;if(A==null)throw new Error("value not set");if(typeof A=="object"&&A.hex!=null)return this.hV=A.hex,this.hV;if(typeof A=="number")q=new l(String(A),10);else if(A.int!=null)q=new l(String(A.int),10);else if(A.bigint!=null)q=A.bigint;else throw new Error("wrong parameter");return this.hV=N(q),this.hV},P!=null&&(this.params=P)},wt(B.asn1.DERInteger,B.asn1.ASN1Object),B.asn1.DERBitString=function(P){if(P!==void 0&&typeof P.obj<"u"){var N=B.asn1.ASN1Util.newObject(P.obj);P.hex="00"+N.tohex()}B.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(A){this.hTLV=null,this.isModified=!0,this.hV=A},this.setUnusedBitsAndHexValue=function(A,q){if(A<0||7<A)throw"unused bits shall be from 0 to 7: u = "+A;var H="0"+A;this.hTLV=null,this.isModified=!0,this.hV=H+q},this.setByBinaryString=function(A){A=A.replace(/0+$/,"");var q=8-A.length%8;q==8&&(q=0),A+="0000000".substr(0,q);for(var H="",U=0;U<A.length-1;U+=8){var Q=A.substr(U,8),J=parseInt(Q,2).toString(16);J.length==1&&(J="0"+J),H+=J}this.hTLV=null,this.isModified=!0,this.hV="0"+q+H},this.setByBooleanArray=function(A){for(var q="",H=0;H<A.length;H++)A[H]==!0?q+="1":q+="0";this.setByBinaryString(q)},this.newFalseArray=function(A){for(var q=new Array(A),H=0;H<A;H++)q[H]=!1;return q},this.getFreshValueHex=function(){return this.hV},typeof P<"u"&&(typeof P=="string"&&P.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(P):typeof P.hex<"u"?this.setHexValueIncludingUnusedBits(P.hex):typeof P.bin<"u"?this.setByBinaryString(P.bin):typeof P.array<"u"&&this.setByBooleanArray(P.array))},wt(B.asn1.DERBitString,B.asn1.ASN1Object),B.asn1.DEROctetString=function(P){if(P!==void 0&&typeof P.obj<"u"){var N=B.asn1.ASN1Util.newObject(P.obj);P.hex=N.tohex()}B.asn1.DEROctetString.superclass.constructor.call(this,P),this.hT="04"},wt(B.asn1.DEROctetString,B.asn1.DERAbstractString),B.asn1.DERNull=function(){B.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},wt(B.asn1.DERNull,B.asn1.ASN1Object),B.asn1.DERObjectIdentifier=function(P){B.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(N){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=N},this.setValueOidString=function(N){var A=yy(N);if(A==null)throw new Error("malformed oid string: "+N);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=A},this.setValueName=function(N){var A=B.asn1.x509.OID.name2oid(N);if(A!=="")this.setValueOidString(A);else throw new Error("DERObjectIdentifier oidName undefined: "+N)},this.setValueNameOrOid=function(N){N.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(N):this.setValueName(N)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(N){typeof N=="string"?this.setValueNameOrOid(N):N.oid!==void 0?this.setValueNameOrOid(N.oid):N.name!==void 0?this.setValueNameOrOid(N.name):N.hex!==void 0&&this.setValueHex(N.hex)},P!==void 0&&this.setByParam(P)},wt(B.asn1.DERObjectIdentifier,B.asn1.ASN1Object),B.asn1.DEREnumerated=function(P){B.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(N){this.hTLV=null,this.isModified=!0,this.hV=Hc(N)},this.setByInteger=function(N){var A=new l(String(N),10);this.setByBigInteger(A)},this.setValueHex=function(N){this.hV=N},this.getFreshValueHex=function(){return this.hV},typeof P<"u"&&(typeof P.int<"u"?this.setByInteger(P.int):typeof P=="number"?this.setByInteger(P):typeof P.hex<"u"&&this.setValueHex(P.hex))},wt(B.asn1.DEREnumerated,B.asn1.ASN1Object),B.asn1.DERUTF8String=function(P){B.asn1.DERUTF8String.superclass.constructor.call(this,P),this.hT="0c"},wt(B.asn1.DERUTF8String,B.asn1.DERAbstractString),B.asn1.DERNumericString=function(P){B.asn1.DERNumericString.superclass.constructor.call(this,P),this.hT="12"},wt(B.asn1.DERNumericString,B.asn1.DERAbstractString),B.asn1.DERPrintableString=function(P){B.asn1.DERPrintableString.superclass.constructor.call(this,P),this.hT="13"},wt(B.asn1.DERPrintableString,B.asn1.DERAbstractString),B.asn1.DERTeletexString=function(P){B.asn1.DERTeletexString.superclass.constructor.call(this,P),this.hT="14"},wt(B.asn1.DERTeletexString,B.asn1.DERAbstractString),B.asn1.DERIA5String=function(P){B.asn1.DERIA5String.superclass.constructor.call(this,P),this.hT="16"},wt(B.asn1.DERIA5String,B.asn1.DERAbstractString),B.asn1.DERVisibleString=function(P){B.asn1.DERIA5String.superclass.constructor.call(this,P),this.hT="1a"},wt(B.asn1.DERVisibleString,B.asn1.DERAbstractString),B.asn1.DERBMPString=function(P){B.asn1.DERBMPString.superclass.constructor.call(this,P),this.hT="1e"},wt(B.asn1.DERBMPString,B.asn1.DERAbstractString),B.asn1.DERUTCTime=function(P){B.asn1.DERUTCTime.superclass.constructor.call(this,P),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var N=this.params;if(this.params==null&&(N={date:new Date}),typeof N=="string")if(N.match(/^[0-9]{12}Z$/)||N.match(/^[0-9]{12}\.[0-9]+Z$/))this.hV=Lt(N);else throw new Error("malformed string for UTCTime: "+N);else if(N.str!=null)this.hV=Lt(N.str);else if(N.date==null&&N.millis==!0){var A=new Date;this.hV=Lt(this.formatDate(A,"utc",!0))}else if(N.date!=null&&N.date instanceof Date){var q=N.millis===!0;this.hV=Lt(this.formatDate(N.date,"utc",q))}else N instanceof Date&&(this.hV=Lt(this.formatDate(N,"utc")));if(this.hV==null)throw new Error("parameter not specified properly for UTCTime");return this.hV},P!=null&&this.setByParam(P)},wt(B.asn1.DERUTCTime,B.asn1.DERAbstractTime),B.asn1.DERGeneralizedTime=function(P){B.asn1.DERGeneralizedTime.superclass.constructor.call(this,P),this.hT="18",this.params=P,this.getFreshValueHex=function(){var N=this.params;if(this.params==null&&(N={date:new Date}),typeof N=="string")if(N.match(/^[0-9]{14}Z$/)||N.match(/^[0-9]{14}\.[0-9]+Z$/))this.hV=Lt(N);else throw new Error("malformed string for GeneralizedTime: "+N);else if(N.str!=null)this.hV=Lt(N.str);else if(N.date==null&&N.millis==!0){var A=new Date;this.hV=Lt(this.formatDate(A,"gen",!0))}else if(N.date!=null&&N.date instanceof Date){var q=N.millis===!0;this.hV=Lt(this.formatDate(N.date,"gen",q))}else N instanceof Date&&(this.hV=Lt(this.formatDate(N,"gen")));if(this.hV==null)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},P!=null&&this.setByParam(P)},wt(B.asn1.DERGeneralizedTime,B.asn1.DERAbstractTime),B.asn1.DERSequence=function(P){B.asn1.DERSequence.superclass.constructor.call(this,P),this.hT="30",this.getFreshValueHex=function(){for(var N="",A=0;A<this.asn1Array.length;A++){var q=this.asn1Array[A];N+=q.tohex()}return this.hV=N,this.hV}},wt(B.asn1.DERSequence,B.asn1.DERAbstractStructured),B.asn1.DERSet=function(P){B.asn1.DERSet.superclass.constructor.call(this,P),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var N=new Array,A=0;A<this.asn1Array.length;A++){var q=this.asn1Array[A];N.push(q.tohex())}return this.sortFlag==!0&&N.sort(),this.hV=N.join(""),this.hV},typeof P<"u"&&typeof P.sortflag<"u"&&P.sortflag==!1&&(this.sortFlag=!1)},wt(B.asn1.DERSet,B.asn1.DERAbstractStructured),B.asn1.DERTaggedObject=function(P){B.asn1.DERTaggedObject.superclass.constructor.call(this);var N=B.asn1,A=dt,q=A.getV;A.isASN1HEX;var H=N.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(U,Q,J){this.params={tag:Q,explicit:U,obj:J}},this.getFreshValueHex=function(){var U=this.params;if(U.explicit==null&&(U.explicit=!0),U.tage!=null&&(U.tag=U.tage,U.explicit=!0),U.tagi!=null&&(U.tag=U.tagi,U.explicit=!1),U.str!=null)this.hV=zc(U.str);else if(U.hex!=null)this.hV=U.hex;else if(U.obj!=null){var Q;U.obj instanceof N.ASN1Object?Q=U.obj.tohex():typeof U.obj=="object"&&(Q=H(U.obj).tohex()),U.explicit?this.hV=Q:this.hV=q(Q,0)}else throw new Error("str, hex nor obj not specified");return U.tag==null&&(U.tag="a0"),this.hT=U.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(U){this.params=U},P!==void 0&&this.setByParam(P)},wt(B.asn1.DERTaggedObject,B.asn1.ASN1Object);var dt=new function(){};dt.getLblen=function(P,N){if(P.substr(N+2,1)!="8")return 1;var A=parseInt(P.substr(N+3,1));return A==0?-1:0<A&&A<10?A+1:-2},dt.getL=function(P,N){var A=dt.getLblen(P,N);return A<1?"":P.substr(N+2,A*2)},dt.getVblen=function(P,N){var A,q;return A=dt.getL(P,N),A==""?-1:(A.substr(0,1)==="8"?q=new l(A.substr(2),16):q=new l(A,16),q.intValue())},dt.getVidx=function(P,N){var A=dt.getLblen(P,N);return A<0?A:N+(A+1)*2},dt.getV=function(P,N){var A=dt.getVidx(P,N),q=dt.getVblen(P,N);return P.substr(A,q*2)},dt.getTLV=function(P,N){return P.substr(N,2)+dt.getL(P,N)+dt.getV(P,N)},dt.getTLVblen=function(P,N){return 2+dt.getLblen(P,N)*2+dt.getVblen(P,N)*2},dt.getNextSiblingIdx=function(P,N){var A=dt.getVidx(P,N),q=dt.getVblen(P,N);return A+q*2},dt.getChildIdx=function(P,N){var A=dt,q=[],H,U,Q;H=A.getVidx(P,N),U=A.getVblen(P,N)*2,P.substr(N,2)=="03"&&(H+=2,U-=2),Q=0;for(var J=H;Q<=U;){var ae=A.getTLVblen(P,J);if(Q+=ae,Q<=U&&q.push(J),J+=ae,Q>=U)break}return q},dt.getNthChildIdx=function(P,N,A){var q=dt.getChildIdx(P,N);return q[A]},dt.getIdxbyList=function(P,N,A,q){var H=dt,U,Q;return A.length==0?q!==void 0&&P.substr(N,2)!==q?-1:N:(U=A.shift(),Q=H.getChildIdx(P,N),U>=Q.length?-1:H.getIdxbyList(P,Q[U],A,q))},dt.getIdxbyListEx=function(P,N,A,q){var H=dt,U,Q;if(A.length==0)return q!==void 0&&P.substr(N,2)!==q?-1:N;U=A.shift(),Q=H.getChildIdx(P,N);for(var J=0,ae=0;ae<Q.length;ae++){var te=P.substr(Q[ae],2);if(typeof U=="number"&&!H.isContextTag(te)&&J==U||typeof U=="string"&&H.isContextTag(te,U))return H.getIdxbyListEx(P,Q[ae],A,q);H.isContextTag(te)||J++}return-1},dt.getTLVbyList=function(P,N,A,q){var H=dt,U=H.getIdxbyList(P,N,A,q);return U==-1||U>=P.length?null:H.getTLV(P,U)},dt.getTLVbyListEx=function(P,N,A,q){var H=dt,U=H.getIdxbyListEx(P,N,A,q);return U==-1?null:H.getTLV(P,U)},dt.getVbyList=function(P,N,A,q,H){var U=dt,Q,J;return Q=U.getIdxbyList(P,N,A,q),Q==-1||Q>=P.length?null:(J=U.getV(P,Q),H===!0&&(J=J.substr(2)),J)},dt.getVbyListEx=function(P,N,A,q,H){var U=dt,Q,J;return Q=U.getIdxbyListEx(P,N,A,q),Q==-1?null:(J=U.getV(P,Q),P.substr(Q,2)=="03"&&H!==!1&&(J=J.substr(2)),J)},dt.getInt=function(P,N,A){A==null&&(A=-1);try{var q=P.substr(N,2);if(q!="02"&&q!="03")return A;var H=dt.getV(P,N);return q=="02"?parseInt(H,16):vy(H)}catch{return A}},dt.getOID=function(P,N,A){A==null&&(A=null);try{if(P.substr(N,2)!="06")return A;var q=dt.getV(P,N);return by(q)}catch{return A}},dt.getOIDName=function(P,N,A){A==null&&(A=null);try{var q=dt.getOID(P,N,A);if(q==A)return A;var H=B.asn1.x509.OID.oid2name(q);return H==""?q:H}catch{return A}},dt.getString=function(P,N,A){A==null&&(A=null);try{var q=dt.getV(P,N);return lr(q)}catch{return A}},dt.hextooidstr=function(P){var N=function(ce,W){return ce.length>=W?ce:new Array(W-ce.length+1).join("0")+ce},A=[],q=P.substr(0,2),H=parseInt(q,16);A[0]=new String(Math.floor(H/40)),A[1]=new String(H%40);for(var U=P.substr(2),Q=[],J=0;J<U.length/2;J++)Q.push(parseInt(U.substr(J*2,2),16));for(var ae=[],te="",J=0;J<Q.length;J++)Q[J]&128?te=te+N((Q[J]&127).toString(2),7):(te=te+N((Q[J]&127).toString(2),7),ae.push(new String(parseInt(te,2))),te="");var le=A.join(".");return ae.length>0&&(le=le+"."+ae.join(".")),le},dt.dump=function(P,N,A,q){var H=dt,U=H.getV,Q=H.dump,J=H.getChildIdx,ae=P;P instanceof B.asn1.ASN1Object&&(ae=P.tohex());var te=function(Ie,Ae){if(Ie.length<=Ae*2)return Ie;var Te=Ie.substr(0,Ae)+"..(total "+Ie.length/2+"bytes).."+Ie.substr(Ie.length-Ae,Ae);return Te};N===void 0&&(N={ommit_long_octet:32}),A===void 0&&(A=0),q===void 0&&(q="");var le=N.ommit_long_octet,it=ae.substr(A,2);if(it=="01"){var ce=U(ae,A);return ce=="00"?q+`BOOLEAN FALSE
`:q+`BOOLEAN TRUE
`}if(it=="02"){var ce=U(ae,A);return q+"INTEGER "+te(ce,le)+`
`}if(it=="03"){var ce=U(ae,A);if(H.isASN1HEX(ce.substr(2))){var W=q+`BITSTRING, encapsulates
`;return W=W+Q(ce.substr(2),N,0,q+"  "),W}else return q+"BITSTRING "+te(ce,le)+`
`}if(it=="04"){var ce=U(ae,A);if(H.isASN1HEX(ce)){var W=q+`OCTETSTRING, encapsulates
`;return W=W+Q(ce,N,0,q+"  "),W}else return q+"OCTETSTRING "+te(ce,le)+`
`}if(it=="05")return q+`NULL
`;if(it=="06"){var ne=U(ae,A),X=B.asn1.ASN1Util.oidHexToInt(ne),ie=B.asn1.x509.OID.oid2name(X),ue=X.replace(/\./g," ");return ie!=""?q+"ObjectIdentifier "+ie+" ("+ue+`)
`:q+"ObjectIdentifier ("+ue+`)
`}if(it=="0a")return q+"ENUMERATED "+parseInt(U(ae,A))+`
`;if(it=="0c")return q+"UTF8String '"+Ln(U(ae,A))+`'
`;if(it=="13")return q+"PrintableString '"+Ln(U(ae,A))+`'
`;if(it=="14")return q+"TeletexString '"+Ln(U(ae,A))+`'
`;if(it=="16")return q+"IA5String '"+Ln(U(ae,A))+`'
`;if(it=="17")return q+"UTCTime "+Ln(U(ae,A))+`
`;if(it=="18")return q+"GeneralizedTime "+Ln(U(ae,A))+`
`;if(it=="1a")return q+"VisualString '"+Ln(U(ae,A))+`'
`;if(it=="1e")return q+"BMPString '"+Rb(U(ae,A))+`'
`;if(it=="30"){if(ae.substr(A,4)=="3000")return q+`SEQUENCE {}
`;var W=q+`SEQUENCE
`,ve=J(ae,A),ze=N;if((ve.length==2||ve.length==3)&&ae.substr(ve[0],2)=="06"&&ae.substr(ve[ve.length-1],2)=="04"){var ie=H.oidname(U(ae,ve[0])),tt=JSON.parse(JSON.stringify(N));tt.x509ExtName=ie,ze=tt}for(var nt=0;nt<ve.length;nt++)W=W+Q(ae,ze,ve[nt],q+"  ");return W}if(it=="31"){for(var W=q+`SET
`,ve=J(ae,A),nt=0;nt<ve.length;nt++)W=W+Q(ae,N,ve[nt],q+"  ");return W}var it=parseInt(it,16);if((it&128)!=0){var _e=it&31;if((it&32)!=0){for(var W=q+"["+_e+`]
`,ve=J(ae,A),nt=0;nt<ve.length;nt++)W=W+Q(ae,N,ve[nt],q+"  ");return W}else{var ce=U(ae,A);if(dt.isASN1HEX(ce)){var W=q+"["+_e+`]
`;return W=W+Q(ce,N,0,q+"  "),W}else(ce.substr(0,8)=="68747470"||N.x509ExtName==="subjectAltName"&&_e==2)&&(ce=Ln(ce));var W=q+"["+_e+"] "+ce+`
`;return W}}return q+"UNKNOWN("+it+") "+U(ae,A)+`
`},dt.parse=function(P){var N=dt,A=N.parse,q=N.isASN1HEX,H=N.getV,U=N.getTLV,Q=N.getChildIdx,J=B.asn1,ae=J.ASN1Util.oidHexToInt,te=J.x509.OID.oid2name,le=Ln,ce=Rb,W=Td,ne={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},X=function(Te){for(var Be=[],rt=Q(Te,0),ct=0;ct<rt.length;ct++){var Tt=rt[ct],st=U(Te,Tt),yt=A(st);Be.push(yt)}return Be},ie=P.substr(0,2),ue={},ve=H(P,0);if(ie=="01")return P=="0101ff"?{bool:!0}:{bool:!1};if(ie=="02")return{int:{hex:ve}};if(ie=="03")try{if(ve.substr(0,2)!="00")throw"not encap";var ze=ve.substr(2);if(!q(ze))throw"not encap";return{bitstr:{obj:A(ze)}}}catch{var tt=null;return ve.length<=10&&(tt=nc(ve)),tt==null?{bitstr:{hex:ve}}:{bitstr:{bin:tt}}}else if(ie=="04")try{if(!q(ve))throw"not encap";return{octstr:{obj:A(ve)}}}catch{return{octstr:{hex:ve}}}else{if(ie=="05")return{null:""};if(ie=="06"){var nt=ae(ve),it=te(nt);return it==""?{oid:nt}:{oid:it}}else{if(ie=="0a")return ve.length>4?{enum:{hex:ve}}:{enum:parseInt(ve,16)};if(ie=="30"||ie=="31")return ue[ne[ie]]=X(P),ue;if(ie=="14"){var _e=W(ve);return ue[ne[ie]]={str:_e},ue}else if(ie=="1e"){var _e=ce(ve);return ue[ne[ie]]={str:_e},ue}else if(":0c:12:13:16:17:18:1a:".indexOf(ie)!=-1){var _e=le(ve);return ue[ne[ie]]={str:_e},ue}else if(ie.match(/^8[0-9]$/)){var _e=le(ve);return _e==null|_e==""?{tag:{tag:ie,explicit:!1,hex:ve}}:_e.match(/[\x00-\x1F\x7F-\x9F]/)!=null||_e.match(/[\u0000-\u001F\u0080\u009F]/)!=null?{tag:{tag:ie,explicit:!1,hex:ve}}:{tag:{tag:ie,explicit:!1,str:_e}}}else if(ie.match(/^a[0-9]$/))try{if(!q(ve))throw new Error("not encap");return{tag:{tag:ie,explicit:!0,obj:A(ve)}}}catch{return{tag:{tag:ie,explicit:!0,hex:ve}}}else{var Ie=new B.asn1.ASN1Object;Ie.hV=ve;var Ae=Ie.getLengthHexFromValue();return{asn1:{tlv:ie+Ae+ve}}}}}},dt.isContextTag=function(P,N){P=P.toLowerCase();var A,q;try{A=parseInt(P,16)}catch{return-1}if(N===void 0)return(A&192)==128;try{var H=N.match(/^\[[0-9]+\]$/);return H==null||(q=parseInt(N.substr(1,N.length-1),10),q>31)?!1:(A&192)==128&&(A&31)==q}catch{return!1}},dt.isASN1HEX=function(P){var N=dt;if(P.length%2==1)return!1;var A=N.getVblen(P,0),q=P.substr(0,2),H=N.getL(P,0),U=P.length-q.length-H.length;return U==A*2},dt.checkStrictDER=function(P,N,A,q,H){var U=dt;if(A===void 0){if(typeof P!="string")throw new Error("not hex string");if(P=P.toLowerCase(),!B.lang.String.isHex(P))throw new Error("not hex string");A=P.length,q=P.length/2,q<128?H=1:H=Math.ceil(q.toString(16))+1}var Q=U.getL(P,N);if(Q.length>H*2)throw new Error("L of TLV too long: idx="+N);var J=U.getVblen(P,N);if(J>q)throw new Error("value of L too long than hex: idx="+N);var ae=U.getTLV(P,N),te=ae.length-2-U.getL(P,N).length;if(te!==J*2)throw new Error("V string length and L's value not the same:"+te+"/"+J*2);if(N===0&&P.length!=ae.length)throw new Error("total length and TLV length unmatch:"+P.length+"!="+ae.length);var le=P.substr(N,2);if(le==="02"){var ce=U.getVidx(P,N);if(P.substr(ce,2)=="00"&&P.charCodeAt(ce+2)<56)throw new Error("not least zeros for DER INTEGER")}if(parseInt(le,16)&32){for(var W=U.getVblen(P,N),ne=0,X=U.getChildIdx(P,N),ie=0;ie<X.length;ie++){var ue=U.getTLV(P,X[ie]);ne+=ue.length,U.checkStrictDER(P,X[ie],A,q,H)}if(W*2!=ne)throw new Error("sum of children's TLV length and L unmatch: "+W*2+"!="+ne)}},dt.oidname=function(P){var N=B.asn1;B.lang.String.isHex(P)&&(P=N.ASN1Util.oidHexToInt(P));var A=N.x509.OID.oid2name(P);return A===""&&(A=P),A},(typeof B>"u"||!B)&&(B={}),(typeof B.asn1>"u"||!B.asn1)&&(B.asn1={}),(typeof B.asn1.x509>"u"||!B.asn1.x509)&&(B.asn1.x509={}),B.asn1.x509.Certificate=function(P){B.asn1.x509.Certificate.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERBitString,H=A.DERSequence,U=A.x509,Q=U.TBSCertificate,J=U.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(ae){this.params=ae},this.sign=function(){var ae=this.params,te=ae.sigalg;ae.sigalg.name!=null&&(te=ae.sigalg.name);var le=ae.tbsobj.tohex(),ce=new B.crypto.Signature({alg:te});ce.init(ae.cakey),ce.updateHex(le),ae.sighex=ce.sign()},this.getPEM=function(){return Yn(this.tohex(),"CERTIFICATE")},this.tohex=function(){var ae=this.params;if((ae.tbsobj==null||ae.tbsobj==null)&&(ae.tbsobj=new Q(ae)),ae.sighex==null&&ae.cakey!=null&&this.sign(),ae.sighex==null)throw new Error("sighex or cakey parameter not defined");var te=[];te.push(ae.tbsobj),te.push(new J({name:ae.sigalg})),te.push(new q({hex:"00"+ae.sighex}));var le=new H({array:te});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&(this.params=P)},wt(B.asn1.x509.Certificate,B.asn1.ASN1Object),B.asn1.x509.TBSCertificate=function(P){B.asn1.x509.TBSCertificate.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.x509,H=A.DERTaggedObject,U=A.DERInteger,Q=A.DERSequence,J=q.AlgorithmIdentifier,ae=q.Time,te=q.X500Name,le=q.Extensions,ce=q.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(W){this.params=W},this.tohex=function(){var W=[],ne=this.params;if(ne.version!=null||ne.version!=1){var X=2;ne.version!=null&&(X=ne.version-1);var ie=new H({obj:new U({int:X})});W.push(ie)}W.push(new U(ne.serial)),W.push(new J({name:ne.sigalg})),W.push(new te(ne.issuer)),W.push(new Q({array:[new ae(ne.notbefore),new ae(ne.notafter)]})),W.push(new te(ne.subject)),W.push(new ce(Cn.getKey(ne.sbjpubkey))),ne.ext!==void 0&&ne.ext.length>0&&W.push(new H({tag:"a3",obj:new le(ne.ext)}));var ue=new B.asn1.DERSequence({array:W});return ue.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.TBSCertificate,B.asn1.ASN1Object),B.asn1.x509.Extensions=function(P){B.asn1.x509.Extensions.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERSequence,H=A.x509;this.aParam=[],this.setByParam=function(U){this.aParam=U},this.tohex=function(){for(var U=[],Q=0;Q<this.aParam.length;Q++){var J=this.aParam[Q],ae=J.extname,te=null;if(J.extn!=null)te=new H.PrivateExtension(J);else if(ae=="subjectKeyIdentifier")te=new H.SubjectKeyIdentifier(J);else if(ae=="keyUsage")te=new H.KeyUsage(J);else if(ae=="subjectAltName")te=new H.SubjectAltName(J);else if(ae=="issuerAltName")te=new H.IssuerAltName(J);else if(ae=="basicConstraints")te=new H.BasicConstraints(J);else if(ae=="nameConstraints")te=new H.NameConstraints(J);else if(ae=="cRLDistributionPoints")te=new H.CRLDistributionPoints(J);else if(ae=="certificatePolicies")te=new H.CertificatePolicies(J);else if(ae=="policyMappings")te=new H.PolicyMappings(J);else if(ae=="policyConstraints")te=new H.PolicyConstraints(J);else if(ae=="inhibitAnyPolicy")te=new H.InhibitAnyPolicy(J);else if(ae=="authorityKeyIdentifier")te=new H.AuthorityKeyIdentifier(J);else if(ae=="extKeyUsage")te=new H.ExtKeyUsage(J);else if(ae=="authorityInfoAccess")te=new H.AuthorityInfoAccess(J);else if(ae=="cRLNumber")te=new H.CRLNumber(J);else if(ae=="cRLReason")te=new H.CRLReason(J);else if(ae=="ocspNonce")te=new H.OCSPNonce(J);else if(ae=="ocspNoCheck")te=new H.OCSPNoCheck(J);else if(ae=="adobeTimeStamp")te=new H.AdobeTimeStamp(J);else if(ae=="subjectDirectoryAttributes")te=new H.SubjectDirectoryAttributes(J);else throw new Error("extension not supported:"+JSON.stringify(J));te!=null&&U.push(te)}var le=new q({array:U});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.x509.Extensions,B.asn1.ASN1Object),B.asn1.x509.Extension=function(P){B.asn1.x509.Extension.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERObjectIdentifier,H=A.DEROctetString;A.DERBitString;var U=A.DERBoolean,Q=A.DERSequence;this.tohex=function(){var J=new q({oid:this.oid}),ae=new H({hex:this.getExtnValueHex()}),te=new Array;te.push(J),this.critical&&te.push(new U),te.push(ae);var le=new Q({array:te});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,P!==void 0&&P.critical!==void 0&&(this.critical=P.critical)},wt(B.asn1.x509.Extension,B.asn1.ASN1Object),B.asn1.x509.KeyUsage=function(P){B.asn1.x509.KeyUsage.superclass.constructor.call(this,P);var N=Error,A={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var q=this.getBinValue();return this.asn1ExtnValue=new B.asn1.DERBitString({bin:q}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var q=this.params;if(typeof q!="object"||typeof q.names!="object"&&typeof q.bin!="string")throw new N("parameter not yet set");if(q.names!=null)return Fd(q.names,A);if(q.bin!=null)return q.bin;throw new N("parameter not set properly")},this.oid="2.5.29.15",P!==void 0&&(this.params=P)},wt(B.asn1.x509.KeyUsage,B.asn1.x509.Extension),B.asn1.x509.BasicConstraints=function(P){B.asn1.x509.BasicConstraints.superclass.constructor.call(this,P);var N=B.asn1,A=N.DERBoolean,q=N.DERInteger,H=N.DERSequence;this.getExtnValueHex=function(){var U=new Array;this.cA&&U.push(new A),this.pathLen>-1&&U.push(new q({int:this.pathLen}));var Q=new H({array:U});return this.asn1ExtnValue=Q,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,P!==void 0&&(P.cA!==void 0&&(this.cA=P.cA),P.pathLen!==void 0&&(this.pathLen=P.pathLen))},wt(B.asn1.x509.BasicConstraints,B.asn1.x509.Extension),B.asn1.x509.CRLDistributionPoints=function(P){B.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,P);var N=B,A=N.asn1,q=A.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(H){for(var U=[],Q=0;Q<H.length;Q++)if(H[Q]instanceof B.asn1.ASN1Object)U.push(H[Q]);else{var J=new q.DistributionPoint(H[Q]);U.push(J)}this.asn1ExtnValue=new A.DERSequence({array:U})},this.setByOneURI=function(H){var U=new q.DistributionPoint({fulluri:H});this.setByDPArray([U])},this.oid="2.5.29.31",P!==void 0&&(P.array!==void 0?this.setByDPArray(P.array):P.uri!==void 0&&this.setByOneURI(P.uri))},wt(B.asn1.x509.CRLDistributionPoints,B.asn1.x509.Extension),B.asn1.x509.DistributionPoint=function(P){B.asn1.x509.DistributionPoint.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.x509.DistributionPointName;this.tohex=function(){var H=new A.DERSequence;if(this.asn1DP!=null){var U=new A.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});H.appendASN1Object(U)}return this.hTLV=H.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&(P.dpobj!==void 0?this.asn1DP=P.dpobj:P.dpname!==void 0?this.asn1DP=new q(P.dpname):P.fulluri!==void 0&&(this.asn1DP=new q({full:[{uri:P.fulluri}]})))},wt(B.asn1.x509.DistributionPoint,B.asn1.ASN1Object),B.asn1.x509.DistributionPointName=function(P){B.asn1.x509.DistributionPointName.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERTaggedObject;if(this.tohex=function(){if(this.type!="full")throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new q({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0)if(A.x509.GeneralNames.prototype.isPrototypeOf(P))this.type="full",this.tag="a0",this.asn1V=P;else if(P.full!==void 0)this.type="full",this.tag="a0",this.asn1V=new A.x509.GeneralNames(P.full);else throw new Error("This class supports GeneralNames only as argument")},wt(B.asn1.x509.DistributionPointName,B.asn1.ASN1Object),B.asn1.x509.CertificatePolicies=function(P){B.asn1.x509.CertificatePolicies.superclass.constructor.call(this,P);var N=B,A=N.asn1,q=A.x509,H=A.DERSequence,U=q.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var Q=[],J=0;J<this.params.array.length;J++)Q.push(new U(this.params.array[J]));var ae=new H({array:Q});return this.asn1ExtnValue=ae,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",P!==void 0&&(this.params=P)},wt(B.asn1.x509.CertificatePolicies,B.asn1.x509.Extension),B.asn1.x509.PolicyInformation=function(P){B.asn1.x509.PolicyInformation.superclass.constructor.call(this,P);var N=B.asn1,A=N.DERSequence,q=N.DERObjectIdentifier,H=N.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(this.params.policyoid===void 0&&this.params.array===void 0)throw new Error("parameter oid and array missing");var U=[new q(this.params.policyoid)];if(this.params.array!==void 0){for(var Q=[],J=0;J<this.params.array.length;J++)Q.push(new H(this.params.array[J]));Q.length>0&&U.push(new A({array:Q}))}var ae=new A({array:U});return ae.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&(this.params=P)},wt(B.asn1.x509.PolicyInformation,B.asn1.ASN1Object),B.asn1.x509.PolicyQualifierInfo=function(P){B.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,P);var N=B.asn1,A=N.DERSequence,q=N.DERIA5String,H=N.DERObjectIdentifier,U=N.x509.UserNotice;this.params=null,this.tohex=function(){if(this.params.cps!==void 0){var Q=new A({array:[new H({oid:"1.3.6.1.5.5.7.2.1"}),new q({str:this.params.cps})]});return Q.tohex()}if(this.params.unotice!=null){var Q=new A({array:[new H({oid:"1.3.6.1.5.5.7.2.2"}),new U(this.params.unotice)]});return Q.tohex()}},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&(this.params=P)},wt(B.asn1.x509.PolicyQualifierInfo,B.asn1.ASN1Object),B.asn1.x509.UserNotice=function(P){B.asn1.x509.UserNotice.superclass.constructor.call(this,P);var N=B.asn1.DERSequence;B.asn1.DERInteger;var A=B.asn1.x509.DisplayText,q=B.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var H=[];this.params.noticeref!==void 0&&H.push(new q(this.params.noticeref)),this.params.exptext!==void 0&&H.push(new A(this.params.exptext));var U=new N({array:H});return U.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&(this.params=P)},wt(B.asn1.x509.UserNotice,B.asn1.ASN1Object),B.asn1.x509.NoticeReference=function(P){B.asn1.x509.NoticeReference.superclass.constructor.call(this,P);var N=B.asn1.DERSequence,A=B.asn1.DERInteger,q=B.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var H=[];if(this.params.org!==void 0&&H.push(new q(this.params.org)),this.params.noticenum!==void 0){for(var U=[],Q=this.params.noticenum,J=0;J<Q.length;J++)U.push(new A(Q[J]));H.push(new N({array:U}))}if(H.length==0)throw new Error("parameter is empty");var ae=new N({array:H});return ae.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&(this.params=P)},wt(B.asn1.x509.NoticeReference,B.asn1.ASN1Object),B.asn1.x509.DisplayText=function(P){B.asn1.x509.DisplayText.superclass.constructor.call(this,P),this.hT="0c",P!==void 0&&(P.type==="ia5"?this.hT="16":P.type==="vis"?this.hT="1a":P.type==="bmp"&&(this.hT="1e"))},wt(B.asn1.x509.DisplayText,B.asn1.DERAbstractString),B.asn1.x509.PolicyMappings=function(P){B.asn1.x509.PolicyMappings.superclass.constructor.call(this,P);var N=B,A=N.asn1;A.x509;var q=A.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var H=this.params,U=[],Q=0;Q<H.array.length;Q++){var J=H.array[Q];U.push({seq:[{oid:J[0]},{oid:J[1]}]})}return this.asn1ExtnValue=q({seq:U}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",P!==void 0&&(this.params=P)},wt(B.asn1.x509.PolicyMappings,B.asn1.x509.Extension),B.asn1.x509.PolicyConstraints=function(P){B.asn1.x509.PolicyConstraints.superclass.constructor.call(this,P);var N=B,A=N.asn1;A.x509;var q=A.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var H=this.params,U=[];return H.reqexp!=null&&U.push({tag:{tagi:"80",obj:{int:H.reqexp}}}),H.inhibit!=null&&U.push({tag:{tagi:"81",obj:{int:H.inhibit}}}),this.asn1ExtnValue=q({seq:U}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",P!==void 0&&(this.params=P)},wt(B.asn1.x509.PolicyConstraints,B.asn1.x509.Extension),B.asn1.x509.InhibitAnyPolicy=function(P){B.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,P);var N=B,A=N.asn1;A.x509;var q=A.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=q({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",P!==void 0&&(this.params=P)},wt(B.asn1.x509.InhibitAnyPolicy,B.asn1.x509.Extension),B.asn1.x509.NameConstraints=function(P){B.asn1.x509.NameConstraints.superclass.constructor.call(this,P);var N=B,A=N.asn1,q=A.x509,H=A.ASN1Util.newObject,U=q.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var Q=this.params,J=[];if(Q.permit!=null&&Q.permit.length!=null){for(var ae=[],te=0;te<Q.permit.length;te++)ae.push(new U(Q.permit[te]));J.push({tag:{tagi:"a0",obj:{seq:ae}}})}if(Q.exclude!=null&&Q.exclude.length!=null){for(var le=[],te=0;te<Q.exclude.length;te++)le.push(new U(Q.exclude[te]));J.push({tag:{tagi:"a1",obj:{seq:le}}})}return this.asn1ExtnValue=H({seq:J}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",P!==void 0&&(this.params=P)},wt(B.asn1.x509.NameConstraints,B.asn1.x509.Extension),B.asn1.x509.GeneralSubtree=function(P){B.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var N=B.asn1,A=N.x509,q=A.GeneralName,H=N.ASN1Util.newObject;this.params=null,this.setByParam=function(U){this.params=U},this.tohex=function(){var U=this.params,Q=[new q(U)];U.min!=null&&Q.push({tag:{tagi:"80",obj:{int:U.min}}}),U.max!=null&&Q.push({tag:{tagi:"81",obj:{int:U.max}}});var J=H({seq:Q});return J.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.GeneralSubtree,B.asn1.ASN1Object),B.asn1.x509.ExtKeyUsage=function(P){B.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,P);var N=B,A=N.asn1;this.setPurposeArray=function(q){this.asn1ExtnValue=new A.DERSequence;for(var H=0;H<q.length;H++){var U=new A.DERObjectIdentifier(q[H]);this.asn1ExtnValue.appendASN1Object(U)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",P!==void 0&&P.array!==void 0&&this.setPurposeArray(P.array)},wt(B.asn1.x509.ExtKeyUsage,B.asn1.x509.Extension),B.asn1.x509.AuthorityKeyIdentifier=function(P){B.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,P);var N=B,A=N.asn1,q=A.DERTaggedObject,H=A.x509.GeneralNames;N.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var U=new Array;this.asn1KID&&U.push(new q({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&U.push(new q({explicit:!1,tag:"a1",obj:new H([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&U.push(new q({explicit:!1,tag:"82",obj:this.asn1CertSN}));var Q=new A.DERSequence({array:U});return this.asn1ExtnValue=Q,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(U){if(U.str!==void 0||U.hex!==void 0)this.asn1KID=new B.asn1.DEROctetString(U);else if(typeof U=="object"&&B.crypto.Util.isKey(U)||typeof U=="string"&&U.indexOf("BEGIN ")!=-1){var Q=U;typeof U=="string"&&(Q=Cn.getKey(U));var J=Cn.getKeyID(Q);this.asn1KID=new B.asn1.DEROctetString({hex:J})}},this.setCertIssuerByParam=function(U){U.str!==void 0||U.ldapstr!==void 0||U.hex!==void 0||U.certsubject!==void 0||U.certissuer!==void 0?this.asn1CertIssuer=new B.asn1.x509.X500Name(U):typeof U=="string"&&U.indexOf("BEGIN ")!=-1&&U.indexOf("CERTIFICATE")!=-1&&(this.asn1CertIssuer=new B.asn1.x509.X500Name({certissuer:U}))},this.setCertSNByParam=function(U){if(U.str!==void 0||U.bigint!==void 0||U.hex!==void 0)this.asn1CertSN=new B.asn1.DERInteger(U);else if(typeof U=="string"&&U.indexOf("BEGIN ")!=-1&&U.indexOf("CERTIFICATE")){var Q=new an;Q.readCertPEM(U);var J=Q.getSerialNumberHex();this.asn1CertSN=new B.asn1.DERInteger({hex:J})}},this.oid="2.5.29.35",P!==void 0&&(P.kid!==void 0&&this.setKIDByParam(P.kid),P.issuer!==void 0&&this.setCertIssuerByParam(P.issuer),P.sn!==void 0&&this.setCertSNByParam(P.sn),P.issuersn!==void 0&&typeof P.issuersn=="string"&&P.issuersn.indexOf("BEGIN ")!=-1&&P.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(P.issuersn),this.setCertIssuerByParam(P.issuersn)))},wt(B.asn1.x509.AuthorityKeyIdentifier,B.asn1.x509.Extension),B.asn1.x509.SubjectKeyIdentifier=function(P){B.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,P);var N=B,A=N.asn1,q=A.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(H){if(H.str!==void 0||H.hex!==void 0)this.asn1KID=new q(H);else if(typeof H=="object"&&B.crypto.Util.isKey(H)||typeof H=="string"&&H.indexOf("BEGIN")!=-1){var U=H;typeof H=="string"&&(U=Cn.getKey(H));var Q=Cn.getKeyID(U);this.asn1KID=new B.asn1.DEROctetString({hex:Q})}},this.oid="2.5.29.14",P!==void 0&&P.kid!==void 0&&this.setKIDByParam(P.kid)},wt(B.asn1.x509.SubjectKeyIdentifier,B.asn1.x509.Extension),B.asn1.x509.AuthorityInfoAccess=function(P){B.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,P),this.setAccessDescriptionArray=function(N){for(var A=new Array,q=B,H=q.asn1,U=H.DERSequence,Q=H.DERObjectIdentifier,J=H.x509.GeneralName,ae=0;ae<N.length;ae++){var te,le=N[ae];if(le.ocsp!==void 0)te=new U({array:[new Q({oid:"1.3.6.1.5.5.7.48.1"}),new J({uri:le.ocsp})]});else if(le.caissuer!==void 0)te=new U({array:[new Q({oid:"1.3.6.1.5.5.7.48.2"}),new J({uri:le.caissuer})]});else throw new Error("unknown AccessMethod parameter: "+JSON.stringify(le));A.push(te)}this.asn1ExtnValue=new U({array:A})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",P!==void 0&&P.array!==void 0&&this.setAccessDescriptionArray(P.array)},wt(B.asn1.x509.AuthorityInfoAccess,B.asn1.x509.Extension),B.asn1.x509.SubjectAltName=function(P){B.asn1.x509.SubjectAltName.superclass.constructor.call(this,P),this.setNameArray=function(N){this.asn1ExtnValue=new B.asn1.x509.GeneralNames(N)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",P!==void 0&&P.array!==void 0&&this.setNameArray(P.array)},wt(B.asn1.x509.SubjectAltName,B.asn1.x509.Extension),B.asn1.x509.IssuerAltName=function(P){B.asn1.x509.IssuerAltName.superclass.constructor.call(this,P),this.setNameArray=function(N){this.asn1ExtnValue=new B.asn1.x509.GeneralNames(N)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",P!==void 0&&P.array!==void 0&&this.setNameArray(P.array)},wt(B.asn1.x509.IssuerAltName,B.asn1.x509.Extension),B.asn1.x509.SubjectDirectoryAttributes=function(P){B.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,P);var N=B.asn1,A=N.DERSequence,q=N.ASN1Util.newObject,H=N.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var U=[],Q=0;Q<this.params.array.length;Q++){var J=this.params.array[Q];if(J.attr!=null&&J.array!=null){var ae={seq:[{oid:J.attr},{set:J.array}]};U.push(q(ae));continue}var te={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if(J.attr=="dateOfBirth")te.seq[0].oid=H(J.attr),te.seq[1].set[0]={gentime:J.str};else if(J.attr=="placeOfBirth")te.seq[0].oid=H(J.attr),te.seq[1].set[0]={utf8str:J.str};else if(J.attr=="gender")te.seq[0].oid=H(J.attr),te.seq[1].set[0]={prnstr:J.str};else if(J.attr=="countryOfCitizenship")te.seq[0].oid=H(J.attr),te.seq[1].set[0]={prnstr:J.str};else if(J.attr=="countryOfResidence")te.seq[0].oid=H(J.attr),te.seq[1].set[0]={prnstr:J.str};else throw new Error("unsupported attribute: "+J.attr);U.push(new q(te))}var le=new A({array:U});return this.asn1ExtnValue=le,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",P!==void 0&&(this.params=P)},wt(B.asn1.x509.SubjectDirectoryAttributes,B.asn1.x509.Extension),B.asn1.x509.PrivateExtension=function(P){B.asn1.x509.PrivateExtension.superclass.constructor.call(this,P);var N=B,A=N.lang.String.isHex,q=N.asn1,H=q.x509.OID.name2oid,U=q.ASN1Util.newObject;this.params=null,this.setByParam=function(Q){this.oid=H(Q.extname),this.params=Q},this.getExtnValueHex=function(){if(this.params.extname==null||this.params.extn==null)throw new Error("extname or extnhex not specified");var Q=this.params.extn;if(typeof Q=="string"&&A(Q))return Q;if(typeof Q=="object")try{return U(Q).tohex()}catch{}throw new Error("unsupported extn value")},P!=null&&this.setByParam(P)},wt(B.asn1.x509.PrivateExtension,B.asn1.x509.Extension),B.asn1.x509.CRL=function(P){B.asn1.x509.CRL.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERSequence,H=A.DERBitString,U=A.x509,Q=U.AlgorithmIdentifier,J=U.TBSCertList;this.params=void 0,this.setByParam=function(ae){this.params=ae},this.sign=function(){var ae=new J(this.params).tohex(),te=new B.crypto.Signature({alg:this.params.sigalg});te.init(this.params.cakey),te.updateHex(ae);var le=te.sign();this.params.sighex=le},this.getPEM=function(){return Yn(this.tohex(),"X509 CRL")},this.tohex=function(){var ae=this.params;if(ae.tbsobj==null&&(ae.tbsobj=new J(ae)),ae.sighex==null&&ae.cakey!=null&&this.sign(),ae.sighex==null)throw new Error("sighex or cakey parameter not defined");var te=[];te.push(ae.tbsobj),te.push(new Q({name:ae.sigalg})),te.push(new H({hex:"00"+ae.sighex}));var le=new q({array:te});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&(this.params=P)},wt(B.asn1.x509.CRL,B.asn1.ASN1Object),B.asn1.x509.TBSCertList=function(P){B.asn1.x509.TBSCertList.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERInteger,H=A.DERSequence,U=A.DERTaggedObject;A.DERObjectIdentifier;var Q=A.x509,J=Q.AlgorithmIdentifier,ae=Q.Time,te=Q.Extensions,le=Q.X500Name;this.params=null,this.setByParam=function(ce){this.params=ce},this.getRevCertSequence=function(){for(var ce=[],W=this.params.revcert,ne=0;ne<W.length;ne++){var X=[new q(W[ne].sn),new ae(W[ne].date)];W[ne].ext!=null&&X.push(new te(W[ne].ext)),ce.push(new H({array:X}))}return new H({array:ce})},this.tohex=function(){var ce=[],W=this.params;if(W.version!=null){var ne=W.version-1,X=new q({int:ne});ce.push(X)}if(ce.push(new J({name:W.sigalg})),ce.push(new le(W.issuer)),ce.push(new ae(W.thisupdate)),W.nextupdate!=null&&ce.push(new ae(W.nextupdate)),W.revcert!=null&&ce.push(this.getRevCertSequence()),W.ext!=null){var ie=new te(W.ext);ce.push(new U({tag:"a0",explicit:!0,obj:ie}))}var ue=new H({array:ce});return ue.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.TBSCertList,B.asn1.ASN1Object),B.asn1.x509.CRLEntry=function(P){B.asn1.x509.CRLEntry.superclass.constructor.call(this);var N=B,A=N.asn1;this.setCertSerial=function(q){this.sn=new A.DERInteger(q)},this.setRevocationDate=function(q){this.time=new A.x509.Time(q)},this.tohex=function(){var q=new A.DERSequence({array:[this.sn,this.time]});return this.TLV=q.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&(P.time!==void 0&&this.setRevocationDate(P.time),P.sn!==void 0&&this.setCertSerial(P.sn))},wt(B.asn1.x509.CRLEntry,B.asn1.ASN1Object),B.asn1.x509.CRLNumber=function(P){B.asn1.x509.CRLNumber.superclass.constructor.call(this,P),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new B.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",P!=null&&(this.params=P)},wt(B.asn1.x509.CRLNumber,B.asn1.x509.Extension),B.asn1.x509.CRLReason=function(P){B.asn1.x509.CRLReason.superclass.constructor.call(this,P),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new B.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",P!=null&&(this.params=P)},wt(B.asn1.x509.CRLReason,B.asn1.x509.Extension),B.asn1.x509.OCSPNonce=function(P){B.asn1.x509.OCSPNonce.superclass.constructor.call(this,P),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new B.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",P!=null&&(this.params=P)},wt(B.asn1.x509.OCSPNonce,B.asn1.x509.Extension),B.asn1.x509.OCSPNoCheck=function(P){B.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,P),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new B.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",P!=null&&(this.params=P)},wt(B.asn1.x509.OCSPNoCheck,B.asn1.x509.Extension),B.asn1.x509.AdobeTimeStamp=function(P){B.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,P);var N=B,A=N.asn1,q=A.DERInteger,H=A.DERBoolean,U=A.DERSequence,Q=A.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var J=this.params,ae=[new q(1)];return ae.push(new Q({uri:J.uri})),J.reqauth!=null&&ae.push(new H(J.reqauth)),this.asn1ExtnValue=new U({array:ae}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.AdobeTimeStamp,B.asn1.x509.Extension),B.asn1.x509.X500Name=function(P){B.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var N=B,A=N.asn1,q=A.x509,H=q.RDN;this.setByString=function(U,Q){Q!==void 0&&(this.sRule=Q);var J=U.split("/");J.shift();for(var ae=[],te=0;te<J.length;te++)if(J[te].match(/^[^=]+=.+$/))ae.push(J[te]);else{var le=ae.length-1;ae[le]=ae[le]+"/"+J[te]}for(var te=0;te<ae.length;te++)this.asn1Array.push(new H({str:ae[te],rule:this.sRule}))},this.setByLdapString=function(U,Q){Q!==void 0&&(this.sRule=Q);var J=q.X500Name.ldapToCompat(U);this.setByString(J,Q)},this.setByObject=function(U,Q){Q!==void 0&&(this.sRule=Q);for(var J in U)if(U.hasOwnProperty(J)){var ae=new H({str:J+"="+U[J],rule:this.sRule});this.asn1Array?this.asn1Array.push(ae):this.asn1Array=[ae]}},this.setByParam=function(U){if(U.rule!==void 0&&(this.sRule=U.rule),U.array!==void 0)this.paramArray=U.array;else if(U.str!==void 0)this.setByString(U.str);else if(U.ldapstr!==void 0)this.setByLdapString(U.ldapstr);else if(U.hex!==void 0)this.hTLV=U.hex;else if(U.certissuer!==void 0){var Q=new an;Q.readCertPEM(U.certissuer),this.hTLV=Q.getIssuerHex()}else if(U.certsubject!==void 0){var Q=new an;Q.readCertPEM(U.certsubject),this.hTLV=Q.getSubjectHex()}else typeof U=="object"&&U.certsubject===void 0&&U.certissuer===void 0&&this.setByObject(U)},this.tohex=function(){if(typeof this.hTLV=="string")return this.hTLV;if(this.asn1Array.length==0&&this.paramArray.length>0)for(var U=0;U<this.paramArray.length;U++){var Q={array:this.paramArray[U]};this.sRule!="utf8"&&(Q.rule=this.sRule);var J=new H(Q);this.asn1Array.push(J)}var ae=new A.DERSequence({array:this.asn1Array});return this.hTLV=ae.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.X500Name,B.asn1.ASN1Object),B.asn1.x509.X500Name.compatToLDAP=function(P){if(P.substr(0,1)!=="/")throw"malformed input";P=P.substr(1);var N=P.split("/");return N.reverse(),N=N.map(function(A){return A.replace(/,/,"\\,")}),N.join(",")},B.asn1.x509.X500Name.onelineToLDAP=function(P){return B.asn1.x509.X500Name.compatToLDAP(P)},B.asn1.x509.X500Name.ldapToCompat=function(P){for(var N=P.split(","),A=!1,q=[],H=0;N.length>0;H++){var U=N.shift();if(A===!0){var Q=q.pop(),J=(Q+","+U).replace(/\\,/g,",");q.push(J),A=!1}else q.push(U);U.substr(-1,1)==="\\"&&(A=!0)}return q=q.map(function(ae){return ae.replace("/","\\/")}),q.reverse(),"/"+q.join("/")},B.asn1.x509.X500Name.ldapToOneline=function(P){return B.asn1.x509.X500Name.ldapToCompat(P)},B.asn1.x509.RDN=function(P){B.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var N=B.asn1.x509.AttributeTypeAndValue;this.setByParam=function(A){A.rule!==void 0&&(this.sRule=A.rule),A.str!==void 0&&this.addByMultiValuedString(A.str),A.array!==void 0&&(this.paramArray=A.array)},this.addByString=function(A){this.asn1Array.push(new B.asn1.x509.AttributeTypeAndValue({str:A,rule:this.sRule}))},this.addByMultiValuedString=function(A){for(var q=B.asn1.x509.RDN.parseString(A),H=0;H<q.length;H++)this.addByString(q[H])},this.tohex=function(){if(this.asn1Array.length==0&&this.paramArray.length>0)for(var A=0;A<this.paramArray.length;A++){var q=this.paramArray[A];q.rule!==void 0&&this.sRule!="utf8"&&(q.rule=this.sRule);var H=new N(q);this.asn1Array.push(H)}var U=new B.asn1.DERSet({array:this.asn1Array});return this.TLV=U.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.RDN,B.asn1.ASN1Object),B.asn1.x509.RDN.parseString=function(P){for(var N=P.split(/\+/),A=!1,q=[],H=0;N.length>0;H++){var U=N.shift();if(A===!0){var Q=q.pop(),J=(Q+"+"+U).replace(/\\\+/g,"+");q.push(J),A=!1}else q.push(U);U.substr(-1,1)==="\\"&&(A=!0)}for(var ae=!1,te=[],H=0;q.length>0;H++){var U=q.shift();if(ae===!0){var le=te.pop();if(U.match(/"$/)){var J=(le+"+"+U).replace(/^([^=]+)="(.*)"$/,"$1=$2");te.push(J),ae=!1}else te.push(le+"+"+U)}else te.push(U);U.match(/^[^=]+="/)&&(ae=!0)}return te},B.asn1.x509.AttributeTypeAndValue=function(P){B.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var N=B,A=N.asn1,q=A.DERSequence,H=A.DERUTF8String,U=A.DERPrintableString,Q=A.DERTeletexString,J=A.DERIA5String,ae=A.DERVisibleString,te=A.DERBMPString,le=N.lang.String.isMail,ce=N.lang.String.isPrintable;this.setByParam=function(W){if(W.rule!==void 0&&(this.sRule=W.rule),W.ds!==void 0&&(this.dsType=W.ds),W.value===void 0&&W.str!==void 0){var ne=W.str,X=ne.match(/^([^=]+)=(.+)$/);if(X)this.sType=X[1],this.sValue=X[2];else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)}else this.sType=W.type,this.sValue=W.value},this.setByString=function(W,ne){ne!==void 0&&(this.sRule=ne);var X=W.match(/^([^=]+)=(.+)$/);if(X)this.setByAttrTypeAndValueStr(X[1],X[2]);else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)},this._getDsType=function(){var W=this.sType,ne=this.sValue,X=this.sRule;return X==="prn"?W=="CN"&&le(ne)?"ia5":ce(ne)?"prn":"utf8":X==="utf8"?W=="CN"&&le(ne)?"ia5":W=="C"?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(W,ne,X){X!==void 0&&(this.sRule=X),this.sType=W,this.sValue=ne},this.getValueObj=function(W,ne){if(W=="utf8")return new H({str:ne});if(W=="prn")return new U({str:ne});if(W=="tel")return new Q({str:ne});if(W=="ia5")return new J({str:ne});if(W=="vis")return new ae({str:ne});if(W=="bmp")return new te({str:ne});throw new Error("unsupported directory string type: type="+W+" value="+ne)},this.tohex=function(){this.dsType==null&&(this.dsType=this._getDsType());var W=B.asn1.x509.OID.atype2obj(this.sType),ne=this.getValueObj(this.dsType,this.sValue),X=new q({array:[W,ne]});return this.TLV=X.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.AttributeTypeAndValue,B.asn1.ASN1Object),B.asn1.x509.SubjectPublicKeyInfo=function(P){B.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERInteger,H=A.DERBitString,U=A.DERObjectIdentifier,Q=A.DERSequence,J=A.ASN1Util.newObject,ae=A.x509,te=ae.AlgorithmIdentifier,le=N.crypto;le.ECDSA,le.DSA,this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var ce=new Q({array:[this.asn1AlgId,this.asn1SubjPKey]});return ce},this.tohex=function(){var ce=this.getASN1Object();return this.hTLV=ce.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(ce){try{if(ce instanceof rn){var W=J({seq:[{int:{bigint:ce.n}},{int:{int:ce.e}}]}),ne=W.tohex();this.asn1AlgId=new te({name:"rsaEncryption"}),this.asn1SubjPKey=new H({hex:"00"+ne})}}catch{}try{if(ce instanceof B.crypto.ECDSA){var X=new U({name:ce.curveName});this.asn1AlgId=new te({name:"ecPublicKey",asn1params:X}),this.asn1SubjPKey=new H({hex:"00"+ce.pubKeyHex})}}catch{}try{if(ce instanceof B.crypto.DSA){var X=new J({seq:[{int:{bigint:ce.p}},{int:{bigint:ce.q}},{int:{bigint:ce.g}}]});this.asn1AlgId=new te({name:"dsa",asn1params:X});var ie=new q({bigint:ce.y});this.asn1SubjPKey=new H({hex:"00"+ie.tohex()})}}catch{}},P!==void 0&&this.setPubKey(P)},wt(B.asn1.x509.SubjectPublicKeyInfo,B.asn1.ASN1Object),B.asn1.x509.Time=function(P){B.asn1.x509.Time.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERUTCTime,H=A.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(U){this.timeParams=U},this.setByParam=function(U){this.params=U},this.getType=function(U){return U.match(/^[0-9]{12}Z$/)?"utc":U.match(/^[0-9]{14}Z$/)?"gen":U.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":U.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var U=this.params,Q=null;if(typeof U=="string"&&(U={str:U}),U!=null&&U.str&&(U.type==null||U.type==null)&&(U.type=this.getType(U.str)),U!=null&&U.str?(U.type=="utc"&&(Q=new q(U.str)),U.type=="gen"&&(Q=new H(U.str))):this.type=="gen"?Q=new H:Q=new q,Q==null)throw new Error("wrong setting for Time");return this.TLV=Q.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},B.asn1.x509.Time_bak=function(P){B.asn1.x509.Time_bak.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERUTCTime,H=A.DERGeneralizedTime;this.setTimeParams=function(U){this.timeParams=U},this.tohex=function(){var U=null;return this.timeParams!=null?this.type=="utc"?U=new q(this.timeParams):U=new H(this.timeParams):this.type=="utc"?U=new q:U=new H,this.TLV=U.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",P!==void 0&&(P.type!==void 0?this.type=P.type:P.str!==void 0&&(P.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),P.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=P)},wt(B.asn1.x509.Time,B.asn1.ASN1Object),B.asn1.x509.AlgorithmIdentifier=function(P){B.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var N=B,A=N.asn1,q=A.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(this.nameAlg===null&&this.asn1Alg===null)throw new Error("algorithm not specified");if(this.nameAlg!==null){var U=null;for(var Q in q)Q===this.nameAlg&&(U=q[Q]);if(U!==null)return this.hTLV=U,this.hTLV}this.nameAlg!==null&&this.asn1Alg===null&&(this.asn1Alg=A.x509.OID.name2obj(this.nameAlg));var J=[this.asn1Alg];this.asn1Params!==null&&J.push(this.asn1Params);var ae=new A.DERSequence({array:J});return this.hTLV=ae.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&(P.name!==void 0&&(this.nameAlg=P.name),P.asn1params!==void 0&&(this.asn1Params=P.asn1params),P.paramempty!==void 0&&(this.paramEmpty=P.paramempty)),this.asn1Params===null&&this.paramEmpty===!1&&this.nameAlg!==null){this.nameAlg.name!==void 0&&(this.nameAlg=this.nameAlg.name);var H=this.nameAlg.toLowerCase();H.substr(-7,7)!=="withdsa"&&H.substr(-9,9)!=="withecdsa"&&(this.asn1Params=new A.DERNull)}},wt(B.asn1.x509.AlgorithmIdentifier,B.asn1.ASN1Object),B.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},B.asn1.x509.GeneralName=function(P){B.asn1.x509.GeneralName.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.x509,H=q.X500Name,U=q.OtherName,Q=A.DERIA5String;A.DERPrintableString;var J=A.DEROctetString,ae=A.DERTaggedObject,te=A.ASN1Object,le=Error;this.params=null,this.setByParam=function(ce){this.params=ce},this.tohex=function(){var ce=this.params,W,X,ne,X=!1;if(ce.other!==void 0)W="a0",ne=new U(ce.other);else if(ce.rfc822!==void 0)W="81",ne=new Q({str:ce.rfc822});else if(ce.dns!==void 0)W="82",ne=new Q({str:ce.dns});else if(ce.dn!==void 0)W="a4",X=!0,typeof ce.dn=="string"?ne=new H({str:ce.dn}):ce.dn instanceof B.asn1.x509.X500Name?ne=ce.dn:ne=new H(ce.dn);else if(ce.ldapdn!==void 0)W="a4",X=!0,ne=new H({ldapstr:ce.ldapdn});else if(ce.certissuer!==void 0||ce.certsubj!==void 0){W="a4",X=!0;var ie,ue,ve=null;if(ce.certsubj!==void 0?(ie=!1,ue=ce.certsubj):(ie=!0,ue=ce.certissuer),ue.match(/^[0-9A-Fa-f]+$/),ue.indexOf("-----BEGIN ")!=-1&&(ve=nr(ue)),ve==null)throw new Error("certsubj/certissuer not cert");var ze=new an;ze.hex=ve;var tt;ie?tt=ze.getIssuerHex():tt=ze.getSubjectHex(),ne=new te,ne.hTLV=tt}else if(ce.uri!==void 0)W="86",ne=new Q({str:ce.uri});else if(ce.ip!==void 0){W="87";var nt,it=ce.ip;try{if(it.match(/^[0-9a-f]+$/)){var _e=it.length;if(_e==8||_e==16||_e==32||_e==64)nt=it;else throw"err"}else nt=Ib(it)}catch(Ae){throw new le("malformed IP address: "+ce.ip+":"+Ae.message)}ne=new J({hex:nt})}else throw new le("improper params");var Ie=new ae({tag:W,explicit:X,obj:ne});return Ie.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.GeneralName,B.asn1.ASN1Object),B.asn1.x509.GeneralNames=function(P){B.asn1.x509.GeneralNames.superclass.constructor.call(this);var N=B,A=N.asn1;this.setByParamArray=function(q){for(var H=0;H<q.length;H++){var U=new A.x509.GeneralName(q[H]);this.asn1Array.push(U)}},this.tohex=function(){var q=new A.DERSequence({array:this.asn1Array});return q.tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof P<"u"&&this.setByParamArray(P)},wt(B.asn1.x509.GeneralNames,B.asn1.ASN1Object),B.asn1.x509.OtherName=function(P){B.asn1.x509.OtherName.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DERObjectIdentifier,H=A.DERSequence,U=A.ASN1Util.newObject;this.params=null,this.setByParam=function(Q){this.params=Q},this.tohex=function(){var Q=this.params;if(Q.oid==null||Q.value==null)throw new Error("oid or value not specified");var J=new q({oid:Q.oid}),ae=U({tag:{tag:"a0",explicit:!0,obj:Q.value}}),te=new H({array:[J,ae]});return te.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.x509.OtherName,B.asn1.ASN1Object),B.asn1.x509.OID=new function(){var P=B.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(N){if(typeof this.objCache[N]<"u")return this.objCache[N];if(typeof this.name2oidList[N]>"u")throw"Name of ObjectIdentifier not defined: "+N;var A=this.name2oidList[N],q=new P({oid:A});return this.objCache[N]=q,q},this.atype2obj=function(N){if(this.objCache[N]!==void 0)return this.objCache[N];var A;if(N.match(/^\d+\.\d+\.[0-9.]+$/))A=N;else if(this.atype2oidList[N]!==void 0)A=this.atype2oidList[N];else if(this.name2oidList[N]!==void 0)A=this.name2oidList[N];else throw new Error("AttributeType name undefined: "+N);var q=new P({oid:A});return this.objCache[N]=q,q},this.registerOIDs=function(N){if(this.checkOIDs(N))for(var A in N)this.name2oidList[A]=N[A]},this.checkOIDs=function(N){try{var A=Object.keys(N);return A.length==0?!1:(A.map(function(q,H,U){var Q=this[q];if(!Q.match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},N),!0)}catch{return!1}}},B.asn1.x509.OID.oid2name=function(P){var N=B.asn1.x509.OID.name2oidList;for(var A in N)if(N[A]==P)return A;return""},B.asn1.x509.OID.oid2atype=function(P){var N=B.asn1.x509.OID.atype2oidList;for(var A in N)if(N[A]==P)return A;return P},B.asn1.x509.OID.name2oid=function(P){if(P.match(/^[0-9.]+$/))return P;var N=B.asn1.x509.OID.name2oidList;return N[P]===void 0?"":N[P]},B.asn1.x509.X509Util={},B.asn1.x509.X509Util.newCertPEM=function(P){var N=B.asn1.x509;N.TBSCertificate;var A=N.Certificate,q=new A(P);return q.getPEM()},(typeof B>"u"||!B)&&(B={}),(typeof B.asn1>"u"||!B.asn1)&&(B.asn1={}),(typeof B.asn1.cms>"u"||!B.asn1.cms)&&(B.asn1.cms={}),B.asn1.cms.Attribute=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence,U=q.DERSet,Q=q.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(J){this.params=J},this.getValueArray=function(){throw new N("not yet implemented abstract")},this.tohex=function(){var J=new Q({oid:this.typeOid}),ae=new U({array:this.getValueArray()}),te=new H({array:[J,ae]});return te.tohex()},this.getEncodedHex=function(){return this.tohex()}},wt(B.asn1.cms.Attribute,B.asn1.ASN1Object),B.asn1.cms.ContentType=function(P){var N=B,A=N.asn1;A.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){var q=new A.DERObjectIdentifier(this.params.type);return[q]},P!=null&&this.setByParam(P)},wt(B.asn1.cms.ContentType,B.asn1.cms.Attribute),B.asn1.cms.MessageDigest=function(P){var N=B,A=N.asn1,q=A.DEROctetString,H=A.cms;H.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){var U=new q(this.params);return[U]},P!=null&&this.setByParam(P)},wt(B.asn1.cms.MessageDigest,B.asn1.cms.Attribute),B.asn1.cms.SigningTime=function(P){var N=B,A=N.asn1;A.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){var q=new A.x509.Time(this.params);return[q]},P!=null&&this.setByParam(P)},wt(B.asn1.cms.SigningTime,B.asn1.cms.Attribute),B.asn1.cms.SigningCertificate=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence,U=q.cms,Q=U.ESSCertID;A.crypto,U.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new N("parameter 'array' not specified");for(var J=this.params.array,ae=[],te=0;te<J.length;te++){var le=J[te];P.hasis==!1&&typeof le=="string"&&(le.indexOf("-----BEGIN")!=-1||dt.isASN1HEX(le))&&(le={cert:le}),le.hasis!=!1&&P.hasis==!1&&(le.hasis=!1),ae.push(new Q(le))}var ce=new H({array:ae}),W=new H({array:[ce]});return[W]},P!=null&&this.setByParam(P)},wt(B.asn1.cms.SigningCertificate,B.asn1.cms.Attribute),B.asn1.cms.ESSCertID=function(P){B.asn1.cms.ESSCertID.superclass.constructor.call(this);var N=Error,A=B,q=A.asn1,H=q.DEROctetString,U=q.DERSequence,Q=q.cms.IssuerSerial;this.params=null,this.getCertHash=function(J,ae){if(J.hash!=null)return J.hash;if(typeof J=="string"&&J.indexOf("-----BEGIN")==-1&&!dt.isASN1HEX(J))return J;var te;if(typeof J=="string")te=J;else if(J.cert!=null)te=J.cert;else throw new N("hash nor cert unspecified");var le;te.indexOf("-----BEGIN")!=-1?le=nr(te):le=te,typeof J=="string"&&(J.indexOf("-----BEGIN")!=-1?le=nr(J):dt.isASN1HEX(J)&&(le=J));var ce;if(J.alg!=null)ce=J.alg;else if(ae!=null)ce=ae;else throw new N("hash alg unspecified");return A.crypto.Util.hashHex(le,ce)},this.tohex=function(){var J=this.params,ae=this.getCertHash(J,"sha1"),te=[];te.push(new H({hex:ae})),(typeof J=="string"&&J.indexOf("-----BEGIN")!=-1||J.cert!=null&&J.hasis!=!1||J.issuer!=null&&J.serial!=null)&&te.push(new Q(J));var le=new U({array:te});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.ESSCertID,B.asn1.ASN1Object),B.asn1.cms.SigningCertificateV2=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence;q.x509;var U=q.cms,Q=U.ESSCertIDv2;A.crypto,U.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new N("parameter 'array' not specified");for(var J=this.params.array,ae=[],te=0;te<J.length;te++){var le=J[te];(P.alg!=null||P.hasis==!1)&&typeof le=="string"&&(le.indexOf("-----BEGIN")!=-1||dt.isASN1HEX(le))&&(le={cert:le}),le.alg==null&&P.alg!=null&&(le.alg=P.alg),le.hasis!=!1&&P.hasis==!1&&(le.hasis=!1),ae.push(new Q(le))}var ce=new H({array:ae}),W=new H({array:[ce]});return[W]},P!=null&&this.setByParam(P)},wt(B.asn1.cms.SigningCertificateV2,B.asn1.cms.Attribute),B.asn1.cms.ESSCertIDv2=function(P){B.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.DEROctetString,H=A.DERSequence,U=A.cms.IssuerSerial,Q=A.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var J=this.params,ae=this.getCertHash(J,"sha256"),te=[];J.alg!=null&&J.alg!="sha256"&&te.push(new Q({name:J.alg})),te.push(new q({hex:ae})),(typeof J=="string"&&J.indexOf("-----BEGIN")!=-1||J.cert!=null&&J.hasis!=!1||J.issuer!=null&&J.serial!=null)&&te.push(new U(J));var le=new H({array:te});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.ESSCertIDv2,B.asn1.cms.ESSCertID),B.asn1.cms.IssuerSerial=function(P){var N=Error,A=B,q=A.asn1,H=q.DERInteger,U=q.DERSequence,Q=q.cms,J=q.x509,ae=J.GeneralNames,te=an;Q.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(le){this.params=le},this.tohex=function(){var le=this.params,ce,W;if(typeof le=="string"&&le.indexOf("-----BEGIN")!=-1||le.cert!=null){var ne;le.cert!=null?ne=le.cert:ne=le;var X=new te;X.readCertPEM(ne),ce=X.getIssuer(),W={hex:X.getSerialNumberHex()}}else if(le.issuer!=null&&le.serial)ce=le.issuer,W=le.serial;else throw new N("cert or issuer and serial parameter not specified");var ie=new ae([{dn:ce}]),ue=new H(W),ve=new U({array:[ie,ue]});return ve.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.IssuerSerial,B.asn1.ASN1Object),B.asn1.cms.SignerIdentifier=function(P){var N=B,A=N.asn1;A.DERInteger,A.DERSequence;var q=A.cms,H=q.IssuerAndSerialNumber,U=q.SubjectKeyIdentifier,Q=A.x509;Q.X500Name,q.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var J=this.params;if(J.type=="isssn"){var ae=new H(J);return ae.tohex()}else if(J.type=="skid"){var te=new U(J);return te.tohex()}else throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.SignerIdentifier,B.asn1.ASN1Object),B.asn1.cms.IssuerAndSerialNumber=function(P){var N=B,A=N.asn1,q=A.DERInteger,H=A.DERSequence,U=A.cms,Q=A.x509,J=Q.X500Name,ae=an,te=Error;U.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var le=this.params,ce,W;if(typeof le=="string"&&le.indexOf("-----BEGIN")!=-1||le.cert!=null){var ne;le.cert!=null?ne=le.cert:ne=le;var X=new ae;X.readCertPEM(ne),ce=X.getIssuer(),W={hex:X.getSerialNumberHex()}}else if(le.issuer!=null&&le.serial)ce=le.issuer,W=le.serial;else throw new te("cert or issuer and serial parameter not specified");var ie=new J(ce),ue=new q(W),ve=new H({array:[ie,ue]});return ve.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(le){this.params=le},P!=null&&this.setByParam(P)},wt(B.asn1.cms.IssuerAndSerialNumber,B.asn1.ASN1Object),B.asn1.cms.SubjectKeyIdentifier=function(P){var N=B,A=N.asn1;A.DERInteger,A.DERSequence;var q=A.ASN1Util.newObject,H=A.cms;H.IssuerAndSerialName,H.SubjectKeyIdentifier;var U=A.x509;U.X500Name;var Q=an,J=Error;H.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var ae=this.params;if(ae.cert==null&&ae.skid==null)throw new J("property cert nor skid undefined");var te;if(ae.cert!=null){var le=new Q(ae.cert),ce=le.getExtSubjectKeyIdentifier();te=ce.kid.hex}else ae.skid!=null&&(te=ae.skid);var W=q({tag:{tage:"a0",obj:{octstr:{hex:te}}}});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.SubjectKeyIdentifier,B.asn1.ASN1Object),B.asn1.cms.AttributeList=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSet,U=q.cms;U.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(Q){this.params=Q},this.tohex=function(){var Q=this.params;if(this.hTLV!=null)return this.hTLV;var J=!0;Q.sortflag!=null&&(J=Q.sortflag);for(var ae=Q.array,te=[],le=0;le<ae.length;le++){var ce=ae[le],W=ce.attr;if(W=="contentType")te.push(new U.ContentType(ce));else if(W=="messageDigest")te.push(new U.MessageDigest(ce));else if(W=="signingTime")te.push(new U.SigningTime(ce));else if(W=="signingCertificate")te.push(new U.SigningCertificate(ce));else if(W=="signingCertificateV2")te.push(new U.SigningCertificateV2(ce));else if(W=="signaturePolicyIdentifier")te.push(new B.asn1.cades.SignaturePolicyIdentifier(ce));else if(W=="signatureTimeStamp"||W=="timeStampToken")te.push(new B.asn1.cades.SignatureTimeStamp(ce));else throw new N("unknown attr: "+W)}var ne=new H({array:te,sortflag:J});return this.hTLV=ne.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.AttributeList,B.asn1.ASN1Object),B.asn1.cms.SignerInfo=function(P){var N=Error,A=B,q=A.asn1,H=q.DERInteger,U=q.DEROctetString,Q=q.DERSequence,J=q.DERTaggedObject,ae=q.cms,te=ae.SignerIdentifier,le=ae.AttributeList;ae.ContentType,ae.EncapsulatedContentInfo,ae.MessageDigest,ae.SignedData;var ce=q.x509,W=ce.AlgorithmIdentifier,ne=A.crypto,X=Cn;ae.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var ie=this.params,ue=ie.sigalg,ve=new le(ie.sattrs).tohex(),ze=X.getKey(ie.signkey),tt=new ne.Signature({alg:ue});tt.init(ze),tt.updateHex(ve);var nt=tt.sign();ie.sighex=nt},this.tohex=function(){var ie=this.params,ue=[];if(ue.push(new H({int:ie.version})),ue.push(new te(ie.id)),ue.push(new W({name:ie.hashalg})),ie.sattrs!=null){var ve=new le(ie.sattrs);try{ue.push(new J({tag:"a0",explicit:!1,obj:ve}))}catch(tt){throw new N("si sattr error: "+tt)}}if(ie.sigalgfield!=null?ue.push(new W({name:ie.sigalgfield})):ue.push(new W({name:ie.sigalg})),ie.sighex==null&&ie.signkey!=null&&this.sign(),ue.push(new U({hex:ie.sighex})),ie.uattrs!=null){var ve=new le(ie.uattrs);try{ue.push(new J({tag:"a1",explicit:!1,obj:ve}))}catch(nt){throw new N("si uattr error: "+nt)}}var ze=new Q({array:ue});return ze.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.SignerInfo,B.asn1.ASN1Object),B.asn1.cms.EncapsulatedContentInfo=function(P){var N=B,A=N.asn1,q=A.DERTaggedObject,H=A.DERSequence,U=A.DERObjectIdentifier,Q=A.DEROctetString,J=A.cms;J.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var ae=this.params,te=[];if(te.push(new U(ae.type)),ae.content!=null&&(ae.content.hex!=null||ae.content.str!=null)&&ae.isDetached!=!0){var le=new Q(ae.content),ce=new q({tag:"a0",explicit:!0,obj:le});te.push(ce)}var W=new H({array:te});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(ae){this.params=ae},P!=null&&this.setByParam(P)},wt(B.asn1.cms.EncapsulatedContentInfo,B.asn1.ASN1Object),B.asn1.cms.ContentInfo=function(P){var N=B,A=N.asn1,q=A.DERTaggedObject,H=A.DERSequence,U=A.DERObjectIdentifier,Q=A.x509;Q.OID.name2obj,B.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var J=this.params,ae=[];ae.push(new U(J.type));var te=new q({tag:"a0",explicit:!0,obj:J.obj});ae.push(te);var le=new H({array:ae});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(J){this.params=J},P!=null&&this.setByParam(P)},wt(B.asn1.cms.ContentInfo,B.asn1.ASN1Object),B.asn1.cms.SignedData=function(P){var N=B,A=N.asn1;A.ASN1Object;var q=A.DERInteger,H=A.DERSet,U=A.DERSequence;A.DERTaggedObject;var Q=A.cms,J=Q.EncapsulatedContentInfo,ae=Q.SignerInfo,te=Q.ContentInfo,le=Q.CertificateSet,ce=Q.RevocationInfoChoices,W=A.x509,ne=W.AlgorithmIdentifier;B.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var X=this.params;this._setDigestAlgs(X),this._setContentTypeByEContent(X),this._setMessageDigestByEContent(X),this._setSignerInfoVersion(X),this._setSignedDataVersion(X)},this._setDigestAlgs=function(X){for(var ie={},ue=X.sinfos,ve=0;ve<ue.length;ve++){var ze=ue[ve];ie[ze.hashalg]=1}X.hashalgs=Object.keys(ie).sort()},this._setContentTypeByEContent=function(X){for(var ie=X.econtent.type,ue=X.sinfos,ve=0;ve<ue.length;ve++){var ze=ue[ve],tt=this._getAttrParamByName(ze,"contentType");tt.type=ie}},this._setMessageDigestByEContent=function(X){var ie=X.econtent;X.econtent.type;var ue=ie.content.hex;ue==null&&ie.type=="data"&&ie.content.str!=null&&(ue=Ts(ie.content.str));for(var ve=X.sinfos,ze=0;ze<ve.length;ze++){var tt=ve[ze],nt=tt.hashalg,it=this._getAttrParamByName(tt,"messageDigest"),_e=B.crypto.Util.hashHex(ue,nt);it.hex=_e}},this._getAttrParamByName=function(X,ie){for(var ue=X.sattrs.array,ve=0;ve<ue.length;ve++)if(ue[ve].attr==ie)return ue[ve]},this._setSignerInfoVersion=function(X){for(var ie=X.sinfos,ue=0;ue<ie.length;ue++){var ve=ie[ue],ze=1;ve.id.type=="skid"&&(ze=3),ve.version=ze}},this._setSignedDataVersion=function(X){var ie=this._getSignedDataVersion(X);X.version=ie},this._getSignedDataVersion=function(X){if(X.revinfos!=null)for(var ie=X.revinfos,ue=0;ue<ie.length;ue++){var ve=ie[ue];if(ve.ocsp!=null)return 5}for(var ze=X.sinfos,ue=0;ue<ze.length;ue++){var tt=X.sinfos[ue];if(tt.version==3)return 3}return X.econtent.type!="data"?3:1},this.tohex=function(){var X=this.params;this.getEncodedHexPrepare!=null&&this.getEncodedHexPrepare(),X.fixed!=!0&&this.checkAndFixParam();var ie=[];ie.push(new q({int:X.version}));for(var ue=[],ve=0;ve<X.hashalgs.length;ve++){var ze=X.hashalgs[ve];ue.push(new ne({name:ze}))}ie.push(new H({array:ue})),ie.push(new J(X.econtent)),X.certs!=null&&ie.push(new le(X.certs)),X.revinfos!=null&&ie.push(new ce(X.revinfos));for(var tt=[],ve=0;ve<X.sinfos.length;ve++){var nt=X.sinfos[ve];tt.push(new ae(nt))}ie.push(new H({array:tt}));var it=new U({array:ie});return it.tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){var X=new te({type:"signed-data",obj:this});return X},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.SignedData,B.asn1.ASN1Object),B.asn1.cms.CertificateSet=function(P){B.asn1.cms.CertificateSet.superclass.constructor.call(this);var N=Error,A=B.asn1,q=A.DERTaggedObject,H=A.DERSet,U=A.ASN1Object;this.params=null,this.tohex=function(){var Q=this.params,J=[],ae;if(Q instanceof Array)ae=Q;else if(Q.array!=null)ae=Q.array;else throw new N("cert array not specified");for(var te=0;te<ae.length;te++){var le=ae[te],ce=nr(le),W=new U;W.hTLV=ce,J.push(W)}var ne={array:J};Q.sortflag==!1&&(ne.sortflag=!1);var X=new H(ne),ie=new q({tag:"a0",explicit:!1,obj:X});return ie.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.CertificateSet,B.asn1.ASN1Object),B.asn1.cms.RevocationInfoChoices=function(P){B.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params;if(!N instanceof Array)throw new Error("params is not array");for(var A=[],q=0;q<N.length;q++)A.push(new B.asn1.cms.RevocationInfoChoice(N[q]));var H=B.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:A}}});return H.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.RevocationInfoChoices,B.asn1.ASN1Object),B.asn1.cms.RevocationInfoChoice=function(P){B.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params;if(N.crl!=null&&typeof N.crl=="string"){var A=N.crl;return N.crl.indexOf("-----BEGIN")!=-1&&(A=nr(N.crl)),A}else if(N.ocsp!=null){var q=B.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new B.asn1.cms.OtherRevocationFormat(N)}});return q.tohex()}else throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.RevocationInfoChoice,B.asn1.ASN1Object),B.asn1.cms.OtherRevocationFormat=function(P){B.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var N=Error,A=B,q=A.asn1,H=q.ASN1Util.newObject,U=A.lang.String.isHex;this.params=null,this.tohex=function(){var Q=this.params;if(Q.ocsp==null)throw new N("property ocsp not specified");if(!U(Q.ocsp)||!dt.isASN1HEX(Q.ocsp))throw new N("ocsp value not ASN.1 hex string");var J=H({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:Q.ocsp}}]});return J.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cms.OtherRevocationFormat,B.asn1.ASN1Object),B.asn1.cms.CMSUtil=new function(){},B.asn1.cms.CMSUtil.newSignedData=function(P){return new B.asn1.cms.SignedData(P)},B.asn1.cms.CMSUtil.verifySignedData=function(P){var N=B,A=N.asn1,q=A.cms;q.SignerInfo,q.SignedData,q.SigningTime,q.SigningCertificate,q.SigningCertificateV2;var H=A.cades;H.SignaturePolicyIdentifier;var U=N.lang.String.isHex,Q=dt,J=Q.getVbyList,ae=Q.getTLVbyList,te=Q.getIdxbyList,le=Q.getChildIdx,ce=Q.getTLV,W=Q.oidname,ne=N.crypto.Util.hashHex;P.cms===void 0&&U(P.cms);var X=P.cms,ie=function(Ae,Te){for(var Be,rt=3;rt<6;rt++)if(Be=te(Ae,0,[1,0,rt]),Be!==void 0){var ct=Ae.substr(Be,2);ct==="a0"&&(Te.certsIdx=Be),ct==="a1"&&(Te.revinfosIdx=Be),ct==="31"&&(Te.signerinfosIdx=Be)}},ue=function(Ae,Te){var Be=Te.signerinfosIdx;if(Be!==void 0){var rt=le(Ae,Be);Te.signerInfoIdxList=rt;for(var ct=0;ct<rt.length;ct++){var Tt=rt[ct],st={idx:Tt};ve(Ae,st),Te.signerInfos.push(st)}}},ve=function(Ae,Te){var Be=Te.idx;Te.signerid_issuer1=ae(Ae,Be,[1,0],"30"),Te.signerid_serial1=J(Ae,Be,[1,1],"02"),Te.hashalg=W(J(Ae,Be,[2,0],"06"));var rt=te(Ae,Be,[3],"a0");Te.idxSignedAttrs=rt,ze(Ae,Te,rt);var ct=le(Ae,Be),Tt=ct.length;if(Tt<6)throw"malformed SignerInfo";Te.sigalg=W(J(Ae,Be,[Tt-2,0],"06")),Te.sigval=J(Ae,Be,[Tt-1],"04")},ze=function(Ae,Te,Be){var rt=le(Ae,Be);Te.signedAttrIdxList=rt;for(var ct=0;ct<rt.length;ct++){var Tt=rt[ct],st=J(Ae,Tt,[0],"06"),yt;st==="2a864886f70d010905"?(yt=Ln(J(Ae,Tt,[1,0])),Te.saSigningTime=yt):st==="2a864886f70d010904"&&(yt=J(Ae,Tt,[1,0],"04"),Te.saMessageDigest=yt)}},tt=function(Ae,Te){if(J(Ae,0,[0],"06")!=="2a864886f70d010702")return Te;Te.cmsType="signedData",Te.econtent=J(Ae,0,[1,0,2,1,0]),ie(Ae,Te),Te.signerInfos=[],ue(Ae,Te)},nt=function(Ae,Te){for(var Be=Te.parse.signerInfos,rt=Be.length,ct=!0,Tt=0;Tt<rt;Tt++){var st=Be[Tt];_e(Ae,Te,st),st.isValid||(ct=!1)}Te.isValid=ct},it=function(Ae,Te,Be,rt){var ct=Te.parse.certsIdx,Tt;if(Te.certs===void 0){Tt=[],Te.certkeys=[];for(var st=le(Ae,ct),yt=0;yt<st.length;yt++){var Pt=ce(Ae,st[yt]),jt=new an;jt.readCertHex(Pt),Tt[yt]=jt,Te.certkeys[yt]=jt.getPublicKey()}Te.certs=Tt}else Tt=Te.certs;Te.cccc=Tt.length,Te.cccci=st.length;for(var yt=0;yt<Tt.length;yt++){var kr=jt.getIssuerHex(),Er=jt.getSerialNumberHex();Be.signerid_issuer1===kr&&Be.signerid_serial1===Er&&(Be.certkey_idx=yt)}},_e=function(Ae,Te,Be,rt){Be.verifyDetail={};var ct=Be.verifyDetail,Tt=Te.parse.econtent,st=Be.hashalg,yt=Be.saMessageDigest;ct.validMessageDigest=!1,ne(Tt,st)===yt&&(ct.validMessageDigest=!0),it(Ae,Te,Be),ct.validSignatureValue=!1;var Pt=Be.sigalg,jt="31"+ce(Ae,Be.idxSignedAttrs).substr(2);Be.signedattrshex=jt;var kr=Te.certs[Be.certkey_idx].getPublicKey(),Er=new B.crypto.Signature({alg:Pt});Er.init(kr),Er.updateHex(jt);var ir=Er.verify(Be.sigval);ct.validSignatureValue_isValid=ir,ir===!0&&(ct.validSignatureValue=!0),Be.isValid=!1,ct.validMessageDigest&&ct.validSignatureValue&&(Be.isValid=!0)},Ie={isValid:!1,parse:{}};return tt(X,Ie.parse),nt(X,Ie),Ie},B.asn1.cms.CMSParser=function(){var P=Error,N=an,A=new N,q=dt,H=q.getV,U=q.getTLV;q.getIdxbyList;var Q=q.getTLVbyList,J=q.getTLVbyListEx,ae=q.getVbyList,te=q.getVbyListEx,le=q.getChildIdx;this.getCMSSignedData=function(ce){var W=Q(ce,0,[1,0]),ne=this.getSignedData(W);return ne},this.getSignedData=function(ce){var W=le(ce,0),ne={},X=H(ce,W[0]),ie=parseInt(X,16);ne.version=ie;var ue=U(ce,W[1]);ne.hashalgs=this.getHashAlgArray(ue);var ve=U(ce,W[2]);ne.econtent=this.getEContent(ve);var ze=J(ce,0,["[0]"]);ze!=null&&(ne.certs=this.getCertificateSet(ze)),J(ce,0,["[1]"]);var tt=J(ce,0,[3]);return ne.sinfos=this.getSignerInfos(tt),ne},this.getHashAlgArray=function(ce){for(var W=le(ce,0),ne=new N,X=[],ie=0;ie<W.length;ie++){var ue=U(ce,W[ie]),ve=ne.getAlgorithmIdentifierName(ue);X.push(ve)}return X},this.getEContent=function(ce){var W={},ne=ae(ce,0,[0]),X=ae(ce,0,[1,0]);return W.type=B.asn1.x509.OID.oid2name(dt.hextooidstr(ne)),W.content={hex:X},W},this.getSignerInfos=function(ce){for(var W=[],ne=le(ce,0),X=0;X<ne.length;X++){var ie=U(ce,ne[X]),ue=this.getSignerInfo(ie);W.push(ue)}return W},this.getSignerInfo=function(ce){var W={},ne=le(ce,0),X=q.getInt(ce,ne[0],-1);X!=-1&&(W.version=X);var ie=U(ce,ne[1]),ue=this.getIssuerAndSerialNumber(ie);W.id=ue;var ve=U(ce,ne[2]),ze=A.getAlgorithmIdentifierName(ve);W.hashalg=ze;var tt=J(ce,0,["[0]"]);if(tt!=null){var nt=this.getAttributeList(tt);W.sattrs=nt}var it=J(ce,0,[3]),_e=A.getAlgorithmIdentifierName(it);W.sigalg=_e;var Ie=te(ce,0,[4]);W.sighex=Ie;var Ae=J(ce,0,["[1]"]);if(Ae!=null){var Te=this.getAttributeList(Ae);W.uattrs=Te}return W},this.getSignerIdentifier=function(ce){if(ce.substr(0,2)=="30")return this.getIssuerAndSerialNumber(ce);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(ce){var W={type:"isssn"},ne=le(ce,0),X=U(ce,ne[0]);W.issuer=A.getX500Name(X);var ie=H(ce,ne[1]);return W.serial={hex:ie},W},this.getAttributeList=function(ce){for(var W=[],ne=le(ce,0),X=0;X<ne.length;X++){var ie=U(ce,ne[X]),ue=this.getAttribute(ie);W.push(ue)}return{array:W}},this.getAttribute=function(ce){var W={},ne=le(ce,0),X=q.getOID(ce,ne[0]),ie=B.asn1.x509.OID.oid2name(X);W.attr=ie;var ue=U(ce,ne[1]),ve=le(ue,0);if(ve.length==1)W.valhex=U(ue,ve[0]);else{for(var ze=[],tt=0;tt<ve.length;tt++)ze.push(U(ue,ve[tt]));W.valhex=ze}return ie=="contentType"?this.setContentType(W):ie=="messageDigest"?this.setMessageDigest(W):ie=="signingTime"?this.setSigningTime(W):ie=="signingCertificate"?this.setSigningCertificate(W):ie=="signingCertificateV2"?this.setSigningCertificateV2(W):ie=="signaturePolicyIdentifier"&&this.setSignaturePolicyIdentifier(W),W},this.setContentType=function(ce){var W=q.getOIDName(ce.valhex,0,null);W!=null&&(ce.type=W,delete ce.valhex)},this.setSigningTime=function(ce){var W=H(ce.valhex,0),ne=Ln(W);ce.str=ne,delete ce.valhex},this.setMessageDigest=function(ce){var W=H(ce.valhex,0);ce.hex=W,delete ce.valhex},this.setSigningCertificate=function(ce){var W=le(ce.valhex,0);if(W.length>0){for(var ne=U(ce.valhex,W[0]),X=le(ne,0),ie=[],ue=0;ue<X.length;ue++){var ve=U(ne,X[ue]),ze=this.getESSCertID(ve);ie.push(ze)}ce.array=ie}if(W.length>1){var tt=U(ce.valhex,W[1]);ce.polhex=tt}delete ce.valhex},this.setSignaturePolicyIdentifier=function(ce){var W=le(ce.valhex,0);if(W.length>0){var ne=q.getOID(ce.valhex,W[0]);ce.oid=ne}if(W.length>1){var X=new N,ie=le(ce.valhex,W[1]),ue=U(ce.valhex,ie[0]),ve=X.getAlgorithmIdentifierName(ue);ce.alg=ve;var ze=H(ce.valhex,ie[1]);ce.hash=ze}delete ce.valhex},this.setSigningCertificateV2=function(ce){var W=le(ce.valhex,0);if(W.length>0){for(var ne=U(ce.valhex,W[0]),X=le(ne,0),ie=[],ue=0;ue<X.length;ue++){var ve=U(ne,X[ue]),ze=this.getESSCertIDv2(ve);ie.push(ze)}ce.array=ie}if(W.length>1){var tt=U(ce.valhex,W[1]);ce.polhex=tt}delete ce.valhex},this.getESSCertID=function(ce){var W={},ne=le(ce,0);if(ne.length>0){var X=H(ce,ne[0]);W.hash=X}if(ne.length>1){var ie=U(ce,ne[1]),ue=this.getIssuerSerial(ie);ue.serial!=null&&(W.serial=ue.serial),ue.issuer!=null&&(W.issuer=ue.issuer)}return W},this.getESSCertIDv2=function(ce){var W={},ne=le(ce,0);if(ne.length<1||3<ne.length)throw new P("wrong number of elements");var X=0;if(ce.substr(ne[0],2)=="30"){var ie=U(ce,ne[0]);W.alg=A.getAlgorithmIdentifierName(ie),X++}else W.alg="sha256";var ue=H(ce,ne[X]);if(W.hash=ue,ne.length>X+1){var ve=U(ce,ne[X+1]),ze=this.getIssuerSerial(ve);W.issuer=ze.issuer,W.serial=ze.serial}return W},this.getIssuerSerial=function(ce){var W={},ne=le(ce,0),X=U(ce,ne[0]),ie=A.getGeneralNames(X),ue=ie[0].dn;W.issuer=ue;var ve=H(ce,ne[1]);return W.serial={hex:ve},W},this.getCertificateSet=function(ce){for(var W=le(ce,0),ne=[],X=0;X<W.length;X++){var ie=U(ce,W[X]);if(ie.substr(0,2)=="30"){var ue=Yn(ie,"CERTIFICATE");ne.push(ue)}}return{array:ne,sortflag:!1}}},(typeof B>"u"||!B)&&(B={}),(typeof B.asn1>"u"||!B.asn1)&&(B.asn1={}),(typeof B.asn1.tsp>"u"||!B.asn1.tsp)&&(B.asn1.tsp={}),B.asn1.tsp.TimeStampToken=function(P){var N=B,A=N.asn1,q=A.tsp;q.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var H=new q.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=H.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.TimeStampToken,B.asn1.cms.SignedData),B.asn1.tsp.TSTInfo=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.DERInteger,U=A.DERBoolean,Q=A.DERGeneralizedTime,J=A.DERObjectIdentifier,ae=A.DERTaggedObject,te=A.tsp,le=te.MessageImprint,ce=te.Accuracy;A.x509.X500Name;var W=A.x509.GeneralName;if(te.TSTInfo.superclass.constructor.call(this),this.dVersion=new H({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var ne=[this.dVersion];if(this.dPolicy==null)throw new Error("policy shall be specified.");if(ne.push(this.dPolicy),this.dMessageImprint==null)throw new Error("messageImprint shall be specified.");if(ne.push(this.dMessageImprint),this.dSerial==null)throw new Error("serialNumber shall be specified.");if(ne.push(this.dSerial),this.dGenTime==null)throw new Error("genTime shall be specified.");ne.push(this.dGenTime),this.dAccuracy!=null&&ne.push(this.dAccuracy),this.dOrdering!=null&&ne.push(this.dOrdering),this.dNonce!=null&&ne.push(this.dNonce),this.dTsa!=null&&ne.push(this.dTsa);var X=new q({array:ne});return this.hTLV=X.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0){if(typeof P.policy=="string"){if(!P.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new J({oid:P.policy})}P.messageImprint!==void 0&&(this.dMessageImprint=new le(P.messageImprint)),P.serial!==void 0&&(this.dSerial=new H(P.serial)),P.genTime!==void 0&&(this.dGenTime=new Q(P.genTime)),P.accuracy!==void 0&&(this.dAccuracy=new ce(P.accuracy)),P.ordering!==void 0&&P.ordering==!0&&(this.dOrdering=new U),P.nonce!==void 0&&(this.dNonce=new H(P.nonce)),P.tsa!==void 0&&(this.dTsa=new ae({tag:"a0",explicit:!0,obj:new W({dn:P.tsa})}))}},wt(B.asn1.tsp.TSTInfo,B.asn1.ASN1Object),B.asn1.tsp.Accuracy=function(P){var N=B,A=N.asn1,q=A.ASN1Util.newObject;A.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var H=this.params,U=[];return H.seconds!=null&&typeof H.seconds=="number"&&U.push({int:H.seconds}),H.millis!=null&&typeof H.millis=="number"&&U.push({tag:{tagi:"80",obj:{int:H.millis}}}),H.micros!=null&&typeof H.micros=="number"&&U.push({tag:{tagi:"81",obj:{int:H.micros}}}),q({seq:U}).tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.Accuracy,B.asn1.ASN1Object),B.asn1.tsp.MessageImprint=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.DEROctetString,U=A.x509,Q=U.AlgorithmIdentifier;A.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var J=this.params,ae=new Q({name:J.alg}),te=new H({hex:J.hash}),le=new q({array:[ae,te]});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.tsp.MessageImprint,B.asn1.ASN1Object),B.asn1.tsp.TimeStampReq=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.DERInteger,U=A.DERBoolean;A.ASN1Object;var Q=A.DERObjectIdentifier,J=A.tsp,ae=J.MessageImprint;J.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var te=this.params,le=[];le.push(new H({int:1})),te.messageImprint instanceof B.asn1.ASN1Object?le.push(te.messageImprint):le.push(new ae(te.messageImprint)),te.policy!=null&&le.push(new Q(te.policy)),te.nonce!=null&&le.push(new H(te.nonce)),te.certreq==!0&&le.push(new U);var ce=new q({array:le});return ce.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.TimeStampReq,B.asn1.ASN1Object),B.asn1.tsp.TimeStampResp=function(P){var N=B,A=N.asn1,q=A.DERSequence;A.ASN1Object;var H=A.tsp,U=H.PKIStatusInfo;H.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var Q=this.params,J=[];if(Q.econtent!=null||Q.tst!=null)if(Q.statusinfo!=null?J.push(new U(Q.statusinfo)):J.push(new U("granted")),Q.econtent!=null)J.push(new H.TimeStampToken(Q).getContentInfo());else if(Q.tst instanceof A.ASN1Object)J.push(Q.tst);else throw new Error("improper member tst value");else if(Q.statusinfo!=null)J.push(new U(Q.statusinfo));else throw new Error("parameter for token nor statusinfo not specified");var ae=new q({array:J});return ae.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.TimeStampResp,B.asn1.ASN1Object),B.asn1.tsp.PKIStatusInfo=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence,U=q.tsp,Q=U.PKIStatus,J=U.PKIFreeText,ae=U.PKIFailureInfo;U.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var te=this.params,le=[];if(typeof te=="string")le.push(new Q(te));else{if(te.status==null)throw new N("property 'status' unspecified");le.push(new Q(te.status)),te.statusstr!=null&&le.push(new J(te.statusstr)),te.failinfo!=null&&le.push(new ae(te.failinfo))}var ce=new H({array:le});return ce.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.PKIStatusInfo,B.asn1.ASN1Object),B.asn1.tsp.PKIStatus=function(P){var N=Error,A=B,q=A.asn1,H=q.DERInteger,U=q.tsp;U.PKIStatus.superclass.constructor.call(this);var Q={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var J=this.params,ae;if(typeof J=="string")try{ae=Q[J]}catch{throw new N("undefined name: "+J)}else if(typeof J=="number")ae=J;else throw new N("unsupported params");return new H({int:ae}).tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.PKIStatus,B.asn1.ASN1Object),B.asn1.tsp.PKIFreeText=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence,U=q.DERUTF8String,Q=q.tsp;Q.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var J=this.params;if(!J instanceof Array)throw new N("wrong params: not array");for(var ae=[],te=0;te<J.length;te++)ae.push(new U({str:J[te]}));var le=new H({array:ae});return le.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.PKIFreeText,B.asn1.ASN1Object),B.asn1.tsp.PKIFailureInfo=function(P){var N=Error,A=B,q=A.asn1,H=q.DERBitString,U=q.tsp,Q=U.PKIFailureInfo,J={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};Q.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var ae=this.params,te=0;if(typeof ae=="number"&&0<=ae&&ae<=25){te|=1<<ae;for(var le=te.toString(2),ce="",W=le.length-1;W>=0;W--)ce+=le[W];return ce}else{if(typeof ae=="string"&&J[ae]!=null)return Fd([ae],J);if(typeof ae=="object"&&ae.length!=null)return Fd(ae,J);throw new N("wrong params")}},this.tohex=function(){this.params;var ae=this.getBinValue();return new H({bin:ae}).tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.tsp.PKIFailureInfo,B.asn1.ASN1Object),B.asn1.tsp.AbstractTSAAdapter=function(P){this.getTSTHex=function(N,A){throw"not implemented yet"}},B.asn1.tsp.SimpleTSAAdapter=function(P){var N=B,A=N.asn1,q=A.tsp,H=N.crypto.Util.hashHex;q.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(U,Q){var J=H(U,Q);this.params.econtent.content.messageImprint={alg:Q,hash:J},this.params.econtent.content.serial={int:this.serial++};var ae=Math.floor(Math.random()*1e9);this.params.econtent.content.nonce={int:ae};var te=new q.TimeStampToken(this.params);return te.getContentInfoEncodedHex()},P!==void 0&&(this.params=P)},wt(B.asn1.tsp.SimpleTSAAdapter,B.asn1.tsp.AbstractTSAAdapter),B.asn1.tsp.FixedTSAAdapter=function(P){var N=B,A=N.asn1,q=A.tsp,H=N.crypto.Util.hashHex;q.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(U,Q){var J=H(U,Q);this.params.econtent.content.messageImprint={alg:Q,hash:J};var ae=new q.TimeStampToken(this.params);return ae.getContentInfoEncodedHex()},P!==void 0&&(this.params=P)},wt(B.asn1.tsp.FixedTSAAdapter,B.asn1.tsp.AbstractTSAAdapter),B.asn1.tsp.TSPUtil=new function(){},B.asn1.tsp.TSPUtil.newTimeStampToken=function(P){return new B.asn1.tsp.TimeStampToken(P)},B.asn1.tsp.TSPUtil.parseTimeStampReq=function(P){var N=new B.asn1.tsp.TSPParser;return N.getTimeStampReq(P)},B.asn1.tsp.TSPUtil.parseMessageImprint=function(P){var N=new B.asn1.tsp.TSPParser;return N.getMessageImprint(P)},B.asn1.tsp.TSPParser=function(){var P=an,N=new P,A=dt,q=A.getV,H=A.getTLV,U=A.getIdxbyList;A.getTLVbyListEx;var Q=A.getChildIdx,J=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],ae={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(te){var le=Q(te,0);if(le.length==1)return this.getPKIStatusInfo(H(te,le[0]));if(le.length>1){var ce=this.getPKIStatusInfo(H(te,le[0])),W=H(te,le[1]),ne=this.getToken(W);return ne.statusinfo=ce,ne}},this.getToken=function(te){var le=new B.asn1.cms.CMSParser,ce=le.getCMSSignedData(te);return this.setTSTInfo(ce),ce},this.setTSTInfo=function(te){var le=te.econtent;if(le.type=="tstinfo"){var ce=le.content.hex,W=this.getTSTInfo(ce);le.content=W}},this.getTSTInfo=function(te){var le={},ce=Q(te,0),W=q(te,ce[1]);le.policy=by(W);var ne=H(te,ce[2]);le.messageImprint=this.getMessageImprint(ne);var X=q(te,ce[3]);le.serial={hex:X};var ie=q(te,ce[4]);le.genTime={str:Ln(ie)};var ue=0;if(ce.length>5&&te.substr(ce[5],2)=="30"){var ve=H(te,ce[5]);le.accuracy=this.getAccuracy(ve),ue++}if(ce.length>5+ue&&te.substr(ce[5+ue],2)=="01"){var ze=q(te,ce[5+ue]);ze=="ff"&&(le.ordering=!0),ue++}if(ce.length>5+ue&&te.substr(ce[5+ue],2)=="02"){var tt=q(te,ce[5+ue]);le.nonce={hex:tt},ue++}if(ce.length>5+ue&&te.substr(ce[5+ue],2)=="a0"){var nt=H(te,ce[5+ue]);nt="30"+nt.substr(2),pGeneralNames=N.getGeneralNames(nt);var it=pGeneralNames[0].dn;le.tsa=it,ue++}if(ce.length>5+ue&&te.substr(ce[5+ue],2)=="a1"){var _e=H(te,ce[5+ue]);_e="30"+_e.substr(2);var Ie=N.getExtParamArray(_e);le.ext=Ie,ue++}return le},this.getAccuracy=function(te){for(var le={},ce=Q(te,0),W=0;W<ce.length;W++){var ne=te.substr(ce[W],2),X=q(te,ce[W]),ie=parseInt(X,16);ne=="02"?le.seconds=ie:ne=="80"?le.millis=ie:ne=="81"&&(le.micros=ie)}return le},this.getMessageImprint=function(te){if(te.substr(0,2)!="30")throw new Error("head of messageImprint hex shall be x30");var le={};Q(te,0);var ce=U(te,0,[0,0]),W=q(te,ce),ne=A.hextooidstr(W),X=B.asn1.x509.OID.oid2name(ne);if(X=="")throw new Error("hashAlg name undefined: "+ne);var ie=X,ue=U(te,0,[1]);return le.alg=ie,le.hash=q(te,ue),le},this.getPKIStatusInfo=function(te){var le={},ce=Q(te,0),W=0;try{var ne=q(te,ce[0]),X=parseInt(ne,16);le.status=J[X]}catch{}if(ce.length>1&&te.substr(ce[1],2)=="30"){var ie=H(te,ce[1]);le.statusstr=this.getPKIFreeText(ie),W++}if(ce.length>W&&te.substr(ce[1+W],2)=="03"){var ue=H(te,ce[1+W]);le.failinfo=this.getPKIFailureInfo(ue)}return le},this.getPKIFreeText=function(te){for(var le=[],ce=Q(te,0),W=0;W<ce.length;W++)le.push(A.getString(te,ce[W]));return le},this.getPKIFailureInfo=function(te){var le=A.getInt(te,0);return ae[le]!=null?ae[le]:le},this.getTimeStampReq=function(te){var le={};le.certreq=!1;var ce=Q(te,0);if(ce.length<2)throw new Error("TimeStampReq must have at least 2 items");var W=H(te,ce[1]);le.messageImprint=B.asn1.tsp.TSPUtil.parseMessageImprint(W);for(var ne=2;ne<ce.length;ne++){var X=ce[ne],ie=te.substr(X,2);if(ie=="06"){var ue=q(te,X);le.policy=A.hextooidstr(ue)}ie=="02"&&(le.nonce=q(te,X)),ie=="01"&&(le.certreq=!0)}return le}},(typeof B>"u"||!B)&&(B={}),(typeof B.asn1>"u"||!B.asn1)&&(B.asn1={}),(typeof B.asn1.cades>"u"||!B.asn1.cades)&&(B.asn1.cades={}),B.asn1.cades.SignaturePolicyIdentifier=function(P){var N=B,A=N.asn1,q=A.cades,H=q.SignaturePolicyId;q.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new H(this.params)]},this.setByParam=function(U){this.params=U},P!=null&&this.setByParam(P)},wt(B.asn1.cades.SignaturePolicyIdentifier,B.asn1.cms.Attribute),B.asn1.cades.SignaturePolicyId=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.DERObjectIdentifier,U=A.x509;U.AlgorithmIdentifier;var Q=A.cades,J=Q.SignaturePolicyId,ae=Q.OtherHashAlgAndValue;J.superclass.constructor.call(this),this.params=null,this.tohex=function(){var te=this.params,le=[];le.push(new H(te.oid)),le.push(new ae(te));var ce=new q({array:le});return ce.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(te){this.params=te},P!=null&&this.setByParam(P)},wt(B.asn1.cades.SignaturePolicyId,B.asn1.ASN1Object),B.asn1.cades.OtherHashAlgAndValue=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence,U=q.DEROctetString,Q=q.x509,J=Q.AlgorithmIdentifier,ae=q.cades,te=ae.OtherHashAlgAndValue;te.superclass.constructor.call(this),this.params=null,this.tohex=function(){var le=this.params;if(le.alg==null)throw new N("property 'alg' not specified");if(le.hash==null&&le.cert==null)throw new N("property 'hash' nor 'cert' not specified");var ce=null;if(le.hash!=null)ce=le.hash;else if(le.cert!=null){if(typeof le.cert!="string")throw new N("cert not string");var W=le.cert;le.cert.indexOf("-----BEGIN")!=-1&&(W=nr(le.cert)),ce=B.crypto.Util.hashHex(W,le.alg)}var ne=[];ne.push(new J({name:le.alg})),ne.push(new U({hex:ce}));var X=new H({array:ne});return X.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cades.OtherHashAlgAndValue,B.asn1.ASN1Object),B.asn1.cades.OtherHashValue=function(P){B.asn1.cades.OtherHashValue.superclass.constructor.call(this);var N=Error,A=B;A.lang.String.isHex;var q=A.asn1,H=q.DEROctetString;A.crypto.Util.hashHex,this.params=null,this.tohex=function(){var U=this.params;if(U.hash==null&&U.cert==null)throw new N("hash or cert not specified");var Q=null;if(U.hash!=null)Q=U.hash;else if(U.cert!=null){if(typeof U.cert!="string")throw new N("cert not string");var J=U.cert;U.cert.indexOf("-----BEGIN")!=-1&&(J=nr(U.cert)),Q=B.crypto.Util.hashHex(J,"sha1")}return new H({hex:Q}).tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cades.OtherHashValue,B.asn1.ASN1Object),B.asn1.cades.SignatureTimeStamp=function(P){var N=Error,A=B,q=A.lang.String.isHex,H=A.asn1,U=H.ASN1Object;H.x509;var Q=H.cades;Q.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var J=this.params;if(J.tst!=null)if(q(J.tst)){var ae=new U;return ae.hTLV=J.tst,[ae]}else{if(J.tst instanceof U)return[J.tst];throw new N("params.tst has wrong value")}else if(J.res!=null){var te=J.res;if(te instanceof U&&(te=te.tohex()),typeof te!="string"||!q(te))throw new N("params.res has wrong value");dt.getTLVbyList(te,0,[1]);var ae=new U;return ae.hTLV=J.tst,[ae]}},P!=null&&this.setByParam(P)},wt(B.asn1.cades.SignatureTimeStamp,B.asn1.cms.Attribute),B.asn1.cades.CompleteCertificateRefs=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence,U=q.cades,Q=U.OtherCertID,J=A.lang.String.isHex;U.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var ae=this.params,te=[],le=0;le<ae.array.length;le++){var ce=ae.array[le];if(typeof ce=="string")if(ce.indexOf("-----BEGIN")!=-1)ce={cert:ce};else if(J(ce))ce={hash:ce};else throw new N("unsupported value: "+ce);ae.alg!=null&&ce.alg==null&&(ce.alg=ae.alg),ae.hasis!=null&&ce.hasis==null&&(ce.hasis=ae.hasis);var W=new Q(ce);te.push(W)}var ne=new H({array:te});return[ne]},P!=null&&this.setByParam(P)},wt(B.asn1.cades.CompleteCertificateRefs,B.asn1.cms.Attribute),B.asn1.cades.OtherCertID=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.cms,U=H.IssuerSerial,Q=A.cades,J=Q.OtherHashValue,ae=Q.OtherHashAlgAndValue;Q.OtherCertID.superclass.constructor.call(this),this.params=P,this.tohex=function(){var te=this.params;typeof te=="string"&&(te.indexOf("-----BEGIN")!=-1?te={cert:te}:_isHex(te)&&(te={hash:te}));var le=[],ce=null;if(te.alg!=null?ce=new ae(te):ce=new J(te),le.push(ce),te.cert!=null&&te.hasis==!0||te.issuer!=null&&te.serial!=null){var W=new U(te);le.push(W)}var ne=new q({array:le});return ne.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cades.OtherCertID,B.asn1.ASN1Object),B.asn1.cades.OtherHash=function(P){var N=B,A=N.asn1;A.cms;var q=A.cades,H=q.OtherHashAlgAndValue,U=q.OtherHashValue;N.crypto.Util.hashHex;var Q=N.lang.String.isHex;q.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var J=this.params;typeof J=="string"&&(J.indexOf("-----BEGIN")!=-1?J={cert:J}:Q(J)&&(J={hash:J}));var ae=null;return J.alg!=null?ae=new H(J):ae=new U(J),ae.tohex()},this.getEncodedHex=function(){return this.tohex()},P!=null&&this.setByParam(P)},wt(B.asn1.cades.OtherHash,B.asn1.ASN1Object),B.asn1.cades.CAdESUtil=new function(){},B.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(P){var N=new B.asn1.cms.CMSParser,A=N.getCMSSignedData(P);return A},B.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(P,N,A){var q=dt,H=q.getChildIdx,U=q.getTLV,Q=q.getV,J=B,ae=J.asn1,te=ae.ASN1Object,le=ae.cms,ce=le.AttributeList,W=le.SignerInfo,ne={},X=H(P,N);if(X.length!=6)throw"not supported items for SignerInfo (!=6)";var ie=X.shift();ne.version=U(P,ie);var ue=X.shift();ne.si=U(P,ue);var ve=X.shift();ne.digalg=U(P,ve);var ze=X.shift();ne.sattrs=U(P,ze);var tt=X.shift();ne.sigalg=U(P,tt);var nt=X.shift();ne.sig=U(P,nt),ne.sigval=Q(P,nt);var it=null;return ne.obj=new W,it=new te,it.hTLV=ne.version,ne.obj.dCMSVersion=it,it=new te,it.hTLV=ne.si,ne.obj.dSignerIdentifier=it,it=new te,it.hTLV=ne.digalg,ne.obj.dDigestAlgorithm=it,it=new te,it.hTLV=ne.sattrs,ne.obj.dSignedAttrs=it,it=new te,it.hTLV=ne.sigalg,ne.obj.dSigAlg=it,it=new te,it.hTLV=ne.sig,ne.obj.dSig=it,ne.obj.dUnsignedAttrs=new ce,ne},(typeof B.asn1.csr>"u"||!B.asn1.csr)&&(B.asn1.csr={}),B.asn1.csr.CertificationRequest=function(P){var N=B,A=N.asn1,q=A.DERBitString,H=A.DERSequence,U=A.csr;A.x509;var Q=U.CertificationRequestInfo;U.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(J){this.params=J},this.sign=function(){var J=new Q(this.params).tohex(),ae=new B.crypto.Signature({alg:this.params.sigalg});ae.init(this.params.sbjprvkey),ae.updateHex(J);var te=ae.sign();this.params.sighex=te},this.getPEM=function(){return Yn(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var J=this.params,ae=new B.asn1.csr.CertificationRequestInfo(this.params),te=new B.asn1.x509.AlgorithmIdentifier({name:J.sigalg});if(J.sighex==null&&J.sbjprvkey!=null&&this.sign(),J.sighex==null)throw new Error("sighex or sbjprvkey parameter not defined");var le=new q({hex:"00"+J.sighex}),ce=new H({array:[ae,te,le]});return ce.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.csr.CertificationRequest,B.asn1.ASN1Object),B.asn1.csr.CertificationRequestInfo=function(P){var N=B,A=N.asn1;A.DERBitString;var q=A.DERSequence,H=A.DERInteger,U=A.DERUTF8String,Q=A.DERTaggedObject,J=A.ASN1Util.newObject,ae=A.csr,te=A.x509,le=te.X500Name,ce=te.Extensions,W=te.SubjectPublicKeyInfo;ae.AttributeList,ae.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(X){X!=null&&(this.params=X)},this.tohex=function(){var X=this.params,ie=[];if(ie.push(new H({int:0})),ie.push(new le(X.subject)),ie.push(new W(Cn.getKey(X.sbjpubkey))),X.attrs!=null){var ue=ne(X.attrs),ve=J({tag:{tage:"a0",obj:ue}});ie.push(ve)}else if(X.extreq!=null){var ze=new ce(X.extreq),ve=J({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[ze]}]}}});ie.push(ve)}else ie.push(new Q({tag:"a0",explicit:!1,obj:new U({str:""})}));var tt=new q({array:ie});return tt.tohex()},this.getEncodedHex=function(){return this.tohex()};function ne(X){for(var ie=Error,ue=B.asn1.x509.Extensions,ve=[],ze=0;ze<X.length;ze++){var tt=X[ze],nt=tt.attr;if(nt=="extensionRequest"){var it=new ue(tt.ext),_e={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[it]}]};ve.push(_e)}else if(nt=="unstructuredName"){var _e={seq:[{oid:"1.2.840.113549.1.9.2"},{set:tt.names}]};ve.push(_e)}else if(nt=="challengePassword"){var _e={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:tt.password}]}]};ve.push(_e)}else throw new ie("unknown CSR attribute")}return{set:ve}}P!=null&&this.setByParam(P)},wt(B.asn1.csr.CertificationRequestInfo,B.asn1.ASN1Object),B.asn1.csr.AttributeList=function(P){},wt(B.asn1.csr.AttributeList,B.asn1.ASN1Object),B.asn1.csr.CSRUtil=new function(){},B.asn1.csr.CSRUtil.newCSRPEM=function(P){var N=B.asn1.csr,A=new N.CertificationRequest(P),q=A.getPEM();return q},B.asn1.csr.CSRUtil.getParam=function(P,N){var A=dt,q=A.getV,H=A.getIdxbyList,U=A.getTLVbyList,Q=A.getTLVbyListEx,J=A.getVbyListEx,ae=function(ze){var tt=H(ze,0,[0,3,0,0],"06");return q(ze,tt)!="2a864886f70d01090e"?null:U(ze,0,[0,3,0,1,0],"30")},te={};if(P.indexOf("-----BEGIN CERTIFICATE REQUEST")==-1)throw new Error("argument is not PEM file");var le=nr(P,"CERTIFICATE REQUEST");N&&(te.tbs=U(le,0,[0]));try{var ce=Q(le,0,[0,1]);if(ce=="3000")te.subject={};else{var ie=new an;te.subject=ie.getX500Name(ce)}}catch{}var W=Q(le,0,[0,2]),ne=Cn.getKey(W,null,"pkcs8pub");te.sbjpubkey=Cn.getPEM(ne,"PKCS8PUB");var X=ae(le),ie=new an;X!=null&&(te.extreq=ie.getExtParamArray(X));try{var ue=Q(le,0,[1],"30"),ie=new an;te.sigalg=ie.getAlgorithmIdentifierName(ue)}catch{}try{var ve=J(le,0,[2]);te.sighex=ve}catch{}return te},B.asn1.csr.CSRUtil.verifySignature=function(P){try{var N=null;if(typeof P=="string"&&P.indexOf("-----BEGIN CERTIFICATE REQUEST")!=-1?N=B.asn1.csr.CSRUtil.getParam(P,!0):typeof P=="object"&&P.sbjpubkey!=null&&P.sigalg!=null&&P.sighex!=null&&P.tbs!=null&&(N=P),N==null)return!1;var A=new B.crypto.Signature({alg:N.sigalg});return A.init(N.sbjpubkey),A.updateHex(N.tbs),A.verify(N.sighex)}catch(q){return alert(q),!1}},(typeof B>"u"||!B)&&(B={}),(typeof B.asn1>"u"||!B.asn1)&&(B.asn1={}),(typeof B.asn1.ocsp>"u"||!B.asn1.ocsp)&&(B.asn1.ocsp={}),B.asn1.ocsp.DEFAULT_HASH="sha1",B.asn1.ocsp.OCSPResponse=function(P){B.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),B.asn1.DEREnumerated;var N=B.asn1.ASN1Util.newObject,A=B.asn1.ocsp.ResponseBytes,q=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var H=this.params.resstatus;return typeof H=="number"?H:typeof H!="string"?-1:q.indexOf(H)},this.setByParam=function(H){this.params=H},this.tohex=function(){var H=this.params,U=this._getStatusCode();if(U==-1)throw new Error("responseStatus not supported: "+H.resstatus);if(U!=0)return N({seq:[{enum:{int:U}}]}).tohex();var Q=new A(H);return N({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:Q}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.OCSPResponse,B.asn1.ASN1Object),B.asn1.ocsp.ResponseBytes=function(P){B.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var N=B.asn1,A=N.DERSequence,q=N.DERObjectIdentifier,H=N.DEROctetString,U=N.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(Q){this.params=Q},this.tohex=function(){var Q=this.params;if(Q.restype!="ocspBasic")throw new Error("not supported responseType: "+Q.restype);var J=new U(Q),ae=[];ae.push(new q({name:"ocspBasic"})),ae.push(new H({hex:J.tohex()}));var te=new A({array:ae});return te.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.ResponseBytes,B.asn1.ASN1Object),B.asn1.ocsp.BasicOCSPResponse=function(P){B.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var N=Error,A=B.asn1,q=A.ASN1Object,H=A.DERSequence;A.DERGeneralizedTime;var U=A.DERTaggedObject,Q=A.DERBitString;A.x509.Extensions;var J=A.x509.AlgorithmIdentifier,ae=A.ocsp;ae.ResponderID,_SingleResponseList=ae.SingleResponseList,_ResponseData=ae.ResponseData,this.params=null,this.setByParam=function(te){this.params=te},this.sign=function(){var te=this.params,le=te.tbsresp.tohex(),ce=new B.crypto.Signature({alg:te.sigalg});ce.init(te.reskey),ce.updateHex(le),te.sighex=ce.sign()},this.tohex=function(){var te=this.params;te.tbsresp==null&&(te.tbsresp=new _ResponseData(te)),te.sighex==null&&te.reskey!=null&&this.sign();var le=[];if(le.push(te.tbsresp),le.push(new J({name:te.sigalg})),le.push(new Q({hex:"00"+te.sighex})),te.certs!=null&&te.certs.length!=null){for(var ce=[],W=0;W<te.certs.length;W++){var ne=te.certs[W],X=null;if(dt.isASN1HEX(ne))X=ne;else if(ne.match(/-----BEGIN/))X=nr(ne);else throw new N("certs["+W+"] not hex or PEM");ce.push(new q({tlv:X}))}var ie=new H({array:ce});le.push(new U({tag:"a0",explicit:!0,obj:ie}))}var ue=new H({array:le});return ue.tohex()},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.BasicOCSPResponse,B.asn1.ASN1Object),B.asn1.ocsp.ResponseData=function(P){B.asn1.ocsp.ResponseData.superclass.constructor.call(this);var N=B.asn1,A=N.DERSequence,q=N.DERGeneralizedTime,H=N.DERTaggedObject,U=N.x509.Extensions,Q=N.ocsp,J=Q.ResponderID;_SingleResponseList=Q.SingleResponseList,this.params=null,this.tohex=function(){var ae=this.params;ae.respid!=null,ae.prodat!=null,ae.array!=null;var te=[];if(te.push(new J(ae.respid)),te.push(new q(ae.prodat)),te.push(new _SingleResponseList(ae.array)),ae.ext!=null){var le=new U(ae.ext);te.push(new H({tag:"a1",explicit:!0,obj:le}))}var ce=new A({array:te});return ce.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(ae){this.params=ae},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.ResponseData,B.asn1.ASN1Object),B.asn1.ocsp.ResponderID=function(P){B.asn1.ocsp.ResponderID.superclass.constructor.call(this);var N=B,A=N.asn1,q=A.ASN1Util.newObject,H=A.x509.X500Name,U=N.lang.String.isHex,Q=Error;this.params=null,this.tohex=function(){var J=this.params;if(J.key!=null){var ae=null;if(typeof J.key=="string"){if(U(J.key)&&(ae=J.key),J.key.match(/-----BEGIN CERTIFICATE/)){var te=new an(J.key),le=te.getExtSubjectKeyIdentifier();le!=null&&(ae=le.kid.hex)}}else if(J.key instanceof an){var le=J.key.getExtSubjectKeyIdentifier();le!=null&&(ae=le.kid.hex)}if(ae==null)throw new Q("wrong key member value");var ce=q({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:ae}}}});return ce.tohex()}else if(J.name!=null){var W=null;if(typeof J.name=="string"&&J.name.match(/-----BEGIN CERTIFICATE/)){var te=new an(J.name);W=te.getSubject()}else J.name instanceof an?W=J.name.getSubject():typeof J.name=="object"&&(J.name.array!=null||J.name.str!=null)&&(W=J.name);if(W==null)throw new Q("wrong name member value");var ce=q({tag:{tag:"a1",explicit:!0,obj:new H(W)}});return ce.tohex()}throw new Q("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(J){this.params=J},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.ResponderID,B.asn1.ASN1Object),B.asn1.ocsp.SingleResponseList=function(P){B.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var N=B.asn1,A=N.DERSequence,q=N.ocsp.SingleResponse;this.params=null,this.tohex=function(){var H=this.params;if(typeof H!="object"||H.length==null)throw new Error("params not specified properly");for(var U=[],Q=0;Q<H.length;Q++)U.push(new q(H[Q]));var J=new A({array:U});return J.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(H){this.params=H},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.SingleResponseList,B.asn1.ASN1Object),B.asn1.ocsp.SingleResponse=function(P){var N=Error,A=B,q=A.asn1,H=q.DERSequence,U=q.DERGeneralizedTime,Q=q.DERTaggedObject,J=q.ocsp,ae=J.CertID,te=J.CertStatus,le=q.x509,ce=le.Extensions;J.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var W=this.params,ne=[];if(W.certid==null)throw new N("certid unspecified");if(W.status==null)throw new N("status unspecified");if(W.thisupdate==null)throw new N("thisupdate unspecified");if(ne.push(new ae(W.certid)),ne.push(new te(W.status)),ne.push(new U(W.thisupdate)),W.nextupdate!=null){var X=new U(W.nextupdate);ne.push(new Q({tag:"a0",explicit:!0,obj:X}))}if(W.ext!=null){var ie=new ce(W.ext);ne.push(new Q({tag:"a1",explicit:!0,obj:ie}))}var ue=new H({array:ne});return ue.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(W){this.params=W},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.SingleResponse,B.asn1.ASN1Object),B.asn1.ocsp.CertID=function(P){var N=B,A=N.asn1,q=A.DEROctetString,H=A.DERInteger,U=A.DERSequence,Q=A.x509,J=Q.AlgorithmIdentifier,ae=A.ocsp;ae.DEFAULT_HASH;var te=N.crypto,le=te.Util.hashHex,ce=an,W=dt,ne=W.getVbyList;ae.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(X,ie,ue,ve){ve==null&&(ve=this.DEFAULT_HASH),this.params={alg:ve,issname:X,isskey:ie,sbjsn:ue}},this.setByCert=function(X,ie,ue){ue==null&&(ue=this.DEFAULT_HASH),this.params={alg:ue,issuerCert:X,subjectCert:ie}},this.getParamByCerts=function(X,ie,ue){ue==null&&(ue=this.DEFAULT_HASH);var ve=new ce(X),ze=new ce(ie),tt=le(ve.getSubjectHex(),ue),nt=ve.getPublicKeyHex(),it=le(ne(nt,0,[1],"03",!0),ue),_e=ze.getSerialNumberHex(),Ie={alg:ue,issname:tt,isskey:it,sbjsn:_e};return Ie},this.tohex=function(){if(typeof this.params!="object")throw new Error("params not set");var X=this.params,ie,ue,ve,ze;if(X.alg==null?ze=this.DEFAULT_HASH:ze=X.alg,X.issuerCert!=null&&X.subjectCert!=null){var tt=this.getParamByCerts(X.issuerCert,X.subjectCert,ze);ie=tt.issname,ue=tt.isskey,ve=tt.sbjsn}else if(X.issname!=null&&X.isskey!=null&&X.sbjsn!=null)ie=X.issname,ue=X.isskey,ve=X.sbjsn;else throw new Error("required param members not defined");var nt=new J({name:ze}),it=new q({hex:ie}),_e=new q({hex:ue}),Ie=new H({hex:ve}),Ae=new U({array:[nt,it,_e,Ie]});return this.hTLV=Ae.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.CertID,B.asn1.ASN1Object),B.asn1.ocsp.CertStatus=function(P){B.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params;if(N.status=="good")return"8000";if(N.status=="unknown")return"8200";if(N.status=="revoked"){var A=[{gentime:{str:N.time}}];N.reason!=null&&A.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:N.reason}}}});var q={tag:"a1",explicit:!1,obj:{seq:A}};return B.asn1.ASN1Util.newObject({tag:q}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(N){this.params=N},P!==void 0&&this.setByParam(P)},wt(B.asn1.ocsp.CertStatus,B.asn1.ASN1Object),B.asn1.ocsp.Request=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.ocsp;if(H.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var Q=[];if(this.dReqCert===null)throw"reqCert not set";Q.push(this.dReqCert);var J=new q({array:Q});return this.hTLV=J.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof P<"u"){var U=new H.CertID(P);this.dReqCert=U}},wt(B.asn1.ocsp.Request,B.asn1.ASN1Object),B.asn1.ocsp.TBSRequest=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.ocsp;H.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(U){for(var Q=[],J=0;J<U.length;J++){var ae=new H.Request(U[0]);Q.push(ae)}this.dRequestList=Q},this.tohex=function(){var U=[];if(this.version!==0)throw"not supported version: "+this.version;if(this.dRequestorName!==null)throw"requestorName not supported";var Q=new q({array:this.dRequestList});if(U.push(Q),this.dRequestExt!==null)throw"requestExtensions not supported";var J=new q({array:U});return this.hTLV=J.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&P.reqList!==void 0&&this.setRequestListByParam(P.reqList)},wt(B.asn1.ocsp.TBSRequest,B.asn1.ASN1Object),B.asn1.ocsp.OCSPRequest=function(P){var N=B,A=N.asn1,q=A.DERSequence,H=A.ocsp;if(H.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var Q=[];if(this.dTbsRequest!==null)Q.push(this.dTbsRequest);else throw"tbsRequest not set";if(this.dOptionalSignature!==null)throw"optionalSignature not supported";var J=new q({array:Q});return this.hTLV=J.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},P!==void 0&&P.reqList!==void 0){var U=new H.TBSRequest(P);this.dTbsRequest=U}},wt(B.asn1.ocsp.OCSPRequest,B.asn1.ASN1Object),B.asn1.ocsp.OCSPUtil={},B.asn1.ocsp.OCSPUtil.getRequestHex=function(P,N,A){var q=B,H=q.asn1,U=H.ocsp;A===void 0&&(A=U.DEFAULT_HASH);var Q={alg:A,issuerCert:P,subjectCert:N},J=new U.OCSPRequest({reqList:[Q]});return J.tohex()},B.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(P){var N=dt,A=N.getVbyList,q=N.getVbyListEx,H=N.getIdxbyList;N.getIdxbyListEx;var U=N.getV,Q={};try{var J=q(P,0,[0],"0a");Q.responseStatus=parseInt(J,16)}catch{}if(Q.responseStatus!==0)return Q;try{var ae=H(P,0,[1,0,1,0,0,2,0,1]);P.substr(ae,2)==="80"?Q.certStatus="good":P.substr(ae,2)==="a1"?(Q.certStatus="revoked",Q.revocationTime=Ln(A(P,ae,[0]))):P.substr(ae,2)==="82"&&(Q.certStatus="unknown")}catch{}try{var te=H(P,0,[1,0,1,0,0,2,0,2]);Q.thisUpdate=Ln(U(P,te))}catch{}try{var le=H(P,0,[1,0,1,0,0,2,0,3]);P.substr(le,2)==="a0"&&(Q.nextUpdate=Ln(A(P,le,[0])))}catch{}return Q},B.asn1.ocsp.OCSPParser=function(){var P=Error,N=an,A=new N,q=dt,H=q.getV,U=q.getTLV,Q=q.getIdxbyList,J=q.getVbyList,ae=q.getTLVbyList,te=q.getVbyListEx,le=q.getTLVbyListEx,ce=q.getChildIdx;this.getOCSPRequest=function(W){var ne=ce(W,0);if(ne.length!=1&&ne.length!=2)throw new P("wrong number elements: "+ne.length);var X=this.getTBSRequest(U(W,ne[0]));return X},this.getTBSRequest=function(W){var ne={},X=le(W,0,[0],"30");ne.array=this.getRequestList(X);var ie=le(W,0,["[2]",0],"30");return ie!=null&&(ne.ext=A.getExtParamArray(ie)),ne},this.getRequestList=function(W){for(var ne=[],X=ce(W,0),ie=0;ie<X.length;ie++){var W=U(W,X[ie]);ne.push(this.getRequest(W))}return ne},this.getRequest=function(W){var ne=ce(W,0);if(ne.length!=1&&ne.length!=2)throw new P("wrong number elements: "+ne.length);var X=this.getCertID(U(W,ne[0]));if(ne.length==2){var ie=Q(W,0,[1,0]);X.ext=A.getExtParamArray(U(W,ie))}return X},this.getCertID=function(W){var ne=ce(W,0);if(ne.length!=4)throw new P("wrong number elements: "+ne.length);var X=new N,ie={};return ie.alg=X.getAlgorithmIdentifierName(U(W,ne[0])),ie.issname=H(W,ne[1]),ie.isskey=H(W,ne[2]),ie.sbjsn=H(W,ne[3]),ie},this.getOCSPResponse=function(W){var ne=ce(W,0),X,ie=H(W,ne[0]),ue=parseInt(ie);if(ne.length==1)return{resstatus:ue};var ve=ae(W,0,[1,0]);return X=this.getResponseBytes(ve),X.resstatus=ue,X},this.getResponseBytes=function(W){var ne=ce(W,0),X,ie=ae(W,0,[1,0]);X=this.getBasicOCSPResponse(ie);var ue=H(W,ne[0]);return X.restype=B.asn1.x509.OID.oid2name(by(ue)),X},this.getBasicOCSPResponse=function(W){var ne=ce(W,0),X;X=this.getResponseData(U(W,ne[0]));var ie=new an;X.alg=ie.getAlgorithmIdentifierName(U(W,ne[1]));var ue=H(W,ne[2]);X.sighex=ue.substr(2);var ve=te(W,0,["[0]"]);if(ve!=null){for(var ze=ce(ve,0),tt=[],nt=0;nt<ze.length;nt++){var it=U(ve,ze[nt]);tt.push(it)}X.certs=tt}return X},this.getResponseData=function(W){var ne=ce(W,0),X=ne.length,ie={},ue=0;W.substr(ne[0],2)=="a0"&&ue++,ie.respid=this.getResponderID(U(W,ne[ue++]));var ve=H(W,ne[ue++]);if(ie.prodat=Ln(ve),ie.array=this.getSingleResponseList(U(W,ne[ue++])),W.substr(ne[X-1],2)=="a1"){var ze=ae(W,ne[X-1],[0]),tt=new an;ie.ext=tt.getExtParamArray(ze)}return ie},this.getResponderID=function(W){var ne={};if(W.substr(0,2)=="a2"){var X=J(W,0,[0]);ne.key=X}if(W.substr(0,2)=="a1"){var ie=ae(W,0,[0]),ue=new an;ne.name=ue.getX500Name(ie)}return ne},this.getSingleResponseList=function(W){for(var ne=ce(W,0),X=[],ie=0;ie<ne.length;ie++){var ue=this.getSingleResponse(U(W,ne[ie]));X.push(ue)}return X},this.getSingleResponse=function(W){var ne=ce(W,0),X={},ie=this.getCertID(U(W,ne[0]));X.certid=ie;var ue=this.getCertStatus(U(W,ne[1]));if(X.status=ue,W.substr(ne[2],2)=="18"){var ve=H(W,ne[2]);X.thisupdate=Ln(ve)}for(var ze=3;ze<ne.length;ze++){if(W.substr(ne[ze],2)=="a0"){var tt=J(W,ne[ze],[0],"18");X.nextupdate=Ln(tt)}if(W.substr(ne[ze],2)=="a1"){var nt=new an,it=ae(W,0,[ze,0]);X.ext=nt.getExtParamArray(it)}}return X},this.getCertStatus=function(W){var ne={};if(W=="8000")return{status:"good"};if(W=="8200")return{status:"unknown"};if(W.substr(0,2)=="a1"){ne.status="revoked";var X=J(W,0,[0]),ie=Ln(X);ne.time=ie}return ne}};var B;(typeof B>"u"||!B)&&(B={}),(typeof B.lang>"u"||!B.lang)&&(B.lang={}),B.lang.String=function(){};function en(P){for(var N=new Array,A=0;A<P.length;A++)N[A]=P.charCodeAt(A);return N}function tr(P){for(var N="",A=0;A<P.length;A++)N=N+String.fromCharCode(P[A]);return N}function Ur(P){for(var N="",A=0;A<P.length;A++){var q=P[A].toString(16);q.length==1&&(q="0"+q),N=N+q}return N}function Lt(P){return Ur(en(P))}function sn(P){return o(Lt(P))}function Qt(P){return ai(o(Lt(P)))}function zr(P){return tr(c(br(P)))}function ai(P){return P=P.replace(/\=/g,""),P=P.replace(/\+/g,"-"),P=P.replace(/\//g,"_"),P}function br(P){return P.length%4==2?P=P+"==":P.length%4==3&&(P=P+"="),P=P.replace(/-/g,"+"),P=P.replace(/_/g,"/"),P}function kn(P){return P.length%2==1&&(P="0"+P),ai(o(P))}function On(P){return u(br(P))}var _s,Pr;typeof Buffer=="function"?(_s=function(P){return ai(Buffer.from(P,"utf8").toString("base64"))},Pr=function(P){return Buffer.from(br(P),"base64").toString("utf8")}):(_s=function(P){return kn(Al(my(P)))},Pr=function(P){return decodeURIComponent(Ed(On(P)))});function Rl(P){return o(Al(my(P)))}function _d(P){return decodeURIComponent(Ed(u(P)))}function zc(P){return Al(my(P)).toLowerCase()}function Ln(P){try{return decodeURIComponent(Ed(P))}catch{return null}}function Td(P){return Ln(Ja(P))}function Ja(P){for(var N=P.match(/.{1,2}/g),A=[],q=0;q<N.length;q++){var H=parseInt(N[q],16);161<=H&&H<=191?(A.push("c2"),A.push(N[q])):192<=H&&H<=255?(A.push("c3"),A.push((H-64).toString(16))):A.push(N[q])}return A.join("")}function lr(P){for(var N="",A=0;A<P.length-1;A+=2)N+=String.fromCharCode(parseInt(P.substr(A,2),16));return N}function Ts(P){for(var N="",A=0;A<P.length;A++)N+=("0"+P.charCodeAt(A).toString(16)).slice(-2);return N}function zi(P){return o(P)}function Fl(P){return ls(zi(P),64)}function ls(P,N){return P=P.replace(new RegExp("(.{"+N+"})","g"),`$1\r
`),P=P.replace(/\s+$/,""),P}function wd(P){var N=P.replace(/[^0-9A-Za-z\/+=]*/g,""),A=u(N);return A}function dy(P,N){return"-----BEGIN "+N+`-----\r
`+ls(P,64)+`\r
-----END `+N+`-----\r
`}function Yn(P,N){return"-----BEGIN "+N+`-----\r
`+ls(zi(P),64)+`\r
-----END `+N+`-----\r
`}function nr(P,N){if(P.indexOf("-----BEGIN ")==-1)throw new Error("can't find PEM header");return N!==void 0?(P=P.replace(new RegExp("^[^]*-----BEGIN "+N+"-----"),""),P=P.replace(new RegExp("-----END "+N+"-----[^]*$"),"")):(P=P.replace(/^[^]*-----BEGIN [^-]+-----/,""),P=P.replace(/-----END [^-]+-----[^]*$/,"")),wd(P)}function jl(P){return P.indexOf("-----BEGIN ")==-1||P.indexOf("-----END ")==-1?null:(P=P.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,""),P=P.replace(/-----END [\s\S]+$/m,""),P=P.replace(/\s+/g,""),P.match(/^[0-9a-zA-Z+/=]+$/)?P:null)}function Od(P){if(P.length%2!=0)throw"input is not even length";if(P.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var N=new ArrayBuffer(P.length/2),A=new DataView(N),q=0;q<P.length/2;q++)A.setUint8(q,parseInt(P.substr(q*2,2),16));return N}function Ml(P){for(var N="",A=new DataView(P),q=0;q<P.byteLength;q++)N+=("00"+A.getUint8(q).toString(16)).slice(-2);return N}function ly(P){var N,A,q,H,U,Q,J,ae,te,le;if(P=Pb(P),le=P.match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/),le)return N=parseInt(le[1]),A=parseInt(le[2])-1,q=parseInt(le[3]),H=parseInt(le[4]),U=parseInt(le[5]),Q=parseInt(le[6]),J=0,ae=le[7],ae!==""&&(te=(ae.substr(1)+"00").substr(0,3),J=parseInt(te)),Date.UTC(N,A,q,H,U,Q,J);throw new Error("unsupported zulu format: "+P)}function Nl(P){var N=new Date(P),A=("0000"+N.getUTCFullYear()).slice(-4),q=("00"+(N.getUTCMonth()+1)).slice(-2),H=("00"+N.getUTCDate()).slice(-2),U=("00"+N.getUTCHours()).slice(-2),Q=("00"+N.getUTCMinutes()).slice(-2),J=("00"+N.getUTCSeconds()).slice(-2),ae=("000"+N.getUTCMilliseconds()).slice(-3);return ae=ae.replace(/0+$/,""),ae=ae!=""?"."+ae:ae,A+q+H+U+Q+J+ae+"Z"}function Pd(P){return Math.round(ly(P)/1e3)}function FI(P){return new Date(ly(P))}function fy(P,N,A){var q,H=P.getUTCFullYear();if(N){if(H<1950||2049<H)throw"not proper year for UTCTime: "+H;q=(""+H).slice(-2)}else q=("000"+H).slice(-4);if(q+=("0"+(P.getUTCMonth()+1)).slice(-2),q+=("0"+P.getUTCDate()).slice(-2),q+=("0"+P.getUTCHours()).slice(-2),q+=("0"+P.getUTCMinutes()).slice(-2),q+=("0"+P.getUTCSeconds()).slice(-2),A){var U=P.getUTCMilliseconds();U!==0&&(U=("00"+U).slice(-3),U=U.replace(/0+$/g,""),q+="."+U)}return q+="Z",q}function Pb(P){return P.match(/^[0-9]{12}Z$/)||P.match(/^[0-9]{12}[.][0-9]*Z$/)?P.match(/^[0-4]/)?"20"+P:"19"+P:P}function Al(P){return P.replace(/%/g,"")}function Ed(P){return P.replace(/(..)/g,"%$1")}function Dl(P){var N="malformed IPv6 address";if(!P.match(/^[0-9A-Fa-f:]+$/))throw N;P=P.toLowerCase();var A=P.split(":").length-1;if(A<2)throw N;var q=":".repeat(7-A+2);P=P.replace("::",q);var H=P.split(":");if(H.length!=8)throw N;for(var U=0;U<8;U++)H[U]=("0000"+H[U]).slice(-4);return H.join("")}function hy(P){if(!P.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+P);P=P.toLowerCase();var N=P.match(/.{1,4}/g);N=N.map(function(H){return H.replace(/^0+/,"")}),N=N.map(function(H){return H==""?"0":H}),P=":"+N.join(":")+":";var A=P.match(/:(0:){2,}/g);if(A==null)return P.slice(1,-1);var q=A.sort().slice(-1)[0];return P=P.replace(q.substr(0,q.length-1),":"),P.substr(0,2)!="::"&&(P=P.substr(1)),P.substr(-2,2)!="::"&&(P=P.substr(0,P.length-1)),P}function kl(P){var N=new Error("malformed hex value");if(!P.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw N;if(P.length==8){var A;try{return A=parseInt(P.substr(0,2),16)+"."+parseInt(P.substr(2,2),16)+"."+parseInt(P.substr(4,2),16)+"."+parseInt(P.substr(6,2),16),A}catch{throw N}}else if(P.length==16)try{return kl(P.substr(0,8))+"/"+Eb(P.substr(8))}catch{throw N}else{if(P.length==32)return hy(P);if(P.length==64){try{return hy(P.substr(0,32))+"/"+Eb(P.substr(32))}catch{throw N}return}else return P}}function Eb(P){var N=new Error("malformed mask"),A;try{A=new l(P,16).toString(2)}catch{throw N}if(!A.match(/^1*0*$/))throw N;return A.replace(/0+$/,"").length}function Ib(P){var N=new Error("malformed IP address");if(P=P.toLowerCase(P),!P.match(/^[0-9a-f.:/]+$/))throw N;if(P.match(/^[0-9.]+$/)){var A=P.split(".");if(A.length!==4)throw N;var q="";try{for(var H=0;H<4;H++){var U=parseInt(A[H]);q+=("0"+U.toString(16)).slice(-2)}return q}catch{throw N}}else if(P.match(/^[0-9.]+\/[0-9]+$/)){var Q=P.split("/");return Ib(Q[0])+UT(parseInt(Q[1]),32)}else{if(P.match(/^[0-9a-f:]+$/)&&P.indexOf(":")!==-1)return Dl(P);if(P.match(/^[0-9a-f:]+\/[0-9]+$/)&&P.indexOf(":")!==-1){var Q=P.split("/");return Dl(Q[0])+UT(parseInt(Q[1]),128)}else throw N}}function UT(P,N){if(N==32&&P==0)return"00000000";if(N==128&&P==0)return"00000000000000000000000000000000";var A=Array(P+1).join("1")+Array(N-P+1).join("0");return new l(A,2).toString(16)}function Rb(P){function N(H){var U=parseInt(H.substr(0,2),16),Q=parseInt(H.substr(2),16);if(U==0&Q<128)return String.fromCharCode(Q);if(U<8){var J=192|(U&7)<<3|(Q&192)>>6,ae=128|Q&63;return Ln(J.toString(16)+ae.toString(16))}var J=224|(U&240)>>4,ae=128|(U&15)<<2|(Q&192)>>6,te=128|Q&63;return Ln(J.toString(16)+ae.toString(16)+te.toString(16))}var A=P.match(/.{4}/g),q=A.map(N);return q.join("")}function my(P){for(var N=encodeURIComponent(P),A="",q=0;q<N.length;q++)N[q]=="%"?(A=A+N.substr(q,3),q=q+2):A=A+"%"+Lt(N[q]);return A}function jI(P){return P=P.replace(/\r\n/mg,`
`),P}function ws(P){return P=P.replace(/\r\n/mg,`
`),P=P.replace(/\n/mg,`\r
`),P}B.lang.String.isInteger=function(P){return P.match(/^[0-9]+$/)?!0:!!P.match(/^-[0-9]+$/)},B.lang.String.isHex=function(P){return Id(P)};function Id(P){return!!(P.length%2==0&&(P.match(/^[0-9a-f]+$/)||P.match(/^[0-9A-F]+$/)))}B.lang.String.isBase64=function(P){return P=P.replace(/\s+/g,""),!!(P.match(/^[0-9A-Za-z+\/]+={0,3}$/)&&P.length%4==0)},B.lang.String.isBase64URL=function(P){return P.match(/[+/=]/)?!1:(P=br(P),B.lang.String.isBase64(P))};function py(P){return!!P.match(/^[0-9A-Za-z-_.]+$/)}B.lang.String.isIntegerArray=function(P){return P=P.replace(/\s+/g,""),!!P.match(/^\[[0-9,]+\]$/)},B.lang.String.isPrintable=function(P){return P.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},B.lang.String.isIA5=function(P){return P.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},B.lang.String.isMail=function(P){return P.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};function gy(P){return P.length%2==1?"0"+P:P.substr(0,1)>"7"?"00"+P:P}function zT(P){P=P.replace(/^\s*\[\s*/,""),P=P.replace(/\s*\]\s*$/,""),P=P.replace(/\s*/g,"");try{var N=P.split(/,/).map(function(A,q,H){var U=parseInt(A);if(U<0||255<U)throw"integer not in range 0-255";var Q=("00"+U.toString(16)).slice(-2);return Q}).join("");return N}catch(A){throw"malformed integer array string: "+A}}var VT=function(P,N){var A=P.length;P.length>N.length&&(A=N.length);for(var q=0;q<A;q++)if(P.charCodeAt(q)!=N.charCodeAt(q))return q;return P.length!=N.length?A:-1};function yy(P){var N=function(J){var ae=J.toString(16);return ae.length==1&&(ae="0"+ae),ae},A=function(J){var ae="",te=parseInt(J,10),le=te.toString(2),ce=7-le.length%7;ce==7&&(ce=0);for(var W="",ne=0;ne<ce;ne++)W+="0";le=W+le;for(var ne=0;ne<le.length-1;ne+=7){var X=le.substr(ne,7);ne!=le.length-7&&(X="1"+X),ae+=N(parseInt(X,2))}return ae};try{if(!P.match(/^[0-9.]+$/))return null;var q="",H=P.split("."),U=parseInt(H[0],10)*40+parseInt(H[1],10);q+=N(U),H.splice(0,2);for(var Q=0;Q<H.length;Q++)q+=A(H[Q]);return q}catch{return null}}function by(P){if(!Id(P))return null;try{var N=[],A=P.substr(0,2),q=parseInt(A,16);N[0]=new String(Math.floor(q/40)),N[1]=new String(q%40);for(var H=P.substr(2),U=[],Q=0;Q<H.length/2;Q++)U.push(parseInt(H.substr(Q*2,2),16));for(var J=[],ae="",Q=0;Q<U.length;Q++)U[Q]&128?ae=ae+tc((U[Q]&127).toString(2),7):(ae=ae+tc((U[Q]&127).toString(2),7),J.push(new String(parseInt(ae,2))),ae="");var te=N.join(".");return J.length>0&&(te=te+"."+J.join(".")),te}catch{return null}}function Vc(P){var N=new l(String(P),10);return Hc(N)}function Hc(P){var N=P.toString(16);if(N.substr(0,1)!="-")return N.length%2==1?N="0"+N:N.match(/^[0-7]/)||(N="00"+N),N;var A=N.substr(1),q=A.length;q%2==1?q+=1:N.match(/^[0-7]/)||(q+=2);for(var H="",U=0;U<q;U++)H+="f";var Q=new l(H,16),J=Q.xor(P).add(l.ONE);return N=J.toString(16).replace(/^-/,""),N}var tc=function(P,N,A){return A==null&&(A="0"),P.length>=N?P:new Array(N-P.length+1).join(A)+P};function vy(P){if(P.length%2!=0||(P=P.toLowerCase(),P.match(/^[0-9a-f]+$/)==null))return-1;try{var N=P.substr(0,2);if(N=="00")return parseInt(P.substr(2),16);var A=parseInt(N,16);if(A>7)return-1;var q=P.substr(2),H=parseInt(q,16).toString(2);H=="0"&&(H="00000000"),H=H.slice(0,0-A);var U=parseInt(H,2);return U==NaN?-1:U}catch{return-1}}function Fb(P){if(typeof P!="number"||P<0)return null;var N=Number(P).toString(2),A=8-N.length%8;A==8&&(A=0),N=N+tc("",A,"0");var q=parseInt(N,2).toString(16);q.length%2==1&&(q="0"+q);var H="0"+A;return H+q}function nc(P){if(typeof P!="string"||P.length%2!=0||!P.match(/^[0-9a-f]+$/))return null;try{var N=parseInt(P.substr(0,2),16);if(N<0||7<N)return null;for(var A=P.substr(2),q="",H=0;H<A.length;H+=2){var U=A.substr(H,2),Q=parseInt(U,16).toString(2);Q=("0000000"+Q).slice(-8),q+=Q}return q.substr(0,q.length-N)}catch{return null}}function Rd(P){if(typeof P!="string"||P.match(/^[01]+$/)==null)return null;try{var N=parseInt(P,2);return Fb(N)}catch{return null}}function Fd(P,N){for(var A=0,q=0;q<P.length;q++)A|=1<<N[P[q]];for(var H=A.toString(2),U="",q=H.length-1;q>=0;q--)U+=H[q];return U}function rr(P,q,A){if(typeof P=="object"){for(var q=String(q).split("."),H=0;H<q.length&&P;H++){var U=q[H];U.match(/^[0-9]+$/)&&(U=parseInt(U)),P=P[U]}return P||P===!1?P:A}}function wt(P,N){var A=function(){};A.prototype=N.prototype,P.prototype=new A,P.prototype.constructor=P,P.superclass=N.prototype,N.prototype.constructor==Object.prototype.constructor&&(N.prototype.constructor=N)}(typeof B>"u"||!B)&&(B={}),(typeof B.crypto>"u"||!B.crypto)&&(B.crypto={}),B.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:i.algo.MD5,sha1:i.algo.SHA1,sha224:i.algo.SHA224,sha256:i.algo.SHA256,sha384:i.algo.SHA384,sha512:i.algo.SHA512,ripemd160:i.algo.RIPEMD160},this.getDigestInfoHex=function(P,N){if(typeof this.DIGESTINFOHEAD[N]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+N;return this.DIGESTINFOHEAD[N]+P},this.getPaddedDigestInfoHex=function(P,N,A){var q=this.getDigestInfoHex(P,N),H=A/4;if(q.length+22>H)throw"key is too short for SigAlg: keylen="+A+","+N;for(var U="0001",Q="00"+q,J="",ae=H-U.length-Q.length,te=0;te<ae;te+=2)J+="ff";var le=U+J+Q;return le},this.hashString=function(P,N){var A=new B.crypto.MessageDigest({alg:N});return A.digestString(P)},this.hashHex=function(P,N){var A=new B.crypto.MessageDigest({alg:N});return A.digestHex(P)},this.sha1=function(P){return this.hashString(P,"sha1")},this.sha256=function(P){return this.hashString(P,"sha256")},this.sha256Hex=function(P){return this.hashHex(P,"sha256")},this.sha512=function(P){return this.hashString(P,"sha512")},this.sha512Hex=function(P){return this.hashHex(P,"sha512")},this.isKey=function(P){return P instanceof rn||P instanceof B.crypto.DSA||P instanceof B.crypto.ECDSA}},B.crypto.Util.md5=function(P){var N=new B.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return N.digestString(P)},B.crypto.Util.ripemd160=function(P){var N=new B.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return N.digestString(P)},B.crypto.Util.SECURERANDOMGEN=new Us,B.crypto.Util.getRandomHexOfNbytes=function(P){var N=new Array(P);return B.crypto.Util.SECURERANDOMGEN.nextBytes(N),Ur(N)},B.crypto.Util.getRandomBigIntegerOfNbytes=function(P){return new l(B.crypto.Util.getRandomHexOfNbytes(P),16)},B.crypto.Util.getRandomHexOfNbits=function(P){var N=P%8,A=(P-N)/8,q=new Array(A+1);return B.crypto.Util.SECURERANDOMGEN.nextBytes(q),q[0]=(255<<N&255^255)&q[0],Ur(q)},B.crypto.Util.getRandomBigIntegerOfNbits=function(P){return new l(B.crypto.Util.getRandomHexOfNbits(P),16)},B.crypto.Util.getRandomBigIntegerZeroToMax=function(P){for(var N=P.bitLength();;){var A=B.crypto.Util.getRandomBigIntegerOfNbits(N);if(P.compareTo(A)!=-1)return A}},B.crypto.Util.getRandomBigIntegerMinToMax=function(P,N){var A=P.compareTo(N);if(A==1)throw"biMin is greater than biMax";if(A==0)return P;var q=N.subtract(P),H=B.crypto.Util.getRandomBigIntegerZeroToMax(q);return H.add(P)},B.crypto.MessageDigest=function(P){this.setAlgAndProvider=function(N,A){if(N=B.crypto.MessageDigest.getCanonicalAlgName(N),N!==null&&A===void 0&&(A=B.crypto.Util.DEFAULTPROVIDER[N]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(N)!=-1&&A=="cryptojs"){try{this.md=B.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[N].create()}catch(q){throw"setAlgAndProvider hash alg set fail alg="+N+"/"+q}this.updateString=function(q){this.md.update(q)},this.updateHex=function(q){var H=i.enc.Hex.parse(q);this.md.update(H)},this.digest=function(){var q=this.md.finalize();return q.toString(i.enc.Hex)},this.digestString=function(q){return this.updateString(q),this.digest()},this.digestHex=function(q){return this.updateHex(q),this.digest()}}if(":sha256:".indexOf(N)!=-1&&A=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(q){throw"setAlgAndProvider hash alg set fail alg="+N+"/"+q}this.updateString=function(q){this.md.update(q)},this.updateHex=function(q){var H=sjcl.codec.hex.toBits(q);this.md.update(H)},this.digest=function(){var q=this.md.finalize();return sjcl.codec.hex.fromBits(q)},this.digestString=function(q){return this.updateString(q),this.digest()},this.digestHex=function(q){return this.updateHex(q),this.digest()}}},this.updateString=function(N){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(N){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(N){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(N){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},P!==void 0&&P.alg!==void 0&&(this.algName=P.alg,P.prov===void 0&&(this.provName=B.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},B.crypto.MessageDigest.getCanonicalAlgName=function(P){return typeof P=="string"&&(P=P.toLowerCase(),P=P.replace(/-/,"")),P},B.crypto.MessageDigest.getHashLength=function(P){var N=B.crypto.MessageDigest,A=N.getCanonicalAlgName(P);if(N.HASHLENGTH[A]===void 0)throw"not supported algorithm: "+P;return N.HASHLENGTH[A]},B.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},B.crypto.Mac=function(P){this.setAlgAndProvider=function(N,A){if(N=N.toLowerCase(),N==null&&(N="hmacsha1"),N=N.toLowerCase(),N.substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+N;A===void 0&&(A=B.crypto.Util.DEFAULTPROVIDER[N]),this.algProv=N+"/"+A;var q=N.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(q)!=-1&&A=="cryptojs"){try{var H=B.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[q];this.mac=i.algo.HMAC.create(H,this.pass)}catch(U){throw"setAlgAndProvider hash alg set fail hashAlg="+q+"/"+U}this.updateString=function(U){this.mac.update(U)},this.updateHex=function(U){var Q=i.enc.Hex.parse(U);this.mac.update(Q)},this.doFinal=function(){var U=this.mac.finalize();return U.toString(i.enc.Hex)},this.doFinalString=function(U){return this.updateString(U),this.doFinal()},this.doFinalHex=function(U){return this.updateHex(U),this.doFinal()}}},this.updateString=function(N){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(N){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(N){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(N){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(N){if(typeof N=="string"){var A=N;(N.length%2==1||!N.match(/^[0-9A-Fa-f]+$/))&&(A=Ts(N)),this.pass=i.enc.Hex.parse(A);return}if(typeof N!="object")throw"KJUR.crypto.Mac unsupported password type: "+N;var A=null;if(N.hex!==void 0){if(N.hex.length%2!=0||!N.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+N.hex;A=N.hex}if(N.utf8!==void 0&&(A=zc(N.utf8)),N.rstr!==void 0&&(A=Ts(N.rstr)),N.b64!==void 0&&(A=u(N.b64)),N.b64u!==void 0&&(A=On(N.b64u)),A==null)throw"KJUR.crypto.Mac unsupported password type: "+N;this.pass=i.enc.Hex.parse(A)},P!==void 0&&(P.pass!==void 0&&this.setPassword(P.pass),P.alg!==void 0&&(this.algName=P.alg,P.prov===void 0&&(this.provName=B.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},B.crypto.Signature=function(P){var N=null;if(this._setAlgNames=function(){var A=this.algName.match(/^(.+)with(.+)$/);A&&(this.mdAlgName=A[1].toLowerCase(),this.pubkeyAlgName=A[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(A,q){for(var H="",U=q/4-A.length,Q=0;Q<U;Q++)H=H+"0";return H+A},this.setAlgAndProvider=function(A,q){if(this._setAlgNames(),q!="cryptojs/jsrsa")throw new Error("provider not supported: "+q);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new B.crypto.MessageDigest({alg:this.mdAlgName})}catch(H){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+H)}this.init=function(H,U){var Q=null;try{U===void 0?Q=Cn.getKey(H):Q=Cn.getKey(H,U)}catch(J){throw"init failed:"+J}if(Q.isPrivate===!0)this.prvKey=Q,this.state="SIGN";else if(Q.isPublic===!0)this.pubKey=Q,this.state="VERIFY";else throw"init failed.:"+Q},this.updateString=function(H){this.md.updateString(H)},this.updateHex=function(H){this.md.updateHex(H)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&B.crypto.ECDSA!==void 0&&(this.prvKey=new B.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof rn&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof rn&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof B.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else if(this.prvKey instanceof B.crypto.DSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;return this.hSign},this.signString=function(H){return this.updateString(H),this.sign()},this.signHex=function(H){return this.updateHex(H),this.sign()},this.verify=function(H){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&B.crypto.ECDSA!==void 0&&(this.pubKey=new B.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof rn&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,H,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof rn&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,H);if(B.crypto.ECDSA!==void 0&&this.pubKey instanceof B.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,H);if(B.crypto.DSA!==void 0&&this.pubKey instanceof B.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,H);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(A,q){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(A){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(A){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(A){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(A){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(A){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=P,P!==void 0&&(P.alg!==void 0&&(this.algName=P.alg,P.prov===void 0?this.provName=B.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=P.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),P.psssaltlen!==void 0&&(this.pssSaltLen=P.psssaltlen),P.prvkeypem!==void 0)){if(P.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{var N=Cn.getKey(P.prvkeypem);this.init(N)}catch(A){throw"fatal error to load pem private key: "+A}}},B.crypto.Cipher=function(P){},B.crypto.Cipher.encrypt=function(P,N,A,q){if(rr(q,"enclag")!=null&&(A=q.encalg),typeof A=="string"&&A.substr(-4)=="-CBC"){var H=N,U=P;rr(q,"key")!=null&&(H=q.key),rr(q,"enc")!=null&&(hEnc=q.enc);var Q=i.enc.Hex.parse(H),J=i.enc.Hex.parse(U),ae=i.enc.Hex.parse(q.iv),te;if(A=="des-EDE3-CBC")te=i.TripleDES.encrypt(J,Q,{iv:ae});else if(A=="aes128-CBC"||A=="aes256-CBC")te=i.AES.encrypt(J,Q,{iv:ae});else throw new Error("unsupported algorithm: "+A);return te+""}else throw new Error("Cipher.encrypt: unsupported key or algorithm")},B.crypto.Cipher.decrypt=function(P,N,A,q){if(rr(q,"enclag")!=null&&(A=q.encalg),typeof A=="string"&&A.substr(-4)=="-CBC"){var H=N,U=P;rr(q,"key")!=null&&(H=q.key),rr(q,"enc")!=null&&(U=q.enc);var Q=i.enc.Hex.parse(H),J=i.enc.Hex.parse(U),ae=i.enc.Hex.parse(q.iv),te;if(A=="des-EDE3-CBC")te=i.TripleDES.decrypt({ciphertext:J},Q,{iv:ae});else if(A=="aes128-CBC"||A=="aes256-CBC")te=i.AES.decrypt({ciphertext:J},Q,{iv:ae});else throw new Error("unsupported algorithm: "+A);return i.enc.Hex.stringify(te)}else throw new Error("Cipher.decrypt: unsupported key or algorithm")},B.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},(typeof B>"u"||!B)&&(B={}),(typeof B.crypto>"u"||!B.crypto)&&(B.crypto={}),B.crypto.ECDSA=function(P){var N="secp256r1",A=Error,q=l,H=Sn,U=B.crypto.ECDSA,Q=B.crypto.ECParameterDB,J=U.getName,ae=dt,te=ae.getVbyListEx,le=ae.isASN1HEX,ce=new Us;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(W){return new q(W.bitLength(),ce).mod(W.subtract(q.ONE)).add(q.ONE)},this.setNamedCurve=function(W){this.ecparams=Q.getByName(W),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=W},this.setPrivateKeyHex=function(W){this.isPrivate=!0,this.prvKeyHex=W},this.setPublicKeyHex=function(W){this.isPublic=!0,this.pubKeyHex=W},this.getPublicKeyXYHex=function(){var W=this.pubKeyHex;if(W.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var ne=this.ecparams.keycharlen;if(W.length!==2+ne*2)throw"malformed public key hex length";var X={};return X.x=W.substr(2,ne),X.y=W.substr(2+ne),X},this.getShortNISTPCurveName=function(){var W=this.curveName;return W==="secp256r1"||W==="NIST P-256"||W==="P-256"||W==="prime256v1"?"P-256":W==="secp384r1"||W==="NIST P-384"||W==="P-384"?"P-384":W==="secp521r1"||W==="NIST P-521"||W==="P-521"?"P-521":null},this.generateKeyPairHex=function(){var W=this.ecparams.n,ne=this.getBigRandom(W),X=this.ecparams.keycharlen,ie=("0000000000"+ne.toString(16)).slice(-X);this.setPrivateKeyHex(ie);var ue=this.generatePublicKeyHex();return{ecprvhex:ie,ecpubhex:ue}},this.generatePublicKeyHex=function(){var W=new q(this.prvKeyHex,16),ne=this.ecparams.G.multiply(W),X=ne.getX().toBigInteger(),ie=ne.getY().toBigInteger(),ue=this.ecparams.keycharlen,ve=("0000000000"+X.toString(16)).slice(-ue),ze=("0000000000"+ie.toString(16)).slice(-ue),tt="04"+ve+ze;return this.setPublicKeyHex(tt),tt},this.signWithMessageHash=function(W){return this.signHex(W,this.prvKeyHex)},this.signHex=function(W,ne){var X=new q(ne,16),ie=this.ecparams.n,ue=new q(W.substring(0,this.ecparams.keycharlen),16);do var ve=this.getBigRandom(ie),ze=this.ecparams.G,tt=ze.multiply(ve),nt=tt.getX().toBigInteger().mod(ie);while(nt.compareTo(q.ZERO)<=0);var it=ve.modInverse(ie).multiply(ue.add(X.multiply(nt))).mod(ie);return U.biRSSigToASN1Sig(nt,it)},this.sign=function(W,ne){var X=ne,ie=this.ecparams.n,ue=q.fromByteArrayUnsigned(W);do var ve=this.getBigRandom(ie),ze=this.ecparams.G,tt=ze.multiply(ve),nt=tt.getX().toBigInteger().mod(ie);while(nt.compareTo(l.ZERO)<=0);var it=ve.modInverse(ie).multiply(ue.add(X.multiply(nt))).mod(ie);return this.serializeSig(nt,it)},this.verifyWithMessageHash=function(W,ne){return this.verifyHex(W,ne,this.pubKeyHex)},this.verifyHex=function(W,ne,X){try{var ie,ue,ve=U.parseSigHex(ne);ie=ve.r,ue=ve.s;var ze=H.decodeFromHex(this.ecparams.curve,X),tt=new q(W.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(tt,ie,ue,ze)}catch{return!1}},this.verify=function(W,ne,X){var ie,ue;if(Bitcoin.Util.isArray(ne)){var ve=this.parseSig(ne);ie=ve.r,ue=ve.s}else if(typeof ne=="object"&&ne.r&&ne.s)ie=ne.r,ue=ne.s;else throw"Invalid value for signature";var ze;if(X instanceof Sn)ze=X;else if(Bitcoin.Util.isArray(X))ze=H.decodeFrom(this.ecparams.curve,X);else throw"Invalid format for pubkey value, must be byte array or ECPointFp";var tt=q.fromByteArrayUnsigned(W);return this.verifyRaw(tt,ie,ue,ze)},this.verifyRaw=function(W,ne,X,ie){var ue=this.ecparams.n,ve=this.ecparams.G;if(ne.compareTo(q.ONE)<0||ne.compareTo(ue)>=0||X.compareTo(q.ONE)<0||X.compareTo(ue)>=0)return!1;var ze=X.modInverse(ue),tt=W.multiply(ze).mod(ue),nt=ne.multiply(ze).mod(ue),it=ve.multiply(tt).add(ie.multiply(nt)),_e=it.getX().toBigInteger().mod(ue);return _e.equals(ne)},this.serializeSig=function(W,ne){var X=W.toByteArraySigned(),ie=ne.toByteArraySigned(),ue=[];return ue.push(2),ue.push(X.length),ue=ue.concat(X),ue.push(2),ue.push(ie.length),ue=ue.concat(ie),ue.unshift(ue.length),ue.unshift(48),ue},this.parseSig=function(W){var ne;if(W[0]!=48)throw new Error("Signature not a valid DERSequence");if(ne=2,W[ne]!=2)throw new Error("First element in signature must be a DERInteger");var X=W.slice(ne+2,ne+2+W[ne+1]);if(ne+=2+W[ne+1],W[ne]!=2)throw new Error("Second element in signature must be a DERInteger");var ie=W.slice(ne+2,ne+2+W[ne+1]);ne+=2+W[ne+1];var ue=q.fromByteArrayUnsigned(X),ve=q.fromByteArrayUnsigned(ie);return{r:ue,s:ve}},this.parseSigCompact=function(W){if(W.length!==65)throw"Signature has the wrong length";var ne=W[0]-27;if(ne<0||ne>7)throw"Invalid signature type";var X=this.ecparams.n,ie=q.fromByteArrayUnsigned(W.slice(1,33)).mod(X),ue=q.fromByteArrayUnsigned(W.slice(33,65)).mod(X);return{r:ie,s:ue,i:ne}},this.readPKCS5PrvKeyHex=function(W){if(le(W)===!1)throw new Error("not ASN.1 hex string");var ne,X,ie;try{ne=te(W,0,["[0]",0],"06"),X=te(W,0,[1],"04");try{ie=te(W,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=J(ne),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(ie),this.setPrivateKeyHex(X),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(W){if(le(W)===!1)throw new A("not ASN.1 hex string");var ne,X,ie,ue;try{ne=te(W,0,[1,0],"06"),X=te(W,0,[1,1],"06"),ie=te(W,0,[2,0,1],"04");try{ue=te(W,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new A("malformed PKCS#8 plain ECC private key")}if(this.curveName=J(X),this.curveName===void 0)throw new A("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(ue),this.setPrivateKeyHex(ie),this.isPublic=!1},this.readPKCS8PubKeyHex=function(W){if(le(W)===!1)throw new A("not ASN.1 hex string");var ne,X,ie;try{ne=te(W,0,[0,0],"06"),X=te(W,0,[0,1],"06"),ie=te(W,0,[1],"03")}catch{throw new A("malformed PKCS#8 ECC public key")}if(this.curveName=J(X),this.curveName===null)throw new A("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(ie)},this.readCertPubKeyHex=function(W,ne){if(le(W)===!1)throw new A("not ASN.1 hex string");var X,ie;try{X=te(W,0,[0,5,0,1],"06"),ie=te(W,0,[0,5,1],"03")}catch{throw new A("malformed X.509 certificate ECC public key")}if(this.curveName=J(X),this.curveName===null)throw new A("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(ie)},P!==void 0&&P.curve!==void 0&&(this.curveName=P.curve),this.curveName===void 0&&(this.curveName=N),this.setNamedCurve(this.curveName),P!==void 0&&(P.prv!==void 0&&this.setPrivateKeyHex(P.prv),P.pub!==void 0&&this.setPublicKeyHex(P.pub))},B.crypto.ECDSA.parseSigHex=function(P){var N=B.crypto.ECDSA.parseSigHexInHexRS(P),A=new l(N.r,16),q=new l(N.s,16);return{r:A,s:q}},B.crypto.ECDSA.parseSigHexInHexRS=function(P){var N=dt,A=N.getChildIdx,q=N.getV;if(N.checkStrictDER(P,0),P.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var H=A(P,0);if(H.length!=2)throw new Error("signature shall have two elements");var U=H[0],Q=H[1];if(P.substr(U,2)!="02")throw new Error("1st item not ASN.1 integer");if(P.substr(Q,2)!="02")throw new Error("2nd item not ASN.1 integer");var J=q(P,U),ae=q(P,Q);return{r:J,s:ae}},B.crypto.ECDSA.asn1SigToConcatSig=function(P){var N=B.crypto.ECDSA.parseSigHexInHexRS(P),A=N.r,q=N.s;if(A.length>=130&&A.length<=134){if(A.length%2!=0)throw Error("unknown ECDSA sig r length error");if(q.length%2!=0)throw Error("unknown ECDSA sig s length error");A.substr(0,2)=="00"&&(A=A.substr(2)),q.substr(0,2)=="00"&&(q=q.substr(2));var H=Math.max(A.length,q.length);return A=("000000"+A).slice(-H),q=("000000"+q).slice(-H),A+q}if(A.substr(0,2)=="00"&&A.length%32==2&&(A=A.substr(2)),q.substr(0,2)=="00"&&q.length%32==2&&(q=q.substr(2)),A.length%32==30&&(A="00"+A),q.length%32==30&&(q="00"+q),A.length%32!=0)throw Error("unknown ECDSA sig r length error");if(q.length%32!=0)throw Error("unknown ECDSA sig s length error");return A+q},B.crypto.ECDSA.concatSigToASN1Sig=function(P){if(P.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var N=P.substr(0,P.length/2),A=P.substr(P.length/2);return B.crypto.ECDSA.hexRSSigToASN1Sig(N,A)},B.crypto.ECDSA.hexRSSigToASN1Sig=function(P,N){var A=new l(P,16),q=new l(N,16);return B.crypto.ECDSA.biRSSigToASN1Sig(A,q)},B.crypto.ECDSA.biRSSigToASN1Sig=function(P,N){var A=B.asn1,q=new A.DERInteger({bigint:P}),H=new A.DERInteger({bigint:N}),U=new A.DERSequence({array:[q,H]});return U.tohex()},B.crypto.ECDSA.getName=function(P){return P==="2b8104001f"?"secp192k1":P==="2a8648ce3d030107"?"secp256r1":P==="2b8104000a"?"secp256k1":P==="2b81040021"?"secp224r1":P==="2b81040022"?"secp384r1":P==="2b81040023"?"secp521r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(P)!==-1?"secp256r1":"|secp256k1|".indexOf(P)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(P)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(P)!==-1?"secp384r1":"|secp521r1|NIST P-521|P-521|".indexOf(P)!==-1?"secp521r1":null},(typeof B>"u"||!B)&&(B={}),(typeof B.crypto>"u"||!B.crypto)&&(B.crypto={}),B.crypto.ECParameterDB=new function(){var P={},N={};function A(q){return new l(q,16)}this.getByName=function(q){var H=q;if(typeof N[H]<"u"&&(H=N[q]),typeof P[H]<"u")return P[H];throw"unregistered EC curve name: "+H},this.regist=function(q,H,U,Q,J,ae,te,le,ce,W,ne,X){P[q]={};var ie=A(U),ue=A(Q),ve=A(J),ze=A(ae),tt=A(te),nt=new be(ie,ue,ve),it=nt.decodePointHex("04"+le+ce);P[q].name=q,P[q].keylen=H,P[q].keycharlen=Math.ceil(H/8)*2,P[q].curve=nt,P[q].G=it,P[q].n=ze,P[q].h=tt,P[q].oid=ne,P[q].info=X;for(var _e=0;_e<W.length;_e++)N[W[_e]]=q}},B.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),B.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),B.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),B.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),B.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),B.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),B.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),B.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),B.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),B.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),(typeof B>"u"||!B)&&(B={}),(typeof B.crypto>"u"||!B.crypto)&&(B.crypto={}),B.crypto.DSA=function(){var P=dt;P.getVbyList;var N=P.getVbyListEx,A=P.isASN1HEX,q=l;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(H,U,Q,J,ae){this.isPrivate=!0,this.p=H,this.q=U,this.g=Q,this.y=J,this.x=ae},this.setPrivateHex=function(H,U,Q,J,ae){var te,le,ce,W,ne;te=new l(H,16),le=new l(U,16),ce=new l(Q,16),typeof J=="string"&&J.length>1?W=new l(J,16):W=null,ne=new l(ae,16),this.setPrivate(te,le,ce,W,ne)},this.setPublic=function(H,U,Q,J){this.isPublic=!0,this.p=H,this.q=U,this.g=Q,this.y=J,this.x=null},this.setPublicHex=function(H,U,Q,J){var ae,te,le,ce;ae=new l(H,16),te=new l(U,16),le=new l(Q,16),ce=new l(J,16),this.setPublic(ae,te,le,ce)},this.signWithMessageHash=function(H){var U=this.p,Q=this.q,J=this.g;this.y;var ae=this.x,te=B.crypto.Util.getRandomBigIntegerMinToMax(l.ONE.add(l.ONE),Q.subtract(l.ONE)),le=H.substr(0,Q.bitLength()/4),ce=new l(le,16),W=J.modPow(te,U).mod(Q),ne=te.modInverse(Q).multiply(ce.add(ae.multiply(W))).mod(Q),X=B.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:W}},{int:{bigint:ne}}]});return X},this.verifyWithMessageHash=function(H,U){var Q=this.p,J=this.q,ae=this.g,te=this.y,le=this.parseASN1Signature(U),ce=le[0],W=le[1],ne=H.substr(0,J.bitLength()/4),X=new l(ne,16);if(l.ZERO.compareTo(ce)>0||ce.compareTo(J)>0||l.ZERO.compareTo(W)>=0||W.compareTo(J)>0)throw"invalid DSA signature";var ie=W.modInverse(J),ue=X.multiply(ie).mod(J),ve=ce.multiply(ie).mod(J),ze=ae.modPow(ue,Q).multiply(te.modPow(ve,Q)).mod(Q).mod(J);return ze.compareTo(ce)==0},this.parseASN1Signature=function(H){try{var U=new q(N(H,0,[0],"02"),16),Q=new q(N(H,0,[1],"02"),16);return[U,Q]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(H){var U,Q,J,ae,te;if(A(H)===!1)throw new Error("not ASN.1 hex string");try{U=N(H,0,[1],"02"),Q=N(H,0,[2],"02"),J=N(H,0,[3],"02"),ae=N(H,0,[4],"02"),te=N(H,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(U,Q,J,ae,te)},this.readPKCS8PrvKeyHex=function(H){var U,Q,J,ae;if(A(H)===!1)throw new Error("not ASN.1 hex string");try{U=N(H,0,[1,1,0],"02"),Q=N(H,0,[1,1,1],"02"),J=N(H,0,[1,1,2],"02"),ae=N(H,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(U,Q,J,null,ae)},this.readPKCS8PubKeyHex=function(H){var U,Q,J,ae;if(A(H)===!1)throw new Error("not ASN.1 hex string");try{U=N(H,0,[0,1,0],"02"),Q=N(H,0,[0,1,1],"02"),J=N(H,0,[0,1,2],"02"),ae=N(H,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(U,Q,J,ae)},this.readCertPubKeyHex=function(H,U){var Q,J,ae,te;if(A(H)===!1)throw new Error("not ASN.1 hex string");try{Q=N(H,0,[0,5,0,1,0],"02"),J=N(H,0,[0,5,0,1,1],"02"),ae=N(H,0,[0,5,0,1,2],"02"),te=N(H,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(Q,J,ae,te)}};var Cn=(function(){var P=function(X,ie,ue){return q(i.AES,X,ie,ue)},N=function(X,ie,ue){return q(i.TripleDES,X,ie,ue)},A=function(X,ie,ue){return q(i.DES,X,ie,ue)},q=function(X,ie,ue,ve){var ze=i.enc.Hex.parse(ie),tt=i.enc.Hex.parse(ue),nt=i.enc.Hex.parse(ve),it={};it.key=tt,it.iv=nt,it.ciphertext=ze;var _e=X.decrypt(it,tt,{iv:nt});return i.enc.Hex.stringify(_e)},H=function(X,ie,ue){return J(i.AES,X,ie,ue)},U=function(X,ie,ue){return J(i.TripleDES,X,ie,ue)},Q=function(X,ie,ue){return J(i.DES,X,ie,ue)},J=function(X,ie,ue,ve){var ze=i.enc.Hex.parse(ie),tt=i.enc.Hex.parse(ue),nt=i.enc.Hex.parse(ve),it=X.encrypt(ze,tt,{iv:nt}),_e=i.enc.Hex.parse(it.toString()),Ie=i.enc.Base64.stringify(_e);return Ie},ae={"AES-256-CBC":{proc:P,eproc:H,keylen:32,ivlen:16},"AES-192-CBC":{proc:P,eproc:H,keylen:24,ivlen:16},"AES-128-CBC":{proc:P,eproc:H,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:N,eproc:U,keylen:24,ivlen:8},"DES-CBC":{proc:A,eproc:Q,keylen:8,ivlen:8}},te=function(X){var ie=i.lib.WordArray.random(X),ue=i.enc.Hex.stringify(ie);return ue},le=function(X){var ie={},ue=X.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));ue&&(ie.cipher=ue[1],ie.ivsalt=ue[2]);var ve=X.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));ve&&(ie.type=ve[1]);var ze=-1,tt=0;X.indexOf(`\r
\r
`)!=-1&&(ze=X.indexOf(`\r
\r
`),tt=2),X.indexOf(`

`)!=-1&&(ze=X.indexOf(`

`),tt=1);var nt=X.indexOf("-----END");if(ze!=-1&&nt!=-1){var it=X.substring(ze+tt*2,nt-tt);it=it.replace(/\s+/g,""),ie.data=it}return ie},ce=function(X,ie,ue){for(var ve=ue.substring(0,16),ze=i.enc.Hex.parse(ve),tt=i.enc.Utf8.parse(ie),nt=ae[X].keylen+ae[X].ivlen,it="",_e=null;;){var Ie=i.algo.MD5.create();if(_e!=null&&Ie.update(_e),Ie.update(tt),Ie.update(ze),_e=Ie.finalize(),it=it+i.enc.Hex.stringify(_e),it.length>=nt*2)break}var Ae={};return Ae.keyhex=it.substr(0,ae[X].keylen*2),Ae.ivhex=it.substr(ae[X].keylen*2,ae[X].ivlen*2),Ae},W=function(X,ie,ue,ve){var ze=i.enc.Base64.parse(X),tt=i.enc.Hex.stringify(ze),nt=ae[ie].proc,it=nt(tt,ue,ve);return it},ne=function(X,ie,ue,ve){var ze=ae[ie].eproc,tt=ze(X,ue,ve);return tt};return{version:"1.0.0",parsePKCS5PEM:function(X){return le(X)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(X,ie,ue){return ce(X,ie,ue)},decryptKeyB64:function(X,ie,ue,ve){return W(X,ie,ue,ve)},getDecryptedKeyHex:function(X,ie){var ue=le(X);ue.type;var ve=ue.cipher,ze=ue.ivsalt,tt=ue.data,nt=ce(ve,ie,ze),it=nt.keyhex,_e=W(tt,ve,it,ze);return _e},getEncryptedPKCS5PEMFromPrvKeyHex:function(X,ie,ue,ve,ze){var Te="";if((typeof ve>"u"||ve==null)&&(ve="AES-256-CBC"),typeof ae[ve]>"u")throw new Error("KEYUTIL unsupported algorithm: "+ve);if(typeof ze>"u"||ze==null){var tt=ae[ve].ivlen,nt=te(tt);ze=nt.toUpperCase()}var it=ce(ve,ue,ze),_e=it.keyhex,Ie=ne(ie,ve,_e,ze),Ae=Ie.replace(/(.{64})/g,`$1\r
`),Te="-----BEGIN "+X+` PRIVATE KEY-----\r
`;return Te+=`Proc-Type: 4,ENCRYPTED\r
`,Te+="DEK-Info: "+ve+","+ze+`\r
`,Te+=`\r
`,Te+=Ae,Te+=`\r
-----END `+X+` PRIVATE KEY-----\r
`,Te},getEncryptedPKCS8PEM:function(X,ie,ue){var ve=this.getEncryptedPKCS8Hex(X,ie,ue);return Yn(ve,"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(X,ie,ue){var ve;ue==null||ue==null?ve={}:ve=JSON.parse(JSON.stringify(ue)),ve.plain=X,this.initPBES2Param(ve),this.encryptPBES2Param(ve,ie);var ze=this.generatePBES2ASN1Param(ve);return B.asn1.ASN1Util.newObject(ze).tohex()},initPBES2Param:function(X){if(rr(X,"encalg")==null&&(X.encalg="aes256-CBC"),rr(X,"iter")==null&&(X.iter=2048),rr(X,"prf")==null&&(X.prf="hmacWithSHA256"),rr(X,"salt")==null&&(X.salt=i.enc.Hex.stringify(i.lib.WordArray.random(8))),rr(X,"enciv")==null){var ie;X.encalg=="des-EDE3-CBC"&&(ie=8),X.encalg=="aes128-CBC"&&(ie=16),X.encalg=="aes256-CBC"&&(ie=16),X.enciv=i.enc.Hex.stringify(i.lib.WordArray.random(ie))}},encryptPBES2Param:function(X,ie){var ue=Cn.getDKFromPBES2Param(X,ie);try{var ve=B.crypto.Cipher.encrypt(X.plain,ue,X.encalg,{iv:X.enciv})}catch{throw new Error("encrypt error: "+X.plain+" "+ue+" "+X.encalg+" "+X.enciv)}X.enc=ve},generatePBES2ASN1Param:function(X){var ie={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:X.salt}},{int:{hex:Vc(X.iter)}}]}]},{seq:[{oid:X.encalg},{octstr:{hex:X.enciv}}]}]}]},{octstr:{hex:X.enc}}]};return X.prf!="hmacWithSHA1"&&ie.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:X.prf},{null:""}]}),ie},parseHexOfEncryptedPKCS8:function(X){var ie=dt,ue=ie.getChildIdx,ve=ie.getV,ze={},tt=ue(X,0);if(tt.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+tt.length);ze.ciphertext=ve(X,tt[1]);var nt=ue(X,tt[0]);if(nt.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+nt.length);if(ve(X,nt[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var it=ue(X,nt[1]);if(nt.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+it.length);var _e=ue(X,it[1]);if(_e.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+_e.length);if(ve(X,_e[0])!="2a864886f70d0307")throw"this only supports TripleDES";ze.encryptionSchemeAlg="TripleDES",ze.encryptionSchemeIV=ve(X,_e[1]);var Ie=ue(X,it[0]);if(Ie.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+Ie.length);if(ve(X,Ie[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var Ae=ue(X,Ie[1]);if(Ae.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+Ae.length);ze.pbkdf2Salt=ve(X,Ae[0]);var Te=ve(X,Ae[1]);try{ze.pbkdf2Iter=parseInt(Te,16)}catch{throw new Error("malformed format pbkdf2Iter: "+Te)}return ze},getPBKDF2KeyHexFromParam:function(X,ie){var ue=i.enc.Hex.parse(X.pbkdf2Salt),ve=X.pbkdf2Iter,ze=i.PBKDF2(ie,ue,{keySize:192/32,iterations:ve}),tt=i.enc.Hex.stringify(ze);return tt},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(X,ie){var ue=nr(X,"ENCRYPTED PRIVATE KEY"),ve=this.parseHexOfEncryptedPKCS8(ue),ze=Cn.getPBKDF2KeyHexFromParam(ve,ie),tt={};tt.ciphertext=i.enc.Hex.parse(ve.ciphertext);var nt=i.enc.Hex.parse(ze),it=i.enc.Hex.parse(ve.encryptionSchemeIV),_e=i.TripleDES.decrypt(tt,nt,{iv:it}),Ie=i.enc.Hex.stringify(_e);return Ie},parsePBES2:function(X){var ie=dt.parse(X);if(rr(ie,"seq.0.seq.0.oid")!="pkcs5PBES2"||rr(ie,"seq.0.seq.1.seq.0.seq.0.oid")!="pkcs5PBKDF2")throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var ue=rr(ie,"seq.0.seq.1.seq.0.seq.1.seq");if(ue==null)throw new Error("PBKDF2 parameter not found");var ve=rr(ue,"0.octstr.hex"),ze=rr(ue,"1.int.hex"),tt=rr(ue,"2.seq.0.oid","hmacWithSHA1"),nt=-1;try{nt=parseInt(ze,16)}catch{throw new Error("iter not proper value")}var it=rr(ie,"seq.0.seq.1.seq.1.seq.0.oid"),_e=rr(ie,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),Ie=rr(ie,"seq.1.octstr.hex");if(it==null||_e==null||Ie==null)throw new Error("encalg, enciv or enc is undefined");var Ae={salt:ve,iter:nt,prf:tt,encalg:it,enciv:_e,enc:Ie};return Ae},getDKFromPBES2Param:function(X,ie){var ue={hmacWithSHA1:i.algo.SHA1,hmacWithSHA224:i.algo.SHA224,hmacWithSHA256:i.algo.SHA256,hmacWithSHA384:i.algo.SHA384,hmacWithSHA512:i.algo.SHA512},ve={"des-EDE3-CBC":192/32,"aes128-CBC":128/32,"aes256-CBC":256/32},ze=ue[X.prf];if(ze==null)throw new Error("unsupported prf");var tt=ve[X.encalg];if(tt==null)throw new Error("unsupported encalg");var nt=i.enc.Hex.parse(X.salt),it=X.iter;try{var _e=i.PBKDF2(ie,nt,{keySize:tt,iterations:it,hasher:ze});return i.enc.Hex.stringify(_e)}catch(Ie){throw new Error("PBKDF2 error: "+Ie+" "+JSON.stringify(X)+" "+ie)}},getPlainHexFromEncryptedPKCS8PEM:function(X,ie){if(X.indexOf("BEGIN ENCRYPTED PRIVATE KEY")==-1)throw new Error("not Encrypted PKCS#8 PEM string");var ue=nr(X),ve;try{ve=Cn.parsePBES2(ue)}catch(tt){throw new Error("malformed PBES2 format: "+tt.message)}var ze=Cn.getDKFromPBES2Param(ve,ie);return B.crypto.Cipher.decrypt(ve.enc,ze,ve.encalg,{iv:ve.enciv})},getKeyFromEncryptedPKCS8PEM:function(X,ie){var ue=this.getPlainHexFromEncryptedPKCS8PEM(X,ie),ve=this.getKeyFromPlainPrivatePKCS8Hex(ue);return ve},parsePlainPrivatePKCS8Hex:function(X){var ie=dt,ue=ie.getChildIdx,ve=ie.getV,ze={};if(ze.algparam=null,X.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var tt=ue(X,0);if(tt.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(X.substr(tt[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var nt=ue(X,tt[1]);if(nt.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(X.substr(nt[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(ze.algoid=ve(X,nt[0]),X.substr(nt[1],2)=="06"&&(ze.algparam=ve(X,nt[1])),X.substr(tt[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return ze.keyidx=ie.getVidx(X,tt[2]),ze},getKeyFromPlainPrivatePKCS8PEM:function(X){var ie=nr(X,"PRIVATE KEY"),ue=this.getKeyFromPlainPrivatePKCS8Hex(ie);return ue},getKeyFromPlainPrivatePKCS8Hex:function(X){var ie=this.parsePlainPrivatePKCS8Hex(X),ue;if(ie.algoid=="2a864886f70d010101")ue=new rn;else if(ie.algoid=="2a8648ce380401")ue=new B.crypto.DSA;else if(ie.algoid=="2a8648ce3d0201")ue=new B.crypto.ECDSA;else throw new Error("unsupported private key algorithm");return ue.readPKCS8PrvKeyHex(X),ue},_getKeyFromPublicPKCS8Hex:function(X){var ie,ue=dt.getVbyList(X,0,[0,0],"06");if(ue==="2a864886f70d010101")ie=new rn;else if(ue==="2a8648ce380401")ie=new B.crypto.DSA;else if(ue==="2a8648ce3d0201")ie=new B.crypto.ECDSA;else throw new Error("unsupported PKCS#8 public key hex");return ie.readPKCS8PubKeyHex(X),ie},parsePublicRawRSAKeyHex:function(X){var ie=dt,ue=ie.getChildIdx,ve=ie.getV,ze={};if(X.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var tt=ue(X,0);if(tt.length!=2)throw new Error("malformed RSA key(code:002)");if(X.substr(tt[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(ze.n=ve(X,tt[0]),X.substr(tt[1],2)!="02")throw new Error("malformed RSA key(code:004)");return ze.e=ve(X,tt[1]),ze},parsePublicPKCS8Hex:function(X){var ie=dt,ue=ie.getChildIdx,ve=ie.getV,ze={};ze.algparam=null;var tt=ue(X,0);if(tt.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+tt.length);var nt=tt[0];if(X.substr(nt,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var it=ue(X,nt);if(it.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(X.substr(it[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(ze.algoid=ve(X,it[0]),X.substr(it[1],2)=="06"?ze.algparam=ve(X,it[1]):X.substr(it[1],2)=="30"&&(ze.algparam={},ze.algparam.p=ie.getVbyList(X,it[1],[0],"02"),ze.algparam.q=ie.getVbyList(X,it[1],[1],"02"),ze.algparam.g=ie.getVbyList(X,it[1],[2],"02")),X.substr(tt[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return ze.key=ve(X,tt[1]).substr(2),ze}}})();Cn.getKey=function(P,N,A){var q=dt,H=q.getChildIdx;q.getV;var U=q.getVbyList,Q=B.crypto,J=Q.ECDSA,ae=Q.DSA,te=rn,le=nr,ce=Cn;if(typeof te<"u"&&P instanceof te||typeof J<"u"&&P instanceof J||typeof ae<"u"&&P instanceof ae)return P;if(P.curve!==void 0&&P.xy!==void 0&&P.d===void 0)return new J({pub:P.xy,curve:P.curve});if(P.curve!==void 0&&P.d!==void 0)return new J({prv:P.d,curve:P.curve});if(P.kty===void 0&&P.n!==void 0&&P.e!==void 0&&P.d===void 0){var W=new te;return W.setPublic(P.n,P.e),W}if(P.kty===void 0&&P.n!==void 0&&P.e!==void 0&&P.d!==void 0&&P.p!==void 0&&P.q!==void 0&&P.dp!==void 0&&P.dq!==void 0&&P.co!==void 0&&P.qi===void 0){var W=new te;return W.setPrivateEx(P.n,P.e,P.d,P.p,P.q,P.dp,P.dq,P.co),W}if(P.kty===void 0&&P.n!==void 0&&P.e!==void 0&&P.d!==void 0&&P.p===void 0){var W=new te;return W.setPrivate(P.n,P.e,P.d),W}if(P.p!==void 0&&P.q!==void 0&&P.g!==void 0&&P.y!==void 0&&P.x===void 0){var W=new ae;return W.setPublic(P.p,P.q,P.g,P.y),W}if(P.p!==void 0&&P.q!==void 0&&P.g!==void 0&&P.y!==void 0&&P.x!==void 0){var W=new ae;return W.setPrivate(P.p,P.q,P.g,P.y,P.x),W}if(P.kty==="RSA"&&P.n!==void 0&&P.e!==void 0&&P.d===void 0){var W=new te;return W.setPublic(On(P.n),On(P.e)),W}if(P.kty==="RSA"&&P.n!==void 0&&P.e!==void 0&&P.d!==void 0&&P.p!==void 0&&P.q!==void 0&&P.dp!==void 0&&P.dq!==void 0&&P.qi!==void 0){var W=new te;return W.setPrivateEx(On(P.n),On(P.e),On(P.d),On(P.p),On(P.q),On(P.dp),On(P.dq),On(P.qi)),W}if(P.kty==="RSA"&&P.n!==void 0&&P.e!==void 0&&P.d!==void 0){var W=new te;return W.setPrivate(On(P.n),On(P.e),On(P.d)),W}if(P.kty==="EC"&&P.crv!==void 0&&P.x!==void 0&&P.y!==void 0&&P.d===void 0){var ne=new J({curve:P.crv}),X=ne.ecparams.keycharlen,ie=("0000000000"+On(P.x)).slice(-X),ue=("0000000000"+On(P.y)).slice(-X),ve="04"+ie+ue;return ne.setPublicKeyHex(ve),ne}if(P.kty==="EC"&&P.crv!==void 0&&P.x!==void 0&&P.y!==void 0&&P.d!==void 0){var ne=new J({curve:P.crv}),X=ne.ecparams.keycharlen,ie=("0000000000"+On(P.x)).slice(-X),ue=("0000000000"+On(P.y)).slice(-X),ve="04"+ie+ue,ze=("0000000000"+On(P.d)).slice(-X);return ne.setPublicKeyHex(ve),ne.setPrivateKeyHex(ze),ne}if(A==="pkcs5prv"){var tt=P,q=dt,nt,W;if(nt=H(tt,0),nt.length===9)W=new te,W.readPKCS5PrvKeyHex(tt);else if(nt.length===6)W=new ae,W.readPKCS5PrvKeyHex(tt);else if(nt.length>2&&tt.substr(nt[1],2)==="04")W=new J,W.readPKCS5PrvKeyHex(tt);else throw new Error("unsupported PKCS#1/5 hexadecimal key");return W}if(A==="pkcs8prv"){var W=ce.getKeyFromPlainPrivatePKCS8Hex(P);return W}if(A==="pkcs8pub")return ce._getKeyFromPublicPKCS8Hex(P);if(A==="x509pub")return an.getPublicKeyFromCertHex(P);if(P.indexOf("-END CERTIFICATE-",0)!=-1||P.indexOf("-END X509 CERTIFICATE-",0)!=-1||P.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return an.getPublicKeyFromCertPEM(P);if(P.indexOf("-END PUBLIC KEY-")!=-1){var it=nr(P,"PUBLIC KEY");return ce._getKeyFromPublicPKCS8Hex(it)}if(P.indexOf("-END RSA PRIVATE KEY-")!=-1&&P.indexOf("4,ENCRYPTED")==-1){var _e=le(P,"RSA PRIVATE KEY");return ce.getKey(_e,null,"pkcs5prv")}if(P.indexOf("-END DSA PRIVATE KEY-")!=-1&&P.indexOf("4,ENCRYPTED")==-1){var Ie=le(P,"DSA PRIVATE KEY"),Ae=U(Ie,0,[1],"02"),Te=U(Ie,0,[2],"02"),Be=U(Ie,0,[3],"02"),rt=U(Ie,0,[4],"02"),ct=U(Ie,0,[5],"02"),W=new ae;return W.setPrivate(new l(Ae,16),new l(Te,16),new l(Be,16),new l(rt,16),new l(ct,16)),W}if(P.indexOf("-END EC PRIVATE KEY-")!=-1&&P.indexOf("4,ENCRYPTED")==-1){var _e=le(P,"EC PRIVATE KEY");return ce.getKey(_e,null,"pkcs5prv")}if(P.indexOf("-END PRIVATE KEY-")!=-1)return ce.getKeyFromPlainPrivatePKCS8PEM(P);if(P.indexOf("-END RSA PRIVATE KEY-")!=-1&&P.indexOf("4,ENCRYPTED")!=-1){var Tt=ce.getDecryptedKeyHex(P,N),st=new rn;return st.readPKCS5PrvKeyHex(Tt),st}if(P.indexOf("-END EC PRIVATE KEY-")!=-1&&P.indexOf("4,ENCRYPTED")!=-1){var Ie=ce.getDecryptedKeyHex(P,N),W=U(Ie,0,[1],"04"),yt=U(Ie,0,[2,0],"06"),Pt=U(Ie,0,[3,0],"03").substr(2),jt="";if(B.crypto.OID.oidhex2name[yt]!==void 0)jt=B.crypto.OID.oidhex2name[yt];else throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+yt);var ne=new J({curve:jt});return ne.setPublicKeyHex(Pt),ne.setPrivateKeyHex(W),ne.isPublic=!1,ne}if(P.indexOf("-END DSA PRIVATE KEY-")!=-1&&P.indexOf("4,ENCRYPTED")!=-1){var Ie=ce.getDecryptedKeyHex(P,N),Ae=U(Ie,0,[1],"02"),Te=U(Ie,0,[2],"02"),Be=U(Ie,0,[3],"02"),rt=U(Ie,0,[4],"02"),ct=U(Ie,0,[5],"02"),W=new ae;return W.setPrivate(new l(Ae,16),new l(Te,16),new l(Be,16),new l(rt,16),new l(ct,16)),W}if(P.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return ce.getKeyFromEncryptedPKCS8PEM(P,N);throw new Error("not supported argument")},Cn.generateKeypair=function(P,N){if(P=="RSA"){var A=N,q=new rn;q.generate(A,"10001"),q.isPrivate=!0,q.isPublic=!0;var H=new rn,U=q.n.toString(16),Q=q.e.toString(16);H.setPublic(U,Q),H.isPrivate=!1,H.isPublic=!0;var J={};return J.prvKeyObj=q,J.pubKeyObj=H,J}else if(P=="EC"){var ae=N,te=new B.crypto.ECDSA({curve:ae}),le=te.generateKeyPairHex(),q=new B.crypto.ECDSA({curve:ae});q.setPublicKeyHex(le.ecpubhex),q.setPrivateKeyHex(le.ecprvhex),q.isPrivate=!0,q.isPublic=!1;var H=new B.crypto.ECDSA({curve:ae});H.setPublicKeyHex(le.ecpubhex),H.isPrivate=!1,H.isPublic=!0;var J={};return J.prvKeyObj=q,J.pubKeyObj=H,J}else throw new Error("unknown algorithm: "+P)},Cn.getPEM=function(P,N,A,q,H,U){var Q=B,J=Q.asn1,ae=J.DERObjectIdentifier,te=J.DERInteger,le=J.ASN1Util.newObject,ce=J.x509,W=ce.SubjectPublicKeyInfo,ne=Q.crypto,X=ne.DSA,ie=ne.ECDSA,ue=rn;function ve(yt){var Pt=le({seq:[{int:0},{int:{bigint:yt.n}},{int:yt.e},{int:{bigint:yt.d}},{int:{bigint:yt.p}},{int:{bigint:yt.q}},{int:{bigint:yt.dmp1}},{int:{bigint:yt.dmq1}},{int:{bigint:yt.coeff}}]});return Pt}function ze(yt){var Pt=le({seq:[{int:1},{octstr:{hex:yt.prvKeyHex}},{tag:["a0",!0,{oid:{name:yt.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+yt.pubKeyHex}}]}]});return Pt}function tt(yt){var Pt=le({seq:[{int:0},{int:{bigint:yt.p}},{int:{bigint:yt.q}},{int:{bigint:yt.g}},{int:{bigint:yt.y}},{int:{bigint:yt.x}}]});return Pt}if((ue!==void 0&&P instanceof ue||X!==void 0&&P instanceof X||ie!==void 0&&P instanceof ie)&&P.isPublic==!0&&(N===void 0||N=="PKCS8PUB")){var nt=new W(P),it=nt.tohex();return Yn(it,"PUBLIC KEY")}if(N=="PKCS1PRV"&&ue!==void 0&&P instanceof ue&&(A===void 0||A==null)&&P.isPrivate==!0){var nt=ve(P),it=nt.tohex();return Yn(it,"RSA PRIVATE KEY")}if(N=="PKCS1PRV"&&ie!==void 0&&P instanceof ie&&(A===void 0||A==null)&&P.isPrivate==!0){var _e=new ae({name:P.curveName}),Ie=_e.tohex(),Ae=ze(P),Te=Ae.tohex(),Be="";return Be+=Yn(Ie,"EC PARAMETERS"),Be+=Yn(Te,"EC PRIVATE KEY"),Be}if(N=="PKCS1PRV"&&X!==void 0&&P instanceof X&&(A===void 0||A==null)&&P.isPrivate==!0){var nt=tt(P),it=nt.tohex();return Yn(it,"DSA PRIVATE KEY")}if(N=="PKCS5PRV"&&ue!==void 0&&P instanceof ue&&A!==void 0&&A!=null&&P.isPrivate==!0){var nt=ve(P),it=nt.tohex();return q===void 0&&(q="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",it,A,q,U)}if(N=="PKCS5PRV"&&ie!==void 0&&P instanceof ie&&A!==void 0&&A!=null&&P.isPrivate==!0){var nt=ze(P),it=nt.tohex();return q===void 0&&(q="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",it,A,q,U)}if(N=="PKCS5PRV"&&X!==void 0&&P instanceof X&&A!==void 0&&A!=null&&P.isPrivate==!0){var nt=tt(P),it=nt.tohex();return q===void 0&&(q="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",it,A,q,U)}var rt=function(yt,Pt){if(typeof Pt=="string")return Cn.getEncryptedPKCS8PEM(yt,Pt);if(typeof Pt=="object"&&rr(Pt,"passcode")!=null){var jt=JSON.parse(JSON.stringify(Pt)),kr=jt.passcode;return delete jt.passcode,Cn.getEncryptedPKCS8PEM(yt,kr,jt)}};if(N=="PKCS8PRV"&&ue!=null&&P instanceof ue&&P.isPrivate==!0){var ct=ve(P),Tt=ct.tohex(),nt=le({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:Tt}}]}),it=nt.tohex();return A===void 0||A==null?Yn(it,"PRIVATE KEY"):rt(it,A)}if(N=="PKCS8PRV"&&ie!==void 0&&P instanceof ie&&P.isPrivate==!0){var st={seq:[{int:1},{octstr:{hex:P.prvKeyHex}}]};typeof P.pubKeyHex=="string"&&st.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+P.pubKeyHex}}]});var ct=new le(st),Tt=ct.tohex(),nt=le({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:P.curveName}}]},{octstr:{hex:Tt}}]}),it=nt.tohex();return A===void 0||A==null?Yn(it,"PRIVATE KEY"):rt(it,A)}if(N=="PKCS8PRV"&&X!==void 0&&P instanceof X&&P.isPrivate==!0){var ct=new te({bigint:P.x}),Tt=ct.tohex(),nt=le({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:P.p}},{int:{bigint:P.q}},{int:{bigint:P.g}}]}]},{octstr:{hex:Tt}}]}),it=nt.tohex();return A===void 0||A==null?Yn(it,"PRIVATE KEY"):rt(it,A)}throw new Error("unsupported object nor format")},Cn.getKeyFromCSRPEM=function(P){var N=nr(P,"CERTIFICATE REQUEST"),A=Cn.getKeyFromCSRHex(N);return A},Cn.getKeyFromCSRHex=function(P){var N=Cn.parseCSRHex(P),A=Cn.getKey(N.p8pubkeyhex,null,"pkcs8pub");return A},Cn.parseCSRHex=function(P){var N=dt,A=N.getChildIdx,q=N.getTLV,H={},U=P;if(U.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var Q=A(U,0);if(Q.length<1)throw new Error("malformed CSR(code:002)");if(U.substr(Q[0],2)!="30")throw new Error("malformed CSR(code:003)");var J=A(U,Q[0]);if(J.length<3)throw new Error("malformed CSR(code:004)");return H.p8pubkeyhex=q(U,J[2]),H},Cn.getKeyID=function(P){var N=Cn,A=dt;typeof P=="string"&&P.indexOf("BEGIN ")!=-1&&(P=N.getKey(P));var q=nr(N.getPEM(P)),H=A.getIdxbyList(q,0,[1]),U=A.getV(q,H).substring(2);return B.crypto.Util.hashHex(U,"sha1")},Cn.getJWK=function(P,N,A,q,H){var U,Q={},J,ae=B.crypto.Util.hashHex;if(typeof P=="string")U=Cn.getKey(P),P.indexOf("CERTIFICATE")!=-1&&(J=nr(P));else if(typeof P=="object")P instanceof an?(U=P.getPublicKey(),J=P.hex):U=P;else throw new Error("unsupported keyinfo type");if(U instanceof rn&&U.isPrivate)Q.kty="RSA",Q.n=kn(U.n.toString(16)),Q.e=kn(U.e.toString(16)),Q.d=kn(U.d.toString(16)),Q.p=kn(U.p.toString(16)),Q.q=kn(U.q.toString(16)),Q.dp=kn(U.dmp1.toString(16)),Q.dq=kn(U.dmq1.toString(16)),Q.qi=kn(U.coeff.toString(16));else if(U instanceof rn&&U.isPublic)Q.kty="RSA",Q.n=kn(U.n.toString(16)),Q.e=kn(U.e.toString(16));else if(U instanceof B.crypto.ECDSA&&U.isPrivate){var te=U.getShortNISTPCurveName();if(te!=="P-256"&&te!=="P-384"&&te!=="P-521")throw new Error("unsupported curve name for JWT: "+te);var le=U.getPublicKeyXYHex();Q.kty="EC",Q.crv=te,Q.x=kn(le.x),Q.y=kn(le.y),Q.d=kn(U.prvKeyHex)}else if(U instanceof B.crypto.ECDSA&&U.isPublic){var te=U.getShortNISTPCurveName();if(te!=="P-256"&&te!=="P-384"&&te!=="P-521")throw new Error("unsupported curve name for JWT: "+te);var le=U.getPublicKeyXYHex();Q.kty="EC",Q.crv=te,Q.x=kn(le.x),Q.y=kn(le.y)}if(Q.kty==null)throw new Error("unsupported keyinfo");return!U.isPrivate&&N!=!0&&(Q.kid=B.jws.JWS.getJWKthumbprint(Q)),J!=null&&A!=!0&&(Q.x5c=[o(J)]),J!=null&&q!=!0&&(Q.x5t=ai(o(ae(J,"sha1")))),J!=null&&H!=!0&&(Q["x5t#S256"]=ai(o(ae(J,"sha256")))),Q},Cn.getJWKFromKey=function(P){return Cn.getJWK(P,!0,!0,!0,!0)},rn.getPosArrayOfChildrenFromHex=function(P){return dt.getChildIdx(P,0)},rn.getHexValueArrayOfChildrenFromHex=function(P){var N=dt,A=N.getV,W=rn.getPosArrayOfChildrenFromHex(P),q=A(P,W[0]),H=A(P,W[1]),U=A(P,W[2]),Q=A(P,W[3]),J=A(P,W[4]),ae=A(P,W[5]),te=A(P,W[6]),le=A(P,W[7]),ce=A(P,W[8]),W=new Array;return W.push(q,H,U,Q,J,ae,te,le,ce),W},rn.prototype.readPrivateKeyFromPEMString=function(P){var N=nr(P),A=rn.getHexValueArrayOfChildrenFromHex(N);this.setPrivateEx(A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8])},rn.prototype.readPKCS5PrvKeyHex=function(P){var N=rn.getHexValueArrayOfChildrenFromHex(P);this.setPrivateEx(N[1],N[2],N[3],N[4],N[5],N[6],N[7],N[8])},rn.prototype.readPKCS8PrvKeyHex=function(P){var N,A,q,H,U,Q,J,ae,te=dt,le=te.getVbyListEx;if(te.isASN1HEX(P)===!1)throw new Error("not ASN.1 hex string");try{N=le(P,0,[2,0,1],"02"),A=le(P,0,[2,0,2],"02"),q=le(P,0,[2,0,3],"02"),H=le(P,0,[2,0,4],"02"),U=le(P,0,[2,0,5],"02"),Q=le(P,0,[2,0,6],"02"),J=le(P,0,[2,0,7],"02"),ae=le(P,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(N,A,q,H,U,Q,J,ae)},rn.prototype.readPKCS5PubKeyHex=function(P){var N=dt,A=N.getV;if(N.isASN1HEX(P)===!1)throw new Error("keyHex is not ASN.1 hex string");var q=N.getChildIdx(P,0);if(q.length!==2||P.substr(q[0],2)!=="02"||P.substr(q[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var H=A(P,q[0]),U=A(P,q[1]);this.setPublic(H,U)},rn.prototype.readPKCS8PubKeyHex=function(P){var N=dt;if(N.isASN1HEX(P)===!1)throw new Error("not ASN.1 hex string");if(N.getTLVbyListEx(P,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var A=N.getTLVbyListEx(P,0,[1,0]);this.readPKCS5PubKeyHex(A)},rn.prototype.readCertPubKeyHex=function(P,N){var A,q;A=new an,A.readCertHex(P),q=A.getPublicKeyHex(),this.readPKCS8PubKeyHex(q)};function jb(P,N){for(var A="",q=N/4-P.length,H=0;H<q;H++)A=A+"0";return A+P}rn.prototype.sign=function(P,N){var A=function(H){return B.crypto.Util.hashString(H,N)},q=A(P);return this.signWithMessageHash(q,N)},rn.prototype.signWithMessageHash=function(P,N){var A=B.crypto.Util.getPaddedDigestInfoHex(P,N,this.n.bitLength()),q=ii(A,16),H=this.doPrivate(q),U=H.toString(16);return jb(U,this.n.bitLength())};function Mb(P,N,A){for(var q="",H=0;q.length<N;)q+=lr(A(Ts(P+String.fromCharCode.apply(String,[(H&4278190080)>>24,(H&16711680)>>16,(H&65280)>>8,H&255])))),H+=1;return q}rn.prototype.signPSS=function(P,N,A){var q=function(U){return B.crypto.Util.hashHex(U,N)},H=q(Ts(P));return A===void 0&&(A=-1),this.signWithMessageHashPSS(H,N,A)},rn.prototype.signWithMessageHashPSS=function(P,N,A){var q=lr(P),H=q.length,U=this.n.bitLength()-1,Q=Math.ceil(U/8),J,ae=function(ue){return B.crypto.Util.hashHex(ue,N)};if(A===-1||A===void 0)A=H;else if(A===-2)A=Q-H-2;else if(A<-2)throw new Error("invalid salt length");if(Q<H+A+2)throw new Error("data too long");var te="";A>0&&(te=new Array(A),new Us().nextBytes(te),te=String.fromCharCode.apply(String,te));var le=lr(ae(Ts("\0\0\0\0\0\0\0\0"+q+te))),ce=[];for(J=0;J<Q-A-H-2;J+=1)ce[J]=0;var W=String.fromCharCode.apply(String,ce)+""+te,ne=Mb(le,W.length,ae),X=[];for(J=0;J<W.length;J+=1)X[J]=W.charCodeAt(J)^ne.charCodeAt(J);var ie=65280>>8*Q-U&255;for(X[0]&=~ie,J=0;J<H;J++)X.push(le.charCodeAt(J));return X.push(188),jb(this.doPrivate(new l(X)).toString(16),this.n.bitLength())};function HT(P){for(var N in B.crypto.Util.DIGESTINFOHEAD){var A=B.crypto.Util.DIGESTINFOHEAD[N],q=A.length;if(P.substring(0,q)==A){var H=[N,P.substring(q)];return H}}return[]}rn.prototype.verify=function(P,N){if(N=N.toLowerCase(),N.match(/^[0-9a-f]+$/)==null)return!1;var A=ii(N,16),q=this.n.bitLength();if(A.bitLength()>q)return!1;var H=this.doPublic(A),U=H.toString(16);if(U.length+3!=q/4)return!1;var Q=U.replace(/^1f+00/,""),J=HT(Q);if(J.length==0)return!1;var ae=J[0],te=J[1],le=function(W){return B.crypto.Util.hashString(W,ae)},ce=le(P);return te==ce},rn.prototype.verifyWithMessageHash=function(P,N){if(N.length!=Math.ceil(this.n.bitLength()/4))return!1;var A=ii(N,16);if(A.bitLength()>this.n.bitLength())return 0;var q=this.doPublic(A),H=q.toString(16).replace(/^1f+00/,""),U=HT(H);if(U.length==0)return!1;U[0];var Q=U[1];return Q==P},rn.prototype.verifyPSS=function(P,N,A,q){var H=function(Q){return B.crypto.Util.hashHex(Q,A)},U=H(Ts(P));return q===void 0&&(q=-1),this.verifyWithMessageHashPSS(U,N,A,q)},rn.prototype.verifyWithMessageHashPSS=function(P,N,A,q){if(N.length!=Math.ceil(this.n.bitLength()/4))return!1;var H=new l(N,16),U=function(ze){return B.crypto.Util.hashHex(ze,A)},Q=lr(P),J=Q.length,ae=this.n.bitLength()-1,te=Math.ceil(ae/8),le;if(q===-1||q===void 0)q=J;else if(q===-2)q=te-J-2;else if(q<-2)throw new Error("invalid salt length");if(te<J+q+2)throw new Error("data too long");var ce=this.doPublic(H).toByteArray();for(le=0;le<ce.length;le+=1)ce[le]&=255;for(;ce.length<te;)ce.unshift(0);if(ce[te-1]!==188)throw new Error("encoded message does not end in 0xbc");ce=String.fromCharCode.apply(String,ce);var W=ce.substr(0,te-J-1),ne=ce.substr(W.length,J),X=65280>>8*te-ae&255;if((W.charCodeAt(0)&X)!==0)throw new Error("bits beyond keysize not zero");var ie=Mb(ne,W.length,U),ue=[];for(le=0;le<W.length;le+=1)ue[le]=W.charCodeAt(le)^ie.charCodeAt(le);ue[0]&=~X;var ve=te-J-q-2;for(le=0;le<ve;le+=1)if(ue[le]!==0)throw new Error("leftmost octets not zero");if(ue[ve]!==1)throw new Error("0x01 marker not found");return ne===lr(U(Ts("\0\0\0\0\0\0\0\0"+Q+String.fromCharCode.apply(String,ue.slice(-q)))))},rn.SALT_LEN_HLEN=-1,rn.SALT_LEN_MAX=-2,rn.SALT_LEN_RECOVER=-2;function an(P){var N=dt,A=N.getChildIdx,q=N.getV;N.dump;var H=N.parse,U=N.getTLV,Q=N.getVbyList,J=N.getVbyListEx,ae=N.getTLVbyList,te=N.getTLVbyListEx,le=N.getIdxbyList,ce=N.getIdxbyListEx,W=N.getVidx,ne=N.getInt,X=N.oidname,ie=N.hextooidstr,ue=nr,ve,ze=Error;try{ve=B.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var _e=ae(this.hex,0,[0,0]);if(_e.substr(0,2)=="a0"){var Ie=ae(_e,0,[0]),Ae=ne(Ie,0);if(Ae<0||2<Ae)throw new Error("malformed version field");return this.version=Ae+1,this.version}else return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return J(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var _e=te(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(_e)},this.getAlgorithmIdentifierName=function(_e){for(var Ie in ve)if(_e===ve[Ie])return Ie;return X(J(_e,0,[0],"06"))},this.getIssuer=function(_e,Ie){return this.getX500Name(this.getIssuerHex(),_e,Ie)},this.getIssuerHex=function(){return ae(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){var _e=this.getIssuer();return _e.str},this.getSubject=function(_e,Ie){return this.getX500Name(this.getSubjectHex(),_e,Ie)},this.getSubjectHex=function(){return ae(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){var _e=this.getSubject();return _e.str},this.getNotBefore=function(){var _e=Q(this.hex,0,[0,4+this.foffset,0]);return _e=_e.replace(/(..)/g,"%$1"),_e=decodeURIComponent(_e),_e},this.getNotAfter=function(){var _e=Q(this.hex,0,[0,4+this.foffset,1]);return _e=_e.replace(/(..)/g,"%$1"),_e=decodeURIComponent(_e),_e},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return ae(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var _e=this.getSPKI();return _e==null?null:Q(_e,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return le(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var _e=this.getPublicKeyIdx();return le(this.hex,_e,[1,0],"30")},this.getPublicKey=function(){return Cn.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var _e=ae(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(_e)},this.getSignatureValueHex=function(){return Q(this.hex,0,[2],"03",!0)},this.verifySignature=function(_e){var Ie=this.getSignatureAlgorithmField(),Ae=this.getSignatureValueHex(),Te=ae(this.hex,0,[0],"30"),Be=new B.crypto.Signature({alg:Ie});return Be.init(_e),Be.updateHex(Te),Be.verify(Ae)},this.parseExt=function(_e){var Ie,Ae,Te;if(_e===void 0){if(Te=this.hex,this.version!==3)return-1;Ie=le(Te,0,[0,7,0],"30"),Ae=A(Te,Ie)}else{Te=nr(_e);var Be=le(Te,0,[0,3,0,0],"06");if(q(Te,Be)!="2a864886f70d01090e"){this.aExtInfo=new Array;return}Ie=le(Te,0,[0,3,0,1,0],"30"),Ae=A(Te,Ie),this.hex=Te}this.aExtInfo=new Array;for(var rt=0;rt<Ae.length;rt++){var ct={};ct.critical=!1;var Tt=A(Te,Ae[rt]),st=0;Tt.length===3&&(ct.critical=!0,st=1),ct.oid=N.hextooidstr(Q(Te,Ae[rt],[0],"06"));var yt=le(Te,Ae[rt],[1+st]);ct.vidx=W(Te,yt),this.aExtInfo.push(ct)}},this.getExtInfo=function(_e){var Ie=this.aExtInfo,Ae=_e;if(_e.match(/^[0-9.]+$/)||(Ae=B.asn1.x509.OID.name2oid(_e)),Ae!==""){for(var Te=0;Te<Ie.length;Te++)if(Ie[Te].oid===Ae)return Ie[Te]}},this.getCriticalExtV=function(_e,Ie,Ae){if(Ie!=null)return[Ie,Ae];var Te=this.getExtInfo(_e);return Te==null?[null,null]:[U(this.hex,Te.vidx),Te.critical]},this.getExtBasicConstraints=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("basicConstraints");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"basicConstraints"};if(Ie&&(Te.critical=!0),_e==="3000")return Te;if(_e==="30030101ff")return Te.cA=!0,Te;if(_e.substr(0,12)==="30060101ff02"){var Be=q(_e,10),rt=parseInt(Be,16);return Te.cA=!0,Te.pathLen=rt,Te}throw new Error("hExtV parse error: "+_e)},this.getExtNameConstraints=function(_e,Ie){var Ae=this.getCriticalExtV("nameConstraints",_e,Ie);if(_e=Ae[0],Ie=Ae[1],_e!=null){var Te={extname:"nameConstraints"};Ie&&(Te.critical=!0);for(var Be=A(_e,0),rt=0;rt<Be.length;rt++){for(var ct=[],Tt=A(_e,Be[rt]),st=0;st<Tt.length;st++){var yt=U(_e,Tt[st]),Pt=this.getGeneralSubtree(yt);ct.push(Pt)}var jt=_e.substr(Be[rt],2);jt=="a0"?Te.permit=ct:jt=="a1"&&(Te.exclude=ct)}return Te}},this.getGeneralSubtree=function(_e){var Ie=A(_e,0),Ae=Ie.length;if(Ae<1||2<Ae)throw new Error("wrong num elements");for(var Te=this.getGeneralName(U(_e,Ie[0])),Be=1;Be<Ae;Be++){var rt=_e.substr(Ie[Be],2),ct=q(_e,Ie[Be]),Tt=parseInt(ct,16);rt=="80"&&(Te.min=Tt),rt=="81"&&(Te.max=Tt)}return Te},this.getExtKeyUsage=function(_e,Ie){var Ae=this.getCriticalExtV("keyUsage",_e,Ie);if(_e=Ae[0],Ie=Ae[1],_e!=null){var Te={extname:"keyUsage"};return Ie&&(Te.critical=!0),Te.names=this.getExtKeyUsageString(_e).split(","),Te}},this.getExtKeyUsageBin=function(_e){if(_e===void 0){var Ie=this.getExtInfo("keyUsage");if(Ie===void 0)return"";_e=U(this.hex,Ie.vidx)}if(_e.length!=8&&_e.length!=10)throw new Error("malformed key usage value: "+_e);var Ae="000000000000000"+parseInt(_e.substr(6),16).toString(2);return _e.length==8&&(Ae=Ae.slice(-8)),_e.length==10&&(Ae=Ae.slice(-16)),Ae=Ae.replace(/0+$/,""),Ae==""&&(Ae="0"),Ae},this.getExtKeyUsageString=function(_e){for(var Ie=this.getExtKeyUsageBin(_e),Ae=new Array,Te=0;Te<Ie.length;Te++)Ie.substr(Te,1)=="1"&&Ae.push(an.KEYUSAGE_NAME[Te]);return Ae.join(",")},this.getExtSubjectKeyIdentifier=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("subjectKeyIdentifier");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"subjectKeyIdentifier"};Ie&&(Te.critical=!0);var Be=q(_e,0);return Te.kid={hex:Be},Te},this.getExtAuthorityKeyIdentifier=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("authorityKeyIdentifier");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"authorityKeyIdentifier"};Ie&&(Te.critical=!0);for(var Be=A(_e,0),rt=0;rt<Be.length;rt++){var ct=_e.substr(Be[rt],2);if(ct==="80"&&(Te.kid={hex:q(_e,Be[rt])}),ct==="a1"){var Tt=U(_e,Be[rt]),st=this.getGeneralNames(Tt);Te.issuer=st[0].dn}ct==="82"&&(Te.sn={hex:q(_e,Be[rt])})}return Te},this.getExtExtKeyUsage=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("extKeyUsage");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"extKeyUsage",array:[]};Ie&&(Te.critical=!0);for(var Be=A(_e,0),rt=0;rt<Be.length;rt++)Te.array.push(X(q(_e,Be[rt])));return Te},this.getExtExtKeyUsageName=function(){var _e=this.getExtInfo("extKeyUsage");if(_e===void 0)return _e;var Ie=new Array,Ae=U(this.hex,_e.vidx);if(Ae==="")return Ie;for(var Te=A(Ae,0),Be=0;Be<Te.length;Be++)Ie.push(X(q(Ae,Te[Be])));return Ie},this.getExtSubjectAltName=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("subjectAltName");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"subjectAltName",array:[]};return Ie&&(Te.critical=!0),Te.array=this.getGeneralNames(_e),Te},this.getExtIssuerAltName=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("issuerAltName");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"issuerAltName",array:[]};return Ie&&(Te.critical=!0),Te.array=this.getGeneralNames(_e),Te},this.getGeneralNames=function(_e){for(var Ie=A(_e,0),Ae=[],Te=0;Te<Ie.length;Te++){var Be=this.getGeneralName(U(_e,Ie[Te]));Be!==void 0&&Ae.push(Be)}return Ae},this.getGeneralName=function(_e){var Ie=_e.substr(0,2),Ae=q(_e,0),Te=lr(Ae);if(Ie=="81")return{rfc822:Te};if(Ie=="82")return{dns:Te};if(Ie=="86")return{uri:Te};if(Ie=="87")return{ip:kl(Ae)};if(Ie=="a4")return{dn:this.getX500Name(Ae)};if(Ie=="a0")return{other:this.getOtherName(_e)}},this.getExtSubjectAltName2=function(){var _e,Ie,Ae,Te=this.getExtInfo("subjectAltName");if(Te===void 0)return Te;for(var Be=new Array,rt=U(this.hex,Te.vidx),ct=A(rt,0),Tt=0;Tt<ct.length;Tt++)Ae=rt.substr(ct[Tt],2),_e=q(rt,ct[Tt]),Ae==="81"&&(Ie=Ln(_e),Be.push(["MAIL",Ie])),Ae==="82"&&(Ie=Ln(_e),Be.push(["DNS",Ie])),Ae==="84"&&(Ie=an.hex2dn(_e,0),Be.push(["DN",Ie])),Ae==="86"&&(Ie=Ln(_e),Be.push(["URI",Ie])),Ae==="87"&&(Ie=kl(_e),Be.push(["IP",Ie]));return Be},this.getExtCRLDistributionPoints=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("cRLDistributionPoints");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"cRLDistributionPoints",array:[]};Ie&&(Te.critical=!0);for(var Be=A(_e,0),rt=0;rt<Be.length;rt++){var ct=U(_e,Be[rt]);Te.array.push(this.getDistributionPoint(ct))}return Te},this.getDistributionPoint=function(_e){for(var Ie={},Ae=A(_e,0),Te=0;Te<Ae.length;Te++){var Be=_e.substr(Ae[Te],2),rt=U(_e,Ae[Te]);Be=="a0"&&(Ie.dpname=this.getDistributionPointName(rt))}return Ie},this.getDistributionPointName=function(_e){for(var Ie={},Ae=A(_e,0),Te=0;Te<Ae.length;Te++){var Be=_e.substr(Ae[Te],2),rt=U(_e,Ae[Te]);Be=="a0"&&(Ie.full=this.getGeneralNames(rt))}return Ie},this.getExtCRLDistributionPointsURI=function(){var _e=this.getExtCRLDistributionPoints();if(_e==null)return _e;for(var Ie=_e.array,Ae=[],Te=0;Te<Ie.length;Te++)try{Ie[Te].dpname.full[0].uri!=null&&Ae.push(Ie[Te].dpname.full[0].uri)}catch{}return Ae},this.getExtAIAInfo=function(){var _e=this.getExtInfo("authorityInfoAccess");if(_e===void 0)return _e;for(var Ie={ocsp:[],caissuer:[]},Ae=A(this.hex,_e.vidx),Te=0;Te<Ae.length;Te++){var Be=Q(this.hex,Ae[Te],[0],"06"),rt=Q(this.hex,Ae[Te],[1],"86");Be==="2b06010505073001"&&Ie.ocsp.push(Ln(rt)),Be==="2b06010505073002"&&Ie.caissuer.push(Ln(rt))}return Ie},this.getExtAuthorityInfoAccess=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("authorityInfoAccess");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"authorityInfoAccess",array:[]};Ie&&(Te.critical=!0);for(var Be=A(_e,0),rt=0;rt<Be.length;rt++){var ct=J(_e,Be[rt],[0],"06"),Tt=Q(_e,Be[rt],[1],"86"),st=Ln(Tt);if(ct=="2b06010505073001")Te.array.push({ocsp:st});else if(ct=="2b06010505073002")Te.array.push({caissuer:st});else throw new Error("unknown method: "+ct)}return Te},this.getExtCertificatePolicies=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("certificatePolicies");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"certificatePolicies",array:[]};Ie&&(Te.critical=!0);for(var Be=A(_e,0),rt=0;rt<Be.length;rt++){var ct=U(_e,Be[rt]),Tt=this.getPolicyInformation(ct);Te.array.push(Tt)}return Te},this.getPolicyInformation=function(_e){var Ie={},Ae=Q(_e,0,[0],"06");Ie.policyoid=X(Ae);var Te=ce(_e,0,[1],"30");if(Te!=-1){Ie.array=[];for(var Be=A(_e,Te),rt=0;rt<Be.length;rt++){var ct=U(_e,Be[rt]),Tt=this.getPolicyQualifierInfo(ct);Ie.array.push(Tt)}}return Ie},this.getOtherName=function(_e){var Ie={},Ae=A(_e,0),Te=Q(_e,Ae[0],[],"06"),Be=Q(_e,Ae[1],[]);return Ie.oid=X(Te),Ie.value=H(Be),Ie},this.getPolicyQualifierInfo=function(_e){var Ie={},Ae=Q(_e,0,[0],"06");if(Ae==="2b06010505070201"){var Te=J(_e,0,[1],"16");Ie.cps=lr(Te)}else if(Ae==="2b06010505070202"){var Be=ae(_e,0,[1],"30");Ie.unotice=this.getUserNotice(Be)}return Ie},this.getUserNotice=function(_e){var Ie=null;try{Ie=N.parse(_e);var Ae=this._asn1ToUnotice(Ie);return Ae}catch{return}},this._asn1ToUnotice=function(_e){try{for(var Ie={},Ae=rr(_e,"seq"),Te=0;Te<Ae.length;Te++){var Be=this._asn1ToNoticeRef(Ae[Te]);Be!=null&&(Ie.noticeref=Be);var rt=this.asn1ToDisplayText(Ae[Te]);rt!=null&&(Ie.exptext=rt)}return Object.keys(Ie).length>0?Ie:void 0}catch{return}},this._asn1ToNoticeRef=function(_e){try{for(var Ie={},Ae=rr(_e,"seq"),Te=0;Te<Ae.length;Te++){var Be=this._asn1ToNoticeNum(Ae[Te]);Be!=null&&(Ie.noticenum=Be);var rt=this.asn1ToDisplayText(Ae[Te]);rt!=null&&(Ie.org=rt)}return Object.keys(Ie).length>0?Ie:void 0}catch{return}},this._asn1ToNoticeNum=function(_e){try{for(var Ie=rr(_e,"seq"),Ae=[],Te=0;Te<Ie.length;Te++){var Be=Ie[Te];Ae.push(parseInt(rr(Be,"int.hex"),16))}return Ae}catch{return}},this.getDisplayText=function(_e){var Ie={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"},Ae={};return Ae.type=Ie[_e.substr(0,2)],Ae.str=lr(q(_e,0)),Ae},this.asn1ToDisplayText=function(_e){if(_e.utf8str!=null)return{type:"utf8",str:_e.utf8str.str};if(_e.ia5str!=null)return{type:"ia5",str:_e.ia5str.str};if(_e.visstr!=null)return{type:"vis",str:_e.visstr.str};if(_e.bmpstr!=null)return{type:"bmp",str:_e.bmpstr.str};if(_e.prnstr!=null)return{type:"prn",str:_e.prnstr.str}},this.getExtPolicyMappings=function(_e,Ie){var Ae=this.getCriticalExtV("policyMappings",_e,Ie);if(_e=Ae[0],Ie=Ae[1],_e!=null){var Te={extname:"policyMappings"};Ie&&(Te.critical=!0);try{for(var Be=H(_e),rt=Be.seq,ct=[],Tt=0;Tt<rt.length;Tt++){var st=rt[Tt].seq;ct.push([st[0].oid,st[1].oid])}Te.array=ct}catch{throw new ze("malformed policyMappings")}return Te}},this.getExtPolicyConstraints=function(_e,Ie){var Ae=this.getCriticalExtV("policyConstraints",_e,Ie);if(_e=Ae[0],Ie=Ae[1],_e!=null){var Te={extname:"policyConstraints"};Ie&&(Te.critical=!0);var Be=H(_e);try{for(var rt=Be.seq,ct=0;ct<rt.length;ct++){var Tt=rt[ct].tag;Tt.explicit==!1&&(Tt.tag=="80"&&(Te.reqexp=parseInt(Tt.hex,16)),Tt.tag=="81"&&(Te.inhibit=parseInt(Tt.hex,16)))}}catch{return new ze("malformed policyConstraints value")}return Te}},this.getExtInhibitAnyPolicy=function(_e,Ie){var Ae=this.getCriticalExtV("inhibitAnyPolicy",_e,Ie);if(_e=Ae[0],Ie=Ae[1],_e!=null){var Te={extname:"inhibitAnyPolicy"};Ie&&(Te.critical=!0);var Be=ne(_e,0);return Be==-1?new ze("wrong value"):(Te.skip=Be,Te)}},this.getExtCRLNumber=function(_e,Ie){var Ae={extname:"cRLNumber"};if(Ie&&(Ae.critical=!0),_e.substr(0,2)=="02")return Ae.num={hex:q(_e,0)},Ae;throw new ze("hExtV parse error: "+_e)},this.getExtCRLReason=function(_e,Ie){var Ae={extname:"cRLReason"};if(Ie&&(Ae.critical=!0),_e.substr(0,2)=="0a")return Ae.code=parseInt(q(_e,0),16),Ae;throw new Error("hExtV parse error: "+_e)},this.getExtOcspNonce=function(_e,Ie){var Ae={extname:"ocspNonce"};Ie&&(Ae.critical=!0);var Te=q(_e,0);return Ae.hex=Te,Ae},this.getExtOcspNoCheck=function(_e,Ie){var Ae={extname:"ocspNoCheck"};return Ie&&(Ae.critical=!0),Ae},this.getExtAdobeTimeStamp=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("adobeTimeStamp");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"adobeTimeStamp"};Ie&&(Te.critical=!0);var Be=A(_e,0);if(Be.length>1){var rt=U(_e,Be[1]),ct=this.getGeneralName(rt);ct.uri!=null&&(Te.uri=ct.uri)}if(Be.length>2){var Tt=U(_e,Be[2]);Tt=="0101ff"&&(Te.reqauth=!0),Tt=="010100"&&(Te.reqauth=!1)}return Te},this.getExtSubjectDirectoryAttributes=function(_e,Ie){if(_e===void 0&&Ie===void 0){var Ae=this.getExtInfo("subjectDirectoryAttributes");if(Ae===void 0)return;_e=U(this.hex,Ae.vidx),Ie=Ae.critical}var Te={extname:"subjectDirectoryAttributes"};Ie&&(Te.critical=!0);try{for(var Be=H(_e),rt=[],ct=0;ct<Be.seq.length;ct++){var Tt=Be.seq[ct],st=rr(Tt,"seq.0.oid"),yt=rr(Tt,"seq.1.set");if(st==null||yt==null)throw"error";rt.push({attr:st,array:yt})}return Te.array=rt,Te}catch{throw new Error("malformed subjectDirectoryAttributes extension value")}};var tt=function(_e){var Ie={};try{var Ae=_e.seq[0].oid,Te=B.asn1.x509.OID.name2oid(Ae);Ie.type=B.asn1.x509.OID.oid2atype(Te);var Be=_e.seq[1];if(Be.utf8str!=null)Ie.ds="utf8",Ie.value=Be.utf8str.str;else if(Be.numstr!=null)Ie.ds="num",Ie.value=Be.numstr.str;else if(Be.telstr!=null)Ie.ds="tel",Ie.value=Be.telstr.str;else if(Be.prnstr!=null)Ie.ds="prn",Ie.value=Be.prnstr.str;else if(Be.ia5str!=null)Ie.ds="ia5",Ie.value=Be.ia5str.str;else if(Be.visstr!=null)Ie.ds="vis",Ie.value=Be.visstr.str;else if(Be.bmpstr!=null)Ie.ds="bmp",Ie.value=Be.bmpstr.str;else throw"error";return Ie}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},nt=function(_e){try{return _e.set.map(function(Ie){return tt(Ie)})}catch(Ie){throw new Error("improper ASN.1 parsed RDN: "+Ie)}},it=function(_e){try{return _e.seq.map(function(Ie){return nt(Ie)})}catch(Ie){throw new Error("improper ASN.1 parsed X500Name: "+Ie)}};this.getX500NameRule=function(_e){for(var Ie=null,Ae=[],Te=0;Te<_e.length;Te++)for(var Be=_e[Te],rt=0;rt<Be.length;rt++)Ae.push(Be[rt]);for(var Te=0;Te<Ae.length;Te++){var ct=Ae[Te],Tt=ct.ds,st=ct.value,yt=ct.type;if(Tt!="prn"&&Tt!="utf8"&&Tt!="ia5")return"mixed";if(Tt=="ia5"){if(yt!="CN")return"mixed";if(B.lang.String.isMail(st))continue;return"mixed"}if(yt=="C"){if(Tt=="prn")continue;return"mixed"}if(Ie==null)Ie=Tt;else if(Ie!==Tt)return"mixed"}return Ie??"prn"},this.getAttrTypeAndValue=function(_e){var Ie=H(_e);return tt(Ie)},this.getRDN=function(_e){var Ie=H(_e);return nt(Ie)},this.getX500NameArray=function(_e){var Ie=H(_e);return it(Ie)},this.getX500Name=function(_e,Ie,Ae){var Te=this.getX500NameArray(_e),Be=this.dnarraytostr(Te),rt={str:Be};return rt.array=Te,Ae==!0&&(rt.hex=_e),Ie==!0&&(rt.canon=this.c14nRDNArray(Te)),rt},this.readCertPEM=function(_e){this.readCertHex(ue(_e))},this.readCertHex=function(_e){this.hex=_e,this.getVersion();try{le(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(_e){var Ie={};return _e==null&&(_e={}),Ie.version=this.getVersion(),Ie.serial={hex:this.getSerialNumberHex()},Ie.sigalg=this.getSignatureAlgorithmField(),Ie.issuer=this.getIssuer(_e.dncanon,_e.dnhex),Ie.notbefore=this.getNotBefore(),Ie.notafter=this.getNotAfter(),Ie.subject=this.getSubject(_e.dncanon,_e.dnhex),Ie.sbjpubkey=Yn(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo!=null&&this.aExtInfo.length>0&&(Ie.ext=this.getExtParamArray()),Ie.sighex=this.getSignatureValueHex(),_e.tbshex==!0&&(Ie.tbshex=ae(this.hex,0,[0])),_e.nodnarray==!0&&(delete Ie.issuer.array,delete Ie.subject.array),Ie},this.getExtParamArray=function(_e){if(_e==null){var Ie=ce(this.hex,0,[0,"[3]"]);Ie!=-1&&(_e=te(this.hex,0,[0,"[3]",0],"30"))}for(var Ae=[],Te=A(_e,0),Be=0;Be<Te.length;Be++){var rt=U(_e,Te[Be]),ct=this.getExtParam(rt);ct!=null&&Ae.push(ct)}return Ae},this.getExtParam=function(_e){var Ie=A(_e,0),Ae=Ie.length;if(Ae!=2&&Ae!=3)throw new Error("wrong number elements in Extension: "+Ae+" "+_e);var Te=ie(Q(_e,0,[0],"06")),Be=!1;Ae==3&&ae(_e,0,[1])=="0101ff"&&(Be=!0);var rt=ae(_e,0,[Ae-1,0]),ct=void 0;if(Te=="2.5.29.14"?ct=this.getExtSubjectKeyIdentifier(rt,Be):Te=="2.5.29.15"?ct=this.getExtKeyUsage(rt,Be):Te=="2.5.29.17"?ct=this.getExtSubjectAltName(rt,Be):Te=="2.5.29.18"?ct=this.getExtIssuerAltName(rt,Be):Te=="2.5.29.19"?ct=this.getExtBasicConstraints(rt,Be):Te=="2.5.29.30"?ct=this.getExtNameConstraints(rt,Be):Te=="2.5.29.31"?ct=this.getExtCRLDistributionPoints(rt,Be):Te=="2.5.29.32"?ct=this.getExtCertificatePolicies(rt,Be):Te=="2.5.29.33"?ct=this.getExtPolicyMappings(rt,Be):Te=="2.5.29.35"?ct=this.getExtAuthorityKeyIdentifier(rt,Be):Te=="2.5.29.36"?ct=this.getExtPolicyConstraints(rt,Be):Te=="2.5.29.37"?ct=this.getExtExtKeyUsage(rt,Be):Te=="2.5.29.54"?ct=this.getExtInhibitAnyPolicy(rt,Be):Te=="1.3.6.1.5.5.7.1.1"?ct=this.getExtAuthorityInfoAccess(rt,Be):Te=="2.5.29.20"?ct=this.getExtCRLNumber(rt,Be):Te=="2.5.29.21"?ct=this.getExtCRLReason(rt,Be):Te=="2.5.29.9"?ct=this.getExtSubjectDirectoryAttributes(rt,Be):Te=="1.3.6.1.5.5.7.48.1.2"?ct=this.getExtOcspNonce(rt,Be):Te=="1.3.6.1.5.5.7.48.1.5"?ct=this.getExtOcspNoCheck(rt,Be):Te=="1.2.840.113583.1.1.9.1"?ct=this.getExtAdobeTimeStamp(rt,Be):an.EXT_PARSER[Te]!=null&&(ct=an.EXT_PARSER[Te](Te,Be,rt)),ct!=null)return ct;var Tt={extname:Te,extn:rt};try{Tt.extn=H(rt)}catch{}return Be&&(Tt.critical=!0),Tt},this.findExt=function(_e,Ie){for(var Ae=0;Ae<_e.length;Ae++)if(_e[Ae].extname==Ie)return _e[Ae];return null},this.updateExtCDPFullURI=function(_e,Ie){var Ae=this.findExt(_e,"cRLDistributionPoints");if(Ae!=null&&Ae.array!=null){for(var Te=Ae.array,Be=0;Be<Te.length;Be++)if(Te[Be].dpname!=null&&Te[Be].dpname.full!=null)for(var rt=Te[Be].dpname.full,ct=0;ct<rt.length;ct++){var Tt=rt[Be];Tt.uri!=null&&(Tt.uri=Ie)}}},this.updateExtAIAOCSP=function(_e,Ie){var Ae=this.findExt(_e,"authorityInfoAccess");if(Ae!=null&&Ae.array!=null)for(var Te=Ae.array,Be=0;Be<Te.length;Be++)Te[Be].ocsp!=null&&(Te[Be].ocsp=Ie)},this.updateExtAIACAIssuer=function(_e,Ie){var Ae=this.findExt(_e,"authorityInfoAccess");if(Ae!=null&&Ae.array!=null)for(var Te=Ae.array,Be=0;Be<Te.length;Be++)Te[Be].caissuer!=null&&(Te[Be].caissuer=Ie)},this.dnarraytostr=function(_e){function Ie(Te){return Te.map(function(Be){return Ae(Be).replace(/\+/,"\\+")}).join("+")}function Ae(Te){return Te.type+"="+Te.value}return"/"+_e.map(function(Te){return Ie(Te).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(_e){var Ie;if(_e.str!=null&&_e.array==null){var Ae=new B.asn1.x509.X500Name({str:_e.str}),Te=Ae.tohex();Ie=this.getX500NameArray(Te)}else Ie=_e.array;_e.canon==null&&(_e.canon=this.c14nRDNArray(Ie))},this.c14nRDNArray=function(_e){for(var Ie=[],Ae=0;Ae<_e.length;Ae++){for(var Te=_e[Ae],Be=[],rt=0;rt<Te.length;rt++){var ct=Te[rt],Tt=ct.value;Tt=Tt.replace(/^\s*/,""),Tt=Tt.replace(/\s*$/,""),Tt=Tt.replace(/\s+/g," "),Tt=Tt.toLowerCase(),Be.push(ct.type.toLowerCase()+"="+Tt)}Ie.push(Be.join("+"))}return"/"+Ie.join("/")},this.getInfo=function(){var _e=function(Ir){for(var Tn="",Fn="    ",Rr=`
`,Fr=Ir.array,fi=0;fi<Fr.length;fi++){var fr=Fr[fi];if(fr.dn!=null&&(Tn+=Fn+"dn: "+fr.dn.str+Rr),fr.ip!=null&&(Tn+=Fn+"ip: "+fr.ip+Rr),fr.rfc822!=null&&(Tn+=Fn+"rfc822: "+fr.rfc822+Rr),fr.dns!=null&&(Tn+=Fn+"dns: "+fr.dns+Rr),fr.uri!=null&&(Tn+=Fn+"uri: "+fr.uri+Rr),fr.other!=null){var jd=fr.other.oid,ia=JSON.stringify(fr.other.value).replace(/\"/g,"");Tn+=Fn+"other: "+jd+"="+ia+Rr}}return Tn=Tn.replace(/\n$/,""),Tn},Ie=function(Ir){for(var Tn="",Fn=Ir.array,Rr=0;Rr<Fn.length;Rr++){var Fr=Fn[Rr];if(Tn+="    policy oid: "+Fr.policyoid+`
`,Fr.array!==void 0)for(var fi=0;fi<Fr.array.length;fi++){var fr=Fr.array[fi];fr.cps!==void 0&&(Tn+="    cps: "+fr.cps+`
`)}}return Tn},Ae=function(Ir){for(var Tn="",Fn=Ir.array,Rr=0;Rr<Fn.length;Rr++){var Fr=Fn[Rr];try{Fr.dpname.full[0].uri!==void 0&&(Tn+="    "+Fr.dpname.full[0].uri+`
`)}catch{}try{Fr.dname.full[0].dn.hex!==void 0&&(Tn+="    "+an.hex2dn(Fr.dpname.full[0].dn.hex)+`
`)}catch{}}return Tn},Te=function(Ir){for(var Tn="",Fn=Ir.array,Rr=0;Rr<Fn.length;Rr++){var Fr=Fn[Rr];Fr.caissuer!==void 0&&(Tn+="    caissuer: "+Fr.caissuer+`
`),Fr.ocsp!==void 0&&(Tn+="    ocsp: "+Fr.ocsp+`
`)}return Tn},Be,rt,ct;if(Be=`Basic Fields
`,Be+="  serial number: "+this.getSerialNumberHex()+`
`,Be+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,Be+="  issuer: "+this.getIssuerString()+`
`,Be+="  notBefore: "+this.getNotBefore()+`
`,Be+="  notAfter: "+this.getNotAfter()+`
`,Be+="  subject: "+this.getSubjectString()+`
`,Be+=`  subject public key info: 
`,rt=this.getPublicKey(),Be+="    key algorithm: "+rt.type+`
`,rt.type==="RSA"&&(Be+="    n="+gy(rt.n.toString(16)).substr(0,16)+`...
`,Be+="    e="+gy(rt.e.toString(16))+`
`),ct=this.aExtInfo,ct!=null){Be+=`X509v3 Extensions:
`;for(var Tt=0;Tt<ct.length;Tt++){var st=ct[Tt],yt=B.asn1.x509.OID.oid2name(st.oid);yt===""&&(yt=st.oid);var Pt="";if(st.critical===!0&&(Pt="CRITICAL"),Be+="  "+yt+" "+Pt+`:
`,yt==="basicConstraints"){var jt=this.getExtBasicConstraints();jt.cA===void 0?Be+=`    {}
`:(Be+="    cA=true",jt.pathLen!==void 0&&(Be+=", pathLen="+jt.pathLen),Be+=`
`)}else if(yt=="policyMappings"){var kr=this.getExtPolicyMappings().array,Er=kr.map(function(Ir){var Tn=Ir;return Tn[0]+":"+Tn[1]}).join(", ");Be+="    "+Er+`
`}else if(yt=="policyConstraints"){var ir=this.getExtPolicyConstraints();Be+="    ",ir.reqexp!=null&&(Be+=" reqexp="+ir.reqexp),ir.inhibit!=null&&(Be+=" inhibit="+ir.inhibit),Be+=`
`}else if(yt=="inhibitAnyPolicy"){var ir=this.getExtInhibitAnyPolicy();Be+="    skip="+ir.skip+`
`}else if(yt=="keyUsage")Be+="    "+this.getExtKeyUsageString()+`
`;else if(yt=="subjectKeyIdentifier")Be+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(yt=="authorityKeyIdentifier"){var xr=this.getExtAuthorityKeyIdentifier();xr.kid!==void 0&&(Be+="    kid="+xr.kid.hex+`
`)}else if(yt=="extKeyUsage"){var Vn=this.getExtExtKeyUsage().array;Be+="    "+Vn.join(", ")+`
`}else if(yt=="subjectAltName"){var _n=_e(this.getExtSubjectAltName());Be+=_n+`
`}else if(yt=="cRLDistributionPoints"){var dn=this.getExtCRLDistributionPoints();Be+=Ae(dn)}else if(yt=="authorityInfoAccess"){var ra=this.getExtAuthorityInfoAccess();Be+=Te(ra)}else yt=="certificatePolicies"&&(Be+=Ie(this.getExtCertificatePolicies()))}}return Be+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,Be+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`,Be},typeof P=="string"&&(P.indexOf("-----BEGIN")!=-1?this.readCertPEM(P):B.lang.String.isHex(P)&&this.readCertHex(P))}an.EXT_PARSER={},an.registExtParser=function(P,N){an.EXT_PARSER[P]=N},an.hex2dn=function(P,N){N===void 0&&(N=0);var A=new an;dt.getTLV(P,N);var q=A.getX500Name(P);return q.str},an.hex2rdn=function(P,N){if(N===void 0&&(N=0),P.substr(N,2)!=="31")throw new Error("malformed RDN");for(var A=new Array,q=dt.getChildIdx(P,N),H=0;H<q.length;H++)A.push(an.hex2attrTypeValue(P,q[H]));return A=A.map(function(U){return U.replace("+","\\+")}),A.join("+")},an.hex2attrTypeValue=function(P,N){var A=dt,q=A.getV;if(N===void 0&&(N=0),P.substr(N,2)!=="30")throw new Error("malformed attribute type and value");var H=A.getChildIdx(P,N);H.length!==2||P.substr(H[0],2);var U=q(P,H[0]),Q=B.asn1.ASN1Util.oidHexToInt(U),J=B.asn1.x509.OID.oid2atype(Q),ae=q(P,H[1]),te=lr(ae);return J+"="+te},an.getPublicKeyFromCertHex=function(P){var N=new an;return N.readCertHex(P),N.getPublicKey()},an.getPublicKeyFromCertPEM=function(P){var N=new an;return N.readCertPEM(P),N.getPublicKey()},an.getPublicKeyInfoPropOfCertPEM=function(P){var N=dt,A=N.getVbyList,q={},H,U;return q.algparam=null,H=new an,H.readCertPEM(P),U=H.getPublicKeyHex(),q.keyhex=A(U,0,[1],"03").substr(2),q.algoid=A(U,0,[0,0],"06"),q.algoid==="2a8648ce3d0201"&&(q.algparam=A(U,0,[0,1],"06")),q},an.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];var MI=function(P){var N=B,A=N.lang.String.isHex,q=dt,H=q.getV,U=q.getTLV,Q=q.getVbyList,J=q.getTLVbyList,ae=q.getTLVbyListEx,te=q.getIdxbyList,le=q.getIdxbyListEx,ce=q.getChildIdx,W=new an;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var ne=te(this.hex,0,[0,0]),X=this.hex.substr(ne,2);if(X=="02")this.posSigAlg=1;else if(X=="30")this.posSigAlg=0;else throw new Error("malformed 1st item of TBSCertList: "+X);var ie=te(this.hex,0,[0,this.posSigAlg+3]),ue=this.hex.substr(ie,2);if(ue=="17"||ue=="18"){var ve,ze;ve=te(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,ve!=-1&&(ze=this.hex.substr(ve,2),ze=="30"&&(this.posRevCert=this.posSigAlg+4))}else if(ue=="30")this.posRevCert=this.posSigAlg+3;else if(ue=="a0")this.posRevCert=null;else throw new Error("malformed nextUpdate or revCert tag: "+ue)},this.getVersion=function(){return this.posSigAlg==0?null:parseInt(Q(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var ne=J(this.hex,0,[0,this.posSigAlg],"30");return W.getAlgorithmIdentifierName(ne)},this.getIssuer=function(){return W.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return J(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var ne=Q(this.hex,0,[0,this.posSigAlg+2]);return result=lr(ne)},this.getNextUpdate=function(){var ne=te(this.hex,0,[0,this.posSigAlg+3]),X=this.hex.substr(ne,2);return X!="17"&&X!="18"?null:lr(H(this.hex,ne))},this.getRevCertArray=function(){if(this.posRevCert==null)return null;for(var ne=[],X=te(this.hex,0,[0,this.posRevCert]),ie=ce(this.hex,X),ue=0;ue<ie.length;ue++){var ve=U(this.hex,ie[ue]);ne.push(this.getRevCert(ve))}return ne},this.getRevCert=function(ne){var X={},ie=ce(ne,0);return X.sn={hex:Q(ne,0,[0],"02")},X.date=lr(Q(ne,0,[1])),ie.length==3&&(X.ext=W.getExtParamArray(J(ne,0,[2]))),X},this.findRevCert=function(ne){var X=new an(ne),ie=X.getSerialNumberHex();return this.findRevCertBySN(ie)},this.findRevCertBySN=function(ne){if(this.parsed==null&&this.getParam(),this.parsed.revcert==null)return null;for(var X=this.parsed.revcert,ie=0;ie<X.length;ie++)if(ne==X[ie].sn.hex)return X[ie];return null},this.getSignatureValueHex=function(){return Q(this.hex,0,[2],"03",!0)},this.verifySignature=function(ne){var X=this.getSignatureAlgorithmField(),ie=this.getSignatureValueHex(),ue=J(this.hex,0,[0],"30"),ve=new B.crypto.Signature({alg:X});return ve.init(ne),ve.updateHex(ue),ve.verify(ie)},this.getParam=function(ne){var X={},ie=this.getVersion();ie!=null&&(X.version=ie),X.sigalg=this.getSignatureAlgorithmField(),X.issuer=this.getIssuer(),X.thisupdate=this.getThisUpdate();var ue=this.getNextUpdate();ue!=null&&(X.nextupdate=ue);var ve=this.getRevCertArray();ve!=null&&(X.revcert=ve);var ze=le(this.hex,0,[0,"[0]"]);if(ze!=-1){var tt=ae(this.hex,0,[0,"[0]",0]);X.ext=W.getExtParamArray(tt)}return X.sighex=this.getSignatureValueHex(),this.parsed=X,typeof ne=="object"&&(ne.tbshex==!0&&(X.tbshex=J(this.hex,0,[0])),ne.nodnarray==!0&&delete X.issuer.array),X},typeof P=="string"&&(A(P)?this.hex=P:P.match(/-----BEGIN X509 CRL/)&&(this.hex=nr(P)),this._setPos())};return(typeof B>"u"||!B)&&(B={}),(typeof B.jws>"u"||!B.jws)&&(B.jws={}),B.jws.JWS=function(){var P=B,N=P.jws.JWS,A=N.isSafeJSONString;this.parseJWS=function(q,H){if(!(this.parsedJWS!==void 0&&(H||this.parsedJWS.sigvalH!==void 0))){var U=q.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(U==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var Q=U[1],J=U[2],ae=U[3],te=Q+"."+J;if(this.parsedJWS={},this.parsedJWS.headB64U=Q,this.parsedJWS.payloadB64U=J,this.parsedJWS.sigvalB64U=ae,this.parsedJWS.si=te,!H){var le=On(ae),ce=ii(le,16);this.parsedJWS.sigvalH=le,this.parsedJWS.sigvalBI=ce}var W=Pr(Q),ne=Pr(J);if(this.parsedJWS.headS=W,this.parsedJWS.payloadS=ne,!A(W,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+W}}},B.jws.JWS.sign=function(P,N,A,q,H){var U=B,Q=U.jws,J=Q.JWS,ae=J.readSafeJSONString,te=J.isSafeJSONString,le=U.crypto;le.ECDSA;var ce=le.Mac,W=le.Signature,ne=JSON,X,ie,ue;if(typeof N!="string"&&typeof N!="object")throw"spHeader must be JSON string or object: "+N;if(typeof N=="object"&&(ie=N,X=ne.stringify(ie)),typeof N=="string"){if(X=N,!te(X))throw"JWS Head is not safe JSON string: "+X;ie=ae(X)}if(ue=A,typeof A=="object"&&(ue=ne.stringify(A)),(P==""||P==null)&&ie.alg!==void 0&&(P=ie.alg),P!=""&&P!=null&&ie.alg===void 0&&(ie.alg=P,X=ne.stringify(ie)),P!==ie.alg)throw"alg and sHeader.alg doesn't match: "+P+"!="+ie.alg;var ve=null;if(J.jwsalg2sigalg[P]===void 0)throw"unsupported alg name: "+P;ve=J.jwsalg2sigalg[P];var ze=_s(X),tt=_s(ue),nt=ze+"."+tt,it="";if(ve.substr(0,4)=="Hmac"){if(q===void 0)throw"mac key shall be specified for HS* alg";var _e=new ce({alg:ve,prov:"cryptojs",pass:q});_e.updateString(nt),it=_e.doFinal()}else if(ve.indexOf("withECDSA")!=-1){var Ie=new W({alg:ve});Ie.init(q,H),Ie.updateString(nt);var Ae=Ie.sign();it=B.crypto.ECDSA.asn1SigToConcatSig(Ae)}else if(ve!="none"){var Ie=new W({alg:ve});Ie.init(q,H),Ie.updateString(nt),it=Ie.sign()}var Te=kn(it);return nt+"."+Te},B.jws.JWS.verify=function(P,N,A){var q=B,H=q.jws,U=H.JWS,Q=U.readSafeJSONString,J=q.crypto,ae=J.ECDSA,te=J.Mac,le=J.Signature,ce;if(typeof rn!==void 0&&(ce=rn),!py(P))return!1;var W=P.split(".");if(W.length!==3)return!1;var ne=W[0],X=W[1],ie=ne+"."+X,ue=On(W[2]),ve=Q(Pr(W[0])),ze=null,tt=null;if(ve.alg===void 0)throw"algorithm not specified in header";if(ze=ve.alg,tt=ze.substr(0,2),A!=null&&Object.prototype.toString.call(A)==="[object Array]"&&A.length>0){var nt=":"+A.join(":")+":";if(nt.indexOf(":"+ze+":")==-1)throw"algorithm '"+ze+"' not accepted in the list"}if(ze!="none"&&N===null)throw"key shall be specified to verify.";if(typeof N=="string"&&N.indexOf("-----BEGIN ")!=-1&&(N=Cn.getKey(N)),(tt=="RS"||tt=="PS")&&!(N instanceof ce))throw"key shall be a RSAKey obj for RS* and PS* algs";if(tt=="ES"&&!(N instanceof ae))throw"key shall be a ECDSA obj for ES* algs";var it=null;if(U.jwsalg2sigalg[ve.alg]===void 0)throw"unsupported alg name: "+ze;if(it=U.jwsalg2sigalg[ze],it=="none")throw"not supported";if(it.substr(0,4)=="Hmac"){var _e=null;if(N===void 0)throw"hexadecimal key shall be specified for HMAC";var Ie=new te({alg:it,pass:N});return Ie.updateString(ie),_e=Ie.doFinal(),ue==_e}else if(it.indexOf("withECDSA")!=-1){var Ae=null;try{Ae=ae.concatSigToASN1Sig(ue)}catch{return!1}var Te=new le({alg:it});return Te.init(N),Te.updateString(ie),Te.verify(Ae)}else{var Te=new le({alg:it});return Te.init(N),Te.updateString(ie),Te.verify(ue)}},B.jws.JWS.parse=function(P){var N=P.split("."),A={},q,H,U;if(N.length!=2&&N.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return q=N[0],H=N[1],N.length==3&&(U=N[2]),A.headerObj=B.jws.JWS.readSafeJSONString(Pr(q)),A.payloadObj=B.jws.JWS.readSafeJSONString(Pr(H)),A.headerPP=JSON.stringify(A.headerObj,null,"  "),A.payloadObj==null?A.payloadPP=Pr(H):A.payloadPP=JSON.stringify(A.payloadObj,null,"  "),U!==void 0&&(A.sigHex=On(U)),A},B.jws.JWS.verifyJWT=function(P,N,A){var q=B,H=q.jws,U=H.JWS,Q=U.readSafeJSONString,J=U.inArray,ae=U.includedArray;if(!py(P))return!1;var te=P.split(".");if(te.length!=3)return!1;var le=te[0],ce=te[1];On(te[2]);var W=Q(Pr(le)),ne=Q(Pr(ce));if(W.alg===void 0)return!1;if(A.alg===void 0)throw"acceptField.alg shall be specified";if(!J(W.alg,A.alg)||ne.iss!==void 0&&typeof A.iss=="object"&&!J(ne.iss,A.iss)||ne.sub!==void 0&&typeof A.sub=="object"&&!J(ne.sub,A.sub))return!1;if(ne.aud!==void 0&&typeof A.aud=="object"){if(typeof ne.aud=="string"){if(!J(ne.aud,A.aud))return!1}else if(typeof ne.aud=="object"&&!ae(ne.aud,A.aud))return!1}var X=H.IntDate.getNow();return A.verifyAt!==void 0&&typeof A.verifyAt=="number"&&(X=A.verifyAt),(A.gracePeriod===void 0||typeof A.gracePeriod!="number")&&(A.gracePeriod=0),!(ne.exp!==void 0&&typeof ne.exp=="number"&&ne.exp+A.gracePeriod<X||ne.nbf!==void 0&&typeof ne.nbf=="number"&&X<ne.nbf-A.gracePeriod||ne.iat!==void 0&&typeof ne.iat=="number"&&X<ne.iat-A.gracePeriod||ne.jti!==void 0&&A.jti!==void 0&&ne.jti!==A.jti||!U.verify(P,N,A.alg))},B.jws.JWS.includedArray=function(P,N){var A=B.jws.JWS.inArray;if(P===null||typeof P!="object"||typeof P.length!="number")return!1;for(var q=0;q<P.length;q++)if(!A(P[q],N))return!1;return!0},B.jws.JWS.inArray=function(P,N){if(N===null||typeof N!="object"||typeof N.length!="number")return!1;for(var A=0;A<N.length;A++)if(N[A]==P)return!0;return!1},B.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},B.jws.JWS.isSafeJSONString=function(P,N,A){var q=null;try{return q=Wt(P),typeof q!="object"||q.constructor===Array?0:(N&&(N[A]=q),1)}catch{return 0}},B.jws.JWS.readSafeJSONString=function(P){var N=null;try{return N=Wt(P),typeof N!="object"||N.constructor===Array?null:N}catch{return null}},B.jws.JWS.getEncodedSignatureValueFromJWS=function(P){var N=P.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(N==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return N[1]},B.jws.JWS.getJWKthumbprint=function(P){if(P.kty!=="RSA"&&P.kty!=="EC"&&P.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var N="{";if(P.kty==="RSA"){if(typeof P.n!="string"||typeof P.e!="string")throw"wrong n and e value for RSA key";N+='"e":"'+P.e+'",',N+='"kty":"'+P.kty+'",',N+='"n":"'+P.n+'"}'}else if(P.kty==="EC"){if(typeof P.crv!="string"||typeof P.x!="string"||typeof P.y!="string")throw"wrong crv, x and y value for EC key";N+='"crv":"'+P.crv+'",',N+='"kty":"'+P.kty+'",',N+='"x":"'+P.x+'",',N+='"y":"'+P.y+'"}'}else if(P.kty==="oct"){if(typeof P.k!="string")throw"wrong k value for oct(symmetric) key";N+='"kty":"'+P.kty+'",',N+='"k":"'+P.k+'"}'}var A=Ts(N),q=B.crypto.Util.hashHex(A,"sha256"),H=kn(q);return H},B.jws.IntDate={},B.jws.IntDate.get=function(P){var N=B.jws.IntDate,A=N.getNow,q=N.getZulu;if(P=="now")return A();if(P=="now + 1hour")return A()+3600;if(P=="now + 1day")return A()+3600*24;if(P=="now + 1month")return A()+3600*24*30;if(P=="now + 1year")return A()+3600*24*365;if(P.match(/Z$/))return q(P);if(P.match(/^[0-9]+$/))return parseInt(P);throw"unsupported format: "+P},B.jws.IntDate.getZulu=function(P){return Pd(P)},B.jws.IntDate.getNow=function(){var P=~~(new Date/1e3);return P},B.jws.IntDate.intDate2UTCString=function(P){var N=new Date(P*1e3);return N.toUTCString()},B.jws.IntDate.intDate2Zulu=function(P){var N=new Date(P*1e3),A=("0000"+N.getUTCFullYear()).slice(-4),q=("00"+(N.getUTCMonth()+1)).slice(-2),H=("00"+N.getUTCDate()).slice(-2),U=("00"+N.getUTCHours()).slice(-2),Q=("00"+N.getUTCMinutes()).slice(-2),J=("00"+N.getUTCSeconds()).slice(-2);return A+q+H+U+Q+J+"Z"},(typeof B>"u"||!B)&&(B={}),(typeof B.jws>"u"||!B.jws)&&(B.jws={}),B.jws.JWSJS=function(){var P=B,N=P.jws,A=N.JWS,q=A.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(H){this.init();var U=H.split(".");if(U.length!=3)throw"malformed input JWS";this.aHeader.push(U[0]),this.sPayload=U[1],this.aSignature.push(U[2])},this.addSignature=function(H,U,Q,J){if(this.sPayload===void 0||this.sPayload===null)throw"there's no JSON-JS signature to add.";var ae=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var te=B.jws.JWS.sign(H,U,this.sPayload,Q,J),le=te.split("."),ce=le[0],W=le[2];this.aHeader.push(le[0]),this.aSignature.push(le[2])}catch(ne){throw this.aHeader.length>ae&&this.aHeader.pop(),this.aSignature.length>ae&&this.aSignature.pop(),"addSignature failed: "+ne}},this.verifyAll=function(H){if(this.aHeader.length!==H.length||this.aSignature.length!==H.length)return!1;for(var U=0;U<H.length;U++){var Q=H[U];if(Q.length!==2)return!1;var J=this.verifyNth(U,Q[0],Q[1]);if(J===!1)return!1}return!0},this.verifyNth=function(H,U,Q){if(this.aHeader.length<=H||this.aSignature.length<=H)return!1;var J=this.aHeader[H],ae=this.aSignature[H],te=J+"."+this.sPayload+"."+ae,le=!1;try{le=A.verify(te,U,Q)}catch{return!1}return le},this.readJWSJS=function(H){if(typeof H=="string"){var U=q(H);if(U==null)throw"argument is not safe JSON object string";this.aHeader=U.headers,this.sPayload=U.payload,this.aSignature=U.signatures}else try{if(H.headers.length>0)this.aHeader=H.headers;else throw"malformed header";if(typeof H.payload=="string")this.sPayload=H.payload;else throw"malformed signatures";if(H.signatures.length>0)this.aSignature=H.signatures;else throw"malformed signatures"}catch(Q){throw"malformed JWS-JS JSON object: "+Q}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return this.aHeader.length==0?1:0}},Ut.SecureRandom=Us,Ut.rng_seed_time=qa,Ut.BigInteger=l,Ut.RSAKey=rn,Ut.ECDSA=B.crypto.ECDSA,Ut.DSA=B.crypto.DSA,Ut.Signature=B.crypto.Signature,Ut.MessageDigest=B.crypto.MessageDigest,Ut.Mac=B.crypto.Mac,Ut.KEYUTIL=Cn,Ut.ASN1HEX=dt,Ut.X509=an,Ut.X509CRL=MI,Ut.CryptoJS=i,Ut.b64tohex=u,Ut.b64toBA=c,Ut.ECFieldElementFp=Qn,Ut.ECPointFp=Sn,Ut.ECCurveFp=be,Ut.stoBA=en,Ut.BAtos=tr,Ut.BAtohex=Ur,Ut.stohex=Lt,Ut.stob64=sn,Ut.stob64u=Qt,Ut.b64utos=zr,Ut.b64tob64u=ai,Ut.b64utob64=br,Ut.hex2b64=o,Ut.hextob64u=kn,Ut.b64utohex=On,Ut.utf8tob64u=_s,Ut.b64utoutf8=Pr,Ut.utf8tob64=Rl,Ut.b64toutf8=_d,Ut.utf8tohex=zc,Ut.hextoutf8=Ln,Ut.hextorstr=lr,Ut.rstrtohex=Ts,Ut.hextob64=zi,Ut.hextob64nl=Fl,Ut.b64nltohex=wd,Ut.hextopem=Yn,Ut.pemtohex=nr,Ut.hextoArrayBuffer=Od,Ut.ArrayBuffertohex=Ml,Ut.zulutomsec=ly,Ut.msectozulu=Nl,Ut.zulutosec=Pd,Ut.zulutodate=FI,Ut.datetozulu=fy,Ut.uricmptohex=Al,Ut.hextouricmp=Ed,Ut.ipv6tohex=Dl,Ut.hextoipv6=hy,Ut.hextoip=kl,Ut.iptohex=Ib,Ut.ucs2hextoutf8=Rb,Ut.encodeURIComponentAll=my,Ut.newline_toUnix=jI,Ut.newline_toDos=ws,Ut.hextoposhex=gy,Ut.intarystrtohex=zT,Ut.strdiffidx=VT,Ut.oidtohex=yy,Ut.hextooid=by,Ut.strpad=tc,Ut.bitstrtoint=vy,Ut.inttobitstr=Fb,Ut.bitstrtobinstr=nc,Ut.binstrtobitstr=Rd,Ut.isBase64URLDot=py,Ut.namearraytobinstr=Fd,Ut.extendClass=wt,Ut.foldnl=ls,Ut.b64topem=dy,Ut.pemtob64=jl,Ut.timeogen=Pb,Ut.aryval=rr,Ut.inttohex=Vc,Ut.twoscompl=Hc,Ut.KJUR=B,Ut.crypto=B.crypto,Ut.asn1=B.asn1,Ut.jws=B.jws,Ut.lang=B.lang,Ut.VERSION=a,Ut.VERSION_FULL=t,Ut}var iCe=rCe();class B1 extends Error{}B1.prototype.name="InvalidTokenError";function sCe(e){return decodeURIComponent(atob(e).replace(/(.)/g,(n,a)=>{let t=a.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function aCe(e){let n=e.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return sCe(n)}catch{return atob(n)}}function oCe(e,n){if(typeof e!="string")throw new B1("Invalid token specified: must be a string");n||(n={});const a=n.header===!0?0:1,t=e.split(".")[a];if(typeof t!="string")throw new B1(`Invalid token specified: missing part #${a+1}`);let i;try{i=aCe(t)}catch(r){throw new B1(`Invalid token specified: invalid base64 for part #${a+1} (${r.message})`)}try{return JSON.parse(i)}catch(r){throw new B1(`Invalid token specified: invalid json for part #${a+1} (${r.message})`)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function boe(e){return e.name==="CanceledError"&&e.code===Dr.AxiosError.ERR_CANCELED}async function cCe(e,n,a,t){console.log(`Get Repo: ${e}/${n}/${a}`);const i=await Dr.get(`${e}/repos/${n}/${a}`,{headers:t}).catch(r=>{if(r.response&&r.response.status===400)return null;throw r});if(!i||i.status===400){console.log(`Create Repo: ${e}/${n}/${a}`);const r={name:a};await Dr.post(`${e}/${n}/repos`,r,{headers:t})}}const uCe=e=>Math.floor(Math.random()*e);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Tk;(function(e){e.ClusterDraining="ClusterDraining",e.TokenRevoked="TokenRevoked"})(Tk||(Tk={}));class gi extends Error{constructor(n,a,t,i,r,s,o){super(a),this.code=n,this.canRetry=t,this.isFatal=i,this.retryAfterMs=r,this.source=s,this.internalErrorCode=o,this.name="NetworkError",this.retryAfter=r!==void 0?r/1e3:void 0}get details(){return this.canRetry===void 0&&this.isFatal===void 0&&this.retryAfterMs===void 0&&this.source===void 0&&this.internalErrorCode===void 0?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs,source:this.source,internalErrorCode:this.internalErrorCode}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter,source:this.source,internalErrorCode:this.internalErrorCode}}}function dCe(e){return e.name==="NetworkError"&&typeof e.code=="number"&&typeof e.message=="string"}function kg(e,n){let a,t,i,r,s,o;switch(n&&typeof n=="object"?(a=n.message??"Unknown Error",t=n.canRetry,i=n.isFatal,r=n.retryAfterMs??n.retryAfter,s=n.source,o=n.internalErrorCode):n&&typeof n=="string"?a=n:a="Unknown Error",e){case 401:case 403:case 404:return new gi(e,a,!1,!1,void 0,s,o);case 413:case 422:return new gi(e,a,t??!1,i??!1,t?r:void 0,s,o);case 429:return new gi(e,a,!0,!1,r,s,o);case 499:return new gi(e,a,!0,!1,void 0,s,o);case 500:return new gi(e,a,t??!0,i??!1,t?r:void 0,s,o);case 502:case 503:case 504:return new gi(e,a,!0,!1,r,s,o);default:return new gi(e,a,!1,!0,void 0,s,o)}}function lCe(e,n){throw kg(e,n)}function fCe(e){const{response:n,request:a}=e??{};return n===void 0&&a!==void 0?boe(e)?new gi(499,"Client aborted the request."):new gi(502,`Network Error: ${e?.message??"No response received."}`):n!==void 0?new gi(n.status,n.statusText):new gi(500,"Unknown error.")}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function hCe(e,n,a){if(typeof e!="string")throw new gi(403,`Token must be a string. Received: ${typeof e}`);let t;try{t=oCe(e)}catch{throw new gi(401,"Invalid token")}if(!t||t.documentId!==n||t.tenantId!==a)throw new gi(403,"DocumentId and/or TenantId in token claims do not match requested resource");if(t.scopes===void 0||t.scopes===null||t.scopes.length===0)throw new gi(403,"Missing scopes in token claims");return t}function mCe(e,n){if(!e.exp||!e.iat||e.exp-e.iat>n)throw new gi(403,"Invalid token expiry");const a=e.exp*1e3-new Date().getTime();if(a<0)throw new gi(401,"Expired token");return a}function pCe(e,n,a,t,i,r=3600,s="1.0"){let o=i||wk();(o.id===""||o.id===void 0)&&(o=wk());const u=Math.round(new Date().getTime()/1e3),c={documentId:n,scopes:t,tenantId:e,user:o,iat:u,exp:u+r,ver:s,jti:QP()},d={utf8:a};return iCe.KJUR.jws.JWS.sign(null,JSON.stringify({alg:"HS256",typ:"JWT"}),c,d)}function wk(){return{id:QP(),name:QP()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let voe=class{constructor(n){this.comparator=n,this.heap=[]}get size(){return this.heap.length}peek(){return this.heap[0]}push(n){this.heap.push(n),this.bubbleUp(this.size-1)}pop(){if(this.size===0)return;const n=this.heap[0],a=this.heap.pop();return this.size>0&&a!==void 0&&(this.heap[0]=a,this.bubbleDown(0)),n}bubbleUp(n){let a=n;for(;a>0;){const t=Math.floor((a-1)/2);if(this.comparator.compareFn(this.heap[a],this.heap[t])>=0)break;this.swap(a,t),a=t}}bubbleDown(n){let a=n;for(;;){const t=a*2+1,i=a*2+2;let r=a;if(t<this.size&&this.comparator.compareFn(this.heap[t],this.heap[r])<0&&(r=t),i<this.size&&this.comparator.compareFn(this.heap[i],this.heap[r])<0&&(r=i),r===a)break;this.swap(a,r),a=r}}swap(n,a){const t=this.heap[n];this.heap[n]=this.heap[a],this.heap[a]=t}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function gCe(e){const n=[];if(!e?.length)return n;let a=e[0],t=e[0];for(let i=1;i<e.length;i++){const r=e[i];r-t!==1&&(n.push([a,t]),a=r),t=r}return n.push([a,t]),n}function yCe(e,n,a){const t=[];let i=0,r=0;for(;i<e.length&&r<n.length;)a(e[i],n[r])<=0?(t.push(e[i]),i++):(t.push(n[r]),r++);for(;i<e.length;)t.push(e[i]),i++;for(;r<n.length;)t.push(n[r]),r++;return t}class $J{constructor(n,a,t){this.index=n,this.row=a,this.value=t}}function bCe(e,n){const a={compareFn:(r,s)=>n(r.value,s.value)},t=new voe(a);for(let r=0;r<e.length;r++)e[r].length>0&&t.push(new $J(0,r,e[r][0]));const i=[];for(;t.size>0;){const r=t.pop();if(r===void 0)continue;i.push(r.value);const s=r.index+1;s<e[r.row].length&&t.push(new $J(s,r.row,e[r.row][s]))}return i}function vCe(e,n){const a=[];let t;for(const i of e){const r=n(i);t!==r&&(a.push(i),t=r)}return a}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const HP="x-correlation-id",SCe="x-driver-version",Ok="x-telemetry-context",CCe="latest",Pk="x-calling-service";var o_={exports:{}},GJ;function _Ce(){if(GJ)return o_.exports;GJ=1;var e=["Black","White","Gray","Brown","Red","Pink","Crimson","Carnelian","Orange","Yellow","Ivory","Cream","Green","Viridian","Aquamarine","Cyan","Blue","Cerulean","Azure","Indigo","Navy","Violet","Purple","Lavender","Magenta","Rainbow","Iridescent","Spectrum","Prism","Bold","Vivid","Pale","Clear","Glass","Translucent","Misty","Dark","Light","Gold","Silver","Copper","Bronze","Steel","Iron","Brass","Mercury","Zinc","Chrome","Platinum","Titanium","Nickel","Lead","Pewter","Rust","Metal","Stone","Quartz","Granite","Marble","Alabaster","Agate","Jasper","Pebble","Pyrite","Crystal","Geode","Obsidian","Mica","Flint","Sand","Gravel","Boulder","Basalt","Ruby","Beryl","Scarlet","Citrine","Sulpher","Topaz","Amber","Emerald","Malachite","Jade","Abalone","Lapis","Sapphire","Diamond","Peridot","Gem","Jewel","Bevel","Coral","Jet","Ebony","Wood","Tree","Cherry","Maple","Cedar","Branch","Bramble","Rowan","Ash","Fir","Pine","Cactus","Alder","Grove","Forest","Jungle","Palm","Bush","Mulberry","Juniper","Vine","Ivy","Rose","Lily","Tulip","Daffodil","Honeysuckle","Fuschia","Hazel","Walnut","Almond","Lime","Lemon","Apple","Blossom","Bloom","Crocus","Rose","Buttercup","Dandelion","Iris","Carnation","Fern","Root","Branch","Leaf","Seed","Flower","Petal","Pollen","Orchid","Mangrove","Cypress","Sequoia","Sage","Heather","Snapdragon","Daisy","Mountain","Hill","Alpine","Chestnut","Valley","Glacier","Forest","Grove","Glen","Tree","Thorn","Stump","Desert","Canyon","Dune","Oasis","Mirage","Well","Spring","Meadow","Field","Prairie","Grass","Tundra","Island","Shore","Sand","Shell","Surf","Wave","Foam","Tide","Lake","River","Brook","Stream","Pool","Pond","Sun","Sprinkle","Shade","Shadow","Rain","Cloud","Storm","Hail","Snow","Sleet","Thunder","Lightning","Wind","Hurricane","Typhoon","Dawn","Sunrise","Morning","Noon","Twilight","Evening","Sunset","Midnight","Night","Sky","Star","Stellar","Comet","Nebula","Quasar","Solar","Lunar","Planet","Meteor","Sprout","Pear","Plum","Kiwi","Berry","Apricot","Peach","Mango","Pineapple","Coconut","Olive","Ginger","Root","Plain","Fancy","Stripe","Spot","Speckle","Spangle","Ring","Band","Blaze","Paint","Pinto","Shade","Tabby","Brindle","Patch","Calico","Checker","Dot","Pattern","Glitter","Glimmer","Shimmer","Dull","Dust","Dirt","Glaze","Scratch","Quick","Swift","Fast","Slow","Clever","Fire","Flicker","Flash","Spark","Ember","Coal","Flame","Chocolate","Vanilla","Sugar","Spice","Cake","Pie","Cookie","Candy","Caramel","Spiral","Round","Jelly","Square","Narrow","Long","Short","Small","Tiny","Big","Giant","Great","Atom","Peppermint","Mint","Butter","Fringe","Rag","Quilt","Truth","Lie","Holy","Curse","Noble","Sly","Brave","Shy","Lava","Foul","Leather","Fantasy","Keen","Luminous","Feather","Sticky","Gossamer","Cotton","Rattle","Silk","Satin","Cord","Denim","Flannel","Plaid","Wool","Linen","Silent","Flax","Weak","Valiant","Fierce","Gentle","Rhinestone","Splash","North","South","East","West","Summer","Winter","Autumn","Spring","Season","Equinox","Solstice","Paper","Motley","Torch","Ballistic","Rampant","Shag","Freckle","Wild","Free","Chain","Sheer","Crazy","Mad","Candle","Ribbon","Lace","Notch","Wax","Shine","Shallow","Deep","Bubble","Harvest","Fluff","Venom","Boom","Slash","Rune","Cold","Quill","Love","Hate","Garnet","Zircon","Power","Bone","Void","Horn","Glory","Cyber","Nova","Hot","Helix","Cosmic","Quark","Quiver","Holly","Clover","Polar","Regal","Ripple","Ebony","Wheat","Phantom","Dew","Chisel","Crack","Chatter","Laser","Foil","Tin","Clever","Treasure","Maze","Twisty","Curly","Fortune","Fate","Destiny","Cute","Slime","Ink","Disco","Plume","Time","Psychadelic","Relic","Fossil","Water","Savage","Ancient","Rapid","Road","Trail","Stitch","Button","Bow","Nimble","Zest","Sour","Bitter","Phase","Fan","Frill","Plump","Pickle","Mud","Puddle","Pond","River","Spring","Stream","Battle","Arrow","Plume","Roan","Pitch","Tar","Cat","Dog","Horse","Lizard","Bird","Fish","Saber","Scythe","Sharp","Soft","Razor","Neon","Dandy","Weed","Swamp","Marsh","Bog","Peat","Moor","Muck","Mire","Grave","Fair","Just","Brick","Puzzle","Skitter","Prong","Fork","Dent","Dour","Warp","Luck","Coffee","Split","Chip","Hollow","Heavy","Legend","Hickory","Mesquite","Nettle","Rogue","Charm","Prickle","Bead","Sponge","Whip","Bald","Frost","Fog","Oil","Veil","Cliff","Volcano","Rift","Maze","Proud","Dew","Mirror","Shard","Salt","Pepper","Honey","Thread","Bristle","Ripple","Glow","Zenith"],n=["head","crest","crown","tooth","fang","horn","frill","skull","bone","tongue","throat","voice","nose","snout","chin","eye","sight","seer","speaker","singer","song","chanter","howler","chatter","shrieker","shriek","jaw","bite","biter","neck","shoulder","fin","wing","arm","lifter","grasp","grabber","hand","paw","foot","finger","toe","thumb","talon","palm","touch","racer","runner","hoof","fly","flier","swoop","roar","hiss","hisser","snarl","dive","diver","rib","chest","back","ridge","leg","legs","tail","beak","walker","lasher","swisher","carver","kicker","roarer","crusher","spike","shaker","charger","hunter","weaver","crafter","binder","scribe","muse","snap","snapper","slayer","stalker","track","tracker","scar","scarer","fright","killer","death","doom","healer","saver","friend","foe","guardian","thunder","lightning","cloud","storm","forger","scale","hair","braid","nape","belly","thief","stealer","reaper","giver","taker","dancer","player","gambler","twister","turner","painter","dart","drifter","sting","stinger","venom","spur","ripper","swallow","devourer","knight","lady","lord","queen","king","master","mistress","prince","princess","duke","dutchess","samurai","ninja","knave","slave","servant","sage","wizard","witch","warlock","warrior","jester","paladin","bard","trader","sword","shield","knife","dagger","arrow","bow","fighter","bane","follower","leader","scourge","watcher","cat","panther","tiger","cougar","puma","jaguar","ocelot","lynx","lion","leopard","ferret","weasel","wolverine","bear","raccoon","dog","wolf","kitten","puppy","cub","fox","hound","terrier","coyote","hyena","jackal","pig","horse","donkey","stallion","mare","zebra","antelope","gazelle","deer","buffalo","bison","boar","elk","whale","dolphin","shark","fish","minnow","salmon","ray","fisher","otter","gull","duck","goose","crow","raven","bird","eagle","raptor","hawk","falcon","moose","heron","owl","stork","crane","sparrow","robin","parrot","cockatoo","carp","lizard","gecko","iguana","snake","python","viper","boa","condor","vulture","spider","fly","scorpion","heron","oriole","toucan","bee","wasp","hornet","rabbit","bunny","hare","brow","mustang","ox","piper","soarer","flasher","moth","mask","hide","hero","antler","chill","chiller","gem","ogre","myth","elf","fairy","pixie","dragon","griffin","unicorn","pegasus","sprite","fancier","chopper","slicer","skinner","butterfly","legend","wanderer","rover","raver","loon","lancer","glass","glazer","flame","crystal","lantern","lighter","cloak","bell","ringer","keeper","centaur","bolt","catcher","whimsey","quester","rat","mouse","serpent","wyrm","gargoyle","thorn","whip","rider","spirit","sentry","bat","beetle","burn","cowl","stone","gem","collar","mark","grin","scowl","spear","razor","edge","seeker","jay","ape","monkey","gorilla","koala","kangaroo","yak","sloth","ant","roach","weed","seed","eater","razor","shirt","face","goat","mind","shift","rider","face","mole","vole","pirate","llama","stag","bug","cap","boot","drop","hugger","sargent","snagglefoot","carpet","curtain"];function a(r){return r=r||Math.random,n[Math.floor(r()*n.length)]}function t(r){return r=r||Math.random,e[Math.floor(r()*e.length)]}function i(r){var s=a(r),o=a(r);o=o.substr(0,1).toUpperCase()+o.substr(1);var u=t(r);return u+s+" "+o}return o_.exports=i,o_.exports.randomNoun=a,o_.exports.randomAdjective=t,o_.exports}var TCe=_Ce();const wCe=iE(TCe);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Soe(e="_",n=!1){let[a,t]=wCe().split(" ");return n||(a=a.toLowerCase(),t=t.toLowerCase()),`${a}${e}${t}`}const OCe=()=>Soe();/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function yi(e,n){if(!e)throw new Error(typeof n=="number"?`0x${n.toString(16).padStart(3,"0")}`:n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function nI(e,n){switch(n){case"base64":return rT.fromByteArray(e);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(e);default:throw new Error("invalid/unsupported encoding")}}const Dq=(e,n)=>Cl.from(e,n).buffer,PCe=(e,n)=>Cl.from(e).toString(n);function Ek(e){const n=e;return e instanceof ArrayBuffer||typeof n=="object"&&n!==null&&typeof n.byteLength=="number"&&typeof n.slice=="function"&&n.byteOffset===void 0&&n.buffer===void 0}let Cl=class Dg extends Uint8Array{toString(n){return nI(this,n)}static from(n,a,t){if(typeof n=="string")return Dg.fromString(n,a);if(n!==null&&typeof n=="object"&&Ek(n.buffer))return Dg.fromArrayBuffer(n.buffer,n.byteOffset,n.byteLength);if(Ek(n))return Dg.fromArrayBuffer(n,a,t);throw new TypeError}static fromArrayBuffer(n,a,t){const i=a??0,r=t??n.byteLength-i;if(i<0||i>n.byteLength||r<0||r+i>n.byteLength)throw new RangeError;return new Dg(n,i,r)}static fromString(n,a){switch(a){case"base64":{const t=this.sanitizeBase64(n),i=rT.toByteArray(t);return new Dg(i.buffer)}case"utf8":case"utf-8":case void 0:{const t=new TextEncoder().encode(n);return new Dg(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(n){throw new Error("unimplemented")}static sanitizeBase64(n){let a=n;return a=a.split("=")[0],a=a.replace(/[^\w+-/]/g,""),a.length%4!==0&&(a+=["","===","==","="][a.length%4]),a}};async function ECe(e,n){const a=await crypto.subtle.digest(n,e);return new Uint8Array(a)}function ICe(e,n){switch(n){case"hex":return Array.prototype.map.call(e,t=>t.toString(16).padStart(2,"0")).join("");case"base64":return rT.fromByteArray(e)}}async function Coe(e,n="SHA-1",a="hex"){if(crypto.subtle===void 0)return Zk(()=>import("./hashFileNode-BxIUnjPt.js"),__vite__mapDeps([2,1])).then(async i=>i.hashFile(e,n,a));const t=await ECe(e,n);return ICe(t,a)}async function _oe(e){const a=`blob ${e.byteLength.toString()}\0`,t=Cl.from(a+e.toString());return Coe(t)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Ik=globalThis.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const RCe=e=>Cl.from(e,"base64").toString("utf-8"),Toe=e=>Cl.from(e,"utf8").toString("base64"),FCe=(e,n)=>{switch(n){case"utf8":case"utf-8":return e;default:return Cl.from(e,n).toString()}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function jCe(e){return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const MCe=async e=>new Promise(n=>setTimeout(()=>n(),e));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function NCe(e,n){return(...a)=>{if(e.disposed)throw new Error("Already disposed");return n(...a)}}var RP={exports:{}},WJ;function Ec(){if(WJ)return RP.exports;WJ=1;var e=typeof Reflect=="object"?Reflect:null,n=e&&typeof e.apply=="function"?e.apply:function(p,w,O){return Function.prototype.apply.call(p,w,O)},a;e&&typeof e.ownKeys=="function"?a=e.ownKeys:Object.getOwnPropertySymbols?a=function(p){return Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p))}:a=function(p){return Object.getOwnPropertyNames(p)};function t(S){console&&console.warn&&console.warn(S)}var i=Number.isNaN||function(p){return p!==p};function r(){r.init.call(this)}RP.exports=r,RP.exports.once=h,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var s=10;function o(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(S){if(typeof S!="number"||S<0||i(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");s=S}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(p){if(typeof p!="number"||p<0||i(p))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+p+".");return this._maxListeners=p,this};function u(S){return S._maxListeners===void 0?r.defaultMaxListeners:S._maxListeners}r.prototype.getMaxListeners=function(){return u(this)},r.prototype.emit=function(p){for(var w=[],O=1;O<arguments.length;O++)w.push(arguments[O]);var E=p==="error",F=this._events;if(F!==void 0)E=E&&F.error===void 0;else if(!E)return!1;if(E){var R;if(w.length>0&&(R=w[0]),R instanceof Error)throw R;var M=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw M.context=R,M}var j=F[p];if(j===void 0)return!1;if(typeof j=="function")n(j,this,w);else for(var k=j.length,x=C(j,k),O=0;O<k;++O)n(x[O],this,w);return!0};function c(S,p,w,O){var E,F,R;if(o(w),F=S._events,F===void 0?(F=S._events=Object.create(null),S._eventsCount=0):(F.newListener!==void 0&&(S.emit("newListener",p,w.listener?w.listener:w),F=S._events),R=F[p]),R===void 0)R=F[p]=w,++S._eventsCount;else if(typeof R=="function"?R=F[p]=O?[w,R]:[R,w]:O?R.unshift(w):R.push(w),E=u(S),E>0&&R.length>E&&!R.warned){R.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(p)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=S,M.type=p,M.count=R.length,t(M)}return S}r.prototype.addListener=function(p,w){return c(this,p,w,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(p,w){return c(this,p,w,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(S,p,w){var O={fired:!1,wrapFn:void 0,target:S,type:p,listener:w},E=d.bind(O);return E.listener=w,O.wrapFn=E,E}r.prototype.once=function(p,w){return o(w),this.on(p,l(this,p,w)),this},r.prototype.prependOnceListener=function(p,w){return o(w),this.prependListener(p,l(this,p,w)),this},r.prototype.removeListener=function(p,w){var O,E,F,R,M;if(o(w),E=this._events,E===void 0)return this;if(O=E[p],O===void 0)return this;if(O===w||O.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete E[p],E.removeListener&&this.emit("removeListener",p,O.listener||w));else if(typeof O!="function"){for(F=-1,R=O.length-1;R>=0;R--)if(O[R]===w||O[R].listener===w){M=O[R].listener,F=R;break}if(F<0)return this;F===0?O.shift():v(O,F),O.length===1&&(E[p]=O[0]),E.removeListener!==void 0&&this.emit("removeListener",p,M||w)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(p){var w,O,E;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[p]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[p]),this;if(arguments.length===0){var F=Object.keys(O),R;for(E=0;E<F.length;++E)R=F[E],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=O[p],typeof w=="function")this.removeListener(p,w);else if(w!==void 0)for(E=w.length-1;E>=0;E--)this.removeListener(p,w[E]);return this};function f(S,p,w){var O=S._events;if(O===void 0)return[];var E=O[p];return E===void 0?[]:typeof E=="function"?w?[E.listener||E]:[E]:w?m(E):C(E,E.length)}r.prototype.listeners=function(p){return f(this,p,!0)},r.prototype.rawListeners=function(p){return f(this,p,!1)},r.listenerCount=function(S,p){return typeof S.listenerCount=="function"?S.listenerCount(p):b.call(S,p)},r.prototype.listenerCount=b;function b(S){var p=this._events;if(p!==void 0){var w=p[S];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]};function C(S,p){for(var w=new Array(p),O=0;O<p;++O)w[O]=S[O];return w}function v(S,p){for(;p+1<S.length;p++)S[p]=S[p+1];S.pop()}function m(S){for(var p=new Array(S.length),w=0;w<p.length;++w)p[w]=S[w].listener||S[w];return p}function h(S,p){return new Promise(function(w,O){function E(R){S.removeListener(p,F),O(R)}function F(){typeof S.removeListener=="function"&&S.removeListener("error",E),w([].slice.call(arguments))}_(S,p,F,{once:!0}),p!=="error"&&g(S,E,{once:!0})})}function g(S,p,w){typeof S.on=="function"&&_(S,"error",p,w)}function _(S,p,w,O){if(typeof S.on=="function")O.once?S.once(p,w):S.on(p,w);else if(typeof S.addEventListener=="function")S.addEventListener(p,function E(F){O.once&&S.removeEventListener(p,E),w(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S)}return RP.exports}var woe=Ec();/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Ooe=class extends woe.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class vc extends Ooe{constructor(n){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,n!==void 0){const a=i=>this.unforwardEvent(n,i),t=i=>this.forwardEvent(n,i);this.on(vc.removeListenerEvent,a),this.on(vc.newListenerEvent,t)}}static isEmitterEvent(n){return n===vc.newListenerEvent||n===vc.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const n of this.forwardingEvents.values())for(const a of n.values())try{a()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(n,...a){for(const t of a)if(n!==void 0&&t!==void 0&&!vc.isEmitterEvent(t)){let i=this.forwardingEvents.get(t);if(i===void 0&&(i=new Map,this.forwardingEvents.set(t,i)),!i.has(n)){const r=(...s)=>this.emit(t,...s);i.set(n,()=>n.off(t,r)),n.on(t,r)}}}unforwardEvent(n,...a){for(const t of a)if(t!==void 0&&!vc.isEmitterEvent(t)){const i=this.forwardingEvents.get(t);if(i?.has(n)===!0&&this.listenerCount(t)===0){const r=i.get(n);r!==void 0&&r(),i.delete(n),i.size===0&&this.forwardingEvents.delete(t)}}}}vc.newListenerEvent="newListener";vc.removeListenerEvent="removeListener";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const ACe={compare:(e,n)=>e-n,min:Number.MIN_VALUE};class DCe{constructor(n){this.comp=n,this.L=[{value:n.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const n=this.L.pop();return this.fixdown(1),n.value}add(n){const a={value:n,position:this.L.length};return this.L.push(a),this.fixup(this.count()),a}update(n){const a=n.position;this.isGreaterThanParent(a)?this.fixup(a):this.fixdown(a)}remove(n){const a=n.position;this.swap(n.position,this.L.length-1),this.L.splice(this.L.length-1),a!==this.L.length&&this.update(this.L[a])}count(){return this.L.length-1}fixup(n){let a=n;for(;this.isGreaterThanParent(a);){const t=a>>1;this.swap(a,t),a=t}}isGreaterThanParent(n){return n>1&&this.comp.compare(this.L[n>>1].value,this.L[n].value)>0}fixdown(n){let a=n;for(;a<<1<=this.count();){let t=a<<1;if(t<this.count()&&this.comp.compare(this.L[t].value,this.L[t+1].value)>0&&t++,this.comp.compare(this.L[a].value,this.L[t].value)<=0)break;this.swap(a,t),a=t}}swap(n,a){const t=this.L[n];this.L[n]=this.L[a],this.L[n].position=n,this.L[a]=t,this.L[a].position=a}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let kCe=class{constructor(n){this.valueGenerator=n,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let xCe=class{send(n){}};class qCe{send(n){}sendTelemetryEvent(n,a){}sendErrorEvent(n,a){}sendPerformanceEvent(n,a){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class LCe{constructor(n,a){this.expiry=n,this.cleanup=a,this.gcTimeouts=new Map}schedule(n){this.expiry.policy!=="indefinite"&&this.gcTimeouts.set(n,setTimeout(()=>{this.cleanup(n),this.cancel(n)},this.expiry.durationMs))}cancel(n){const a=this.gcTimeouts.get(n);a!==void 0&&(clearTimeout(a),this.gcTimeouts.delete(n))}update(n){this.expiry.policy==="sliding"&&(this.cancel(n),this.schedule(n))}}class BCe{constructor({expiry:n={policy:"indefinite"},removeOnError:a=()=>!0}={}){this.cache=new Map,this.removeOnError=a,this.gc=new LCe(n,t=>this.remove(t))}has(n){return this.cache.has(n)}get(n){return this.has(n)&&this.gc.update(n),this.cache.get(n)}remove(n){return this.gc.cancel(n),this.cache.delete(n)}async addOrGet(n,a){let t=this.get(n);return t===void 0&&(t=(async()=>a())(),this.cache.set(n,t),t.catch(r=>{this.removeOnError(r)&&this.remove(n)}),this.gc.schedule(n)),t}add(n,a){const t=this.has(n);return this.addOrGet(n,a).catch(()=>{}),!t}async addValueOrGet(n,a){return this.addOrGet(n,async()=>a)}addValue(n,a){return this.add(n,async()=>a)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */let Poe=class{constructor(){this.completed=!1,this.p=new Promise((n,a)=>{this.res=n,this.rej=a})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(n){this.res!==void 0&&(this.completed=!0,this.res(n))}reject(n){this.rej!==void 0&&(this.completed=!0,this.rej(n))}};class UCe{constructor(n){this.execute=n}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(n,a){return this.getPromise().then(...arguments)}async catch(n){return this.getPromise().catch(...arguments)}async finally(n){return this.getPromise().finally(...arguments)}async getPromise(){return this.result===void 0&&(this.result=this.execute()),this.result}}var wN,JJ;function zCe(){if(JJ)return wN;JJ=1;function e(){this.__data__=[],this.size=0}return wN=e,wN}var ON,QJ;function Eoe(){if(QJ)return ON;QJ=1;function e(n,a){return n===a||n!==n&&a!==a}return ON=e,ON}var PN,YJ;function rI(){if(YJ)return PN;YJ=1;var e=Eoe();function n(a,t){for(var i=a.length;i--;)if(e(a[i][0],t))return i;return-1}return PN=n,PN}var EN,XJ;function VCe(){if(XJ)return EN;XJ=1;var e=rI(),n=Array.prototype,a=n.splice;function t(i){var r=this.__data__,s=e(r,i);if(s<0)return!1;var o=r.length-1;return s==o?r.pop():a.call(r,s,1),--this.size,!0}return EN=t,EN}var IN,ZJ;function HCe(){if(ZJ)return IN;ZJ=1;var e=rI();function n(a){var t=this.__data__,i=e(t,a);return i<0?void 0:t[i][1]}return IN=n,IN}var RN,eQ;function KCe(){if(eQ)return RN;eQ=1;var e=rI();function n(a){return e(this.__data__,a)>-1}return RN=n,RN}var FN,tQ;function $Ce(){if(tQ)return FN;tQ=1;var e=rI();function n(a,t){var i=this.__data__,r=e(i,a);return r<0?(++this.size,i.push([a,t])):i[r][1]=t,this}return FN=n,FN}var jN,nQ;function iI(){if(nQ)return jN;nQ=1;var e=zCe(),n=VCe(),a=HCe(),t=KCe(),i=$Ce();function r(s){var o=-1,u=s==null?0:s.length;for(this.clear();++o<u;){var c=s[o];this.set(c[0],c[1])}}return r.prototype.clear=e,r.prototype.delete=n,r.prototype.get=a,r.prototype.has=t,r.prototype.set=i,jN=r,jN}var MN,rQ;function GCe(){if(rQ)return MN;rQ=1;var e=iI();function n(){this.__data__=new e,this.size=0}return MN=n,MN}var NN,iQ;function WCe(){if(iQ)return NN;iQ=1;function e(n){var a=this.__data__,t=a.delete(n);return this.size=a.size,t}return NN=e,NN}var AN,sQ;function JCe(){if(sQ)return AN;sQ=1;function e(n){return this.__data__.get(n)}return AN=e,AN}var DN,aQ;function QCe(){if(aQ)return DN;aQ=1;function e(n){return this.__data__.has(n)}return DN=e,DN}var kN,oQ;function Ioe(){if(oQ)return kN;oQ=1;var e=typeof ud=="object"&&ud&&ud.Object===Object&&ud;return kN=e,kN}var xN,cQ;function Ic(){if(cQ)return xN;cQ=1;var e=Ioe(),n=typeof self=="object"&&self&&self.Object===Object&&self,a=e||n||Function("return this")();return xN=a,xN}var qN,uQ;function kq(){if(uQ)return qN;uQ=1;var e=Ic(),n=e.Symbol;return qN=n,qN}var LN,dQ;function YCe(){if(dQ)return LN;dQ=1;var e=kq(),n=Object.prototype,a=n.hasOwnProperty,t=n.toString,i=e?e.toStringTag:void 0;function r(s){var o=a.call(s,i),u=s[i];try{s[i]=void 0;var c=!0}catch{}var d=t.call(s);return c&&(o?s[i]=u:delete s[i]),d}return LN=r,LN}var BN,lQ;function XCe(){if(lQ)return BN;lQ=1;var e=Object.prototype,n=e.toString;function a(t){return n.call(t)}return BN=a,BN}var UN,fQ;function sI(){if(fQ)return UN;fQ=1;var e=kq(),n=YCe(),a=XCe(),t="[object Null]",i="[object Undefined]",r=e?e.toStringTag:void 0;function s(o){return o==null?o===void 0?i:t:r&&r in Object(o)?n(o):a(o)}return UN=s,UN}var zN,hQ;function OT(){if(hQ)return zN;hQ=1;function e(n){var a=typeof n;return n!=null&&(a=="object"||a=="function")}return zN=e,zN}var VN,mQ;function Roe(){if(mQ)return VN;mQ=1;var e=sI(),n=OT(),a="[object AsyncFunction]",t="[object Function]",i="[object GeneratorFunction]",r="[object Proxy]";function s(o){if(!n(o))return!1;var u=e(o);return u==t||u==i||u==a||u==r}return VN=s,VN}var HN,pQ;function ZCe(){if(pQ)return HN;pQ=1;var e=Ic(),n=e["__core-js_shared__"];return HN=n,HN}var KN,gQ;function e_e(){if(gQ)return KN;gQ=1;var e=ZCe(),n=(function(){var t=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function a(t){return!!n&&n in t}return KN=a,KN}var $N,yQ;function Foe(){if(yQ)return $N;yQ=1;var e=Function.prototype,n=e.toString;function a(t){if(t!=null){try{return n.call(t)}catch{}try{return t+""}catch{}}return""}return $N=a,$N}var GN,bQ;function t_e(){if(bQ)return GN;bQ=1;var e=Roe(),n=e_e(),a=OT(),t=Foe(),i=/[\\^$.*+?()[\]{}|]/g,r=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,u=s.toString,c=o.hasOwnProperty,d=RegExp("^"+u.call(c).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function l(f){if(!a(f)||n(f))return!1;var b=e(f)?d:r;return b.test(t(f))}return GN=l,GN}var WN,vQ;function n_e(){if(vQ)return WN;vQ=1;function e(n,a){return n?.[a]}return WN=e,WN}var JN,SQ;function Zg(){if(SQ)return JN;SQ=1;var e=t_e(),n=n_e();function a(t,i){var r=n(t,i);return e(r)?r:void 0}return JN=a,JN}var QN,CQ;function xq(){if(CQ)return QN;CQ=1;var e=Zg(),n=Ic(),a=e(n,"Map");return QN=a,QN}var YN,_Q;function aI(){if(_Q)return YN;_Q=1;var e=Zg(),n=e(Object,"create");return YN=n,YN}var XN,TQ;function r_e(){if(TQ)return XN;TQ=1;var e=aI();function n(){this.__data__=e?e(null):{},this.size=0}return XN=n,XN}var ZN,wQ;function i_e(){if(wQ)return ZN;wQ=1;function e(n){var a=this.has(n)&&delete this.__data__[n];return this.size-=a?1:0,a}return ZN=e,ZN}var eA,OQ;function s_e(){if(OQ)return eA;OQ=1;var e=aI(),n="__lodash_hash_undefined__",a=Object.prototype,t=a.hasOwnProperty;function i(r){var s=this.__data__;if(e){var o=s[r];return o===n?void 0:o}return t.call(s,r)?s[r]:void 0}return eA=i,eA}var tA,PQ;function a_e(){if(PQ)return tA;PQ=1;var e=aI(),n=Object.prototype,a=n.hasOwnProperty;function t(i){var r=this.__data__;return e?r[i]!==void 0:a.call(r,i)}return tA=t,tA}var nA,EQ;function o_e(){if(EQ)return nA;EQ=1;var e=aI(),n="__lodash_hash_undefined__";function a(t,i){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=e&&i===void 0?n:i,this}return nA=a,nA}var rA,IQ;function c_e(){if(IQ)return rA;IQ=1;var e=r_e(),n=i_e(),a=s_e(),t=a_e(),i=o_e();function r(s){var o=-1,u=s==null?0:s.length;for(this.clear();++o<u;){var c=s[o];this.set(c[0],c[1])}}return r.prototype.clear=e,r.prototype.delete=n,r.prototype.get=a,r.prototype.has=t,r.prototype.set=i,rA=r,rA}var iA,RQ;function u_e(){if(RQ)return iA;RQ=1;var e=c_e(),n=iI(),a=xq();function t(){this.size=0,this.__data__={hash:new e,map:new(a||n),string:new e}}return iA=t,iA}var sA,FQ;function d_e(){if(FQ)return sA;FQ=1;function e(n){var a=typeof n;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?n!=="__proto__":n===null}return sA=e,sA}var aA,jQ;function oI(){if(jQ)return aA;jQ=1;var e=d_e();function n(a,t){var i=a.__data__;return e(t)?i[typeof t=="string"?"string":"hash"]:i.map}return aA=n,aA}var oA,MQ;function l_e(){if(MQ)return oA;MQ=1;var e=oI();function n(a){var t=e(this,a).delete(a);return this.size-=t?1:0,t}return oA=n,oA}var cA,NQ;function f_e(){if(NQ)return cA;NQ=1;var e=oI();function n(a){return e(this,a).get(a)}return cA=n,cA}var uA,AQ;function h_e(){if(AQ)return uA;AQ=1;var e=oI();function n(a){return e(this,a).has(a)}return uA=n,uA}var dA,DQ;function m_e(){if(DQ)return dA;DQ=1;var e=oI();function n(a,t){var i=e(this,a),r=i.size;return i.set(a,t),this.size+=i.size==r?0:1,this}return dA=n,dA}var lA,kQ;function p_e(){if(kQ)return lA;kQ=1;var e=u_e(),n=l_e(),a=f_e(),t=h_e(),i=m_e();function r(s){var o=-1,u=s==null?0:s.length;for(this.clear();++o<u;){var c=s[o];this.set(c[0],c[1])}}return r.prototype.clear=e,r.prototype.delete=n,r.prototype.get=a,r.prototype.has=t,r.prototype.set=i,lA=r,lA}var fA,xQ;function g_e(){if(xQ)return fA;xQ=1;var e=iI(),n=xq(),a=p_e(),t=200;function i(r,s){var o=this.__data__;if(o instanceof e){var u=o.__data__;if(!n||u.length<t-1)return u.push([r,s]),this.size=++o.size,this;o=this.__data__=new a(u)}return o.set(r,s),this.size=o.size,this}return fA=i,fA}var hA,qQ;function y_e(){if(qQ)return hA;qQ=1;var e=iI(),n=GCe(),a=WCe(),t=JCe(),i=QCe(),r=g_e();function s(o){var u=this.__data__=new e(o);this.size=u.size}return s.prototype.clear=n,s.prototype.delete=a,s.prototype.get=t,s.prototype.has=i,s.prototype.set=r,hA=s,hA}var mA,LQ;function b_e(){if(LQ)return mA;LQ=1;function e(n,a){for(var t=-1,i=n==null?0:n.length;++t<i&&a(n[t],t,n)!==!1;);return n}return mA=e,mA}var pA,BQ;function v_e(){if(BQ)return pA;BQ=1;var e=Zg(),n=(function(){try{var a=e(Object,"defineProperty");return a({},"",{}),a}catch{}})();return pA=n,pA}var gA,UQ;function joe(){if(UQ)return gA;UQ=1;var e=v_e();function n(a,t,i){t=="__proto__"&&e?e(a,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):a[t]=i}return gA=n,gA}var yA,zQ;function Moe(){if(zQ)return yA;zQ=1;var e=joe(),n=Eoe(),a=Object.prototype,t=a.hasOwnProperty;function i(r,s,o){var u=r[s];(!(t.call(r,s)&&n(u,o))||o===void 0&&!(s in r))&&e(r,s,o)}return yA=i,yA}var bA,VQ;function cI(){if(VQ)return bA;VQ=1;var e=Moe(),n=joe();function a(t,i,r,s){var o=!r;r||(r={});for(var u=-1,c=i.length;++u<c;){var d=i[u],l=s?s(r[d],t[d],d,r,t):void 0;l===void 0&&(l=t[d]),o?n(r,d,l):e(r,d,l)}return r}return bA=a,bA}var vA,HQ;function S_e(){if(HQ)return vA;HQ=1;function e(n,a){for(var t=-1,i=Array(n);++t<n;)i[t]=a(t);return i}return vA=e,vA}var SA,KQ;function PT(){if(KQ)return SA;KQ=1;function e(n){return n!=null&&typeof n=="object"}return SA=e,SA}var CA,$Q;function C_e(){if($Q)return CA;$Q=1;var e=sI(),n=PT(),a="[object Arguments]";function t(i){return n(i)&&e(i)==a}return CA=t,CA}var _A,GQ;function __e(){if(GQ)return _A;GQ=1;var e=C_e(),n=PT(),a=Object.prototype,t=a.hasOwnProperty,i=a.propertyIsEnumerable,r=e((function(){return arguments})())?e:function(s){return n(s)&&t.call(s,"callee")&&!i.call(s,"callee")};return _A=r,_A}var TA,WQ;function qq(){if(WQ)return TA;WQ=1;var e=Array.isArray;return TA=e,TA}var U1={exports:{}},wA,JQ;function T_e(){if(JQ)return wA;JQ=1;function e(){return!1}return wA=e,wA}U1.exports;var QQ;function Noe(){return QQ||(QQ=1,(function(e,n){var a=Ic(),t=T_e(),i=n&&!n.nodeType&&n,r=i&&!0&&e&&!e.nodeType&&e,s=r&&r.exports===i,o=s?a.Buffer:void 0,u=o?o.isBuffer:void 0,c=u||t;e.exports=c})(U1,U1.exports)),U1.exports}var OA,YQ;function w_e(){if(YQ)return OA;YQ=1;var e=9007199254740991,n=/^(?:0|[1-9]\d*)$/;function a(t,i){var r=typeof t;return i=i??e,!!i&&(r=="number"||r!="symbol"&&n.test(t))&&t>-1&&t%1==0&&t<i}return OA=a,OA}var PA,XQ;function Aoe(){if(XQ)return PA;XQ=1;var e=9007199254740991;function n(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=e}return PA=n,PA}var EA,ZQ;function O_e(){if(ZQ)return EA;ZQ=1;var e=sI(),n=Aoe(),a=PT(),t="[object Arguments]",i="[object Array]",r="[object Boolean]",s="[object Date]",o="[object Error]",u="[object Function]",c="[object Map]",d="[object Number]",l="[object Object]",f="[object RegExp]",b="[object Set]",C="[object String]",v="[object WeakMap]",m="[object ArrayBuffer]",h="[object DataView]",g="[object Float32Array]",_="[object Float64Array]",S="[object Int8Array]",p="[object Int16Array]",w="[object Int32Array]",O="[object Uint8Array]",E="[object Uint8ClampedArray]",F="[object Uint16Array]",R="[object Uint32Array]",M={};M[g]=M[_]=M[S]=M[p]=M[w]=M[O]=M[E]=M[F]=M[R]=!0,M[t]=M[i]=M[m]=M[r]=M[h]=M[s]=M[o]=M[u]=M[c]=M[d]=M[l]=M[f]=M[b]=M[C]=M[v]=!1;function j(k){return a(k)&&n(k.length)&&!!M[e(k)]}return EA=j,EA}var IA,eY;function Lq(){if(eY)return IA;eY=1;function e(n){return function(a){return n(a)}}return IA=e,IA}var z1={exports:{}};z1.exports;var tY;function Bq(){return tY||(tY=1,(function(e,n){var a=Ioe(),t=n&&!n.nodeType&&n,i=t&&!0&&e&&!e.nodeType&&e,r=i&&i.exports===t,s=r&&a.process,o=(function(){try{var u=i&&i.require&&i.require("util").types;return u||s&&s.binding&&s.binding("util")}catch{}})();e.exports=o})(z1,z1.exports)),z1.exports}var RA,nY;function P_e(){if(nY)return RA;nY=1;var e=O_e(),n=Lq(),a=Bq(),t=a&&a.isTypedArray,i=t?n(t):e;return RA=i,RA}var FA,rY;function Doe(){if(rY)return FA;rY=1;var e=S_e(),n=__e(),a=qq(),t=Noe(),i=w_e(),r=P_e(),s=Object.prototype,o=s.hasOwnProperty;function u(c,d){var l=a(c),f=!l&&n(c),b=!l&&!f&&t(c),C=!l&&!f&&!b&&r(c),v=l||f||b||C,m=v?e(c.length,String):[],h=m.length;for(var g in c)(d||o.call(c,g))&&!(v&&(g=="length"||b&&(g=="offset"||g=="parent")||C&&(g=="buffer"||g=="byteLength"||g=="byteOffset")||i(g,h)))&&m.push(g);return m}return FA=u,FA}var jA,iY;function Uq(){if(iY)return jA;iY=1;var e=Object.prototype;function n(a){var t=a&&a.constructor,i=typeof t=="function"&&t.prototype||e;return a===i}return jA=n,jA}var MA,sY;function koe(){if(sY)return MA;sY=1;function e(n,a){return function(t){return n(a(t))}}return MA=e,MA}var NA,aY;function E_e(){if(aY)return NA;aY=1;var e=koe(),n=e(Object.keys,Object);return NA=n,NA}var AA,oY;function I_e(){if(oY)return AA;oY=1;var e=Uq(),n=E_e(),a=Object.prototype,t=a.hasOwnProperty;function i(r){if(!e(r))return n(r);var s=[];for(var o in Object(r))t.call(r,o)&&o!="constructor"&&s.push(o);return s}return AA=i,AA}var DA,cY;function xoe(){if(cY)return DA;cY=1;var e=Roe(),n=Aoe();function a(t){return t!=null&&n(t.length)&&!e(t)}return DA=a,DA}var kA,uY;function zq(){if(uY)return kA;uY=1;var e=Doe(),n=I_e(),a=xoe();function t(i){return a(i)?e(i):n(i)}return kA=t,kA}var xA,dY;function R_e(){if(dY)return xA;dY=1;var e=cI(),n=zq();function a(t,i){return t&&e(i,n(i),t)}return xA=a,xA}var qA,lY;function F_e(){if(lY)return qA;lY=1;function e(n){var a=[];if(n!=null)for(var t in Object(n))a.push(t);return a}return qA=e,qA}var LA,fY;function j_e(){if(fY)return LA;fY=1;var e=OT(),n=Uq(),a=F_e(),t=Object.prototype,i=t.hasOwnProperty;function r(s){if(!e(s))return a(s);var o=n(s),u=[];for(var c in s)c=="constructor"&&(o||!i.call(s,c))||u.push(c);return u}return LA=r,LA}var BA,hY;function Vq(){if(hY)return BA;hY=1;var e=Doe(),n=j_e(),a=xoe();function t(i){return a(i)?e(i,!0):n(i)}return BA=t,BA}var UA,mY;function M_e(){if(mY)return UA;mY=1;var e=cI(),n=Vq();function a(t,i){return t&&e(i,n(i),t)}return UA=a,UA}var V1={exports:{}};V1.exports;var pY;function N_e(){return pY||(pY=1,(function(e,n){var a=Ic(),t=n&&!n.nodeType&&n,i=t&&!0&&e&&!e.nodeType&&e,r=i&&i.exports===t,s=r?a.Buffer:void 0,o=s?s.allocUnsafe:void 0;function u(c,d){if(d)return c.slice();var l=c.length,f=o?o(l):new c.constructor(l);return c.copy(f),f}e.exports=u})(V1,V1.exports)),V1.exports}var zA,gY;function A_e(){if(gY)return zA;gY=1;function e(n,a){var t=-1,i=n.length;for(a||(a=Array(i));++t<i;)a[t]=n[t];return a}return zA=e,zA}var VA,yY;function D_e(){if(yY)return VA;yY=1;function e(n,a){for(var t=-1,i=n==null?0:n.length,r=0,s=[];++t<i;){var o=n[t];a(o,t,n)&&(s[r++]=o)}return s}return VA=e,VA}var HA,bY;function qoe(){if(bY)return HA;bY=1;function e(){return[]}return HA=e,HA}var KA,vY;function Hq(){if(vY)return KA;vY=1;var e=D_e(),n=qoe(),a=Object.prototype,t=a.propertyIsEnumerable,i=Object.getOwnPropertySymbols,r=i?function(s){return s==null?[]:(s=Object(s),e(i(s),function(o){return t.call(s,o)}))}:n;return KA=r,KA}var $A,SY;function k_e(){if(SY)return $A;SY=1;var e=cI(),n=Hq();function a(t,i){return e(t,n(t),i)}return $A=a,$A}var GA,CY;function Loe(){if(CY)return GA;CY=1;function e(n,a){for(var t=-1,i=a.length,r=n.length;++t<i;)n[r+t]=a[t];return n}return GA=e,GA}var WA,_Y;function Boe(){if(_Y)return WA;_Y=1;var e=koe(),n=e(Object.getPrototypeOf,Object);return WA=n,WA}var JA,TY;function Uoe(){if(TY)return JA;TY=1;var e=Loe(),n=Boe(),a=Hq(),t=qoe(),i=Object.getOwnPropertySymbols,r=i?function(s){for(var o=[];s;)e(o,a(s)),s=n(s);return o}:t;return JA=r,JA}var QA,wY;function x_e(){if(wY)return QA;wY=1;var e=cI(),n=Uoe();function a(t,i){return e(t,n(t),i)}return QA=a,QA}var YA,OY;function zoe(){if(OY)return YA;OY=1;var e=Loe(),n=qq();function a(t,i,r){var s=i(t);return n(t)?s:e(s,r(t))}return YA=a,YA}var XA,PY;function q_e(){if(PY)return XA;PY=1;var e=zoe(),n=Hq(),a=zq();function t(i){return e(i,a,n)}return XA=t,XA}var ZA,EY;function L_e(){if(EY)return ZA;EY=1;var e=zoe(),n=Uoe(),a=Vq();function t(i){return e(i,a,n)}return ZA=t,ZA}var eD,IY;function B_e(){if(IY)return eD;IY=1;var e=Zg(),n=Ic(),a=e(n,"DataView");return eD=a,eD}var tD,RY;function U_e(){if(RY)return tD;RY=1;var e=Zg(),n=Ic(),a=e(n,"Promise");return tD=a,tD}var nD,FY;function z_e(){if(FY)return nD;FY=1;var e=Zg(),n=Ic(),a=e(n,"Set");return nD=a,nD}var rD,jY;function V_e(){if(jY)return rD;jY=1;var e=Zg(),n=Ic(),a=e(n,"WeakMap");return rD=a,rD}var iD,MY;function Kq(){if(MY)return iD;MY=1;var e=B_e(),n=xq(),a=U_e(),t=z_e(),i=V_e(),r=sI(),s=Foe(),o="[object Map]",u="[object Object]",c="[object Promise]",d="[object Set]",l="[object WeakMap]",f="[object DataView]",b=s(e),C=s(n),v=s(a),m=s(t),h=s(i),g=r;return(e&&g(new e(new ArrayBuffer(1)))!=f||n&&g(new n)!=o||a&&g(a.resolve())!=c||t&&g(new t)!=d||i&&g(new i)!=l)&&(g=function(_){var S=r(_),p=S==u?_.constructor:void 0,w=p?s(p):"";if(w)switch(w){case b:return f;case C:return o;case v:return c;case m:return d;case h:return l}return S}),iD=g,iD}var sD,NY;function H_e(){if(NY)return sD;NY=1;var e=Object.prototype,n=e.hasOwnProperty;function a(t){var i=t.length,r=new t.constructor(i);return i&&typeof t[0]=="string"&&n.call(t,"index")&&(r.index=t.index,r.input=t.input),r}return sD=a,sD}var aD,AY;function K_e(){if(AY)return aD;AY=1;var e=Ic(),n=e.Uint8Array;return aD=n,aD}var oD,DY;function $q(){if(DY)return oD;DY=1;var e=K_e();function n(a){var t=new a.constructor(a.byteLength);return new e(t).set(new e(a)),t}return oD=n,oD}var cD,kY;function $_e(){if(kY)return cD;kY=1;var e=$q();function n(a,t){var i=t?e(a.buffer):a.buffer;return new a.constructor(i,a.byteOffset,a.byteLength)}return cD=n,cD}var uD,xY;function G_e(){if(xY)return uD;xY=1;var e=/\w*$/;function n(a){var t=new a.constructor(a.source,e.exec(a));return t.lastIndex=a.lastIndex,t}return uD=n,uD}var dD,qY;function W_e(){if(qY)return dD;qY=1;var e=kq(),n=e?e.prototype:void 0,a=n?n.valueOf:void 0;function t(i){return a?Object(a.call(i)):{}}return dD=t,dD}var lD,LY;function J_e(){if(LY)return lD;LY=1;var e=$q();function n(a,t){var i=t?e(a.buffer):a.buffer;return new a.constructor(i,a.byteOffset,a.length)}return lD=n,lD}var fD,BY;function Q_e(){if(BY)return fD;BY=1;var e=$q(),n=$_e(),a=G_e(),t=W_e(),i=J_e(),r="[object Boolean]",s="[object Date]",o="[object Map]",u="[object Number]",c="[object RegExp]",d="[object Set]",l="[object String]",f="[object Symbol]",b="[object ArrayBuffer]",C="[object DataView]",v="[object Float32Array]",m="[object Float64Array]",h="[object Int8Array]",g="[object Int16Array]",_="[object Int32Array]",S="[object Uint8Array]",p="[object Uint8ClampedArray]",w="[object Uint16Array]",O="[object Uint32Array]";function E(F,R,M){var j=F.constructor;switch(R){case b:return e(F);case r:case s:return new j(+F);case C:return n(F,M);case v:case m:case h:case g:case _:case S:case p:case w:case O:return i(F,M);case o:return new j;case u:case l:return new j(F);case c:return a(F);case d:return new j;case f:return t(F)}}return fD=E,fD}var hD,UY;function Y_e(){if(UY)return hD;UY=1;var e=OT(),n=Object.create,a=(function(){function t(){}return function(i){if(!e(i))return{};if(n)return n(i);t.prototype=i;var r=new t;return t.prototype=void 0,r}})();return hD=a,hD}var mD,zY;function X_e(){if(zY)return mD;zY=1;var e=Y_e(),n=Boe(),a=Uq();function t(i){return typeof i.constructor=="function"&&!a(i)?e(n(i)):{}}return mD=t,mD}var pD,VY;function Z_e(){if(VY)return pD;VY=1;var e=Kq(),n=PT(),a="[object Map]";function t(i){return n(i)&&e(i)==a}return pD=t,pD}var gD,HY;function e1e(){if(HY)return gD;HY=1;var e=Z_e(),n=Lq(),a=Bq(),t=a&&a.isMap,i=t?n(t):e;return gD=i,gD}var yD,KY;function t1e(){if(KY)return yD;KY=1;var e=Kq(),n=PT(),a="[object Set]";function t(i){return n(i)&&e(i)==a}return yD=t,yD}var bD,$Y;function n1e(){if($Y)return bD;$Y=1;var e=t1e(),n=Lq(),a=Bq(),t=a&&a.isSet,i=t?n(t):e;return bD=i,bD}var vD,GY;function r1e(){if(GY)return vD;GY=1;var e=y_e(),n=b_e(),a=Moe(),t=R_e(),i=M_e(),r=N_e(),s=A_e(),o=k_e(),u=x_e(),c=q_e(),d=L_e(),l=Kq(),f=H_e(),b=Q_e(),C=X_e(),v=qq(),m=Noe(),h=e1e(),g=OT(),_=n1e(),S=zq(),p=Vq(),w=1,O=2,E=4,F="[object Arguments]",R="[object Array]",M="[object Boolean]",j="[object Date]",k="[object Error]",x="[object Function]",L="[object GeneratorFunction]",V="[object Map]",G="[object Number]",ee="[object Object]",se="[object RegExp]",re="[object Set]",fe="[object String]",oe="[object Symbol]",pe="[object WeakMap]",de="[object ArrayBuffer]",ge="[object DataView]",Ce="[object Float32Array]",Fe="[object Float64Array]",We="[object Int8Array]",Ze="[object Int16Array]",lt="[object Int32Array]",ut="[object Uint8Array]",pt="[object Uint8ClampedArray]",Nt="[object Uint16Array]",Ke="[object Uint32Array]",Ge={};Ge[F]=Ge[R]=Ge[de]=Ge[ge]=Ge[M]=Ge[j]=Ge[Ce]=Ge[Fe]=Ge[We]=Ge[Ze]=Ge[lt]=Ge[V]=Ge[G]=Ge[ee]=Ge[se]=Ge[re]=Ge[fe]=Ge[oe]=Ge[ut]=Ge[pt]=Ge[Nt]=Ge[Ke]=!0,Ge[k]=Ge[x]=Ge[pe]=!1;function Re(Qe,Y,Me,K,Z,me){var we,qe=Y&w,xe=Y&O,Oe=Y&E;if(Me&&(we=Z?Me(Qe,K,Z,me):Me(Qe)),we!==void 0)return we;if(!g(Qe))return Qe;var He=v(Qe);if(He){if(we=f(Qe),!qe)return s(Qe,we)}else{var Se=l(Qe),Ve=Se==x||Se==L;if(m(Qe))return r(Qe,qe);if(Se==ee||Se==F||Ve&&!Z){if(we=xe||Ve?{}:C(Qe),!qe)return xe?u(Qe,i(we,Qe)):o(Qe,t(we,Qe))}else{if(!Ge[Se])return Z?Qe:{};we=b(Qe,Se,qe)}}me||(me=new e);var ot=me.get(Qe);if(ot)return ot;me.set(Qe,we),_(Qe)?Qe.forEach(function(Ue){we.add(Re(Ue,Y,Me,Ue,Qe,me))}):h(Qe)&&Qe.forEach(function(Ue,Pe){we.set(Pe,Re(Ue,Y,Me,Pe,Qe,me))});var mt=Oe?xe?d:c:xe?p:S,he=He?void 0:mt(Qe);return n(he||Qe,function(Ue,Pe){he&&(Pe=Ue,Ue=Qe[Pe]),a(we,Pe,Re(Ue,Y,Me,Pe,Qe,me))}),we}return vD=Re,vD}var SD,WY;function i1e(){if(WY)return SD;WY=1;var e=r1e(),n=1,a=4;function t(i){return e(i,n|a)}return SD=t,SD}var s1e=i1e();const JY=iE(s1e);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class a1e{constructor(n,a){typeof n=="number"?(this.ranges=[{length:0,primary:n,secondary:a}],this.lastPrimary=n,this.lastSecondary=a):(this.ranges=JY(n.ranges),this.lastPrimary=n.lastPrimary,this.lastSecondary=n.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:JY(this.ranges)}}add(n,a){yi(n>=this.lastPrimary,3),this.lastSecondary!==void 0&&yi(a>=this.lastSecondary,4),this.lastPrimary=n,this.lastSecondary=a;const t=this.ranges[this.ranges.length-1],i=t.primary+t.length,r=t.secondary+t.length;a!==r&&(n===i?t.length===0?t.secondary=a:(t.length--,this.ranges.push({length:0,primary:n,secondary:a})):i+1===n&&r+1===a?t.length++:this.ranges.push({length:0,primary:n,secondary:a}))}get(n){yi(n>=this.ranges[0].primary,5);let a=1;for(;a<this.ranges.length&&!(n<this.ranges[a].primary);a++);yi(n>=this.ranges[a-1].primary,6);const t=this.ranges[a-1];return Math.min(n-t.primary,t.length)+t.secondary}updateBase(n){yi(n>=this.ranges[0].primary,7);let a=1;for(;a<this.ranges.length&&!(n<this.ranges[a].primary);a++);yi(n>=this.ranges[a-1].primary,8);const t=this.ranges[a-1],i=n-t.primary;t.secondary=t.secondary+Math.min(i,t.length),t.length=Math.max(t.length-i,0),t.primary=n,this.ranges=a-1>0?this.ranges.slice(a-1):this.ranges,yi(n===this.ranges[0].primary,9)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class o1e{constructor(n){this.windowMSec=n,this.requestMap=new Map}filter(n,a){const t=[],i=Date.now();for(const r of a){const s=`${n}/${r}`;if(!this.requestMap.has(s))this.requestMap.set(s,i),t.push(r);else{if(this.requestMap.get(s)+this.windowMSec>i)continue;this.requestMap.set(s,i),t.push(r)}}return t}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function c1e(e){let n;try{n=JSON.parse(e)}catch{return}return n}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const CD=2147483647;function Gq(e,n,a){let t;if(n>CD){const i=n-CD;t=setTimeout(()=>Gq(e,i,a),CD)}else t=setTimeout(()=>e(),Math.max(n,0));return a?.(t),t}class Voe{constructor(n,a,t=()=>Date.now()){this.defaultTimeout=n,this.defaultHandler=a,this.getCurrentTick=t}get hasTimer(){return!!this.runningState}start(n=this.defaultTimeout,a=this.defaultHandler){this.startCore(n,a,n)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(n,a){if(!this.runningState)this.start(n,a);else{const t=n??this.runningState.intendedDuration,i=a??this.runningState.restart?.handler??this.runningState.handler,r=this.calculateRemainingTime(this.runningState);t<r?this.start(t,i):t===r?(this.runningState.handler=i,this.runningState.restart=void 0,this.runningState.intendedDuration=t):this.runningState.restart={startTick:this.getCurrentTick(),duration:t,handler:i}}}startCore(n,a,t){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:n,intendedDuration:t,handler:a,timeout:Gq(()=>this.handler(),n,i=>{this.runningState!==void 0&&(this.runningState.timeout=i)})}}handler(){yi(!!this.runningState,10);const n=this.runningState.restart;if(n!==void 0){const a=this.calculateRemainingTime(n);this.startCore(a,()=>n.handler(),n.duration)}else{const a=this.runningState.handler;this.clear(),a()}}calculateRemainingTime(n){const a=this.getCurrentTick()-n.startTick;return n.duration-a}}class u1e{constructor(n,a){this.timer=new Voe(n,()=>this.wrapHandler(a))}get hasTimer(){return this.timer.hasTimer}async start(n,a){return this.clear(),this.deferred=new Poe,this.timer.start(n,a?()=>this.wrapHandler(a):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(n){n(),yi(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Wq{constructor(n){this.startTick=n,this.lastTick=n}static start(){const n=Ik.now();return new Wq(n)}trace(){const n=Ik.now(),a={totalTimeElapsed:n-this.startTick,duration:n-this.lastTick,tick:n};return this.lastTick=n,a}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ET(e,n="Unreachable Case"){throw new Error(n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const d1e=Object.freeze(Object.defineProperty({__proto__:null,BaseTelemetryNullLogger:xCe,Deferred:Poe,EventForwarder:vc,Heap:DCe,IsoBuffer:Cl,Lazy:kCe,LazyPromise:UCe,NumberComparer:ACe,PromiseCache:BCe,PromiseTimer:u1e,RangeTracker:a1e,RateLimiter:o1e,TelemetryNullLogger:qCe,Timer:Voe,Trace:Wq,TypedEventEmitter:Ooe,Uint8ArrayToArrayBuffer:jCe,Uint8ArrayToString:nI,assert:yi,bufferToString:PCe,delay:MCe,doIfNotDisposed:NCe,fromBase64ToUtf8:RCe,fromUtf8ToBase64:Toe,gitHashFile:_oe,hashFile:Coe,isArrayBuffer:Ek,performance:Ik,safelyParseJSON:c1e,setLongTimeout:Gq,stringToBuffer:Dq,toUtf8:FCe,unreachableCase:ET},Symbol.toStringTag,{value:"Module"}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var X1;(function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"})(X1||(X1={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Fa;(function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"})(Fa||(Fa={}));var Ra;(function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"})(Ra||(Ra={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Wr;(function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4})(Wr||(Wr={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function l1e(e){const n=e.type===Wr.Handle?e.handleType:e.type;switch(n){case Wr.Blob:case Wr.Attachment:return Fa.File;case Wr.Tree:return Fa.Directory;default:ET(n,`Unknown type: ${n}`)}}function Hoe(e){const n=e.type===Wr.Handle?e.handleType:e.type;switch(n){case Wr.Blob:case Wr.Attachment:return"blob";case Wr.Tree:return"tree";default:ET(n,`Unknown type: ${n}`)}}function f1e(e,n=new Map,a=!1){const t={},i={id:e.sha,blobs:{},trees:{}};t[""]=i;for(const r of e.tree){const s=a?r.path.replace(/^\.app\//,""):r.path,o=s.lastIndexOf("/"),u=s.slice(0,Math.max(0,o)),c=s.slice(o+1),d=t[u];if(r.type==="tree"){const l={id:r.sha,blobs:{},commits:{},trees:{}};d.trees[decodeURIComponent(c)]=l,t[s]=l}else if(r.type==="blob")d.blobs[decodeURIComponent(c)]=r.sha,n.set(r.sha,`/${s}`);else throw new Error("Unknown entry type!!")}return i}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const h1e="@fluidframework/server-services-client",m1e="7.0.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Uo=Sme.debug("fluid:services-client");Uo(`Package: ${h1e} - Version: ${m1e}`);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class p1e{constructor(n){this.historian=n,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(n,a){const t=await this.historian.getHeader(a);for(const i of t.blobs)this.blobCache.set(i.sha,i);return f1e(t.tree)}async getFullTree(n){return this.historian.getFullTree(n)}async getCommit(n){const a=this.commitCache.get(n);return a!==void 0?(Uo(`Cache hit on ${n}`),a):this.historian.getCommit(n)}async getCommits(n,a){let t=n;const i=this.refCache.get(n);if(i!==void 0&&(Uo(`Commit cache hit on ${n}`),t=i,this.refCache.delete(n),!t))return[];const r=this.commitCache.get(t);if(r!==void 0){Uo(`Commit cache hit on ${t}`);const s=r;return[{commit:{author:s.author,committer:s.committer,message:s.message,tree:s.tree,url:s.url},parents:s.parents,sha:s.sha,url:s.url}]}return this.historian.getCommits(t,a)}async getTree(n,a=!0){const t=this.treeCache.get(n);return t!==void 0?(Uo(`Tree cache hit on ${n}`),t):this.historian.getTree(n,a)}async getBlob(n){const a=this.blobCache.get(n);return a!==void 0?(Uo(`Blob cache hit on ${n}`),a):this.historian.getBlob(n)}getRawUrl(n){return`${this.historian.endpoint}/git/blobs/raw/${n}`}async getContent(n,a){return this.historian.getContent(a,n)}async createBlob(n,a){const t={content:n,encoding:a};return this.historian.createBlob(t)}async createGitTree(n){return this.historian.createTree(n)}async createTree(n){return this.createTreeCore(n,0)}async createCommit(n){return this.historian.createCommit(n)}async createSummary(n,a=!1){return this.historian.createSummary(n,a)}async deleteSummary(n){return this.historian.deleteSummary(n)}async getSummary(n){return this.historian.getSummary(n)}async getRef(n){return this.historian.getRef(`heads/${n}`).catch(a=>{if(a===400||a===404)return null;throw a})}async createRef(n,a){const t={ref:`refs/heads/${n}`,sha:a,config:{enabled:!0}};return this.historian.createRef(t)}async upsertRef(n,a){const t={force:!0,sha:a,config:{enabled:!0}};return this.historian.updateRef(`heads/${n}`,t)}addRef(n,a){this.refCache.set(n,a)}addCommit(n){this.commitCache.set(n.sha,n)}addTree(n){this.treeCache.set(n.sha,n)}addBlob(n){this.blobCache.set(n.sha,n)}async write(n,a,t,i){const r=await this.createTree(a),s={author:{date:new Date().toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:t,tree:r.sha},o=await this.historian.createCommit(s);return await(await this.getRef(n)?this.upsertRef(n,o.sha):this.createRef(n,o.sha)),o}async createTreeCore(n,a){if(n.id)return this.getTree(n.id);const t=[];for(const u of n.entries)switch(Ra[u.type]){case Ra.Blob:{const c=u.value;u.mode===Fa.Symlink&&(c.contents=this.translateSymlink(c.contents,a));const d=this.createBlob(c.contents,c.encoding);t.push(d);break}case Ra.Tree:{const c=u.value,d=this.createTreeCore(c,a+1);t.push(d);break}default:throw new Error("Unknown entry type")}const i=await Promise.all(t),r=[];yi(i.length===n.entries.length,"File entries length is not correct");for(let u=0;u<n.entries.length;u++){const c=n.entries[u].type===Ra.Tree?"tree":n.entries[u].type===Ra.Blob?"blob":"commit";r.push({mode:n.entries[u].mode,path:n.entries[u].path,sha:i[u].sha,type:c})}const s={tree:r};return this.historian.createTree(s)}translateSymlink(n,a){let t="";for(let i=0;i<=a;i++)t+="../";return`${t}${n}`}}var FP={exports:{}},QY;function Koe(){return QY||(QY=1,(function(e,n){n=e.exports=a,n.getSerialize=t;function a(i,r,s,o){return JSON.stringify(i,t(r,o),s)}function t(i,r){var s=[],o=[];return r==null&&(r=function(u,c){return s[0]===c?"[Circular ~]":"[Circular ~."+o.slice(0,s.indexOf(c)).join(".")+"]"}),function(u,c){if(s.length>0){var d=s.indexOf(this);~d?s.splice(d+1):s.push(this),~d?o.splice(d,1/0,u):o.push(u),~s.indexOf(c)&&(c=r.call(this,u,c))}else s.push(c);return i==null?c:i.call(this,u,c)}}})(FP,FP.exports)),FP.exports}var g1e=Koe();const y1e=iE(g1e);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class b1e{bindTimeout(n,a){a()}async bindTimeoutAsync(n,a){return a()}checkTimeout(){}getTimeRemainingMs(){}}const v1e=new b1e,Rk=()=>typeof window<"u"?window:global,$oe=()=>Rk()?.timeoutContext??v1e,S1e=e=>{Rk()&&(Rk().timeoutContext=e)};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function C1e(e){Dr.interceptors.request.use(n=>{const a=e();return a&&(n.signal=a.signal),n})}class Goe{constructor(n,a={},t=1e3*1024*1024,i=1e3*1024*1024){this.baseurl=n,this.defaultQueryString=a,this.maxBodyLength=t,this.maxContentLength=i}getTimeoutMs(){const n=$oe().getTimeRemainingMs();if(n&&n>0)return n}getTimeoutMessage(n){return`Timeout occurred for request to ${n}`}async get(n,a,t,i){const r={...i,baseURL:this.baseurl,headers:t,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${n}${this.generateQueryString(a)}`,timeout:this.getTimeoutMs(),timeoutErrorMessage:this.getTimeoutMessage(n)};return this.request(r,200)}async post(n,a,t,i,r){const s={...r,baseURL:this.baseurl,data:a,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${n}${this.generateQueryString(t)}`,timeout:this.getTimeoutMs(),timeoutErrorMessage:this.getTimeoutMessage(n)};return this.request(s,201)}async delete(n,a,t,i){const r={...i,baseURL:this.baseurl,headers:t,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${n}${this.generateQueryString(a)}`,timeout:this.getTimeoutMs(),timeoutErrorMessage:this.getTimeoutMessage(n)};return this.request(r,204)}async patch(n,a,t,i,r){const s={...r,baseURL:this.baseurl,data:a,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${n}${this.generateQueryString(t)}`,timeout:this.getTimeoutMs(),timeoutErrorMessage:this.getTimeoutMessage(n)};return this.request(s,200)}generateQueryString(n){if(this.defaultQueryString||n){const a={...this.defaultQueryString,...n},t={};for(const s of Object.keys(a))t[s]=a[s].toString();const r=new URLSearchParams(t).toString();if(r!=="")return`?${r}`}return""}}class Woe extends Goe{constructor(n,a={},t=1e3*1024*1024,i=1e3*1024*1024,r={},s=Dr,o,u,c,d,l,f,b){super(n,a,t,i),this.defaultHeaders=r,this.axios=s,this.refreshDefaultQueryString=o,this.refreshDefaultHeaders=u,this.getCorrelationId=c,this.getTelemetryContextProperties=d,this.refreshTokenIfNeeded=l,this.logHttpMetrics=f,this.getCallingServiceName=b}async request(n,a,t=!0){const i={...n},r=this.getCorrelationId?.()??QP(),s=this.getCallingServiceName?.();if(i.headers=this.generateHeaders(i.headers,r,this.getTelemetryContextProperties?.(),s),i.headers?.Authorization&&this.refreshTokenIfNeeded){const o=await this.refreshTokenIfNeeded(i.headers).catch(u=>{throw Uo(`request to ${i.url} failed ${u?u.message:""}`),u});o&&(i.headers.Authorization=o.Authorization,this.defaultHeaders.Authorization=o.Authorization)}return new Promise((o,u)=>{const c=performance.now();let d,l;this.axios.request(i).then(f=>{l=f,o(f.data)}).catch(f=>{if(f?.response?.status===a&&o(f?.response?.data),f?.config?Uo(`[${f.config.method}] request to [${f.config.baseURL??""}${f.config.url??""}] failed with [${f.response?.status}] [${y1e(f.response?.data,void 0,2)}]`):Uo(`request to ${i.url} failed ${f?f.message:""}`),f?.response?.status===429&&f?.response?.data?.retryAfter>0&&t)setTimeout(()=>{this.request(i,a).then(o).catch(u)},f.response.data.retryAfter*1e3);else if(f?.response?.status===401&&t&&this.refreshOnAuthError()){const b={...n};b.headers=this.generateHeaders(b.headers,i.headers?.[HP]),this.request(b,a,!1).then(o).catch(u)}else{d=f;const b=`[${f?.config?.method??""}] request to [${f?.config?.baseURL??i.baseURL??""}] failed with [${f.response?.status}] status code`;if(f?.response)typeof f?.response?.data=="string"?u(kg(f?.response?.status,{message:f?.response?.data,source:b})):u(kg(f?.response?.status,{...f?.response?.data,source:b}));else if(f?.request)boe(f)&&u(kg(499,{message:f?.message??"Request Aborted by Client",source:b})),u(kg(502,{message:`Network Error: ${f?.message??"undefined"}`,source:b}));else{const C={canRetry:!1,isFatal:!1,message:f?.message??"Unknown Error",source:b};u(kg(500,C))}}}).finally(()=>{if(this.logHttpMetrics){const f=d?d?.response?.status??"STATUS_UNAVAILABLE":l?.status??"STATUS_UNAVAILABLE",b={axiosError:d,status:f,baseUrl:i.baseURL??d?.config?.baseURL??"BASE_URL_UNAVAILABLE",method:i.method??"METHOD_UNAVAILABLE",url:i.url??"URL_UNAVAILABLE",correlationId:r,durationInMs:performance.now()-c,timeoutInMs:i.timeout??this.axios.defaults.timeout??"TIMEOUT_UNAVAILABLE"};this.logHttpMetrics(b)}})})}generateHeaders(n,a,t,i){const r={...this.defaultHeaders,...n};return!r[HP]&&a&&(r[HP]=a),!r[Ok]&&t&&(r[Ok]=JSON.stringify(t)),!r[Pk]&&i&&(r[Pk]=i),r}refreshOnAuthError(){return this.refreshDefaultQueryString===void 0&&this.refreshDefaultHeaders===void 0?!1:(this.refreshDefaultHeaders!==void 0&&(this.defaultHeaders=this.refreshDefaultHeaders()),this.refreshDefaultQueryString!==void 0&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function _1e(e,n){for(const a of n)if(e.endsWith(a))return!0;return!1}const T1e=e=>`Basic ${Toe(`${e.user}:${e.password}`)}`;function w1e(e,n){let a;if(n){const t=n.match(/Basic (.+)/);if(!t)throw Uo("Invalid base64 token",{tenantId:e}),new gi(403,"Malformed authorization token");const r=Buffer.from(t[1],"base64").toString().match(/(.+):(.+)/);if(!r||e!==r[1])throw Uo("Tenant mismatch or invalid token format",{tenantId:e}),new gi(403,"Malformed authorization token");a=r[2]}return a}class O1e{constructor(n,a,t,i){this.endpoint=n,this.historianApi=a,this.defaultQueryString={},t&&this.historianApi?(this.defaultQueryString.disableCache=t,this.cacheBust=!1):this.cacheBust=t,this.restWrapper=i??new Woe(this.endpoint)}async getHeader(n){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(n)}`,this.getQueryString()):this.getHeaderDirect(n)}async getFullTree(n){return this.restWrapper.get(`/tree/${encodeURIComponent(n)}`,this.getQueryString())}async getBlob(n){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(n)}`,this.getQueryString())}async createBlob(n){return this.restWrapper.post("/git/blobs",n,this.getQueryString())}async getContent(n,a){return this.restWrapper.get(`/contents/${n}`,this.getQueryString({ref:a}))}async getCommits(n,a){return this.restWrapper.get("/commits",this.getQueryString({count:a,sha:n})).catch(async t=>t===400||t===404?[]:Promise.reject(t))}async getCommit(n){return this.restWrapper.get(`/git/commits/${encodeURIComponent(n)}`,this.getQueryString())}async createCommit(n){return this.restWrapper.post("/git/commits",n,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(n){return this.restWrapper.get(`/git/refs/${n}`,this.getQueryString())}async createRef(n){return this.restWrapper.post("/git/refs",n,this.getQueryString())}async updateRef(n,a){return this.restWrapper.patch(`/git/refs/${n}`,a,this.getQueryString())}async deleteRef(n){await this.restWrapper.delete(`/git/refs/${n}`,this.getQueryString())}async createTag(n){return this.restWrapper.post("/git/tags",n,this.getQueryString())}async getTag(n){return this.restWrapper.get(`/git/tags/${n}`,this.getQueryString())}async createTree(n){return this.restWrapper.post("/git/trees",n,this.getQueryString())}async getTree(n,a){return this.restWrapper.get(`/git/trees/${encodeURIComponent(n)}`,this.getQueryString({recursive:a?1:0}))}async createSummary(n,a){return this.restWrapper.post("/git/summaries",n,this.getQueryString(a!==void 0?{initial:a}:void 0))}async deleteSummary(n){const a={"Soft-Delete":n};return this.restWrapper.delete("/git/summaries",this.getQueryString(),a)}async getSummary(n){return this.restWrapper.get(`/git/summaries/${n}`,this.getQueryString())}async getHeaderDirect(n){const a=await this.getTree(n,!0),t=[".attributes",".blobs",".messages","header"],i=[];for(const s of a.tree)if(s.type==="blob"&&_1e(s.path,t)){const o=this.getBlob(s.sha);i.push(o)}return{blobs:await Promise.all(i),tree:a}}getQueryString(n){return this.cacheBust?{cacheBust:Date.now(),...this.defaultQueryString,...n}:{...this.defaultQueryString,...n}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */async function P1e(e,n){const a=new Promise((t,i)=>{const r=setTimeout(()=>{clearTimeout(r),i(new Error(`Timed out in ${e} milliseconds.`))},e)});return Promise.race([n,a])}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var eb;(function(e){e.Method="method",e.Header="header",e.Body="body"})(eb||(eb={}));const E1e=(e,n)=>`${e}: ${n}`;class I1e{translate(n){const a={...n},t=new URLSearchParams;if(t.append(eb.Method,a.method??"GET"),a.headers)for(const[i,r]of Object.entries(a.headers)){const s=E1e(i,r);t.append(eb.Header,s)}if(a.data&&a.method!==void 0&&["post","put","patch"].includes(a.method.toLowerCase())){const i=JSON.stringify(a.data);t.append(eb.Body,i)}return a.data=t.toString(),a.method="POST",a.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},a}}var _D={},YY;function R1e(){return YY||(YY=1,(function(e){(function(n){n(typeof DO_NOT_EXPORT_CRC>"u"?e:{})})(function(n){n.version="1.2.0";function a(){for(var u=0,c=new Array(256),d=0;d!=256;++d)u=d,u=u&1?-306674912^u>>>1:u>>>1,u=u&1?-306674912^u>>>1:u>>>1,u=u&1?-306674912^u>>>1:u>>>1,u=u&1?-306674912^u>>>1:u>>>1,u=u&1?-306674912^u>>>1:u>>>1,u=u&1?-306674912^u>>>1:u>>>1,u=u&1?-306674912^u>>>1:u>>>1,u=u&1?-306674912^u>>>1:u>>>1,c[d]=u;return typeof Int32Array<"u"?new Int32Array(c):c}var t=a();function i(u,c){for(var d=c^-1,l=u.length-1,f=0;f<l;)d=d>>>8^t[(d^u.charCodeAt(f++))&255],d=d>>>8^t[(d^u.charCodeAt(f++))&255];return f===l&&(d=d>>>8^t[(d^u.charCodeAt(f))&255]),d^-1}function r(u,c){if(u.length>1e4)return s(u,c);for(var d=c^-1,l=u.length-3,f=0;f<l;)d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255];for(;f<l+3;)d=d>>>8^t[(d^u[f++])&255];return d^-1}function s(u,c){for(var d=c^-1,l=u.length-7,f=0;f<l;)d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255],d=d>>>8^t[(d^u[f++])&255];for(;f<l+7;)d=d>>>8^t[(d^u[f++])&255];return d^-1}function o(u,c){for(var d=c^-1,l=0,f=u.length,b,C;l<f;)b=u.charCodeAt(l++),b<128?d=d>>>8^t[(d^b)&255]:b<2048?(d=d>>>8^t[(d^(192|b>>6&31))&255],d=d>>>8^t[(d^(128|b&63))&255]):b>=55296&&b<57344?(b=(b&1023)+64,C=u.charCodeAt(l++)&1023,d=d>>>8^t[(d^(240|b>>8&7))&255],d=d>>>8^t[(d^(128|b>>2&63))&255],d=d>>>8^t[(d^(128|C>>6&15|(b&3)<<4))&255],d=d>>>8^t[(d^(128|C&63))&255]):(d=d>>>8^t[(d^(224|b>>12&15))&255],d=d>>>8^t[(d^(128|b>>6&63))&255],d=d>>>8^t[(d^(128|b&63))&255]);return d^-1}n.table=t,n.bstr=i,n.buf=r,n.str=o})})(_D)),_D}var F1e=R1e();/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const j1e="00000000",M1e="clientId",N1e="sequenceNumber",A1e="minimumSequenceNumber",D1e="clientSequenceNumber",k1e="referenceSequenceNumber",x1e="type",q1e="timestamp",L1e="data",B1e=[M1e,N1e,A1e,D1e,k1e,x1e,q1e,L1e];function U1e(e,n){const t=JSON.stringify(e,B1e);return F1e.str(t,parseInt(n,16)).toString(16)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Joe="token:revoke",Qoe="doc:delete",z1e=e=>e.includes(X1.DocRead),V1e=e=>e.includes(X1.DocWrite),H1e=e=>e.includes(X1.SummaryWrite),K1e=e=>e.includes(Joe),$1e=e=>e.includes(Qoe);/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function G1e(e,n,a){const t={minimumSequenceNumber:e,sequenceNumber:n};return[{mode:Fa.File,path:"quorumMembers",type:Ra.Blob,value:{contents:JSON.stringify(a.members),encoding:"utf-8"}},{mode:Fa.File,path:"quorumProposals",type:Ra.Blob,value:{contents:JSON.stringify(a.proposals),encoding:"utf-8"}},{mode:Fa.File,path:"quorumValues",type:Ra.Blob,value:{contents:JSON.stringify(a.values),encoding:"utf-8"}},{mode:Fa.File,path:"attributes",type:Ra.Blob,value:{contents:JSON.stringify(t),encoding:"utf-8"}}]}function W1e(e,n){const a=e.tree.filter(t=>!Q1e(t.path)).map(t=>({mode:t.mode,path:t.path,sha:t.sha,type:t.type}));return a.push({mode:Fa.Directory,path:".protocol",sha:n.sha,type:"tree"}),a}function J1e(e,n){const a=[{mode:Fa.File,path:"deli",type:Ra.Blob,value:{contents:e,encoding:"utf-8"}}];return a.push({mode:Fa.File,path:"scribe",type:Ra.Blob,value:{contents:n,encoding:"utf-8"}}),a}const Q1e=e=>e===".protocol"||e===".logTail"||e===".serviceProtocol";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const KP=(...e)=>e.map(n=>n.replace(/^\//,"").replace(/\/$/,"")).filter(n=>!!n).join("/");function Jq(e,n,a="",t=""){const i={type:"tree",entries:[]},r=Object.keys(n.tree);for(const s of r){const o=n.tree[s];let u,c,d;const l=KP(a===""?t:a,s);switch(o.type){case Wr.Tree:{c=Jq(e,o,l,t),d=o.unreferenced||void 0;break}case Wr.Blob:{c=typeof o.content=="string"?{type:"blob",content:o.content,encoding:"utf-8"}:{type:"blob",content:nI(o.content,"base64"),encoding:"base64"};break}case Wr.Handle:{if(o.embedded)u=o.handle;else{if(!e)throw Error("Parent summary does not exist to reference by handle.");u=KP(e,t,o.handle)}break}case Wr.Attachment:{u=o.id;break}default:ET(o,`Unknown type: ${o.type}`)}const f={path:encodeURIComponent(s),type:Hoe(o)};let b;if(c)yi(u===void 0,173),b={value:c,unreferenced:d,...f};else if(u)b={...f,id:u};else throw new Error(`Invalid tree entry for ${o.type}`);i.entries?.push(b)}return i}function Y1e(e,n){const a={},t={id:e.id,blobs:{},trees:{}};a[""]=t;for(const i of e.entries){const r=i.path.replace(new RegExp(`^${n}/`),""),s=r.lastIndexOf("/"),o=r.slice(0,Math.max(0,s)),u=r.slice(s+1),c=a[o];if(i.type==="tree"){const d={blobs:{},trees:{},unreferenced:i.unreferenced};c.trees[decodeURIComponent(u)]=d,a[r]=d}else if(i.type==="blob")c.blobs[decodeURIComponent(u)]=i.id;else throw new Error("Unknown entry type!!")}return t}function X1e(e,n=".app"){const a=new Map;e.blobs&&e.blobs.forEach(s=>{a.set(s.id,Dq(s.content,s.encoding??"utf-8"))});const t=e.trees?.[0],i=t?.sequenceNumber,r=Y1e(t,n);return{blobs:a,snapshotTree:r,sequenceNumber:i}}function XY(e){return typeof e=="object"&&e!==null&&"value"in e}function Z1e(e){return typeof e=="object"&&e!==null&&"content"in e}function eTe(e){return typeof e=="object"&&e!==null&&"type"in e}function Yoe(e,n){const a={};for(const t of e.entries??[])switch(t.type){case"blob":{yi(XY(t),"Invalid entry type"),yi(Z1e(t.value),"entry value is not an IWholeSummaryBlob");const i=t.value;a[t.path]={type:Wr.Blob,content:i.encoding==="base64"?new Uint8Array(Dq(i.content,"base64")):i.content};break}case"tree":{yi(XY(t),"Invalid entry type"),yi(eTe(t.value),"entry value is not an IWholeSummaryTree");const i=t.value,r=t.unreferenced;a[t.path]=Yoe(i,r);break}default:throw new Error("Unsupported tree type for first summary")}return n?{type:Wr.Tree,tree:a,unreferenced:n}:{type:Wr.Tree,tree:a}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class tTe{constructor(n,a,t){this.manager=n,this.blobsShaCache=a,this.getPreviousFullSnapshot=t}async writeSummaryTree(n,a,t,i,r){const s=await this.getPreviousFullSnapshot(a);return this.writeSummaryTreeCore(n,s??void 0)}async writeSummaryTreeCore(n,a){const t=await Promise.all(Object.keys(n.tree).map(async r=>{const s=n.tree[r],o=await this.writeSummaryTreeObject(s,a);return{mode:l1e(s),path:encodeURIComponent(r),sha:o,type:Hoe(s)}}));if(n.groupId!==void 0){const r=n.groupId,s=await this.writeSummaryBlob(r);t.push({mode:Fa.File,path:encodeURIComponent(".groupId"),sha:s,type:"blob"})}return(await this.manager.createGitTree({tree:t})).sha}async writeSummaryTreeObject(n,a){switch(n.type){case Wr.Blob:return this.writeSummaryBlob(n.content);case Wr.Handle:{if(a===void 0)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(n.handleType,n.handle,a)}case Wr.Tree:return this.writeSummaryTreeCore(n,a);case Wr.Attachment:return n.id;default:ET(n,`Unknown type: ${n.type}`)}}async writeSummaryBlob(n){const{parsedContent:a,encoding:t}=typeof n=="string"?{parsedContent:n,encoding:"utf-8"}:{parsedContent:nI(n,"base64"),encoding:"base64"},i=await _oe(Cl.from(a,t));if(!this.blobsShaCache.has(i)){this.blobsShaCache.set(i,"");const r=await this.manager.createBlob(a,t);yi(i===r.sha,182)}return i}getIdFromPath(n,a,t){const i=a.split("/").map(r=>decodeURIComponent(r));return i[0]===""&&i.shift(),i.length===0?t.id:this.getIdFromPathCore(n,i,t)}getIdFromPathCore(n,a,t){yi(a.length>0,179);const i=a[0];if(a.length===1)switch(n){case Wr.Blob:{const r=t.blobs[i];return yi(!!r,180),r}case Wr.Tree:{const r=t.trees[i]?.id;return yi(!!r,181),r}default:throw Error(`Unexpected handle summary object type: "${n}".`)}return this.getIdFromPathCore(n,a.slice(1),t.trees[i])}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class nTe{constructor(n){this.manager=n}async writeSummaryTree(n,a,t,i=0,r=!1){const s=await this.writeSummaryTreeCore(a,n,t,i,r);if(!s)throw new Error("Failed to write summary tree");return s}async writeSummaryTreeCore(n,a,t,i,r){const o={entries:Jq(n,a,"",t==="channel"?".app":"").entries??[],message:`${t} summary upload`,sequenceNumber:i,type:t};return this.manager.createSummary(o,r).then(u=>u.id)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class rTe{bindAbortController(n,a){a()}async bindAbortControllerAsync(n,a){return a()}getAbortController(){}}const iTe=new rTe,Fk=()=>typeof window<"u"?window:global,sTe=()=>Fk()?.abortControllerContext??iTe,aTe=e=>{Fk()&&(Fk().abortControllerContext=e)};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const oTe=Object.freeze(Object.defineProperty({__proto__:null,BasicRestWrapper:Woe,CallingServiceHeaderName:Pk,CorrelationIdHeaderName:HP,DocDeleteScopeType:Qoe,DriverVersionHeaderName:SCe,GitManager:p1e,Heap:voe,Historian:O1e,get InternalErrorCode(){return Tk},LatestSummaryId:CCe,NetworkError:gi,RestLessClient:I1e,get RestLessFieldNames(){return eb},RestWrapper:Goe,SummaryTreeUploadManager:tTe,TelemetryContextHeaderName:Ok,TokenRevokeScopeType:Joe,WholeSummaryUploadManager:nTe,buildTreePath:KP,canDeleteDoc:$1e,canRead:z1e,canRevokeToken:K1e,canSummarize:H1e,canWrite:V1e,choose:OCe,convertAxiosErrorToNetorkError:fCe,convertFirstSummaryWholeSummaryTreeToSummaryTree:Yoe,convertSortedNumberArrayToRanges:gCe,convertSummaryTreeToWholeSummaryTree:Jq,convertWholeFlatSummaryToSnapshotTreeAndBlobs:X1e,createFluidServiceNetworkError:kg,dedupeSortedArray:vCe,defaultHash:j1e,generateServiceProtocolEntries:J1e,generateToken:pCe,generateUser:wk,getAuthorizationTokenFromCredentials:T1e,getGlobalAbortControllerContext:sTe,getGlobalTimeoutContext:$oe,getNextHash:U1e,getOrCreateRepository:cCe,getQuorumTreeEntries:G1e,getRandomInt:uCe,getRandomName:Soe,isNetworkError:dCe,mergeAppAndProtocolTree:W1e,mergeKArrays:bCe,mergeSortedArrays:yCe,parseToken:w1e,promiseTimeout:P1e,setGlobalAbortControllerContext:aTe,setGlobalTimeoutContext:S1e,setupAxiosInterceptorsForAbortSignals:C1e,throwFluidServiceNetworkError:lCe,validateTokenClaims:hCe,validateTokenClaimsExpiration:mCe},Symbol.toStringTag,{value:"Module"})),Qq=sE(oTe);var Cp={},c_={},ZY;function cTe(){if(ZY)return c_;ZY=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(c_,"__esModule",{value:!0}),c_.MapWithExpiration=void 0;const e=Je();class n extends Map{constructor(t){super(),this.expiryMs=t,this.lastRefreshedTimes=new Map}refresh(t){this.lastRefreshedTimes.set(t,new Date().valueOf())}checkExpiry(t,i=!1){const r=this.lastRefreshedTimes.get(t);if((0,e.assert)(r!==void 0===super.has(t),1292),r===void 0)return;const s=new Date().valueOf()-r>=this.expiryMs;return s&&i&&this.delete(t),s}clearExpiredEntries(){this.forEach(()=>{})}get size(){return this.clearExpiredEntries(),super.size}has(t){return this.checkExpiry(t,!0),super.has(t)}get(t){return this.checkExpiry(t,!0),super.get(t)}set(t,i){return this.refresh(t),super.set(t,i)}delete(t){return this.lastRefreshedTimes.delete(t),super.delete(t)}clear(){this.lastRefreshedTimes.clear(),super.clear()}forEach(t,i){const r=[];super.forEach((s,o,u)=>{this.checkExpiry(o)===!0?r.push(o):t.bind(i)(s,o,u)}),r.forEach(s=>{this.delete(s)})}entries(){return this.clearExpiredEntries(),super.entries()}keys(){return this.clearExpiredEntries(),super.keys()}values(){return this.clearExpiredEntries(),super.values()}[Symbol.iterator](){return this.clearExpiredEntries(),super[Symbol.iterator]()}valueOf(){return this.clearExpiredEntries(),super.valueOf()}}return c_.MapWithExpiration=n,c_}var eX;function Yq(){if(eX)return Cp;eX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Cp,"__esModule",{value:!0}),Cp.NullCache=Cp.InMemoryCache=void 0;const e=cTe();class n{constructor(i){this.cache=i!==void 0?new e.MapWithExpiration(i):new Map}async get(i){return this.cache.get(i)}async put(i,r){this.cache.set(i,r)}}Cp.InMemoryCache=n;class a{async get(i){}async put(i,r){}}return Cp.NullCache=a,Cp}var u_={},_p={},TD={},d_={},Tp={},tX;function uTe(){if(tX)return Tp;tX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Tp,"__esModule",{value:!0}),Tp.pkgVersion=Tp.pkgName=void 0,Tp.pkgName="@fluidframework/driver-base",Tp.pkgVersion="2.60.0",Tp}var nX;function dTe(){if(nX)return d_;nX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(d_,"__esModule",{value:!0}),d_.DocumentDeltaConnection=void 0;const e=hd(),n=Je(),a=on(),t=Kn(),i=Ot(),r=uTe(),s="submit_signals_v2";class o extends i.EventEmitterWithErrorHandling{get hasDetails(){return!!this._details}get disposed(){return(0,n.assert)(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}constructor(c,d,l,f=!1,b){super((C,v)=>{this.addPropsToError(v),l.sendErrorEvent({eventName:"DeltaConnection:EventException",name:String(C)},v)}),this.socket=c,this.documentId=d,this.enableLongPollingDowngrades=f,this.connectionId=b,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.disconnect=C=>{this._disposed||(this.trackLatencyTimeout!==void 0&&(clearTimeout(this.trackLatencyTimeout),this.trackLatencyTimeout=void 0),this._disposed=!0,this.removeTrackedListeners(),this.disconnectCore(C),this.emit("disconnect",C))},this.earlyOpHandler=(C,v)=>{this.queuedMessages.push(...v)},this.earlySignalHandler=C=>{Array.isArray(C)?this.queuedSignals.push(...C):this.queuedSignals.push(C)},this.mc=(0,i.createChildMonitoringContext)({logger:l,namespace:"DeltaConnection"}),this.on("newListener",(C,v)=>{if((0,n.assert)(!this.disposed,522),o.eventsAlwaysForwarded.includes(C)){(0,n.assert)(this.trackedListeners.has(C),581);return}if(!o.eventsToForward.includes(C))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${C}`);if((0,n.assert)(this.listeners(C).length!==0===this.trackedListeners.has(C),523),!this.trackedListeners.has(C))if(C==="pong"){this.trackedListeners.set("pong",()=>{});const m=()=>{const h=Date.now();this.socket.volatile?.emit("ping",()=>{this.emit("pong",Date.now()-h),this.trackLatencyTimeout=setTimeout(()=>{m()},1e3*60)})};m()}else this.addTrackedListener(C,(...m)=>{this.emit(C,...m)})})}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotDisposed(){(0,n.assert)(!this.disposed,524)}get initialMessages(){return this.checkNotDisposed(),(0,n.assert)(this.earlyOpHandlerAttached,142),(0,n.assert)(this.listeners("op").length!==0,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((c,d)=>c.sequenceNumber-d.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotDisposed(),(0,n.assert)(this.listeners("signal").length!==0,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotDisposed(),this.details.initialClients}emitMessages(c,d){this.disposed||this.socket.emit(c,this.clientId,d)}submit(c){this.checkNotDisposed(),this.emitMessages("submitOp",[c])}submitSignal(c,d){if(this.checkNotDisposed(),this.details.supportedFeatures?.submit_signals_v2===!0){const l={content:c};d!==void 0&&(l.targetClientId=d),this.emitMessages("submitSignal",[l])}else{if(d!==void 0)throw new t.UsageError("Sending signals to specific client ids is not supported with this service.");this.emitMessages("submitSignal",[[c]])}}closeSocket(c){this._disposed||this.closeSocketCore(c)}closeSocketCore(c){this.disconnect(c)}dispose(c){if(this.logger.sendTelemetryEvent({eventName:"ClientClosingDeltaConnection",driverVersion:r.pkgVersion,details:JSON.stringify({...this.getConnectionDetailsProps()})}),(0,i.isFluidError)(c)){const d=(0,i.normalizeError)(c,{props:{driverVersion:r.pkgVersion}});this.disconnect(d)}else this.disconnect((0,t.createGenericNetworkError)(c?.message??o.errorMessageForClientDisposeWithoutError,{canRetry:c===void 0},{driverVersion:r.pkgVersion}))}disconnectCore(c){this.socket.disconnect()}async initialize(c,d){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0,c.supportedFeatures={...c.supportedFeatures,[s]:!0};let l=0;const f=()=>this.socket.io.reconnection(),b=()=>f()?this.socket.io.reconnectionAttempts():0,C=()=>b()+1;this._details=await new Promise((v,m)=>{const h=_=>{try{this.closeSocket(_)}catch(S){const p=this.addPropsToError(S);this.logger.sendErrorEvent({eventName:"CloseSocketError"},p)}m(_)},g=_=>{try{this.disconnect(_)}catch(S){const p=this.addPropsToError(S);this.logger.sendErrorEvent({eventName:"FailConnectionError"},p)}m(_)};this.socketConnectionTimeout=setTimeout(()=>{g(this.createErrorObject("orderingServiceHandshakeTimeout"))},d+2e3),this.addConnectionListener("connect_error",_=>{l++;let S=!1;try{const p=_?.description,w=_?.context;if(w&&typeof w=="object"){if(w.statusText?.code==="DEPTH_ZERO_SELF_SIGNED_CERT"){h(this.createErrorObject("connect_error",_,!1));return}}else if(p&&typeof p=="object"){if(p.error?.code==="DEPTH_ZERO_SELF_SIGNED_CERT"){h(this.createErrorObject("connect_error",_,!1));return}_.type==="TransportError"&&(S=!0),p.target=void 0}}catch{}S&&this.enableLongPollingDowngrades&&this.socket.io.opts.transports?.[0]!=="polling"&&(this.socket.io.opts.transports=["polling","websocket"],f()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),!(f()&&l<C())&&h(this.createErrorObject("connect_error",_))}),this.addConnectionListener("connect_timeout",()=>{h(this.createErrorObject("connect_timeout"))}),this.addConnectionListener("connect_document_success",_=>{if(c.nonce!==void 0&&_.nonce!==void 0&&_.nonce!==c.nonce)return;const S=c.mode,p=_.mode;if(_.claims.scopes.includes(a.ScopeType.DocWrite)){if(p!==S){g(this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1));return}}else if(p==="write"){g(this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));return}this.logger.sendTelemetryEvent({eventName:"ConnectDocumentSuccess",pendingClientId:_.clientId},void 0,e.LogLevel.verbose),this.checkpointSequenceNumber=_.checkpointSequenceNumber,this.removeConnectionListeners(),v(_)}),this.addTrackedListener("disconnect",(_,S)=>{h(this.createErrorObjectWithProps("disconnect",_,{socketErrorType:S?.context?.type,socketCode:S?.context?.code}))}),this.addTrackedListener("error",_=>{const S=this.createErrorObject("error",_,_!=="Invalid namespace");h(S)}),this.addConnectionListener("connect_document_error",_=>{c.nonce!==void 0&&_.nonce!==void 0&&_.nonce!==c.nonce||g(this.createErrorObject("connect_document_error",_))}),this.socket.emit("connect_document",c)}),(0,n.assert)(!this.disposed,582)}addPropsToError(c){return(0,i.normalizeError)(c,{props:{details:JSON.stringify({...this.getConnectionDetailsProps()})}})}getConnectionDetailsProps(){return{disposed:this._disposed,socketConnected:this.socket?.connected,clientId:this._details?.clientId,connectionId:this.connectionId}}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(c,d){(0,n.assert)(!o.eventsAlwaysForwarded.includes(c),583),(0,n.assert)(!o.eventsToForward.includes(c),584),this.socket.on(c,d),(0,n.assert)(!this.connectionListeners.has(c),525),this.connectionListeners.set(c,d)}addTrackedListener(c,d){this.socket.on(c,d),(0,n.assert)(!this.trackedListeners.has(c),526),this.trackedListeners.set(c,d)}removeTrackedListeners(){for(const[c,d]of this.trackedListeners.entries())this.socket.off(c,d);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){this.socketConnectionTimeout!==void 0&&clearTimeout(this.socketConnectionTimeout);for(const[c,d]of this.connectionListeners.entries())this.socket.off(c,d);this.connectionListeners.clear()}getErrorMessage(c){return c?.type!=="TransportError"?(0,i.extractLogSafeErrorProperties)(c,!0).message:`${c?.message!==void 0?`${c.message}: `:""}${JSON.stringify(c,(0,i.getCircularReplacer)())}`}createErrorObjectWithProps(c,d,l,f=!0){return(0,t.createGenericNetworkError)(`socket.io (${c}): ${this.getErrorMessage(d)}`,{canRetry:f},{...l,driverVersion:r.pkgVersion,details:JSON.stringify({...this.getConnectionDetailsProps()}),scenarioName:c})}createErrorObject(c,d,l=!0){return(0,t.createGenericNetworkError)(`socket.io (${c}): ${this.getErrorMessage(d)}`,{canRetry:l},this.getAdditionalErrorProps(c))}getAdditionalErrorProps(c){return{driverVersion:r.pkgVersion,details:JSON.stringify({...this.getConnectionDetailsProps()}),scenarioName:c}}}return d_.DocumentDeltaConnection=o,o.eventsToForward=["nack","op","signal","pong"],o.eventsAlwaysForwarded=["disconnect","error"],o.errorMessageForClientDisposeWithoutError="Client closing delta connection",d_}var Hu={},rX;function lTe(){if(rX)return Hu;rX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Hu,"__esModule",{value:!0}),Hu.validateMessages=Hu.promiseRaceWithWinner=Hu.getW3CData=void 0;function e(t,i){let r,s,o,u,c,d,l,f;const b=globalThis.performance.getEntriesByType?.("resource")??[];for(let C=b.length-1;C>0;C--){const v=b[C],m=v.name.toString();if(v.initiatorType.localeCompare(i)===0&&m.includes(t)){s=v.redirectEnd-v.redirectStart,f=v.fetchStart,r=v.domainLookupEnd-v.domainLookupStart,o=v.connectEnd-v.connectStart,u=v.secureConnectionStart>0?v.connectEnd-v.secureConnectionStart:0,c=v.responseStart>0?v.responseEnd-v.responseStart:void 0,d=v.fetchStart>0?v.responseEnd-v.fetchStart:void 0,l=v.requestStart>0?v.responseEnd-v.requestStart:void 0;break}}return{dnsLookupTime:r,w3cStartTime:f,redirectTime:s,tcpHandshakeTime:o,secureConnectionTime:u,responseNetworkTime:c,fetchStartToResponseEndTime:d,reqStartToResponseEndTime:l}}Hu.getW3CData=e;async function n(t){return new Promise((i,r)=>{t.forEach((s,o)=>{s.then(u=>i({index:o,value:u})).catch(r)})})}Hu.promiseRaceWithWinner=n;function a(t,i,r,s,o=!0){if(i.length!==0){const u=i[0].sequenceNumber,c=i.length,d=i[c-1].sequenceNumber;if(d+1!==r+c){if(o||r!==u)i.length=0;else{let l=1;for(;l<i.length&&i[l].sequenceNumber===i[l-1].sequenceNumber+1;)l++;i.length=l}s.sendErrorEvent({eventName:"OpsFetchViolation",reason:t,from:r,start:u,last:d,length:c,details:JSON.stringify({validLength:i.length,lastValidOpSeqNumber:i.length>0?i[i.length-1].sequenceNumber:void 0,strict:o})})}}}return Hu.validateMessages=a,Hu}var iX;function uI(){return iX||(iX=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.validateMessages=e.promiseRaceWithWinner=e.getW3CData=e.DocumentDeltaConnection=void 0;var n=dTe();Object.defineProperty(e,"DocumentDeltaConnection",{enumerable:!0,get:function(){return n.DocumentDeltaConnection}});var a=lTe();Object.defineProperty(e,"getW3CData",{enumerable:!0,get:function(){return a.getW3CData}}),Object.defineProperty(e,"promiseRaceWithWinner",{enumerable:!0,get:function(){return a.promiseRaceWithWinner}}),Object.defineProperty(e,"validateMessages",{enumerable:!0,get:function(){return a.validateMessages}})})(TD)),TD}var sX;function fTe(){if(sX)return _p;sX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(_p,"__esModule",{value:!0}),_p.DeltaStorageService=_p.DocumentDeltaStorageService=void 0;const e=uI(),n=Kn(),a=Ot(),t=2e3;class i{constructor(o,u,c,d,l){this.tenantId=o,this.id=u,this.deltaStorageService=c,this.documentStorageService=d,this.logger=l,this.logtailSha=d.logTailSha}fetchMessages(o,u,c,d,l){if(d)return n.emptyMessageStream;let f=0,b=0;const C=async(m,h,g)=>{if(this.snapshotOps=this.logtailSha?await(0,n.readAndParse)(this.documentStorageService,this.logtailSha):[],this.logtailSha=void 0,this.snapshotOps!==void 0&&this.snapshotOps.length!==0){const S=this.snapshotOps.filter(p=>p.sequenceNumber>=m&&p.sequenceNumber<h);if((0,e.validateMessages)("snapshotOps",S,m,this.logger,!1),S.length>0&&S[0].sequenceNumber===m)return this.snapshotOps=this.snapshotOps.filter(p=>p.sequenceNumber>=h),f+=S.length,{messages:S,partialResult:!0};this.snapshotOps=void 0}const _=await this.deltaStorageService.get(this.tenantId,this.id,m,h,l);return(0,e.validateMessages)("storage",_.messages,m,this.logger,!1),b+=_.messages.length,_},v=(0,n.requestOps)(async(m,h,g)=>{const _=await C(m,h);return(0,e.validateMessages)("catch all",_.messages,m,this.logger),_},1,o,u,t,this.logger,c,l);return(0,n.streamObserver)(v,m=>{m.done&&f+b!==0&&this.logger.sendPerformanceEvent({eventName:"CacheOpsRetrieved",opsFromSnapshot:f,opsFromStorage:b})})}}_p.DocumentDeltaStorageService=i;class r{constructor(o,u,c,d=async()=>this.restWrapper,l=()=>this.url){this.url=o,this.restWrapper=u,this.logger=c,this.getRestWrapper=d,this.getDeltaStorageUrl=l}async get(o,u,c,d,l){return{messages:await a.PerformanceEvent.timedExecAsync(this.logger,{eventName:"OpsFetch",from:c,to:d},async b=>{const C=await this.getRestWrapper(),v=this.getDeltaStorageUrl(),m=await C.get(v,{from:c-1,to:d,fetchReason:l??""});return b.end({length:m.content.length,details:JSON.stringify({firstOpSeqNumber:m.content[0]?.sequenceNumber,lastOpSeqNumber:m.content[m.content.length-1]?.sequenceNumber}),...m.propsToLog,...(0,e.getW3CData)(m.requestUrl,"xmlhttprequest")}),m.content}),partialResult:!1}}}return _p.DeltaStorageService=r,_p}var l_={},aX;function hTe(){if(aX)return l_;aX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(l_,"__esModule",{value:!0}),l_.R11sDocumentDeltaConnection=void 0;const e=uI(),n=tI(),a=gb(),t=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class i extends e.DocumentDeltaConnection{static async create(s,o,u,c,d,l,f,b=2e4,C=!0){const v=c(l,{query:{documentId:o,tenantId:s},reconnection:!1,transports:["websocket"],timeout:b}),m={client:d,id:o,mode:d.mode,tenantId:s,token:u,versions:t,relayUserAgent:[d.details.environment,` driverVersion:${a.pkgVersion}`].join(";")},h=new i(v,o,f,l,C);return await h.initialize(m,b),h}constructor(s,o,u,c,d){super(s,o,u,d),this.url=c}createErrorObject(s,o,u=!0){return u&&Number.isInteger(o?.code)&&typeof o?.message=="string"?(0,n.errorObjectFromSocketError)(o,s,this.getAdditionalErrorProps(s)):super.createErrorObject(s,o,u)}getAdditionalErrorProps(s){return{...super.getAdditionalErrorProps(s),url:(0,n.getUrlForTelemetry)(this.url,n.socketIoPath)}}disconnectCore(s){this.socket.connected&&s.message!==e.DocumentDeltaConnection.errorMessageForClientDisposeWithoutError&&this.socket.emit("client_disconnect",this.clientId,this.documentId,s.message),super.disconnectCore(s)}}return l_.R11sDocumentDeltaConnection=i,l_}var f_={},h_={},m_={},oX;function mTe(){if(oX)return m_;oX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(m_,"__esModule",{value:!0}),m_.RetriableGitManager=void 0;const e=Kn();class n{constructor(t,i){this.internalGitManager=t,this.logger=i}async getCommits(t,i){return this.runWithRetry(async()=>this.internalGitManager.getCommits(t,i),"gitManager_getCommits")}async getTree(t,i){return this.runWithRetry(async()=>this.internalGitManager.getTree(t,i),"gitManager_getTree")}async getBlob(t){return this.runWithRetry(async()=>this.internalGitManager.getBlob(t),"gitManager_getBlob")}async createBlob(t,i){return this.runWithRetry(async()=>this.internalGitManager.createBlob(t,i),"gitManager_createBlob")}async createGitTree(t){return this.runWithRetry(async()=>this.internalGitManager.createGitTree(t),"gitManager_createGitTree")}async createSummary(t){return this.runWithRetry(async()=>this.internalGitManager.createSummary(t),"gitManager_createSummary")}async getSnapshot(t){return this.runWithRetry(async()=>this.internalGitManager.getSnapshot(t),"gitManager_getSummary")}async runWithRetry(t,i){return(0,e.runWithRetry)(t,i,this.logger,{})}}return m_.RetriableGitManager=n,m_}var p_={},cX;function pTe(){if(cX)return p_;cX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(p_,"__esModule",{value:!0}),p_.SummaryTreeUploadManager=void 0;const e=Ht(),n=Je(),a=on(),t=Kn();class i{constructor(s,o,u){this.manager=s,this.blobsShaCache=o,this.getPreviousFullSnapshot=u}async writeSummaryTree(s,o,u,c,d){const l=await this.getPreviousFullSnapshot(o);return this.writeSummaryTreeCore(s,l??void 0)}async writeSummaryTreeCore(s,o){const u=await Promise.all(Object.entries(s.tree).map(async([d,l])=>{const f=await this.writeSummaryTreeObject(l,o);return{mode:(0,t.getGitMode)(l),path:encodeURIComponent(d),sha:f,type:(0,t.getGitType)(l)}}));return(await this.manager.createGitTree({tree:u})).content.sha}async writeSummaryTreeObject(s,o){switch(s.type){case a.SummaryType.Blob:return this.writeSummaryBlob(s.content);case a.SummaryType.Handle:{if(o===void 0)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(s.handleType,s.handle,o)}case a.SummaryType.Tree:return this.writeSummaryTreeCore(s,o);case a.SummaryType.Attachment:return s.id;default:(0,n.unreachableCase)(s,`Unknown type: ${s.type}`)}}async writeSummaryBlob(s){const{parsedContent:o,encoding:u}=typeof s=="string"?{parsedContent:s,encoding:"utf-8"}:{parsedContent:(0,e.Uint8ArrayToString)(s,"base64"),encoding:"base64"},c=await(0,e.gitHashFile)(e.IsoBuffer.from(o,u));if(!this.blobsShaCache.has(c)){this.blobsShaCache.set(c,"");const d=(await this.manager.createBlob(o,u)).content;(0,n.assert)(c===d.sha,182)}return c}getIdFromPath(s,o,u){const c=o.split("/").map(d=>decodeURIComponent(d));return c[0]===""&&c.shift(),c.length===0?u.id:this.getIdFromPathCore(s,c,u)}getIdFromPathCore(s,o,u){(0,n.assert)(o.length>0,179);const c=o[0];if(o.length===1)switch(s){case a.SummaryType.Blob:{const d=u.blobs[c];return(0,n.assert)(!!d,180),d}case a.SummaryType.Tree:{const d=u.trees[c]?.id;return(0,n.assert)(!!d,181),d}default:throw Error(`Unexpected handle summary object type: "${s}".`)}return this.getIdFromPathCore(s,o.slice(1),u.trees[c])}}return p_.SummaryTreeUploadManager=i,p_}var uX;function gTe(){if(uX)return h_;uX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(h_,"__esModule",{value:!0}),h_.ShreddedSummaryDocumentStorageService=void 0;const e=Ht(),n=Kn(),a=Ot(),t=Yq(),i=mTe(),r=pTe(),s=typeof window>"u";class o{async getSummaryUploadManager(){const c=await this.getStorageManager();return new r.SummaryTreeUploadManager(new i.RetriableGitManager(c,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}constructor(c,d,l,f,b,C,v,m=async()=>this.manager){this.id=c,this.manager=d,this.logger=l,this.policies=f,this.getStorageManager=m,this.blobsShaCache=new Map,(b?.enableRestLess===!0||s)&&(this.blobCache=C??new t.InMemoryCache,this.snapshotTreeCache=v??new t.InMemoryCache),this.mc=(0,a.createChildMonitoringContext)({logger:l})}async getVersions(c,d){const l=c||this.id;return(await a.PerformanceEvent.timedExecAsync(this.logger,{eventName:"getVersions",versionId:l,count:d},async()=>(await(await this.getStorageManager()).getCommits(l,d)).content)).map(b=>({date:b.commit.author.date,id:b.sha,treeId:b.commit.tree.sha}))}async getSnapshotTree(c){let d=c;if(!d){const C=await this.getVersions(this.id,1);if(C.length===0)return null;d=C[0]}const l=await this.snapshotTreeCache?.get(this.getCacheKey(d.treeId));if(l)return l.snapshotTree;const f=await a.PerformanceEvent.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:d.treeId},async C=>{const m=(await(await this.getStorageManager()).getTree(d.treeId)).content;return C.end({size:m.tree.length}),m}),b=(0,n.buildGitTreeHierarchy)(f,this.blobsShaCache,!0);return await this.snapshotTreeCache?.put(this.getCacheKey(b.id),{id:d.id,snapshotTree:b}),b}async readBlob(c){const d=await this.blobCache?.get(this.getCacheKey(c));if(d)return d;const l=await a.PerformanceEvent.timedExecAsync(this.logger,{eventName:"readBlob",blobId:c},async b=>{const v=(await(await this.getStorageManager()).getBlob(c)).content;return b.end({size:v.size}),v},void 0,this.mc.config.getNumber("Fluid.Driver.ReadBlobTelemetrySampling"));this.blobsShaCache.set(l.sha,"");const f=(0,e.stringToBuffer)(l.content,l.encoding);return await this.blobCache?.put(this.getCacheKey(l.sha),f),f}async uploadSummaryWithContext(c,d){return await a.PerformanceEvent.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext",proposalHandle:d.proposalHandle,ackHandle:d.ackHandle,referenceSequenceNumber:d.referenceSequenceNumber},async()=>(await this.getSummaryUploadManager()).writeSummaryTree(c,d.ackHandle??"","channel"))}async downloadSummary(c){throw new Error("NOT IMPLEMENTED!")}async createBlob(c){const d=new Uint8Array(c);return a.PerformanceEvent.timedExecAsync(this.logger,{eventName:"createBlob",size:d.length},async l=>{const b=await(await this.getStorageManager()).createBlob((0,e.Uint8ArrayToString)(d,"base64"),"base64").then(C=>({id:C.content.sha,url:C.content.url}));return l.end({blobId:b.id}),b})}async getPreviousFullSnapshot(c){return c?this.getVersions(c,1).then(async d=>(this.blobsShaCache.clear(),this.getSnapshotTree(d[0]))):void 0}getCacheKey(c){return`${this.id}:${c}`}}return h_.ShreddedSummaryDocumentStorageService=o,h_}var g_={},y_={},dX;function yTe(){if(dX)return y_;dX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(y_,"__esModule",{value:!0}),y_.convertWholeFlatSnapshotToSnapshotTreeAndBlobs=void 0;const e=Ht();function n(t,i){const r={},s={id:t.id,blobs:{},trees:{}};r[""]=s;for(const o of t.entries){const u=o.path.replace(new RegExp(`^${i}/`),""),c=u.lastIndexOf("/"),d=u.slice(0,Math.max(0,c)),l=u.slice(c+1),f=r[d];if(o.type==="tree"){const b={blobs:{},trees:{},unreferenced:o.unreferenced,groupId:o.groupId};f.trees[decodeURIComponent(l)]=b,r[u]=b}else if(o.type==="blob")f.blobs[decodeURIComponent(l)]=o.id;else throw new Error("Unknown entry type!!")}return s}function a(t,i=".app"){const r=new Map;t.blobs&&t.blobs.forEach(c=>{r.set(c.id,(0,e.stringToBuffer)(c.content,c.encoding??"utf-8"))});const s=t.trees?.[0],o=s?.sequenceNumber,u=n(s,i);return{blobs:r,snapshotTree:u,sequenceNumber:o,id:t.id}}return y_.convertWholeFlatSnapshotToSnapshotTreeAndBlobs=a,y_}var Mo={},lX;function bTe(){if(lX)return Mo;lX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Mo,"__esModule",{value:!0}),Mo.validateBlobsAndTrees=Mo.evalBlobsAndTrees=Mo.convertSnapshotAndBlobsToSummaryTree=Mo.SummaryTreeAssembler=void 0;const e=Ht(),n=Je(),a=on();class t{constructor(c){this.props=c,this.attachmentCounter=0,this.summaryTree={}}get summary(){return{type:a.SummaryType.Tree,tree:{...this.summaryTree},unreferenced:this.props?.unreferenced,groupId:this.props?.groupId}}addBlob(c,d){this.summaryTree[c]={type:a.SummaryType.Blob,content:d}}addHandle(c,d,l){this.summaryTree[c]={type:a.SummaryType.Handle,handleType:d,handle:l}}addTree(c,d){this.summaryTree[c]=d}addAttachment(c){this.summaryTree[this.attachmentCounter++]={id:c,type:a.SummaryType.Attachment}}}Mo.SummaryTreeAssembler=t;function i(u,c){const d=new t({unreferenced:u.unreferenced,groupId:u.groupId});for(const[l,f]of Object.entries(u.blobs)){const b=c.get(f);(0,n.assert)(b!==void 0,733),d.addBlob(l,e.IsoBuffer.from(b).toString("utf-8"))}for(const[l,f]of Object.entries(u.trees)){const b=i(f,c);d.addTree(l,b)}return d.summary}Mo.convertSnapshotAndBlobsToSummaryTree=i;function r(u){const c=o(u.snapshotTree),d=u.blobs.size;let l=0;for(const[f,b]of u.blobs)l+=b.byteLength;return{trees:c,numBlobs:d,encodedBlobsSize:l}}Mo.evalBlobsAndTrees=r;function s(u){(0,n.assert)(u.trees!==void 0,1488),(0,n.assert)(u.blobs!==void 0,1489)}Mo.validateBlobsAndTrees=s;function o(u){let c=0;for(const[d,l]of Object.entries(u.trees))c+=1+o(l);return c}return Mo}var b_={},fX;function vTe(){if(fX)return b_;fX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(b_,"__esModule",{value:!0}),b_.WholeSummaryUploadManager=void 0;const e=Qq;class n{constructor(t){this.manager=t}async writeSummaryTree(t,i,r,s=0,o=!1){const u=await this.writeSummaryTreeCore(i,t,r,s,o);if(!u)throw new Error("Failed to write summary tree");return u}async writeSummaryTreeCore(t,i,r,s,o){const c={entries:(0,e.convertSummaryTreeToWholeSummaryTree)(t,i,"",r==="channel"?".app":"").entries??[],message:"",sequenceNumber:s,type:r};return this.manager.createSummary(c,o).then(d=>d.content.id)}}return b_.WholeSummaryUploadManager=n,b_}var hX;function STe(){if(hX)return g_;hX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(g_,"__esModule",{value:!0}),g_.WholeSummaryDocumentStorageService=void 0;const e=Ht(),n=Je(),a=uI(),t=Ot(),i=Yq(),r=yTe(),s=bTe(),o=vTe(),u="latest";class c{async getSummaryUploadManager(){const l=await this.getStorageManager();return new o.WholeSummaryUploadManager(l)}constructor(l,f,b,C,v,m=new i.InMemoryCache,h=new i.InMemoryCache,g,_=async S=>S&&this.noCacheGitManager!==void 0?this.noCacheGitManager:this.manager){this.id=l,this.manager=f,this.logger=b,this.policies=C,this.driverPolicies=v,this.blobCache=m,this.snapshotTreeCache=h,this.noCacheGitManager=g,this.getStorageManager=_,this.firstVersionsCall=!0,this.mc=(0,t.createChildMonitoringContext)({logger:b})}async getVersions(l,f){if(l!==this.id&&l!==null)return[{id:l,treeId:void 0}];if(this.firstVersionsCall&&f===1){const v=await t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"ObtainSnapshot",versionId:l??void 0,count:f,enableDiscovery:this.driverPolicies?.enableDiscovery},async h=>{let g;const _=this.snapshotTreeCache.get(this.getCacheKey(u)),S=this.driverPolicies?.enableDiscovery?this.fetchSnapshotTree(u,!0,"getVersions"):this.fetchSnapshotTree(u,!1,"getVersions"),p=await(0,a.promiseRaceWithWinner)([_.catch(()=>{}),S.catch(()=>{})]);let w=p.value;return g=p.index===0?"cache":"network",w===void 0&&(p.index===1&&(w=await _,g="cache"),w===void 0&&(w=await S,g="network")),h.end({method:g}),w}),m=await this.initializeFromSnapshot(v);return this.firstVersionsCall=!1,[{id:m,treeId:v.snapshotTree.id}]}const b=l||this.id;return(await t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"getVersions",versionId:b,count:f},async()=>(await(await this.getStorageManager()).getCommits(b,f)).content)).map(v=>({date:v.commit.author.date,id:v.sha,treeId:v.commit.tree.sha}))}async getSnapshotTree(l){let f=l;if(!f){const C=await this.getVersions(this.id,1);if(C.length===0)return null;f=C[0]}let b=await this.snapshotTreeCache.get(this.getCacheKey(f.id));return b!==void 0||(b=await this.fetchSnapshotTree(f.id,void 0,"getSnapshotTree"),await this.updateBlobsCache(b.blobs)),b.snapshotTree}async readBlob(l){const f=await this.blobCache.get(this.getCacheKey(l));if(f!==void 0)return f;const b=await t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"readBlob",blobId:l},async v=>{const h=(await(await this.getStorageManager()).getBlob(l)).content;return v.end({size:h.size}),h},void 0,this.mc.config.getNumber("Fluid.Driver.ReadBlobTelemetrySampling")),C=(0,e.stringToBuffer)(b.content,b.encoding);return await this.blobCache.put(this.getCacheKey(b.sha),C),C}async uploadSummaryWithContext(l,f){return await t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext",proposalHandle:f.proposalHandle,ackHandle:f.ackHandle,referenceSequenceNumber:f.referenceSequenceNumber},async()=>(await this.getSummaryUploadManager()).writeSummaryTree(l,f.ackHandle??"","channel"))}async downloadSummary(l){const f=await t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:l.handle},async v=>{const h=await(await this.getStorageManager()).getSnapshot(l.handle);return v.end({size:h.content.trees[0]?.entries.length}),h.content}),{blobs:b,snapshotTree:C}=(0,r.convertWholeFlatSnapshotToSnapshotTreeAndBlobs)(f,"");return(0,s.convertSnapshotAndBlobsToSummaryTree)(C,b)}async createBlob(l){const f=new Uint8Array(l);return t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"createBlob",size:f.length},async b=>{const v=await(await this.getStorageManager()).createBlob((0,e.Uint8ArrayToString)(f,"base64"),"base64").then(m=>({id:m.content.sha,url:m.content.url}));return b.end({blobId:v.id}),v})}async fetchSnapshotTree(l,f,b){const C=await t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:l,scenarioName:b},async v=>{const h=await(await this.getStorageManager(f)).getSnapshot(l),g=(0,e.performanceNow)(),_=(0,r.convertWholeFlatSnapshotToSnapshotTreeAndBlobs)(h.content),S=(0,e.performanceNow)()-g;(0,s.validateBlobsAndTrees)(_.snapshotTree);const{trees:p,numBlobs:w,encodedBlobsSize:O}=(0,s.evalBlobsAndTrees)(_);return v.end({size:h.content.trees[0]?.entries.length,trees:p,blobs:w,encodedBlobsSize:O,sequenceNumber:_.sequenceNumber,...h.propsToLog,snapshotConversionTime:S,...(0,a.getW3CData)(h.requestUrl,"xmlhttprequest")}),_});return await this.snapshotTreeCache.put(this.getCacheKey(l),C).catch(()=>{}),C}async initializeFromSnapshot(l){const f=l.id;(0,n.assert)(f!==void 0,629);const b=[this.snapshotTreeCache.put(this.getCacheKey(f),l),this.updateBlobsCache(l.blobs)];return await Promise.all(b),f}async updateBlobsCache(l){const f=[];l.forEach((b,C)=>{const v=this.getCacheKey(C);f.push(this.blobCache.put(v,b))}),await Promise.all(f)}getCacheKey(l){return`${this.id}:${l}`}}return g_.WholeSummaryDocumentStorageService=c,g_}var mX;function CTe(){if(mX)return f_;mX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(f_,"__esModule",{value:!0}),f_.DocumentStorageService=void 0;const e=on(),n=Kn(),a=gTe(),t=STe();class i extends n.DocumentStorageServiceProxy{get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(s,o,u,c,d,l,f,b,C,v){const m=d?.enableWholeSummaryUpload?new t.WholeSummaryDocumentStorageService(s,o,u,c,d,l,f,C,v):new a.ShreddedSummaryDocumentStorageService(s,o,u,c,d,l,b,v);return!d?.enableWholeSummaryUpload&&c.caching===e.LoaderCachingPolicy.Prefetch?new n.PrefetchDocumentStorageService(m):m}constructor(s,o,u,c,d,l,f,b,C,v){super(i.loadInternalDocumentStorageService(s,o,u,c,d,l,f,b,C,v)),this.id=s,this.manager=o,this.noCacheGitManager=C,this._logTailSha=void 0}async getSnapshotTree(s){const o=await this.internalStorageService.getSnapshotTree(s);return o!==null&&(this._logTailSha=".logTail"in o.trees?o.trees[".logTail"].blobs.logTail:void 0),o}}return f_.DocumentStorageService=i,f_}var v_={},pX;function _Te(){if(pX)return v_;pX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(v_,"__esModule",{value:!0}),v_.GitManager=void 0;class e{constructor(a){this.historian=a}async getCommits(a,t){return this.historian.getCommits(a,t)}async getTree(a,t=!0){return this.historian.getTree(a,t)}async getBlob(a){return this.historian.getBlob(a)}async createBlob(a,t){const i={content:a,encoding:t};return this.historian.createBlob(i)}async createGitTree(a){return this.historian.createTree(a)}async createSummary(a,t=!1){return this.historian.createSummary(a,t)}async getSnapshot(a){return this.historian.getSnapshot(a)}}return v_.GitManager=e,v_}var wp={},gX;function TTe(){if(gX)return wp;gX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(wp,"__esModule",{value:!0}),wp.Historian=wp.getAuthorizationTokenFromCredentials=void 0;const e=Ht(),n=t=>`Basic ${(0,e.fromUtf8ToBase64)(`${t.user}:${t.password}`)}`;wp.getAuthorizationTokenFromCredentials=n;class a{constructor(i,r,s){this.historianApi=i,this.restWrapper=s,this.defaultQueryString={},r&&this.historianApi?(this.defaultQueryString.disableCache=r,this.cacheBust=!1):this.cacheBust=r}async getBlob(i){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(i)}`,this.getQueryString())}async createBlob(i){return this.restWrapper.post("/git/blobs",i,this.getQueryString())}async getCommits(i,r){return this.restWrapper.get("/commits",this.getQueryString({count:r,sha:i})).catch(async s=>s.statusCode===400||s.statusCode===404?{content:[],headers:new Map,propsToLog:{},requestUrl:""}:Promise.reject(s))}async createTree(i){return this.restWrapper.post("/git/trees",i,this.getQueryString())}async getTree(i,r){return this.restWrapper.get(`/git/trees/${encodeURIComponent(i)}`,this.getQueryString({recursive:r?1:0}))}async createSummary(i,r){return this.restWrapper.post("/git/summaries",i,this.getQueryString(r!==void 0?{initial:r}:void 0))}async getSnapshot(i){return this.restWrapper.get(`/git/summaries/${i}`,this.getQueryString())}getQueryString(i){return this.cacheBust?{cacheBust:Date.now(),...this.defaultQueryString,...i}:{...this.defaultQueryString,...i}}}return wp.Historian=a,wp}var S_={},yX;function wTe(){if(yX)return S_;yX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(S_,"__esModule",{value:!0}),S_.NullBlobStorageService=void 0;class e{async getSnapshotTree(a){return a?Promise.reject(new Error("Invalid operation")):null}async getVersions(a,t){return[]}async uploadSummaryWithContext(a,t){throw new Error("Invalid operation")}async downloadSummary(a){throw new Error("Invalid operation")}async createBlob(a){throw new Error("Null blob storage can not create blob")}async readBlob(a){throw new Error("Null blob storage can not read blob")}}return S_.NullBlobStorageService=e,S_}var Yi={},jP={exports:{}},bX;function OTe(){return bX||(bX=1,(function(e,n){var a=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof ud<"u"&&ud,t=(function(){function r(){this.fetch=!1,this.DOMException=a.DOMException}return r.prototype=a,new r})();(function(r){(function(s){var o=typeof r<"u"&&r||typeof self<"u"&&self||typeof ud<"u"&&ud||{},u={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function c(L){return L&&DataView.prototype.isPrototypeOf(L)}if(u.arrayBuffer)var d=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(L){return L&&d.indexOf(Object.prototype.toString.call(L))>-1};function f(L){if(typeof L!="string"&&(L=String(L)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(L)||L==="")throw new TypeError('Invalid character in header field name: "'+L+'"');return L.toLowerCase()}function b(L){return typeof L!="string"&&(L=String(L)),L}function C(L){var V={next:function(){var G=L.shift();return{done:G===void 0,value:G}}};return u.iterable&&(V[Symbol.iterator]=function(){return V}),V}function v(L){this.map={},L instanceof v?L.forEach(function(V,G){this.append(G,V)},this):Array.isArray(L)?L.forEach(function(V){if(V.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+V.length);this.append(V[0],V[1])},this):L&&Object.getOwnPropertyNames(L).forEach(function(V){this.append(V,L[V])},this)}v.prototype.append=function(L,V){L=f(L),V=b(V);var G=this.map[L];this.map[L]=G?G+", "+V:V},v.prototype.delete=function(L){delete this.map[f(L)]},v.prototype.get=function(L){return L=f(L),this.has(L)?this.map[L]:null},v.prototype.has=function(L){return this.map.hasOwnProperty(f(L))},v.prototype.set=function(L,V){this.map[f(L)]=b(V)},v.prototype.forEach=function(L,V){for(var G in this.map)this.map.hasOwnProperty(G)&&L.call(V,this.map[G],G,this)},v.prototype.keys=function(){var L=[];return this.forEach(function(V,G){L.push(G)}),C(L)},v.prototype.values=function(){var L=[];return this.forEach(function(V){L.push(V)}),C(L)},v.prototype.entries=function(){var L=[];return this.forEach(function(V,G){L.push([G,V])}),C(L)},u.iterable&&(v.prototype[Symbol.iterator]=v.prototype.entries);function m(L){if(!L._noBody){if(L.bodyUsed)return Promise.reject(new TypeError("Already read"));L.bodyUsed=!0}}function h(L){return new Promise(function(V,G){L.onload=function(){V(L.result)},L.onerror=function(){G(L.error)}})}function g(L){var V=new FileReader,G=h(V);return V.readAsArrayBuffer(L),G}function _(L){var V=new FileReader,G=h(V),ee=/charset=([A-Za-z0-9_-]+)/.exec(L.type),se=ee?ee[1]:"utf-8";return V.readAsText(L,se),G}function S(L){for(var V=new Uint8Array(L),G=new Array(V.length),ee=0;ee<V.length;ee++)G[ee]=String.fromCharCode(V[ee]);return G.join("")}function p(L){if(L.slice)return L.slice(0);var V=new Uint8Array(L.byteLength);return V.set(new Uint8Array(L)),V.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(L){this.bodyUsed=this.bodyUsed,this._bodyInit=L,L?typeof L=="string"?this._bodyText=L:u.blob&&Blob.prototype.isPrototypeOf(L)?this._bodyBlob=L:u.formData&&FormData.prototype.isPrototypeOf(L)?this._bodyFormData=L:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(L)?this._bodyText=L.toString():u.arrayBuffer&&u.blob&&c(L)?(this._bodyArrayBuffer=p(L.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(L)||l(L))?this._bodyArrayBuffer=p(L):this._bodyText=L=Object.prototype.toString.call(L):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof L=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(L)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var L=m(this);if(L)return L;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var L=m(this);return L||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(u.blob)return this.blob().then(g);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var L=m(this);if(L)return L;if(this._bodyBlob)return _(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(S(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(R)}),this.json=function(){return this.text().then(JSON.parse)},this}var O=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function E(L){var V=L.toUpperCase();return O.indexOf(V)>-1?V:L}function F(L,V){if(!(this instanceof F))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');V=V||{};var G=V.body;if(L instanceof F){if(L.bodyUsed)throw new TypeError("Already read");this.url=L.url,this.credentials=L.credentials,V.headers||(this.headers=new v(L.headers)),this.method=L.method,this.mode=L.mode,this.signal=L.signal,!G&&L._bodyInit!=null&&(G=L._bodyInit,L.bodyUsed=!0)}else this.url=String(L);if(this.credentials=V.credentials||this.credentials||"same-origin",(V.headers||!this.headers)&&(this.headers=new v(V.headers)),this.method=E(V.method||this.method||"GET"),this.mode=V.mode||this.mode||null,this.signal=V.signal||this.signal||(function(){if("AbortController"in o){var re=new AbortController;return re.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&G)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(G),(this.method==="GET"||this.method==="HEAD")&&(V.cache==="no-store"||V.cache==="no-cache")){var ee=/([?&])_=[^&]*/;if(ee.test(this.url))this.url=this.url.replace(ee,"$1_="+new Date().getTime());else{var se=/\?/;this.url+=(se.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}F.prototype.clone=function(){return new F(this,{body:this._bodyInit})};function R(L){var V=new FormData;return L.trim().split("&").forEach(function(G){if(G){var ee=G.split("="),se=ee.shift().replace(/\+/g," "),re=ee.join("=").replace(/\+/g," ");V.append(decodeURIComponent(se),decodeURIComponent(re))}}),V}function M(L){var V=new v,G=L.replace(/\r?\n[\t ]+/g," ");return G.split("\r").map(function(ee){return ee.indexOf(`
`)===0?ee.substr(1,ee.length):ee}).forEach(function(ee){var se=ee.split(":"),re=se.shift().trim();if(re){var fe=se.join(":").trim();try{V.append(re,fe)}catch(oe){console.warn("Response "+oe.message)}}}),V}w.call(F.prototype);function j(L,V){if(!(this instanceof j))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(V||(V={}),this.type="default",this.status=V.status===void 0?200:V.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=V.statusText===void 0?"":""+V.statusText,this.headers=new v(V.headers),this.url=V.url||"",this._initBody(L)}w.call(j.prototype),j.prototype.clone=function(){return new j(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},j.error=function(){var L=new j(null,{status:200,statusText:""});return L.ok=!1,L.status=0,L.type="error",L};var k=[301,302,303,307,308];j.redirect=function(L,V){if(k.indexOf(V)===-1)throw new RangeError("Invalid status code");return new j(null,{status:V,headers:{location:L}})},s.DOMException=o.DOMException;try{new s.DOMException}catch{s.DOMException=function(V,G){this.message=V,this.name=G;var ee=Error(V);this.stack=ee.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function x(L,V){return new Promise(function(G,ee){var se=new F(L,V);if(se.signal&&se.signal.aborted)return ee(new s.DOMException("Aborted","AbortError"));var re=new XMLHttpRequest;function fe(){re.abort()}re.onload=function(){var de={statusText:re.statusText,headers:M(re.getAllResponseHeaders()||"")};se.url.indexOf("file://")===0&&(re.status<200||re.status>599)?de.status=200:de.status=re.status,de.url="responseURL"in re?re.responseURL:de.headers.get("X-Request-URL");var ge="response"in re?re.response:re.responseText;setTimeout(function(){G(new j(ge,de))},0)},re.onerror=function(){setTimeout(function(){ee(new TypeError("Network request failed"))},0)},re.ontimeout=function(){setTimeout(function(){ee(new TypeError("Network request timed out"))},0)},re.onabort=function(){setTimeout(function(){ee(new s.DOMException("Aborted","AbortError"))},0)};function oe(de){try{return de===""&&o.location.href?o.location.href:de}catch{return de}}if(re.open(se.method,oe(se.url),!0),se.credentials==="include"?re.withCredentials=!0:se.credentials==="omit"&&(re.withCredentials=!1),"responseType"in re&&(u.blob?re.responseType="blob":u.arrayBuffer&&(re.responseType="arraybuffer")),V&&typeof V.headers=="object"&&!(V.headers instanceof v||o.Headers&&V.headers instanceof o.Headers)){var pe=[];Object.getOwnPropertyNames(V.headers).forEach(function(de){pe.push(f(de)),re.setRequestHeader(de,b(V.headers[de]))}),se.headers.forEach(function(de,ge){pe.indexOf(ge)===-1&&re.setRequestHeader(ge,de)})}else se.headers.forEach(function(de,ge){re.setRequestHeader(ge,de)});se.signal&&(se.signal.addEventListener("abort",fe),re.onreadystatechange=function(){re.readyState===4&&se.signal.removeEventListener("abort",fe)}),re.send(typeof se._bodyInit>"u"?null:se._bodyInit)})}return x.polyfill=!0,o.fetch||(o.fetch=x,o.Headers=v,o.Request=F,o.Response=j),s.Headers=v,s.Request=F,s.Response=j,s.fetch=x,Object.defineProperty(s,"__esModule",{value:!0}),s})({})})(t),t.fetch.ponyfill=!0,delete t.fetch.polyfill;var i=a.fetch?a:t;n=i.fetch,n.default=i.fetch,n.fetch=i.fetch,n.Headers=i.Headers,n.Request=i.Request,n.Response=i.Response,e.exports=n})(jP,jP.exports)),jP.exports}var C_={},vX;function PTe(){if(vX)return C_;vX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(C_,"__esModule",{value:!0}),C_.addOrUpdateQueryParams=void 0;function e(n,a){const t=new URL(n),i=t.searchParams;for(const[r,s]of Object.entries(a))i.set(r,encodeURIComponent(s));return t.search=i.toString(),t}return C_.addOrUpdateQueryParams=e,C_}var __={},SX;function ETe(){if(SX)return __;SX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(__,"__esModule",{value:!0}),__.RestWrapper=void 0;class e{constructor(a,t={},i=1e3*1024*1024,r=1e3*1024*1024){this.baseurl=a,this.defaultQueryString=t,this.maxBodyLength=i,this.maxContentLength=r}async get(a,t,i,r){const s={...r,baseURL:this.baseurl,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:a,params:{...this.defaultQueryString,...t}};return this.request(s,200)}async post(a,t,i,r,s){const o={...s,baseURL:this.baseurl,data:t,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:a,params:{...this.defaultQueryString,...i}};return this.request(o,201)}async delete(a,t,i,r){const s={...r,baseURL:this.baseurl,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:a,params:{...this.defaultQueryString,...t}};return this.request(s,204)}async patch(a,t,i,r,s){const o={...s,baseURL:this.baseurl,data:t,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:a,params:{...this.defaultQueryString,...i}};return this.request(o,200)}}return __.RestWrapper=e,__}var CX;function Xoe(){if(CX)return Yi;CX=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Yi&&Yi.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.toInstrumentedR11sStorageTokenFetcher=Yi.toInstrumentedR11sOrdererTokenFetcher=Yi.RouterliciousOrdererRestWrapper=Yi.RouterliciousStorageRestWrapper=Yi.getPropsToLogFromResponse=Yi.createR11sResponseFromContent=void 0;const n=Ht(),a=Je(),t=Kn(),i=Qq,r=Ot(),s=e(OTe()),o=e(Koe()),u=tI(),c=gb(),d=PTe(),l=ETe(),f=w=>w.baseURL!==void 0?`${w.baseURL??""}${w.url??""}`:w.url??"",b=w=>({method:w.method,headers:w.headers,body:w.data});function C(w){return{content:w,headers:new Map,propsToLog:{},requestUrl:""}}Yi.createR11sResponseFromContent=C;function v(w){const O=new Map;for(const[E,F]of w.entries())O.set(E,F);return O}function m(w){const O=[{headerName:i.CorrelationIdHeaderName,logName:"requestCorrelationId"},{headerName:"content-encoding",logName:"contentEncoding"},{headerName:"content-type",logName:"contentType"}],E={contentsize:(0,r.numberFromString)(w.get("content-length"))};return O.forEach(F=>{const R=w.get(F.headerName);R!=null&&(E[F.logName]=R)}),E}Yi.getPropsToLogFromResponse=m;class h extends l.RestWrapper{constructor(O,E,F,R,M,j,k,x={}){super(j,x),this.rateLimiter=E,this.fetchRefreshedToken=F,this.getAuthorizationHeader=R,this.useRestLess=M,this.tokenP=k,this.restLess=new i.RestLessClient,this.retryCounter=new Map}async request(O,E,F=!0){O.params&&delete O.params.retry;let R=(0,d.addOrUpdateQueryParams)(f(O),O.params);const M=`${O.method??""}|${R.href}`,j=this.retryCounter.get(M);j&&(R=(0,d.addOrUpdateQueryParams)(R,{retry:j}));const k={...O,headers:await this.generateHeaders(O.headers)},x=this.useRestLess?this.restLess.translate(k):k,L=b(x),V=await this.rateLimiter.schedule(async()=>{const Ce=(0,n.performanceNow)();return{response:await(0,s.default)(R,L).catch(async We=>{this.retryCounter.set(M,j?j+1:1);const Ze={driverVersion:c.pkgVersion,retryCount:j,url:(0,u.getUrlForTelemetry)(R.hostname,R.pathname),requestMethod:L.method},ut=["TypeError","FetchError"].includes(We?.name)?`NetworkError: ${We.message}`:(0,o.default)(We);throw ut.includes("failed, reason: self signed certificate")?new t.NonRetryableError(ut,u.RouterliciousErrorTypes.sslCertError,Ze):new t.GenericNetworkError(ut,ut.startsWith("NetworkError"),Ze)}),duration:(0,n.performanceNow)()-Ce}}),G=V.response,ee=v(G.headers);let se=(0,n.performanceNow)();const re=await G.text(),fe=(0,n.performanceNow)()-se,oe=re.length;se=(0,n.performanceNow)();const pe=G.headers.get("content-type")?.includes("application/json")?JSON.parse(re):re,de=(0,n.performanceNow)()-se;if(G.ok||G.status===E)return this.retryCounter.delete(M),{content:pe,headers:ee,requestUrl:R.href,propsToLog:{...m(ee),bodySize:oe,receiveContentTime:fe,parseTime:de,fetchTime:V.duration}};if(this.retryCounter.set(M,j?j+1:1),G.status===401&&F)return this.token=await this.fetchRefreshedToken(!0),this.request({...k},E,!1);if(G.status===429&&pe?.retryAfter>0)return new Promise((Ce,Fe)=>setTimeout(()=>{this.request({...k},E).then(Ce).catch(Fe)},pe.retryAfter*1e3));const ge=pe!==void 0?typeof pe=="string"?pe:(0,o.default)(pe):G.statusText;(0,u.throwR11sNetworkError)(`R11s fetch error: ${ge}`,G.status,pe?.retryAfter,{...m(ee),driverVersion:c.pkgVersion,url:(0,u.getUrlForTelemetry)(R.hostname,R.pathname),requestMethod:L.method})}async generateHeaders(O){const E=await this.getToken();return(0,a.assert)(E!==void 0,1657),{...O,[i.DriverVersionHeaderName]:c.pkgVersion,Authorization:this.getAuthorizationHeader(E)}}async getToken(){if(this.token!==void 0)return this.token;const O=await(this.tokenP??this.fetchRefreshedToken());return this.setToken(O),this.tokenP=void 0,O}setToken(O){this.token=O}}class g extends h{constructor(O,E,F,R,M,j,k,x={}){super(O,E,F,R,M,j,k,x)}static load(O,E,F,R,M,j,k){const x={},L=G=>{const ee={password:G.jwt,user:O};return(0,i.getAuthorizationTokenFromCredentials)(ee)};return new g(F,R,E,L,M,j,k,x)}}Yi.RouterliciousStorageRestWrapper=g;class _ extends h{constructor(O,E,F,R,M,j,k,x={}){super(O,E,F,R,M,j,k,x)}static load(O,E,F,R,M,j){const k=L=>`Basic ${L.jwt}`;return new _(E,F,O,k,R,M,j)}}Yi.RouterliciousOrdererRestWrapper=_;function S(w,O,E,F){return async M=>r.PerformanceEvent.timedExecAsync(F,{eventName:"FetchOrdererToken",docId:O},async()=>await E.fetchOrdererToken(w,O,M))}Yi.toInstrumentedR11sOrdererTokenFetcher=S;function p(w,O,E,F){return async M=>r.PerformanceEvent.timedExecAsync(F,{eventName:"FetchStorageToken",docId:O},async()=>await E.fetchStorageToken(w,O,M))}return Yi.toInstrumentedR11sStorageTokenFetcher=p,Yi}var T_={},H1={exports:{}},Op={},wD={},Pp={},w_={},Ku={},$u={},OD={},Jy={},Gu={},_X;function Xq(){if(_X)return Gu;_X=1,Object.defineProperty(Gu,"__esModule",{value:!0}),Gu.ERROR_PACKET=Gu.PACKET_TYPES_REVERSE=Gu.PACKET_TYPES=void 0;const e=Object.create(null);Gu.PACKET_TYPES=e,e.open="0",e.close="1",e.ping="2",e.pong="3",e.message="4",e.upgrade="5",e.noop="6";const n=Object.create(null);Gu.PACKET_TYPES_REVERSE=n,Object.keys(e).forEach(t=>{n[e[t]]=t});const a={type:"error",data:"parser error"};return Gu.ERROR_PACKET=a,Gu}var TX;function ITe(){if(TX)return Jy;TX=1,Object.defineProperty(Jy,"__esModule",{value:!0}),Jy.encodePacket=void 0,Jy.encodePacketToBinary=u;const e=Xq(),n=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",a=typeof ArrayBuffer=="function",t=c=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(c):c&&c.buffer instanceof ArrayBuffer,i=({type:c,data:d},l,f)=>n&&d instanceof Blob?l?f(d):r(d,f):a&&(d instanceof ArrayBuffer||t(d))?l?f(d):r(new Blob([d]),f):f(e.PACKET_TYPES[c]+(d||""));Jy.encodePacket=i;const r=(c,d)=>{const l=new FileReader;return l.onload=function(){const f=l.result.split(",")[1];d("b"+(f||""))},l.readAsDataURL(c)};function s(c){return c instanceof Uint8Array?c:c instanceof ArrayBuffer?new Uint8Array(c):new Uint8Array(c.buffer,c.byteOffset,c.byteLength)}let o;function u(c,d){if(n&&c.data instanceof Blob)return c.data.arrayBuffer().then(s).then(d);if(a&&(c.data instanceof ArrayBuffer||t(c.data)))return d(s(c.data));i(c,!1,l=>{o||(o=new TextEncoder),d(o.encode(l))})}return Jy}var O_={},Ep={},wX;function RTe(){if(wX)return Ep;wX=1,Object.defineProperty(Ep,"__esModule",{value:!0}),Ep.decode=Ep.encode=void 0;const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<e.length;i++)n[e.charCodeAt(i)]=i;const a=i=>{let r=new Uint8Array(i),s,o=r.length,u="";for(s=0;s<o;s+=3)u+=e[r[s]>>2],u+=e[(r[s]&3)<<4|r[s+1]>>4],u+=e[(r[s+1]&15)<<2|r[s+2]>>6],u+=e[r[s+2]&63];return o%3===2?u=u.substring(0,u.length-1)+"=":o%3===1&&(u=u.substring(0,u.length-2)+"=="),u};Ep.encode=a;const t=i=>{let r=i.length*.75,s=i.length,o,u=0,c,d,l,f;i[i.length-1]==="="&&(r--,i[i.length-2]==="="&&r--);const b=new ArrayBuffer(r),C=new Uint8Array(b);for(o=0;o<s;o+=4)c=n[i.charCodeAt(o)],d=n[i.charCodeAt(o+1)],l=n[i.charCodeAt(o+2)],f=n[i.charCodeAt(o+3)],C[u++]=c<<2|d>>4,C[u++]=(d&15)<<4|l>>2,C[u++]=(l&3)<<6|f&63;return b};return Ep.decode=t,Ep}var OX;function FTe(){if(OX)return O_;OX=1,Object.defineProperty(O_,"__esModule",{value:!0}),O_.decodePacket=void 0;const e=Xq(),n=RTe(),a=typeof ArrayBuffer=="function",t=(s,o)=>{if(typeof s!="string")return{type:"message",data:r(s,o)};const u=s.charAt(0);return u==="b"?{type:"message",data:i(s.substring(1),o)}:e.PACKET_TYPES_REVERSE[u]?s.length>1?{type:e.PACKET_TYPES_REVERSE[u],data:s.substring(1)}:{type:e.PACKET_TYPES_REVERSE[u]}:e.ERROR_PACKET};O_.decodePacket=t;const i=(s,o)=>{if(a){const u=(0,n.decode)(s);return r(u,o)}else return{base64:!0,data:s}},r=(s,o)=>{switch(o){case"blob":return s instanceof Blob?s:new Blob([s]);case"arraybuffer":default:return s instanceof ArrayBuffer?s:s.buffer}};return O_}var PX;function IT(){return PX||(PX=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decodePayload=e.decodePacket=e.encodePayload=e.encodePacket=e.protocol=void 0,e.createPacketEncoderStream=o,e.createPacketDecoderStream=l;const n=ITe();Object.defineProperty(e,"encodePacket",{enumerable:!0,get:function(){return n.encodePacket}});const a=FTe();Object.defineProperty(e,"decodePacket",{enumerable:!0,get:function(){return a.decodePacket}});const t=Xq(),i="",r=(f,b)=>{const C=f.length,v=new Array(C);let m=0;f.forEach((h,g)=>{(0,n.encodePacket)(h,!1,_=>{v[g]=_,++m===C&&b(v.join(i))})})};e.encodePayload=r;const s=(f,b)=>{const C=f.split(i),v=[];for(let m=0;m<C.length;m++){const h=(0,a.decodePacket)(C[m],b);if(v.push(h),h.type==="error")break}return v};e.decodePayload=s;function o(){return new TransformStream({transform(f,b){(0,n.encodePacketToBinary)(f,C=>{const v=C.length;let m;if(v<126)m=new Uint8Array(1),new DataView(m.buffer).setUint8(0,v);else if(v<65536){m=new Uint8Array(3);const h=new DataView(m.buffer);h.setUint8(0,126),h.setUint16(1,v)}else{m=new Uint8Array(9);const h=new DataView(m.buffer);h.setUint8(0,127),h.setBigUint64(1,BigInt(v))}f.data&&typeof f.data!="string"&&(m[0]|=128),b.enqueue(m),b.enqueue(C)})}})}let u;function c(f){return f.reduce((b,C)=>b+C.length,0)}function d(f,b){if(f[0].length===b)return f.shift();const C=new Uint8Array(b);let v=0;for(let m=0;m<b;m++)C[m]=f[0][v++],v===f[0].length&&(f.shift(),v=0);return f.length&&v<f[0].length&&(f[0]=f[0].slice(v)),C}function l(f,b){u||(u=new TextDecoder);const C=[];let v=0,m=-1,h=!1;return new TransformStream({transform(g,_){for(C.push(g);;){if(v===0){if(c(C)<1)break;const S=d(C,1);h=(S[0]&128)===128,m=S[0]&127,m<126?v=3:m===126?v=1:v=2}else if(v===1){if(c(C)<2)break;const S=d(C,2);m=new DataView(S.buffer,S.byteOffset,S.length).getUint16(0),v=3}else if(v===2){if(c(C)<8)break;const S=d(C,8),p=new DataView(S.buffer,S.byteOffset,S.length),w=p.getUint32(0);if(w>Math.pow(2,21)-1){_.enqueue(t.ERROR_PACKET);break}m=w*Math.pow(2,32)+p.getUint32(4),v=3}else{if(c(C)<m)break;const S=d(C,m);_.enqueue((0,a.decodePacket)(h?S:u.decode(S),b)),v=0}if(m===0||m>f){_.enqueue(t.ERROR_PACKET);break}}}})}e.protocol=4})(OD)),OD}function qs(e){if(e)return jTe(e)}function jTe(e){for(var n in qs.prototype)e[n]=qs.prototype[n];return e}qs.prototype.on=qs.prototype.addEventListener=function(e,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(n),this};qs.prototype.once=function(e,n){function a(){this.off(e,a),n.apply(this,arguments)}return a.fn=n,this.on(e,a),this};qs.prototype.off=qs.prototype.removeListener=qs.prototype.removeAllListeners=qs.prototype.removeEventListener=function(e,n){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+e];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var t,i=0;i<a.length;i++)if(t=a[i],t===n||t.fn===n){a.splice(i,1);break}return a.length===0&&delete this._callbacks["$"+e],this};qs.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),a=this._callbacks["$"+e],t=1;t<arguments.length;t++)n[t-1]=arguments[t];if(a){a=a.slice(0);for(var t=0,i=a.length;t<i;++t)a[t].apply(this,n)}return this};qs.prototype.emitReserved=qs.prototype.emit;qs.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};qs.prototype.hasListeners=function(e){return!!this.listeners(e).length};const MTe=Object.freeze(Object.defineProperty({__proto__:null,Emitter:qs},Symbol.toStringTag,{value:"Module"})),yb=sE(MTe);var Wu={},P_={},EX;function dI(){return EX||(EX=1,Object.defineProperty(P_,"__esModule",{value:!0}),P_.globalThisShim=void 0,P_.globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")()),P_}var IX;function RT(){if(IX)return Wu;IX=1,Object.defineProperty(Wu,"__esModule",{value:!0}),Wu.byteLength=Wu.installTimerFunctions=Wu.pick=void 0;const e=dI();function n(u,...c){return c.reduce((d,l)=>(u.hasOwnProperty(l)&&(d[l]=u[l]),d),{})}Wu.pick=n;const a=e.globalThisShim.setTimeout,t=e.globalThisShim.clearTimeout;function i(u,c){c.useNativeTimers?(u.setTimeoutFn=a.bind(e.globalThisShim),u.clearTimeoutFn=t.bind(e.globalThisShim)):(u.setTimeoutFn=e.globalThisShim.setTimeout.bind(e.globalThisShim),u.clearTimeoutFn=e.globalThisShim.clearTimeout.bind(e.globalThisShim))}Wu.installTimerFunctions=i;const r=1.33;function s(u){return typeof u=="string"?o(u):Math.ceil((u.byteLength||u.size)*r)}Wu.byteLength=s;function o(u){let c=0,d=0;for(let l=0,f=u.length;l<f;l++)c=u.charCodeAt(l),c<128?d+=1:c<2048?d+=2:c<55296||c>=57344?d+=3:(l++,d+=4);return d}return Wu}var MP={exports:{}},PD,RX;function NTe(){if(RX)return PD;RX=1;function e(n){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=r,t.enabled=o,t.humanize=hE(),t.destroy=d,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function a(l){let f=0;for(let b=0;b<l.length;b++)f=(f<<5)-f+l.charCodeAt(b),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=a;function t(l){let f,b=null,C,v;function m(...h){if(!m.enabled)return;const g=m,_=Number(new Date),S=_-(f||_);g.diff=S,g.prev=f,g.curr=_,f=_,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let p=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(O,E)=>{if(O==="%%")return"%";p++;const F=t.formatters[E];if(typeof F=="function"){const R=h[p];O=F.call(g,R),h.splice(p,1),p--}return O}),t.formatArgs.call(g,h),(g.log||t.log).apply(g,h)}return m.namespace=l,m.useColors=t.useColors(),m.color=t.selectColor(l),m.extend=i,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(C!==t.namespaces&&(C=t.namespaces,v=t.enabled(l)),v),set:h=>{b=h}}),typeof t.init=="function"&&t.init(m),m}function i(l,f){const b=t(this.namespace+(typeof f>"u"?":":f)+l);return b.log=this.log,b}function r(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f;const b=(typeof l=="string"?l:"").split(/[\s,]+/),C=b.length;for(f=0;f<C;f++)b[f]&&(l=b[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function s(){const l=[...t.names.map(u),...t.skips.map(u).map(f=>"-"+f)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let f,b;for(f=0,b=t.skips.length;f<b;f++)if(t.skips[f].test(l))return!1;for(f=0,b=t.names.length;f<b;f++)if(t.names[f].test(l))return!0;return!1}function u(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return PD=e,PD}var FX;function FT(){return FX||(FX=1,(function(e,n){var a={};n.formatArgs=i,n.save=r,n.load=s,n.useColors=t,n.storage=o(),n.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let l=0,f=0;c[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(l++,b==="%c"&&(f=l))}),c.splice(f,0,d)}n.log=console.debug||console.log||(()=>{});function r(c){try{c?n.storage.setItem("debug",c):n.storage.removeItem("debug")}catch{}}function s(){let c;try{c=n.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=a.DEBUG),c}function o(){try{return localStorage}catch{}}e.exports=NTe()(n);const{formatters:u}=e.exports;u.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(MP,MP.exports)),MP.exports}var Ip={},jX;function Zoe(){if(jX)return Ip;jX=1,Object.defineProperty(Ip,"__esModule",{value:!0}),Ip.decode=Ip.encode=void 0;function e(a){let t="";for(let i in a)a.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(a[i]));return t}Ip.encode=e;function n(a){let t={},i=a.split("&");for(let r=0,s=i.length;r<s;r++){let o=i[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}return Ip.decode=n,Ip}var MX;function lI(){if(MX)return $u;MX=1;var e=$u&&$u.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty($u,"__esModule",{value:!0}),$u.Transport=$u.TransportError=void 0;const n=IT(),a=yb,t=RT(),i=e(FT()),r=Zoe(),s=(0,i.default)("engine.io-client:transport");class o extends Error{constructor(d,l,f){super(d),this.description=l,this.context=f,this.type="TransportError"}}$u.TransportError=o;class u extends a.Emitter{constructor(d){super(),this.writable=!1,(0,t.installTimerFunctions)(this,d),this.opts=d,this.query=d.query,this.socket=d.socket}onError(d,l,f){return super.emitReserved("error",new o(d,l,f)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(d){this.readyState==="open"?this.write(d):s("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(d){const l=(0,n.decodePacket)(d,this.socket.binaryType);this.onPacket(l)}onPacket(d){super.emitReserved("packet",d)}onClose(d){this.readyState="closed",super.emitReserved("close",d)}pause(d){}createUri(d,l={}){return d+"://"+this._hostname()+this._port()+this.opts.path+this._query(l)}_hostname(){const d=this.opts.hostname;return d.indexOf(":")===-1?d:"["+d+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(d){const l=(0,r.encode)(d);return l.length?"?"+l:""}}return $u.Transport=u,$u}var Ju={},NX;function ece(){if(NX)return Ju;NX=1,Object.defineProperty(Ju,"__esModule",{value:!0}),Ju.yeast=Ju.decode=Ju.encode=void 0;const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),n=64,a={};let t=0,i=0,r;function s(c){let d="";do d=e[c%n]+d,c=Math.floor(c/n);while(c>0);return d}Ju.encode=s;function o(c){let d=0;for(i=0;i<c.length;i++)d=d*n+a[c.charAt(i)];return d}Ju.decode=o;function u(){const c=s(+new Date);return c!==r?(t=0,r=c):c+"."+s(t++)}for(Ju.yeast=u;i<n;i++)a[e[i]]=i;return Ju}var Rp={},E_={},AX;function ATe(){if(AX)return E_;AX=1,Object.defineProperty(E_,"__esModule",{value:!0}),E_.hasCORS=void 0;let e=!1;try{e=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}return E_.hasCORS=e,E_}var DX;function DTe(){if(DX)return Rp;DX=1,Object.defineProperty(Rp,"__esModule",{value:!0}),Rp.createCookieJar=Rp.XHR=void 0;const e=ATe(),n=dI();function a(i){const r=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!r||e.hasCORS))return new XMLHttpRequest}catch{}if(!r)try{return new n.globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}Rp.XHR=a;function t(){}return Rp.createCookieJar=t,Rp}var kX;function kTe(){if(kX)return Ku;kX=1;var e=Ku&&Ku.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(Ku,"__esModule",{value:!0}),Ku.Request=Ku.Polling=void 0;const n=lI(),a=e(FT()),t=ece(),i=IT(),r=DTe(),s=yb,o=RT(),u=dI(),c=(0,a.default)("engine.io-client:polling");function d(){}const l=(function(){return new r.XHR({xdomain:!1}).responseType!=null})();class f extends n.Transport{constructor(m){if(super(m),this.polling=!1,typeof location<"u"){const g=location.protocol==="https:";let _=location.port;_||(_=g?"443":"80"),this.xd=typeof location<"u"&&m.hostname!==location.hostname||_!==m.port}const h=m&&m.forceBase64;this.supportsBinary=l&&!h,this.opts.withCredentials&&(this.cookieJar=(0,r.createCookieJar)())}get name(){return"polling"}doOpen(){this.poll()}pause(m){this.readyState="pausing";const h=()=>{c("paused"),this.readyState="paused",m()};if(this.polling||!this.writable){let g=0;this.polling&&(c("we are currently polling - waiting to pause"),g++,this.once("pollComplete",function(){c("pre-pause polling complete"),--g||h()})),this.writable||(c("we are currently writing - waiting to pause"),g++,this.once("drain",function(){c("pre-pause writing complete"),--g||h()}))}else h()}poll(){c("polling"),this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(m){c("polling got data %s",m);const h=g=>{if(this.readyState==="opening"&&g.type==="open"&&this.onOpen(),g.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(g)};(0,i.decodePayload)(m,this.socket.binaryType).forEach(h),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"?this.poll():c('ignoring poll - transport state "%s"',this.readyState))}doClose(){const m=()=>{c("writing close packet"),this.write([{type:"close"}])};this.readyState==="open"?(c("transport open - closing"),m()):(c("transport not open - deferring close"),this.once("open",m))}write(m){this.writable=!1,(0,i.encodePayload)(m,h=>{this.doWrite(h,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const m=this.opts.secure?"https":"http",h=this.query||{};return this.opts.timestampRequests!==!1&&(h[this.opts.timestampParam]=(0,t.yeast)()),!this.supportsBinary&&!h.sid&&(h.b64=1),this.createUri(m,h)}request(m={}){return Object.assign(m,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new b(this.uri(),m)}doWrite(m,h){const g=this.request({method:"POST",data:m});g.on("success",h),g.on("error",(_,S)=>{this.onError("xhr post error",_,S)})}doPoll(){c("xhr poll");const m=this.request();m.on("data",this.onData.bind(this)),m.on("error",(h,g)=>{this.onError("xhr poll error",h,g)}),this.pollXhr=m}}Ku.Polling=f;class b extends s.Emitter{constructor(m,h){super(),(0,o.installTimerFunctions)(this,h),this.opts=h,this.method=h.method||"GET",this.uri=m,this.data=h.data!==void 0?h.data:null,this.create()}create(){var m;const h=(0,o.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");h.xdomain=!!this.opts.xd;const g=this.xhr=new r.XHR(h);try{c("xhr open %s: %s",this.method,this.uri),g.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){g.setDisableHeaderCheck&&g.setDisableHeaderCheck(!0);for(let _ in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(_)&&g.setRequestHeader(_,this.opts.extraHeaders[_])}}catch{}if(this.method==="POST")try{g.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{g.setRequestHeader("Accept","*/*")}catch{}(m=this.opts.cookieJar)===null||m===void 0||m.addCookies(g),"withCredentials"in g&&(g.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(g.timeout=this.opts.requestTimeout),g.onreadystatechange=()=>{var _;g.readyState===3&&((_=this.opts.cookieJar)===null||_===void 0||_.parseCookies(g)),g.readyState===4&&(g.status===200||g.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof g.status=="number"?g.status:0)},0))},c("xhr data %s",this.data),g.send(this.data)}catch(_){this.setTimeoutFn(()=>{this.onError(_)},0);return}typeof document<"u"&&(this.index=b.requestsCount++,b.requests[this.index]=this)}onError(m){this.emitReserved("error",m,this.xhr),this.cleanup(!0)}cleanup(m){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=d,m)try{this.xhr.abort()}catch{}typeof document<"u"&&delete b.requests[this.index],this.xhr=null}}onLoad(){const m=this.xhr.responseText;m!==null&&(this.emitReserved("data",m),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(Ku.Request=b,b.requestsCount=0,b.requests={},typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",C);else if(typeof addEventListener=="function"){const v="onpagehide"in u.globalThisShim?"pagehide":"unload";addEventListener(v,C,!1)}}function C(){for(let v in b.requests)b.requests.hasOwnProperty(v)&&b.requests[v].abort()}return Ku}var Fp={},No={},xX;function fI(){if(xX)return No;xX=1,Object.defineProperty(No,"__esModule",{value:!0}),No.defaultBinaryType=No.usingBrowserWebSocket=No.WebSocket=No.nextTick=void 0;const e=dI();return No.nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?a=>Promise.resolve().then(a):(a,t)=>t(a,0),No.WebSocket=e.globalThisShim.WebSocket||e.globalThisShim.MozWebSocket,No.usingBrowserWebSocket=!0,No.defaultBinaryType="arraybuffer",No}var qX;function xTe(){if(qX)return Fp;qX=1;var e=Fp&&Fp.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(Fp,"__esModule",{value:!0}),Fp.WS=void 0;const n=lI(),a=ece(),t=RT(),i=fI(),r=e(FT()),s=IT(),o=(0,r.default)("engine.io-client:websocket"),u=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class c extends n.Transport{constructor(l){super(l),this.supportsBinary=!l.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const l=this.uri(),f=this.opts.protocols,b=u?{}:(0,t.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(b.headers=this.opts.extraHeaders);try{this.ws=i.usingBrowserWebSocket&&!u?f?new i.WebSocket(l,f):new i.WebSocket(l):new i.WebSocket(l,f,b)}catch(C){return this.emitReserved("error",C)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=l=>this.onClose({description:"websocket connection closed",context:l}),this.ws.onmessage=l=>this.onData(l.data),this.ws.onerror=l=>this.onError("websocket error",l)}write(l){this.writable=!1;for(let f=0;f<l.length;f++){const b=l[f],C=f===l.length-1;(0,s.encodePacket)(b,this.supportsBinary,v=>{const m={};i.usingBrowserWebSocket||(b.options&&(m.compress=b.options.compress),this.opts.perMessageDeflate&&(typeof v=="string"?Buffer.byteLength(v):v.length)<this.opts.perMessageDeflate.threshold&&(m.compress=!1));try{i.usingBrowserWebSocket?this.ws.send(v):this.ws.send(v,m)}catch{o("websocket closed before onclose event")}C&&(0,i.nextTick)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const l=this.opts.secure?"wss":"ws",f=this.query||{};return this.opts.timestampRequests&&(f[this.opts.timestampParam]=(0,a.yeast)()),this.supportsBinary||(f.b64=1),this.createUri(l,f)}check(){return!!i.WebSocket}}return Fp.WS=c,Fp}var jp={},LX;function qTe(){if(LX)return jp;LX=1;var e=jp&&jp.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(jp,"__esModule",{value:!0}),jp.WT=void 0;const n=lI(),a=fI(),t=IT(),r=(0,e(FT()).default)("engine.io-client:webtransport");class s extends n.Transport{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{r("transport closed gracefully"),this.onClose()}).catch(u=>{r("transport closed due to %s",u),this.onError("webtransport error",u)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(u=>{const c=(0,t.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER,this.socket.binaryType),d=u.readable.pipeThrough(c).getReader(),l=(0,t.createPacketEncoderStream)();l.readable.pipeTo(u.writable),this.writer=l.writable.getWriter();const f=()=>{d.read().then(({done:C,value:v})=>{if(C){r("session is closed");return}r("received chunk: %o",v),this.onPacket(v),f()}).catch(C=>{r("an error occurred while reading: %s",C)})};f();const b={type:"open"};this.query.sid&&(b.data=`{"sid":"${this.query.sid}"}`),this.writer.write(b).then(()=>this.onOpen())})}))}write(u){this.writable=!1;for(let c=0;c<u.length;c++){const d=u[c],l=c===u.length-1;this.writer.write(d).then(()=>{l&&(0,a.nextTick)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var u;(u=this.transport)===null||u===void 0||u.close()}}return jp.WT=s,jp}var BX;function tce(){if(BX)return w_;BX=1,Object.defineProperty(w_,"__esModule",{value:!0}),w_.transports=void 0;const e=kTe(),n=xTe(),a=qTe();return w_.transports={websocket:n.WS,webtransport:a.WT,polling:e.Polling},w_}var I_={},UX;function nce(){if(UX)return I_;UX=1,Object.defineProperty(I_,"__esModule",{value:!0}),I_.parse=void 0;const e=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function a(r){if(r.length>2e3)throw"URI too long";const s=r,o=r.indexOf("["),u=r.indexOf("]");o!=-1&&u!=-1&&(r=r.substring(0,o)+r.substring(o,u).replace(/:/g,";")+r.substring(u,r.length));let c=e.exec(r||""),d={},l=14;for(;l--;)d[n[l]]=c[l]||"";return o!=-1&&u!=-1&&(d.source=s,d.host=d.host.substring(1,d.host.length-1).replace(/;/g,":"),d.authority=d.authority.replace("[","").replace("]","").replace(/;/g,":"),d.ipv6uri=!0),d.pathNames=t(d,d.path),d.queryKey=i(d,d.query),d}I_.parse=a;function t(r,s){const o=/\/{2,9}/g,u=s.replace(o,"/").split("/");return(s.slice(0,1)=="/"||s.length===0)&&u.splice(0,1),s.slice(-1)=="/"&&u.splice(u.length-1,1),u}function i(r,s){const o={};return s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(u,c,d){c&&(o[c]=d)}),o}return I_}var zX;function LTe(){if(zX)return Pp;zX=1;var e=Pp&&Pp.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(Pp,"__esModule",{value:!0}),Pp.Socket=void 0;const n=tce(),a=RT(),t=Zoe(),i=nce(),r=e(FT()),s=yb,o=IT(),u=fI(),c=(0,r.default)("engine.io-client:socket");class d extends s.Emitter{constructor(f,b={}){super(),this.binaryType=u.defaultBinaryType,this.writeBuffer=[],f&&typeof f=="object"&&(b=f,f=null),f?(f=(0,i.parse)(f),b.hostname=f.host,b.secure=f.protocol==="https"||f.protocol==="wss",b.port=f.port,f.query&&(b.query=f.query)):b.host&&(b.hostname=(0,i.parse)(b.host).host),(0,a.installTimerFunctions)(this,b),this.secure=b.secure!=null?b.secure:typeof location<"u"&&location.protocol==="https:",b.hostname&&!b.port&&(b.port=this.secure?"443":"80"),this.hostname=b.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=b.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=b.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},b),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=(0,t.decode)(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(f){c('creating transport "%s"',f);const b=Object.assign({},this.opts.query);b.EIO=o.protocol,b.transport=f,this.id&&(b.sid=this.id);const C=Object.assign({},this.opts,{query:b,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[f]);return c("options: %j",C),new n.transports[f](C)}open(){let f;if(this.opts.rememberUpgrade&&d.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)f="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else f=this.transports[0];this.readyState="opening";try{f=this.createTransport(f)}catch(b){c("error while creating transport: %s",b),this.transports.shift(),this.open();return}f.open(),this.setTransport(f)}setTransport(f){c("setting transport %s",f.name),this.transport&&(c("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=f,f.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",b=>this.onClose("transport close",b))}probe(f){c('probing transport "%s"',f);let b=this.createTransport(f),C=!1;d.priorWebsocketSuccess=!1;const v=()=>{C||(c('probe transport "%s" opened',f),b.send([{type:"ping",data:"probe"}]),b.once("packet",w=>{if(!C)if(w.type==="pong"&&w.data==="probe"){if(c('probe transport "%s" pong',f),this.upgrading=!0,this.emitReserved("upgrading",b),!b)return;d.priorWebsocketSuccess=b.name==="websocket",c('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{C||this.readyState!=="closed"&&(c("changing transport and sending upgrade packet"),p(),this.setTransport(b),b.send([{type:"upgrade"}]),this.emitReserved("upgrade",b),b=null,this.upgrading=!1,this.flush())})}else{c('probe transport "%s" failed',f);const O=new Error("probe error");O.transport=b.name,this.emitReserved("upgradeError",O)}}))};function m(){C||(C=!0,p(),b.close(),b=null)}const h=w=>{const O=new Error("probe error: "+w);O.transport=b.name,m(),c('probe transport "%s" failed because of error: %s',f,w),this.emitReserved("upgradeError",O)};function g(){h("transport closed")}function _(){h("socket closed")}function S(w){b&&w.name!==b.name&&(c('"%s" works - aborting "%s"',w.name,b.name),m())}const p=()=>{b.removeListener("open",v),b.removeListener("error",h),b.removeListener("close",g),this.off("close",_),this.off("upgrading",S)};b.once("open",v),b.once("error",h),b.once("close",g),this.once("close",_),this.once("upgrading",S),this.upgrades.indexOf("webtransport")!==-1&&f!=="webtransport"?this.setTimeoutFn(()=>{C||b.open()},200):b.open()}onOpen(){if(c("socket open"),this.readyState="open",d.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){c("starting upgrade probes");let f=0;const b=this.upgrades.length;for(;f<b;f++)this.probe(this.upgrades[f])}}onPacket(f){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(c('socket receive: type "%s", data "%s"',f.type,f.data),this.emitReserved("packet",f),this.emitReserved("heartbeat"),this.resetPingTimeout(),f.type){case"open":this.onHandshake(JSON.parse(f.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const b=new Error("server error");b.code=f.data,this.onError(b);break;case"message":this.emitReserved("data",f.data),this.emitReserved("message",f.data);break}else c('packet received with socket readyState "%s"',this.readyState)}onHandshake(f){this.emitReserved("handshake",f),this.id=f.sid,this.transport.query.sid=f.sid,this.upgrades=this.filterUpgrades(f.upgrades),this.pingInterval=f.pingInterval,this.pingTimeout=f.pingTimeout,this.maxPayload=f.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const f=this.getWritablePackets();c("flushing %d packets in socket",f.length),this.transport.send(f),this.prevBufferLen=f.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let b=1;for(let C=0;C<this.writeBuffer.length;C++){const v=this.writeBuffer[C].data;if(v&&(b+=(0,a.byteLength)(v)),C>0&&b>this.maxPayload)return c("only send %d out of %d packets",C,this.writeBuffer.length),this.writeBuffer.slice(0,C);b+=2}return c("payload size is %d (max: %d)",b,this.maxPayload),this.writeBuffer}write(f,b,C){return this.sendPacket("message",f,b,C),this}send(f,b,C){return this.sendPacket("message",f,b,C),this}sendPacket(f,b,C,v){if(typeof b=="function"&&(v=b,b=void 0),typeof C=="function"&&(v=C,C=null),this.readyState==="closing"||this.readyState==="closed")return;C=C||{},C.compress=C.compress!==!1;const m={type:f,data:b,options:C};this.emitReserved("packetCreate",m),this.writeBuffer.push(m),v&&this.once("flush",v),this.flush()}close(){const f=()=>{this.onClose("forced close"),c("socket closing - telling transport to close"),this.transport.close()},b=()=>{this.off("upgrade",b),this.off("upgradeError",b),f()},C=()=>{this.once("upgrade",b),this.once("upgradeError",b)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?C():f()}):this.upgrading?C():f()),this}onError(f){c("socket error %j",f),d.priorWebsocketSuccess=!1,this.emitReserved("error",f),this.onClose("transport error",f)}onClose(f,b){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(c('socket close with reason: "%s"',f),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",f,b),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(f){const b=[];let C=0;const v=f.length;for(;C<v;C++)~this.transports.indexOf(f[C])&&b.push(f[C]);return b}}return Pp.Socket=d,d.protocol=o.protocol,Pp}var VX;function rce(){return VX||(VX=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.nextTick=e.parse=e.installTimerFunctions=e.transports=e.TransportError=e.Transport=e.protocol=e.Socket=void 0;const n=LTe();Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return n.Socket}}),e.protocol=n.Socket.protocol;var a=lI();Object.defineProperty(e,"Transport",{enumerable:!0,get:function(){return a.Transport}}),Object.defineProperty(e,"TransportError",{enumerable:!0,get:function(){return a.TransportError}});var t=tce();Object.defineProperty(e,"transports",{enumerable:!0,get:function(){return t.transports}});var i=RT();Object.defineProperty(e,"installTimerFunctions",{enumerable:!0,get:function(){return i.installTimerFunctions}});var r=nce();Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return r.parse}});var s=fI();Object.defineProperty(e,"nextTick",{enumerable:!0,get:function(){return s.nextTick}})})(wD)),wD}var NP={exports:{}},ED,HX;function BTe(){if(HX)return ED;HX=1;function e(n){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=r,t.enabled=o,t.humanize=hE(),t.destroy=d,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function a(l){let f=0;for(let b=0;b<l.length;b++)f=(f<<5)-f+l.charCodeAt(b),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=a;function t(l){let f,b=null,C,v;function m(...h){if(!m.enabled)return;const g=m,_=Number(new Date),S=_-(f||_);g.diff=S,g.prev=f,g.curr=_,f=_,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let p=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(O,E)=>{if(O==="%%")return"%";p++;const F=t.formatters[E];if(typeof F=="function"){const R=h[p];O=F.call(g,R),h.splice(p,1),p--}return O}),t.formatArgs.call(g,h),(g.log||t.log).apply(g,h)}return m.namespace=l,m.useColors=t.useColors(),m.color=t.selectColor(l),m.extend=i,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(C!==t.namespaces&&(C=t.namespaces,v=t.enabled(l)),v),set:h=>{b=h}}),typeof t.init=="function"&&t.init(m),m}function i(l,f){const b=t(this.namespace+(typeof f>"u"?":":f)+l);return b.log=this.log,b}function r(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f;const b=(typeof l=="string"?l:"").split(/[\s,]+/),C=b.length;for(f=0;f<C;f++)b[f]&&(l=b[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function s(){const l=[...t.names.map(u),...t.skips.map(u).map(f=>"-"+f)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let f,b;for(f=0,b=t.skips.length;f<b;f++)if(t.skips[f].test(l))return!1;for(f=0,b=t.names.length;f<b;f++)if(t.names[f].test(l))return!0;return!1}function u(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return ED=e,ED}var KX;function hI(){return KX||(KX=1,(function(e,n){var a={};n.formatArgs=i,n.save=r,n.load=s,n.useColors=t,n.storage=o(),n.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let l=0,f=0;c[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(l++,b==="%c"&&(f=l))}),c.splice(f,0,d)}n.log=console.debug||console.log||(()=>{});function r(c){try{c?n.storage.setItem("debug",c):n.storage.removeItem("debug")}catch{}}function s(){let c;try{c=n.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=a.DEBUG),c}function o(){try{return localStorage}catch{}}e.exports=BTe()(n);const{formatters:u}=e.exports;u.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(NP,NP.exports)),NP.exports}var $X;function UTe(){if($X)return Op;$X=1;var e=Op&&Op.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Op,"__esModule",{value:!0}),Op.url=void 0;const n=rce(),t=e(hI()).default("socket.io-client:url");function i(r,s="",o){let u=r;o=o||typeof location<"u"&&location,r==null&&(r=o.protocol+"//"+o.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=o.protocol+r:r=o.host+r),/^(https?|wss?):\/\//.test(r)||(t("protocol-less url %s",r),typeof o<"u"?r=o.protocol+"//"+r:r="https://"+r),t("parse %s",r),u=n.parse(r)),u.port||(/^(http|ws)$/.test(u.protocol)?u.port="80":/^(http|ws)s$/.test(u.protocol)&&(u.port="443")),u.path=u.path||"/";const d=u.host.indexOf(":")!==-1?"["+u.host+"]":u.host;return u.id=u.protocol+"://"+d+":"+u.port+s,u.href=u.protocol+"://"+d+(o&&o.port===u.port?"":":"+u.port),u}return Op.url=i,Op}var Ea={},Mp={},ID={},Np={},Ap={},GX;function ice(){if(GX)return Ap;GX=1,Object.defineProperty(Ap,"__esModule",{value:!0}),Ap.hasBinary=Ap.isBinary=void 0;const e=typeof ArrayBuffer=="function",n=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer,a=Object.prototype.toString,t=typeof Blob=="function"||typeof Blob<"u"&&a.call(Blob)==="[object BlobConstructor]",i=typeof File=="function"||typeof File<"u"&&a.call(File)==="[object FileConstructor]";function r(o){return e&&(o instanceof ArrayBuffer||n(o))||t&&o instanceof Blob||i&&o instanceof File}Ap.isBinary=r;function s(o,u){if(!o||typeof o!="object")return!1;if(Array.isArray(o)){for(let c=0,d=o.length;c<d;c++)if(s(o[c]))return!0;return!1}if(r(o))return!0;if(o.toJSON&&typeof o.toJSON=="function"&&arguments.length===1)return s(o.toJSON(),!0);for(const c in o)if(Object.prototype.hasOwnProperty.call(o,c)&&s(o[c]))return!0;return!1}return Ap.hasBinary=s,Ap}var WX;function zTe(){if(WX)return Np;WX=1,Object.defineProperty(Np,"__esModule",{value:!0}),Np.reconstructPacket=Np.deconstructPacket=void 0;const e=ice();function n(r){const s=[],o=r.data,u=r;return u.data=a(o,s),u.attachments=s.length,{packet:u,buffers:s}}Np.deconstructPacket=n;function a(r,s){if(!r)return r;if((0,e.isBinary)(r)){const o={_placeholder:!0,num:s.length};return s.push(r),o}else if(Array.isArray(r)){const o=new Array(r.length);for(let u=0;u<r.length;u++)o[u]=a(r[u],s);return o}else if(typeof r=="object"&&!(r instanceof Date)){const o={};for(const u in r)Object.prototype.hasOwnProperty.call(r,u)&&(o[u]=a(r[u],s));return o}return r}function t(r,s){return r.data=i(r.data,s),delete r.attachments,r}Np.reconstructPacket=t;function i(r,s){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<s.length)return s[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let o=0;o<r.length;o++)r[o]=i(r[o],s);else if(typeof r=="object")for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(r[o]=i(r[o],s));return r}return Np}var AP={exports:{}},RD,JX;function VTe(){if(JX)return RD;JX=1;function e(n){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=r,t.enabled=o,t.humanize=hE(),t.destroy=d,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function a(l){let f=0;for(let b=0;b<l.length;b++)f=(f<<5)-f+l.charCodeAt(b),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=a;function t(l){let f,b=null,C,v;function m(...h){if(!m.enabled)return;const g=m,_=Number(new Date),S=_-(f||_);g.diff=S,g.prev=f,g.curr=_,f=_,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let p=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(O,E)=>{if(O==="%%")return"%";p++;const F=t.formatters[E];if(typeof F=="function"){const R=h[p];O=F.call(g,R),h.splice(p,1),p--}return O}),t.formatArgs.call(g,h),(g.log||t.log).apply(g,h)}return m.namespace=l,m.useColors=t.useColors(),m.color=t.selectColor(l),m.extend=i,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(C!==t.namespaces&&(C=t.namespaces,v=t.enabled(l)),v),set:h=>{b=h}}),typeof t.init=="function"&&t.init(m),m}function i(l,f){const b=t(this.namespace+(typeof f>"u"?":":f)+l);return b.log=this.log,b}function r(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f;const b=(typeof l=="string"?l:"").split(/[\s,]+/),C=b.length;for(f=0;f<C;f++)b[f]&&(l=b[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function s(){const l=[...t.names.map(u),...t.skips.map(u).map(f=>"-"+f)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let f,b;for(f=0,b=t.skips.length;f<b;f++)if(t.skips[f].test(l))return!1;for(f=0,b=t.names.length;f<b;f++)if(t.names[f].test(l))return!0;return!1}function u(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return RD=e,RD}var QX;function HTe(){return QX||(QX=1,(function(e,n){var a={};n.formatArgs=i,n.save=r,n.load=s,n.useColors=t,n.storage=o(),n.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let l=0,f=0;c[0].replace(/%[a-zA-Z%]/g,b=>{b!=="%%"&&(l++,b==="%c"&&(f=l))}),c.splice(f,0,d)}n.log=console.debug||console.log||(()=>{});function r(c){try{c?n.storage.setItem("debug",c):n.storage.removeItem("debug")}catch{}}function s(){let c;try{c=n.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=a.DEBUG),c}function o(){try{return localStorage}catch{}}e.exports=VTe()(n);const{formatters:u}=e.exports;u.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(AP,AP.exports)),AP.exports}var YX;function Zq(){return YX||(YX=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.Encoder=e.PacketType=e.protocol=void 0;const n=yb,a=zTe(),t=ice(),r=(0,HTe().default)("socket.io-parser"),s=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];e.protocol=5;var o;(function(f){f[f.CONNECT=0]="CONNECT",f[f.DISCONNECT=1]="DISCONNECT",f[f.EVENT=2]="EVENT",f[f.ACK=3]="ACK",f[f.CONNECT_ERROR=4]="CONNECT_ERROR",f[f.BINARY_EVENT=5]="BINARY_EVENT",f[f.BINARY_ACK=6]="BINARY_ACK"})(o=e.PacketType||(e.PacketType={}));class u{constructor(b){this.replacer=b}encode(b){return r("encoding packet %j",b),(b.type===o.EVENT||b.type===o.ACK)&&(0,t.hasBinary)(b)?this.encodeAsBinary({type:b.type===o.EVENT?o.BINARY_EVENT:o.BINARY_ACK,nsp:b.nsp,data:b.data,id:b.id}):[this.encodeAsString(b)]}encodeAsString(b){let C=""+b.type;return(b.type===o.BINARY_EVENT||b.type===o.BINARY_ACK)&&(C+=b.attachments+"-"),b.nsp&&b.nsp!=="/"&&(C+=b.nsp+","),b.id!=null&&(C+=b.id),b.data!=null&&(C+=JSON.stringify(b.data,this.replacer)),r("encoded %j as %s",b,C),C}encodeAsBinary(b){const C=(0,a.deconstructPacket)(b),v=this.encodeAsString(C.packet),m=C.buffers;return m.unshift(v),m}}e.Encoder=u;function c(f){return Object.prototype.toString.call(f)==="[object Object]"}class d extends n.Emitter{constructor(b){super(),this.reviver=b}add(b){let C;if(typeof b=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");C=this.decodeString(b);const v=C.type===o.BINARY_EVENT;v||C.type===o.BINARY_ACK?(C.type=v?o.EVENT:o.ACK,this.reconstructor=new l(C),C.attachments===0&&super.emitReserved("decoded",C)):super.emitReserved("decoded",C)}else if((0,t.isBinary)(b)||b.base64)if(this.reconstructor)C=this.reconstructor.takeBinaryData(b),C&&(this.reconstructor=null,super.emitReserved("decoded",C));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+b)}decodeString(b){let C=0;const v={type:Number(b.charAt(0))};if(o[v.type]===void 0)throw new Error("unknown packet type "+v.type);if(v.type===o.BINARY_EVENT||v.type===o.BINARY_ACK){const h=C+1;for(;b.charAt(++C)!=="-"&&C!=b.length;);const g=b.substring(h,C);if(g!=Number(g)||b.charAt(C)!=="-")throw new Error("Illegal attachments");v.attachments=Number(g)}if(b.charAt(C+1)==="/"){const h=C+1;for(;++C&&!(b.charAt(C)===","||C===b.length););v.nsp=b.substring(h,C)}else v.nsp="/";const m=b.charAt(C+1);if(m!==""&&Number(m)==m){const h=C+1;for(;++C;){const g=b.charAt(C);if(g==null||Number(g)!=g){--C;break}if(C===b.length)break}v.id=Number(b.substring(h,C+1))}if(b.charAt(++C)){const h=this.tryParse(b.substr(C));if(d.isPayloadValid(v.type,h))v.data=h;else throw new Error("invalid payload")}return r("decoded %s as %j",b,v),v}tryParse(b){try{return JSON.parse(b,this.reviver)}catch{return!1}}static isPayloadValid(b,C){switch(b){case o.CONNECT:return c(C);case o.DISCONNECT:return C===void 0;case o.CONNECT_ERROR:return typeof C=="string"||c(C);case o.EVENT:case o.BINARY_EVENT:return Array.isArray(C)&&(typeof C[0]=="number"||typeof C[0]=="string"&&s.indexOf(C[0])===-1);case o.ACK:case o.BINARY_ACK:return Array.isArray(C)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}e.Decoder=d;class l{constructor(b){this.packet=b,this.buffers=[],this.reconPack=b}takeBinaryData(b){if(this.buffers.push(b),this.buffers.length===this.reconPack.attachments){const C=(0,a.reconstructPacket)(this.reconPack,this.buffers);return this.finishedReconstruction(),C}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}})(ID)),ID}var R_={},XX;function sce(){if(XX)return R_;XX=1,Object.defineProperty(R_,"__esModule",{value:!0}),R_.on=void 0;function e(n,a,t){return n.on(a,t),function(){n.off(a,t)}}return R_.on=e,R_}var ZX;function ace(){if(ZX)return Mp;ZX=1;var e=Mp&&Mp.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Mp,"__esModule",{value:!0}),Mp.Socket=void 0;const n=Zq(),a=sce(),t=yb,r=e(hI()).default("socket.io-client:socket"),s=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class o extends t.Emitter{constructor(c,d,l){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=c,this.nsp=d,l&&l.auth&&(this.auth=l.auth),this._opts=Object.assign({},l),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const c=this.io;this.subs=[a.on(c,"open",this.onopen.bind(this)),a.on(c,"packet",this.onpacket.bind(this)),a.on(c,"error",this.onerror.bind(this)),a.on(c,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...c){return c.unshift("message"),this.emit.apply(this,c),this}emit(c,...d){if(s.hasOwnProperty(c))throw new Error('"'+c.toString()+'" is a reserved event name');if(d.unshift(c),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(d),this;const l={type:n.PacketType.EVENT,data:d};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof d[d.length-1]=="function"){const C=this.ids++;r("emitting packet with ack id %d",C);const v=d.pop();this._registerAckCallback(C,v),l.id=C}const f=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!f||!this.connected)?r("discard packet as the transport is not currently writable"):this.connected?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l),this.flags={},this}_registerAckCallback(c,d){var l;const f=(l=this.flags.timeout)!==null&&l!==void 0?l:this._opts.ackTimeout;if(f===void 0){this.acks[c]=d;return}const b=this.io.setTimeoutFn(()=>{delete this.acks[c];for(let v=0;v<this.sendBuffer.length;v++)this.sendBuffer[v].id===c&&(r("removing packet with ack id %d from the buffer",c),this.sendBuffer.splice(v,1));r("event with ack id %d has timed out after %d ms",c,f),d.call(this,new Error("operation has timed out"))},f),C=(...v)=>{this.io.clearTimeoutFn(b),d.apply(this,v)};C.withError=!0,this.acks[c]=C}emitWithAck(c,...d){return new Promise((l,f)=>{const b=(C,v)=>C?f(C):l(v);b.withError=!0,d.push(b),this.emit(c,...d)})}_addToQueue(c){let d;typeof c[c.length-1]=="function"&&(d=c.pop());const l={id:this._queueSeq++,tryCount:0,pending:!1,args:c,flags:Object.assign({fromQueue:!0},this.flags)};c.push((f,...b)=>l!==this._queue[0]?void 0:(f!==null?l.tryCount>this._opts.retries&&(r("packet [%d] is discarded after %d tries",l.id,l.tryCount),this._queue.shift(),d&&d(f)):(r("packet [%d] was successfully sent",l.id),this._queue.shift(),d&&d(null,...b)),l.pending=!1,this._drainQueue())),this._queue.push(l),this._drainQueue()}_drainQueue(c=!1){if(r("draining queue"),!this.connected||this._queue.length===0)return;const d=this._queue[0];if(d.pending&&!c){r("packet [%d] has already been sent and is waiting for an ack",d.id);return}d.pending=!0,d.tryCount++,r("sending packet [%d] (try n%d)",d.id,d.tryCount),this.flags=d.flags,this.emit.apply(this,d.args)}packet(c){c.nsp=this.nsp,this.io._packet(c)}onopen(){r("transport is open - connecting"),typeof this.auth=="function"?this.auth(c=>{this._sendConnectPacket(c)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(c){this.packet({type:n.PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},c):c})}onerror(c){this.connected||this.emitReserved("connect_error",c)}onclose(c,d){r("close (%s)",c),this.connected=!1,delete this.id,this.emitReserved("disconnect",c,d),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(c=>{if(!this.sendBuffer.some(l=>String(l.id)===c)){const l=this.acks[c];delete this.acks[c],l.withError&&l.call(this,new Error("socket has been disconnected"))}})}onpacket(c){if(c.nsp===this.nsp)switch(c.type){case n.PacketType.CONNECT:c.data&&c.data.sid?this.onconnect(c.data.sid,c.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case n.PacketType.EVENT:case n.PacketType.BINARY_EVENT:this.onevent(c);break;case n.PacketType.ACK:case n.PacketType.BINARY_ACK:this.onack(c);break;case n.PacketType.DISCONNECT:this.ondisconnect();break;case n.PacketType.CONNECT_ERROR:this.destroy();const l=new Error(c.data.message);l.data=c.data.data,this.emitReserved("connect_error",l);break}}onevent(c){const d=c.data||[];r("emitting event %j",d),c.id!=null&&(r("attaching ack callback to event"),d.push(this.ack(c.id))),this.connected?this.emitEvent(d):this.receiveBuffer.push(Object.freeze(d))}emitEvent(c){if(this._anyListeners&&this._anyListeners.length){const d=this._anyListeners.slice();for(const l of d)l.apply(this,c)}super.emit.apply(this,c),this._pid&&c.length&&typeof c[c.length-1]=="string"&&(this._lastOffset=c[c.length-1])}ack(c){const d=this;let l=!1;return function(...f){l||(l=!0,r("sending ack %j",f),d.packet({type:n.PacketType.ACK,id:c,data:f}))}}onack(c){const d=this.acks[c.id];if(typeof d!="function"){r("bad ack %s",c.id);return}delete this.acks[c.id],r("calling ack %s with %j",c.id,c.data),d.withError&&c.data.unshift(null),d.apply(this,c.data)}onconnect(c,d){r("socket connected with id %s",c),this.id=c,this.recovered=d&&this._pid===d,this._pid=d,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(c=>this.emitEvent(c)),this.receiveBuffer=[],this.sendBuffer.forEach(c=>{this.notifyOutgoingListeners(c),this.packet(c)}),this.sendBuffer=[]}ondisconnect(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(c=>c()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:n.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(c){return this.flags.compress=c,this}get volatile(){return this.flags.volatile=!0,this}timeout(c){return this.flags.timeout=c,this}onAny(c){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(c),this}prependAny(c){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(c),this}offAny(c){if(!this._anyListeners)return this;if(c){const d=this._anyListeners;for(let l=0;l<d.length;l++)if(c===d[l])return d.splice(l,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(c){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(c),this}prependAnyOutgoing(c){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(c),this}offAnyOutgoing(c){if(!this._anyOutgoingListeners)return this;if(c){const d=this._anyOutgoingListeners;for(let l=0;l<d.length;l++)if(c===d[l])return d.splice(l,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(c){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const d=this._anyOutgoingListeners.slice();for(const l of d)l.apply(this,c.data)}}}return Mp.Socket=o,Mp}var F_={},eZ;function KTe(){if(eZ)return F_;eZ=1,Object.defineProperty(F_,"__esModule",{value:!0}),F_.Backoff=void 0;function e(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}return F_.Backoff=e,e.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),t=Math.floor(a*this.jitter*n);n=(Math.floor(a*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0},e.prototype.reset=function(){this.attempts=0},e.prototype.setMin=function(n){this.ms=n},e.prototype.setMax=function(n){this.max=n},e.prototype.setJitter=function(n){this.jitter=n},F_}var tZ;function $Te(){if(tZ)return Ea;tZ=1;var e=Ea&&Ea.__createBinding||(Object.create?(function(b,C,v,m){m===void 0&&(m=v),Object.defineProperty(b,m,{enumerable:!0,get:function(){return C[v]}})}):(function(b,C,v,m){m===void 0&&(m=v),b[m]=C[v]})),n=Ea&&Ea.__setModuleDefault||(Object.create?(function(b,C){Object.defineProperty(b,"default",{enumerable:!0,value:C})}):function(b,C){b.default=C}),a=Ea&&Ea.__importStar||function(b){if(b&&b.__esModule)return b;var C={};if(b!=null)for(var v in b)v!=="default"&&Object.prototype.hasOwnProperty.call(b,v)&&e(C,b,v);return n(C,b),C},t=Ea&&Ea.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(Ea,"__esModule",{value:!0}),Ea.Manager=void 0;const i=rce(),r=ace(),s=a(Zq()),o=sce(),u=KTe(),c=yb,l=t(hI()).default("socket.io-client:manager");class f extends c.Emitter{constructor(C,v){var m;super(),this.nsps={},this.subs=[],C&&typeof C=="object"&&(v=C,C=void 0),v=v||{},v.path=v.path||"/socket.io",this.opts=v,i.installTimerFunctions(this,v),this.reconnection(v.reconnection!==!1),this.reconnectionAttempts(v.reconnectionAttempts||1/0),this.reconnectionDelay(v.reconnectionDelay||1e3),this.reconnectionDelayMax(v.reconnectionDelayMax||5e3),this.randomizationFactor((m=v.randomizationFactor)!==null&&m!==void 0?m:.5),this.backoff=new u.Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(v.timeout==null?2e4:v.timeout),this._readyState="closed",this.uri=C;const h=v.parser||s;this.encoder=new h.Encoder,this.decoder=new h.Decoder,this._autoConnect=v.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(C){return arguments.length?(this._reconnection=!!C,this):this._reconnection}reconnectionAttempts(C){return C===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=C,this)}reconnectionDelay(C){var v;return C===void 0?this._reconnectionDelay:(this._reconnectionDelay=C,(v=this.backoff)===null||v===void 0||v.setMin(C),this)}randomizationFactor(C){var v;return C===void 0?this._randomizationFactor:(this._randomizationFactor=C,(v=this.backoff)===null||v===void 0||v.setJitter(C),this)}reconnectionDelayMax(C){var v;return C===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=C,(v=this.backoff)===null||v===void 0||v.setMax(C),this)}timeout(C){return arguments.length?(this._timeout=C,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(C){if(l("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=new i.Socket(this.uri,this.opts);const v=this.engine,m=this;this._readyState="opening",this.skipReconnect=!1;const h=o.on(v,"open",function(){m.onopen(),C&&C()}),g=S=>{l("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",S),C?C(S):this.maybeReconnectOnOpen()},_=o.on(v,"error",g);if(this._timeout!==!1){const S=this._timeout;l("connect attempt will timeout after %d",S);const p=this.setTimeoutFn(()=>{l("connect attempt timed out after %d",S),h(),g(new Error("timeout")),v.close()},S);this.opts.autoUnref&&p.unref(),this.subs.push(()=>{this.clearTimeoutFn(p)})}return this.subs.push(h),this.subs.push(_),this}connect(C){return this.open(C)}onopen(){l("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const C=this.engine;this.subs.push(o.on(C,"ping",this.onping.bind(this)),o.on(C,"data",this.ondata.bind(this)),o.on(C,"error",this.onerror.bind(this)),o.on(C,"close",this.onclose.bind(this)),o.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(C){try{this.decoder.add(C)}catch(v){this.onclose("parse error",v)}}ondecoded(C){i.nextTick(()=>{this.emitReserved("packet",C)},this.setTimeoutFn)}onerror(C){l("error",C),this.emitReserved("error",C)}socket(C,v){let m=this.nsps[C];return m?this._autoConnect&&!m.active&&m.connect():(m=new r.Socket(this,C,v),this.nsps[C]=m),m}_destroy(C){const v=Object.keys(this.nsps);for(const m of v)if(this.nsps[m].active){l("socket %s is still active, skipping close",m);return}this._close()}_packet(C){l("writing packet %j",C);const v=this.encoder.encode(C);for(let m=0;m<v.length;m++)this.engine.write(v[m],C.options)}cleanup(){l("cleanup"),this.subs.forEach(C=>C()),this.subs.length=0,this.decoder.destroy()}_close(){l("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(C,v){l("closed due to %s",C),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",C,v),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const C=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const v=this.backoff.duration();l("will wait %dms before reconnect attempt",v),this._reconnecting=!0;const m=this.setTimeoutFn(()=>{C.skipReconnect||(l("attempting reconnect"),this.emitReserved("reconnect_attempt",C.backoff.attempts),!C.skipReconnect&&C.open(h=>{h?(l("reconnect attempt error"),C._reconnecting=!1,C.reconnect(),this.emitReserved("reconnect_error",h)):(l("reconnect success"),C.onreconnect())}))},v);this.opts.autoUnref&&m.unref(),this.subs.push(()=>{this.clearTimeoutFn(m)})}}onreconnect(){const C=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",C)}}return Ea.Manager=f,Ea}var nZ=H1.exports,rZ;function GTe(){return rZ||(rZ=1,(function(e,n){var a=nZ&&nZ.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.connect=n.io=n.Socket=n.Manager=n.protocol=void 0;const t=UTe(),i=$Te();Object.defineProperty(n,"Manager",{enumerable:!0,get:function(){return i.Manager}});const r=ace();Object.defineProperty(n,"Socket",{enumerable:!0,get:function(){return r.Socket}});const o=a(hI()).default("socket.io-client"),u={};function c(l,f){typeof l=="object"&&(f=l,l=void 0),f=f||{};const b=t.url(l,f.path||"/socket.io"),C=b.source,v=b.id,m=b.path,h=u[v]&&m in u[v].nsps,g=f.forceNew||f["force new connection"]||f.multiplex===!1||h;let _;return g?(o("ignoring socket cache for %s",C),_=new i.Manager(C,f)):(u[v]||(o("new io instance for %s",C),u[v]=new i.Manager(C,f)),_=u[v]),b.query&&!f.query&&(f.query=b.queryKey),_.socket(b.path,f)}n.io=c,n.connect=c,n.default=c,Object.assign(c,{Manager:i.Manager,Socket:r.Socket,io:c,connect:c});var d=Zq();Object.defineProperty(n,"protocol",{enumerable:!0,get:function(){return d.protocol}}),e.exports=c})(H1,H1.exports)),H1.exports}var iZ;function WTe(){if(iZ)return T_;iZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(T_,"__esModule",{value:!0}),T_.SocketIOClientStatic=void 0;const e=GTe();return T_.SocketIOClientStatic=e.io,T_}var sZ;function JTe(){if(sZ)return u_;sZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(u_,"__esModule",{value:!0}),u_.DocumentService=void 0;const e=Ht(),n=Je(),a=Kn(),t=Ot(),i=fTe(),r=hTe(),s=CTe(),o=tI(),u=_Te(),c=TTe(),d=wTe(),l=gb(),f=Xoe(),b=WTe();class C extends e.TypedEventEmitter{get resolvedUrl(){return this._resolvedUrl}constructor(m,h,g,_,S,p,w,O,E,F,R,M,j,k,x,L,V,G,ee){super(),this._resolvedUrl=m,this.ordererUrl=h,this.deltaStorageUrl=g,this.deltaStreamUrl=_,this.storageUrl=S,this.logger=p,this.tokenProvider=w,this.tenantId=O,this.documentId=E,this.ordererRestWrapper=F,this.documentStorageServicePolicies=R,this.driverPolicies=M,this.blobCache=j,this.wholeSnapshotTreeCache=k,this.shreddedSummaryTreeCache=x,this.getSessionInfo=L,this.storageRestWrapper=V,this.storageTokenFetcher=G,this.ordererTokenFetcher=ee}get policies(){return this._policies}dispose(){}async connectToStorage(){if(this.documentStorageService!==void 0)return this.documentStorageService;if(this.storageUrl===void 0)return new d.NullBlobStorageService;const m=async _=>{const S=await this.refreshSessionInfoIfNeeded();if(!this.storageManager||!this.noCacheStorageManager||S){if(S){const O=new a.RateLimiter(this.driverPolicies.maxConcurrentStorageRequests);this.storageRestWrapper=f.RouterliciousStorageRestWrapper.load(this.tenantId,this.storageTokenFetcher,this.logger,O,this.driverPolicies.enableRestLess,this.storageUrl)}const p=new c.Historian(!0,!1,this.storageRestWrapper);this.storageManager=new u.GitManager(p);const w=new c.Historian(!0,!0,this.storageRestWrapper);this.noCacheStorageManager=new u.GitManager(w)}return _?this.noCacheStorageManager:this.storageManager},h=await m(),g=await m(!0);return this.documentStorageService=new s.DocumentStorageService(this.documentId,h,this.logger,this.documentStorageServicePolicies,this.driverPolicies,this.blobCache,this.wholeSnapshotTreeCache,this.shreddedSummaryTreeCache,g,m),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),(0,n.assert)(!!this.documentStorageService,177);const m=async()=>{if(await this.refreshSessionInfoIfNeeded()){const S=new a.RateLimiter(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=f.RouterliciousOrdererRestWrapper.load(this.ordererTokenFetcher,this.logger,S,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},h=await m(),g=new i.DeltaStorageService(this.deltaStorageUrl,h,this.logger,m,()=>this.deltaStorageUrl);return new i.DocumentDeltaStorageService(this.tenantId,this.documentId,g,this.documentStorageService,this.logger)}async connectToDeltaStream(m){const h=async g=>{let _=await this.ordererRestWrapper.getToken();return await this.refreshSessionInfoIfNeeded(),g&&(_=await t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"GetDeltaStreamToken",docId:this.documentId,details:JSON.stringify({refreshToken:g})},async()=>this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,g).then(S=>(this.ordererRestWrapper.setToken(S),S),S=>{throw(0,t.wrapError)(S,w=>new a.NetworkErrorBasic("The Host-provided token fetcher threw an error",o.RouterliciousErrorTypes.fetchTokenError,(0,a.canRetryOnError)(S),{errorMessage:w,driverVersion:l.pkgVersion}))}))),t.PerformanceEvent.timedExecAsync(this.logger,{eventName:"ConnectToDeltaStream",docId:this.documentId},async()=>r.R11sDocumentDeltaConnection.create(this.tenantId,this.documentId,_.jwt,b.SocketIOClientStatic,m,this.deltaStreamUrl,this.logger,void 0,this.driverPolicies.enableLongPollingDowngrade))};try{const g=await h(),_=!!g.details?.supportedFeatures?.enable_single_commit_summary;return this._policies={...this._policies,summarizeProtocolTree:_},g}catch(g){if(typeof g=="object"&&g!==null&&g.errorType===o.RouterliciousErrorTypes.authorizationError)return h(!0);throw g}}async refreshSessionInfoIfNeeded(){const m=await this.getSessionInfo();if(!m.refreshed)return!1;const h=m.resolvedUrl;return this._resolvedUrl=h,this.storageUrl=h.endpoints.storageUrl,this.ordererUrl=h.endpoints.ordererUrl,this.deltaStorageUrl=h.endpoints.deltaStorageUrl,this.deltaStreamUrl=h.endpoints.deltaStreamUrl??this.ordererUrl,!0}}return u_.DocumentService=C,u_}var j_={},aZ;function oce(){if(aZ)return j_;aZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(j_,"__esModule",{value:!0}),j_.r11sDriverCompatDetailsForLoader=void 0;const e=gb();return j_.r11sDriverCompatDetailsForLoader={pkgVersion:e.pkgVersion,generation:1,supportedFeatures:new Set},j_}var M_={},oZ;function QTe(){if(oZ)return M_;oZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(M_,"__esModule",{value:!0}),M_.isRouterliciousResolvedUrl=void 0;const e=n=>n.routerliciousResolvedUrl===!0;return M_.isRouterliciousResolvedUrl=e,M_}var FD={},Dp={},cZ;function cce(){if(cZ)return Dp;cZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Dp,"__esModule",{value:!0}),Dp.getDiscoveredFluidResolvedUrl=Dp.replaceDocumentIdInPath=void 0;const e=(a,t)=>a.split("/").slice(0,-1).concat([t]).join("/");Dp.replaceDocumentIdInPath=e;const n=(a,t)=>{const i=new URL(t.ordererUrl),r=new URL(a.endpoints.deltaStorageUrl);r.host=i.host;const s=new URL(t.historianUrl),o=new URL(a.endpoints.storageUrl);o.host=s.host;const u=new URL(a.url);return{endpoints:{deltaStorageUrl:r.toString(),ordererUrl:t.ordererUrl,deltaStreamUrl:t.deltaStreamUrl,storageUrl:o.toString()},id:a.id,tokens:a.tokens,type:a.type,url:new URL(`https://${i.host}${u.pathname}`).toString()}};return Dp.getDiscoveredFluidResolvedUrl=n,Dp}var uZ;function YTe(){return uZ||(uZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.SessionInfoManager=e.RediscoverAfterTimeSinceDiscoveryMs=void 0;const n=Je(),a=uI(),t=Ot(),i=cce();e.RediscoverAfterTimeSinceDiscoveryMs=5*6e4;class r{constructor(u){this.enableDiscovery=u,this.sessionInfoMap=new Map,this.sessionLastDiscoveredMap=new Map}async initializeSessionInfo(u){const{resolvedUrl:c,session:d}=u,l=s(u);return(0,n.assert)(this.sessionInfoMap.has(l)===this.sessionLastDiscoveredMap.has(l),2605),d!==void 0?(this.sessionInfoMap.set(l,(0,i.getDiscoveredFluidResolvedUrl)(c,d)),this.sessionLastDiscoveredMap.set(l,Date.now())):this.sessionInfoMap.has(l)||(this.sessionInfoMap.set(l,c),this.sessionLastDiscoveredMap.set(l,0)),(await this.getSessionInfo(u)).resolvedUrl}async getSessionInfo(u){const c=s(u);(0,n.assert)(this.sessionInfoMap.has(c)&&this.sessionLastDiscoveredMap.has(c),2606);let d=!1;const l=Date.now()-this.sessionLastDiscoveredMap.get(c)>e.RediscoverAfterTimeSinceDiscoveryMs;return this.enableDiscovery&&l&&(await this.fetchAndUpdateSessionInfo(u).catch(f=>{throw this.sessionLastDiscoveredMap.set(c,0),f}),d=!0),{refreshed:d,resolvedUrl:{...this.sessionInfoMap.get(c)}}}async fetchAndUpdateSessionInfo(u){const{documentId:c,ordererRestWrapper:d,logger:l,resolvedUrl:f}=u,b=s(u),C=await t.PerformanceEvent.timedExecAsync(l,{eventName:"DiscoverSession",docId:c},async v=>{const m=await d.get(b);return v.end({...m.propsToLog,...(0,a.getW3CData)(m.requestUrl,"xmlhttprequest")}),m.content});this.sessionInfoMap.set(b,(0,i.getDiscoveredFluidResolvedUrl)(f,C)),this.sessionLastDiscoveredMap.set(b,Date.now())}}e.SessionInfoManager=r;function s(o){const{resolvedUrl:u,tenantId:c,documentId:d}=o;return`${u.endpoints.ordererUrl}/documents/${c}/session/${d}`}})(FD)),FD}var dZ;function XTe(){if(dZ)return Vu;dZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Vu,"__esModule",{value:!0}),Vu.createRouterliciousDocumentServiceFactory=Vu.DocumentPostCreateError=Vu.RouterliciousDocumentServiceFactory=void 0;const e=Je(),n=on(),a=Kn(),t=Qq,i=Ot(),r=Yq(),s=JTe(),o=gb(),u=oce(),c=Xoe(),d=QTe(),l=YTe(),f=cce(),b=432e6,C={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0,enableInternalSummaryCaching:!0,enableLongPollingDowngrade:!0};class v{constructor(_,S={}){this.tokenProvider=_,this.wholeSnapshotTreeCache=new r.NullCache,this.shreddedSummaryTreeCache=new r.NullCache;const p=b;this.driverPolicies={...C,...S},this.blobCache=new r.InMemoryCache,this.driverPolicies.enableInternalSummaryCaching&&(this.driverPolicies.enableWholeSummaryUpload?this.wholeSnapshotTreeCache=new r.InMemoryCache(p):this.shreddedSummaryTreeCache=new r.InMemoryCache(p)),this.sessionInfoManager=new l.SessionInfoManager(this.driverPolicies.enableDiscovery)}get ILayerCompatDetails(){return u.r11sDriverCompatDetailsForLoader}async createContainer(_,S,p,w){if(_===void 0)throw new Error("Empty file summary creation isn't supported in this driver.");(0,e.assert)(!!S.endpoints.ordererUrl,178);const O=new URL(S.url);if(!O.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,E]=O.pathname.split("/");if(!(0,a.isCombinedAppAndProtocolSummary)(_))throw new Error("Protocol and App Summary required in the full summary");const F=_.tree[".protocol"],R=_.tree[".app"],M=(0,a.getDocAttributesFromProtocolSummary)(F),j=(0,a.getQuorumValuesFromProtocolSummary)(F),k=(0,i.createChildLogger)({logger:p,namespace:"RouterliciousDriver"}),x=(0,c.toInstrumentedR11sOrdererTokenFetcher)(E,void 0,this.tokenProvider,k),L=new a.RateLimiter(this.driverPolicies.maxConcurrentOrdererRequests),V=c.RouterliciousOrdererRestWrapper.load(x,k,L,this.driverPolicies.enableRestLess,S.endpoints.ordererUrl),G=(0,d.isRouterliciousResolvedUrl)(S)?S.createAsEphemeral===!0:!1,ee=await i.PerformanceEvent.timedExecAsync(k,{eventName:"CreateNew",details:JSON.stringify({enableDiscovery:this.driverPolicies.enableDiscovery,sequenceNumber:M.sequenceNumber,isEphemeralContainer:G})},async de=>{const ge=(await V.post(`/documents/${E}`,{summary:(0,t.convertSummaryTreeToWholeSummaryTree)(void 0,R),sequenceNumber:M.sequenceNumber,values:j,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:this.tokenProvider.documentPostCreateCallback!==void 0,isEphemeralContainer:G,enableAnyBinaryBlobOnFirstSummary:!0})).content;return de.end({docId:typeof ge=="string"?ge:ge.id}),ge});let se,re,fe;typeof ee=="string"?se=ee:(se=ee.id,re=ee.token,fe=this.driverPolicies.enableDiscovery?ee.session:void 0);try{await i.PerformanceEvent.timedExecAsync(k,{eventName:"DocPostCreateCallback",docId:se},async()=>{if(re&&this.tokenProvider.documentPostCreateCallback!==void 0)return this.tokenProvider.documentPostCreateCallback(se,re)})}catch(de){throw new m(de)}O.pathname=(0,f.replaceDocumentIdInPath)(O.pathname,se);const oe=S.endpoints.deltaStorageUrl;if(!oe)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${oe}]`);const pe=new URL(oe);return pe.pathname=(0,f.replaceDocumentIdInPath)(pe.pathname,se),this.createDocumentService({...S,url:O.toString(),id:se,endpoints:{...S.endpoints,deltaStorageUrl:pe.toString()}},p,w,fe)}async createDocumentService(_,S,p,w){const O=new URL(_.url),[,E,F]=O.pathname.split("/");if(!F||!E)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${F}][tenantId:${E}]`);const R=(0,i.createChildLogger)({logger:S,namespace:"RouterliciousDriver",properties:{all:{driverVersion:o.pkgVersion}}}),M=(0,c.toInstrumentedR11sOrdererTokenFetcher)(E,F,this.tokenProvider,R),j=(0,c.toInstrumentedR11sStorageTokenFetcher)(E,F,this.tokenProvider,R),k=M(),x=j(),L=new a.RateLimiter(this.driverPolicies.maxConcurrentOrdererRequests),V=c.RouterliciousOrdererRestWrapper.load(M,R,L,this.driverPolicies.enableRestLess,void 0,k),G=await this.sessionInfoManager.initializeSessionInfo({session:w,resolvedUrl:_,documentId:F,tenantId:E,ordererRestWrapper:V,logger:R}),ee=G.endpoints.storageUrl,se=G.endpoints.ordererUrl,re=G.endpoints.deltaStorageUrl,fe=G.endpoints.deltaStreamUrl||se;if(!se||!re)throw new Error(`All endpoints urls must be provided. [ordererUrl:${se}][deltaStorageUrl:${re}]`);const oe=c.RouterliciousStorageRestWrapper.load(E,j,R,new a.RateLimiter(this.driverPolicies.maxConcurrentStorageRequests),this.driverPolicies.enableRestLess,ee,x),pe={caching:this.driverPolicies.enablePrefetch?n.LoaderCachingPolicy.Prefetch:n.LoaderCachingPolicy.NoCaching,maximumCacheDurationMs:b};return new s.DocumentService(G,se,re,fe,ee,R,this.tokenProvider,E,F,V,pe,this.driverPolicies,this.blobCache,this.wholeSnapshotTreeCache,this.shreddedSummaryTreeCache,async()=>this.sessionInfoManager.getSessionInfo({resolvedUrl:_,documentId:F,tenantId:E,ordererRestWrapper:V,logger:R}),oe,j,M)}}Vu.RouterliciousDocumentServiceFactory=v;class m extends Error{constructor(_){super(_.message),this.innerError=_,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}Vu.DocumentPostCreateError=m;function h(g){return new v(g)}return Vu.createRouterliciousDocumentServiceFactory=h,Vu}var lZ;function ZTe(){return lZ||(lZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.r11sDriverCompatDetailsForLoader=e.RouterliciousDocumentServiceFactory=e.DocumentPostCreateError=e.createRouterliciousDocumentServiceFactory=e.RouterliciousErrorTypes=e.DefaultTokenProvider=void 0;var n=tCe();Object.defineProperty(e,"DefaultTokenProvider",{enumerable:!0,get:function(){return n.DefaultTokenProvider}});var a=tI();Object.defineProperty(e,"RouterliciousErrorTypes",{enumerable:!0,get:function(){return a.RouterliciousErrorTypes}});var t=XTe();Object.defineProperty(e,"createRouterliciousDocumentServiceFactory",{enumerable:!0,get:function(){return t.createRouterliciousDocumentServiceFactory}}),Object.defineProperty(e,"DocumentPostCreateError",{enumerable:!0,get:function(){return t.DocumentPostCreateError}}),Object.defineProperty(e,"RouterliciousDocumentServiceFactory",{enumerable:!0,get:function(){return t.RouterliciousDocumentServiceFactory}});var i=oce();Object.defineProperty(e,"r11sDriverCompatDetailsForLoader",{enumerable:!0,get:function(){return i.r11sDriverCompatDetailsForLoader}})})(_N)),_N}var N_={},fZ;function ewe(){if(fZ)return N_;fZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(N_,"__esModule",{value:!0}),N_.createAzureAudienceMember=void 0;function e(a){const t=a.user;return n(t),{id:t.id,name:t.name,connections:[],additionalDetails:t.additionalDetails}}N_.createAzureAudienceMember=e;function n(a){const t=a,i='Provided user data was not an "AzureUser".';if(t.id===void 0)throw new TypeError(`${i} Missing required "id" property.`);if(t.name===void 0)throw new TypeError(`${i} Missing required "name" property.`)}return N_}var kp={},hZ;function twe(){if(hZ)return kp;hZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(kp,"__esModule",{value:!0}),kp.createAzureCreateNewRequest=kp.AzureUrlResolver=void 0;const e=on();let n=class{constructor(){}async resolve(r){const{ordererUrl:s,storageUrl:o,tenantId:u,containerId:c}=a(r.url);if(r.headers&&r.headers[e.DriverHeader.createNew]===!0)return{endpoints:{deltaStorageUrl:`${s}/deltas/${u}/new`,ordererUrl:s,storageUrl:`${o}/repos/${u}`},id:"",tokens:{},type:"fluid",url:`${s}/${u}/new`};if(c===void 0)throw new Error("Azure URL did not contain containerId");const d=`${s}/${u}/${c}`;return{endpoints:{deltaStorageUrl:`${s}/deltas/${u}/${c}`,ordererUrl:s,storageUrl:`${o}/repos/${u}`},id:c,tokens:{},type:"fluid",url:d}}async getAbsoluteUrl(r,s){if(r.type!=="fluid")throw new Error("Invalid Resolved Url");return`${r.url}/${s}`}};kp.AzureUrlResolver=n;function a(i){const r=new URL(i),s=r.origin,o=r.searchParams,u=o.get("storage");if(u===null)throw new Error("Azure URL did not contain a storage URL");const c=o.get("tenantId");if(c===null)throw new Error("Azure URL did not contain a tenant ID");const d=decodeURIComponent(u),l=decodeURIComponent(c),f=o.get("containerId"),b=f===null?void 0:decodeURIComponent(f);return{ordererUrl:s,storageUrl:d,tenantId:l,containerId:b}}const t=(i,r)=>{const s=new URL(i);return s.searchParams.append("storage",encodeURIComponent(i)),s.searchParams.append("tenantId",encodeURIComponent(r)),{url:s.href,headers:{[e.DriverHeader.createNew]:!0}}};return kp.createAzureCreateNewRequest=t,kp}var xp={},mZ;function nwe(){if(mZ)return xp;mZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(xp,"__esModule",{value:!0}),xp.isAzureLocalConnectionConfig=xp.isAzureRemoteConnectionConfig=void 0;function e(a){return a.type==="remote"}xp.isAzureRemoteConnectionConfig=e;function n(a){return a.type==="local"}return xp.isAzureLocalConnectionConfig=n,xp}var pZ;function rwe(){if(pZ)return yv;pZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(yv,"__esModule",{value:!0}),yv.AzureClient=void 0;const e=Mr(),n=Mr(),a=Lie(),t=Kn(),i=eCe(),r=ZTe(),s=Ot(),o=ewe(),u=twe(),c=nwe(),d="local",l=m=>(0,c.isAzureRemoteConnectionConfig)(m)?m.tenantId:d,f=5,b={"Fluid.Container.ForceWriteConnection":!0};function C(m){return(0,s.wrapConfigProviderWithDefaults)(m,b)}let v=class{constructor(h){this.connectionConfig=h.connection,this.logger=h.logger,this.connectionConfig.endpoint=this.connectionConfig.endpoint.replace(/\/$/,""),this.urlResolver=new u.AzureUrlResolver;const g=(0,c.isAzureRemoteConnectionConfig)(this.connectionConfig),_=new r.RouterliciousDocumentServiceFactory(this.connectionConfig.tokenProvider,{enableWholeSummaryUpload:g,enableDiscovery:g});this.documentServiceFactory=(0,t.applyStorageCompression)(_,h.summaryCompression),this.configProvider=C(h.configProvider),this.createContainerRuntimeFactory=h.createContainerRuntimeFactory}async createContainer(h,g){const _=this.getLoaderProps(h,g),S=await(0,a.createDetachedContainer)({..._,codeDetails:{package:"no-dynamic-package",config:{}}}),p=await this.createFluidContainer(S,this.connectionConfig),w=this.getContainerServices(S);return{container:p,services:w}}async getContainer(h,g,_){const S=this.getLoaderProps(g,_),p=new URL(this.connectionConfig.endpoint);p.searchParams.append("storage",encodeURIComponent(this.connectionConfig.endpoint)),p.searchParams.append("tenantId",encodeURIComponent(l(this.connectionConfig))),p.searchParams.append("containerId",encodeURIComponent(h));const w=await(0,a.loadExistingContainer)({...S,request:{url:p.href}}),O=await(0,i.createFluidContainer)({container:w}),E=this.getContainerServices(w);return{container:O,services:E}}async viewContainerVersion(h,g,_,S){const p=this.getLoaderProps(g,S),w=new URL(this.connectionConfig.endpoint);w.searchParams.append("storage",encodeURIComponent(this.connectionConfig.endpoint)),w.searchParams.append("tenantId",encodeURIComponent(l(this.connectionConfig))),w.searchParams.append("containerId",encodeURIComponent(h));const O=await(0,a.loadContainerPaused)(p,{url:w.href,headers:{[n.LoaderHeader.version]:_.id}});return{container:await(0,i.createFluidContainer)({container:O})}}async getContainerVersions(h,g){const _=new URL(this.connectionConfig.endpoint);_.searchParams.append("storage",encodeURIComponent(this.connectionConfig.endpoint)),_.searchParams.append("tenantId",encodeURIComponent(l(this.connectionConfig))),_.searchParams.append("containerId",encodeURIComponent(h));const S=await this.urlResolver.resolve({url:_.href});if(!S)throw new Error("Unable to resolved URL");return(await(await(await this.documentServiceFactory.createDocumentService(S)).connectToStorage()).getVersions(null,g?.maxCount??f)).map(E=>({id:E.id,date:E.date}))}getContainerServices(h){return{audience:(0,i.createServiceAudience)({container:h,createServiceMember:o.createAzureAudienceMember})}}getLoaderProps(h,g){const _=this.createContainerRuntimeFactory?this.createContainerRuntimeFactory({schema:h,compatibilityMode:g}):(0,i.createDOProviderContainerRuntimeFactory)({schema:h,compatibilityMode:g}),p={load:async()=>({module:{fluidExport:_},details:{package:"no-dynamic-package",config:{}}})},w={details:{capabilities:{interactive:!0}},permission:[],scopes:[],user:{id:""},mode:"write"};return{urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:p,logger:this.logger,options:{client:w},configProvider:this.configProvider}}async createFluidContainer(h,g){const _=(0,u.createAzureCreateNewRequest)(g.endpoint,l(g)),S=async()=>{if(h.attachState!==e.AttachState.Detached)throw new Error("Cannot attach container. Container is not in detached state");if(await h.attach(_),h.resolvedUrl===void 0)throw new Error("Resolved Url not available on attached container");return h.resolvedUrl.id},p=await(0,i.createFluidContainer)({container:h});return p.attach=S,p}};return yv.AzureClient=v,yv}var gZ;function uce(){return gZ||(gZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.AzureClient=void 0;var n=rwe();Object.defineProperty(e,"AzureClient",{enumerable:!0,get:function(){return n.AzureClient}})})(TF)),TF}var qp={},A_={},Lp={},jD={},MD={},ND={},AD={},Qu={},Bp={},yZ;function iwe(){if(yZ)return Bp;yZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Bp,"__esModule",{value:!0}),Bp.AttributionCollection=Bp.areEqualAttributionKeys=void 0;const e=Je(),n=Ot();function a(i,r){if(!i&&!r)return!0;if(!i||!r||i.type!==r.type)return!1;switch(i.type){case"op":return i.seq===r.seq;case"detached":return i.id===r.id;case"local":return!0;default:(0,e.unreachableCase)(i,"Unhandled AttributionKey type")}}Bp.areEqualAttributionKeys=a;class t{get channelEntries(){return Object.entries(this.channels??{})}constructor(r,s){this._length=r,this.offsets=[],this.keys=[],s!==void 0&&(this.offsets.push(0),this.keys.push(s))}get channelNames(){return Object.keys(this.channels??{})}getAtOffset(r,s){return s!==void 0?this.channels?.[s]?.getAtOffset(r):((0,e.assert)(r>=0&&r<this._length,1091),this.get(this.findIndex(r)))}getKeysInOffsetRange(r,s,o){if(r<0||r>=this._length)throw new n.UsageError("startOffset should be valid and in range");if(s!==void 0&&(s<0||s>=this._length||r>s))throw new n.UsageError("endOffset should be valid and in range");if(o!==void 0)return this.channels?.[o]?.getKeysInOffsetRange(r,s);const u=[];let c=this.findIndex(r),d=this.get(c);d!==void 0&&u.push({offset:this.offsets[c],key:d}),c++;const l=s??Number.MAX_SAFE_INTEGER;for(;c<this.offsets.length&&l>=this.offsets[c];)d=this.get(c),d!==void 0&&u.push({offset:this.offsets[c],key:d}),c++;return u}findIndex(r){let s=0;for(;s<this.offsets.length&&r>this.offsets[s];)s++;return this.offsets[s]===r?s:s-1}get(r){return this.keys[r]??void 0}get length(){return this._length}splitAt(r){const s=this.findIndex(r),o=new t(this.length-r);for(let c=s;c<this.keys.length;c++)o.offsets.push(Math.max(this.offsets[c]-r,0)),o.keys.push(this.keys[c]);if(this.channels){o.channels={};for(const[c,d]of this.channelEntries)o.channels[c]=d.splitAt(r)}const u=this.offsets[s]===r?s:s+1;return this.keys.splice(u),this.offsets.splice(u),this._length=r,o}append(r){const s=this.keys[this.keys.length-1];for(let o=0;o<r.keys.length;o++)(o!==0||!a(s,r.keys[o]))&&(this.offsets.push(r.offsets[o]+this.length),this.keys.push(r.keys[o]));if(r.channels!==void 0||this.channels!==void 0){this.channels??={};for(const[o,u]of r.channelEntries)(this.channels[o]??=new t(this.length,null)).append(u);for(const[o,u]of this.channelEntries)r.channels?.[o]===void 0&&u.append(new t(r.length,null))}this._length+=r.length}getAll(){const r=Array.from({length:this.keys.length});for(let o=0;o<this.keys.length;o++)r[o]={offset:this.offsets[o],key:this.keys[o]};const s={root:r,length:this.length};if(this.channels!==void 0){s.channels={};for(const[o,u]of this.channelEntries)s.channels[o]=u.getAll().root}return s}clone(){const r=new t(this.length);if(r.keys=[...this.keys],r.offsets=[...this.offsets],this.channels!==void 0){const s={};for(const[o,u]of this.channelEntries)s[o]=u.clone();r.channels=s}return r}update(r,s){(0,e.assert)(s.length===this.length,1472),r===void 0?(this.offsets=[...s.offsets],this.keys=[...s.keys]):(this.channels??={},this.channels[r]===void 0?this.channels[r]=s:this.channels[r]?.update(void 0,s))}static populateAttributionCollections(r,s){const{channels:o}=s;(0,e.assert)(s.seqs.length===s.posBreakpoints.length,1093);const u=({seqs:c,posBreakpoints:d},l)=>{if(c.length===0){(0,e.assert)(d.length===0,2529);return}let f=0,b=0;for(const C of r){const v=new t(C.cachedLength),m=(h,g)=>{v.offsets.push(h),v.keys.push(g===null?null:typeof g=="object"?g:{type:"op",seq:g})};for(d[f]>b&&f--;d[f]<b+C.cachedLength;){const h=Math.max(d[f]-b,0);m(h,c[f]),f++}v.offsets.length===0&&m(0,c[f-1]),l(v,C),b+=C.cachedLength}};if(u(s,(c,d)=>{d.attribution=c}),o)for(const[c,d]of Object.entries(o))u(d,(l,f)=>{f.attribution!==void 0&&((f.attribution.channels??={})[c]=l)})}static serializeAttributionCollections(r){const s=[],o=new Set;for(const d of r){const f=(d.attribution??new t(d.cachedLength,null)).getAll();if(s.push(f),f.channels)for(const b of Object.keys(f.channels))o.add(b)}const u=d=>{const l=[],f=[];let b,C=0;for(const v of s){for(const{offset:m,key:h}of d(v))(0,e.assert)(h?.type!=="local",1473),(b===void 0||!a(h,b))&&(l.push(m+C),f.push(h?h.type==="op"?h.seq:h:null)),b=h;C+=v.length}return{seqs:f,posBreakpoints:l,length:C}},c=u(d=>d.root);if(o.size>0){const d={};for(const l of o){const{posBreakpoints:f,seqs:b}=u(C=>C.channels?.[l]??[{offset:0,key:null}]);d[l]={posBreakpoints:f,seqs:b}}c.channels=d}return c}}return Bp.AttributionCollection=t,Bp}var D_={},bZ;function mI(){if(bZ)return D_;bZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(D_,"__esModule",{value:!0}),D_.MergeTreeMaintenanceType=void 0,D_.MergeTreeMaintenanceType={APPEND:-1,SPLIT:-2,UNLINK:-3,ACKNOWLEDGED:-4},D_}var Up={},vZ;function _l(){if(vZ)return Up;vZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Up,"__esModule",{value:!0}),Up.MergeTreeDeltaType=Up.ReferenceType=void 0;var e;return(function(n){n[n.Simple=0]="Simple",n[n.Tile=1]="Tile",n[n.RangeBegin=16]="RangeBegin",n[n.RangeEnd=32]="RangeEnd",n[n.SlideOnRemove=64]="SlideOnRemove",n[n.StayOnRemove=128]="StayOnRemove",n[n.Transient=256]="Transient"})(e||(Up.ReferenceType=e={})),Up.MergeTreeDeltaType={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3,OBLITERATE:4,OBLITERATE_SIDED:5},Up}var DD={},As={},SZ;function Da(){if(SZ)return As;SZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(As,"__esModule",{value:!0}),As.SquashClient=As.NonCollabClient=As.LocalClientId=As.TreeMaintenanceSequenceNumber=As.UnassignedSequenceNumber=As.UniversalSequenceNumber=void 0,As.UniversalSequenceNumber=0,As.UnassignedSequenceNumber=-1,As.TreeMaintenanceSequenceNumber=-2,As.LocalClientId=-1,As.NonCollabClient=-2,As.SquashClient=-3,As}var kD={},xD={},Yu={},k_={},x_={},CZ;function eL(){if(CZ)return x_;CZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(x_,"__esModule",{value:!0}),x_.SortedSet=void 0;class e{constructor(){this.sortedItems=[]}get size(){return this.sortedItems.length}get items(){return this.sortedItems}addOrUpdate(a,t){const i=this.findItemPosition(a);i.exists?t?.(this.sortedItems[i.index],a):this.sortedItems.splice(i.index,0,a)}remove(a){const t=this.findItemPosition(a);return t.exists?(this.sortedItems.splice(t.index,1),!0):!1}has(a){return this.findItemPosition(a).exists}findItemPosition(a){if(this.sortedItems.length===0)return{exists:!1,index:0};let t=0,i=this.sortedItems.length-1,r=-1;for(;t<=i;){r=t+Math.floor((i-t)/2);const s=this.compare(a,this.sortedItems[r]);if(s<0){if(t===r)return{exists:!1,index:r};i=r-1}else if(s>0){if(r===i)return{exists:!1,index:r+1};t=r+1}else if(s===0)return this.onFindEquivalent(a,r)}return{exists:!1,index:r}}onFindEquivalent(a,t){return{exists:!0,index:t}}}return x_.SortedSet=e,x_}var _Z;function tL(){if(_Z)return k_;_Z=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(k_,"__esModule",{value:!0}),k_.SortedSegmentSet=void 0;const e=ka(),n=eL();class a extends n.SortedSet{getOrdinal(i){const r=i;if(r.getSegment!==void 0&&r.isLeaf?.()===!1){const s=r;return(0,e.toMergeNodeInfo)(s.getSegment())?.ordinal??""}return(0,e.hasProp)(i,"segment","object")?(0,e.toMergeNodeInfo)(i.segment)?.ordinal??"":(0,e.toMergeNodeInfo)(i)?.ordinal??""}getOffset(i){const r=i;return r.getSegment!==void 0&&r.isLeaf?.()===!1?r.getOffset():0}onSortOrderChange(){this.sortedItems.sort((i,r)=>this.compare(i,r))}compare(i,r){const s=this.getOrdinal(i),o=this.getOrdinal(r);return s<o?-1:s>o?1:this.getOffset(i)-this.getOffset(r)}onFindEquivalent(i,r){let s=r;if(i===this.sortedItems[s])return{exists:!0,index:s};for(let o=s-1;o>=0&&this.compare(i,this.sortedItems[o])===0;o--)if(this.sortedItems[o]===i)return{exists:!0,index:o};for(s+1;s<this.sortedItems.length&&this.compare(i,this.sortedItems[s])===0;s++)if(this.sortedItems[s]===i)return{exists:!0,index:s};return{exists:!1,index:s}}}return k_.SortedSegmentSet=a,k_}var TZ;function jT(){if(TZ)return Yu;TZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Yu,"__esModule",{value:!0}),Yu.TrackingGroupCollection=Yu.UnorderedTrackingGroup=Yu.TrackingGroup=void 0;const e=tL();class n{constructor(){this.trackedSet=new e.SortedSegmentSet}get tracked(){return this.trackedSet.items}get size(){return this.trackedSet.size}has(r){return this.trackedSet.has(r)}link(r){this.trackedSet.has(r)||(this.trackedSet.addOrUpdate(r),r.trackingCollection.link(this))}unlink(r){return this.trackedSet.remove(r)?(r.trackingCollection.unlink(this),!0):!1}}Yu.TrackingGroup=n;class a{constructor(){this.trackedSet=new Set}get tracked(){return[...this.trackedSet]}get size(){return this.trackedSet.size}has(r){return this.trackedSet.has(r)}link(r){this.trackedSet.has(r)||(this.trackedSet.add(r),r.trackingCollection.link(this))}unlink(r){return this.trackedSet.delete(r)?(r.trackingCollection.unlink(this),!0):!1}}Yu.UnorderedTrackingGroup=a;class t{get trackingGroups(){return this._trackingGroups}constructor(r){this.trackable=r,this._trackingGroups=new Set}link(r){r&&(this._trackingGroups.has(r)||this._trackingGroups.add(r),r.has(this.trackable)||r.link(this.trackable))}unlink(r){return this._trackingGroups.has(r)?(r.has(this.trackable)&&r.unlink(this.trackable),this._trackingGroups.delete(r),!0):!1}copyTo(r){for(const s of this._trackingGroups)r.trackingCollection.link(s)}get empty(){return this._trackingGroups.size===0}matches(r){if(!r||this._trackingGroups.size!==r._trackingGroups.size)return!1;for(const s of this._trackingGroups.values())if(!r._trackingGroups.has(s))return!1;return!0}}return Yu.TrackingGroupCollection=t,Yu}var Ds={},wZ;function yd(){if(wZ)return Ds;wZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.createMap=Ds.extendIfUndefined=Ds.addProperties=Ds.clone=Ds.extend=Ds.matchProperties=void 0;function e(s,o){if(!s&&!o)return!0;const u=s?Object.keys(s):[],c=o?Object.keys(o):[];if(u.length!==c.length)return!1;for(const d of u){if(o?.[d]===void 0)return!1;if(typeof o[d]=="object"){if(!e(s?.[d],o[d]))return!1}else if(o[d]!==s?.[d])return!1}return!0}Ds.matchProperties=e;function n(s,o){if(o!==void 0)for(const[u,c]of Object.entries(o))c!==void 0&&(c===null?delete s[u]:s[u]=c);return s}Ds.extend=n;function a(s){if(s===void 0)return;const o=r();return n(o,s)}Ds.clone=a;function t(s,o){return n(s??r(),o)}Ds.addProperties=t;function i(s,o){if(o!==void 0)for(const[u,c]of Object.entries(o))s[u]===void 0&&(s[u]=c);return s}Ds.extendIfUndefined=i;function r(){return Object.create(null)}return Ds.createMap=r,Ds}var qD={},OZ;function MT(){return OZ||(OZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.compareReferencePositions=e.maxReferencePosition=e.minReferencePosition=e.DetachedReferencePosition=e.refHasTileLabels=e.refHasTileLabel=e.refGetTileLabels=e.refTypeIncludesFlag=e.reservedRangeLabelsKey=e.reservedTileLabelsKey=void 0;const n=_l(),a=ka();e.reservedTileLabelsKey="referenceTileLabels",e.reservedRangeLabelsKey="referenceRangeLabels";function t(d,l){return((typeof d=="number"?d:d.refType)&l)!==0}e.refTypeIncludesFlag=t;const i=d=>t(d,n.ReferenceType.Tile)&&d.properties?d.properties[e.reservedTileLabelsKey]:void 0;e.refGetTileLabels=i;function r(d,l){return(0,e.refGetTileLabels)(d)?.includes(l)??!1}e.refHasTileLabel=r;function s(d){return(0,e.refGetTileLabels)(d)!==void 0}e.refHasTileLabels=s,e.DetachedReferencePosition=-1;function o(d,l){return c(d,l)<0?d:l}e.minReferencePosition=o;function u(d,l){return c(d,l)>0?d:l}e.maxReferencePosition=u;function c(d,l){const f=d.getSegment(),b=l.getSegment();return f===b?d.getOffset()-l.getOffset():!(0,a.isMergeNodeInfo)(f)||(0,a.isMergeNodeInfo)(b)&&f.ordinal<b.ordinal?-1:1}e.compareReferencePositions=c})(qD)),qD}var PZ;function NT(){return PZ||(PZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.LocalReferenceCollection=e.setValidateRefCount=e.filterLocalReferencePositions=e.anyLocalReferencePosition=e.createDetachedLocalReferencePosition=e.SlidingPreference=void 0;const n=Je(),a=Ot(),t=jT(),i=_l(),r=yd(),s=MT();e.SlidingPreference={BACKWARD:0,FORWARD:1};function o(m){let h=0;if((0,s.refTypeIncludesFlag)(m,i.ReferenceType.Transient)&&++h,(0,s.refTypeIncludesFlag)(m,i.ReferenceType.SlideOnRemove)&&++h,(0,s.refTypeIncludesFlag)(m,i.ReferenceType.StayOnRemove)&&++h,h>1)throw new a.UsageError("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}class u{get trackingCollection(){return this._trackingCollection??=new t.TrackingGroupCollection(this)}constructor(h=i.ReferenceType.Simple,g,_=e.SlidingPreference.FORWARD,S){this.refType=h,this.slidingPreference=_,this.canSlideToEndpoint=S,this.offset=0,o(h),this.properties=g}link(h,g,_){if(_!==this.listNode&&this.listNode!==void 0&&this.segment?.localRefs?.removeLocalRef(this),this.listNode=_,h!==this.segment){const S=[];for(const p of this.trackingCollection.trackingGroups)p.unlink(this),S.push(p);this.segment=h;for(const p of S)p.link(this)}this.offset=g}isLeaf(){return!1}addProperties(h){this.properties=(0,r.addProperties)(this.properties,h)}getSegment(){return this.segment}getOffset(){return this.offset}getListNode(){return this.listNode}getProperties(){return this.properties}}function c(m,h){return new u(h,void 0,m)}e.createDetachedLocalReferencePosition=c;function d(m){(0,n.assert)(m instanceof u,736)}function l(m,h){for(const g of m)if(h(g))return!0;return!1}e.anyLocalReferencePosition=l;function*f(m,h){for(const g of m)h(g)&&(yield g)}e.filterLocalReferencePositions=f;let b;function C(m){b=m}e.setValidateRefCount=C;class v{static append(h,g){g.localRefs&&!g.localRefs.empty?(h.localRefs||(h.localRefs=new v(h)),(0,n.assert)(h.localRefs.refsByOffset.length===h.cachedLength,702),h.localRefs.append(g.localRefs)):h.localRefs&&(h.localRefs.refsByOffset.length+=g.cachedLength),b?.(h.localRefs),b?.(g.localRefs)}static setOrGet(h){return h.localRefs??=new v(h)}constructor(h,g=Array.from({length:h.cachedLength})){this.segment=h,this.refCount=0,this.refsByOffset=g}[Symbol.iterator](){const h=[];for(const _ of this.refsByOffset)_&&(_.before&&h.push(_.before[Symbol.iterator]()),_.at&&h.push(_.at[Symbol.iterator]()),_.after&&h.push(_.after[Symbol.iterator]()));return{next(){for(;h.length>0;){const _=h[0].next();if(_.done===!0)h.shift();else return{done:_.done,value:_.value.data}}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}get empty(){return b?.(this),this.refCount===0}createLocalRef(h,g,_,S,p){const w=new u(g,_,S,p);return w.link(this.segment,h,void 0),(0,s.refTypeIncludesFlag)(w,i.ReferenceType.Transient)||this.addLocalRef(w,h),b?.(this),w}addLocalRef(h,g){if(d(h),(0,n.assert)(g<this.segment.cachedLength,840),(0,s.refTypeIncludesFlag)(h,i.ReferenceType.Transient))h.link(this.segment,g,void 0);else{const _=this.refsByOffset[g]=this.refsByOffset[g]??{at:new n.DoublyLinkedList},S=_.at=_.at??new n.DoublyLinkedList;h.link(this.segment,g,S.push(h).last),this.refCount++}b?.(this)}removeLocalRef(h){if(this.has(h)){d(h);const g=h.getListNode();return g?.list?.remove(g),h.link(void 0,0,void 0),this.refCount--,b?.(this),h}}append(h){if(!(!h||h.empty)){this.refCount+=h.refCount,h.refCount=0;for(const g of h)d(g),g.link(this.segment,g.getOffset()+this.refsByOffset.length,g.getListNode());this.refsByOffset.push(...h.refsByOffset),h.refsByOffset.length=0}}has(h){if(!(h instanceof u)||(0,s.refTypeIncludesFlag)(h,i.ReferenceType.Transient)||h.getSegment()!==this.segment)return!1;const _=h.getListNode();if(_===void 0)return!1;const S=h.getOffset(),p=this.refsByOffset[S];return!!(p?.before?.includes(_)||p?.at?.includes(_)||p?.after?.includes(_))}split(h,g){if(this.empty)this.refsByOffset.length=h;else{const _=new v(g,this.refsByOffset.splice(h,this.refsByOffset.length-h));g.localRefs=_;for(const S of _)d(S),S.link(g,S.getOffset()-h,S.getListNode()),this.refCount--,_.refCount++}b?.(this)}addBeforeTombstones(...h){const g=this.refsByOffset[0]?.before??new n.DoublyLinkedList;if(this.refsByOffset[0]?.before===void 0){const S=this.refsByOffset[0]??={before:g};S.before??=g}let _;for(const S of h)for(const p of S)d(p),!(0,s.refTypeIncludesFlag)(p,i.ReferenceType.StayOnRemove)&&((0,s.refTypeIncludesFlag)(p,i.ReferenceType.SlideOnRemove)?(p.callbacks?.beforeSlide?.(p),_=_===void 0?g.unshift(p)?.first:g.insertAfter(_,p)?.first,p.link(this.segment,0,_),this.refCount++,p.callbacks?.afterSlide?.(p)):p.link(void 0,0,void 0));b?.(this)}addAfterTombstones(...h){const g=this.segment.cachedLength-1,_=this.refsByOffset[g]?.after??new n.DoublyLinkedList;if(this.refsByOffset[g]?.after===void 0){const S=this.refsByOffset[g]??={after:_};S.after??=_}for(const S of h)for(const p of S)d(p),!(0,s.refTypeIncludesFlag)(p,i.ReferenceType.StayOnRemove)&&((0,s.refTypeIncludesFlag)(p,i.ReferenceType.SlideOnRemove)?(p.callbacks?.beforeSlide?.(p),_.push(p),p.link(this.segment,g,_.last),this.refCount++,p.callbacks?.afterSlide?.(p)):p.link(void 0,0,void 0));b?.(this)}isAfterTombstone(h){const g=this.refsByOffset[h.getOffset()]?.after;return g?(d(h),g.includes(h.getListNode())):!1}walkReferences(h,g,_=!0){if(g!==void 0){if(!this.has(g))throw new a.UsageError("start must be in collection");d(g)}let S=g?.getOffset()??(_?0:this.segment.cachedLength-1);const p=new n.DoublyLinkedList;p.push(this.refsByOffset[S]?.before,this.refsByOffset[S]?.at,this.refsByOffset[S]?.after);const w=g?.getListNode(),O=w?.list;if(O!==void 0)if(_)for(;!p.empty&&p.first!==w;)p.shift();else for(;!p.empty&&p.last!==w;)p.pop();const E=R=>(0,n.walkList)(R,M=>h(M.data),O===R?w:void 0,_),F=_?1:-1;for(;S>=0&&S<this.refsByOffset.length;){for(;p.length>0;){const R=_?p.shift():p.pop();if(R?.data!==void 0&&E(R.data)===!1)return!1}S+=F,p.push(this.refsByOffset[S]?.before,this.refsByOffset[S]?.at,this.refsByOffset[S]?.after)}return!0}}e.LocalReferenceCollection=v})(xD)),xD}var q_={},EZ;function swe(){if(EZ)return q_;EZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(q_,"__esModule",{value:!0}),q_.computeHierarchicalOrdinal=void 0;const e=Je();function n(a,t,i,r){(0,e.assert)(a<=16&&t<=a,1008);const s=1<<a-t;let o;if(r===void 0)o=i+String.fromCharCode(s-1);else{const u=r.charCodeAt(r.length-1);(0,e.assert)(u!==void 0,2477);const c=u+s;o=i+String.fromCharCode(c)}return o}return q_.computeHierarchicalOrdinal=n,q_}var $r={},Ar={},IZ;function ey(){if(IZ)return Ar;IZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.compare=Ar.hasAnyAckedOperation=Ar.spliceIntoList=Ar.isAcked=Ar.isSquashedOp=Ar.isLocal=Ar.equal=Ar.lte=Ar.greaterThan=Ar.gte=Ar.lessThan=void 0;const e=Da();function n(f,b){return f.seq===e.UnassignedSequenceNumber?b.seq===e.UnassignedSequenceNumber&&f.localSeq<b.localSeq:b.seq===e.UnassignedSequenceNumber?!0:f.seq<b.seq}Ar.lessThan=n;function a(f,b){return!n(f,b)}Ar.gte=a;function t(f,b){return f.seq===e.UnassignedSequenceNumber?b.seq!==e.UnassignedSequenceNumber||f.localSeq>b.localSeq:b.seq===e.UnassignedSequenceNumber?!1:f.seq>b.seq}Ar.greaterThan=t;function i(f,b){return!t(f,b)}Ar.lte=i;function r(f,b){return f.seq===b.seq&&f.clientId===b.clientId&&f.localSeq===b.localSeq}Ar.equal=r;function s(f){return f.seq===e.UnassignedSequenceNumber}Ar.isLocal=s;function o(f){return f.clientId===e.SquashClient&&f.seq===e.UniversalSequenceNumber}Ar.isSquashedOp=o;function u(f){return f.seq!==e.UnassignedSequenceNumber}Ar.isAcked=u;function c(f,b){if(s(b)||f.length===0)f.push(b);else{for(let C=f.length-1;C>=0;C--)if(t(b,f[C])){f.splice(C+1,0,b);return}f.unshift(b)}}Ar.spliceIntoList=c;function d(f){return f.some(b=>u(b))}Ar.hasAnyAckedOperation=d;function l(f,b){return t(f,b)?1:n(f,b)?-1:0}return Ar.compare=l,Ar}var RZ;function ty(){if(RZ)return $r;RZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=$r&&$r.__createBinding||(Object.create?(function(v,m,h,g){g===void 0&&(g=h);var _=Object.getOwnPropertyDescriptor(m,h);(!_||("get"in _?!m.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return m[h]}}),Object.defineProperty(v,g,_)}):(function(v,m,h,g){g===void 0&&(g=h),v[g]=m[h]})),n=$r&&$r.__setModuleDefault||(Object.create?(function(v,m){Object.defineProperty(v,"default",{enumerable:!0,value:m})}):function(v,m){v.default=m}),a=$r&&$r.__importStar||function(v){if(v&&v.__esModule)return v;var m={};if(v!=null)for(var h in v)h!=="default"&&Object.prototype.hasOwnProperty.call(v,h)&&e(m,v,h);return n(m,v),m};Object.defineProperty($r,"__esModule",{value:!0}),$r.allAckedChangesPerspective=$r.RemoteObliteratePerspective=$r.LocalDefaultPerspective=$r.createLocalReconnectingPerspective=$r.LocalSquashPerspective=$r.LocalReconnectingPerspective=$r.PriorPerspective=void 0;const t=Da(),i=Rc(),r=ka(),s=a(ey());class o{isSegmentPresent(m){return!((0,r.isInserted)(m)&&!this.hasOccurred(m.insert)||(0,r.isRemoved)(m)&&m.removes.some(h=>this.hasOccurred(h)))}}class u extends o{constructor(m,h){super(),this.refSeq=m,this.clientId=h}hasOccurred(m){const h=(0,i.seqLTE)(m.seq,this.refSeq),g=m.clientId===this.clientId;return h||g}}$r.PriorPerspective=u;class c extends o{constructor(m,h,g){super(),this.refSeq=m,this.clientId=h,this.localSeq=g}hasOccurred(m){const h=(0,i.seqLTE)(m.seq,this.refSeq),g=m.localSeq!==void 0&&m.localSeq<=this.localSeq;return h||g}}$r.LocalReconnectingPerspective=c;class d extends c{constructor(m,h,g){super(m,h,g),this.refSeq=m,this.clientId=h,this.localSeq=g}isSegmentPresent(m){return(0,r.isInserted)(m)&&s.isLocal(m.insert)&&(0,r.isRemoved)(m)?!1:super.isSegmentPresent(m)}}$r.LocalSquashPerspective=d;function l(v,m,h,g=!1){return new(g?d:c)(v,m,h)}$r.createLocalReconnectingPerspective=l;class f extends o{constructor(m){super(),this.clientId=m,this.refSeq=Number.MAX_SAFE_INTEGER}hasOccurred(m){return!0}}$r.LocalDefaultPerspective=f;class b extends o{constructor(m){super(),this.clientId=m,this.refSeq=Number.MAX_SAFE_INTEGER}hasOccurred(m){return!(C(m)&&s.isLocal(m))}}$r.RemoteObliteratePerspective=b;function C(v){const{type:m}=v;return m==="setRemove"||m==="sliceRemove"}return $r.allAckedChangesPerspective=new u(Number.MAX_SAFE_INTEGER,t.NonCollabClient),$r}var FZ;function Rc(){return FZ||(FZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.compareStrings=e.compareNumbers=e.CollaborationWindow=e.getMinSeqPerspective=e.getMinSeqStamp=e.Marker=e.reservedMarkerSimpleTypeKey=e.reservedMarkerIdKey=e.BaseSegment=e.seqLTE=e.assignChild=e.MergeBlock=e.MaxNodesInBlock=e.segmentIsRemoved=e.assertSegmentLeaf=e.toSegmentLeaf=e.isSegmentLeaf=void 0;const n=Je(),a=Da(),t=NT(),i=jT(),r=swe(),s=ty(),o=yd(),u=ka(),c=O=>(0,u.isInserted)(O)&&(0,u.isMergeNodeInfo)(O);e.isSegmentLeaf=c;const d=O=>(0,e.isSegmentLeaf)(O)?O:void 0;e.toSegmentLeaf=d;const l=O=>(0,n.assert)((0,e.isSegmentLeaf)(O),2731);e.assertSegmentLeaf=l;function f(O){return(0,u.isRemoved)(O)}e.segmentIsRemoved=f,e.MaxNodesInBlock=8;class b{isLeaf(){return!1}constructor(E){this.childCount=E,this.index=0,this.ordinal="",this.cachedLength=0,this.children=new Array(e.MaxNodesInBlock),this.rightmostTiles=(0,o.createMap)(),this.leftmostTiles=(0,o.createMap)()}setOrdinal(E,F){const R=this.childCount;(0,n.assert)(R>=1&&R<=e.MaxNodesInBlock,64),E.ordinal=(0,r.computeHierarchicalOrdinal)(e.MaxNodesInBlock,R,this.ordinal,F===0?void 0:this.children[F-1]?.ordinal)}}e.MergeBlock=b;function C(O,E,F,R=!0){const M=Object.assign(E,{parent:O,index:F,ordinal:(0,u.hasProp)(E,"ordinal","string")?E.ordinal:""});R&&O.setOrdinal(M,F),O.children[F]=M}e.assignChild=C;function v(O,E){return O!==a.UnassignedSequenceNumber&&O<=E}e.seqLTE=v;class m{constructor(E){this.cachedLength=0,this.trackingCollection=new i.TrackingGroupCollection(this),E!==void 0&&(this.properties=(0,o.clone)(E))}hasProperty(E){return!!this.properties&&this.properties[E]!==void 0}isLeaf(){return!0}cloneInto(E){const F=E;(0,u.isInserted)(this)&&(0,u.overwriteInfo)(F,{insert:this.insert}),F.properties=(0,o.clone)(this.properties),(0,u.isRemoved)(this)&&(0,u.overwriteInfo)(F,{removes:[...this.removes]}),F.attribution=this.attribution?.clone()}canAppend(E){return!1}addSerializedProps(E){this.properties&&(E.props={...this.properties})}splitAt(E){if(E<=0)return;const F=this.createSplitSegmentAt(E);if(F)return(0,u.isMergeNodeInfo)(this)&&(0,u.overwriteInfo)(F,{index:this.index+1,ordinal:this.ordinal+"\0",parent:this.parent}),(0,u.isInserted)(this)&&(0,u.overwriteInfo)(F,{insert:this.insert}),(0,u.isRemoved)(this)&&(0,u.overwriteInfo)(F,{removes:[...this.removes]}),(0,u.isInsideObliterate)(this)&&(0,u.overwriteInfo)(F,{obliteratePrecedingInsertion:this.obliteratePrecedingInsertion,insertionRefSeqStamp:this.insertionRefSeqStamp}),this.trackingCollection.copyTo(F),this.attribution&&(F.attribution=this.attribution.splitAt(E)),F}append(E){t.LocalReferenceCollection.append(this,E),this.attribution?((0,n.assert)(E.attribution!==void 0,1213),this.attribution.append(E.attribution)):(0,n.assert)(E.attribution===void 0,1214),this.cachedLength??=0,this.cachedLength+=E.cachedLength}}e.BaseSegment=m,e.reservedMarkerIdKey="markerId",e.reservedMarkerSimpleTypeKey="markerSimpleType";class h extends m{static is(E){return E.type===h.type}static make(E,F){return new h(E,F)}constructor(E,F){super(F),this.refType=E,this.type=h.type,this.cachedLength=1}toJSONObject(){const E={marker:{refType:this.refType}};return super.addSerializedProps(E),E}static fromJSONObject(E){if(E&&typeof E=="object"&&"marker"in E)return h.make(E.marker.refType,E.props)}clone(){const E=h.make(this.refType,this.properties);return this.cloneInto(E),E}getSegment(){return this}getOffset(){return 0}getProperties(){return this.properties}getId(){return this.properties?.[e.reservedMarkerIdKey]}toString(){return`M${this.getId()}`}createSplitSegmentAt(E){}canAppend(E){return!1}append(){throw new Error("Can not append to marker")}}e.Marker=h,h.type="Marker";function g(O){return{seq:O.minSeq,clientId:a.NonCollabClient}}e.getMinSeqStamp=g;function _(O){return new s.PriorPerspective(O.minSeq,a.NonCollabClient)}e.getMinSeqPerspective=_;class S{constructor(){this.clientId=a.LocalClientId,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0,this.localPerspective=new s.LocalDefaultPerspective(this.clientId)}loadFrom(E){this.clientId=E.clientId,this.collaborating=E.collaborating,this.minSeq=E.minSeq,this.currentSeq=E.currentSeq}mintNextLocalOperationStamp(){return this.collaborating&&this.localSeq++,{seq:this.collaborating?a.UnassignedSequenceNumber:a.UniversalSequenceNumber,clientId:this.clientId,localSeq:this.localSeq}}}e.CollaborationWindow=S;const p=(O,E)=>O-E;e.compareNumbers=p;const w=(O,E)=>O.localeCompare(E);e.compareStrings=w})(kD)),kD}var jZ;function ka(){return jZ||(jZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.overwriteInfo=e.wasRemovedOnInsert=e.removeRemovalInfo=e.assertRemoved=e.isRemoved=e.toRemovalInfo=e.removeMergeNodeInfo=e.assertMergeNode=e.isMergeNodeInfo=e.toMergeNodeInfo=e.assertInserted=e.isInsideObliterate=e.isInserted=e.toInsertionInfo=e.propInstanceOf=e.hasProp=e.propExists=void 0;const n=Je(),a=Da(),t=Rc();function i(p,w){return(0,n.isObject)(p)&&w in p}e.propExists=i;function r(p,w,O){return i(p,w)&&(O==="array"?Array.isArray(p[w]):typeof p[w]===O)}e.hasProp=r;function s(p,w,O){return i(p,w)&&p[w]instanceof O}e.propInstanceOf=s;const o=p=>p!==void 0&&r(p,"insert","object")&&r(p.insert,"clientId","number")&&r(p.insert,"seq","number")?p:void 0;e.toInsertionInfo=o;const u=p=>(0,e.toInsertionInfo)(p)!==void 0;e.isInserted=u;const c=p=>p!==void 0&&r(p,"obliteratePrecedingInsertion","object");e.isInsideObliterate=c;const d=p=>(0,n.assert)(p===void 0||(0,e.isInserted)(p),2720);e.assertInserted=d;const l=p=>s(p,"parent",t.MergeBlock)&&r(p,"ordinal","string")&&r(p,"index","number")?p:void 0;e.toMergeNodeInfo=l;const f=p=>(0,e.toMergeNodeInfo)(p)!==void 0;e.isMergeNodeInfo=f;const b=p=>(0,n.assert)(p===void 0||(0,e.isMergeNodeInfo)(p),2721);e.assertMergeNode=b;const C=p=>Object.assign(p,{parent:void 0,index:void 0,ordinal:void 0});e.removeMergeNodeInfo=C;const v=p=>r(p,"removes","array")&&p.removes.length>0&&r(p.removes[0],"clientId","number")&&r(p.removes[0],"seq","number")?p:void 0;e.toRemovalInfo=v;const m=p=>(0,e.toRemovalInfo)(p)!==void 0;e.isRemoved=m;const h=p=>(0,n.assert)(p===void 0||(0,e.isRemoved)(p),2722);e.assertRemoved=h;const g=p=>Object.assign(p,{removes:void 0});e.removeRemovalInfo=g;function _(p){const O=(0,e.toRemovalInfo)(p)?.removes[0].seq;if(O===void 0||O===a.UnassignedSequenceNumber)return!1;const E=p.insert.seq;return E===a.UnassignedSequenceNumber||E>O}e.wasRemovedOnInsert=_;const S=(p,w)=>Object.assign(p,w);e.overwriteInfo=S})(DD)),DD}var MZ;function awe(){if(MZ)return Qu;MZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Qu,"__esModule",{value:!0}),Qu.createPropertyTrackingAndInsertionAttributionPolicyFactory=Qu.createPropertyTrackingAttributionPolicyFactory=Qu.createInsertOnlyAttributionPolicy=void 0;const e=Je(),n=iwe(),a=mI(),t=_l(),i=ka();function r({delta:v,maintenance:m}){let h;return{attach:g=>{(0,e.assert)(h===void 0,1367);const _=(p,w)=>v(p,w,g),S=(p,w)=>m(p,w,g);g.on("delta",_),g.on("maintenance",S),h=()=>{g.off("delta",_),g.off("maintenance",S)}},detach:()=>{h?.(),h=void 0},get isAttached(){return h!==void 0},serializer:n.AttributionCollection}}const s={delta:({op:v},{deltaSegments:m})=>{if(v.type===t.MergeTreeDeltaType.INSERT)for(const{segment:h}of m)h.attribution=new n.AttributionCollection(h.cachedLength)},maintenance:()=>{}},o=(v,m)=>m?{type:"op",seq:m.sequenceNumber}:v.getCollabWindow().collaborating?{type:"local"}:{type:"detached",id:0},u=(v,m)=>{for(const{segment:h}of v)(0,i.isInserted)(h)&&h.attribution?.update(void 0,new n.AttributionCollection(h.cachedLength,m))},c={delta:(v,{deltaSegments:m,operation:h},g)=>{h===t.MergeTreeDeltaType.INSERT&&u(m,o(g,v.sequencedMessage))},maintenance:({deltaSegments:v,operation:m},h,g)=>{m===a.MergeTreeMaintenanceType.ACKNOWLEDGED&&h?.op.type===t.MergeTreeDeltaType.INSERT&&u(v,o(g,h.sequencedMessage))}};function d(...v){const m=v.map(g=>({propName:g,channelName:g})),h=(g,_,{op:S},p)=>{for(const{segment:w,propertyDeltas:O}of _)for(const{propName:E,channelName:F}of m){const R=S.type===t.MergeTreeDeltaType.INSERT&&w.properties?.[E]!==void 0,M=S.type===t.MergeTreeDeltaType.ANNOTATE&&(S.props?.[E]!==void 0||S.adjust?.[E]!==void 0)&&(g||O!==void 0&&E in O);(R||M)&&w.attribution?.update(F,new n.AttributionCollection(w.cachedLength,p))}};return{delta:(g,{deltaSegments:_},S)=>{const{op:p,sequencedMessage:w}=g;(p.type===t.MergeTreeDeltaType.ANNOTATE||p.type===t.MergeTreeDeltaType.INSERT)&&h(w===void 0,_,g,o(S,w))},maintenance:({deltaSegments:g,operation:_},S,p)=>{_===a.MergeTreeMaintenanceType.ACKNOWLEDGED&&S!==void 0&&h(!0,g,S,o(p,S.sequencedMessage))}}}function l(v){return{delta:(...m)=>{for(const{delta:h}of v)h(...m)},maintenance:(...m)=>{for(const{maintenance:h}of v)h(...m)}}}function f(){return r(l([s,c]))}Qu.createInsertOnlyAttributionPolicy=f;function b(...v){return()=>r(l([s,d(...v)]))}Qu.createPropertyTrackingAttributionPolicyFactory=b;function C(...v){return()=>r(l([s,c,d(...v)]))}return Qu.createPropertyTrackingAndInsertionAttributionPolicyFactory=C,Qu}var Ao={},L_={},LD={},NZ;function dce(){return NZ||(NZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.TextSegment=e.TextSegmentGranularity=void 0;const n=Je(),a=Rc();e.TextSegmentGranularity=256;class t extends a.BaseSegment{static is(r){return r.type===t.type}static make(r,s){return new t(r,s)}static fromJSONObject(r){if(typeof r=="string")return new t(r);if(r&&typeof r=="object"&&"text"in r){const s=r;return t.make(s.text,s.props)}}constructor(r,s){super(s),this.text=r,this.type=t.type,this.cachedLength=r.length}toJSONObject(){return this.properties?{text:this.text,props:{...this.properties}}:this.text}clone(r=0,s){const o=this.text.slice(r,s),u=t.make(o,this.properties);return this.cloneInto(u),u}canAppend(r){return!this.text.endsWith(`
`)&&t.is(r)&&(this.cachedLength<=e.TextSegmentGranularity||r.cachedLength<=e.TextSegmentGranularity)}toString(){return this.text}append(r){(0,n.assert)(t.is(r),1095),super.append(r),this.text+=r.text}createSplitSegmentAt(r){if(r>0){const s=this.text.slice(Math.max(0,r));return this.text=this.text.slice(0,Math.max(0,r)),this.cachedLength=this.text.length,new t(s)}}}e.TextSegment=t,t.type="TextSegment"})(LD)),LD}var AZ;function owe(){if(AZ)return L_;AZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(L_,"__esModule",{value:!0}),L_.MergeTreeTextHelper=void 0;const e=dce();let n=class{constructor(i){this.mergeTree=i}getText(i,r="",s,o){const u=this.getValidRange(s,o,i),c={textSegment:new e.TextSegment(""),placeholder:r};return this.mergeTree.mapRange(a,i,c,u.start,u.end),c.textSegment.text}getValidRange(i,r,s){return{end:r??this.mergeTree.getLength(s),start:i??0}}};L_.MergeTreeTextHelper=n;function a(t,i,r,s,o,u,{textSegment:c,placeholder:d}){if(e.TextSegment.is(t))if(o<=0&&u>=t.text.length)c.text+=t.text;else{const l=t.text.length,f=o<0?0:o,b=u>=l?void 0:u;c.text+=t.text.slice(f,b)}else if(d&&d.length>0){const l=d==="*"?`
${t}`:d.repeat(t.cachedLength);c.text+=l}return!0}return L_}var BD={},UD={},DZ;function cwe(){return DZ||(DZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.RedBlackTree=e.RBColor=void 0,e.RBColor={RED:0,BLACK:1};class n{constructor(t,i){this.compareKeys=t,this.aug=i}makeNode(t,i,r,s){return{key:t,data:i,color:r,size:s}}isRed(t){return!!t&&t.color===e.RBColor.RED}nodeSize(t){return t?t.size:0}size(){return this.nodeSize(this.root)}isEmpty(){return!this.root}get(t){if(t!==void 0)return this.nodeGet(this.root,t)}nodeGet(t,i){let r=t;for(;r;){const s=this.compareKeys(i,r.key);if(s<0)r=r.left;else if(s>0)r=r.right;else return r}}contains(t){return this.get(t)}gather(t,i){const r=[];return t!==void 0&&this.nodeGather(this.root,r,t,i),r}nodeGather(t,i,r,s){t&&(s.continueSubtree(t.left,r)&&this.nodeGather(t.left,i,r,s),s.matchNode(t,r)&&i.push(t),s.continueSubtree(t.right,r)&&this.nodeGather(t.right,i,r,s))}walkExactMatchesForward(t,i,r,s){this.nodeWalkExactMatchesForward(this.root,t,i,r,s)}nodeWalkExactMatchesForward(t,i,r,s,o){if(!t)return;const u=i(t);s(u)&&this.nodeWalkExactMatchesForward(t.left,i,r,s,o),u===0&&r(t),o(u)&&this.nodeWalkExactMatchesForward(t.right,i,r,s,o)}walkExactMatchesBackward(t,i,r,s){this.nodeWalkExactMatchesBackward(this.root,t,i,r,s)}nodeWalkExactMatchesBackward(t,i,r,s,o){if(!t)return;const u=i(t);o(u)&&this.nodeWalkExactMatchesBackward(t.right,i,r,s,o),u===0&&r(t),s(u)&&this.nodeWalkExactMatchesBackward(t.left,i,r,s,o)}put(t,i,r){t!==void 0&&(i===void 0?this.remove(t):(this.root=this.nodePut(this.root,t,i,r),this.root.color=e.RBColor.BLACK))}nodePut(t,i,r,s){let o=t;if(o){const u=this.compareKeys(i,o.key);if(u<0)o.left=this.nodePut(o.left,i,r,s);else if(u>0)o.right=this.nodePut(o.right,i,r,s);else if(s){const c=s(i,o.key,r,o.data);c.key&&(o.key=c.key),o.data=c.data??r}else o.data=r;return this.isRed(o.right)&&!this.isRed(o.left)&&(o=this.rotateLeft(o)),this.isRed(o.left)&&this.isRed(o.left.left)&&(o=this.rotateRight(o)),this.isRed(o.left)&&this.isRed(o.right)&&this.flipColors(o),o.size=this.nodeSize(o.left)+this.nodeSize(o.right)+1,this.aug&&this.updateLocal(o),o}else return this.makeNode(i,r,e.RBColor.RED,1)}updateLocal(t){this.aug&&(this.isRed(t.left)&&this.aug.update(t.left),this.isRed(t.right)&&this.aug.update(t.right),this.aug.update(t))}nodeRemoveMin(t){let i=t;if(i.left)return!this.isRed(i.left)&&!this.isRed(i.left.left)&&(i=this.moveRedLeft(i)),i.left=this.nodeRemoveMin(i.left),this.balance(i)}remove(t){if(t!==void 0){if(!this.contains(t))return;this.removeExisting(t)}}removeExisting(t){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.color=e.RBColor.RED),this.root=this.nodeRemove(this.root,t)}nodeRemove(t,i){let r=t;if(this.compareKeys(i,r.key)<0)!this.isRed(r.left)&&!this.isRed(r.left.left)&&(r=this.moveRedLeft(r)),r.left=this.nodeRemove(r.left,i);else{if(this.isRed(r.left)&&(r=this.rotateRight(r)),this.compareKeys(i,r.key)===0&&!r.right)return;if(!this.isRed(r.right)&&!this.isRed(r.right.left)&&(r=this.moveRedRight(r)),this.compareKeys(i,r.key)===0){const s=this.nodeMin(r.right);r.key=s.key,r.data=s.data,r.right=this.nodeRemoveMin(r.right)}else r.right=this.nodeRemove(r.right,i)}return this.balance(r)}floor(t){if(!this.isEmpty())return this.nodeFloor(this.root,t)}nodeFloor(t,i){if(t){const r=this.compareKeys(i,t.key);return r===0?t:r<0?this.nodeFloor(t.left,i):this.nodeFloor(t.right,i)??t}}ceil(t){if(!this.isEmpty())return this.nodeCeil(this.root,t)}nodeCeil(t,i){if(t){const r=this.compareKeys(i,t.key);return r===0?t:r>0?this.nodeCeil(t.right,i):this.nodeCeil(t.left,i)??t}}min(){if(this.root)return this.nodeMin(this.root)}nodeMin(t){return t.left?this.nodeMin(t.left):t}max(){if(this.root)return this.nodeMax(this.root)}nodeMax(t){return t.right?this.nodeMax(t.right):t}rotateRight(t){const i=t.left;return t.left=i.right,i.right=t,i.color=i.right.color,i.right.color=e.RBColor.RED,i.size=t.size,t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&(this.updateLocal(t),this.updateLocal(i)),i}rotateLeft(t){const i=t.right;return t.right=i.left,i.left=t,i.color=i.left.color,i.left.color=e.RBColor.RED,i.size=t.size,t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&(this.updateLocal(t),this.updateLocal(i)),i}oppositeColor(t){return t===e.RBColor.BLACK?e.RBColor.RED:e.RBColor.BLACK}flipColors(t){t.color=this.oppositeColor(t.color),t.left.color=this.oppositeColor(t.left.color),t.right.color=this.oppositeColor(t.right.color)}moveRedLeft(t){let i=t;return this.flipColors(i),this.isRed(i.right.left)&&(i.right=this.rotateRight(i.right),i=this.rotateLeft(i),this.flipColors(i)),i}moveRedRight(t){let i=t;return this.flipColors(i),this.isRed(i.left.left)&&(i=this.rotateRight(i),this.flipColors(i)),i}balance(t){let i=t;return this.isRed(i.right)&&(i=this.rotateLeft(i)),this.isRed(i.left)&&this.isRed(i.left.left)&&(i=this.rotateRight(i)),this.isRed(i.left)&&this.isRed(i.right)&&this.flipColors(i),i.size=this.nodeSize(i.left)+this.nodeSize(i.right)+1,this.aug&&this.aug.update(i),i}mapRange(t,i,r,s){this.nodeMap(this.root,t,i,r,s)}map(t,i){this.nodeMap(this.root,t,i)}keys(){const t=[],i={showStructure:!0,infix:r=>(t.push(r.key),!0)};return this.walk(i),t}walk(t){this.nodeWalk(this.root,t)}walkBackward(t){this.nodeWalkBackward(this.root,t)}nodeWalk(t,i){let r=!0;return t&&(i.pre&&(i.showStructure||t.color===e.RBColor.BLACK)&&(r=i.pre(t)),t.left&&(r=this.nodeWalk(t.left,i)),r&&i.infix&&(i.showStructure||t.color===e.RBColor.BLACK)&&(r=i.infix(t)),r&&(r=this.nodeWalk(t.right,i)),r&&i.post&&(i.showStructure||t.color===e.RBColor.BLACK)&&(r=i.post(t))),r}nodeWalkBackward(t,i){let r=!0;return t&&(i.pre&&(i.showStructure||t.color===e.RBColor.BLACK)&&(r=i.pre(t)),t.right&&(r=this.nodeWalkBackward(t.right,i)),r&&i.infix&&(i.showStructure||t.color===e.RBColor.BLACK)&&(r=i.infix(t)),r&&(r=this.nodeWalkBackward(t.left,i)),r&&i.post&&(i.showStructure||t.color===e.RBColor.BLACK)&&(r=i.post(t))),r}nodeMap(t,i,r,s,o){let u=s,c=o;if(!t)return!0;u===void 0&&(u=this.nodeMin(t).key),c===void 0&&(c=this.nodeMax(t).key);const d=this.compareKeys(u,t.key),l=this.compareKeys(c,t.key);let f=!0;return d<0&&(f=this.nodeMap(t.left,i,r,u,c)),f&&d<=0&&l>=0&&(f=i(t,r)),f&&l>0&&(f=this.nodeMap(t.right,i,r,u,c)),f}}e.RedBlackTree=n})(UD)),UD}var kZ;function lce(){return kZ||(kZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.RedBlackTree=e.RBColor=void 0;var n=cwe();Object.defineProperty(e,"RBColor",{enumerable:!0,get:function(){return n.RBColor}}),Object.defineProperty(e,"RedBlackTree",{enumerable:!0,get:function(){return n.RedBlackTree}})})(BD)),BD}var Ri={},zp={},zD={},xZ;function AT(){return xZ||(xZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.walkAllChildSegments=e.backwardExcursion=e.forwardExcursion=e.depthFirstNodeWalk=e.NodeAction=e.LeafAction=void 0;const n=ka();e.LeafAction={Exit:!1},e.NodeAction={Continue:void 0,Exit:e.LeafAction.Exit,Skip:2};function a(s,o,u,c,d,l=!0){const f=l?1:-1,b=c??u;if(b===void 0)return!0;let C=s,v=C.childCount,m=o;for(;;){let h;for(;m?.isLeaf()===!1;)C=m,v=C.childCount,h=u?.(C),m=h===e.NodeAction.Continue?C.children[l?0:v-1]:void 0;let g=h===e.NodeAction.Exit;if(m!==void 0){for(let S=m.index;S!==-1&&S!==v;S+=f)if(b(C.children[S])===e.LeafAction.Exit){g=!0;break}}if(d===void 0&&g)return!1;let _=-1;do{if(h===e.NodeAction.Continue?d?.(C):h=e.NodeAction.Continue,C.parent===void 0)return!g;m=C,C=C.parent,v=C.childCount,_=m.index+f}while(g||_===-1||_===v);m=C.children[_]}}e.depthFirstNodeWalk=a;function t(s,o){return(0,n.isMergeNodeInfo)(s)?a(s.parent,s.parent.children[s.index+1],void 0,o):!0}e.forwardExcursion=t;function i(s,o){return(0,n.isMergeNodeInfo)(s)?a(s.parent,s.parent.children[s.index-1],void 0,o,void 0,!1):!0}e.backwardExcursion=i;function r(s,o){if(s.childCount===0)return!0;const u=new Set;for(let c=s.parent;c!==void 0;c=c.parent)u.add(c);return a(s,s.children[0],u.size===0?void 0:c=>u.has(c.parent)?e.NodeAction.Exit:e.NodeAction.Continue,o)}e.walkAllChildSegments=r})(zD)),zD}var qZ;function fce(){if(qZ)return zp;qZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(zp,"__esModule",{value:!0}),zp.EndOfTreeSegment=zp.StartOfTreeSegment=void 0;const e=Je(),n=Da(),a=AT();class t{constructor(u){this.mergeTree=u,this.removes=[{type:"setRemove",seq:0,clientId:n.LocalClientId}],this.cachedLength=1,this.insert={type:"insert",seq:0,clientId:n.LocalClientId},this.addProperties=i,this.clone=i,this.canAppend=i,this.append=i,this.splitAt=i,this.toJSONObject=i,this.ack=i}isLeaf(){return!0}get parent(){return this.endpointSegmentProps().parent}get index(){return this.endpointSegmentProps().index}get segmentGroups(){return i()}get trackingCollection(){return i()}}const i=()=>{(0,e.assert)(!1,1005)};class r extends t{constructor(){super(...arguments),this.type="StartOfTreeSegment",this.endpointType="start"}endpointSegmentProps(){let u,c=1;const d=this.mergeTree.root;return(0,a.depthFirstNodeWalk)(d,d.children[0],b=>{if(c++,b?.isLeaf())return u=b,a.NodeAction.Exit},void 0,void 0,!1),{parent:u?.parent??d,index:0,depth:c}}get ordinal(){return"\0"}}zp.StartOfTreeSegment=r;class s extends t{constructor(){super(...arguments),this.type="EndOfTreeSegment",this.endpointType="end"}endpointSegmentProps(){let u,c=1;const d=this.mergeTree.root;(0,a.depthFirstNodeWalk)(d,d.children[d.childCount-1],b=>{if(c++,b?.isLeaf())return u=b,a.NodeAction.Exit},void 0,void 0,!1);const l=u?.parent??d,f=l.childCount;return{parent:l,index:f,depth:c}}get ordinal(){return String.fromCodePoint(65535).repeat(this.endpointSegmentProps().depth)}}return zp.EndOfTreeSegment=s,zp}var li={},Xu={},LZ;function pI(){if(LZ)return Xu;LZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Xu,"__esModule",{value:!0}),Xu.normalizePlace=Xu.endpointPosAndSide=Xu.Side=void 0;var e;(function(t){t[t.Before=0]="Before",t[t.After=1]="After"})(e||(Xu.Side=e={}));function n(t,i){const r=typeof t=="number"||t==="start"||t==="end",s=typeof i=="number"||i==="start"||i==="end",o=r?e.Before:t?.side,u=s?e.Before:i?.side,c=r?t:t?.pos,d=s?i:i?.pos;return{startSide:o,endSide:u,startPos:c,endPos:d}}Xu.endpointPosAndSide=n;function a(t){return typeof t=="number"?{pos:t,side:e.Before}:t==="start"?{pos:-1,side:e.After}:t==="end"?{pos:-1,side:e.Before}:t}return Xu.normalizePlace=a,Xu}var BZ;function nL(){if(BZ)return li;BZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(li,"__esModule",{value:!0}),li.createGroupOp=li.createInsertOp=li.createInsertSegmentOp=li.createObliterateRangeOpSided=li.createObliterateRangeOp=li.createRemoveRangeOp=li.createAdjustRangeOp=li.createAnnotateRangeOp=li.createAnnotateMarkerOp=void 0;const e=_l(),n=pI();function a(l,f){const b=l.getId();if(b)return{props:{...f},relativePos1:{id:b,before:!0},relativePos2:{id:b},type:e.MergeTreeDeltaType.ANNOTATE}}li.createAnnotateMarkerOp=a;function t(l,f,b){return{pos1:l,pos2:f,props:{...b},type:e.MergeTreeDeltaType.ANNOTATE}}li.createAnnotateRangeOp=t;function i(l,f,b){return{pos1:l,pos2:f,adjust:{...b},type:e.MergeTreeDeltaType.ANNOTATE}}li.createAdjustRangeOp=i;function r(l,f){return{pos1:l,pos2:f,type:e.MergeTreeDeltaType.REMOVE}}li.createRemoveRangeOp=r;function s(l,f){return{pos1:l,pos2:f,type:e.MergeTreeDeltaType.OBLITERATE}}li.createObliterateRangeOp=s;function o(l,f){const b=(0,n.normalizePlace)(l),C=typeof f=="number"?{pos:f-1,side:n.Side.After}:(0,n.normalizePlace)(f);return{type:e.MergeTreeDeltaType.OBLITERATE_SIDED,pos1:{pos:b.pos,before:b.side===n.Side.Before},pos2:{pos:C.pos,before:C.side===n.Side.Before}}}li.createObliterateRangeOpSided=o;function u(l,f){return c(l,f.toJSONObject())}li.createInsertSegmentOp=u;function c(l,f){return{pos1:l,seg:f,type:e.MergeTreeDeltaType.INSERT}}li.createInsertOp=c;function d(...l){return{ops:l,type:e.MergeTreeDeltaType.GROUP}}return li.createGroupOp=d,li}var ks={},UZ;function uwe(){if(UZ)return ks;UZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=ks&&ks.__createBinding||(Object.create?(function(m,h,g,_){_===void 0&&(_=g);var S=Object.getOwnPropertyDescriptor(h,g);(!S||("get"in S?!h.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return h[g]}}),Object.defineProperty(m,_,S)}):(function(m,h,g,_){_===void 0&&(_=g),m[_]=h[g]})),n=ks&&ks.__setModuleDefault||(Object.create?(function(m,h){Object.defineProperty(m,"default",{enumerable:!0,value:h})}):function(m,h){m.default=h}),a=ks&&ks.__importStar||function(m){if(m&&m.__esModule)return m;var h={};if(m!=null)for(var g in m)g!=="default"&&Object.prototype.hasOwnProperty.call(m,g)&&e(h,m,g);return n(h,m),h};Object.defineProperty(ks,"__esModule",{value:!0}),ks.verifyPartialLengths=ks.verifyExpectedPartialLengths=ks.PartialSequenceLengths=void 0;const t=Je(),i=Rc(),r=ty(),s=ka(),o=eL(),u=a(ey());class c extends o.SortedSet{compare(h,g){return h.seq-g.seq}addOrUpdate(h,g){if(h.seglen===0)return;const _=this.latestLeq(h.seq);_?.seq!==h.seq&&(h.len=(_?.len??0)+h.seglen);for(let S=this.sortedItems.length-1;S>=0;S--){const p=this.sortedItems[S];if(!p||p.seq<=h.seq)break;p.len+=h.seglen}super.addOrUpdate(h,(S,p)=>{(0,t.assert)(p.clientId===S.clientId,2742),S.seglen+=p.seglen,S.len+=p.seglen})}latestLeq(h){return this.sortedItems[this.latestLeqIndex(h)]}firstGte(h){const{index:g}=this.findItemPosition({seq:h,len:0,seglen:0});return this.sortedItems[g]}latestLeqIndex(h){const{exists:g,index:_}=this.findItemPosition({seq:h,len:0,seglen:0});return g?_:_-1}copyDown(h){const g=this.latestLeqIndex(h);let _=0;if(g>=0){_=this.sortedItems[g].len;const S=this.size;if(g<=S-1){const p=S-g-1;for(let w=0;w<p;w++)this.sortedItems[w]=this.sortedItems[w+g+1],this.sortedItems[w].len-=_;this.sortedItems.length=p}}return _}}class d{constructor(h,g){this.minSeq=h,this.minLength=0,this.segmentCount=0,this.partialLengths=new c,this.perClientAdjustments=[],this.lastIncrementalInvalidationSeq=Number.NEGATIVE_INFINITY,g&&(this.unsequencedRecords={partialLengths:new c,perRefSeqAdjustments:new Map,cachedAdjustmentByRefSeq:new Map})}static combine(h,g,_=!1,S=!1){const p=d.fromLeaves(h,g,S);let w=!1;const O=[];for(let F=0;F<h.childCount;F++){const R=h.children[F];R.isLeaf()||(w=!0,_&&(R.partialLengths=d.combine(R,g,!0,S)),O.push(R.partialLengths))}const E=w?new d(g.minSeq,S):p;if(w){p.partialLengths.size>0&&O.push(p);const F=O.length,R=[],M=[],j=[];for(let k=0;k<F;k++){const{segmentCount:x,minLength:L,partialLengths:V,unsequencedRecords:G}=O[k];E.segmentCount+=x,E.minLength+=L,R.push(V.items),G&&(M.push(G.partialLengths.items),j.push(G.perRefSeqAdjustments))}if(C(R,E.partialLengths),S){E.unsequencedRecords={partialLengths:C(M),cachedAdjustmentByRefSeq:new Map,perRefSeqAdjustments:new Map};for(const k of j)for(const[x,L]of k){let V=E.unsequencedRecords.perRefSeqAdjustments.get(x);V===void 0&&(V=new c,E.unsequencedRecords.perRefSeqAdjustments.set(x,V));for(const G of L.items)V.addOrUpdate({...G})}}for(let k=0;k<F;k++){const{perClientAdjustments:x}=O[k];if(x.length>0){for(let L=0;L<x.length;L++)if(x[L]!==void 0)for(const G of x[L].items)E.addClientAdjustment(L,G.seq,G.seglen)}}}return d.options.zamboni&&E.zamboni(g),d.options.verifier?.(E),E}static fromLeaves(h,g,_,S=!0){const p=new d(g.minSeq,_);p.segmentCount=h.childCount;for(let w=0;w<h.childCount;w++){const O=h.children[w];if(O.isLeaf()){const E=O;(0,s.wasRemovedOnInsert)(E)?d.accountForRemoveOnInsert(p,E,g):(d.accountForInsertion(p,E,g),d.accountForRemoval(p,E,g))}}return d.options.verifier?.(p),p}static accountForRemoveOnInsert(h,g,_){(0,s.assertInserted)(g);const S=(0,s.toRemovalInfo)(g);(0,t.assert)(S!==void 0&&(0,s.wasRemovedOnInsert)(g),2743);const p=S?.removes[0];if(u.lte(p,(0,i.getMinSeqStamp)(_)))return;const{insert:w,cachedLength:O}=g,E=u.isLocal(w),{clientId:F}=w,R=E?h.unsequencedRecords?.partialLengths:h.partialLengths;if(R!==void 0){if(E){const M=w.localSeq;R.addOrUpdate({seq:M,len:0,seglen:O,clientId:F}),h.addLocalAdjustment({refSeq:p.seq,localSeq:M,seglen:-O});const j=S.removes[S.removes.length-1];u.isLocal(j)&&(R.addOrUpdate({seq:j.localSeq,len:0,seglen:-O,clientId:F}),h.addLocalAdjustment({refSeq:p.seq,localSeq:j.localSeq,seglen:O}))}else if(!(S!==void 0&&S.removes.some(j=>j.clientId===F))){const j=p?.seq;(0,t.assert)(j!==void 0,2744),h.addClientAdjustment(F,j,O)}}}static accountForInsertion(h,g,_){if((0,s.assertInserted)(g),u.lte(g.insert,(0,i.getMinSeqStamp)(_))){h.minLength+=g.cachedLength;return}const{insert:S,cachedLength:p}=g,w=u.isLocal(S),O=w?S.localSeq:S.seq,E=S.clientId,F=w?h.unsequencedRecords?.partialLengths:h.partialLengths;F&&(w?F.addOrUpdate({seq:O,clientId:E,len:0,seglen:p}):(F.addOrUpdate({seq:O,clientId:E,len:0,seglen:p}),h.addClientAdjustment(E,O,p)))}static accountForRemoval(h,g,_){(0,s.assertInserted)(g);const S=(0,s.toRemovalInfo)(g);if(!S)return;const p=S?.removes[0],w=(0,i.getMinSeqStamp)(_);if(p!==void 0&&u.lte(p,w)){h.minLength-=g.cachedLength;return}const O=!!p&&u.isLocal(p),E=u.isLocal(g.insert),R=E||O;if(E&&!O)throw new Error("Should have handled this codepath in wasRemovedOnInsertion");const M=-g.cachedLength,j=O?p.localSeq:p.seq,k=p.clientId,x=new Set(S?.removes.map(V=>V.clientId)),L=R?h.unsequencedRecords?.partialLengths:h.partialLengths;if(L!==void 0)if(R)u.lte(g.insert,w)||_.clientId===g.insert.clientId?L.addOrUpdate({seq:j,clientId:k,len:0,seglen:M}):h.addLocalAdjustment({localSeq:j,refSeq:g.insert.seq,seglen:M});else{L.addOrUpdate({seq:j,clientId:k,len:0,seglen:M});for(const V of x)if(V===_.clientId){const{localSeq:G}=S.removes[S.removes.length-1];if(G===void 0)continue;const{unsequencedRecords:ee}=h;if(!ee)continue;(0,t.assert)(G!==void 0,2746),u.isAcked(g.insert)&&u.greaterThan(g.insert,w)?h.addLocalAdjustment({refSeq:g.insert.seq,localSeq:G,seglen:M}):ee.partialLengths.addOrUpdate({seq:G,clientId:_.clientId,seglen:M,len:0}),h.addLocalAdjustment({refSeq:j,localSeq:G,seglen:g.cachedLength})}else h.addClientAdjustment(V,j,M),u.greaterThan(g.insert,w)&&V!==g.insert.clientId&&h.addClientAdjustment(V,g.insert.seq,g.cachedLength)}}update(h,g,_,S){const p=this.partialLengths.latestLeq(g);p?.seq===g&&this.partialLengths.addOrUpdate({seq:g,len:0,seglen:-p.seglen,clientId:_}),this.perClientAdjustments.forEach(F=>{const R=F.latestLeq(g);R&&R.seq===g&&this.addClientAdjustment(_,g,-R.seglen)});let w=!1,O=0,E=0;for(let F=0;F<h.childCount;F++){const R=h.children[F];if(R.isLeaf()){const M=R,k=(0,s.toRemovalInfo)(M)?.removes[0];g===M.insert.seq&&(M.insert.seq!==void 0&&k!==void 0&&(0,s.wasRemovedOnInsert)(M)?(this.addClientAdjustment(_,k.seq,M.cachedLength),w=!0):(O+=M.cachedLength,this.addClientAdjustment(_,g,M.cachedLength))),u.isAcked(M.insert)&&g===k?.seq&&(O-=M.cachedLength,_!==S.clientId&&(this.addClientAdjustment(_,g,-M.cachedLength),u.greaterThan(M.insert,(0,i.getMinSeqStamp)(S))&&M.insert.clientId!==_&&(this.addClientAdjustment(_,M.insert.seq,M.cachedLength),w=!0))),E++}else{const j=R.partialLengths;if(j.lastIncrementalInvalidationSeq===g){const L=d.combine(h,S,!1);L.lastIncrementalInvalidationSeq=g,h.partialLengths=L;return}const x=j.partialLengths.latestLeq(g);x&&x.seq===g&&(O+=x.seglen),E+=j.segmentCount,j.perClientAdjustments.forEach(L=>{const V=L.latestLeq(g);V&&V.seq===g&&this.addClientAdjustment(_,g,V.seglen)})}}w&&(this.lastIncrementalInvalidationSeq=g),this.segmentCount=E,this.unsequencedRecords=void 0,this.partialLengths.addOrUpdate({seq:g,seglen:O,len:0,clientId:_}),d.options.zamboni&&this.zamboni(S),d.options.verifier?.(this)}getPartialLength(h,g,_){let S=this.minLength;if(S+=this.partialLengths.latestLeq(h)?.len??0,_===void 0){const p=this.latestClientEntry(g);if(p!==void 0&&p.seq>h){S+=p.len;const w=this.latestClientEntryLEQ(g,h);w&&(S-=w.len)}}else{(0,t.assert)(this.unsequencedRecords!==void 0,927);const p=this.unsequencedRecords.partialLengths;S+=p.latestLeq(_)?.len??0,S+=this.computeOverallRefSeqAdjustment(h,_)}return S}computeOverallRefSeqAdjustment(h,g){if(this.unsequencedRecords===void 0)return 0;let _=this.unsequencedRecords.cachedAdjustmentByRefSeq.get(h);if(!_){const p=new c;for(const[w,O]of this.unsequencedRecords.perRefSeqAdjustments.entries())if(!(w>h))for(const E of O.items)p.addOrUpdate({...E});_=p,this.unsequencedRecords.cachedAdjustmentByRefSeq.set(h,_)}return _.latestLeq(g)?.len??0}toString(h,g=0){let _="";for(const S of this.partialLengths.items)_+=`(${S.seq},${S.len}) `;for(const S in this.perClientAdjustments)if(this.perClientAdjustments[S].size>0){_+="Client ",_+=h?`${h(+S)}`:`${S}`,_+="[";for(const p of this.perClientAdjustments[S].items)_+=`(${p.seq},${p.len})`;_+="]"}return _=`min(seq ${this.minSeq}): ${this.minLength}; sc: ${this.segmentCount};${_}`,_}zamboni(h){this.minLength+=this.partialLengths.copyDown(h.minSeq),this.minSeq=h.minSeq;for(const g in this.perClientAdjustments){const _=this.perClientAdjustments[g];_&&_.copyDown(h.minSeq)}}addClientAdjustment(h,g,_){this.perClientAdjustments[h]??=new c,this.perClientAdjustments[h].addOrUpdate({seq:g,len:0,seglen:_})}addLocalAdjustment({refSeq:h,localSeq:g,seglen:_}){(0,t.assert)(this.unsequencedRecords!==void 0,2747);const S=this.unsequencedRecords.perRefSeqAdjustments.get(h)??new c;this.unsequencedRecords.perRefSeqAdjustments.set(h,S),S.addOrUpdate({seq:g,len:0,seglen:_})}latestClientEntryLEQ(h,g){return this.perClientAdjustments[h]?.latestLeq(g)}latestClientEntry(h){const g=this.perClientAdjustments[h];return g&&g.size>0?g.items[g.size-1]:void 0}}ks.PartialSequenceLengths=d,d.options={zamboni:!0};function l(m,h,g){if(h.size===0)return 0;let _=0,S=0,p=0;for(const w of h.items)p++,(0,t.assert)(m.minSeq<=w.seq,84),(0,t.assert)(_<w.seq,85),_=w.seq,S+=w.seglen,S!==w.len&&(0,t.assert)(!1,86),g||m.minLength+w.len<0&&(0,t.assert)(!1,87);return p}function f(m,h,g,_,S){if((!m.collabWindow.collaborating||m.collabWindow.clientId===_)&&(h.isLeaf()||S===void 0))return;const p=h.partialLengths?.getPartialLength(g,_,S);let w=0;const O=[h],E=_===m.collabWindow.clientId?S===void 0?new r.LocalDefaultPerspective(_):new r.LocalReconnectingPerspective(g,_,S):new r.PriorPerspective(g,_);for(;O.length>0;){const F=O.pop();F&&(F.isLeaf()?w+=m.nodeLength(F,E)??0:O.push(...F.children.slice(0,F.childCount)))}if(w!==p){const R=d.combine(h,m.collabWindow,!1,!0).getPartialLength(g,_,S);throw h.partialLengths?.getPartialLength(g,_,S),new Error(`expected partial length of ${w} but found ${p}. refSeq: ${g}, clientId: ${_}. (non-incremental codepath returned ${R})`)}}ks.verifyExpectedPartialLengths=f;function b(m){if(m.perClientAdjustments){for(const h of m.perClientAdjustments)h&&l(m,h,!0);(0,t.assert)(!!m.partialLengths,89),l(m,m.partialLengths,!1)}else(0,t.assert)(!m.partialLengths,91)}ks.verifyPartialLengths=b;function C(m,h=new c){for(const g of v(m))h.addOrUpdate({...g});return h}function v(m){class h{constructor(_){this.sublists=_,this.nextSmallestIndex=Array.from({length:_.length});for(let S=0;S<_.length;S++)this.nextSmallestIndex[S]=0}next(){const _=this.sublists.length;let S,p;for(let w=0;w<_;w++){const O=this.nextSmallestIndex[w];if(O<this.sublists[w].length){const E=this.sublists[w][O];(!S||E.seq<S.seq)&&(S=E,p=w)}}return S?(this.nextSmallestIndex[p]++,{value:S,done:!1}):{value:void 0,done:!0}}}return{[Symbol.iterator]:()=>new h(m)}}return ks}var B_={},zZ;function dwe(){if(zZ)return B_;zZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(B_,"__esModule",{value:!0}),B_.SegmentGroupCollection=void 0;const e=Je();class n{constructor(t){this.segment=t,this.segmentGroups=new e.DoublyLinkedList}get size(){return this.segmentGroups.length}get empty(){return this.segmentGroups.empty}enqueue(t){this.segmentGroups.push(t),t.segments.push(this.segment)}dequeue(){return this.segmentGroups.shift()?.data}remove(t){const i=this.segmentGroups.find(r=>r.data===t);return i===void 0?!1:(this.segmentGroups.remove(i),!0)}pop(){return this.segmentGroups.pop?this.segmentGroups.pop()?.data:void 0}copyTo(t){(0,e.walkList)(this.segmentGroups,i=>t.enqueueOnCopy(i.data,this.segment))}enqueueOnCopy(t,i){if(this.enqueue(t),t.previousProps){const r=t.segments.indexOf(i);r!==-1&&t.previousProps.push(t.previousProps[r])}}}return B_.SegmentGroupCollection=n,B_}var Vp={},VZ;function hce(){if(VZ)return Vp;VZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Vp,"__esModule",{value:!0}),Vp.PropertiesManager=Vp.copyPropertiesAndManager=void 0;const e=Je(),n=Da(),a=yd();function t(u,c){u.properties&&(u.propertyManager===void 0?c.properties=(0,a.clone)(u.properties):(c.propertyManager??=new o,u.propertyManager.copyTo(u.properties,c)))}Vp.copyPropertiesAndManager=t;function i(u,...c){let d=u;for(const l of c)for(const f of l){const{raw:b,adjust:C}=f;if(C===void 0)d=b;else{const v=(typeof d=="number"?d:0)+C.delta;C.max!==void 0&&v>C.max?d=C.max:C.min!==void 0&&v<C.min?d=C.min:d=v}}return d}const r=(u,c)=>[...Object.entries(u.props??{}).map(([d,l])=>[d,{raw:l,seq:c}]).filter(([d,l])=>l.raw!==void 0),...Object.entries(u.adjust??{}).map(([d,l])=>[d,{adjust:l,seq:c}])];function s(u,c,d,l){const f=c.properties??=(0,a.createMap)(),b={};for(const[C,v]of r(u,d))l(f,b,C,v),f[C]===null&&delete f[C];return b}class o{constructor(){this.changes=new Map}rollbackProperties(c,d,l=!1){return s(c,d,n.UniversalSequenceNumber,(f,b,C,v)=>{const m=f[C]??null,h=this.changes.get(C);l?((0,e.assert)(h!==void 0,2671),h.local.pop(),f[C]=i(h.msnConsensus,h.remote.map(g=>g.data),h.local.map(g=>g.data)),h.local.empty&&h.remote.empty&&this.changes.delete(C)):((0,e.assert)(h===void 0,2672),f[C]=i(m,[v])),b[C]=m})}handleProperties(c,d,l,f,b=!1,C=!1){if(C)return this.rollbackProperties(c,d,b);const v=s(c,d,l,(m,h,g,_)=>{const S=m[g]??null;if(b){const p=this.changes.get(g)??{msnConsensus:S,remote:new e.DoublyLinkedList,local:new e.DoublyLinkedList};this.changes.set(g,p);const w=l===n.UnassignedSequenceNumber;w?p.local.push(_):_.raw!==void 0&&p.remote.empty?p.msnConsensus=i(p.msnConsensus,[_]):p.remote.push(_),m[g]=i(p.msnConsensus,p.remote.map(O=>O.data),p.local.map(O=>O.data)),(w||p.local.empty||m[g]!==S)&&(h[g]=S)}else m[g]=i(S,[_]),h[g]=S});return this.updateMsn(f),v}ack(c,d,l){for(const[f,b]of r(l,c)){const C=this.changes.get(f),v=C?.local?.shift();(0,e.assert)(C!==void 0&&v!==void 0,2673),b.raw!==void 0&&C.remote.empty?C.msnConsensus=i(C.msnConsensus,[b]):C.remote.push(b)}this.updateMsn(d)}updateMsn(c){for(const[d,l]of this.changes)l.msnConsensus=i(l.msnConsensus,(0,e.iterateListValuesWhile)(l.remote.first,f=>f.data.seq<=c?(f.list?.remove(f),!0):!1)),l.local.empty&&l.remote.empty&&this.changes.delete(d)}copyTo(c,d){const l=d.propertyManager??=new o;d.properties=(0,a.clone)(c);for(const[f,{local:b,remote:C,msnConsensus:v}]of this.changes.entries())l.changes.set(f,{msnConsensus:v,remote:new e.DoublyLinkedList(C.empty?void 0:C.map(m=>m.data)),local:new e.DoublyLinkedList(b.empty?void 0:b.map(m=>m.data))})}getAtSeq(c,d){const l={...c};for(const[f,b]of this.changes)l[f]=i(b.msnConsensus,(0,e.iterateListValuesWhile)(b.remote.first,C=>C.data.seq<=d)),l[f]===null&&delete l[f];return l}hasPendingProperties(c){for(const[d,l]of Object.entries(c))if(l!==void 0&&this.changes.get(d)?.local.empty!==!1)return!1;return!0}}return Vp.PropertiesManager=o,Vp}var Zu={},HZ;function lwe(){return HZ||(HZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=Zu&&Zu.__createBinding||(Object.create?(function(v,m,h,g){g===void 0&&(g=h);var _=Object.getOwnPropertyDescriptor(m,h);(!_||("get"in _?!m.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return m[h]}}),Object.defineProperty(v,g,_)}):(function(v,m,h,g){g===void 0&&(g=h),v[g]=m[h]})),a=Zu&&Zu.__setModuleDefault||(Object.create?(function(v,m){Object.defineProperty(v,"default",{enumerable:!0,value:m})}):function(v,m){v.default=m}),t=Zu&&Zu.__importStar||function(v){if(v&&v.__esModule)return v;var m={};if(v!=null)for(var h in v)h!=="default"&&Object.prototype.hasOwnProperty.call(v,h)&&n(m,v,h);return a(m,v),m};Object.defineProperty(e,"__esModule",{value:!0}),e.packParent=e.zamboniSegments=e.zamboniSegmentsMax=void 0;const i=Da(),r=mI(),s=Rc(),o=yd(),u=ka(),c=t(ey());e.zamboniSegmentsMax=2;function d(v){return v.childCount<s.MaxNodesInBlock/2}const l={seq:i.UnassignedSequenceNumber,clientId:-1};function f(v,m=e.zamboniSegmentsMax){if(v.collabWindow.collaborating)for(let h=0;h<m;h++){let g=v.segmentsToScour.peek()?.value;if(g?.segment?.propertyManager?.updateMsn(v.collabWindow.minSeq),!g||g.maxSeq>v.collabWindow.minSeq)break;if(g=v.segmentsToScour.get(),g?.segment?.parent&&g.segment.parent.needsScour!==!1){const _=g.segment.parent,S=[];C(_,S,v),_.needsScour=!1;const p=S.length;if(p<_.childCount){_.childCount=p,_.children=S;for(let w=0;w<p;w++)(0,s.assignChild)(_,S[w],w,!1);d(_)&&_.parent?b(_.parent,v):(v.nodeUpdateOrdinals(_),v.blockUpdatePathLengths(_,l,!0))}}}}e.zamboniSegments=f;function b(v,m){const h=v.children;let g,_;const S=[];for(g=0;g<v.childCount;g++)_=h[g],C(_,S,m),_.parent=void 0;if(S.length>0){const p=S.length,w=s.MaxNodesInBlock/2;let O=Math.min(s.MaxNodesInBlock-1,Math.floor(p/w));O<1&&(O=1);const E=Math.floor(p/O);let F=p%O;const R=Array.from({length:s.MaxNodesInBlock});let M=0;for(let j=0;j<O;j++){let k=E;F>0&&(k++,F--);const x=m.makeBlock(k);for(let L=0;L<k;L++){const V=S[M++];(0,s.assignChild)(x,V,L,!1)}x.parent=v,R[j]=x,m.nodeUpdateLengthNewStructure(x)}v.children=R;for(let j=0;j<O;j++)(0,s.assignChild)(v,R[j],j,!1);v.childCount=O}else v.children=[],v.childCount=0;d(v)&&v.parent?b(v.parent,m):(m.nodeUpdateOrdinals(v),m.blockUpdatePathLengths(v,l,!0))}e.packParent=b;function C(v,m,h){let g;for(let _=0;_<v.childCount;_++){const S=v.children[_];if(!S.isLeaf()||S.segmentGroups?.empty===!1){m.push(S),g=void 0;continue}const p=S,w=(0,u.toRemovalInfo)(p),O=(0,s.getMinSeqStamp)(h.collabWindow);if(w===void 0)if(c.lte(p.insert,O)){const E=(h.leafLength(p)??0)>0;if(g?.canAppend(p)&&(0,o.matchProperties)(g.properties,p.properties)&&g.trackingCollection.matches(p.trackingCollection)&&E){g.append(p),h.mergeTreeMaintenanceCallback?.({operation:r.MergeTreeMaintenanceType.APPEND,deltaSegments:[{segment:g},{segment:p}]},void 0);for(const R of p.trackingCollection.trackingGroups)R.unlink(p);(0,u.removeMergeNodeInfo)(p)}else m.push(p),g=E?p:void 0}else m.push(p),g=void 0;else{const E=w.removes[0];E&&c.lte(E,O)&&p.trackingCollection.empty?(h.mergeTreeMaintenanceCallback?.({operation:r.MergeTreeMaintenanceType.UNLINK,deltaSegments:[{segment:p}]},void 0),s.Marker.is(p)&&h.unlinkMarker(p),(0,u.removeMergeNodeInfo)(p)):m.push(p),g=void 0}}}})(Zu)),Zu}var KZ;function rL(){if(KZ)return Ri;KZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Ri&&Ri.__createBinding||(Object.create?(function(fe,oe,pe,de){de===void 0&&(de=pe);var ge=Object.getOwnPropertyDescriptor(oe,pe);(!ge||("get"in ge?!oe.__esModule:ge.writable||ge.configurable))&&(ge={enumerable:!0,get:function(){return oe[pe]}}),Object.defineProperty(fe,de,ge)}):(function(fe,oe,pe,de){de===void 0&&(de=pe),fe[de]=oe[pe]})),n=Ri&&Ri.__setModuleDefault||(Object.create?(function(fe,oe){Object.defineProperty(fe,"default",{enumerable:!0,value:oe})}):function(fe,oe){fe.default=oe}),a=Ri&&Ri.__importStar||function(fe){if(fe&&fe.__esModule)return fe;var oe={};if(fe!=null)for(var pe in fe)pe!=="default"&&Object.prototype.hasOwnProperty.call(fe,pe)&&e(oe,fe,pe);return n(oe,fe),oe};Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.MergeTree=Ri.getSlideToSegoff=Ri.findRootMergeBlock=Ri.errorIfOptionNotTrue=Ri.isRemovedAndAcked=void 0;const t=Je(),i=Ot(),r=Da(),s=fce(),o=NT(),u=mI(),c=AT(),d=Rc(),l=jT(),f=nL(),b=_l(),C=uwe(),v=ty(),m=yd(),h=MT(),g=dwe(),_=ka(),S=hce(),p=pI(),w=tL(),O=a(ey()),E=lwe();function F(fe){const oe=(0,_.toRemovalInfo)(fe);return oe!==void 0&&O.isAcked(oe.removes[0])}Ri.isRemovedAndAcked=F;function R(fe,oe){return oe.isLeaf()?fe.leafLength(oe):oe.cachedLength}const M={min:{maxSeq:-2},compare:(fe,oe)=>fe.maxSeq-oe.maxSeq};function j(fe,oe,pe,de){const ge=fe.segmentGroups?.dequeue();(0,t.assert)(ge===oe,67),(0,t.assert)(pe.sequencedMessage!==void 0,2670);const{op:Ce,sequencedMessage:{sequenceNumber:Fe,minimumSequenceNumber:We}}=pe;let Ze=!0;switch(Ce.type){case b.MergeTreeDeltaType.ANNOTATE:{(0,t.assert)(!!fe.propertyManager,68),fe.propertyManager.ack(Fe,We,Ce);break}case b.MergeTreeDeltaType.INSERT:{(0,t.assert)(O.isLocal(fe.insert),69),fe.insert={...de,type:"insert"};break}case b.MergeTreeDeltaType.REMOVE:case b.MergeTreeDeltaType.OBLITERATE:case b.MergeTreeDeltaType.OBLITERATE_SIDED:{(0,_.assertRemoved)(fe);const lt=fe.removes[fe.removes.length-1];(0,t.assert)(O.isLocal(lt),2909),(0,t.assert)(fe.removes.length===1||O.isAcked(fe.removes[fe.removes.length-2]),2910),Ze=fe.removes.length===1;const ut={...de,type:Ce.type===b.MergeTreeDeltaType.REMOVE?"setRemove":"sliceRemove"};fe.removes[fe.removes.length-1]=ut;break}default:throw new Error(`${Ce.type} is in unrecognized operation type`)}return Ze}function k(fe,oe){if(fe?.[oe]!==!0)throw new Error(`${oe} is not enabled.`)}Ri.errorIfOptionNotTrue=k;function x(fe){if(fe===void 0)return;let oe=fe.isLeaf()?fe.parent:fe;for(;oe?.parent!==void 0;)oe=oe.parent;return oe?.mergeTree===void 0?void 0:oe}Ri.findRootMergeBlock=x;function L(fe,oe=o.SlidingPreference.FORWARD,pe,de,ge=!1){if(!fe||pe.isSegmentPresent(fe)||fe.endpointType!==void 0)return[fe,void 0];const Ce=de?.get(fe);if(Ce!==void 0)return[Ce.seg,void 0];const Fe={};de?.set(fe,Fe);const We=lt=>pe.isSegmentPresent(lt)?(Fe.seg=lt,!1):(de!==void 0&&(0,_.toRemovalInfo)(lt)?.removes[0].seq===(0,_.toRemovalInfo)(fe)?.removes[0].seq&&de.set(lt,Fe),!0);if(oe===o.SlidingPreference.BACKWARD?(0,c.backwardExcursion)(fe,We):(0,c.forwardExcursion)(fe,We),Fe.seg!==void 0)return[Fe.seg,void 0];ge||(oe===o.SlidingPreference.BACKWARD?(0,c.forwardExcursion)(fe,We):(0,c.backwardExcursion)(fe,We));let Ze;return oe===o.SlidingPreference.BACKWARD?Ze="start":oe===o.SlidingPreference.FORWARD&&(Ze="end"),[Fe.seg,Ze]}function V(fe,oe=o.SlidingPreference.FORWARD,pe=v.allAckedChangesPerspective,de=!1){if(!(0,d.isSegmentLeaf)(fe?.segment))return fe;const[ge,Ce]=L(fe.segment,oe,pe,void 0,de);if(ge===fe.segment)return fe;if(ge===void 0)return;const Fe=ge.ordinal<fe.segment.ordinal?ge.cachedLength-1:0;return{segment:ge,offset:Fe}}Ri.getSlideToSegoff=V;const G=fe=>fe.slidingPreference!==o.SlidingPreference.BACKWARD,ee=fe=>fe.slidingPreference===o.SlidingPreference.BACKWARD;class se{constructor(oe){this.mergeTree=oe,this.seqOrdered=new t.DoublyLinkedList,this.startOrdered=new w.SortedSegmentSet}setMinSeq(oe){for(;!this.seqOrdered.empty&&this.seqOrdered.first?.data.stamp.seq<=oe;){const pe=this.seqOrdered.shift();this.startOrdered.remove(pe.data.start),this.mergeTree.removeLocalReferencePosition(pe.data.start),this.mergeTree.removeLocalReferencePosition(pe.data.end)}}onNormalize(){this.startOrdered.onSortOrderChange()}addOrUpdate(oe){const{stamp:{seq:pe},start:de}=oe;pe!==r.UnassignedSequenceNumber&&this.seqOrdered.push(oe),this.startOrdered.addOrUpdate(de)}empty(){return this.startOrdered.size===0}findOverlapping(oe){const pe=[];for(const de of this.startOrdered.items){const ge=de.getSegment();if((0,_.isMergeNodeInfo)(ge)&&ge.ordinal<=oe.ordinal){const Ce=de.properties?.obliterate,Fe=Ce.end.getSegment();(0,_.isMergeNodeInfo)(Fe)&&Fe.ordinal>=oe.ordinal&&pe.push(Ce)}else break}return pe}removeLocalObliterate(oe){(0,t.assert)(oe.stamp.seq===r.UnassignedSequenceNumber,2926),this.startOrdered.remove(oe.start)}[Symbol.iterator](){let oe=0;const{items:pe}=this.startOrdered;return{next(){if(oe<pe.length){const Ce=pe[oe++].properties?.obliterate;return(0,t.assert)(Ce?.start!==void 0&&Ce?.end!==void 0,2927),{value:Ce,done:!1}}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}}class re{get localPerspective(){return this.collabWindow.localPerspective}constructor(oe){this.options=oe,this.collabWindow=new d.CollaborationWindow,this.pendingSegments=new t.DoublyLinkedList,this.segmentsToScour=new t.Heap(M),this.localPartialsComputed=!1,this.idToMarker=new Map,this.obliterates=new se(this),this.splitLeafSegment=(pe,de)=>{if(!(de>0&&pe))return{};const ge=pe.splitAt(de);return(0,d.assertSegmentLeaf)(ge),pe?.segmentGroups&&(ge.segmentGroups??=new g.SegmentGroupCollection(ge),pe.segmentGroups.copyTo(ge.segmentGroups)),(0,S.copyPropertiesAndManager)(pe,ge),pe.localRefs?.split(de,ge),this.mergeTreeMaintenanceCallback?.({operation:u.MergeTreeMaintenanceType.SPLIT,deltaSegments:[{segment:pe},{segment:ge}]},void 0),{next:ge}},this.startOfTree=new s.StartOfTreeSegment(this),this.endOfTree=new s.EndOfTreeSegment(this),this._root=this.makeBlock(0),this._root.mergeTree=this,this.attributionPolicy=oe?.attribution?.policyFactory?.()}rebaseObliterateTo(oe,pe){this.obliterates.removeLocalObliterate(oe),pe!==void 0&&this.obliterates.addOrUpdate(pe)}get root(){return this._root}set root(oe){this._root=oe,oe.mergeTree=this}makeBlock(oe){const pe=new d.MergeBlock(oe);return pe.ordinal="",pe}leafLength(oe,pe=this.localPerspective){const de=(0,_.toRemovalInfo)(oe);if(!(de&&(0,d.getMinSeqPerspective)(this.collabWindow).hasOccurred(de.removes[0])))return pe.isSegmentPresent(oe)?oe.cachedLength:0}unlinkMarker(oe){const pe=oe.getId();pe&&this.idToMarker.delete(pe)}addNode(oe,pe){const de=oe.childCount++;return(0,d.assignChild)(oe,pe,de,!1),de}reloadFromSegments(oe){(0,t.assert)(!this.collabWindow.collaborating,73);const pe=d.MaxNodesInBlock-1,de=ge=>{const Ce=Math.ceil(ge.length/pe),Fe=Array.from({length:Ce});for(let We=0,Ze=0;Ze<Ce;Ze++){const lt=Fe[Ze]=this.makeBlock(0);for(let ut=0;ut<pe&&We<ge.length;ut++,We++)this.addNode(lt,ge[We]);this.blockUpdate(lt)}return Fe.length===1?Fe[0]:de(Fe)};oe.length>0?(this.root=de(oe),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}startCollaboration(oe,pe,de){this.collabWindow.clientId=oe,this.collabWindow.minSeq=pe,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=de,this.collabWindow.localPerspective=new v.LocalDefaultPerspective(oe),this.nodeUpdateLengthNewStructure(this.root,!0)}addToLRUSet(oe,pe){oe.parent.needsScour!==!0&&pe>this.collabWindow.currentSeq&&(oe.parent.needsScour=!0,this.segmentsToScour.add({segment:oe,maxSeq:pe}))}getLength(oe){return this.nodeLength(this.root,oe)??0}get length(){return this.root.cachedLength}getPosition(oe,pe){if(oe.isLeaf()&&oe.endpointType==="start")return 0;let de=0,ge=oe.parent,Ce;for(;ge;){const Fe=ge.children;for(let We=0;We<ge.childCount;We++){const Ze=Fe[We];if(Ce&&Ze===Ce||Ze===oe)break;de+=this.nodeLength(Ze,pe)??0}Ce=ge,ge=ge.parent}return de}getContainingSegment(oe,pe){(0,t.assert)(pe.localSeq===void 0||pe.clientId===this.collabWindow.clientId,923);let de,ge;const Ce=(Fe,We,Ze)=>(de=Fe,ge=Ze,!1);if(this.nodeMap(pe,Ce,void 0,oe,oe+1),!(de===void 0||ge===void 0))return{segment:de,offset:ge}}slideAckedRemovedSegmentReferences(oe){let pe=[],de=[],ge,Ce,Fe,We,Ze,lt;const ut=(Ge,Re,Qe,Y,Me)=>{if(Re===void 0)return;const K=Qe.map(me=>(0,o.filterLocalReferencePositions)(me,we=>Y(we)&&(Me?!we.canSlideToEndpoint:!0))),Z=Qe.map(me=>(0,o.filterLocalReferencePositions)(me,we=>Y(we)&&!!we.canSlideToEndpoint));if(Me){const me=Me==="start"?this.startOfTree:this.endOfTree,we=o.LocalReferenceCollection.setOrGet(me);Re?we.addBeforeTombstones(...Z):we.addAfterTombstones(...Z)}if(Ge===void 0)for(const me of Qe)for(const we of me)Y(we)&&!(0,h.refTypeIncludesFlag)(we,b.ReferenceType.StayOnRemove)&&(we.callbacks?.beforeSlide?.(we),me.removeLocalRef(we),we.callbacks?.afterSlide?.(we));else{const me=o.LocalReferenceCollection.setOrGet(Ge);Re?me.addBeforeTombstones(...K):me.addAfterTombstones(...K)}},pt=(Ge,Re,Qe,Y,Me,K,Z,me)=>{if(!Ge.localRefs||!(0,o.anyLocalReferencePosition)(Ge.localRefs,Me))return;const[we,qe]=L(Ge,K,v.allAckedChangesPerspective,K===o.SlidingPreference.FORWARD?Nt:Ke,this.options?.mergeTreeReferencesCanSlideToEndpoint),xe=we===void 0?!1:we.ordinal>Ge.ordinal;we!==Re||xe!==Qe||qe!==Z?(ut(Re,Qe,Y,Me,this.options?.mergeTreeReferencesCanSlideToEndpoint?qe:void 0),me(Ge.localRefs,we,xe,this.options?.mergeTreeReferencesCanSlideToEndpoint?qe:void 0)):Y.push(Ge.localRefs)},Nt=new Map,Ke=new Map;for(const Ge of oe)(0,t.assert)(F(Ge),753),!(Ge.localRefs===void 0||Ge.localRefs.empty)&&(pt(Ge,Ce,Fe,pe,G,o.SlidingPreference.FORWARD,ge,(Re,Qe,Y,Me)=>{pe=[Re],Ce=Qe,Fe=Y,ge=Me}),pt(Ge,Ze,lt,de,ee,o.SlidingPreference.BACKWARD,We,(Re,Qe,Y,Me)=>{de=[Re],Ze=Qe,lt=Y,We=Me}));ut(Ce,Fe,pe,G,ge),ut(Ze,lt,de,ee,We)}computeLocalPartials(oe){if(this.localPartialsComputed)return;const pe=new d.CollaborationWindow;pe.loadFrom(this.collabWindow),oe<this.collabWindow.minSeq&&(pe.minSeq=oe),this.root.partialLengths=C.PartialSequenceLengths.combine(this.root,pe,!0,!0),this.localPartialsComputed=!0}nodeLength(oe,pe){if(oe.isLeaf())return this.leafLength(oe,pe);const{refSeq:de,clientId:ge,localSeq:Ce}=pe;if((!this.collabWindow.collaborating||this.collabWindow.clientId===ge)&&(Ce===void 0||Ce===this.collabWindow.localSeq&&de>=this.collabWindow.currentSeq))return oe.cachedLength;Ce!==void 0&&this.computeLocalPartials(de);const We=oe.partialLengths.getPartialLength(de,ge,Ce);return C.PartialSequenceLengths.options.verifyExpected?.(this,oe,de,ge,Ce),We}setMinSeq(oe){(0,t.assert)(oe<=this.collabWindow.currentSeq,78),(0,t.assert)(this.collabWindow.minSeq<=oe,79),oe>this.collabWindow.minSeq&&(this.collabWindow.minSeq=oe,this.obliterates.setMinSeq(oe),re.options.zamboniSegments&&(0,E.zamboniSegments)(this))}referencePositionToLocalPosition(oe,pe=Number.MAX_SAFE_INTEGER,de=this.collabWindow.clientId,ge=void 0){const Ce=de===this.collabWindow.clientId?ge===void 0?this.localPerspective:new v.LocalReconnectingPerspective(pe,de,ge):new v.PriorPerspective(pe,de),Fe=oe.getSegment();if(Fe===void 0||!(0,d.isSegmentLeaf)(Fe))return h.DetachedReferencePosition;if(oe.isLeaf())return this.getPosition(Fe,Ce);if((0,h.refTypeIncludesFlag)(oe,b.ReferenceType.Transient)||Fe.localRefs?.has(oe)){if(Fe!==this.startOfTree&&Fe!==this.endOfTree&&!Ce.isSegmentPresent(Fe)){const We=oe.slidingPreference===o.SlidingPreference.FORWARD,lt=(0,_.toRemovalInfo)(Fe)?.removes[0],ut=lt!==void 0&&O.isAcked(lt)?lt.seq:pe,pt=lt?.localSeq===void 0?new v.PriorPerspective(ut,this.collabWindow.clientId):new v.LocalReconnectingPerspective(ut,this.collabWindow.clientId,lt.localSeq),Nt=this.nextSegment(pt,Fe,We);return this.getPosition(Nt,Ce)+(We||Nt.cachedLength===0?0:Nt.cachedLength-1)}return this.getPosition(Fe,Ce)+oe.getOffset()}return h.DetachedReferencePosition}nextSegment(oe,pe,de=!0){let ge;const Ce=Fe=>{if(oe.isSegmentPresent(Fe))return ge=Fe,c.LeafAction.Exit};return(de?c.forwardExcursion:c.backwardExcursion)(pe,Ce),ge??(de?this.endOfTree:this.startOfTree)}searchForMarker(oe,pe,de=!0){let ge;const Ce=this.getContainingSegment(oe,this.localPerspective);if(!(0,d.isSegmentLeaf)(Ce?.segment))return;const{segment:Fe}=Ce;return(0,c.depthFirstNodeWalk)(Fe.parent,Fe,We=>{if(We.isLeaf())!(0,_.isRemoved)(We)&&d.Marker.is(We)&&(0,h.refHasTileLabel)(We,pe)&&(ge=We);else{const Ze=de?We.leftmostTiles[pe]:We.rightmostTiles[pe];Ze!==void 0&&((0,t.assert)(Ze.isLeaf()&&d.Marker.is(Ze),1873),ge=Ze)}return ge===void 0?c.NodeAction.Skip:c.NodeAction.Exit},void 0,void 0,de),ge}updateRoot(oe){const pe=this.makeBlock(2);(0,d.assignChild)(pe,this.root,0,!1),(0,d.assignChild)(pe,oe,1,!1),this.root=pe,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}ackOp(oe){const pe=oe.sequencedMessage.sequenceNumber,de={seq:pe,clientId:this.collabWindow.clientId},ge=this.pendingSegments.shift()?.data,Ce=[];let Fe=!1;if(ge!==void 0){const{obliterateInfo:We,segments:Ze}=ge,lt=We!==void 0,ut=oe.op.type===b.MergeTreeDeltaType.OBLITERATE||oe.op.type===b.MergeTreeDeltaType.OBLITERATE_SIDED;if((0,t.assert)(lt===ut,2624),lt){We.stamp={...de,type:"sliceRemove"},this.obliterates.addOrUpdate(We),(0,t.assert)(We.tiebreakTrackingGroup!==void 0,2928);for(const Nt of We.tiebreakTrackingGroup.tracked)Nt.trackingCollection.unlink(We.tiebreakTrackingGroup),(0,t.assert)((0,d.isSegmentLeaf)(Nt)&&(0,_.isInsideObliterate)(Nt),2929),Nt.insertionRefSeqStamp=void 0;We.tiebreakTrackingGroup=void 0}const pt=[];Ze.map(Nt=>{const Ke=!j(Nt,ge,oe,de);Fe||=Ke,re.options.zamboniSegments&&this.addToLRUSet(Nt,pe),Ce.includes(Nt.parent)||Ce.push(Nt.parent),pt.push({segment:Nt})}),(oe.op.type===b.MergeTreeDeltaType.REMOVE||oe.op.type===b.MergeTreeDeltaType.OBLITERATE||oe.op.type===b.MergeTreeDeltaType.OBLITERATE_SIDED)&&this.slideAckedRemovedSegmentReferences(Ze),this.mergeTreeMaintenanceCallback?.({deltaSegments:pt,operation:u.MergeTreeMaintenanceType.ACKNOWLEDGED},oe);for(const Nt of Ce)this.blockUpdatePathLengths(Nt,de,Fe)}re.options.zamboniSegments&&(0,E.zamboniSegments)(this)}addToPendingList(oe,pe,de,ge){let Ce=pe;if(Ce===void 0&&((0,t.assert)(de!==void 0,2930),Ce={segments:[],localSeq:de,refSeq:this.collabWindow.currentSeq},ge&&(Ce.previousProps=[]),this.pendingSegments.push(Ce)),!Ce.previousProps&&ge||Ce.previousProps&&!ge)throw new Error("All segments in group should have previousProps or none");return ge&&Ce.previousProps.push(ge),(oe.segmentGroups??=new g.SegmentGroupCollection(oe)).enqueue(Ce),Ce}getMarkerFromId(oe){const pe=this.idToMarker.get(oe);return pe===void 0||(0,_.isRemoved)(pe)?void 0:pe}posFromRelativePos(oe,pe){let de=-1,ge;return oe.id&&(ge=this.getMarkerFromId(oe.id)),(0,d.isSegmentLeaf)(ge)&&(de=this.getPosition(ge,pe),oe.before?oe.offset!==void 0&&(de-=oe.offset):(de+=ge.cachedLength,oe.offset!==void 0&&(de+=oe.offset))),de}insertSegments(oe,pe,de,ge,Ce){const Fe={...ge,type:"insert"};if(this.ensureIntervalBoundary(oe,de),this.blockInsert(oe,de,Fe,pe),Ce!==void 0){const We=pe.filter(Ze=>!(0,_.isRemoved)(Ze)).map(Ze=>({segment:Ze}));We.length>0&&this.mergeTreeDeltaCallback?.(Ce,{operation:b.MergeTreeDeltaType.INSERT,deltaSegments:We})}this.collabWindow.collaborating&&re.options.zamboniSegments&&O.isAcked(Fe)&&(0,E.zamboniSegments)(this)}resolveRemoteClientPosition(oe,pe,de){if(pe<this.collabWindow.minSeq)return;const ge=new v.PriorPerspective(pe,de),Ce=this.getContainingSegment(oe,ge);if((0,d.isSegmentLeaf)(Ce?.segment))return this.getPosition(Ce.segment,this.localPerspective)+Ce.offset;if(oe===this.getLength(ge))return this.getLength(this.localPerspective)}blockInsert(oe,pe,de,ge){const Ce=ut=>{let pt=!1;return(0,c.forwardExcursion)(ut,()=>(pt=!0,!1)),pt};let Fe;const We=ut=>{this.collabWindow.collaborating&&(O.isLocal(ut.insert)&&de.clientId===this.collabWindow.clientId?Fe=this.addToPendingList(ut,Fe,de.localSeq):re.options.zamboniSegments&&O.greaterThan(ut.insert,(0,d.getMinSeqStamp)(this.collabWindow))&&this.addToLRUSet(ut,ut.insert.seq))},Ze=(ut,pt,Nt)=>{const Ke={};return ut?(Ke.replaceCurrent=Nt.candidateSegment,Ke.next=ut):Ke.next=Nt.candidateSegment,Ke};let lt=oe;for(const ut of ge.filter(pt=>pt.cachedLength>0).map(pt=>(0,_.overwriteInfo)(pt,{insert:de}))){if(d.Marker.is(ut)){const Y=ut.getId();Y&&this.idToMarker.set(Y,ut)}if(this.insertingWalk(lt,pe,de,{leaf:Ze,candidateSegment:ut,continuePredicate:Ce}),!(0,d.isSegmentLeaf)(ut)){const Y=de.localSeq===void 0?i.DataProcessingError:i.UsageError;throw new Y("MergeTree insert failed",{currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:de.seq})}if(lt+=ut.cachedLength,!this.options?.mergeTreeEnableObliterate||this.obliterates.empty()){We(ut);continue}const pt={seq:pe.refSeq,clientId:de.clientId},Nt=[];let Ke,Ge,Re,Qe;for(const Y of this.obliterates.findOverlapping(ut))O.greaterThan(Y.stamp,pt)&&(de.clientId!==Y.stamp.clientId&&(O.isAcked(Y.stamp)&&Nt.push(Y.stamp),(Ke===void 0||O.lessThan(Y.stamp,Ke.stamp))&&(Ke=Y)),(Ge===void 0||O.greaterThan(Y.stamp,Ge.stamp))&&(Ge=Y),O.isAcked(Y.stamp)&&(Re===void 0||O.greaterThan(Y.stamp,Re.stamp))&&(Re=Y),O.isLocal(Y.stamp)&&(Qe===void 0||O.greaterThan(Qe.stamp,Y.stamp))&&(Qe=Y));if((0,_.overwriteInfo)(ut,{obliteratePrecedingInsertion:Ge}),Ge!==void 0&&O.isLocal(Ge.stamp)&&((0,t.assert)(Ge?.tiebreakTrackingGroup!==void 0,2931),Ge.tiebreakTrackingGroup.link(ut),(0,_.overwriteInfo)(ut,{insertionRefSeqStamp:pt})),Ke&&Ge?.stamp.clientId!==de.clientId){const Y={removes:[]};(Re===Ge||Re?.stamp.clientId!==de.clientId)&&(Y.removes=Nt,Y.removes.sort(O.compare)),(0,_.overwriteInfo)(ut,Y),Qe!==void 0&&(Y.removes.push(Qe.stamp),(0,t.assert)(Qe.segmentGroup!==void 0,2156),this.addToPendingList(ut,Qe.segmentGroup)),ut.parent&&this.blockUpdatePathLengths(ut.parent,Y.removes[0],!0)}We(ut)}}computeObliteratePrecedingInsertion(oe,pe){let de;for(const ge of this.obliterates.findOverlapping(oe))O.greaterThan(ge.stamp,pe)&&(de===void 0||O.greaterThan(ge.stamp,de.stamp))&&(de=ge);return de}ensureIntervalBoundary(oe,pe){this.insertingWalk(oe,pe,{seq:r.TreeMaintenanceSequenceNumber,clientId:pe.clientId},{leaf:this.splitLeafSegment})}breakTie(oe,pe,de){return pe.isLeaf()?oe!==0?!1:O.greaterThan(de,pe.insert)||(0,_.isRemoved)(pe)&&O.isAcked(pe.removes[0])&&O.greaterThan(pe.removes[0],de):!0}insertingWalk(oe,pe,de,ge){const{remainder:Ce}=this.insertRecursive(this.root,oe,pe,de,ge,!0);Ce!==void 0&&this.updateRoot(Ce)}insertRecursive(oe,pe,de,ge,Ce,Fe){let We=pe;const Ze=oe.children;let lt,ut,pt,Nt,Ke=!1;for(lt=0;lt<oe.childCount;lt++){ut=Ze[lt];const Ge=Fe&&lt===oe.childCount-1,Re=this.nodeLength(ut,de)??(Ge?0:void 0);if(Re!==void 0)if((0,t.assert)(Re>=0,1212),We<Re||We===Re&&this.breakTie(We,ut,ge)){if(ut.isLeaf()){const Qe=ut,Y=Ce.leaf(Qe,We,Ce);if(Y.replaceCurrent&&(Ke=!0,(0,d.assignChild)(oe,Y.replaceCurrent,lt,!1),Y.replaceCurrent.ordinal=ut.ordinal),Y.next)Ke=!0,pt=Y.next,lt++;else return{remainder:void 0,hadChanges:Ke}}else{const Qe=this.insertRecursive(ut,We,de,ge,Ce,Ge);if(Ke||=Qe.hadChanges,Qe.remainder===void 0)return Qe.hadChanges&&this.blockUpdateLength(oe,ge),Qe;if(Qe.remainder===re.theUnfinishedNode){We-=Re;continue}else pt=Qe.remainder,Nt=Qe.remainder,lt++}break}else We-=Re}if(!pt&&We===0){if(Ce.continuePredicate?.(oe))return{remainder:re.theUnfinishedNode,hadChanges:Ke};pt=Ce.leaf(void 0,We,Ce).next}if(pt){Ke=!0;for(let Ge=oe.childCount;Ge>lt;Ge--)oe.children[Ge]=oe.children[Ge-1],oe.children[Ge].index=Ge;if((0,d.assignChild)(oe,pt,lt,!1),oe.childCount++,oe.setOrdinal(pt,lt),oe.childCount<d.MaxNodesInBlock)return Nt&&this.nodeUpdateOrdinals(Nt),this.blockUpdateLength(oe,ge),{remainder:void 0,hadChanges:Ke};{const Ge=this.split(oe);return C.PartialSequenceLengths.options.verifyExpected?.(this,oe,de.refSeq,ge.clientId),C.PartialSequenceLengths.options.verifyExpected?.(this,Ge,de.refSeq,ge.clientId),{remainder:Ge,hadChanges:Ke}}}else return{remainder:void 0,hadChanges:Ke}}split(oe){const pe=d.MaxNodesInBlock/2,de=this.makeBlock(pe);oe.childCount=pe,this.nodeUpdateOrdinals(oe);for(let ge=0;ge<pe;ge++)(0,d.assignChild)(de,oe.children[pe+ge],ge,!1),oe.children[pe+ge]=void 0;return this.nodeUpdateLengthNewStructure(oe),this.nodeUpdateLengthNewStructure(de),de}nodeUpdateOrdinals(oe){for(let pe=0;pe<oe.childCount;pe++){const de=oe.children[pe];oe.setOrdinal(de,pe),de.isLeaf()||this.nodeUpdateOrdinals(de)}}annotateRange(oe,pe,de,ge,Ce,Fe){de.adjust!==void 0&&k(this.options,"mergeTreeEnableAnnotateAdjust"),this.ensureIntervalBoundary(oe,ge),this.ensureIntervalBoundary(pe,ge);const We=[];let Ze;const lt=de.props??de.adjust,ut=pt=>{(0,t.assert)(!d.Marker.is(pt)||!(d.reservedMarkerIdKey in lt)||lt.markerId===pt.properties?.markerId,1453);const Ke=(pt.propertyManager??=new S.PropertiesManager).handleProperties(de,pt,Ce.seq,this.collabWindow.minSeq,this.collabWindow.collaborating,Fe?.rollback===!0);return(0,_.isRemoved)(pt)||We.push({segment:pt,propertyDeltas:Ke}),this.collabWindow.collaborating&&(O.isLocal(Ce)?Ze=this.addToPendingList(pt,Ze,Ce.localSeq,Ke):re.options.zamboniSegments&&this.addToLRUSet(pt,Ce.seq)),!0};this.nodeMap(ge,ut,void 0,oe,pe),We.length>0&&this.mergeTreeDeltaCallback?.(Fe,{operation:b.MergeTreeDeltaType.ANNOTATE,deltaSegments:We}),this.collabWindow.collaborating&&O.isAcked(Ce)&&re.options.zamboniSegments&&(0,E.zamboniSegments)(this)}obliterateRangeSided(oe,pe,de,ge,Ce){const Fe=oe.side===p.Side.Before?oe.pos:oe.pos+1,We=pe.side===p.Side.Before?pe.pos:pe.pos+1;this.ensureIntervalBoundary(Fe,de),this.ensureIntervalBoundary(We,de);let Ze=!1;const lt=[],ut=[],pt=Re=>{const Qe=this.getContainingSegment(Re.pos,de);(0,t.assert)((0,d.isSegmentLeaf)(Qe?.segment),2623);const{segment:Y,offset:Me}=Qe;return this.createLocalReferencePosition(Y,Me,b.ReferenceType.StayOnRemove,void 0)},Nt={start:pt(oe),startSide:oe.side,end:pt(pe),endSide:pe.side,refSeq:de.refSeq,stamp:ge,segmentGroup:void 0,tiebreakTrackingGroup:void 0};Nt.start.addProperties({obliterate:Nt}),Nt.end.addProperties({obliterate:Nt}),this.collabWindow.collaborating&&ge.clientId===this.collabWindow.clientId&&(Nt.segmentGroup={segments:[],localSeq:ge.localSeq,refSeq:this.collabWindow.currentSeq,obliterateInfo:Nt},Nt.tiebreakTrackingGroup=new l.UnorderedTrackingGroup,this.pendingSegments.push(Nt.segmentGroup)),this.obliterates.addOrUpdate(Nt);const Ke=(Re,Qe)=>{if(oe.side===p.Side.After&&Fe===Qe+Re.cachedLength||pe.side===p.Side.Before&&We===Qe&&de.isSegmentPresent(Re))return!0;const Y=(0,_.toRemovalInfo)(Re);if(O.isLocal(Re.insert)&&(0,_.isInsideObliterate)(Re)&&Re.obliteratePrecedingInsertion?.stamp.seq===r.UnassignedSequenceNumber&&O.isAcked(ge))return!0;if(Ze||=Y!==void 0,Y===void 0){const Me=(0,_.overwriteInfo)(Re,{removes:[ge]});ut.push(Me)}else!O.hasAnyAckedOperation(Y.removes)&&Re.localRefs?.empty===!1&&lt.push(Re),O.spliceIntoList(Y.removes,ge);return(0,_.assertRemoved)(Re),this.collabWindow.collaborating&&(O.isLocal(Re.removes[0])&&ge.clientId===this.collabWindow.clientId?Nt.segmentGroup=this.addToPendingList(Re,Nt.segmentGroup,ge.localSeq):re.options.zamboniSegments&&this.addToLRUSet(Re,ge.seq)),!0},Ge=Re=>(Ze?this.nodeUpdateLengthNewStructure(Re):this.blockUpdateLength(Re,ge),!0);this.nodeMap(de,Ke,Ge,oe.pos,pe.pos+1,O.isLocal(ge)?de:new v.RemoteObliteratePerspective(ge.clientId)),this.slideAckedRemovedSegmentReferences(lt),(oe.pos!==pe.pos||oe.side!==pe.side)&&this.mergeTreeDeltaCallback?.(Ce,{operation:b.MergeTreeDeltaType.OBLITERATE,deltaSegments:ut.map(Re=>({segment:Re}))}),(!this.collabWindow.collaborating||ge.clientId!==this.collabWindow.clientId)&&this.slideAckedRemovedSegmentReferences(ut),this.collabWindow.collaborating&&O.isAcked(ge)&&re.options.zamboniSegments&&(0,E.zamboniSegments)(this)}obliterateRange(oe,pe,de,ge,Ce){k(this.options,"mergeTreeEnableObliterate");const Fe={...ge,type:"sliceRemove"};this.options?.mergeTreeEnableSidedObliterate?((0,t.assert)(typeof oe=="object"&&typeof pe=="object",2629),this.obliterateRangeSided(oe,pe,de,Fe,Ce)):((0,t.assert)(typeof oe=="number"&&typeof pe=="number",2630),this.obliterateRangeSided({pos:oe,side:p.Side.Before},{pos:pe-1,side:p.Side.After},de,Fe,Ce))}markRangeRemoved(oe,pe,de,ge,Ce){let Fe=!1;const We={...ge,type:"setRemove"};this.ensureIntervalBoundary(oe,de),this.ensureIntervalBoundary(pe,de);let Ze;const lt=[],ut=[],pt=(Ke,Ge,Re,Qe)=>{const Y=(0,_.toRemovalInfo)(Ke);if(Fe||=Y!==void 0,Y===void 0){const Me=(0,_.overwriteInfo)(Ke,{removes:[We]});lt.push(Me)}else!O.hasAnyAckedOperation(Y.removes)&&Ke.localRefs?.empty===!1&&ut.push(Ke),O.spliceIntoList(Y.removes,We);return(0,_.assertRemoved)(Ke),this.collabWindow.collaborating&&(O.isLocal(Ke.removes[0])&&We.clientId===this.collabWindow.clientId?Ze=this.addToPendingList(Ke,Ze,We.localSeq):re.options.zamboniSegments&&this.addToLRUSet(Ke,We.seq)),!0},Nt=Ke=>(Fe?this.nodeUpdateLengthNewStructure(Ke):this.blockUpdateLength(Ke,We),!0);this.nodeMap(de,pt,Nt,oe,pe),this.slideAckedRemovedSegmentReferences(ut),lt.length>0&&this.mergeTreeDeltaCallback?.(Ce,{operation:b.MergeTreeDeltaType.REMOVE,deltaSegments:lt.map(Ke=>({segment:Ke}))}),(!this.collabWindow.collaborating||We.clientId!==this.collabWindow.clientId)&&this.slideAckedRemovedSegmentReferences(lt),this.collabWindow.collaborating&&O.isAcked(We)&&re.options.zamboniSegments&&(0,E.zamboniSegments)(this)}rollback(oe,pe){if(oe.type===b.MergeTreeDeltaType.GROUP){(0,t.assert)(Array.isArray(pe),3042);for(let ge=oe.ops.length-1;ge>=0;ge--)this.rollback(oe.ops[ge],pe[ge]);return}const de={seq:r.TreeMaintenanceSequenceNumber,clientId:r.NonCollabClient};if(oe.type===b.MergeTreeDeltaType.REMOVE){const ge=this.pendingSegments.pop()?.data;if(ge===void 0||ge!==pe)throw new Error("Rollback op doesn't match last edit");ge.segments.forEach(Ce=>{const Fe=Ce?.segmentGroups?.pop();(0,t.assert)(Fe===ge,1006),(0,t.assert)((0,_.isRemoved)(Ce)&&Ce.removes[0].type==="setRemove",925),Ce.removes[0].clientId===this.collabWindow.clientId&&((0,_.removeRemovalInfo)(Ce),this.blockUpdatePathLengths(Ce.parent,de),this.mergeTreeDeltaCallback?.({op:(0,f.createInsertSegmentOp)(this.findRollbackPosition(Ce),Ce),rollback:!0},{operation:b.MergeTreeDeltaType.INSERT,deltaSegments:[{segment:Ce}]}))})}else if(oe.type===b.MergeTreeDeltaType.INSERT||oe.type===b.MergeTreeDeltaType.ANNOTATE){const ge=this.pendingSegments.pop()?.data;if(ge===void 0||ge!==pe||oe.type===b.MergeTreeDeltaType.ANNOTATE&&!ge.previousProps)throw new Error("Rollback op doesn't match last edit");let Ce=0;for(const Fe of ge.segments){const We=Fe?.segmentGroups?.pop();(0,t.assert)(We===ge,1007);const Ze=this.findRollbackPosition(Fe);if(oe.type===b.MergeTreeDeltaType.INSERT){Fe.insert={type:"insert",...de};const lt=(0,f.createRemoveRangeOp)(Ze,Ze+Fe.cachedLength),ut={type:"setRemove",...de};this.markRangeRemoved(Ze,Ze+Fe.cachedLength,this.localPerspective,ut,{op:lt,rollback:!0})}else{const lt=ge.previousProps[Ce],ut=(0,f.createAnnotateRangeOp)(Ze,Ze+Fe.cachedLength,lt);this.annotateRange(Ze,Ze+Fe.cachedLength,{props:lt},this.localPerspective,de,{op:ut,rollback:!0}),Ce++}}}else throw new Error("Unsupported op type for rollback")}findRollbackPosition(oe){let pe=0;return(0,c.walkAllChildSegments)(this.root,de=>de===oe?!1:((0,_.isRemoved)(de)||(pe+=de.cachedLength),!0)),pe}nodeUpdateLengthNewStructure(oe,pe=!1){this.blockUpdate(oe),this.collabWindow.collaborating&&(this.localPartialsComputed=!1,oe.partialLengths=C.PartialSequenceLengths.combine(oe,this.collabWindow,pe))}removeLocalReferencePosition(oe){return oe.getSegment()?.localRefs?.removeLocalRef(oe)}createLocalReferencePosition(oe,pe,de,ge,Ce,Fe){if(oe!=="start"&&oe!=="end"&&F(oe)&&!(0,h.refTypeIncludesFlag)(de,b.ReferenceType.SlideOnRemove|b.ReferenceType.Transient|b.ReferenceType.StayOnRemove)&&oe.endpointType===void 0)throw new i.UsageError("Can only create SlideOnRemove or Transient local reference position on a removed or obliterated segment");let We;return oe==="start"?We=this.startOfTree:oe==="end"?We=this.endOfTree:((0,d.assertSegmentLeaf)(oe),We=oe),o.LocalReferenceCollection.setOrGet(We).createLocalRef(pe,de,ge,Ce,Fe)}normalizeAdjacentSegments(oe){const pe=Array.from(oe,({data:Ze})=>({parent:Ze.parent,index:Ze.index,ordinal:Ze.ordinal}));let de=oe.last;for(;de!==void 0&&F(de.data);)de=de.prev;if(!de)return;for(let Ze=de,lt=de?.prev;Ze!==void 0;Ze=lt,lt=lt?.prev)if(F(Ze.data))oe.remove(Ze),oe.insertAfter(de,Ze.data);else if((0,_.isRemoved)(Ze.data)){(0,t.assert)(Ze.data.removes[0].seq!==void 0,1357);let ut=Ze,pt=ut.next;for(;pt!==void 0&&!F(pt.data)&&pt.data.insert.localSeq!==void 0&&O.greaterThan(pt.data.insert,Ze.data.removes[0]);)ut=pt,pt=pt.next;ut!==Ze&&(oe.remove(Ze),oe.insertAfter(ut,Ze.data))}const ge=Array.from(oe,({data:Ze})=>Ze);for(const Ze of ge)Ze.localRefs?.walkReferences(lt=>lt.callbacks?.beforeSlide?.(lt));const Ce=new Map;for(const Ze of ge){const{trackingCollection:lt}=Ze,ut=[...lt.trackingGroups];Ce.set(Ze,ut);for(const pt of lt.trackingGroups)lt.unlink(pt)}for(let Ze=0;Ze<ge.length;Ze++){const lt=ge[Ze],{parent:ut,index:pt,ordinal:Nt}=pe[Ze];(0,d.assignChild)(ut,lt,pt,!1),lt.ordinal=Nt}for(const[Ze,lt]of Ce.entries())for(const ut of lt)Ze.trackingCollection.link(ut);const Fe=new Map,We=Ze=>(Fe.has(Ze)||Fe.set(Ze,Ze.parent===void 0?0:1+We(Ze.parent)),Fe.get(Ze));for(const Ze of ge)We(Ze);for(const[Ze]of[...Fe.entries()].sort((lt,ut)=>ut[1]-lt[1]))Ze.isLeaf()||this.nodeUpdateLengthNewStructure(Ze);for(const Ze of ge)Ze.localRefs?.walkReferences(lt=>lt.callbacks?.afterSlide?.(lt))}normalizeSegmentsOnRebase(){let oe=new t.DoublyLinkedList,pe=!1,de=!1;const ge=()=>{pe&&de&&oe.length>1&&this.normalizeAdjacentSegments(oe)};(0,c.walkAllChildSegments)(this.root,Fe=>((0,_.isRemoved)(Fe)||O.isLocal(Fe.insert)?(F(Fe)&&(de=!0),O.isLocal(Fe.insert)&&(pe=!0),oe.push(Fe)):(ge(),oe=new t.DoublyLinkedList,pe=!1,de=!1),!0)),ge(),this.obliterates.onNormalize();const Ce=new Set;for(const Fe of this.obliterates)if(Fe.tiebreakTrackingGroup!==void 0)for(const We of Fe.tiebreakTrackingGroup.tracked){(0,t.assert)((0,d.isSegmentLeaf)(We)&&(0,_.isInsideObliterate)(We)&&We.insertionRefSeqStamp!==void 0,2932);const Ze=this.computeObliteratePrecedingInsertion(We,We.insertionRefSeqStamp);Ze!==Fe&&Ce.add({segment:We,old:Fe,new:Ze})}for(const{segment:Fe,old:We,new:Ze}of Ce)We.tiebreakTrackingGroup?.unlink(Fe),Ze?.tiebreakTrackingGroup===void 0?(0,_.overwriteInfo)(Fe,{obliteratePrecedingInsertion:Ze,insertionRefSeqStamp:void 0}):((0,_.overwriteInfo)(Fe,{obliteratePrecedingInsertion:Ze}),Ze.tiebreakTrackingGroup.link(Fe))}blockUpdate(oe){let pe;const de=(0,m.createMap)(),ge=(0,m.createMap)();for(let Ce=0;Ce<oe.childCount;Ce++){const Fe=oe.children[Ce],We=R(this,Fe);if(We!==void 0&&(pe??=0,pe+=We),Fe.isLeaf()){const Ze=Fe;if((this.leafLength(Ze)??0)>0&&d.Marker.is(Ze)){const lt=Ze.getId();if(lt&&this.idToMarker.set(lt,Ze),(0,h.refTypeIncludesFlag)(Ze,b.ReferenceType.Tile)){const ut=(0,h.refGetTileLabels)(Ze);if(ut)for(const pt of ut)de[pt]=Ze,ge[pt]??=Ze}}}else(0,m.extend)(de,Fe.rightmostTiles),(0,m.extendIfUndefined)(ge,Fe.leftmostTiles)}oe.leftmostTiles=ge,oe.rightmostTiles=de,oe.cachedLength=pe}blockUpdatePathLengths(oe,pe,de=!1){let ge=oe;for(;ge!==void 0;)de?this.nodeUpdateLengthNewStructure(ge):this.blockUpdateLength(ge,pe),ge=ge.parent}blockUpdateLength(oe,pe){this.blockUpdate(oe),this.localPartialsComputed=!1,this.collabWindow.collaborating&&O.isAcked(pe)&&pe.seq!==r.TreeMaintenanceSequenceNumber&&(oe.partialLengths!==void 0&&re.options.incrementalUpdate&&pe.clientId!==r.NonCollabClient?oe.partialLengths.update(oe,pe.seq,pe.clientId,this.collabWindow):oe.partialLengths=C.PartialSequenceLengths.combine(oe,this.collabWindow),C.PartialSequenceLengths.options.verifyExpected?.(this,oe,pe.seq,pe.clientId))}mapRange(oe,pe,de,ge,Ce,Fe=!1,We=pe){Fe&&(ge&&this.ensureIntervalBoundary(ge,pe),Ce&&this.ensureIntervalBoundary(Ce,pe)),this.nodeMap(pe,(Ze,lt,ut,pt)=>oe(Ze,lt,pe.refSeq,pe.clientId,ut,pt,de),void 0,ge,Ce,We)}nodeMap(oe,pe,de,ge=0,Ce,Fe=oe){const We=Ce??this.nodeLength(this.root,oe)??0;if(We===ge)return;let Ze=0;(0,c.depthFirstNodeWalk)(this.root,this.root.children[0],lt=>{if(We<=Ze)return c.NodeAction.Exit;const ut=this.nodeLength(lt,Fe),pt=(Fe===oe?ut:this.nodeLength(lt,oe))??0,Nt=Fe!==oe&&(!lt.isLeaf()||O.isLocal(lt.insert));if(ut===void 0&&pt===0||ut===0&&!Nt&&pt===0)return c.NodeAction.Skip;const Ke=Ze+pt;if(ge>=Ke)return Ze=Ke,c.NodeAction.Skip;if(lt.isLeaf()){if(pe(lt,Ze,ge-Ze,We-Ze)===!1)return c.NodeAction.Exit;Ze=Ke}},void 0,de)}}return Ri.MergeTree=re,re.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0},re.theUnfinishedNode={childCount:-1},Ri}var Do={},ko={},U_={},$Z;function gI(){if($Z)return U_;$Z=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(U_,"__esModule",{value:!0}),U_.SnapshotLegacy=void 0;const e=Je(),n=bn(),a=Ot(),t=Da(),i=Rc(),r=ty(),s=yd(),o=iL();class u{constructor(d,l,f,b){this.mergeTree=d,this.filename=f,this.onCompletion=b,this.logger=(0,a.createChildLogger)({logger:l,namespace:"Snapshot"}),this.chunkSize=d?.options?.mergeTreeSnapshotChunkSize??u.sizeOfFirstChunk}getSeqLengthSegs(d,l,f=0){const b=[];let C=0,v=0,m=0;for(;C<l&&f+v<d.length;){const g=d[f+v];b.push(g),g.attribution&&m++,C+=g.cachedLength,v++}(0,e.assert)(m===0||m===v,1215);const h=this.mergeTree.attributionPolicy?.serializer;return(0,e.assert)(m===0||h!==void 0,1369),{version:void 0,chunkStartSegmentIndex:f,chunkSegmentCount:v,chunkLengthChars:C,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:d.length,chunkSequenceNumber:this.header.seq,segmentTexts:b.map(g=>g.toJSONObject()),attribution:m>0||this.mergeTree.attributionPolicy?.isAttached?h?.serializeAttributionCollections(b):void 0}}emit(d,l,f){const b=this.getSeqLengthSegs(this.segments,this.chunkSize);let C=b.chunkLengthChars,v=b.chunkSegmentCount;const m=new n.SummaryTreeBuilder;if(m.addBlob(u.header,(0,o.serializeAsMinSupportedVersion)(u.header,b,this.logger,this.mergeTree.options,l,f)),b.chunkSegmentCount<b.totalSegmentCount){const h=this.getSeqLengthSegs(this.segments,this.header.segmentsTotalLength,b.chunkSegmentCount);C+=h.chunkLengthChars,v+=h.chunkSegmentCount,m.addBlob(u.body,(0,o.serializeAsMinSupportedVersion)(u.body,h,this.logger,this.mergeTree.options,l,f))}if((0,e.assert)(C===this.header.segmentsTotalLength,93),(0,e.assert)(v===b.totalSegmentCount,94),d!==void 0&&d.length>0){for(const h of d)delete h.term;m.addBlob(this.mergeTree.options?.catchUpBlobName??u.catchupOps,l?l.stringify(d,f):JSON.stringify(d))}return m.getSummaryTree()}extractSync(){const d=this.mergeTree.collabWindow,l=this.seq=d.minSeq,f=new r.PriorPerspective(this.seq,t.NonCollabClient);this.header={segmentsTotalLength:this.mergeTree.getLength(f),seq:this.mergeTree.collabWindow.minSeq};let b=0;const C=[];let v;const m=g=>{if((0,i.isSegmentLeaf)(g)&&f.isSegmentPresent(g)){b+=1;const _=g.propertyManager?.getAtSeq(g.properties,l)??g.properties;v?.canAppend(g)&&(0,s.matchProperties)(v.properties,_)?v.append(g.clone()):(v=g.clone(),v.properties=_,C.push(v))}return!0};this.mergeTree.mapRange(m,f,void 0),this.segments=[];let h=0;return C.map(g=>{h+=g.cachedLength,g.properties!==void 0&&Object.keys(g.properties).length===0&&(g.properties=void 0),this.segments.push(g)}),Math.abs(b-C.length)>500&&Math.random()<.005&&this.logger.sendTelemetryEvent({eventName:"MergeTreeLegacySummarizeSegmentCount",originalSegments:b,segmentsAfterCombine:C.length,segmentsLen:this.segments.length}),this.header.segmentsTotalLength!==h&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:h,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=h),this.segments}}return U_.SnapshotLegacy=u,u.header="header",u.body="body",u.catchupOps="catchupOps",u.sizeOfFirstChunk=1e4,U_}var GZ;function iL(){if(GZ)return ko;GZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(ko,"__esModule",{value:!0}),ko.toLatestVersion=ko.serializeAsMaxSupportedVersion=ko.serializeAsMinSupportedVersion=ko.hasMergeInfo=void 0;const e=gI();function n(s){return!!s&&typeof s=="object"&&"json"in s}ko.hasMergeInfo=n;function a(s,o,u,c,d,l){let f;switch(o.version!==void 0&&u.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:o.version,toChunkVersion:void 0}),o.version){case void 0:{f=o,f.headerMetadata=r(s,f);break}case"1":{const b=o,C=s===e.SnapshotLegacy.header?b.headerMetadata:void 0;f={version:void 0,chunkStartSegmentIndex:b.startIndex,chunkLengthChars:b.length,chunkSegmentCount:b.segmentCount,segmentTexts:b.segments,totalLengthChars:C?.totalLength,totalSegmentCount:C?.totalSegmentCount,chunkSequenceNumber:C?.sequenceNumber,chunkMinSequenceNumber:C?.minSequenceNumber,headerMetadata:C};break}default:throw new Error(`Unsupported chunk path: ${s} version: ${o.version}`)}return d.stringify(f,l)}ko.serializeAsMinSupportedVersion=a;function t(s,o,u,c,d,l){const f=i(s,o);return d.stringify(f,l)}ko.serializeAsMaxSupportedVersion=t;function i(s,o,u,c){switch(o.version){case void 0:{const d=o;return{version:"1",length:d.chunkLengthChars,segmentCount:d.chunkSegmentCount,headerMetadata:r(s,d),segments:d.segmentTexts,startIndex:d.chunkStartSegmentIndex,attribution:d.attribution}}case"1":return o;default:throw new Error(`Unsupported chunk path: ${s} version: ${o.version}`)}}ko.toLatestVersion=i;function r(s,o,u){if(s===e.SnapshotLegacy.header){if(o.headerMetadata!==void 0)return o.headerMetadata;const c=[{id:e.SnapshotLegacy.header}];return o.chunkLengthChars<o.totalLengthChars&&c.push({id:e.SnapshotLegacy.body}),{orderedChunkMetadata:c,minSequenceNumber:o.chunkMinSequenceNumber,sequenceNumber:o.chunkSequenceNumber,totalLength:o.totalLengthChars,totalSegmentCount:o.totalSegmentCount}}}return ko}var xo={},WZ;function mce(){if(WZ)return xo;WZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=xo&&xo.__createBinding||(Object.create?(function(v,m,h,g){g===void 0&&(g=h);var _=Object.getOwnPropertyDescriptor(m,h);(!_||("get"in _?!m.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return m[h]}}),Object.defineProperty(v,g,_)}):(function(v,m,h,g){g===void 0&&(g=h),v[g]=m[h]})),n=xo&&xo.__setModuleDefault||(Object.create?(function(v,m){Object.defineProperty(v,"default",{enumerable:!0,value:m})}):function(v,m){v.default=m}),a=xo&&xo.__importStar||function(v){if(v&&v.__esModule)return v;var m={};if(v!=null)for(var h in v)h!=="default"&&Object.prototype.hasOwnProperty.call(v,h)&&e(m,v,h);return n(m,v),m};Object.defineProperty(xo,"__esModule",{value:!0}),xo.SnapshotV1=void 0;const t=Ht(),i=Je(),r=bn(),s=Ot(),o=Da(),u=AT(),c=yd(),d=ka(),l=iL(),f=gI(),b=a(ey());class C{constructor(m,h,g,_,S){this.mergeTree=m,this.getLongClientId=g,this.filename=_,this.onCompletion=S,this.logger=(0,s.createChildLogger)({logger:h,namespace:"Snapshot"}),this.chunkSize=m?.options?.mergeTreeSnapshotChunkSize??C.chunkSize;const{currentSeq:p,minSeq:w}=m.collabWindow;this.header={minSequenceNumber:w,sequenceNumber:p,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[],this.attributionCollections=[]}getSeqLengthSegs(m,h,g,_,S=0){const p=[],w=[];let O=0,E=0,F=!1;for(;O<_&&S+E<m.length;){const M=m[S+E];p.push(M),O+=h[S+E],g[S+E]&&(F=!0,w.push({attribution:g[S+E],cachedLength:h[S+E]})),E++}const R=this.mergeTree.attributionPolicy?.serializer;return(0,i.assert)(!F||R!==void 0,1370),{version:"1",segmentCount:E,length:O,segments:p,startIndex:S,headerMetadata:void 0,attribution:F?R?.serializeAttributionCollections(w):void 0}}emit(m,h){const g=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{const w=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.attributionCollections,this.chunkSize,this.header.totalSegmentCount);g.push(w),this.header.totalSegmentCount+=w.segmentCount,this.header.totalLength+=w.length}while(this.header.totalSegmentCount<this.segments.length);const _=g.shift();_.headerMetadata=this.header,_.headerMetadata.orderedChunkMetadata=[{id:f.SnapshotLegacy.header}];const S=[];for(const[w,O]of g.entries()){const E=`${f.SnapshotLegacy.body}_${w}`;this.header.orderedChunkMetadata.push({id:E}),S.push([E,(0,l.serializeAsMaxSupportedVersion)(E,O,this.logger,this.mergeTree.options,m,h)])}const p=new r.SummaryTreeBuilder;p.addBlob(f.SnapshotLegacy.header,(0,l.serializeAsMaxSupportedVersion)(f.SnapshotLegacy.header,_,this.logger,this.mergeTree.options,m,h));for(const w of S)p.addBlob(w[0],w[1]);return p.getSummaryTree()}extractSync(){const m=this.mergeTree,g={seq:this.header.minSequenceNumber,clientId:o.NonCollabClient};let _=0,S=0;const p=(F,R,M)=>{S+=1,this.segments.push(F),this.segmentLengths.push(R),M&&this.attributionCollections.push(M)},w=F=>{F&&(F.properties!==void 0&&Object.keys(F.properties).length===0&&(F.properties=void 0),p(F.toJSONObject(),F.cachedLength,F.attribution))};let O;const E=F=>{if((0,d.assertInserted)(F),b.isLocal(F.insert)||(0,d.isRemoved)(F)&&b.lte(F.removes[0],g))return b.isAcked(F.insert)&&(_+=1),!0;if(_+=1,b.lte(F.insert,g)&&(!(0,d.isRemoved)(F)||b.isLocal(F.removes[0])))O?O.canAppend(F)&&(0,c.matchProperties)(O.properties,F.properties)?(O=O.clone(),O.append(F.clone())):(w(O),O=F):O=F;else{w(O),O=void 0,F.properties!==void 0&&Object.keys(F.properties).length===0&&(F.properties=void 0);const R={json:F.toJSONObject()};if(b.greaterThan(F.insert,g)&&(R.seq=F.insert.seq,R.client=this.getLongClientId(F.insert.clientId)),(0,d.isRemoved)(F)&&F.removes.some(M=>M.type==="setRemove")){const M=F.removes.filter(k=>k.type==="setRemove"),j=M[0];(0,i.assert)(b.isAcked(j)&&b.greaterThan(j,g),101),R.removedSeq=j.seq,R.removedClient=this.getLongClientId(j.clientId),R.removedClientIds=M.map(({clientId:k})=>this.getLongClientId(k))}if((0,d.isRemoved)(F)&&F.removes.some(M=>M.type==="sliceRemove")){const M=F.removes.filter(k=>k.type==="sliceRemove"),j=M[0];(0,i.assert)(b.isAcked(j)&&b.greaterThan(j,g),2163),R.movedSeq=j.seq,R.movedSeqs=M.map(({seq:k})=>k),R.movedClientIds=M.map(({clientId:k})=>this.getLongClientId(k))}(0,i.assert)(R.seq!==void 0&&R.client!==void 0||R.removedSeq!==void 0&&R.removedClientIds!==void 0||R.movedSeq!==void 0&&R.movedClientIds!==void 0&&R.movedClientIds.length>0&&R.movedSeqs!==void 0&&R.movedSeqs.length>0,102),p(R,F.cachedLength,F.attribution)}return!0};return(0,u.walkAllChildSegments)(m.root,E),w(O),Math.abs(_-S)>500&&Math.random()<.005&&this.logger.sendTelemetryEvent({eventName:"MergeTreeV1SummarizeSegmentCount",originalSegments:_,segmentsAfterCombine:S,segmentsLen:this.segments.length}),this.segments}static async loadChunk(m,h,g,_,S){const p=await m.readBlob(h),w=(0,t.bufferToString)(p,"utf8");return C.processChunk(h,w,g,_,S)}static processChunk(m,h,g,_,S){const p=S?S.parse(h):JSON.parse(h);return(0,l.toLatestVersion)(m,p,g,_)}}return xo.SnapshotV1=C,C.chunkSize=1e4,xo}var JZ;function fwe(){if(JZ)return Do;JZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Do&&Do.__createBinding||(Object.create?(function(v,m,h,g){g===void 0&&(g=h);var _=Object.getOwnPropertyDescriptor(m,h);(!_||("get"in _?!m.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return m[h]}}),Object.defineProperty(v,g,_)}):(function(v,m,h,g){g===void 0&&(g=h),v[g]=m[h]})),n=Do&&Do.__setModuleDefault||(Object.create?(function(v,m){Object.defineProperty(v,"default",{enumerable:!0,value:m})}):function(v,m){v.default=m}),a=Do&&Do.__importStar||function(v){if(v&&v.__esModule)return v;var m={};if(v!=null)for(var h in v)h!=="default"&&Object.prototype.hasOwnProperty.call(v,h)&&e(m,v,h);return n(m,v),m};Object.defineProperty(Do,"__esModule",{value:!0}),Do.SnapshotLoader=void 0;const t=Ht(),i=Mr(),r=Je(),s=Ot(),o=Da(),u=ty(),c=ka(),d=iL(),l=mce(),f=gI(),b=a(ey());class C{constructor(m,h,g,_,S){this.runtime=m,this.client=h,this.mergeTree=g,this.serializer=S,this.specToSegment=p=>{if((0,d.hasMergeInfo)(p)){const w=(0,c.overwriteInfo)(this.client.specToSegment(p.json),{insert:{type:"insert",seq:p.seq??o.UniversalSequenceNumber,clientId:p.client===void 0?o.NonCollabClient:this.client.getOrAddShortClientId(p.client)}}),O=[];if(p.removedSeq!==void 0){const E=p;E.removedClient!==void 0&&(p.removedClientIds??=[E.removedClient]),(0,r.assert)(p.removedClientIds!==void 0,2732);const F=p.removedSeq;O.push(...p.removedClientIds.map(R=>({type:"setRemove",seq:F,clientId:this.client.getOrAddShortClientId(R)})))}return p.movedSeq!==void 0&&((0,r.assert)(p.movedClientIds!==void 0&&p.movedSeqs!==void 0,2725),(0,r.assert)(p.movedClientIds.length===p.movedSeqs.length,2911),O.push(...p.movedClientIds.map((E,F)=>({type:"sliceRemove",seq:p.movedSeqs[F],clientId:this.client.getOrAddShortClientId(E)})))),O.length>0&&(O.sort(b.compare),(0,c.overwriteInfo)(w,{removes:O})),w}return(0,c.overwriteInfo)(this.client.specToSegment(p),{insert:{type:"insert",seq:o.UniversalSequenceNumber,clientId:o.NonCollabClient}})},this.logger=(0,s.createChildLogger)({logger:_,namespace:"SnapshotLoader"})}async initialize(m){const h=m.readBlob(f.SnapshotLegacy.header).then(_=>((0,r.assert)(!!_,95),this.loadHeader((0,t.bufferToString)(_,"utf8")))),g=this.loadBodyAndCatchupOps(h,m);return g.catch(_=>this.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},_)),await h,{catchupOpsP:g}}async loadBodyAndCatchupOps(m,h){const g=h.list(""),_=await m;await this.loadBody(_,h);const S=await g;if(S.length===_.headerMetadata.orderedChunkMetadata.length+1){for(const p of _.headerMetadata.orderedChunkMetadata)S.splice(S.indexOf(p.id),1);return(0,r.assert)(S.length===1,96),this.loadCatchupOps(h.readBlob(S[0]),this.serializer)}else if(S.length!==_.headerMetadata.orderedChunkMetadata.length)throw new Error("Unexpected blobs in snapshot");return[]}loadHeader(m){const h=l.SnapshotV1.processChunk(f.SnapshotLegacy.header,m,this.logger,this.mergeTree.options,this.serializer),g=h.segments.map(_=>this.specToSegment(_));if(this.extractAttribution(g,h),this.mergeTree.reloadFromSegments(g),h.headerMetadata===void 0)throw new Error("header metadata not available");return this.runtime.attachState!==i.AttachState.Detached&&this.client.startOrUpdateCollaboration(this.runtime.clientId??"snapshot",h.headerMetadata.minSequenceNumber??h.headerMetadata.sequenceNumber,h.headerMetadata.sequenceNumber),h}async loadBody(m,h){const g=m.headerMetadata;if((0,r.assert)(m.length<=g.totalLength,97),(0,r.assert)(m.segmentCount<=g.totalSegmentCount,98),m.segmentCount===g.totalSegmentCount)return;let _=m.attribution===void 0?0:1;const S=[];let p=m.length;for(let R=1;R<g.orderedChunkMetadata.length;R++){const M=await l.SnapshotV1.loadChunk(h,g.orderedChunkMetadata[R].id,this.logger,this.mergeTree.options,this.serializer);p+=M.length;const j=M.segments.map(k=>this.specToSegment(k));this.extractAttribution(j,M),_+=M.attribution===void 0?0:1,S.push(...j)}(0,r.assert)(_===0||_===g.orderedChunkMetadata.length,1216),(0,r.assert)(p===g.totalLength,99),(0,r.assert)(m.segmentCount+S.length===g.totalSegmentCount,100);const w=this.mergeTree,O=(R,M,j)=>{w.insertSegments(w.root.cachedLength??0,R,new u.PriorPerspective(o.UniversalSequenceNumber,M),{seq:j,clientId:M},void 0)},E=[],F=()=>{E.length>0&&O(E,o.NonCollabClient,o.UniversalSequenceNumber)};for(const R of S){const{clientId:M,seq:j}=R.insert;M===o.NonCollabClient&&j===o.UniversalSequenceNumber?E.push(R):(F(),O([R],M,j))}F()}extractAttribution(m,h){if(h.attribution){const{attributionPolicy:g}=this.mergeTree;if(g===void 0)throw new s.UsageError("Attribution policy must be provided when loading a document with attribution information.");const{isAttached:_,attach:S,serializer:p}=g;_||S(this.client),p.populateAttributionCollections(m,h.attribution)}else{const{attributionPolicy:g}=this.mergeTree;g?.isAttached&&g?.detach()}}async loadCatchupOps(m,h){return h.parse((0,t.bufferToString)(await m,"utf8"))}}return Do.SnapshotLoader=C,Do}var QZ;function hwe(){if(QZ)return Ao;QZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Ao&&Ao.__createBinding||(Object.create?(function(M,j,k,x){x===void 0&&(x=k);var L=Object.getOwnPropertyDescriptor(j,k);(!L||("get"in L?!j.__esModule:L.writable||L.configurable))&&(L={enumerable:!0,get:function(){return j[k]}}),Object.defineProperty(M,x,L)}):(function(M,j,k,x){x===void 0&&(x=k),M[x]=j[k]})),n=Ao&&Ao.__setModuleDefault||(Object.create?(function(M,j){Object.defineProperty(M,"default",{enumerable:!0,value:j})}):function(M,j){M.default=j}),a=Ao&&Ao.__importStar||function(M){if(M&&M.__esModule)return M;var j={};if(M!=null)for(var k in M)k!=="default"&&Object.prototype.hasOwnProperty.call(M,k)&&e(j,M,k);return n(j,M),j};Object.defineProperty(Ao,"__esModule",{value:!0}),Ao.Client=void 0;const t=Ht(),i=Je(),r=on(),s=bn(),o=Ot(),u=owe(),c=lce(),d=Da(),l=NT(),f=rL(),b=AT(),C=Rc(),v=nL(),m=_l(),h=ty(),g=MT(),_=ka(),S=pI(),p=fwe(),w=mce(),O=gI(),E=a(ey()),F="The provided segment is not bound to this DDS.";class R extends t.TypedEventEmitter{constructor(j,k,x,L=()=>{}){if(super(),this.specToSegment=j,this.logger=k,this.getMinInFlightRefSeq=L,this.clientNameToIds=new c.RedBlackTree(C.compareStrings),this.shortClientIdMap=[],this.cachedObliterateRebases=new Map,this._mergeTree=new f.MergeTree(x),this._mergeTree.mergeTreeDeltaCallback=(V,G)=>{this.emit("delta",V,G,this)},this._mergeTree.mergeTreeMaintenanceCallback=(V,G)=>{this.emit("maintenance",V,G,this)},x?.attribution?.track){const V=this._mergeTree?.attributionPolicy;if(V===void 0)throw new o.UsageError("Attribution policy must be provided when attribution tracking is requested.");V.attach(this)}}get endOfTree(){return this._mergeTree.endOfTree}get startOfTree(){return this._mergeTree.startOfTree}peekPendingSegmentGroups(j=1){const k=this._mergeTree.pendingSegments;let x=k?.last;if(j===1||k===void 0)return x?.data;const L=Array.from({length:Math.min(j,k.length)});for(let V=L.length-1;V>=0;V--)L[V]=x.data,x=x.prev;return L}annotateMarker(j,k){const x=(0,v.createAnnotateMarkerOp)(j,k);return this.applyAnnotateRangeOp({op:x}),x}annotateRangeLocal(j,k,x){const L=(0,v.createAnnotateRangeOp)(j,k,x);return this.applyAnnotateRangeOp({op:L}),L}annotateAdjustRangeLocal(j,k,x){const L=(0,v.createAdjustRangeOp)(j,k,x);for(const[V,G]of Object.entries(x))if(G.min!==void 0&&G.max!==void 0&&G.min>G.max)throw new o.UsageError(`min is greater than max for ${V}`);return this.applyAnnotateRangeOp({op:L}),L}removeRangeLocal(j,k){const x=(0,v.createRemoveRangeOp)(j,k);return this.applyRemoveRangeOp({op:x}),x}obliterateRangeLocal(j,k){let x;return this._mergeTree.options?.mergeTreeEnableSidedObliterate?x=(0,v.createObliterateRangeOpSided)(j,k):((0,i.assert)(typeof j=="number"&&typeof k=="number",2626),x=(0,v.createObliterateRangeOp)(j,k)),this.applyObliterateRangeOp({op:x}),x}insertSegmentLocal(j,k){if(k.cachedLength<=0)return;const x=(0,v.createInsertSegmentOp)(j,k);return this.applyInsertOp({op:x}),x}insertAtReferencePositionLocal(j,k){const x=this._mergeTree.referencePositionToLocalPosition(j,this.getCurrentSeq(),this.getClientId());if(x===g.DetachedReferencePosition)throw new o.UsageError("Cannot insert at detached local reference.");return this.insertSegmentLocal(x,k)}walkSegments(j,k,x,L,V=!1,G){this._mergeTree.mapRange(j,G===void 0?this.getCollabWindow().localPerspective:this.getOperationPerspective(G),L,k,x,V)}walkAllSegments(j,k){return(0,b.walkAllChildSegments)(this._mergeTree.root,k===void 0?j:x=>j(x,k))}serializeGCData(j,k){let x=0,L=0,V=0;(0,b.walkAllChildSegments)(this._mergeTree.root,G=>((0,_.isInserted)(G)&&E.isLocal(G.insert)&&x++,(0,_.isRemoved)(G)&&E.isLocal(G.removes[G.removes.length-1])&&(G.removes[G.removes.length-1].type==="setRemove"?L++:V++),(0,_.isRemoved)(G)||k.stringify(G.clone().toJSONObject(),j),!0)),(x>0||L>0)&&this.logger.sendErrorEvent({eventName:"LocalEditsInProcessGCData",localInserts:x,localRemoves:L,localObliterates:V})}getCollabWindow(){return this._mergeTree.collabWindow}getPosition(j,k){if(!(0,C.isSegmentLeaf)(j))return-1;const x=k===void 0?this._mergeTree.localPerspective:new h.LocalReconnectingPerspective(this.getCurrentSeq(),this.getClientId(),k);return this._mergeTree.getPosition(j,x)}createLocalReferencePosition(j,k,x,L,V,G){if(!(0,C.isSegmentLeaf)(j)&&typeof j!="string")throw new o.UsageError(F);return this._mergeTree.createLocalReferencePosition(j,k??0,x,L,V,G)}removeLocalReferencePosition(j){return this._mergeTree.removeLocalReferencePosition(j)}localReferencePositionToPosition(j){return this._mergeTree.referencePositionToLocalPosition(j)}posFromRelativePos(j){return this._mergeTree.posFromRelativePos(j,this._mergeTree.localPerspective)}getMarkerFromId(j){return this._mergeTree.getMarkerFromId(j)}rollback(j,k){this._mergeTree.rollback(j,k)}applyObliterateRangeOp(j){const{op:k,sequencedMessage:x}=j;(0,i.assert)(k.type===m.MergeTreeDeltaType.OBLITERATE||k.type===m.MergeTreeDeltaType.OBLITERATE_SIDED,2150);const L=this.getOperationPerspective(x),V=this.getOperationStamp(x);if(this._mergeTree.options?.mergeTreeEnableSidedObliterate){const{start:G,end:ee}=this.getValidSidedRange(k,L);this._mergeTree.obliterateRange(G,ee,L,V,j)}else{(0,i.assert)(k.type===m.MergeTreeDeltaType.OBLITERATE,2627);const{start:G,end:ee}=this.getValidOpRange(k,L);this._mergeTree.obliterateRange(G,ee,L,V,j)}}getOperationPerspective(j){if(!j)return this._mergeTree.localPerspective;const k=this.getOrAddShortClientIdFromMessage(j),{referenceSequenceNumber:x}=j;return new h.PriorPerspective(x,k)}getOperationStamp(j){if(!j)return this.getCollabWindow().mintNextLocalOperationStamp();const{sequenceNumber:k}=j,x=this.getOrAddShortClientIdFromMessage(j);return{seq:k,clientId:x}}applyRemoveRangeOp(j){const{op:k,sequencedMessage:x}=j;(0,i.assert)(k.type===m.MergeTreeDeltaType.REMOVE,45);const L=this.getOperationPerspective(x),V=this.getOperationStamp(x),G=this.getValidOpRange(k,L);this._mergeTree.markRangeRemoved(G.start,G.end,L,V,j)}applyAnnotateRangeOp(j){const{op:k,sequencedMessage:x}=j;(0,i.assert)(k.type===m.MergeTreeDeltaType.ANNOTATE,46);const L=this.getOperationPerspective(x),V=this.getOperationStamp(x),G=this.getValidOpRange(k,L);this._mergeTree.annotateRange(G.start,G.end,k,L,V,j)}applyInsertOp(j){const{op:k,sequencedMessage:x}=j;(0,i.assert)(k.type===m.MergeTreeDeltaType.INSERT,47);const L=this.getOperationPerspective(x),V=this.getOperationStamp(x),G=this.getValidOpRange(k,L),ee=[this.specToSegment(k.seg)];this._mergeTree.insertSegments(G.start,ee,L,V,j)}getValidSidedRange(j,k){const x=[];let L,V;if(j.pos1===void 0?x.push("start"):L=typeof j.pos1=="object"?{pos:j.pos1.pos,side:j.pos1.before?S.Side.Before:S.Side.After}:{pos:j.pos1,side:S.Side.Before},j.pos2===void 0?x.push("end"):V=typeof j.pos2=="object"?{pos:j.pos2.pos,side:j.pos2.before?S.Side.Before:S.Side.After}:{pos:j.pos2-1,side:S.Side.After},k.clientId===this.getClientId()){const G=this._mergeTree.getLength(this._mergeTree.localPerspective);if(L!==void 0&&(L.pos>=G||L.pos<0)&&x.push("start"),V!==void 0&&(V.pos>=G||V.pos<0)&&x.push("end"),L!==void 0&&V!==void 0&&(L.pos>V.pos||L.pos===V.pos&&L.side!==V.side&&L.side===S.Side.After)&&x.push("inverted"),x.length>0)throw new o.LoggingError("InvalidRange",{usageError:!0,invalidPositions:x.toString(),length:G,opType:j.type,opPos1Relative:j.relativePos1!==void 0,opPos2Relative:j.relativePos2!==void 0,opPos1:JSON.stringify(j.pos1),opPos2:JSON.stringify(j.pos2),start:JSON.stringify(L),end:JSON.stringify(V)})}return(0,i.assert)(L!==void 0&&V!==void 0,2628),{start:L,end:V}}getValidOpRange(j,k){let x=j.pos1;x===void 0&&j.relativePos1&&(x=this._mergeTree.posFromRelativePos(j.relativePos1,k));let L=j.pos2;if(L===void 0&&j.relativePos2&&(L=this._mergeTree.posFromRelativePos(j.relativePos2,k)),k.clientId===this.getClientId()){const V=this.getLength(),G=[];if((x===void 0||x<0||x>V||x===V&&j.type!==m.MergeTreeDeltaType.INSERT)&&G.push("start"),(j.type!==m.MergeTreeDeltaType.INSERT||L!==void 0)&&(L===void 0||L<=x)&&G.push("end"),j.type===m.MergeTreeDeltaType.OBLITERATE&&L!==void 0&&L>V&&G.push("end"),G.length>0)throw new o.LoggingError("RangeOutOfBounds",{usageError:!0,end:L,invalidPositions:G.toString(),length:V,opPos1:j.pos1,opPos1Relative:j.relativePos1!==void 0,opPos2:j.pos2,opPos2Relative:j.relativePos2!==void 0,opType:j.type,start:x})}return{start:x,end:L}}ackPendingSegment(j){if(j.op.type===m.MergeTreeDeltaType.GROUP)for(const k of j.op.ops)this._mergeTree.ackOp({groupOp:j.op,op:k,sequencedMessage:j.sequencedMessage});else this._mergeTree.ackOp(j)}getOrAddShortClientId(j){return this.clientNameToIds.get(j)||this.addLongClientId(j),this.getShortClientId(j)}getShortClientId(j){return this.clientNameToIds.get(j).data}getLongClientId(j){return j>=0?this.shortClientIdMap[j]:"original"}addLongClientId(j){this.clientNameToIds.put(j,this.shortClientIdMap.length),this.shortClientIdMap.push(j)}getOrAddShortClientIdFromMessage(j){return this.getOrAddShortClientId(j.clientId??"server")}findReconnectionPosition(j,k){(0,i.assert)(k<=this._mergeTree.collabWindow.localSeq,50);const{currentSeq:x,clientId:L}=this.getCollabWindow();if(!(0,C.isSegmentLeaf)(j))throw new o.UsageError(F);const V=new h.LocalReconnectingPerspective(x,L,k);return this._mergeTree.getPosition(j,V)}rebaseSidedLocalReference(j,k,x,L){const V=j.getSegment(),G=j.getOffset();(0,i.assert)(V!==void 0&&G!==void 0,2913);const se=(0,f.getSlideToSegoff)({segment:V,offset:G},L,x,!0),{segment:re,offset:fe}=se??{segment:L===l.SlidingPreference.FORWARD?this._mergeTree.endOfTree:this._mergeTree.startOfTree,offset:0};(0,i.assert)((0,C.isSegmentLeaf)(re)&&fe!==void 0,2914);const oe=re===V?k:L===l.SlidingPreference.FORWARD?S.Side.Before:S.Side.After;return{segment:re,offset:fe,side:oe}}computeNewObliterateEndpoints(j,k){const{currentSeq:x,clientId:L}=this.getCollabWindow(),V=(0,h.createLocalReconnectingPerspective)(x,L,j.stamp.localSeq-1,k),G=this.rebaseSidedLocalReference(j.start,j.startSide,V,l.SlidingPreference.FORWARD),ee=this.rebaseSidedLocalReference(j.end,j.endSide,V,l.SlidingPreference.BACKWARD);return{start:G,end:ee}}resetPendingDeltaToOps(j,k,x){(0,i.assert)(!!k,51);const L=this.pendingRebase?.shift()?.data;if((0,i.assert)(k===L,52),(0,i.assert)(k.localSeq!==void 0,2151),this.pendingRebase?.empty&&(this.pendingRebase=void 0),j.type===m.MergeTreeDeltaType.OBLITERATE||j.type===m.MergeTreeDeltaType.OBLITERATE_SIDED){(0,f.errorIfOptionNotTrue)(this._mergeTree.options,"mergeTreeEnableObliterateReconnect");const G=k.obliterateInfo;(0,i.assert)(G!==void 0,2915),(0,i.assert)(G.stamp.localSeq===k.localSeq,2916);const ee=this.cachedObliterateRebases.get(G.stamp.localSeq);(0,i.assert)(ee!==void 0,2917);const{start:{segment:se,offset:re,side:fe},end:{segment:oe,offset:pe,side:de}}=ee,{currentSeq:ge,clientId:Ce}=this.getCollabWindow();if(oe.ordinal<se.ordinal){for(const ut of k.segments){(0,i.assert)((0,f.isRemovedAndAcked)(ut),2918);const pt=ut.removes[ut.removes.length-1];(0,i.assert)(pt.type==="sliceRemove"&&pt.localSeq===k.localSeq||E.isSquashedOp(pt),2989),E.isSquashedOp(pt)||ut.removes.pop()}return this._mergeTree.rebaseObliterateTo(G,void 0),[]}(0,i.assert)(G.tiebreakTrackingGroup!==void 0,2920);const Fe={start:this._mergeTree.createLocalReferencePosition(se,re,m.ReferenceType.StayOnRemove,void 0),startSide:fe,end:this._mergeTree.createLocalReferencePosition(oe,pe,m.ReferenceType.StayOnRemove,void 0),endSide:de,refSeq:ge,stamp:G.stamp,segmentGroup:void 0,tiebreakTrackingGroup:G.tiebreakTrackingGroup};Fe.start.addProperties({obliterate:Fe}),Fe.end.addProperties({obliterate:Fe}),Fe.segmentGroup={segments:[],localSeq:k.localSeq,refSeq:this.getCollabWindow().currentSeq,obliterateInfo:Fe};for(const ut of k.segments)if((0,i.assert)(ut.segmentGroups?.remove(k)===!0,53),!(0,f.isRemovedAndAcked)(ut)&&(ut.ordinal>se.ordinal&&ut.ordinal<oe.ordinal||ut===se&&fe===S.Side.Before||ut===oe&&de===S.Side.After))ut.segmentGroups.enqueue(Fe.segmentGroup);else{(0,i.assert)((0,f.isRemovedAndAcked)(ut),2921);const pt=ut.removes[ut.removes.length-1];(0,i.assert)(pt.type==="sliceRemove"&&pt.localSeq===k.localSeq||E.isSquashedOp(pt),2990),E.isSquashedOp(pt)||ut.removes.pop()}this._mergeTree.rebaseObliterateTo(G,Fe),this._mergeTree.pendingSegments.push(Fe.segmentGroup);const We=new h.LocalReconnectingPerspective(ge,Ce,G.stamp.localSeq-1),Ze=this._mergeTree.getPosition(se,We)+re,lt=this._mergeTree.getPosition(oe,We)+pe;return j.type===m.MergeTreeDeltaType.OBLITERATE?((0,i.assert)(fe===S.Side.Before&&de===S.Side.After,2923),[(0,v.createObliterateRangeOp)(Ze,lt+1)]):[(0,v.createObliterateRangeOpSided)({pos:Ze,side:fe},{pos:lt,side:de})]}const V=[];for(const G of k.segments.sort((ee,se)=>ee.ordinal<se.ordinal?-1:1)){(0,i.assert)(G.segmentGroups?.remove(k)===!0,2924);const ee=this.findReconnectionPosition(G,k.localSeq);let se;switch(j.type){case m.MergeTreeDeltaType.ANNOTATE:{(0,i.assert)(G.propertyManager?.hasPendingProperties(j.props??j.adjust)===!0,54),(0,f.isRemovedAndAcked)(G)||(se=j.props===void 0?(0,v.createAdjustRangeOp)(ee,ee+G.cachedLength,j.adjust):(0,v.createAnnotateRangeOp)(ee,ee+G.cachedLength,j.props));break}case m.MergeTreeDeltaType.INSERT:{if((0,_.isInserted)(G)&&E.isSquashedOp(G.insert))break;(0,i.assert)((0,_.isInserted)(G)&&E.isLocal(G.insert),55);const re=(0,_.toRemovalInfo)(G),fe={seq:0,clientId:0};if(re!==void 0&&x){(0,i.assert)(re.removes.length===1||E.isAcked(re.removes[re.removes.length-2]),2991),this.squashInsertion(G);break}else if(re!==void 0&&E.isAcked(re.removes[0])){(0,i.assert)(re.removes[0].type==="sliceRemove",2908),(0,f.errorIfOptionNotTrue)(this._mergeTree.options,"mergeTreeEnableObliterateReconnect"),(0,_.overwriteInfo)(G,{insert:{type:"insert",seq:d.UniversalSequenceNumber,localSeq:void 0,clientId:d.NonCollabClient}}),this._mergeTree.blockUpdatePathLengths(G.parent,fe,!0);break}const oe=G.clone(),pe=(0,i.isObject)(j.seg)&&"props"in j.seg&&(0,i.isObject)(j.seg.props)?{...j.seg.props}:void 0;oe.properties=pe,se=(0,v.createInsertSegmentOp)(ee,oe);break}case m.MergeTreeDeltaType.REMOVE:{(0,_.isRemoved)(G)&&E.isLocal(G.removes[0])&&(se=(0,v.createRemoveRangeOp)(ee,ee+G.cachedLength));break}default:throw new Error("Invalid op type")}if(se){const re={segments:[],localSeq:k.localSeq,refSeq:this.getCollabWindow().currentSeq,previousProps:k.previousProps?.slice(0)};G.segmentGroups.enqueue(re),this._mergeTree.pendingSegments.push(re),V.push(se)}}return V}applyRemoteOp(j){const k=j.op,x=j.sequencedMessage;switch(this.getOrAddShortClientIdFromMessage(x),k.type){case m.MergeTreeDeltaType.INSERT:{this.applyInsertOp(j);break}case m.MergeTreeDeltaType.REMOVE:{this.applyRemoveRangeOp(j);break}case m.MergeTreeDeltaType.ANNOTATE:{this.applyAnnotateRangeOp(j);break}case m.MergeTreeDeltaType.OBLITERATE:case m.MergeTreeDeltaType.OBLITERATE_SIDED:{this.applyObliterateRangeOp(j);break}case m.MergeTreeDeltaType.GROUP:{for(const L of k.ops)this.applyRemoteOp({op:L,groupOp:k,sequencedMessage:x});break}}}applyStashedOp(j){switch(j.type){case m.MergeTreeDeltaType.INSERT:{this.applyInsertOp({op:j});break}case m.MergeTreeDeltaType.REMOVE:{this.applyRemoveRangeOp({op:j});break}case m.MergeTreeDeltaType.ANNOTATE:{this.applyAnnotateRangeOp({op:j});break}case m.MergeTreeDeltaType.OBLITERATE_SIDED:case m.MergeTreeDeltaType.OBLITERATE:{this.applyObliterateRangeOp({op:j});break}case m.MergeTreeDeltaType.GROUP:{j.ops.map(k=>this.applyStashedOp(k));break}default:(0,i.unreachableCase)(j,"unrecognized op type")}}applyMsg(j,k=!1){if(this.getOrAddShortClientIdFromMessage(j),j.type===r.MessageType.Operation){const L={op:j.contents,sequencedMessage:j};L.sequencedMessage?.clientId===this.longClientId||k?this.ackPendingSegment(L):this.applyRemoteOp(L)}const x=Math.min(this.getMinInFlightRefSeq()??Number.POSITIVE_INFINITY,j.minimumSequenceNumber);this.updateSeqNumbers(x,j.sequenceNumber)}updateSeqNumbers(j,k){const x=this.getCollabWindow();(0,i.assert)(x.currentSeq<=k,56),x.currentSeq=k,(0,i.assert)(j<=k,57),this.updateMinSeq(j)}resolveRemoteClientPosition(j,k,x){const L=this.getOrAddShortClientId(x);return this._mergeTree.resolveRemoteClientPosition(j,k,L)}squashInsertion(j){(0,_.overwriteInfo)(j,{insert:{type:"insert",seq:d.UniversalSequenceNumber,localSeq:void 0,clientId:d.SquashClient},removes:[{type:"setRemove",seq:d.UniversalSequenceNumber,localSeq:void 0,clientId:d.SquashClient}]}),this._mergeTree.blockUpdatePathLengths(j.parent,{seq:0,clientId:0},!0)}regeneratePendingOp(j,k,x){const L=k;if(this.pendingRebase===void 0||this.pendingRebase.empty){let ee;if(Array.isArray(L)){if(L.length===0)return(0,v.createGroupOp)();ee=L[0]}else ee=L;const se=this._mergeTree.pendingSegments.find(re=>re.data===ee);(0,i.assert)(se!==void 0,1806),this.pendingRebase=this._mergeTree.pendingSegments.splice(se)}const V=this.getCollabWindow();if(this.lastNormalization===void 0||V.currentSeq!==this.lastNormalization.refSeq||V.localSeq!==this.lastNormalization.localRefSeq){const ee=[...this._mergeTree.pendingSegments,...this.pendingRebase];this.cachedObliterateRebases.clear();for(const se of ee){const{obliterateInfo:re}=se.data;if(re!==void 0){const{start:fe,end:oe}=this.computeNewObliterateEndpoints(re,x),{localSeq:pe}=re.stamp;(0,i.assert)(pe!==void 0,2925),this.cachedObliterateRebases.set(pe,{start:fe,end:oe})}}this.emit("normalize",x,this),this._mergeTree.normalizeSegmentsOnRebase(),this.lastNormalization={refSeq:V.currentSeq,localRefSeq:V.localSeq}}const G=[];if(j.type===m.MergeTreeDeltaType.GROUP)if(Array.isArray(L)){(0,i.assert)(j.ops.length===L.length,58);for(let ee=0;ee<j.ops.length;ee++)G.push(...this.resetPendingDeltaToOps(j.ops[ee],L[ee],x))}else(0,i.assert)(j.ops.length===1,59),G.push(...this.resetPendingDeltaToOps(j.ops[0],L,x));else(0,i.assert)(j.type!==m.MergeTreeDeltaType.GROUP,60),(0,i.assert)(!Array.isArray(L),61),G.push(...this.resetPendingDeltaToOps(j,L,x));return G.length===1?G[0]:(0,v.createGroupOp)(...G)}createTextHelper(){return new u.MergeTreeTextHelper(this._mergeTree)}summarize(j,k,x,L){const V=(0,s.toDeltaManagerInternal)(j.deltaManager),G=V.minimumSequenceNumber;if(this.updateSeqNumbers(G,V.lastSequenceNumber),(0,i.assert)(this.getCollabWindow().minSeq===G,62),this._mergeTree.options?.newMergeTreeSnapshotFormat===!0){(0,i.assert)(L===void 0||L.length===0,63);const ee=new w.SnapshotV1(this._mergeTree,this.logger,se=>this.getLongClientId(se));return ee.extractSync(),ee.emit(x,k)}else{const ee=new O.SnapshotLegacy(this._mergeTree,this.logger);return ee.extractSync(),ee.emit(L,x,k)}}async load(j,k,x){return new p.SnapshotLoader(j,this,this._mergeTree,this.logger,x).initialize(k)}localTransaction(j){for(const k of j.ops){const x={op:k,groupOp:j};switch(k.type){case m.MergeTreeDeltaType.INSERT:{this.applyInsertOp(x);break}case m.MergeTreeDeltaType.ANNOTATE:{this.applyAnnotateRangeOp(x);break}case m.MergeTreeDeltaType.REMOVE:{this.applyRemoveRangeOp(x);break}case m.MergeTreeDeltaType.OBLITERATE_SIDED:case m.MergeTreeDeltaType.OBLITERATE:{this.applyObliterateRangeOp(x);break}}}}updateMinSeq(j){this._mergeTree.setMinSeq(j)}getContainingSegment(j,k,x){let L;const V=k===void 0?this.getClientId():this.getOrAddShortClientIdFromMessage(k),G=k?.referenceSequenceNumber??this.getCollabWindow().currentSeq;return x!==void 0?L=new h.LocalReconnectingPerspective(G,V,x):k===void 0?L=this._mergeTree.localPerspective:L=new h.PriorPerspective(G,V),this._mergeTree.getContainingSegment(j,L)}getPropertiesAtPosition(j){return this.getContainingSegment(j)?.segment?.properties}getRangeExtentsOfPosition(j){let k,x;const V=this.getContainingSegment(j)?.segment;return V&&(k=this.getPosition(V),x=k+V.cachedLength),{posStart:k,posAfterEnd:x}}getCurrentSeq(){return this.getCollabWindow().currentSeq}getClientId(){return this.getCollabWindow().clientId}getLength(){return this._mergeTree.length??0}startOrUpdateCollaboration(j,k=0,x=0){if(j!==void 0)if(this.longClientId===void 0)this.longClientId=j,this.addLongClientId(this.longClientId),this._mergeTree.startCollaboration(this.getShortClientId(this.longClientId),k,x);else{const L=this.longClientId,V=this.clientNameToIds.get(L).data;this.longClientId=j,this.clientNameToIds.put(j,V),this.shortClientIdMap[V]=j}}searchForMarker(j,k,x=!0){return this._mergeTree.searchForMarker(j,k,x)}}return Ao.Client=R,Ao}var qo={},YZ;function mwe(){if(YZ)return qo;YZ=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(qo,"__esModule",{value:!0}),qo.revertMergeTreeDeltaRevertibles=qo.discardMergeTreeDeltaRevertible=qo.appendToMergeTreeDeltaRevertibles=qo.isMergeTreeDeltaRevertible=void 0;const e=Je(),n=Ot(),a=fce(),t=NT(),i=rL(),r=AT(),s=Rc(),o=jT(),u=_l(),c=yd(),d=MT(),l=ka();function f(E){return!!E&&typeof E=="object"&&"operation"in E&&"trackingGroup"in E}qo.isMergeTreeDeltaRevertible=f;function b(E){const F=E.isLeaf()?E:E.getSegment(),R=(0,i.findRootMergeBlock)((0,s.toSegmentLeaf)(F));(0,e.assert)(R?.mergeTree!==void 0,1474);const M=R.mergeTree;if(M.__mergeTreeRevertible===void 0){const j=new a.EndOfTreeSegment(R.mergeTree),k={afterSlide:x=>{M.referencePositionToLocalPosition(x)===d.DetachedReferencePosition&&t.LocalReferenceCollection.setOrGet(j).addAfterTombstones([x])}};M.__mergeTreeRevertible={refCallbacks:k,detachedReferences:j}}return M}function C(E,F){F[F.length-1]?.operation!==u.MergeTreeDeltaType.INSERT&&F.push({operation:u.MergeTreeDeltaType.INSERT,trackingGroup:new o.UnorderedTrackingGroup});const R=F[F.length-1];for(const M of E.deltaSegments)R.trackingGroup.link(M.segment);return F}function v(E,F){F[F.length-1]?.operation!==u.MergeTreeDeltaType.REMOVE&&F.push({operation:u.MergeTreeDeltaType.REMOVE,trackingGroup:new o.UnorderedTrackingGroup});const R=F[F.length-1],M=b(E.deltaSegments[0].segment);for(const j of E.deltaSegments){const k={segSpec:j.segment.toJSONObject(),referenceSpace:"mergeTreeDeltaRevertible"},x=M.createLocalReferencePosition(j.segment,0,u.ReferenceType.SlideOnRemove,k);x.callbacks=M.__mergeTreeRevertible.refCallbacks;for(const L of j.segment.trackingCollection.trackingGroups)L.link(x),L.unlink(j.segment);R.trackingGroup.link(x)}return F}function m(E,F){let R=F[F.length-1];for(const M of E.deltaSegments){const j=M.propertyDeltas;j&&(R?.operation===u.MergeTreeDeltaType.ANNOTATE&&(0,c.matchProperties)(R?.propertyDeltas,j)?R.trackingGroup.link(M.segment):(R={operation:u.MergeTreeDeltaType.ANNOTATE,propertyDeltas:j,trackingGroup:new o.UnorderedTrackingGroup},R.trackingGroup.link(M.segment),F.push(R)))}return F}function h(E,F){if(E.deltaSegments.length!==0)switch(E.operation){case u.MergeTreeDeltaType.INSERT:{C(E,F);break}case u.MergeTreeDeltaType.REMOVE:{v(E,F);break}case u.MergeTreeDeltaType.ANNOTATE:{m(E,F);break}default:throw new n.UsageError("Unsupported event delta type",{operation:E.operation})}}qo.appendToMergeTreeDeltaRevertibles=h;function g(E){for(const F of E)for(const R of F.trackingGroup.tracked)R.trackingCollection.unlink(F.trackingGroup),R.trackingCollection.empty&&!R.isLeaf()&&R.getSegment()?.localRefs?.removeLocalRef(R)}qo.discardMergeTreeDeltaRevertible=g;function _(E,F,R){for(;R.trackingGroup.size>0;){const M=R.trackingGroup.tracked[0];if((0,e.assert)(M.trackingCollection.unlink(R.trackingGroup),1009),(0,e.assert)((0,s.isSegmentLeaf)(M),1010),(0,l.toRemovalInfo)(M)===void 0){const j=w(F,M);E.removeRange(j,j+M.cachedLength)}}}function S(E,F,R){for(;R.trackingGroup.size>0;){const M=R.trackingGroup.tracked[0];(0,e.assert)(M.trackingCollection.unlink(R.trackingGroup),1011),(0,e.assert)(!M.isLeaf(),1012);const j=M.getSegment();let k=F.referencePositionToLocalPosition(M);if(k===d.DetachedReferencePosition||!(0,s.isSegmentLeaf)(j))throw new n.UsageError("Cannot insert at detached references position");(0,l.toRemovalInfo)(j)===void 0&&j.localRefs?.isAfterTombstone(M)&&k++;const x=M.properties;E.insertFromSpec(k,x.segSpec);const L=F.getContainingSegment(k,F.localPerspective)?.segment;(0,s.assertSegmentLeaf)(L);const V=fe=>fe.properties?.referenceSpace==="mergeTreeDeltaRevertible",G={},ee=L.ordinal<j.ordinal,se=fe=>{if(M===fe)return!1;V(fe)&&(ee?(G.before??=new e.DoublyLinkedList).push(fe):(G.after??=new e.DoublyLinkedList).unshift(fe))};if((0,r.depthFirstNodeWalk)(L.parent,L,void 0,fe=>fe.localRefs?.empty===!1?fe.localRefs.walkReferences(se,void 0,ee):!0,void 0,ee),F?.__mergeTreeRevertible?.detachedReferences?.localRefs?.has(M)&&((0,e.assert)(ee,1014),F?.__mergeTreeRevertible.detachedReferences.localRefs.walkReferences(se)),G!==void 0){const fe=t.LocalReferenceCollection.setOrGet(L);G.before?.empty===!1&&fe.addBeforeTombstones(G.before.map(oe=>oe.data)),G.after?.empty===!1&&fe.addAfterTombstones(G.after.map(oe=>oe.data))}for(const fe of M.trackingCollection.trackingGroups)fe.link(L),fe.unlink(M);M.getSegment()?.localRefs?.removeLocalRef(M)}}function p(E,F,R){for(;R.trackingGroup.size>0;){const M=R.trackingGroup.tracked[0],j=M.trackingCollection.unlink(R.trackingGroup);if((0,e.assert)(j&&(0,s.isSegmentLeaf)(M),1015),(0,l.toRemovalInfo)(M)===void 0){const k=w(F,M);E.annotateRange(k,k+M.cachedLength,R.propertyDeltas)}}}function w(E,F){return E.getPosition(F,E.localPerspective)}function O(E,F){let R;for(;F.length>0;){const M=F.pop(),j=M.operation;if(M.trackingGroup.size>0)switch(R??=b(M.trackingGroup.tracked[0]),j){case u.MergeTreeDeltaType.INSERT:{_(E,R,M);break}case u.MergeTreeDeltaType.REMOVE:{S(E,R,M);break}case u.MergeTreeDeltaType.ANNOTATE:{p(E,R,M);break}default:(0,e.unreachableCase)(j)}}}return qo.revertMergeTreeDeltaRevertibles=O,qo}var XZ;function Ls(){return XZ||(XZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.appendToMergeTreeDeltaRevertibles=e.TextSegment=e.SortedSegmentSet=e.SortedSet=e.endpointPosAndSide=e.Side=e.PropertiesManager=e.copyPropertiesAndManager=e.reservedTileLabelsKey=e.reservedRangeLabelsKey=e.refTypeIncludesFlag=e.refHasTileLabels=e.refHasTileLabel=e.refGetTileLabels=e.minReferencePosition=e.maxReferencePosition=e.DetachedReferencePosition=e.compareReferencePositions=e.matchProperties=e.createMap=e.addProperties=e.ReferenceType=e.MergeTreeDeltaType=e.createObliterateRangeOp=e.createRemoveRangeOp=e.createInsertSegmentOp=e.createInsertOp=e.createGroupOp=e.createAnnotateRangeOp=e.TrackingGroupCollection=e.TrackingGroup=e.reservedMarkerSimpleTypeKey=e.reservedMarkerIdKey=e.Marker=e.segmentIsRemoved=e.CollaborationWindow=e.BaseSegment=e.MergeTreeMaintenanceType=e.getSlideToSegoff=e.SlidingPreference=e.LocalReferenceCollection=e.createDetachedLocalReferencePosition=e.UniversalSequenceNumber=e.UnassignedSequenceNumber=e.RedBlackTree=e.RBColor=e.Client=e.createPropertyTrackingAndInsertionAttributionPolicyFactory=e.createPropertyTrackingAttributionPolicyFactory=e.createInsertOnlyAttributionPolicy=void 0,e.createLocalReconnectingPerspective=e.revertMergeTreeDeltaRevertibles=e.isMergeTreeDeltaRevertible=e.discardMergeTreeDeltaRevertible=void 0;var n=awe();Object.defineProperty(e,"createInsertOnlyAttributionPolicy",{enumerable:!0,get:function(){return n.createInsertOnlyAttributionPolicy}}),Object.defineProperty(e,"createPropertyTrackingAttributionPolicyFactory",{enumerable:!0,get:function(){return n.createPropertyTrackingAttributionPolicyFactory}}),Object.defineProperty(e,"createPropertyTrackingAndInsertionAttributionPolicyFactory",{enumerable:!0,get:function(){return n.createPropertyTrackingAndInsertionAttributionPolicyFactory}});var a=hwe();Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return a.Client}});var t=lce();Object.defineProperty(e,"RBColor",{enumerable:!0,get:function(){return t.RBColor}}),Object.defineProperty(e,"RedBlackTree",{enumerable:!0,get:function(){return t.RedBlackTree}});var i=Da();Object.defineProperty(e,"UnassignedSequenceNumber",{enumerable:!0,get:function(){return i.UnassignedSequenceNumber}}),Object.defineProperty(e,"UniversalSequenceNumber",{enumerable:!0,get:function(){return i.UniversalSequenceNumber}});var r=NT();Object.defineProperty(e,"createDetachedLocalReferencePosition",{enumerable:!0,get:function(){return r.createDetachedLocalReferencePosition}}),Object.defineProperty(e,"LocalReferenceCollection",{enumerable:!0,get:function(){return r.LocalReferenceCollection}}),Object.defineProperty(e,"SlidingPreference",{enumerable:!0,get:function(){return r.SlidingPreference}});var s=rL();Object.defineProperty(e,"getSlideToSegoff",{enumerable:!0,get:function(){return s.getSlideToSegoff}});var o=mI();Object.defineProperty(e,"MergeTreeMaintenanceType",{enumerable:!0,get:function(){return o.MergeTreeMaintenanceType}});var u=Rc();Object.defineProperty(e,"BaseSegment",{enumerable:!0,get:function(){return u.BaseSegment}}),Object.defineProperty(e,"CollaborationWindow",{enumerable:!0,get:function(){return u.CollaborationWindow}}),Object.defineProperty(e,"segmentIsRemoved",{enumerable:!0,get:function(){return u.segmentIsRemoved}}),Object.defineProperty(e,"Marker",{enumerable:!0,get:function(){return u.Marker}}),Object.defineProperty(e,"reservedMarkerIdKey",{enumerable:!0,get:function(){return u.reservedMarkerIdKey}}),Object.defineProperty(e,"reservedMarkerSimpleTypeKey",{enumerable:!0,get:function(){return u.reservedMarkerSimpleTypeKey}});var c=jT();Object.defineProperty(e,"TrackingGroup",{enumerable:!0,get:function(){return c.TrackingGroup}}),Object.defineProperty(e,"TrackingGroupCollection",{enumerable:!0,get:function(){return c.TrackingGroupCollection}});var d=nL();Object.defineProperty(e,"createAnnotateRangeOp",{enumerable:!0,get:function(){return d.createAnnotateRangeOp}}),Object.defineProperty(e,"createGroupOp",{enumerable:!0,get:function(){return d.createGroupOp}}),Object.defineProperty(e,"createInsertOp",{enumerable:!0,get:function(){return d.createInsertOp}}),Object.defineProperty(e,"createInsertSegmentOp",{enumerable:!0,get:function(){return d.createInsertSegmentOp}}),Object.defineProperty(e,"createRemoveRangeOp",{enumerable:!0,get:function(){return d.createRemoveRangeOp}}),Object.defineProperty(e,"createObliterateRangeOp",{enumerable:!0,get:function(){return d.createObliterateRangeOp}});var l=_l();Object.defineProperty(e,"MergeTreeDeltaType",{enumerable:!0,get:function(){return l.MergeTreeDeltaType}}),Object.defineProperty(e,"ReferenceType",{enumerable:!0,get:function(){return l.ReferenceType}});var f=yd();Object.defineProperty(e,"addProperties",{enumerable:!0,get:function(){return f.addProperties}}),Object.defineProperty(e,"createMap",{enumerable:!0,get:function(){return f.createMap}}),Object.defineProperty(e,"matchProperties",{enumerable:!0,get:function(){return f.matchProperties}});var b=MT();Object.defineProperty(e,"compareReferencePositions",{enumerable:!0,get:function(){return b.compareReferencePositions}}),Object.defineProperty(e,"DetachedReferencePosition",{enumerable:!0,get:function(){return b.DetachedReferencePosition}}),Object.defineProperty(e,"maxReferencePosition",{enumerable:!0,get:function(){return b.maxReferencePosition}}),Object.defineProperty(e,"minReferencePosition",{enumerable:!0,get:function(){return b.minReferencePosition}}),Object.defineProperty(e,"refGetTileLabels",{enumerable:!0,get:function(){return b.refGetTileLabels}}),Object.defineProperty(e,"refHasTileLabel",{enumerable:!0,get:function(){return b.refHasTileLabel}}),Object.defineProperty(e,"refHasTileLabels",{enumerable:!0,get:function(){return b.refHasTileLabels}}),Object.defineProperty(e,"refTypeIncludesFlag",{enumerable:!0,get:function(){return b.refTypeIncludesFlag}}),Object.defineProperty(e,"reservedRangeLabelsKey",{enumerable:!0,get:function(){return b.reservedRangeLabelsKey}}),Object.defineProperty(e,"reservedTileLabelsKey",{enumerable:!0,get:function(){return b.reservedTileLabelsKey}});var C=hce();Object.defineProperty(e,"copyPropertiesAndManager",{enumerable:!0,get:function(){return C.copyPropertiesAndManager}}),Object.defineProperty(e,"PropertiesManager",{enumerable:!0,get:function(){return C.PropertiesManager}});var v=pI();Object.defineProperty(e,"Side",{enumerable:!0,get:function(){return v.Side}}),Object.defineProperty(e,"endpointPosAndSide",{enumerable:!0,get:function(){return v.endpointPosAndSide}});var m=eL();Object.defineProperty(e,"SortedSet",{enumerable:!0,get:function(){return m.SortedSet}});var h=tL();Object.defineProperty(e,"SortedSegmentSet",{enumerable:!0,get:function(){return h.SortedSegmentSet}});var g=dce();Object.defineProperty(e,"TextSegment",{enumerable:!0,get:function(){return g.TextSegment}});var _=mwe();Object.defineProperty(e,"appendToMergeTreeDeltaRevertibles",{enumerable:!0,get:function(){return _.appendToMergeTreeDeltaRevertibles}}),Object.defineProperty(e,"discardMergeTreeDeltaRevertible",{enumerable:!0,get:function(){return _.discardMergeTreeDeltaRevertible}}),Object.defineProperty(e,"isMergeTreeDeltaRevertible",{enumerable:!0,get:function(){return _.isMergeTreeDeltaRevertible}}),Object.defineProperty(e,"revertMergeTreeDeltaRevertibles",{enumerable:!0,get:function(){return _.revertMergeTreeDeltaRevertibles}});var S=ty();Object.defineProperty(e,"createLocalReconnectingPerspective",{enumerable:!0,get:function(){return S.createLocalReconnectingPerspective}})})(AD)),AD}var ZZ;function pce(){return ZZ||(ZZ=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.computeStickinessFromSide=e.endReferenceSlidingPreference=e.startReferenceSlidingPreference=e.IntervalStickiness=e.IntervalType=e.IntervalOpType=e.IntervalDeltaOpType=void 0;const n=Ls();e.IntervalDeltaOpType={ADD:"add",DELETE:"delete",CHANGE:"change"},e.IntervalOpType={...e.IntervalDeltaOpType,PROPERTY_CHANGED:"propertyChanged",POSITION_REMOVE:"positionRemove"};var a;(function(s){s[s.Simple=0]="Simple",s[s.SlideOnRemove=2]="SlideOnRemove",s[s.Transient=4]="Transient"})(a||(e.IntervalType=a={})),e.IntervalStickiness={NONE:0,START:1,END:2,FULL:3};function t(s,o,u,c){return(r(s,o,u,c)&e.IntervalStickiness.START)===0?n.SlidingPreference.FORWARD:n.SlidingPreference.BACKWARD}e.startReferenceSlidingPreference=t;function i(s,o,u,c){return(r(s,o,u,c)&e.IntervalStickiness.END)===0?n.SlidingPreference.BACKWARD:n.SlidingPreference.FORWARD}e.endReferenceSlidingPreference=i;function r(s,o,u,c){let d=e.IntervalStickiness.NONE;return(o===n.Side.After||s==="start")&&(d|=e.IntervalStickiness.START),(c===n.Side.Before||u==="end")&&(d|=e.IntervalStickiness.END),d}e.computeStickinessFromSide=r})(ND)),ND}var Xi={},eee;function pwe(){if(eee)return Xi;eee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=Xi&&Xi.__classPrivateFieldGet||function(S,p,w,O){if(w==="a"&&!O)throw new TypeError("Private accessor was defined without a getter");if(typeof p=="function"?S!==p||!O:!p.has(S))throw new TypeError("Cannot read private member from an object whose class did not declare it");return w==="m"?O:w==="a"?O.call(S):O?O.value:p.get(S)},n=Xi&&Xi.__classPrivateFieldSet||function(S,p,w,O,E){if(O==="m")throw new TypeError("Private method is not writable");if(O==="a"&&!E)throw new TypeError("Private accessor was defined without a setter");if(typeof p=="function"?S!==p||!E:!p.has(S))throw new TypeError("Cannot write private member to an object whose class did not declare it");return O==="a"?E.call(S,w):E?E.value=w:p.set(S,w),w},a,t;Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.createSequenceInterval=Xi.createTransientInterval=Xi.createPositionReferenceFromSegoff=Xi.SequenceIntervalClass=Xi.getSerializedProperties=void 0;const i=Je(),r=Ls(),s=Ot(),o=ys(),u=pce();function c(S,p){return S===p?0:S===r.Side.Before?1:-1}function d(S,p){return S===r.Side.After&&p===r.Side.After?r.Side.After:r.Side.Before}function l(S,p){return S===r.Side.Before&&p===r.Side.Before?r.Side.Before:r.Side.After}const f="intervalId",b="legacy";function C(S){const{[f]:p,[r.reservedRangeLabelsKey]:w,...O}=S.properties??{};return{id:p??`${b}${S.start}-${S.end}`,labels:w,properties:O}}Xi.getSerializedProperties=C;class v{get properties(){return this.verifyNotDispose(),e(this,a,"f").properties}changeProperties(p,w,O){if(this.verifyNotDispose(),p!==void 0)return e(this,a,"f").propertyManager??=new r.PropertiesManager,e(this,a,"f").propertyManager.handleProperties({props:p},e(this,a,"f"),this.client.getCollabWindow().collaborating?w?.sequenceNumber??r.UnassignedSequenceNumber:r.UniversalSequenceNumber,w?.minimumSequenceNumber??r.UniversalSequenceNumber,this.client.getCollabWindow().collaborating,O)}get stickiness(){this.verifyNotDispose();const p=this.start.getSegment(),w=this.end.getSegment();return(0,u.computeStickinessFromSide)(p?.endpointType,this.startSide,w?.endpointType,this.endSide)}constructor(p,w,O,E,F,R,M,j=r.Side.Before,k=r.Side.Before){this.client=p,this.id=w,this.label=O,this.start=E,this.end=F,this.intervalType=R,this.startSide=j,this.endSide=k,a.set(this,{properties:(0,r.createMap)()}),t.set(this,!1),M&&(e(this,a,"f").properties=(0,r.addProperties)(e(this,a,"f").properties,M))}get disposed(){return e(this,t,"f")}dispose(p){e(this,t,"f")||(n(this,t,!0,"f"),this.client.removeLocalReferencePosition(this.start),this.client.removeLocalReferencePosition(this.end),this.removePositionChangeListeners(),e(this,a,"f").propertyManager=void 0)}verifyNotDispose(){if(e(this,t,"f"))throw new s.LoggingError("Invalid interval access after dispose")}addPositionChangeListeners(p,w){if(this.verifyNotDispose(),this.callbacks===void 0){this.callbacks={beforePositionChange:p,afterPositionChange:w};const O=this.start.callbacks??={},E=this.end.callbacks??={};O.beforeSlide=E.beforeSlide=p,O.afterSlide=E.afterSlide=w}}removePositionChangeListeners(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}serialize(){return this.verifyNotDispose(),this.serializeDelta({props:this.properties,includeEndpoints:!0})}serializeDelta({props:p,includeEndpoints:w}){this.verifyNotDispose();const O=this.start.getSegment(),E=this.end.getSegment(),F=w?O?.endpointType??this.client.localReferencePositionToPosition(this.start):void 0;return{end:w?E?.endpointType??this.client.localReferencePositionToPosition(this.end):void 0,intervalType:this.intervalType,sequenceNumber:this.client.getCurrentSeq(),start:F,stickiness:this.stickiness,startSide:w?this.startSide:void 0,endSide:w?this.endSide:void 0,properties:{...p,[f]:this.id,[r.reservedRangeLabelsKey]:[this.label]}}}clone(){return this.verifyNotDispose(),new v(this.client,this.id,this.label,this.start,this.end,this.intervalType,this.properties,this.startSide,this.endSide)}compare(p){const w=this.compareStart(p);if(w===0){const O=this.compareEnd(p);if(O===0){const E=this.getIntervalId();if(E){const F=p.getIntervalId();return F?E>F?1:E<F?-1:0:0}return 0}else return O}else return w}compareStart(p){this.verifyNotDispose();const w=(0,r.compareReferencePositions)(this.start,p.start);return w===0?c(this.startSide,p.startSide):w}compareEnd(p){this.verifyNotDispose();const w=(0,r.compareReferencePositions)(this.end,p.end);return w===0?c(p.endSide,this.endSide):w}overlaps(p){return this.verifyNotDispose(),(0,r.compareReferencePositions)(this.start,p.end)<=0&&(0,r.compareReferencePositions)(this.end,p.start)>=0}getIntervalId(){return this.id}union(p){this.verifyNotDispose();const w=(0,r.minReferencePosition)(this.start,p.start),O=(0,r.maxReferencePosition)(this.end,p.end);let E;this.start===p.start?E=d(this.startSide,p.startSide):E=this.start===w?this.startSide:p.startSide;let F;return this.end===p.end?F=l(this.endSide,p.endSide):F=this.end===O?this.endSide:p.endSide,new v(this.client,(0,o.v4)(),this.label,w,O,this.intervalType,void 0,E,F)}overlapsPos(p,w){this.verifyNotDispose();const O=this.client.localReferencePositionToPosition(this.start);return this.client.localReferencePositionToPosition(this.end)>p&&O<w}moveEndpointReferences(p){this.verifyNotDispose();const w=m({client:this.client,segoff:p.start,refType:this.start.refType,slidingPreference:this.start.slidingPreference,canSlideToEndpoint:this.start.canSlideToEndpoint});this.start.properties&&w.addProperties(this.start.properties),this.start=w;const O=m({client:this.client,segoff:p.end,refType:this.end.refType,slidingPreference:this.end.slidingPreference,canSlideToEndpoint:this.end.canSlideToEndpoint});this.end.properties&&O.addProperties(this.end.properties),this.end=O}modify(p,w,O,E,F,R=!1){this.verifyNotDispose();const{startSide:M,endSide:j,startPos:k,endPos:x}=(0,r.endpointPosAndSide)(w,O),L=se=>{let re=se;return E===void 0?(re&=~r.ReferenceType.SlideOnRemove,re|=r.ReferenceType.StayOnRemove):(re&=~r.ReferenceType.StayOnRemove,re|=r.ReferenceType.SlideOnRemove),re};let V=this.start;if(k!==void 0){const se=(0,u.startReferenceSlidingPreference)(k,M??r.Side.Before,x,j??r.Side.Before);V=h({client:this.client,pos:k,refType:L(this.start.refType),op:E,localSeq:F,slidingPreference:se,canSlideToEndpoint:R&&se===r.SlidingPreference.BACKWARD}),this.start.properties&&V.addProperties(this.start.properties)}let G=this.end;if(x!==void 0){const se=(0,u.endReferenceSlidingPreference)(k,M??r.Side.Before,x,j??r.Side.Before);G=h({client:this.client,pos:x,refType:L(this.end.refType),op:E,localSeq:F,slidingPreference:se,canSlideToEndpoint:R&&se===r.SlidingPreference.FORWARD}),this.end.properties&&G.addProperties(this.end.properties)}const ee=new v(this.client,this.id,this.label,V,G,this.intervalType,void 0,M??this.startSide,j??this.endSide);return e(ee,a,"f").propertyManager=e(this,a,"f").propertyManager??=new r.PropertiesManager,e(ee,a,"f").properties=e(this,a,"f").properties,ee}ackPropertiesChange(p,w){this.verifyNotDispose(),Object.keys(p).length!==0&&((0,i.assert)(e(this,a,"f").propertyManager!==void 0,3029),e(this,a,"f").propertyManager.ack(w.sequenceNumber,w.minimumSequenceNumber,{props:p}))}}Xi.SequenceIntervalClass=v,a=new WeakMap,t=new WeakMap;function m({client:S,segoff:p,refType:w,op:O,localSeq:E,fromSnapshot:F,slidingPreference:R,canSlideToEndpoint:M,rollback:j}){if(p==="start"||p==="end")return S.createLocalReferencePosition(p,void 0,w,void 0,R,M);if(p?.segment)return S.createLocalReferencePosition(p.segment,p.offset,w,void 0,R,M);if(!O&&!E&&!F&&!(0,r.refTypeIncludesFlag)(w,r.ReferenceType.Transient)&&!j)throw new s.UsageError("Non-transient references need segment");return(0,r.createDetachedLocalReferencePosition)(R,w)}Xi.createPositionReferenceFromSegoff=m;function h({client:S,pos:p,refType:w,op:O,fromSnapshot:E,localSeq:F,slidingPreference:R,canSlideToEndpoint:M,rollback:j}){let k;return O?((0,i.assert)((w&r.ReferenceType.SlideOnRemove)!==0,757),p==="start"||p==="end"?k=p:(k=S.getContainingSegment(p,{referenceSequenceNumber:O.referenceSequenceNumber,clientId:O.clientId}),k=(0,r.getSlideToSegoff)(k,R,void 0,M))):((0,i.assert)((w&r.ReferenceType.SlideOnRemove)===0||!!E,758),k=p==="start"||p==="end"?p:S.getContainingSegment(p,void 0,F)),m({client:S,segoff:k,refType:w,op:O,localSeq:F,fromSnapshot:E,slidingPreference:R,canSlideToEndpoint:M,rollback:j})}function g(S,p,w){return _("transient",(0,o.v4)(),S,p,w,u.IntervalType.Transient)}Xi.createTransientInterval=g;function _(S,p,w,O,E,F,R,M,j=!1,k,x){const{startPos:L,startSide:V,endPos:G,endSide:ee}=(0,r.endpointPosAndSide)(w??"start",O??"end");(0,i.assert)(L!==void 0&&G!==void 0&&V!==void 0&&ee!==void 0,1940);let se=r.ReferenceType.RangeBegin,re=r.ReferenceType.RangeEnd;F===u.IntervalType.Transient?(se=r.ReferenceType.Transient,re=r.ReferenceType.Transient):R??M?(se|=r.ReferenceType.SlideOnRemove,re|=r.ReferenceType.SlideOnRemove):(se|=r.ReferenceType.StayOnRemove,re|=r.ReferenceType.StayOnRemove);const fe=(0,u.computeStickinessFromSide)(L,V,G,ee),oe=(0,u.startReferenceSlidingPreference)(L,V,G,ee),pe=h({client:E,pos:L,refType:se,op:R,fromSnapshot:M,slidingPreference:oe,canSlideToEndpoint:j&&fe!==u.IntervalStickiness.NONE,rollback:x}),de=(0,u.endReferenceSlidingPreference)(L,V,G,ee),ge=h({client:E,pos:G,refType:re,op:R,fromSnapshot:M,slidingPreference:de,canSlideToEndpoint:j&&fe!==u.IntervalStickiness.NONE,rollback:x}),Ce={[r.reservedRangeLabelsKey]:[S]};return pe.addProperties(Ce),ge.addProperties(Ce),new v(E,p,S,pe,ge,F,k===void 0?void 0:{...k,[f]:void 0,[r.reservedRangeLabelsKey]:void 0},V,ee)}return Xi.createSequenceInterval=_,Xi}var tee;function ny(){return tee||(tee=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.getSerializedProperties=e.createTransientInterval=e.createPositionReferenceFromSegoff=e.createSequenceInterval=e.SequenceIntervalClass=e.startReferenceSlidingPreference=e.endReferenceSlidingPreference=e.IntervalStickiness=e.IntervalDeltaOpType=e.IntervalType=e.IntervalOpType=void 0;var n=pce();Object.defineProperty(e,"IntervalOpType",{enumerable:!0,get:function(){return n.IntervalOpType}}),Object.defineProperty(e,"IntervalType",{enumerable:!0,get:function(){return n.IntervalType}}),Object.defineProperty(e,"IntervalDeltaOpType",{enumerable:!0,get:function(){return n.IntervalDeltaOpType}}),Object.defineProperty(e,"IntervalStickiness",{enumerable:!0,get:function(){return n.IntervalStickiness}}),Object.defineProperty(e,"endReferenceSlidingPreference",{enumerable:!0,get:function(){return n.endReferenceSlidingPreference}}),Object.defineProperty(e,"startReferenceSlidingPreference",{enumerable:!0,get:function(){return n.startReferenceSlidingPreference}});var a=pwe();Object.defineProperty(e,"SequenceIntervalClass",{enumerable:!0,get:function(){return a.SequenceIntervalClass}}),Object.defineProperty(e,"createSequenceInterval",{enumerable:!0,get:function(){return a.createSequenceInterval}}),Object.defineProperty(e,"createPositionReferenceFromSegoff",{enumerable:!0,get:function(){return a.createPositionReferenceFromSegoff}}),Object.defineProperty(e,"createTransientInterval",{enumerable:!0,get:function(){return a.createTransientInterval}}),Object.defineProperty(e,"getSerializedProperties",{enumerable:!0,get:function(){return a.getSerializedProperties}})})(MD)),MD}var VD={},z_={},nee;function gwe(){if(nee)return z_;nee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(z_,"__esModule",{value:!0}),z_.createIdIntervalIndex=void 0;const e=Je();class n{constructor(){this.intervalIdMap=new Map}add(i){const r=i.getIntervalId();(0,e.assert)(r!==void 0,704),this.intervalIdMap.set(r,i)}remove(i){const r=i.getIntervalId();(0,e.assert)(r!==void 0,785),this.intervalIdMap.delete(r)}getIntervalById(i){return this.intervalIdMap.get(i)}[Symbol.iterator](){return this.intervalIdMap.values()}}function a(){return new n}return z_.createIdIntervalIndex=a,z_}var Hp={},ree;function ywe(){if(ree)return Hp;ree=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Hp,"__esModule",{value:!0}),Hp.createEndpointIndex=Hp.EndpointIndex=void 0;const e=Ls(),n=ny();class a{constructor(r){this.client=r,this.endIntervalTree=new e.RedBlackTree((s,o)=>s.compareEnd(o))}previousInterval(r){const s=(0,n.createTransientInterval)(r,r,this.client),o=this.endIntervalTree.floor(s);if(o)return o.data}nextInterval(r){const s=(0,n.createTransientInterval)(r,r,this.client),o=this.endIntervalTree.ceil(s);if(o)return o.data}add(r){this.endIntervalTree.put(r,r)}remove(r){this.endIntervalTree.remove(r)}}Hp.EndpointIndex=a;function t(i){const r=i.client;return new a(r)}return Hp.createEndpointIndex=t,Hp}var Kp={},HD={},iee;function gce(){return iee||(iee=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.compareOverrideables=e.forceCompare=void 0,e.forceCompare=Symbol();function n(a,t){const i=a[e.forceCompare]??0,r=t[e.forceCompare]??0;return i-r}e.compareOverrideables=n})(HD)),HD}var see;function bwe(){if(see)return Kp;see=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Kp,"__esModule",{value:!0}),Kp.createEndpointInRangeIndex=Kp.EndpointInRangeIndex=void 0;const e=Ls(),n=ny(),a=gce();class t{constructor(s){this.client=s,this.intervalTree=new e.RedBlackTree((o,u)=>{const c=o.compareEnd(u);if(c!==0)return c;const d=(0,a.compareOverrideables)(o,u);if(d!==0)return d;const l=o.getIntervalId(),f=u.getIntervalId();return l!==void 0&&f!==void 0?l.localeCompare(f):0})}add(s){this.intervalTree.put(s,s)}remove(s){this.intervalTree.remove(s)}findIntervalsWithEndpointInRange(s,o){if(s<=0||s>o||this.intervalTree.isEmpty())return[];const u=[],c=f=>(u.push(f.data),!0),d=(0,n.createTransientInterval)(s,s,this.client),l=(0,n.createTransientInterval)(o,o,this.client);return d[a.forceCompare]=-1,l[a.forceCompare]=1,this.intervalTree.mapRange(c,u,d,l),u}}Kp.EndpointInRangeIndex=t;function i(r){const s=r.client;return new t(s)}return Kp.createEndpointInRangeIndex=i,Kp}var $p={},aee;function vwe(){if(aee)return $p;aee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty($p,"__esModule",{value:!0}),$p.createStartpointInRangeIndex=$p.StartpointInRangeIndex=void 0;const e=Ls(),n=ny(),a=gce();class t{constructor(s){this.client=s,this.intervalTree=new e.RedBlackTree((o,u)=>{const c=o.compareStart(u);if(c!==0)return c;const d=(0,a.compareOverrideables)(o,u);if(d!==0)return d;const l=o.getIntervalId(),f=u.getIntervalId();return l!==void 0&&f!==void 0?l.localeCompare(f):0})}add(s){this.intervalTree.put(s,s)}remove(s){this.intervalTree.remove(s)}findIntervalsWithStartpointInRange(s,o){if(s<=0||s>o||this.intervalTree.isEmpty())return[];const u=[],c=f=>(u.push(f.data),!0),d=(0,n.createTransientInterval)(s,s,this.client),l=(0,n.createTransientInterval)(o,o,this.client);return d[a.forceCompare]=-1,l[a.forceCompare]=1,this.intervalTree.mapRange(c,u,d,l),u}}$p.StartpointInRangeIndex=t;function i(r){const s=r.client;return new t(s)}return $p.createStartpointInRangeIndex=i,$p}var Gp={},V_={},oee;function Swe(){if(oee)return V_;oee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(V_,"__esModule",{value:!0}),V_.IntervalTree=void 0;const e=Ls(),n=(t,i)=>t.compare(i);class a{constructor(){this.intervals=new e.RedBlackTree(n,this)}remove(i){this.intervals.remove(i)}removeExisting(i){this.intervals.removeExisting(i)}put(i){this.intervals.put(i,{minmax:i.clone()})}map(i){const r={infix:s=>(i(s.key),!0),showStructure:!0};this.intervals.walk(r)}mapUntil(i){const r={infix:s=>i(s.key),showStructure:!0};this.intervals.walk(r)}mapBackward(i){const r={infix:s=>(i(s.key),!0),showStructure:!0};this.intervals.walkBackward(r)}match(i){return this.intervals.gather(i,this)}matchNode(i,r){return!!i&&i.key.overlaps(r)}continueSubtree(i,r){return!!i&&i.data.minmax.overlaps(r)}update(i){i.left&&i.right?i.data.minmax=i.key.union(i.left.data.minmax.union(i.right.data.minmax)):i.left?i.data.minmax=i.key.union(i.left.data.minmax):i.right?i.data.minmax=i.key.union(i.right.data.minmax):i.data.minmax=i.key.clone()}}return V_.IntervalTree=a,V_}var cee;function Cwe(){if(cee)return Gp;cee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Gp,"__esModule",{value:!0}),Gp.createOverlappingIntervalsIndex=Gp.OverlappingIntervalsIndex=void 0;const e=Ls(),n=Swe(),a=ny();class t{constructor(s){this.intervalTree=new n.IntervalTree,this.client=s}map(s){this.intervalTree.map(s)}mapUntil(s){this.intervalTree.mapUntil(s)}gatherIterationResults(s,o,u,c){if(!this.intervalTree.intervals.isEmpty())if(u===void 0&&c===void 0)o?this.intervalTree.map(d=>{s.push(d)}):this.intervalTree.mapBackward(d=>{s.push(d)});else{const d=(0,a.createTransientInterval)(u??"start",c??"end",this.client);if(u===void 0)o?this.intervalTree.map(l=>{d.compareEnd(l)===0&&s.push(l)}):this.intervalTree.mapBackward(l=>{d.compareEnd(l)===0&&s.push(l)});else{const l=c===void 0?v=>d.compareStart(v.key):v=>d.compare(v.key),f=v=>v<=0,b=v=>v>=0,C=v=>{s.push(v.key)};o?this.intervalTree.intervals.walkExactMatchesForward(l,C,f,b):this.intervalTree.intervals.walkExactMatchesBackward(l,C,f,b)}}}findOverlappingIntervals(s,o){const{startPos:u,endPos:c}=(0,e.endpointPosAndSide)(s,o);if(u===void 0||c===void 0||typeof u=="number"&&typeof c=="number"&&c<u||u==="end"&&c!=="end"||u!=="start"&&c==="start"||this.intervalTree.intervals.isEmpty())return[];const d=(0,a.createTransientInterval)(s,o,this.client);return this.intervalTree.match(d).map(f=>f.key)}remove(s){this.intervalTree.removeExisting(s)}add(s){this.intervalTree.put(s)}}Gp.OverlappingIntervalsIndex=t;function i(r){const s=r.client;return new t(s)}return Gp.createOverlappingIntervalsIndex=i,Gp}var uee;function yce(){return uee||(uee=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.OverlappingIntervalsIndex=e.createOverlappingIntervalsIndex=e.StartpointInRangeIndex=e.createStartpointInRangeIndex=e.EndpointInRangeIndex=e.createEndpointInRangeIndex=e.EndpointIndex=e.createEndpointIndex=e.createIdIntervalIndex=void 0;var n=gwe();Object.defineProperty(e,"createIdIntervalIndex",{enumerable:!0,get:function(){return n.createIdIntervalIndex}});var a=ywe();Object.defineProperty(e,"createEndpointIndex",{enumerable:!0,get:function(){return a.createEndpointIndex}}),Object.defineProperty(e,"EndpointIndex",{enumerable:!0,get:function(){return a.EndpointIndex}});var t=bwe();Object.defineProperty(e,"createEndpointInRangeIndex",{enumerable:!0,get:function(){return t.createEndpointInRangeIndex}}),Object.defineProperty(e,"EndpointInRangeIndex",{enumerable:!0,get:function(){return t.EndpointInRangeIndex}});var i=vwe();Object.defineProperty(e,"createStartpointInRangeIndex",{enumerable:!0,get:function(){return i.createStartpointInRangeIndex}}),Object.defineProperty(e,"StartpointInRangeIndex",{enumerable:!0,get:function(){return i.StartpointInRangeIndex}});var r=Cwe();Object.defineProperty(e,"createOverlappingIntervalsIndex",{enumerable:!0,get:function(){return r.createOverlappingIntervalsIndex}}),Object.defineProperty(e,"OverlappingIntervalsIndex",{enumerable:!0,get:function(){return r.OverlappingIntervalsIndex}})})(VD)),VD}var Zi={},dee;function _we(){if(dee)return Zi;dee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.revertSharedStringRevertibles=Zi.discardSharedStringRevertibles=Zi.appendSharedStringDeltaToRevertibles=Zi.appendIntervalPropertyChangedToRevertibles=Zi.appendChangeIntervalToRevertibles=Zi.appendDeleteIntervalToRevertibles=Zi.appendAddIntervalToRevertibles=void 0;const e=Je(),n=Ls(),a=ny(),t=new Map;function i(R){const M=R.getIntervalId();return r(M)}function r(R){return t.get(R)??R}function s(R,M){return M.push({event:a.IntervalOpType.ADD,interval:R}),M}Zi.appendAddIntervalToRevertibles=s;function o(R,M,j){const k=M.start.getSegment();if(!k)return j;const x=(0,n.segmentIsRemoved)(k)?n.ReferenceType.SlideOnRemove|n.ReferenceType.RangeBegin:n.ReferenceType.StayOnRemove|n.ReferenceType.RangeBegin,L=M.end.getSegment();if(!L)return j;const V=(0,n.segmentIsRemoved)(k)?n.ReferenceType.SlideOnRemove|n.ReferenceType.RangeEnd:n.ReferenceType.StayOnRemove|n.ReferenceType.RangeEnd,G=R.createLocalReferencePosition(k,M.start.getOffset(),x,void 0,M.start.slidingPreference),ee=R.createLocalReferencePosition(L,M.end.getOffset(),V,void 0,M.end.slidingPreference),se={event:a.IntervalOpType.DELETE,interval:M,start:G,end:ee};return se.start.addProperties({revertible:se}),se.end.addProperties({revertible:se}),j.push(se),j}Zi.appendDeleteIntervalToRevertibles=o;function u(R,M,j,k){const x=j.start.getSegment(),L=(0,n.segmentIsRemoved)(x)?n.ReferenceType.SlideOnRemove|n.ReferenceType.RangeBegin:n.ReferenceType.StayOnRemove|n.ReferenceType.RangeBegin,V=j.end.getSegment(),G=(0,n.segmentIsRemoved)(x)?n.ReferenceType.SlideOnRemove|n.ReferenceType.RangeEnd:n.ReferenceType.StayOnRemove|n.ReferenceType.RangeEnd,ee=R.createLocalReferencePosition(x,j.start.getOffset(),L,void 0,j.start.slidingPreference),se=R.createLocalReferencePosition(V,j.end.getOffset(),G,void 0,j.end.slidingPreference),re={event:a.IntervalOpType.CHANGE,interval:M,start:ee,end:se};return re.start.addProperties({revertible:re}),re.end.addProperties({revertible:re}),k.push(re),k}Zi.appendChangeIntervalToRevertibles=u;function c(R,M,j){return j.push({event:a.IntervalOpType.PROPERTY_CHANGED,interval:R,propertyDeltas:M}),j}Zi.appendIntervalPropertyChangedToRevertibles=c;function d(R,M,j,k){if((0,n.refTypeIncludesFlag)(R.refType,n.ReferenceType.RangeBegin)){const x=R.properties?.interval;if(x&&x instanceof a.SequenceIntervalClass)return j.push({offset:M+x.start.getOffset(),interval:x}),!0}else if((0,n.refTypeIncludesFlag)(R.refType,n.ReferenceType.RangeEnd)){const x=R.properties?.interval;if(x&&x instanceof a.SequenceIntervalClass)return k.push({offset:M+x.end.getOffset(),interval:x}),!0}return!1}function l(R,M,j){const k=R.properties?.revertible;k&&j.push({revertible:k,offset:M+R.getOffset(),isStart:(0,n.refTypeIncludesFlag)(R.refType,n.ReferenceType.RangeBegin)})}function f(R,M,j){if(M.ranges.length===0)return;if(M.deltaOperation===n.MergeTreeDeltaType.REMOVE){const x=[],L=[],V=[];let G=0;for(const ee of M.ranges){const re=ee.segment.localRefs;if(re!==void 0&&ee.position!==-1)for(const fe of re)d(fe,G,x,L),l(fe,G,V);G+=ee.segment.cachedLength}if(x.length>0||L.length>0||V.length>0){const ee=[];(0,n.appendToMergeTreeDeltaRevertibles)(M.deltaArgs,ee),(0,e.assert)(ee.length===1,1732);const se={event:a.IntervalOpType.POSITION_REMOVE,intervals:[],revertibleRefs:V,mergeTreeRevertible:ee[0]};x.forEach(({interval:re,offset:fe})=>{const oe=L.findIndex(de=>de.interval===re);let pe;oe!==-1&&(pe=L[oe].offset,L.splice(oe,1)),se.intervals.push({intervalId:re.getIntervalId(),label:re.start.properties?.referenceRangeLabels[0],startOffset:fe,endOffset:pe})}),L.forEach(({interval:re,offset:fe})=>{se.intervals.push({intervalId:re.getIntervalId(),label:re.start.properties?.referenceRangeLabels[0],endOffset:fe})}),j.push(se);return}}const k=[];j.length>0&&(0,n.isMergeTreeDeltaRevertible)(j[j.length-1])&&k.push(j.pop()),(0,n.appendToMergeTreeDeltaRevertibles)(M.deltaArgs,k),j.push(...k)}Zi.appendSharedStringDeltaToRevertibles=f;function b(R,M){M.forEach(j=>{(0,n.isMergeTreeDeltaRevertible)(j)?(0,n.discardMergeTreeDeltaRevertible)([j]):(j.event===a.IntervalOpType.CHANGE||j.event===a.IntervalOpType.DELETE)&&(R.removeLocalReferencePosition(j.start),R.removeLocalReferencePosition(j.end))})}Zi.discardSharedStringRevertibles=b;function C(R,M,j){const k=M.getSegment(),x=M.getOffset(),L=k===void 0?void 0:(0,n.getSlideToSegoff)({segment:k,offset:x},M.slidingPreference);return L!==void 0&&R.getPosition(L.segment)!==-1&&(j<0||j>=R.getLength())?R.getPosition(L.segment)+L.offset:j}function v(R,M,j,k,x){return R>=0&&R<x.getLength()&&j>=0&&j<x.getLength()&&(R<j||R===j&&(M===n.SlidingPreference.FORWARD||k!==n.SlidingPreference.FORWARD))}function m(R,M){const j=i(M.interval),k=M.interval.start.properties?.referenceRangeLabels[0];R.getIntervalCollection(k).removeIntervalById(j)}function h(R,M,j=void 0){return M===n.SlidingPreference.BACKWARD||M===void 0&&j===n.SlidingPreference.BACKWARD?{pos:R,side:n.Side.After}:M===n.SlidingPreference.FORWARD&&j===n.SlidingPreference.BACKWARD?{pos:R,side:n.Side.Before}:R}function g(R,M){const j=M.interval.start.properties?.referenceRangeLabels[0],k=R.getIntervalCollection(j),x=R.localReferencePositionToPosition(M.start),L=C(R,M.start,x),V=R.localReferencePositionToPosition(M.end),G=C(R,M.end,V),{...ee}=M.interval.properties,se=M.interval.getIntervalId();if(v(L,M.start.slidingPreference,G,M.end.slidingPreference,R)){const re=k.add({start:h(L,M.start.slidingPreference),end:h(G,M.end.slidingPreference),props:ee});t.forEach((fe,oe)=>{se===fe&&t.set(oe,i(re))}),t.set(se,re.getIntervalId())}R.removeLocalReferencePosition(M.start),R.removeLocalReferencePosition(M.end)}function _(R,M){const j=M.interval.start.properties?.referenceRangeLabels[0],k=R.getIntervalCollection(j),x=i(M.interval),L=R.localReferencePositionToPosition(M.start),V=C(R,M.start,L),G=R.localReferencePositionToPosition(M.end),ee=C(R,M.end,G),se=k.getIntervalById(x);se!==void 0&&v(V,M.start.slidingPreference??se.start.slidingPreference,ee,M.end.slidingPreference??se.end.slidingPreference,R)&&k.change(x,{start:h(V,M.start.slidingPreference,se.start.slidingPreference),end:h(ee,M.end.slidingPreference,se.end.slidingPreference)}),R.removeLocalReferencePosition(M.start),R.removeLocalReferencePosition(M.end)}function S(R,M){const j=M.interval.start.properties?.referenceRangeLabels[0],k=i(M.interval),x=M.propertyDeltas;R.getIntervalCollection(j).change(k,{props:x})}function p(R,M){if(R===void 0)return;let j=R;for(const k of M.items){if(j<k.length)for(const x of k.ranges){if(x.segment.cachedLength>j)return{segment:x.segment,offset:j};j-=x.segment.cachedLength}j-=k.length}}function w(R,M,j){const k=p(R,M);return k===void 0?void 0:j.getPosition(k.segment)+k.offset}class O extends n.SortedSegmentSet{}function E(R,M){const j=new O,k=x=>{if(x.ranges.length>0){let L=0;x.ranges.forEach(V=>{L+=V.segment.cachedLength}),j.addOrUpdate({ranges:x.ranges,length:L,segment:x.ranges[0].segment})}};R.on("sequenceDelta",k),(0,n.revertMergeTreeDeltaRevertibles)(R,[M.mergeTreeRevertible]),R.off("sequenceDelta",k),M.intervals.forEach(x=>{const L=R.getIntervalCollection(x.label),V=r(x.intervalId),G=L.getIntervalById(V);if(G!==void 0){const ee=w(x.startOffset,j,R)??R.localReferencePositionToPosition(G.start),se=w(x.endOffset,j,R)??R.localReferencePositionToPosition(G.end);v(ee,G.start.slidingPreference,se,G.end.slidingPreference,R)&&L.change(V,{start:h(ee,G.start.slidingPreference),end:h(se,G.end.slidingPreference)})}}),M.revertibleRefs.forEach(x=>{(0,e.assert)(x.revertible.event===a.IntervalOpType.CHANGE||x.revertible.event===a.IntervalOpType.DELETE,1733);const L=p(x.offset,j);if(L!==void 0)if(x.isStart){R.removeLocalReferencePosition(x.revertible.start);const V=R.createLocalReferencePosition(L.segment,L.offset,n.ReferenceType.StayOnRemove|n.ReferenceType.RangeBegin,{revertible:x.revertible},x.revertible.start.slidingPreference);x.revertible.start=V}else{R.removeLocalReferencePosition(x.revertible.end);const V=R.createLocalReferencePosition(L.segment,L.offset,n.ReferenceType.StayOnRemove|n.ReferenceType.RangeEnd,{revertible:x.revertible},x.revertible.end.slidingPreference);x.revertible.end=V}})}function F(R,M){for(;M.length>0;){const j=M.pop();if("event"in j){const k=j.event;switch(k){case a.IntervalOpType.ADD:m(R,j);break;case a.IntervalOpType.DELETE:g(R,j);break;case a.IntervalOpType.CHANGE:_(R,j);break;case a.IntervalOpType.PROPERTY_CHANGED:S(R,j);break;case a.IntervalOpType.POSITION_REMOVE:E(R,j);break;default:(0,e.unreachableCase)(k)}}else(0,n.revertMergeTreeDeltaRevertibles)(R,[j])}}return Zi.revertSharedStringRevertibles=F,Zi}var ed={},H_={},K_={},lee;function Twe(){if(lee)return K_;lee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(K_,"__esModule",{value:!0}),K_.makeSerializable=void 0;const e=Ma();function n(a,t,i,r){const s=a.serializeInternal(r),o=(0,e.serializeHandles)(s,t,i);return{type:"sharedStringIntervalCollection",value:o&&JSON.parse(o)}}return K_.makeSerializable=n,K_}var Ia={},fee;function wwe(){if(fee)return Ia;fee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.intervalLocatorFromEndpoint=Ia.IntervalCollection=Ia.LocalIntervalCollection=Ia.toOptionalSequencePlace=Ia.toSequencePlace=void 0;const e=Ht(),n=Je(),a=Ls(),t=Ot(),i=ys(),r=yce(),s=ny();function o(S){const p=(S&s.IntervalStickiness.START)!==0?a.Side.After:a.Side.Before,w=(S&s.IntervalStickiness.END)!==0?a.Side.Before:a.Side.After;return{startSide:p,endSide:w}}function u(S,p){const w=S[5]??s.IntervalStickiness.END,{startSide:O,endSide:E}=o(w);return{start:S[0],end:S[1],sequenceNumber:S[2],intervalType:S[3],properties:{...S[4],[a.reservedRangeLabelsKey]:[p]},stickiness:w,startSide:O,endSide:E}}function c(S){const{start:p,end:w,sequenceNumber:O,intervalType:E,properties:F}=S;let R=[p,w,O,E,{...F,[a.reservedRangeLabelsKey]:void 0}];return S.stickiness!==void 0&&S.stickiness!==s.IntervalStickiness.END&&(R=[...R,S.stickiness]),R}function d(S,p){return typeof S=="number"&&p!==void 0?{pos:S,side:p}:S}Ia.toSequencePlace=d;function l(S,p){return typeof S=="number"&&p!==void 0?{pos:S,side:p}:S}Ia.toOptionalSequencePlace=l;class f{constructor(p,w,O,E){this.client=p,this.label=w,this.options=O,this.onPositionChange=E,this.overlappingIntervalsIndex=new r.OverlappingIntervalsIndex(p),this.idIntervalIndex=(0,r.createIdIntervalIndex)(),this.endIntervalIndex=new r.EndpointIndex(p),this.indexes=new Set([this.overlappingIntervalsIndex,this.idIntervalIndex,this.endIntervalIndex])}removeIntervalFromIndexes(p){for(const w of this.indexes)w.remove(p)}appendIndex(p){this.indexes.add(p)}removeIndex(p){return this.indexes.delete(p)}removeExistingInterval(p){this.removeIntervalFromIndexes(p),this.removeIntervalListeners(p)}addInterval(p,w,O,E,F){if(E?.[a.reservedRangeLabelsKey]!==void 0&&E[a.reservedRangeLabelsKey][0]!==this.label)throw new t.LoggingError("Adding an interval that belongs to another interval collection is not permitted");const R=(0,s.createSequenceInterval)(this.label,p,w,O,this.client,s.IntervalType.SlideOnRemove,F,void 0,this.options.mergeTreeReferencesCanSlideToEndpoint,E,!1);return this.add(R),R}linkEndpointsToInterval(p){p.start.addProperties({interval:p}),p.end.addProperties({interval:p})}addIntervalToIndexes(p){for(const w of this.indexes)w.add(p)}add(p){this.linkEndpointsToInterval(p),this.addIntervalToIndexes(p),this.addIntervalListeners(p)}changeInterval(p,w,O,E,F){const R=p.modify(this.label,w,O,E,F,this.options.mergeTreeReferencesCanSlideToEndpoint);return R&&(this.removeExistingInterval(p),this.add(R)),R}serialize(p){return p==="1"?Array.from(this.idIntervalIndex,w=>w.serialize()):{label:this.label,intervals:Array.from(this.idIntervalIndex,w=>c(w.serialize())),version:2}}addIntervalListeners(p){const w=F=>{const R=F.getSegment();return R===void 0?F:this.client.createLocalReferencePosition(R,F.getOffset(),a.ReferenceType.Transient,F.properties,F.slidingPreference,F.canSlideToEndpoint)};let O,E=0;p.addPositionChangeListeners(()=>{E++,O||(O=p.clone(),O.start=w(O.start),O.end=w(O.end),this.removeIntervalFromIndexes(p))},()=>{(0,n.assert)(O!==void 0,1018),E--,E===0&&(this.addIntervalToIndexes(p),this.onPositionChange?.(p,O),O=void 0)})}removeIntervalListeners(p){p.removePositionChangeListeners()}}Ia.LocalIntervalCollection=f;class b{constructor(p,w=!0,O,E){this.results=[],this.index=0,p.gatherIterationResults(this.results,w,O,E)}next(){return this.index<this.results.length?{value:this.results[this.index++],done:!1}:{value:void 0,done:!0}}}function C(S){const p=S?.remove()?.data;return(0,n.assert)(p!==void 0,3006),p.endpointChangesNode?.remove(),p}function v(S,p){const w=S[p];return w!==void 0&&w.local.empty&&((0,n.assert)(w.endpointChanges?.empty!==!1,3008),delete S[p]),w}function m(S){return S.start!==void 0&&S.end!==void 0}class h extends e.TypedEventEmitter{get attached(){return!!this.localCollection}constructor(p,w,O={}){super(),this.options=O,this.pending={},this.submitDelta=(E,F,R)=>{const{id:M}=(0,s.getSerializedProperties)(E.value),j=this.pending[M]??={local:new n.DoublyLinkedList,consensus:R};if(F.type==="add"||F.type==="change"&&m(E.value)){const k=j.endpointChanges??=new n.DoublyLinkedList;F.endpointChangesNode=k.push(F).last}p(E,j.local.push(F).last)},this.savedSerializedIntervals=Array.isArray(w)?w:w.intervals.map(E=>u(E,w.label))}attachIndex(p){if(!this.attached)throw new t.LoggingError("The local interval collection must exist");for(const w of this)p.add(w);this.localCollection?.appendIndex(p)}detachIndex(p){if(!this.attached)throw new t.LoggingError("The local interval collection must exist");if(!this.localCollection?.removeIndex(p))return!1;for(const w of this)p.remove(w);return!0}rollback(p,w){const O=C(w),{value:E}=p,{id:F,properties:R}=(0,s.getSerializedProperties)(E),M=v(this.pending,F),j=M?.local.empty?M.consensus:M?.local.last?.data.interval,{type:k,interval:x}=O;switch(k){case"add":{this.deleteExistingInterval({interval:x,local:!0,rollback:!0}),x.dispose();break}case"change":{const L=Object.keys(R).length>0,V=L?x.changeProperties(R,void 0,!0):void 0;O.endpointChangesNode!==void 0&&(j!==void 0&&(this.localCollection?.removeExistingInterval(x),this.localCollection?.add(j),this.emitChange(j,x,!0,!0)),j!==x&&x.dispose()),L&&this.emit("propertyChanged",j,V,!0,void 0);break}case"delete":{j!==void 0&&(this.localCollection?.add(j),this.emit("addInterval",j,!0,void 0));break}default:(0,n.unreachableCase)(k)}}process(p,w,O,E){const F=w?C(E):void 0,{opName:R,value:M}=p,{id:j}=(0,s.getSerializedProperties)(M);(0,n.assert)(w===!1&&F===void 0||R===F?.type,3009);let k=F?.interval;switch(R){case"add":{k=this.ackAdd(M,w,O,F);break}case"delete":{this.ackDelete(M,w,O);break}case"change":{k=this.ackChange(M,w,O,F);break}default:(0,n.unreachableCase)(R)}const x=v(this.pending,j);x!==void 0&&(x.consensus=k)}resubmitMessage(p,w,O){const{opName:E,value:F}=p,R=C(w),M=R.endpointChangesNode===void 0?F:this.rebaseLocalInterval(F,R,O);if(M===void 0){const{id:j}=(0,s.getSerializedProperties)(F);v(this.pending,j);return}this.submitDelta({opName:E,value:M},R)}applyStashedOp(p){const{opName:w,value:O}=p,{id:E,properties:F}=(0,s.getSerializedProperties)(O);switch(w){case"add":{this.add({id:E,start:d(O.start,O.startSide),end:d(O.end,O.endSide),props:F});break}case"change":{this.change(E,{start:l(O.start,O.startSide),end:l(O.end,O.endSide),props:F});break}case"delete":{this.removeIntervalById(E);break}default:throw new Error("unknown ops should not be stashed")}}rebaseReferenceWithSegmentSlide(p,w,O){if(!this.client)throw new t.LoggingError("mergeTree client must exist");const{clientId:E}=this.client.getCollabWindow(),F=p.getSegment();if(F?.endpointType)return{segment:F,offset:0};const R=p.getOffset(),M=(0,a.getSlideToSegoff)(F===void 0?void 0:{segment:F,offset:R},p.slidingPreference,(0,a.createLocalReconnectingPerspective)(this.client.getCurrentSeq(),E,w,O),p.canSlideToEndpoint);return M===void 0?p.canSlideToEndpoint!==!0?void 0:{segment:p.slidingPreference===a.SlidingPreference.FORWARD?this.client.endOfTree:this.client.startOfTree,offset:0}:M}computeRebasedPositions(p,w){(0,n.assert)(this.client!==void 0,1360);const{localSeq:O,interval:E}=p,F=this.rebaseReferenceWithSegmentSlide(E.start,O,w);if(F===void 0)return"detached";const R=this.rebaseReferenceWithSegmentSlide(E.end,O,w);return R===void 0?"detached":{start:F,end:R}}attachGraph(p,w){if(this.attached)throw new t.LoggingError("Only supports one Sequence attach");if(p===void 0)throw new t.LoggingError("Client required for this collection");if(this.client=p,p&&p.on("normalize",O=>{for(const E of Object.values(this.pending))if(E?.endpointChanges!==void 0)for(const F of E.endpointChanges)this.rebaseLocalInterval(F.data.interval.serialize(),F.data,O)}),this.localCollection=new f(p,w,this.options,(O,E)=>this.emitChange(O,E,!0,!0)),this.savedSerializedIntervals)for(const O of this.savedSerializedIntervals){const{id:E,properties:F}=(0,s.getSerializedProperties)(O),{start:R,end:M,intervalType:j,startSide:k,endSide:x}=O,L=typeof R=="number"&&k!==void 0?{pos:R,side:k}:R,V=typeof M=="number"&&x!==void 0?{pos:M,side:x}:M,G=(0,s.createSequenceInterval)(w,E,L,V,p,j,void 0,!0,this.options.mergeTreeReferencesCanSlideToEndpoint,F);this.localCollection.add(G)}this.savedSerializedIntervals=void 0}getNextLocalSeq(){return this.client?++this.client.getCollabWindow().localSeq:0}emitChange(p,w,O,E,F){const R=w.start.refType,M=w.end.refType;w.start.refType=a.ReferenceType.Transient,w.end.refType=a.ReferenceType.Transient,this.emit("changeInterval",p,w,O,F,E),this.emit("changed",p,void 0,w??void 0,O,E),w.start.refType=R,w.end.refType=M}getIntervalById(p){if(!this.localCollection)throw new t.LoggingError("attach must be called before accessing intervals");return this.localCollection.idIntervalIndex.getIntervalById(p)}assertStickinessEnabled(p,w){if(!(typeof p=="number"&&typeof w=="number")&&!this.options.intervalStickinessEnabled)throw new t.UsageError("attempted to set interval stickiness without enabling `intervalStickinessEnabled` feature flag")}add({id:p,start:w,end:O,props:E}){if(!this.localCollection)throw new t.LoggingError("attach must be called prior to adding intervals");const{startSide:F,endSide:R,startPos:M,endPos:j}=(0,a.endpointPosAndSide)(w,O);(0,n.assert)(M!==void 0&&j!==void 0&&F!==void 0&&R!==void 0,1939),this.assertStickinessEnabled(w,O);const k=p??(0,i.v4)(),x=this.localCollection.addInterval(k,d(M,F),d(j,R),E,void 0);if(x){this.isCollaborating||(g(x.start),g(x.end));const L=x.serialize(),V=this.getNextLocalSeq();this.isCollaborating&&this.submitDelta({opName:"add",value:L},{type:"add",localSeq:V,interval:x})}return this.emit("addInterval",x,!0,void 0),x}deleteExistingInterval({interval:p,local:w,op:O,rollback:E}){if(!this.localCollection)throw new t.LoggingError("Attach must be called before accessing intervals");if(this.localCollection.removeExistingInterval(p),p)if(w&&E!==!0){const F=p.serialize();this.submitDelta({opName:"delete",value:F},{type:"delete",localSeq:this.getNextLocalSeq()},p)}else this.onDeserialize&&this.onDeserialize(p);this.emit("deleteInterval",p,w,O)}removeIntervalById(p){if(!this.localCollection)throw new t.LoggingError("Attach must be called before accessing intervals");const w=this.getIntervalById(p);return w&&this.deleteExistingInterval({interval:w,local:!0}),w}change(p,{start:w,end:O,props:E,rollback:F}){if(!this.localCollection)throw new t.LoggingError("Attach must be called before accessing intervals");if(typeof p!="string")throw new t.UsageError("Change API requires an ID that is a string");if(w===void 0!=(O===void 0))throw new t.UsageError("Change API requires both start and end to be defined or undefined");if(E?.[a.reservedRangeLabelsKey]!==void 0)throw new t.UsageError("The label property should not be modified once inserted to the collection");const R=this.getIntervalById(p);if(R){let M,j;E!==void 0&&(M=R.changeProperties(E,void 0,F));const k=w!==void 0&&O!==void 0;if(k&&(j=this.localCollection.changeInterval(R,w,O),!this.isCollaborating&&j!==void 0&&(g(j.start),g(j.end))),this.isCollaborating&&F!==!0){const x=(j??R).serializeDelta({props:E,includeEndpoints:k}),V={type:"change",localSeq:this.getNextLocalSeq(),interval:j??R};this.submitDelta({opName:"change",value:x},V,R)}return M!==void 0&&(this.emit("propertyChanged",R,M,!0,void 0),this.emit("changed",j??R,M,j?R:void 0,!0,!1)),j&&(this.emitChange(j,R,!0,!1),R.start.properties.interval=void 0,R.end.properties.interval=void 0),j}}get isCollaborating(){return this.client?.getCollabWindow().collaborating??!1}hasPendingEndpointChanges(p){return this.pending[p]?.endpointChanges?.empty===!1}ackChange(p,w,O,E){if(!this.localCollection)throw new t.LoggingError("Attach must be called before accessing intervals");const{id:F,properties:R}=(0,s.getSerializedProperties)(p);if((0,n.assert)(F!==void 0,1022),w){(0,n.assert)(E!==void 0,3028);const{interval:M}=E;return M.ackPropertiesChange(R,O),this.ackInterval(M,O),M}else{const M=this.getIntervalById(F),j=this.pending[F]?.consensus??M,k=j===M;if(!j)return j;const x=j.changeProperties(R,O);let L=j;if(m(p)){const{start:V,end:G,startSide:ee,endSide:se}=p;L=j.modify("",l(V,ee??a.Side.Before),l(G,se??a.Side.Before),O),k&&(this.localCollection.removeExistingInterval(j),this.localCollection.add(L),this.emitChange(L,j,w,!1,O),this.onDeserialize&&this.onDeserialize(L))}return x!==void 0&&Object.keys(x).length>0&&(this.emit("propertyChanged",M,x,w,O),this.emit("changed",M,x,void 0,w,!1)),L}}attachDeserializer(p){p&&(this.onDeserialize=p,this.attached&&this.map(p))}rebaseLocalInterval(p,w,O){if(!this.client||!m(p))return p;if(!this.attached||this.localCollection===void 0)throw new t.LoggingError("attachSequence must be called");const{localSeq:E,interval:F}=w,{id:R}=(0,s.getSerializedProperties)(p),M=this.computeRebasedPositions(w,O),j=this.getIntervalById(R);if(M==="detached"){j!==void 0&&(j===F||w.type==="add")&&this.localCollection?.removeExistingInterval(j);return}const{start:k,end:x}=M;if(F.start.getSegment()!==k.segment||F.start.getOffset()!==k.offset||F.end.getSegment()!==x.segment||F.end.getOffset()!==x.offset){j===F&&this.localCollection.removeExistingInterval(j);const L=F.clone();F.moveEndpointReferences(M),j===F&&(this.localCollection.add(F),this.emitChange(F,L,!0,!0)),L.dispose()}return{...p,start:k.segment.endpointType??this.client.findReconnectionPosition(k.segment,E)+k.offset,end:x.segment.endpointType??this.client.findReconnectionPosition(x.segment,E)+x.offset,sequenceNumber:this.client?.getCurrentSeq()??0}}getSlideToSegment(p){if(!this.client)throw new t.LoggingError("client does not exist");const w=p.getSegment();if(w===void 0)return;const O={segment:w,offset:p.getOffset()};if(O.segment.localRefs?.has(p)===!0)return(0,a.getSlideToSegoff)(O,p.slidingPreference,void 0,p.canSlideToEndpoint)}ackInterval(p,w){if(!(0,a.refTypeIncludesFlag)(p.start,a.ReferenceType.StayOnRemove)&&!(0,a.refTypeIncludesFlag)(p.end,a.ReferenceType.StayOnRemove))return;const O=this.getSlideToSegment(p.start),E=this.getSlideToSegment(p.end),F=p.getIntervalId(),R=this.hasPendingEndpointChanges(F);R||(g(p.start),g(p.end));const M=O?.segment!==p.start.getSegment()&&!R,j=E?.segment!==p.end.getSegment()&&!R;if(M||j){if(!this.localCollection)throw new t.LoggingError("Attach must be called before accessing intervals");const k=p.clone(),x=this.getIntervalById(F)===p;if(x&&this.localCollection.removeExistingInterval(p),!this.client)throw new t.LoggingError("client does not exist");if(M){const L=p.start.properties;p.start=(0,s.createPositionReferenceFromSegoff)({client:this.client,segoff:O,refType:p.start.refType,op:w,slidingPreference:p.start.slidingPreference,canSlideToEndpoint:p.start.canSlideToEndpoint}),L&&p.start.addProperties(L);const V=k.start.getSegment();this.client.removeLocalReferencePosition(k.start),k.start.refType=a.ReferenceType.Transient,V?.localRefs?.addLocalRef(k.start,k.start.getOffset())}if(j){const L=p.end.properties;p.end=(0,s.createPositionReferenceFromSegoff)({client:this.client,segoff:E,refType:p.end.refType,op:w,slidingPreference:p.end.slidingPreference,canSlideToEndpoint:p.end.canSlideToEndpoint}),L&&p.end.addProperties(L);const V=k.end.getSegment();this.client.removeLocalReferencePosition(k.end),k.end.refType=a.ReferenceType.Transient,V?.localRefs?.addLocalRef(k.end,k.end.getOffset())}x&&(this.localCollection.add(p),this.emitChange(p,k,!0,!0,w))}}ackAdd(p,w,O,E){const{id:F,properties:R}=(0,s.getSerializedProperties)(p);if(w)return(0,n.assert)(E!==void 0,1363),this.ackInterval(E.interval,O),E.interval;if(!this.localCollection)throw new t.LoggingError("attachSequence must be called");const M=this.localCollection.addInterval(F,d(p.start,p.startSide??a.Side.Before),d(p.end,p.endSide??a.Side.Before),R,O);return M&&this.onDeserialize&&this.onDeserialize(M),this.emit("addInterval",M,w,O),M}ackDelete(p,w,O){if(w)return;if(!this.localCollection)throw new t.LoggingError("attach must be called prior to deleting intervals");const{id:E}=(0,s.getSerializedProperties)(p),F=this.getIntervalById(E);F&&this.deleteExistingInterval({interval:F,local:w,op:O})}serializeInternal(p){if(!this.localCollection)throw new t.LoggingError("attachSequence must be called");return this.localCollection.serialize(p)}[Symbol.iterator](){return new b(this)}CreateForwardIteratorWithStartPosition(p){return new b(this,!0,p)}CreateBackwardIteratorWithStartPosition(p){return new b(this,!1,p)}CreateForwardIteratorWithEndPosition(p){return new b(this,!0,void 0,p)}CreateBackwardIteratorWithEndPosition(p){return new b(this,!1,void 0,p)}gatherIterationResults(p,w,O,E){this.localCollection&&this.localCollection.overlappingIntervalsIndex.gatherIterationResults(p,w,O,E)}findOverlappingIntervals(p,w){if(!this.localCollection)throw new t.LoggingError("attachSequence must be called");return this.localCollection.overlappingIntervalsIndex.findOverlappingIntervals(p,w)}map(p){if(!this.localCollection)throw new t.LoggingError("attachSequence must be called");for(const w of this.localCollection.idIntervalIndex)p(w)}previousInterval(p){if(!this.localCollection)throw new t.LoggingError("attachSequence must be called");return this.localCollection.endIntervalIndex.previousInterval(p)}nextInterval(p){if(!this.localCollection)throw new t.LoggingError("attachSequence must be called");return this.localCollection.endIntervalIndex.nextInterval(p)}}Ia.IntervalCollection=h;function g(S){let p=S.refType;p=p&~a.ReferenceType.StayOnRemove,p=p|a.ReferenceType.SlideOnRemove,S.refType=p}function _(S){const{interval:p,[a.reservedRangeLabelsKey]:w}=S.properties??{};return p&&w?.length===1?{label:w[0],interval:p}:void 0}return Ia.intervalLocatorFromEndpoint=_,Ia}var hee;function Owe(){if(hee)return H_;hee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(H_,"__esModule",{value:!0}),H_.IntervalCollectionMap=void 0;const e=Ht(),n=Je(),a=Ma(),t=Twe(),i=wwe();function r(o){return typeof o=="object"&&o!==null&&"type"in o&&o.type==="act"}class s{get size(){return this.data.size}get events(){return this.eventEmitter}constructor(u,c,d,l){this.serializer=u,this.handle=c,this.submitMessage=d,this.options=l,this.data=new Map,this.eventEmitter=new e.TypedEventEmitter}keys(){return this.data.keys()}values(){const u=this.data.values();return{next(){const d=u.next();return d.done?{value:void 0,done:!0}:{value:d.value,done:!1}},[Symbol.iterator](){return this}}}get(u){return this.data.get(u)??this.createCore(u,!0)}serialize(u){const c={};return this.data.forEach((d,l)=>{c[l]=(0,t.makeSerializable)(d,u,this.handle,this.options?.intervalSerializationFormat??"2")}),JSON.stringify(c)}populate(u){const c=this.serializer.parse(u);for(const[d,l]of Object.entries(c)){if(l.type===a.ValueType[a.ValueType.Plain]||l.type===a.ValueType[a.ValueType.Shared])continue;const f=d.startsWith("intervalCollections/")?d.substring(20):d;(0,n.assert)(l.type!==a.ValueType[a.ValueType.Plain]&&l.type!==a.ValueType[a.ValueType.Shared],737),this.createCore(f,!1,l.value)}}tryResubmitMessage(u,c,d){if(r(u)){const{value:l,key:f}=u,b=this.data.get(f);return(0,n.assert)(b!==void 0,1016),b.resubmitMessage(l,c,d),!0}return!1}tryRollback(u,c){if(r(u)){const d=this.data.get(u.key);return(0,n.assert)(d!==void 0,2942),d.rollback(u.value,c),!0}return!1}tryApplyStashedOp(u){if(r(u)){const{value:c,key:d}=u;return this.get(d).applyStashedOp(c),!0}return!1}tryProcessMessage(u,c,d,l){if(r(u)){const{value:f,key:b}=u;return(this.data.get(b)??this.createCore(b,c)).process(f,c,d,l),!0}return!1}createCore(u,c,d){const l=new i.IntervalCollection((f,b)=>{this.submitMessage({key:u,type:"act",value:f},b)},d??[],this.options);return this.data.set(u,l),this.eventEmitter.emit("createIntervalCollection",u,c,this.eventEmitter),l}}return H_.IntervalCollectionMap=s,H_}var td={},mee;function Pwe(){if(mee)return td;mee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(td,"__esModule",{value:!0}),td.SequenceMaintenanceEventClass=td.SequenceDeltaEventClass=td.SequenceEventClass=void 0;const e=Je(),n=Ls();class a{constructor(s,o,u){this.opArgs=s,this.deltaArgs=o,this.mergeTreeClient=u,o.operation!==n.MergeTreeDeltaType.OBLITERATE&&o.operation!==n.MergeTreeMaintenanceType.ACKNOWLEDGED&&(0,e.assert)(o.deltaSegments.length>0,728),this.deltaOperation=o.operation,this.isLocal=s?.sequencedMessage===void 0,this.sortedRanges=new e.Lazy(()=>{const c=new n.SortedSegmentSet;return this.deltaArgs.deltaSegments.forEach(d=>{const l={operation:this.deltaArgs.operation,position:this.mergeTreeClient.getPosition(d.segment),propertyDeltas:d.propertyDeltas??{},segment:d.segment};c.addOrUpdate(l)}),c}),this.pFirst=new e.Lazy(()=>this.sortedRanges.value.items[0]),this.pLast=new e.Lazy(()=>this.sortedRanges.value.items[this.sortedRanges.value.size-1])}get ranges(){return this.sortedRanges.value.items}get clientId(){return this.mergeTreeClient.longClientId}get first(){return this.pFirst.value}get last(){return this.pLast.value}}td.SequenceEventClass=a;class t extends a{constructor(s,o,u){super(s,o,u),this.opArgs=s}}td.SequenceDeltaEventClass=t;class i extends a{constructor(s,o,u){super(s,o,u),this.opArgs=s}}return td.SequenceMaintenanceEventClass=i,td}var pee;function sL(){if(pee)return ed;pee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var e=ed&&ed.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(ed,"__esModule",{value:!0}),ed.resetReentrancyLogCounter=ed.SharedSegmentSequence=void 0;const n=Ht(),a=Je(),t=on(),i=Ls(),r=bn(),s=Ma(),o=Ot(),u=e(ix()),c=Owe(),d=Pwe(),l="header",f="content";class b extends s.SharedObject{static createOpsFromDelta(S){const p=[];for(const w of S.ranges)switch(S.deltaOperation){case i.MergeTreeDeltaType.ANNOTATE:{const O=p[p.length-1],E={};for(const F of Object.keys(w.propertyDeltas))E[F]=w.segment.properties?.[F]??null;O&&O.pos2===w.position&&(0,i.matchProperties)(O.props,E)?O.pos2+=w.segment.cachedLength:p.push((0,i.createAnnotateRangeOp)(w.position,w.position+w.segment.cachedLength,E));break}case i.MergeTreeDeltaType.INSERT:p.push((0,i.createInsertOp)(w.position,w.segment.clone().toJSONObject()));break;case i.MergeTreeDeltaType.REMOVE:{const O=p[p.length-1];O?.pos1===w.position?((0,a.assert)(O.pos2!==void 0,1023),O.pos2+=w.segment.cachedLength):p.push((0,i.createRemoveRangeOp)(w.position,w.position+w.segment.cachedLength));break}case i.MergeTreeDeltaType.OBLITERATE:{const O=p[p.length-1];O?.pos1===w.position?((0,a.assert)(O.pos2!==void 0,2164),O.pos2+=w.segment.cachedLength):p.push((0,i.createObliterateRangeOp)(w.position,w.position+w.segment.cachedLength));break}}return p}get currentRefSeq(){return this.ongoingResubmitRefSeq??this.deltaManager.lastSequenceNumber}constructor(S,p,w,O){super(p,S,w,"fluid_sequence_"),this.id=p,this.segmentFromSpec=O,this.inFlightRefSeqs=new u.default,this.messagesSinceMSNChange=[];const E=()=>this.inFlightRefSeqs.get(0);this.guardReentrancy=S.options.sharedStringPreventReentrancy??!0?g:C(R=>{v>0&&(v--,this.logger.sendTelemetryEvent({eventName:"LocalOpReentry",depth:R},new o.LoggingError(h)))});const F=(0,o.createConfigBasedOptionsProxy)((0,o.loggerToMonitoringContext)(this.logger).config,"Fluid.Sequence",{mergeTreeEnableObliterate:(R,M)=>R.getBoolean(M),mergeTreeEnableSidedObliterate:(R,M)=>R.getBoolean(M),intervalStickinessEnabled:(R,M)=>R.getBoolean(M),mergeTreeReferencesCanSlideToEndpoint:(R,M)=>R.getBoolean(M),mergeTreeEnableAnnotateAdjust:(R,M)=>R.getBoolean(M)},S.options);this.client=new i.Client(O,(0,o.createChildLogger)({logger:this.logger,namespace:"SharedSegmentSequence.MergeTreeClient"}),F,E),this.client.prependListener("delta",(R,M)=>{const j=new d.SequenceDeltaEventClass(R,M,this.client);j.isLocal&&j.opArgs.rollback!==!0&&this.submitSequenceMessage(R.op),M.deltaSegments.length>0&&this.emit("sequenceDelta",j,this)}),this.client.on("maintenance",(R,M)=>{this.emit("maintenance",new d.SequenceMaintenanceEventClass(M,R,this.client),this)}),this.intervalCollections=new c.IntervalCollectionMap(this.serializer,this.handle,(R,M)=>{this.isAttached()&&(this.inFlightRefSeqs.push(this.currentRefSeq),this.submitLocalMessage(R,M))},F)}removeRange(S,p){this.guardReentrancy(()=>this.client.removeRangeLocal(S,p))}obliterateRange(S,p){this.guardReentrancy(()=>this.client.obliterateRangeLocal(S,p))}groupOperation(S){this.guardReentrancy(()=>this.client.localTransaction(S))}getContainingSegment(S){return this.client.getContainingSegment(S)??{segment:void 0,offset:void 0}}getLength(){return this.client.getLength()}getPosition(S){return this.client.getPosition(S)}annotateRange(S,p,w){this.guardReentrancy(()=>this.client.annotateRangeLocal(S,p,w))}annotateAdjustRange(S,p,w){this.guardReentrancy(()=>this.client.annotateAdjustRangeLocal(S,p,w))}getPropertiesAtPosition(S){return this.client.getPropertiesAtPosition(S)}getRangeExtentsOfPosition(S){return this.client.getRangeExtentsOfPosition(S)}createLocalReferencePosition(S,p,w,O,E,F){return this.client.createLocalReferencePosition(S,p,w,O,E,F)}localReferencePositionToPosition(S){return this.client.localReferencePositionToPosition(S)}removeLocalReferencePosition(S){return this.client.removeLocalReferencePosition(S)}resolveRemoteClientPosition(S,p,w){return this.client.resolveRemoteClientPosition(S,p,w)}submitSequenceMessage(S){if(!this.isAttached())return;this.inFlightRefSeqs.push(this.currentRefSeq);const p=this.client.peekPendingSegmentGroups(S.type===i.MergeTreeDeltaType.GROUP?S.ops.length:1);this.submitLocalMessage(S,p)}posFromRelativePos(S){return this.client.posFromRelativePos(S)}walkSegments(S,p,w,O,E=!1){this.client.walkSegments(S,p,w,O,E)}getCurrentSeq(){return this.client.getCurrentSeq()}insertAtReferencePosition(S,p){this.guardReentrancy(()=>this.client.insertAtReferencePositionLocal(S,p))}insertFromSpec(S,p){const w=this.segmentFromSpec(p);this.guardReentrancy(()=>this.client.insertSegmentLocal(S,w))}getIntervalCollection(S){return this.intervalCollections.get(S)}getIntervalCollectionLabels(){return this.intervalCollections.keys()}summarizeCore(S,p){const w=new r.SummaryTreeBuilder;return this.intervalCollections.size>0&&w.addBlob(l,this.intervalCollections.serialize(S)),w.addWithStats(f,this.summarizeMergeTree(S)),w.getSummaryTree()}processGCDataCore(S){this.intervalCollections.size>0&&this.intervalCollections.serialize(S),this.client.serializeGCData(this.handle,S)}replaceRange(S,p,w){const O=Math.max(S,p);this.guardReentrancy(()=>this.client.insertSegmentLocal(O,w))&&S<p&&this.removeRange(S,p)}onConnect(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}onDisconnect(){}reSubmitCore(S,p,w=!1){const O=this.inFlightRefSeqs.shift();(0,a.assert)(O!==void 0,2235),this.useResubmitRefSeq(O,()=>{this.intervalCollections.tryResubmitMessage(S,p,w)||this.submitSequenceMessage(this.client.regeneratePendingOp(S,p,w))})}reSubmitSquashed(S,p){this.reSubmitCore(S,p,!0)}rollback(S,p){const w=this.inFlightRefSeqs.pop();(0,a.assert)(w!==void 0,2943),this.intervalCollections.tryRollback(S,p)||this.client.rollback(S,p)}async loadCore(S){if(await S.contains(l)){const p=await S.readBlob(l),w=(0,n.bufferToString)(p,"utf8");this.intervalCollections.populate(w)}try{const{catchupOpsP:p}=await this.client.load(this.runtime,new r.ObjectStoragePartition(S,f),this.serializer);(await p).forEach(w=>{const O=this.client.getCollabWindow();if(w.minimumSequenceNumber<O.minSeq||w.referenceSequenceNumber<O.minSeq||w.sequenceNumber<=O.minSeq||w.sequenceNumber<O.currentSeq)throw new Error(`Invalid catchup operations in snapshot: ${JSON.stringify({op:{seq:w.sequenceNumber,minSeq:w.minimumSequenceNumber,refSeq:w.referenceSequenceNumber},collabWindow:{seq:O.currentSeq,minSeq:O.minSeq}})}`);this.processMergeTreeMsg(w)}),this.initializeIntervalCollections()}catch(p){throw this.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},p),p}}processCore(S,p,w){if(p){const E=this.inFlightRefSeqs.shift();(0,a.assert)(E!==void 0,2236)}(0,a.assert)(S.type===t.MessageType.Operation,115),this.intervalCollections.tryProcessMessage(S.contents,p,S,w)||this.processMergeTreeMsg(S,p)}didAttach(){this.isAttached()&&this.client.startOrUpdateCollaboration(this.runtime.clientId??"attached")}initializeLocalCore(){super.initializeLocalCore(),this.initializeIntervalCollections()}applyStashedOp(S){this.intervalCollections.tryApplyStashedOp(S)||this.client.applyStashedOp(S)}summarizeMergeTree(S){const p=this.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(p),this.messagesSinceMSNChange.forEach(w=>{w.minimumSequenceNumber=p}),this.client.summarize(this.runtime,this.handle,S,this.messagesSinceMSNChange)}processMergeTreeMsg(S,p){const w=[];function O(R){w.push(...b.createOpsFromDelta(R))}const E=S.referenceSequenceNumber!==S.sequenceNumber-1;let F=S;this.runtime.options.newMergeTreeSnapshotFormat!==!0&&E&&this.on("sequenceDelta",O),this.client.applyMsg(S,p),this.runtime.options.newMergeTreeSnapshotFormat!==!0&&(E&&(this.removeListener("sequenceDelta",O),F={...S,referenceSequenceNumber:F.sequenceNumber-1,contents:w.length!==1?(0,i.createGroupOp)(...w):w[0]}),this.messagesSinceMSNChange.push(F),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<S.minimumSequenceNumber&&this.processMinSequenceNumberChanged(S.minimumSequenceNumber))}processMinSequenceNumberChanged(S){let p=0;for(;p<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[p].sequenceNumber>S);p++);p!==0&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(p))}initializeIntervalCollections(){this.intervalCollections.events.on("createIntervalCollection",(S,p)=>{const w=this.intervalCollections.get(S);w.attached||w.attachGraph(this.client,S),this.emit("createIntervalCollection",S,p,this)});for(const S of this.intervalCollections.keys())this.intervalCollections.get(S).attachGraph(this.client,S)}useResubmitRefSeq(S,p){const w=this.ongoingResubmitRefSeq;this.ongoingResubmitRefSeq=S;try{p()}finally{this.ongoingResubmitRefSeq=w}}}ed.SharedSegmentSequence=b;function C(_){let S=0;function p(w){S>0&&_(S),S++;try{return w()}finally{S--}}return p}let v=3;function m(){v=3}ed.resetReentrancyLogCounter=m;const h="Reentrancy detected in sequence local ops",g=C(()=>{throw new o.LoggingError(h)});return ed}var Wp={},Jp={},gee;function Ewe(){if(gee)return Jp;gee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */return Object.defineProperty(Jp,"__esModule",{value:!0}),Jp.pkgVersion=Jp.pkgName=void 0,Jp.pkgName="@fluidframework/sequence",Jp.pkgVersion="2.60.0",Jp}var Qp={},yee;function bce(){if(yee)return Qp;yee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Qp,"__esModule",{value:!0}),Qp.getTextAndMarkers=Qp.SharedStringClass=void 0;const e=Ls(),n=sL(),a=vce();class t extends n.SharedSegmentSequence{get ISharedString(){return this}constructor(o,u,c){super(o,u,c,a.SharedStringFactory.segmentFromSpec),this.id=u,this.mergeTreeTextHelper=this.client.createTextHelper()}insertMarkerRelative(o,u,c){const d=this.posFromRelativePos(o);this.guardReentrancy(()=>this.client.insertSegmentLocal(d,e.Marker.make(u,c)))}insertMarker(o,u,c){this.guardReentrancy(()=>this.client.insertSegmentLocal(o,e.Marker.make(u,c)))}insertTextRelative(o,u,c){const d=this.posFromRelativePos(o);this.guardReentrancy(()=>this.client.insertSegmentLocal(d,e.TextSegment.make(u,c)))}insertText(o,u,c){this.guardReentrancy(()=>this.client.insertSegmentLocal(o,e.TextSegment.make(u,c)))}replaceText(o,u,c,d){this.replaceRange(o,u,e.TextSegment.make(c,d))}removeText(o,u){this.removeRange(o,u)}annotateMarker(o,u){this.guardReentrancy(()=>this.client.annotateMarker(o,u))}searchForMarker(o,u,c=!0){return this.client.searchForMarker(o,u,c)}getText(o,u){const c=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(c.localPerspective,"",o,u)}getTextWithPlaceholders(o,u){const c=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(c.localPerspective," ",o,u)}getTextRangeWithMarkers(o,u){const c=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(c.localPerspective,"*",o,u)}getMarkerFromId(o){return this.client.getMarkerFromId(o)}}Qp.SharedStringClass=t;function i(s,o,u,c){const d={parallelMarkerLabel:o,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new e.TextSegment("")};return s.walkSegments(r,u,c,d),{parallelText:d.parallelText,parallelMarkers:d.parallelMarkers}}Qp.getTextAndMarkers=i;const r=(s,o,u,c,d,l,f)=>{const{placeholder:b,tagsInProgress:C,textSegment:v}=f;if(e.TextSegment.is(s)){let m="",h="";const g=[],_=[];s.properties?.["font-weight"]&&g.push("b"),s.properties?.["text-decoration"]&&g.push("u");const S=[];if(g.length>0){for(const p of g)C.includes(p)||(m+=`<${p}>`,_.push(p));for(const p of C)g.includes(p)||(h+=`</${p}>`,S.push(p));for(const p of _.reverse())C.push(p)}else for(const p of C)h+=`</${p}>`,S.push(p);for(const p of S){const w=C.indexOf(p);w>=0&&C.splice(w,1)}if(v.text+=h,v.text+=m,d<=0&&l>=s.text.length)v.text+=s.text;else{const p=s.text.length,w=d<0?0:d,O=l>=p?void 0:l;v.text+=s.text.substring(w,O)}}else if(b&&b.length>0){const m=b==="*"?`
${s}`:b.repeat(s.cachedLength);v.text+=m}else{const m=s;(0,e.refHasTileLabel)(m,f.parallelMarkerLabel)&&(f.parallelMarkers.push(m),f.parallelText.push(v.text),v.text="")}return!0};return Qp}var bee;function vce(){if(bee)return Wp;bee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Wp,"__esModule",{value:!0}),Wp.SharedString=Wp.SharedStringFactory=void 0;const e=Ls(),n=Ma(),a=Ewe(),t=bce();class i{static segmentFromSpec(s){const o=e.TextSegment.fromJSONObject(s);if(o)return o;const u=e.Marker.fromJSONObject(s);if(u)return u;throw new Error("Unrecognized IJSONObject")}get type(){return i.Type}get attributes(){return i.Attributes}async load(s,o,u,c){const d=new t.SharedStringClass(s,o,c);return await d.load(u),d}create(s,o){const u=new t.SharedStringClass(s,o,this.attributes);return u.initializeLocal(),u}}return Wp.SharedStringFactory=i,i.Type="https://graph.microsoft.com/types/mergeTree",i.Attributes={type:i.Type,snapshotFormatVersion:"0.1",packageVersion:a.pkgVersion},Wp.SharedString=(0,n.createSharedObjectKind)(i),Wp}var Yp={},vee;function Iwe(){if(vee)return Yp;vee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(Yp,"__esModule",{value:!0}),Yp.SharedSequence=Yp.SubSequence=void 0;const e=Je(),n=Ls(),a=sL(),t=128;class i extends n.BaseSegment{static is(o){return o.type===i.typeString}static fromJSONObject(o){if(o&&typeof o=="object"&&"items"in o)return new i(o.items,o.props)}constructor(o,u){super(u),this.items=o,this.type=i.typeString,this.cachedLength=o.length}toJSONObject(){const o={items:this.items};return super.addSerializedProps(o),o}clone(o=0,u){const c=this.items.slice(o,u),d=new i(c);return this.cloneInto(d),d}canAppend(o){return i.is(o)&&(this.cachedLength<=t||o.cachedLength<=t)}toString(){return this.items.toString()}append(o){(0,e.assert)(i.is(o),1096),super.append(o),this.items=this.items.concat(o.items)}removeRange(o,u){let c=[];const d=this.items.length;return o>0&&(c=c.concat(this.items.slice(0,o))),u<d&&(c=c.concat(this.items.slice(u))),this.items=c,this.cachedLength=this.items.length,this.items.length===0}createSplitSegmentAt(o){if(o>0){const u=this.items.slice(o);return this.items=this.items.slice(0,o),this.cachedLength=this.items.length,new i(u)}}}Yp.SubSequence=i,i.typeString="SubSequence";class r extends a.SharedSegmentSequence{constructor(o,u,c,d){super(o,u,c,d),this.id=u}insert(o,u,c){const d=new i(u,c);this.client.insertSegmentLocal(o,d)}remove(o,u){this.removeRange(o,u)}getItemCount(){return this.getLength()}getItems(o,u){const c=[];let d;return u!==void 0&&u<=o||(this.walkSegments(l=>(i.is(l)&&(d===void 0&&(d=l),c.push(...l.items)),!0),o,u),d!==void 0&&c.splice(0,o-this.getPosition(d)),u!==void 0&&c.splice(u-o)),c}}return Yp.SharedSequence=r,Yp}var See;function Rwe(){return See||(See=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.Side=e.TrackingGroup=e.reservedRangeLabelsKey=e.reservedTileLabelsKey=e.reservedMarkerIdKey=e.MergeTreeDeltaType=e.TextSegment=e.ReferenceType=e.BaseSegment=e.Marker=e.SubSequence=e.SharedSequence=e.SharedStringClass=e.getTextAndMarkers=e.SharedString=e.SharedSegmentSequence=e.revertSharedStringRevertibles=e.discardSharedStringRevertibles=e.appendSharedStringDeltaToRevertibles=e.appendIntervalPropertyChangedToRevertibles=e.appendDeleteIntervalToRevertibles=e.appendChangeIntervalToRevertibles=e.appendAddIntervalToRevertibles=e.createEndpointIndex=e.createOverlappingIntervalsIndex=e.IntervalStickiness=e.IntervalType=e.IntervalOpType=void 0;var n=ny();Object.defineProperty(e,"IntervalOpType",{enumerable:!0,get:function(){return n.IntervalOpType}}),Object.defineProperty(e,"IntervalType",{enumerable:!0,get:function(){return n.IntervalType}}),Object.defineProperty(e,"IntervalStickiness",{enumerable:!0,get:function(){return n.IntervalStickiness}});var a=yce();Object.defineProperty(e,"createOverlappingIntervalsIndex",{enumerable:!0,get:function(){return a.createOverlappingIntervalsIndex}}),Object.defineProperty(e,"createEndpointIndex",{enumerable:!0,get:function(){return a.createEndpointIndex}});var t=_we();Object.defineProperty(e,"appendAddIntervalToRevertibles",{enumerable:!0,get:function(){return t.appendAddIntervalToRevertibles}}),Object.defineProperty(e,"appendChangeIntervalToRevertibles",{enumerable:!0,get:function(){return t.appendChangeIntervalToRevertibles}}),Object.defineProperty(e,"appendDeleteIntervalToRevertibles",{enumerable:!0,get:function(){return t.appendDeleteIntervalToRevertibles}}),Object.defineProperty(e,"appendIntervalPropertyChangedToRevertibles",{enumerable:!0,get:function(){return t.appendIntervalPropertyChangedToRevertibles}}),Object.defineProperty(e,"appendSharedStringDeltaToRevertibles",{enumerable:!0,get:function(){return t.appendSharedStringDeltaToRevertibles}}),Object.defineProperty(e,"discardSharedStringRevertibles",{enumerable:!0,get:function(){return t.discardSharedStringRevertibles}}),Object.defineProperty(e,"revertSharedStringRevertibles",{enumerable:!0,get:function(){return t.revertSharedStringRevertibles}});var i=sL();Object.defineProperty(e,"SharedSegmentSequence",{enumerable:!0,get:function(){return i.SharedSegmentSequence}});var r=vce();Object.defineProperty(e,"SharedString",{enumerable:!0,get:function(){return r.SharedString}});var s=bce();Object.defineProperty(e,"getTextAndMarkers",{enumerable:!0,get:function(){return s.getTextAndMarkers}}),Object.defineProperty(e,"SharedStringClass",{enumerable:!0,get:function(){return s.SharedStringClass}});var o=Iwe();Object.defineProperty(e,"SharedSequence",{enumerable:!0,get:function(){return o.SharedSequence}}),Object.defineProperty(e,"SubSequence",{enumerable:!0,get:function(){return o.SubSequence}});var u=Ls();Object.defineProperty(e,"Marker",{enumerable:!0,get:function(){return u.Marker}}),Object.defineProperty(e,"BaseSegment",{enumerable:!0,get:function(){return u.BaseSegment}}),Object.defineProperty(e,"ReferenceType",{enumerable:!0,get:function(){return u.ReferenceType}}),Object.defineProperty(e,"TextSegment",{enumerable:!0,get:function(){return u.TextSegment}}),Object.defineProperty(e,"MergeTreeDeltaType",{enumerable:!0,get:function(){return u.MergeTreeDeltaType}}),Object.defineProperty(e,"reservedMarkerIdKey",{enumerable:!0,get:function(){return u.reservedMarkerIdKey}}),Object.defineProperty(e,"reservedTileLabelsKey",{enumerable:!0,get:function(){return u.reservedTileLabelsKey}}),Object.defineProperty(e,"reservedRangeLabelsKey",{enumerable:!0,get:function(){return u.reservedRangeLabelsKey}}),Object.defineProperty(e,"TrackingGroup",{enumerable:!0,get:function(){return u.TrackingGroup}}),Object.defineProperty(e,"Side",{enumerable:!0,get:function(){return u.Side}})})(jD)),jD}var Cee;function Sce(){return Cee||(Cee=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=Lp&&Lp.__createBinding||(Object.create?(function(d,l,f,b){b===void 0&&(b=f);var C=Object.getOwnPropertyDescriptor(l,f);(!C||("get"in C?!l.__esModule:C.writable||C.configurable))&&(C={enumerable:!0,get:function(){return l[f]}}),Object.defineProperty(d,b,C)}):(function(d,l,f,b){b===void 0&&(b=f),d[b]=l[f]})),a=Lp&&Lp.__exportStar||function(d,l){for(var f in d)f!=="default"&&!Object.prototype.hasOwnProperty.call(l,f)&&n(l,d,f)};Object.defineProperty(e,"__esModule",{value:!0}),e.SharedString=e.SharedMap=e.SharedDirectory=e.configuredSharedTree=e.SharedTree=e.onAssertionFailure=e.ConnectionState=e.AttachState=void 0;var t=Mr();Object.defineProperty(e,"AttachState",{enumerable:!0,get:function(){return t.AttachState}});var i=Lie();Object.defineProperty(e,"ConnectionState",{enumerable:!0,get:function(){return i.ConnectionState}});var r=Je();Object.defineProperty(e,"onAssertionFailure",{enumerable:!0,get:function(){return r.onAssertionFailure}}),a(Y1(),e);const s=Y1();e.SharedTree=s.SharedTree;function o(d){return(0,s.configuredSharedTree)(d)}e.configuredSharedTree=o;var u=yE();Object.defineProperty(e,"SharedDirectory",{enumerable:!0,get:function(){return u.SharedDirectory}}),Object.defineProperty(e,"SharedMap",{enumerable:!0,get:function(){return u.SharedMap}});var c=Rwe();Object.defineProperty(e,"SharedString",{enumerable:!0,get:function(){return c.SharedString}})})(Lp)),Lp}var _ee;function bb(){if(_ee)return A_;_ee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(A_,"__esModule",{value:!0}),A_.DynamicObjectRegistry=void 0;const e=Sce(),n="@microsoft/live-share:DYNAMIC-LOADABLE-OBJECTS";let a=class{static get dynamicLoadableObjects(){return typeof window>"u"?this._dynamicLoadableObjects:window[n]||this._dynamicLoadableObjects}static registerObjectClass(i,r){const s=this.dynamicLoadableObjects;s.has(r)||(s.set(r,i),typeof window<"u"&&(window[n]=s))}};return a._dynamicLoadableObjects=new Map,A_.DynamicObjectRegistry=a,a.registerObjectClass(e.SharedMap,e.SharedMap.getFactory().type),a.registerObjectClass(e.SharedString,e.SharedString.getFactory().type),a.registerObjectClass(e.SharedDirectory,e.SharedDirectory.getFactory().type),A_}var $_={},Xp={},Tee;function Cce(){if(Tee)return Xp;Tee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Xp&&Xp.__awaiter||function(i,r,s,o){function u(c){return c instanceof s?c:new s(function(d){d(c)})}return new(s||(s=Promise))(function(c,d){function l(C){try{b(o.next(C))}catch(v){d(v)}}function f(C){try{b(o.throw(C))}catch(v){d(v)}}function b(C){C.done?c(C.value):u(C.value).then(l,f)}b((o=o.apply(i,r||[])).next())})};Object.defineProperty(Xp,"__esModule",{value:!0}),Xp.TimestampProvider=void 0;const n=5*1e3,a=5;let t=class{constructor(){this._retries=0,this._lastTimeSent=0}get isRunning(){return!!this._serverTime}getTimestamp(){if(!this._serverTime)throw new Error("TimestampProvider: can't call getTimestamp() before calling start().");return this._lastTimeSent=Math.max(new Date().getTime()+this._serverTime.offset,this._lastTimeSent+1)}getMaxTimestampError(){if(!this._serverTime)throw new Error("DefaultTimestampProvider: can't call getMaxTimestampError() before calling initialize().");return Math.floor(this._serverTime.requestLatency/2)}start(){return e(this,void 0,void 0,function*(){this.stop(),performance.mark("TeamsSync: starting clock");try{yield this.improveAccuracy()}finally{performance.measure("TeamsSync: clock startup","TeamsSync: starting clock")}})}stop(){this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._serverTime=void 0,this._retries=0}improveAccuracy(){return e(this,void 0,void 0,function*(){const r=yield this.getSessionTimeOffset();!this._serverTime||r.requestLatency<this._serverTime.requestLatency?(this._serverTime=r,this._retries=0):this._retries++,this._retries<=a?this._syncTimer=setTimeout(this.improveAccuracy.bind(this),n):this._syncTimer=void 0})}getSessionTimeOffset(){return e(this,void 0,void 0,function*(){const r=performance.now(),s=yield this.getNtpTime(),o=performance.now(),u=new Date().getTime(),c=o-r,d=s.ntpTimeInUTC+Math.floor(c/2);return{serverTimeInUtc:d,localTimeInUtc:u,requestLatency:c,offset:d-u}})}};return Xp.TimestampProvider=t,Xp}var wee;function _ce(){if(wee)return $_;wee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty($_,"__esModule",{value:!0}),$_.HostTimestampProvider=void 0;const e=Cce();let n=class extends e.TimestampProvider{constructor(t){super(),this._host=t}getNtpTime(){return this._host.getNtpTime()}};return $_.HostTimestampProvider=n,$_}var KD={},Oee;function Go(){return Oee||(Oee=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.LiveDataObjectInitializeState=e.ContainerState=e.UserMeetingRole=void 0,(function(n){n.guest="Guest",n.attendee="Attendee",n.presenter="Presenter",n.organizer="Organizer"})(e.UserMeetingRole||(e.UserMeetingRole={})),(function(n){n.added="Added",n.alreadyExists="AlreadyExists",n.conflict="Conflict",n.notFound="NotFound"})(e.ContainerState||(e.ContainerState={})),(function(n){n.needed="needed",n.pending="pending",n.succeeded="succeeded",n.fatalError="fatalError"})(e.LiveDataObjectInitializeState||(e.LiveDataObjectInitializeState={}))})(KD)),KD}var G_={},nd={};const ry=sE(d1e);var Zp={},rd={},Pee;function aL(){if(Pee)return rd;Pee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */return Object.defineProperty(rd,"__esModule",{value:!0}),rd.LiveShareReportIssueLink=rd.ObjectSynchronizerEvents=rd.TelemetryEvents=void 0,rd.TelemetryEvents={LivePresence:{LocalPresenceChanged:"LivePresence:LocalPresenceChange",RemotePresenceChanged:"LivePresence:RemotePresenceChange",GetClientInfoError:"LivePresence:GetClientInfoError",RoleVerificationError:"LivePresence:RoleVerificationError"},LiveState:{StateChanged:"LiveState:StateChanged",RoleVerificationError:"LiveState:RoleVerificationError"}},rd.ObjectSynchronizerEvents={update:"update",connect:"connect"},rd.LiveShareReportIssueLink="https://aka.ms/teamsliveshare/issue",rd}var eg={},Eee;function Fwe(){if(Eee)return eg;Eee=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=eg&&eg.__awaiter||function(a,t,i,r){function s(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function c(f){try{l(r.next(f))}catch(b){u(b)}}function d(f){try{l(r.throw(f))}catch(b){u(b)}}function l(f){f.done?o(f.value):s(f.value).then(c,d)}l((r=r.apply(a,t||[])).next())})};Object.defineProperty(eg,"__esModule",{value:!0}),eg.LiveShareTokenProvider=void 0;let n=class{constructor(t){this._host=t}fetchOrdererToken(t,i,r){return e(this,void 0,void 0,function*(){return yield this.fetchFluidToken(t,i,r)})}fetchStorageToken(t,i,r){return e(this,void 0,void 0,function*(){return yield this.fetchFluidToken(t,i,r)})}fetchFluidToken(t,i,r){return e(this,void 0,void 0,function*(){let s;return!this._frsToken||r||this._tenantId!==t||this._documentId!==i?(this._frsToken=yield this._host.getFluidToken(i),s=!1):s=!0,this._tenantId=t,i&&(this._documentId=i),{jwt:this._frsToken,fromCache:s}})}};return eg.LiveShareTokenProvider=n,eg}var W_={},Iee;function oL(){if(Iee)return W_;Iee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(W_,"__esModule",{value:!0}),W_.RequestCache=void 0;let e=class{constructor(a){this._cache=new Map,this._cacheLifetime=a}cacheRequest(a,t){const i=new Date().getTime();let r;if(this._cache.has(a)){r=this._cache.get(a);const o=r.startTime+this._cacheLifetime;if(i<o)return r.promise}const s=t();return this._cache.set(a,{startTime:i,promise:s}),s}has(a){return this._cache.has(a)}};return W_.RequestCache=e,W_}var tg={},Ree;function jwe(){if(Ree)return tg;Ree=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=tg&&tg.__awaiter||function(a,t,i,r){function s(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function c(f){try{l(r.next(f))}catch(b){u(b)}}function d(f){try{l(r.throw(f))}catch(b){u(b)}}function l(f){f.done?o(f.value):s(f.value).then(c,d)}l((r=r.apply(a,t||[])).next())})};Object.defineProperty(tg,"__esModule",{value:!0}),tg.RoleVerifier=void 0;let n=class{constructor(t){this._host=t}verifyRolesAllowed(t,i){var r;return e(this,void 0,void 0,function*(){if(!t)throw new Error("RoleVerifier: called verifyRolesAllowed() without a clientId");if(Array.isArray(i)&&i.length>0){const s=yield this._host.getClientInfo(t),o=(r=s?.roles)!==null&&r!==void 0?r:[];for(let u=0;u<i.length;u++){const c=i[u];if(o.indexOf(c)>=0)return!0}return!1}return!0})}};return tg.RoleVerifier=n,tg}var Gr={},$D={},J_={},DP={},Fee;function Tce(){if(Fee)return DP;Fee=1,Object.defineProperty(DP,"__esModule",{value:!0}),DP.default=a;let e;const n=new Uint8Array(16);function a(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(n)}return DP}var Qy={},Q_={},Y_={},jee;function Mwe(){if(jee)return Y_;jee=1,Object.defineProperty(Y_,"__esModule",{value:!0}),Y_.default=void 0;var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;return Y_.default=e,Y_}var Mee;function yI(){if(Mee)return Q_;Mee=1,Object.defineProperty(Q_,"__esModule",{value:!0}),Q_.default=void 0;var e=n(Mwe());function n(i){return i&&i.__esModule?i:{default:i}}function a(i){return typeof i=="string"&&e.default.test(i)}var t=a;return Q_.default=t,Q_}var Nee;function bI(){if(Nee)return Qy;Nee=1,Object.defineProperty(Qy,"__esModule",{value:!0}),Qy.default=void 0,Qy.unsafeStringify=t;var e=n(yI());function n(s){return s&&s.__esModule?s:{default:s}}const a=[];for(let s=0;s<256;++s)a.push((s+256).toString(16).slice(1));function t(s,o=0){return a[s[o+0]]+a[s[o+1]]+a[s[o+2]]+a[s[o+3]]+"-"+a[s[o+4]]+a[s[o+5]]+"-"+a[s[o+6]]+a[s[o+7]]+"-"+a[s[o+8]]+a[s[o+9]]+"-"+a[s[o+10]]+a[s[o+11]]+a[s[o+12]]+a[s[o+13]]+a[s[o+14]]+a[s[o+15]]}function i(s,o=0){const u=t(s,o);if(!(0,e.default)(u))throw TypeError("Stringified UUID is invalid");return u}var r=i;return Qy.default=r,Qy}var Aee;function Nwe(){if(Aee)return J_;Aee=1,Object.defineProperty(J_,"__esModule",{value:!0}),J_.default=void 0;var e=a(Tce()),n=bI();function a(c){return c&&c.__esModule?c:{default:c}}let t,i,r=0,s=0;function o(c,d,l){let f=d&&l||0;const b=d||new Array(16);c=c||{};let C=c.node||t,v=c.clockseq!==void 0?c.clockseq:i;if(C==null||v==null){const p=c.random||(c.rng||e.default)();C==null&&(C=t=[p[0]|1,p[1],p[2],p[3],p[4],p[5]]),v==null&&(v=i=(p[6]<<8|p[7])&16383)}let m=c.msecs!==void 0?c.msecs:Date.now(),h=c.nsecs!==void 0?c.nsecs:s+1;const g=m-r+(h-s)/1e4;if(g<0&&c.clockseq===void 0&&(v=v+1&16383),(g<0||m>r)&&c.nsecs===void 0&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");r=m,s=h,i=v,m+=122192928e5;const _=((m&268435455)*1e4+h)%4294967296;b[f++]=_>>>24&255,b[f++]=_>>>16&255,b[f++]=_>>>8&255,b[f++]=_&255;const S=m/4294967296*1e4&268435455;b[f++]=S>>>8&255,b[f++]=S&255,b[f++]=S>>>24&15|16,b[f++]=S>>>16&255,b[f++]=v>>>8|128,b[f++]=v&255;for(let p=0;p<6;++p)b[f+p]=C[p];return d||(0,n.unsafeStringify)(b)}var u=o;return J_.default=u,J_}var X_={},nl={},Z_={},Dee;function wce(){if(Dee)return Z_;Dee=1,Object.defineProperty(Z_,"__esModule",{value:!0}),Z_.default=void 0;var e=n(yI());function n(i){return i&&i.__esModule?i:{default:i}}function a(i){if(!(0,e.default)(i))throw TypeError("Invalid UUID");let r;const s=new Uint8Array(16);return s[0]=(r=parseInt(i.slice(0,8),16))>>>24,s[1]=r>>>16&255,s[2]=r>>>8&255,s[3]=r&255,s[4]=(r=parseInt(i.slice(9,13),16))>>>8,s[5]=r&255,s[6]=(r=parseInt(i.slice(14,18),16))>>>8,s[7]=r&255,s[8]=(r=parseInt(i.slice(19,23),16))>>>8,s[9]=r&255,s[10]=(r=parseInt(i.slice(24,36),16))/1099511627776&255,s[11]=r/4294967296&255,s[12]=r>>>24&255,s[13]=r>>>16&255,s[14]=r>>>8&255,s[15]=r&255,s}var t=a;return Z_.default=t,Z_}var kee;function Oce(){if(kee)return nl;kee=1,Object.defineProperty(nl,"__esModule",{value:!0}),nl.URL=nl.DNS=void 0,nl.default=s;var e=bI(),n=a(wce());function a(o){return o&&o.__esModule?o:{default:o}}function t(o){o=unescape(encodeURIComponent(o));const u=[];for(let c=0;c<o.length;++c)u.push(o.charCodeAt(c));return u}const i="6ba7b810-9dad-11d1-80b4-00c04fd430c8";nl.DNS=i;const r="6ba7b811-9dad-11d1-80b4-00c04fd430c8";nl.URL=r;function s(o,u,c){function d(l,f,b,C){var v;if(typeof l=="string"&&(l=t(l)),typeof f=="string"&&(f=(0,n.default)(f)),((v=f)===null||v===void 0?void 0:v.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let m=new Uint8Array(16+l.length);if(m.set(f),m.set(l,f.length),m=c(m),m[6]=m[6]&15|u,m[8]=m[8]&63|128,b){C=C||0;for(let h=0;h<16;++h)b[C+h]=m[h];return b}return(0,e.unsafeStringify)(m)}try{d.name=o}catch{}return d.DNS=i,d.URL=r,d}return nl}var e1={},xee;function Awe(){if(xee)return e1;xee=1,Object.defineProperty(e1,"__esModule",{value:!0}),e1.default=void 0;function e(b){if(typeof b=="string"){const C=unescape(encodeURIComponent(b));b=new Uint8Array(C.length);for(let v=0;v<C.length;++v)b[v]=C.charCodeAt(v)}return n(t(i(b),b.length*8))}function n(b){const C=[],v=b.length*32,m="0123456789abcdef";for(let h=0;h<v;h+=8){const g=b[h>>5]>>>h%32&255,_=parseInt(m.charAt(g>>>4&15)+m.charAt(g&15),16);C.push(_)}return C}function a(b){return(b+64>>>9<<4)+14+1}function t(b,C){b[C>>5]|=128<<C%32,b[a(C)-1]=C;let v=1732584193,m=-271733879,h=-1732584194,g=271733878;for(let _=0;_<b.length;_+=16){const S=v,p=m,w=h,O=g;v=u(v,m,h,g,b[_],7,-680876936),g=u(g,v,m,h,b[_+1],12,-389564586),h=u(h,g,v,m,b[_+2],17,606105819),m=u(m,h,g,v,b[_+3],22,-1044525330),v=u(v,m,h,g,b[_+4],7,-176418897),g=u(g,v,m,h,b[_+5],12,1200080426),h=u(h,g,v,m,b[_+6],17,-1473231341),m=u(m,h,g,v,b[_+7],22,-45705983),v=u(v,m,h,g,b[_+8],7,1770035416),g=u(g,v,m,h,b[_+9],12,-1958414417),h=u(h,g,v,m,b[_+10],17,-42063),m=u(m,h,g,v,b[_+11],22,-1990404162),v=u(v,m,h,g,b[_+12],7,1804603682),g=u(g,v,m,h,b[_+13],12,-40341101),h=u(h,g,v,m,b[_+14],17,-1502002290),m=u(m,h,g,v,b[_+15],22,1236535329),v=c(v,m,h,g,b[_+1],5,-165796510),g=c(g,v,m,h,b[_+6],9,-1069501632),h=c(h,g,v,m,b[_+11],14,643717713),m=c(m,h,g,v,b[_],20,-373897302),v=c(v,m,h,g,b[_+5],5,-701558691),g=c(g,v,m,h,b[_+10],9,38016083),h=c(h,g,v,m,b[_+15],14,-660478335),m=c(m,h,g,v,b[_+4],20,-405537848),v=c(v,m,h,g,b[_+9],5,568446438),g=c(g,v,m,h,b[_+14],9,-1019803690),h=c(h,g,v,m,b[_+3],14,-187363961),m=c(m,h,g,v,b[_+8],20,1163531501),v=c(v,m,h,g,b[_+13],5,-1444681467),g=c(g,v,m,h,b[_+2],9,-51403784),h=c(h,g,v,m,b[_+7],14,1735328473),m=c(m,h,g,v,b[_+12],20,-1926607734),v=d(v,m,h,g,b[_+5],4,-378558),g=d(g,v,m,h,b[_+8],11,-2022574463),h=d(h,g,v,m,b[_+11],16,1839030562),m=d(m,h,g,v,b[_+14],23,-35309556),v=d(v,m,h,g,b[_+1],4,-1530992060),g=d(g,v,m,h,b[_+4],11,1272893353),h=d(h,g,v,m,b[_+7],16,-155497632),m=d(m,h,g,v,b[_+10],23,-1094730640),v=d(v,m,h,g,b[_+13],4,681279174),g=d(g,v,m,h,b[_],11,-358537222),h=d(h,g,v,m,b[_+3],16,-722521979),m=d(m,h,g,v,b[_+6],23,76029189),v=d(v,m,h,g,b[_+9],4,-640364487),g=d(g,v,m,h,b[_+12],11,-421815835),h=d(h,g,v,m,b[_+15],16,530742520),m=d(m,h,g,v,b[_+2],23,-995338651),v=l(v,m,h,g,b[_],6,-198630844),g=l(g,v,m,h,b[_+7],10,1126891415),h=l(h,g,v,m,b[_+14],15,-1416354905),m=l(m,h,g,v,b[_+5],21,-57434055),v=l(v,m,h,g,b[_+12],6,1700485571),g=l(g,v,m,h,b[_+3],10,-1894986606),h=l(h,g,v,m,b[_+10],15,-1051523),m=l(m,h,g,v,b[_+1],21,-2054922799),v=l(v,m,h,g,b[_+8],6,1873313359),g=l(g,v,m,h,b[_+15],10,-30611744),h=l(h,g,v,m,b[_+6],15,-1560198380),m=l(m,h,g,v,b[_+13],21,1309151649),v=l(v,m,h,g,b[_+4],6,-145523070),g=l(g,v,m,h,b[_+11],10,-1120210379),h=l(h,g,v,m,b[_+2],15,718787259),m=l(m,h,g,v,b[_+9],21,-343485551),v=r(v,S),m=r(m,p),h=r(h,w),g=r(g,O)}return[v,m,h,g]}function i(b){if(b.length===0)return[];const C=b.length*8,v=new Uint32Array(a(C));for(let m=0;m<C;m+=8)v[m>>5]|=(b[m/8]&255)<<m%32;return v}function r(b,C){const v=(b&65535)+(C&65535);return(b>>16)+(C>>16)+(v>>16)<<16|v&65535}function s(b,C){return b<<C|b>>>32-C}function o(b,C,v,m,h,g){return r(s(r(r(C,b),r(m,g)),h),v)}function u(b,C,v,m,h,g,_){return o(C&v|~C&m,b,C,h,g,_)}function c(b,C,v,m,h,g,_){return o(C&m|v&~m,b,C,h,g,_)}function d(b,C,v,m,h,g,_){return o(C^v^m,b,C,h,g,_)}function l(b,C,v,m,h,g,_){return o(v^(C|~m),b,C,h,g,_)}var f=e;return e1.default=f,e1}var qee;function Dwe(){if(qee)return X_;qee=1,Object.defineProperty(X_,"__esModule",{value:!0}),X_.default=void 0;var e=a(Oce()),n=a(Awe());function a(r){return r&&r.__esModule?r:{default:r}}var i=(0,e.default)("v3",48,n.default);return X_.default=i,X_}var t1={},n1={},Lee;function kwe(){if(Lee)return n1;Lee=1,Object.defineProperty(n1,"__esModule",{value:!0}),n1.default=void 0;var n={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};return n1.default=n,n1}var Bee;function xwe(){if(Bee)return t1;Bee=1,Object.defineProperty(t1,"__esModule",{value:!0}),t1.default=void 0;var e=t(kwe()),n=t(Tce()),a=bI();function t(s){return s&&s.__esModule?s:{default:s}}function i(s,o,u){if(e.default.randomUUID&&!o&&!s)return e.default.randomUUID();s=s||{};const c=s.random||(s.rng||n.default)();if(c[6]=c[6]&15|64,c[8]=c[8]&63|128,o){u=u||0;for(let d=0;d<16;++d)o[u+d]=c[d];return o}return(0,a.unsafeStringify)(c)}var r=i;return t1.default=r,t1}var r1={},i1={},Uee;function qwe(){if(Uee)return i1;Uee=1,Object.defineProperty(i1,"__esModule",{value:!0}),i1.default=void 0;function e(i,r,s,o){switch(i){case 0:return r&s^~r&o;case 1:return r^s^o;case 2:return r&s^r&o^s&o;case 3:return r^s^o}}function n(i,r){return i<<r|i>>>32-r}function a(i){const r=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof i=="string"){const d=unescape(encodeURIComponent(i));i=[];for(let l=0;l<d.length;++l)i.push(d.charCodeAt(l))}else Array.isArray(i)||(i=Array.prototype.slice.call(i));i.push(128);const o=i.length/4+2,u=Math.ceil(o/16),c=new Array(u);for(let d=0;d<u;++d){const l=new Uint32Array(16);for(let f=0;f<16;++f)l[f]=i[d*64+f*4]<<24|i[d*64+f*4+1]<<16|i[d*64+f*4+2]<<8|i[d*64+f*4+3];c[d]=l}c[u-1][14]=(i.length-1)*8/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=(i.length-1)*8&4294967295;for(let d=0;d<u;++d){const l=new Uint32Array(80);for(let h=0;h<16;++h)l[h]=c[d][h];for(let h=16;h<80;++h)l[h]=n(l[h-3]^l[h-8]^l[h-14]^l[h-16],1);let f=s[0],b=s[1],C=s[2],v=s[3],m=s[4];for(let h=0;h<80;++h){const g=Math.floor(h/20),_=n(f,5)+e(g,b,C,v)+m+r[g]+l[h]>>>0;m=v,v=C,C=n(b,30)>>>0,b=f,f=_}s[0]=s[0]+f>>>0,s[1]=s[1]+b>>>0,s[2]=s[2]+C>>>0,s[3]=s[3]+v>>>0,s[4]=s[4]+m>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,s[0]&255,s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,s[1]&255,s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,s[2]&255,s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,s[3]&255,s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,s[4]&255]}var t=a;return i1.default=t,i1}var zee;function Lwe(){if(zee)return r1;zee=1,Object.defineProperty(r1,"__esModule",{value:!0}),r1.default=void 0;var e=a(Oce()),n=a(qwe());function a(r){return r&&r.__esModule?r:{default:r}}var i=(0,e.default)("v5",80,n.default);return r1.default=i,r1}var s1={},Vee;function Bwe(){if(Vee)return s1;Vee=1,Object.defineProperty(s1,"__esModule",{value:!0}),s1.default=void 0;var e="00000000-0000-0000-0000-000000000000";return s1.default=e,s1}var a1={},Hee;function Uwe(){if(Hee)return a1;Hee=1,Object.defineProperty(a1,"__esModule",{value:!0}),a1.default=void 0;var e=n(yI());function n(i){return i&&i.__esModule?i:{default:i}}function a(i){if(!(0,e.default)(i))throw TypeError("Invalid UUID");return parseInt(i.slice(14,15),16)}var t=a;return a1.default=t,a1}var Kee;function zwe(){return Kee||(Kee=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return s.default}});var n=d(Nwe()),a=d(Dwe()),t=d(xwe()),i=d(Lwe()),r=d(Bwe()),s=d(Uwe()),o=d(yI()),u=d(bI()),c=d(wce());function d(l){return l&&l.__esModule?l:{default:l}}})($D)),$D}var $ee;function vI(){if($ee)return Gr;$ee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Gr&&Gr.__awaiter||function(l,f,b,C){function v(m){return m instanceof b?m:new b(function(h){h(m)})}return new(b||(b=Promise))(function(m,h){function g(p){try{S(C.next(p))}catch(w){h(w)}}function _(p){try{S(C.throw(p))}catch(w){h(w)}}function S(p){p.done?m(p.value):v(p.value).then(g,_)}S((C=C.apply(l,f||[])).next())})};Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.waitUntilConnected=Gr.getInsecureTokenProvider=Gr.timeoutRequest=Gr.waitForResult=Gr.TimeoutError=Gr.waitForDelay=Gr.parseJwt=Gr.decodeBase64=Gr.cloneValue=void 0;const n=zwe();function a(l){return typeof l=="object"?JSON.parse(JSON.stringify(l)):l}Gr.cloneValue=a;function t(l){return typeof atob=="function"?atob(l):Buffer.from(l,"base64").toString()}Gr.decodeBase64=t;const i=l=>{try{return JSON.parse(t(l.split(".")[1]))}catch{return null}};Gr.parseJwt=i;function r(l){return new Promise(f=>{setTimeout(()=>f(),l)})}Gr.waitForDelay=r;class s extends Error{constructor(){super("timed out")}}Gr.TimeoutError=s;function o(l,f,b,C,v,m,h=1e3){let g=0;return new Promise((_,S)=>e(this,void 0,void 0,function*(){for(;;){try{const p=yield u(l,Math.max(h*(g+1),h*3),m),w=f(p);if(w!==null){_(w.response);break}else if(g>=C.length){S(new Error("waitForResult: invalid response"));break}}catch(p){if(g>=C.length){S(b(p));break}if(v&&!(p instanceof s)){const w=v(p);if(w!==null){S(w);break}}}yield r(C[g++])}}))}Gr.waitForResult=o;function u(l,f,b){return new Promise((C,v)=>e(this,void 0,void 0,function*(){let m=setTimeout(()=>{v(new s),m=null},f);try{const h=yield l();C(h),m==null&&b?.()}catch(h){v(h),m==null&&b?.()}clearTimeout(m)}))}Gr.timeoutRequest=u;function c(){var l,f;return e(this,void 0,void 0,function*(){try{const{InsecureTokenProvider:b}=yield require("@fluidframework/test-client-utils"),C=(f=(l=new URL(window.location.href))===null||l===void 0?void 0:l.searchParams)===null||f===void 0?void 0:f.get("userId");return new b("",{id:C??(0,n.v4)(),name:"Test User"})}catch{throw new Error("@microsoft/live-share: when using 'local' connection type, you must have @fluidframework/test-client-utils installed")}})}Gr.getInsecureTokenProvider=c;function d(l){return new Promise(f=>{const b=C=>{l.off("connected",b),f(C)};l.clientId?f(l.clientId):l.on("connected",b)})}return Gr.waitUntilConnected=d,Gr}var ng={},rg={},Gee;function cL(){if(Gee)return rg;Gee=1;var e=rg&&rg.__awaiter||function(a,t,i,r){function s(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function c(f){try{l(r.next(f))}catch(b){u(b)}}function d(f){try{l(r.throw(f))}catch(b){u(b)}}function l(f){f.done?o(f.value):s(f.value).then(c,d)}l((r=r.apply(a,t||[])).next())})};Object.defineProperty(rg,"__esModule",{value:!0}),rg.BaseHostDecorator=void 0;let n=class{constructor(t){this._host=t}registerClientId(t){return e(this,void 0,void 0,function*(){return this._host.registerClientId(t)})}getClientRoles(t){return e(this,void 0,void 0,function*(){return this._host.getClientRoles(t)})}getClientInfo(t){return e(this,void 0,void 0,function*(){return this._host.getClientInfo(t)})}getFluidTenantInfo(){return this._host.getFluidTenantInfo()}getFluidToken(t){return this._host.getFluidToken(t)}getFluidContainerId(){return this._host.getFluidContainerId()}setFluidContainerId(t){return this._host.setFluidContainerId(t)}getNtpTime(){return this._host.getNtpTime()}};return rg.BaseHostDecorator=n,rg}var xs={},Wee;function SI(){if(Wee)return xs;Wee=1,Object.defineProperty(xs,"__esModule",{value:!0}),xs.isTimestampProvider=xs.isILiveEvent=xs.isErrorLike=xs.isIClientInfo=xs.isClientRolesResponse=xs.isMobileWorkaroundRolesResponse=void 0;function e(s){return n(s?.userRoles)}xs.isMobileWorkaroundRolesResponse=e;function n(s){return Array.isArray(s)&&s.every(o=>typeof o=="string")}xs.isClientRolesResponse=n;function a(s){return s===void 0||s?.userId!==void 0&&n(s?.roles)}xs.isIClientInfo=a;function t(s){return typeof s?.message=="string"}xs.isErrorLike=t;function i(s){return typeof s=="object"&&typeof s.clientId=="string"&&typeof s.timestamp=="number"&&typeof s.name=="string"}xs.isILiveEvent=i;function r(s){return typeof s?.start=="function"}return xs.isTimestampProvider=r,xs}var Jee;function Vwe(){if(Jee)return ng;Jee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=ng&&ng.__awaiter||function(u,c,d,l){function f(b){return b instanceof d?b:new d(function(C){C(b)})}return new(d||(d=Promise))(function(b,C){function v(g){try{h(l.next(g))}catch(_){C(_)}}function m(g){try{h(l.throw(g))}catch(_){C(_)}}function h(g){g.done?b(g.value):f(g.value).then(v,m)}h((l=l.apply(u,c||[])).next())})};Object.defineProperty(ng,"__esModule",{value:!0}),ng.LiveShareHostDecorator=void 0;const n=cL(),a=oL(),t=SI(),i=vI(),r=[100,200,200,400,600],s=4*1e3;let o=class extends n.BaseHostDecorator{constructor(){super(...arguments),this._registerRequestCache=new a.RequestCache(s),this._userInfoRequestCache=new a.RequestCache(s)}getClientInfo(c,d,l){return e(this,void 0,void 0,function*(){if(!c)throw new Error("LiveShareHostDecorator: called getClientInfo() without a clientId");const f=l?`${c}backwardsCompat`:c;return this._userInfoRequestCache.cacheRequest(f,()=>(0,i.waitForResult)(()=>e(this,void 0,void 0,function*(){return yield this._host.getClientInfo(c)}),b=>(0,t.isIClientInfo)(b)?{response:b}:null,b=>new Error(`LiveShareHostDecorator: getting client info for a remote client ID for reason: ${(0,t.isErrorLike)(b)?b.message:"unknown"}`),l??r,b=>c==="fakeId"?new Error((0,t.isErrorLike)(b)?b.message:"an unknown error occurred"):null,d))})}registerClientId(c){return e(this,void 0,void 0,function*(){return this._registerRequestCache.cacheRequest(c,()=>(0,i.waitForResult)(()=>e(this,void 0,void 0,function*(){return yield this._host.registerClientId(c)}),d=>(0,t.isClientRolesResponse)(d)?{response:d}:(0,t.isMobileWorkaroundRolesResponse)(d)?{response:d.userRoles}:null,d=>new Error(`LiveShareHostDecorator: registering local client ID for reason: ${(0,t.isErrorLike)(d)?d.message:"unknown"}`),r))})}};return ng.LiveShareHostDecorator=o,ng}var ig={},Qee;function Hwe(){if(Qee)return ig;Qee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=ig&&ig.__awaiter||function(u,c,d,l){function f(b){return b instanceof d?b:new d(function(C){C(b)})}return new(d||(d=Promise))(function(b,C){function v(g){try{h(l.next(g))}catch(_){C(_)}}function m(g){try{h(l.throw(g))}catch(_){C(_)}}function h(g){g.done?b(g.value):f(g.value).then(v,m)}h((l=l.apply(u,c||[])).next())})};Object.defineProperty(ig,"__esModule",{value:!0}),ig.BackwardsCompatibilityHostDecorator=void 0;const n=cL(),a=oL(),t=SI(),i=vI(),r=[100,200,200,400,600],s=300*1e3;let o=class extends n.BaseHostDecorator{constructor(c){super(c),this._host=c,this._userRolesRequestCache=new a.RequestCache(s),this._totalTries=4,this._getClientInfoTriesRemaining=this._totalTries,this._getClientInfoExists=!1,this._hasWarnedPolyfill=!1,this.warmupCheckGetClientInfoExists()}getClientRoles(c){return e(this,void 0,void 0,function*(){if(!c)throw new Error("BackwardsCompatibilityHostDecorator: called getClientInfo() without a clientId");return this._userRolesRequestCache.cacheRequest(c,()=>(0,i.waitForResult)(()=>e(this,void 0,void 0,function*(){return yield this._host.getClientRoles(c)}),d=>(0,t.isClientRolesResponse)(d)?{response:d}:(0,t.isMobileWorkaroundRolesResponse)(d)?{response:d.userRoles}:null,()=>new Error("BackwardsCompatibilityHostDecorator: timed out getting roles for a remote client ID"),r))})}getClientInfo(c){return e(this,void 0,void 0,function*(){if(this._getClientInfoExists)return yield this._host.getClientInfo(c);if(this._getClientInfoTriesRemaining<=0){this._hasWarnedPolyfill||(console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: using getClientInfo polyfill"),this._hasWarnedPolyfill=!0);const l=yield this.getClientRoles(c);return{userId:c,displayName:void 0,roles:l??[]}}const d=this.getClientRoles(c);try{const l=yield this._host.getClientInfo(c,()=>{this._getClientInfoExists=!0},this.getRetrySchedule());return this._getClientInfoExists=!0,l}catch(l){if((0,t.isErrorLike)(l)&&l.message.includes("timed out")){this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining<=0&&console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill");const f=yield d;return{userId:c,displayName:void 0,roles:f??[]}}}return this._getClientInfoExists=!0,console.log("BackwardsCompatibilityHostDecorator: error, retryingWithActual"),yield this.getClientInfo(c)})}warmupCheckGetClientInfoExists(){this._getClientInfoExists||this._host.getClientInfo("fakeId",()=>{this._getClientInfoExists=!0},[]).catch(c=>{c.message.includes("timed out")?(this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining>0?this.warmupCheckGetClientInfoExists():console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill")):this._getClientInfoExists=!0})}getRetrySchedule(){const c=this._totalTries-Math.max(0,this._getClientInfoTriesRemaining);return r.slice(0,c)}};return ig.BackwardsCompatibilityHostDecorator=o,ig}var o1={},Yee;function Pce(){if(Yee)return o1;Yee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(o1,"__esModule",{value:!0}),o1.Deferred=void 0;let e=class{constructor(){this._promise=new Promise((a,t)=>{this._resolve=a,this._reject=t})}get promise(){return this._promise}get resolve(){return this._resolve}get reject(){return this._reject}};return o1.Deferred=e,o1}var GD={},Xee;function Kwe(){return Xee||(Xee=1,Object.defineProperty(GD,"__esModule",{value:!0})),GD}var sg={},Zee;function $we(){if(Zee)return sg;Zee=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=sg&&sg.__awaiter||function(r,s,o,u){function c(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function f(v){try{C(u.next(v))}catch(m){l(m)}}function b(v){try{C(u.throw(v))}catch(m){l(m)}}function C(v){v.done?d(v.value):c(v.value).then(f,b)}C((u=u.apply(r,s||[])).next())})};Object.defineProperty(sg,"__esModule",{value:!0}),sg.LiveObjectManager=void 0;const n=ry,a=Sb(),t=Bs();let i=class extends n.TypedEventEmitter{constructor(s,o){super(),this._liveRuntime=s,this._containerRuntime=o,this.objectStoreMap=new Map,this.updateInterval=1e4}start(){this.startReceivingSignalUpdates()}stop(){this.stopReceivingSignalUpdates(),this.objectStoreMap.clear()}registerObject(s,o,u,c,d){return e(this,void 0,void 0,function*(){this._synchronizer||(this._synchronizer=new t.ContainerSynchronizer(o,this._containerRuntime,this._liveRuntime,this)),this._synchronizer.registerObject(s,c,d);const l={clientId:yield(0,t.waitUntilConnected)(o),timestamp:0,data:u,name:t.ObjectSynchronizerEvents.update};this.updateEventLocallyInStore(s,l)})}unregisterObject(s){this._synchronizer&&this._synchronizer.unregisterObject(s)}getLatestEventForObject(s){var o;return(o=this.getEventsForObject(s))===null||o===void 0?void 0:o[0]}getLatestEventForObjectClient(s,o){var u;return(u=this.objectStoreMap.get(s))===null||u===void 0?void 0:u.get(o)}getEventsForObject(s){var o;const u=this.objectStoreMap.get(s);if(u)return(o=[...u.values()])===null||o===void 0?void 0:o.sort((c,d)=>d.timestamp-c.timestamp)}sendEventForObject(s,o){return e(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const u=yield this._synchronizer.sendEventForObject(s,o);return this.updateEventLocallyInStore(s,u),u})}sendThrottledEventForObject(s,o){return e(this,void 0,void 0,function*(){if(!this._synchronizer)throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");const u=yield this._synchronizer.sendThrottledEventForObject(s,o);return this.updateEventLocallyInStore(s,u),u})}clientIdDidChange(s,o){this.objectStoreMap.forEach(u=>{const c=u.get(s);c&&(u.set(o,c),u.delete(s))})}__dangerouslySetContainerRuntime(s){var o;this._containerRuntime!==s&&(this.stopReceivingSignalUpdates(),this._containerRuntime=s,this.startReceivingSignalUpdates(),(o=this._synchronizer)===null||o===void 0||o.__dangerouslySetContainerRuntime(s))}setAudience(s){this._audience=s}onReceivedSignal(s,o){var u;o||!s.clientId||!(0,t.isILiveEvent)(s.content)||typeof s.content.data!="object"||(this.dispatchUpdates(t.ObjectSynchronizerEvents.update,s.clientId,s.content.data,o),s.type===t.ObjectSynchronizerEvents.connect&&((u=this._synchronizer)===null||u===void 0||u.onSendBackgroundUpdates()))}dispatchUpdates(s,o,u,c){for(const d in u){const l=u[d],f={clientId:o,timestamp:l.timestamp,data:(0,t.cloneValue)(l.data),name:s};this.updateEventLocallyInStore(d,f)&&this.emit(t.ObjectSynchronizerEvents.update,d,(0,t.cloneValue)(f),c)}}updateEventLocallyInStore(s,o){let u=this.objectStoreMap.get(s);if(u){const c=u.get(o.clientId);if(c&&!a.LiveEvent.isNewer(c,o))return!1;u.set(o.clientId,o),c||this.emitJoined(s,o)}else u=new Map,u.set(o.clientId,o),this.objectStoreMap.set(s,u),this.emitJoined(s,o);return!0}emitJoined(s,o){this.emit("joined",{objectId:s,clientId:o.clientId,timestamp:o.timestamp})}startReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this.stopReceivingSignalUpdates(),this._onBoundReceivedSignalListener=this.onReceivedSignal.bind(this),this._containerRuntime.on("signal",this._onBoundReceivedSignalListener)}stopReceivingSignalUpdates(){this._onBoundReceivedSignalListener&&this._containerRuntime.off("signal",this._onBoundReceivedSignalListener)}};return sg.LiveObjectManager=i,sg}var ag={},og={},id={},ete;function iy(){if(ete)return id;ete=1,Object.defineProperty(id,"__esModule",{value:!0}),id.LiveDataObjectInitializeNotNeededError=id.LiveDataObjectNotInitializedError=id.UnexpectedError=void 0;const e=Bs(),n=Go();class a extends Error{constructor(s,o){super(`${s} - ${o}
Please report this issue at ${e.LiveShareReportIssueLink}.`)}static assert(s,o,u){if(!s)throw new a(o,u)}}id.UnexpectedError=a;class t extends Error{constructor(s,o,u){super(`${s} - not initialized prior to calling \`${o}()\`. \`initializeState\` is \`${u}\` but must equal \`succeeded\`.
To fix this error, ensure \`.initialize()\` has resolved before calling this function.`)}static assert(s,o,u){if(u!==n.LiveDataObjectInitializeState.succeeded)throw new t(s,o,u)}}id.LiveDataObjectNotInitializedError=t;class i extends Error{constructor(s,o){super(`${s} -  initialization is not needed. \`initializeState\` is \`${o}\` but must equal \`needed\`.
To fix this error, ensure you only call \`.initialize()\` when \`initializeState\` equals \`needed\`.`)}static assert(s,o){if(o!==n.LiveDataObjectInitializeState.needed)throw new i(s,o)}}return id.LiveDataObjectInitializeNotNeededError=i,id}var tte;function Gwe(){if(tte)return og;tte=1;var e=og&&og.__awaiter||function(r,s,o,u){function c(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function f(v){try{C(u.next(v))}catch(m){l(m)}}function b(v){try{C(u.throw(v))}catch(m){l(m)}}function C(v){v.done?d(v.value):c(v.value).then(f,b)}C((u=u.apply(r,s||[])).next())})};Object.defineProperty(og,"__esModule",{value:!0}),og.ThrottledEventQueue=void 0;const n=Pce(),a=aL(),t=iy();let i=class{constructor(s,o=50){this._events={},this._containerSynchronizer=s,this._throttleIntervalMilli=o}sendWithQueue(s,o){return e(this,void 0,void 0,function*(){this._events[s]=o,this._hTimer||(this._deferred=new n.Deferred,this._hTimer=setTimeout(()=>e(this,void 0,void 0,function*(){var c,d;try{const l=yield this._containerSynchronizer.sendEventUpdates(this._events,a.ObjectSynchronizerEvents.update);t.UnexpectedError.assert(!!l,"ThrottledEventQueue","unable to send empty set of updates, which should not occur."),(c=this._deferred)===null||c===void 0||c.resolve(l)}catch(l){(d=this._deferred)===null||d===void 0||d.reject(l)}finally{this._events={},this._hTimer=void 0}}),this._throttleIntervalMilli)),t.UnexpectedError.assert(!!this._deferred,"ThrottledEventQueue","no deferred set, which should not occur.");const u=yield this._deferred.promise;return{clientId:u.clientId,timestamp:u.data[s].timestamp,name:u.name,data:u.data[s].data}})}};return og.ThrottledEventQueue=i,og}var nte;function Wwe(){if(nte)return ag;nte=1;var e=ag&&ag.__awaiter||function(r,s,o,u){function c(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function f(v){try{C(u.next(v))}catch(m){l(m)}}function b(v){try{C(u.throw(v))}catch(m){l(m)}}function C(v){v.done?d(v.value):c(v.value).then(f,b)}C((u=u.apply(r,s||[])).next())})};Object.defineProperty(ag,"__esModule",{value:!0}),ag.ContainerSynchronizer=void 0;const n=Gwe(),a=aL(),t=vI();let i=class{constructor(s,o,u,c){this._runtime=s,this._containerRuntime=o,this._liveRuntime=u,this._objectStore=c,this._objects=new Map,this._throttledEventsQueue=new n.ThrottledEventQueue(this),this._connectedKeys=[],this._ddsBackgroundUpdateEnabled=new Set,this.startListeningForConnected()}registerObject(s,o,u){var c;if(this._objects.has(s))throw new Error(`LiveObjectSynchronizer: too many calls to registerObject() for object '${s}'`);this._connectedKeys.push(s),this._objects.set(s,o),this._runtime.clientId&&this._runtime.clientId!==this._connectSentForClientId&&this.onConnected(this._runtime.clientId),(c=this._objectStore.getEventsForObject(s))===null||c===void 0||c.forEach(d=>{this.onReceiveUpdate(s,d,d.clientId===this._runtime.clientId)}),u&&(this._ddsBackgroundUpdateEnabled.add(s),this._ddsBackgroundUpdateEnabled.size==1&&this.startBackgroundObjectUpdates())}unregisterObject(s){return this._objects.has(s)&&(this._objects.delete(s),this._connectedKeys=this._connectedKeys.filter(u=>u!=s),this._ddsBackgroundUpdateEnabled.has(s)&&(this._ddsBackgroundUpdateEnabled.delete(s),this._ddsBackgroundUpdateEnabled.size==0))?(this.stopBackgroundObjectUpdates(),!0):!1}onSendBackgroundUpdates(){return e(this,void 0,void 0,function*(){this._liveRuntime.canSendBackgroundUpdates&&(yield this.sendGroupEvent(this._connectedKeys.filter(s=>this._ddsBackgroundUpdateEnabled.has(s)),a.ObjectSynchronizerEvents.update).catch(s=>console.error(s)))})}sendEventForObject(s,o){return e(this,void 0,void 0,function*(){const u=this._objects.get(s);if(!u)throw new Error("ContainerSynchronizer.sendEventForObject(): cannot send an event for an object that is not registered");if(!(yield u.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");const d=yield this.sendEventUpdates({[s]:{data:o,timestamp:this._liveRuntime.getTimestamp()}},a.ObjectSynchronizerEvents.update);if(!d)throw new Error("Unable to send an event with empty updates");return{clientId:d.clientId,timestamp:d.data[s].timestamp,name:d.name,data:d.data[s].data}})}sendThrottledEventForObject(s,o){return e(this,void 0,void 0,function*(){const u=this._objects.get(s);if(!u)throw new Error("ContainerSynchronizer.sendThrottledEventForObject(): cannot send an event for an object that is not registered");if(!(yield u.getLocalUserCanSend(!1)))throw new Error("The local user doesn't meet the app requirements to send a message for this object");return yield this._throttledEventsQueue.sendWithQueue(s,{data:o,timestamp:this._liveRuntime.getTimestamp()})})}sendEventUpdates(s,o){return e(this,void 0,void 0,function*(){if(Object.keys(s).length>0){const c={clientId:yield this.waitUntilConnected(),data:s,timestamp:o===a.ObjectSynchronizerEvents.connect?0:this._liveRuntime.getTimestamp(),name:o};return this._containerRuntime.submitSignal(o,c),c}})}__dangerouslySetContainerRuntime(s){this._containerRuntime!==s&&(this._containerRuntime=s)}onConnected(s){return e(this,void 0,void 0,function*(){if(s!==this._connectSentForClientId){this._connectSentForClientId&&this._objectStore.clientIdDidChange(this._connectSentForClientId,s),this._connectSentForClientId=s,this._liveRuntime.host.registerClientId(s).catch(o=>{console.error(o)});try{yield this.sendGroupEvent(this._connectedKeys,a.ObjectSynchronizerEvents.connect)}catch(o){console.error(`LiveObjectSynchronizer: error sending update - ${o.toString()}`)}}})}sendGroupEvent(s,o){return e(this,void 0,void 0,function*(){const u=[],c={},d=yield this.waitUntilConnected();for(let f=0;f<s.length;f++){const b=s[f];try{const C=this._objects.get(b);if(C&&(yield C.getLocalUserCanSend(o===a.ObjectSynchronizerEvents.connect))){const v=this._objectStore.getLatestEventForObjectClient(b,d);if(typeof v=="object"){c[b]={data:v.data,timestamp:C.shouldUpdateTimestampPeriodically?this._liveRuntime.getTimestamp():o===a.ObjectSynchronizerEvents.connect?0:v.timestamp};continue}}}catch(C){console.error(`LiveObjectSynchronizer: error getting an objects state - ${C.toString()}`)}u.push(b)}const l=Object.keys(c);return yield this.sendEventUpdates(c,o),{sent:l,skipped:u}})}onReceiveUpdate(s,o,u){return e(this,void 0,void 0,function*(){const c=this._objects.get(s);!c||!(yield c.updateState(o,o.clientId,u))||this._objectStore.updateEventLocallyInStore.bind(this._objectStore)(s,Object.assign(Object.assign({},o),{clientId:yield this.waitUntilConnected()}))})}waitUntilConnected(){return(0,t.waitUntilConnected)(this._runtime)}startListeningForConnected(){this._onBoundConnectedListener&&this.stopListeningForConnected(),this._onBoundConnectedListener=this.onConnected.bind(this),this._runtime.on("connected",this._onBoundConnectedListener)}stopListeningForConnected(){this._onBoundConnectedListener&&this._runtime.off("connected",this._onBoundConnectedListener)}startBackgroundObjectUpdates(){this.stopBackgroundObjectUpdates(),this._onReceiveObjectUpdateListener=this.onReceiveUpdate.bind(this),this._objectStore.on(a.ObjectSynchronizerEvents.update,this._onReceiveObjectUpdateListener),this._onSendUpdatesIntervalCallback=this.onSendBackgroundUpdates.bind(this),this._hTimer=setInterval(this._onSendUpdatesIntervalCallback,this._liveRuntime.objectManager.updateInterval)}stopBackgroundObjectUpdates(){this._hTimer&&(clearInterval(this._hTimer),this._hTimer=void 0,this._onSendUpdatesIntervalCallback=void 0),this._onReceiveObjectUpdateListener&&(this._objectStore.off("update",this._onReceiveObjectUpdateListener),this._onReceiveObjectUpdateListener=void 0)}};return ag.ContainerSynchronizer=i,ag}var cg={},rte;function Jwe(){if(rte)return cg;rte=1;var e=cg&&cg.__awaiter||function(s,o,u,c){function d(l){return l instanceof u?l:new u(function(f){f(l)})}return new(u||(u=Promise))(function(l,f){function b(m){try{v(c.next(m))}catch(h){f(h)}}function C(m){try{v(c.throw(m))}catch(h){f(h)}}function v(m){m.done?l(m.value):d(m.value).then(b,C)}v((c=c.apply(s,o||[])).next())})};Object.defineProperty(cg,"__esModule",{value:!0}),cg.FormatFixHostDecorator=void 0;const n=cL(),a=SI();let t=class extends n.BaseHostDecorator{getClientInfo(o){return e(this,void 0,void 0,function*(){const u=yield this._host.getClientInfo(o);if((0,a.isIClientInfo)(o))return u;const c=i(u);return c||u})}};cg.FormatFixHostDecorator=t;function i(s){if(s instanceof Object){let o,u,c;if(Object.keys(s).map(d=>s[d]).forEach(d=>{(0,a.isClientRolesResponse)(d)?u=d:r(d)?o=d:typeof d=="string"&&(c=d)}),o&&u)return{userId:o,roles:u,displayName:c}}}function r(s){return typeof s=="string"?/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/.test(s):!1}return cg}var ite;function Bs(){return ite||(ite=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=Zp&&Zp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Zp&&Zp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(aL(),e),a(Fwe(),e),a(oL(),e),a(jwe(),e),a(vI(),e),a(Vwe(),e),a(Hwe(),e),a(Pce(),e),a(SI(),e),a(Kwe(),e),a($we(),e),a(Wwe(),e),a(Jwe(),e)})(Zp)),Zp}var ste;function Ece(){if(ste)return nd;ste=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=nd&&nd.__awaiter||function(s,o,u,c){function d(l){return l instanceof u?l:new u(function(f){f(l)})}return new(u||(u=Promise))(function(l,f){function b(m){try{v(c.next(m))}catch(h){f(h)}}function C(m){try{v(c.throw(m))}catch(h){f(h)}}function v(m){m.done?l(m.value):d(m.value).then(b,C)}v((c=c.apply(s,o||[])).next())})},n=nd&&nd.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(nd,"__esModule",{value:!0}),nd.LiveEventScope=void 0;const a=n(Ec()),t=ry,i=Bs();let r=class extends t.TypedEventEmitter{constructor(o,u,c){super(),this._liveRuntime=u,this.emitter=new a.default,this.throwForEvents=[],this._runtime=o,this._allowedRoles=c||[],this.emitter.on("error",d=>{this.emit("error",d)}),this._runtime.on("signal",(d,l)=>{if(!d.clientId||!this._runtime.connected)return;const f=d.clientId;d.content.clientId=f,this.emitToListeners(f,d.content,l)})}get allowedRoles(){return this._allowedRoles}set allowedRoles(o){this._allowedRoles=o}get clientId(){return this._runtime.clientId}onEvent(o,u){return this.throwForEvents.push(o),this.emitter.on(o,u),this}offEvent(o,u){this.emitter.off(o,u);const c=this.throwForEvents.indexOf(o);return c>=0&&this.throwForEvents.splice(c,1),this}sendEvent(o,u){return e(this,void 0,void 0,function*(){const c=yield this.createEvent(o,u);return this._runtime.submitSignal(o,c),c})}sendLocalEvent(o,u){return e(this,void 0,void 0,function*(){const c=yield this.createEvent(o,u);return this.emitToListeners(c.clientId,c,!0),c})}createEvent(o,u){return e(this,void 0,void 0,function*(){const c=yield this.waitUntilConnected();if(!(yield this._liveRuntime.verifyRolesAllowed(c,this._allowedRoles)))throw new Error(`The local user doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`);return{clientId:c,name:o,timestamp:this._liveRuntime.getTimestamp(),data:u}})}waitUntilConnected(){return(0,i.waitUntilConnected)(this._runtime)}emitToListeners(o,u,c){this._liveRuntime.verifyRolesAllowed(o,this._allowedRoles).then(d=>{d?this.emitter.emit(u.name,u,c):this.throwForEvents.includes(u.name)&&this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},new Error(`The clientId of "${o}" doesn't have a role of ${JSON.stringify(this._allowedRoles)}.`))}).catch(d=>{this._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},d)})}};return nd.LiveEventScope=r,nd}var c1={},ug={},ate;function Ice(){if(ate)return ug;ate=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=ug&&ug.__awaiter||function(a,t,i,r){function s(o){return o instanceof i?o:new i(function(u){u(o)})}return new(i||(i=Promise))(function(o,u){function c(f){try{l(r.next(f))}catch(b){u(b)}}function d(f){try{l(r.throw(f))}catch(b){u(b)}}function l(f){f.done?o(f.value):s(f.value).then(c,d)}l((r=r.apply(a,t||[])).next())})};Object.defineProperty(ug,"__esModule",{value:!0}),ug.LiveEventSource=void 0;let n=class{constructor(t,i){this._scope=t,this._eventName=i}sendEvent(t){return e(this,void 0,void 0,function*(){return yield this._scope.sendEvent(this._eventName,t)})}sendLocalEvent(t){return e(this,void 0,void 0,function*(){return yield this._scope.sendLocalEvent(this._eventName,t)})}};return ug.LiveEventSource=n,ug}var ote;function Rce(){if(ote)return c1;ote=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(c1,"__esModule",{value:!0}),c1.LiveEventTarget=void 0;const e=Ice();let n=class extends e.LiveEventSource{constructor(t,i,r){super(t,i),t.onEvent(i,r)}};return c1.LiveEventTarget=n,c1}var dg={},cte;function vb(){if(cte)return dg;cte=1;var e=dg&&dg.__awaiter||function(s,o,u,c){function d(l){return l instanceof u?l:new u(function(f){f(l)})}return new(u||(u=Promise))(function(l,f){function b(m){try{v(c.next(m))}catch(h){f(h)}}function C(m){try{v(c.throw(m))}catch(h){f(h)}}function v(m){m.done?l(m.value):d(m.value).then(b,C)}v((c=c.apply(s,o||[])).next())})};Object.defineProperty(dg,"__esModule",{value:!0}),dg.LiveDataObject=void 0;const n=$o(),a=ry,t=Go(),i=Bs();let r=class extends n.DataObject{get liveRuntime(){return(0,a.assert)(this._liveRuntime!==null,`LiveShareRuntime not initialized. Ensure your Fluid \`ContainerSchema\` was first wrapped inside of \`getLiveContainerSchema()\` before calling \`client.getContainer()\` / \`client.createContainer()\` from your \`AzureClient\` (or equivalent) instance.
Alternatively, you can use the \`.joinContainer()\` in \`LiveShareClient\`, which does this for you.
If you are using \`LiveShareClient\` and are still encountering this issue, please report this issue at ${i.LiveShareReportIssueLink}.`),this._liveRuntime}get isInitialized(){return this.initializeState===t.LiveDataObjectInitializeState.succeeded}get initializeState(){return this._initializeState}set initializeState(o){this._initializeState=o}constructor(o){super(o),this._initializeState=t.LiveDataObjectInitializeState.needed,this._allowedRoles=[],this._liveRuntime=null}getClientInfo(o){return this.liveRuntime.getClientInfo(o)}waitUntilConnected(){return(0,i.waitUntilConnected)(this.runtime)}verifyLocalUserRoles(){var o;return e(this,void 0,void 0,function*(){const u=yield this.waitUntilConnected();return this.liveRuntime.verifyRolesAllowed(u,(o=this._allowedRoles)!==null&&o!==void 0?o:[])})}__dangerouslySetLiveRuntime(o){this._liveRuntime=o}onLocalUserAllowed(o){return e(this,void 0,void 0,function*(){(yield this.verifyLocalUserRoles())&&o()})}};return r.LiveEnabled=!0,dg.LiveDataObject=r,dg}var ute;function Sb(){return ute||(ute=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=G_&&G_.__awaiter||function(f,b,C,v){function m(h){return h instanceof C?h:new C(function(g){g(h)})}return new(C||(C=Promise))(function(h,g){function _(w){try{p(v.next(w))}catch(O){g(O)}}function S(w){try{p(v.throw(w))}catch(O){g(O)}}function p(w){w.done?h(w.value):m(w.value).then(_,S)}p((v=v.apply(f,b||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.LiveEvent=e.LiveEventEvents=void 0;const a=$o(),t=Go(),i=Ece(),r=Rce(),s=bb(),o=vb(),u=Bs(),c=iy();var d;(function(f){f.received="received"})(d=e.LiveEventEvents||(e.LiveEventEvents={}));let l=class extends o.LiveDataObject{initialize(b){c.LiveDataObjectInitializeNotNeededError.assert("LiveEvent:initialize",this.initializeState),this.initializeState=t.LiveDataObjectInitializeState.pending,this._allowedRoles=b??[];const C=new i.LiveEventScope(this.runtime,this.liveRuntime,b);return this._eventTarget=new r.LiveEventTarget(C,"event",(v,m)=>{this.emit(d.received,(0,u.cloneValue)(v.data),m,v.clientId,v.timestamp)}),this.initializeState=t.LiveDataObjectInitializeState.succeeded,Promise.resolve()}send(b){return n(this,void 0,void 0,function*(){return c.LiveDataObjectNotInitializedError.assert("LiveEvent:send","send",this.initializeState),c.UnexpectedError.assert(!!this._eventTarget,"LiveEvent:send","`this._eventTarget` is undefined, implying there was an error during initialization that should not occur."),yield this._eventTarget.sendEvent(b)})}static isNewer(b,C,v=0){if(b){if(b.timestamp==C.timestamp){if((b.clientId||"").localeCompare(C.clientId||"")<=0)return!1}else if(b.timestamp>C.timestamp){if(b.timestamp-C.timestamp>v)return!1}else if(C.timestamp-b.timestamp<v)return!1}return!0}};l.TypeName="@microsoft/live-share:LiveEvent",l.factory=new a.DataObjectFactory(l.TypeName,l,[],{}),e.LiveEvent=l,s.DynamicObjectRegistry.registerObjectClass(l,l.TypeName)})(G_)),G_}var u1={},d1={},dte;function uL(){if(dte)return d1;dte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(d1,"__esModule",{value:!0}),d1.TimeInterval=void 0;let e=class{constructor(a){this._value=a}get milliseconds(){return this._value}set milliseconds(a){this._value=a}get seconds(){return this._value/1e3}set seconds(a){this._value=Math.floor(a*1e3)}};return d1.TimeInterval=e,d1}var lte;function Qwe(){if(lte)return u1;lte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(u1,"__esModule",{value:!0}),u1.LiveEventTimer=void 0;const e=uL();let n=class{constructor(t,i,r,s=!1){this._isRunning=!1,this._eventSource=t,this._createEvent=i,this._delay=new e.TimeInterval(r),this.repeat=s}get delay(){return this._delay.milliseconds}set delay(t){this._delay.milliseconds=t}get isRunning(){return this._isRunning}sendEvent(){const t=this._createEvent();return this._eventSource.sendEvent(t)}start(){this.stop(),this._isRunning=!0,this.delayedEmit(this.delay)}stop(){this._timer!=null&&(clearTimeout(this._timer),this._timer=void 0),this._isRunning=!1}delayedEmit(t){this._timer=setTimeout(()=>{this._timer=void 0;const i=new Date().getTime();if(this.sendEvent().catch(r=>{console.warn(r)}),this._isRunning&&this.repeat){const r=(new Date().getTime()-i)%this.delay;this.delayedEmit(this.delay-r)}},t)}};return u1.LiveEventTimer=n,u1}var l1={},WD={},f1={},fte;function Ywe(){if(fte)return f1;fte=1,Object.defineProperty(f1,"__esModule",{value:!0}),f1.LivePresenceConnection=void 0;const e=Bs(),n=Sb(),a=CI();let t=class{constructor(r,s,o,u){this._evt=r,this._isLocalConnection=s,this._expirationPeriod=o,this._liveRuntime=u}get isLocalConnection(){return this._isLocalConnection}get clientId(){return this._evt.clientId}get state(){return this.hasExpired()?a.PresenceState.offline:this._evt.data.state}get data(){return(0,e.cloneValue)(this._evt.data.data)}updateConnection(r){if(this._evt.clientId!==r.clientId)throw new Error("LivePresenceConnection.updateConnection called with event with different clientId");n.LiveEvent.isNewer(this._evt,r)&&(this._evt=r)}set expirationPeriod(r){this._expirationPeriod=r}hasExpired(){const s=this._liveRuntime.getTimestamp()-this._evt.timestamp;return!this._isLocalConnection&&s>this._expirationPeriod.milliseconds}};return f1.LivePresenceConnection=t,f1}var hte;function CI(){return hte||(hte=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.LivePresenceUser=e.PresenceState=void 0;const n=Sb(),a=Bs(),t=Ywe();var i;(function(s){s.online="online",s.away="away",s.offline="offline"})(i=e.PresenceState||(e.PresenceState={}));class r{constructor(o,u,c,d,l){this._clientInfo=o,this._evt=u,this._expirationPeriod=c,this._liveRuntime=d,this._connections=new Map,this._isLocalUser=!1,this.updateClients(this._evt,l),this._lastUpdateTime=this._liveRuntime.getTimestamp()}get isLocalUser(){return this._isLocalUser}get userId(){return this._clientInfo.userId}get displayName(){return this._clientInfo.displayName}get state(){return this.hasExpired()?i.offline:this._evt.data.state}get data(){return(0,a.cloneValue)(this._evt.data.data)}get roles(){return this._clientInfo.roles}getConnections(o){const u=[];return this._connections.forEach(c=>{(o==null||c.state==o)&&u.push(c)}),u}getConnection(o){return this._connections.get(o)}isFromClient(o){return this._connections.get(o)!==void 0}updateReceived(o,u,c){const d=this.updateClients(o,c),l=this._evt,f=this._clientInfo;return n.LiveEvent.isNewer(l,o)?(this._evt=o,this._clientInfo=u,this._lastUpdateTime=this._liveRuntime.getTimestamp(),d||o.data.state!=l.data.state||JSON.stringify(u)!=JSON.stringify(f)||JSON.stringify(o.data.data)!=JSON.stringify(l.data.data)):d}set expirationPeriod(o){this._expirationPeriod=o,this._connections.forEach(u=>{u.expirationPeriod=o})}hasExpired(){const u=this._liveRuntime.getTimestamp()-this._lastUpdateTime;return!this._isLocalUser&&u>this._expirationPeriod.milliseconds}updateClients(o,u){const c=this._connections.get(o.clientId);return c?(c.updateConnection(o),!1):(this._connections.set(o.clientId,new t.LivePresenceConnection(o,u,this._expirationPeriod,this._liveRuntime)),u&&!this._isLocalUser?(this._isLocalUser=u,!0):!1)}}e.LivePresenceUser=r})(WD)),WD}var h1={},mte;function _I(){if(mte)return h1;mte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(h1,"__esModule",{value:!0}),h1.LiveObjectSynchronizer=void 0;let e=class{constructor(a,t,i){this.id=a,this.runtime=t,this.liveRuntime=i,this._isDisposed=!1,this._joinedListener=()=>{}}start(a,t,i,r=!1,s=!0){return this.liveRuntime.objectManager.registerObject(this.id,this.runtime,a,{updateState:t,getLocalUserCanSend:i,shouldUpdateTimestampPeriodically:r},s)}dispose(){this._isDisposed||(this._isDisposed=!0,this.liveRuntime.objectManager.unregisterObject(this.id),this.liveRuntime.objectManager.off("joined",this._joinedListener))}getLatestEvent(){return this.liveRuntime.objectManager.getLatestEventForObject(this.id)}getLatestEventForClient(a){return this.liveRuntime.objectManager.getLatestEventForObjectClient(this.id,a)}getEvents(){return this.liveRuntime.objectManager.getEventsForObject(this.id)}sendEvent(a){return this.liveRuntime.objectManager.sendEventForObject(this.id,a)}sendThrottledEvent(a){return this.liveRuntime.objectManager.sendThrottledEventForObject(this.id,a)}set onJoinedListener(a){this.liveRuntime.objectManager.off("joined",this._joinedListener),this._joinedListener=a,this.liveRuntime.objectManager.on("joined",({objectId:t,clientId:i,timestamp:r})=>{t===this.id&&this._joinedListener(i,r)})}};return h1.LiveObjectSynchronizer=e,h1}var m1={},pte;function TI(){if(pte)return m1;pte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(m1,"__esModule",{value:!0}),m1.LiveTelemetryLogger=void 0;let e=class Fce{constructor(a,t){this._liveRuntime=t,this._runtime=a}sendTelemetryEvent(a,t,i){if(this._runtime.logger){const r=this.createTelemetryEvent(a,i);this._runtime.logger.sendTelemetryEvent(r,t)}}sendErrorEvent(a,t,i){if(this._runtime.logger){const r=this.createTelemetryEvent(a,i);this._runtime.logger.sendErrorEvent(r,t)}}sendPerformanceEvent(a,t,i,r){if(this._runtime.logger){const s=Object.assign({duration:t},this.createTelemetryEvent(a,r));this._runtime.logger.sendPerformanceEvent(s,i)}}createTelemetryEvent(a,t){const i=this._liveRuntime.getTimestamp();return Object.assign({eventName:a,clientId:this._runtime.clientId,correlationId:Fce.formatCorrelationId(this._runtime.clientId,i),timestamp:i},t)}static formatCorrelationId(a,t){return`${a}:${t}`}};return m1.LiveTelemetryLogger=e,m1}var gte;function jce(){return gte||(gte=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=l1&&l1.__awaiter||function(C,v,m,h){function g(_){return _ instanceof m?_:new m(function(S){S(_)})}return new(m||(m=Promise))(function(_,S){function p(E){try{O(h.next(E))}catch(F){S(F)}}function w(E){try{O(h.throw(E))}catch(F){S(F)}}function O(E){E.done?_(E.value):g(E.value).then(p,w)}O((h=h.apply(C,v||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.LivePresence=e.LivePresenceEvents=void 0;const a=$o(),t=CI(),i=_I(),r=TI(),s=Bs(),o=iy(),u=uL(),c=bb(),d=Go(),l=vb();var f;(function(C){C.presenceChanged="presenceChanged"})(f=e.LivePresenceEvents||(e.LivePresenceEvents={}));let b=class extends l.LiveDataObject{constructor(){super(...arguments),this._expirationPeriod=new u.TimeInterval(2e4),this._users=[],this._lastEmitPresenceStateMap=new Map}get expirationPeriod(){return this._expirationPeriod.seconds}set expirationPeriod(v){this._expirationPeriod.seconds=v>.1?v:.1,this.getUsers().forEach(m=>{m.expirationPeriod=this._expirationPeriod})}get localUser(){var v;const m=(v=this._currentPresence)===null||v===void 0?void 0:v.clientId;if(m)return this.getUserForClient(m)}initialize(v,m=t.PresenceState.online,h){return n(this,void 0,void 0,function*(){o.LiveDataObjectInitializeNotNeededError.assert("LivePresence:initialize",this.initializeState),o.UnexpectedError.assert(!this._synchronizer,"LivePresence:initialize","_synchronizer already set, which is an unexpected error."),this.initializeState=d.LiveDataObjectInitializeState.pending,this._logger=new r.LiveTelemetryLogger(this.runtime,this.liveRuntime),this._allowedRoles=h||[],this._currentPresence={clientId:yield this.waitUntilConnected(),name:"UpdatePresence",timestamp:0,data:{state:m,data:v}},this._synchronizer=new i.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentPresence.data,(g,_,S)=>n(this,void 0,void 0,function*(){return yield this.updateMembersList(g,S),!1}),g=>n(this,void 0,void 0,function*(){if(g)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}),!0)}catch(g){throw this.initializeState=d.LiveDataObjectInitializeState.fatalError,g}this.initializeState=d.LiveDataObjectInitializeState.succeeded,yield this.updateInternal(this._currentPresence.data.data,this._currentPresence.data.state,!0,!0).catch(()=>{})})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}getUsers(v){return v?this._users.filter(m=>m.state==v):this._users}update(v,m){return n(this,void 0,void 0,function*(){return yield this.updateInternal(v,m)})}getUserForClient(v){return this._users.find(m=>m.isFromClient(v))}getUser(v){return this._users.find(m=>m.userId==v)}updateInternal(v,m,h=!1,g=!1){var _;return n(this,void 0,void 0,function*(){o.LiveDataObjectNotInitializedError.assert("LivePresence:updateInternal","update",this.initializeState),o.UnexpectedError.assert(!!this._synchronizer,"LivePresence:updateInternal","this._synchronizer is undefined, implying there was an error during initialization that should not occur."),o.UnexpectedError.assert(!!this._currentPresence,"LivePresence:updateInternal","this._currentPresence is undefined, implying there was an error during initialization that should not occur.");const S={state:m??this._currentPresence.data.state,data:(_=(0,s.cloneValue)(v))!==null&&_!==void 0?_:this._currentPresence.data.data};if(!g||this.liveRuntime.canSendBackgroundUpdates){const p=h?yield this._synchronizer.sendThrottledEvent(S):yield this._synchronizer.sendEvent(S);yield this.updateMembersList(p,!0)}else{const p={data:S,name:"",clientId:yield this.waitUntilConnected(),timestamp:1};yield this.updateMembersList(p,!0)}})}updateMembersList(v,m){var h;return n(this,void 0,void 0,function*(){try{if(!(yield this.liveRuntime.verifyRolesAllowed(v.clientId,this._allowedRoles)))return!1;m&&(this._currentPresence=v);const _=yield this.liveRuntime.getClientInfo(v.clientId);return _?this.useTransientParticipantWorkaround(_)?this.transientParticipantWorkaround(v,m,_):this.updateMembersListWithInfo(v,m,_):!1}catch(g){(h=this._logger)===null||h===void 0||h.sendErrorEvent(s.TelemetryEvents.LiveState.RoleVerificationError,g)}return!1})}useTransientParticipantWorkaround(v){const m={userId:v.userId,roles:[d.UserMeetingRole.guest],displayName:void 0};return JSON.stringify(v)===JSON.stringify(m)}transientParticipantWorkaround(v,m,h){const g=this._users.find(_=>_.userId===h.userId);if(g){const _={userId:g.userId,roles:g.roles,displayName:g.displayName};return this.updateMembersListWithInfo(v,m,_)}return this.updateMembersListWithInfo(v,m,h)}updateMembersListWithInfo(v,m,h){const g=w=>{var O,E;this._lastEmitPresenceStateMap.set(w.userId,w.state),this.emit(f.presenceChanged,w,m,v.clientId),m?(O=this._logger)===null||O===void 0||O.sendTelemetryEvent(s.TelemetryEvents.LivePresence.LocalPresenceChanged,null,{user:JSON.stringify(v)}):(E=this._logger)===null||E===void 0||E.sendTelemetryEvent(s.TelemetryEvents.LivePresence.RemotePresenceChanged,null,{user:JSON.stringify(v)})};let _=!1,S=!0;for(let w=0;w<this._users.length;w++){const O=this._users[w];h.userId===O.userId?(O.updateReceived(v,h,m)&&(g(O),_=!0),S=!1):this._lastEmitPresenceStateMap.get(O.userId)!==O.state&&(g(O),_=!0)}if(!S)return _;const p=new t.LivePresenceUser(h,v,this._expirationPeriod,this.liveRuntime,m);return this._users.push(p),g(p),!0}};b.TypeName="@microsoft/live-share:LivePresence",b.factory=new a.DataObjectFactory(b.TypeName,b,[],{}),e.LivePresence=b,c.DynamicObjectRegistry.registerObjectClass(b,b.TypeName)})(l1)),l1}var p1={},g1={},yte;function Mce(){return yte||(yte=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=g1&&g1.__awaiter||function(C,v,m,h){function g(_){return _ instanceof m?_:new m(function(S){S(_)})}return new(m||(m=Promise))(function(_,S){function p(E){try{O(h.next(E))}catch(F){S(F)}}function w(E){try{O(h.throw(E))}catch(F){S(F)}}function O(E){E.done?_(E.value):g(E.value).then(p,w)}O((h=h.apply(C,v||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.LiveState=e.LiveStateEvents=void 0;const a=$o(),t=ry,i=Go(),r=Bs(),s=iy(),o=TI(),u=Sb(),c=_I(),d=bb(),l=vb();var f;(function(C){C.stateChanged="stateChanged"})(f=e.LiveStateEvents||(e.LiveStateEvents={}));let b=class extends l.LiveDataObject{get state(){return this.latestEvent.data}initialize(v,m){return n(this,void 0,void 0,function*(){s.LiveDataObjectInitializeNotNeededError.assert("LiveState:initialize",this.initializeState),s.UnexpectedError.assert(!this._synchronizer,"LiveState:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._logger=new o.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.latestEvent={clientId:"",name:"ChangeState",timestamp:0,data:v},this._allowedRoles=m||[],this._synchronizer=new c.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(v,(h,g,_)=>n(this,void 0,void 0,function*(){return yield this.onReceivedStateEvent(h,g,_)}),h=>n(this,void 0,void 0,function*(){if(h)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(h){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,h}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}set(v){return n(this,void 0,void 0,function*(){s.LiveDataObjectNotInitializedError.assert("LiveState:set","set",this.initializeState);const m=(0,r.cloneValue)(v),h=yield this._synchronizer.sendEvent(m);this.updateState(h,!0)})}get latestEvent(){return(0,t.assert)(this._latestEvent!==void 0,"LiveState is not initialized"),this._latestEvent}set latestEvent(v){this._latestEvent=v}onReceivedStateEvent(v,m,h){var g;return n(this,void 0,void 0,function*(){try{return!(yield this.liveRuntime.verifyRolesAllowed(m,this._allowedRoles))||!u.LiveEvent.isNewer(this.latestEvent,v)||JSON.stringify(this.latestEvent.data)===JSON.stringify(v.data)?!1:(this.updateState(v,h),!0)}catch(_){return(g=this._logger)===null||g===void 0||g.sendErrorEvent(r.TelemetryEvents.LiveState.RoleVerificationError,_),!1}})}updateState(v,m){var h;const g=this.latestEvent.data,_=v.data;this.latestEvent=v,this.emit(f.stateChanged,(0,r.cloneValue)(v.data),m,v.clientId,v.timestamp),(h=this._logger)===null||h===void 0||h.sendTelemetryEvent(r.TelemetryEvents.LiveState.StateChanged,null,{oldState:JSON.stringify(g),newState:JSON.stringify(_)})}};b.TypeName="@microsoft/live-share:LiveState",b.factory=new a.DataObjectFactory(b.TypeName,b,[],{}),e.LiveState=b,d.DynamicObjectRegistry.registerObjectClass(b,b.TypeName)})(g1)),g1}var bte;function Xwe(){return bte||(bte=1,(function(e){var n=p1&&p1.__awaiter||function(m,h,g,_){function S(p){return p instanceof g?p:new g(function(w){w(p)})}return new(g||(g=Promise))(function(p,w){function O(R){try{F(_.next(R))}catch(M){w(M)}}function E(R){try{F(_.throw(R))}catch(M){w(M)}}function F(R){R.done?p(R.value):S(R.value).then(O,E)}F((_=_.apply(m,h||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.LiveFollowMode=e.FollowModeType=e.LiveFollowModeEvents=void 0;const a=vb(),t=Mce(),i=jce(),r=$o(),s=ry,o=Go(),u=TI(),c=CI(),d=bb(),l=iy();(function(m){m.stateChanged="stateChanged",m.presenceChanged="presenceChanged"})(e.LiveFollowModeEvents||(e.LiveFollowModeEvents={}));var f;(function(m){m.local="local",m.activeFollowers="activeFollowers",m.activePresenter="activePresenter",m.followPresenter="followPresenter",m.suspendFollowPresenter="suspendFollowPresenter",m.followUser="followUser",m.suspendFollowUser="suspendFollowUser"})(f=e.FollowModeType||(e.FollowModeType={}));const b="@microsoft/live-share:LiveFollowMode:LiveState",C="@microsoft/live-share:LiveFollowMode:LivePresence";let v=class extends a.LiveDataObject{constructor(){super(...arguments),this._suspended=!1}get state(){const h=this.presence.localUser;if(!h||!h.data)return;const g=this.presentingUserIdState.state?this.presence.getUser(this.presentingUserIdState.state):void 0;if(g&&g.data){const p=this.getUsers(c.PresenceState.online).length-1;return g.isLocalUser?{value:g.data.stateValue,followingUserId:g.userId,type:f.activePresenter,otherUsersCount:p,isLocalValue:!0}:this._suspended?{value:h.data.stateValue,followingUserId:g.userId,type:f.suspendFollowPresenter,otherUsersCount:p-1,isLocalValue:!0}:{value:g.data.stateValue,followingUserId:g.userId,type:f.followPresenter,otherUsersCount:p-1,isLocalValue:!1}}const _=h.data.followingUserId?this.presence.getUser(h.data.followingUserId):void 0;if(_&&_.data){const p=this.getUserFollowers(_.userId,c.PresenceState.online).length-1;return this._suspended?{value:h.data.stateValue,followingUserId:_.userId,type:f.suspendFollowUser,otherUsersCount:p,isLocalValue:!0}:{value:_.data.stateValue,followingUserId:_.userId,type:f.followUser,otherUsersCount:p,isLocalValue:!1}}const S=this.getUserFollowers(h.userId,c.PresenceState.online).length;return S>0?{value:h.data.stateValue,followingUserId:h.userId,type:f.activeFollowers,otherUsersCount:S,isLocalValue:!0}:{value:h.data.stateValue,followingUserId:h.userId,type:f.local,otherUsersCount:this.getUserFollowers(h.userId,c.PresenceState.online).length,isLocalValue:!0}}get localUser(){return this.presence.localUser}get presentingUserIdState(){return l.UnexpectedError.assert(this._presentingUserIdState!==void 0,"LiveFollowMode:presentingUserIdState","This happens when `hasInitialized()` has not yet resolved, which should not happen."),this._presentingUserIdState}get presence(){return(0,s.assert)(this._presence!==void 0,"_presence not initialized"),this._presence}initialize(h,g){return n(this,void 0,void 0,function*(){l.LiveDataObjectInitializeNotNeededError.assert("LiveFollowMode:initialize",this.initializeState),this.initializeState=o.LiveDataObjectInitializeState.pending,this._logger=new u.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.presentingUserIdState.on("stateChanged",(_,S,p)=>{this._suspended=!1,this.handlePotentialStateChange(S,p)}),this.presence.on("presenceChanged",(_,S,p)=>{this.handlePotentialStateChange(S,p),this.emit("presenceChanged",_,S,p)});try{yield Promise.all([this.presentingUserIdState.initialize(void 0,g),this.presence.initialize({stateValue:h,followingUserId:void 0})])}catch(_){throw this.initializeState=o.LiveDataObjectInitializeState.fatalError,_}this.initializeState=o.LiveDataObjectInitializeState.succeeded})}update(h){var g;return n(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveFollowMode:update","update",this.initializeState),l.UnexpectedError.assert(!!(!((g=this.presence.localUser)===null||g===void 0)&&g.data),"LiveFollowMode:update","invalid local user's current state value when calling `.update()`, implying there was an error during initialization that should not occur."),yield this.presence.update({stateValue:h,followingUserId:this.presence.localUser.data.followingUserId})})}startPresenting(){var h;return n(this,void 0,void 0,function*(){if(l.LiveDataObjectNotInitializedError.assert("LiveFollowMode:startPresenting","startPresenting",this.initializeState),l.UnexpectedError.assert(!!(!((h=this.presence.localUser)===null||h===void 0)&&h.data),"LiveFollowMode:startPresenting","invalid local user's current state value when calling `.startPresenting()`, implying there was an error during initialization that should not occur."),this.presence.localUser.userId===this.presentingUserIdState.state)throw new Error("LiveFollowMode:startPresenting - the local user is already the active presenter. To stop presenting, use the `.stopPresenting()` function.");yield this.presentingUserIdState.set(this.presence.localUser.userId)})}stopPresenting(){var h;return n(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopPresenting","stopPresenting",this.initializeState),l.UnexpectedError.assert(!!(!((h=this.presence.localUser)===null||h===void 0)&&h.data),"LiveFollowMode:stopPresenting","invalid local user's current state value when calling `.stopPresenting()`, implying there was an error during initialization that should not occur."),yield this.presentingUserIdState.set(void 0)})}beginSuspension(){var h;return n(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveFollowMode:beginSuspension","beginSuspension",this.initializeState),l.UnexpectedError.assert(!!(!((h=this.presence.localUser)===null||h===void 0)&&h.data),"LiveFollowMode:beginSuspension","invalid local user's current state value when calling `.beginSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!0,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}endSuspension(){var h;return n(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveFollowMode:endSuspension","endSuspension",this.initializeState),l.UnexpectedError.assert(!!(!((h=this.presence.localUser)===null||h===void 0)&&h.data),"LiveFollowMode:endSuspension","invalid local user's current state value when calling `.endSuspension()`, implying there was an error during initialization that should not occur."),this._suspended=!1,this.handlePotentialStateChange(!0,yield this.waitUntilConnected())})}followUser(h){var g;return n(this,void 0,void 0,function*(){l.LiveDataObjectNotInitializedError.assert("LiveFollowMode:followUser","followUser",this.initializeState),l.UnexpectedError.assert(!!(!((g=this.presence.localUser)===null||g===void 0)&&g.data),"LiveFollowMode:followUser","invalid local user's current state value when calling `.followUser()`, implying there was an error during initialization that should not occur.");const _=this.presence.getUser(h);if(!_)throw new Error(`LiveFollowMode:followUser - cannot find user for provided \`userId\` of ${h}. Ensure remote user for this userId has also called \`.initialize()\`.`);if(_.isLocalUser)throw new Error("LiveFollowMode:followUser - local user cannot follow themselves. If you are trying to stop following another user, instead use the `.stopFollowing()` function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:h})})}stopFollowing(){var h;return n(this,void 0,void 0,function*(){if(l.LiveDataObjectNotInitializedError.assert("LiveFollowMode:stopFollowing","stopFollowing",this.initializeState),l.UnexpectedError.assert(!!(!((h=this.presence.localUser)===null||h===void 0)&&h.data),"LiveFollowMode:stopFollowing","invalid local user's current state value when calling `.stopFollowing()`, implying there was an error during initialization that should not occur."),!this.presence.localUser.data.followingUserId)throw new Error("LiveFollowMode:stopFollowing - the local user is not following another user.\nTo fix this error, ensure that `.followUser()` has resolved before calling this function.");yield this.presence.update({stateValue:this.presence.localUser.data.stateValue,followingUserId:void 0})})}getUsers(h){return this.presence.getUsers(h)}getUser(h){return this.presence.getUser(h)}getUserForClient(h){return this.presence.getUserForClient(h)}getUserFollowers(h,g){return this.getUsers(g).filter(S=>{var p;return((p=S.data)===null||p===void 0?void 0:p.followingUserId)===h})}dispose(){super.dispose(),this.presence.dispose(),this.presentingUserIdState.dispose()}initializingFirstTime(){return n(this,void 0,void 0,function*(){const h=t.LiveState.factory.createChildInstance(this.context),g=i.LivePresence.factory.createChildInstance(this.context);try{const[_,S]=yield Promise.all([h,g]);this.root.set(b,_.handle),this.root.set(C,S.handle)}catch(_){console.log(_)}})}hasInitialized(){return n(this,void 0,void 0,function*(){const h=this.root.get(b),g=this.root.get(C),[_,S]=yield Promise.all([h?.get(),g?.get()]);_?.__dangerouslySetLiveRuntime(this.liveRuntime),S?.__dangerouslySetLiveRuntime(this.liveRuntime),this._presentingUserIdState=_,this._presence=S})}handlePotentialStateChange(h,g){const _=this.state;JSON.stringify(_)!==JSON.stringify(this._recentState)&&(this._recentState=_,this.emit("stateChanged",_,h,g))}};v.TypeName="@microsoft/live-share:LiveFollowMode",v.factory=new r.DataObjectFactory(v.TypeName,v,[],{},new Map([t.LiveState.factory.registryEntry,i.LivePresence.factory.registryEntry])),e.LiveFollowMode=v,d.DynamicObjectRegistry.registerObjectClass(v,v.TypeName)})(p1)),p1}var lg={},y1={},vte;function Nce(){if(vte)return y1;vte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(y1,"__esModule",{value:!0}),y1.LocalTimestampProvider=void 0;let e=class $P{constructor(a=!1){this._lastTimeSent=0,a&&($P._warned=!0)}getTimestamp(){return $P._warned||(console.warn("LiveEvent is using a LocalTimestampProvider which could cause issues when used across multiple clients."),$P._warned=!0),this._lastTimeSent=Math.max(new Date().getTime(),this._lastTimeSent+1)}getMaxTimestampError(){return 0}};return e._warned=!1,y1.LocalTimestampProvider=e,y1}var fg={},Ste;function Ace(){if(Ste)return fg;Ste=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=fg&&fg.__awaiter||function(t,i,r,s){function o(u){return u instanceof r?u:new r(function(c){c(u)})}return new(r||(r=Promise))(function(u,c){function d(b){try{f(s.next(b))}catch(C){c(C)}}function l(b){try{f(s.throw(b))}catch(C){c(C)}}function f(b){b.done?u(b.value):o(b.value).then(d,l)}f((s=s.apply(t,i||[])).next())})};Object.defineProperty(fg,"__esModule",{value:!0}),fg.TestLiveShareHost=void 0;const n=Go();let a=class Yy{static create(i,r){return new Yy(i,r)}constructor(i,r){this._getLocalTestContainerId=i,this._setLocalTestContainerId=r,this.roleCache=new Map,this.defaultRemoteRoles=[n.UserMeetingRole.organizer,n.UserMeetingRole.presenter,n.UserMeetingRole.attendee],this.defaultLocalRoles=[n.UserMeetingRole.organizer,n.UserMeetingRole.presenter,n.UserMeetingRole.attendee]}getFluidTenantInfo(){return Yy.ensureWarned(),Promise.resolve({tenantId:"local",serviceEndpoint:"http://localhost:7070"})}getFluidToken(i){return Promise.resolve(Yy.LOCAL_MODE_TEST_TOKEN)}getFluidContainerId(){const i=this.getLocalTestContainerId();return Promise.resolve({containerState:i?n.ContainerState.alreadyExists:n.ContainerState.notFound,shouldCreate:!i,containerId:i,retryAfter:0})}setFluidContainerId(i){return this.setLocalTestContainerId(i),Promise.resolve({containerState:n.ContainerState.added,containerId:i,shouldCreate:!1,retryAfter:0})}getNtpTime(){const i=new Date;return Promise.resolve({ntpTime:i.toUTCString(),ntpTimeInUTC:i.getTime()})}registerClientId(i){if(this.roleCache.has(i))throw new Error("Already registered clientId");return this.addClient(i,this.defaultLocalRoles),Promise.resolve(this.defaultLocalRoles)}addClient(i,r){return this.roleCache.set(i,r),this}getClientInfo(i){return e(this,void 0,void 0,function*(){const r={userId:i,roles:yield this.getClientRoles(i),displayName:i.substring(0,4)};return Promise.resolve(r)})}getClientRoles(i){return e(this,void 0,void 0,function*(){if(!i)throw new Error("TestLiveShareHost: called getClientRoles() without a clientId");let r;return this.roleCache.has(i)?r=this.roleCache.get(i):r=this.defaultRemoteRoles,Promise.resolve(r)})}getLocalTestContainerId(){return this._getLocalTestContainerId?this._getLocalTestContainerId():window.location.hash?window.location.hash.substring(1):void 0}setLocalTestContainerId(i){this._setLocalTestContainerId?this._setLocalTestContainerId(i):window.location.hash=i}static ensureWarned(){Yy._warned||(console.warn("TestLiveShareHost is being used. This should only be used for local testing purposes."),Yy._warned=!0)}};return a.LOCAL_MODE_TEST_TOKEN="test-token",a._warned=!1,fg.TestLiveShareHost=a,fg}var hg={},Cte;function Dce(){if(Cte)return hg;Cte=1;var e=hg&&hg.__awaiter||function(r,s,o,u){function c(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function f(v){try{C(u.next(v))}catch(m){l(m)}}function b(v){try{C(u.throw(v))}catch(m){l(m)}}function C(v){v.done?d(v.value):c(v.value).then(f,b)}C((u=u.apply(r,s||[])).next())})};Object.defineProperty(hg,"__esModule",{value:!0}),hg.LiveShareRuntime=void 0;const n=ry,a=_ce(),t=Bs();let i=class{constructor(s,o,u=!0){var c,d,l;this._started=!1,this._objectManager=null,this._host=u?new t.BackwardsCompatibilityHostDecorator(new t.LiveShareHostDecorator(new t.FormatFixHostDecorator(s))):s,this._timestampProvider=(c=o?.timestampProvider)!==null&&c!==void 0?c:new a.HostTimestampProvider(this._host),this._roleVerifier=(d=o?.roleVerifier)!==null&&d!==void 0?d:new t.RoleVerifier(this._host),this._canSendBackgroundUpdates=(l=o?.canSendBackgroundUpdates)!==null&&l!==void 0?l:!0}get objectManager(){return(0,n.assert)(this._objectManager!==null,"LiveObjectSynchronizerManager not initialized."),this._objectManager}get timestampProvider(){return this._timestampProvider}get host(){return this._host}get canSendBackgroundUpdates(){return this._canSendBackgroundUpdates}set canSendBackgroundUpdates(s){this._canSendBackgroundUpdates=s}getTimestamp(){return this._timestampProvider.getTimestamp()}verifyRolesAllowed(s,o){return this._roleVerifier.verifyRolesAllowed(s,o)}getClientInfo(s){return this._host.getClientInfo(s)}setTimestampProvider(s){this._timestampProvider=s}setRoleVerifier(s){this._roleVerifier=s}setHost(s,o=!0){this._host=o?new t.BackwardsCompatibilityHostDecorator(new t.LiveShareHostDecorator(s)):s,this._timestampProvider instanceof a.HostTimestampProvider&&(this._timestampProvider.stop(),this.setTimestampProvider(new a.HostTimestampProvider(this._host))),this._roleVerifier instanceof t.RoleVerifier&&this.setRoleVerifier(new t.RoleVerifier(this._host))}setAudience(s){var o;this._audience=s,(o=this._objectManager)===null||o===void 0||o.setAudience(this._audience)}start(){return e(this,void 0,void 0,function*(){if(this._started)throw new Error("LiveShareRuntime.start(): cannot call start when already started");this._started=!0,this._objectManager&&this.startObjectSynchronizerManager(),(0,t.isTimestampProvider)(this._timestampProvider)&&!this._timestampProvider.isRunning&&(yield this._timestampProvider.start())})}stop(){var s;if(!this._started)throw new Error("LiveShareRuntime.stop(): cannot call stop when not already started");this._started=!1,(0,t.isTimestampProvider)(this._timestampProvider)&&this._timestampProvider.isRunning&&this._timestampProvider.stop(),(s=this._objectManager)===null||s===void 0||s.stop()}__dangerouslySetContainerRuntime(s){if(this._containerRuntime!==s){if(this._containerRuntime=s,this._objectManager){this._objectManager.__dangerouslySetContainerRuntime(s);return}this._objectManager=new t.LiveObjectManager(this,this._containerRuntime),this.startObjectSynchronizerManager()}}startObjectSynchronizerManager(){this.objectManager.start()}};return hg.LiveShareRuntime=i,hg}var Lo={},_te;function kce(){if(_te)return Lo;_te=1;var e=Lo&&Lo.__setFunctionName||function(s,o,u){return typeof o=="symbol"&&(o=o.description?"[".concat(o.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:u?"".concat(u," ",o):o})};Object.defineProperty(Lo,"__esModule",{value:!0}),Lo.getLiveDataObjectClass=Lo.getLiveContainerSchemaProxy=Lo.getLiveContainerSchema=void 0;function n(s,o){var u;const c=new Map,d=Object.entries(s.initialObjects).map(([f,b])=>[f,t(b,o,c)]);return{initialObjects:Object.fromEntries(d),dynamicObjectTypes:(u=s.dynamicObjectTypes)===null||u===void 0?void 0:u.map(f=>t(f,o,c))}}Lo.getLiveContainerSchema=n;function a(s,o){return n(s,o)}Lo.getLiveContainerSchemaProxy=a;function t(s,o,u=new Map){if(i(s)){const c=s.TypeName,d=u.get(c);if(d!==void 0)return d;const l=r(s,o);return u.set(c,l),l}return s}Lo.getLiveDataObjectClass=t;function i(s){return s.LiveEnabled===!0}function r(s,o){var u;class c extends s{constructor(f){if(super(f),this.__dangerouslySetLiveRuntime(o),!this.context||!this.context.containerRuntime)throw Error("getLiveDataObjectProxyClassInternal: required dependencies unknown");this.context.clientDetails.capabilities.interactive!==!1&&o.__dangerouslySetContainerRuntime(this.context.containerRuntime)}}return u=class extends s{},e(u,"DynamicClass"),u.TypeName=s.TypeName,u.factory=new Proxy(s.factory,{get:function(l,f,b){return f==="ctor"?c:Reflect.get(l,f,b)}}),u}return Lo}var Tte;function Zwe(){if(Tte)return lg;Tte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=lg&&lg.__awaiter||function(l,f,b,C){function v(m){return m instanceof b?m:new b(function(h){h(m)})}return new(b||(b=Promise))(function(m,h){function g(p){try{S(C.next(p))}catch(w){h(w)}}function _(p){try{S(C.throw(p))}catch(w){h(w)}}function S(p){p.done?m(p.value):v(p.value).then(g,_)}S((C=C.apply(l,f||[])).next())})};Object.defineProperty(lg,"__esModule",{value:!0}),lg.LiveShareClient=void 0;const n=Bs(),a=uce(),t=Go(),i=Nce(),r=Ace(),s=Dce(),o=kce(),u=new Map().set("https://alfred.westus2.fluidrelay.azure.com","https://us.fluidrelay.azure.com").set("https://alfred.westeurope.fluidrelay.azure.com","https://eu.fluidrelay.azure.com").set("https://alfred.southeastasia.fluidrelay.azure.com","https://global.fluidrelay.azure.com");let c=class{constructor(f,b){if(this._host=r.TestLiveShareHost.create(void 0,void 0),this.maxContainerLookupTries=3,!f)throw new Error(`LiveShareClient: prop \`host\` is \`${f}\` when it is expected to be a non-optional value of type \`ILiveShareHost\`. Please ensure \`host\` is defined before initializing \`LiveShareClient\`.`);if(typeof f.getFluidTenantInfo!="function")throw new Error(`LiveShareClient: \`host.getFluidTenantInfo\` is of type \`${typeof f.getFluidTenantInfo}\` when it is expected to be a type of \`function\`. For more information, review the \`ILiveShareHost\` interface.`);this._host=f,this._options=Object.assign(Object.assign({},b),{timestampProvider:d(f,b)?new i.LocalTimestampProvider:b?.timestampProvider}),this._runtime=new s.LiveShareRuntime(this._host,this._options,!0)}get isTesting(){return d(this._host,this._options)}get canSendBackgroundUpdates(){return this._runtime.canSendBackgroundUpdates}set canSendBackgroundUpdates(f){this._runtime.canSendBackgroundUpdates=f}joinContainer(f,b){return e(this,void 0,void 0,function*(){performance.mark("TeamsSync: join container");try{const C=this._runtime.start(),v=(0,o.getLiveContainerSchema)(f,this._runtime);let m=this._options.connection;if(!m){const S=yield this._host.getFluidTenantInfo();let p=S.serviceEndpoint;if(!p)if(u.has(S.serviceEndpoint))p=u.get(S.serviceEndpoint);else throw new Error(`LiveShareClient:joinContainer - unable to find fluid endpoint for: ${S.serviceEndpoint}`);S.tenantId=="local"?m={type:"local",endpoint:p,tokenProvider:yield(0,n.getInsecureTokenProvider)()}:m={type:"remote",tenantId:S.tenantId,endpoint:p,tokenProvider:new n.LiveShareTokenProvider(this._host)}}const h=new a.AzureClient({connection:m,logger:this._options.logger}),g=this.getOrCreateContainer(h,v,0,b),_=yield Promise.all([g,C]);return this._runtime.setAudience(_[0].services.audience),performance.mark("TeamsSync: container connecting"),this._results=Object.assign(Object.assign({},_[0]),{timestampProvider:this._runtime.timestampProvider}),this._results}finally{performance.measure("TeamsSync: container joined","TeamsSync: join container")}})}getOrCreateContainer(f,b,C,v){return e(this,void 0,void 0,function*(){const m=yield this._host.getFluidContainerId();if(m.shouldCreate)return yield this.createNewContainer(f,b,C,v);if(m.containerId)return Object.assign({created:!1},yield f.getContainer(m.containerId,b));if(C<this.maxContainerLookupTries&&m.retryAfter>0)return yield this.wait(m.retryAfter),yield this.getOrCreateContainer(f,b,C+1,v);throw new Error("LiveShareClient: timed out attempting to create or get container for current context.")})}createNewContainer(f,b,C,v){return e(this,void 0,void 0,function*(){const{container:m,services:h}=yield f.createContainer(b);v&&v(m);const g=yield m.attach(),_=yield this._host.setFluidContainerId(g);return _.containerState!=t.ContainerState.added?(m.dispose(),Object.assign({created:!1},yield f.getContainer(_.containerId,b))):{container:m,services:h,created:!0}})}wait(f){return new Promise(b=>{setTimeout(()=>b(),f)})}};lg.LiveShareClient=c;function d(l,f){var b;return((b=f?.connection)===null||b===void 0?void 0:b.type)=="local"||l instanceof r.TestLiveShareHost}return lg}var b1={},wte;function eOe(){return wte||(wte=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=b1&&b1.__awaiter||function(l,f,b,C){function v(m){return m instanceof b?m:new b(function(h){h(m)})}return new(b||(b=Promise))(function(m,h){function g(p){try{S(C.next(p))}catch(w){h(w)}}function _(p){try{S(C.throw(p))}catch(w){h(w)}}function S(p){p.done?m(p.value):v(p.value).then(g,_)}S((C=C.apply(l,f||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.LiveTimer=e.LiveTimerEvents=void 0;const a=$o(),t=_I(),i=Go(),r=Sb(),s=bb(),o=vb(),u=iy();var c;(function(l){l.started="started",l.played="played",l.paused="paused",l.finished="finished",l.onTick="onTick"})(c=e.LiveTimerEvents||(e.LiveTimerEvents={}));let d=class extends o.LiveDataObject{constructor(){super(...arguments),this._currentConfig={clientId:"",timestamp:0,data:{duration:0,position:0,running:!1}},this._defaultTickRate=20,this._tickRate=this._defaultTickRate}get tickRate(){return this._tickRate}set tickRate(f){this._tickRate=f}initialize(f){return n(this,void 0,void 0,function*(){u.LiveDataObjectInitializeNotNeededError.assert("LiveTimer:initialize",this.initializeState),u.UnexpectedError.assert(!this._synchronizer,"LiveTimer:initialize","_synchronizer already set, which implies there was an error during initialization that should not occur."),this.initializeState=i.LiveDataObjectInitializeState.pending,this._allowedRoles=f||[],this._synchronizer=new t.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime);try{yield this._synchronizer.start(this._currentConfig.data,(b,C)=>n(this,void 0,void 0,function*(){return yield this.remoteConfigReceived(b,C)}),b=>n(this,void 0,void 0,function*(){if(b)return!0;try{return yield this.verifyLocalUserRoles()}catch{return!1}}))}catch(b){throw this.initializeState=i.LiveDataObjectInitializeState.fatalError,b}this.initializeState=i.LiveDataObjectInitializeState.succeeded})}dispose(){super.dispose(),this._synchronizer&&this._synchronizer.dispose()}start(f){return n(this,void 0,void 0,function*(){u.LiveDataObjectNotInitializedError.assert("LiveTimer:start","start",this.initializeState),yield this.playInternal(f,0)})}play(){return n(this,void 0,void 0,function*(){u.LiveDataObjectNotInitializedError.assert("LiveTimer:play","play",this.initializeState),!this._currentConfig.data.running&&this._currentConfig.data.position<this._currentConfig.data.duration&&(yield this.playInternal(this._currentConfig.data.duration,this._currentConfig.data.position))})}playInternal(f,b){return n(this,void 0,void 0,function*(){const C={timestamp:this.liveRuntime.getTimestamp(),clientId:yield this.waitUntilConnected(),data:{duration:f,position:b,running:!0}};yield this.updateConfig(C,!0)})}pause(){return n(this,void 0,void 0,function*(){if(u.LiveDataObjectNotInitializedError.assert("LiveTimer:pause","pause",this.initializeState),this._currentConfig.data.running){const f=this.liveRuntime.getTimestamp(),b={timestamp:f,clientId:yield this.waitUntilConnected(),data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.position+(f-this._currentConfig.timestamp),running:!1}};yield this.updateConfig(b,!0)}})}remoteConfigReceived(f,b){return n(this,void 0,void 0,function*(){try{const C=yield this.liveRuntime.verifyRolesAllowed(b,this._allowedRoles),v={timestamp:this._currentConfig.timestamp,clientId:this._currentConfig.clientId},m=r.LiveEvent.isNewer(v,f),h=this.liveRuntime.getTimestamp(),g=this.endTimeFromConfig(f);if(C&&this._currentConfig.timestamp===0&&f.data.running===!0&&h>=g){const _={timestamp:g,clientId:f.clientId,data:{duration:f.data.duration,position:f.data.duration,running:!1}};return this.updateConfig(_,!1),!0}return JSON.stringify(this._currentConfig.data)===JSON.stringify(f.data)&&this._currentConfig.timestamp===f.timestamp?!1:C&&m?(this.updateConfig(f,!1),!0):!1}catch{return!1}})}updateConfig(f,b){return n(this,void 0,void 0,function*(){const C=Object.assign({clientId:f.clientId,configChangedAt:f.timestamp},f.data);if(this._currentConfig=f,f.data.position===0?this.emit(c.started,C,b):f.data.duration===f.data.position?this.emit(c.finished,C):f.data.running?this.emit(c.played,C,b):this.emit(c.paused,C,b),f.data.running&&this.startTicking(),b)return yield this._synchronizer.sendEvent(f.data)})}startTicking(){const f=()=>{if(this._currentConfig.data.running){const b=this.liveRuntime.getTimestamp(),C=this.endTimeFromConfig(this._currentConfig);if(b>=C){const v={timestamp:C,clientId:this._currentConfig.clientId,data:{duration:this._currentConfig.data.duration,position:this._currentConfig.data.duration,running:!1}};this.updateConfig(v,!1).catch(m=>{console.error(m)})}else this.emit(c.onTick,C-b),this.scheduleAnimationFrame(f)}};this.scheduleAnimationFrame(f)}scheduleAnimationFrame(f){this._tickRate<=this._defaultTickRate&&typeof requestAnimationFrame=="function"?requestAnimationFrame(f):setTimeout(f,this._tickRate)}endTimeFromConfig(f){return f.timestamp-f.data.position+f.data.duration}};d.TypeName="@microsoft/live-share:LiveTimer",d.factory=new a.DataObjectFactory(d.TypeName,d,[],{}),e.LiveTimer=d,s.DynamicObjectRegistry.registerObjectClass(d,d.TypeName)})(b1)),b1}var mg={},Ote;function tOe(){if(Ote)return mg;Ote=1;var e=mg&&mg.__awaiter||function(i,r,s,o){function u(c){return c instanceof s?c:new s(function(d){d(c)})}return new(s||(s=Promise))(function(c,d){function l(C){try{b(o.next(C))}catch(v){d(v)}}function f(C){try{b(o.throw(C))}catch(v){d(v)}}function b(C){C.done?c(C.value):u(C.value).then(l,f)}b((o=o.apply(i,r||[])).next())})};Object.defineProperty(mg,"__esModule",{value:!0}),mg.AzureLiveShareHost=void 0;const n=Go(),a=Bs();let t=class xce{constructor(r){this._shouldWarnLocalTimestamp=r,this._azureAudienceDeferred=new a.Deferred,this.hasWarned=!1}static create(r=!0){return new xce(r)}setAudience(r){this._azureAudienceDeferred.resolve(r)}registerClientId(r){var s;return e(this,void 0,void 0,function*(){const o=yield this.getClientInfo(r);return(s=o?.roles)!==null&&s!==void 0?s:[]})}getClientInfo(r){return e(this,void 0,void 0,function*(){const s=yield this.getAudienceMemberInfo(r);if(!s)throw new Error("AzureLiveShareHost.getClientInfo: audience member not found");return{userId:s.userId,roles:this.getRolesForAudienceMember(s),displayName:s.userName}})}getNtpTime(){return e(this,void 0,void 0,function*(){!this.hasWarned&&this._shouldWarnLocalTimestamp&&(console.warn(`AzureLiveShareHost is using a local timestamp, which could cause issues when use some LiveDataObject data structures across multiple clients.

                To disable this warning, set _shouldWarn in AzureLiveShareHost.create() to false.

                To resolve synchronization issues you may encounter, you should implement a service API to get this timestamp value and override this function.`),this.hasWarned=!0);const r=new Date;return Promise.resolve({ntpTime:r.toUTCString(),ntpTimeInUTC:r.getTime()})})}getClientRoles(r){return e(this,void 0,void 0,function*(){const s=yield this.getClientInfo(r);return s?.roles})}getFluidTenantInfo(){return e(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidTenantInfo: not implemented exception")})}getFluidToken(r){return e(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidToken: not implemented exception")})}getFluidContainerId(){return e(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.getFluidContainerId: not implemented exception")})}setFluidContainerId(r){return e(this,void 0,void 0,function*(){throw new Error("AzureLiveShareHost.setFluidContainerId: not implemented exception")})}getAudienceMemberInfo(r){return e(this,void 0,void 0,function*(){const o=[...(yield this._azureAudienceDeferred.promise).getMembers().values()];for(let u=0;u<o.length;u++){const c=o[u];if(c.connections.find(d=>d.id===r))return c}})}getRolesForAudienceMember(r){return r.connections.length===0?[]:r.connections[r.connections.length-1].mode==="write"?[n.UserMeetingRole.presenter]:[n.UserMeetingRole.attendee]}};return mg.AzureLiveShareHost=t,mg}var Pte;function Wo(){return Pte||(Pte=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var n=qp&&qp.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=qp&&qp.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(bb(),e),a(_ce(),e),a(Go(),e),a(Sb(),e),a(Ece(),e),a(Ice(),e),a(Rce(),e),a(Qwe(),e),a(jce(),e),a(CI(),e),a(Xwe(),e),a(Zwe(),e),a(Mce(),e),a(TI(),e),a(eOe(),e),a(Nce(),e),a(Ace(),e),a(uL(),e),a(Cce(),e),a(kce(),e),a(vb(),e),a(Dce(),e),a(tOe(),e),a(_I(),e),a(iy(),e)})(qp)),qp}var pg={},gg={},v1={},yg={},bg={};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ms(e,n){if(!e)throw new Error(typeof n=="number"?`0x${n.toString(16).padStart(3,"0")}`:n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function nOe(e,n){switch(n){case"base64":return rT.fromByteArray(e);case"utf8":case"utf-8":case void 0:return new TextDecoder().decode(e);default:throw new Error("invalid/unsupported encoding")}}const rOe=(e,n)=>al.from(e).toString(n);function Ete(e){const n=e;return e instanceof ArrayBuffer||typeof n=="object"&&n!==null&&typeof n.byteLength=="number"&&typeof n.slice=="function"&&n.byteOffset===void 0&&n.buffer===void 0}class al extends Uint8Array{toString(n){return nOe(this,n)}static from(n,a,t){if(typeof n=="string")return al.fromString(n,a);if(n!==null&&typeof n=="object"&&Ete(n.buffer))return ms(n.byteOffset===0,0),ms(n.byteLength===n.buffer.byteLength,1),al.fromArrayBuffer(n.buffer,a,t);if(Ete(n))return al.fromArrayBuffer(n,a,t);throw new TypeError}static fromArrayBuffer(n,a,t){const i=a??0,r=t??n.byteLength-i;if(i<0||i>n.byteLength||r<0||r+i>n.byteLength)throw new RangeError;return new al(n,i,r)}static fromString(n,a){switch(a){case"base64":{const t=this.sanitizeBase64(n),i=rT.toByteArray(t);return new al(i.buffer)}case"utf8":case"utf-8":case void 0:{const t=new TextEncoder().encode(n);return new al(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(n){throw new Error("unimplemented")}static sanitizeBase64(n){let a=n;return a=a.split("=")[0],a=a.replace(/[^\w+-/]/g,""),a.length%4!==0&&(a+=["","===","==","="][a.length%4]),a}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Ite=window.performance;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class iOe extends woe.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class sOe{send(n){}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function aOe(e,n="Unreachable Case"){throw new Error(n)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class oOe{constructor(n){this.valueGenerator=n,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var jk;(function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"})(jk||(jk={}));var Rte;(function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"})(Rte||(Rte={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var qg;(function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4})(qg||(qg={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function qce(e,n){if(e==="")return n===void 0?"":n.absolutePath;{let a=e.startsWith("/")?e.slice(1):e;return a=a.endsWith("/")?a.slice(0,-1):a,n===void 0?`/${a}`:`${n.absolutePath==="/"?"":n.absolutePath}/${a}`}}const cOe=new oOe(()=>dOe(lOe())),uOe={getRawConfig:()=>{}},dOe=e=>e!=null?new DT({getRawConfig:n=>{var a,t;try{return(t=Lce((a=e.getItem(n))!==null&&a!==void 0?a:void 0))===null||t===void 0?void 0:t.raw}catch{}}}):uOe;function Fte(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function Lce(e){let n=e,a;if(typeof e=="string")try{n=JSON.parse(e),a={raw:e,string:e}}catch{}if(n===void 0)return a;const t=typeof n;if(Fte(t))return Object.assign(Object.assign({},a),{raw:e,[t]:n});if(Array.isArray(n)){const i=typeof n[0];if(!Fte(i))return a;for(const r of n)if(typeof r!==i)return a;return Object.assign(Object.assign({},a),{raw:e,[`${i}[]`]:n})}return a}const lOe=()=>{try{return sessionStorage!==null?sessionStorage:void 0}catch{return}};class DT{constructor(...n){this.configCache=new Map,this.orderedBaseProviders=[];const a=new Set,t=[...n];for(;t.length>0;){const i=t.shift();i!==void 0&&Uce(i)&&!a.has(i)&&(a.add(i),i instanceof DT?t.push(...i.orderedBaseProviders):this.orderedBaseProviders.push(i))}}getBoolean(n){var a;return(a=this.getCacheEntry(n))===null||a===void 0?void 0:a.boolean}getNumber(n){var a;return(a=this.getCacheEntry(n))===null||a===void 0?void 0:a.number}getString(n){var a;return(a=this.getCacheEntry(n))===null||a===void 0?void 0:a.string}getBooleanArray(n){var a;return(a=this.getCacheEntry(n))===null||a===void 0?void 0:a["boolean[]"]}getNumberArray(n){var a;return(a=this.getCacheEntry(n))===null||a===void 0?void 0:a["number[]"]}getStringArray(n){var a;return(a=this.getCacheEntry(n))===null||a===void 0?void 0:a["string[]"]}getRawConfig(n){var a;return(a=this.getCacheEntry(n))===null||a===void 0?void 0:a.raw}getCacheEntry(n){if(!this.configCache.has(n)){for(const a of this.orderedBaseProviders){const t=Lce(a?.getRawConfig(n));if(t!==void 0)return this.configCache.set(n,t),t}this.configCache.set(n,{raw:void 0})}return this.configCache.get(n)}}function dL(e){const n=e;return Uce(n?.config)&&n?.logger!==void 0}function fOe(e){return dL(e)?e:Bce(e,cOe.value)}function Bce(e,...n){if(dL(e))throw new Error("Logger is already a monitoring context");const a=e;return a.config=new DT(...n),a.logger=e,a}function Uce(e){const n=e;return typeof n?.getRawConfig=="function"}var kP,hOe=new Uint8Array(16);function mOe(){if(!kP&&(kP=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!kP))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return kP(hOe)}const pOe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function gOe(e){return typeof e=="string"&&pOe.test(e)}var ns=[];for(var JD=0;JD<256;++JD)ns.push((JD+256).toString(16).substr(1));function yOe(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=(ns[e[n+0]]+ns[e[n+1]]+ns[e[n+2]]+ns[e[n+3]]+"-"+ns[e[n+4]]+ns[e[n+5]]+"-"+ns[e[n+6]]+ns[e[n+7]]+"-"+ns[e[n+8]]+ns[e[n+9]]+"-"+ns[e[n+10]]+ns[e[n+11]]+ns[e[n+12]]+ns[e[n+13]]+ns[e[n+14]]+ns[e[n+15]]).toLowerCase();if(!gOe(a))throw TypeError("Stringified UUID is invalid");return a}function zce(e,n,a){e=e||{};var t=e.random||(e.rng||mOe)();return t[6]=t[6]&15|64,t[8]=t[8]&63|128,yOe(t)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const bOe=e=>e!==null&&!Array.isArray(e)&&typeof e=="object";function vOe(e,n){const a=(r,s)=>{const o=r.split(`
`);return o.shift(),s!==void 0&&o.unshift(s),o.join(`
`)},i={message:typeof e?.message=="string"?e.message:String(e)};if(bOe(e)){const{errorType:r,stack:s,name:o}=e;if(typeof r=="string"&&(i.errorType=r),typeof s=="string"){const u=typeof o=="string"?o:void 0;i.stack=a(s,u)}}return i}const SOe=e=>typeof e?.getTelemetryProperties=="function";function COe(e,n){for(const a of Object.keys(n))e[a]===void 0&&(e[a]=n[a])}let QD;function wI(){const e=new Error("<<generated stack>>");if(QD===void 0&&(QD=e.stack!==void 0),QD)return e;try{throw e}catch(n){return n}}function _Oe(){return wI().stack}function TOe(e,n){try{Object.assign(e,{stack:n})}catch{e.addTelemetryProperties({stack2:n})}}function wOe(e){return typeof e?.value!="object"&&typeof e?.tag=="string"}function OOe(e,n){const a={};for(const t of Object.keys(e)){if(n.has(t))continue;const i=e[t];switch(typeof i){case"string":case"number":case"boolean":case"undefined":a[t]=i;break;default:{wOe(i)?a[t]=i:a[t]="REDACTED (arbitrary object)";break}}}return a}let POe=class extends Error{constructor(n,a,t=new Set){super(n),this.omitPropsFromLogging=t,this._errorInstanceId=zce(),this.fluidErrorCode="-",t.add("omitPropsFromLogging"),t.add("_errorInstanceId"),a&&this.addTelemetryProperties(a)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(n){this._errorInstanceId=n}addTelemetryProperties(n){COe(this,n)}getTelemetryProperties(){const n=OOe(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},n),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}},EOe=class Vce extends POe{constructor(n){super(n.message),this.errorType=Vce.normalizedErrorType,n.stack!==void 0&&TOe(this,n.stack)}};EOe.normalizedErrorType="genericError";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Mk;(function(e){e.PackageData="PackageData",e.CodeArtifact="CodeArtifact",e.UserData="UserData"})(Mk||(Mk={}));class Bg{constructor(n,a){this.namespace=n,this.properties=a}static formatTick(n){return Math.floor(n)}static numberFromString(n){if(n==null)return;const a=Number(n);return Number.isNaN(a)?n:a}static sanitizePkgName(n){return n.replace("@","").replace("/","-")}static prepareErrorObject(n,a,t){const{message:i,errorType:r,stack:s}=vOe(a);if(n.stack=s,n.error=i,n.errorType=r,SOe(a)){const o=a.getTelemetryProperties();for(const u of Object.keys(o))n[u]===void 0&&(n[u]=o[u])}n.stack===void 0&&t&&(n.stack=_Oe())}sendTelemetryEvent(n,a){var t;this.sendTelemetryEventCore(Object.assign(Object.assign({},n),{category:(t=n.category)!==null&&t!==void 0?t:"generic"}),a)}sendTelemetryEventCore(n,a){const t=Object.assign({},n);a!==void 0&&Bg.prepareErrorObject(t,a,!1),typeof t.duration=="number"&&(t.duration=Bg.formatTick(t.duration)),this.send(t)}sendErrorEvent(n,a){this.sendTelemetryEventCore(Object.assign(Object.assign({error:n.eventName},n),{category:"error"}),a)}sendPerformanceEvent(n,a){var t;const i=Object.assign(Object.assign({},n),{category:(t=n.category)!==null&&t!==void 0?t:"performance"});this.sendTelemetryEventCore(i,a)}prepareEvent(n){const a=n.category==="error"||n.error!==void 0,t=Object.assign({},n);if(this.namespace!==void 0&&(t.eventName=`${this.namespace}${Bg.eventNamespaceSeparator}${t.eventName}`),this.properties){const i=[];i.push(this.properties.all),a&&i.push(this.properties.error);for(const r of i)if(r!==void 0)for(const s of Object.keys(r)){if(n[s]!==void 0)continue;const o=r[s],u=typeof o=="function"?o():o;u!==void 0&&(t[s]=u)}}return t}}Bg.eventNamespaceSeparator=":";class W1 extends Bg{constructor(n,a,t){super(a,t),this.baseLogger=n,dL(n)&&Bce(this,new DT(n.config))}static create(n,a,t){if(n instanceof W1){const i={};for(const s of[n.properties,t])s!==void 0&&(s.all!==void 0&&(i.all=Object.assign(Object.assign({},i.all),s.all)),s.error!==void 0&&(i.error=Object.assign(Object.assign({},i.error),s.error)));const r=n.namespace===void 0?a:a===void 0?n.namespace:`${n.namespace}${Bg.eventNamespaceSeparator}${a}`;return new W1(n.baseLogger,r,i)}return new W1(n||new sOe,a,t)}send(n){this.baseLogger.send(this.prepareEvent(n))}}class IOe extends iOe{constructor(n){super(),this.errorHandler=n}emit(n,...a){try{return super.emit(n,...a)}catch(t){return this.errorHandler(n,t),!0}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class jte{constructor(n,a,t,i=!1,r=new Map){this.eventBase=n,this.logger=a,this.sampleThreshold=t,this.includeAggregateMetrics=i,this.perBucketProperties=r,this.disposed=!1,this.measurementsMap=new Map}measure(n,a=""){var t,i,r;const s=Ite.now(),o=n(),u=Ite.now()-s;let c=this.measurementsMap.get(a);return c===void 0&&(c={count:0,duration:-1},this.measurementsMap.set(a,c)),c.count++,c.duration=u,this.includeAggregateMetrics&&(c.totalDuration=((t=c.totalDuration)!==null&&t!==void 0?t:0)+u,c.minDuration=Math.min((i=c.minDuration)!==null&&i!==void 0?i:u,u),c.maxDuration=Math.max((r=c.maxDuration)!==null&&r!==void 0?r:0,u)),c.count>=this.sampleThreshold&&this.flushBucket(a),o}flushBucket(n){const a=this.measurementsMap.get(n);if(a!==void 0&&a.count!==0){const t=this.perBucketProperties.get(n),i=Object.assign(Object.assign(Object.assign({},this.eventBase),t),a);this.logger.sendPerformanceEvent(i),this.measurementsMap.delete(n)}}dispose(n){this.measurementsMap.forEach((a,t)=>this.flushBucket(t))}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function ROe(e){if(e!==null&&typeof e=="object"&&e.errorFromRequestFluidObject===!0){const t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack}}}const a=wI();return{mimeType:"text/plain",status:500,value:`${e}`,get stack(){var t;return(t=e?.stack)!==null&&t!==void 0?t:a.stack}}}function FOe(e,n){const a=e.value,t=wI();return{errorFromRequestFluidObject:!0,message:a,name:"Error",code:e.status,get stack(){var r;return(r=e.stack)!==null&&r!==void 0?r:t.stack}}}const jOe=e=>MOe(404,"not found",e);function MOe(e,n,a){var t;ms(e!==200,411);const i=(t=a.url)===null||t===void 0?void 0:t.split("?")[0],r=wI();return{mimeType:"text/plain",status:e,value:i===void 0?n:`${n}: ${i}`,get stack(){return r.stack}}}var vg={},S1={},Mte;function NOe(){if(Mte)return S1;Mte=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(S1,"__esModule",{value:!0}),S1.IFluidDataStoreFactory=void 0,S1.IFluidDataStoreFactory="IFluidDataStoreFactory",S1}var C1={},Nte;function AOe(){if(Nte)return C1;Nte=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(C1,"__esModule",{value:!0}),C1.IFluidDataStoreRegistry=void 0,C1.IFluidDataStoreRegistry="IFluidDataStoreRegistry",C1}var YD={},Ate;function DOe(){return Ate||(Ate=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.VisibilityState=e.FlushMode=void 0,(function(n){n[n.Immediate=0]="Immediate",n[n.TurnBased=1]="TurnBased"})(e.FlushMode||(e.FlushMode={})),e.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}})(YD)),YD}var _1={},Dte;function kOe(){if(Dte)return _1;Dte=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(_1,"__esModule",{value:!0}),_1.gcBlobKey=void 0,_1.gcBlobKey="gc",_1}var XD={},kte;function xOe(){if(kte)return XD;kte=1;/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */return Object.defineProperty(XD,"__esModule",{value:!0}),XD}var ZD={},xte;function qOe(){return xte||(xte=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */Object.defineProperty(e,"__esModule",{value:!0}),e.totalBlobSizePropertyName=e.blobCountPropertyName=e.channelsTreeName=e.CreateSummarizerNodeSource=void 0,(function(n){n[n.FromSummary=0]="FromSummary",n[n.FromAttach=1]="FromAttach",n[n.Local=2]="Local"})(e.CreateSummarizerNodeSource||(e.CreateSummarizerNodeSource={})),e.channelsTreeName=".channels",e.blobCountPropertyName="BlobCount",e.totalBlobSizePropertyName="TotalBlobSize"})(ZD)),ZD}var qte;function LOe(){return qte||(qte=1,(function(e){/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var n=vg&&vg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r),Object.defineProperty(t,s,{enumerable:!0,get:function(){return i[r]}})}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=vg&&vg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(NOe(),e),a(AOe(),e),a(DOe(),e),a(kOe(),e),a(xOe(),e),a(qOe(),e)})(vg)),vg}var K1=LOe();/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function Lte(...e){const n={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const a of e)n.treeNodeCount+=a.treeNodeCount,n.blobNodeCount+=a.blobNodeCount,n.handleNodeCount+=a.handleNodeCount,n.totalBlobSize+=a.totalBlobSize,n.unreferencedBlobSize+=a.unreferencedBlobSize;return n}function BOe(e){let n=e.length;for(let a=e.length-1;a>=0;a--){const t=e.charCodeAt(a);t>127&&t<=2047?n++:t>2047&&t<=65535&&(n+=2),t>=56320&&t<=57343&&a--}return n}function UOe(e){return typeof e=="string"?BOe(e):e.byteLength}function zOe(e,n,a){const t={type:qg.Blob,content:a};e.summary.tree[n]=t,e.stats.blobNodeCount++,e.stats.totalBlobSize+=UOe(a)}class VOe{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=Lte(),this.summaryStats.treeNodeCount++}get summary(){return{type:qg.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(n,a){zOe({summary:{type:qg.Tree,tree:this.summaryTree},stats:this.summaryStats},n,a)}addHandle(n,a,t){this.summaryTree[n]={type:qg.Handle,handleType:a,handle:t},this.summaryStats.handleNodeCount++}addWithStats(n,a){this.summaryTree[n]=a.summary,this.summaryStats=Lte(this.summaryStats,a.stats)}addAttachment(n){this.summaryTree[this.attachmentCounter++]={id:n,type:qg.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var J1;(function(e){e.Detached="Detached",e.Attaching="Attaching",e.Attached="Attached"})(J1||(J1={}));var Bte;(function(e){e.NotBound="NotBound",e.Binding="Binding",e.Bound="Bound"})(Bte||(Bte={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Nk;(function(e){e.genericError="genericError",e.throttlingError="throttlingError",e.dataCorruptionError="dataCorruptionError",e.dataProcessingError="dataProcessingError",e.usageError="usageError",e.clientSessionExpiredError="clientSessionExpiredError"})(Nk||(Nk={}));var xP,HOe=new Uint8Array(16);function KOe(){if(!xP&&(xP=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!xP))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xP(HOe)}const $Oe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function GOe(e){return typeof e=="string"&&$Oe.test(e)}var rs=[];for(var ek=0;ek<256;++ek)rs.push((ek+256).toString(16).substr(1));function WOe(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=(rs[e[n+0]]+rs[e[n+1]]+rs[e[n+2]]+rs[e[n+3]]+"-"+rs[e[n+4]]+rs[e[n+5]]+"-"+rs[e[n+6]]+rs[e[n+7]]+"-"+rs[e[n+8]]+rs[e[n+9]]+"-"+rs[e[n+10]]+rs[e[n+11]]+rs[e[n+12]]+rs[e[n+13]]+rs[e[n+14]]+rs[e[n+15]]).toLowerCase();if(!GOe(a))throw TypeError("Stringified UUID is invalid");return a}function Hce(e,n,a){e=e||{};var t=e.random||(e.rng||KOe)();return t[6]=t[6]&15|64,t[8]=t[8]&63|128,WOe(t)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Kce=e=>typeof e?.getTelemetryProperties=="function"&&typeof e?.addTelemetryProperties=="function",$ce=e=>typeof e?.errorInstanceId=="string";function JOe(e){return typeof e?.errorType=="string"&&typeof e?.message=="string"&&$ce(e)&&Kce(e)}function Gce(e){return typeof e?.errorType=="string"&&typeof e?.message=="string"&&Kce(e)}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const QOe=e=>e!==null&&!Array.isArray(e)&&typeof e=="object";function Wce(e,n){const a=(r,s)=>r,i={message:typeof e?.message=="string"?e.message:String(e)};if(QOe(e)){const{errorType:r,stack:s,name:o}=e;typeof r=="string"&&(i.errorType=r),typeof s=="string"&&(i.stack=a(s))}return i}const Jce=e=>typeof e?.getTelemetryProperties=="function";function YOe(e,n){for(const a of Object.keys(n))e[a]===void 0&&(e[a]=n[a])}function XOe(e){const n=e;n.errorInstanceId===void 0&&(n.errorInstanceId=Hce())}function Qce(e,n={}){var a;if(Gce(e)&&XOe(e),JOe(e))return e.addTelemetryProperties((a=n.props)!==null&&a!==void 0?a:{}),e;const{message:t,stack:i}=Wce(e),r=new kT({message:t,stack:i});if(typeof e=="object"&&e!==null){const{canRetry:o,retryAfterSeconds:u}=e;Object.assign(Qce,{canRetry:o,retryAfterSeconds:u})}typeof e!="object"&&r.addTelemetryProperties({typeofError:typeof e});const s=Jce(e)?e.getTelemetryProperties():{};return r.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},s),n.props),{untrustedOrigin:1})),r}function ZOe(e,n){const{message:a,stack:t}=Wce(e),i=n(a);return t!==void 0&&Yce(i,t),Xce(e)&&i.addTelemetryProperties({untrustedOrigin:1}),$ce(e)&&(i.overwriteErrorInstanceId(e.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),Jce(e)&&i.addTelemetryProperties(e.getTelemetryProperties()),i}function Yce(e,n){try{Object.assign(e,{stack:n})}catch{e.addTelemetryProperties({stack2:n})}}function Xce(e){return!Gce(e)||e.getTelemetryProperties().untrustedOrigin===1&&e.errorType===kT.normalizedErrorType}function ePe(e){return typeof e?.value!="object"&&typeof e?.tag=="string"}function tPe(e,n){const a={};for(const t of Object.keys(e)){if(n.has(t))continue;const i=e[t];switch(typeof i){case"string":case"number":case"boolean":case"undefined":a[t]=i;break;default:{ePe(i)?a[t]=i:a[t]="REDACTED (arbitrary object)";break}}}return a}class Zce extends Error{constructor(n,a,t=new Set){super(n),this.omitPropsFromLogging=t,this._errorInstanceId=Hce(),this.fluidErrorCode="-",t.add("omitPropsFromLogging"),t.add("_errorInstanceId"),a&&this.addTelemetryProperties(a)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(n){this._errorInstanceId=n}addTelemetryProperties(n){YOe(this,n)}getTelemetryProperties(){const n=tPe(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},n),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class kT extends Zce{constructor(n){super(n.message),this.errorType=kT.normalizedErrorType,n.stack!==void 0&&Yce(this,n.stack)}}kT.normalizedErrorType="genericError";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class tE extends Zce{constructor(n){super(n),this.errorType=Nk.dataProcessingError,this.canRetry=!1}static create(n,a,t,i={}){const r=tE.wrapIfUnrecognized(n,a,t);return r.addTelemetryProperties(i),r}static wrapIfUnrecognized(n,a,t){const i=Object.assign({dataProcessingError:1,dataProcessingCodepath:a},t===void 0?void 0:nPe(t)),r=Qce(n,{props:i});if(!Xce(r))return r;const s=ZOe(r,o=>new tE(o));return s.addTelemetryProperties(r.getTelemetryProperties()),s}}const nPe=e=>({messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp});/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class rPe{constructor(n,a,t){this.value=n,this.path=a,this.routeContext=t,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=qce(a,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach(n=>{n.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(n){if(this.visible){n.attachGraph();return}this.pendingHandlesToMakeVisible.add(n)}}var Ute;(function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias"})(Ute||(Ute={}));var Ak;(function(e){e.wait="wait",e.externalRequest="externalRequest",e.viaHandle="viaHandle"})(Ak||(Ak={}));K1.FlushMode.TurnBased;var zte;(function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"})(zte||(zte={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class iPe{constructor(n,a){this.absolutePath=n,this.routeContext=a,this.isAttached=!0,ms(n.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(this.objectP===void 0){const n={url:this.absolutePath,headers:{[Ak.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(n).then(a=>{if(a.mimeType==="fluid/object")return a.value;throw FOe(a)})}return this.objectP}attachGraph(){}bind(n){n.attachGraph()}async request(n){try{const t=(await this.get()).IFluidRouter;return t!==void 0?t.request(n):jOe(n)}catch(a){return ROe(a)}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const sPe=e=>e?.type==="__fluid_handle__";class eue{constructor(n,a){for(this.context=n,this.handleParsedCb=a,this.encodeValue=(t,i)=>{const r=t?.IFluidHandle;return r!==void 0?this.serializeHandle(r,i):t},this.decodeValue=t=>{if(sPe(t)){const i=t.url.startsWith("/")?t.url:qce(t.url,this.context),r=new iPe(i,this.root);return this.handleParsedCb(r),r}else return t},this.root=this.context;this.root.routeContext!==void 0;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(n,a){return n&&typeof n=="object"?this.recursivelyReplace(n,this.encodeValue,a):n}decode(n){return n&&typeof n=="object"?this.recursivelyReplace(n,this.decodeValue):n}stringify(n,a){return JSON.stringify(n,(t,i)=>this.encodeValue(i,a))}parse(n){return JSON.parse(n,(a,t)=>this.decodeValue(t))}recursivelyReplace(n,a,t){const i=a(n,t);if(i!==n)return i;let r;for(const s of Object.keys(n)){const o=n[s];if(o&&typeof o=="object"){const u=this.recursivelyReplace(o,a,t);u!==o&&(r=r??(Array.isArray(n)?[...n]:Object.assign({},n)),r[s]=u)}}return r??n}serializeHandle(n,a){return a.bind(n),{type:"__fluid_handle__",url:n.absolutePath}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class aPe extends rPe{get isAttached(){return this.value.isAttached()}constructor(n,a,t){super(n,a,t)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class oPe extends eue{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(n,a){return this.serializedRoutes.add(n.absolutePath),super.serializeHandle(n,a)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class cPe extends IOe{constructor(n,a,t){super((i,r)=>this.eventListenerErrorHandler(i,r)),this.id=n,this.runtime=a,this.attributes=t,this._connected=!1,this._isBoundToContext=!1,ms(!n.includes("/"),772),this.handle=new aPe(this,n,a.IFluidHandleContext),this.logger=W1.create(a.logger,void 0,{all:{sharedObjectId:zce(),ddsType:{value:this.attributes.type,tag:Mk.CodeArtifact}}}),this.mc=fOe(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var n,a;ms(this.mc!==void 0&&this.logger!==void 0,"this.mc and/or this.logger has not been set");const t=new jte({eventName:"ddsOpProcessing",category:"performance"},this.logger,(n=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))!==null&&n!==void 0?n:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new jte({eventName:"ddsEventCallbacks",category:"performance"},this.logger,(a=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))!==null&&a!==void 0?a:100,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),[t,i]}closeWithError(n){this.closeError===void 0&&(this.closeError=n)}verifyNotClosed(){if(this.closeError!==void 0)throw this.closeError}eventListenerErrorHandler(n,a){const t=tE.wrapIfUnrecognized(a,"SharedObjectEventListenerException");throw t.addTelemetryProperties({emittedEventName:String(n)}),this.closeWithError(t),t}attachListeners(){this.isAttached()||this.runtime.once("attaching",()=>{this.didAttach()})}async load(n){this.runtime.attachState!==J1.Detached&&(this.services=n),await this.loadCore(n.objectStorage),this.runtime.attachState!==J1.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(n){this.services=n,this.attachDeltaHandler()}isAttached(){return this.services!==void 0&&this.runtime.attachState!==J1.Detached}handleDecoded(n){var a,t,i;this.isAttached()&&((i=(a=this.services)===null||a===void 0?void 0:(t=a.deltaConnection).addedGCOutboundReference)===null||i===void 0||i.call(t,this.handle,n))}initializeLocalCore(){}didAttach(){}submitLocalMessage(n,a=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(n,a)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(n,a){this.submitLocalMessage(n,a)}async newAckBasedPromise(n){let a;return new Promise((t,i)=>{if(a=()=>i(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed){a();return}this.runtime.on("dispose",a),n(t,i)}).finally(()=>{this.runtime.off("dispose",a)})}attachDeltaHandler(){ms(this.services!==void 0,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(n,a,t)=>{this.process(n,a,t)},setConnectionState:n=>{this.setConnectionState(n)},reSubmit:(n,a)=>{this.reSubmit(n,a)},applyStashedOp:n=>this.applyStashedOp(n),rollback:(n,a)=>{this.rollback(n,a)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(n){this._connected!==n&&(this._connected=n,n?this.onConnect():this.onDisconnect())}process(n,a,t){this.verifyNotClosed(),this.emitInternal("pre-op",n,a,this),this.opProcessingHelper.measure(()=>{this.processCore(n,a,t)},a?"local":"remote"),this.emitInternal("op",n,a,this)}reSubmit(n,a){this.reSubmitCore(n,a)}rollback(n,a){throw new Error("rollback not supported")}emit(n,...a){return this.callbacksHelper.measure(()=>super.emit(n,...a))}emitInternal(n,...a){return super.emit(n,...a)}}class uPe extends cPe{constructor(n,a,t,i){super(n,a,t),this.telemetryContextPrefix=i,this._isGCing=!1,this._serializer=new eue(this.runtime.channelsRoutingContext,r=>this.handleDecoded(r))}get serializer(){return ms(!this._isGCing,117),this._serializer}getAttachSummary(n=!1,a=!1,t){const i=this.summarizeCore(this.serializer,t);return this.incrementTelemetryMetric(K1.blobCountPropertyName,i.stats.blobNodeCount,t),this.incrementTelemetryMetric(K1.totalBlobSizePropertyName,i.stats.totalBlobSize,t),i}async summarize(n=!1,a=!1,t){const i=this.summarizeCore(this.serializer,t);return this.incrementTelemetryMetric(K1.blobCountPropertyName,i.stats.blobNodeCount,t),this.incrementTelemetryMetric(K1.totalBlobSizePropertyName,i.stats.totalBlobSize,t),i}getGCData(n=!1){ms(!this._isGCing,120),this._isGCing=!0;let a;try{const t=new oPe(this.runtime.channelsRoutingContext,i=>this.handleDecoded(i));this.processGCDataCore(t),a={gcNodes:{"/":t.getSerializedRoutes()}},ms(this._isGCing,121)}finally{this._isGCing=!1}return a}processGCDataCore(n){this.summarizeCore(n)}incrementTelemetryMetric(n,a,t){var i;const r=(i=t?.get(this.telemetryContextPrefix,n))!==null&&i!==void 0?i:0;t?.set(this.telemetryContextPrefix,n,r+a)}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */function dPe(e,n){const a=new VOe;return a.addBlob(e,n),a.getSummaryTree()}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 *
 * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY
 */const lPe="1.4.0";/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */class Sc{get type(){return Sc.Type}get attributes(){return Sc.Attributes}async load(n,a,t,i){const r=new Dk(a,n,i);return await r.load(t),r}create(n,a){const t=new Dk(a,n,Sc.Attributes);return t.initializeLocal(),t}}Sc.Type="https://graph.microsoft.com/types/consensus-register-collection";Sc.Attributes={type:Sc.Type,snapshotFormatVersion:"0.1",packageVersion:lPe};/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */var Z1;(function(e){e[e.Atomic=0]="Atomic",e[e.LWW=1]="LWW"})(Z1||(Z1={}));/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const Vte=(e,n)=>({sequenceNumber:e,value:{type:"Plain",value:n}}),fPe=e=>"serializedValue"in e,Hte="header";class Dk extends uPe{constructor(n,a,t){super(n,a,t,"fluid_consensusRegisterCollection_"),this.data=new Map}static create(n,a){return n.createChannel(a,Sc.Type)}static getFactory(){return new Sc}async write(n,a){const t=this.stringify(a,this.serializer);if(!this.isAttached())return this.processInboundWrite(n,this.parse(t,this.serializer),0,0,!0),!0;const i={key:n,type:"write",serializedValue:t,refSeq:this.runtime.deltaManager.lastSequenceNumber};return this.newAckBasedPromise(r=>{this.submitLocalMessage(i,r)}).catch(r=>!1)}read(n,a=Z1.Atomic){if(a===Z1.Atomic)return this.readAtomic(n);const t=this.readVersions(n);if(t!==void 0)return ms(t.length>0,108),t[t.length-1]}readVersions(n){const a=this.data.get(n);return a?.versions.map(t=>t.value.value)}keys(){return[...this.data.keys()]}summarizeCore(n){const a={};return this.data.forEach((t,i)=>{a[i]=t}),dPe(Hte,this.stringify(a,n))}async loadCore(n){var a;const t=await n.readBlob(Hte),i=rOe(t,"utf8"),r=this.parse(i,this.serializer);for(const s of Object.keys(r))ms(((a=r[s].atomic)===null||a===void 0?void 0:a.value.type)!=="Shared",109),this.data.set(s,r[s])}onDisconnect(){}processCore(n,a,t){if(n.type===jk.Operation){const i=n.contents;switch(i.type){case"write":{i.refSeq===void 0&&(i.refSeq=n.referenceSequenceNumber);const r=i.refSeq;ms(r<=n.referenceSequenceNumber,110);const s=fPe(i)?this.parse(i.serializedValue,this.serializer):i.value.value,o=this.processInboundWrite(i.key,s,r,n.sequenceNumber,a);a&&t(o);break}default:aOe(i.type)}}}readAtomic(n){const a=this.data.get(n);return a?.atomic.value.value}processInboundWrite(n,a,t,i,r){let s=this.data.get(n);const o=s===void 0||t>=s.atomic.sequenceNumber;if(o){const c=Vte(i,a);s===void 0?(s={atomic:c,versions:[]},this.data.set(n,s)):s.atomic=c}else ms(!!s,111);for(;s.versions.length>0&&t>=s.versions[0].sequenceNumber;)s.versions.shift();const u=Vte(i,a);return this.isAttached()?s.versions.length>0&&ms(i>s.versions[s.versions.length-1].sequenceNumber,113):ms(t===0&&i===0,112),s.versions.push(u),o&&this.emit("atomicChanged",n,a,r),this.emit("versionChanged",n,a,r),o}stringify(n,a){return a.stringify(n,this.handle)}parse(n,a){return a.parse(n)}applyStashedOp(){return()=>{}}}/*!
 * Copyright (c) Microsoft Corporation and contributors. All rights reserved.
 * Licensed under the MIT License.
 */const hPe=Object.freeze(Object.defineProperty({__proto__:null,ConsensusRegisterCollection:Dk,ConsensusRegisterCollectionFactory:Sc,get ReadPolicy(){return Z1}},Symbol.toStringTag,{value:"Module"})),mPe=sE(hPe);var Kte;function pPe(){if(Kte)return bg;Kte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=bg&&bg.__awaiter||function(o,u,c,d){function l(f){return f instanceof c?f:new c(function(b){b(f)})}return new(c||(c=Promise))(function(f,b){function C(h){try{m(d.next(h))}catch(g){b(g)}}function v(h){try{m(d.throw(h))}catch(g){b(g)}}function m(h){h.done?f(h.value):l(h.value).then(C,v)}m((d=d.apply(o,u||[])).next())})};Object.defineProperty(bg,"__esModule",{value:!0}),bg.DynamicObjectManager=void 0;const n=$o(),a=ry,t=mPe,i=Wo();i.DynamicObjectRegistry.registerObjectClass(t.ConsensusRegisterCollection,t.ConsensusRegisterCollection.getFactory().type);const r="<<consensusRegisterCollectionKey>>";let s=class extends i.LiveDataObject{constructor(){super(...arguments),this._dynamicObjectsMap=new Map}initializingFirstTime(){return e(this,void 0,void 0,function*(){const u=t.ConsensusRegisterCollection.create(this.runtime,r);this.root.set(r,u.handle)})}hasInitialized(){return e(this,void 0,void 0,function*(){const u=this.root.get(r);this._dynamicObjectsCollection=yield u?.get()})}get dynamicObjectsCollection(){return(0,a.assert)(this._dynamicObjectsCollection!==void 0,"_dynamicObjectsCollection not initialized"),this._dynamicObjectsCollection}getDDS(u,c,d){return e(this,void 0,void 0,function*(){let l=yield this.internalGetDDS(u);if(l)return{dds:l,created:!1};const f=yield d.create(c);return this.loadDDSWithConsensus(u,f)})}internalGetDDS(u){return e(this,void 0,void 0,function*(){const c=this._dynamicObjectsMap.get(u);if(c)return c;const d=this.dynamicObjectsCollection.read(u);if(!d)return;const l=d?.get();return this._dynamicObjectsMap.set(u,l),l})}loadDDSWithConsensus(u,c){return e(this,void 0,void 0,function*(){yield this.waitUntilConnected();const d=yield this.internalGetDDS(u);return d?{dds:d,created:!1}:(yield this.dynamicObjectsCollection.write(u,c.handle))?(this._dynamicObjectsMap.set(u,Promise.resolve(c)),{dds:c,created:!0}):yield this.loadDDSWithConsensus(u,c)})}};return s.TypeName="@microsoft/live-share:DynamicObjectManager",s.factory=new n.DataObjectFactory(s.TypeName,s,[t.ConsensusRegisterCollection.getFactory()],{}),bg.DynamicObjectManager=s,bg}var $te;function tue(){return $te||($te=1,(function(e){var n=yg&&yg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=yg&&yg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(pPe(),e)})(yg)),yg}var Gte;function gPe(){if(Gte)return v1;Gte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(v1,"__esModule",{value:!0}),v1.BASE_CONTAINER_SCHEMA=void 0;const e=Sce(),n=tue();return v1.BASE_CONTAINER_SCHEMA={initialObjects:{TURBO_STATE_MAP:e.SharedMap,TURBO_DYNAMIC_OBJECTS:n.DynamicObjectManager}},v1}var T1={},Wte;function yPe(){if(Wte)return T1;Wte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */Object.defineProperty(T1,"__esModule",{value:!0}),T1.debounce=void 0;function e(n,a){let t;return[(...s)=>new Promise(o=>{t&&clearTimeout(t),t=setTimeout(()=>{o(n(s))},a)}),()=>t&&clearTimeout(t)]}return T1.debounce=e,T1}var Jte;function bPe(){return Jte||(Jte=1,(function(e){var n=gg&&gg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=gg&&gg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(gPe(),e),a(yPe(),e)})(gg)),gg}var Qte;function lL(){if(Qte)return pg;Qte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=pg&&pg.__awaiter||function(i,r,s,o){function u(c){return c instanceof s?c:new s(function(d){d(c)})}return new(s||(s=Promise))(function(c,d){function l(C){try{b(o.next(C))}catch(v){d(v)}}function f(C){try{b(o.throw(C))}catch(v){d(v)}}function b(C){C.done?c(C.value):u(C.value).then(l,f)}b((o=o.apply(i,r||[])).next())})};Object.defineProperty(pg,"__esModule",{value:!0}),pg.FluidTurboClient=void 0;const n=Wo(),a=bPe();let t=class{get stateMap(){if(this.results)return this.results.container.initialObjects.TURBO_STATE_MAP}get dynamicObjects(){if(this.results)return this.results.container.initialObjects.TURBO_DYNAMIC_OBJECTS}getDDS(r,s,o){return e(this,void 0,void 0,function*(){if(!this.results)throw new Error("FluidTurboClient getDDS: cannot call until successful get/create/join FluidContainer");if(!this.dynamicObjects)throw new Error("FluidTurboClient: getDDS must have valid dynamicObjects DynamicObjectManager");yield this.waitUntilConnected();const u=this.results.container.initialObjects[r];if(u!==void 0)return u;const c=`<${s.name}>:${r}`,d=yield this.dynamicObjects.getDDS(c,s,this.results.container);return d.created&&o?.(d.dds),d.dds})}getContainerSchema(r){return{initialObjects:Object.assign(Object.assign({},a.BASE_CONTAINER_SCHEMA.initialObjects),r),dynamicObjectTypes:[...n.DynamicObjectRegistry.dynamicLoadableObjects.values()]}}waitUntilConnected(){return e(this,void 0,void 0,function*(){return this._awaitConnectedPromise?this._awaitConnectedPromise:(this._awaitConnectedPromise=new Promise((r,s)=>{var o;if(!(!((o=this.results)===null||o===void 0)&&o.container))s(new Error("FluidTurboClient awaitConnected: cannot load DDS without a Fluid container")),this._awaitConnectedPromise=void 0;else{const u=()=>{var c;(c=this.results)===null||c===void 0||c.container.off("connected",u),r()};this.results.container.connectionState===2?r():this.results.container.on("connected",u)}}),this._awaitConnectedPromise)})}};return pg.FluidTurboClient=t,pg}var Yte;function vPe(){if(Yte)return Gl;Yte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Gl&&Gl.__awaiter||function(r,s,o,u){function c(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function f(v){try{C(u.next(v))}catch(m){l(m)}}function b(v){try{C(u.throw(v))}catch(m){l(m)}}function C(v){v.done?d(v.value):c(v.value).then(f,b)}C((u=u.apply(r,s||[])).next())})};Object.defineProperty(Gl,"__esModule",{value:!0}),Gl.AzureTurboClient=void 0;const n=uce(),a=Wo(),t=lL();let i=class extends t.FluidTurboClient{constructor(s,o=a.AzureLiveShareHost.create(!0)){super(),this._client=new n.AzureClient(s),this._host=o,this._runtime=new a.LiveShareRuntime(this._host)}get results(){return this._results}get canSendBackgroundUpdates(){return this._runtime.canSendBackgroundUpdates}set canSendBackgroundUpdates(s){this._runtime.canSendBackgroundUpdates=s}createContainer(s){return e(this,void 0,void 0,function*(){const o=this.getInjectedContainerSchema(s);return this._results=yield this._client.createContainer(o),this._host instanceof a.AzureLiveShareHost&&this._host.setAudience(this._results.services.audience),yield this._runtime.start(),this._results})}getContainer(s,o){return e(this,void 0,void 0,function*(){const u=this.getInjectedContainerSchema(o);return this._results=yield this._client.getContainer(s,u),this._host instanceof a.AzureLiveShareHost&&this._host.setAudience(this._results.services.audience),yield this._runtime.start(),this._results})}getInjectedContainerSchema(s){return(0,a.getLiveContainerSchema)(this.getContainerSchema(s),this._runtime)}};return Gl.AzureTurboClient=i,Gl}var Sg={},Xte;function SPe(){if(Xte)return Sg;Xte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var e=Sg&&Sg.__awaiter||function(i,r,s,o){function u(c){return c instanceof s?c:new s(function(d){d(c)})}return new(s||(s=Promise))(function(c,d){function l(C){try{b(o.next(C))}catch(v){d(v)}}function f(C){try{b(o.throw(C))}catch(v){d(v)}}function b(C){C.done?c(C.value):u(C.value).then(l,f)}b((o=o.apply(i,r||[])).next())})};Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.LiveShareTurboClient=void 0;const n=Wo(),a=lL();let t=class extends a.FluidTurboClient{constructor(r,s){super(),this._client=new n.LiveShareClient(r,s)}get isTesting(){return this._client.isTesting}get maxContainerLookupTries(){return this._client.maxContainerLookupTries}set maxContainerLookupTries(r){this._client.maxContainerLookupTries=r}get results(){return this._results}get canSendBackgroundUpdates(){return this._client.canSendBackgroundUpdates}set canSendBackgroundUpdates(r){this._client.canSendBackgroundUpdates=r}join(r,s){return e(this,void 0,void 0,function*(){const o=this.getContainerSchema(r);return this._results=yield this._client.joinContainer(o,s),this._results})}};return Sg.LiveShareTurboClient=t,Sg}var Cg={},tk={},Zte;function CPe(){if(Zte)return tk;Zte=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */return Object.defineProperty(tk,"__esModule",{value:!0}),tk}var ene;function _Pe(){return ene||(ene=1,(function(e){var n=Cg&&Cg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Cg&&Cg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(CPe(),e)})(Cg)),Cg}var tne;function TPe(){return tne||(tne=1,(function(e){var n=$l&&$l.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=$l&&$l.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(vPe(),e),a(SPe(),e),a(lL(),e),a(tue(),e),a(_Pe(),e)})($l)),$l}var wPe=TPe();const OPe=hs.createContext({});var nk=function(e,n,a,t){function i(r){return r instanceof a?r:new a(function(s){s(r)})}return new(a||(a=Promise))(function(r,s){function o(d){try{c(t.next(d))}catch(l){s(l)}}function u(d){try{c(t.throw(d))}catch(l){s(l)}}function c(d){d.done?r(d.value):i(d.value).then(o,u)}c((t=t.apply(e,n||[])).next())})};const nue=hs.createContext({}),rue=()=>{const e=hs.useContext(nue);if(!EPe(e))throw new Error("@microsoft/live-share-react: attempting to use `useLiveShareContext()` from a component that is not a child of `<LiveShareProvider>`.\nTo fix this error, ensure that you are only using Live Share hooks (e.g., `useLiveState`) from a child component of `<LiveShareProvider>`.");return e},PPe=e=>{const n=hs.useRef(!1),a=hs.useRef(new wPe.LiveShareTurboClient(e.host,e.clientOptions)),[t,i]=hs.useState(),[r,s]=hs.useState(),o=_me(t),u=hs.useCallback((c,d)=>nk(void 0,void 0,void 0,function*(){n.current=!0;const l=yield a.current.join(c,d);return i(l),l}),[]);return hs.useEffect(()=>{t!==void 0||n.current||!e.joinOnLoad||u(e.initialObjects).catch(c=>{var d;console.error(c),c instanceof Error?s(c):xfe(c)?s(new Error(`[${c.errorCode}] ${(d=c.message)!==null&&d!==void 0?d:"An unknown error occurred while joining container."}`)):s(typeof c=="string"?new Error(c):new Error("LiveShareProvider: An unknown error occurred while joining container."))})},[t,e.joinOnLoad,e.initialObjects,u]),Dt.jsx(nue.Provider,Object.assign({value:{created:!!t?.created,timestampProvider:t?.timestampProvider,joined:!!t?.container,joinError:r,join:u}},{children:Dt.jsx(OPe.Provider,Object.assign({value:Object.assign({clientRef:a,container:t?.container,services:t?.services,joinError:r,getContainer:()=>nk(void 0,void 0,void 0,function*(){throw new Error("Cannot join new container through getContainer in LiveShareProvider")}),createContainer:()=>nk(void 0,void 0,void 0,function*(){throw new Error("Cannot create new container through createContainer in LiveShareProvider")})},o)},{children:e.children}))}))};function EPe(e){return typeof e?.created=="boolean"&&typeof e?.join=="function"}Wo();/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 *//*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 *//*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var _g={},Tg={},wg={},rk={},nne;function fL(){return nne||(nne=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MediaSessionCoordinatorEvents=void 0,(function(n){n.coordinatorstatechange="coordinatorstatechange",n.triggeraction="triggeraction",n.triggeractionignored="triggeractionignored"})(e.MediaSessionCoordinatorEvents||(e.MediaSessionCoordinatorEvents={}))})(rk)),rk}var ik={},rne;function iue(){return rne||(rne=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.VolumeManager=e.LimitLevelType=void 0;const n=Wo();var a;(function(i){i[i.fixed=0]="fixed",i[i.percentage=1]="percentage"})(a=e.LimitLevelType||(e.LimitLevelType={}));class t{constructor(r){this._volumeChangeDuration=new n.TimeInterval(500),this._volume=0,this._isLimiting=!1,this._limitLevel=.1,this._limitLevelType=a.fixed,this._startTime=0,this._startVolume=0,this._running=!1,this._player=r,this._volume=this._player.volume}get volume(){return this._volume}set volume(r){if(r<0||r>1)throw new Error(`VolumeManager: cannot set volume to ${r}. Level must be between 0.0 and 1.0.`);this._volume=r,this.startAdjusting()}get limitLevel(){return this._limitLevel}set limitLevel(r){if(r<0||r>1)throw new Error(`VolumeManager: cannot set level to ${r}. Level must be between 0.0 and 1.0.`);this._limitLevel=r}get limitLevelType(){return this._limitLevelType}set limitLevelType(r){this._limitLevelType=r}get volumeChangeDuration(){return this._volumeChangeDuration.seconds}set volumeChangeDuration(r){this._volumeChangeDuration.seconds=Math.abs(r)}get isLimiting(){return this._isLimiting}startLimiting(){this._isLimiting=!0,this.startAdjusting()}stopLimiting(){this._isLimiting=!1,this.startAdjusting()}startAdjusting(){const r=()=>{this.millisSinceVolumeChangeStart()<=this._volumeChangeDuration.milliseconds?(this._player.volume=this.computeInterpolatedVolume(),this.scheduleAnimationFrame(r)):(this._player.volume=this.computeTargetVolume(),this._running=!1)};this._startTime=new Date().getTime(),this._startVolume=this._player.volume,this._running||(this._running=!0,this.scheduleAnimationFrame(r))}scheduleAnimationFrame(r){typeof requestAnimationFrame=="function"?requestAnimationFrame(r):setTimeout(r,Math.min(this._volumeChangeDuration.milliseconds/25,20))}computeInterpolatedVolume(){const r=this._volumeChangeDuration.milliseconds,o=(this.computeTargetVolume()-this._startVolume)/r*this.millisSinceVolumeChangeStart();return this._startVolume+o}computeTargetVolume(){return this._limitLevelType==a.percentage?this._isLimiting?this._volume*this._limitLevel:this._volume:this._isLimiting&&this._volume>this._limitLevel?this._limitLevel:this._volume}millisSinceVolumeChangeStart(){return new Date().getTime()-this._startTime}}e.VolumeManager=t})(ik)),ik}var Og={},w1={},ine;function sue(){if(ine)return w1;ine=1,Object.defineProperty(w1,"__esModule",{value:!0}),w1.TelemetryEvents=void 0,w1.TelemetryEvents={MediaPlayerSynchronizer:{SynchronizationStarted:"MediaPlayerSynchronizer:SynchronizationStarted",PlayerEvent:"MediaPlayerSynchronizer:PlayerEvent",PlayAction:"MediaPlayerSynchronizer:PlayAction",PauseAction:"MediaPlayerSynchronizer:PauseAction",SeekToAction:"MediaPlayerSynchronizer:SeekToAction",RateChangeAction:"MediaPlayerSynchronizer:RateChangeAction",CatchupAction:"MediaPlayerSynchronizer:CatchupAction",SetTrackAction:"MediaPlayerSynchronizer:SetTrackAction",DataChangeAction:"MediaPlayerSynchronizer:DataChangeAction",UserTappedVideoToPlay:e("MediaPlayerSynchronizer:UserTappedVideoToPlay"),UserTappedVideoToPlayError:"MediaPlayerSynchronizer:UserTappedVideoToPlayError",PlayerBlockedOperation:e("MediaPlayerSynchronizer:PlayerBlockedOperation"),SeekingPlayerToStartPosition:"MediaPlayerSynchronizer:SeekingPlayerToStartPosition",BeginSeekCalled:"MediaPlayerSynchronizer:BeginSeekCalled",EndSeekCalled:"MediaPlayerSynchronizer:EndSeekCalled",PlayCalled:"MediaPlayerSynchronizer:PlayCalled",PauseCalled:"MediaPlayerSynchronizer:PauseCalled",SeekToCalled:"MediaPlayerSynchronizer:SeekToCalled",RateChangeCalled:"MediaSession:RateChangeCalled",SetTrackCalled:"MediaPlayerSynchronizer:SetTrackCalled",SetTrackDataCalled:"MediaPlayerSynchronizer:SetTrackDataCalled"},MediaSession:{PlayAction:e("MediaSession:PlayAction"),PauseAction:e("MediaSession:PauseAction"),SeekToAction:e("MediaSession:SeekToAction"),RateChangeAction:e("MediaSession:RateChangeAction"),CatchUpAction:e("MediaSession:CatchUpAction"),SetTrackAction:e("MediaSession:SetTrackAction"),DataChangeAction:"MediaSession:DataChangeAction",BeginPositionUpdateTimer:"MediaSession:BeginPositionUpdateTimer"},SessionCoordinator:{PlayCalled:e("SessionCoordinator:PlayCalled"),PauseCalled:e("SessionCoordinator:PauseCalled"),SeekToCalled:e("SessionCoordinator:SeekToCalled"),SetPlaybackRateCalled:e("SessionCoordinator:SetPlaybackRateCalled"),SetTrackCalled:e("SessionCoordinator:SetTrackCalled"),SetTrackDataCalled:"SessionCoordinator:SetTrackDataCalled",BeginSuspension:"SessionCoordinator:BeginSuspension",BeginSuspensionAndWait:e("SessionCoordinator:BeginSuspensionAndWait"),EndSuspension:"SessionCoordinator:EndSuspension",EndSuspensionAndWait:e("SessionCoordinator:EndSuspensionAndWait"),RemoteConnectReceived:"SessionCoordinator:RemoteConnectReceived",RemoteSetTrackReceived:e("SessionCoordinator:RemoteSetTrackReceived"),RemoteSetTrackDataReceived:e("SessionCoordinator:RemoteSetTrackDataReceived"),RemotePlayReceived:e("SessionCoordinator:RemotePlayReceived"),RemotePauseReceived:e("SessionCoordinator:RemotePauseReceived"),RemoteSeekToReceived:e("SessionCoordinator:RemoteSeekToReceived"),RemoteRateChangeReceived:e("SessionCoordinator:RemoteRateChangeReceived"),PositionUpdateEventError:"SessionCoordinator:PositionUpdateEventError",LiveObjectSynchronizerStartError:"SessionCoordinator:LiveObjectSynchronizerStartError"},GroupCoordinator:{TrackChanged:"GroupCoordinator:TrackChanged",TrackChangeDelayed:"GroupCoordinator:TrackChangeDelayed",TrackDataChanged:"GroupCoordinator:TrackDataChanged",TrackDataChangeDelayed:"GroupCoordinator:TrackDataChangeDelayed",TransportStateChanged:"GroupCoordinator:TransportStateChanged",TransportStateChangeDelayed:"GroupCoordinator:TransportStateChangeDelayed",PlaybackRateChanged:"GroupCoordinator:PlaybackRateChanged",PlaybackRateChangedDelayed:"GroupCoordinator:PlaybackRateChanged",BeginSoftSuspension:"GroupCoordinator:BeginSoftSuspension",CheckingForSyncIssues:"GroupCoordinator:CheckingForSyncIssues",TrackOutOfSync:e("GroupCoordinator:TrackOutOfSync"),TrackDataOutOfSync:e("GroupCoordinator:TrackDataOutOfSync"),TransportOutOfSync:e("GroupCoordinator:TransportOutOfSync"),PositionOutOfSync:e("GroupCoordinator:PositionOutOfSync"),PlaybackRateOutOfSync:e("GroupCoordinator:PlaybackRateOutOfSync")}};function e(n){return`${n}#transmit`}return w1}var Pg={},O1={},sne;function xT(){return sne||(sne=1,(function(e){var n=O1&&O1.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0}),e.GroupPlaybackTrack=e.GroupPlaybackTrackEvents=void 0;const a=n(Ec());var t;(function(r){r.trackChange="trackChange"})(t=e.GroupPlaybackTrackEvents||(e.GroupPlaybackTrackEvents={}));let i=class kk extends a.default{constructor(s){super(),this._current={metadata:null,waitPoints:[],timestamp:0,clientId:""},this._getMediaPlayerState=s}get current(){return this._current.metadata||(this._current.metadata=this._getMediaPlayerState().metadata),this._current}get metadata(){return this.current.metadata}addWaitPoint(s){for(let o=0;o<this._current.waitPoints.length;o++){const u=this._current.waitPoints[o];if(u.position==s.position)return!1;if(u.position>s.position)return this._current.waitPoints.splice(o,0,s),!0}return this._current.waitPoints.push(s),!0}findNextWaitPoint(s){const o=this._current.waitPoints||[];for(const u of o)if(!(s&&u.position<=s.position))return u}updateTrack(s,o){Array.isArray(s.waitPoints)||(s.waitPoints=[]);const u=this.current;if(kk.compareMetadata(this.current.metadata,s.metadata)&&(s.waitPoints.forEach(d=>{this.addWaitPoint(d)}),s.timestamp==u.timestamp&&s.clientId==u.clientId)||s.timestamp<u.timestamp||s.timestamp==u.timestamp&&s.clientId.localeCompare(u.clientId)>0)return!1;this._current=s;const c={name:t.trackChange,clientId:s.clientId,metadata:s.metadata,source:o};return this.emit(t.trackChange,c),!0}compare(s){return kk.compareMetadata(this.current.metadata,s)}static compareMetadata(s,o){return s&&o?JSON.stringify(s)==JSON.stringify(o):!(!s&&o)}};e.GroupPlaybackTrack=i})(O1)),O1}var P1={},ane;function xk(){return ane||(ane=1,(function(e){var n=P1&&P1.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0}),e.GroupTransportState=e.GroupTransportStateEvents=void 0;const a=n(Ec()),t=xT();var i;(function(s){s.transportStateChange="transportStateChange"})(i=e.GroupTransportStateEvents||(e.GroupTransportStateEvents={}));let r=class extends a.default{constructor(o,u,c,d){super(),this._liveRuntime=d,this._getMediaPlayerState=c,this._track=o,this._playbackRate=u,this._current={playbackState:"none",startPosition:0,timestamp:0,clientId:""},this._track.on(t.GroupPlaybackTrackEvents.trackChange,()=>{this._current={playbackState:"none",startPosition:0,timestamp:this._track.current.timestamp,clientId:this._track.current.clientId}})}get current(){return this._current}get playbackState(){return this.current.playbackState}get startPosition(){return this.current.startPosition}get timestamp(){return this.current.timestamp}get track(){return this._track}compare(o){return this.current.playbackState==o.playbackState&&this.current.startPosition==o.startPosition}updateState(o,u){if(this.compare(o))return!1;const c=this.current;if(o.timestamp<c.timestamp||o.timestamp==c.timestamp&&o.clientId.localeCompare(c.clientId)>0)return!1;this._current=o;const d=this._getMediaPlayerState().playbackState;if(c.playbackState==o.playbackState&&d!="ended"){const l={name:i.transportStateChange,action:"seekto",clientId:o.clientId,seekTime:o.startPosition,source:u};this.emit(i.transportStateChange,l)}else if(o.playbackState=="playing"){const l=this._liveRuntime.getTimestamp(),f=o.startPosition+(l-o.timestamp)/1e3*this._playbackRate.rate,b={name:i.transportStateChange,action:"play",clientId:o.clientId,seekTime:f,source:u};this.emit(i.transportStateChange,b)}else{const l={name:i.transportStateChange,action:"pause",clientId:o.clientId,seekTime:o.startPosition,source:u};this.emit(i.transportStateChange,l)}return!0}};e.GroupTransportState=r})(P1)),P1}var E1={},one;function aue(){if(one)return E1;one=1,Object.defineProperty(E1,"__esModule",{value:!0}),E1.GroupPlaybackPosition=void 0;const e=xT();let n=class{constructor(t,i,r,s,o){this._transportState=t,this._playbackRate=i,this._runtime=r,this._liveRuntime=s,this._updateInterval=o,this._positions=new Map,this._transportState.track.on(e.GroupPlaybackTrackEvents.trackChange,u=>{this._positions=new Map,this.mediaDuration=void 0})}get localPosition(){return this._positions.get(this._runtime.clientId)}get totalClients(){let t=0;return this.forEach(i=>t++),t}get trackEnded(){let t=0;return this.forEach((i,r)=>{switch(i.playbackState){case"none":case"ended":break;default:t++;break}}),t==0}get clientsWaiting(){var t;let i=0;const r=(t=this.localPosition)===null||t===void 0?void 0:t.waitPoint;return r&&(r.maxClients==null||this.totalClients<=r.maxClients)&&this.forEach((s,o)=>{(s.playbackState=="suspended"&&s.waitPoint||s.position<r.position)&&i++}),i}get maxPosition(){if(this._transportState.playbackState=="playing"){const t=this._liveRuntime.getTimestamp(),i=this._transportState.startPosition+(t-this._transportState.timestamp)/1e3*this._playbackRate.rate;return this.limitProjectedPosition(i)}else return this._transportState.startPosition}get targetPosition(){return this._transportState.playbackState=="playing"?this.getMostProgressedPosition():this._transportState.startPosition}forEach(t){var i;const r=this._liveRuntime.getTimestamp(),s=r-this._updateInterval.milliseconds*2,o=!(!((i=this._transportState.track.metadata)===null||i===void 0)&&i.liveStream);this._positions.forEach((u,c)=>{if(u.timestamp>s){const d=u.playbackState=="playing"&&o?u.position+(r-u.timestamp)/1e3*this._playbackRate.rate:u.position;t(u,this.limitProjectedPosition(d))}})}UpdatePlaybackPosition(t){if(t.duration!=null&&(this.mediaDuration=t.duration),this._positions.has(t.clientId)){const i=this._positions.get(t.clientId);t.timestamp>=i.timestamp&&this._positions.set(t.clientId,t)}else this._positions.set(t.clientId,t)}getMostProgressedPosition(){const t=this.maxPosition;let i=-1;return this.forEach((r,s)=>{s<=t&&s>i&&(i=s)}),i}limitProjectedPosition(t){return this.mediaDuration!=null?Math.min(t,this.mediaDuration):t}};return E1.GroupPlaybackPosition=n,E1}var I1={},cne;function oue(){return cne||(cne=1,(function(e){var n=I1&&I1.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0}),e.GroupPlaybackTrackData=e.PlaybackTrackDataEvents=void 0;const a=n(Ec()),t=xT();var i;(function(s){s.dataChange="dataChange"})(i=e.PlaybackTrackDataEvents||(e.PlaybackTrackDataEvents={}));let r=class extends a.default{constructor(o){super(),this._track=o,this._current={data:null,timestamp:0,clientId:""},this._track.on(t.GroupPlaybackTrackEvents.trackChange,()=>{this._current={data:null,timestamp:this._track.current.timestamp,clientId:this._track.current.clientId}})}get current(){return this._current}get data(){return this.current.data}updateData(o,u){const c=this.current;if(o.timestamp<c.timestamp||o.timestamp==c.timestamp&&o.clientId.localeCompare(c.clientId)>0||JSON.stringify(c.data)==JSON.stringify(o.data))return!1;this._current=o;const d={name:i.dataChange,clientId:o.clientId,data:o.data,source:u};return this.emit(i.dataChange,d),!0}};e.GroupPlaybackTrackData=r})(I1)),I1}var R1={},une;function cue(){return une||(une=1,(function(e){var n=R1&&R1.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0}),e.GroupPlaybackRate=e.PlaybackRateEvents=void 0;const a=n(Ec());var t;(function(r){r.rateChange="rateChange"})(t=e.PlaybackRateEvents||(e.PlaybackRateEvents={}));let i=class extends a.default{constructor(){super(),this._current={playbackRate:1,timestamp:0,clientId:""}}get current(){return this._current}get rate(){return this.current.playbackRate}updatePlaybackRate(s,o){const u=this.current;if(s.timestamp<u.timestamp||s.timestamp==u.timestamp&&s.clientId.localeCompare(u.clientId)>0||u.playbackRate==s.playbackRate)return!1;this._current=s;const c={name:t.rateChange,clientId:s.clientId,playbackRate:s.playbackRate,source:o};return this.emit(t.rateChange,c),!0}};e.GroupPlaybackRate=i})(R1)),R1}var dne;function IPe(){return dne||(dne=1,(function(e){var n=Pg&&Pg.__awaiter||function(v,m,h,g){function _(S){return S instanceof h?S:new h(function(p){p(S)})}return new(h||(h=Promise))(function(S,p){function w(F){try{E(g.next(F))}catch(R){p(R)}}function O(F){try{E(g.throw(F))}catch(R){p(R)}}function E(F){F.done?S(F.value):_(F.value).then(w,O)}E((g=g.apply(v,m||[])).next())})},a=Pg&&Pg.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(e,"__esModule",{value:!0}),e.GroupCoordinatorState=e.GroupCoordinatorStateEvents=void 0;const t=Wo(),i=a(Ec()),r=xT(),s=xk(),o=aue(),u=xk(),c=oue(),d=sue(),l=Bs(),f=cue();var b;(function(v){v.newwaitpoint="newwaitpoint",v.triggeraction="triggeraction",v.triggeractionignored="triggeractionignored"})(b=e.GroupCoordinatorStateEvents||(e.GroupCoordinatorStateEvents={}));let C=class extends i.default{constructor(m,h,g,_,S){super(),this._suspensionCnt=0,this._lastStateChange="none",this._lastStateChangeTime=0,this._runtime=m,this._liveRuntime=h,this._logger=new t.LiveTelemetryLogger(m,h),this._maxPlaybackDrift=g,this._playbackTrack=new r.GroupPlaybackTrack(S),this._playbackTrackData=new c.GroupPlaybackTrackData(this._playbackTrack),this._playbackRate=new f.GroupPlaybackRate,this._transportState=new s.GroupTransportState(this._playbackTrack,this._playbackRate,S,this._liveRuntime),this._playbackPosition=new o.GroupPlaybackPosition(this._transportState,this._playbackRate,this._runtime,this._liveRuntime,_),this._getMediaPlayerState=S,this._playbackTrack.on(r.GroupPlaybackTrackEvents.trackChange,p=>{this.isSuspended?this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.TrackChangeDelayed):(this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.TrackChanged),this.emitSetTrack(p.clientId,p.metadata,p.source))}),this._playbackTrackData.on(c.PlaybackTrackDataEvents.dataChange,p=>n(this,void 0,void 0,function*(){!this.isSuspended&&!this.isWaiting?this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.TrackDataChanged):this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.TrackDataChangeDelayed);const w=yield(0,l.waitUntilConnected)(this._runtime);this.emitTriggerActionOrIgnored({action:"datachange",source:p.source,data:p.data,clientId:p.clientId,local:p.clientId===w})})),this._playbackRate.on(f.PlaybackRateEvents.rateChange,p=>n(this,void 0,void 0,function*(){!this.isSuspended&&!this.isWaiting?this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.PlaybackRateChanged):this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.PlaybackRateChangedDelayed);const w=yield(0,l.waitUntilConnected)(this._runtime),O=p.clientId===w;this.emitTriggerActionOrIgnored({action:"ratechange",source:p.source,clientId:p.clientId,local:O,playbackRate:p.playbackRate})})),this._transportState.on(u.GroupTransportStateEvents.transportStateChange,p=>n(this,void 0,void 0,function*(){const w=this.isSuspended||this.isWaiting?d.TelemetryEvents.GroupCoordinator.TransportStateChangeDelayed:d.TelemetryEvents.GroupCoordinator.TransportStateChanged;this._logger.sendTelemetryEvent(w,null,{action:p.action,seekTime:p.seekTime});const O=yield(0,l.waitUntilConnected)(this._runtime),E=p.clientId===O;switch(p.action){case"play":this.emitTriggerActionOrIgnored({action:"play",source:p.source,clientId:p.clientId,local:E,seekTime:p.seekTime});break;case"pause":this.emitTriggerActionOrIgnored({action:"pause",source:p.source,clientId:p.clientId,local:E,seekTime:p.seekTime});break;case"seekto":this.emitTriggerActionOrIgnored({action:"seekto",source:p.source,clientId:p.clientId,local:E,seekTime:p.seekTime});break}}))}get playbackTrack(){return this._playbackTrack}get playbackTrackData(){return this._playbackTrackData}get transportState(){return this._transportState}get playbackPosition(){return this._playbackPosition}get playbackRate(){return this._playbackRate}get waitingAt(){return this._waitPoint}get isSuspended(){return this._suspensionCnt>0}get isWaiting(){return!!this._waitPoint}beginSuspension(m){this._suspensionCnt++,m&&(this._waitPoint=m,this.playbackTrack.addWaitPoint(m))}endSuspension(m){if(this._suspensionCnt==0)throw new Error(`GroupCoordinatorState:endSuspension - cannot end suspension when there are no active suspensions. The expected value is > 0 but the actual count is ${this._suspensionCnt}`);this._suspensionCnt--,this._suspensionCnt==0&&m&&this.syncLocalMediaSession()}createPositionUpdateEvent(m){const{positionState:h,playbackState:g}=m;return this.isSuspended?{track:this.playbackTrack.current,trackData:this.playbackTrackData.current,transport:this.transportState.current,playbackRate:this.playbackRate.current,playbackState:"suspended",position:h?.position||0,waitPoint:this._waitPoint}:{track:this.playbackTrack.current,trackData:this.playbackTrackData.current,transport:this.transportState.current,playbackRate:this.playbackRate.current,playbackState:this._waitPoint?"waiting":g,position:h?.position||0,waitPoint:this._waitPoint}}handleSetTrack(m,h){this.playbackTrack.updateTrack({metadata:m.data.metadata,waitPoints:m.data.waitPoints,timestamp:m.timestamp,clientId:m.clientId||""},"user")&&this._logger.sendTelemetryEvent(d.TelemetryEvents.SessionCoordinator.RemoteSetTrackReceived,null,{correlationId:t.LiveTelemetryLogger.formatCorrelationId(m.clientId,m.timestamp)})}handleSetTrackData(m,h){this.playbackTrackData.updateData({data:m.data.data,timestamp:m.timestamp,clientId:m.clientId||""},"user")&&this._logger.sendTelemetryEvent(d.TelemetryEvents.SessionCoordinator.RemoteSetTrackReceived,null,{correlationId:t.LiveTelemetryLogger.formatCorrelationId(m.clientId,m.timestamp)})}handleRateChangeCommand(m,h){const g={playbackRate:m.data.playbackRate,clientId:m.clientId,timestamp:m.timestamp};if(this.playbackRate.updatePlaybackRate(g,"user")){const S=t.LiveTelemetryLogger.formatCorrelationId(m.clientId,m.timestamp);this._logger.sendTelemetryEvent(d.TelemetryEvents.SessionCoordinator.RemoteRateChangeReceived,null,{correlationId:S})}}handleTransportCommand(m,h){if(this.playbackTrack.updateTrack(m.data.track,"system"),this.playbackTrack.compare(m.data.track.metadata)){let g=this.transportState.playbackState;switch(m.name){case"play":g="playing";break;case"pause":g="paused";break}const _={playbackState:g,startPosition:m.data.position,timestamp:m.timestamp,clientId:m.clientId||""};if(this.transportState.updateState(_,"user")){const p=t.LiveTelemetryLogger.formatCorrelationId(m.clientId,m.timestamp);switch(m.name){case"play":this._logger.sendTelemetryEvent(d.TelemetryEvents.SessionCoordinator.RemotePlayReceived,null,{correlationId:p});break;case"pause":this._logger.sendTelemetryEvent(d.TelemetryEvents.SessionCoordinator.RemotePauseReceived,null,{correlationId:p});break;case"seekTo":this._logger.sendTelemetryEvent(d.TelemetryEvents.SessionCoordinator.RemoteSeekToReceived,null,{correlationId:p});break}}}}handlePositionUpdate(m,h){if(this.playbackTrack.updateTrack(m.data.track,"system"),this.playbackTrack.compare(m.data.track.metadata)&&(this.playbackTrackData.updateData(m.data.trackData,"system"),m.data.playbackState!="ended"&&this.transportState.updateState(m.data.transport,"system"),this.transportState.compare(m.data.transport))){const g={playbackState:m.data.playbackState,waitPoint:m.data.waitPoint,position:m.data.position,timestamp:m.timestamp,clientId:m.clientId||""};if(this.playbackPosition.UpdatePlaybackPosition(g),h&&!this.isSuspended){switch(m.data.playbackState){case"none":case"paused":case"playing":m.data.playbackState!=this._lastStateChange&&(this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.BeginSoftSuspension,null,{playbackState:m.data.playbackState}),this._lastStateChange=m.data.playbackState,this._lastStateChangeTime=this._liveRuntime.getTimestamp());break}this.isWaiting?this.playbackPosition.clientsWaiting==0&&(this._waitPoint=void 0,this.syncLocalMediaSession()):this.syncLocalMediaSession()}}}syncLocalMediaSession(){return n(this,void 0,void 0,function*(){const m=this._liveRuntime.getTimestamp()-this._lastStateChangeTime;if(!this.isWaiting&&m>=1e3){let{metadata:h,trackData:g,positionState:_,playbackState:S}=this._getMediaPlayerState();if(this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.CheckingForSyncIssues),!this.playbackTrack.compare(h)){this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.TrackOutOfSync),this.emitSetTrack(this.playbackTrack.current.clientId,this.playbackTrack.metadata,"system");return}if(S!="ended"&&!this._playbackPosition.trackEnded){let p=_?.position;p==null&&(p=0);const w=this.playbackPosition.targetPosition;w>=0&&Math.abs(w-p)>=Math.max(this._maxPlaybackDrift.seconds,this._maxPlaybackDrift.seconds*this._playbackRate.rate)&&(this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.PositionOutOfSync,null,{current:p,target:w}),this.emitTriggerAction({action:"catchup",source:"system",clientId:yield(0,l.waitUntilConnected)(this._runtime),local:!0,seekTime:w}));const O=yield(0,l.waitUntilConnected)(this._runtime);if(this.transportState.playbackState!=S){this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.TransportOutOfSync,null,{current:S,target:this.transportState.playbackState});const E=O===this.transportState.current.clientId;switch(this.transportState.playbackState){case"playing":this.emitTriggerAction({action:"play",source:"system",clientId:this.transportState.current.clientId,local:E});break;case"paused":this.emitTriggerAction({action:"pause",source:"system",clientId:this.transportState.current.clientId,local:E});break}}if(JSON.stringify(this.playbackTrackData.data)!=JSON.stringify(g)){this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.TrackDataOutOfSync);const E=O===this.playbackTrackData.current.clientId;this.emitTriggerAction({action:"datachange",source:"system",clientId:this.playbackTrackData.current.clientId,local:E,data:this.playbackTrackData.data})}if(this.playbackRate.rate!=_?.playbackRate){this._logger.sendTelemetryEvent(d.TelemetryEvents.GroupCoordinator.PlaybackRateOutOfSync);const E=O===this.playbackTrackData.current.clientId;this.emitTriggerAction({action:"ratechange",source:"system",clientId:this.playbackTrackData.current.clientId,local:E,playbackRate:this.playbackRate.rate})}}}})}emitSetTrack(m,h,g){return n(this,void 0,void 0,function*(){this._waitPoint=void 0;const _=yield(0,l.waitUntilConnected)(this._runtime);this.emitTriggerAction({action:"settrack",source:g,clientId:m,local:_===m,metadata:h})})}emitTriggerActionOrIgnored(m){return this.isSuspended||this.isWaiting?this.emitTriggerActionIgnored(m):this.emitTriggerAction(m)}emitTriggerAction(m){const h={name:b.triggeraction,details:m};this.emit(b.triggeraction,h)}emitTriggerActionIgnored(m){m.ignoreReason="localusersuspended";const h={name:b.triggeractionignored,details:m};this.emit(b.triggeractionignored,h)}};e.GroupCoordinatorState=C})(Pg)),Pg}var Eg={},lne;function RPe(){if(lne)return Eg;lne=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.ActionBlockedError=Eg.TrackMetadataNotSetError=void 0;class e extends Error{constructor(t,i){super(`${t} -  called before playback track metadata has been assigned.
To fix this error, ensure \`setTrack()\` has been called with the track information before calling \`${i}()\``)}static assert(t,i,r){if(!t)throw new e(i,r)}}Eg.TrackMetadataNotSetError=e;class n extends Error{constructor(t,i,r){super(`${t} - operation blocked due to \`${r}\` being set to false.
To fix this error, ensure \`${r}\` is true before calling \`${i}()\`, or set \`${r}\` to true. If you are using \`MediaPlayerSynchronizer\`, you can instead use the \`viewOnly\`, which when set to false, it will set \`${r}\` value to true.`)}static assert(t,i,r,s){if(!t)throw new n(i,r,s)}}return Eg.ActionBlockedError=n,Eg}var fne;function hL(){return fne||(fne=1,(function(e){var n=Og&&Og.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Og&&Og.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(sue(),e),a(IPe(),e),a(aue(),e),a(xT(),e),a(oue(),e),a(xk(),e),a(cue(),e),a(RPe(),e)})(Og)),Og}var hne;function uue(){return hne||(hne=1,(function(e){var n=wg&&wg.__awaiter||function(d,l,f,b){function C(v){return v instanceof f?v:new f(function(m){m(v)})}return new(f||(f=Promise))(function(v,m){function h(S){try{_(b.next(S))}catch(p){m(p)}}function g(S){try{_(b.throw(S))}catch(p){m(p)}}function _(S){S.done?v(S.value):C(S.value).then(h,g)}_((b=b.apply(d,l||[])).next())})},a=wg&&wg.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(e,"__esModule",{value:!0}),e.MediaPlayerSynchronizer=e.MediaPlayerSynchronizerEvents=void 0;const t=a(Ec()),i=fL(),r=iue(),s=hL(),o=Bs();var u;(function(d){d.coordinatorstatechange="coordinatorstatechange",d.groupaction="groupaction",d.useraction="useraction"})(u=e.MediaPlayerSynchronizerEvents||(e.MediaPlayerSynchronizerEvents={}));let c=class $1 extends t.default{constructor(l,f,b,C){super(),this._viewOnly=!1,this._blockUnexpectedPlayerEvents=!0,this._expectedPlaybackState="none",this._expectedPlaybackRate=1,this._metadata=null,this._trackData=null,this._player=l,this._mediaSession=f,this._runtime=b,this._logger=f.logger,this._volumeManager=new r.VolumeManager(l),this._onEnd=C,f.setRequestPlayerStateHandler(()=>{var v;let m;const h=this._player.currentSrc||this._player.src;return this._player.ended?m="ended":!h||this._player.paused&&this._player.currentTime<1?m="none":this._player.paused?m="paused":m="playing",{metadata:this._metadata&&this._metadata.trackIdentifier===h?this._metadata:{trackIdentifier:h},playbackState:m,positionState:{position:this._player.currentTime,playbackRate:(v=this._player.playbackRate)!==null&&v!==void 0?v:1,duration:this._player.duration},trackData:this._trackData}}),this._onPlayerEvent=v=>{switch(v.type!="timeupdate"&&this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.PlayerEvent,null,{type:v.type}),v.type){case"loadedmetadata":this._player.currentSrc||this._player.src,this._trackData=null;break;case"playing":this._blockUnexpectedPlayerEvents&&this._expectedPlaybackState!="playing"&&this._mediaSession.coordinator.canPlayPause&&this._player.currentTime<1&&(this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.UserTappedVideoToPlay),this.play().catch(m=>{this._logger.sendErrorEvent(s.TelemetryEvents.MediaPlayerSynchronizer.UserTappedVideoToPlayError,m)})),this._blockUnexpectedPlayerEvents&&this._expectedPlaybackState==="paused"&&!this._mediaSession.coordinator.isSuspended&&this._player.pause(),this._blockUnexpectedPlayerEvents&&this._expectedPlaybackState==="none"&&!this._mediaSession.coordinator.isSuspended&&this._player.pause();break;case"pause":this._blockUnexpectedPlayerEvents&&this._expectedPlaybackState==="playing"&&!this._mediaSession.coordinator.isSuspended&&!this._player.ended&&this._player.play();break;case"ratechange":this._blockUnexpectedPlayerEvents&&this._expectedPlaybackRate!==this._player.playbackRate&&!this._mediaSession.coordinator.isSuspended&&(this._player.playbackRate=this._expectedPlaybackRate);break;case"blocked":this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.PlayerBlockedOperation);break}},this._mediaSession.coordinator.on(i.MediaSessionCoordinatorEvents.coordinatorstatechange,v=>this.emit(v.type,v)),this._mediaSession.coordinator.on(i.MediaSessionCoordinatorEvents.triggeractionignored,v=>{this.dispatchGroupAction(v.details,void 0)});for(const v of $1.SESSION_ACTIONS)this._mediaSession.setActionHandler(v,m=>n(this,void 0,void 0,function*(){var h,g,_;let S;try{switch(m.action){case"play":this._expectedPlaybackState="playing",this._player.paused&&(this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.PlayAction),typeof m.seekTime=="number"&&this._player.currentTime<1&&(this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SeekingPlayerToStartPosition,null,{position:m.seekTime}),this._player.currentTime=m.seekTime),yield this._player.play());break;case"pause":this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.PauseAction),this._expectedPlaybackState="paused",typeof m.seekTime=="number"&&this._player.currentTime<1&&(this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SeekingPlayerToStartPosition,null,{position:m.seekTime}),this._player.currentTime=m.seekTime),this._player.pause();break;case"seekto":typeof m.seekTime=="number"&&(this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SeekToAction,null,{position:m.seekTime}),this._player.currentTime=m.seekTime);break;case"settrack":if(this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SetTrackAction),this._expectedPlaybackState="none",this._metadata=(h=m.metadata)!==null&&h!==void 0?h:null,this._player.src===((g=m.metadata)===null||g===void 0?void 0:g.trackIdentifier))break;this._player.src=m.metadata.trackIdentifier,this._player.load();break;case"datachange":this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.DataChangeAction);break;case"ratechange":if(!m.playbackRate)break;this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.RateChangeAction,null,{playbackRate:m.playbackRate}),this._expectedPlaybackRate=m.playbackRate,this._player.playbackRate=m.playbackRate;break;case"catchup":typeof m.seekTime=="number"&&(this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.CatchupAction,null,{position:m.seekTime}),this.catchupPlayer(m.seekTime));break}}catch(p){p instanceof Error?S=p:S=new Error((_=p?.message)!==null&&_!==void 0?_:"An unknown error occurred after processing the group session action.")}this.dispatchGroupAction(m,S)}));for(const v of $1.PLAYER_EVENTS)this._player.addEventListener(v,this._onPlayerEvent);this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SynchronizationStarted)}get player(){return this._player}get mediaSession(){return this._mediaSession}get viewOnly(){return this._viewOnly}set viewOnly(l){this._viewOnly=l,this.mediaSession.coordinator.canPlayPause=!l,this.mediaSession.coordinator.canSeek=!l,this.mediaSession.coordinator.canSetTrack=!l,this.mediaSession.coordinator.canSetTrackData=!l,this.mediaSession.coordinator.canSetPlaybackRate=!l}get blockUnexpectedPlayerEvents(){return this._blockUnexpectedPlayerEvents}set blockUnexpectedPlayerEvents(l){this._blockUnexpectedPlayerEvents=l}get volumeManager(){return this._volumeManager}addEventListener(l,f){return this.on(l,f),this}removeEventListener(l,f){return this.off(l,f),this}end(){if(this._onEnd)try{for(const l of $1.SESSION_ACTIONS)this._mediaSession.setActionHandler(l,null);for(const l of $1.PLAYER_EVENTS)this._player.removeEventListener(l,this._onPlayerEvent);this._onEnd()}finally{this._onEnd=void 0}}beginSeek(){if(this._seekSuspension)throw new Error("MediaPlayerSynchronizer:beginSeek - cannot begin seek since a seek is already in progress.\nTo prevent this error, ensure you first call `endSeek()` before calling `beginSeek()` again.");this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.BeginSeekCalled),this._seekSuspension=this._mediaSession.coordinator.beginSuspension()}endSeek(l){if(!this._seekSuspension)throw new Error("MediaPlayerSynchronizer:endSeek - cannot end seek while no seek is in progress.\nTo prevent this error, ensure you first call `beginSeek()`.");this._player.currentTime=l;const f=this._seekSuspension;this._seekSuspension=void 0,this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.EndSeekCalled,null,{position:l}),f.end(l),(0,o.waitUntilConnected)(this._runtime).then(b=>{this.dispatchUserAction({action:"seekto",source:"user",clientId:b,local:!0,seekTime:l})})}play(){return n(this,void 0,void 0,function*(){this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.PlayCalled),this._expectedPlaybackState="playing",yield this._mediaSession.coordinator.play(),this.dispatchUserAction({action:"play",source:"user",clientId:yield(0,o.waitUntilConnected)(this._runtime),local:!0})})}pause(){return n(this,void 0,void 0,function*(){this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.PauseCalled),this._expectedPlaybackState="paused",yield this._mediaSession.coordinator.pause(),this.dispatchUserAction({action:"pause",source:"user",clientId:yield(0,o.waitUntilConnected)(this._runtime),local:!0})})}seekTo(l){return n(this,void 0,void 0,function*(){this._player.currentTime=l,this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SeekToCalled,null,{position:l}),yield this._mediaSession.coordinator.seekTo(l),this.dispatchUserAction({action:"seekto",source:"user",clientId:yield(0,o.waitUntilConnected)(this._runtime),seekTime:l,local:!0})})}setPlaybackRate(l){return n(this,void 0,void 0,function*(){this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.RateChangeCalled,null,{playbackRate:l}),yield this._mediaSession.coordinator.setPlaybackRate(l),this.dispatchUserAction({action:"ratechange",source:"user",clientId:yield(0,o.waitUntilConnected)(this._runtime),local:!0,playbackRate:l})})}setTrack(l,f){return n(this,void 0,void 0,function*(){this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SetTrackCalled),yield this._mediaSession.coordinator.setTrack(l,f),this.dispatchUserAction({action:"settrack",source:"user",clientId:yield(0,o.waitUntilConnected)(this._runtime),metadata:l,local:!0})})}setTrackData(l){return n(this,void 0,void 0,function*(){this._logger.sendTelemetryEvent(s.TelemetryEvents.MediaPlayerSynchronizer.SetTrackDataCalled),this._trackData=l,yield this._mediaSession.coordinator.setTrackData(l),this.dispatchUserAction({action:"datachange",source:"user",clientId:yield(0,o.waitUntilConnected)(this._runtime),local:!0,data:l})})}dispatchGroupAction(l,f){this.emit(u.groupaction,{type:u.groupaction,details:l,error:f})}dispatchUserAction(l){this.emit(u.useraction,{type:u.useraction,details:l})}catchupPlayer(l){return n(this,void 0,void 0,function*(){this._player.currentTime=l})}};c.SESSION_ACTIONS=["play","pause","seekto","settrack","ratechange","datachange","catchup","wait"],c.PLAYER_EVENTS=["playing","pause","ratechange","timeupdate","ended","loadedmetadata","blocked"],e.MediaPlayerSynchronizer=c})(wg)),wg}var sd={},F1={},mne;function due(){if(mne)return F1;mne=1,Object.defineProperty(F1,"__esModule",{value:!0}),F1.LiveMediaSessionCoordinatorSuspension=void 0;let e=class{constructor(a,t){this._waitPoint=a,this._onEnd=t}get waitPoint(){return this._waitPoint}end(a){this._onEnd(a)}};return F1.LiveMediaSessionCoordinatorSuspension=e,F1}var pne;function lue(){if(pne)return sd;pne=1;var e=sd&&sd.__awaiter||function(u,c,d,l){function f(b){return b instanceof d?b:new d(function(C){C(b)})}return new(d||(d=Promise))(function(b,C){function v(g){try{h(l.next(g))}catch(_){C(_)}}function m(g){try{h(l.throw(g))}catch(_){C(_)}}function h(g){g.done?b(g.value):f(g.value).then(v,m)}h((l=l.apply(u,c||[])).next())})},n=sd&&sd.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(sd,"__esModule",{value:!0}),sd.LiveMediaSessionCoordinator=void 0;const a=Wo(),t=hL(),i=due(),r=n(Ec()),s=Bs();let o=class extends r.default{constructor(c,d,l,f){super(),this._positionUpdateInterval=new a.TimeInterval(2e3),this._maxPlaybackDrift=new a.TimeInterval(1e3),this.initializeState=a.LiveDataObjectInitializeState.needed,this.canPlayPause=!0,this.canSeek=!0,this.canSetTrack=!0,this.canSetTrackData=!0,this.canSetPlaybackRate=!0,this.canSendPositionUpdates=!0,this._id=c,this._runtime=d,this._liveRuntime=l,this._logger=new a.LiveTelemetryLogger(d,l),this._getPlayerState=f}get isSuspended(){return this._groupState?this._groupState.isSuspended:!1}get maxPlaybackDrift(){return this._maxPlaybackDrift.seconds}set maxPlaybackDrift(c){this._maxPlaybackDrift.seconds=c}get positionUpdateInterval(){return this._positionUpdateInterval.seconds}set positionUpdateInterval(c){this._positionUpdateInterval.seconds=c}play(){var c;return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:play","play",this.initializeState),t.TrackMetadataNotSetError.assert(!!(!((c=this._groupState)===null||c===void 0)&&c.playbackTrack.current.metadata),"LiveMediaSessionCoordinator:play","play"),t.ActionBlockedError.assert(this.canPlayPause,"LiveMediaSessionCoordinator:play","play","canPlayPause");const d=this.getPlayerPosition();this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.PlayCalled,null,{position:d}),yield this._playEvent.sendEvent({track:this._groupState.playbackTrack.current,position:d})})}pause(){var c;return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:pause","pause",this.initializeState),t.TrackMetadataNotSetError.assert(!!(!((c=this._groupState)===null||c===void 0)&&c.playbackTrack.current.metadata),"LiveMediaSessionCoordinator:pause","pause"),t.ActionBlockedError.assert(this.canPlayPause,"LiveMediaSessionCoordinator:pause","pause","canPlayPause");const d=this.getPlayerPosition();this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.PauseCalled,null,{position:d}),yield this._pauseEvent.sendEvent({track:this._groupState.playbackTrack.current,position:d})})}seekTo(c){var d;return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:seekTo","seekTo",this.initializeState),t.TrackMetadataNotSetError.assert(!!(!((d=this._groupState)===null||d===void 0)&&d.playbackTrack.current.metadata),"LiveMediaSessionCoordinator:seekTo","seekTo"),t.ActionBlockedError.assert(this.canSeek,"LiveMediaSessionCoordinator:seekTo","seekTo","canSeek"),this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.SeekToCalled,null,{position:c});try{yield this._seekToEvent.sendEvent({track:this._groupState.playbackTrack.current,position:c})}catch(l){throw yield this._groupState.syncLocalMediaSession(),l}})}setPlaybackRate(c){return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:setPlaybackRate","setPlaybackRate",this.initializeState),t.ActionBlockedError.assert(this.canSetPlaybackRate,"LiveMediaSessionCoordinator:setPlaybackRate","setPlaybackRate","canSetPlaybackRate"),this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.SetPlaybackRateCalled,null,{playbackRate:c}),yield this._rateChangeEvent.sendEvent({playbackRate:c})})}setTrack(c,d){return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:setTrack","setTrack",this.initializeState),t.ActionBlockedError.assert(this.canSetTrack,"LiveMediaSessionCoordinator:setTrack","setTrack","canSetTrack"),this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.SetTrackCalled),yield this._setTrackEvent.sendEvent({metadata:c,waitPoints:d||[]})})}setTrackData(c){return e(this,void 0,void 0,function*(){a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:setTrackData","setTrackData",this.initializeState),t.ActionBlockedError.assert(this.canSetTrackData,"LiveMediaSessionCoordinator:setTrackData","setTrackData","canSetTrackData"),this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.SetTrackDataCalled),yield this._setTrackDataEvent.sendEvent({data:c})})}beginSuspension(c){var d;return a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:beginSuspension","beginSuspension",this.initializeState),t.TrackMetadataNotSetError.assert(!!(!((d=this._groupState)===null||d===void 0)&&d.playbackTrack.current.metadata),"LiveMediaSessionCoordinator:beginSuspension","beginSuspension"),c?(this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.BeginSuspensionAndWait,null,{position:c.position,maxClients:c.maxClients}),this._lastWaitPoint=c,this._groupState.beginSuspension(c)):(this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.BeginSuspension),this._groupState.beginSuspension()),new i.LiveMediaSessionCoordinatorSuspension(c,l=>{var f,b;c?this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.EndSuspensionAndWait,null,{position:c.position,maxClients:c.maxClients}):this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.EndSuspension),this._groupState.endSuspension(l==null),l!=null&&!(!((f=this._groupState)===null||f===void 0)&&f.isSuspended)&&!(!((b=this._groupState)===null||b===void 0)&&b.isWaiting)&&this.seekTo(Math.max(l,0))})}get isInitialized(){return this.initializeState===a.LiveDataObjectInitializeState.succeeded}initialize(c){var d;return e(this,void 0,void 0,function*(){a.LiveDataObjectInitializeNotNeededError.assert("LiveMediaSessionCoordinator:initialize",this.initializeState),this.initializeState=a.LiveDataObjectInitializeState.pending;try{yield this.createChildren(c)}catch(l){throw this.initializeState=a.LiveDataObjectInitializeState.needed,l}this.initializeState=a.LiveDataObjectInitializeState.succeeded;try{yield(d=this._synchronizer)===null||d===void 0?void 0:d.start(void 0,(l,f,b)=>e(this,void 0,void 0,function*(){return!1}),l=>e(this,void 0,void 0,function*(){return!0}),!1,!1)}catch(l){this._logger.sendErrorEvent(t.TelemetryEvents.SessionCoordinator.LiveObjectSynchronizerStartError,l)}})}findNextWaitPoint(){var c;return((c=this._groupState)===null||c===void 0?void 0:c.playbackTrack.findNextWaitPoint(this._lastWaitPoint))||null}sendPositionUpdate(c){var d,l;if(a.LiveDataObjectNotInitializedError.assert("LiveMediaSessionCoordinator:sendPositionUpdate","sendPositionUpdate",this.initializeState),this.canSendPositionUpdates){const f=this._groupState.createPositionUpdateEvent(c);(d=this._positionUpdateEvent)===null||d===void 0||d.sendEvent(f).catch(b=>{this._logger.sendErrorEvent(t.TelemetryEvents.SessionCoordinator.PositionUpdateEventError,b)})}else if(this.isSuspended){const f=this._groupState.createPositionUpdateEvent(c);(l=this._positionUpdateEvent)===null||l===void 0||l.sendLocalEvent(f).catch(b=>{this._logger.sendErrorEvent(t.TelemetryEvents.SessionCoordinator.PositionUpdateEventError,b)})}else this._groupState.syncLocalMediaSession()}createChildren(c){return e(this,void 0,void 0,function*(){const d=new a.LiveEventScope(this._runtime,this._liveRuntime,c),l=new a.LiveEventScope(this._runtime,this._liveRuntime);this._groupState=new t.GroupCoordinatorState(this._runtime,this._liveRuntime,this._maxPlaybackDrift,this._positionUpdateInterval,this._getPlayerState),this._groupState.on(t.GroupCoordinatorStateEvents.triggeraction,f=>this.emit(f.name,f)),this._groupState.on(t.GroupCoordinatorStateEvents.triggeractionignored,f=>this.emit(f.name,f)),this._setTrackEvent=new a.LiveEventTarget(d,"setTrack",(f,b)=>this._groupState.handleSetTrack(f,b)),this._setTrackDataEvent=new a.LiveEventTarget(d,"setTrackData",(f,b)=>this._groupState.handleSetTrackData(f,b)),this._playEvent=new a.LiveEventTarget(d,"play",(f,b)=>this._groupState.handleTransportCommand(f,b)),this._pauseEvent=new a.LiveEventTarget(d,"pause",(f,b)=>this._groupState.handleTransportCommand(f,b)),this._seekToEvent=new a.LiveEventTarget(d,"seekTo",(f,b)=>this._groupState.handleTransportCommand(f,b)),this._rateChangeEvent=new a.LiveEventTarget(d,"rateChange",(f,b)=>{this._groupState.handleRateChangeCommand(f,b)}),this._positionUpdateEvent=new a.LiveEventTarget(l,"positionUpdate",(f,b)=>this._groupState.handlePositionUpdate(f,b)),this._synchronizer=new a.LiveObjectSynchronizer(this._id,this._runtime,this._liveRuntime),this._synchronizer.onJoinedListener=(f,b)=>{this._logger.sendTelemetryEvent(t.TelemetryEvents.SessionCoordinator.RemoteConnectReceived,null,{correlationId:a.LiveTelemetryLogger.formatCorrelationId(f,b)});try{const C=this._getPlayerState();this.sendPositionUpdate(C)}catch(C){if(!((0,s.isErrorLike)(C)&&C.message.includes("LiveMediaSession:getCurrentPlayerState")))throw C}}})}getPlayerPosition(){const{positionState:c,playbackState:d}=this._getPlayerState();switch(d){case"none":case"ended":return 0;default:return c&&c.position!=null?c.position:0}}};return sd.LiveMediaSessionCoordinator=o,sd}var j1={},M1={},gne;function fue(){if(gne)return M1;gne=1,Object.defineProperty(M1,"__esModule",{value:!0}),M1.MediaSessionActionThrottler=void 0;let e=class{};return M1.MediaSessionActionThrottler=e,M1}var yne;function mue(){if(yne)return j1;yne=1,Object.defineProperty(j1,"__esModule",{value:!0}),j1.RepeatedActionThrottler=void 0;const e=Wo(),n=fue();let a=class hue extends n.MediaSessionActionThrottler{constructor(){super(...arguments),this._repeatInterval=new e.TimeInterval(2e3)}get repeatInterval(){return this._repeatInterval.seconds}set repeatInterval(i){this._repeatInterval.seconds=i}throttled(i,r){if(r)if(hue.FILTERED_ACTIONS.indexOf(i.action)>=0){const s=this.getChangeKey(i),o=new Date().getTime();this._lastActionSent&&s==this._lastActionSent?o-this._lastActionSentTime>=this._repeatInterval.milliseconds&&(r(i),this._lastActionSentTime=o):(r(i),this._lastActionSent=s,this._lastActionSentTime=o)}else r(i)}getChangeKey(i){switch(i.action){case"seekto":return`seekto:${i.seekTime}`;default:return i.action}}};return a.FILTERED_ACTIONS=["play","pause","seekto","catchup"],j1.RepeatedActionThrottler=a,j1}var bne;function FPe(){if(bne)return Tg;bne=1;var e=Tg&&Tg.__awaiter||function(c,d,l,f){function b(C){return C instanceof l?C:new l(function(v){v(C)})}return new(l||(l=Promise))(function(C,v){function m(_){try{g(f.next(_))}catch(S){v(S)}}function h(_){try{g(f.throw(_))}catch(S){v(S)}}function g(_){_.done?C(_.value):b(_.value).then(m,h)}g((f=f.apply(c,d||[])).next())})};Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.LiveMediaSession=void 0;const n=$o(),a=Wo(),t=uue(),i=hL(),r=fL(),s=lue(),o=mue();let u=class extends a.LiveDataObject{constructor(){super(...arguments),this._actionThrottler=new o.RepeatedActionThrottler,this._actionHandlers=new Map,this._lastUpdateTime=0}get actionThrottler(){return this._actionThrottler}set actionThrottler(d){this._actionThrottler=d}get coordinator(){return this._coordinator}get logger(){return this._logger}initialize(d){return e(this,void 0,void 0,function*(){a.LiveDataObjectInitializeNotNeededError.assert("LiveMediaSession:initialize",this.initializeState),this.initializeState=a.LiveDataObjectInitializeState.pending,d&&(this._allowedRoles=d);try{yield this.coordinator.initialize(d)}catch(l){throw this.initializeState=a.LiveDataObjectInitializeState.needed,l}this.initializeState=a.LiveDataObjectInitializeState.succeeded})}setActionHandler(d,l){l?this._actionHandlers.set(d,l):this._actionHandlers.has(d)&&this._actionHandlers.delete(d)}setRequestPlayerStateHandler(d){this._requestPlayerStateHandler=d}synchronize(d){return this._synchronizing&&this._synchronizing.end(),this._updateTimer||(this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.BeginPositionUpdateTimer),this._updateTimer=setInterval(()=>{const l=this.getCurrentPlayerState();this.checkWaitPointHit(l);const f=new Date().getTime(),b=(f-this._lastUpdateTime)/1e3;this.coordinator.isInitialized&&b>=this.coordinator.positionUpdateInterval&&(this._lastUpdateTime=f,this.coordinator.sendPositionUpdate(l))},500)),new t.MediaPlayerSynchronizer(d,this,this.runtime,()=>{this._synchronizing=void 0})}hasInitialized(){return e(this,void 0,void 0,function*(){this._logger=new a.LiveTelemetryLogger(this.runtime,this.liveRuntime),this._coordinator=new s.LiveMediaSessionCoordinator(this.id,this.runtime,this.liveRuntime,()=>this.getCurrentPlayerState()),this._coordinator.on(r.MediaSessionCoordinatorEvents.triggeraction,d=>{const l=d.details,f=typeof l.seekTime=="number"?l.seekTime:-1;switch(l.action){case"play":this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.PlayAction,null,{position:f});break;case"pause":this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.PauseAction,null,{position:f});break;case"ratechange":if(!l.playbackRate)break;this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.RateChangeAction,null,{playbackRate:l.playbackRate});break;case"seekto":this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.SeekToAction,null,{position:f});break;case"settrack":this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.SetTrackAction);break;case"datachange":this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.DataChangeAction);break;case"catchup":this.logger.sendTelemetryEvent(i.TelemetryEvents.MediaSession.CatchUpAction,null,{position:f}),this._actionHandlers.has("catchup")||(l.action="seekto");break}this.dispatchAction(l)})})}checkWaitPointHit(d){if(d.positionState&&this.coordinator.isInitialized){const l=this.coordinator.findNextWaitPoint();if(l&&d.positionState.position!=null&&d.positionState.position>=l.position){if(!this._actionHandlers.has("wait"))throw new Error("LiveMediaSession:checkWaitPointHit - wait point hit but no 'wait' action registered.\nTo fix this error, set a `wait` action using the `setActionHandler()` function.");this.waitUntilConnected().then(f=>{const b=this.coordinator.beginSuspension(l);this.dispatchAction({action:"wait",source:"system",clientId:f,local:!0,suspension:b})})}}}getCurrentPlayerState(){if(!this._requestPlayerStateHandler)throw new Error("LiveMediaSession:getCurrentPlayerState - no `requestPlayerStateHandler` callback configured.\nTo fix this error, ensure `setRequestPlayerStateHandler()` has been set with a delegate to retrieve your player's state, or use the `synchronize()` function to create a new `MediaPlayerSynchronizer` instance tied to your `IMediaPlayer` instance.");return this._requestPlayerStateHandler()}dispatchAction(d){if(this._actionHandlers.has(d.action)){const l=this._actionHandlers.get(d.action);this._actionThrottler.throttled(d,l)}}};return u.TypeName="@microsoft/fluid-media:SharedMediaSession",u.factory=new n.DataObjectFactory(u.TypeName,u,[],{}),Tg.LiveMediaSession=u,a.DynamicObjectRegistry.registerObjectClass(u,u.TypeName),Tg}var sk={},vne;function jPe(){return vne||(vne=1,Object.defineProperty(sk,"__esModule",{value:!0})),sk}var Sne;function MPe(){return Sne||(Sne=1,(function(e){var n=_g&&_g.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=_g&&_g.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(FPe(),e),a(lue(),e),a(due(),e),a(jPe(),e),a(uue(),e),a(fue(),e),a(fL(),e),a(mue(),e),a(iue(),e)})(_g)),_g}MPe();/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 *//*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */var Ig={},Rg={},Bo={},ak={},Fg={},N1={},Cne;function NPe(){if(Cne)return N1;Cne=1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */return Object.defineProperty(N1,"__esModule",{value:!0}),N1.TelemetryEvents=void 0,N1.TelemetryEvents={LiveCanvas:{PointerMovedEventError:"LiveCanvas:PointerMovedEventError",AddWetStrokeEventError:"LiveCanvas:AddWetStrokeEventError",BeginWetStrokeError:"LiveCanvas:BeginWetStrokeError"}},N1}var pn={},_ne;function APe(){if(_ne)return pn;_ne=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.computeEndArrow=pn.getSegmentIntersectionsWithRectangle=pn.getSegmentsIntersection=pn.segmentMayIntersectWithRectangle=pn.getRectangleSegments=pn.segmentsMayIntersect=pn.doRectanglesOverlap=pn.isRectangleInsideRectangle=pn.isPointInsideRectangle=pn.makeRectangle=pn.renderQuadPathToSVG=pn.renderFilledSVGRectangle=pn.renderFilledSVGCircle=pn.renderFilledSVGPath=pn.computeQuadPath=pn.computeQuadBetweenTwoRectangles=pn.computeQuadBetweenTwoCircles=pn.forceIntoRange=pn.isInRange=pn.generateUniqueId=pn.TWO_PI=void 0;const e=ys(),n=PI();pn.TWO_PI=Math.PI*2;const a=1e-6;function t(){return(0,e.v4)()}pn.generateUniqueId=t;function i(E,F,R){const M=Math.min(F,R)-a,j=Math.max(F,R)+a;return E>=M&&E<=j}pn.isInRange=i;function r(E,F,R){return E<F?F:E>R?R:E}pn.forceIntoRange=r;function s(E,F,R,M){const j=R.x-E.x,k=R.y-E.y,x=Math.sqrt(j*j+k*k);if(x<=Math.abs(M-F))return;const L=j/x,V=-k/x,G=(M-F)/x,ee=Math.sqrt(1-G*G),se=V*ee+L*G,re=L*ee-V*G,fe=V*ee-L*G,oe=L*ee+V*G;return{p1:{x:E.x-se*F,y:E.y-re*F},p2:{x:R.x-se*M,y:R.y-re*M},p3:{x:R.x+fe*M,y:R.y+oe*M},p4:{x:E.x+fe*F,y:E.y+oe*F}}}pn.computeQuadBetweenTwoCircles=s;function o(E,F,R,M,j,k){const x=E.x-F,L=E.y-R,V=E.x+F,G=E.y+R,ee=M.x-j,se=M.y-k,re=M.x+j,fe=M.y+k;if(ee>=x&&se>=L&&re<=V&&fe<=G||x>=ee&&L>=se&&V<=re&&G<=fe)return;const oe=M.x-E.x>0?1:-1,pe=M.y-E.y>0?1:-1;return{p1:{x:E.x-pe*F,y:E.y+oe*R},p2:{x:E.x+pe*F,y:E.y-oe*R},p3:{x:M.x+pe*j,y:M.y-oe*k},p4:{x:M.x-pe*j,y:M.y+oe*k}}}pn.computeQuadBetweenTwoRectangles=o;function u(E,F,R,M){const j=[],k=M/2;if(F<E.length){let x,L=0;F>0&&(x=E[F-1],L=(0,n.getPressureAdjustedSize)(k,x.pressure));for(let V=F;V<E.length;V++){const G=E[V];let ee=(0,n.getPressureAdjustedSize)(k,G.pressure);const se={endPoint:G,tipSize:ee};x!==void 0&&(se.quad=R==="ellipse"?s(G,ee,x,L):o(G,ee,ee,x,L,L)),j.push(se),x=G,L=ee}}return j}pn.computeQuadPath=u;function c(E){return E.toFixed(5)}function d(E,F){let R="";for(let M=0;M<E.length;M++){const j=M===0?"M":"L",k=E[M];R+=`${j}${c(k.x)} ${c(k.y)}`}return`<path d="${R}" fill="${(0,n.toCssRgbaColor)(F)}"/>`}pn.renderFilledSVGPath=d;function l(E,F,R){return`<circle cx="${c(E.x)}" cy="${c(E.y)}" r="${c(F)}" fill="${(0,n.toCssRgbaColor)(R)}"/>`}pn.renderFilledSVGCircle=l;function f(E,F,R,M){const j=E.x-F,k=E.x+F,x=E.y-R,L=E.y+R;return d([{x:j,y:x},{x:k,y:x},{x:k,y:L},{x:j,y:L}],M)}pn.renderFilledSVGRectangle=f;function b(E,F,R){let M="";for(let j of E)j.quad!==void 0&&(M+=d([j.quad.p1,j.quad.p2,j.quad.p3,j.quad.p4],R)),F==="ellipse"?M+=l(j.endPoint,j.tipSize,R):M+=f(j.endPoint,j.tipSize,j.tipSize,R);return M}pn.renderQuadPathToSVG=b;function C(E,F,R){const M=F/2,j=R/2;return{left:E.x-M,top:E.y-j,right:E.x+M,bottom:E.y+j}}pn.makeRectangle=C;function v(E,F){return i(E.x,F.left,F.right)&&i(E.y,F.top,F.bottom)}pn.isPointInsideRectangle=v;function m(E,F){const R={x:E.left,y:E.top},M={x:E.right,y:E.top},j={x:E.left,y:E.bottom},k={x:E.right,y:E.bottom};return v(R,F)&&v(M,F)&&v(j,F)&&v(k,F)}pn.isRectangleInsideRectangle=m;function h(E,F){const R=(M,j)=>{const k={x:M.left,y:M.top},x={x:M.right,y:M.top},L={x:M.left,y:M.bottom},V={x:M.right,y:M.bottom};return v(k,j)||v(x,j)||v(L,j)||v(V,j)};return R(E,F)||R(F,E)}pn.doRectanglesOverlap=h;function g(E,F){const R={from:{x:Math.min(E.from.x,E.to.x),y:Math.min(E.from.y,E.to.y)},to:{x:Math.max(E.from.x,E.to.x),y:Math.max(E.from.y,E.to.y)}},M={from:{x:Math.min(F.from.x,F.to.x),y:Math.min(F.from.y,F.to.y)},to:{x:Math.max(F.from.x,F.to.x),y:Math.max(F.from.y,F.to.y)}};return!(R.to.x<M.from.x||R.from.x>M.to.x||R.to.y<M.from.y||R.from.y>M.to.y)}pn.segmentsMayIntersect=g;function _(E){return[{from:{x:E.left,y:E.top},to:{x:E.right,y:E.top}},{from:{x:E.right,y:E.top},to:{x:E.right,y:E.bottom}},{from:{x:E.right,y:E.bottom},to:{x:E.left,y:E.bottom}},{from:{x:E.left,y:E.bottom},to:{x:E.left,y:E.top}}]}pn.getRectangleSegments=_;function S(E,F){const R=_(F);for(let M of R)if(g(E,M))return!0;return!1}pn.segmentMayIntersectWithRectangle=S;function p(E,F){const R=E.to.y-E.from.y,M=E.from.x-E.to.x,j=F.to.y-F.from.y,k=F.from.x-F.to.x,x=R*k-j*M;if(x===0)return;const L=j*F.from.x+k*F.from.y,V=R*E.from.x+M*E.from.y,G=1/x,ee={x:(k*V-M*L)*G,y:(R*L-j*V)*G};if(i(ee.x,E.from.x,E.to.x)&&i(ee.x,F.from.x,F.to.x)&&i(ee.y,E.from.y,E.to.y)&&i(ee.y,F.from.y,F.to.y))return ee}pn.getSegmentsIntersection=p;function w(E,F){const R=[],M=_(F);for(let j of M){const k=p(E,j);if(k){let x=!1;for(const L of R)if(L.x===k.x&&L.y===k.y){x=!0;break}x||R.push(k)}}return R}pn.getSegmentIntersectionsWithRectangle=w;function O(E,F,R=20){const M=F.x-E.x,j=F.y-E.y,k=Math.sqrt(M*M+j*j),x=M/k,L=j/k;return[{x:F.x-R*(x-L),y:F.y-R*(L+x)},F,{x:F.x-R*(x+L),y:F.y-R*(L-x)}]}return pn.computeEndArrow=O,pn}var Tne;function Cb(){return Tne||(Tne=1,(function(e){var n=Fg&&Fg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Fg&&Fg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(NPe(),e),a(APe(),e)})(Fg)),Fg}var wne;function mL(){return wne||(wne=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HighlighterColors=e.PenColors=e.BasicColors=e.darkenColor=e.lightenColor=e.fromCssColor=e.toCssRgbaColor=void 0;const n=Cb();function a(s,o=1){const u=(0,n.forceIntoRange)(s.r,0,255),c=(0,n.forceIntoRange)(s.g,0,255),d=(0,n.forceIntoRange)(s.b,0,255),l=(0,n.forceIntoRange)(o,0,1);return`rgba(${u},${c},${d},${l})`}e.toCssRgbaColor=a;function t(s){if(s){const u=/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/gi.exec(s);if(u){const c=parseInt(u[1],16),d=parseInt(u[2],16),l=parseInt(u[3],16);return{r:c,g:d,b:l}}}return e.PenColors.black}e.fromCssColor=t;function i(s,o){if(o<0||o>100)return s;const u=c=>{const d=255-c;return c+Math.round(d/100*o)};return{r:u(s.r),g:u(s.g),b:u(s.b)}}e.lightenColor=i;function r(s,o){if(o<0||o>100)return s;const u=c=>c-Math.round(c/100*o);return{r:u(s.r),g:u(s.g),b:u(s.b)}}e.darkenColor=r,e.BasicColors={black:t("#000000"),white:t("#ffffff"),gray:t("#808080"),silver:t("#c0c0c0"),red:t("#ff0000"),green:t("#008000"),blue:t("#0000ff"),yellow:t("#ffff00"),magenta:t("#ea33f6"),violet:t("#8719cc"),purple:t("#76147d")},e.PenColors={yellow:t("#ffc114"),orange:t("#f6630d"),pink:t("#ff0066"),red:t("#e71224"),indigo:t("#5b2d90"),purple:t("#ab008b"),plum:t("#cc0066"),darkBlue:t("#004f8b"),skyBlue:t("#00a0d7"),lightBlue:t("#33ccff"),green:t("#008c3a"),lightGreen:t("#66cc00"),black:t("#000000"),darkGray:t("#333333"),lightGray:t("#849398"),white:t("#ffffff")},e.HighlighterColors={yellow:t("#fffc00"),lime:t("#00f900"),aqua:t("#00fdff"),Pink:t("#ff40ff"),orange:t("#ff8517"),lightGreen:t("#a2d762"),paleBlue:t("#a9d8ff"),rose:t("#ffacd5"),crimson:t("#ef0c4d"),green:t("#00b44b"),blue:t("#0069af"),lavender:t("#d9aeff"),red:t("#ff2500"),lightGray:t("#e6e6e6"),gray:t("#969696"),black:t("#000000")}})(ak)),ak}var One;function pL(){if(One)return Bo;One=1,Object.defineProperty(Bo,"__esModule",{value:!0}),Bo.DefaultLaserPointerBrush=Bo.DefaultHighlighterBrush=Bo.DefaultLineBrush=Bo.DefaultPenBrush=void 0;const e=mL();return Bo.DefaultPenBrush={type:"pen",color:e.PenColors.black,tip:"ellipse",tipSize:10},Bo.DefaultLineBrush={type:"pen",color:e.PenColors.black,tip:"ellipse",tipSize:10},Bo.DefaultHighlighterBrush={type:"highlighter",color:e.HighlighterColors.yellow,tip:"rectangle",tipSize:10},Bo.DefaultLaserPointerBrush={type:"laser",color:e.BasicColors.red,tip:"ellipse",tipSize:10},Bo}var es={},Pne;function OI(){if(Pne)return es;Pne=1,Object.defineProperty(es,"__esModule",{value:!0}),es.viewportToScreen=es.screenToViewport=es.getSquaredDistanceBetweenPoints=es.getDistanceBetweenPoints=es.combineRects=es.expandRect=es.getPressureAdjustedSize=void 0;function e(o,u){return o*(u*1.5+.25)}es.getPressureAdjustedSize=e;function n(o,u){return{left:Math.min(o.left,u.x),right:Math.max(o.right,u.x),top:Math.min(o.top,u.y),bottom:Math.max(o.bottom,u.y)}}es.expandRect=n;function a(o,u){return{left:Math.min(o.left,u.left),top:Math.min(o.top,u.top),right:Math.max(o.right,u.right),bottom:Math.max(o.bottom,u.bottom)}}es.combineRects=a;function t(o,u){return Math.hypot(u.x-o.x,u.y-o.y)}es.getDistanceBetweenPoints=t;function i(o,u){return(u.x-o.x)*(u.x-o.x)+(u.y-o.y)*(u.y-o.y)}es.getSquaredDistanceBetweenPoints=i;function r(o,u,c,d){const l=d>0?d:1;return{x:(o.x-c.x-u.x)/l,y:(o.y-c.y-u.y)/l}}es.screenToViewport=r;function s(o,u,c,d){const l=d>0?d:1;return{x:o.x*l+u.x+c.x,y:o.y*l+u.y+c.y}}return es.viewportToScreen=s,es}var ok={},jg={},ad={},A1={},Ene;function pue(){if(Ene)return A1;Ene=1,Object.defineProperty(A1,"__esModule",{value:!0}),A1.InkingCanvas=void 0;const e=PI(),n=Cb();let a=class qk{render(){this.internalRender()}createLayer(){const i=document.createElement("canvas");i.style.position="absolute",i.style.touchAction="none";const r={alpha:!0,desynchronized:!1},s=i.getContext("2d",r);if(s===null)throw new Error("Could not get 2D context from canvas.");return s}resizeLayer(i,r,s){i.canvas.style.width=`${r}px`,i.canvas.style.height=`${s}px`,i.canvas.width=r*window.devicePixelRatio,i.canvas.height=s*window.devicePixelRatio,i.scale(window.devicePixelRatio,window.devicePixelRatio)}addLayerToDOM(i){this._parentElement&&(this._parentElement.appendChild(i.canvas),this.resizeLayer(i,this.clientDimensions.width,this.clientDimensions.height))}removeLayerFromDOM(i){this._parentElement&&this._parentElement.removeChild(i.canvas)}get clientDimensions(){if(!this._clientDimensions){const i=this._parentElement?this._parentElement.clientWidth:100,r=this._parentElement?this._parentElement.clientHeight:100;this._clientDimensions={width:i,height:r,halfWidth:i*.5,halfHeight:r*.5}}return this._clientDimensions}scheduleRender(){this._renderTimeout&&window.cancelAnimationFrame(this._renderTimeout);const i=()=>{this.render(),this._renderTimeout=void 0};this._renderTimeout=window.requestAnimationFrame(i)}viewportToScreen(i){return Object.assign(Object.assign({},(0,e.viewportToScreen)(i,this.referencePoint==="center"?{x:this.clientDimensions.halfWidth,y:this.clientDimensions.halfHeight}:{x:0,y:0},this.offset,this.scale)),{pressure:i.pressure})}rendersAsynchronously(){return!0}numsToIPointerPoint(i,r){return{x:i,y:r}}moveTo(i,r){const s=this.viewportToScreen(r);i.moveTo(s.x,s.y)}lineTo(i,r){const s=this.viewportToScreen(r);i.lineTo(s.x,s.y)}renderRectangle(i,r,s,o){const u=r.x-s,c=r.x+s,d=r.y-o,l=r.y+o;this.moveTo(i,this.numsToIPointerPoint(u,d)),this.lineTo(i,this.numsToIPointerPoint(c,d)),this.lineTo(i,this.numsToIPointerPoint(c,l)),this.lineTo(i,this.numsToIPointerPoint(u,l)),this.lineTo(i,this.numsToIPointerPoint(u,d))}renderQuad(i,r){this.moveTo(i,this.numsToIPointerPoint(r.p1.x,r.p1.y)),this.lineTo(i,this.numsToIPointerPoint(r.p2.x,r.p2.y)),this.lineTo(i,this.numsToIPointerPoint(r.p3.x,r.p3.y)),this.lineTo(i,this.numsToIPointerPoint(r.p4.x,r.p4.y)),this.lineTo(i,this.numsToIPointerPoint(r.p1.x,r.p1.y))}renderCircle(i,r,s){const o=this.viewportToScreen(r);i.arc(o.x,o.y,s*this._scale,0,n.TWO_PI)}addLayer(){const i=this.createLayer();return this._additionalLayers.add(i),this.addLayerToDOM(i),i}removeLayer(i){this.removeLayerFromDOM(i),this._additionalLayers.delete(i)}get context(){return this._context}constructor(i){this._parentElement=i,this._additionalLayers=new Set,this._strokeStarted=!1,this._offset={x:0,y:0},this._scale=1,this.referencePoint="center",this._context=this.createLayer(),this.addLayerToDOM(this._context)}fadeOut(){let i=.9;const r=()=>{i>0?(this.canvas.style.opacity=i.toString(),this._additionalLayers.forEach(s=>{s.canvas.style.opacity=i.toString()}),window.setTimeout(r,qk.fadeOutDuration/10),i-=.1):this.removeFromDOM()};window.setTimeout(r,qk.fadeOutDuration/10)}removeFromDOM(){this.removeLayerFromDOM(this.context),this._additionalLayers.forEach(i=>{this.removeLayerFromDOM(i)}),this._additionalLayers.clear(),this._parentElement=void 0}resize(i,r){this._clientDimensions=void 0,this.resizeLayer(this.context,i,r),this._additionalLayers.forEach(s=>{this.resizeLayer(s,i,r)})}clear(){const i=r=>{r.save(),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,r.canvas.width,r.canvas.height),r.restore()};i(this.context),this._additionalLayers.forEach(r=>{i(r)})}beginStroke(i){this._strokeStarted=!0,this.internalBeginStroke(i),this.rendersAsynchronously()&&this.scheduleRender()}addPoint(i){if(!this._strokeStarted)throw new Error("beginStroke must be called before addPoint.");this.internalAddPoint(i),this.rendersAsynchronously()&&this.scheduleRender()}endStroke(i){this.internalEndStroke(i),this.rendersAsynchronously()?this.scheduleRender():this.render(),this._strokeStarted=!1}cancelStroke(){this.internalCancelStroke(),this.clear(),this._strokeStarted=!1}renderStroke(i){if(this.setBrush(i.brush),i.length===1)this.beginStroke(i.getPointAt(0)),this.endStroke(i.getPointAt(0));else for(let r=0;r<i.length;r++)r===0?this.beginStroke(i.getPointAt(r)):r===i.length-1?this.endStroke(i.getPointAt(r)):this.addPoint(i.getPointAt(r))}setBrush(i){this._brush=i}get canvas(){return this._context.canvas}get brush(){var i;return(i=this._brush)!==null&&i!==void 0?i:this.getDefaultBrush()}get offset(){return this._offset}set offset(i){this._offset=Object.assign({},i)}get scale(){return this._scale}set scale(i){i>0&&(this._scale=i)}};return a.fadeOutDuration=300,a.laserShadowOpacity=.5,a.highlighterOpacity=.5,A1.InkingCanvas=a,A1}var Ine;function gue(){if(Ine)return ad;Ine=1,Object.defineProperty(ad,"__esModule",{value:!0}),ad.WetCanvas=ad.DryCanvas=ad.DryWetCanvas=void 0;const e=pue(),n=PI(),a=Cb();let t=class extends e.InkingCanvas{constructor(){super(...arguments),this._pendingPointsStartIndex=0,this._points=[]}computeQuadPath(o){return(0,a.computeQuadPath)(this._points,this._pendingPointsStartIndex,this.brush.tip,o)}renderQuadPath(o,u){const c=this.getBrushCssColor();o.strokeStyle=c,o.fillStyle=c,o.beginPath();for(let d of u)d.quad!==void 0&&this.renderQuad(o,d.quad),this.brush.tip==="ellipse"?this.renderCircle(o,d.endPoint,d.tipSize):this.renderRectangle(o,d.endPoint,d.tipSize,d.tipSize);o.fill(),o.closePath()}getDefaultBrush(){return n.DefaultPenBrush}getBrushCssColor(){return(0,n.toCssRgbaColor)(this.brush.color,this.brush.type==="highlighter"?.5:1)}rendersProgressively(){return!0}adjustOpacity(o){o.globalAlpha=1,o.canvas.style.opacity="1"}internalRender(){this.rendersProgressively()||this.clear();const o=this.computeQuadPath(this.brush.tipSize);if(this.adjustOpacity(this.context),this.renderQuadPath(this.context,o),this.brush.type==="laser"){const u=this.computeQuadPath(this.brush.tipSize/3);this._innerLayer||(this._innerLayer=this.addLayer()),this.renderQuadPath(this._innerLayer,u)}else this._innerLayer&&(this.removeLayer(this._innerLayer),this._innerLayer=void 0);this.rendersProgressively()&&(this._pendingPointsStartIndex=this._points.length)}internalBeginStroke(o){this._points=[o],this._pendingPointsStartIndex=0}internalAddPoint(o){this._points.push(o)}internalEndStroke(o){o&&this._points.push(o)}internalCancelStroke(){}get points(){return this._points}};ad.DryWetCanvas=t;class i extends t{rendersAsynchronously(){return!1}adjustOpacity(o){switch(this.brush.type){case"laser":o.globalAlpha=e.InkingCanvas.laserShadowOpacity;break;default:super.adjustOpacity(o);break}}}ad.DryCanvas=i;class r extends t{rendersAsynchronously(){return r.forceSynchronousRendering?!1:super.rendersAsynchronously()}rendersProgressively(){return r.forceSynchronousRendering?!1:super.rendersProgressively()}getBrushCssColor(){return(0,n.toCssRgbaColor)(this.brush.color)}adjustOpacity(o){switch(this.brush.type){case"laser":o.canvas.style.opacity=e.InkingCanvas.laserShadowOpacity.toString();break;case"highlighter":o.canvas.style.opacity=e.InkingCanvas.highlighterOpacity.toString();break;default:super.adjustOpacity(o);break}}}return r.forceSynchronousRendering=!1,ad.WetCanvas=r,ad}var D1={},Rne;function DPe(){if(Rne)return D1;Rne=1,Object.defineProperty(D1,"__esModule",{value:!0}),D1.LaserPointerCanvas=void 0;const e=gue();let n=class yue extends e.WetCanvas{scheduleTrailingPointsRemoval(){this._trailingPointsRemovalInterval===void 0&&this.points.length>1&&(this._trailingPointsRemovalInterval=window.setTimeout(()=>{const t=Math.ceil((this.points.length-1)/5);if(this.points.splice(0,t),this.points.length>0){let i=.5;const r=(.9-i)/this.points.length;for(let s=this.points.length-1;s>=0;s--)this.points[s].pressure=i,i-=r}this._trailingPointsRemovalInterval=void 0,this.scheduleRender(),this.scheduleTrailingPointsRemoval()},yue.TrailingPointsRemovalInterval))}cancelTralingPointRemoval(){this._trailingPointsRemovalInterval!==void 0&&(window.clearInterval(this._trailingPointsRemovalInterval),this._trailingPointsRemovalInterval=void 0)}internalAddPoint(t){super.internalAddPoint(t),this.scheduleTrailingPointsRemoval()}internalEndStroke(t){this.cancelTralingPointRemoval(),super.internalEndStroke(t)}internalCancelStroke(){this.cancelTralingPointRemoval(),super.internalCancelStroke()}rendersProgressively(){return!1}removeFromDOM(){super.removeFromDOM(),this.cancelTralingPointRemoval()}};return n.TrailingPointsRemovalInterval=20,D1.LaserPointerCanvas=n,D1}var Fne;function bue(){return Fne||(Fne=1,(function(e){var n=jg&&jg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=jg&&jg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(gue(),e),a(pue(),e),a(DPe(),e)})(jg)),jg}var ck={},jne;function gL(){return jne||(jne=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stroke=e.StrokeType=e.StrokeMode=void 0;const n=pL(),a=OI(),t=Cb();(function(r){r[r.freeHand=0]="freeHand",r[r.line=1]="line"})(e.StrokeMode||(e.StrokeMode={})),(function(r){r[r.laserPointer=0]="laserPointer",r[r.ephemeral=1]="ephemeral",r[r.persistent=2]="persistent"})(e.StrokeType||(e.StrokeType={}));class i{serializePoints(){let s="";const o=Math.pow(10,i.coordinateSerializationPrecision),u=Math.pow(10,i.pressureSerializationPrecision);for(let c=0;c<this._points.length;c++){const d=this._points[c];s+=`${(d.x*o).toFixed(0)},${(d.y*o).toFixed(0)},${(d.pressure*u).toFixed(0)}`,c<this._points.length-1&&(s+=",")}return s}deserializePoints(s){const o=[],u=Math.pow(10,i.coordinateSerializationPrecision),c=Math.pow(10,i.pressureSerializationPrecision);let d=0,l=[];for(;d<s.length;){let f=s.indexOf(",",d);if(f===-1&&(f=s.length),l.push(parseFloat(s.substring(d,f))),l.length===3){const b={x:l[0]/u,y:l[1]/u,pressure:l[2]/c};o.push(b),l=[]}d=f+1}return o}addPoint(s){let o=this._points.length>0?this._points[this._points.length-1]:void 0;return o===void 0||o.x!==s.x||o.y!==s.y?(this._points.push(s),this._boundingRect&&!(0,t.isPointInsideRectangle)(s,this._boundingRect)&&(this._boundingRect=void 0),!0):!1}constructor(s){var o,u,c,d;this._version=1,this._brush=Object.assign({},n.DefaultPenBrush),this._iteratorCounter=0;const l={id:s?s.id:void 0,clientId:s?s.clientId:void 0,timeStamp:s?s.timeStamp:void 0,brush:s?s.brush:void 0,points:s?s.points:void 0};this._id=(o=l.id)!==null&&o!==void 0?o:(0,t.generateUniqueId)(),this._clientId=l.clientId,this._timeStamp=(u=l.timeStamp)!==null&&u!==void 0?u:Date.now(),this._points=(c=l.points)!==null&&c!==void 0?c:[],this._brush=Object.assign({},(d=l.brush)!==null&&d!==void 0?d:n.DefaultPenBrush)}addPoints(...s){let o=!1;for(let u of s)this.addPoint(u)&&(o=!0);return o}clear(){this._points=[],this._boundingRect=void 0}intersectsWithRectangle(s){let o;for(const u of this){if(o&&(0,t.getSegmentIntersectionsWithRectangle)({from:o,to:u},s).length>0)return!0;o=u}return!1}getIntersectionPoints(s){const o=[];let u;for(const c of this){if(u){const d=(0,t.getSegmentsIntersection)(s,{from:u,to:c});d&&o.push(d)}u=c}return o}getBoundingRect(){if(this._boundingRect===void 0){let s={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE};for(const o of this)s=(0,a.expandRect)(s,o);this._boundingRect=s}return this._boundingRect}getPointAt(s){return this._points[s]}getAllPoints(){const s=[];for(const o of this._points)s.push(Object.assign({},o));return s}pointErase(s){const o=this.getBoundingRect();if(this.length===1)return(0,t.isPointInsideRectangle)(this.getPointAt(0),s)?[]:void 0;if((0,t.isRectangleInsideRectangle)(o,s))return[];if(!(0,t.doRectanglesOverlap)(s,o))return;const u=()=>new i({clientId:this.clientId,timeStamp:this.timeStamp,brush:this.brush});let c;const d=[];let l=u();for(const f of this){if(c){const b={from:c,to:f};if((0,t.segmentMayIntersectWithRectangle)(b,s)){const C=(0,t.getSegmentIntersectionsWithRectangle)(b,s);if(C.length===1)(0,t.isPointInsideRectangle)(c,s)?(l=u(),l.addPoint(Object.assign(Object.assign({},C[0]),{pressure:c.pressure})),l.addPoint(f)):(l.addPoint(Object.assign(Object.assign({},C[0]),{pressure:f.pressure})),d.push(l),l=u());else if(C.length===2){const v=(0,a.getSquaredDistanceBetweenPoints)(c,C[0]),m=(0,a.getSquaredDistanceBetweenPoints)(c,C[1]);let[h,g]=v<m?[0,1]:[1,0];l.addPoint(Object.assign(Object.assign({},C[h]),{pressure:c.pressure})),d.push(l),l=u(),l.addPoint(Object.assign(Object.assign({},C[g]),{pressure:c.pressure})),l.addPoint(f)}else!(0,t.isPointInsideRectangle)(c,s)&&!(0,t.isPointInsideRectangle)(f,s)&&(l.length===0&&l.addPoint(c),l.addPoint(f))}else l.addPoint(f)}else l.addPoint(f);c=f}return l.length>1&&d.push(l),d}serialize(){const s={v:this._version,id:this.id,cId:this.clientId,t:this.timeStamp,br:this.brush,d:this.serializePoints()};return JSON.stringify(s)}deserialize(s){const o=JSON.parse(s);this._version=o.v,this._id=o.id,this._clientId=o.cId,this._timeStamp=o.t,this._brush=o.br,this._points=this.deserializePoints(o.d)}[Symbol.iterator](){return this._iteratorCounter=0,{next:()=>({done:this._iteratorCounter===this._points.length,value:this._points[this._iteratorCounter++]})}}get id(){return this._id}get clientId(){return this._clientId}get timeStamp(){return this._timeStamp}get length(){return this._points.length}get brush(){return this._brush}}i.coordinateSerializationPrecision=1,i.pressureSerializationPrecision=2,e.Stroke=i})(ck)),ck}var Mg={},Ng={},Mne;function vue(){if(Mne)return Ng;Mne=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.InputFilterCollection=Ng.InputFilter=void 0;let e=class{reset(t){}};Ng.InputFilter=e;class n{constructor(...t){this._items=[],this._items.push(...t)}addFilters(...t){this._items.push(...t)}reset(t){for(const i of this._items)i.reset(t)}filterPoint(t){let i=t;for(const r of this._items)i=r.filterPoint(i);return i}}return Ng.InputFilterCollection=n,Ng}var Ag={},Nne;function Sue(){if(Nne)return Ag;Nne=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.InputProvider=Ag.MulticastEvent=void 0;class e{constructor(){this._listeners=new Set}on(t){this._listeners.has(t)||this._listeners.add(t)}off(t){this._listeners.delete(t)}emit(t){for(const i of this._listeners)i(t)}}Ag.MulticastEvent=e;let n=class{constructor(){this.pointerDownEvent=new e,this.pointerMoveEvent=new e,this.pointerUpEvent=new e,this.pointerEnterEvent=new e,this.pointerLeaveEvent=new e,this._isActive=!0}activate(){this._isActive=!0}deactivate(){this._isActive=!1}get isActive(){return this._isActive}get pointerDown(){return this.pointerDownEvent}get pointerMove(){return this.pointerMoveEvent}get pointerUp(){return this.pointerUpEvent}get pointerEnter(){return this.pointerEnterEvent}get pointerLeave(){return this.pointerLeaveEvent}};return Ag.InputProvider=n,Ag}var k1={},Ane;function kPe(){if(Ane)return k1;Ane=1,Object.defineProperty(k1,"__esModule",{value:!0}),k1.JitterFilter=void 0;const e=vue();let n=class Xy extends e.InputFilter{static iir(t,i,r){return Xy._ab*t+Xy._a*i+Xy._b*r}reset(t){this._out1=t,this._out2=t}filterPoint(t){if(this._out1&&this._out2){const i={x:Xy.iir(t.x,this._out1.x,this._out2.x),y:Xy.iir(t.y,this._out1.y,this._out2.y),pressure:t.pressure};return this._out2=this._out1,this._out1=i,i}return t}};return n._a=1.33,n._b=-.5,n._ab=1-n._a-n._b,k1.JitterFilter=n,k1}var x1={},Dne;function xPe(){if(Dne)return x1;Dne=1,Object.defineProperty(x1,"__esModule",{value:!0}),x1.PointerInputProvider=void 0;const e=Sue();function n(i){return{altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,x:i.offsetX,y:i.offsetY,pressure:i.pressure>0?i.pressure:.5}}function a(i){if("getCoalescedEvents"in i){const r=i.getCoalescedEvents();if(r.length>=1)return r}return[i]}let t=class extends e.InputProvider{capturePointer(r){try{this.element.setPointerCapture(r),this._activePointerId=r}catch(s){console.error(`Could not capture pointer with id ${r}: ${s}`)}}releaseActivePointer(){if(this._activePointerId!==void 0){try{this.element.releasePointerCapture(this._activePointerId)}catch(r){console.error(`Could not release pointer with id ${this._activePointerId}: ${r}`)}this._activePointerId=void 0}}activate(){super.activate(),this.element.addEventListener("pointerdown",this.onPointerDown),this.element.addEventListener("pointermove",this.onPointerMove),this.element.addEventListener("pointerup",this.onPointerUp),this.element.addEventListener("pointerenter",this.onPointerEnter),this.element.addEventListener("pointerleave",this.onPointerLeave)}deactivate(){super.deactivate(),this.element.removeEventListener("pointerdown",this.onPointerDown),this.element.removeEventListener("pointermove",this.onPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp),this.element.removeEventListener("pointerenter",this.onPointerEnter),this.element.removeEventListener("pointerleave",this.onPointerLeave)}constructor(r){super(),this.element=r,this.onPointerDown=s=>{this.isActive&&(this._activePointerId===void 0&&(this.capturePointer(s.pointerId),this.pointerDownEvent.emit(n(s))),s.preventDefault(),s.stopPropagation())},this.onPointerMove=s=>{if(this.isActive){let o=!0;if(this._activePointerId!==void 0&&(o=s.pointerId===this._activePointerId),o){const u=this._activePointerId!==void 0;a(s).forEach(d=>{this.pointerMoveEvent.emit(Object.assign(Object.assign({},n(d)),{isPointerDown:u}))})}s.preventDefault(),s.stopPropagation()}},this.onPointerUp=s=>{this.isActive&&(this._activePointerId===s.pointerId&&(this.releaseActivePointer(),this.pointerUpEvent.emit(n(s))),s.preventDefault(),s.stopPropagation())},this.onPointerEnter=s=>{this.isActive&&(this._activePointerId===void 0&&this.pointerEnterEvent.emit(n(s)),s.preventDefault(),s.stopPropagation())},this.onPointerLeave=s=>{this.isActive&&(this._activePointerId===void 0&&this.pointerLeaveEvent.emit(n(s)),s.preventDefault(),s.stopPropagation())}}};return x1.PointerInputProvider=t,x1}var kne;function yL(){return kne||(kne=1,(function(e){var n=Mg&&Mg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Mg&&Mg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(vue(),e),a(Sue(),e),a(kPe(),e),a(xPe(),e)})(Mg)),Mg}var xne;function Cue(){return xne||(xne=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InkingManager=e.AddPointsEvent=e.StrokeEndState=e.BeginStrokeEvent=e.PointerMovedEvent=e.StrokesRemovedEvent=e.StrokesAddedEvent=e.ClearEvent=e.InkingTool=void 0;const n=Ec(),a=bue(),t=OI(),i=gL(),r=yL(),s=pL(),o=Cb();var u;(function(m){m[m.pen=0]="pen",m[m.laserPointer=1]="laserPointer",m[m.highlighter=2]="highlighter",m[m.eraser=3]="eraser",m[m.pointEraser=4]="pointEraser",m[m.line=5]="line"})(u=e.InkingTool||(e.InkingTool={})),e.ClearEvent="Clear",e.StrokesAddedEvent="StrokesAdded",e.StrokesRemovedEvent="StrokesRemoved",e.PointerMovedEvent="PointerMoved",e.BeginStrokeEvent="BeginStroke";var c;(function(m){m[m.ended=0]="ended",m[m.cancelled=1]="cancelled"})(c=e.StrokeEndState||(e.StrokeEndState={})),e.AddPointsEvent="AddPoints";class d{constructor(){this._addedStrokes=new Map,this._removedStrokes=new Set}clear(){this._addedStrokes.clear(),this._removedStrokes.clear()}mergeChanges(h){for(let g of h._removedStrokes)this._addedStrokes.delete(g)||this._removedStrokes.add(g);h._addedStrokes.forEach(g=>{this._addedStrokes.set(g.id,g)})}addStroke(h){this._addedStrokes.set(h.id,h)}removeStroke(h){this._removedStrokes.add(h)}getRemovedStrokes(){return[...this._removedStrokes]}getAddedStrokes(){return[...this._addedStrokes.values()]}get hasChanges(){return this._addedStrokes.size>0||this._removedStrokes.size>0}}class l extends a.DryCanvas{constructor(h,g){super(g),this.clientId=h}scheduleRemoval(h){this._removalTimeout&&window.clearTimeout(this._removalTimeout),this._removalTimeout=window.setTimeout(()=>{this.fadeOut(),h(this)},v.ephemeralCanvasRemovalDelay)}}class f extends i.Stroke{notifyStrokeEnded(h){this.onStrokeEnded&&this.onStrokeEnded(this,h)}constructor(h,g,_,S){super(S),this._canvas=h,this.type=g,this.mode=_,this._canvas.setBrush(this.brush)}straighten(h){return h}end(){this._canvas.removeFromDOM(),this._canvas.endStroke(),this.notifyStrokeEnded(!1)}cancel(){this._canvas.removeFromDOM(),this._canvas.cancelStroke(),this.notifyStrokeEnded(!0)}get canvas(){return this._canvas}}class b extends f{addPoints(...h){const g=this.length,_=super.addPoints(...h);if(_){let S=g;S===0&&(this.canvas.beginStroke(this.getPointAt(0)),S=1);for(let p=S;p<this.length;p++)this.canvas.addPoint(this.getPointAt(p))}return _}end(){if(this.length>1&&this.brush.endArrow==="open"){const h=this.getPointAt(this.length-2),g=this.getPointAt(this.length-1),_=(0,o.computeEndArrow)(h,g);for(let S=0;S<_.length;S++){const p=Object.assign(Object.assign({},_[S]),{pressure:g.pressure});this.addPoint(p)}}super.end()}}class C extends f{straighten(h){const g=Object.assign({},h);if(this.length>0){const _=this.getPointAt(0);Math.abs(g.x-_.x)>Math.abs(g.y-_.y)?g.y=_.y:g.x=_.x}return g}addPoints(...h){if(this.length===0)this.addPoint(h[0]),h.length>1&&this.addPoint(h[h.length-1]);else{const g=this.getPointAt(0);this.clear(),this.addPoint(g),this.addPoint(h[h.length-1])}if(this.canvas.cancelStroke(),this.canvas.beginStroke(this.getPointAt(0)),this.length>1&&(this.canvas.addPoint(this.getPointAt(1)),this.brush.endArrow==="open")){const g=(0,o.computeEndArrow)(this.getPointAt(0),this.getPointAt(1));for(let _=0;_<g.length;_++){const S=Object.assign(Object.assign({},g[_]),{pressure:this.getPointAt(1).pressure});this.addPoint(S),this.canvas.addPoint(S)}}return!0}}class v extends n.EventEmitter{reRender(){this._dryCanvas.clear(),this._dryCanvas.offset=this._offset,this._dryCanvas.scale=this._scale;const h=[...this._strokes.values()].sort((g,_)=>g.timeStamp-_.timeStamp);for(const g of h)this._dryCanvas.renderStroke(g)}scheduleReRender(){this._reRenderTimeout!==void 0&&window.cancelAnimationFrame(this._reRenderTimeout),this._reRenderTimeout=window.requestAnimationFrame(()=>{this.reRender(),this._reRenderTimeout=void 0})}flushChangeLog(){this._changeLogFlushTimeout&&(window.clearTimeout(this._changeLogFlushTimeout),this._changeLogFlushTimeout=void 0),this._changeLog.hasChanges&&(this.notifyStrokesRemoved(...this._changeLog.getRemovedStrokes()),this.notifyStrokesAdded(...this._changeLog.getAddedStrokes()),this._changeLog.clear())}scheduleChangeLogFlush(){this._changeLogFlushTimeout===void 0&&(this._changeLogFlushTimeout=window.setTimeout(()=>{this._changeLogFlushTimeout=void 0,this.flushChangeLog()},v.changeLogFlushInterval))}processPendingPointErasePoints(){for(let h of this._pendingPointErasePoints)this.internalPointErase(h);this._pendingPointErasePoints=[]}schedulePointEraseProcessing(){this._pointEraseProcessingInterval===void 0&&(this._pointEraseProcessingInterval=window.setTimeout(()=>{this.processPendingPointErasePoints(),this._pointEraseProcessingInterval=void 0,this.scheduleChangeLogFlush()},v.pointEraserProcessingInterval))}getBrushForTool(h){switch(h){case u.laserPointer:return this.laserPointerBrush;case u.highlighter:return this.highlighterBrush;case u.line:return this.lineBrush;default:return this.penBrush}}cancelCurrentStroke(h){this._currentStroke!==void 0&&(this._currentStroke.cancel(),this.notifyEndStroke(this._currentStroke.id,h,!0),this._currentStroke=void 0)}internalAddStroke(h,g){var _,S;const p={forceReRender:g&&(_=g.forceReRender)!==null&&_!==void 0?_:!1,addToChangeLog:g&&(S=g.addToChangeLog)!==null&&S!==void 0?S:!0};p.forceReRender||this._strokes.has(h.id)?(this._strokes.set(h.id,h),p.forceReRender?this.reRender():this.scheduleReRender()):(this._strokes.set(h.id,h),this._reRenderTimeout||this._dryCanvas.renderStroke(h)),p.addToChangeLog&&this._changeLog.addStroke(h)}internalErase(h){const g=new d,_=(0,o.makeRectangle)(h,this.eraserSize,this.eraserSize);return this._strokes.forEach(S=>{S.length===1?(0,o.isPointInsideRectangle)(S.getPointAt(0),_)&&g.removeStroke(S.id):S.intersectsWithRectangle(_)&&g.removeStroke(S.id)}),g.hasChanges&&(g.getRemovedStrokes().forEach(S=>{this._strokes.delete(S)}),this.scheduleReRender(),this._changeLog.mergeChanges(g)),g}internalPointErase(h){const g=new d,_=(0,o.makeRectangle)(h,this.eraserSize,this.eraserSize);return this._strokes.forEach(S=>{const p=S.pointErase(_);if(p){g.removeStroke(S.id);for(const w of p)g.addStroke(w)}}),g.hasChanges&&(g.getRemovedStrokes().forEach(S=>{this._strokes.delete(S)}),g.getAddedStrokes().forEach(S=>{this._strokes.set(S.id,S)}),this.scheduleReRender(),this._changeLog.mergeChanges(g)),g}queuePointerMovedNotification(h){this._lastPointerMovePosition=h,this._pointerMovedNotificationTimeout===void 0&&(this._pointerMovedNotificationTimeout=window.setTimeout(()=>{this.notifyPointerMoved(this._lastPointerMovePosition),this._pointerMovedNotificationTimeout=void 0},v.pointerMovedNotificationDelay))}notifyPointerMoved(h){const g={position:h};this.emit(e.PointerMovedEvent,g)}notifyStrokesAdded(...h){h.length>0&&this.emit(e.StrokesAddedEvent,h)}notifyStrokesRemoved(...h){h.length>0&&this.emit(e.StrokesRemovedEvent,h)}notifyClear(){this.emit(e.ClearEvent)}notifyBeginStroke(h){const g={strokeId:h.id,brush:h.brush,startPoint:h.getPointAt(0),type:h.type,mode:h.mode};this.emit(e.BeginStrokeEvent,g)}notifyAddPoints(h,...g){const _={strokeId:h,points:g};this.emit(e.AddPointsEvent,_)}notifyEndStroke(h,g,_=!1){const S={strokeId:h,points:g?[g]:[],endState:_?c.cancelled:c.ended};this.emit(e.AddPointsEvent,S)}createInputFilterCollection(h){const g=new r.InputFilterCollection;return h?g.addFilters(...h):g.addFilters(new r.JitterFilter),g.addFilters(new v.ScreenToViewportCoordinateTransform(this)),g}constructor(h){super(),this._penBrush=Object.assign({},s.DefaultPenBrush),this._lineBrush=Object.assign({},s.DefaultLineBrush),this._highlighterBrush=Object.assign({},s.DefaultHighlighterBrush),this._laserPointerBrush=Object.assign({},s.DefaultLaserPointerBrush),this._tool=u.pen,this._strokes=new Map,this._pendingPointErasePoints=[],this._changeLog=new d,this._isUpdating=!1,this._referencePoint="center",this._offset={x:0,y:0},this._scale=1,this._ephemeralCanvases=new Map,this.onHostResized=(g,_)=>{if(this._clientWidth=void 0,this._clientHeight=void 0,this._centerX=void 0,this._centerY=void 0,g.length>=1){const S=g[0];this._canvasPoolHost.style.width=S.contentRect.width+"px",this._canvasPoolHost.style.height=S.contentRect.height+"px",this._dryCanvas.resize(S.contentRect.width,S.contentRect.height),this.reRender()}},this.onPointerDown=g=>{this._inputFilters.reset(g);const _=this._inputFilters.filterPoint(g);switch(this.cancelCurrentStroke(_),this.tool){case u.pen:case u.line:case u.highlighter:case u.laserPointer:const S=this.tool===u.line||g.ctrlKey&&v.enableStrokeModifierHotKeys?i.StrokeMode.line:i.StrokeMode.freeHand,p=Object.assign({},this.getBrushForTool(this.tool));g.altKey&&v.enableStrokeModifierHotKeys&&(p.endArrow="open"),this._currentStroke=this.beginWetStroke(this.tool===u.laserPointer?i.StrokeType.ephemeral:i.StrokeType.persistent,S,_,{brush:p}),this.notifyBeginStroke(this._currentStroke);break;case u.eraser:this.erase(_);break;case u.pointEraser:this._pendingPointErasePoints.push(_),this.schedulePointEraseProcessing();break}},this.onPointerMove=g=>{if(g.isPointerDown){let _=this._inputFilters.filterPoint(g);if(this._currentStroke)g.shiftKey&&v.enableStrokeModifierHotKeys&&(_=this._currentStroke.straighten(_)),this._currentStroke.addPoints(_),this.notifyAddPoints(this._currentStroke.id,_);else switch(this.tool){case u.eraser:this.erase(_),this.queuePointerMovedNotification(_);break;case u.pointEraser:this._pendingPointErasePoints.push(_),this.queuePointerMovedNotification(_),this.schedulePointEraseProcessing();break}}else if(this.tool===u.laserPointer)if(this._currentStroke===void 0){this._inputFilters.reset(g);const _=this._inputFilters.filterPoint(g);this._currentStroke=this.beginWetStroke(i.StrokeType.laserPointer,i.StrokeMode.freeHand,_,{brush:this.getBrushForTool(this.tool)}),this.notifyBeginStroke(this._currentStroke)}else{const _=this._inputFilters.filterPoint(g);this._currentStroke.addPoints(_),this.notifyAddPoints(this._currentStroke.id,_)}else{const _=this._inputFilters.filterPoint(g);this.queuePointerMovedNotification(_)}},this.onPointerUp=g=>{let _=this._inputFilters.filterPoint(g);this._currentStroke&&(g.shiftKey&&v.enableStrokeModifierHotKeys&&(_=this._currentStroke.straighten(_)),this._currentStroke.addPoints(_),this._currentStroke.end(),this.notifyEndStroke(this._currentStroke.id,_),this._currentStroke=void 0),this.flushChangeLog()},this.onPointerLeave=g=>{if(this.tool===u.laserPointer){const _=this._inputFilters.filterPoint(g);this.cancelCurrentStroke(_)}else this.queuePointerMovedNotification()},this.wetStrokeEnded=(g,_)=>{var S;if(!_)if(g.type===i.StrokeType.ephemeral){const p=(S=g.clientId)!==null&&S!==void 0?S:v.localClientId;let w=this._ephemeralCanvases.get(p);w||(w=new l(p,this._canvasPoolHost),w.offset=this.offset,w.scale=this.scale,this._ephemeralCanvases.set(p,w)),w.renderStroke(g),w.scheduleRemoval(O=>{this._ephemeralCanvases.delete(O.clientId)})}else g.type===i.StrokeType.persistent&&this.internalAddStroke(g)},this.eraserSize=20,this._inputFilters=this.createInputFilterCollection(),this._hostElement=h,this._dryCanvas=new a.DryCanvas(this._hostElement),this._canvasPoolHost=document.createElement("div"),this._canvasPoolHost.style.position="absolute",this._canvasPoolHost.style.pointerEvents="none",this._hostElement.appendChild(this._canvasPoolHost),this.inputProvider=new r.PointerInputProvider(this._dryCanvas.canvas),this._hostResizeObserver=new ResizeObserver(this.onHostResized),this._hostResizeObserver.observe(this._hostElement)}setInputFilters(h){this._inputFilters=this.createInputFilterCollection(h)}beginUpdate(){this._isUpdating=!0}endUpdate(){this._isUpdating&&(this._isUpdating=!1,this.flushChangeLog())}activate(){this._inputProvider.activate()}deactivate(){this._inputProvider.deactivate()}clear(){this._strokes.clear(),this.scheduleReRender(),this.notifyClear()}exportRaw(){const h=[];return this._strokes.forEach(g=>{h.push({points:g.getAllPoints(),brush:Object.assign({},g.brush)})}),h}exportSVG(){let h="",g,_=0;this._strokes.forEach(p=>{const w=p.getBoundingRect();g=g?(0,t.combineRects)(g,w):w,p.brush.tipSize>_&&(_=p.brush.tipSize);const O=(0,o.computeQuadPath)(p.getAllPoints(),0,p.brush.tip,p.brush.tipSize);let E=(0,o.renderQuadPathToSVG)(O,p.brush.tip,p.brush.color);p.brush.type==="highlighter"&&(E=`<g opacity="${a.InkingCanvas.highlighterOpacity}">${E}</g>`),h+=E});let S="";if(g){const p=_/2;g.left-=p,g.top-=p;const w=g.right-g.left+_,O=g.bottom-g.top+_;S=`viewBox="${g.left} ${g.top} ${w} ${O}"`}return`<svg ${S} xmlns="http://www.w3.org/2000/svg">${h}</svg>`}importRaw(h){for(const g of h){const _=new i.Stroke({brush:g.brush,points:g.points,clientId:v.localClientId});this.addStroke(_)}}beginWetStroke(h,g,_,S){const p=h===i.StrokeType.laserPointer?new a.LaserPointerCanvas(this._canvasPoolHost):new a.WetCanvas(this._canvasPoolHost);p.resize(this.clientWidth,this.clientHeight),p.offset=this.offset,p.scale=this.scale,p.referencePoint=this.referencePoint;let w;return g===i.StrokeMode.line?w=new C(p,h,g,S):w=new b(p,h,g,S),w.onStrokeEnded=this.wetStrokeEnded,w.addPoints(_),w}getStroke(h){return this._strokes.get(h)}addStroke(h,g){this.internalAddStroke(h,g),this._isUpdating||this.flushChangeLog()}removeStroke(h,g){var _,S;if(this._strokes.delete(h)){const p={forceReRender:g&&(_=g.forceReRender)!==null&&_!==void 0?_:!1,addToChangeLog:g&&(S=g.addToChangeLog)!==null&&S!==void 0?S:!0};p.forceReRender?this.reRender():this.scheduleReRender(),p.addToChangeLog&&this._changeLog.removeStroke(h),this._isUpdating||this.flushChangeLog()}}erase(h){this.internalErase(h),this._isUpdating||this.flushChangeLog()}pointErase(h){this.internalPointErase(h),this._isUpdating||this.flushChangeLog()}screenToViewport(h){return(0,t.screenToViewport)(h,this.referencePoint==="center"?{x:this.centerX,y:this.centerY}:{x:0,y:0},this.offset,this.scale)}viewportToScreen(h){return(0,t.viewportToScreen)(h,this.referencePoint==="center"?{x:this.centerX,y:this.centerY}:{x:0,y:0},this.offset,this.scale)}get hostElement(){return this._hostElement}get penBrush(){return this._penBrush}set penBrush(h){this._penBrush=Object.assign({},h)}get lineBrush(){return this._lineBrush}set lineBrush(h){this._lineBrush=Object.assign({},h)}get highlighterBrush(){return this._highlighterBrush}set highlighterBrush(h){this._highlighterBrush=Object.assign({},h)}get laserPointerBrush(){return this._laserPointerBrush}set laserPointerBrush(h){this._laserPointerBrush=Object.assign({},h)}get clientWidth(){return this._clientWidth||(this._clientWidth=this._hostElement.clientWidth),this._clientWidth}get clientHeight(){return this._clientHeight||(this._clientHeight=this._hostElement.clientHeight),this._clientHeight}get centerX(){return this._centerX||(this._centerX=this.clientWidth*.5),this._centerX}get centerY(){return this._centerY||(this._centerY=this.clientHeight*.5),this._centerY}get inputProvider(){return this._inputProvider}set inputProvider(h){if(this._inputProvider!==h){let g=!1;this._inputProvider&&(g=this._inputProvider.isActive,this._inputProvider.deactivate(),this._inputProvider.pointerDown.off(this.onPointerDown),this._inputProvider.pointerMove.off(this.onPointerMove),this._inputProvider.pointerUp.off(this.onPointerUp),this._inputProvider.pointerLeave.off(this.onPointerLeave)),this._inputProvider=h,this._inputProvider&&(this._inputProvider.pointerDown.on(this.onPointerDown),this._inputProvider.pointerMove.on(this.onPointerMove),this._inputProvider.pointerUp.on(this.onPointerUp),this._inputProvider.pointerLeave.on(this.onPointerLeave),g&&this._inputProvider.activate())}}get tool(){return this._tool}set tool(h){this._tool!==h&&(this._currentStroke!==void 0&&this._currentStroke.cancel(),this._tool=h)}get referencePoint(){return this._referencePoint}set referencePoint(h){this._referencePoint!==h&&(this._referencePoint=h,this._dryCanvas.referencePoint=h,this.reRender())}get offset(){return this._offset}set offset(h){this._offset!=h&&(this._offset=Object.assign({},h),this.reRender())}get scale(){return this._scale}set scale(h){this._scale!==h&&h>0&&(this._scale=h,this.reRender())}get viewPort(){const h=this.screenToViewport({x:0,y:0}),g=this.screenToViewport({x:this.clientWidth,y:this.clientHeight});return{left:h.x,top:h.y,right:g.x,bottom:g.y}}}v.pointerMovedNotificationDelay=15,v.pointEraserProcessingInterval=30,v.changeLogFlushInterval=60,v.localClientId=(0,o.generateUniqueId)(),v.ephemeralCanvasRemovalDelay=1500,v.enableStrokeModifierHotKeys=!0,v.ScreenToViewportCoordinateTransform=class extends r.InputFilter{constructor(m){super(),this._owner=m}filterPoint(m){return Object.assign(Object.assign({},this._owner.screenToViewport(m)),{pressure:m.pressure})}},e.InkingManager=v})(ok)),ok}var od={},qne;function qPe(){if(qne)return od;qne=1;var e=od&&od.__awaiter||function(m,h,g,_){function S(p){return p instanceof g?p:new g(function(w){w(p)})}return new(g||(g=Promise))(function(p,w){function O(R){try{F(_.next(R))}catch(M){w(M)}}function E(R){try{F(_.throw(R))}catch(M){w(M)}}function F(R){R.done?p(R.value):S(R.value).then(O,E)}F((_=_.apply(m,h||[])).next())})};Object.defineProperty(od,"__esModule",{value:!0}),od.LiveCanvas=od.LiveCursor=void 0;const n=$o(),a=yE(),t=Cue(),i=OI(),r=gL(),s=Wo(),o=mL(),u=Cb(),c=yL();var d;(function(m){m.pointerMove="PointerMove",m.beginWetStroke="BeginWetStroke",m.addWetStrokePoints="AddWetStrokePoint"})(d||(d={}));class l{process(){if(this.type!==r.StrokeType.persistent)return;let h=0;for(;h+2<this._points.length;){const g=this._points[h],_=this._points[h+1],S=this._points[h+2],p=(0,i.getDistanceBetweenPoints)(g,_),w=(0,i.getDistanceBetweenPoints)(_,S),O=(0,i.getDistanceBetweenPoints)(g,S);(p+w)*(100/O)<this.simplificationThreshold?this._points.splice(h+1,1):h++}}constructor(h,g,_,S){this.id=h,this.type=g,this.brush=_,this.simplificationThreshold=S,this._points=[]}get points(){return this._points}clear(){this._points=[]}scheduleProcessing(h){this._processTimeout===void 0&&(this._processTimeout=window.setTimeout(()=>{this.process(),this._processTimeout=void 0,h(this)},l.wetStrokeEventsStreamDelay))}}l.wetStrokeEventsStreamDelay=60;class f{constructor(h,g){this.clientId=h,this._lastUpdated=Date.now(),this._userInfo=g}setPosition(h){this._lastUpdated=Date.now(),this.renderedElement&&(this.renderedElement.style.left=h.x+"px",this.renderedElement.style.top=h.y+"px")}set userInfo(h){this._userInfo=h}get userInfo(){return this._userInfo}get idleTime(){return Date.now()-this._lastUpdated}get renderedElement(){return this._renderedElement||(this._renderedElement=this.internalRender()),this._renderedElement}}od.LiveCursor=f;class b extends f{internalRender(){const h=[{x:0,y:0},{x:10,y:30},{x:17,y:17},{x:30,y:10}];if(!this._arrowPathData||!this._arrowBounds){this._arrowPathData="",this._arrowBounds={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE};for(let M=0;M<h.length;M++){const j=h[M];this._arrowBounds=(0,i.expandRect)(this._arrowBounds,j),this._arrowPathData+=`${M===0?"M":"L"} ${j.x} ${j.y} `}this._arrowPathData+="Z"}const g=this._arrowBounds.right-this._arrowBounds.left,_=this._arrowBounds.bottom-this._arrowBounds.top,S=10,p=(0,o.toCssRgbaColor)(this._color.textColor),w=(0,o.toCssRgbaColor)((0,o.lightenColor)(this._color.backgroundColor,80)),O=(0,o.toCssRgbaColor)(this._color.backgroundColor);let E=`
            <svg viewbox="-${S} -${S} ${2*S+g} ${2*S+_}"
                width="${g}" height="${_}" style="filter: drop-shadow(0px 0px 1px rgba(0, 0, 0, .7)">
                <path d="${this._arrowPathData}" stroke="${w}" stroke-width="10" stroke-linejoin="round" stroke-opacity="0.90"/>
                <path d="${this._arrowPathData}" fill="${O}" stroke="${O}" stroke-width="2" stroke-linejoin="round"/>
            </svg>`;this.userInfo&&(this.userInfo.displayName&&!this.userInfo.pictureUri?E+=`
                    <div style="display: flex; align-items: center; box-shadow: 0 0 2px black; background-color: ${O};
                        height: ${_}px; color: ${p}; border-radius: ${_/2}px / 50%;
                        border-top-left-radius: 4px; padding: 2px 8px; margin: ${_*.75}px 0 0 -${g*.25}px;
                        white-space: nowrap; font-size: 12px; font-family: sans-serif">
                        ${this.userInfo.displayName}
                    </div>`:this.userInfo.pictureUri&&!this.userInfo.displayName?E+=`
                    <img src="${this.userInfo.pictureUri}" style="width: ${_*1.1}px; height: ${_*1.1}px;
                        border-radius: 50%; box-shadow: 0 0 2px black;
                        margin: ${_*.75}px 0 0 -${g*.25}px;">`:this.userInfo.pictureUri&&this.userInfo.displayName&&(E+=`
                    <div style="display: flex; flex-direction: row; align-items: center; background-color: ${O}; color: ${p};
                        border-radius: ${_/2}px / 50%; margin: ${_*.75}px 0 0 -${g*.25}px;
                        padding: 2px; white-space: nowrap; font-size: 12px; font-family: sans-serif; box-shadow: 0 0 2px black">
                        <img src="${this.userInfo.pictureUri}" style="width: ${_*1.1}px; height: ${_*1.1}px; border-radius: 50%;">
                        <div style="padding: 0 8px">${this.userInfo.displayName}</div>
                    </div>`));const F=document.createElement("template");F.innerHTML=E;const R=document.createElement("div");return R.style.position="absolute",R.style.display="flex",R.style.flexDirection="row",R.appendChild(F.content.cloneNode(!0)),R}constructor(h,g){super(h,g),this.clientId=h,this._color=b.cursorColors[b.currentColorIndex],b.currentColorIndex++,b.currentColorIndex>=b.cursorColors.length&&(b.currentColorIndex=0)}}b.cursorColors=[{backgroundColor:o.BasicColors.red,textColor:o.BasicColors.white},{backgroundColor:o.BasicColors.green,textColor:o.BasicColors.white},{backgroundColor:o.BasicColors.blue,textColor:o.BasicColors.white},{backgroundColor:o.BasicColors.purple,textColor:o.BasicColors.white},{backgroundColor:o.BasicColors.magenta,textColor:o.BasicColors.white},{backgroundColor:o.BasicColors.violet,textColor:o.BasicColors.white},{backgroundColor:o.BasicColors.gray,textColor:o.BasicColors.white},{backgroundColor:o.BasicColors.silver,textColor:o.BasicColors.black}],b.currentColorIndex=0;let C=class sl extends s.LiveDataObject{constructor(){super(...arguments),this._processingIncomingChanges=!1,this._wetStrokes=new Map,this._pendingLiveStrokes=new Map,this._liveCursorsMap=new Map,this._isCursorShared=!1,this.liveStrokeProcessed=h=>{this.onLocalUserAllowed(()=>e(this,void 0,void 0,function*(){var g;try{yield this._addWetStrokePointEventTarget.sendEvent({isCursorShared:this.isCursorShared?!0:void 0,strokeId:h.id,points:h.points,endState:h.endState})}catch(_){(g=this._logger)===null||g===void 0||g.sendErrorEvent(u.TelemetryEvents.LiveCanvas.AddWetStrokeEventError,_)}h.clear()}))}}getLocalUserPictureUrl(){return this.onGetLocalUserPictureUrl?this.onGetLocalUserPictureUrl():void 0}setupWetInkProcessing(){this._inkingManager&&(this._inkingManager.on(t.PointerMovedEvent,g=>{this.isCursorShared&&this.onLocalUserAllowed(()=>e(this,void 0,void 0,function*(){var _;try{this._pointerMovedEventTarget.sendEvent({position:g.position,pictureUri:this.getLocalUserPictureUrl()})}catch(S){(_=this._logger)===null||_===void 0||_.sendErrorEvent(u.TelemetryEvents.LiveCanvas.PointerMovedEventError,S)}}))}),this._inkingManager.on(t.BeginStrokeEvent,g=>{const _=new l(g.strokeId,g.type,g.brush,sl.wetStrokePointSimplificationThreshold);_.points.push(g.startPoint),this._pendingLiveStrokes.set(_.id,_),this.onLocalUserAllowed(()=>e(this,void 0,void 0,function*(){var S;try{this._beginWetStrokeEventTarget.sendEvent(Object.assign({isCursorShared:this.isCursorShared?!0:void 0,pictureUri:this.getLocalUserPictureUrl()},g))}catch(p){(S=this._logger)===null||S===void 0||S.sendErrorEvent(u.TelemetryEvents.LiveCanvas.BeginWetStrokeError,p)}}))}),this._inkingManager.on(t.AddPointsEvent,g=>{const _=this._pendingLiveStrokes.get(g.strokeId);_!==void 0&&(!g.endState&&g.points.length>0&&_.points.push(...g.points),_.endState=g.endState,g.endState&&this._pendingLiveStrokes.delete(g.strokeId),g.points.length>0&&_.scheduleProcessing(this.liveStrokeProcessed))}));const h=new s.LiveEventScope(this.runtime,this.liveRuntime,this.allowedRoles);this._pointerMovedEventTarget=new s.LiveEventTarget(h,d.pointerMove,(g,_)=>{!_&&g.clientId&&this.updateCursorPosition(g.clientId,{pictureUri:g.data.pictureUri},g.data.position)}),this._beginWetStrokeEventTarget=new s.LiveEventTarget(h,d.beginWetStroke,(g,_)=>{if(!_&&this._inkingManager){const S=this._inkingManager.beginWetStroke(g.data.type,g.data.mode,g.data.startPoint,{id:g.data.strokeId,clientId:g.clientId,timeStamp:g.timestamp,brush:g.data.brush});this._wetStrokes.set(g.data.strokeId,S),g.clientId&&(g.data.type!==r.StrokeType.persistent||!g.data.isCursorShared?this.removeCursor(g.clientId):this.updateCursorPosition(g.clientId,{pictureUri:g.data.pictureUri},g.data.startPoint))}}),this._addWetStrokePointEventTarget=new s.LiveEventTarget(h,d.addWetStrokePoints,(g,_)=>{if(!_){const S=this._wetStrokes.get(g.data.strokeId);S&&(S.addPoints(...g.data.points),g.data.endState===t.StrokeEndState.cancelled?S.cancel():g.data.endState===t.StrokeEndState.ended&&S.type===r.StrokeType.ephemeral&&S.end(),g.clientId&&(S.type!==r.StrokeType.persistent||g.data.endState||!g.data.isCursorShared?this.removeCursor(g.clientId):this.updateCursorPosition(g.clientId,{pictureUri:g.data.pictureUri},g.data.points[g.data.points.length-1])))}})}setupStorageProcessing(){if(this._inkingManager){const h=this._inkingManager;this._dryInkMap.forEach(g=>{const _=new r.Stroke;_.deserialize(g),h.addStroke(_)}),this._dryInkMap.on("valueChanged",(g,_)=>{var S;this._processingIncomingChanges=!0;try{if(!_){const p=this._dryInkMap.get(g.key),w={forceReRender:!0,addToChangeLog:!1};if(p!==void 0){const O=(S=h.getStroke(g.key))!==null&&S!==void 0?S:new r.Stroke;O.deserialize(p);const E=this._wetStrokes.get(O.id);E&&(E.cancel(),this._wetStrokes.delete(E.id)),h.addStroke(O,w)}else h.removeStroke(g.key,w)}}finally{this._processingIncomingChanges=!1}}),this._dryInkMap.on("op",(g,_)=>{this._processingIncomingChanges=!0;try{_||g.contents.type==="clear"&&h.clear()}finally{this._processingIncomingChanges=!1}}),h.on(t.StrokesAddedEvent,g=>{if(!this._processingIncomingChanges)for(let _ of g)this._dryInkMap.set(_.id,_.serialize())}),h.on(t.StrokesRemovedEvent,g=>{if(!this._processingIncomingChanges)for(let _ of g)this._dryInkMap.delete(_)}),h.on(t.ClearEvent,()=>{this._processingIncomingChanges||this._dryInkMap.clear()})}}sweepLiveCursors(){const h=[];this._liveCursorsMap.forEach(g=>{g.idleTime>sl.liveCursorIdleLifetime&&h.push(g.clientId)});for(let g of h)this.removeCursor(g)}scheduleLiveCursorSweep(){this._liveCursorSweepTimeout===void 0&&(this._liveCursorSweepTimeout=window.setTimeout(()=>{this._liveCursorSweepTimeout=void 0,this.sweepLiveCursors(),this._liveCursorsMap.size>0&&this.scheduleLiveCursorSweep()},sl.liveCursorSweepFrequency))}getCursor(h,g){let _=this._liveCursorsMap.get(h);return _?g?.displayName&&(_.userInfo=g):(_=this.onCreateLiveCursor?this.onCreateLiveCursor(h,g):new b(h,g),this._liveCursorsMap.set(h,_)),this._liveCursorsHost.contains(_.renderedElement)||this._liveCursorsHost.appendChild(_.renderedElement),this.scheduleLiveCursorSweep(),_}removeCursor(h){const g=this._liveCursorsMap.get(h);g&&this._liveCursorsHost.contains(g.renderedElement)&&this._liveCursorsHost.removeChild(g.renderedElement)}updateCursorPosition(h,g,_){_?this.liveRuntime.getClientInfo(h).then(S=>{if(this._inkingManager){const p={displayName:S?.displayName,pictureUri:g?.pictureUri},w=this.getCursor(h,p),O=this._inkingManager.viewportToScreen(_);w.setPosition(O)}}):this.removeCursor(h)}initializingFirstTime(){return e(this,void 0,void 0,function*(){this._dryInkMap=a.SharedMap.create(this.runtime,sl.dryInkMapKey),this.root.set(sl.dryInkMapKey,this._dryInkMap.handle)})}hasInitialized(){return e(this,void 0,void 0,function*(){const h=this.root.get(sl.dryInkMapKey);if(h)this._dryInkMap=yield h.get();else throw new Error(`Unable to get SharedMap with key "${sl.dryInkMapKey}"`)})}initialize(h,g){return e(this,void 0,void 0,function*(){this.initializeState=s.LiveDataObjectInitializeState.pending,this._inkingManager=h,g&&(this._allowedRoles=g),this._inkingManager.inputProvider=new v(this._inkingManager.inputProvider,()=>this.verifyLocalUserRoles()),this._logger=new s.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.setupStorageProcessing(),this.setupWetInkProcessing(),this._liveCursorsHost=document.createElement("div"),this._liveCursorsHost.style.position="absolute",this._liveCursorsHost.style.pointerEvents="none",this._liveCursorsHost.style.width="100%",this._liveCursorsHost.style.height="100%",this._liveCursorsHost.style.overflow="hidden",h.hostElement.appendChild(this._liveCursorsHost),this.initializeState=s.LiveDataObjectInitializeState.succeeded})}get isCursorShared(){return this._isCursorShared}set isCursorShared(h){this._isCursorShared!==h&&(this._isCursorShared=h,this._isCursorShared||this.onLocalUserAllowed(()=>e(this,void 0,void 0,function*(){var g;try{yield this._pointerMovedEventTarget.sendEvent({})}catch(_){(g=this._logger)===null||g===void 0||g.sendErrorEvent(u.TelemetryEvents.LiveCanvas.PointerMovedEventError,_)}})))}get allowedRoles(){return this._allowedRoles}set allowedRoles(h){this._allowedRoles=h,this.setupWetInkProcessing()}};C.dryInkMapKey="dryInk",C.wetStrokePointSimplificationThreshold=100.05,C.liveCursorSweepFrequency=1e3,C.liveCursorIdleLifetime=5e3,C.TypeName="@microsoft/shared-inking-session",C.factory=new n.DataObjectFactory(C.TypeName,C,[],{}),od.LiveCanvas=C;class v extends c.InputProvider{constructor(h,g){super(),this.delegate=h,this.verifyLocalUserRoles=g}activate(){this.verifyLocalUserRoles().then(h=>{h?this.delegate.activate():this.delegate.deactivate()})}deactivate(){this.delegate.deactivate()}get isActive(){return this.delegate.isActive}get pointerDown(){return this.delegate.pointerDown}get pointerMove(){return this.delegate.pointerMove}get pointerUp(){return this.delegate.pointerUp}get pointerEnter(){return this.delegate.pointerEnter}get pointerLeave(){return this.delegate.pointerLeave}}return s.DynamicObjectRegistry.registerObjectClass(C,C.TypeName),od}var Lne;function PI(){return Lne||(Lne=1,(function(e){var n=Rg&&Rg.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Rg&&Rg.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(pL(),e),a(mL(),e),a(OI(),e),a(Cue(),e),a(qPe(),e),a(gL(),e)})(Rg)),Rg}var Bne;function LPe(){return Bne||(Bne=1,(function(e){var n=Ig&&Ig.__createBinding||(Object.create?(function(t,i,r,s){s===void 0&&(s=r);var o=Object.getOwnPropertyDescriptor(i,r);(!o||("get"in o?!i.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(t,s,o)}):(function(t,i,r,s){s===void 0&&(s=r),t[s]=i[r]})),a=Ig&&Ig.__exportStar||function(t,i){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&n(i,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),a(PI(),e),a(bue(),e),a(yL(),e)})(Ig)),Ig}LPe();/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the Microsoft Live Share SDK License.
 */function bL(e,n){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(t=Object.getOwnPropertySymbols(e);i<t.length;i++)n.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(e,t[i])&&(a[t[i]]=e[t[i]])}return a}function qT(e,n,a,t){return new(a||(a=Promise))((function(i,r){function s(c){try{u(t.next(c))}catch(d){r(d)}}function o(c){try{u(t.throw(c))}catch(d){r(d)}}function u(c){var d;c.done?i(c.value):(d=c.value,d instanceof a?d:new a((function(l){l(d)}))).then(s,o)}u((t=t.apply(e,[])).next())}))}var Une,zne,Vne,Lk,Hne,Kne,$ne,Bk,Gne,Wne;(function(e){e.Inline="inline",e.Desktop="desktop",e.Web="web"})(Une||(Une={})),(function(e){e.M365Content="m365content"})(zne||(zne={})),(function(e){e.DriveId="driveId",e.GroupId="groupId",e.SiteId="siteId",e.UserId="userId"})(Vne||(Vne={})),(function(e){e[e.NOT_SUPPORTED_ON_PLATFORM=100]="NOT_SUPPORTED_ON_PLATFORM",e[e.INTERNAL_ERROR=500]="INTERNAL_ERROR",e[e.NOT_SUPPORTED_IN_CURRENT_CONTEXT=501]="NOT_SUPPORTED_IN_CURRENT_CONTEXT",e[e.PERMISSION_DENIED=1e3]="PERMISSION_DENIED",e[e.NETWORK_ERROR=2e3]="NETWORK_ERROR",e[e.NO_HW_SUPPORT=3e3]="NO_HW_SUPPORT",e[e.INVALID_ARGUMENTS=4e3]="INVALID_ARGUMENTS",e[e.UNAUTHORIZED_USER_OPERATION=5e3]="UNAUTHORIZED_USER_OPERATION",e[e.INSUFFICIENT_RESOURCES=6e3]="INSUFFICIENT_RESOURCES",e[e.THROTTLE=7e3]="THROTTLE",e[e.USER_ABORT=8e3]="USER_ABORT",e[e.OPERATION_TIMED_OUT=8001]="OPERATION_TIMED_OUT",e[e.OLD_PLATFORM=9e3]="OLD_PLATFORM",e[e.FILE_NOT_FOUND=404]="FILE_NOT_FOUND",e[e.SIZE_EXCEEDED=1e4]="SIZE_EXCEEDED"})(Lk||(Lk={})),(function(e){e.GeoLocation="geolocation",e.Media="media"})(Hne||(Hne={})),(function(e){e.BCAIS="bcais",e.BCWAF="bcwaf",e.BCWBF="bcwbf"})(Kne||(Kne={})),(function(e){e.Faculty="faculty",e.Student="student",e.Other="other"})($ne||($ne={})),(function(e){e.Adult="adult",e.MinorNoParentalConsentRequired="minorNoParentalConsentRequired",e.MinorWithoutParentalConsent="minorWithoutParentalConsent",e.MinorWithParentalConsent="minorWithParentalConsent",e.NotAdult="notAdult",e.NonAdult="notAdult"})(Bk||(Bk={})),(function(e){e.HigherEducation="higherEducation",e.K12="k12",e.Other="other"})(Gne||(Gne={})),(function(e){e.TextPlain="text/plain",e.TextHtml="text/html",e.ImagePNG="image/png",e.ImageJPEG="image/jpeg"})(Wne||(Wne={}));var Jn,Uk,Ha,Jne,Qne,Yne,Xne,Zne;(function(e){e.desktop="desktop",e.web="web",e.android="android",e.ios="ios",e.ipados="ipados",e.macos="macos",e.visionOS="visionOS",e.rigel="rigel",e.surfaceHub="surfaceHub",e.teamsRoomsWindows="teamsRoomsWindows",e.teamsRoomsAndroid="teamsRoomsAndroid",e.teamsPhones="teamsPhones",e.teamsDisplays="teamsDisplays"})(Jn||(Jn={})),(function(e){e.office="Office",e.outlook="Outlook",e.outlookWin32="OutlookWin32",e.orange="Orange",e.places="Places",e.teams="Teams",e.teamsModern="TeamsModern"})(Uk||(Uk={})),(function(e){e.settings="settings",e.content="content",e.authentication="authentication",e.remove="remove",e.task="task",e.sidePanel="sidePanel",e.stage="stage",e.meetingStage="meetingStage"})(Ha||(Ha={})),(function(e){e.copilotSidePanel="copilotSidePanel",e.copilotMainPane="copilotMainPane",e.copilotFullScreen="copilotFullScreen"})(Jne||(Jne={})),(function(e){e[e.Standard=0]="Standard",e[e.Edu=1]="Edu",e[e.Class=2]="Class",e[e.Plc=3]="Plc",e[e.Staff=4]="Staff"})(Qne||(Qne={})),(function(e){e[e.Admin=0]="Admin",e[e.User=1]="User",e[e.Guest=2]="Guest"})(Yne||(Yne={})),(function(e){e.Large="large",e.Medium="medium",e.Small="small"})(Xne||(Xne={})),(function(e){e.Regular="Regular",e.Private="Private",e.Shared="Shared"})(Zne||(Zne={}));const EI={errorCode:Lk.NOT_SUPPORTED_ON_PLATFORM},BPe={adaptiveCardSchemaVersion:{majorVersion:1,minorVersion:5}};var ere={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let qP;const UPe=new Uint8Array(16);function zPe(){if(!qP&&(qP=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!qP))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return qP(UPe)}const is=[];for(let e=0;e<256;++e)is.push((e+256).toString(16).slice(1));function VPe(e,n=0){return is[e[n+0]]+is[e[n+1]]+is[e[n+2]]+is[e[n+3]]+"-"+is[e[n+4]]+is[e[n+5]]+"-"+is[e[n+6]]+is[e[n+7]]+"-"+is[e[n+8]]+is[e[n+9]]+"-"+is[e[n+10]]+is[e[n+11]]+is[e[n+12]]+is[e[n+13]]+is[e[n+14]]+is[e[n+15]]}function HPe(e,n,a){if(ere.randomUUID&&!e)return ere.randomUUID();const t=(e=e||{}).random||(e.rng||zPe)();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,VPe(t)}var KPe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function $Pe(e){return typeof e=="string"&&KPe.test(e)}function _ue(e,n){if(typeof e!="string"||typeof n!="string")return NaN;const a=e.split("."),t=n.split(".");function i(r){return/^\d+$/.test(r)}if(!a.every(i)||!t.every(i))return NaN;for(;a.length<t.length;)a.push("0");for(;t.length<a.length;)t.push("0");for(let r=0;r<a.length;++r)if(Number(a[r])!=Number(t[r]))return Number(a[r])>Number(t[r])?1:-1;return 0}function GPe(){return HPe()}function Tue(e){return Object.keys(e).forEach((n=>{e[n]!==null&&e[n]!==void 0&&typeof e[n]=="object"&&Tue(e[n])})),Object.freeze(e)}function WPe(e,n,a){return new Promise(((t,i)=>{const r=setTimeout(i,n,a);e().then((s=>{clearTimeout(r),t(s)})).catch((s=>{clearTimeout(r),i(s)}))}))}function JPe(e){return e.protocol==="https:"}function QPe(){if(II())throw new Error("window object undefined at SSR check");return window}function II(){return typeof window>"u"}function YPe(e){return new RegExp(`${/<script[^>]*>|&lt;script[^&]*&gt;|%3Cscript[^%]*%3E/gi.source}|${/<\/script[^>]*>|&lt;\/script[^&]*&gt;|%3C\/script[^%]*%3E/gi.source}`,"gi").test(e)}function XPe(e){if(!e)throw new Error("id must not be empty");if($Pe(e)===!1)throw new Error("id must be a valid UUID")}const ZPe=!!performance&&"now"in performance;function vL(){return ZPe?performance.now()+performance.timeOrigin:void 0}function tre(e){var n,a;if(!(!((a=(n=e.hostVersionsInfo)===null||n===void 0?void 0:n.appEligibilityInformation)===null||a===void 0)&&a.ageGroup))return e;const t=e.hostVersionsInfo.appEligibilityInformation.ageGroup;return t?.toLowerCase()!=="nonadult"?e:Object.assign(Object.assign({},e),{hostVersionsInfo:Object.assign(Object.assign({},e.hostVersionsInfo),{appEligibilityInformation:Object.assign(Object.assign({},e.hostVersionsInfo.appEligibilityInformation),{ageGroup:Bk.NotAdult})})})}let LT=class{constructor(n=GPe()){this.uuid=n,XPe(n)}toString(){return this.uuid}serialize(){return this.toString()}};const wue=e=>{const{uuid:n}=e,a=bL(e,["uuid"]),t=n?.toString();return Object.assign(Object.assign({},a),{uuidAsString:t})},eEe=e=>{const{uuidAsString:n}=e,a=bL(e,["uuidAsString"]);return Object.assign(Object.assign({},a),{uuid:n?new LT(n):void 0})};var zk={exports:{}},nre,rre;function tEe(){if(rre)return nre;rre=1;var e=1e3,n=60*e,a=60*n,t=24*a,i=7*t,r=365.25*t;function s(o,u,c,d){var l=u>=1.5*c;return Math.round(o/c)+" "+d+(l?"s":"")}return nre=function(o,u){u=u||{};var c=typeof o;if(c==="string"&&o.length>0)return(function(d){if(!((d=String(d)).length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(l){var f=parseFloat(l[1]);switch((l[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return f*r;case"weeks":case"week":case"w":return f*i;case"days":case"day":case"d":return f*t;case"hours":case"hour":case"hrs":case"hr":case"h":return f*a;case"minutes":case"minute":case"mins":case"min":case"m":return f*n;case"seconds":case"second":case"secs":case"sec":case"s":return f*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}})(o);if(c==="number"&&isFinite(o))return u.long?(function(d){var l=Math.abs(d);return l>=t?s(d,l,t,"day"):l>=a?s(d,l,a,"hour"):l>=n?s(d,l,n,"minute"):l>=e?s(d,l,e,"second"):d+" ms"})(o):(function(d){var l=Math.abs(d);return l>=t?Math.round(d/t)+"d":l>=a?Math.round(d/a)+"h":l>=n?Math.round(d/n)+"m":l>=e?Math.round(d/e)+"s":d+"ms"})(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))}}var nEe=function(e){function n(i){let r,s,o,u=null;function c(...d){if(!c.enabled)return;const l=c,f=Number(new Date),b=f-(r||f);l.diff=b,l.prev=r,l.curr=f,r=f,d[0]=n.coerce(d[0]),typeof d[0]!="string"&&d.unshift("%O");let C=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,((v,m)=>{if(v==="%%")return"%";C++;const h=n.formatters[m];if(typeof h=="function"){const g=d[C];v=h.call(l,g),d.splice(C,1),C--}return v})),n.formatArgs.call(l,d),(l.log||n.log).apply(l,d)}return c.namespace=i,c.useColors=n.useColors(),c.color=n.selectColor(i),c.extend=a,c.destroy=n.destroy,Object.defineProperty(c,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(s!==n.namespaces&&(s=n.namespaces,o=n.enabled(i)),o),set:d=>{u=d}}),typeof n.init=="function"&&n.init(c),c}function a(i,r){const s=n(this.namespace+(r===void 0?":":r)+i);return s.log=this.log,s}function t(i){return i.toString().substring(2,i.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(i){return i instanceof Error?i.stack||i.message:i},n.disable=function(){const i=[...n.names.map(t),...n.skips.map(t).map((r=>"-"+r))].join(",");return n.enable(""),i},n.enable=function(i){let r;n.save(i),n.namespaces=i,n.names=[],n.skips=[];const s=(typeof i=="string"?i:"").split(/[\s,]+/),o=s.length;for(r=0;r<o;r++)s[r]&&((i=s[r].replace(/\*/g,".*?"))[0]==="-"?n.skips.push(new RegExp("^"+i.slice(1)+"$")):n.names.push(new RegExp("^"+i+"$")))},n.enabled=function(i){if(i[i.length-1]==="*")return!0;let r,s;for(r=0,s=n.skips.length;r<s;r++)if(n.skips[r].test(i))return!1;for(r=0,s=n.names.length;r<s;r++)if(n.names[r].test(i))return!0;return!1},n.humanize=tEe(),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((i=>{n[i]=e[i]})),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(i){let r=0;for(let s=0;s<i.length;s++)r=(r<<5)-r+i.charCodeAt(s),r|=0;return n.colors[Math.abs(r)%n.colors.length]},n.enable(n.load()),n},rEe={};(function(e,n){n.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;t.splice(1,0,i,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(o=>{o!=="%%"&&(r++,o==="%c"&&(s=r))})),t.splice(s,0,i)},n.save=function(t){try{t?n.storage.setItem("debug",t):n.storage.removeItem("debug")}catch{}},n.load=function(){let t;try{t=n.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=rEe.DEBUG),t},n.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage=(function(){try{return localStorage}catch{}})(),n.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.log=console.debug||console.log||(()=>{}),e.exports=nEe(n);const{formatters:a}=e.exports;a.j=function(t){try{return JSON.stringify(t)}catch(i){return"[UnexpectedJSONParseError]: "+i.message}}})(zk,zk.exports);var SL=zk.exports;const iEe=new LT,sEe=SL.debug.formatArgs;SL.debug.formatArgs=function(e){e[0]=`(${new Date().toISOString()}): ${e[0]} [${iEe.toString()}]`,sEe.call(this,e)};const aEe=SL.debug("teamsJs");function Fc(e){return aEe.extend(e)}function ar(e,n){return`${e}_${n}`}function Oue(e){return/^v\d+_[\w.]+$/.test(e)}function ul(e){return e.uuidAsString!==void 0?`${e.uuidAsString} (legacy id: ${e.id})`:e.uuid!==void 0?`${e.uuid.toString()} (legacy id: ${e.id})`:`legacy id: ${e.id} (no uuid)`}const oEe=Fc("flushMessageQueue");function Pue(e,n,a,t){if(e&&n&&a.length!==0)for(;a.length>0;){const i=a.shift();if(i){const r=wue(i);oEe("Flushing message %s from %s message queue via postMessage.",ul(r),t),e.postMessage(r,n)}}}var cEe=["teams.microsoft.com","teams.microsoft.us","gov.teams.microsoft.us","dod.teams.microsoft.us","int.teams.microsoft.com","outlook.office.com","outlook-sdf.office.com","outlook.office365.com","outlook-sdf.office365.com","outlook.office365.us","outlook-dod.office365.us","webmail.apps.mil","outlook.live.com","outlook-sdf.live.com","teams.live.com","local.teams.live.com","local.teams.live.com:8080","local.teams.office.com","local.teams.office.com:8080","devspaces.skype.com","*.www.office.com","www.office.com","word.office.com","excel.office.com","powerpoint.office.com","www.officeppe.com","*.www.microsoft365.com","www.microsoft365.com","bing.com","edgeservices.bing.com","work.bing.com","www.bing.com","www.staging-bing-int.com","*.cloud.microsoft","*.m365.cloud.microsoft","*.outlook.cloud.microsoft","chatuxmanager.svc.cloud.microsoft","copilot.microsoft.com","windows.msn.com","fa000000125.resources.office.net","fa000000129.resources.office.net","fa000000124.resources.office.net","fa000000128.resources.office.net","fa000000136.resources.office.net","fa000000125.officeapps.live.com","fa000000129.officeapps.live.com","fa000000124.officeapps.live.com","fa000000128.officeapps.live.com"];const ire="2.0.1",GP=cEe,sre=1500,uEe=new URL("https://res.cdn.office.net/teams-js/validDomains/json/validDomains.json"),dEe=/^https:\/\//,nE="The library has not yet been initialized",lEe="The runtime has not yet been initialized",fEe="The runtime version is not supported";let En=class{};En.initializeCalled=!1,En.initializeCompleted=!1,En.additionalValidOrigins=[],En.initializePromise=void 0,En.isFramelessWindow=!1,En.frameContext=void 0,En.hostClientType=void 0,En.printCapabilityEnabled=!1,En.teamsJsInstanceId=new LT().toString();const Eue=Fc("runtime"),RI=4;function Iue(e){return e.apiVersion===RI}function hEe(e){if(Iue(e))return!0;throw e.apiVersion===-1?new Error(lEe):new Error(fEe)}let gs={apiVersion:-1,supports:{}};const mEe={supports:{appInstallDialog:{},appEntity:{},call:{},chat:{},conversations:{},dialog:{card:{bot:{}},url:{bot:{},parentCommunication:{}},update:{}},interactive:{},logs:{},meetingRoom:{},menus:{},monetization:{},notifications:{},pages:{config:{},backStack:{},fullTrust:{}},remoteCamera:{},teams:{fullTrust:{}},teamsCore:{},video:{sharedFrame:{}}}},Rue=[Jn.desktop,Jn.web,Jn.rigel,Jn.surfaceHub,Jn.teamsRoomsWindows,Jn.teamsRoomsAndroid,Jn.teamsPhones,Jn.teamsDisplays],pEe=[Jn.android,Jn.ios,Jn.ipados,Jn.visionOS],are=[...Rue,...pEe];function gEe(e){let n=e;if(n.apiVersion<RI&&yEe.forEach((a=>{n.apiVersion===a.versionToUpgradeFrom&&(n=a.upgradeToNextVersion(n))})),Iue(n))return n;throw new Error("Received a runtime that could not be upgraded to the latest version")}const yEe=[{versionToUpgradeFrom:1,upgradeToNextVersion:e=>{var n;return{apiVersion:2,hostVersionsInfo:void 0,isLegacyTeams:e.isLegacyTeams,supports:Object.assign(Object.assign({},e.supports),{dialog:e.supports.dialog?{card:void 0,url:e.supports.dialog,update:(n=e.supports.dialog)===null||n===void 0?void 0:n.update}:void 0})}}},{versionToUpgradeFrom:2,upgradeToNextVersion:e=>{const n=e.supports,a=bL(n,["appNotification"]);return Object.assign(Object.assign({},e),{apiVersion:3,supports:a})}},{versionToUpgradeFrom:3,upgradeToNextVersion:e=>{var n,a,t,i,r;return{apiVersion:4,hostVersionsInfo:e.hostVersionsInfo,isNAAChannelRecommended:e.isNAAChannelRecommended,isLegacyTeams:e.isLegacyTeams,supports:Object.assign(Object.assign({},e.supports),{dialog:e.supports.dialog?{card:(n=e.supports.dialog)===null||n===void 0?void 0:n.card,url:{bot:(t=(a=e.supports.dialog)===null||a===void 0?void 0:a.url)===null||t===void 0?void 0:t.bot,parentCommunication:!((i=e.supports.dialog)===null||i===void 0)&&i.url?{}:void 0},update:(r=e.supports.dialog)===null||r===void 0?void 0:r.update}:void 0})}}}],bEe={"1.0.0":[{capability:{pages:{appButton:{},tabs:{}},stageView:{}},hostClientTypes:Rue}],"1.9.0":[{capability:{location:{}},hostClientTypes:are}],"2.0.0":[{capability:{people:{}},hostClientTypes:are},{capability:{sharing:{}},hostClientTypes:[Jn.desktop,Jn.web]}],"2.0.1":[{capability:{teams:{fullTrust:{joinedTeams:{}}}},hostClientTypes:[Jn.android,Jn.desktop,Jn.ios,Jn.teamsRoomsAndroid,Jn.teamsPhones,Jn.teamsDisplays,Jn.web]},{capability:{webStorage:{}},hostClientTypes:[Jn.desktop]}],"2.0.5":[{capability:{webStorage:{}},hostClientTypes:[Jn.android,Jn.ios]}],"2.0.8":[{capability:{sharing:{}},hostClientTypes:[Jn.android,Jn.ios]}],"2.1.1":[{capability:{nestedAppAuth:{}},hostClientTypes:[Jn.android,Jn.ios,Jn.ipados,Jn.visionOS]}],"2.1.2":[]},uk=Eue.extend("generateBackCompatRuntimeConfig");function Fue(e,n){const a=Object.assign({},e);for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(typeof n[t]!="object"||Array.isArray(n[t])?t in e||(a[t]=n[t]):a[t]=Fue(e[t]||{},n[t]));return a}function vEe(e,n,a){uk("generating back compat runtime config for %s",e);let t=Object.assign({},n.supports);uk("Supported capabilities in config before updating based on highestSupportedVersion: %o",t),Object.keys(a).forEach((r=>{_ue(e,r)>=0&&a[r].forEach((s=>{En.hostClientType!==void 0&&s.hostClientTypes.includes(En.hostClientType)&&(t=Fue(t,s.capability))}))}));const i={apiVersion:RI,hostVersionsInfo:BPe,isLegacyTeams:!0,supports:t};return uk("Runtime config after updating based on highestSupportedVersion: %o",i),i}const dk=Eue.extend("applyRuntimeConfig");function lk(e){typeof e.apiVersion=="string"&&(dk("Trying to apply runtime with string apiVersion, processing as v1: %o",e),e=Object.assign(Object.assign({},e),{apiVersion:1})),dk("Fast-forwarding runtime %o",e);const n=gEe(e);dk("Applying runtime %o",n),gs=Tue(n)}const jue="2.45.0";let rE=class Zy{static storeCallbackInformation(n,a){Zy.callbackInformation.set(n,a)}static clearMessages(){Zy.callbackInformation.clear()}static deleteMessageInformation(n){Zy.callbackInformation.delete(n)}static handleOneWayPerformanceMetrics(n,a,t){const i=n.monotonicTimestamp;i&&t?bre({actionName:n.func,messageDelay:t-i,requestStartedAt:i}):a("Unable to send performance metrics for event %s",n.func)}static handlePerformanceMetrics(n,a,t,i){const r=Zy.callbackInformation.get(n);r&&a.monotonicTimestamp&&i?(bre({actionName:r.name,messageDelay:i-a.monotonicTimestamp,requestStartedAt:r.calledAt}),Zy.deleteMessageInformation(n)):t("Unable to send performance metrics for callback %s with arguments %o",n.toString(),a.args)}};rE.callbackInformation=new Map;const Mue=Fc("nestedAppAuthUtils"),SEe=Mue.extend("tryPolyfillWithNestedAppAuthBridge"),CEe="v2";function _Ee(e,n,a){var t;const i=SEe;if(En.isFramelessWindow)return void i("Cannot polyfill nestedAppAuthBridge as current window is frameless");if(!n)return void i("Cannot polyfill nestedAppAuthBridge as current window does not exist");if(n.parent!==n.top)return void i("Default NAA bridge injection not supported in nested iframe. Use standalone NAA bridge instead.");const r=(()=>{try{return JSON.parse(e)}catch{return null}})();if(!r||!(!((t=r.supports)===null||t===void 0)&&t.nestedAppAuth))return void i("Cannot polyfill nestedAppAuthBridge as current hub does not support nested app auth");const s=n;if(s.nestedAppAuthBridge)return void i("nestedAppAuthBridge already exists on current window, skipping polyfill");const o=(function(u,c){const d=TEe;if(!u)return d("nestedAppAuthBridge cannot be created as current window does not exist"),null;const{onMessage:l,sendPostMessage:f}=c,b=C=>v=>l(v,C);return{addEventListener:(C,v)=>{C==="message"?u.addEventListener(C,b(v)):d(`Event ${C} is not supported by nestedAppAuthBridge`)},postMessage:C=>{const v=(()=>{try{return JSON.parse(C)}catch{return null}})();if(!v||typeof v!="object"||v.messageType!=="NestedAppAuthRequest")return void d("Unrecognized data format received by app, message being ignored. Message: %o",C);const m=ar(CEe,"nestedAppAuth.execute");f(C,m)},removeEventListener:(C,v)=>{u.removeEventListener(C,b(v))}}})(s,a);o&&(s.nestedAppAuthBridge=o)}const TEe=Mue.extend("createNestedAppAuthBridge");let ol=[];const cl=Fc("validateOrigin");let G1;function wEe(){return qT(this,void 0,void 0,(function*(){G1||(yield Aue())}))}function Nue(){return ol.length===0}function Aue(e=!1){return qT(this,void 0,void 0,(function*(){if(!Nue()&&!e)return ol;if(G1)return G1;if(II())return ol=GP,GP;{cl("Initiating fetch call to acquire valid origins list from CDN");const n=new AbortController,a=setTimeout((()=>n.abort()),sre);return G1=fetch(uEe,{signal:n.signal}).then((t=>{if(clearTimeout(a),!t.ok)throw new Error("Invalid Response from Fetch Call");return cl("Fetch call completed and retrieved valid origins list from CDN"),t.json().then((i=>{if((function(r){let s=JSON.parse(r);try{s=JSON.parse(r)}catch{return!1}if(!s.validOrigins)return!1;for(const o of s.validOrigins)try{new URL("https://"+o)}catch{return cl("isValidOriginsFromCDN call failed to validate origin: %s",o),!1}return!0})(JSON.stringify(i)))return ol=i.validOrigins,ol;throw new Error("Valid origins list retrieved from CDN is invalid")}))})).catch((t=>(t.name==="AbortError"?cl(`validOrigins fetch call to CDN failed due to Timeout of ${sre} ms. Defaulting to fallback list`):cl("validOrigins fetch call to CDN failed with error: %s. Defaulting to fallback list",t),ol=GP,ol))),G1}}))}function ore(e,n){if(e.substring(0,2)==="*."){const a=e.substring(1);if(n.length>a.length&&n.split(".").length===a.split(".").length&&n.substring(n.length-a.length)===a)return!0}else if(e===n)return!0;return!1}function OEe(e,n){const a=Nue()?GP:ol;return cre(e,a)?Promise.resolve(!0):(cl("Origin %s is not in the local valid origins list, fetching from CDN",e),Aue(n).then((t=>cre(e,t))))}function cre(e,n){if(!JPe(e))return cl("Origin %s is invalid because it is not using https protocol. Protocol being used: %s",e,e.protocol),!1;const a=e.host;if(n.some((t=>ore(t,a))))return!0;for(const t of En.additionalValidOrigins)if(ore(t.substring(0,8)==="https://"?t.substring(8):t,a))return!0;return cl(`Origin %s is invalid because it is not an origin approved by this library or included in the call to app.initialize.
Origins approved by this library: %o
Origins included in app.initialize: %o`,e,n,En.additionalValidOrigins),!1}wEe();const sy=Fc("communication");let Zt=class{},Zn=class{};function PEe(e,n){if(Zn.messageListener=a=>(function(t){return qT(this,void 0,void 0,(function*(){if(!t||!t.data||typeof t.data!="object")return void ure("Unrecognized message format received by app, message being ignored. Message: %o",t);const i=t.source||t.originalEvent&&t.originalEvent.source,r=t.origin||t.originalEvent&&t.originalEvent.origin;return xue(i,r).then((s=>{s?((function(o,u){En.isFramelessWindow||Zt.parentWindow&&!Zt.parentWindow.closed&&o!==Zt.parentWindow||(Zt.parentWindow=o,Zt.parentOrigin=u),Zt.parentWindow&&Zt.parentWindow.closed&&(Zt.parentWindow=null,Zt.parentOrigin=null),Pue(Zt.parentWindow,Zt.parentOrigin,Zn.parentMessageQueue,"parent")})(i,r),i!==Zt.parentWindow?EIe():lre(t)):ure("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin, message: %o, source: %o, origin: %o",t,i,r)}))}))})(a),Zt.currentWindow=Zt.currentWindow||QPe(),Zt.parentWindow=Zt.currentWindow.parent!==Zt.currentWindow.self?Zt.currentWindow.parent:Zt.currentWindow.opener,Zt.topWindow=Zt.currentWindow.top,(Zt.parentWindow||e)&&Zt.currentWindow.addEventListener("message",Zn.messageListener,!1),!Zt.parentWindow){const a=Zt.currentWindow;if(!a.nativeInterface)return Promise.reject(new Error("Initialization Failed. No Parent window found."));En.isFramelessWindow=!0,a.onNativeMessage=lre}try{return Zt.parentOrigin="*",BT(n,"initialize",[jue,RI,e]).then((([a,t,i,r])=>(_Ee(r,Zt.currentWindow,{onMessage:DEe,sendPostMessage:jEe}),{context:a,clientType:t,runtimeConfig:i,clientSupportedSDKVersion:r})))}finally{Zt.parentOrigin=null}}function EEe(e,n,...a){return BT(e,n,a).then((([t])=>t))}function IEe(e,n,...a){return BT(e,n,a).then((([t,i])=>{if(!t)throw new Error(i)}))}function REe(e,n,a,...t){return BT(e,n,t).then((([i,r])=>{if(!i)throw new Error(r||a)}))}function rl(e,n,...a){return BT(e,n,a).then((([t,i])=>{if(t)throw t;return i}))}function BT(e,n,a=void 0){if(!Oue(e))throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);return new Promise((t=>{const i=kue(e,n,a);var r;t((r=i.uuid,new Promise((s=>{Zn.promiseCallbacks.set(r,s)}))))}))}function Vo(e,n,a,t){let i;if(a instanceof Function?t=a:a instanceof Array&&(i=a),!Oue(e))throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);const r=kue(e,n,i);t&&Zn.callbacks.set(r.uuid,t)}Zn.parentMessageQueue=[],Zn.topMessageQueue=[],Zn.nextMessageId=0,Zn.callbacks=new Map,Zn.promiseCallbacks=new Map,Zn.portCallbacks=new Map,Zn.legacyMessageIdsToUuidMap={};const FEe=sy.extend("sendNestedAuthRequestToTopWindow");function jEe(e,n){const a=FEe,t=Zt.topWindow,i=(function(r,s){const o=Zn.nextMessageId++,u=new LT;return Zn.legacyMessageIdsToUuidMap[o]=u,{id:o,uuid:u,func:"nestedAppAuth.execute",timestamp:Date.now(),monotonicTimestamp:vL(),apiVersionTag:s,args:[],data:r}})(e,n);return a("Message %s information: %o",ul(i),{actionName:i.func}),Due(t,i)}const MEe=sy.extend("sendRequestToTargetWindowHelper");function Due(e,n){const a=MEe,t=(function(r){return r===Zt.topWindow&&Vk()?"top":r===Zt.parentWindow?"parent":null})(e),i=wue(n);if(En.isFramelessWindow)Zt.currentWindow&&Zt.currentWindow.nativeInterface&&(a("Sending message %s to %s via framelessPostMessage interface",ul(i),t),Zt.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(i)));else{const r=(function(s){return s===Zt.topWindow&&Vk()?Zt.topOrigin:s===Zt.parentWindow?Zt.parentOrigin:null})(e);e&&r?(a("Sending message %s to %s via postMessage",ul(i),t),e.postMessage(i,r)):(a("Adding message %s to %s message queue",ul(i),t),kEe(e).push(n))}return n}const NEe=sy.extend("sendMessageToParentHelper");function kue(e,n,a,t,i){const r=NEe,s=Zt.parentWindow,o=(function(u,c,d,l,f){const b=Zn.nextMessageId++,C=new LT;Zn.legacyMessageIdsToUuidMap[b]=C;const v=En.teamsJsInstanceId;return{id:b,uuid:C,func:c,timestamp:Date.now(),monotonicTimestamp:vL(),args:d||[],apiVersionTag:u,isProxiedFromChild:l!=null,teamsJsInstanceId:v}})(e,n,a,t);return rE.storeCallbackInformation(o.uuid,{name:n,calledAt:o.timestamp}),r("Message %s information: %o",ul(o),{actionName:n,args:a}),Due(s,o)}const ure=sy.extend("processIncomingMessage"),AEe=sy.extend("processAuthBridgeMessage");function DEe(e,n){var a,t;const i=AEe;if(!e||!e.data||typeof e.data!="object")return void i("Unrecognized message format received by app, message being ignored. Message: %o",e);const{args:r}=e.data,[,s]=r??[],o=(()=>{try{return JSON.parse(s)}catch{return null}})();if(!o||typeof o!="object"||o.messageType!=="NestedAppAuthResponse")return void i("Unrecognized data format received by app, message being ignored. Message: %o",e);const u=e.source||((a=e?.originalEvent)===null||a===void 0?void 0:a.source),c=e.origin||((t=e?.originalEvent)===null||t===void 0?void 0:t.origin);u?xue(u,c)?(Zt.topWindow&&!Zt.topWindow.closed&&u!==Zt.topWindow||(Zt.topWindow=u,Zt.topOrigin=c),Zt.topWindow&&Zt.topWindow.closed&&(Zt.topWindow=null,Zt.topOrigin=null),Pue(Zt.topWindow,Zt.topOrigin,Zn.topMessageQueue,"top"),n(s)):i("Message being ignored by app because it is either coming from the current window or a different window with an invalid origin"):i("Message being ignored by app because it is coming for a target that is null")}const fk=sy.extend("shouldProcessIncomingMessage");function xue(e,n){return qT(this,void 0,void 0,(function*(){if(Zt.currentWindow&&e===Zt.currentWindow)return fk("Should not process message because it is coming from the current window"),!1;if(Zt.currentWindow&&Zt.currentWindow.location&&n&&n===Zt.currentWindow.location.origin)return!0;{let a;try{a=new URL(n)}catch{return fk("Message has an invalid origin of %s",n),!1}const t=yield OEe(a);return t||fk("Message has an invalid origin of %s",n),t}}))}const dre=sy.extend("handleIncomingMessageFromParent");function WP(e,n){if(n){const a=[...e].find((([t,i])=>t.toString()===n.toString()));if(a)return a[0]}}function hk(e,n){const a=WP(n,e.uuid);a&&n.delete(a),e.uuid?Zn.legacyMessageIdsToUuidMap={}:delete Zn.legacyMessageIdsToUuidMap[e.id]}function lre(e){const n=dre,a=vL();if("id"in e.data&&typeof e.data.id=="number"){const t=e.data,i=eEe(t),r=(function(s){const o=dre;if(!s.uuid)return Zn.legacyMessageIdsToUuidMap[s.id];{const u=s.uuid,c=WP(Zn.callbacks,u);if(c)return c;const d=WP(Zn.promiseCallbacks,u);if(d)return d;const l=WP(Zn.portCallbacks,u);if(l)return l}o("Received message %s that failed to produce a callbackId",ul(s))})(i);if(r){const s=Zn.callbacks.get(r);n("Received a response from parent for message %s",r.toString()),rE.handlePerformanceMetrics(r,i,n,a),s&&(n("Invoking the registered callback for message %s with arguments %o",r.toString(),i.args),s.apply(null,[...i.args,i.isPartialResponse]),(function(c){return c.data.isPartialResponse===!0})(e)||(n("Removing registered callback for message %s",r.toString()),hk(i,Zn.callbacks)));const o=Zn.promiseCallbacks.get(r);o&&(n("Invoking the registered promise callback for message %s with arguments %o",r.toString(),i.args),o(i.args),n("Removing registered promise callback for message %s",r.toString()),hk(i,Zn.promiseCallbacks));const u=Zn.portCallbacks.get(r);if(u){let c;n("Invoking the registered port callback for message %s with arguments %o",r.toString(),i.args),e.ports&&e.ports[0]instanceof MessagePort&&(c=e.ports[0]),u(c,i.args),n("Removing registered port callback for message %s",r.toString()),hk(i,Zn.portCallbacks)}i.uuid&&(Zn.legacyMessageIdsToUuidMap={})}}else if("func"in e.data&&typeof e.data.func=="string"){const t=e.data;rE.handleOneWayPerformanceMetrics(t,n,a),n('Received a message from parent %s, action: "%s"',ul(t),t.func),CIe(t.func,t.args)}else n("Received an unknown message: %O",e)}function Vk(){return Zt.topWindow!==Zt.parentWindow}function kEe(e){return e===Zt.topWindow&&Vk()?Zn.topMessageQueue:e===Zt.parentWindow?Zn.parentMessageQueue:[]}const que=Fc("internal"),xEe=que.extend("ensureInitializeCalled"),qEe=que.extend("ensureInitialized");function LEe(){if(!En.initializeCalled)throw xEe(nE),new Error(nE)}function jc(e,...n){if(!En.initializeCompleted)throw qEe("%s. initializeCalled: %s",nE,En.initializeCalled.toString()),new Error(nE);if(n&&n.length>0){let a=!1;for(let t=0;t<n.length;t++)if(n[t]===En.frameContext){a=!0;break}if(!a)throw new Error(`This call is only allowed in following contexts: ${JSON.stringify(n)}. Current context: "${En.frameContext}".`)}return hEe(e)}function BEe(e){let n=En.additionalValidOrigins.concat(e.filter((t=>typeof t=="string"&&dEe.test(t))));const a={};n=n.filter((t=>!a[t]&&(a[t]=!0,!0))),En.additionalValidOrigins=n}function UEe(e){if(!VEe(e))throw new Error(`Potential app id (${e}) is invalid; its length ${e.length} is not within the length limits (${Lue}-${Bue}).`)}function zEe(e){if(YPe(e))throw new Error(`Potential app id (${e}) is invalid; it contains script tags.`);if(HEe(e))throw new Error(`Potential app id (${e}) is invalid; it contains non-printable characters.`)}const Lue=4,Bue=256;function VEe(e){return e.length<Bue&&e.length>Lue}function HEe(e){return[...e].some((n=>{const a=n.charCodeAt(0);return a<32||a>126}))}let KEe=class{constructor(n){this.idAsString=n,zEe(n)}serialize(){return this.toString()}toString(){return this.idAsString}},$Ee=class extends KEe{constructor(n){super(n),UEe(n)}toJSON(){return{appIdAsString:this.toString()}}};function Hk(e){return e==null}const Uue="v2",mk=Fc("app");var fre,hre;function GEe(e){return lIe(ar(Uue,"app.initialize"),e)}function WEe(){return new Promise((e=>{LEe(),e(EEe(ar(Uue,"app.getContext"),"getContext"))})).then((e=>(function(n){var a;return{actionInfo:n.actionInfo,app:{locale:n.locale,sessionId:n.appSessionId?n.appSessionId:"",theme:n.theme?n.theme:"default",iconPositionVertical:n.appIconPosition,osLocaleInfo:n.osLocaleInfo,messageId:n.messageId,parentMessageId:n.parentMessageId,userClickTime:n.userClickTime,userClickTimeV2:n.userClickTimeV2,userFileOpenPreference:n.userFileOpenPreference,host:{name:n.hostName?n.hostName:Uk.teams,clientType:n.hostClientType?n.hostClientType:Jn.web,sessionId:n.sessionId?n.sessionId:"",ringId:n.ringId},appLaunchId:n.appLaunchId,appId:n.appId?new $Ee(n.appId):void 0,manifestVersion:n.manifestVersion},page:{id:n.entityId,frameContext:n.frameContext?n.frameContext:En.frameContext,renderingSurface:n.renderingSurface?n.renderingSurface:void 0,subPageId:n.subEntityId,isFullScreen:n.isFullScreen,isMultiWindow:n.isMultiWindow,isBackgroundLoad:n.isBackgroundLoad,sourceOrigin:n.sourceOrigin},user:{id:(a=n.userObjectId)!==null&&a!==void 0?a:"",displayName:n.userDisplayName,isCallingAllowed:n.isCallingAllowed,isPSTNCallingAllowed:n.isPSTNCallingAllowed,licenseType:n.userLicenseType,loginHint:n.loginHint,userPrincipalName:n.userPrincipalName,tenant:n.tid?{id:n.tid,teamsSku:n.tenantSKU}:void 0},channel:n.channelId?{id:n.channelId,displayName:n.channelName,relativeUrl:n.channelRelativeUrl,membershipType:n.channelType,defaultOneNoteSectionId:n.defaultOneNoteSectionId,ownerGroupId:n.hostTeamGroupId,ownerTenantId:n.hostTeamTenantId}:void 0,chat:n.chatId?{id:n.chatId}:void 0,meeting:n.meetingId?{id:n.meetingId}:void 0,sharepoint:n.sharepoint,team:n.teamId?{internalId:n.teamId,displayName:n.teamName,type:n.teamType,groupId:n.groupId,templateId:n.teamTemplateId,isArchived:n.isTeamArchived,userRole:n.userTeamRole}:void 0,sharePointSite:n.teamSiteUrl||n.teamSiteDomain||n.teamSitePath||n.mySitePath||n.mySiteDomain?{teamSiteUrl:n.teamSiteUrl,teamSiteDomain:n.teamSiteDomain,teamSitePath:n.teamSitePath,teamSiteId:n.teamSiteId,mySitePath:n.mySitePath,mySiteDomain:n.mySiteDomain}:void 0,dialogParameters:n.dialogParameters||{}}})(e)))}(function(e){e.AuthFailed="AuthFailed",e.Timeout="Timeout",e.Other="Other"})(fre||(fre={})),(function(e){e.PermissionError="PermissionError",e.NotFound="NotFound",e.Throttling="Throttling",e.Offline="Offline",e.Other="Other"})(hre||(hre={})),mk("teamsjs instance is version %s, starting at %s UTC (%s local)",jue,new Date().toISOString(),new Date().toLocaleString()),(function(){if(II())return;const e=document.getElementsByTagName("script"),n=e&&e[e.length-1]&&e[e.length-1].src,a="Today, teamsjs can only be used from a single script or you may see undefined behavior. This log line is used to help detect cases where teamsjs is loaded multiple times -- it is always written. The presence of the log itself does not indicate a multi-load situation, but multiples of these log lines will. If you would like to use teamjs from more than one script at the same time, please open an issue at https://github.com/OfficeDev/microsoft-teams-library-js/issues";n&&n.length!==0?mk("teamsjs is being used from %s. %s",n,a):mk("teamsjs is being used from a script tag embedded directly in your html. %s",a)})();const JEe="v2",QEe=[];function YEe(e){En.frameContext&&(En.frameContext===Ha.task?QEe.push(e):_Ie("messageForChild"))}function XEe(){Ug(ar(JEe,"dialog.registerMessageForChildHandler"),"messageForChild",YEe,!1)}const tb="v2";var mre,pre;(function(e){e[e.ifRoom=0]="ifRoom",e[e.overflowOnly=1]="overflowOnly"})(mre||(mre={}));function ZEe(){Ug(ar(tb,"menus.registerNavBarMenuItemPressHandler"),"navBarMenuItemPress",tIe,!1),Ug(ar(tb,"menus.registerActionMenuItemPressHandler"),"actionMenuItemPress",nIe,!1),Ug(ar(tb,"menus.registerSetModuleViewHandler"),"setModuleView",eIe,!1)}function eIe(e){jc(gs),Vo(ar(tb,"menus.handleViewConfigItemPress"),"viewConfigItemPress",[e])}function tIe(e){jc(gs),Vo(ar(tb,"menus.handleNavBarMenuItemPress"),"handleNavBarMenuItemPress",[e])}function nIe(e){jc(gs),Vo(ar(tb,"menus.handleActionMenuItemPress"),"handleActionMenuItemPress",[e])}(function(e){e.dropDown="dropDown",e.popOver="popOver"})(pre||(pre={}));let Kk;function rIe(){Ug(ar(Cc,"pages.config.registerSettingsSaveHandler"),"settings.save",oIe,!1),Ug(ar(Cc,"pages.config.registerSettingsRemoveHandler"),"settings.remove",uIe,!1)}function gre(e){return pIe(ar(Cc,"pages.config.setValidityState"),e)}function iIe(e){return gIe(ar(Cc,"pages.config.setConfig"),e)}function sIe(e){aIe(ar(Cc,"pages.config.registerOnSaveHandler"),e,(()=>{if(!Hk(e)&&!CL())throw EI}))}function aIe(e,n,a){!Hk(n)&&jc(gs,Ha.settings),a&&a(),Kk=n,!Hk(n)&&Vo(e,"registerHandler",["save"])}function oIe(e){const n=new cIe(e);Kk?Kk(n):n.notifySuccess()}let cIe=class{constructor(n){this.notified=!1,this.result=n||{}}notifySuccess(){this.ensureNotNotified(),Vo(ar(Cc,"pages.saveEvent.notifySuccess"),"settings.save.success"),this.notified=!0}notifyFailure(n){this.ensureNotNotified(),Vo(ar(Cc,"pages.saveEvent.notifyFailure"),"settings.save.failure",[n]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The SaveEvent may only notify success or failure once.")}};function uIe(){new dIe().notifySuccess()}let dIe=class{constructor(){this.notified=!1}notifySuccess(){this.ensureNotNotified(),Vo(ar(Cc,"pages.removeEvent.notifySuccess"),"settings.remove.success"),this.notified=!0}notifyFailure(n){this.ensureNotNotified(),Vo(ar(Cc,"pages.removeEvent.notifyFailure"),"settings.remove.failure",[n]),this.notified=!0}ensureNotNotified(){if(this.notified)throw new Error("The removeEventType may only notify success or failure once.")}};function CL(){return!(!jc(gs)||!gs.supports.pages)&&!!gs.supports.pages.config}const zue=Fc("app");function lIe(e,n){return II()?(zue.extend("initialize")("window object undefined at initialization"),Promise.resolve()):WPe((()=>(function(a,t){return new Promise((i=>{En.initializeCalled||(En.initializeCalled=!0,SIe(),En.initializePromise=PEe(t,a).then((({context:r,clientType:s,runtimeConfig:o,clientSupportedSDKVersion:u=ire})=>{En.frameContext=r,En.hostClientType=s,En.clientSupportedSDKVersion=u;try{q1("Parsing %s",o);let c=JSON.parse(o);if(q1("Checking if %o is a valid runtime object",c??"null"),!c||!c.apiVersion)throw new Error("Received runtime config is invalid");c=tre(c),o&&lk(c)}catch(c){if(!(c instanceof SyntaxError))throw c;try{q1("Attempting to parse %s as an SDK version",o),isNaN(_ue(o,ire))||(En.clientSupportedSDKVersion=o);let d=JSON.parse(u);if(q1("givenRuntimeConfig parsed to %o",d??"null"),!d)throw new Error("givenRuntimeConfig string was successfully parsed. However, it parsed to value of null");d=tre(d),lk(d)}catch(d){if(!(d instanceof SyntaxError))throw d;lk(vEe(En.clientSupportedSDKVersion,mEe,bEe))}}En.initializeCompleted=!0})),ZEe(),rIe(),XEe()),Array.isArray(t)&&BEe(t),En.initializePromise!==void 0?i(En.initializePromise):q1("GlobalVars.initializePromise is unexpectedly undefined")}))})(e,n)),6e4,new Error("SDK initialization timed out."))}const q1=zue.extend("initializeHelper");function fIe(){return mIe(ar(Cc,"pages.backStack.navigateBack"))}function hIe(){return!(!jc(gs)||!gs.supports.pages)&&!!gs.supports.pages.backStack}const Cc="v2";function mIe(e){return new Promise((n=>{if(jc(gs),!hIe())throw EI;n(REe(e,"navigateBack","Back navigation is not supported in the current client or context."))}))}function pIe(e,n){if(jc(gs,Ha.settings,Ha.remove),!CL())throw EI;Vo(e,"settings.setValidityState",[n])}function gIe(e,n){return new Promise((a=>{if(jc(gs,Ha.content,Ha.settings,Ha.sidePanel),!CL())throw EI;a(IEe(e,"settings.setSettings",n))}))}function yIe(){Ug(ar("v2","pages.backStack.registerBackButtonPressHandler"),"backButtonPress",bIe,!1)}function bIe(){fIe()}const vIe=Fc("handlers");let Lr=class bc{static initializeHandlers(){bc.handlers.themeChange=TIe,bc.handlers.load=wIe,bc.handlers.beforeUnload=OIe,yIe()}static uninitializeHandlers(){bc.handlers={},bc.themeChangeHandler=null,bc.loadHandler=null,bc.beforeUnloadHandler=null,bc.beforeSuspendOrTerminateHandler=null,bc.resumeHandler=null}};function SIe(){Lr.initializeHandlers()}Lr.handlers={},Lr.themeChangeHandler=null,Lr.loadHandler=null,Lr.beforeUnloadHandler=null,Lr.beforeSuspendOrTerminateHandler=null,Lr.resumeHandler=null,Lr.hostToAppPerformanceMetricsHandler=null;const yre=vIe.extend("callHandler");function CIe(e,n){const a=Lr.handlers[e];return a?(yre("Invoking the registered handler for message %s with arguments %o",e,n),[!0,a.apply(this,n)]):(yre("Handler for action message %s not found.",e),[!1,void 0])}function Ug(e,n,a,t=!0,i=[]){a?(Lr.handlers[n]=a,t&&Vo(e,"registerHandler",[n,...i])):delete Lr.handlers[n]}function _Ie(e){delete Lr.handlers[e]}function TIe(e){Lr.themeChangeHandler&&Lr.themeChangeHandler(e)}function bre(e){Lr.hostToAppPerformanceMetricsHandler&&Lr.hostToAppPerformanceMetricsHandler(e)}function wIe(e){const n={entityId:(a=e).entityId,contentUrl:new URL(a.contentUrl)};var a;Lr.resumeHandler?(Lr.resumeHandler(n),vre()):Lr.loadHandler&&(Lr.loadHandler(e),vre())}function OIe(){return qT(this,void 0,void 0,(function*(){const e=()=>{Vo(ar("v2","handleBeforeUnload"),"readyToUnload",[])};Lr.beforeSuspendOrTerminateHandler?(yield Lr.beforeSuspendOrTerminateHandler(),e()):Lr.beforeUnloadHandler&&Lr.beforeUnloadHandler(e)||e()}))}const PIe=Fc("childProxyingCommunication");function vre(){return!1}function EIe(e,n){return!1}PIe.extend("handleIncomingMessageFromChild");const il="v2";var Sre,Cre;function IIe(){return!(!jc(gs,Ha.meetingStage,Ha.sidePanel,Ha.content)||!gs.supports.interactive)}(function(e){e.guest="Guest",e.attendee="Attendee",e.presenter="Presenter",e.organizer="Organizer"})(Sre||(Sre={})),(function(e){e.added="Added",e.alreadyExists="AlreadyExists",e.conflict="Conflict",e.notFound="NotFound"})(Cre||(Cre={}));class _L{getFluidTenantInfo(){return cd(),new Promise((n=>{n(rl(ar(il,"interactive.getFluidTenantInfo"),"interactive.getFluidTenantInfo"))}))}getFluidToken(n){return cd(),new Promise((a=>{a(rl(ar(il,"interactive.getFluidToken"),"interactive.getFluidToken",n))}))}getFluidContainerId(){return cd(),new Promise((n=>{n(rl(ar(il,"interactive.getFluidContainerId"),"interactive.getFluidContainerId"))}))}setFluidContainerId(n){return cd(),new Promise((a=>{a(rl(ar(il,"interactive.setFluidContainerId"),"interactive.setFluidContainerId",n))}))}getNtpTime(){return cd(),new Promise((n=>{n(rl(ar(il,"interactive.getNtpTime"),"interactive.getNtpTime"))}))}registerClientId(n){return cd(),new Promise((a=>{a(rl(ar(il,"interactive.registerClientId"),"interactive.registerClientId",n))}))}getClientRoles(n){return cd(),new Promise((a=>{a(rl(ar(il,"interactive.getClientRoles"),"interactive.getClientRoles",n))}))}getClientInfo(n){return cd(),new Promise((a=>{a(rl(ar(il,"interactive.getClientInfo"),"interactive.getClientInfo",n))}))}static create(){return cd(),new _L}}function cd(){if(!IIe())throw new Error("LiveShareHost Not supported")}const Vue=Et.createContext({context:null,isLoading:!0,isInTeams:!1,error:null}),TL=()=>{const e=Et.useContext(Vue);if(!e)throw new Error("useTeams must be used within a TeamsProvider");return e},RIe=({children:e})=>{const[n,a]=Et.useState(null),[t,i]=Et.useState(!0),[r,s]=Et.useState(!1),[o,u]=Et.useState(null);Et.useEffect(()=>{(async()=>{console.log("[TEAMS PROVIDER]  Starting Teams SDK initialization..."),console.log("[TEAMS PROVIDER]  Current URL:",window.location.href),console.log("[TEAMS PROVIDER]  Current hash:",window.location.hash),console.log("[TEAMS PROVIDER]  User agent:",navigator.userAgent),console.log("[TEAMS PROVIDER]  Referrer:",document.referrer);const l=window!==window.top;console.log("[TEAMS PROVIDER]  In iframe:",l);const f=typeof window<"u"&&window.microsoftTeams;console.log("[TEAMS PROVIDER]  Teams JS available:",f);try{console.log("[TEAMS PROVIDER]  Attempting Teams SDK initialization..."),await GEe(),console.log("[TEAMS PROVIDER]  Teams SDK initialized successfully"),console.log("[TEAMS PROVIDER]  Getting Teams context...");const b=await WEe();console.log("[TEAMS PROVIDER]  Teams context received:",{frameContext:b?.page?.frameContext,entityId:b?.page?.id,userId:b?.user?.id,userName:b?.user?.displayName,teamId:b?.team?.internalId,channelId:b?.channel?.id,locale:b?.app?.locale,theme:b?.app?.theme}),a(b),s(!0),u(null),console.log("[TEAMS PROVIDER]  Teams initialization complete")}catch(b){console.warn("[TEAMS PROVIDER]  Teams initialization failed:",b),console.log("[TEAMS PROVIDER]  Error details:",{message:b instanceof Error?b.message:"Unknown error",stack:b instanceof Error?b.stack:void 0,inIframe:l,teamsJsAvailable:f,url:window.location.href}),s(!1),u(b instanceof Error?b.message:"Failed to initialize Teams"),console.log("[TEAMS PROVIDER]  Creating development context..."),a({app:{locale:"en-US",theme:"default",sessionId:"dev-session",host:{name:"Teams",clientType:"desktop"}},page:{id:"dev-page",frameContext:"content"},user:{id:"dev-user-"+Math.random().toString(36).substr(2,9),displayName:"Development User",userPrincipalName:"dev@example.com"},channel:{id:"dev-channel",displayName:"Development Channel"},team:{internalId:"dev-team",displayName:"Development Team"}}),console.log("[TEAMS PROVIDER]  Development context created")}finally{i(!1),console.log("[TEAMS PROVIDER]  Initialization process complete")}})()},[]);const c={context:n,isLoading:t,isInTeams:r,error:o};return console.log("[TEAMS PROVIDER]  Current state:",{isLoading:t,isInTeams:r,hasContext:!!n,error:o}),Dt.jsx(Vue.Provider,{value:c,children:e})},_re=()=>{const{context:e,isLoading:n,isInTeams:a,error:t}=TL(),{joined:i}=rue();return Et.useEffect(()=>{console.log("[SIDE PANEL]  Side Panel View mounted"),console.log("[SIDE PANEL]  Teams state:",{isLoading:n,isInTeams:a,error:t,hasContext:!!e}),console.log("[SIDE PANEL]  Live Share state:",{joined:i}),console.log("[SIDE PANEL]  Current route:",window.location.hash)},[n,a,t,e,i]),n?(console.log("[SIDE PANEL]  Showing loading state"),Dt.jsxs("div",{style:{padding:"32px",textAlign:"center",fontFamily:"Segoe UI, sans-serif",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[Dt.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #0078d4",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"16px"}}),Dt.jsx("div",{children:" Loading..."}),Dt.jsx("p",{children:"Initializing Personal Whiteboard..."})]})):i?(console.log("[SIDE PANEL]  Rendering main side panel interface"),Dt.jsxs("div",{style:{fontFamily:"Segoe UI, sans-serif",height:"100vh",display:"flex",flexDirection:"column",backgroundColor:"#f5f5f5"},children:[Dt.jsxs("div",{style:{backgroundColor:"white",padding:"16px",borderBottom:"1px solid #e1e1e1",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[Dt.jsx("h2",{style:{margin:"0",color:"#323130",fontSize:"18px"},children:" Personal Whiteboard"}),Dt.jsxs("div",{style:{fontSize:"12px",color:"#605e5c",marginTop:"4px"},children:[a?" Connected to Teams":" Development Mode"," ",i?" Live Share Connected":" Live Share Offline"," ",e?.user?.displayName||"Unknown User"]}),t&&Dt.jsxs("div",{style:{fontSize:"11px",color:"#d13438",marginTop:"4px",backgroundColor:"#fdf2f2",padding:"4px 8px",borderRadius:"4px"},children:["Teams Error: ",t]})]}),Dt.jsxs("div",{style:{flex:1,padding:"16px",display:"flex",flexDirection:"column",gap:"16px"},children:[Dt.jsxs("div",{style:{backgroundColor:"white",padding:"12px",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",display:"flex",gap:"8px",alignItems:"center"},children:[Dt.jsx("button",{style:{padding:"8px 12px",backgroundColor:"#0078d4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:" Pen"}),Dt.jsx("button",{style:{padding:"8px 12px",backgroundColor:"white",color:"#323130",border:"1px solid #d1d1d1",borderRadius:"4px",cursor:"pointer"},children:" Highlighter"}),Dt.jsx("button",{style:{padding:"8px 12px",backgroundColor:"white",color:"#323130",border:"1px solid #d1d1d1",borderRadius:"4px",cursor:"pointer"},children:" Eraser"}),Dt.jsx("div",{style:{width:"1px",height:"24px",backgroundColor:"#d1d1d1"}}),Dt.jsx("button",{style:{padding:"8px 12px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:" Clear"})]}),Dt.jsx("div",{style:{flex:1,backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"300px",border:"2px dashed #d1d1d1"},children:Dt.jsxs("div",{style:{textAlign:"center",color:"#666"},children:[Dt.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),Dt.jsx("div",{style:{fontSize:"16px",marginBottom:"8px"},children:"Personal Drawing Canvas"}),Dt.jsx("div",{style:{fontSize:"14px"},children:"Start drawing your private notes here"}),Dt.jsxs("div",{style:{fontSize:"12px",marginTop:"8px",color:"#999"},children:["Route: ",window.location.hash||"/"," | Teams: ",a?"Yes":"No"," | Live Share: ",i?"Connected":"Disconnected"]})]})}),Dt.jsxs("div",{style:{backgroundColor:"white",padding:"16px",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[Dt.jsx("button",{style:{width:"100%",padding:"12px",backgroundColor:i?"#0078d4":"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:i?"pointer":"not-allowed",fontSize:"16px",fontWeight:"600"},disabled:!i,onClick:()=>{console.log("[SIDE PANEL]  Share to Stage clicked"),i&&alert("Share to Stage functionality would be implemented here")},children:" Share to Stage"}),Dt.jsx("div",{style:{fontSize:"12px",color:"#605e5c",textAlign:"center",marginTop:"8px"},children:i?"Presenters can share your whiteboard with all meeting participants":"Live Share connection required to share content"})]})]})]})):(console.log("[SIDE PANEL]  Showing Live Share connection state"),Dt.jsxs("div",{style:{padding:"32px",textAlign:"center",fontFamily:"Segoe UI, sans-serif",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[Dt.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #0078d4",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"16px"}}),Dt.jsx("div",{children:" Connecting..."}),Dt.jsx("p",{children:"Joining collaboration session..."}),Dt.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"16px"},children:"If this persists, you may be accessing outside Teams context"})]}))},FIe=()=>{const{joined:e}=rue(),[n,a]=Et.useState("Jane Smith"),t=[{id:"1",name:"John Doe",hasCanvas:!0,preview:""},{id:"2",name:"Jane Smith",hasCanvas:!0,preview:""},{id:"3",name:"Mike Johnson",hasCanvas:!0,preview:""},{id:"4",name:"Sarah Wilson",hasCanvas:!0,preview:""}];if(!e)return Dt.jsxs("div",{style:{padding:"32px",textAlign:"center"},children:[Dt.jsx("div",{children:" Connecting..."}),Dt.jsx("p",{children:"Joining collaboration session..."})]});const i=s=>{a(s),console.log(`Selected participant: ${s}`)},r=()=>{window.confirm("Hide whiteboard from stage? This will remove it from all meeting participants.")&&console.log("Hiding from stage...")};return Dt.jsxs("div",{style:{fontFamily:"Segoe UI, sans-serif",height:"100vh",display:"flex",flexDirection:"column",backgroundColor:"#f5f5f5"},children:[Dt.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",backgroundColor:"white",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",borderBottom:"1px solid #e1e1e1"},children:[Dt.jsx("h2",{style:{margin:"0",color:"#323130",fontSize:"24px"},children:" Shared Whiteboard"}),Dt.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[Dt.jsx("button",{onClick:()=>{const o=(t.findIndex(u=>u.name===n)-1+t.length)%t.length;i(t[o].name)},style:{padding:"8px 16px",border:"1px solid #d1d1d1",borderRadius:"4px",backgroundColor:"white",cursor:"pointer"},children:" Previous"}),Dt.jsx("button",{onClick:()=>{const o=(t.findIndex(u=>u.name===n)+1)%t.length;i(t[o].name)},style:{padding:"8px 16px",border:"1px solid #d1d1d1",borderRadius:"4px",backgroundColor:"white",cursor:"pointer"},children:" Next"}),Dt.jsx("button",{onClick:r,style:{padding:"8px 16px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:" Hide from Stage"})]})]}),Dt.jsxs("div",{style:{textAlign:"center",padding:"12px",backgroundColor:"#e3f2fd",color:"#1976d2",fontSize:"16px"},children:["Currently showing: ",Dt.jsx("strong",{children:n}),"'s whiteboard"]}),Dt.jsx("div",{style:{flex:1,margin:"16px",border:"3px solid #0078d4",borderRadius:"8px",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:Dt.jsxs("div",{style:{textAlign:"center",color:"#666"},children:[Dt.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),Dt.jsxs("div",{style:{fontSize:"18px",marginBottom:"8px"},children:[n,"'s Whiteboard"]}),Dt.jsx("div",{style:{fontSize:"14px"},children:"Selected participant's canvas content would appear here"})]})}),Dt.jsxs("div",{style:{margin:"16px",padding:"16px",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[Dt.jsx("div",{style:{margin:"0 0 12px 0",fontSize:"14px",color:"#323130",fontWeight:"600"},children:"Select participant to display:"}),Dt.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"center",flexWrap:"wrap"},children:t.map(s=>Dt.jsxs("div",{onClick:()=>i(s.name),style:{width:"100px",height:"80px",border:n===s.name?"2px solid #0078d4":"2px solid #d1d1d1",borderRadius:"6px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:n===s.name?"#f3f8ff":"white",padding:"8px",boxSizing:"border-box",transition:"border-color 0.2s"},children:[Dt.jsx("div",{style:{width:"60px",height:"40px",backgroundColor:"#f9f9f9",border:"1px solid #e1e1e1",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:"#666"},children:s.preview}),Dt.jsx("div",{style:{marginTop:"4px",fontWeight:"500",fontSize:"12px",textAlign:"center"},children:s.name})]},s.id))})]})]})},jIe=()=>{const{context:e,isInTeams:n}=TL(),[a,t]=Et.useState(!1),[i,r]=Et.useState(null);Et.useEffect(()=>{n&&(console.log("[CONFIG]  Initializing Teams config page..."),sIe(o=>{console.log("[CONFIG]  Save handler called");const c={contentUrl:window.location.origin+"/personal-whiteboard-app/dist"+"/stage.html",entityId:"personalWhiteboard",suggestedDisplayName:"Personal Whiteboard"};console.log("[CONFIG]  Setting config:",c),iIe(c),console.log("[CONFIG]  Notifying save success"),o.notifySuccess()}),console.log("[CONFIG]  Setting validity state to true"),gre(!0))},[n]);const s=()=>{t(!0),r(null),setTimeout(()=>{t(!1),n?(r({message:" Configuration saved successfully! You can now use Personal Whiteboard in your meetings.",type:"success"}),setTimeout(()=>{try{gre(!0)}catch{console.log("Not in Teams configuration environment")}},2e3)):r({message:" Configuration saved, but not running in Teams environment",type:"error"})},1500)};return Dt.jsxs("div",{style:{fontFamily:"Segoe UI, sans-serif",backgroundColor:"#f5f5f5",minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px",boxSizing:"border-box"},children:[Dt.jsxs("div",{style:{backgroundColor:"white",padding:"32px",borderRadius:"12px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",maxWidth:"500px",width:"100%",textAlign:"center"},children:[Dt.jsx("h1",{style:{margin:"0 0 16px 0",color:"#323130",fontSize:"28px"},children:" Personal Whiteboard"}),Dt.jsx("div",{style:{color:"#605e5c",fontSize:"16px",marginBottom:"32px",lineHeight:"1.4"},children:"Configure this app to enhance your Teams meetings with personal whiteboards and presenter sharing capabilities."}),Dt.jsx("ul",{style:{textAlign:"left",margin:"24px 0",padding:"0",listStyle:"none"},children:[{title:"Personal Whiteboards",desc:"Each participant gets a private drawing space"},{title:"Presenter Controls",desc:"Share selected whiteboards to the meeting stage"},{title:"Privacy First",desc:"All drawings are session-only and explicitly shared"},{title:"Easy to Use",desc:"Simple drawing tools with intuitive interface"}].map((o,u)=>Dt.jsxs("li",{style:{margin:"12px 0",padding:"12px 16px",background:"#f3f2f1",borderRadius:"6px",borderLeft:"4px solid #0078d4"},children:[Dt.jsxs("strong",{children:[o.title,":"]})," ",o.desc]},u))}),Dt.jsx("button",{onClick:s,disabled:a,style:{backgroundColor:a?"#d1d1d1":"#0078d4",color:"white",border:"none",padding:"16px 32px",borderRadius:"6px",cursor:a?"not-allowed":"pointer",fontSize:"16px",fontWeight:"600",marginTop:"24px",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%"},children:a?Dt.jsxs(Dt.Fragment,{children:[Dt.jsx("div",{style:{width:"20px",height:"20px",border:"3px solid #f3f3f3",borderTop:"3px solid #0078d4",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Saving..."]}):"Save Configuration"}),i&&Dt.jsx("div",{style:{marginTop:"16px",padding:"12px",borderRadius:"6px",fontWeight:"500",backgroundColor:i.type==="success"?"#d4edda":"#f8d7da",color:i.type==="success"?"#155724":"#721c24",border:`1px solid ${i.type==="success"?"#c3e6cb":"#f5c6cb"}`},children:i.message}),Dt.jsxs("div",{style:{marginTop:"16px",fontSize:"12px",color:"#605e5c"},children:[n?" Running in Teams environment":" Development mode - not connected to Teams",e?.user?.displayName&&Dt.jsxs(Dt.Fragment,{children:["  User: ",e.user.displayName]})]})]}),Dt.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})};class MIe extends hs.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[ERROR BOUNDARY]  Error caught:",n,a)}render(){return this.state.hasError?Dt.jsxs("div",{style:{padding:"32px",textAlign:"center",fontFamily:"Segoe UI, sans-serif",color:"#721c24",backgroundColor:"#f8d7da",border:"1px solid #f5c6cb",borderRadius:"8px",margin:"16px"},children:[Dt.jsx("h2",{children:" Something went wrong"}),Dt.jsx("p",{children:"The Personal Whiteboard app encountered an error."}),this.state.error&&Dt.jsxs("details",{style:{marginTop:"16px",textAlign:"left"},children:[Dt.jsx("summary",{children:"Error Details"}),Dt.jsxs("pre",{style:{background:"#fff",padding:"16px",borderRadius:"4px",fontSize:"12px",overflow:"auto"},children:[this.state.error.message,this.state.error.stack]})]}),Dt.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"16px",padding:"8px 16px",backgroundColor:"#0078d4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reload App"})]}):this.props.children}}const NIe=()=>{const{isLoading:e,isInTeams:n,error:a}=TL(),[t,i]=Et.useState(null),[r,s]=Et.useState(null),[o,u]=Et.useState(!1);return Et.useEffect(()=>{!e&&!t&&!o&&(console.log("[APP]  Teams initialization complete, creating Live Share Host..."),console.log("[APP]  Teams state:",{teamsLoading:e,isInTeams:n,teamsError:a}),console.log("[APP]  Environment check:",{url:window.location.href,hash:window.location.hash,inIframe:window!==window.top,teamsJsAvailable:typeof window.microsoftTeams<"u"}),u(!0),setTimeout(()=>{(()=>{try{console.log("[APP]  Creating Live Share Host...");const d=_L.create();console.log("[APP]  Live Share Host created successfully:",d),i(d),s(null)}catch(d){console.error("[APP]  Failed to create Live Share Host:",d);const l=d instanceof Error?d.message:"Failed to create Live Share Host";s(l),console.log("[APP]  Creating development mock host..."),i({create:()=>console.log("Mock Live Share Host"),role:"Local",serviceEndpoint:"localhost",getFluidTenantInfo:()=>Promise.resolve({tenantId:"mock-tenant-id",serviceEndpoint:"https://localhost"}),getFluidToken:()=>Promise.resolve("mock-token"),getFluidContainerId:()=>Promise.resolve("mock-container-id"),setFluidContainerId:()=>Promise.resolve(),getNtpTimeAsync:()=>Promise.resolve(Date.now()),registerClientId:()=>"mock-client-id",getClientRoles:()=>["Local"],getClientInfo:()=>Promise.resolve([]),on:()=>{},off:()=>{},removeAllListeners:()=>{}})}finally{u(!1)}})()},500))},[e,n,a,t,o]),e||o?(console.log("[APP]  Showing loading state - Teams:",e,"Host:",o),Dt.jsx("div",{style:{padding:"32px",textAlign:"center",fontFamily:"Segoe UI, sans-serif",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:Dt.jsxs("div",{children:[Dt.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #0078d4",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),Dt.jsx("div",{children:e?" Initializing Teams...":" Setting up Live Share..."}),Dt.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:e?"Connecting to Teams platform":"Creating collaboration host"})]})})):r&&!t?Dt.jsx("div",{style:{padding:"32px",textAlign:"center",fontFamily:"Segoe UI, sans-serif",color:"#721c24",backgroundColor:"#f8d7da",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:Dt.jsxs("div",{children:[Dt.jsx("h2",{children:" Live Share Host Error"}),Dt.jsxs("p",{children:["Failed to initialize Live Share: ",r]}),Dt.jsx("p",{children:Dt.jsx("small",{children:"This is expected when running outside of Teams"})}),Dt.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",backgroundColor:"#0078d4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Retry"})]})}):t?(console.log("[APP]  Rendering App with host:",t),Dt.jsx(PPe,{host:t,joinOnLoad:!0,children:Dt.jsx(Efe,{children:Dt.jsx("div",{className:"App",children:Dt.jsxs(ife,{children:[Dt.jsx(L1,{path:"/sidepanel",element:Dt.jsx(_re,{})}),Dt.jsx(L1,{path:"/stage",element:Dt.jsx(FIe,{})}),Dt.jsx(L1,{path:"/config",element:Dt.jsx(jIe,{})}),Dt.jsx(L1,{path:"/",element:Dt.jsx(_re,{})})]})})})})):Dt.jsx("div",{style:{padding:"32px",textAlign:"center",fontFamily:"Segoe UI, sans-serif",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:Dt.jsxs("div",{children:[Dt.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #0078d4",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),Dt.jsx("div",{children:"Initializing Live Share..."})]})})};function AIe(){return console.log("[APP]  App component mounting"),Dt.jsx(MIe,{children:Dt.jsx(RIe,{children:Dt.jsx(NIe,{})})})}hle.createRoot(document.getElementById("root")).render(Dt.jsx(Et.StrictMode,{children:Dt.jsx(AIe,{})}));export{uT as a,ud as c,iE as g,Xk as r};
